var hA=Object.defineProperty;var Rk=(n,e,t)=>e in n?hA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e)=>hA(n,"name",{value:e,configurable:!0});var S=(n,e,t)=>(Rk(n,typeof e!="symbol"?e+"":e,t),t);const Ik=u(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}u(t,"getFetchOpts");function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}u(i,"processPreload")},"polyfill");Ik();function j_(n,e){const t=Object.create(null),i=n.split(",");for(let s=0;s<i.length;s++)t[i[s]]=!0;return e?s=>!!t[s.toLowerCase()]:s=>!!t[s]}u(j_,"makeMap");function ti(n){if(ut(n)){const e={};for(let t=0;t<n.length;t++){const i=n[t],s=$n(i)?kk(i):ti(i);if(s)for(const r in s)e[r]=s[r]}return e}else{if($n(n))return n;if(vn(n))return n}}u(ti,"normalizeStyle");const Dk=/;(?![^(]*\))/g,Lk=/:([^]+)/,Ok=/\/\*.*?\*\//gs;function kk(n){const e={};return n.replace(Ok,"").split(Dk).forEach(t=>{if(t){const i=t.split(Lk);i.length>1&&(e[i[0].trim()]=i[1].trim())}}),e}u(kk,"parseStringStyle");function bn(n){let e="";if($n(n))e=n;else if(ut(n))for(let t=0;t<n.length;t++){const i=bn(n[t]);i&&(e+=i+" ")}else if(vn(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}u(bn,"normalizeClass");const Nk="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Fk=j_(Nk);function VE(n){return!!n||n===""}u(VE,"includeBooleanAttr");const Tn=u(n=>$n(n)?n:n==null?"":ut(n)||vn(n)&&(n.toString===jE||!dt(n.toString))?JSON.stringify(n,GE,2):String(n),"toDisplayString"),GE=u((n,e)=>e&&e.__v_isRef?GE(n,e.value):du(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[i,s])=>(t[`${i} =>`]=s,t),{})}:HE(e)?{[`Set(${e.size})`]:[...e.values()]}:vn(e)&&!ut(e)&&!XE(e)?String(e):e,"replacer"),ln={},fu=[],fr=u(()=>{},"NOOP"),zk=u(()=>!1,"NO"),Bk=/^on[^a-z]/,r0=u(n=>Bk.test(n),"isOn"),X_=u(n=>n.startsWith("onUpdate:"),"isModelListener"),Qi=Object.assign,Y_=u((n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},"remove"),Uk=Object.prototype.hasOwnProperty,kt=u((n,e)=>Uk.call(n,e),"hasOwn"),ut=Array.isArray,du=u(n=>o0(n)==="[object Map]","isMap"),HE=u(n=>o0(n)==="[object Set]","isSet"),dt=u(n=>typeof n=="function","isFunction"),$n=u(n=>typeof n=="string","isString"),q_=u(n=>typeof n=="symbol","isSymbol"),vn=u(n=>n!==null&&typeof n=="object","isObject"),WE=u(n=>vn(n)&&dt(n.then)&&dt(n.catch),"isPromise"),jE=Object.prototype.toString,o0=u(n=>jE.call(n),"toTypeString"),$k=u(n=>o0(n).slice(8,-1),"toRawType"),XE=u(n=>o0(n)==="[object Object]","isPlainObject"),Z_=u(n=>$n(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,"isIntegerKey"),gg=j_(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),a0=u(n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},"cacheStringFunction"),Vk=/-(\w)/g,Vr=a0(n=>n.replace(Vk,(e,t)=>t?t.toUpperCase():"")),Gk=/\B([A-Z])/g,tc=a0(n=>n.replace(Gk,"-$1").toLowerCase()),l0=a0(n=>n.charAt(0).toUpperCase()+n.slice(1)),M1=a0(n=>n?`on${l0(n)}`:""),cd=u((n,e)=>!Object.is(n,e),"hasChanged"),vg=u((n,e)=>{for(let t=0;t<n.length;t++)n[t](e)},"invokeArrayFns"),Dg=u((n,e,t)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value:t})},"def"),Lg=u(n=>{const e=parseFloat(n);return isNaN(e)?n:e},"toNumber");let fA;const Hk=u(()=>fA||(fA=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{}),"getGlobalThis");let Pr;class YE{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Pr,!e&&Pr&&(this.index=(Pr.scopes||(Pr.scopes=[])).push(this)-1)}run(e){if(this.active){const t=Pr;try{return Pr=this,e()}finally{Pr=t}}}on(){Pr=this}off(){Pr=this.parent}stop(e){if(this.active){let t,i;for(t=0,i=this.effects.length;t<i;t++)this.effects[t].stop();for(t=0,i=this.cleanups.length;t<i;t++)this.cleanups[t]();if(this.scopes)for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this.active=!1}}}u(YE,"EffectScope");function Wk(n,e=Pr){e&&e.active&&e.effects.push(n)}u(Wk,"recordEffectScope");const K_=u(n=>{const e=new Set(n);return e.w=0,e.n=0,e},"createDep"),qE=u(n=>(n.w&Da)>0,"wasTracked"),ZE=u(n=>(n.n&Da)>0,"newTracked"),jk=u(({deps:n})=>{if(n.length)for(let e=0;e<n.length;e++)n[e].w|=Da},"initDepMarkers"),Xk=u(n=>{const{deps:e}=n;if(e.length){let t=0;for(let i=0;i<e.length;i++){const s=e[i];qE(s)&&!ZE(s)?s.delete(n):e[t++]=s,s.w&=~Da,s.n&=~Da}e.length=t}},"finalizeDepMarkers"),jy=new WeakMap;let Nf=0,Da=1;const Xy=30;let lr;const kl=Symbol(""),Yy=Symbol("");class c0{constructor(e,t=null,i){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,Wk(this,i)}run(){if(!this.active)return this.fn();let e=lr,t=Ca;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=lr,lr=this,Ca=!0,Da=1<<++Nf,Nf<=Xy?jk(this):dA(this),this.fn()}finally{Nf<=Xy&&Xk(this),Da=1<<--Nf,lr=this.parent,Ca=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){lr===this?this.deferStop=!0:this.active&&(dA(this),this.onStop&&this.onStop(),this.active=!1)}}u(c0,"ReactiveEffect");function dA(n){const{deps:e}=n;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(n);e.length=0}}u(dA,"cleanupEffect");let Ca=!0;const KE=[];function oh(){KE.push(Ca),Ca=!1}u(oh,"pauseTracking");function ah(){const n=KE.pop();Ca=n===void 0?!0:n}u(ah,"resetTracking");function Is(n,e,t){if(Ca&&lr){let i=jy.get(n);i||jy.set(n,i=new Map);let s=i.get(t);s||i.set(t,s=K_()),QE(s)}}u(Is,"track");function QE(n,e){let t=!1;Nf<=Xy?ZE(n)||(n.n|=Da,t=!qE(n)):t=!n.has(lr),t&&(n.add(lr),lr.deps.push(n))}u(QE,"trackEffects");function Io(n,e,t,i,s,r){const o=jy.get(n);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(t==="length"&&ut(n)){const l=Lg(i);o.forEach((c,h)=>{(h==="length"||h>=l)&&a.push(c)})}else switch(t!==void 0&&a.push(o.get(t)),e){case"add":ut(n)?Z_(t)&&a.push(o.get("length")):(a.push(o.get(kl)),du(n)&&a.push(o.get(Yy)));break;case"delete":ut(n)||(a.push(o.get(kl)),du(n)&&a.push(o.get(Yy)));break;case"set":du(n)&&a.push(o.get(kl));break}if(a.length===1)a[0]&&qy(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);qy(K_(l))}}u(Io,"trigger");function qy(n,e){const t=ut(n)?n:[...n];for(const i of t)i.computed&&pA(i);for(const i of t)i.computed||pA(i)}u(qy,"triggerEffects");function pA(n,e){(n!==lr||n.allowRecurse)&&(n.scheduler?n.scheduler():n.run())}u(pA,"triggerEffect");const Yk=j_("__proto__,__v_isRef,__isVue"),JE=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(q_)),qk=Q_(),Zk=Q_(!1,!0),Kk=Q_(!0),mA=Qk();function Qk(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const i=nt(this);for(let r=0,o=this.length;r<o;r++)Is(i,"get",r+"");const s=i[e](...t);return s===-1||s===!1?i[e](...t.map(nt)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){oh();const i=nt(this)[e].apply(this,t);return ah(),i}}),n}u(Qk,"createArrayInstrumentations");function Q_(n=!1,e=!1){return u(function(i,s,r){if(s==="__v_isReactive")return!n;if(s==="__v_isReadonly")return n;if(s==="__v_isShallow")return e;if(s==="__v_raw"&&r===(n?e?pN:sT:e?iT:nT).get(i))return i;const o=ut(i);if(!n&&o&&kt(mA,s))return Reflect.get(mA,s,r);const a=Reflect.get(i,s,r);return(q_(s)?JE.has(s):Yk(s))||(n||Is(i,"get",s),e)?a:Pi(a)?o&&Z_(s)?a:a.value:vn(a)?n?rT(a):To(a):a},"get")}u(Q_,"createGetter");const Jk=eT(),eN=eT(!0);function eT(n=!1){return u(function(t,i,s,r){let o=t[i];if(xu(o)&&Pi(o)&&!Pi(s))return!1;if(!n&&(!Og(s)&&!xu(s)&&(o=nt(o),s=nt(s)),!ut(t)&&Pi(o)&&!Pi(s)))return o.value=s,!0;const a=ut(t)&&Z_(i)?Number(i)<t.length:kt(t,i),l=Reflect.set(t,i,s,r);return t===nt(r)&&(a?cd(s,o)&&Io(t,"set",i,s):Io(t,"add",i,s)),l},"set")}u(eT,"createSetter");function tN(n,e){const t=kt(n,e);n[e];const i=Reflect.deleteProperty(n,e);return i&&t&&Io(n,"delete",e,void 0),i}u(tN,"deleteProperty");function nN(n,e){const t=Reflect.has(n,e);return(!q_(e)||!JE.has(e))&&Is(n,"has",e),t}u(nN,"has");function iN(n){return Is(n,"iterate",ut(n)?"length":kl),Reflect.ownKeys(n)}u(iN,"ownKeys");const tT={get:qk,set:Jk,deleteProperty:tN,has:nN,ownKeys:iN},sN={get:Kk,set(n,e){return!0},deleteProperty(n,e){return!0}},rN=Qi({},tT,{get:Zk,set:eN}),J_=u(n=>n,"toShallow"),u0=u(n=>Reflect.getPrototypeOf(n),"getProto");function up(n,e,t=!1,i=!1){n=n.__v_raw;const s=nt(n),r=nt(e);t||(e!==r&&Is(s,"get",e),Is(s,"get",r));const{has:o}=u0(s),a=i?J_:t?nb:ud;if(o.call(s,e))return a(n.get(e));if(o.call(s,r))return a(n.get(r));n!==s&&n.get(e)}u(up,"get$1");function hp(n,e=!1){const t=this.__v_raw,i=nt(t),s=nt(n);return e||(n!==s&&Is(i,"has",n),Is(i,"has",s)),n===s?t.has(n):t.has(n)||t.has(s)}u(hp,"has$1");function fp(n,e=!1){return n=n.__v_raw,!e&&Is(nt(n),"iterate",kl),Reflect.get(n,"size",n)}u(fp,"size");function gA(n){n=nt(n);const e=nt(this);return u0(e).has.call(e,n)||(e.add(n),Io(e,"add",n,n)),this}u(gA,"add$4");function vA(n,e){e=nt(e);const t=nt(this),{has:i,get:s}=u0(t);let r=i.call(t,n);r||(n=nt(n),r=i.call(t,n));const o=s.call(t,n);return t.set(n,e),r?cd(e,o)&&Io(t,"set",n,e):Io(t,"add",n,e),this}u(vA,"set$1");function yA(n){const e=nt(this),{has:t,get:i}=u0(e);let s=t.call(e,n);s||(n=nt(n),s=t.call(e,n)),i&&i.call(e,n);const r=e.delete(n);return s&&Io(e,"delete",n,void 0),r}u(yA,"deleteEntry");function _A(){const n=nt(this),e=n.size!==0,t=n.clear();return e&&Io(n,"clear",void 0,void 0),t}u(_A,"clear");function dp(n,e){return u(function(i,s){const r=this,o=r.__v_raw,a=nt(o),l=e?J_:n?nb:ud;return!n&&Is(a,"iterate",kl),o.forEach((c,h)=>i.call(s,l(c),l(h),r))},"forEach")}u(dp,"createForEach");function pp(n,e,t){return function(...i){const s=this.__v_raw,r=nt(s),o=du(r),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...i),h=t?J_:e?nb:ud;return!e&&Is(r,"iterate",l?Yy:kl),{next(){const{value:f,done:d}=c.next();return d?{value:f,done:d}:{value:a?[h(f[0]),h(f[1])]:h(f),done:d}},[Symbol.iterator](){return this}}}}u(pp,"createIterableMethod");function Wo(n){return function(...e){return n==="delete"?!1:this}}u(Wo,"createReadonlyMethod");function oN(){const n={get(r){return up(this,r)},get size(){return fp(this)},has:hp,add:gA,set:vA,delete:yA,clear:_A,forEach:dp(!1,!1)},e={get(r){return up(this,r,!1,!0)},get size(){return fp(this)},has:hp,add:gA,set:vA,delete:yA,clear:_A,forEach:dp(!1,!0)},t={get(r){return up(this,r,!0)},get size(){return fp(this,!0)},has(r){return hp.call(this,r,!0)},add:Wo("add"),set:Wo("set"),delete:Wo("delete"),clear:Wo("clear"),forEach:dp(!0,!1)},i={get(r){return up(this,r,!0,!0)},get size(){return fp(this,!0)},has(r){return hp.call(this,r,!0)},add:Wo("add"),set:Wo("set"),delete:Wo("delete"),clear:Wo("clear"),forEach:dp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=pp(r,!1,!1),t[r]=pp(r,!0,!1),e[r]=pp(r,!1,!0),i[r]=pp(r,!0,!0)}),[n,t,e,i]}u(oN,"createInstrumentations");const[aN,lN,cN,uN]=oN();function eb(n,e){const t=e?n?uN:cN:n?lN:aN;return(i,s,r)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?i:Reflect.get(kt(t,s)&&s in i?t:i,s,r)}u(eb,"createInstrumentationGetter");const hN={get:eb(!1,!1)},fN={get:eb(!1,!0)},dN={get:eb(!0,!1)},nT=new WeakMap,iT=new WeakMap,sT=new WeakMap,pN=new WeakMap;function mN(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}u(mN,"targetTypeMap");function gN(n){return n.__v_skip||!Object.isExtensible(n)?0:mN($k(n))}u(gN,"getTargetType");function To(n){return xu(n)?n:tb(n,!1,tT,hN,nT)}u(To,"reactive");function vN(n){return tb(n,!1,rN,fN,iT)}u(vN,"shallowReactive");function rT(n){return tb(n,!0,sN,dN,sT)}u(rT,"readonly");function tb(n,e,t,i,s){if(!vn(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const r=s.get(n);if(r)return r;const o=gN(n);if(o===0)return n;const a=new Proxy(n,o===2?i:t);return s.set(n,a),a}u(tb,"createReactiveObject");function pu(n){return xu(n)?pu(n.__v_raw):!!(n&&n.__v_isReactive)}u(pu,"isReactive");function xu(n){return!!(n&&n.__v_isReadonly)}u(xu,"isReadonly");function Og(n){return!!(n&&n.__v_isShallow)}u(Og,"isShallow");function oT(n){return pu(n)||xu(n)}u(oT,"isProxy");function nt(n){const e=n&&n.__v_raw;return e?nt(e):n}u(nt,"toRaw");function aT(n){return Dg(n,"__v_skip",!0),n}u(aT,"markRaw");const ud=u(n=>vn(n)?To(n):n,"toReactive"),nb=u(n=>vn(n)?rT(n):n,"toReadonly");function lT(n){Ca&&lr&&(n=nt(n),QE(n.dep||(n.dep=K_())))}u(lT,"trackRefValue");function cT(n,e){n=nt(n),n.dep&&qy(n.dep)}u(cT,"triggerRefValue");function Pi(n){return!!(n&&n.__v_isRef===!0)}u(Pi,"isRef");function Ge(n){return uT(n,!1)}u(Ge,"ref");function yN(n){return uT(n,!0)}u(yN,"shallowRef");function uT(n,e){return Pi(n)?n:new hT(n,e)}u(uT,"createRef");class hT{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:nt(e),this._value=t?e:ud(e)}get value(){return lT(this),this._value}set value(e){const t=this.__v_isShallow||Og(e)||xu(e);e=t?e:nt(e),cd(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:ud(e),cT(this))}}u(hT,"RefImpl");function mu(n){return Pi(n)?n.value:n}u(mu,"unref");const _N={get:(n,e,t)=>mu(Reflect.get(n,e,t)),set:(n,e,t,i)=>{const s=n[e];return Pi(s)&&!Pi(t)?(s.value=t,!0):Reflect.set(n,e,t,i)}};function fT(n){return pu(n)?n:new Proxy(n,_N)}u(fT,"proxyRefs");var dT;class pT{constructor(e,t,i,s){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[dT]=!1,this._dirty=!0,this.effect=new c0(e,()=>{this._dirty||(this._dirty=!0,cT(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=i}get value(){const e=nt(this);return lT(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}u(pT,"ComputedRefImpl");dT="__v_isReadonly";function bN(n,e,t=!1){let i,s;const r=dt(n);return r?(i=n,s=fr):(i=n.get,s=n.set),new pT(i,s,r||!s,t)}u(bN,"computed$1");function Ea(n,e,t,i){let s;try{s=i?n(...i):n()}catch(r){h0(r,e,t)}return s}u(Ea,"callWithErrorHandling");function dr(n,e,t,i){if(dt(n)){const r=Ea(n,e,t,i);return r&&WE(r)&&r.catch(o=>{h0(o,e,t)}),r}const s=[];for(let r=0;r<n.length;r++)s.push(dr(n[r],e,t,i));return s}u(dr,"callWithAsyncErrorHandling");function h0(n,e,t,i=!0){const s=e?e.vnode:null;if(e){let r=e.parent;const o=e.proxy,a=t;for(;r;){const c=r.ec;if(c){for(let h=0;h<c.length;h++)if(c[h](n,o,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){Ea(l,null,10,[n,o,a]);return}}wN(n,t,s,i)}u(h0,"handleError");function wN(n,e,t,i=!0){console.error(n)}u(wN,"logError");let hd=!1,Zy=!1;const Ei=[];let Lr=0;const gu=[];let bo=null,Sl=0;const mT=Promise.resolve();let ib=null;function Vs(n){const e=ib||mT;return n?e.then(this?n.bind(this):n):e}u(Vs,"nextTick");function xN(n){let e=Lr+1,t=Ei.length;for(;e<t;){const i=e+t>>>1;fd(Ei[i])<n?e=i+1:t=i}return e}u(xN,"findInsertionIndex");function sb(n){(!Ei.length||!Ei.includes(n,hd&&n.allowRecurse?Lr+1:Lr))&&(n.id==null?Ei.push(n):Ei.splice(xN(n.id),0,n),gT())}u(sb,"queueJob");function gT(){!hd&&!Zy&&(Zy=!0,ib=mT.then(yT))}u(gT,"queueFlush");function AN(n){const e=Ei.indexOf(n);e>Lr&&Ei.splice(e,1)}u(AN,"invalidateJob");function MN(n){ut(n)?gu.push(...n):(!bo||!bo.includes(n,n.allowRecurse?Sl+1:Sl))&&gu.push(n),gT()}u(MN,"queuePostFlushCb");function bA(n,e=hd?Lr+1:0){for(;e<Ei.length;e++){const t=Ei[e];t&&t.pre&&(Ei.splice(e,1),e--,t())}}u(bA,"flushPreFlushCbs");function vT(n){if(gu.length){const e=[...new Set(gu)];if(gu.length=0,bo){bo.push(...e);return}for(bo=e,bo.sort((t,i)=>fd(t)-fd(i)),Sl=0;Sl<bo.length;Sl++)bo[Sl]();bo=null,Sl=0}}u(vT,"flushPostFlushCbs");const fd=u(n=>n.id==null?1/0:n.id,"getId"),SN=u((n,e)=>{const t=fd(n)-fd(e);if(t===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return t},"comparator");function yT(n){Zy=!1,hd=!0,Ei.sort(SN);const e=fr;try{for(Lr=0;Lr<Ei.length;Lr++){const t=Ei[Lr];t&&t.active!==!1&&Ea(t,null,14)}}finally{Lr=0,Ei.length=0,vT(),hd=!1,ib=null,(Ei.length||gu.length)&&yT()}}u(yT,"flushJobs");function CN(n,e,...t){if(n.isUnmounted)return;const i=n.vnode.props||ln;let s=t;const r=e.startsWith("update:"),o=r&&e.slice(7);if(o&&o in i){const h=`${o==="modelValue"?"model":o}Modifiers`,{number:f,trim:d}=i[h]||ln;d&&(s=t.map(p=>$n(p)?p.trim():p)),f&&(s=t.map(Lg))}let a,l=i[a=M1(e)]||i[a=M1(Vr(e))];!l&&r&&(l=i[a=M1(tc(e))]),l&&dr(l,n,6,s);const c=i[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,dr(c,n,6,s)}}u(CN,"emit$1");function _T(n,e,t=!1){const i=e.emitsCache,s=i.get(n);if(s!==void 0)return s;const r=n.emits;let o={},a=!1;if(!dt(n)){const l=u(c=>{const h=_T(c,e,!0);h&&(a=!0,Qi(o,h))},"extendEmits");!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!r&&!a?(vn(n)&&i.set(n,null),null):(ut(r)?r.forEach(l=>o[l]=null):Qi(o,r),vn(n)&&i.set(n,o),o)}u(_T,"normalizeEmitsOptions");function f0(n,e){return!n||!r0(e)?!1:(e=e.slice(2).replace(/Once$/,""),kt(n,e[0].toLowerCase()+e.slice(1))||kt(n,tc(e))||kt(n,e))}u(f0,"isEmitListener");let Ri=null,d0=null;function kg(n){const e=Ri;return Ri=n,d0=n&&n.type.__scopeId||null,e}u(kg,"setCurrentRenderingInstance");function Fa(n){d0=n}u(Fa,"pushScopeId");function za(){d0=null}u(za,"popScopeId");function an(n,e=Ri,t){if(!e||n._n)return n;const i=u((...s)=>{i._d&&RA(-1);const r=kg(e);let o;try{o=n(...s)}finally{kg(r),i._d&&RA(1)}return o},"renderFnWithContext");return i._n=!0,i._c=!0,i._d=!0,i}u(an,"withCtx");function S1(n){const{type:e,vnode:t,proxy:i,withProxy:s,props:r,propsOptions:[o],slots:a,attrs:l,emit:c,render:h,renderCache:f,data:d,setupState:p,ctx:g,inheritAttrs:m}=n;let v,y;const b=kg(n);try{if(t.shapeFlag&4){const x=s||i;v=Ir(h.call(x,x,f,r,p,d,g)),y=l}else{const x=e;v=Ir(x.length>1?x(r,{attrs:l,slots:a,emit:c}):x(r,null)),y=e.props?l:EN(l)}}catch(x){Kf.length=0,h0(x,n,1),v=Ee(La)}let _=v;if(y&&m!==!1){const x=Object.keys(y),{shapeFlag:w}=_;x.length&&w&7&&(o&&x.some(X_)&&(y=TN(y,o)),_=Au(_,y))}return t.dirs&&(_=Au(_),_.dirs=_.dirs?_.dirs.concat(t.dirs):t.dirs),t.transition&&(_.transition=t.transition),v=_,kg(b),v}u(S1,"renderComponentRoot");const EN=u(n=>{let e;for(const t in n)(t==="class"||t==="style"||r0(t))&&((e||(e={}))[t]=n[t]);return e},"getFunctionalFallthrough"),TN=u((n,e)=>{const t={};for(const i in n)(!X_(i)||!(i.slice(9)in e))&&(t[i]=n[i]);return t},"filterModelListeners");function PN(n,e,t){const{props:i,children:s,component:r}=n,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return i?wA(i,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let f=0;f<h.length;f++){const d=h[f];if(o[d]!==i[d]&&!f0(c,d))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:i===o?!1:i?o?wA(i,o,c):!0:!!o;return!1}u(PN,"shouldUpdateComponent");function wA(n,e,t){const i=Object.keys(e);if(i.length!==Object.keys(n).length)return!0;for(let s=0;s<i.length;s++){const r=i[s];if(e[r]!==n[r]&&!f0(t,r))return!0}return!1}u(wA,"hasPropsChanged");function RN({vnode:n,parent:e},t){for(;e&&e.subTree===n;)(n=e.vnode).el=t,e=e.parent}u(RN,"updateHOCHostEl");const IN=u(n=>n.__isSuspense,"isSuspense");function DN(n,e){e&&e.pendingBranch?ut(n)?e.effects.push(...n):e.effects.push(n):MN(n)}u(DN,"queueEffectWithSuspense");function vu(n,e){if(bi){let t=bi.provides;const i=bi.parent&&bi.parent.provides;i===t&&(t=bi.provides=Object.create(i)),t[n]=e}}u(vu,"provide");function Ii(n,e,t=!1){const i=bi||Ri;if(i){const s=i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides;if(s&&n in s)return s[n];if(arguments.length>1)return t&&dt(e)?e.call(i.proxy):e}}u(Ii,"inject$1");const mp={};function qi(n,e,t){return bT(n,e,t)}u(qi,"watch$1");function bT(n,e,{immediate:t,deep:i,flush:s,onTrack:r,onTrigger:o}=ln){const a=bi;let l,c=!1,h=!1;if(Pi(n)?(l=u(()=>n.value,"getter"),c=Og(n)):pu(n)?(l=u(()=>n,"getter"),i=!0):ut(n)?(h=!0,c=n.some(_=>pu(_)||Og(_)),l=u(()=>n.map(_=>{if(Pi(_))return _.value;if(pu(_))return Rl(_);if(dt(_))return Ea(_,a,2)}),"getter")):dt(n)?e?l=u(()=>Ea(n,a,2),"getter"):l=u(()=>{if(!(a&&a.isUnmounted))return f&&f(),dr(n,a,3,[d])},"getter"):l=fr,e&&i){const _=l;l=u(()=>Rl(_()),"getter")}let f,d=u(_=>{f=y.onStop=()=>{Ea(_,a,4)}},"onCleanup"),p;if(md)if(d=fr,e?t&&dr(e,a,3,[l(),h?[]:void 0,d]):l(),s==="sync"){const _=A4();p=_.__watcherHandles||(_.__watcherHandles=[])}else return fr;let g=h?new Array(n.length).fill(mp):mp;const m=u(()=>{if(!!y.active)if(e){const _=y.run();(i||c||(h?_.some((x,w)=>cd(x,g[w])):cd(_,g)))&&(f&&f(),dr(e,a,3,[_,g===mp?void 0:h&&g[0]===mp?[]:g,d]),g=_)}else y.run()},"job");m.allowRecurse=!!e;let v;s==="sync"?v=m:s==="post"?v=u(()=>os(m,a&&a.suspense),"scheduler"):(m.pre=!0,a&&(m.id=a.uid),v=u(()=>sb(m),"scheduler"));const y=new c0(l,v);e?t?m():g=y.run():s==="post"?os(y.run.bind(y),a&&a.suspense):y.run();const b=u(()=>{y.stop(),a&&a.scope&&Y_(a.scope.effects,y)},"unwatch");return p&&p.push(b),b}u(bT,"doWatch");function LN(n,e,t){const i=this.proxy,s=$n(n)?n.includes(".")?wT(i,n):()=>i[n]:n.bind(i,i);let r;dt(e)?r=e:(r=e.handler,t=e);const o=bi;Mu(this);const a=bT(s,r.bind(i),t);return o?Mu(o):Nl(),a}u(LN,"instanceWatch");function wT(n,e){const t=e.split(".");return()=>{let i=n;for(let s=0;s<t.length&&i;s++)i=i[t[s]];return i}}u(wT,"createPathGetter");function Rl(n,e){if(!vn(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),Pi(n))Rl(n.value,e);else if(ut(n))for(let t=0;t<n.length;t++)Rl(n[t],e);else if(HE(n)||du(n))n.forEach(t=>{Rl(t,e)});else if(XE(n))for(const t in n)Rl(n[t],e);return n}u(Rl,"traverse");function zt(n){return dt(n)?{setup:n,name:n.name}:n}u(zt,"defineComponent");const Yf=u(n=>!!n.type.__asyncLoader,"isAsyncWrapper"),xT=u(n=>n.type.__isKeepAlive,"isKeepAlive");function ON(n,e){AT(n,"a",e)}u(ON,"onActivated");function kN(n,e){AT(n,"da",e)}u(kN,"onDeactivated");function AT(n,e,t=bi){const i=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(p0(e,i,t),t){let s=t.parent;for(;s&&s.parent;)xT(s.parent.vnode)&&NN(i,e,t,s),s=s.parent}}u(AT,"registerKeepAliveHook");function NN(n,e,t,i){const s=p0(e,n,i,!0);g0(()=>{Y_(i[e],s)},t)}u(NN,"injectToKeepAliveRoot");function p0(n,e,t=bi,i=!1){if(t){const s=t[n]||(t[n]=[]),r=e.__weh||(e.__weh=(...o)=>{if(t.isUnmounted)return;oh(),Mu(t);const a=dr(e,t,n,o);return Nl(),ah(),a});return i?s.unshift(r):s.push(r),r}}u(p0,"injectHook");const Uo=u(n=>(e,t=bi)=>(!md||n==="sp")&&p0(n,(...i)=>e(...i),t),"createHook"),FN=Uo("bm"),m0=Uo("m"),zN=Uo("bu"),BN=Uo("u"),Ba=Uo("bum"),g0=Uo("um"),UN=Uo("sp"),$N=Uo("rtg"),VN=Uo("rtc");function GN(n,e=bi){p0("ec",n,e)}u(GN,"onErrorCaptured");function ru(n,e){const t=Ri;if(t===null)return n;const i=_0(t)||t.proxy,s=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[o,a,l,c=ln]=e[r];o&&(dt(o)&&(o={mounted:o,updated:o}),o.deep&&Rl(a),s.push({dir:o,instance:i,value:a,oldValue:void 0,arg:l,modifiers:c}))}return n}u(ru,"withDirectives");function Ka(n,e,t,i){const s=n.dirs,r=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];r&&(a.oldValue=r[o].value);let l=a.dir[i];l&&(oh(),dr(l,t,8,[n.el,a,n,e]),ah())}}u(Ka,"invokeDirectiveHook");const rb="components";function pn(n,e){return ST(rb,n,!0,e)||n}u(pn,"resolveComponent");const MT=Symbol();function HN(n){return $n(n)?ST(rb,n,!1)||n:n||MT}u(HN,"resolveDynamicComponent");function ST(n,e,t=!0,i=!1){const s=Ri||bi;if(s){const r=s.type;if(n===rb){const a=b4(r,!1);if(a&&(a===e||a===Vr(e)||a===l0(Vr(e))))return r}const o=xA(s[n]||r[n],e)||xA(s.appContext[n],e);return!o&&i?r:o}}u(ST,"resolveAsset");function xA(n,e){return n&&(n[e]||n[Vr(e)]||n[l0(Vr(e))])}u(xA,"resolve");function Ta(n,e,t,i){let s;const r=t&&t[i];if(ut(n)||$n(n)){s=new Array(n.length);for(let o=0,a=n.length;o<a;o++)s[o]=e(n[o],o,void 0,r&&r[o])}else if(typeof n=="number"){s=new Array(n);for(let o=0;o<n;o++)s[o]=e(o+1,o,void 0,r&&r[o])}else if(vn(n))if(n[Symbol.iterator])s=Array.from(n,(o,a)=>e(o,a,void 0,r&&r[a]));else{const o=Object.keys(n);s=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];s[a]=e(n[c],c,a,r&&r[a])}}else s=[];return t&&(t[i]=s),s}u(Ta,"renderList");function dd(n,e,t={},i,s){if(Ri.isCE||Ri.parent&&Yf(Ri.parent)&&Ri.parent.isCE)return e!=="default"&&(t.name=e),Ee("slot",t,i&&i());let r=n[e];r&&r._c&&(r._d=!1),Ce();const o=r&&CT(r(t)),a=sn(Nt,{key:t.key||o&&o.key||`_${e}`},o||(i?i():[]),o&&n._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}u(dd,"renderSlot");function CT(n){return n.some(e=>Fg(e)?!(e.type===La||e.type===Nt&&!CT(e.children)):!0)?n:null}u(CT,"ensureValidVNode");const Ky=u(n=>n?zT(n)?_0(n)||n.proxy:Ky(n.parent):null,"getPublicInstance"),qf=Qi(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Ky(n.parent),$root:n=>Ky(n.root),$emit:n=>n.emit,$options:n=>ob(n),$forceUpdate:n=>n.f||(n.f=()=>sb(n.update)),$nextTick:n=>n.n||(n.n=Vs.bind(n.proxy)),$watch:n=>LN.bind(n)}),C1=u((n,e)=>n!==ln&&!n.__isScriptSetup&&kt(n,e),"hasSetupBinding"),WN={get({_:n},e){const{ctx:t,setupState:i,data:s,props:r,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const p=o[e];if(p!==void 0)switch(p){case 1:return i[e];case 2:return s[e];case 4:return t[e];case 3:return r[e]}else{if(C1(i,e))return o[e]=1,i[e];if(s!==ln&&kt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&kt(c,e))return o[e]=3,r[e];if(t!==ln&&kt(t,e))return o[e]=4,t[e];Qy&&(o[e]=0)}}const h=qf[e];let f,d;if(h)return e==="$attrs"&&Is(n,"get",e),h(n);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==ln&&kt(t,e))return o[e]=4,t[e];if(d=l.config.globalProperties,kt(d,e))return d[e]},set({_:n},e,t){const{data:i,setupState:s,ctx:r}=n;return C1(s,e)?(s[e]=t,!0):i!==ln&&kt(i,e)?(i[e]=t,!0):kt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(r[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:i,appContext:s,propsOptions:r}},o){let a;return!!t[o]||n!==ln&&kt(n,o)||C1(e,o)||(a=r[0])&&kt(a,o)||kt(i,o)||kt(qf,o)||kt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:kt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};let Qy=!0;function jN(n){const e=ob(n),t=n.proxy,i=n.ctx;Qy=!1,e.beforeCreate&&AA(e.beforeCreate,n,"bc");const{data:s,computed:r,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:f,mounted:d,beforeUpdate:p,updated:g,activated:m,deactivated:v,beforeDestroy:y,beforeUnmount:b,destroyed:_,unmounted:x,render:w,renderTracked:M,renderTriggered:C,errorCaptured:A,serverPrefetch:P,expose:D,inheritAttrs:k,components:O,directives:N,filters:E}=e;if(c&&XN(c,i,null,n.appContext.config.unwrapInjectedRef),o)for(const Z in o){const ne=o[Z];dt(ne)&&(i[Z]=ne.bind(t))}if(s){const Z=s.call(t,t);vn(Z)&&(n.data=To(Z))}if(Qy=!0,r)for(const Z in r){const ne=r[Z],j=dt(ne)?ne.bind(t,t):dt(ne.get)?ne.get.bind(t,t):fr,ie=!dt(ne)&&dt(ne.set)?ne.set.bind(t):fr,K=st({get:j,set:ie});Object.defineProperty(i,Z,{enumerable:!0,configurable:!0,get:()=>K.value,set:$=>K.value=$})}if(a)for(const Z in a)ET(a[Z],i,t,Z);if(l){const Z=dt(l)?l.call(t):l;Reflect.ownKeys(Z).forEach(ne=>{vu(ne,Z[ne])})}h&&AA(h,n,"c");function W(Z,ne){ut(ne)?ne.forEach(j=>Z(j.bind(t))):ne&&Z(ne.bind(t))}if(u(W,"registerLifecycleHook"),W(FN,f),W(m0,d),W(zN,p),W(BN,g),W(ON,m),W(kN,v),W(GN,A),W(VN,M),W($N,C),W(Ba,b),W(g0,x),W(UN,P),ut(D))if(D.length){const Z=n.exposed||(n.exposed={});D.forEach(ne=>{Object.defineProperty(Z,ne,{get:()=>t[ne],set:j=>t[ne]=j})})}else n.exposed||(n.exposed={});w&&n.render===fr&&(n.render=w),k!=null&&(n.inheritAttrs=k),O&&(n.components=O),N&&(n.directives=N)}u(jN,"applyOptions");function XN(n,e,t=fr,i=!1){ut(n)&&(n=Jy(n));for(const s in n){const r=n[s];let o;vn(r)?"default"in r?o=Ii(r.from||s,r.default,!0):o=Ii(r.from||s):o=Ii(r),Pi(o)&&i?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[s]=o}}u(XN,"resolveInjections");function AA(n,e,t){dr(ut(n)?n.map(i=>i.bind(e.proxy)):n.bind(e.proxy),e,t)}u(AA,"callHook");function ET(n,e,t,i){const s=i.includes(".")?wT(t,i):()=>t[i];if($n(n)){const r=e[n];dt(r)&&qi(s,r)}else if(dt(n))qi(s,n.bind(t));else if(vn(n))if(ut(n))n.forEach(r=>ET(r,e,t,i));else{const r=dt(n.handler)?n.handler.bind(t):e[n.handler];dt(r)&&qi(s,r,n)}}u(ET,"createWatcher");function ob(n){const e=n.type,{mixins:t,extends:i}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:o}}=n.appContext,a=r.get(e);let l;return a?l=a:!s.length&&!t&&!i?l=e:(l={},s.length&&s.forEach(c=>Ng(l,c,o,!0)),Ng(l,e,o)),vn(e)&&r.set(e,l),l}u(ob,"resolveMergedOptions");function Ng(n,e,t,i=!1){const{mixins:s,extends:r}=e;r&&Ng(n,r,t,!0),s&&s.forEach(o=>Ng(n,o,t,!0));for(const o in e)if(!(i&&o==="expose")){const a=YN[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}u(Ng,"mergeOptions$1");const YN={data:MA,props:xl,emits:xl,methods:xl,computed:xl,beforeCreate:zi,created:zi,beforeMount:zi,mounted:zi,beforeUpdate:zi,updated:zi,beforeDestroy:zi,beforeUnmount:zi,destroyed:zi,unmounted:zi,activated:zi,deactivated:zi,errorCaptured:zi,serverPrefetch:zi,components:xl,directives:xl,watch:ZN,provide:MA,inject:qN};function MA(n,e){return e?n?u(function(){return Qi(dt(n)?n.call(this,this):n,dt(e)?e.call(this,this):e)},"mergedDataFn"):e:n}u(MA,"mergeDataFn");function qN(n,e){return xl(Jy(n),Jy(e))}u(qN,"mergeInject");function Jy(n){if(ut(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}u(Jy,"normalizeInject");function zi(n,e){return n?[...new Set([].concat(n,e))]:e}u(zi,"mergeAsArray");function xl(n,e){return n?Qi(Qi(Object.create(null),n),e):e}u(xl,"mergeObjectOptions");function ZN(n,e){if(!n)return e;if(!e)return n;const t=Qi(Object.create(null),n);for(const i in e)t[i]=zi(n[i],e[i]);return t}u(ZN,"mergeWatchOptions");function KN(n,e,t,i=!1){const s={},r={};Dg(r,y0,1),n.propsDefaults=Object.create(null),TT(n,e,s,r);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=i?s:vN(s):n.type.props?n.props=s:n.props=r,n.attrs=r}u(KN,"initProps");function QN(n,e,t,i){const{props:s,attrs:r,vnode:{patchFlag:o}}=n,a=nt(s),[l]=n.propsOptions;let c=!1;if((i||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let f=0;f<h.length;f++){let d=h[f];if(f0(n.emitsOptions,d))continue;const p=e[d];if(l)if(kt(r,d))p!==r[d]&&(r[d]=p,c=!0);else{const g=Vr(d);s[g]=e_(l,a,g,p,n,!1)}else p!==r[d]&&(r[d]=p,c=!0)}}}else{TT(n,e,s,r)&&(c=!0);let h;for(const f in a)(!e||!kt(e,f)&&((h=tc(f))===f||!kt(e,h)))&&(l?t&&(t[f]!==void 0||t[h]!==void 0)&&(s[f]=e_(l,a,f,void 0,n,!0)):delete s[f]);if(r!==a)for(const f in r)(!e||!kt(e,f)&&!0)&&(delete r[f],c=!0)}c&&Io(n,"set","$attrs")}u(QN,"updateProps");function TT(n,e,t,i){const[s,r]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(gg(l))continue;const c=e[l];let h;s&&kt(s,h=Vr(l))?!r||!r.includes(h)?t[h]=c:(a||(a={}))[h]=c:f0(n.emitsOptions,l)||(!(l in i)||c!==i[l])&&(i[l]=c,o=!0)}if(r){const l=nt(t),c=a||ln;for(let h=0;h<r.length;h++){const f=r[h];t[f]=e_(s,l,f,c[f],n,!kt(c,f))}}return o}u(TT,"setFullProps");function e_(n,e,t,i,s,r){const o=n[t];if(o!=null){const a=kt(o,"default");if(a&&i===void 0){const l=o.default;if(o.type!==Function&&dt(l)){const{propsDefaults:c}=s;t in c?i=c[t]:(Mu(s),i=c[t]=l.call(null,e),Nl())}else i=l}o[0]&&(r&&!a?i=!1:o[1]&&(i===""||i===tc(t))&&(i=!0))}return i}u(e_,"resolvePropValue");function PT(n,e,t=!1){const i=e.propsCache,s=i.get(n);if(s)return s;const r=n.props,o={},a=[];let l=!1;if(!dt(n)){const h=u(f=>{l=!0;const[d,p]=PT(f,e,!0);Qi(o,d),p&&a.push(...p)},"extendProps");!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!r&&!l)return vn(n)&&i.set(n,fu),fu;if(ut(r))for(let h=0;h<r.length;h++){const f=Vr(r[h]);SA(f)&&(o[f]=ln)}else if(r)for(const h in r){const f=Vr(h);if(SA(f)){const d=r[h],p=o[f]=ut(d)||dt(d)?{type:d}:Object.assign({},d);if(p){const g=TA(Boolean,p.type),m=TA(String,p.type);p[0]=g>-1,p[1]=m<0||g<m,(g>-1||kt(p,"default"))&&a.push(f)}}}const c=[o,a];return vn(n)&&i.set(n,c),c}u(PT,"normalizePropsOptions");function SA(n){return n[0]!=="$"}u(SA,"validatePropName");function CA(n){const e=n&&n.toString().match(/^\s*function (\w+)/);return e?e[1]:n===null?"null":""}u(CA,"getType");function EA(n,e){return CA(n)===CA(e)}u(EA,"isSameType");function TA(n,e){return ut(e)?e.findIndex(t=>EA(t,n)):dt(e)&&EA(e,n)?0:-1}u(TA,"getTypeIndex");const RT=u(n=>n[0]==="_"||n==="$stable","isInternalKey"),ab=u(n=>ut(n)?n.map(Ir):[Ir(n)],"normalizeSlotValue"),JN=u((n,e,t)=>{if(e._n)return e;const i=an((...s)=>ab(e(...s)),t);return i._c=!1,i},"normalizeSlot$1"),IT=u((n,e,t)=>{const i=n._ctx;for(const s in n){if(RT(s))continue;const r=n[s];if(dt(r))e[s]=JN(s,r,i);else if(r!=null){const o=ab(r);e[s]=()=>o}}},"normalizeObjectSlots"),DT=u((n,e)=>{const t=ab(e);n.slots.default=()=>t},"normalizeVNodeSlots"),e4=u((n,e)=>{if(n.vnode.shapeFlag&32){const t=e._;t?(n.slots=nt(e),Dg(e,"_",t)):IT(e,n.slots={})}else n.slots={},e&&DT(n,e);Dg(n.slots,y0,1)},"initSlots"),t4=u((n,e,t)=>{const{vnode:i,slots:s}=n;let r=!0,o=ln;if(i.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:(Qi(s,e),!t&&a===1&&delete s._):(r=!e.$stable,IT(e,s)),o=e}else e&&(DT(n,e),o={default:1});if(r)for(const a in s)!RT(a)&&!(a in o)&&delete s[a]},"updateSlots");function LT(){return{app:null,config:{isNativeTag:zk,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}u(LT,"createAppContext");let n4=0;function i4(n,e){return u(function(i,s=null){dt(i)||(i=Object.assign({},i)),s!=null&&!vn(s)&&(s=null);const r=LT(),o=new Set;let a=!1;const l=r.app={_uid:n4++,_component:i,_props:s,_container:null,_context:r,_instance:null,version:M4,get config(){return r.config},set config(c){},use(c,...h){return o.has(c)||(c&&dt(c.install)?(o.add(c),c.install(l,...h)):dt(c)&&(o.add(c),c(l,...h))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,h){return h?(r.components[c]=h,l):r.components[c]},directive(c,h){return h?(r.directives[c]=h,l):r.directives[c]},mount(c,h,f){if(!a){const d=Ee(i,s);return d.appContext=r,h&&e?e(d,c):n(d,c,f),a=!0,l._container=c,c.__vue_app__=l,_0(d.component)||d.component.proxy}},unmount(){a&&(n(null,l._container),delete l._container.__vue_app__)},provide(c,h){return r.provides[c]=h,l}};return l},"createApp")}u(i4,"createAppAPI");function t_(n,e,t,i,s=!1){if(ut(n)){n.forEach((d,p)=>t_(d,e&&(ut(e)?e[p]:e),t,i,s));return}if(Yf(i)&&!s)return;const r=i.shapeFlag&4?_0(i.component)||i.component.proxy:i.el,o=s?null:r,{i:a,r:l}=n,c=e&&e.r,h=a.refs===ln?a.refs={}:a.refs,f=a.setupState;if(c!=null&&c!==l&&($n(c)?(h[c]=null,kt(f,c)&&(f[c]=null)):Pi(c)&&(c.value=null)),dt(l))Ea(l,a,12,[o,h]);else{const d=$n(l),p=Pi(l);if(d||p){const g=u(()=>{if(n.f){const m=d?kt(f,l)?f[l]:h[l]:l.value;s?ut(m)&&Y_(m,r):ut(m)?m.includes(r)||m.push(r):d?(h[l]=[r],kt(f,l)&&(f[l]=h[l])):(l.value=[r],n.k&&(h[n.k]=l.value))}else d?(h[l]=o,kt(f,l)&&(f[l]=o)):p&&(l.value=o,n.k&&(h[n.k]=o))},"doSet");o?(g.id=-1,os(g,t)):g()}}}u(t_,"setRef");const os=DN;function s4(n){return r4(n)}u(s4,"createRenderer");function r4(n,e){const t=Hk();t.__VUE__=!0;const{insert:i,remove:s,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:f,nextSibling:d,setScopeId:p=fr,insertStaticContent:g}=n,m=u((V,Y,R,ee=null,Q=null,U=null,F=!1,H=null,re=!!Y.dynamicChildren)=>{if(V===Y)return;V&&!Ch(V,Y)&&(ee=ge(V),$(V,Q,U,!0),V=null),Y.patchFlag===-2&&(re=!1,Y.dynamicChildren=null);const{type:z,ref:I,shapeFlag:L}=Y;switch(z){case v0:v(V,Y,R,ee);break;case La:y(V,Y,R,ee);break;case E1:V==null&&b(Y,R,ee,F);break;case Nt:O(V,Y,R,ee,Q,U,F,H,re);break;default:L&1?w(V,Y,R,ee,Q,U,F,H,re):L&6?N(V,Y,R,ee,Q,U,F,H,re):(L&64||L&128)&&z.process(V,Y,R,ee,Q,U,F,H,re,we)}I!=null&&Q&&t_(I,V&&V.ref,U,Y||V,!Y)},"patch"),v=u((V,Y,R,ee)=>{if(V==null)i(Y.el=a(Y.children),R,ee);else{const Q=Y.el=V.el;Y.children!==V.children&&c(Q,Y.children)}},"processText"),y=u((V,Y,R,ee)=>{V==null?i(Y.el=l(Y.children||""),R,ee):Y.el=V.el},"processCommentNode"),b=u((V,Y,R,ee)=>{[V.el,V.anchor]=g(V.children,Y,R,ee,V.el,V.anchor)},"mountStaticNode"),_=u(({el:V,anchor:Y},R,ee)=>{let Q;for(;V&&V!==Y;)Q=d(V),i(V,R,ee),V=Q;i(Y,R,ee)},"moveStaticNode"),x=u(({el:V,anchor:Y})=>{let R;for(;V&&V!==Y;)R=d(V),s(V),V=R;s(Y)},"removeStaticNode"),w=u((V,Y,R,ee,Q,U,F,H,re)=>{F=F||Y.type==="svg",V==null?M(Y,R,ee,Q,U,F,H,re):P(V,Y,Q,U,F,H,re)},"processElement"),M=u((V,Y,R,ee,Q,U,F,H)=>{let re,z;const{type:I,props:L,shapeFlag:G,transition:X,dirs:se}=V;if(re=V.el=o(V.type,U,L&&L.is,L),G&8?h(re,V.children):G&16&&A(V.children,re,null,ee,Q,U&&I!=="foreignObject",F,H),se&&Ka(V,null,ee,"created"),L){for(const me in L)me!=="value"&&!gg(me)&&r(re,me,null,L[me],U,V.children,ee,Q,te);"value"in L&&r(re,"value",null,L.value),(z=L.onVnodeBeforeMount)&&Ar(z,ee,V)}C(re,V,V.scopeId,F,ee),se&&Ka(V,null,ee,"beforeMount");const de=(!Q||Q&&!Q.pendingBranch)&&X&&!X.persisted;de&&X.beforeEnter(re),i(re,Y,R),((z=L&&L.onVnodeMounted)||de||se)&&os(()=>{z&&Ar(z,ee,V),de&&X.enter(re),se&&Ka(V,null,ee,"mounted")},Q)},"mountElement"),C=u((V,Y,R,ee,Q)=>{if(R&&p(V,R),ee)for(let U=0;U<ee.length;U++)p(V,ee[U]);if(Q){let U=Q.subTree;if(Y===U){const F=Q.vnode;C(V,F,F.scopeId,F.slotScopeIds,Q.parent)}}},"setScopeId"),A=u((V,Y,R,ee,Q,U,F,H,re=0)=>{for(let z=re;z<V.length;z++){const I=V[z]=H?ba(V[z]):Ir(V[z]);m(null,I,Y,R,ee,Q,U,F,H)}},"mountChildren"),P=u((V,Y,R,ee,Q,U,F)=>{const H=Y.el=V.el;let{patchFlag:re,dynamicChildren:z,dirs:I}=Y;re|=V.patchFlag&16;const L=V.props||ln,G=Y.props||ln;let X;R&&Qa(R,!1),(X=G.onVnodeBeforeUpdate)&&Ar(X,R,Y,V),I&&Ka(Y,V,R,"beforeUpdate"),R&&Qa(R,!0);const se=Q&&Y.type!=="foreignObject";if(z?D(V.dynamicChildren,z,H,R,ee,se,U):F||ne(V,Y,H,null,R,ee,se,U,!1),re>0){if(re&16)k(H,Y,L,G,R,ee,Q);else if(re&2&&L.class!==G.class&&r(H,"class",null,G.class,Q),re&4&&r(H,"style",L.style,G.style,Q),re&8){const de=Y.dynamicProps;for(let me=0;me<de.length;me++){const ye=de[me],pe=L[ye],Fe=G[ye];(Fe!==pe||ye==="value")&&r(H,ye,pe,Fe,Q,V.children,R,ee,te)}}re&1&&V.children!==Y.children&&h(H,Y.children)}else!F&&z==null&&k(H,Y,L,G,R,ee,Q);((X=G.onVnodeUpdated)||I)&&os(()=>{X&&Ar(X,R,Y,V),I&&Ka(Y,V,R,"updated")},ee)},"patchElement"),D=u((V,Y,R,ee,Q,U,F)=>{for(let H=0;H<Y.length;H++){const re=V[H],z=Y[H],I=re.el&&(re.type===Nt||!Ch(re,z)||re.shapeFlag&70)?f(re.el):R;m(re,z,I,null,ee,Q,U,F,!0)}},"patchBlockChildren"),k=u((V,Y,R,ee,Q,U,F)=>{if(R!==ee){if(R!==ln)for(const H in R)!gg(H)&&!(H in ee)&&r(V,H,R[H],null,F,Y.children,Q,U,te);for(const H in ee){if(gg(H))continue;const re=ee[H],z=R[H];re!==z&&H!=="value"&&r(V,H,z,re,F,Y.children,Q,U,te)}"value"in ee&&r(V,"value",R.value,ee.value)}},"patchProps"),O=u((V,Y,R,ee,Q,U,F,H,re)=>{const z=Y.el=V?V.el:a(""),I=Y.anchor=V?V.anchor:a("");let{patchFlag:L,dynamicChildren:G,slotScopeIds:X}=Y;X&&(H=H?H.concat(X):X),V==null?(i(z,R,ee),i(I,R,ee),A(Y.children,R,I,Q,U,F,H,re)):L>0&&L&64&&G&&V.dynamicChildren?(D(V.dynamicChildren,G,R,Q,U,F,H),(Y.key!=null||Q&&Y===Q.subTree)&&lb(V,Y,!0)):ne(V,Y,R,I,Q,U,F,H,re)},"processFragment"),N=u((V,Y,R,ee,Q,U,F,H,re)=>{Y.slotScopeIds=H,V==null?Y.shapeFlag&512?Q.ctx.activate(Y,R,ee,F,re):E(Y,R,ee,Q,U,F,re):B(V,Y,re)},"processComponent"),E=u((V,Y,R,ee,Q,U,F)=>{const H=V.component=m4(V,ee,Q);if(xT(V)&&(H.ctx.renderer=we),g4(H),H.asyncDep){if(Q&&Q.registerDep(H,W),!V.el){const re=H.subTree=Ee(La);y(null,re,Y,R)}return}W(H,V,Y,R,Q,U,F)},"mountComponent"),B=u((V,Y,R)=>{const ee=Y.component=V.component;if(PN(V,Y,R))if(ee.asyncDep&&!ee.asyncResolved){Z(ee,Y,R);return}else ee.next=Y,AN(ee.update),ee.update();else Y.el=V.el,ee.vnode=Y},"updateComponent"),W=u((V,Y,R,ee,Q,U,F)=>{const H=u(()=>{if(V.isMounted){let{next:I,bu:L,u:G,parent:X,vnode:se}=V,de=I,me;Qa(V,!1),I?(I.el=se.el,Z(V,I,F)):I=se,L&&vg(L),(me=I.props&&I.props.onVnodeBeforeUpdate)&&Ar(me,X,I,se),Qa(V,!0);const ye=S1(V),pe=V.subTree;V.subTree=ye,m(pe,ye,f(pe.el),ge(pe),V,Q,U),I.el=ye.el,de===null&&RN(V,ye.el),G&&os(G,Q),(me=I.props&&I.props.onVnodeUpdated)&&os(()=>Ar(me,X,I,se),Q)}else{let I;const{el:L,props:G}=Y,{bm:X,m:se,parent:de}=V,me=Yf(Y);if(Qa(V,!1),X&&vg(X),!me&&(I=G&&G.onVnodeBeforeMount)&&Ar(I,de,Y),Qa(V,!0),L&&Se){const ye=u(()=>{V.subTree=S1(V),Se(L,V.subTree,V,Q,null)},"hydrateSubTree");me?Y.type.__asyncLoader().then(()=>!V.isUnmounted&&ye()):ye()}else{const ye=V.subTree=S1(V);m(null,ye,R,ee,V,Q,U),Y.el=ye.el}if(se&&os(se,Q),!me&&(I=G&&G.onVnodeMounted)){const ye=Y;os(()=>Ar(I,de,ye),Q)}(Y.shapeFlag&256||de&&Yf(de.vnode)&&de.vnode.shapeFlag&256)&&V.a&&os(V.a,Q),V.isMounted=!0,Y=R=ee=null}},"componentUpdateFn"),re=V.effect=new c0(H,()=>sb(z),V.scope),z=V.update=()=>re.run();z.id=V.uid,Qa(V,!0),z()},"setupRenderEffect"),Z=u((V,Y,R)=>{Y.component=V;const ee=V.vnode.props;V.vnode=Y,V.next=null,QN(V,Y.props,ee,R),t4(V,Y.children,R),oh(),bA(),ah()},"updateComponentPreRender"),ne=u((V,Y,R,ee,Q,U,F,H,re=!1)=>{const z=V&&V.children,I=V?V.shapeFlag:0,L=Y.children,{patchFlag:G,shapeFlag:X}=Y;if(G>0){if(G&128){ie(z,L,R,ee,Q,U,F,H,re);return}else if(G&256){j(z,L,R,ee,Q,U,F,H,re);return}}X&8?(I&16&&te(z,Q,U),L!==z&&h(R,L)):I&16?X&16?ie(z,L,R,ee,Q,U,F,H,re):te(z,Q,U,!0):(I&8&&h(R,""),X&16&&A(L,R,ee,Q,U,F,H,re))},"patchChildren"),j=u((V,Y,R,ee,Q,U,F,H,re)=>{V=V||fu,Y=Y||fu;const z=V.length,I=Y.length,L=Math.min(z,I);let G;for(G=0;G<L;G++){const X=Y[G]=re?ba(Y[G]):Ir(Y[G]);m(V[G],X,R,null,Q,U,F,H,re)}z>I?te(V,Q,U,!0,!1,L):A(Y,R,ee,Q,U,F,H,re,L)},"patchUnkeyedChildren"),ie=u((V,Y,R,ee,Q,U,F,H,re)=>{let z=0;const I=Y.length;let L=V.length-1,G=I-1;for(;z<=L&&z<=G;){const X=V[z],se=Y[z]=re?ba(Y[z]):Ir(Y[z]);if(Ch(X,se))m(X,se,R,null,Q,U,F,H,re);else break;z++}for(;z<=L&&z<=G;){const X=V[L],se=Y[G]=re?ba(Y[G]):Ir(Y[G]);if(Ch(X,se))m(X,se,R,null,Q,U,F,H,re);else break;L--,G--}if(z>L){if(z<=G){const X=G+1,se=X<I?Y[X].el:ee;for(;z<=G;)m(null,Y[z]=re?ba(Y[z]):Ir(Y[z]),R,se,Q,U,F,H,re),z++}}else if(z>G)for(;z<=L;)$(V[z],Q,U,!0),z++;else{const X=z,se=z,de=new Map;for(z=se;z<=G;z++){const $e=Y[z]=re?ba(Y[z]):Ir(Y[z]);$e.key!=null&&de.set($e.key,z)}let me,ye=0;const pe=G-se+1;let Fe=!1,qe=0;const Re=new Array(pe);for(z=0;z<pe;z++)Re[z]=0;for(z=X;z<=L;z++){const $e=V[z];if(ye>=pe){$($e,Q,U,!0);continue}let Je;if($e.key!=null)Je=de.get($e.key);else for(me=se;me<=G;me++)if(Re[me-se]===0&&Ch($e,Y[me])){Je=me;break}Je===void 0?$($e,Q,U,!0):(Re[Je-se]=z+1,Je>=qe?qe=Je:Fe=!0,m($e,Y[Je],R,null,Q,U,F,H,re),ye++)}const Ke=Fe?o4(Re):fu;for(me=Ke.length-1,z=pe-1;z>=0;z--){const $e=se+z,Je=Y[$e],Bt=$e+1<I?Y[$e+1].el:ee;Re[z]===0?m(null,Je,R,Bt,Q,U,F,H,re):Fe&&(me<0||z!==Ke[me]?K(Je,R,Bt,2):me--)}}},"patchKeyedChildren"),K=u((V,Y,R,ee,Q=null)=>{const{el:U,type:F,transition:H,children:re,shapeFlag:z}=V;if(z&6){K(V.component.subTree,Y,R,ee);return}if(z&128){V.suspense.move(Y,R,ee);return}if(z&64){F.move(V,Y,R,we);return}if(F===Nt){i(U,Y,R);for(let L=0;L<re.length;L++)K(re[L],Y,R,ee);i(V.anchor,Y,R);return}if(F===E1){_(V,Y,R);return}if(ee!==2&&z&1&&H)if(ee===0)H.beforeEnter(U),i(U,Y,R),os(()=>H.enter(U),Q);else{const{leave:L,delayLeave:G,afterLeave:X}=H,se=u(()=>i(U,Y,R),"remove"),de=u(()=>{L(U,()=>{se(),X&&X()})},"performLeave");G?G(U,se,de):de()}else i(U,Y,R)},"move"),$=u((V,Y,R,ee=!1,Q=!1)=>{const{type:U,props:F,ref:H,children:re,dynamicChildren:z,shapeFlag:I,patchFlag:L,dirs:G}=V;if(H!=null&&t_(H,null,R,V,!0),I&256){Y.ctx.deactivate(V);return}const X=I&1&&G,se=!Yf(V);let de;if(se&&(de=F&&F.onVnodeBeforeUnmount)&&Ar(de,Y,V),I&6)J(V.component,R,ee);else{if(I&128){V.suspense.unmount(R,ee);return}X&&Ka(V,null,Y,"beforeUnmount"),I&64?V.type.remove(V,Y,R,Q,we,ee):z&&(U!==Nt||L>0&&L&64)?te(z,Y,R,!1,!0):(U===Nt&&L&384||!Q&&I&16)&&te(re,Y,R),ee&&le(V)}(se&&(de=F&&F.onVnodeUnmounted)||X)&&os(()=>{de&&Ar(de,Y,V),X&&Ka(V,null,Y,"unmounted")},R)},"unmount"),le=u(V=>{const{type:Y,el:R,anchor:ee,transition:Q}=V;if(Y===Nt){ae(R,ee);return}if(Y===E1){x(V);return}const U=u(()=>{s(R),Q&&!Q.persisted&&Q.afterLeave&&Q.afterLeave()},"performRemove");if(V.shapeFlag&1&&Q&&!Q.persisted){const{leave:F,delayLeave:H}=Q,re=u(()=>F(R,U),"performLeave");H?H(V.el,U,re):re()}else U()},"remove"),ae=u((V,Y)=>{let R;for(;V!==Y;)R=d(V),s(V),V=R;s(Y)},"removeFragment"),J=u((V,Y,R)=>{const{bum:ee,scope:Q,update:U,subTree:F,um:H}=V;ee&&vg(ee),Q.stop(),U&&(U.active=!1,$(F,V,Y,R)),H&&os(H,Y),os(()=>{V.isUnmounted=!0},Y),Y&&Y.pendingBranch&&!Y.isUnmounted&&V.asyncDep&&!V.asyncResolved&&V.suspenseId===Y.pendingId&&(Y.deps--,Y.deps===0&&Y.resolve())},"unmountComponent"),te=u((V,Y,R,ee=!1,Q=!1,U=0)=>{for(let F=U;F<V.length;F++)$(V[F],Y,R,ee,Q)},"unmountChildren"),ge=u(V=>V.shapeFlag&6?ge(V.component.subTree):V.shapeFlag&128?V.suspense.next():d(V.anchor||V.el),"getNextHostNode"),he=u((V,Y,R)=>{V==null?Y._vnode&&$(Y._vnode,null,null,!0):m(Y._vnode||null,V,Y,null,null,null,R),bA(),vT(),Y._vnode=V},"render"),we={p:m,um:$,m:K,r:le,mt:E,mc:A,pc:ne,pbc:D,n:ge,o:n};let xe,Se;return e&&([xe,Se]=e(we)),{render:he,hydrate:xe,createApp:i4(he,xe)}}u(r4,"baseCreateRenderer");function Qa({effect:n,update:e},t){n.allowRecurse=e.allowRecurse=t}u(Qa,"toggleRecurse");function lb(n,e,t=!1){const i=n.children,s=e.children;if(ut(i)&&ut(s))for(let r=0;r<i.length;r++){const o=i[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=ba(s[r]),a.el=o.el),t||lb(o,a)),a.type===v0&&(a.el=o.el)}}u(lb,"traverseStaticChildren");function o4(n){const e=n.slice(),t=[0];let i,s,r,o,a;const l=n.length;for(i=0;i<l;i++){const c=n[i];if(c!==0){if(s=t[t.length-1],n[s]<c){e[i]=s,t.push(i);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,n[t[a]]<c?r=a+1:o=a;c<n[t[r]]&&(r>0&&(e[i]=t[r-1]),t[r]=i)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}u(o4,"getSequence");const a4=u(n=>n.__isTeleport,"isTeleport"),Zf=u(n=>n&&(n.disabled||n.disabled===""),"isTeleportDisabled"),PA=u(n=>typeof SVGElement!="undefined"&&n instanceof SVGElement,"isTargetSVG"),n_=u((n,e)=>{const t=n&&n.to;return $n(t)?e?e(t):null:t},"resolveTarget"),l4={__isTeleport:!0,process(n,e,t,i,s,r,o,a,l,c){const{mc:h,pc:f,pbc:d,o:{insert:p,querySelector:g,createText:m,createComment:v}}=c,y=Zf(e.props);let{shapeFlag:b,children:_,dynamicChildren:x}=e;if(n==null){const w=e.el=m(""),M=e.anchor=m("");p(w,t,i),p(M,t,i);const C=e.target=n_(e.props,g),A=e.targetAnchor=m("");C&&(p(A,C),o=o||PA(C));const P=u((D,k)=>{b&16&&h(_,D,k,s,r,o,a,l)},"mount");y?P(t,M):C&&P(C,A)}else{e.el=n.el;const w=e.anchor=n.anchor,M=e.target=n.target,C=e.targetAnchor=n.targetAnchor,A=Zf(n.props),P=A?t:M,D=A?w:C;if(o=o||PA(M),x?(d(n.dynamicChildren,x,P,s,r,o,a),lb(n,e,!0)):l||f(n,e,P,D,s,r,o,a,!1),y)A||gp(e,t,w,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const k=e.target=n_(e.props,g);k&&gp(e,k,null,c,0)}else A&&gp(e,M,C,c,1)}OT(e)},remove(n,e,t,i,{um:s,o:{remove:r}},o){const{shapeFlag:a,children:l,anchor:c,targetAnchor:h,target:f,props:d}=n;if(f&&r(h),(o||!Zf(d))&&(r(c),a&16))for(let p=0;p<l.length;p++){const g=l[p];s(g,e,t,!0,!!g.dynamicChildren)}},move:gp,hydrate:c4};function gp(n,e,t,{o:{insert:i},m:s},r=2){r===0&&i(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,f=r===2;if(f&&i(o,e,t),(!f||Zf(h))&&l&16)for(let d=0;d<c.length;d++)s(c[d],e,t,2);f&&i(a,e,t)}u(gp,"moveTeleport");function c4(n,e,t,i,s,r,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const h=e.target=n_(e.props,l);if(h){const f=h._lpa||h.firstChild;if(e.shapeFlag&16)if(Zf(e.props))e.anchor=c(o(n),e,a(n),t,i,s,r),e.targetAnchor=f;else{e.anchor=o(n);let d=f;for(;d;)if(d=o(d),d&&d.nodeType===8&&d.data==="teleport anchor"){e.targetAnchor=d,h._lpa=e.targetAnchor&&o(e.targetAnchor);break}c(f,e,h,t,i,s,r)}OT(e)}return e.anchor&&o(e.anchor)}u(c4,"hydrateTeleport");const cb=l4;function OT(n){const e=n.ctx;if(e&&e.ut){let t=n.children[0].el;for(;t!==n.targetAnchor;)t.nodeType===1&&t.setAttribute("data-v-owner",e.uid),t=t.nextSibling;e.ut()}}u(OT,"updateCssVars");const Nt=Symbol(void 0),v0=Symbol(void 0),La=Symbol(void 0),E1=Symbol(void 0),Kf=[];let cr=null;function Ce(n=!1){Kf.push(cr=n?null:[])}u(Ce,"openBlock");function u4(){Kf.pop(),cr=Kf[Kf.length-1]||null}u(u4,"closeBlock");let pd=1;function RA(n){pd+=n}u(RA,"setBlockTracking");function kT(n){return n.dynamicChildren=pd>0?cr||fu:null,u4(),pd>0&&cr&&cr.push(n),n}u(kT,"setupBlock");function Be(n,e,t,i,s,r){return kT(ue(n,e,t,i,s,r,!0))}u(Be,"createElementBlock");function sn(n,e,t,i,s){return kT(Ee(n,e,t,i,s,!0))}u(sn,"createBlock");function Fg(n){return n?n.__v_isVNode===!0:!1}u(Fg,"isVNode");function Ch(n,e){return n.type===e.type&&n.key===e.key}u(Ch,"isSameVNodeType");const y0="__vInternal",NT=u(({key:n})=>n!=null?n:null,"normalizeKey"),yg=u(({ref:n,ref_key:e,ref_for:t})=>n!=null?$n(n)||Pi(n)||dt(n)?{i:Ri,r:n,k:e,f:!!t}:n:null,"normalizeRef");function ue(n,e=null,t=null,i=0,s=null,r=n===Nt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&NT(e),ref:e&&yg(e),scopeId:d0,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Ri};return a?(ub(l,t),r&128&&n.normalize(l)):t&&(l.shapeFlag|=$n(t)?8:16),pd>0&&!o&&cr&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&cr.push(l),l}u(ue,"createBaseVNode");const Ee=h4;function h4(n,e=null,t=null,i=0,s=null,r=!1){if((!n||n===MT)&&(n=La),Fg(n)){const a=Au(n,e,!0);return t&&ub(a,t),pd>0&&!r&&cr&&(a.shapeFlag&6?cr[cr.indexOf(n)]=a:cr.push(a)),a.patchFlag|=-2,a}if(w4(n)&&(n=n.__vccOpts),e){e=f4(e);let{class:a,style:l}=e;a&&!$n(a)&&(e.class=bn(a)),vn(l)&&(oT(l)&&!ut(l)&&(l=Qi({},l)),e.style=ti(l))}const o=$n(n)?1:IN(n)?128:a4(n)?64:vn(n)?4:dt(n)?2:0;return ue(n,e,t,i,s,o,r,!0)}u(h4,"_createVNode");function f4(n){return n?oT(n)||y0 in n?Qi({},n):n:null}u(f4,"guardReactiveProps");function Au(n,e,t=!1){const{props:i,ref:s,patchFlag:r,children:o}=n,a=e?FT(i||{},e):i;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:a,key:a&&NT(a),ref:e&&e.ref?t&&s?ut(s)?s.concat(yg(e)):[s,yg(e)]:yg(e):s,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:o,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Nt?r===-1?16:r|16:r,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Au(n.ssContent),ssFallback:n.ssFallback&&Au(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx}}u(Au,"cloneVNode");function Mo(n=" ",e=0){return Ee(v0,null,n,e)}u(Mo,"createTextVNode");function tt(n="",e=!1){return e?(Ce(),sn(La,null,n)):Ee(La,null,n)}u(tt,"createCommentVNode");function Ir(n){return n==null||typeof n=="boolean"?Ee(La):ut(n)?Ee(Nt,null,n.slice()):typeof n=="object"?ba(n):Ee(v0,null,String(n))}u(Ir,"normalizeVNode");function ba(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Au(n)}u(ba,"cloneIfMounted");function ub(n,e){let t=0;const{shapeFlag:i}=n;if(e==null)e=null;else if(ut(e))t=16;else if(typeof e=="object")if(i&65){const s=e.default;s&&(s._c&&(s._d=!1),ub(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!(y0 in e)?e._ctx=Ri:s===3&&Ri&&(Ri.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else dt(e)?(e={default:e,_ctx:Ri},t=32):(e=String(e),i&64?(t=16,e=[Mo(e)]):t=8);n.children=e,n.shapeFlag|=t}u(ub,"normalizeChildren");function FT(...n){const e={};for(let t=0;t<n.length;t++){const i=n[t];for(const s in i)if(s==="class")e.class!==i.class&&(e.class=bn([e.class,i.class]));else if(s==="style")e.style=ti([e.style,i.style]);else if(r0(s)){const r=e[s],o=i[s];o&&r!==o&&!(ut(r)&&r.includes(o))&&(e[s]=r?[].concat(r,o):o)}else s!==""&&(e[s]=i[s])}return e}u(FT,"mergeProps");function Ar(n,e,t,i=null){dr(n,e,7,[t,i])}u(Ar,"invokeVNodeHook");const d4=LT();let p4=0;function m4(n,e,t){const i=n.type,s=(e?e.appContext:n.appContext)||d4,r={uid:p4++,vnode:n,type:i,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new YE(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:PT(i,s),emitsOptions:_T(i,s),emit:null,emitted:null,propsDefaults:ln,inheritAttrs:i.inheritAttrs,ctx:ln,data:ln,props:ln,attrs:ln,slots:ln,refs:ln,setupState:ln,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=CN.bind(null,r),n.ce&&n.ce(r),r}u(m4,"createComponentInstance$1");let bi=null;const Mu=u(n=>{bi=n,n.scope.on()},"setCurrentInstance"),Nl=u(()=>{bi&&bi.scope.off(),bi=null},"unsetCurrentInstance");function zT(n){return n.vnode.shapeFlag&4}u(zT,"isStatefulComponent");let md=!1;function g4(n,e=!1){md=e;const{props:t,children:i}=n.vnode,s=zT(n);KN(n,t,s,e),e4(n,i);const r=s?v4(n,e):void 0;return md=!1,r}u(g4,"setupComponent");function v4(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=aT(new Proxy(n.ctx,WN));const{setup:i}=t;if(i){const s=n.setupContext=i.length>1?_4(n):null;Mu(n),oh();const r=Ea(i,n,0,[n.props,s]);if(ah(),Nl(),WE(r)){if(r.then(Nl,Nl),e)return r.then(o=>{IA(n,o,e)}).catch(o=>{h0(o,n,0)});n.asyncDep=r}else IA(n,r,e)}else BT(n,e)}u(v4,"setupStatefulComponent");function IA(n,e,t){dt(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:vn(e)&&(n.setupState=fT(e)),BT(n,t)}u(IA,"handleSetupResult");let DA;function BT(n,e,t){const i=n.type;if(!n.render){if(!e&&DA&&!i.render){const s=i.template||ob(n).template;if(s){const{isCustomElement:r,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=i,c=Qi(Qi({isCustomElement:r,delimiters:a},o),l);i.render=DA(s,c)}}n.render=i.render||fr}Mu(n),oh(),jN(n),ah(),Nl()}u(BT,"finishComponentSetup");function y4(n){return new Proxy(n.attrs,{get(e,t){return Is(n,"get","$attrs"),e[t]}})}u(y4,"createAttrsProxy");function _4(n){const e=u(i=>{n.exposed=i||{}},"expose");let t;return{get attrs(){return t||(t=y4(n))},slots:n.slots,emit:n.emit,expose:e}}u(_4,"createSetupContext");function _0(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(fT(aT(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in qf)return qf[t](n)},has(e,t){return t in e||t in qf}}))}u(_0,"getExposeProxy");function b4(n,e=!0){return dt(n)?n.displayName||n.name:n.name||e&&n.__name}u(b4,"getComponentName");function w4(n){return dt(n)&&"__vccOpts"in n}u(w4,"isClassComponent");const st=u((n,e)=>bN(n,e,md),"computed");function UT(n,e,t){const i=arguments.length;return i===2?vn(e)&&!ut(e)?Fg(e)?Ee(n,null,[e]):Ee(n,e):Ee(n,null,e):(i>3?t=Array.prototype.slice.call(arguments,2):i===3&&Fg(t)&&(t=[t]),Ee(n,e,t))}u(UT,"h");const x4=Symbol(""),A4=u(()=>Ii(x4),"useSSRContext"),M4="3.2.45",S4="http://www.w3.org/2000/svg",Cl=typeof document!="undefined"?document:null,LA=Cl&&Cl.createElement("template"),C4={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,i)=>{const s=e?Cl.createElementNS(S4,n):Cl.createElement(n,t?{is:t}:void 0);return n==="select"&&i&&i.multiple!=null&&s.setAttribute("multiple",i.multiple),s},createText:n=>Cl.createTextNode(n),createComment:n=>Cl.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Cl.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,i,s,r){const o=t?t.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===r||!(s=s.nextSibling)););else{LA.innerHTML=i?`<svg>${n}</svg>`:n;const a=LA.content;if(i){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}};function E4(n,e,t){const i=n._vtc;i&&(e=(e?[e,...i]:[...i]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}u(E4,"patchClass");function T4(n,e,t){const i=n.style,s=$n(t);if(t&&!s){for(const r in t)i_(i,r,t[r]);if(e&&!$n(e))for(const r in e)t[r]==null&&i_(i,r,"")}else{const r=i.display;s?e!==t&&(i.cssText=t):e&&n.removeAttribute("style"),"_vod"in n&&(i.display=r)}}u(T4,"patchStyle");const OA=/\s*!important$/;function i_(n,e,t){if(ut(t))t.forEach(i=>i_(n,e,i));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const i=P4(n,e);OA.test(t)?n.setProperty(tc(i),t.replace(OA,""),"important"):n[i]=t}}u(i_,"setStyle");const kA=["Webkit","Moz","ms"],T1={};function P4(n,e){const t=T1[e];if(t)return t;let i=Vr(e);if(i!=="filter"&&i in n)return T1[e]=i;i=l0(i);for(let s=0;s<kA.length;s++){const r=kA[s]+i;if(r in n)return T1[e]=r}return e}u(P4,"autoPrefix");const NA="http://www.w3.org/1999/xlink";function R4(n,e,t,i,s){if(i&&e.startsWith("xlink:"))t==null?n.removeAttributeNS(NA,e.slice(6,e.length)):n.setAttributeNS(NA,e,t);else{const r=Fk(e);t==null||r&&!VE(t)?n.removeAttribute(e):n.setAttribute(e,r?"":t)}}u(R4,"patchAttr");function I4(n,e,t,i,s,r,o){if(e==="innerHTML"||e==="textContent"){i&&o(i,s,r),n[e]=t==null?"":t;return}if(e==="value"&&n.tagName!=="PROGRESS"&&!n.tagName.includes("-")){n._value=t;const l=t==null?"":t;(n.value!==l||n.tagName==="OPTION")&&(n.value=l),t==null&&n.removeAttribute(e);return}let a=!1;if(t===""||t==null){const l=typeof n[e];l==="boolean"?t=VE(t):t==null&&l==="string"?(t="",a=!0):l==="number"&&(t=0,a=!0)}try{n[e]=t}catch{}a&&n.removeAttribute(e)}u(I4,"patchDOMProp");function Kc(n,e,t,i){n.addEventListener(e,t,i)}u(Kc,"addEventListener");function D4(n,e,t,i){n.removeEventListener(e,t,i)}u(D4,"removeEventListener");function L4(n,e,t,i,s=null){const r=n._vei||(n._vei={}),o=r[e];if(i&&o)o.value=i;else{const[a,l]=O4(e);if(i){const c=r[e]=F4(i,s);Kc(n,a,c,l)}else o&&(D4(n,a,o,l),r[e]=void 0)}}u(L4,"patchEvent");const FA=/(?:Once|Passive|Capture)$/;function O4(n){let e;if(FA.test(n)){e={};let i;for(;i=n.match(FA);)n=n.slice(0,n.length-i[0].length),e[i[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):tc(n.slice(2)),e]}u(O4,"parseName");let P1=0;const k4=Promise.resolve(),N4=u(()=>P1||(k4.then(()=>P1=0),P1=Date.now()),"getNow");function F4(n,e){const t=u(i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=t.attached)return;dr(z4(i,t.value),e,5,[i])},"invoker");return t.value=n,t.attached=N4(),t}u(F4,"createInvoker");function z4(n,e){if(ut(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(i=>s=>!s._stopped&&i&&i(s))}else return e}u(z4,"patchStopImmediatePropagation");const zA=/^on[a-z]/,B4=u((n,e,t,i,s=!1,r,o,a,l)=>{e==="class"?E4(n,i,s):e==="style"?T4(n,t,i):r0(e)?X_(e)||L4(n,e,t,i,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):U4(n,e,i,s))?I4(n,e,i,r,o,a,l):(e==="true-value"?n._trueValue=i:e==="false-value"&&(n._falseValue=i),R4(n,e,i,s))},"patchProp");function U4(n,e,t,i){return i?!!(e==="innerHTML"||e==="textContent"||e in n&&zA.test(e)&&dt(t)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA"||zA.test(e)&&$n(t)?!1:e in n}u(U4,"shouldSetAsProp");const BA=u(n=>{const e=n.props["onUpdate:modelValue"]||!1;return ut(e)?t=>vg(e,t):e},"getModelAssigner");function $4(n){n.target.composing=!0}u($4,"onCompositionStart");function UA(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}u(UA,"onCompositionEnd");const $T={created(n,{modifiers:{lazy:e,trim:t,number:i}},s){n._assign=BA(s);const r=i||s.props&&s.props.type==="number";Kc(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),r&&(a=Lg(a)),n._assign(a)}),t&&Kc(n,"change",()=>{n.value=n.value.trim()}),e||(Kc(n,"compositionstart",$4),Kc(n,"compositionend",UA),Kc(n,"change",UA))},mounted(n,{value:e}){n.value=e==null?"":e},beforeUpdate(n,{value:e,modifiers:{lazy:t,trim:i,number:s}},r){if(n._assign=BA(r),n.composing||document.activeElement===n&&n.type!=="range"&&(t||i&&n.value.trim()===e||(s||n.type==="number")&&Lg(n.value)===e))return;const o=e==null?"":e;n.value!==o&&(n.value=o)}},V4=["ctrl","shift","alt","meta"],G4={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>V4.some(t=>n[`${t}Key`]&&!e.includes(t))},Fn=u((n,e)=>(t,...i)=>{for(let s=0;s<e.length;s++){const r=G4[e[s]];if(r&&r(t,e))return}return n(t,...i)},"withModifiers"),H4={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},En=u((n,e)=>t=>{if(!("key"in t))return;const i=tc(t.key);if(e.some(s=>s===i||H4[s]===i))return n(t)},"withKeys"),vp={beforeMount(n,{value:e},{transition:t}){n._vod=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Eh(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:i}){!e!=!t&&(i?e?(i.beforeEnter(n),Eh(n,!0),i.enter(n)):i.leave(n,()=>{Eh(n,!1)}):Eh(n,e))},beforeUnmount(n,{value:e}){Eh(n,e)}};function Eh(n,e){n.style.display=e?n._vod:"none"}u(Eh,"setDisplay");const W4=Qi({patchProp:B4},C4);let $A;function j4(){return $A||($A=s4(W4))}u(j4,"ensureRenderer");const VT=u((...n)=>{const e=j4().createApp(...n),{mount:t}=e;return e.mount=i=>{const s=X4(i);if(!s)return;const r=e._component;!dt(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.innerHTML="";const o=t(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e},"createApp");function X4(n){return $n(n)?document.querySelector(n):n}u(X4,"normalizeContainer");var Y4=Object.defineProperty,R1=u((n,e)=>Y4(n,"name",{value:e,configurable:!0}),"__name$3o"),q4=zt({setup(){const n=Ii("errorSignal"),e=Ge(""),t=Ge(!1),i=R1(o=>{console.error(o),o instanceof Error?e.value=o.stack+"":e.value=o+"",t.value=!0},"showErrorMessageWindow"),s=R1(o=>{i(o.error)},"onError"),r=R1(o=>{i(o.reason)},"onUnhandledRejection");return n.addListener(i),window.addEventListener("error",s),window.addEventListener("unhandledrejection",r),g0(()=>{n.removeListener(i),window.removeEventListener("error",s),window.removeEventListener("unhandledrejection",r)}),{errorMessage:e,errorMessageWindowVisible:t}}});var Wt=u((n,e)=>{const t=n.__vccOpts||n;for(const[i,s]of e)t[i]=s;return t},"_export_sfc");const Z4=u(n=>(Fa("data-v-18bfa632"),n=n(),za(),n),"_withScopeId$7"),K4={key:0,class:"dialog-mask"},Q4={class:"dialog"},J4=Z4(()=>ue("div",{style:{"margin-bottom":".25em"}},"An error occurred.",-1)),eF={readonly:""},tF={style:{"text-align":"right"}};function nF(n,e,t,i,s,r){const o=pn("router-view");return Ce(),Be(Nt,null,[Ee(o),n.errorMessageWindowVisible?(Ce(),Be("div",K4,[ue("div",Q4,[J4,ue("textarea",eF,Tn(n.errorMessage),1),ue("div",tF,[ue("button",{onClick:e[0]||(e[0]=a=>n.errorMessageWindowVisible=!1)},"Close")])])])):tt("",!0)],64)}u(nF,"_sfc_render$t");var iF=Wt(q4,[["render",nF],["__scopeId","data-v-18bfa632"]]),sF=Object.defineProperty,rF=u((n,e)=>sF(n,"name",{value:e,configurable:!0}),"__name$3n");class hb{constructor(){S(this,"listeners",[])}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.findIndex(i=>i===e);t>=0&&this.listeners.splice(t,1)}dispatch(e){this.listeners.forEach(t=>t(e))}}u(hb,"Signal");rF(hb,"Signal");/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const Qc=typeof window!="undefined";function oF(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}u(oF,"isESModule");const Xt=Object.assign;function I1(n,e){const t={};for(const i in e){const s=e[i];t[i]=gr(s)?s.map(n):n(s)}return t}u(I1,"applyToParams");const Qf=u(()=>{},"noop"),gr=Array.isArray,aF=/\/$/,lF=u(n=>n.replace(aF,""),"removeTrailingSlash");function D1(n,e,t="/"){let i,s={},r="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(i=e.slice(0,l),r=e.slice(l+1,a>-1?a:e.length),s=n(r)),a>-1&&(i=i||e.slice(0,a),o=e.slice(a,e.length)),i=fF(i!=null?i:e,t),{fullPath:i+(r&&"?")+r+o,path:i,query:s,hash:o}}u(D1,"parseURL");function cF(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}u(cF,"stringifyURL");function VA(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}u(VA,"stripBase");function uF(n,e,t){const i=e.matched.length-1,s=t.matched.length-1;return i>-1&&i===s&&Su(e.matched[i],t.matched[s])&&GT(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}u(uF,"isSameRouteLocation");function Su(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}u(Su,"isSameRouteRecord");function GT(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!hF(n[t],e[t]))return!1;return!0}u(GT,"isSameRouteLocationParams");function hF(n,e){return gr(n)?GA(n,e):gr(e)?GA(e,n):n===e}u(hF,"isSameRouteLocationParamsValue");function GA(n,e){return gr(e)?n.length===e.length&&n.every((t,i)=>t===e[i]):n.length===1&&n[0]===e}u(GA,"isEquivalentArray");function fF(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),i=n.split("/");let s=t.length-1,r,o;for(r=0;r<i.length;r++)if(o=i[r],o!==".")if(o==="..")s>1&&s--;else break;return t.slice(0,s).join("/")+"/"+i.slice(r-(r===i.length?1:0)).join("/")}u(fF,"resolveRelativePath");var gd;(function(n){n.pop="pop",n.push="push"})(gd||(gd={}));var Jf;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Jf||(Jf={}));function dF(n){if(!n)if(Qc){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),lF(n)}u(dF,"normalizeBase");const pF=/^[^#]+#/;function mF(n,e){return n.replace(pF,"#")+e}u(mF,"createHref");function gF(n,e){const t=document.documentElement.getBoundingClientRect(),i=n.getBoundingClientRect();return{behavior:e.behavior,left:i.left-t.left-(e.left||0),top:i.top-t.top-(e.top||0)}}u(gF,"getElementPosition");const b0=u(()=>({left:window.pageXOffset,top:window.pageYOffset}),"computeScrollPosition");function vF(n){let e;if("el"in n){const t=n.el,i=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?i?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=gF(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}u(vF,"scrollToPosition");function HA(n,e){return(history.state?history.state.position-e:-1)+n}u(HA,"getScrollKey");const s_=new Map;function yF(n,e){s_.set(n,e)}u(yF,"saveScrollPosition");function _F(n){const e=s_.get(n);return s_.delete(n),e}u(_F,"getSavedScrollPosition");let bF=u(()=>location.protocol+"//"+location.host,"createBaseLocation");function HT(n,e){const{pathname:t,search:i,hash:s}=e,r=n.indexOf("#");if(r>-1){let a=s.includes(n.slice(r))?n.slice(r).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),VA(l,"")}return VA(t,n)+i+s}u(HT,"createCurrentLocation");function wF(n,e,t,i){let s=[],r=[],o=null;const a=u(({state:d})=>{const p=HT(n,location),g=t.value,m=e.value;let v=0;if(d){if(t.value=p,e.value=d,o&&o===g){o=null;return}v=m?d.position-m.position:0}else i(p);s.forEach(y=>{y(t.value,g,{delta:v,type:gd.pop,direction:v?v>0?Jf.forward:Jf.back:Jf.unknown})})},"popStateHandler");function l(){o=t.value}u(l,"pauseListeners");function c(d){s.push(d);const p=u(()=>{const g=s.indexOf(d);g>-1&&s.splice(g,1)},"teardown");return r.push(p),p}u(c,"listen");function h(){const{history:d}=window;!d.state||d.replaceState(Xt({},d.state,{scroll:b0()}),"")}u(h,"beforeUnloadListener");function f(){for(const d of r)d();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return u(f,"destroy"),window.addEventListener("popstate",a),window.addEventListener("beforeunload",h),{pauseListeners:l,listen:c,destroy:f}}u(wF,"useHistoryListeners");function WA(n,e,t,i=!1,s=!1){return{back:n,current:e,forward:t,replaced:i,position:window.history.length,scroll:s?b0():null}}u(WA,"buildState");function xF(n){const{history:e,location:t}=window,i={value:HT(n,t)},s={value:e.state};s.value||r(i.value,{back:null,current:i.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(l,c,h){const f=n.indexOf("#"),d=f>-1?(t.host&&document.querySelector("base")?n:n.slice(f))+l:bF()+n+l;try{e[h?"replaceState":"pushState"](c,"",d),s.value=c}catch(p){console.error(p),t[h?"replace":"assign"](d)}}u(r,"changeLocation");function o(l,c){const h=Xt({},e.state,WA(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});r(l,h,!0),i.value=l}u(o,"replace");function a(l,c){const h=Xt({},s.value,e.state,{forward:l,scroll:b0()});r(h.current,h,!0);const f=Xt({},WA(i.value,l,null),{position:h.position+1},c);r(l,f,!1),i.value=l}return u(a,"push"),{location:i,state:s,push:a,replace:o}}u(xF,"useHistoryStateNavigation");function AF(n){n=dF(n);const e=xF(n),t=wF(n,e.state,e.location,e.replace);function i(r,o=!0){o||t.pauseListeners(),history.go(r)}u(i,"go");const s=Xt({location:"",base:n,go:i,createHref:mF.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}u(AF,"createWebHistory");function MF(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),AF(n)}u(MF,"createWebHashHistory");function SF(n){return typeof n=="string"||n&&typeof n=="object"}u(SF,"isRouteLocation");function WT(n){return typeof n=="string"||typeof n=="symbol"}u(WT,"isRouteName");const jo={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},jT=Symbol("");var jA;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(jA||(jA={}));function Cu(n,e){return Xt(new Error,{type:n,[jT]:!0},e)}u(Cu,"createRouterError");function jr(n,e){return n instanceof Error&&jT in n&&(e==null||!!(n.type&e))}u(jr,"isNavigationFailure");const XA="[^/]+?",CF={sensitive:!1,strict:!1,start:!0,end:!0},EF=/[.+*?^${}()[\]/\\]/g;function TF(n,e){const t=Xt({},CF,e),i=[];let s=t.start?"^":"";const r=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let f=0;f<c.length;f++){const d=c[f];let p=40+(t.sensitive?.25:0);if(d.type===0)f||(s+="/"),s+=d.value.replace(EF,"\\$&"),p+=40;else if(d.type===1){const{value:g,repeatable:m,optional:v,regexp:y}=d;r.push({name:g,repeatable:m,optional:v});const b=y||XA;if(b!==XA){p+=10;try{new RegExp(`(${b})`)}catch(x){throw new Error(`Invalid custom RegExp for param "${g}" (${b}): `+x.message)}}let _=m?`((?:${b})(?:/(?:${b}))*)`:`(${b})`;f||(_=v&&c.length<2?`(?:/${_})`:"/"+_),v&&(_+="?"),s+=_,p+=20,v&&(p+=-8),m&&(p+=-20),b===".*"&&(p+=-50)}h.push(p)}i.push(h)}if(t.strict&&t.end){const c=i.length-1;i[c][i[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),f={};if(!h)return null;for(let d=1;d<h.length;d++){const p=h[d]||"",g=r[d-1];f[g.name]=p&&g.repeatable?p.split("/"):p}return f}u(a,"parse");function l(c){let h="",f=!1;for(const d of n){(!f||!h.endsWith("/"))&&(h+="/"),f=!1;for(const p of d)if(p.type===0)h+=p.value;else if(p.type===1){const{value:g,repeatable:m,optional:v}=p,y=g in c?c[g]:"";if(gr(y)&&!m)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const b=gr(y)?y.join("/"):y;if(!b)if(v)d.length<2&&(h.endsWith("/")?h=h.slice(0,-1):f=!0);else throw new Error(`Missing required param "${g}"`);h+=b}}return h||"/"}return u(l,"stringify"),{re:o,score:i,keys:r,parse:a,stringify:l}}u(TF,"tokensToParser");function PF(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=e[t]-n[t];if(i)return i;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}u(PF,"compareScoreArray");function RF(n,e){let t=0;const i=n.score,s=e.score;for(;t<i.length&&t<s.length;){const r=PF(i[t],s[t]);if(r)return r;t++}if(Math.abs(s.length-i.length)===1){if(YA(i))return 1;if(YA(s))return-1}return s.length-i.length}u(RF,"comparePathParserScore");function YA(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}u(YA,"isLastScoreNegative");const IF={type:0,value:""},DF=/[a-zA-Z0-9_]/;function LF(n){if(!n)return[[]];if(n==="/")return[[IF]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(p){throw new Error(`ERR (${t})/"${c}": ${p}`)}u(e,"crash");let t=0,i=t;const s=[];let r;function o(){r&&s.push(r),r=[]}u(o,"finalizeSegment");let a=0,l,c="",h="";function f(){!c||(t===0?r.push({type:0,value:c}):t===1||t===2||t===3?(r.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}u(f,"consumeBuffer");function d(){c+=l}for(u(d,"addCharToBuffer");a<n.length;){if(l=n[a++],l==="\\"&&t!==2){i=t,t=4;continue}switch(t){case 0:l==="/"?(c&&f(),o()):l===":"?(f(),t=1):d();break;case 4:d(),t=i;break;case 1:l==="("?t=2:DF.test(l)?d():(f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:f(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),f(),o(),s}u(LF,"tokenizePath");function OF(n,e,t){const i=TF(LF(n.path),t),s=Xt(i,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}u(OF,"createRouteRecordMatcher");function kF(n,e){const t=[],i=new Map;e=KA({strict:!1,end:!0,sensitive:!1},e);function s(h){return i.get(h)}u(s,"getRecordMatcher");function r(h,f,d){const p=!d,g=NF(h);g.aliasOf=d&&d.record;const m=KA(e,h),v=[g];if("alias"in h){const _=typeof h.alias=="string"?[h.alias]:h.alias;for(const x of _)v.push(Xt({},g,{components:d?d.record.components:g.components,path:x,aliasOf:d?d.record:g}))}let y,b;for(const _ of v){const{path:x}=_;if(f&&x[0]!=="/"){const w=f.record.path,M=w[w.length-1]==="/"?"":"/";_.path=f.record.path+(x&&M+x)}if(y=OF(_,f,m),d?d.alias.push(y):(b=b||y,b!==y&&b.alias.push(y),p&&h.name&&!ZA(y)&&o(h.name)),g.children){const w=g.children;for(let M=0;M<w.length;M++)r(w[M],y,d&&d.children[M])}d=d||y,(y.record.components&&Object.keys(y.record.components).length||y.record.name||y.record.redirect)&&l(y)}return b?()=>{o(b)}:Qf}u(r,"addRoute");function o(h){if(WT(h)){const f=i.get(h);f&&(i.delete(h),t.splice(t.indexOf(f),1),f.children.forEach(o),f.alias.forEach(o))}else{const f=t.indexOf(h);f>-1&&(t.splice(f,1),h.record.name&&i.delete(h.record.name),h.children.forEach(o),h.alias.forEach(o))}}u(o,"removeRoute");function a(){return t}u(a,"getRoutes");function l(h){let f=0;for(;f<t.length&&RF(h,t[f])>=0&&(h.record.path!==t[f].record.path||!XT(h,t[f]));)f++;t.splice(f,0,h),h.record.name&&!ZA(h)&&i.set(h.record.name,h)}u(l,"insertMatcher");function c(h,f){let d,p={},g,m;if("name"in h&&h.name){if(d=i.get(h.name),!d)throw Cu(1,{location:h});m=d.record.name,p=Xt(qA(f.params,d.keys.filter(b=>!b.optional).map(b=>b.name)),h.params&&qA(h.params,d.keys.map(b=>b.name))),g=d.stringify(p)}else if("path"in h)g=h.path,d=t.find(b=>b.re.test(g)),d&&(p=d.parse(g),m=d.record.name);else{if(d=f.name?i.get(f.name):t.find(b=>b.re.test(f.path)),!d)throw Cu(1,{location:h,currentLocation:f});m=d.record.name,p=Xt({},f.params,h.params),g=d.stringify(p)}const v=[];let y=d;for(;y;)v.unshift(y.record),y=y.parent;return{name:m,path:g,params:p,matched:v,meta:zF(v)}}return u(c,"resolve"),n.forEach(h=>r(h)),{addRoute:r,resolve:c,removeRoute:o,getRoutes:a,getRecordMatcher:s}}u(kF,"createRouterMatcher");function qA(n,e){const t={};for(const i of e)i in n&&(t[i]=n[i]);return t}u(qA,"paramsFromLocation");function NF(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:FF(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}u(NF,"normalizeRouteRecord");function FF(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const i in n.components)e[i]=typeof t=="boolean"?t:t[i];return e}u(FF,"normalizeRecordProps");function ZA(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}u(ZA,"isAliasRecord");function zF(n){return n.reduce((e,t)=>Xt(e,t.meta),{})}u(zF,"mergeMetaFields");function KA(n,e){const t={};for(const i in n)t[i]=i in e?e[i]:n[i];return t}u(KA,"mergeOptions");function XT(n,e){return e.children.some(t=>t===n||XT(n,t))}u(XT,"isRecordChildOf");const YT=/#/g,BF=/&/g,UF=/\//g,$F=/=/g,VF=/\?/g,qT=/\+/g,GF=/%5B/g,HF=/%5D/g,ZT=/%5E/g,WF=/%60/g,KT=/%7B/g,jF=/%7C/g,QT=/%7D/g,XF=/%20/g;function fb(n){return encodeURI(""+n).replace(jF,"|").replace(GF,"[").replace(HF,"]")}u(fb,"commonEncode");function YF(n){return fb(n).replace(KT,"{").replace(QT,"}").replace(ZT,"^")}u(YF,"encodeHash");function r_(n){return fb(n).replace(qT,"%2B").replace(XF,"+").replace(YT,"%23").replace(BF,"%26").replace(WF,"`").replace(KT,"{").replace(QT,"}").replace(ZT,"^")}u(r_,"encodeQueryValue");function qF(n){return r_(n).replace($F,"%3D")}u(qF,"encodeQueryKey");function ZF(n){return fb(n).replace(YT,"%23").replace(VF,"%3F")}u(ZF,"encodePath");function KF(n){return n==null?"":ZF(n).replace(UF,"%2F")}u(KF,"encodeParam");function zg(n){try{return decodeURIComponent(""+n)}catch{}return""+n}u(zg,"decode");function QF(n){const e={};if(n===""||n==="?")return e;const i=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<i.length;++s){const r=i[s].replace(qT," "),o=r.indexOf("="),a=zg(o<0?r:r.slice(0,o)),l=o<0?null:zg(r.slice(o+1));if(a in e){let c=e[a];gr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}u(QF,"parseQuery");function QA(n){let e="";for(let t in n){const i=n[t];if(t=qF(t),i==null){i!==void 0&&(e+=(e.length?"&":"")+t);continue}(gr(i)?i.map(r=>r&&r_(r)):[i&&r_(i)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}u(QA,"stringifyQuery");function JF(n){const e={};for(const t in n){const i=n[t];i!==void 0&&(e[t]=gr(i)?i.map(s=>s==null?null:""+s):i==null?i:""+i)}return e}u(JF,"normalizeQuery");const e5=Symbol(""),JA=Symbol(""),w0=Symbol(""),JT=Symbol(""),o_=Symbol("");function Th(){let n=[];function e(i){return n.push(i),()=>{const s=n.indexOf(i);s>-1&&n.splice(s,1)}}u(e,"add");function t(){n=[]}return u(t,"reset"),{add:e,list:()=>n,reset:t}}u(Th,"useCallbacks");function wa(n,e,t,i,s){const r=i&&(i.enterCallbacks[s]=i.enterCallbacks[s]||[]);return()=>new Promise((o,a)=>{const l=u(f=>{f===!1?a(Cu(4,{from:t,to:e})):f instanceof Error?a(f):SF(f)?a(Cu(2,{from:e,to:f})):(r&&i.enterCallbacks[s]===r&&typeof f=="function"&&r.push(f),o())},"next"),c=n.call(i&&i.instances[s],e,t,l);let h=Promise.resolve(c);n.length<3&&(h=h.then(l)),h.catch(f=>a(f))})}u(wa,"guardToPromiseFn");function L1(n,e,t,i){const s=[];for(const r of n)for(const o in r.components){let a=r.components[o];if(!(e!=="beforeRouteEnter"&&!r.instances[o]))if(t5(a)){const c=(a.__vccOpts||a)[e];c&&s.push(wa(c,t,i,r,o))}else{let l=a();s.push(()=>l.then(c=>{if(!c)return Promise.reject(new Error(`Couldn't resolve component "${o}" at "${r.path}"`));const h=oF(c)?c.default:c;r.components[o]=h;const d=(h.__vccOpts||h)[e];return d&&wa(d,t,i,r,o)()}))}}return s}u(L1,"extractComponentsGuards");function t5(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}u(t5,"isRouteComponent");function eM(n){const e=Ii(w0),t=Ii(JT),i=st(()=>e.resolve(mu(n.to))),s=st(()=>{const{matched:l}=i.value,{length:c}=l,h=l[c-1],f=t.matched;if(!h||!f.length)return-1;const d=f.findIndex(Su.bind(null,h));if(d>-1)return d;const p=tM(l[c-2]);return c>1&&tM(h)===p&&f[f.length-1].path!==p?f.findIndex(Su.bind(null,l[c-2])):d}),r=st(()=>s.value>-1&&r5(t.params,i.value.params)),o=st(()=>s.value>-1&&s.value===t.matched.length-1&&GT(t.params,i.value.params));function a(l={}){return s5(l)?e[mu(n.replace)?"replace":"push"](mu(n.to)).catch(Qf):Promise.resolve()}return u(a,"navigate"),{route:i,href:st(()=>i.value.href),isActive:r,isExactActive:o,navigate:a}}u(eM,"useLink");const n5=zt({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:eM,setup(n,{slots:e}){const t=To(eM(n)),{options:i}=Ii(w0),s=st(()=>({[nM(n.activeClass,i.linkActiveClass,"router-link-active")]:t.isActive,[nM(n.exactActiveClass,i.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&e.default(t);return n.custom?r:UT("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},r)}}}),i5=n5;function s5(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}u(s5,"guardEvent");function r5(n,e){for(const t in e){const i=e[t],s=n[t];if(typeof i=="string"){if(i!==s)return!1}else if(!gr(s)||s.length!==i.length||i.some((r,o)=>r!==s[o]))return!1}return!0}u(r5,"includesParams");function tM(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}u(tM,"getOriginalPath");const nM=u((n,e,t)=>n!=null?n:e!=null?e:t,"getLinkClass"),o5=zt({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const i=Ii(o_),s=st(()=>n.route||i.value),r=Ii(JA,0),o=st(()=>{let c=mu(r);const{matched:h}=s.value;let f;for(;(f=h[c])&&!f.components;)c++;return c}),a=st(()=>s.value.matched[o.value]);vu(JA,st(()=>o.value+1)),vu(e5,a),vu(o_,s);const l=Ge();return qi(()=>[l.value,a.value,n.name],([c,h,f],[d,p,g])=>{h&&(h.instances[f]=c,p&&p!==h&&c&&c===d&&(h.leaveGuards.size||(h.leaveGuards=p.leaveGuards),h.updateGuards.size||(h.updateGuards=p.updateGuards))),c&&h&&(!p||!Su(h,p)||!d)&&(h.enterCallbacks[f]||[]).forEach(m=>m(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,f=a.value,d=f&&f.components[h];if(!d)return iM(t.default,{Component:d,route:c});const p=f.props[h],g=p?p===!0?c.params:typeof p=="function"?p(c):p:null,v=UT(d,Xt({},g,e,{onVnodeUnmounted:u(y=>{y.component.isUnmounted&&(f.instances[h]=null)},"onVnodeUnmounted"),ref:l}));return iM(t.default,{Component:v,route:c})||v}}});function iM(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}u(iM,"normalizeSlot");const a5=o5;function l5(n){const e=kF(n.routes,n),t=n.parseQuery||QF,i=n.stringifyQuery||QA,s=n.history,r=Th(),o=Th(),a=Th(),l=yN(jo);let c=jo;Qc&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=I1.bind(null,J=>""+J),f=I1.bind(null,KF),d=I1.bind(null,zg);function p(J,te){let ge,he;return WT(J)?(ge=e.getRecordMatcher(J),he=te):he=J,e.addRoute(he,ge)}u(p,"addRoute");function g(J){const te=e.getRecordMatcher(J);te&&e.removeRoute(te)}u(g,"removeRoute");function m(){return e.getRoutes().map(J=>J.record)}u(m,"getRoutes");function v(J){return!!e.getRecordMatcher(J)}u(v,"hasRoute");function y(J,te){if(te=Xt({},te||l.value),typeof J=="string"){const V=D1(t,J,te.path),Y=e.resolve({path:V.path},te),R=s.createHref(V.fullPath);return Xt(V,Y,{params:d(Y.params),hash:zg(V.hash),redirectedFrom:void 0,href:R})}let ge;if("path"in J)ge=Xt({},J,{path:D1(t,J.path,te.path).path});else{const V=Xt({},J.params);for(const Y in V)V[Y]==null&&delete V[Y];ge=Xt({},J,{params:f(J.params)}),te.params=f(te.params)}const he=e.resolve(ge,te),we=J.hash||"";he.params=h(d(he.params));const xe=cF(i,Xt({},J,{hash:YF(we),path:he.path})),Se=s.createHref(xe);return Xt({fullPath:xe,hash:we,query:i===QA?JF(J.query):J.query||{}},he,{redirectedFrom:void 0,href:Se})}u(y,"resolve");function b(J){return typeof J=="string"?D1(t,J,l.value.path):Xt({},J)}u(b,"locationAsObject");function _(J,te){if(c!==J)return Cu(8,{from:te,to:J})}u(_,"checkCanceledNavigation");function x(J){return C(J)}u(x,"push");function w(J){return x(Xt(b(J),{replace:!0}))}u(w,"replace");function M(J){const te=J.matched[J.matched.length-1];if(te&&te.redirect){const{redirect:ge}=te;let he=typeof ge=="function"?ge(J):ge;return typeof he=="string"&&(he=he.includes("?")||he.includes("#")?he=b(he):{path:he},he.params={}),Xt({query:J.query,hash:J.hash,params:"path"in he?{}:J.params},he)}}u(M,"handleRedirectRecord");function C(J,te){const ge=c=y(J),he=l.value,we=J.state,xe=J.force,Se=J.replace===!0,V=M(ge);if(V)return C(Xt(b(V),{state:typeof V=="object"?Xt({},we,V.state):we,force:xe,replace:Se}),te||ge);const Y=ge;Y.redirectedFrom=te;let R;return!xe&&uF(i,he,ge)&&(R=Cu(16,{to:Y,from:he}),ie(he,he,!0,!1)),(R?Promise.resolve(R):P(Y,he)).catch(ee=>jr(ee)?jr(ee,2)?ee:j(ee):Z(ee,Y,he)).then(ee=>{if(ee){if(jr(ee,2))return C(Xt({replace:Se},b(ee.to),{state:typeof ee.to=="object"?Xt({},we,ee.to.state):we,force:xe}),te||Y)}else ee=k(Y,he,!0,Se,we);return D(Y,he,ee),ee})}u(C,"pushWithRedirect");function A(J,te){const ge=_(J,te);return ge?Promise.reject(ge):Promise.resolve()}u(A,"checkCanceledNavigationAndReject");function P(J,te){let ge;const[he,we,xe]=c5(J,te);ge=L1(he.reverse(),"beforeRouteLeave",J,te);for(const V of he)V.leaveGuards.forEach(Y=>{ge.push(wa(Y,J,te))});const Se=A.bind(null,J,te);return ge.push(Se),fc(ge).then(()=>{ge=[];for(const V of r.list())ge.push(wa(V,J,te));return ge.push(Se),fc(ge)}).then(()=>{ge=L1(we,"beforeRouteUpdate",J,te);for(const V of we)V.updateGuards.forEach(Y=>{ge.push(wa(Y,J,te))});return ge.push(Se),fc(ge)}).then(()=>{ge=[];for(const V of J.matched)if(V.beforeEnter&&!te.matched.includes(V))if(gr(V.beforeEnter))for(const Y of V.beforeEnter)ge.push(wa(Y,J,te));else ge.push(wa(V.beforeEnter,J,te));return ge.push(Se),fc(ge)}).then(()=>(J.matched.forEach(V=>V.enterCallbacks={}),ge=L1(xe,"beforeRouteEnter",J,te),ge.push(Se),fc(ge))).then(()=>{ge=[];for(const V of o.list())ge.push(wa(V,J,te));return ge.push(Se),fc(ge)}).catch(V=>jr(V,8)?V:Promise.reject(V))}u(P,"navigate");function D(J,te,ge){for(const he of a.list())he(J,te,ge)}u(D,"triggerAfterEach");function k(J,te,ge,he,we){const xe=_(J,te);if(xe)return xe;const Se=te===jo,V=Qc?history.state:{};ge&&(he||Se?s.replace(J.fullPath,Xt({scroll:Se&&V&&V.scroll},we)):s.push(J.fullPath,we)),l.value=J,ie(J,te,ge,Se),j()}u(k,"finalizeNavigation");let O;function N(){O||(O=s.listen((J,te,ge)=>{if(!ae.listening)return;const he=y(J),we=M(he);if(we){C(Xt(we,{replace:!0}),he).catch(Qf);return}c=he;const xe=l.value;Qc&&yF(HA(xe.fullPath,ge.delta),b0()),P(he,xe).catch(Se=>jr(Se,12)?Se:jr(Se,2)?(C(Se.to,he).then(V=>{jr(V,20)&&!ge.delta&&ge.type===gd.pop&&s.go(-1,!1)}).catch(Qf),Promise.reject()):(ge.delta&&s.go(-ge.delta,!1),Z(Se,he,xe))).then(Se=>{Se=Se||k(he,xe,!1),Se&&(ge.delta&&!jr(Se,8)?s.go(-ge.delta,!1):ge.type===gd.pop&&jr(Se,20)&&s.go(-1,!1)),D(he,xe,Se)}).catch(Qf)}))}u(N,"setupListeners");let E=Th(),B=Th(),W;function Z(J,te,ge){j(J);const he=B.list();return he.length?he.forEach(we=>we(J,te,ge)):console.error(J),Promise.reject(J)}u(Z,"triggerError");function ne(){return W&&l.value!==jo?Promise.resolve():new Promise((J,te)=>{E.add([J,te])})}u(ne,"isReady");function j(J){return W||(W=!J,N(),E.list().forEach(([te,ge])=>J?ge(J):te()),E.reset()),J}u(j,"markAsReady");function ie(J,te,ge,he){const{scrollBehavior:we}=n;if(!Qc||!we)return Promise.resolve();const xe=!ge&&_F(HA(J.fullPath,0))||(he||!ge)&&history.state&&history.state.scroll||null;return Vs().then(()=>we(J,te,xe)).then(Se=>Se&&vF(Se)).catch(Se=>Z(Se,J,te))}u(ie,"handleScroll");const K=u(J=>s.go(J),"go");let $;const le=new Set,ae={currentRoute:l,listening:!0,addRoute:p,removeRoute:g,hasRoute:v,getRoutes:m,resolve:y,options:n,push:x,replace:w,go:K,back:()=>K(-1),forward:()=>K(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:B.add,isReady:ne,install(J){const te=this;J.component("RouterLink",i5),J.component("RouterView",a5),J.config.globalProperties.$router=te,Object.defineProperty(J.config.globalProperties,"$route",{enumerable:!0,get:()=>mu(l)}),Qc&&!$&&l.value===jo&&($=!0,x(s.location).catch(we=>{}));const ge={};for(const we in jo)ge[we]=st(()=>l.value[we]);J.provide(w0,te),J.provide(JT,To(ge)),J.provide(o_,l);const he=J.unmount;le.add(J),J.unmount=function(){le.delete(J),le.size<1&&(c=jo,O&&O(),O=null,l.value=jo,$=!1,W=!1),he()}}};return ae}u(l5,"createRouter");function fc(n){return n.reduce((e,t)=>e.then(()=>t()),Promise.resolve())}u(fc,"runGuardQueue");function c5(n,e){const t=[],i=[],s=[],r=Math.max(e.matched.length,n.matched.length);for(let o=0;o<r;o++){const a=e.matched[o];a&&(n.matched.find(c=>Su(c,a))?i.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Su(c,l))||s.push(l))}return[t,i,s]}u(c5,"extractChangingRecords");function u5(){return Ii(w0)}u(u5,"useRouter");/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const db="146",h5=0,sM=1,f5=2,eP=1,tP=2,Ff=3,Ul=0,Ws=1,Ts=2,Br=0,yu=1,a_=2,rM=3,oM=4,d5=5,Jc=100,p5=101,m5=102,aM=103,lM=104,g5=200,v5=201,y5=202,_5=203,nP=204,iP=205,b5=206,w5=207,x5=208,A5=209,M5=210,S5=0,C5=1,E5=2,l_=3,T5=4,P5=5,R5=6,I5=7,x0=0,D5=1,L5=2,Ur=0,O5=1,k5=2,N5=3,F5=4,z5=5,sP=300,Eu=301,Tu=302,Bg=303,c_=304,A0=306,Do=1e3,Gi=1001,vd=1002,zn=1003,Ug=1004,$g=1005,Vi=1006,pb=1007,nc=1008,$l=1009,B5=1010,U5=1011,rP=1012,$5=1013,Il=1014,Ma=1015,Pu=1016,V5=1017,G5=1018,_u=1020,H5=1021,W5=1022,Es=1023,j5=1024,X5=1025,Fl=1026,Ru=1027,Y5=1028,q5=1029,Z5=1030,K5=1031,Q5=1033,O1=33776,k1=33777,N1=33778,F1=33779,cM=35840,uM=35841,hM=35842,fM=35843,J5=36196,dM=37492,pM=37496,mM=37808,gM=37809,vM=37810,yM=37811,_M=37812,bM=37813,wM=37814,xM=37815,AM=37816,MM=37817,SM=37818,CM=37819,EM=37820,TM=37821,PM=36492,Iu=2300,Vl=2301,z1=2302,RM=2400,IM=2401,DM=2402,ez=2500,tz=1,oP=2,Lo=3e3,It=3001,nz=3200,aP=3201,Gd=0,iz=1,wo="srgb",Dl="srgb-linear",B1=7680,sz=519,u_=35044,LM="300 es",h_=1035;class ic{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}u(ic,"EventDispatcher");const Ai=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let OM=1234567;const ed=Math.PI/180,yd=180/Math.PI;function pr(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Ai[n&255]+Ai[n>>8&255]+Ai[n>>16&255]+Ai[n>>24&255]+"-"+Ai[e&255]+Ai[e>>8&255]+"-"+Ai[e>>16&15|64]+Ai[e>>24&255]+"-"+Ai[t&63|128]+Ai[t>>8&255]+"-"+Ai[t>>16&255]+Ai[t>>24&255]+Ai[i&255]+Ai[i>>8&255]+Ai[i>>16&255]+Ai[i>>24&255]).toLowerCase()}u(pr,"generateUUID");function _i(n,e,t){return Math.max(e,Math.min(t,n))}u(_i,"clamp");function mb(n,e){return(n%e+e)%e}u(mb,"euclideanModulo");function rz(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}u(rz,"mapLinear");function oz(n,e,t){return n!==e?(t-n)/(e-n):0}u(oz,"inverseLerp");function td(n,e,t){return(1-t)*n+t*e}u(td,"lerp$2");function az(n,e,t,i){return td(n,e,1-Math.exp(-t*i))}u(az,"damp");function lz(n,e=1){return e-Math.abs(mb(n,e*2)-e)}u(lz,"pingpong");function cz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}u(cz,"smoothstep");function uz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}u(uz,"smootherstep");function hz(n,e){return n+Math.floor(Math.random()*(e-n+1))}u(hz,"randInt");function fz(n,e){return n+Math.random()*(e-n)}u(fz,"randFloat");function dz(n){return n*(.5-Math.random())}u(dz,"randFloatSpread");function pz(n){n!==void 0&&(OM=n);let e=OM+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}u(pz,"seededRandom");function mz(n){return n*ed}u(mz,"degToRad$1");function gz(n){return n*yd}u(gz,"radToDeg$1");function f_(n){return(n&n-1)===0&&n!==0}u(f_,"isPowerOfTwo");function lP(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}u(lP,"ceilPowerOfTwo");function Vg(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}u(Vg,"floorPowerOfTwo");function vz(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),f=r((e-i)/2),d=o((e-i)/2),p=r((i-e)/2),g=o((i-e)/2);switch(s){case"XYX":n.set(a*h,l*f,l*d,a*c);break;case"YZY":n.set(l*d,a*h,l*f,a*c);break;case"ZXZ":n.set(l*f,l*d,a*h,a*c);break;case"XZX":n.set(a*h,l*g,l*p,a*c);break;case"YXY":n.set(l*p,a*h,l*g,a*c);break;case"ZYZ":n.set(l*g,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}u(vz,"setQuaternionFromProperEuler");function So(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}u(So,"denormalize");function en(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}u(en,"normalize$4");var $s=Object.freeze({__proto__:null,DEG2RAD:ed,RAD2DEG:yd,generateUUID:pr,clamp:_i,euclideanModulo:mb,mapLinear:rz,inverseLerp:oz,lerp:td,damp:az,pingpong:lz,smoothstep:cz,smootherstep:uz,randInt:hz,randFloat:fz,randFloatSpread:dz,seededRandom:pz,degToRad:mz,radToDeg:gz,isPowerOfTwo:f_,ceilPowerOfTwo:lP,floorPowerOfTwo:Vg,setQuaternionFromProperEuler:vz,normalize:en,denormalize:So});class ke{constructor(e=0,t=0){ke.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}u(ke,"Vector2");class Wi{constructor(){Wi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,s,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=s,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],f=i[7],d=i[2],p=i[5],g=i[8],m=s[0],v=s[3],y=s[6],b=s[1],_=s[4],x=s[7],w=s[2],M=s[5],C=s[8];return r[0]=o*m+a*b+l*w,r[3]=o*v+a*_+l*M,r[6]=o*y+a*x+l*C,r[1]=c*m+h*b+f*w,r[4]=c*v+h*_+f*M,r[7]=c*y+h*x+f*C,r[2]=d*m+p*b+g*w,r[5]=d*v+p*_+g*M,r[8]=d*y+p*x+g*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],f=h*o-a*c,d=a*l-h*r,p=c*r-o*l,g=t*f+i*d+s*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/g;return e[0]=f*m,e[1]=(s*c-h*i)*m,e[2]=(a*i-s*o)*m,e[3]=d*m,e[4]=(h*t-s*l)*m,e[5]=(s*r-a*t)*m,e[6]=p*m,e[7]=(i*l-c*t)*m,e[8]=(o*t-i*r)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.elements,r=s[0],o=s[3],a=s[6],l=s[1],c=s[4],h=s[7];return s[0]=t*r+i*l,s[3]=t*o+i*c,s[6]=t*a+i*h,s[1]=-i*r+t*l,s[4]=-i*o+t*c,s[7]=-i*a+t*h,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}u(Wi,"Matrix3");function cP(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}u(cP,"arrayNeedsUint32");function _d(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}u(_d,"createElementNS");function zl(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}u(zl,"SRGBToLinear");function _g(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}u(_g,"LinearToSRGB");const U1={[wo]:{[Dl]:zl},[Dl]:{[wo]:_g}},Qs={legacyMode:!0,get workingColorSpace(){return Dl},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(U1[e]&&U1[e][t]!==void 0){const i=U1[e][t];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},uP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ei={r:0,g:0,b:0},Js={h:0,s:0,l:0},yp={h:0,s:0,l:0};function $1(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}u($1,"hue2rgb");function _p(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}u(_p,"toComponents");class Te{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=wo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Qs.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=Dl){return this.r=e,this.g=t,this.b=i,Qs.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=Dl){if(e=mb(e,1),t=_i(t,0,1),i=_i(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=$1(o,r,e+1/3),this.g=$1(o,r,e),this.b=$1(o,r,e-1/3)}return Qs.toWorkingColorSpace(this,s),this}setStyle(e,t=wo){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}u(i,"handleAlpha");let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,Qs.toWorkingColorSpace(this,t),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,Qs.toWorkingColorSpace(this,t),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(r[1])/360,c=parseFloat(r[2])/100,h=parseFloat(r[3])/100;return i(r[4]),this.setHSL(l,c,h,t)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,Qs.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,Qs.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=wo){const i=uP[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=zl(e.r),this.g=zl(e.g),this.b=zl(e.b),this}copyLinearToSRGB(e){return this.r=_g(e.r),this.g=_g(e.g),this.b=_g(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=wo){return Qs.fromWorkingColorSpace(_p(this,ei),e),_i(ei.r*255,0,255)<<16^_i(ei.g*255,0,255)<<8^_i(ei.b*255,0,255)<<0}getHexString(e=wo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Dl){Qs.fromWorkingColorSpace(_p(this,ei),t);const i=ei.r,s=ei.g,r=ei.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const f=o-a;switch(c=h<=.5?f/(o+a):f/(2-o-a),o){case i:l=(s-r)/f+(s<r?6:0);break;case s:l=(r-i)/f+2;break;case r:l=(i-s)/f+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=Dl){return Qs.fromWorkingColorSpace(_p(this,ei),t),e.r=ei.r,e.g=ei.g,e.b=ei.b,e}getStyle(e=wo){return Qs.fromWorkingColorSpace(_p(this,ei),e),e!==wo?`color(${e} ${ei.r} ${ei.g} ${ei.b})`:`rgb(${ei.r*255|0},${ei.g*255|0},${ei.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(Js),Js.h+=e,Js.s+=t,Js.l+=i,this.setHSL(Js.h,Js.s,Js.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Js),e.getHSL(yp);const i=td(Js.h,yp.h,t),s=td(Js.s,yp.s,t),r=td(Js.l,yp.l,t);return this.setHSL(i,s,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}u(Te,"Color");Te.NAMES=uP;let dc;class gb{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{dc===void 0&&(dc=_d("canvas")),dc.width=e.width,dc.height=e.height;const i=dc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=dc}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=_d("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=zl(r[o]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(zl(t[i]/255)*255):t[i]=zl(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}u(gb,"ImageUtils");class M0{constructor(e=null){this.isSource=!0,this.uuid=pr(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(V1(s[o].image)):r.push(V1(s[o]))}else r=V1(s);i.url=r}return t||(e.images[this.uuid]=i),i}}u(M0,"Source");function V1(n){return typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&n instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?gb.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}u(V1,"serializeImage");let yz=0;class ii extends ic{constructor(e=ii.DEFAULT_IMAGE,t=ii.DEFAULT_MAPPING,i=Gi,s=Gi,r=Vi,o=nc,a=Es,l=$l,c=1,h=Lo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:yz++}),this.uuid=pr(),this.name="",this.source=new M0(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ke(0,0),this.repeat=new ke(1,1),this.center=new ke(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==sP)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Do:e.x=e.x-Math.floor(e.x);break;case Gi:e.x=e.x<0?0:1;break;case vd:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Do:e.y=e.y-Math.floor(e.y);break;case Gi:e.y=e.y<0?0:1;break;case vd:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}u(ii,"Texture");ii.DEFAULT_IMAGE=null;ii.DEFAULT_MAPPING=sP;class Dt{constructor(e=0,t=0,i=0,s=1){Dt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const l=e.elements,c=l[0],h=l[4],f=l[8],d=l[1],p=l[5],g=l[9],m=l[2],v=l[6],y=l[10];if(Math.abs(h-d)<.01&&Math.abs(f-m)<.01&&Math.abs(g-v)<.01){if(Math.abs(h+d)<.1&&Math.abs(f+m)<.1&&Math.abs(g+v)<.1&&Math.abs(c+p+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,x=(p+1)/2,w=(y+1)/2,M=(h+d)/4,C=(f+m)/4,A=(g+v)/4;return _>x&&_>w?_<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(_),s=M/i,r=C/i):x>w?x<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(x),i=M/s,r=A/s):w<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(w),i=C/r,s=A/r),this.set(i,s,r,t),this}let b=Math.sqrt((v-g)*(v-g)+(f-m)*(f-m)+(d-h)*(d-h));return Math.abs(b)<.001&&(b=1),this.x=(v-g)/b,this.y=(f-m)/b,this.z=(d-h)/b,this.w=Math.acos((c+p+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}u(Dt,"Vector4");class yi extends ic{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Dt(0,0,e,t),this.scissorTest=!1,this.viewport=new Dt(0,0,e,t);const s={width:e,height:t,depth:1};this.texture=new ii(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Vi,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new M0(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}u(yi,"WebGLRenderTarget");class vb extends ii{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=zn,this.minFilter=zn,this.wrapR=Gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(vb,"DataArrayTexture");class hP extends ii{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=zn,this.minFilter=zn,this.wrapR=Gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(hP,"Data3DTexture");class je{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],f=i[s+3];const d=r[o+0],p=r[o+1],g=r[o+2],m=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=f;return}if(a===1){e[t+0]=d,e[t+1]=p,e[t+2]=g,e[t+3]=m;return}if(f!==m||l!==d||c!==p||h!==g){let v=1-a;const y=l*d+c*p+h*g+f*m,b=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const w=Math.sqrt(_),M=Math.atan2(w,y*b);v=Math.sin(v*M)/w,a=Math.sin(a*M)/w}const x=a*b;if(l=l*v+d*x,c=c*v+p*x,h=h*v+g*x,f=f*v+m*x,v===1-a){const w=1/Math.sqrt(l*l+c*c+h*h+f*f);l*=w,c*=w,h*=w,f*=w}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=f}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],f=r[o],d=r[o+1],p=r[o+2],g=r[o+3];return e[t]=a*g+h*f+l*p-c*d,e[t+1]=l*g+h*d+c*f-a*p,e[t+2]=c*g+h*p+a*d-l*f,e[t+3]=h*g-a*f-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),f=a(r/2),d=l(i/2),p=l(s/2),g=l(r/2);switch(o){case"XYZ":this._x=d*h*f+c*p*g,this._y=c*p*f-d*h*g,this._z=c*h*g+d*p*f,this._w=c*h*f-d*p*g;break;case"YXZ":this._x=d*h*f+c*p*g,this._y=c*p*f-d*h*g,this._z=c*h*g-d*p*f,this._w=c*h*f+d*p*g;break;case"ZXY":this._x=d*h*f-c*p*g,this._y=c*p*f+d*h*g,this._z=c*h*g+d*p*f,this._w=c*h*f-d*p*g;break;case"ZYX":this._x=d*h*f-c*p*g,this._y=c*p*f+d*h*g,this._z=c*h*g-d*p*f,this._w=c*h*f+d*p*g;break;case"YZX":this._x=d*h*f+c*p*g,this._y=c*p*f+d*h*g,this._z=c*h*g-d*p*f,this._w=c*h*f-d*p*g;break;case"XZY":this._x=d*h*f-c*p*g,this._y=c*p*f-d*h*g,this._z=c*h*g+d*p*f,this._w=c*h*f+d*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],f=t[10],d=i+a+f;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-s)*p}else if(i>a&&i>f){const p=2*Math.sqrt(1+i-a-f);this._w=(h-l)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+c)/p}else if(a>f){const p=2*Math.sqrt(1+a-i-f);this._w=(r-c)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+f-i-a);this._w=(o-s)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(_i(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),f=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=o*f+this._w*d,this._x=i*f+this._x*d,this._y=s*f+this._y*d,this._z=r*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),i*Math.sin(r),i*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}u(je,"Quaternion");class T{constructor(e=0,t=0,i=0){T.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(kM.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(kM.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*s-a*i,h=l*i+a*t-r*s,f=l*s+r*i-o*t,d=-r*t-o*i-a*s;return this.x=c*l+d*-r+h*-a-f*-o,this.y=h*l+d*-o+f*-r-c*-a,this.z=f*l+d*-a+c*-o-h*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-i*l,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return G1.copy(this).projectOnVector(e),this.sub(G1)}reflect(e){return this.sub(G1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(_i(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}u(T,"Vector3");const G1=new T,kM=new je;class Qn{constructor(e=new T(1/0,1/0,1/0),t=new T(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const h=e[l],f=e[l+1],d=e[l+2];h<t&&(t=h),f<i&&(i=f),d<s&&(s=d),h>r&&(r=h),f>o&&(o=f),d>a&&(a=d)}return this.min.set(t,i,s),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const h=e.getX(l),f=e.getY(l),d=e.getZ(l);h<t&&(t=h),f<i&&(i=f),d<s&&(s=d),h>r&&(r=h),f>o&&(o=f),d>a&&(a=d)}return this.min.set(t,i,s),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ja.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){const r=i.attributes.position;for(let o=0,a=r.count;o<a;o++)Ja.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Ja)}else i.boundingBox===null&&i.computeBoundingBox(),H1.copy(i.boundingBox),H1.applyMatrix4(e.matrixWorld),this.union(H1);const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ja),Ja.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ph),bp.subVectors(this.max,Ph),pc.subVectors(e.a,Ph),mc.subVectors(e.b,Ph),gc.subVectors(e.c,Ph),Xo.subVectors(mc,pc),Yo.subVectors(gc,mc),el.subVectors(pc,gc);let t=[0,-Xo.z,Xo.y,0,-Yo.z,Yo.y,0,-el.z,el.y,Xo.z,0,-Xo.x,Yo.z,0,-Yo.x,el.z,0,-el.x,-Xo.y,Xo.x,0,-Yo.y,Yo.x,0,-el.y,el.x,0];return!W1(t,pc,mc,gc,bp)||(t=[1,0,0,0,1,0,0,0,1],!W1(t,pc,mc,gc,bp))?!1:(wp.crossVectors(Xo,Yo),t=[wp.x,wp.y,wp.z],W1(t,pc,mc,gc,bp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ja.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Ja).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Xr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Xr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Xr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Xr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Xr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Xr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Xr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Xr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Xr),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}u(Qn,"Box3");const Xr=[new T,new T,new T,new T,new T,new T,new T,new T],Ja=new T,H1=new Qn,pc=new T,mc=new T,gc=new T,Xo=new T,Yo=new T,el=new T,Ph=new T,bp=new T,wp=new T,tl=new T;function W1(n,e,t,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){tl.fromArray(n,r);const a=s.x*Math.abs(tl.x)+s.y*Math.abs(tl.y)+s.z*Math.abs(tl.z),l=e.dot(tl),c=t.dot(tl),h=i.dot(tl);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}u(W1,"satForAxes");const _z=new Qn,Rh=new T,j1=new T;class Ua{constructor(e=new T,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):_z.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Rh.subVectors(e,this.center);const t=Rh.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(Rh,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(j1.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Rh.copy(e.center).add(j1)),this.expandByPoint(Rh.copy(e.center).sub(j1))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}u(Ua,"Sphere");const Yr=new T,X1=new T,xp=new T,qo=new T,Y1=new T,Ap=new T,q1=new T;class $a{constructor(e=new T,t=new T(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Yr)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Yr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Yr.copy(this.direction).multiplyScalar(t).add(this.origin),Yr.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){X1.copy(e).add(t).multiplyScalar(.5),xp.copy(t).sub(e).normalize(),qo.copy(this.origin).sub(X1);const r=e.distanceTo(t)*.5,o=-this.direction.dot(xp),a=qo.dot(this.direction),l=-qo.dot(xp),c=qo.lengthSq(),h=Math.abs(1-o*o);let f,d,p,g;if(h>0)if(f=o*l-a,d=o*a-l,g=r*h,f>=0)if(d>=-g)if(d<=g){const m=1/h;f*=m,d*=m,p=f*(f+o*d+2*a)+d*(o*f+d+2*l)+c}else d=r,f=Math.max(0,-(o*d+a)),p=-f*f+d*(d+2*l)+c;else d=-r,f=Math.max(0,-(o*d+a)),p=-f*f+d*(d+2*l)+c;else d<=-g?(f=Math.max(0,-(-o*r+a)),d=f>0?-r:Math.min(Math.max(-r,-l),r),p=-f*f+d*(d+2*l)+c):d<=g?(f=0,d=Math.min(Math.max(-r,-l),r),p=d*(d+2*l)+c):(f=Math.max(0,-(o*r+a)),d=f>0?r:Math.min(Math.max(-r,-l),r),p=-f*f+d*(d+2*l)+c);else d=o>0?-r:r,f=Math.max(0,-(o*d+a)),p=-f*f+d*(d+2*l)+c;return i&&i.copy(this.direction).multiplyScalar(f).add(this.origin),s&&s.copy(xp).multiplyScalar(d).add(X1),p}intersectSphere(e,t){Yr.subVectors(e.center,this.origin);const i=Yr.dot(this.direction),s=Yr.dot(Yr)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z,d=this.origin;return c>=0?(i=(e.min.x-d.x)*c,s=(e.max.x-d.x)*c):(i=(e.max.x-d.x)*c,s=(e.min.x-d.x)*c),h>=0?(r=(e.min.y-d.y)*h,o=(e.max.y-d.y)*h):(r=(e.max.y-d.y)*h,o=(e.min.y-d.y)*h),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),f>=0?(a=(e.min.z-d.z)*f,l=(e.max.z-d.z)*f):(a=(e.max.z-d.z)*f,l=(e.min.z-d.z)*f),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,Yr)!==null}intersectTriangle(e,t,i,s,r){Y1.subVectors(t,e),Ap.subVectors(i,e),q1.crossVectors(Y1,Ap);let o=this.direction.dot(q1),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;qo.subVectors(this.origin,e);const l=a*this.direction.dot(Ap.crossVectors(qo,Ap));if(l<0)return null;const c=a*this.direction.dot(Y1.cross(qo));if(c<0||l+c>o)return null;const h=-a*qo.dot(q1);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}u($a,"Ray");class ve{constructor(){ve.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,s,r,o,a,l,c,h,f,d,p,g,m,v){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=s,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=f,y[14]=d,y[3]=p,y[7]=g,y[11]=m,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ve().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/vc.setFromMatrixColumn(e,0).length(),r=1/vc.setFromMatrixColumn(e,1).length(),o=1/vc.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(s),c=Math.sin(s),h=Math.cos(r),f=Math.sin(r);if(e.order==="XYZ"){const d=o*h,p=o*f,g=a*h,m=a*f;t[0]=l*h,t[4]=-l*f,t[8]=c,t[1]=p+g*c,t[5]=d-m*c,t[9]=-a*l,t[2]=m-d*c,t[6]=g+p*c,t[10]=o*l}else if(e.order==="YXZ"){const d=l*h,p=l*f,g=c*h,m=c*f;t[0]=d+m*a,t[4]=g*a-p,t[8]=o*c,t[1]=o*f,t[5]=o*h,t[9]=-a,t[2]=p*a-g,t[6]=m+d*a,t[10]=o*l}else if(e.order==="ZXY"){const d=l*h,p=l*f,g=c*h,m=c*f;t[0]=d-m*a,t[4]=-o*f,t[8]=g+p*a,t[1]=p+g*a,t[5]=o*h,t[9]=m-d*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const d=o*h,p=o*f,g=a*h,m=a*f;t[0]=l*h,t[4]=g*c-p,t[8]=d*c+m,t[1]=l*f,t[5]=m*c+d,t[9]=p*c-g,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const d=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*h,t[4]=m-d*f,t[8]=g*f+p,t[1]=f,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*f+g,t[10]=d-m*f}else if(e.order==="XZY"){const d=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*h,t[4]=-f,t[8]=c*h,t[1]=d*f+m,t[5]=o*h,t[9]=p*f-g,t[2]=g*f-p,t[6]=a*h,t[10]=m*f+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(bz,e,wz)}lookAt(e,t,i){const s=this.elements;return fs.subVectors(e,t),fs.lengthSq()===0&&(fs.z=1),fs.normalize(),Zo.crossVectors(i,fs),Zo.lengthSq()===0&&(Math.abs(i.z)===1?fs.x+=1e-4:fs.z+=1e-4,fs.normalize(),Zo.crossVectors(i,fs)),Zo.normalize(),Mp.crossVectors(fs,Zo),s[0]=Zo.x,s[4]=Mp.x,s[8]=fs.x,s[1]=Zo.y,s[5]=Mp.y,s[9]=fs.y,s[2]=Zo.z,s[6]=Mp.z,s[10]=fs.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],f=i[5],d=i[9],p=i[13],g=i[2],m=i[6],v=i[10],y=i[14],b=i[3],_=i[7],x=i[11],w=i[15],M=s[0],C=s[4],A=s[8],P=s[12],D=s[1],k=s[5],O=s[9],N=s[13],E=s[2],B=s[6],W=s[10],Z=s[14],ne=s[3],j=s[7],ie=s[11],K=s[15];return r[0]=o*M+a*D+l*E+c*ne,r[4]=o*C+a*k+l*B+c*j,r[8]=o*A+a*O+l*W+c*ie,r[12]=o*P+a*N+l*Z+c*K,r[1]=h*M+f*D+d*E+p*ne,r[5]=h*C+f*k+d*B+p*j,r[9]=h*A+f*O+d*W+p*ie,r[13]=h*P+f*N+d*Z+p*K,r[2]=g*M+m*D+v*E+y*ne,r[6]=g*C+m*k+v*B+y*j,r[10]=g*A+m*O+v*W+y*ie,r[14]=g*P+m*N+v*Z+y*K,r[3]=b*M+_*D+x*E+w*ne,r[7]=b*C+_*k+x*B+w*j,r[11]=b*A+_*O+x*W+w*ie,r[15]=b*P+_*N+x*Z+w*K,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],f=e[6],d=e[10],p=e[14],g=e[3],m=e[7],v=e[11],y=e[15];return g*(+r*l*f-s*c*f-r*a*d+i*c*d+s*a*p-i*l*p)+m*(+t*l*p-t*c*d+r*o*d-s*o*p+s*c*h-r*l*h)+v*(+t*c*f-t*a*p-r*o*f+i*o*p+r*a*h-i*c*h)+y*(-s*a*h-t*l*f+t*a*d+s*o*f-i*o*d+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=f*v*c-m*d*c+m*l*p-a*v*p-f*l*y+a*d*y,_=g*d*c-h*v*c-g*l*p+o*v*p+h*l*y-o*d*y,x=h*m*c-g*f*c+g*a*p-o*m*p-h*a*y+o*f*y,w=g*f*l-h*m*l-g*a*d+o*m*d+h*a*v-o*f*v,M=t*b+i*_+s*x+r*w;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/M;return e[0]=b*C,e[1]=(m*d*r-f*v*r-m*s*p+i*v*p+f*s*y-i*d*y)*C,e[2]=(a*v*r-m*l*r+m*s*c-i*v*c-a*s*y+i*l*y)*C,e[3]=(f*l*r-a*d*r-f*s*c+i*d*c+a*s*p-i*l*p)*C,e[4]=_*C,e[5]=(h*v*r-g*d*r+g*s*p-t*v*p-h*s*y+t*d*y)*C,e[6]=(g*l*r-o*v*r-g*s*c+t*v*c+o*s*y-t*l*y)*C,e[7]=(o*d*r-h*l*r+h*s*c-t*d*c-o*s*p+t*l*p)*C,e[8]=x*C,e[9]=(g*f*r-h*m*r-g*i*p+t*m*p+h*i*y-t*f*y)*C,e[10]=(o*m*r-g*a*r+g*i*c-t*m*c-o*i*y+t*a*y)*C,e[11]=(h*a*r-o*f*r-h*i*c+t*f*c+o*i*p-t*a*p)*C,e[12]=w*C,e[13]=(h*m*s-g*f*s+g*i*d-t*m*d-h*i*v+t*f*v)*C,e[14]=(g*a*s-o*m*s-g*i*l+t*m*l+o*i*v-t*a*v)*C,e[15]=(o*f*s-h*a*s+h*i*l-t*f*l-o*i*d+t*a*d)*C,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-s*l,c*l+s*a,0,c*a+s*l,h*a+i,h*l-s*o,0,c*l-s*a,h*l+s*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,f=a+a,d=r*c,p=r*h,g=r*f,m=o*h,v=o*f,y=a*f,b=l*c,_=l*h,x=l*f,w=i.x,M=i.y,C=i.z;return s[0]=(1-(m+y))*w,s[1]=(p+x)*w,s[2]=(g-_)*w,s[3]=0,s[4]=(p-x)*M,s[5]=(1-(d+y))*M,s[6]=(v+b)*M,s[7]=0,s[8]=(g+_)*C,s[9]=(v-b)*C,s[10]=(1-(d+m))*C,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=vc.set(s[0],s[1],s[2]).length();const o=vc.set(s[4],s[5],s[6]).length(),a=vc.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],er.copy(this);const c=1/r,h=1/o,f=1/a;return er.elements[0]*=c,er.elements[1]*=c,er.elements[2]*=c,er.elements[4]*=h,er.elements[5]*=h,er.elements[6]*=h,er.elements[8]*=f,er.elements[9]*=f,er.elements[10]*=f,t.setFromRotationMatrix(er),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o){const a=this.elements,l=2*r/(t-e),c=2*r/(i-s),h=(t+e)/(t-e),f=(i+s)/(i-s),d=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=c,a[9]=f,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,s,r,o){const a=this.elements,l=1/(t-e),c=1/(i-s),h=1/(o-r),f=(t+e)*l,d=(i+s)*c,p=(o+r)*h;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-f,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}u(ve,"Matrix4");const vc=new T,er=new ve,bz=new T(0,0,0),wz=new T(1,1,1),Zo=new T,Mp=new T,fs=new T,NM=new ve,FM=new je;class lt{constructor(e=0,t=0,i=0,s=lt.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],h=s[9],f=s[2],d=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(_i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-_i(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(_i(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-_i(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(_i(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-_i(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return NM.makeRotationFromQuaternion(e),this.setFromRotationMatrix(NM,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return FM.setFromEuler(this),this.setFromQuaternion(FM,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}u(lt,"Euler");lt.DefaultOrder="XYZ";lt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class S0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}u(S0,"Layers");let xz=0;const zM=new T,yc=new je,qr=new ve,Sp=new T,Ih=new T,Az=new T,Mz=new je,BM=new T(1,0,0),UM=new T(0,1,0),$M=new T(0,0,1),Sz={type:"added"},VM={type:"removed"};class Pt extends ic{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:xz++}),this.uuid=pr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pt.DefaultUp.clone();const e=new T,t=new lt,i=new je,s=new T(1,1,1);function r(){i.setFromEuler(t,!1)}u(r,"onRotationChange");function o(){t.setFromQuaternion(i,void 0,!1)}u(o,"onQuaternionChange"),t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ve},normalMatrix:{value:new Wi}}),this.matrix=new ve,this.matrixWorld=new ve,this.matrixAutoUpdate=Pt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Pt.DefaultMatrixWorldAutoUpdate,this.layers=new S0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return yc.setFromAxisAngle(e,t),this.quaternion.multiply(yc),this}rotateOnWorldAxis(e,t){return yc.setFromAxisAngle(e,t),this.quaternion.premultiply(yc),this}rotateX(e){return this.rotateOnAxis(BM,e)}rotateY(e){return this.rotateOnAxis(UM,e)}rotateZ(e){return this.rotateOnAxis($M,e)}translateOnAxis(e,t){return zM.copy(e).applyQuaternion(this.quaternion),this.position.add(zM.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(BM,e)}translateY(e){return this.translateOnAxis(UM,e)}translateZ(e){return this.translateOnAxis($M,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(qr.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Sp.copy(e):Sp.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Ih.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qr.lookAt(Ih,Sp,this.up):qr.lookAt(Sp,Ih,this.up),this.quaternion.setFromRotationMatrix(qr),s&&(qr.extractRotation(s.matrixWorld),yc.setFromRotationMatrix(qr),this.quaternion.premultiply(yc.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Sz)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(VM)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(VM)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),qr.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),qr.multiply(e.parent.matrixWorld)),e.applyMatrix4(qr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ih,e,Az),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ih,Mz,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++){const r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++){const a=s[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(u(r,"serialize"),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const f=l[c];r(e.shapes,f)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),f=o(e.shapes),d=o(e.skeletons),p=o(e.animations),g=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),f.length>0&&(i.shapes=f),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),g.length>0&&(i.nodes=g)}return i.object=s,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}u(o,"extractFromCache")}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}u(Pt,"Object3D");Pt.DefaultUp=new T(0,1,0);Pt.DefaultMatrixAutoUpdate=!0;Pt.DefaultMatrixWorldAutoUpdate=!0;const tr=new T,Zr=new T,Z1=new T,Kr=new T,_c=new T,bc=new T,GM=new T,K1=new T,Q1=new T,J1=new T;class Or{constructor(e=new T,t=new T,i=new T){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),tr.subVectors(e,t),s.cross(tr);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){tr.subVectors(s,t),Zr.subVectors(i,t),Z1.subVectors(e,t);const o=tr.dot(tr),a=tr.dot(Zr),l=tr.dot(Z1),c=Zr.dot(Zr),h=Zr.dot(Z1),f=o*c-a*a;if(f===0)return r.set(-2,-1,-1);const d=1/f,p=(c*l-a*h)*d,g=(o*h-a*l)*d;return r.set(1-p-g,g,p)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Kr),Kr.x>=0&&Kr.y>=0&&Kr.x+Kr.y<=1}static getUV(e,t,i,s,r,o,a,l){return this.getBarycoord(e,t,i,s,Kr),l.set(0,0),l.addScaledVector(r,Kr.x),l.addScaledVector(o,Kr.y),l.addScaledVector(a,Kr.z),l}static isFrontFacing(e,t,i,s){return tr.subVectors(i,t),Zr.subVectors(e,t),tr.cross(Zr).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return tr.subVectors(this.c,this.b),Zr.subVectors(this.a,this.b),tr.cross(Zr).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Or.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Or.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,s,r){return Or.getUV(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return Or.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Or.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,a;_c.subVectors(s,i),bc.subVectors(r,i),K1.subVectors(e,i);const l=_c.dot(K1),c=bc.dot(K1);if(l<=0&&c<=0)return t.copy(i);Q1.subVectors(e,s);const h=_c.dot(Q1),f=bc.dot(Q1);if(h>=0&&f<=h)return t.copy(s);const d=l*f-h*c;if(d<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(_c,o);J1.subVectors(e,r);const p=_c.dot(J1),g=bc.dot(J1);if(g>=0&&p<=g)return t.copy(r);const m=p*c-l*g;if(m<=0&&c>=0&&g<=0)return a=c/(c-g),t.copy(i).addScaledVector(bc,a);const v=h*g-p*f;if(v<=0&&f-h>=0&&p-g>=0)return GM.subVectors(r,s),a=(f-h)/(f-h+(p-g)),t.copy(s).addScaledVector(GM,a);const y=1/(v+m+d);return o=m*y,a=d*y,t.copy(i).addScaledVector(_c,o).addScaledVector(bc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}u(Or,"Triangle");let Cz=0;class Zi extends ic{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Cz++}),this.uuid=pr(),this.name="",this.type="Material",this.blending=yu,this.side=Ul,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=nP,this.blendDst=iP,this.blendEquation=Jc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=l_,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=sz,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=B1,this.stencilZFail=B1,this.stencilZPass=B1,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const s=this[t];if(s===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==yu&&(i.blending=this.blending),this.side!==Ul&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(u(s,"extractFromCache"),t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}u(Zi,"Material");class ji extends Zi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=x0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}u(ji,"MeshBasicMaterial");const jn=new T,Cp=new ke;class mn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=u_,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Cp.fromBufferAttribute(this,t),Cp.applyMatrix3(e),this.setXY(t,Cp.x,Cp.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.applyMatrix3(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.applyMatrix4(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.applyNormalMatrix(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)jn.fromBufferAttribute(this,t),jn.transformDirection(e),this.setXYZ(t,jn.x,jn.y,jn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=So(t,this.array)),t}setX(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=So(t,this.array)),t}setY(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=So(t,this.array)),t}setZ(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=So(t,this.array)),t}setW(e,t){return this.normalized&&(t=en(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),i=en(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),i=en(i,this.array),s=en(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=en(t,this.array),i=en(i,this.array),s=en(s,this.array),r=en(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==u_&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}u(mn,"BufferAttribute");class C0 extends mn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}u(C0,"Uint16BufferAttribute");class yb extends mn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}u(yb,"Uint32BufferAttribute");class Ve extends mn{constructor(e,t,i){super(new Float32Array(e),t,i)}}u(Ve,"Float32BufferAttribute");let Ez=0;const Ns=new ve,ev=new Pt,wc=new T,ds=new Qn,Dh=new Qn,li=new T;class it extends ic{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ez++}),this.uuid=pr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(cP(e)?yb:C0)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Wi().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ns.makeRotationFromQuaternion(e),this.applyMatrix4(Ns),this}rotateX(e){return Ns.makeRotationX(e),this.applyMatrix4(Ns),this}rotateY(e){return Ns.makeRotationY(e),this.applyMatrix4(Ns),this}rotateZ(e){return Ns.makeRotationZ(e),this.applyMatrix4(Ns),this}translate(e,t,i){return Ns.makeTranslation(e,t,i),this.applyMatrix4(Ns),this}scale(e,t,i){return Ns.makeScale(e,t,i),this.applyMatrix4(Ns),this}lookAt(e){return ev.lookAt(e),ev.updateMatrix(),this.applyMatrix4(ev.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(wc).negate(),this.translate(wc.x,wc.y,wc.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Ve(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new T(-1/0,-1/0,-1/0),new T(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];ds.setFromBufferAttribute(r),this.morphTargetsRelative?(li.addVectors(this.boundingBox.min,ds.min),this.boundingBox.expandByPoint(li),li.addVectors(this.boundingBox.max,ds.max),this.boundingBox.expandByPoint(li)):(this.boundingBox.expandByPoint(ds.min),this.boundingBox.expandByPoint(ds.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ua);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new T,1/0);return}if(e){const i=this.boundingSphere.center;if(ds.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Dh.setFromBufferAttribute(a),this.morphTargetsRelative?(li.addVectors(ds.min,Dh.min),ds.expandByPoint(li),li.addVectors(ds.max,Dh.max),ds.expandByPoint(li)):(ds.expandByPoint(Dh.min),ds.expandByPoint(Dh.max))}ds.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)li.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(li));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)li.fromBufferAttribute(a,c),l&&(wc.fromBufferAttribute(e,c),li.add(wc)),s=Math.max(s,i.distanceToSquared(li))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,s=t.position.array,r=t.normal.array,o=t.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],h=[];for(let D=0;D<a;D++)c[D]=new T,h[D]=new T;const f=new T,d=new T,p=new T,g=new ke,m=new ke,v=new ke,y=new T,b=new T;function _(D,k,O){f.fromArray(s,D*3),d.fromArray(s,k*3),p.fromArray(s,O*3),g.fromArray(o,D*2),m.fromArray(o,k*2),v.fromArray(o,O*2),d.sub(f),p.sub(f),m.sub(g),v.sub(g);const N=1/(m.x*v.y-v.x*m.y);!isFinite(N)||(y.copy(d).multiplyScalar(v.y).addScaledVector(p,-m.y).multiplyScalar(N),b.copy(p).multiplyScalar(m.x).addScaledVector(d,-v.x).multiplyScalar(N),c[D].add(y),c[k].add(y),c[O].add(y),h[D].add(b),h[k].add(b),h[O].add(b))}u(_,"handleTriangle");let x=this.groups;x.length===0&&(x=[{start:0,count:i.length}]);for(let D=0,k=x.length;D<k;++D){const O=x[D],N=O.start,E=O.count;for(let B=N,W=N+E;B<W;B+=3)_(i[B+0],i[B+1],i[B+2])}const w=new T,M=new T,C=new T,A=new T;function P(D){C.fromArray(r,D*3),A.copy(C);const k=c[D];w.copy(k),w.sub(C.multiplyScalar(C.dot(k))).normalize(),M.crossVectors(A,k);const N=M.dot(h[D])<0?-1:1;l[D*4]=w.x,l[D*4+1]=w.y,l[D*4+2]=w.z,l[D*4+3]=N}u(P,"handleVertex");for(let D=0,k=x.length;D<k;++D){const O=x[D],N=O.start,E=O.count;for(let B=N,W=N+E;B<W;B+=3)P(i[B+0]),P(i[B+1]),P(i[B+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new mn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const s=new T,r=new T,o=new T,a=new T,l=new T,c=new T,h=new T,f=new T;if(e)for(let d=0,p=e.count;d<p;d+=3){const g=e.getX(d+0),m=e.getX(d+1),v=e.getX(d+2);s.fromBufferAttribute(t,g),r.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),h.subVectors(o,r),f.subVectors(s,r),h.cross(f),a.fromBufferAttribute(i,g),l.fromBufferAttribute(i,m),c.fromBufferAttribute(i,v),a.add(h),l.add(h),c.add(h),i.setXYZ(g,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z),i.setXYZ(v,c.x,c.y,c.z)}else for(let d=0,p=t.count;d<p;d+=3)s.fromBufferAttribute(t,d+0),r.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),h.subVectors(o,r),f.subVectors(s,r),h.cross(f),i.setXYZ(d+0,h.x,h.y,h.z),i.setXYZ(d+1,h.x,h.y,h.z),i.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)li.fromBufferAttribute(e,t),li.normalize(),e.setXYZ(t,li.x,li.y,li.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,f=a.normalized,d=new c.constructor(l.length*h);let p=0,g=0;for(let m=0,v=l.length;m<v;m++){a.isInterleavedBufferAttribute?p=l[m]*a.data.stride+a.offset:p=l[m]*h;for(let y=0;y<h;y++)d[g++]=c[p++]}return new mn(d,h,f)}if(u(e,"convertBufferAttribute"),this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new it,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,f=c.length;h<f;h++){const d=c[h],p=e(d,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let f=0,d=c.length;f<d;f++){const p=c[f];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],f=r[c];for(let d=0,p=f.length;d<p;d++)h.push(f[d].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const f=o[c];this.addGroup(f.start,f.count,f.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}u(it,"BufferGeometry");const HM=new ve,xc=new $a,tv=new Ua,Ko=new T,Qo=new T,Jo=new T,nv=new T,iv=new T,sv=new T,Ep=new T,Tp=new T,Pp=new T,Rp=new ke,Ip=new ke,Dp=new ke,rv=new T,Lp=new T;class We extends Pt{constructor(e=new it,t=new ji){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;if(s===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),tv.copy(i.boundingSphere),tv.applyMatrix4(r),e.ray.intersectsSphere(tv)===!1)||(HM.copy(r).invert(),xc.copy(e.ray).applyMatrix4(HM),i.boundingBox!==null&&xc.intersectsBox(i.boundingBox)===!1))return;let o;const a=i.index,l=i.attributes.position,c=i.morphAttributes.position,h=i.morphTargetsRelative,f=i.attributes.uv,d=i.attributes.uv2,p=i.groups,g=i.drawRange;if(a!==null)if(Array.isArray(s))for(let m=0,v=p.length;m<v;m++){const y=p[m],b=s[y.materialIndex],_=Math.max(y.start,g.start),x=Math.min(a.count,Math.min(y.start+y.count,g.start+g.count));for(let w=_,M=x;w<M;w+=3){const C=a.getX(w),A=a.getX(w+1),P=a.getX(w+2);o=Op(this,b,e,xc,l,c,h,f,d,C,A,P),o&&(o.faceIndex=Math.floor(w/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(a.count,g.start+g.count);for(let y=m,b=v;y<b;y+=3){const _=a.getX(y),x=a.getX(y+1),w=a.getX(y+2);o=Op(this,s,e,xc,l,c,h,f,d,_,x,w),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(s))for(let m=0,v=p.length;m<v;m++){const y=p[m],b=s[y.materialIndex],_=Math.max(y.start,g.start),x=Math.min(l.count,Math.min(y.start+y.count,g.start+g.count));for(let w=_,M=x;w<M;w+=3){const C=w,A=w+1,P=w+2;o=Op(this,b,e,xc,l,c,h,f,d,C,A,P),o&&(o.faceIndex=Math.floor(w/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(l.count,g.start+g.count);for(let y=m,b=v;y<b;y+=3){const _=y,x=y+1,w=y+2;o=Op(this,s,e,xc,l,c,h,f,d,_,x,w),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}}}u(We,"Mesh");function Tz(n,e,t,i,s,r,o,a){let l;if(e.side===Ws?l=i.intersectTriangle(o,r,s,!0,a):l=i.intersectTriangle(s,r,o,e.side!==Ts,a),l===null)return null;Lp.copy(a),Lp.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Lp);return c<t.near||c>t.far?null:{distance:c,point:Lp.clone(),object:n}}u(Tz,"checkIntersection");function Op(n,e,t,i,s,r,o,a,l,c,h,f){Ko.fromBufferAttribute(s,c),Qo.fromBufferAttribute(s,h),Jo.fromBufferAttribute(s,f);const d=n.morphTargetInfluences;if(r&&d){Ep.set(0,0,0),Tp.set(0,0,0),Pp.set(0,0,0);for(let g=0,m=r.length;g<m;g++){const v=d[g],y=r[g];v!==0&&(nv.fromBufferAttribute(y,c),iv.fromBufferAttribute(y,h),sv.fromBufferAttribute(y,f),o?(Ep.addScaledVector(nv,v),Tp.addScaledVector(iv,v),Pp.addScaledVector(sv,v)):(Ep.addScaledVector(nv.sub(Ko),v),Tp.addScaledVector(iv.sub(Qo),v),Pp.addScaledVector(sv.sub(Jo),v)))}Ko.add(Ep),Qo.add(Tp),Jo.add(Pp)}n.isSkinnedMesh&&(n.boneTransform(c,Ko),n.boneTransform(h,Qo),n.boneTransform(f,Jo));const p=Tz(n,e,t,i,Ko,Qo,Jo,rv);if(p){a&&(Rp.fromBufferAttribute(a,c),Ip.fromBufferAttribute(a,h),Dp.fromBufferAttribute(a,f),p.uv=Or.getUV(rv,Ko,Qo,Jo,Rp,Ip,Dp,new ke)),l&&(Rp.fromBufferAttribute(l,c),Ip.fromBufferAttribute(l,h),Dp.fromBufferAttribute(l,f),p.uv2=Or.getUV(rv,Ko,Qo,Jo,Rp,Ip,Dp,new ke));const g={a:c,b:h,c:f,normal:new T,materialIndex:0};Or.getNormal(Ko,Qo,Jo,g.normal),p.face=g}return p}u(Op,"checkBufferGeometryIntersection");class ur extends it{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],f=[];let d=0,p=0;g("z","y","x",-1,-1,i,t,e,o,r,0),g("z","y","x",1,-1,i,t,-e,o,r,1),g("x","z","y",1,1,e,i,t,s,o,2),g("x","z","y",1,-1,e,i,-t,s,o,3),g("x","y","z",1,-1,e,t,i,s,r,4),g("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new Ve(c,3)),this.setAttribute("normal",new Ve(h,3)),this.setAttribute("uv",new Ve(f,2));function g(m,v,y,b,_,x,w,M,C,A,P){const D=x/C,k=w/A,O=x/2,N=w/2,E=M/2,B=C+1,W=A+1;let Z=0,ne=0;const j=new T;for(let ie=0;ie<W;ie++){const K=ie*k-N;for(let $=0;$<B;$++){const le=$*D-O;j[m]=le*b,j[v]=K*_,j[y]=E,c.push(j.x,j.y,j.z),j[m]=0,j[v]=0,j[y]=M>0?1:-1,h.push(j.x,j.y,j.z),f.push($/C),f.push(1-ie/A),Z+=1}}for(let ie=0;ie<A;ie++)for(let K=0;K<C;K++){const $=d+K+B*ie,le=d+K+B*(ie+1),ae=d+(K+1)+B*(ie+1),J=d+(K+1)+B*ie;l.push($,le,J),l.push(le,ae,J),ne+=6}a.addGroup(p,ne,P),p+=ne,d+=Z}u(g,"buildPlane")}static fromJSON(e){return new ur(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}u(ur,"BoxGeometry");function Du(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}u(Du,"cloneUniforms");function Bi(n){const e={};for(let t=0;t<n.length;t++){const i=Du(n[t]);for(const s in i)e[s]=i[s]}return e}u(Bi,"mergeUniforms");function Pz(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}u(Pz,"cloneUniformsGroups");const E0={clone:Du,merge:Bi};var Rz=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Iz=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ti extends Zi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Rz,this.fragmentShader=Iz,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Du(e.uniforms),this.uniformsGroups=Pz(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}u(Ti,"ShaderMaterial");class T0 extends Pt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ve,this.projectionMatrix=new ve,this.projectionMatrixInverse=new ve}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}u(T0,"Camera");class di extends T0{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=yd*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(ed*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return yd*2*Math.atan(Math.tan(ed*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(ed*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,t-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}u(di,"PerspectiveCamera");const Ac=90,Mc=1;class fP extends Pt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const s=new di(Ac,Mc,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new T(1,0,0)),this.add(s);const r=new di(Ac,Mc,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new T(-1,0,0)),this.add(r);const o=new di(Ac,Mc,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new T(0,1,0)),this.add(o);const a=new di(Ac,Mc,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new T(0,-1,0)),this.add(a);const l=new di(Ac,Mc,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new T(0,0,1)),this.add(l);const c=new di(Ac,Mc,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new T(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[s,r,o,a,l,c]=this.children,h=e.getRenderTarget(),f=e.toneMapping,d=e.xr.enabled;e.toneMapping=Ur,e.xr.enabled=!1;const p=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,s),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=p,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(h),e.toneMapping=f,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}u(fP,"CubeCamera");class _b extends ii{constructor(e,t,i,s,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:Eu,super(e,t,i,s,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}u(_b,"CubeTexture");class dP extends yi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new _b(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Vi}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new ur(5,5,5),r=new Ti({name:"CubemapFromEquirect",uniforms:Du(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Ws,blending:Br});r.uniforms.tEquirect.value=t;const o=new We(s,r),a=t.minFilter;return t.minFilter===nc&&(t.minFilter=Vi),new fP(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}u(dP,"WebGLCubeRenderTarget");const ov=new T,Dz=new T,Lz=new Wi;class xo{constructor(e=new T(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=ov.subVectors(i,t).cross(Dz.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(ov),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Lz.getNormalMatrix(e),s=this.coplanarPoint(ov).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}u(xo,"Plane$1");const Sc=new Ua,kp=new T;class Hd{constructor(e=new xo,t=new xo,i=new xo,s=new xo,r=new xo,o=new xo){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,s=i[0],r=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],f=i[7],d=i[8],p=i[9],g=i[10],m=i[11],v=i[12],y=i[13],b=i[14],_=i[15];return t[0].setComponents(a-s,f-l,m-d,_-v).normalize(),t[1].setComponents(a+s,f+l,m+d,_+v).normalize(),t[2].setComponents(a+r,f+c,m+p,_+y).normalize(),t[3].setComponents(a-r,f-c,m-p,_-y).normalize(),t[4].setComponents(a-o,f-h,m-g,_-b).normalize(),t[5].setComponents(a+o,f+h,m+g,_+b).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Sc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Sc)}intersectsSprite(e){return Sc.center.set(0,0,0),Sc.radius=.7071067811865476,Sc.applyMatrix4(e.matrixWorld),this.intersectsSphere(Sc)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(kp.x=s.normal.x>0?e.max.x:e.min.x,kp.y=s.normal.y>0?e.max.y:e.min.y,kp.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(kp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}u(Hd,"Frustum");function pP(){let n=null,e=!1,t=null,i=null;function s(r,o){t(r,o),i=n.requestAnimationFrame(s)}return u(s,"onAnimationFrame"),{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}u(pP,"WebGLAnimation");function Oz(n,e){const t=e.isWebGL2,i=new WeakMap;function s(c,h){const f=c.array,d=c.usage,p=n.createBuffer();n.bindBuffer(h,p),n.bufferData(h,f,d),c.onUploadCallback();let g;if(f instanceof Float32Array)g=5126;else if(f instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(f instanceof Int16Array)g=5122;else if(f instanceof Uint32Array)g=5125;else if(f instanceof Int32Array)g=5124;else if(f instanceof Int8Array)g=5120;else if(f instanceof Uint8Array)g=5121;else if(f instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:p,type:g,bytesPerElement:f.BYTES_PER_ELEMENT,version:c.version}}u(s,"createBuffer");function r(c,h,f){const d=h.array,p=h.updateRange;n.bindBuffer(f,c),p.count===-1?n.bufferSubData(f,0,d):(t?n.bufferSubData(f,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):n.bufferSubData(f,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1)}u(r,"updateBuffer");function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}u(o,"get");function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=i.get(c);h&&(n.deleteBuffer(h.buffer),i.delete(c))}u(a,"remove");function l(c,h){if(c.isGLBufferAttribute){const d=i.get(c);(!d||d.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const f=i.get(c);f===void 0?i.set(c,s(c,h)):f.version<c.version&&(r(f.buffer,c,h),f.version=c.version)}return u(l,"update"),{get:o,remove:a,update:l}}u(Oz,"WebGLAttributes");class Lu extends it{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(s),c=a+1,h=l+1,f=e/a,d=t/l,p=[],g=[],m=[],v=[];for(let y=0;y<h;y++){const b=y*d-o;for(let _=0;_<c;_++){const x=_*f-r;g.push(x,-b,0),m.push(0,0,1),v.push(_/a),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let b=0;b<a;b++){const _=b+c*y,x=b+c*(y+1),w=b+1+c*(y+1),M=b+1+c*y;p.push(_,x,M),p.push(x,w,M)}this.setIndex(p),this.setAttribute("position",new Ve(g,3)),this.setAttribute("normal",new Ve(m,3)),this.setAttribute("uv",new Ve(v,2))}static fromJSON(e){return new Lu(e.width,e.height,e.widthSegments,e.heightSegments)}}u(Lu,"PlaneGeometry");var kz=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,Nz=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Fz=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,zz=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Bz=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Uz=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,$z="vec3 transformed = vec3( position );",Vz=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Gz=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,Hz=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Wz=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,jz=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Xz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Yz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,qz=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Zz=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Kz=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Qz=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Jz=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,eB=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,tB=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,nB=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,iB=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,sB=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,rB=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,oB=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,aB="gl_FragColor = linearToOutputTexel( gl_FragColor );",lB=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,cB=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,uB=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,hB=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,fB=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,dB=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,pB=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,mB=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,gB=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,vB=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,yB=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,_B=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,bB=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,wB=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,xB=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,AB=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,MB=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,SB=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,CB=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,EB=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,TB=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,PB=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,RB=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,IB=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,DB=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,LB=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,OB=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,kB=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,NB=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,FB=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,zB=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,BB=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,UB=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,$B=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,VB=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,GB=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,HB=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,WB=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,jB=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,XB=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,YB=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,qB=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,ZB=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,KB=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,QB=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,JB=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,eU=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,tU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,nU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,sU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,rU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,oU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,aU=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,lU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,cU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,uU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,hU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,fU=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,dU=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,pU=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,mU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,gU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,vU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,yU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,_U=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,bU=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,wU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,xU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,AU=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,MU=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,SU=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,CU=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,EU=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,TU=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,PU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,RU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,IU=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,DU=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const LU=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,OU=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,kU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,NU=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,FU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,zU=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,BU=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,UU=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,$U=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,VU=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,GU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,HU=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,WU=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,jU=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,XU=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,YU=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,qU=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ZU=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,KU=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,QU=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JU=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,e6=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,t6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,n6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,i6=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,s6=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,r6=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,o6=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,a6=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,l6=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,c6=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,u6=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,h6=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,f6=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,yt={alphamap_fragment:kz,alphamap_pars_fragment:Nz,alphatest_fragment:Fz,alphatest_pars_fragment:zz,aomap_fragment:Bz,aomap_pars_fragment:Uz,begin_vertex:$z,beginnormal_vertex:Vz,bsdfs:Gz,iridescence_fragment:Hz,bumpmap_pars_fragment:Wz,clipping_planes_fragment:jz,clipping_planes_pars_fragment:Xz,clipping_planes_pars_vertex:Yz,clipping_planes_vertex:qz,color_fragment:Zz,color_pars_fragment:Kz,color_pars_vertex:Qz,color_vertex:Jz,common:eB,cube_uv_reflection_fragment:tB,defaultnormal_vertex:nB,displacementmap_pars_vertex:iB,displacementmap_vertex:sB,emissivemap_fragment:rB,emissivemap_pars_fragment:oB,encodings_fragment:aB,encodings_pars_fragment:lB,envmap_fragment:cB,envmap_common_pars_fragment:uB,envmap_pars_fragment:hB,envmap_pars_vertex:fB,envmap_physical_pars_fragment:MB,envmap_vertex:dB,fog_vertex:pB,fog_pars_vertex:mB,fog_fragment:gB,fog_pars_fragment:vB,gradientmap_pars_fragment:yB,lightmap_fragment:_B,lightmap_pars_fragment:bB,lights_lambert_fragment:wB,lights_lambert_pars_fragment:xB,lights_pars_begin:AB,lights_toon_fragment:SB,lights_toon_pars_fragment:CB,lights_phong_fragment:EB,lights_phong_pars_fragment:TB,lights_physical_fragment:PB,lights_physical_pars_fragment:RB,lights_fragment_begin:IB,lights_fragment_maps:DB,lights_fragment_end:LB,logdepthbuf_fragment:OB,logdepthbuf_pars_fragment:kB,logdepthbuf_pars_vertex:NB,logdepthbuf_vertex:FB,map_fragment:zB,map_pars_fragment:BB,map_particle_fragment:UB,map_particle_pars_fragment:$B,metalnessmap_fragment:VB,metalnessmap_pars_fragment:GB,morphcolor_vertex:HB,morphnormal_vertex:WB,morphtarget_pars_vertex:jB,morphtarget_vertex:XB,normal_fragment_begin:YB,normal_fragment_maps:qB,normal_pars_fragment:ZB,normal_pars_vertex:KB,normal_vertex:QB,normalmap_pars_fragment:JB,clearcoat_normal_fragment_begin:eU,clearcoat_normal_fragment_maps:tU,clearcoat_pars_fragment:nU,iridescence_pars_fragment:iU,output_fragment:sU,packing:rU,premultiplied_alpha_fragment:oU,project_vertex:aU,dithering_fragment:lU,dithering_pars_fragment:cU,roughnessmap_fragment:uU,roughnessmap_pars_fragment:hU,shadowmap_pars_fragment:fU,shadowmap_pars_vertex:dU,shadowmap_vertex:pU,shadowmask_pars_fragment:mU,skinbase_vertex:gU,skinning_pars_vertex:vU,skinning_vertex:yU,skinnormal_vertex:_U,specularmap_fragment:bU,specularmap_pars_fragment:wU,tonemapping_fragment:xU,tonemapping_pars_fragment:AU,transmission_fragment:MU,transmission_pars_fragment:SU,uv_pars_fragment:CU,uv_pars_vertex:EU,uv_vertex:TU,uv2_pars_fragment:PU,uv2_pars_vertex:RU,uv2_vertex:IU,worldpos_vertex:DU,background_vert:LU,background_frag:OU,backgroundCube_vert:kU,backgroundCube_frag:NU,cube_vert:FU,cube_frag:zU,depth_vert:BU,depth_frag:UU,distanceRGBA_vert:$U,distanceRGBA_frag:VU,equirect_vert:GU,equirect_frag:HU,linedashed_vert:WU,linedashed_frag:jU,meshbasic_vert:XU,meshbasic_frag:YU,meshlambert_vert:qU,meshlambert_frag:ZU,meshmatcap_vert:KU,meshmatcap_frag:QU,meshnormal_vert:JU,meshnormal_frag:e6,meshphong_vert:t6,meshphong_frag:n6,meshphysical_vert:i6,meshphysical_frag:s6,meshtoon_vert:r6,meshtoon_frag:o6,points_vert:a6,points_frag:l6,shadow_vert:c6,shadow_frag:u6,sprite_vert:h6,sprite_frag:f6},Oe={common:{diffuse:{value:new Te(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wi},uv2Transform:{value:new Wi},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ke(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Te(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Te(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wi}},sprite:{diffuse:{value:new Te(16777215)},opacity:{value:1},center:{value:new ke(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wi}}},Dr={basic:{uniforms:Bi([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.fog]),vertexShader:yt.meshbasic_vert,fragmentShader:yt.meshbasic_frag},lambert:{uniforms:Bi([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new Te(0)}}]),vertexShader:yt.meshlambert_vert,fragmentShader:yt.meshlambert_frag},phong:{uniforms:Bi([Oe.common,Oe.specularmap,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,Oe.lights,{emissive:{value:new Te(0)},specular:{value:new Te(1118481)},shininess:{value:30}}]),vertexShader:yt.meshphong_vert,fragmentShader:yt.meshphong_frag},standard:{uniforms:Bi([Oe.common,Oe.envmap,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.roughnessmap,Oe.metalnessmap,Oe.fog,Oe.lights,{emissive:{value:new Te(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag},toon:{uniforms:Bi([Oe.common,Oe.aomap,Oe.lightmap,Oe.emissivemap,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.gradientmap,Oe.fog,Oe.lights,{emissive:{value:new Te(0)}}]),vertexShader:yt.meshtoon_vert,fragmentShader:yt.meshtoon_frag},matcap:{uniforms:Bi([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,Oe.fog,{matcap:{value:null}}]),vertexShader:yt.meshmatcap_vert,fragmentShader:yt.meshmatcap_frag},points:{uniforms:Bi([Oe.points,Oe.fog]),vertexShader:yt.points_vert,fragmentShader:yt.points_frag},dashed:{uniforms:Bi([Oe.common,Oe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yt.linedashed_vert,fragmentShader:yt.linedashed_frag},depth:{uniforms:Bi([Oe.common,Oe.displacementmap]),vertexShader:yt.depth_vert,fragmentShader:yt.depth_frag},normal:{uniforms:Bi([Oe.common,Oe.bumpmap,Oe.normalmap,Oe.displacementmap,{opacity:{value:1}}]),vertexShader:yt.meshnormal_vert,fragmentShader:yt.meshnormal_frag},sprite:{uniforms:Bi([Oe.sprite,Oe.fog]),vertexShader:yt.sprite_vert,fragmentShader:yt.sprite_frag},background:{uniforms:{uvTransform:{value:new Wi},t2D:{value:null}},vertexShader:yt.background_vert,fragmentShader:yt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0}},vertexShader:yt.backgroundCube_vert,fragmentShader:yt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:yt.cube_vert,fragmentShader:yt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yt.equirect_vert,fragmentShader:yt.equirect_frag},distanceRGBA:{uniforms:Bi([Oe.common,Oe.displacementmap,{referencePosition:{value:new T},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yt.distanceRGBA_vert,fragmentShader:yt.distanceRGBA_frag},shadow:{uniforms:Bi([Oe.lights,Oe.fog,{color:{value:new Te(0)},opacity:{value:1}}]),vertexShader:yt.shadow_vert,fragmentShader:yt.shadow_frag}};Dr.physical={uniforms:Bi([Dr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ke(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Te(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ke},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Te(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Te(1,1,1)},specularColorMap:{value:null}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag};function d6(n,e,t,i,s,r,o){const a=new Te(0);let l=r===!0?0:1,c,h,f=null,d=0,p=null;function g(v,y){let b=!1,_=y.isScene===!0?y.background:null;_&&_.isTexture&&(_=(y.backgroundBlurriness>0?t:e).get(_));const x=n.xr,w=x.getSession&&x.getSession();w&&w.environmentBlendMode==="additive"&&(_=null),_===null?m(a,l):_&&_.isColor&&(m(_,1),b=!0),(n.autoClear||b)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),_&&(_.isCubeTexture||_.mapping===A0)?(h===void 0&&(h=new We(new ur(1,1,1),new Ti({name:"BackgroundCubeMaterial",uniforms:Du(Dr.backgroundCube.uniforms),vertexShader:Dr.backgroundCube.vertexShader,fragmentShader:Dr.backgroundCube.fragmentShader,side:Ws,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(M,C,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,(f!==_||d!==_.version||p!==n.toneMapping)&&(h.material.needsUpdate=!0,f=_,d=_.version,p=n.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new We(new Lu(2,2),new Ti({name:"BackgroundMaterial",uniforms:Du(Dr.background.uniforms),vertexShader:Dr.background.vertexShader,fragmentShader:Dr.background.fragmentShader,side:Ul,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(f!==_||d!==_.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,f=_,d=_.version,p=n.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}u(g,"render");function m(v,y){i.buffers.color.setClear(v.r,v.g,v.b,y,o)}return u(m,"setClear"),{getClearColor:function(){return a},setClearColor:function(v,y=1){a.set(v),l=y,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,m(a,l)},render:g}}u(d6,"WebGLBackground");function p6(n,e,t,i){const s=n.getParameter(34921),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||r!==null,a={},l=v(null);let c=l,h=!1;function f(E,B,W,Z,ne){let j=!1;if(o){const ie=m(Z,W,B);c!==ie&&(c=ie,p(c.object)),j=y(E,Z,W,ne),j&&b(E,Z,W,ne)}else{const ie=B.wireframe===!0;(c.geometry!==Z.id||c.program!==W.id||c.wireframe!==ie)&&(c.geometry=Z.id,c.program=W.id,c.wireframe=ie,j=!0)}ne!==null&&t.update(ne,34963),(j||h)&&(h=!1,A(E,B,W,Z),ne!==null&&n.bindBuffer(34963,t.get(ne).buffer))}u(f,"setup");function d(){return i.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}u(d,"createVertexArrayObject");function p(E){return i.isWebGL2?n.bindVertexArray(E):r.bindVertexArrayOES(E)}u(p,"bindVertexArrayObject");function g(E){return i.isWebGL2?n.deleteVertexArray(E):r.deleteVertexArrayOES(E)}u(g,"deleteVertexArrayObject");function m(E,B,W){const Z=W.wireframe===!0;let ne=a[E.id];ne===void 0&&(ne={},a[E.id]=ne);let j=ne[B.id];j===void 0&&(j={},ne[B.id]=j);let ie=j[Z];return ie===void 0&&(ie=v(d()),j[Z]=ie),ie}u(m,"getBindingState");function v(E){const B=[],W=[],Z=[];for(let ne=0;ne<s;ne++)B[ne]=0,W[ne]=0,Z[ne]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:B,enabledAttributes:W,attributeDivisors:Z,object:E,attributes:{},index:null}}u(v,"createBindingState");function y(E,B,W,Z){const ne=c.attributes,j=B.attributes;let ie=0;const K=W.getAttributes();for(const $ in K)if(K[$].location>=0){const ae=ne[$];let J=j[$];if(J===void 0&&($==="instanceMatrix"&&E.instanceMatrix&&(J=E.instanceMatrix),$==="instanceColor"&&E.instanceColor&&(J=E.instanceColor)),ae===void 0||ae.attribute!==J||J&&ae.data!==J.data)return!0;ie++}return c.attributesNum!==ie||c.index!==Z}u(y,"needsUpdate");function b(E,B,W,Z){const ne={},j=B.attributes;let ie=0;const K=W.getAttributes();for(const $ in K)if(K[$].location>=0){let ae=j[$];ae===void 0&&($==="instanceMatrix"&&E.instanceMatrix&&(ae=E.instanceMatrix),$==="instanceColor"&&E.instanceColor&&(ae=E.instanceColor));const J={};J.attribute=ae,ae&&ae.data&&(J.data=ae.data),ne[$]=J,ie++}c.attributes=ne,c.attributesNum=ie,c.index=Z}u(b,"saveCache");function _(){const E=c.newAttributes;for(let B=0,W=E.length;B<W;B++)E[B]=0}u(_,"initAttributes");function x(E){w(E,0)}u(x,"enableAttribute");function w(E,B){const W=c.newAttributes,Z=c.enabledAttributes,ne=c.attributeDivisors;W[E]=1,Z[E]===0&&(n.enableVertexAttribArray(E),Z[E]=1),ne[E]!==B&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](E,B),ne[E]=B)}u(w,"enableAttributeAndDivisor");function M(){const E=c.newAttributes,B=c.enabledAttributes;for(let W=0,Z=B.length;W<Z;W++)B[W]!==E[W]&&(n.disableVertexAttribArray(W),B[W]=0)}u(M,"disableUnusedAttributes");function C(E,B,W,Z,ne,j){i.isWebGL2===!0&&(W===5124||W===5125)?n.vertexAttribIPointer(E,B,W,ne,j):n.vertexAttribPointer(E,B,W,Z,ne,j)}u(C,"vertexAttribPointer");function A(E,B,W,Z){if(i.isWebGL2===!1&&(E.isInstancedMesh||Z.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;_();const ne=Z.attributes,j=W.getAttributes(),ie=B.defaultAttributeValues;for(const K in j){const $=j[K];if($.location>=0){let le=ne[K];if(le===void 0&&(K==="instanceMatrix"&&E.instanceMatrix&&(le=E.instanceMatrix),K==="instanceColor"&&E.instanceColor&&(le=E.instanceColor)),le!==void 0){const ae=le.normalized,J=le.itemSize,te=t.get(le);if(te===void 0)continue;const ge=te.buffer,he=te.type,we=te.bytesPerElement;if(le.isInterleavedBufferAttribute){const xe=le.data,Se=xe.stride,V=le.offset;if(xe.isInstancedInterleavedBuffer){for(let Y=0;Y<$.locationSize;Y++)w($.location+Y,xe.meshPerAttribute);E.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let Y=0;Y<$.locationSize;Y++)x($.location+Y);n.bindBuffer(34962,ge);for(let Y=0;Y<$.locationSize;Y++)C($.location+Y,J/$.locationSize,he,ae,Se*we,(V+J/$.locationSize*Y)*we)}else{if(le.isInstancedBufferAttribute){for(let xe=0;xe<$.locationSize;xe++)w($.location+xe,le.meshPerAttribute);E.isInstancedMesh!==!0&&Z._maxInstanceCount===void 0&&(Z._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let xe=0;xe<$.locationSize;xe++)x($.location+xe);n.bindBuffer(34962,ge);for(let xe=0;xe<$.locationSize;xe++)C($.location+xe,J/$.locationSize,he,ae,J*we,J/$.locationSize*xe*we)}}else if(ie!==void 0){const ae=ie[K];if(ae!==void 0)switch(ae.length){case 2:n.vertexAttrib2fv($.location,ae);break;case 3:n.vertexAttrib3fv($.location,ae);break;case 4:n.vertexAttrib4fv($.location,ae);break;default:n.vertexAttrib1fv($.location,ae)}}}}M()}u(A,"setupVertexAttributes");function P(){O();for(const E in a){const B=a[E];for(const W in B){const Z=B[W];for(const ne in Z)g(Z[ne].object),delete Z[ne];delete B[W]}delete a[E]}}u(P,"dispose");function D(E){if(a[E.id]===void 0)return;const B=a[E.id];for(const W in B){const Z=B[W];for(const ne in Z)g(Z[ne].object),delete Z[ne];delete B[W]}delete a[E.id]}u(D,"releaseStatesOfGeometry");function k(E){for(const B in a){const W=a[B];if(W[E.id]===void 0)continue;const Z=W[E.id];for(const ne in Z)g(Z[ne].object),delete Z[ne];delete W[E.id]}}u(k,"releaseStatesOfProgram");function O(){N(),h=!0,c!==l&&(c=l,p(c.object))}u(O,"reset");function N(){l.geometry=null,l.program=null,l.wireframe=!1}return u(N,"resetDefaultState"),{setup:f,reset:O,resetDefaultState:N,dispose:P,releaseStatesOfGeometry:D,releaseStatesOfProgram:k,initAttributes:_,enableAttribute:x,disableUnusedAttributes:M}}u(p6,"WebGLBindingStates");function m6(n,e,t,i){const s=i.isWebGL2;let r;function o(c){r=c}u(o,"setMode");function a(c,h){n.drawArrays(r,c,h),t.update(h,r,1)}u(a,"render");function l(c,h,f){if(f===0)return;let d,p;if(s)d=n,p="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](r,c,h,f),t.update(h,r,f)}u(l,"renderInstances"),this.setMode=o,this.render=a,this.renderInstances=l}u(m6,"WebGLBufferRenderer");function g6(n,e,t){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}u(s,"getMaxAnisotropy");function r(C){if(C==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";C="mediump"}return C==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}u(r,"getMaxPrecision");const o=typeof WebGL2RenderingContext!="undefined"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&n instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,f=n.getParameter(34930),d=n.getParameter(35660),p=n.getParameter(3379),g=n.getParameter(34076),m=n.getParameter(34921),v=n.getParameter(36347),y=n.getParameter(36348),b=n.getParameter(36349),_=d>0,x=o||e.has("OES_texture_float"),w=_&&x,M=o?n.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:s,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:f,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:b,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:w,maxSamples:M}}u(g6,"WebGLCapabilities");function v6(n){const e=this;let t=null,i=0,s=!1,r=!1;const o=new xo,a=new Wi,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,d,p){const g=f.length!==0||d||i!==0||s;return s=d,t=h(f,p,0),i=f.length,g},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,c()},this.setState=function(f,d,p){const g=f.clippingPlanes,m=f.clipIntersection,v=f.clipShadows,y=n.get(f);if(!s||g===null||g.length===0||r&&!v)r?h(null):c();else{const b=r?0:i,_=b*4;let x=y.clippingState||null;l.value=x,x=h(g,d,_,p);for(let w=0;w!==_;++w)x[w]=t[w];y.clippingState=x,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}u(c,"resetGlobalState");function h(f,d,p,g){const m=f!==null?f.length:0;let v=null;if(m!==0){if(v=l.value,g!==!0||v===null){const y=p+m*4,b=d.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<y)&&(v=new Float32Array(y));for(let _=0,x=p;_!==m;++_,x+=4)o.copy(f[_]).applyMatrix4(b,a),o.normal.toArray(v,x),v[x+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,v}u(h,"projectPlanes")}u(v6,"WebGLClipping");function y6(n){let e=new WeakMap;function t(o,a){return a===Bg?o.mapping=Eu:a===c_&&(o.mapping=Tu),o}u(t,"mapTextureMapping");function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===Bg||a===c_)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new dP(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",s),t(c.texture,o.mapping)}else return null}}return o}u(i,"get");function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}u(s,"onTextureDispose");function r(){e=new WeakMap}return u(r,"dispose"),{get:i,dispose:r}}u(y6,"WebGLCubeMaps");class Va extends T0{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}u(Va,"OrthographicCamera");const ou=4,WM=[.125,.215,.35,.446,.526,.582],El=20,av=new Va,jM=new Te;let lv=null;const Al=(1+Math.sqrt(5))/2,Cc=1/Al,XM=[new T(1,1,1),new T(-1,1,1),new T(1,1,-1),new T(-1,1,-1),new T(0,Al,Cc),new T(0,Al,-Cc),new T(Cc,0,Al),new T(-Cc,0,Al),new T(Al,Cc,0),new T(-Al,Cc,0)];class d_{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){lv=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=ZM(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=qM(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(lv),e.scissorTest=!1,Np(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Eu||e.mapping===Tu?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),lv=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Vi,minFilter:Vi,generateMipmaps:!1,type:Pu,format:Es,encoding:Lo,depthBuffer:!1},s=YM(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=YM(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_6(r)),this._blurMaterial=b6(r,e,t)}return s}_compileMaterial(e){const t=new We(this._lodPlanes[0],e);this._renderer.compile(t,av)}_sceneToCubeUV(e,t,i,s){const a=new di(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,d=h.toneMapping;h.getClearColor(jM),h.toneMapping=Ur,h.autoClear=!1;const p=new ji({name:"PMREM.Background",side:Ws,depthWrite:!1,depthTest:!1}),g=new We(new ur,p);let m=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,m=!0):(p.color.copy(jM),m=!0);for(let y=0;y<6;y++){const b=y%3;b===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):b===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const _=this._cubeSize;Np(s,b*_,y>2?_:0,_,_),h.setRenderTarget(s),m&&h.render(g,a),h.render(e,a)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=d,h.autoClear=f,e.background=v}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===Eu||e.mapping===Tu;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=ZM()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=qM());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new We(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;Np(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,av)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=XM[(s-1)%XM.length];this._blur(e,s-1,s,r,o)}t.autoClear=i}_blur(e,t,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,s,"latitudinal",r),this._halfBlur(o,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,f=new We(this._lodPlanes[s],c),d=c.uniforms,p=this._sizeLods[i]-1,g=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*El-1),m=r/g,v=isFinite(r)?1+Math.floor(h*m):El;v>El&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${El}`);const y=[];let b=0;for(let C=0;C<El;++C){const A=C/m,P=Math.exp(-A*A/2);y.push(P),C===0?b+=P:C<v&&(b+=2*P)}for(let C=0;C<y.length;C++)y[C]=y[C]/b;d.envMap.value=e.texture,d.samples.value=v,d.weights.value=y,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:_}=this;d.dTheta.value=g,d.mipInt.value=_-i;const x=this._sizeLods[s],w=3*x*(s>_-ou?s-_+ou:0),M=4*(this._cubeSize-x);Np(t,w,M,3*x,2*x),l.setRenderTarget(t),l.render(f,av)}}u(d_,"PMREMGenerator");function _6(n){const e=[],t=[],i=[];let s=n;const r=n-ou+1+WM.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);t.push(a);let l=1/a;o>n-ou?l=WM[o-n+ou-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,f=1+c,d=[h,h,f,h,f,f,h,h,f,f,h,f],p=6,g=6,m=3,v=2,y=1,b=new Float32Array(m*g*p),_=new Float32Array(v*g*p),x=new Float32Array(y*g*p);for(let M=0;M<p;M++){const C=M%3*2/3-1,A=M>2?0:-1,P=[C,A,0,C+2/3,A,0,C+2/3,A+1,0,C,A,0,C+2/3,A+1,0,C,A+1,0];b.set(P,m*g*M),_.set(d,v*g*M);const D=[M,M,M,M,M,M];x.set(D,y*g*M)}const w=new it;w.setAttribute("position",new mn(b,m)),w.setAttribute("uv",new mn(_,v)),w.setAttribute("faceIndex",new mn(x,y)),e.push(w),s>ou&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}u(_6,"_createPlanes");function YM(n,e,t){const i=new yi(n,e,t);return i.texture.mapping=A0,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}u(YM,"_createRenderTarget");function Np(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}u(Np,"_setViewport");function b6(n,e,t){const i=new Float32Array(El),s=new T(0,1,0);return new Ti({name:"SphericalGaussianBlur",defines:{n:El,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:bb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Br,depthTest:!1,depthWrite:!1})}u(b6,"_getBlurShader");function qM(){return new Ti({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:bb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Br,depthTest:!1,depthWrite:!1})}u(qM,"_getEquirectMaterial");function ZM(){return new Ti({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:bb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Br,depthTest:!1,depthWrite:!1})}u(ZM,"_getCubemapMaterial");function bb(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}u(bb,"_getCommonVertexShader");function w6(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===Bg||l===c_,h=l===Eu||l===Tu;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let f=e.get(a);return t===null&&(t=new d_(n)),f=c?t.fromEquirectangular(a,f):t.fromCubemap(a,f),e.set(a,f),f.texture}else{if(e.has(a))return e.get(a).texture;{const f=a.image;if(c&&f&&f.height>0||h&&f&&s(f)){t===null&&(t=new d_(n));const d=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",r),d.texture}else return null}}}return a}u(i,"get");function s(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}u(s,"isCubeTextureComplete");function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}u(r,"onTextureDispose");function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return u(o,"dispose"),{get:i,dispose:o}}u(w6,"WebGLCubeUVMaps");function x6(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return u(t,"getExtension"),{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const s=t(i);return s===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}u(x6,"WebGLExtensions");function A6(n,e,t,i){const s={},r=new WeakMap;function o(f){const d=f.target;d.index!==null&&e.remove(d.index);for(const g in d.attributes)e.remove(d.attributes[g]);d.removeEventListener("dispose",o),delete s[d.id];const p=r.get(d);p&&(e.remove(p),r.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}u(o,"onGeometryDispose");function a(f,d){return s[d.id]===!0||(d.addEventListener("dispose",o),s[d.id]=!0,t.memory.geometries++),d}u(a,"get");function l(f){const d=f.attributes;for(const g in d)e.update(d[g],34962);const p=f.morphAttributes;for(const g in p){const m=p[g];for(let v=0,y=m.length;v<y;v++)e.update(m[v],34962)}}u(l,"update");function c(f){const d=[],p=f.index,g=f.attributes.position;let m=0;if(p!==null){const b=p.array;m=p.version;for(let _=0,x=b.length;_<x;_+=3){const w=b[_+0],M=b[_+1],C=b[_+2];d.push(w,M,M,C,C,w)}}else{const b=g.array;m=g.version;for(let _=0,x=b.length/3-1;_<x;_+=3){const w=_+0,M=_+1,C=_+2;d.push(w,M,M,C,C,w)}}const v=new(cP(d)?yb:C0)(d,1);v.version=m;const y=r.get(f);y&&e.remove(y),r.set(f,v)}u(c,"updateWireframeAttribute");function h(f){const d=r.get(f);if(d){const p=f.index;p!==null&&d.version<p.version&&c(f)}else c(f);return r.get(f)}return u(h,"getWireframeAttribute"),{get:a,update:l,getWireframeAttribute:h}}u(A6,"WebGLGeometries");function M6(n,e,t,i){const s=i.isWebGL2;let r;function o(d){r=d}u(o,"setMode");let a,l;function c(d){a=d.type,l=d.bytesPerElement}u(c,"setIndex");function h(d,p){n.drawElements(r,p,a,d*l),t.update(p,r,1)}u(h,"render");function f(d,p,g){if(g===0)return;let m,v;if(s)m=n,v="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[v](r,p,a,d*l,g),t.update(p,r,g)}u(f,"renderInstances"),this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=f}u(M6,"WebGLIndexedBufferRenderer");function S6(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}u(i,"update");function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return u(s,"reset"),{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}u(S6,"WebGLInfo");function C6(n,e){return n[0]-e[0]}u(C6,"numericalSort");function E6(n,e){return Math.abs(e[1])-Math.abs(n[1])}u(E6,"absNumericalSort");function T6(n,e,t){const i={},s=new Float32Array(8),r=new WeakMap,o=new Dt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,f,d){const p=c.morphTargetInfluences;if(e.isWebGL2===!0){const m=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,v=m!==void 0?m.length:0;let y=r.get(h);if(y===void 0||y.count!==v){let W=function(){E.dispose(),r.delete(h),h.removeEventListener("dispose",W)};var g=W;u(W,"disposeTexture"),y!==void 0&&y.texture.dispose();const x=h.morphAttributes.position!==void 0,w=h.morphAttributes.normal!==void 0,M=h.morphAttributes.color!==void 0,C=h.morphAttributes.position||[],A=h.morphAttributes.normal||[],P=h.morphAttributes.color||[];let D=0;x===!0&&(D=1),w===!0&&(D=2),M===!0&&(D=3);let k=h.attributes.position.count*D,O=1;k>e.maxTextureSize&&(O=Math.ceil(k/e.maxTextureSize),k=e.maxTextureSize);const N=new Float32Array(k*O*4*v),E=new vb(N,k,O,v);E.type=Ma,E.needsUpdate=!0;const B=D*4;for(let Z=0;Z<v;Z++){const ne=C[Z],j=A[Z],ie=P[Z],K=k*O*4*Z;for(let $=0;$<ne.count;$++){const le=$*B;x===!0&&(o.fromBufferAttribute(ne,$),N[K+le+0]=o.x,N[K+le+1]=o.y,N[K+le+2]=o.z,N[K+le+3]=0),w===!0&&(o.fromBufferAttribute(j,$),N[K+le+4]=o.x,N[K+le+5]=o.y,N[K+le+6]=o.z,N[K+le+7]=0),M===!0&&(o.fromBufferAttribute(ie,$),N[K+le+8]=o.x,N[K+le+9]=o.y,N[K+le+10]=o.z,N[K+le+11]=ie.itemSize===4?o.w:1)}}y={count:v,texture:E,size:new ke(k,O)},r.set(h,y),h.addEventListener("dispose",W)}let b=0;for(let x=0;x<p.length;x++)b+=p[x];const _=h.morphTargetsRelative?1:1-b;d.getUniforms().setValue(n,"morphTargetBaseInfluence",_),d.getUniforms().setValue(n,"morphTargetInfluences",p),d.getUniforms().setValue(n,"morphTargetsTexture",y.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",y.size)}else{const m=p===void 0?0:p.length;let v=i[h.id];if(v===void 0||v.length!==m){v=[];for(let w=0;w<m;w++)v[w]=[w,0];i[h.id]=v}for(let w=0;w<m;w++){const M=v[w];M[0]=w,M[1]=p[w]}v.sort(E6);for(let w=0;w<8;w++)w<m&&v[w][1]?(a[w][0]=v[w][0],a[w][1]=v[w][1]):(a[w][0]=Number.MAX_SAFE_INTEGER,a[w][1]=0);a.sort(C6);const y=h.morphAttributes.position,b=h.morphAttributes.normal;let _=0;for(let w=0;w<8;w++){const M=a[w],C=M[0],A=M[1];C!==Number.MAX_SAFE_INTEGER&&A?(y&&h.getAttribute("morphTarget"+w)!==y[C]&&h.setAttribute("morphTarget"+w,y[C]),b&&h.getAttribute("morphNormal"+w)!==b[C]&&h.setAttribute("morphNormal"+w,b[C]),s[w]=A,_+=A):(y&&h.hasAttribute("morphTarget"+w)===!0&&h.deleteAttribute("morphTarget"+w),b&&h.hasAttribute("morphNormal"+w)===!0&&h.deleteAttribute("morphNormal"+w),s[w]=0)}const x=h.morphTargetsRelative?1:1-_;d.getUniforms().setValue(n,"morphTargetBaseInfluence",x),d.getUniforms().setValue(n,"morphTargetInfluences",s)}}return u(l,"update"),{update:l}}u(T6,"WebGLMorphtargets");function P6(n,e,t,i){let s=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,f=e.get(l,h);return s.get(f)!==c&&(e.update(f),s.set(f,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),f}u(r,"update");function o(){s=new WeakMap}u(o,"dispose");function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return u(a,"onInstancedMeshDispose"),{update:r,dispose:o}}u(P6,"WebGLObjects");const mP=new ii,gP=new vb,vP=new hP,yP=new _b,KM=[],QM=[],JM=new Float32Array(16),e2=new Float32Array(9),t2=new Float32Array(4);function lh(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let r=KM[s];if(r===void 0&&(r=new Float32Array(s),KM[s]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(r,a)}return r}u(lh,"flatten$u");function si(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}u(si,"arraysEqual");function ri(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}u(ri,"copyArray");function P0(n,e){let t=QM[e];t===void 0&&(t=new Int32Array(e),QM[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}u(P0,"allocTexUnits");function R6(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}u(R6,"setValueV1f");function I6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(si(t,e))return;n.uniform2fv(this.addr,e),ri(t,e)}}u(I6,"setValueV2f");function D6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(si(t,e))return;n.uniform3fv(this.addr,e),ri(t,e)}}u(D6,"setValueV3f");function L6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(si(t,e))return;n.uniform4fv(this.addr,e),ri(t,e)}}u(L6,"setValueV4f");function O6(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(si(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),ri(t,e)}else{if(si(t,i))return;t2.set(i),n.uniformMatrix2fv(this.addr,!1,t2),ri(t,i)}}u(O6,"setValueM2");function k6(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(si(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),ri(t,e)}else{if(si(t,i))return;e2.set(i),n.uniformMatrix3fv(this.addr,!1,e2),ri(t,i)}}u(k6,"setValueM3");function N6(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(si(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),ri(t,e)}else{if(si(t,i))return;JM.set(i),n.uniformMatrix4fv(this.addr,!1,JM),ri(t,i)}}u(N6,"setValueM4");function F6(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}u(F6,"setValueV1i");function z6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(si(t,e))return;n.uniform2iv(this.addr,e),ri(t,e)}}u(z6,"setValueV2i");function B6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(si(t,e))return;n.uniform3iv(this.addr,e),ri(t,e)}}u(B6,"setValueV3i");function U6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(si(t,e))return;n.uniform4iv(this.addr,e),ri(t,e)}}u(U6,"setValueV4i");function $6(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}u($6,"setValueV1ui");function V6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(si(t,e))return;n.uniform2uiv(this.addr,e),ri(t,e)}}u(V6,"setValueV2ui");function G6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(si(t,e))return;n.uniform3uiv(this.addr,e),ri(t,e)}}u(G6,"setValueV3ui");function H6(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(si(t,e))return;n.uniform4uiv(this.addr,e),ri(t,e)}}u(H6,"setValueV4ui");function W6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2D(e||mP,s)}u(W6,"setValueT1");function j6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||vP,s)}u(j6,"setValueT3D1");function X6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||yP,s)}u(X6,"setValueT6");function Y6(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||gP,s)}u(Y6,"setValueT2DArray1");function q6(n){switch(n){case 5126:return R6;case 35664:return I6;case 35665:return D6;case 35666:return L6;case 35674:return O6;case 35675:return k6;case 35676:return N6;case 5124:case 35670:return F6;case 35667:case 35671:return z6;case 35668:case 35672:return B6;case 35669:case 35673:return U6;case 5125:return $6;case 36294:return V6;case 36295:return G6;case 36296:return H6;case 35678:case 36198:case 36298:case 36306:case 35682:return W6;case 35679:case 36299:case 36307:return j6;case 35680:case 36300:case 36308:case 36293:return X6;case 36289:case 36303:case 36311:case 36292:return Y6}}u(q6,"getSingularSetter");function Z6(n,e){n.uniform1fv(this.addr,e)}u(Z6,"setValueV1fArray");function K6(n,e){const t=lh(e,this.size,2);n.uniform2fv(this.addr,t)}u(K6,"setValueV2fArray");function Q6(n,e){const t=lh(e,this.size,3);n.uniform3fv(this.addr,t)}u(Q6,"setValueV3fArray");function J6(n,e){const t=lh(e,this.size,4);n.uniform4fv(this.addr,t)}u(J6,"setValueV4fArray");function e$(n,e){const t=lh(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}u(e$,"setValueM2Array");function t$(n,e){const t=lh(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}u(t$,"setValueM3Array");function n$(n,e){const t=lh(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}u(n$,"setValueM4Array");function i$(n,e){n.uniform1iv(this.addr,e)}u(i$,"setValueV1iArray");function s$(n,e){n.uniform2iv(this.addr,e)}u(s$,"setValueV2iArray");function r$(n,e){n.uniform3iv(this.addr,e)}u(r$,"setValueV3iArray");function o$(n,e){n.uniform4iv(this.addr,e)}u(o$,"setValueV4iArray");function a$(n,e){n.uniform1uiv(this.addr,e)}u(a$,"setValueV1uiArray");function l$(n,e){n.uniform2uiv(this.addr,e)}u(l$,"setValueV2uiArray");function c$(n,e){n.uniform3uiv(this.addr,e)}u(c$,"setValueV3uiArray");function u$(n,e){n.uniform4uiv(this.addr,e)}u(u$,"setValueV4uiArray");function h$(n,e,t){const i=this.cache,s=e.length,r=P0(t,s);si(i,r)||(n.uniform1iv(this.addr,r),ri(i,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||mP,r[o])}u(h$,"setValueT1Array");function f$(n,e,t){const i=this.cache,s=e.length,r=P0(t,s);si(i,r)||(n.uniform1iv(this.addr,r),ri(i,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||vP,r[o])}u(f$,"setValueT3DArray");function d$(n,e,t){const i=this.cache,s=e.length,r=P0(t,s);si(i,r)||(n.uniform1iv(this.addr,r),ri(i,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||yP,r[o])}u(d$,"setValueT6Array");function p$(n,e,t){const i=this.cache,s=e.length,r=P0(t,s);si(i,r)||(n.uniform1iv(this.addr,r),ri(i,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||gP,r[o])}u(p$,"setValueT2DArrayArray");function m$(n){switch(n){case 5126:return Z6;case 35664:return K6;case 35665:return Q6;case 35666:return J6;case 35674:return e$;case 35675:return t$;case 35676:return n$;case 5124:case 35670:return i$;case 35667:case 35671:return s$;case 35668:case 35672:return r$;case 35669:case 35673:return o$;case 5125:return a$;case 36294:return l$;case 36295:return c$;case 36296:return u$;case 35678:case 36198:case 36298:case 36306:case 35682:return h$;case 35679:case 36299:case 36307:return f$;case 35680:case 36300:case 36308:case 36293:return d$;case 36289:case 36303:case 36311:case 36292:return p$}}u(m$,"getPureArraySetter");class _P{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=q6(t.type)}}u(_P,"SingleUniform");class bP{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=m$(t.type)}}u(bP,"PureArrayUniform");class wP{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(e,t[a.id],i)}}}u(wP,"StructuredUniform");const cv=/(\w+)(\])?(\[|\.)?/g;function n2(n,e){n.seq.push(e),n.map[e.id]=e}u(n2,"addUniform");function g$(n,e,t){const i=n.name,s=i.length;for(cv.lastIndex=0;;){const r=cv.exec(i),o=cv.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){n2(t,c===void 0?new _P(a,n,e):new bP(a,n,e));break}else{let f=t.map[a];f===void 0&&(f=new wP(a),n2(t,f)),t=f}}}u(g$,"parseUniform");class nd{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let s=0;s<i;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);g$(r,o,this)}}setValue(e,t,i,s){const r=this.map[t];r!==void 0&&r.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&i.push(o)}return i}}u(nd,"WebGLUniforms");function i2(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}u(i2,"WebGLShader");let v$=0;function y$(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}u(y$,"handleSource");function _$(n){switch(n){case Lo:return["Linear","( value )"];case It:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}u(_$,"getEncodingComponents");function s2(n,e,t){const i=n.getShaderParameter(e,35713),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+y$(n.getShaderSource(e),o)}else return s}u(s2,"getShaderErrors");function b$(n,e){const t=_$(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}u(b$,"getTexelEncodingFunction");function w$(n,e){let t;switch(e){case O5:t="Linear";break;case k5:t="Reinhard";break;case N5:t="OptimizedCineon";break;case F5:t="ACESFilmic";break;case z5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}u(w$,"getToneMappingFunction");function x$(n){return[n.extensionDerivatives||!!n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(zf).join(`
`)}u(x$,"generateExtensions");function A$(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}u(A$,"generateDefines");function M$(n,e){const t={},i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s),o=r.name;let a=1;r.type===35674&&(a=2),r.type===35675&&(a=3),r.type===35676&&(a=4),t[o]={type:r.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}u(M$,"fetchAttributeLocations");function zf(n){return n!==""}u(zf,"filterEmptyLine");function r2(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}u(r2,"replaceLightNums");function o2(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}u(o2,"replaceClippingPlaneNums");const S$=/^[ \t]*#include +<([\w\d./]+)>/gm;function p_(n){return n.replace(S$,C$)}u(p_,"resolveIncludes");function C$(n,e){const t=yt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return p_(t)}u(C$,"includeReplacer");const E$=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function a2(n){return n.replace(E$,T$)}u(a2,"unrollLoops");function T$(n,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}u(T$,"loopReplacer");function l2(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}u(l2,"generatePrecision");function P$(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===eP?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===tP?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Ff&&(e="SHADOWMAP_TYPE_VSM"),e}u(P$,"generateShadowMapTypeDefine");function R$(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Eu:case Tu:e="ENVMAP_TYPE_CUBE";break;case A0:e="ENVMAP_TYPE_CUBE_UV";break}return e}u(R$,"generateEnvMapTypeDefine");function I$(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Tu:e="ENVMAP_MODE_REFRACTION";break}return e}u(I$,"generateEnvMapModeDefine");function D$(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case x0:e="ENVMAP_BLENDING_MULTIPLY";break;case D5:e="ENVMAP_BLENDING_MIX";break;case L5:e="ENVMAP_BLENDING_ADD";break}return e}u(D$,"generateEnvMapBlendingDefine");function L$(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}u(L$,"generateCubeUVSize");function O$(n,e,t,i){const s=n.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=P$(t),c=R$(t),h=I$(t),f=D$(t),d=L$(t),p=t.isWebGL2?"":x$(t),g=A$(r),m=s.createProgram();let v,y,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[g].filter(zf).join(`
`),v.length>0&&(v+=`
`),y=[p,g].filter(zf).join(`
`),y.length>0&&(y+=`
`)):(v=[l2(t),"#define SHADER_NAME "+t.shaderName,g,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(zf).join(`
`),y=[p,l2(t),"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+f:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ur?"#define TONE_MAPPING":"",t.toneMapping!==Ur?yt.tonemapping_pars_fragment:"",t.toneMapping!==Ur?w$("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",yt.encodings_pars_fragment,b$("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(zf).join(`
`)),o=p_(o),o=r2(o,t),o=o2(o,t),a=p_(a),a=r2(a,t),a=o2(a,t),o=a2(o),a=a2(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===LM?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===LM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const _=b+v+o,x=b+y+a,w=i2(s,35633,_),M=i2(s,35632,x);if(s.attachShader(m,w),s.attachShader(m,M),t.index0AttributeName!==void 0?s.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),n.debug.checkShaderErrors){const P=s.getProgramInfoLog(m).trim(),D=s.getShaderInfoLog(w).trim(),k=s.getShaderInfoLog(M).trim();let O=!0,N=!0;if(s.getProgramParameter(m,35714)===!1){O=!1;const E=s2(s,w,"vertex"),B=s2(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+`

Program Info Log: `+P+`
`+E+`
`+B)}else P!==""?console.warn("THREE.WebGLProgram: Program Info Log:",P):(D===""||k==="")&&(N=!1);N&&(this.diagnostics={runnable:O,programLog:P,vertexShader:{log:D,prefix:v},fragmentShader:{log:k,prefix:y}})}s.deleteShader(w),s.deleteShader(M);let C;this.getUniforms=function(){return C===void 0&&(C=new nd(s,m)),C};let A;return this.getAttributes=function(){return A===void 0&&(A=M$(s,m)),A},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=v$++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=M,this}u(O$,"WebGLProgram");let k$=0;class xP{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new AP(e),t.set(e,i)),i}}u(xP,"WebGLShaderCache");class AP{constructor(e){this.id=k$++,this.code=e,this.usedTimes=0}}u(AP,"WebGLShaderStage");function N$(n,e,t,i,s,r,o){const a=new S0,l=new xP,c=[],h=s.isWebGL2,f=s.logarithmicDepthBuffer,d=s.vertexTextures;let p=s.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(A,P,D,k,O){const N=k.fog,E=O.geometry,B=A.isMeshStandardMaterial?k.environment:null,W=(A.isMeshStandardMaterial?t:e).get(A.envMap||B),Z=!!W&&W.mapping===A0?W.image.height:null,ne=g[A.type];A.precision!==null&&(p=s.getMaxPrecision(A.precision),p!==A.precision&&console.warn("THREE.WebGLProgram.getParameters:",A.precision,"not supported, using",p,"instead."));const j=E.morphAttributes.position||E.morphAttributes.normal||E.morphAttributes.color,ie=j!==void 0?j.length:0;let K=0;E.morphAttributes.position!==void 0&&(K=1),E.morphAttributes.normal!==void 0&&(K=2),E.morphAttributes.color!==void 0&&(K=3);let $,le,ae,J;if(ne){const Se=Dr[ne];$=Se.vertexShader,le=Se.fragmentShader}else $=A.vertexShader,le=A.fragmentShader,l.update(A),ae=l.getVertexShaderID(A),J=l.getFragmentShaderID(A);const te=n.getRenderTarget(),ge=A.alphaTest>0,he=A.clearcoat>0,we=A.iridescence>0;return{isWebGL2:h,shaderID:ne,shaderName:A.type,vertexShader:$,fragmentShader:le,defines:A.defines,customVertexShaderID:ae,customFragmentShaderID:J,isRawShaderMaterial:A.isRawShaderMaterial===!0,glslVersion:A.glslVersion,precision:p,instancing:O.isInstancedMesh===!0,instancingColor:O.isInstancedMesh===!0&&O.instanceColor!==null,supportsVertexTextures:d,outputEncoding:te===null?n.outputEncoding:te.isXRRenderTarget===!0?te.texture.encoding:Lo,map:!!A.map,matcap:!!A.matcap,envMap:!!W,envMapMode:W&&W.mapping,envMapCubeUVHeight:Z,lightMap:!!A.lightMap,aoMap:!!A.aoMap,emissiveMap:!!A.emissiveMap,bumpMap:!!A.bumpMap,normalMap:!!A.normalMap,objectSpaceNormalMap:A.normalMapType===iz,tangentSpaceNormalMap:A.normalMapType===Gd,decodeVideoTexture:!!A.map&&A.map.isVideoTexture===!0&&A.map.encoding===It,clearcoat:he,clearcoatMap:he&&!!A.clearcoatMap,clearcoatRoughnessMap:he&&!!A.clearcoatRoughnessMap,clearcoatNormalMap:he&&!!A.clearcoatNormalMap,iridescence:we,iridescenceMap:we&&!!A.iridescenceMap,iridescenceThicknessMap:we&&!!A.iridescenceThicknessMap,displacementMap:!!A.displacementMap,roughnessMap:!!A.roughnessMap,metalnessMap:!!A.metalnessMap,specularMap:!!A.specularMap,specularIntensityMap:!!A.specularIntensityMap,specularColorMap:!!A.specularColorMap,opaque:A.transparent===!1&&A.blending===yu,alphaMap:!!A.alphaMap,alphaTest:ge,gradientMap:!!A.gradientMap,sheen:A.sheen>0,sheenColorMap:!!A.sheenColorMap,sheenRoughnessMap:!!A.sheenRoughnessMap,transmission:A.transmission>0,transmissionMap:!!A.transmissionMap,thicknessMap:!!A.thicknessMap,combine:A.combine,vertexTangents:!!A.normalMap&&!!E.attributes.tangent,vertexColors:A.vertexColors,vertexAlphas:A.vertexColors===!0&&!!E.attributes.color&&E.attributes.color.itemSize===4,vertexUvs:!!A.map||!!A.bumpMap||!!A.normalMap||!!A.specularMap||!!A.alphaMap||!!A.emissiveMap||!!A.roughnessMap||!!A.metalnessMap||!!A.clearcoatMap||!!A.clearcoatRoughnessMap||!!A.clearcoatNormalMap||!!A.iridescenceMap||!!A.iridescenceThicknessMap||!!A.displacementMap||!!A.transmissionMap||!!A.thicknessMap||!!A.specularIntensityMap||!!A.specularColorMap||!!A.sheenColorMap||!!A.sheenRoughnessMap,uvsVertexOnly:!(!!A.map||!!A.bumpMap||!!A.normalMap||!!A.specularMap||!!A.alphaMap||!!A.emissiveMap||!!A.roughnessMap||!!A.metalnessMap||!!A.clearcoatNormalMap||!!A.iridescenceMap||!!A.iridescenceThicknessMap||A.transmission>0||!!A.transmissionMap||!!A.thicknessMap||!!A.specularIntensityMap||!!A.specularColorMap||A.sheen>0||!!A.sheenColorMap||!!A.sheenRoughnessMap)&&!!A.displacementMap,fog:!!N,useFog:A.fog===!0,fogExp2:N&&N.isFogExp2,flatShading:!!A.flatShading,sizeAttenuation:A.sizeAttenuation,logarithmicDepthBuffer:f,skinning:O.isSkinnedMesh===!0,morphTargets:E.morphAttributes.position!==void 0,morphNormals:E.morphAttributes.normal!==void 0,morphColors:E.morphAttributes.color!==void 0,morphTargetsCount:ie,morphTextureStride:K,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:A.dithering,shadowMapEnabled:n.shadowMap.enabled&&D.length>0,shadowMapType:n.shadowMap.type,toneMapping:A.toneMapped?n.toneMapping:Ur,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:A.premultipliedAlpha,doubleSided:A.side===Ts,flipSided:A.side===Ws,useDepthPacking:!!A.depthPacking,depthPacking:A.depthPacking||0,index0AttributeName:A.index0AttributeName,extensionDerivatives:A.extensions&&A.extensions.derivatives,extensionFragDepth:A.extensions&&A.extensions.fragDepth,extensionDrawBuffers:A.extensions&&A.extensions.drawBuffers,extensionShaderTextureLOD:A.extensions&&A.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:A.customProgramCacheKey()}}u(m,"getParameters");function v(A){const P=[];if(A.shaderID?P.push(A.shaderID):(P.push(A.customVertexShaderID),P.push(A.customFragmentShaderID)),A.defines!==void 0)for(const D in A.defines)P.push(D),P.push(A.defines[D]);return A.isRawShaderMaterial===!1&&(y(P,A),b(P,A),P.push(n.outputEncoding)),P.push(A.customProgramCacheKey),P.join()}u(v,"getProgramCacheKey");function y(A,P){A.push(P.precision),A.push(P.outputEncoding),A.push(P.envMapMode),A.push(P.envMapCubeUVHeight),A.push(P.combine),A.push(P.vertexUvs),A.push(P.fogExp2),A.push(P.sizeAttenuation),A.push(P.morphTargetsCount),A.push(P.morphAttributeCount),A.push(P.numDirLights),A.push(P.numPointLights),A.push(P.numSpotLights),A.push(P.numSpotLightMaps),A.push(P.numHemiLights),A.push(P.numRectAreaLights),A.push(P.numDirLightShadows),A.push(P.numPointLightShadows),A.push(P.numSpotLightShadows),A.push(P.numSpotLightShadowsWithMaps),A.push(P.shadowMapType),A.push(P.toneMapping),A.push(P.numClippingPlanes),A.push(P.numClipIntersection),A.push(P.depthPacking)}u(y,"getProgramCacheKeyParameters");function b(A,P){a.disableAll(),P.isWebGL2&&a.enable(0),P.supportsVertexTextures&&a.enable(1),P.instancing&&a.enable(2),P.instancingColor&&a.enable(3),P.map&&a.enable(4),P.matcap&&a.enable(5),P.envMap&&a.enable(6),P.lightMap&&a.enable(7),P.aoMap&&a.enable(8),P.emissiveMap&&a.enable(9),P.bumpMap&&a.enable(10),P.normalMap&&a.enable(11),P.objectSpaceNormalMap&&a.enable(12),P.tangentSpaceNormalMap&&a.enable(13),P.clearcoat&&a.enable(14),P.clearcoatMap&&a.enable(15),P.clearcoatRoughnessMap&&a.enable(16),P.clearcoatNormalMap&&a.enable(17),P.iridescence&&a.enable(18),P.iridescenceMap&&a.enable(19),P.iridescenceThicknessMap&&a.enable(20),P.displacementMap&&a.enable(21),P.specularMap&&a.enable(22),P.roughnessMap&&a.enable(23),P.metalnessMap&&a.enable(24),P.gradientMap&&a.enable(25),P.alphaMap&&a.enable(26),P.alphaTest&&a.enable(27),P.vertexColors&&a.enable(28),P.vertexAlphas&&a.enable(29),P.vertexUvs&&a.enable(30),P.vertexTangents&&a.enable(31),P.uvsVertexOnly&&a.enable(32),A.push(a.mask),a.disableAll(),P.fog&&a.enable(0),P.useFog&&a.enable(1),P.flatShading&&a.enable(2),P.logarithmicDepthBuffer&&a.enable(3),P.skinning&&a.enable(4),P.morphTargets&&a.enable(5),P.morphNormals&&a.enable(6),P.morphColors&&a.enable(7),P.premultipliedAlpha&&a.enable(8),P.shadowMapEnabled&&a.enable(9),P.physicallyCorrectLights&&a.enable(10),P.doubleSided&&a.enable(11),P.flipSided&&a.enable(12),P.useDepthPacking&&a.enable(13),P.dithering&&a.enable(14),P.specularIntensityMap&&a.enable(15),P.specularColorMap&&a.enable(16),P.transmission&&a.enable(17),P.transmissionMap&&a.enable(18),P.thicknessMap&&a.enable(19),P.sheen&&a.enable(20),P.sheenColorMap&&a.enable(21),P.sheenRoughnessMap&&a.enable(22),P.decodeVideoTexture&&a.enable(23),P.opaque&&a.enable(24),A.push(a.mask)}u(b,"getProgramCacheKeyBooleans");function _(A){const P=g[A.type];let D;if(P){const k=Dr[P];D=E0.clone(k.uniforms)}else D=A.uniforms;return D}u(_,"getUniforms");function x(A,P){let D;for(let k=0,O=c.length;k<O;k++){const N=c[k];if(N.cacheKey===P){D=N,++D.usedTimes;break}}return D===void 0&&(D=new O$(n,P,A,r),c.push(D)),D}u(x,"acquireProgram");function w(A){if(--A.usedTimes===0){const P=c.indexOf(A);c[P]=c[c.length-1],c.pop(),A.destroy()}}u(w,"releaseProgram");function M(A){l.remove(A)}u(M,"releaseShaderCache");function C(){l.dispose()}return u(C,"dispose"),{getParameters:m,getProgramCacheKey:v,getUniforms:_,acquireProgram:x,releaseProgram:w,releaseShaderCache:M,programs:c,dispose:C}}u(N$,"WebGLPrograms");function F$(){let n=new WeakMap;function e(r){let o=n.get(r);return o===void 0&&(o={},n.set(r,o)),o}u(e,"get");function t(r){n.delete(r)}u(t,"remove");function i(r,o,a){n.get(r)[o]=a}u(i,"update");function s(){n=new WeakMap}return u(s,"dispose"),{get:e,remove:t,update:i,dispose:s}}u(F$,"WebGLProperties");function z$(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}u(z$,"painterSortStable");function c2(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}u(c2,"reversePainterSortStable");function u2(){const n=[];let e=0;const t=[],i=[],s=[];function r(){e=0,t.length=0,i.length=0,s.length=0}u(r,"init");function o(f,d,p,g,m,v){let y=n[e];return y===void 0?(y={id:f.id,object:f,geometry:d,material:p,groupOrder:g,renderOrder:f.renderOrder,z:m,group:v},n[e]=y):(y.id=f.id,y.object=f,y.geometry=d,y.material=p,y.groupOrder=g,y.renderOrder=f.renderOrder,y.z=m,y.group=v),e++,y}u(o,"getNextRenderItem");function a(f,d,p,g,m,v){const y=o(f,d,p,g,m,v);p.transmission>0?i.push(y):p.transparent===!0?s.push(y):t.push(y)}u(a,"push");function l(f,d,p,g,m,v){const y=o(f,d,p,g,m,v);p.transmission>0?i.unshift(y):p.transparent===!0?s.unshift(y):t.unshift(y)}u(l,"unshift");function c(f,d){t.length>1&&t.sort(f||z$),i.length>1&&i.sort(d||c2),s.length>1&&s.sort(d||c2)}u(c,"sort");function h(){for(let f=e,d=n.length;f<d;f++){const p=n[f];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return u(h,"finish"),{opaque:t,transmissive:i,transparent:s,init:r,push:a,unshift:l,finish:h,sort:c}}u(u2,"WebGLRenderList");function B$(){let n=new WeakMap;function e(i,s){const r=n.get(i);let o;return r===void 0?(o=new u2,n.set(i,[o])):s>=r.length?(o=new u2,r.push(o)):o=r[s],o}u(e,"get");function t(){n=new WeakMap}return u(t,"dispose"),{get:e,dispose:t}}u(B$,"WebGLRenderLists");function U$(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new T,color:new Te};break;case"SpotLight":t={position:new T,direction:new T,color:new Te,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new T,color:new Te,distance:0,decay:0};break;case"HemisphereLight":t={direction:new T,skyColor:new Te,groundColor:new Te};break;case"RectAreaLight":t={color:new Te,position:new T,halfWidth:new T,halfHeight:new T};break}return n[e.id]=t,t}}}u(U$,"UniformsCache");function $$(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ke};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ke};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ke,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}u($$,"ShadowUniformsCache");let V$=0;function G$(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}u(G$,"shadowCastingAndTexturingLightsFirst");function H$(n,e){const t=new U$,i=$$(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)s.probe.push(new T);const r=new T,o=new ve,a=new ve;function l(h,f){let d=0,p=0,g=0;for(let k=0;k<9;k++)s.probe[k].set(0,0,0);let m=0,v=0,y=0,b=0,_=0,x=0,w=0,M=0,C=0,A=0;h.sort(G$);const P=f!==!0?Math.PI:1;for(let k=0,O=h.length;k<O;k++){const N=h[k],E=N.color,B=N.intensity,W=N.distance,Z=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)d+=E.r*B*P,p+=E.g*B*P,g+=E.b*B*P;else if(N.isLightProbe)for(let ne=0;ne<9;ne++)s.probe[ne].addScaledVector(N.sh.coefficients[ne],B);else if(N.isDirectionalLight){const ne=t.get(N);if(ne.color.copy(N.color).multiplyScalar(N.intensity*P),N.castShadow){const j=N.shadow,ie=i.get(N);ie.shadowBias=j.bias,ie.shadowNormalBias=j.normalBias,ie.shadowRadius=j.radius,ie.shadowMapSize=j.mapSize,s.directionalShadow[m]=ie,s.directionalShadowMap[m]=Z,s.directionalShadowMatrix[m]=N.shadow.matrix,x++}s.directional[m]=ne,m++}else if(N.isSpotLight){const ne=t.get(N);ne.position.setFromMatrixPosition(N.matrixWorld),ne.color.copy(E).multiplyScalar(B*P),ne.distance=W,ne.coneCos=Math.cos(N.angle),ne.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),ne.decay=N.decay,s.spot[y]=ne;const j=N.shadow;if(N.map&&(s.spotLightMap[C]=N.map,C++,j.updateMatrices(N),N.castShadow&&A++),s.spotLightMatrix[y]=j.matrix,N.castShadow){const ie=i.get(N);ie.shadowBias=j.bias,ie.shadowNormalBias=j.normalBias,ie.shadowRadius=j.radius,ie.shadowMapSize=j.mapSize,s.spotShadow[y]=ie,s.spotShadowMap[y]=Z,M++}y++}else if(N.isRectAreaLight){const ne=t.get(N);ne.color.copy(E).multiplyScalar(B),ne.halfWidth.set(N.width*.5,0,0),ne.halfHeight.set(0,N.height*.5,0),s.rectArea[b]=ne,b++}else if(N.isPointLight){const ne=t.get(N);if(ne.color.copy(N.color).multiplyScalar(N.intensity*P),ne.distance=N.distance,ne.decay=N.decay,N.castShadow){const j=N.shadow,ie=i.get(N);ie.shadowBias=j.bias,ie.shadowNormalBias=j.normalBias,ie.shadowRadius=j.radius,ie.shadowMapSize=j.mapSize,ie.shadowCameraNear=j.camera.near,ie.shadowCameraFar=j.camera.far,s.pointShadow[v]=ie,s.pointShadowMap[v]=Z,s.pointShadowMatrix[v]=N.shadow.matrix,w++}s.point[v]=ne,v++}else if(N.isHemisphereLight){const ne=t.get(N);ne.skyColor.copy(N.color).multiplyScalar(B*P),ne.groundColor.copy(N.groundColor).multiplyScalar(B*P),s.hemi[_]=ne,_++}}b>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Oe.LTC_FLOAT_1,s.rectAreaLTC2=Oe.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Oe.LTC_HALF_1,s.rectAreaLTC2=Oe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=d,s.ambient[1]=p,s.ambient[2]=g;const D=s.hash;(D.directionalLength!==m||D.pointLength!==v||D.spotLength!==y||D.rectAreaLength!==b||D.hemiLength!==_||D.numDirectionalShadows!==x||D.numPointShadows!==w||D.numSpotShadows!==M||D.numSpotMaps!==C)&&(s.directional.length=m,s.spot.length=y,s.rectArea.length=b,s.point.length=v,s.hemi.length=_,s.directionalShadow.length=x,s.directionalShadowMap.length=x,s.pointShadow.length=w,s.pointShadowMap.length=w,s.spotShadow.length=M,s.spotShadowMap.length=M,s.directionalShadowMatrix.length=x,s.pointShadowMatrix.length=w,s.spotLightMatrix.length=M+C-A,s.spotLightMap.length=C,s.numSpotLightShadowsWithMaps=A,D.directionalLength=m,D.pointLength=v,D.spotLength=y,D.rectAreaLength=b,D.hemiLength=_,D.numDirectionalShadows=x,D.numPointShadows=w,D.numSpotShadows=M,D.numSpotMaps=C,s.version=V$++)}u(l,"setup");function c(h,f){let d=0,p=0,g=0,m=0,v=0;const y=f.matrixWorldInverse;for(let b=0,_=h.length;b<_;b++){const x=h[b];if(x.isDirectionalLight){const w=s.directional[d];w.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),d++}else if(x.isSpotLight){const w=s.spot[g];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),w.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),g++}else if(x.isRectAreaLight){const w=s.rectArea[m];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),a.identity(),o.copy(x.matrixWorld),o.premultiply(y),a.extractRotation(o),w.halfWidth.set(x.width*.5,0,0),w.halfHeight.set(0,x.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),m++}else if(x.isPointLight){const w=s.point[p];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),p++}else if(x.isHemisphereLight){const w=s.hemi[v];w.direction.setFromMatrixPosition(x.matrixWorld),w.direction.transformDirection(y),v++}}}return u(c,"setupView"),{setup:l,setupView:c,state:s}}u(H$,"WebGLLights");function h2(n,e){const t=new H$(n,e),i=[],s=[];function r(){i.length=0,s.length=0}u(r,"init");function o(f){i.push(f)}u(o,"pushLight");function a(f){s.push(f)}u(a,"pushShadow");function l(f){t.setup(i,f)}u(l,"setupLights");function c(f){t.setupView(i,f)}return u(c,"setupLightsView"),{init:r,state:{lightsArray:i,shadowsArray:s,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}u(h2,"WebGLRenderState");function W$(n,e){let t=new WeakMap;function i(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new h2(n,e),t.set(r,[l])):o>=a.length?(l=new h2(n,e),a.push(l)):l=a[o],l}u(i,"get");function s(){t=new WeakMap}return u(s,"dispose"),{get:i,dispose:s}}u(W$,"WebGLRenderStates");class wb extends Zi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=nz,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}u(wb,"MeshDepthMaterial");class MP extends Zi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new T,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}u(MP,"MeshDistanceMaterial");const j$=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,X$=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Y$(n,e,t){let i=new Hd;const s=new ke,r=new ke,o=new Dt,a=new wb({depthPacking:aP}),l=new MP,c={},h=t.maxTextureSize,f={0:Ws,1:Ul,2:Ts},d=new Ti({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ke},radius:{value:4}},vertexShader:j$,fragmentShader:X$}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const g=new it;g.setAttribute("position",new mn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new We(g,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=eP,this.render=function(x,w,M){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||x.length===0)return;const C=n.getRenderTarget(),A=n.getActiveCubeFace(),P=n.getActiveMipmapLevel(),D=n.state;D.setBlending(Br),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);for(let k=0,O=x.length;k<O;k++){const N=x[k],E=N.shadow;if(E===void 0){console.warn("THREE.WebGLShadowMap:",N,"has no shadow.");continue}if(E.autoUpdate===!1&&E.needsUpdate===!1)continue;s.copy(E.mapSize);const B=E.getFrameExtents();if(s.multiply(B),r.copy(E.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/B.x),s.x=r.x*B.x,E.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/B.y),s.y=r.y*B.y,E.mapSize.y=r.y)),E.map===null){const Z=this.type!==Ff?{minFilter:zn,magFilter:zn}:{};E.map=new yi(s.x,s.y,Z),E.map.texture.name=N.name+".shadowMap",E.camera.updateProjectionMatrix()}n.setRenderTarget(E.map),n.clear();const W=E.getViewportCount();for(let Z=0;Z<W;Z++){const ne=E.getViewport(Z);o.set(r.x*ne.x,r.y*ne.y,r.x*ne.z,r.y*ne.w),D.viewport(o),E.updateMatrices(N,Z),i=E.getFrustum(),_(w,M,E.camera,N,this.type)}E.isPointLightShadow!==!0&&this.type===Ff&&y(E,M),E.needsUpdate=!1}v.needsUpdate=!1,n.setRenderTarget(C,A,P)};function y(x,w){const M=e.update(m);d.defines.VSM_SAMPLES!==x.blurSamples&&(d.defines.VSM_SAMPLES=x.blurSamples,p.defines.VSM_SAMPLES=x.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),x.mapPass===null&&(x.mapPass=new yi(s.x,s.y)),d.uniforms.shadow_pass.value=x.map.texture,d.uniforms.resolution.value=x.mapSize,d.uniforms.radius.value=x.radius,n.setRenderTarget(x.mapPass),n.clear(),n.renderBufferDirect(w,null,M,d,m,null),p.uniforms.shadow_pass.value=x.mapPass.texture,p.uniforms.resolution.value=x.mapSize,p.uniforms.radius.value=x.radius,n.setRenderTarget(x.map),n.clear(),n.renderBufferDirect(w,null,M,p,m,null)}u(y,"VSMPass");function b(x,w,M,C,A,P){let D=null;const k=M.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(k!==void 0?D=k:D=M.isPointLight===!0?l:a,n.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0){const O=D.uuid,N=w.uuid;let E=c[O];E===void 0&&(E={},c[O]=E);let B=E[N];B===void 0&&(B=D.clone(),E[N]=B),D=B}return D.visible=w.visible,D.wireframe=w.wireframe,P===Ff?D.side=w.shadowSide!==null?w.shadowSide:w.side:D.side=w.shadowSide!==null?w.shadowSide:f[w.side],D.alphaMap=w.alphaMap,D.alphaTest=w.alphaTest,D.clipShadows=w.clipShadows,D.clippingPlanes=w.clippingPlanes,D.clipIntersection=w.clipIntersection,D.displacementMap=w.displacementMap,D.displacementScale=w.displacementScale,D.displacementBias=w.displacementBias,D.wireframeLinewidth=w.wireframeLinewidth,D.linewidth=w.linewidth,M.isPointLight===!0&&D.isMeshDistanceMaterial===!0&&(D.referencePosition.setFromMatrixPosition(M.matrixWorld),D.nearDistance=C,D.farDistance=A),D}u(b,"getDepthMaterial");function _(x,w,M,C,A){if(x.visible===!1)return;if(x.layers.test(w.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&A===Ff)&&(!x.frustumCulled||i.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,x.matrixWorld);const k=e.update(x),O=x.material;if(Array.isArray(O)){const N=k.groups;for(let E=0,B=N.length;E<B;E++){const W=N[E],Z=O[W.materialIndex];if(Z&&Z.visible){const ne=b(x,Z,C,M.near,M.far,A);n.renderBufferDirect(M,null,k,ne,x,W)}}}else if(O.visible){const N=b(x,O,C,M.near,M.far,A);n.renderBufferDirect(M,null,k,N,x,null)}}const D=x.children;for(let k=0,O=D.length;k<O;k++)_(D[k],w,M,C,A)}u(_,"renderObject")}u(Y$,"WebGLShadowMap");function q$(n,e,t){const i=t.isWebGL2;function s(){let oe=!1;const _e=new Dt;let Pe=null;const Ue=new Dt(0,0,0,0);return{setMask:function(Xe){Pe!==Xe&&!oe&&(n.colorMask(Xe,Xe,Xe,Xe),Pe=Xe)},setLocked:function(Xe){oe=Xe},setClear:function(Xe,Ut,ai,xi,Ya){Ya===!0&&(Xe*=xi,Ut*=xi,ai*=xi),_e.set(Xe,Ut,ai,xi),Ue.equals(_e)===!1&&(n.clearColor(Xe,Ut,ai,xi),Ue.copy(_e))},reset:function(){oe=!1,Pe=null,Ue.set(-1,0,0,0)}}}u(s,"ColorBuffer");function r(){let oe=!1,_e=null,Pe=null,Ue=null;return{setTest:function(Xe){Xe?ge(2929):he(2929)},setMask:function(Xe){_e!==Xe&&!oe&&(n.depthMask(Xe),_e=Xe)},setFunc:function(Xe){if(Pe!==Xe){switch(Xe){case S5:n.depthFunc(512);break;case C5:n.depthFunc(519);break;case E5:n.depthFunc(513);break;case l_:n.depthFunc(515);break;case T5:n.depthFunc(514);break;case P5:n.depthFunc(518);break;case R5:n.depthFunc(516);break;case I5:n.depthFunc(517);break;default:n.depthFunc(515)}Pe=Xe}},setLocked:function(Xe){oe=Xe},setClear:function(Xe){Ue!==Xe&&(n.clearDepth(Xe),Ue=Xe)},reset:function(){oe=!1,_e=null,Pe=null,Ue=null}}}u(r,"DepthBuffer");function o(){let oe=!1,_e=null,Pe=null,Ue=null,Xe=null,Ut=null,ai=null,xi=null,Ya=null;return{setTest:function(un){oe||(un?ge(2960):he(2960))},setMask:function(un){_e!==un&&!oe&&(n.stencilMask(un),_e=un)},setFunc:function(un,Wr,Os){(Pe!==un||Ue!==Wr||Xe!==Os)&&(n.stencilFunc(un,Wr,Os),Pe=un,Ue=Wr,Xe=Os)},setOp:function(un,Wr,Os){(Ut!==un||ai!==Wr||xi!==Os)&&(n.stencilOp(un,Wr,Os),Ut=un,ai=Wr,xi=Os)},setLocked:function(un){oe=un},setClear:function(un){Ya!==un&&(n.clearStencil(un),Ya=un)},reset:function(){oe=!1,_e=null,Pe=null,Ue=null,Xe=null,Ut=null,ai=null,xi=null,Ya=null}}}u(o,"StencilBuffer");const a=new s,l=new r,c=new o,h=new WeakMap,f=new WeakMap;let d={},p={},g=new WeakMap,m=[],v=null,y=!1,b=null,_=null,x=null,w=null,M=null,C=null,A=null,P=!1,D=null,k=null,O=null,N=null,E=null;const B=n.getParameter(35661);let W=!1,Z=0;const ne=n.getParameter(7938);ne.indexOf("WebGL")!==-1?(Z=parseFloat(/^WebGL (\d)/.exec(ne)[1]),W=Z>=1):ne.indexOf("OpenGL ES")!==-1&&(Z=parseFloat(/^OpenGL ES (\d)/.exec(ne)[1]),W=Z>=2);let j=null,ie={};const K=n.getParameter(3088),$=n.getParameter(2978),le=new Dt().fromArray(K),ae=new Dt().fromArray($);function J(oe,_e,Pe){const Ue=new Uint8Array(4),Xe=n.createTexture();n.bindTexture(oe,Xe),n.texParameteri(oe,10241,9728),n.texParameteri(oe,10240,9728);for(let Ut=0;Ut<Pe;Ut++)n.texImage2D(_e+Ut,0,6408,1,1,0,6408,5121,Ue);return Xe}u(J,"createTexture");const te={};te[3553]=J(3553,3553,1),te[34067]=J(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),ge(2929),l.setFunc(l_),Q(!1),U(sM),ge(2884),R(Br);function ge(oe){d[oe]!==!0&&(n.enable(oe),d[oe]=!0)}u(ge,"enable");function he(oe){d[oe]!==!1&&(n.disable(oe),d[oe]=!1)}u(he,"disable");function we(oe,_e){return p[oe]!==_e?(n.bindFramebuffer(oe,_e),p[oe]=_e,i&&(oe===36009&&(p[36160]=_e),oe===36160&&(p[36009]=_e)),!0):!1}u(we,"bindFramebuffer");function xe(oe,_e){let Pe=m,Ue=!1;if(oe)if(Pe=g.get(_e),Pe===void 0&&(Pe=[],g.set(_e,Pe)),oe.isWebGLMultipleRenderTargets){const Xe=oe.texture;if(Pe.length!==Xe.length||Pe[0]!==36064){for(let Ut=0,ai=Xe.length;Ut<ai;Ut++)Pe[Ut]=36064+Ut;Pe.length=Xe.length,Ue=!0}}else Pe[0]!==36064&&(Pe[0]=36064,Ue=!0);else Pe[0]!==1029&&(Pe[0]=1029,Ue=!0);Ue&&(t.isWebGL2?n.drawBuffers(Pe):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Pe))}u(xe,"drawBuffers");function Se(oe){return v!==oe?(n.useProgram(oe),v=oe,!0):!1}u(Se,"useProgram");const V={[Jc]:32774,[p5]:32778,[m5]:32779};if(i)V[aM]=32775,V[lM]=32776;else{const oe=e.get("EXT_blend_minmax");oe!==null&&(V[aM]=oe.MIN_EXT,V[lM]=oe.MAX_EXT)}const Y={[g5]:0,[v5]:1,[y5]:768,[nP]:770,[M5]:776,[x5]:774,[b5]:772,[_5]:769,[iP]:771,[A5]:775,[w5]:773};function R(oe,_e,Pe,Ue,Xe,Ut,ai,xi){if(oe===Br){y===!0&&(he(3042),y=!1);return}if(y===!1&&(ge(3042),y=!0),oe!==d5){if(oe!==b||xi!==P){if((_!==Jc||M!==Jc)&&(n.blendEquation(32774),_=Jc,M=Jc),xi)switch(oe){case yu:n.blendFuncSeparate(1,771,1,771);break;case a_:n.blendFunc(1,1);break;case rM:n.blendFuncSeparate(0,769,0,1);break;case oM:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}else switch(oe){case yu:n.blendFuncSeparate(770,771,1,771);break;case a_:n.blendFunc(770,1);break;case rM:n.blendFuncSeparate(0,769,0,1);break;case oM:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}x=null,w=null,C=null,A=null,b=oe,P=xi}return}Xe=Xe||_e,Ut=Ut||Pe,ai=ai||Ue,(_e!==_||Xe!==M)&&(n.blendEquationSeparate(V[_e],V[Xe]),_=_e,M=Xe),(Pe!==x||Ue!==w||Ut!==C||ai!==A)&&(n.blendFuncSeparate(Y[Pe],Y[Ue],Y[Ut],Y[ai]),x=Pe,w=Ue,C=Ut,A=ai),b=oe,P=null}u(R,"setBlending");function ee(oe,_e){oe.side===Ts?he(2884):ge(2884);let Pe=oe.side===Ws;_e&&(Pe=!Pe),Q(Pe),oe.blending===yu&&oe.transparent===!1?R(Br):R(oe.blending,oe.blendEquation,oe.blendSrc,oe.blendDst,oe.blendEquationAlpha,oe.blendSrcAlpha,oe.blendDstAlpha,oe.premultipliedAlpha),l.setFunc(oe.depthFunc),l.setTest(oe.depthTest),l.setMask(oe.depthWrite),a.setMask(oe.colorWrite);const Ue=oe.stencilWrite;c.setTest(Ue),Ue&&(c.setMask(oe.stencilWriteMask),c.setFunc(oe.stencilFunc,oe.stencilRef,oe.stencilFuncMask),c.setOp(oe.stencilFail,oe.stencilZFail,oe.stencilZPass)),H(oe.polygonOffset,oe.polygonOffsetFactor,oe.polygonOffsetUnits),oe.alphaToCoverage===!0?ge(32926):he(32926)}u(ee,"setMaterial");function Q(oe){D!==oe&&(oe?n.frontFace(2304):n.frontFace(2305),D=oe)}u(Q,"setFlipSided");function U(oe){oe!==h5?(ge(2884),oe!==k&&(oe===sM?n.cullFace(1029):oe===f5?n.cullFace(1028):n.cullFace(1032))):he(2884),k=oe}u(U,"setCullFace");function F(oe){oe!==O&&(W&&n.lineWidth(oe),O=oe)}u(F,"setLineWidth");function H(oe,_e,Pe){oe?(ge(32823),(N!==_e||E!==Pe)&&(n.polygonOffset(_e,Pe),N=_e,E=Pe)):he(32823)}u(H,"setPolygonOffset");function re(oe){oe?ge(3089):he(3089)}u(re,"setScissorTest");function z(oe){oe===void 0&&(oe=33984+B-1),j!==oe&&(n.activeTexture(oe),j=oe)}u(z,"activeTexture");function I(oe,_e,Pe){Pe===void 0&&(j===null?Pe=33984+B-1:Pe=j);let Ue=ie[Pe];Ue===void 0&&(Ue={type:void 0,texture:void 0},ie[Pe]=Ue),(Ue.type!==oe||Ue.texture!==_e)&&(j!==Pe&&(n.activeTexture(Pe),j=Pe),n.bindTexture(oe,_e||te[oe]),Ue.type=oe,Ue.texture=_e)}u(I,"bindTexture");function L(){const oe=ie[j];oe!==void 0&&oe.type!==void 0&&(n.bindTexture(oe.type,null),oe.type=void 0,oe.texture=void 0)}u(L,"unbindTexture");function G(){try{n.compressedTexImage2D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(G,"compressedTexImage2D");function X(){try{n.compressedTexImage3D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(X,"compressedTexImage3D");function se(){try{n.texSubImage2D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(se,"texSubImage2D");function de(){try{n.texSubImage3D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(de,"texSubImage3D");function me(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(me,"compressedTexSubImage2D");function ye(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(ye,"compressedTexSubImage3D");function pe(){try{n.texStorage2D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(pe,"texStorage2D");function Fe(){try{n.texStorage3D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(Fe,"texStorage3D");function qe(){try{n.texImage2D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(qe,"texImage2D");function Re(){try{n.texImage3D.apply(n,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}u(Re,"texImage3D");function Ke(oe){le.equals(oe)===!1&&(n.scissor(oe.x,oe.y,oe.z,oe.w),le.copy(oe))}u(Ke,"scissor");function $e(oe){ae.equals(oe)===!1&&(n.viewport(oe.x,oe.y,oe.z,oe.w),ae.copy(oe))}u($e,"viewport");function Je(oe,_e){let Pe=f.get(_e);Pe===void 0&&(Pe=new WeakMap,f.set(_e,Pe));let Ue=Pe.get(oe);Ue===void 0&&(Ue=n.getUniformBlockIndex(_e,oe.name),Pe.set(oe,Ue))}u(Je,"updateUBOMapping");function Bt(oe,_e){const Ue=f.get(_e).get(oe);h.get(oe)!==Ue&&(n.uniformBlockBinding(_e,Ue,oe.__bindingPointIndex),h.set(oe,Ue))}u(Bt,"uniformBlockBinding");function Hn(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),d={},j=null,ie={},p={},g=new WeakMap,m=[],v=null,y=!1,b=null,_=null,x=null,w=null,M=null,C=null,A=null,P=!1,D=null,k=null,O=null,N=null,E=null,le.set(0,0,n.canvas.width,n.canvas.height),ae.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return u(Hn,"reset"),{buffers:{color:a,depth:l,stencil:c},enable:ge,disable:he,bindFramebuffer:we,drawBuffers:xe,useProgram:Se,setBlending:R,setMaterial:ee,setFlipSided:Q,setCullFace:U,setLineWidth:F,setPolygonOffset:H,setScissorTest:re,activeTexture:z,bindTexture:I,unbindTexture:L,compressedTexImage2D:G,compressedTexImage3D:X,texImage2D:qe,texImage3D:Re,updateUBOMapping:Je,uniformBlockBinding:Bt,texStorage2D:pe,texStorage3D:Fe,texSubImage2D:se,texSubImage3D:de,compressedTexSubImage2D:me,compressedTexSubImage3D:ye,scissor:Ke,viewport:$e,reset:Hn}}u(q$,"WebGLState");function Z$(n,e,t,i,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,h=s.maxTextureSize,f=s.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(typeof navigator=="undefined"?"":navigator.userAgent),g=new WeakMap;let m;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(I,L){return y?new OffscreenCanvas(I,L):_d("canvas")}u(b,"createCanvas");function _(I,L,G,X){let se=1;if((I.width>X||I.height>X)&&(se=X/Math.max(I.width,I.height)),se<1||L===!0)if(typeof HTMLImageElement!="undefined"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&I instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&I instanceof ImageBitmap){const de=L?Vg:Math.floor,me=de(se*I.width),ye=de(se*I.height);m===void 0&&(m=b(me,ye));const pe=G?b(me,ye):m;return pe.width=me,pe.height=ye,pe.getContext("2d").drawImage(I,0,0,me,ye),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+I.width+"x"+I.height+") to ("+me+"x"+ye+")."),pe}else return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+I.width+"x"+I.height+")."),I;return I}u(_,"resizeImage");function x(I){return f_(I.width)&&f_(I.height)}u(x,"isPowerOfTwo$1");function w(I){return a?!1:I.wrapS!==Gi||I.wrapT!==Gi||I.minFilter!==zn&&I.minFilter!==Vi}u(w,"textureNeedsPowerOfTwo");function M(I,L){return I.generateMipmaps&&L&&I.minFilter!==zn&&I.minFilter!==Vi}u(M,"textureNeedsGenerateMipmaps");function C(I){n.generateMipmap(I)}u(C,"generateMipmap");function A(I,L,G,X,se=!1){if(a===!1)return L;if(I!==null){if(n[I]!==void 0)return n[I];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+I+"'")}let de=L;return L===6403&&(G===5126&&(de=33326),G===5131&&(de=33325),G===5121&&(de=33321)),L===33319&&(G===5126&&(de=33328),G===5131&&(de=33327),G===5121&&(de=33323)),L===6408&&(G===5126&&(de=34836),G===5131&&(de=34842),G===5121&&(de=X===It&&se===!1?35907:32856),G===32819&&(de=32854),G===32820&&(de=32855)),(de===33325||de===33326||de===33327||de===33328||de===34842||de===34836)&&e.get("EXT_color_buffer_float"),de}u(A,"getInternalFormat");function P(I,L,G){return M(I,G)===!0||I.isFramebufferTexture&&I.minFilter!==zn&&I.minFilter!==Vi?Math.log2(Math.max(L.width,L.height))+1:I.mipmaps!==void 0&&I.mipmaps.length>0?I.mipmaps.length:I.isCompressedTexture&&Array.isArray(I.image)?L.mipmaps.length:1}u(P,"getMipLevels");function D(I){return I===zn||I===Ug||I===$g?9728:9729}u(D,"filterFallback");function k(I){const L=I.target;L.removeEventListener("dispose",k),N(L),L.isVideoTexture&&g.delete(L)}u(k,"onTextureDispose");function O(I){const L=I.target;L.removeEventListener("dispose",O),B(L)}u(O,"onRenderTargetDispose");function N(I){const L=i.get(I);if(L.__webglInit===void 0)return;const G=I.source,X=v.get(G);if(X){const se=X[L.__cacheKey];se.usedTimes--,se.usedTimes===0&&E(I),Object.keys(X).length===0&&v.delete(G)}i.remove(I)}u(N,"deallocateTexture");function E(I){const L=i.get(I);n.deleteTexture(L.__webglTexture);const G=I.source,X=v.get(G);delete X[L.__cacheKey],o.memory.textures--}u(E,"deleteTexture");function B(I){const L=I.texture,G=i.get(I),X=i.get(L);if(X.__webglTexture!==void 0&&(n.deleteTexture(X.__webglTexture),o.memory.textures--),I.depthTexture&&I.depthTexture.dispose(),I.isWebGLCubeRenderTarget)for(let se=0;se<6;se++)n.deleteFramebuffer(G.__webglFramebuffer[se]),G.__webglDepthbuffer&&n.deleteRenderbuffer(G.__webglDepthbuffer[se]);else{if(n.deleteFramebuffer(G.__webglFramebuffer),G.__webglDepthbuffer&&n.deleteRenderbuffer(G.__webglDepthbuffer),G.__webglMultisampledFramebuffer&&n.deleteFramebuffer(G.__webglMultisampledFramebuffer),G.__webglColorRenderbuffer)for(let se=0;se<G.__webglColorRenderbuffer.length;se++)G.__webglColorRenderbuffer[se]&&n.deleteRenderbuffer(G.__webglColorRenderbuffer[se]);G.__webglDepthRenderbuffer&&n.deleteRenderbuffer(G.__webglDepthRenderbuffer)}if(I.isWebGLMultipleRenderTargets)for(let se=0,de=L.length;se<de;se++){const me=i.get(L[se]);me.__webglTexture&&(n.deleteTexture(me.__webglTexture),o.memory.textures--),i.remove(L[se])}i.remove(L),i.remove(I)}u(B,"deallocateRenderTarget");let W=0;function Z(){W=0}u(Z,"resetTextureUnits");function ne(){const I=W;return I>=l&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+l),W+=1,I}u(ne,"allocateTextureUnit");function j(I){const L=[];return L.push(I.wrapS),L.push(I.wrapT),L.push(I.wrapR||0),L.push(I.magFilter),L.push(I.minFilter),L.push(I.anisotropy),L.push(I.internalFormat),L.push(I.format),L.push(I.type),L.push(I.generateMipmaps),L.push(I.premultiplyAlpha),L.push(I.flipY),L.push(I.unpackAlignment),L.push(I.encoding),L.join()}u(j,"getTextureCacheKey");function ie(I,L){const G=i.get(I);if(I.isVideoTexture&&re(I),I.isRenderTargetTexture===!1&&I.version>0&&G.__version!==I.version){const X=I.image;if(X===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(X.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{he(G,I,L);return}}t.bindTexture(3553,G.__webglTexture,33984+L)}u(ie,"setTexture2D");function K(I,L){const G=i.get(I);if(I.version>0&&G.__version!==I.version){he(G,I,L);return}t.bindTexture(35866,G.__webglTexture,33984+L)}u(K,"setTexture2DArray");function $(I,L){const G=i.get(I);if(I.version>0&&G.__version!==I.version){he(G,I,L);return}t.bindTexture(32879,G.__webglTexture,33984+L)}u($,"setTexture3D");function le(I,L){const G=i.get(I);if(I.version>0&&G.__version!==I.version){we(G,I,L);return}t.bindTexture(34067,G.__webglTexture,33984+L)}u(le,"setTextureCube");const ae={[Do]:10497,[Gi]:33071,[vd]:33648},J={[zn]:9728,[Ug]:9984,[$g]:9986,[Vi]:9729,[pb]:9985,[nc]:9987};function te(I,L,G){if(G?(n.texParameteri(I,10242,ae[L.wrapS]),n.texParameteri(I,10243,ae[L.wrapT]),(I===32879||I===35866)&&n.texParameteri(I,32882,ae[L.wrapR]),n.texParameteri(I,10240,J[L.magFilter]),n.texParameteri(I,10241,J[L.minFilter])):(n.texParameteri(I,10242,33071),n.texParameteri(I,10243,33071),(I===32879||I===35866)&&n.texParameteri(I,32882,33071),(L.wrapS!==Gi||L.wrapT!==Gi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(I,10240,D(L.magFilter)),n.texParameteri(I,10241,D(L.minFilter)),L.minFilter!==zn&&L.minFilter!==Vi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const X=e.get("EXT_texture_filter_anisotropic");if(L.type===Ma&&e.has("OES_texture_float_linear")===!1||a===!1&&L.type===Pu&&e.has("OES_texture_half_float_linear")===!1)return;(L.anisotropy>1||i.get(L).__currentAnisotropy)&&(n.texParameterf(I,X.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(L.anisotropy,s.getMaxAnisotropy())),i.get(L).__currentAnisotropy=L.anisotropy)}}u(te,"setTextureParameters");function ge(I,L){let G=!1;I.__webglInit===void 0&&(I.__webglInit=!0,L.addEventListener("dispose",k));const X=L.source;let se=v.get(X);se===void 0&&(se={},v.set(X,se));const de=j(L);if(de!==I.__cacheKey){se[de]===void 0&&(se[de]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,G=!0),se[de].usedTimes++;const me=se[I.__cacheKey];me!==void 0&&(se[I.__cacheKey].usedTimes--,me.usedTimes===0&&E(L)),I.__cacheKey=de,I.__webglTexture=se[de].texture}return G}u(ge,"initTexture");function he(I,L,G){let X=3553;(L.isDataArrayTexture||L.isCompressedArrayTexture)&&(X=35866),L.isData3DTexture&&(X=32879);const se=ge(I,L),de=L.source;t.bindTexture(X,I.__webglTexture,33984+G);const me=i.get(de);if(de.version!==me.__version||se===!0){t.activeTexture(33984+G),n.pixelStorei(37440,L.flipY),n.pixelStorei(37441,L.premultiplyAlpha),n.pixelStorei(3317,L.unpackAlignment),n.pixelStorei(37443,0);const ye=w(L)&&x(L.image)===!1;let pe=_(L.image,ye,!1,h);pe=z(L,pe);const Fe=x(pe)||a,qe=r.convert(L.format,L.encoding);let Re=r.convert(L.type),Ke=A(L.internalFormat,qe,Re,L.encoding,L.isVideoTexture);te(X,L,Fe);let $e;const Je=L.mipmaps,Bt=a&&L.isVideoTexture!==!0,Hn=me.__version===void 0||se===!0,oe=P(L,pe,Fe);if(L.isDepthTexture)Ke=6402,a?L.type===Ma?Ke=36012:L.type===Il?Ke=33190:L.type===_u?Ke=35056:Ke=33189:L.type===Ma&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),L.format===Fl&&Ke===6402&&L.type!==rP&&L.type!==Il&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),L.type=Il,Re=r.convert(L.type)),L.format===Ru&&Ke===6402&&(Ke=34041,L.type!==_u&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),L.type=_u,Re=r.convert(L.type))),Hn&&(Bt?t.texStorage2D(3553,1,Ke,pe.width,pe.height):t.texImage2D(3553,0,Ke,pe.width,pe.height,0,qe,Re,null));else if(L.isDataTexture)if(Je.length>0&&Fe){Bt&&Hn&&t.texStorage2D(3553,oe,Ke,Je[0].width,Je[0].height);for(let _e=0,Pe=Je.length;_e<Pe;_e++)$e=Je[_e],Bt?t.texSubImage2D(3553,_e,0,0,$e.width,$e.height,qe,Re,$e.data):t.texImage2D(3553,_e,Ke,$e.width,$e.height,0,qe,Re,$e.data);L.generateMipmaps=!1}else Bt?(Hn&&t.texStorage2D(3553,oe,Ke,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,pe.width,pe.height,qe,Re,pe.data)):t.texImage2D(3553,0,Ke,pe.width,pe.height,0,qe,Re,pe.data);else if(L.isCompressedTexture)if(L.isCompressedArrayTexture){Bt&&Hn&&t.texStorage3D(35866,oe,Ke,Je[0].width,Je[0].height,pe.depth);for(let _e=0,Pe=Je.length;_e<Pe;_e++)$e=Je[_e],L.format!==Es?qe!==null?Bt?t.compressedTexSubImage3D(35866,_e,0,0,0,$e.width,$e.height,pe.depth,qe,$e.data,0,0):t.compressedTexImage3D(35866,_e,Ke,$e.width,$e.height,pe.depth,0,$e.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Bt?t.texSubImage3D(35866,_e,0,0,0,$e.width,$e.height,pe.depth,qe,Re,$e.data):t.texImage3D(35866,_e,Ke,$e.width,$e.height,pe.depth,0,qe,Re,$e.data)}else{Bt&&Hn&&t.texStorage2D(3553,oe,Ke,Je[0].width,Je[0].height);for(let _e=0,Pe=Je.length;_e<Pe;_e++)$e=Je[_e],L.format!==Es?qe!==null?Bt?t.compressedTexSubImage2D(3553,_e,0,0,$e.width,$e.height,qe,$e.data):t.compressedTexImage2D(3553,_e,Ke,$e.width,$e.height,0,$e.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Bt?t.texSubImage2D(3553,_e,0,0,$e.width,$e.height,qe,Re,$e.data):t.texImage2D(3553,_e,Ke,$e.width,$e.height,0,qe,Re,$e.data)}else if(L.isDataArrayTexture)Bt?(Hn&&t.texStorage3D(35866,oe,Ke,pe.width,pe.height,pe.depth),t.texSubImage3D(35866,0,0,0,0,pe.width,pe.height,pe.depth,qe,Re,pe.data)):t.texImage3D(35866,0,Ke,pe.width,pe.height,pe.depth,0,qe,Re,pe.data);else if(L.isData3DTexture)Bt?(Hn&&t.texStorage3D(32879,oe,Ke,pe.width,pe.height,pe.depth),t.texSubImage3D(32879,0,0,0,0,pe.width,pe.height,pe.depth,qe,Re,pe.data)):t.texImage3D(32879,0,Ke,pe.width,pe.height,pe.depth,0,qe,Re,pe.data);else if(L.isFramebufferTexture){if(Hn)if(Bt)t.texStorage2D(3553,oe,Ke,pe.width,pe.height);else{let _e=pe.width,Pe=pe.height;for(let Ue=0;Ue<oe;Ue++)t.texImage2D(3553,Ue,Ke,_e,Pe,0,qe,Re,null),_e>>=1,Pe>>=1}}else if(Je.length>0&&Fe){Bt&&Hn&&t.texStorage2D(3553,oe,Ke,Je[0].width,Je[0].height);for(let _e=0,Pe=Je.length;_e<Pe;_e++)$e=Je[_e],Bt?t.texSubImage2D(3553,_e,0,0,qe,Re,$e):t.texImage2D(3553,_e,Ke,qe,Re,$e);L.generateMipmaps=!1}else Bt?(Hn&&t.texStorage2D(3553,oe,Ke,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,qe,Re,pe)):t.texImage2D(3553,0,Ke,qe,Re,pe);M(L,Fe)&&C(X),me.__version=de.version,L.onUpdate&&L.onUpdate(L)}I.__version=L.version}u(he,"uploadTexture");function we(I,L,G){if(L.image.length!==6)return;const X=ge(I,L),se=L.source;t.bindTexture(34067,I.__webglTexture,33984+G);const de=i.get(se);if(se.version!==de.__version||X===!0){t.activeTexture(33984+G),n.pixelStorei(37440,L.flipY),n.pixelStorei(37441,L.premultiplyAlpha),n.pixelStorei(3317,L.unpackAlignment),n.pixelStorei(37443,0);const me=L.isCompressedTexture||L.image[0].isCompressedTexture,ye=L.image[0]&&L.image[0].isDataTexture,pe=[];for(let _e=0;_e<6;_e++)!me&&!ye?pe[_e]=_(L.image[_e],!1,!0,c):pe[_e]=ye?L.image[_e].image:L.image[_e],pe[_e]=z(L,pe[_e]);const Fe=pe[0],qe=x(Fe)||a,Re=r.convert(L.format,L.encoding),Ke=r.convert(L.type),$e=A(L.internalFormat,Re,Ke,L.encoding),Je=a&&L.isVideoTexture!==!0,Bt=de.__version===void 0||X===!0;let Hn=P(L,Fe,qe);te(34067,L,qe);let oe;if(me){Je&&Bt&&t.texStorage2D(34067,Hn,$e,Fe.width,Fe.height);for(let _e=0;_e<6;_e++){oe=pe[_e].mipmaps;for(let Pe=0;Pe<oe.length;Pe++){const Ue=oe[Pe];L.format!==Es?Re!==null?Je?t.compressedTexSubImage2D(34069+_e,Pe,0,0,Ue.width,Ue.height,Re,Ue.data):t.compressedTexImage2D(34069+_e,Pe,$e,Ue.width,Ue.height,0,Ue.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Je?t.texSubImage2D(34069+_e,Pe,0,0,Ue.width,Ue.height,Re,Ke,Ue.data):t.texImage2D(34069+_e,Pe,$e,Ue.width,Ue.height,0,Re,Ke,Ue.data)}}}else{oe=L.mipmaps,Je&&Bt&&(oe.length>0&&Hn++,t.texStorage2D(34067,Hn,$e,pe[0].width,pe[0].height));for(let _e=0;_e<6;_e++)if(ye){Je?t.texSubImage2D(34069+_e,0,0,0,pe[_e].width,pe[_e].height,Re,Ke,pe[_e].data):t.texImage2D(34069+_e,0,$e,pe[_e].width,pe[_e].height,0,Re,Ke,pe[_e].data);for(let Pe=0;Pe<oe.length;Pe++){const Xe=oe[Pe].image[_e].image;Je?t.texSubImage2D(34069+_e,Pe+1,0,0,Xe.width,Xe.height,Re,Ke,Xe.data):t.texImage2D(34069+_e,Pe+1,$e,Xe.width,Xe.height,0,Re,Ke,Xe.data)}}else{Je?t.texSubImage2D(34069+_e,0,0,0,Re,Ke,pe[_e]):t.texImage2D(34069+_e,0,$e,Re,Ke,pe[_e]);for(let Pe=0;Pe<oe.length;Pe++){const Ue=oe[Pe];Je?t.texSubImage2D(34069+_e,Pe+1,0,0,Re,Ke,Ue.image[_e]):t.texImage2D(34069+_e,Pe+1,$e,Re,Ke,Ue.image[_e])}}}M(L,qe)&&C(34067),de.__version=se.version,L.onUpdate&&L.onUpdate(L)}I.__version=L.version}u(we,"uploadCubeTexture");function xe(I,L,G,X,se){const de=r.convert(G.format,G.encoding),me=r.convert(G.type),ye=A(G.internalFormat,de,me,G.encoding);i.get(L).__hasExternalTextures||(se===32879||se===35866?t.texImage3D(se,0,ye,L.width,L.height,L.depth,0,de,me,null):t.texImage2D(se,0,ye,L.width,L.height,0,de,me,null)),t.bindFramebuffer(36160,I),H(L)?d.framebufferTexture2DMultisampleEXT(36160,X,se,i.get(G).__webglTexture,0,F(L)):(se===3553||se>=34069&&se<=34074)&&n.framebufferTexture2D(36160,X,se,i.get(G).__webglTexture,0),t.bindFramebuffer(36160,null)}u(xe,"setupFrameBufferTexture");function Se(I,L,G){if(n.bindRenderbuffer(36161,I),L.depthBuffer&&!L.stencilBuffer){let X=33189;if(G||H(L)){const se=L.depthTexture;se&&se.isDepthTexture&&(se.type===Ma?X=36012:se.type===Il&&(X=33190));const de=F(L);H(L)?d.renderbufferStorageMultisampleEXT(36161,de,X,L.width,L.height):n.renderbufferStorageMultisample(36161,de,X,L.width,L.height)}else n.renderbufferStorage(36161,X,L.width,L.height);n.framebufferRenderbuffer(36160,36096,36161,I)}else if(L.depthBuffer&&L.stencilBuffer){const X=F(L);G&&H(L)===!1?n.renderbufferStorageMultisample(36161,X,35056,L.width,L.height):H(L)?d.renderbufferStorageMultisampleEXT(36161,X,35056,L.width,L.height):n.renderbufferStorage(36161,34041,L.width,L.height),n.framebufferRenderbuffer(36160,33306,36161,I)}else{const X=L.isWebGLMultipleRenderTargets===!0?L.texture:[L.texture];for(let se=0;se<X.length;se++){const de=X[se],me=r.convert(de.format,de.encoding),ye=r.convert(de.type),pe=A(de.internalFormat,me,ye,de.encoding),Fe=F(L);G&&H(L)===!1?n.renderbufferStorageMultisample(36161,Fe,pe,L.width,L.height):H(L)?d.renderbufferStorageMultisampleEXT(36161,Fe,pe,L.width,L.height):n.renderbufferStorage(36161,pe,L.width,L.height)}}n.bindRenderbuffer(36161,null)}u(Se,"setupRenderBufferStorage");function V(I,L){if(L&&L.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,I),!(L.depthTexture&&L.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(L.depthTexture).__webglTexture||L.depthTexture.image.width!==L.width||L.depthTexture.image.height!==L.height)&&(L.depthTexture.image.width=L.width,L.depthTexture.image.height=L.height,L.depthTexture.needsUpdate=!0),ie(L.depthTexture,0);const X=i.get(L.depthTexture).__webglTexture,se=F(L);if(L.depthTexture.format===Fl)H(L)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,X,0,se):n.framebufferTexture2D(36160,36096,3553,X,0);else if(L.depthTexture.format===Ru)H(L)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,X,0,se):n.framebufferTexture2D(36160,33306,3553,X,0);else throw new Error("Unknown depthTexture format")}u(V,"setupDepthTexture");function Y(I){const L=i.get(I),G=I.isWebGLCubeRenderTarget===!0;if(I.depthTexture&&!L.__autoAllocateDepthBuffer){if(G)throw new Error("target.depthTexture not supported in Cube render targets");V(L.__webglFramebuffer,I)}else if(G){L.__webglDepthbuffer=[];for(let X=0;X<6;X++)t.bindFramebuffer(36160,L.__webglFramebuffer[X]),L.__webglDepthbuffer[X]=n.createRenderbuffer(),Se(L.__webglDepthbuffer[X],I,!1)}else t.bindFramebuffer(36160,L.__webglFramebuffer),L.__webglDepthbuffer=n.createRenderbuffer(),Se(L.__webglDepthbuffer,I,!1);t.bindFramebuffer(36160,null)}u(Y,"setupDepthRenderbuffer");function R(I,L,G){const X=i.get(I);L!==void 0&&xe(X.__webglFramebuffer,I,I.texture,36064,3553),G!==void 0&&Y(I)}u(R,"rebindTextures");function ee(I){const L=I.texture,G=i.get(I),X=i.get(L);I.addEventListener("dispose",O),I.isWebGLMultipleRenderTargets!==!0&&(X.__webglTexture===void 0&&(X.__webglTexture=n.createTexture()),X.__version=L.version,o.memory.textures++);const se=I.isWebGLCubeRenderTarget===!0,de=I.isWebGLMultipleRenderTargets===!0,me=x(I)||a;if(se){G.__webglFramebuffer=[];for(let ye=0;ye<6;ye++)G.__webglFramebuffer[ye]=n.createFramebuffer()}else{if(G.__webglFramebuffer=n.createFramebuffer(),de)if(s.drawBuffers){const ye=I.texture;for(let pe=0,Fe=ye.length;pe<Fe;pe++){const qe=i.get(ye[pe]);qe.__webglTexture===void 0&&(qe.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&I.samples>0&&H(I)===!1){const ye=de?L:[L];G.__webglMultisampledFramebuffer=n.createFramebuffer(),G.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,G.__webglMultisampledFramebuffer);for(let pe=0;pe<ye.length;pe++){const Fe=ye[pe];G.__webglColorRenderbuffer[pe]=n.createRenderbuffer(),n.bindRenderbuffer(36161,G.__webglColorRenderbuffer[pe]);const qe=r.convert(Fe.format,Fe.encoding),Re=r.convert(Fe.type),Ke=A(Fe.internalFormat,qe,Re,Fe.encoding,I.isXRRenderTarget===!0),$e=F(I);n.renderbufferStorageMultisample(36161,$e,Ke,I.width,I.height),n.framebufferRenderbuffer(36160,36064+pe,36161,G.__webglColorRenderbuffer[pe])}n.bindRenderbuffer(36161,null),I.depthBuffer&&(G.__webglDepthRenderbuffer=n.createRenderbuffer(),Se(G.__webglDepthRenderbuffer,I,!0)),t.bindFramebuffer(36160,null)}}if(se){t.bindTexture(34067,X.__webglTexture),te(34067,L,me);for(let ye=0;ye<6;ye++)xe(G.__webglFramebuffer[ye],I,L,36064,34069+ye);M(L,me)&&C(34067),t.unbindTexture()}else if(de){const ye=I.texture;for(let pe=0,Fe=ye.length;pe<Fe;pe++){const qe=ye[pe],Re=i.get(qe);t.bindTexture(3553,Re.__webglTexture),te(3553,qe,me),xe(G.__webglFramebuffer,I,qe,36064+pe,3553),M(qe,me)&&C(3553)}t.unbindTexture()}else{let ye=3553;(I.isWebGL3DRenderTarget||I.isWebGLArrayRenderTarget)&&(a?ye=I.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ye,X.__webglTexture),te(ye,L,me),xe(G.__webglFramebuffer,I,L,36064,ye),M(L,me)&&C(ye),t.unbindTexture()}I.depthBuffer&&Y(I)}u(ee,"setupRenderTarget");function Q(I){const L=x(I)||a,G=I.isWebGLMultipleRenderTargets===!0?I.texture:[I.texture];for(let X=0,se=G.length;X<se;X++){const de=G[X];if(M(de,L)){const me=I.isWebGLCubeRenderTarget?34067:3553,ye=i.get(de).__webglTexture;t.bindTexture(me,ye),C(me),t.unbindTexture()}}}u(Q,"updateRenderTargetMipmap");function U(I){if(a&&I.samples>0&&H(I)===!1){const L=I.isWebGLMultipleRenderTargets?I.texture:[I.texture],G=I.width,X=I.height;let se=16384;const de=[],me=I.stencilBuffer?33306:36096,ye=i.get(I),pe=I.isWebGLMultipleRenderTargets===!0;if(pe)for(let Fe=0;Fe<L.length;Fe++)t.bindFramebuffer(36160,ye.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Fe,36161,null),t.bindFramebuffer(36160,ye.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Fe,3553,null,0);t.bindFramebuffer(36008,ye.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,ye.__webglFramebuffer);for(let Fe=0;Fe<L.length;Fe++){de.push(36064+Fe),I.depthBuffer&&de.push(me);const qe=ye.__ignoreDepthValues!==void 0?ye.__ignoreDepthValues:!1;if(qe===!1&&(I.depthBuffer&&(se|=256),I.stencilBuffer&&(se|=1024)),pe&&n.framebufferRenderbuffer(36008,36064,36161,ye.__webglColorRenderbuffer[Fe]),qe===!0&&(n.invalidateFramebuffer(36008,[me]),n.invalidateFramebuffer(36009,[me])),pe){const Re=i.get(L[Fe]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Re,0)}n.blitFramebuffer(0,0,G,X,0,0,G,X,se,9728),p&&n.invalidateFramebuffer(36008,de)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),pe)for(let Fe=0;Fe<L.length;Fe++){t.bindFramebuffer(36160,ye.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Fe,36161,ye.__webglColorRenderbuffer[Fe]);const qe=i.get(L[Fe]).__webglTexture;t.bindFramebuffer(36160,ye.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Fe,3553,qe,0)}t.bindFramebuffer(36009,ye.__webglMultisampledFramebuffer)}}u(U,"updateMultisampleRenderTarget");function F(I){return Math.min(f,I.samples)}u(F,"getRenderTargetSamples");function H(I){const L=i.get(I);return a&&I.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&L.__useRenderToTexture!==!1}u(H,"useMultisampledRTT");function re(I){const L=o.render.frame;g.get(I)!==L&&(g.set(I,L),I.update())}u(re,"updateVideoTexture");function z(I,L){const G=I.encoding,X=I.format,se=I.type;return I.isCompressedTexture===!0||I.isVideoTexture===!0||I.format===h_||G!==Lo&&(G===It?a===!1?e.has("EXT_sRGB")===!0&&X===Es?(I.format=h_,I.minFilter=Vi,I.generateMipmaps=!1):L=gb.sRGBToLinear(L):(X!==Es||se!==$l)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",G)),L}u(z,"verifyColorSpace"),this.allocateTextureUnit=ne,this.resetTextureUnits=Z,this.setTexture2D=ie,this.setTexture2DArray=K,this.setTexture3D=$,this.setTextureCube=le,this.rebindTextures=R,this.setupRenderTarget=ee,this.updateRenderTargetMipmap=Q,this.updateMultisampleRenderTarget=U,this.setupDepthRenderbuffer=Y,this.setupFrameBufferTexture=xe,this.useMultisampledRTT=H}u(Z$,"WebGLTextures");function K$(n,e,t){const i=t.isWebGL2;function s(r,o=null){let a;if(r===$l)return 5121;if(r===V5)return 32819;if(r===G5)return 32820;if(r===B5)return 5120;if(r===U5)return 5122;if(r===rP)return 5123;if(r===$5)return 5124;if(r===Il)return 5125;if(r===Ma)return 5126;if(r===Pu)return i?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===H5)return 6406;if(r===Es)return 6408;if(r===j5)return 6409;if(r===X5)return 6410;if(r===Fl)return 6402;if(r===Ru)return 34041;if(r===Y5)return 6403;if(r===W5)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===h_)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===q5)return 36244;if(r===Z5)return 33319;if(r===K5)return 33320;if(r===Q5)return 36249;if(r===O1||r===k1||r===N1||r===F1)if(o===It)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===O1)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===k1)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===N1)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===F1)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===O1)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===k1)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===N1)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===F1)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===cM||r===uM||r===hM||r===fM)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===cM)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===uM)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===hM)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===fM)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===J5)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===dM||r===pM)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===dM)return o===It?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===pM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===mM||r===gM||r===vM||r===yM||r===_M||r===bM||r===wM||r===xM||r===AM||r===MM||r===SM||r===CM||r===EM||r===TM)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===mM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===gM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===vM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===yM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===_M)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===bM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===wM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===xM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===AM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===MM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===SM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===CM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===EM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===TM)return o===It?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===PM)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===PM)return o===It?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===_u?i?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[r]!==void 0?n[r]:null}return u(s,"convert"),{convert:s}}u(K$,"WebGLUtils");class SP extends di{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}u(SP,"ArrayCamera");class ni extends Pt{constructor(){super(),this.isGroup=!0,this.type="Group"}}u(ni,"Group");const Q$={type:"move"};class bg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ni,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ni,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new T,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new T),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ni,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new T,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new T),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const m of e.hand.values()){const v=t.getJointPose(m,i);if(c.joints[m.jointName]===void 0){const b=new ni;b.matrixAutoUpdate=!1,b.visible=!1,c.joints[m.jointName]=b,c.add(b)}const y=c.joints[m.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}const h=c.joints["index-finger-tip"],f=c.joints["thumb-tip"],d=h.position.distanceTo(f.position),p=.02,g=.005;c.inputState.pinching&&d>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Q$)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}}u(bg,"WebXRController");class CP extends ii{constructor(e,t,i,s,r,o,a,l,c,h){if(h=h!==void 0?h:Fl,h!==Fl&&h!==Ru)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Fl&&(i=Il),i===void 0&&h===Ru&&(i=_u),super(null,s,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:zn,this.minFilter=l!==void 0?l:zn,this.flipY=!1,this.generateMipmaps=!1}}u(CP,"DepthTexture");class EP extends ic{constructor(e,t){super();const i=this;let s=null,r=1,o=null,a="local-floor",l=null,c=null,h=null,f=null,d=null,p=null;const g=t.getContextAttributes();let m=null,v=null;const y=[],b=[],_=new di;_.layers.enable(1),_.viewport=new Dt;const x=new di;x.layers.enable(2),x.viewport=new Dt;const w=[_,x],M=new SP;M.layers.enable(1),M.layers.enable(2);let C=null,A=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let ie=y[j];return ie===void 0&&(ie=new bg,y[j]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(j){let ie=y[j];return ie===void 0&&(ie=new bg,y[j]=ie),ie.getGripSpace()},this.getHand=function(j){let ie=y[j];return ie===void 0&&(ie=new bg,y[j]=ie),ie.getHandSpace()};function P(j){const ie=b.indexOf(j.inputSource);if(ie===-1)return;const K=y[ie];K!==void 0&&K.dispatchEvent({type:j.type,data:j.inputSource})}u(P,"onSessionEvent");function D(){s.removeEventListener("select",P),s.removeEventListener("selectstart",P),s.removeEventListener("selectend",P),s.removeEventListener("squeeze",P),s.removeEventListener("squeezestart",P),s.removeEventListener("squeezeend",P),s.removeEventListener("end",D),s.removeEventListener("inputsourceschange",k);for(let j=0;j<y.length;j++){const ie=b[j];ie!==null&&(b[j]=null,y[j].disconnect(ie))}C=null,A=null,e.setRenderTarget(m),d=null,f=null,h=null,s=null,v=null,ne.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}u(D,"onSessionEnd"),this.setFramebufferScaleFactor=function(j){r=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(j){l=j},this.getBaseLayer=function(){return f!==null?f:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(j){if(s=j,s!==null){if(m=e.getRenderTarget(),s.addEventListener("select",P),s.addEventListener("selectstart",P),s.addEventListener("selectend",P),s.addEventListener("squeeze",P),s.addEventListener("squeezestart",P),s.addEventListener("squeezeend",P),s.addEventListener("end",D),s.addEventListener("inputsourceschange",k),g.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ie={antialias:s.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};d=new XRWebGLLayer(s,t,ie),s.updateRenderState({baseLayer:d}),v=new yi(d.framebufferWidth,d.framebufferHeight,{format:Es,type:$l,encoding:e.outputEncoding,stencilBuffer:g.stencil})}else{let ie=null,K=null,$=null;g.depth&&($=g.stencil?35056:33190,ie=g.stencil?Ru:Fl,K=g.stencil?_u:Il);const le={colorFormat:32856,depthFormat:$,scaleFactor:r};h=new XRWebGLBinding(s,t),f=h.createProjectionLayer(le),s.updateRenderState({layers:[f]}),v=new yi(f.textureWidth,f.textureHeight,{format:Es,type:$l,depthTexture:new CP(f.textureWidth,f.textureHeight,K,void 0,void 0,void 0,void 0,void 0,void 0,ie),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0});const ae=e.properties.get(v);ae.__ignoreDepthValues=f.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(1),l=null,o=await s.requestReferenceSpace(a),ne.setContext(s),ne.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function k(j){for(let ie=0;ie<j.removed.length;ie++){const K=j.removed[ie],$=b.indexOf(K);$>=0&&(b[$]=null,y[$].dispatchEvent({type:"disconnected",data:K}))}for(let ie=0;ie<j.added.length;ie++){const K=j.added[ie];let $=b.indexOf(K);if($===-1){for(let ae=0;ae<y.length;ae++)if(ae>=b.length){b.push(K),$=ae;break}else if(b[ae]===null){b[ae]=K,$=ae;break}if($===-1)break}const le=y[$];le&&le.dispatchEvent({type:"connected",data:K})}}u(k,"onInputSourcesChange");const O=new T,N=new T;function E(j,ie,K){O.setFromMatrixPosition(ie.matrixWorld),N.setFromMatrixPosition(K.matrixWorld);const $=O.distanceTo(N),le=ie.projectionMatrix.elements,ae=K.projectionMatrix.elements,J=le[14]/(le[10]-1),te=le[14]/(le[10]+1),ge=(le[9]+1)/le[5],he=(le[9]-1)/le[5],we=(le[8]-1)/le[0],xe=(ae[8]+1)/ae[0],Se=J*we,V=J*xe,Y=$/(-we+xe),R=Y*-we;ie.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(R),j.translateZ(Y),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();const ee=J+Y,Q=te+Y,U=Se-R,F=V+($-R),H=ge*te/Q*ee,re=he*te/Q*ee;j.projectionMatrix.makePerspective(U,F,H,re,ee,Q)}u(E,"setProjectionFromUnion");function B(j,ie){ie===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(ie.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}u(B,"updateCamera"),this.updateCamera=function(j){if(s===null)return;M.near=x.near=_.near=j.near,M.far=x.far=_.far=j.far,(C!==M.near||A!==M.far)&&(s.updateRenderState({depthNear:M.near,depthFar:M.far}),C=M.near,A=M.far);const ie=j.parent,K=M.cameras;B(M,ie);for(let le=0;le<K.length;le++)B(K[le],ie);M.matrixWorld.decompose(M.position,M.quaternion,M.scale),j.matrix.copy(M.matrix),j.matrix.decompose(j.position,j.quaternion,j.scale);const $=j.children;for(let le=0,ae=$.length;le<ae;le++)$[le].updateMatrixWorld(!0);K.length===2?E(M,_,x):M.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return M},this.getFoveation=function(){if(f!==null)return f.fixedFoveation;if(d!==null)return d.fixedFoveation},this.setFoveation=function(j){f!==null&&(f.fixedFoveation=j),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=j)};let W=null;function Z(j,ie){if(c=ie.getViewerPose(l||o),p=ie,c!==null){const K=c.views;d!==null&&(e.setRenderTargetFramebuffer(v,d.framebuffer),e.setRenderTarget(v));let $=!1;K.length!==M.cameras.length&&(M.cameras.length=0,$=!0);for(let le=0;le<K.length;le++){const ae=K[le];let J=null;if(d!==null)J=d.getViewport(ae);else{const ge=h.getViewSubImage(f,ae);J=ge.viewport,le===0&&(e.setRenderTargetTextures(v,ge.colorTexture,f.ignoreDepthValues?void 0:ge.depthStencilTexture),e.setRenderTarget(v))}let te=w[le];te===void 0&&(te=new di,te.layers.enable(le),te.viewport=new Dt,w[le]=te),te.matrix.fromArray(ae.transform.matrix),te.projectionMatrix.fromArray(ae.projectionMatrix),te.viewport.set(J.x,J.y,J.width,J.height),le===0&&M.matrix.copy(te.matrix),$===!0&&M.cameras.push(te)}}for(let K=0;K<y.length;K++){const $=b[K],le=y[K];$!==null&&le!==void 0&&le.update($,ie,l||o)}W&&W(j,ie),p=null}u(Z,"onAnimationFrame");const ne=new pP;ne.setAnimationLoop(Z),this.setAnimationLoop=function(j){W=j},this.dispose=function(){}}}u(EP,"WebXRManager");function J$(n,e){function t(m,v){m.fogColor.value.copy(v.color),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)}u(t,"refreshFogUniforms");function i(m,v,y,b,_){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(m,v):v.isMeshToonMaterial?(s(m,v),h(m,v)):v.isMeshPhongMaterial?(s(m,v),c(m,v)):v.isMeshStandardMaterial?(s(m,v),f(m,v),v.isMeshPhysicalMaterial&&d(m,v,_)):v.isMeshMatcapMaterial?(s(m,v),p(m,v)):v.isMeshDepthMaterial?s(m,v):v.isMeshDistanceMaterial?(s(m,v),g(m,v)):v.isMeshNormalMaterial?s(m,v):v.isLineBasicMaterial?(r(m,v),v.isLineDashedMaterial&&o(m,v)):v.isPointsMaterial?a(m,v,y,b):v.isSpriteMaterial?l(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}u(i,"refreshMaterialUniforms");function s(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.bumpMap&&(m.bumpMap.value=v.bumpMap,m.bumpScale.value=v.bumpScale,v.side===Ws&&(m.bumpScale.value*=-1)),v.displacementMap&&(m.displacementMap.value=v.displacementMap,m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap),v.normalMap&&(m.normalMap.value=v.normalMap,m.normalScale.value.copy(v.normalScale),v.side===Ws&&m.normalScale.value.negate()),v.specularMap&&(m.specularMap.value=v.specularMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const y=e.get(v).envMap;if(y&&(m.envMap.value=y,m.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio),v.lightMap){m.lightMap.value=v.lightMap;const x=n.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=v.lightMapIntensity*x}v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity);let b;v.map?b=v.map:v.specularMap?b=v.specularMap:v.displacementMap?b=v.displacementMap:v.normalMap?b=v.normalMap:v.bumpMap?b=v.bumpMap:v.roughnessMap?b=v.roughnessMap:v.metalnessMap?b=v.metalnessMap:v.alphaMap?b=v.alphaMap:v.emissiveMap?b=v.emissiveMap:v.clearcoatMap?b=v.clearcoatMap:v.clearcoatNormalMap?b=v.clearcoatNormalMap:v.clearcoatRoughnessMap?b=v.clearcoatRoughnessMap:v.iridescenceMap?b=v.iridescenceMap:v.iridescenceThicknessMap?b=v.iridescenceThicknessMap:v.specularIntensityMap?b=v.specularIntensityMap:v.specularColorMap?b=v.specularColorMap:v.transmissionMap?b=v.transmissionMap:v.thicknessMap?b=v.thicknessMap:v.sheenColorMap?b=v.sheenColorMap:v.sheenRoughnessMap&&(b=v.sheenRoughnessMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),m.uvTransform.value.copy(b.matrix));let _;v.aoMap?_=v.aoMap:v.lightMap&&(_=v.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uv2Transform.value.copy(_.matrix))}u(s,"refreshUniformsCommon");function r(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity}u(r,"refreshUniformsLine");function o(m,v){m.dashSize.value=v.dashSize,m.totalSize.value=v.dashSize+v.gapSize,m.scale.value=v.scale}u(o,"refreshUniformsDash");function a(m,v,y,b){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.size.value=v.size*y,m.scale.value=b*.5,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let _;v.map?_=v.map:v.alphaMap&&(_=v.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uvTransform.value.copy(_.matrix))}u(a,"refreshUniformsPoints");function l(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.rotation.value=v.rotation,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let y;v.map?y=v.map:v.alphaMap&&(y=v.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix))}u(l,"refreshUniformsSprites");function c(m,v){m.specular.value.copy(v.specular),m.shininess.value=Math.max(v.shininess,1e-4)}u(c,"refreshUniformsPhong");function h(m,v){v.gradientMap&&(m.gradientMap.value=v.gradientMap)}u(h,"refreshUniformsToon");function f(m,v){m.roughness.value=v.roughness,m.metalness.value=v.metalness,v.roughnessMap&&(m.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(m.metalnessMap.value=v.metalnessMap),e.get(v).envMap&&(m.envMapIntensity.value=v.envMapIntensity)}u(f,"refreshUniformsStandard");function d(m,v,y){m.ior.value=v.ior,v.sheen>0&&(m.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),m.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(m.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(m.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(m.clearcoat.value=v.clearcoat,m.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(m.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),m.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===Ws&&m.clearcoatNormalScale.value.negate())),v.iridescence>0&&(m.iridescence.value=v.iridescence,m.iridescenceIOR.value=v.iridescenceIOR,m.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(m.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(m.transmission.value=v.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),v.transmissionMap&&(m.transmissionMap.value=v.transmissionMap),m.thickness.value=v.thickness,v.thicknessMap&&(m.thicknessMap.value=v.thicknessMap),m.attenuationDistance.value=v.attenuationDistance,m.attenuationColor.value.copy(v.attenuationColor)),m.specularIntensity.value=v.specularIntensity,m.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(m.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(m.specularColorMap.value=v.specularColorMap)}u(d,"refreshUniformsPhysical");function p(m,v){v.matcap&&(m.matcap.value=v.matcap)}u(p,"refreshUniformsMatcap");function g(m,v){m.referencePosition.value.copy(v.referencePosition),m.nearDistance.value=v.nearDistance,m.farDistance.value=v.farDistance}return u(g,"refreshUniformsDistance"),{refreshFogUniforms:t,refreshMaterialUniforms:i}}u(J$,"WebGLMaterials");function eV(n,e,t,i){let s={},r={},o=[];const a=t.isWebGL2?n.getParameter(35375):0;function l(b,_){const x=_.program;i.uniformBlockBinding(b,x)}u(l,"bind");function c(b,_){let x=s[b.id];x===void 0&&(g(b),x=h(b),s[b.id]=x,b.addEventListener("dispose",v));const w=_.program;i.updateUBOMapping(b,w);const M=e.render.frame;r[b.id]!==M&&(d(b),r[b.id]=M)}u(c,"update");function h(b){const _=f();b.__bindingPointIndex=_;const x=n.createBuffer(),w=b.__size,M=b.usage;return n.bindBuffer(35345,x),n.bufferData(35345,w,M),n.bindBuffer(35345,null),n.bindBufferBase(35345,_,x),x}u(h,"createBuffer");function f(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}u(f,"allocateBindingPointIndex");function d(b){const _=s[b.id],x=b.uniforms,w=b.__cache;n.bindBuffer(35345,_);for(let M=0,C=x.length;M<C;M++){const A=x[M];if(p(A,M,w)===!0){const P=A.value,D=A.__offset;typeof P=="number"?(A.__data[0]=P,n.bufferSubData(35345,D,A.__data)):(A.value.isMatrix3?(A.__data[0]=A.value.elements[0],A.__data[1]=A.value.elements[1],A.__data[2]=A.value.elements[2],A.__data[3]=A.value.elements[0],A.__data[4]=A.value.elements[3],A.__data[5]=A.value.elements[4],A.__data[6]=A.value.elements[5],A.__data[7]=A.value.elements[0],A.__data[8]=A.value.elements[6],A.__data[9]=A.value.elements[7],A.__data[10]=A.value.elements[8],A.__data[11]=A.value.elements[0]):P.toArray(A.__data),n.bufferSubData(35345,D,A.__data))}}n.bindBuffer(35345,null)}u(d,"updateBufferData");function p(b,_,x){const w=b.value;if(x[_]===void 0)return typeof w=="number"?x[_]=w:x[_]=w.clone(),!0;if(typeof w=="number"){if(x[_]!==w)return x[_]=w,!0}else{const M=x[_];if(M.equals(w)===!1)return M.copy(w),!0}return!1}u(p,"hasUniformChanged");function g(b){const _=b.uniforms;let x=0;const w=16;let M=0;for(let C=0,A=_.length;C<A;C++){const P=_[C],D=m(P);if(P.__data=new Float32Array(D.storage/Float32Array.BYTES_PER_ELEMENT),P.__offset=x,C>0){M=x%w;const k=w-M;M!==0&&k-D.boundary<0&&(x+=w-M,P.__offset=x)}x+=D.storage}return M=x%w,M>0&&(x+=w-M),b.__size=x,b.__cache={},this}u(g,"prepareUniformsGroup");function m(b){const _=b.value,x={boundary:0,storage:0};return typeof _=="number"?(x.boundary=4,x.storage=4):_.isVector2?(x.boundary=8,x.storage=8):_.isVector3||_.isColor?(x.boundary=16,x.storage=12):_.isVector4?(x.boundary=16,x.storage=16):_.isMatrix3?(x.boundary=48,x.storage=48):_.isMatrix4?(x.boundary=64,x.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),x}u(m,"getUniformSize");function v(b){const _=b.target;_.removeEventListener("dispose",v);const x=o.indexOf(_.__bindingPointIndex);o.splice(x,1),n.deleteBuffer(s[_.id]),delete s[_.id],delete r[_.id]}u(v,"onUniformsGroupsDispose");function y(){for(const b in s)n.deleteBuffer(s[b]);o=[],s={},r={}}return u(y,"dispose"),{bind:l,update:c,dispose:y}}u(eV,"WebGLUniformsGroups");function tV(){const n=_d("canvas");return n.style.display="block",n}u(tV,"createCanvasElement");function TP(n={}){this.isWebGLRenderer=!0;const e=n.canvas!==void 0?n.canvas:tV(),t=n.context!==void 0?n.context:null,i=n.depth!==void 0?n.depth:!0,s=n.stencil!==void 0?n.stencil:!0,r=n.antialias!==void 0?n.antialias:!1,o=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,a=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,l=n.powerPreference!==void 0?n.powerPreference:"default",c=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let h;t!==null?h=t.getContextAttributes().alpha:h=n.alpha!==void 0?n.alpha:!1;let f=null,d=null;const p=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Lo,this.physicallyCorrectLights=!1,this.toneMapping=Ur,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let v=!1,y=0,b=0,_=null,x=-1,w=null;const M=new Dt,C=new Dt;let A=null,P=e.width,D=e.height,k=1,O=null,N=null;const E=new Dt(0,0,P,D),B=new Dt(0,0,P,D);let W=!1;const Z=new Hd;let ne=!1,j=!1,ie=null;const K=new ve,$=new ke,le=new T,ae={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function J(){return _===null?k:1}u(J,"getTargetPixelRatio");let te=t;function ge(q,fe){for(let be=0;be<q.length;be++){const ce=q[be],Ae=e.getContext(ce,fe);if(Ae!==null)return Ae}return null}u(ge,"getContext");try{const q={alpha:!0,depth:i,stencil:s,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${db}`),e.addEventListener("webglcontextlost",Ke,!1),e.addEventListener("webglcontextrestored",$e,!1),e.addEventListener("webglcontextcreationerror",Je,!1),te===null){const fe=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&fe.shift(),te=ge(fe,q),te===null)throw ge(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}te.getShaderPrecisionFormat===void 0&&(te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(q){throw console.error("THREE.WebGLRenderer: "+q.message),q}let he,we,xe,Se,V,Y,R,ee,Q,U,F,H,re,z,I,L,G,X,se,de,me,ye,pe,Fe;function qe(){he=new x6(te),we=new g6(te,he,n),he.init(we),ye=new K$(te,he,we),xe=new q$(te,he,we),Se=new S6,V=new F$,Y=new Z$(te,he,xe,V,we,ye,Se),R=new y6(m),ee=new w6(m),Q=new Oz(te,we),pe=new p6(te,he,Q,we),U=new A6(te,Q,Se,pe),F=new P6(te,U,Q,Se),se=new T6(te,we,Y),L=new v6(V),H=new N$(m,R,ee,he,we,pe,L),re=new J$(m,V),z=new B$,I=new W$(he,we),X=new d6(m,R,ee,xe,F,h,o),G=new Y$(m,F,we),Fe=new eV(te,Se,we,xe),de=new m6(te,he,Se,we),me=new M6(te,he,Se,we),Se.programs=H.programs,m.capabilities=we,m.extensions=he,m.properties=V,m.renderLists=z,m.shadowMap=G,m.state=xe,m.info=Se}u(qe,"initGLContext"),qe();const Re=new EP(m,te);this.xr=Re,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const q=he.get("WEBGL_lose_context");q&&q.loseContext()},this.forceContextRestore=function(){const q=he.get("WEBGL_lose_context");q&&q.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(q){q!==void 0&&(k=q,this.setSize(P,D,!1))},this.getSize=function(q){return q.set(P,D)},this.setSize=function(q,fe,be){if(Re.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}P=q,D=fe,e.width=Math.floor(q*k),e.height=Math.floor(fe*k),be!==!1&&(e.style.width=q+"px",e.style.height=fe+"px"),this.setViewport(0,0,q,fe)},this.getDrawingBufferSize=function(q){return q.set(P*k,D*k).floor()},this.setDrawingBufferSize=function(q,fe,be){P=q,D=fe,k=be,e.width=Math.floor(q*be),e.height=Math.floor(fe*be),this.setViewport(0,0,q,fe)},this.getCurrentViewport=function(q){return q.copy(M)},this.getViewport=function(q){return q.copy(E)},this.setViewport=function(q,fe,be,ce){q.isVector4?E.set(q.x,q.y,q.z,q.w):E.set(q,fe,be,ce),xe.viewport(M.copy(E).multiplyScalar(k).floor())},this.getScissor=function(q){return q.copy(B)},this.setScissor=function(q,fe,be,ce){q.isVector4?B.set(q.x,q.y,q.z,q.w):B.set(q,fe,be,ce),xe.scissor(C.copy(B).multiplyScalar(k).floor())},this.getScissorTest=function(){return W},this.setScissorTest=function(q){xe.setScissorTest(W=q)},this.setOpaqueSort=function(q){O=q},this.setTransparentSort=function(q){N=q},this.getClearColor=function(q){return q.copy(X.getClearColor())},this.setClearColor=function(){X.setClearColor.apply(X,arguments)},this.getClearAlpha=function(){return X.getClearAlpha()},this.setClearAlpha=function(){X.setClearAlpha.apply(X,arguments)},this.clear=function(q=!0,fe=!0,be=!0){let ce=0;q&&(ce|=16384),fe&&(ce|=256),be&&(ce|=1024),te.clear(ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ke,!1),e.removeEventListener("webglcontextrestored",$e,!1),e.removeEventListener("webglcontextcreationerror",Je,!1),z.dispose(),I.dispose(),V.dispose(),R.dispose(),ee.dispose(),F.dispose(),pe.dispose(),Fe.dispose(),H.dispose(),Re.dispose(),Re.removeEventListener("sessionstart",Ue),Re.removeEventListener("sessionend",Xe),ie&&(ie.dispose(),ie=null),Ut.stop()};function Ke(q){q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}u(Ke,"onContextLost");function $e(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const q=Se.autoReset,fe=G.enabled,be=G.autoUpdate,ce=G.needsUpdate,Ae=G.type;qe(),Se.autoReset=q,G.enabled=fe,G.autoUpdate=be,G.needsUpdate=ce,G.type=Ae}u($e,"onContextRestore");function Je(q){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",q.statusMessage)}u(Je,"onContextCreationError");function Bt(q){const fe=q.target;fe.removeEventListener("dispose",Bt),Hn(fe)}u(Bt,"onMaterialDispose");function Hn(q){oe(q),V.remove(q)}u(Hn,"deallocateMaterial");function oe(q){const fe=V.get(q).programs;fe!==void 0&&(fe.forEach(function(be){H.releaseProgram(be)}),q.isShaderMaterial&&H.releaseShaderCache(q))}u(oe,"releaseMaterialProgramReferences"),this.renderBufferDirect=function(q,fe,be,ce,Ae,et){fe===null&&(fe=ae);const ct=Ae.isMesh&&Ae.matrixWorld.determinant()<0,_t=Ck(q,fe,be,ce,Ae);xe.setMaterial(ce,ct);let vt=be.index;const $t=be.attributes.position;if(vt===null){if($t===void 0||$t.count===0)return}else if(vt.count===0)return;let Et=1;ce.wireframe===!0&&(vt=U.getWireframeAttribute(be),Et=2),pe.setup(Ae,ce,_t,be,vt);let Lt,xn=de;vt!==null&&(Lt=Q.get(vt),xn=me,xn.setIndex(Lt));const qa=vt!==null?vt.count:$t.count,cc=be.drawRange.start*Et,uc=be.drawRange.count*Et,xr=et!==null?et.start*Et:0,Vt=et!==null?et.count*Et:1/0,hc=Math.max(cc,xr),Wn=Math.min(qa,cc+uc,xr+Vt)-1,ks=Math.max(0,Wn-hc+1);if(ks!==0){if(Ae.isMesh)ce.wireframe===!0?(xe.setLineWidth(ce.wireframeLinewidth*J()),xn.setMode(1)):xn.setMode(4);else if(Ae.isLine){let Ho=ce.linewidth;Ho===void 0&&(Ho=1),xe.setLineWidth(Ho*J()),Ae.isLineSegments?xn.setMode(1):Ae.isLineLoop?xn.setMode(2):xn.setMode(3)}else Ae.isPoints?xn.setMode(0):Ae.isSprite&&xn.setMode(4);if(Ae.isInstancedMesh)xn.renderInstances(hc,ks,Ae.count);else if(be.isInstancedBufferGeometry){const Ho=Math.min(be.instanceCount,be._maxInstanceCount);xn.renderInstances(hc,ks,Ho)}else xn.render(hc,ks)}},this.compile=function(q,fe){function be(ce,Ae,et){ce.transparent===!0&&ce.side===Ts?(ce.side=Ws,ce.needsUpdate=!0,Os(ce,Ae,et),ce.side=Ul,ce.needsUpdate=!0,Os(ce,Ae,et),ce.side=Ts):Os(ce,Ae,et)}u(be,"prepare"),d=I.get(q),d.init(),g.push(d),q.traverseVisible(function(ce){ce.isLight&&ce.layers.test(fe.layers)&&(d.pushLight(ce),ce.castShadow&&d.pushShadow(ce))}),d.setupLights(m.physicallyCorrectLights),q.traverse(function(ce){const Ae=ce.material;if(Ae)if(Array.isArray(Ae))for(let et=0;et<Ae.length;et++){const ct=Ae[et];be(ct,q,ce)}else be(Ae,q,ce)}),g.pop(),d=null};let _e=null;function Pe(q){_e&&_e(q)}u(Pe,"onAnimationFrame");function Ue(){Ut.stop()}u(Ue,"onXRSessionStart");function Xe(){Ut.start()}u(Xe,"onXRSessionEnd");const Ut=new pP;Ut.setAnimationLoop(Pe),typeof self!="undefined"&&Ut.setContext(self),this.setAnimationLoop=function(q){_e=q,Re.setAnimationLoop(q),q===null?Ut.stop():Ut.start()},Re.addEventListener("sessionstart",Ue),Re.addEventListener("sessionend",Xe),this.render=function(q,fe){if(fe!==void 0&&fe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;q.matrixWorldAutoUpdate===!0&&q.updateMatrixWorld(),fe.parent===null&&fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),Re.enabled===!0&&Re.isPresenting===!0&&(Re.cameraAutoUpdate===!0&&Re.updateCamera(fe),fe=Re.getCamera()),q.isScene===!0&&q.onBeforeRender(m,q,fe,_),d=I.get(q,g.length),d.init(),g.push(d),K.multiplyMatrices(fe.projectionMatrix,fe.matrixWorldInverse),Z.setFromProjectionMatrix(K),j=this.localClippingEnabled,ne=L.init(this.clippingPlanes,j,fe),f=z.get(q,p.length),f.init(),p.push(f),ai(q,fe,0,m.sortObjects),f.finish(),m.sortObjects===!0&&f.sort(O,N),ne===!0&&L.beginShadows();const be=d.state.shadowsArray;if(G.render(be,q,fe),ne===!0&&L.endShadows(),this.info.autoReset===!0&&this.info.reset(),X.render(f,q),d.setupLights(m.physicallyCorrectLights),fe.isArrayCamera){const ce=fe.cameras;for(let Ae=0,et=ce.length;Ae<et;Ae++){const ct=ce[Ae];xi(f,q,ct,ct.viewport)}}else xi(f,q,fe);_!==null&&(Y.updateMultisampleRenderTarget(_),Y.updateRenderTargetMipmap(_)),q.isScene===!0&&q.onAfterRender(m,q,fe),pe.resetDefaultState(),x=-1,w=null,g.pop(),g.length>0?d=g[g.length-1]:d=null,p.pop(),p.length>0?f=p[p.length-1]:f=null};function ai(q,fe,be,ce){if(q.visible===!1)return;if(q.layers.test(fe.layers)){if(q.isGroup)be=q.renderOrder;else if(q.isLOD)q.autoUpdate===!0&&q.update(fe);else if(q.isLight)d.pushLight(q),q.castShadow&&d.pushShadow(q);else if(q.isSprite){if(!q.frustumCulled||Z.intersectsSprite(q)){ce&&le.setFromMatrixPosition(q.matrixWorld).applyMatrix4(K);const ct=F.update(q),_t=q.material;_t.visible&&f.push(q,ct,_t,be,le.z,null)}}else if((q.isMesh||q.isLine||q.isPoints)&&(q.isSkinnedMesh&&q.skeleton.frame!==Se.render.frame&&(q.skeleton.update(),q.skeleton.frame=Se.render.frame),!q.frustumCulled||Z.intersectsObject(q))){ce&&le.setFromMatrixPosition(q.matrixWorld).applyMatrix4(K);const ct=F.update(q),_t=q.material;if(Array.isArray(_t)){const vt=ct.groups;for(let $t=0,Et=vt.length;$t<Et;$t++){const Lt=vt[$t],xn=_t[Lt.materialIndex];xn&&xn.visible&&f.push(q,ct,xn,be,le.z,Lt)}}else _t.visible&&f.push(q,ct,_t,be,le.z,null)}}const et=q.children;for(let ct=0,_t=et.length;ct<_t;ct++)ai(et[ct],fe,be,ce)}u(ai,"projectObject");function xi(q,fe,be,ce){const Ae=q.opaque,et=q.transmissive,ct=q.transparent;d.setupLightsView(be),et.length>0&&Ya(Ae,fe,be),ce&&xe.viewport(M.copy(ce)),Ae.length>0&&un(Ae,fe,be),et.length>0&&un(et,fe,be),ct.length>0&&un(ct,fe,be),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1)}u(xi,"renderScene");function Ya(q,fe,be){const ce=we.isWebGL2;ie===null&&(ie=new yi(1,1,{generateMipmaps:!0,type:he.has("EXT_color_buffer_half_float")?Pu:$l,minFilter:nc,samples:ce&&r===!0?4:0})),m.getDrawingBufferSize($),ce?ie.setSize($.x,$.y):ie.setSize(Vg($.x),Vg($.y));const Ae=m.getRenderTarget();m.setRenderTarget(ie),m.clear();const et=m.toneMapping;m.toneMapping=Ur,un(q,fe,be),m.toneMapping=et,Y.updateMultisampleRenderTarget(ie),Y.updateRenderTargetMipmap(ie),m.setRenderTarget(Ae)}u(Ya,"renderTransmissionPass");function un(q,fe,be){const ce=fe.isScene===!0?fe.overrideMaterial:null;for(let Ae=0,et=q.length;Ae<et;Ae++){const ct=q[Ae],_t=ct.object,vt=ct.geometry,$t=ce===null?ct.material:ce,Et=ct.group;_t.layers.test(be.layers)&&Wr(_t,fe,be,vt,$t,Et)}}u(un,"renderObjects");function Wr(q,fe,be,ce,Ae,et){q.onBeforeRender(m,fe,be,ce,Ae,et),q.modelViewMatrix.multiplyMatrices(be.matrixWorldInverse,q.matrixWorld),q.normalMatrix.getNormalMatrix(q.modelViewMatrix),Ae.onBeforeRender(m,fe,be,ce,q,et),Ae.transparent===!0&&Ae.side===Ts?(Ae.side=Ws,Ae.needsUpdate=!0,m.renderBufferDirect(be,fe,ce,Ae,q,et),Ae.side=Ul,Ae.needsUpdate=!0,m.renderBufferDirect(be,fe,ce,Ae,q,et),Ae.side=Ts):m.renderBufferDirect(be,fe,ce,Ae,q,et),q.onAfterRender(m,fe,be,ce,Ae,et)}u(Wr,"renderObject");function Os(q,fe,be){fe.isScene!==!0&&(fe=ae);const ce=V.get(q),Ae=d.state.lights,et=d.state.shadowsArray,ct=Ae.state.version,_t=H.getParameters(q,Ae.state,et,fe,be),vt=H.getProgramCacheKey(_t);let $t=ce.programs;ce.environment=q.isMeshStandardMaterial?fe.environment:null,ce.fog=fe.fog,ce.envMap=(q.isMeshStandardMaterial?ee:R).get(q.envMap||ce.environment),$t===void 0&&(q.addEventListener("dispose",Bt),$t=new Map,ce.programs=$t);let Et=$t.get(vt);if(Et!==void 0){if(ce.currentProgram===Et&&ce.lightsStateVersion===ct)return cA(q,_t),Et}else _t.uniforms=H.getUniforms(q),q.onBuild(be,_t,m),q.onBeforeCompile(_t,m),Et=H.acquireProgram(_t,vt),$t.set(vt,Et),ce.uniforms=_t.uniforms;const Lt=ce.uniforms;(!q.isShaderMaterial&&!q.isRawShaderMaterial||q.clipping===!0)&&(Lt.clippingPlanes=L.uniform),cA(q,_t),ce.needsLights=Tk(q),ce.lightsStateVersion=ct,ce.needsLights&&(Lt.ambientLightColor.value=Ae.state.ambient,Lt.lightProbe.value=Ae.state.probe,Lt.directionalLights.value=Ae.state.directional,Lt.directionalLightShadows.value=Ae.state.directionalShadow,Lt.spotLights.value=Ae.state.spot,Lt.spotLightShadows.value=Ae.state.spotShadow,Lt.rectAreaLights.value=Ae.state.rectArea,Lt.ltc_1.value=Ae.state.rectAreaLTC1,Lt.ltc_2.value=Ae.state.rectAreaLTC2,Lt.pointLights.value=Ae.state.point,Lt.pointLightShadows.value=Ae.state.pointShadow,Lt.hemisphereLights.value=Ae.state.hemi,Lt.directionalShadowMap.value=Ae.state.directionalShadowMap,Lt.directionalShadowMatrix.value=Ae.state.directionalShadowMatrix,Lt.spotShadowMap.value=Ae.state.spotShadowMap,Lt.spotLightMatrix.value=Ae.state.spotLightMatrix,Lt.spotLightMap.value=Ae.state.spotLightMap,Lt.pointShadowMap.value=Ae.state.pointShadowMap,Lt.pointShadowMatrix.value=Ae.state.pointShadowMatrix);const xn=Et.getUniforms(),qa=nd.seqWithValue(xn.seq,Lt);return ce.currentProgram=Et,ce.uniformsList=qa,Et}u(Os,"getProgram");function cA(q,fe){const be=V.get(q);be.outputEncoding=fe.outputEncoding,be.instancing=fe.instancing,be.skinning=fe.skinning,be.morphTargets=fe.morphTargets,be.morphNormals=fe.morphNormals,be.morphColors=fe.morphColors,be.morphTargetsCount=fe.morphTargetsCount,be.numClippingPlanes=fe.numClippingPlanes,be.numIntersection=fe.numClipIntersection,be.vertexAlphas=fe.vertexAlphas,be.vertexTangents=fe.vertexTangents,be.toneMapping=fe.toneMapping}u(cA,"updateCommonMaterialProperties");function Ck(q,fe,be,ce,Ae){fe.isScene!==!0&&(fe=ae),Y.resetTextureUnits();const et=fe.fog,ct=ce.isMeshStandardMaterial?fe.environment:null,_t=_===null?m.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:Lo,vt=(ce.isMeshStandardMaterial?ee:R).get(ce.envMap||ct),$t=ce.vertexColors===!0&&!!be.attributes.color&&be.attributes.color.itemSize===4,Et=!!ce.normalMap&&!!be.attributes.tangent,Lt=!!be.morphAttributes.position,xn=!!be.morphAttributes.normal,qa=!!be.morphAttributes.color,cc=ce.toneMapped?m.toneMapping:Ur,uc=be.morphAttributes.position||be.morphAttributes.normal||be.morphAttributes.color,xr=uc!==void 0?uc.length:0,Vt=V.get(ce),hc=d.state.lights;if(ne===!0&&(j===!0||q!==w)){const hs=q===w&&ce.id===x;L.setState(ce,q,hs)}let Wn=!1;ce.version===Vt.__version?(Vt.needsLights&&Vt.lightsStateVersion!==hc.state.version||Vt.outputEncoding!==_t||Ae.isInstancedMesh&&Vt.instancing===!1||!Ae.isInstancedMesh&&Vt.instancing===!0||Ae.isSkinnedMesh&&Vt.skinning===!1||!Ae.isSkinnedMesh&&Vt.skinning===!0||Vt.envMap!==vt||ce.fog===!0&&Vt.fog!==et||Vt.numClippingPlanes!==void 0&&(Vt.numClippingPlanes!==L.numPlanes||Vt.numIntersection!==L.numIntersection)||Vt.vertexAlphas!==$t||Vt.vertexTangents!==Et||Vt.morphTargets!==Lt||Vt.morphNormals!==xn||Vt.morphColors!==qa||Vt.toneMapping!==cc||we.isWebGL2===!0&&Vt.morphTargetsCount!==xr)&&(Wn=!0):(Wn=!0,Vt.__version=ce.version);let ks=Vt.currentProgram;Wn===!0&&(ks=Os(ce,fe,Ae));let Ho=!1,Sh=!1,w1=!1;const Oi=ks.getUniforms(),Za=Vt.uniforms;if(xe.useProgram(ks.program)&&(Ho=!0,Sh=!0,w1=!0),ce.id!==x&&(x=ce.id,Sh=!0),Ho||w!==q){if(Oi.setValue(te,"projectionMatrix",q.projectionMatrix),we.logarithmicDepthBuffer&&Oi.setValue(te,"logDepthBufFC",2/(Math.log(q.far+1)/Math.LN2)),w!==q&&(w=q,Sh=!0,w1=!0),ce.isShaderMaterial||ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshStandardMaterial||ce.envMap){const hs=Oi.map.cameraPosition;hs!==void 0&&hs.setValue(te,le.setFromMatrixPosition(q.matrixWorld))}(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial)&&Oi.setValue(te,"isOrthographic",q.isOrthographicCamera===!0),(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial||ce.isShadowMaterial||Ae.isSkinnedMesh)&&Oi.setValue(te,"viewMatrix",q.matrixWorldInverse)}if(Ae.isSkinnedMesh){Oi.setOptional(te,Ae,"bindMatrix"),Oi.setOptional(te,Ae,"bindMatrixInverse");const hs=Ae.skeleton;hs&&(we.floatVertexTextures?(hs.boneTexture===null&&hs.computeBoneTexture(),Oi.setValue(te,"boneTexture",hs.boneTexture,Y),Oi.setValue(te,"boneTextureSize",hs.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const x1=be.morphAttributes;if((x1.position!==void 0||x1.normal!==void 0||x1.color!==void 0&&we.isWebGL2===!0)&&se.update(Ae,be,ce,ks),(Sh||Vt.receiveShadow!==Ae.receiveShadow)&&(Vt.receiveShadow=Ae.receiveShadow,Oi.setValue(te,"receiveShadow",Ae.receiveShadow)),ce.isMeshGouraudMaterial&&ce.envMap!==null&&(Za.envMap.value=vt,Za.flipEnvMap.value=vt.isCubeTexture&&vt.isRenderTargetTexture===!1?-1:1),Sh&&(Oi.setValue(te,"toneMappingExposure",m.toneMappingExposure),Vt.needsLights&&Ek(Za,w1),et&&ce.fog===!0&&re.refreshFogUniforms(Za,et),re.refreshMaterialUniforms(Za,ce,k,D,ie),nd.upload(te,Vt.uniformsList,Za,Y)),ce.isShaderMaterial&&ce.uniformsNeedUpdate===!0&&(nd.upload(te,Vt.uniformsList,Za,Y),ce.uniformsNeedUpdate=!1),ce.isSpriteMaterial&&Oi.setValue(te,"center",Ae.center),Oi.setValue(te,"modelViewMatrix",Ae.modelViewMatrix),Oi.setValue(te,"normalMatrix",Ae.normalMatrix),Oi.setValue(te,"modelMatrix",Ae.matrixWorld),ce.isShaderMaterial||ce.isRawShaderMaterial){const hs=ce.uniformsGroups;for(let A1=0,Pk=hs.length;A1<Pk;A1++)if(we.isWebGL2){const uA=hs[A1];Fe.update(uA,ks),Fe.bind(uA,ks)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return ks}u(Ck,"setProgram");function Ek(q,fe){q.ambientLightColor.needsUpdate=fe,q.lightProbe.needsUpdate=fe,q.directionalLights.needsUpdate=fe,q.directionalLightShadows.needsUpdate=fe,q.pointLights.needsUpdate=fe,q.pointLightShadows.needsUpdate=fe,q.spotLights.needsUpdate=fe,q.spotLightShadows.needsUpdate=fe,q.rectAreaLights.needsUpdate=fe,q.hemisphereLights.needsUpdate=fe}u(Ek,"markUniformsLightsNeedsUpdate");function Tk(q){return q.isMeshLambertMaterial||q.isMeshToonMaterial||q.isMeshPhongMaterial||q.isMeshStandardMaterial||q.isShadowMaterial||q.isShaderMaterial&&q.lights===!0}u(Tk,"materialNeedsLights"),this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(q,fe,be){V.get(q.texture).__webglTexture=fe,V.get(q.depthTexture).__webglTexture=be;const ce=V.get(q);ce.__hasExternalTextures=!0,ce.__hasExternalTextures&&(ce.__autoAllocateDepthBuffer=be===void 0,ce.__autoAllocateDepthBuffer||he.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ce.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(q,fe){const be=V.get(q);be.__webglFramebuffer=fe,be.__useDefaultFramebuffer=fe===void 0},this.setRenderTarget=function(q,fe=0,be=0){_=q,y=fe,b=be;let ce=!0,Ae=null,et=!1,ct=!1;if(q){const vt=V.get(q);vt.__useDefaultFramebuffer!==void 0?(xe.bindFramebuffer(36160,null),ce=!1):vt.__webglFramebuffer===void 0?Y.setupRenderTarget(q):vt.__hasExternalTextures&&Y.rebindTextures(q,V.get(q.texture).__webglTexture,V.get(q.depthTexture).__webglTexture);const $t=q.texture;($t.isData3DTexture||$t.isDataArrayTexture||$t.isCompressedArrayTexture)&&(ct=!0);const Et=V.get(q).__webglFramebuffer;q.isWebGLCubeRenderTarget?(Ae=Et[fe],et=!0):we.isWebGL2&&q.samples>0&&Y.useMultisampledRTT(q)===!1?Ae=V.get(q).__webglMultisampledFramebuffer:Ae=Et,M.copy(q.viewport),C.copy(q.scissor),A=q.scissorTest}else M.copy(E).multiplyScalar(k).floor(),C.copy(B).multiplyScalar(k).floor(),A=W;if(xe.bindFramebuffer(36160,Ae)&&we.drawBuffers&&ce&&xe.drawBuffers(q,Ae),xe.viewport(M),xe.scissor(C),xe.setScissorTest(A),et){const vt=V.get(q.texture);te.framebufferTexture2D(36160,36064,34069+fe,vt.__webglTexture,be)}else if(ct){const vt=V.get(q.texture),$t=fe||0;te.framebufferTextureLayer(36160,36064,vt.__webglTexture,be||0,$t)}x=-1},this.readRenderTargetPixels=function(q,fe,be,ce,Ae,et,ct){if(!(q&&q.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let _t=V.get(q).__webglFramebuffer;if(q.isWebGLCubeRenderTarget&&ct!==void 0&&(_t=_t[ct]),_t){xe.bindFramebuffer(36160,_t);try{const vt=q.texture,$t=vt.format,Et=vt.type;if($t!==Es&&ye.convert($t)!==te.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Lt=Et===Pu&&(he.has("EXT_color_buffer_half_float")||we.isWebGL2&&he.has("EXT_color_buffer_float"));if(Et!==$l&&ye.convert(Et)!==te.getParameter(35738)&&!(Et===Ma&&(we.isWebGL2||he.has("OES_texture_float")||he.has("WEBGL_color_buffer_float")))&&!Lt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}fe>=0&&fe<=q.width-ce&&be>=0&&be<=q.height-Ae&&te.readPixels(fe,be,ce,Ae,ye.convert($t),ye.convert(Et),et)}finally{const vt=_!==null?V.get(_).__webglFramebuffer:null;xe.bindFramebuffer(36160,vt)}}},this.copyFramebufferToTexture=function(q,fe,be=0){const ce=Math.pow(2,-be),Ae=Math.floor(fe.image.width*ce),et=Math.floor(fe.image.height*ce);Y.setTexture2D(fe,0),te.copyTexSubImage2D(3553,be,0,0,q.x,q.y,Ae,et),xe.unbindTexture()},this.copyTextureToTexture=function(q,fe,be,ce=0){const Ae=fe.image.width,et=fe.image.height,ct=ye.convert(be.format),_t=ye.convert(be.type);Y.setTexture2D(be,0),te.pixelStorei(37440,be.flipY),te.pixelStorei(37441,be.premultiplyAlpha),te.pixelStorei(3317,be.unpackAlignment),fe.isDataTexture?te.texSubImage2D(3553,ce,q.x,q.y,Ae,et,ct,_t,fe.image.data):fe.isCompressedTexture?te.compressedTexSubImage2D(3553,ce,q.x,q.y,fe.mipmaps[0].width,fe.mipmaps[0].height,ct,fe.mipmaps[0].data):te.texSubImage2D(3553,ce,q.x,q.y,ct,_t,fe.image),ce===0&&be.generateMipmaps&&te.generateMipmap(3553),xe.unbindTexture()},this.copyTextureToTexture3D=function(q,fe,be,ce,Ae=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const et=q.max.x-q.min.x+1,ct=q.max.y-q.min.y+1,_t=q.max.z-q.min.z+1,vt=ye.convert(ce.format),$t=ye.convert(ce.type);let Et;if(ce.isData3DTexture)Y.setTexture3D(ce,0),Et=32879;else if(ce.isDataArrayTexture)Y.setTexture2DArray(ce,0),Et=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}te.pixelStorei(37440,ce.flipY),te.pixelStorei(37441,ce.premultiplyAlpha),te.pixelStorei(3317,ce.unpackAlignment);const Lt=te.getParameter(3314),xn=te.getParameter(32878),qa=te.getParameter(3316),cc=te.getParameter(3315),uc=te.getParameter(32877),xr=be.isCompressedTexture?be.mipmaps[0]:be.image;te.pixelStorei(3314,xr.width),te.pixelStorei(32878,xr.height),te.pixelStorei(3316,q.min.x),te.pixelStorei(3315,q.min.y),te.pixelStorei(32877,q.min.z),be.isDataTexture||be.isData3DTexture?te.texSubImage3D(Et,Ae,fe.x,fe.y,fe.z,et,ct,_t,vt,$t,xr.data):be.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),te.compressedTexSubImage3D(Et,Ae,fe.x,fe.y,fe.z,et,ct,_t,vt,xr.data)):te.texSubImage3D(Et,Ae,fe.x,fe.y,fe.z,et,ct,_t,vt,$t,xr),te.pixelStorei(3314,Lt),te.pixelStorei(32878,xn),te.pixelStorei(3316,qa),te.pixelStorei(3315,cc),te.pixelStorei(32877,uc),Ae===0&&ce.generateMipmaps&&te.generateMipmap(Et),xe.unbindTexture()},this.initTexture=function(q){q.isCubeTexture?Y.setTextureCube(q,0):q.isData3DTexture?Y.setTexture3D(q,0):q.isDataArrayTexture||q.isCompressedArrayTexture?Y.setTexture2DArray(q,0):Y.setTexture2D(q,0),xe.unbindTexture()},this.resetState=function(){y=0,b=0,_=null,xe.reset(),pe.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}u(TP,"WebGLRenderer");class PP extends TP{}u(PP,"WebGL1Renderer");PP.prototype.isWebGL1Renderer=!0;class bd extends Pt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.backgroundBlurriness=this.backgroundBlurriness),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}u(bd,"Scene");class RP{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=u_,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=pr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=pr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=pr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}u(RP,"InterleavedBuffer");const ki=new T;class R0{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyMatrix4(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.applyNormalMatrix(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ki.fromBufferAttribute(this,t),ki.transformDirection(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}setX(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=en(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=So(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=So(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=So(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=So(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=en(t,this.array),i=en(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=en(t,this.array),i=en(i,this.array),s=en(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=en(t,this.array),i=en(i,this.array),s=en(s,this.array),r=en(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new mn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new R0(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}u(R0,"InterleavedBufferAttribute");const f2=new T,d2=new Dt,p2=new Dt,nV=new T,m2=new ve;class xb extends We{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ve,this.bindMatrixInverse=new ve}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Dt,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,s=this.geometry;d2.fromBufferAttribute(s.attributes.skinIndex,e),p2.fromBufferAttribute(s.attributes.skinWeight,e),f2.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=p2.getComponent(r);if(o!==0){const a=d2.getComponent(r);m2.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(nV.copy(f2).applyMatrix4(m2),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}u(xb,"SkinnedMesh");class wd extends Pt{constructor(){super(),this.isBone=!0,this.type="Bone"}}u(wd,"Bone");class IP extends ii{constructor(e=null,t=1,i=1,s,r,o,a,l,c=zn,h=zn,f,d){super(null,o,a,l,c,h,s,r,f,d),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(IP,"DataTexture");const g2=new ve,iV=new ve;class Wd{constructor(e=[],t=[]){this.uuid=pr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new ve)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new ve;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:iV;g2.multiplyMatrices(a,t[r]),g2.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new Wd(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=lP(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new IP(t,e,e,Es,Ma);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new wd),this.bones.push(o),this.boneInverses.push(new ve().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}u(Wd,"Skeleton");class m_ extends mn{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}u(m_,"InstancedBufferAttribute");const v2=new ve,y2=new ve,Fp=[],sV=new ve,Lh=new We;class DP extends We{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new m_(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let s=0;s<i;s++)this.setMatrixAt(s,sV)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const i=this.matrixWorld,s=this.count;if(Lh.geometry=this.geometry,Lh.material=this.material,Lh.material!==void 0)for(let r=0;r<s;r++){this.getMatrixAt(r,v2),y2.multiplyMatrices(i,v2),Lh.matrixWorld=y2,Lh.raycast(e,Fp);for(let o=0,a=Fp.length;o<a;o++){const l=Fp[o];l.instanceId=r,l.object=this,t.push(l)}Fp.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new m_(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}u(DP,"InstancedMesh");class Di extends Zi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Te(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}u(Di,"LineBasicMaterial");const _2=new T,b2=new T,w2=new ve,uv=new $a,zp=new Ua;class js extends Pt{constructor(e=new it,t=new Di){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)_2.fromBufferAttribute(t,s-1),b2.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=_2.distanceTo(b2);e.setAttribute("lineDistance",new Ve(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),zp.copy(i.boundingSphere),zp.applyMatrix4(s),zp.radius+=r,e.ray.intersectsSphere(zp)===!1)return;w2.copy(s).invert(),uv.copy(e.ray).applyMatrix4(w2);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new T,h=new T,f=new T,d=new T,p=this.isLineSegments?2:1,g=i.index,v=i.attributes.position;if(g!==null){const y=Math.max(0,o.start),b=Math.min(g.count,o.start+o.count);for(let _=y,x=b-1;_<x;_+=p){const w=g.getX(_),M=g.getX(_+1);if(c.fromBufferAttribute(v,w),h.fromBufferAttribute(v,M),uv.distanceSqToSegment(c,h,d,f)>l)continue;d.applyMatrix4(this.matrixWorld);const A=e.ray.origin.distanceTo(d);A<e.near||A>e.far||t.push({distance:A,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let _=y,x=b-1;_<x;_+=p){if(c.fromBufferAttribute(v,_),h.fromBufferAttribute(v,_+1),uv.distanceSqToSegment(c,h,d,f)>l)continue;d.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(d);M<e.near||M>e.far||t.push({distance:M,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}u(js,"Line");const x2=new T,A2=new T;class vr extends js{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)x2.fromBufferAttribute(t,s),A2.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+x2.distanceTo(A2);e.setAttribute("lineDistance",new Ve(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}u(vr,"LineSegments");class LP extends js{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}u(LP,"LineLoop");class Fr extends Zi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Te(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}u(Fr,"PointsMaterial");const M2=new ve,g_=new $a,Bp=new Ua,Up=new T;class Pa extends Pt{constructor(e=new it,t=new Fr){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Bp.copy(i.boundingSphere),Bp.applyMatrix4(s),Bp.radius+=r,e.ray.intersectsSphere(Bp)===!1)return;M2.copy(s).invert(),g_.copy(e.ray).applyMatrix4(M2);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,f=i.attributes.position;if(c!==null){const d=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let g=d,m=p;g<m;g++){const v=c.getX(g);Up.fromBufferAttribute(f,v),S2(Up,v,l,s,e,t,this)}}else{const d=Math.max(0,o.start),p=Math.min(f.count,o.start+o.count);for(let g=d,m=p;g<m;g++)Up.fromBufferAttribute(f,g),S2(Up,g,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}u(Pa,"Points");function S2(n,e,t,i,s,r,o){const a=g_.distanceSqToPoint(n);if(a<t){const l=new T;g_.closestPointToPoint(n,l),l.applyMatrix4(i);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}u(S2,"testPoint");class Ab{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(s),t.push(r),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),c=i[s]-o,c<0)a=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,i[s]===o)return s/(r-1);const h=i[s],d=i[s+1]-h,p=(o-h)/d;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=t||(o.isVector2?new ke:new T);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new T,s=[],r=[],o=[],a=new T,l=new ve;for(let p=0;p<=e;p++){const g=p/e;s[p]=this.getTangentAt(g,new T)}r[0]=new T,o[0]=new T;let c=Number.MAX_VALUE;const h=Math.abs(s[0].x),f=Math.abs(s[0].y),d=Math.abs(s[0].z);h<=c&&(c=h,i.set(1,0,0)),f<=c&&(c=f,i.set(0,1,0)),d<=c&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(s[p-1],s[p]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(_i(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,g))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(_i(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let g=1;g<=e;g++)r[g].applyMatrix4(l.makeRotationAxis(s[g],p*g)),o[g].crossVectors(s[g],r[g])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}u(Ab,"Curve");class Ou extends it{constructor(e=1,t=8,i=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:s},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new T,h=new ke;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let f=0,d=3;f<=t;f++,d+=3){const p=i+f/t*s;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),a.push(0,0,1),h.x=(o[d]/e+1)/2,h.y=(o[d+1]/e+1)/2,l.push(h.x,h.y)}for(let f=1;f<=t;f++)r.push(f,f+1,0);this.setIndex(r),this.setAttribute("position",new Ve(o,3)),this.setAttribute("normal",new Ve(a,3)),this.setAttribute("uv",new Ve(l,2))}static fromJSON(e){return new Ou(e.radius,e.segments,e.thetaStart,e.thetaLength)}}u(Ou,"CircleGeometry");class ku extends it{constructor(e=1,t=1,i=1,s=8,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const h=[],f=[],d=[],p=[];let g=0;const m=[],v=i/2;let y=0;b(),o===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new Ve(f,3)),this.setAttribute("normal",new Ve(d,3)),this.setAttribute("uv",new Ve(p,2));function b(){const x=new T,w=new T;let M=0;const C=(t-e)/i;for(let A=0;A<=r;A++){const P=[],D=A/r,k=D*(t-e)+e;for(let O=0;O<=s;O++){const N=O/s,E=N*l+a,B=Math.sin(E),W=Math.cos(E);w.x=k*B,w.y=-D*i+v,w.z=k*W,f.push(w.x,w.y,w.z),x.set(B,C,W).normalize(),d.push(x.x,x.y,x.z),p.push(N,1-D),P.push(g++)}m.push(P)}for(let A=0;A<s;A++)for(let P=0;P<r;P++){const D=m[P][A],k=m[P+1][A],O=m[P+1][A+1],N=m[P][A+1];h.push(D,k,N),h.push(k,O,N),M+=6}c.addGroup(y,M,0),y+=M}u(b,"generateTorso");function _(x){const w=g,M=new ke,C=new T;let A=0;const P=x===!0?e:t,D=x===!0?1:-1;for(let O=1;O<=s;O++)f.push(0,v*D,0),d.push(0,D,0),p.push(.5,.5),g++;const k=g;for(let O=0;O<=s;O++){const E=O/s*l+a,B=Math.cos(E),W=Math.sin(E);C.x=P*W,C.y=v*D,C.z=P*B,f.push(C.x,C.y,C.z),d.push(0,D,0),M.x=B*.5+.5,M.y=W*.5*D+.5,p.push(M.x,M.y),g++}for(let O=0;O<s;O++){const N=w+O,E=k+O;x===!0?h.push(E,E+1,N):h.push(E+1,E,N),A+=3}c.addGroup(y,A,x===!0?1:2),y+=A}u(_,"generateCap")}static fromJSON(e){return new ku(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}u(ku,"CylinderGeometry");class I0 extends ku{constructor(e=1,t=1,i=8,s=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,s,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new I0(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}u(I0,"ConeGeometry");class D0 extends it{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const r=[],o=[];a(s),c(i),h(),this.setAttribute("position",new Ve(r,3)),this.setAttribute("normal",new Ve(r.slice(),3)),this.setAttribute("uv",new Ve(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const _=new T,x=new T,w=new T;for(let M=0;M<t.length;M+=3)p(t[M+0],_),p(t[M+1],x),p(t[M+2],w),l(_,x,w,b)}u(a,"subdivide");function l(b,_,x,w){const M=w+1,C=[];for(let A=0;A<=M;A++){C[A]=[];const P=b.clone().lerp(x,A/M),D=_.clone().lerp(x,A/M),k=M-A;for(let O=0;O<=k;O++)O===0&&A===M?C[A][O]=P:C[A][O]=P.clone().lerp(D,O/k)}for(let A=0;A<M;A++)for(let P=0;P<2*(M-A)-1;P++){const D=Math.floor(P/2);P%2===0?(d(C[A][D+1]),d(C[A+1][D]),d(C[A][D])):(d(C[A][D+1]),d(C[A+1][D+1]),d(C[A+1][D]))}}u(l,"subdivideFace");function c(b){const _=new T;for(let x=0;x<r.length;x+=3)_.x=r[x+0],_.y=r[x+1],_.z=r[x+2],_.normalize().multiplyScalar(b),r[x+0]=_.x,r[x+1]=_.y,r[x+2]=_.z}u(c,"applyRadius");function h(){const b=new T;for(let _=0;_<r.length;_+=3){b.x=r[_+0],b.y=r[_+1],b.z=r[_+2];const x=v(b)/2/Math.PI+.5,w=y(b)/Math.PI+.5;o.push(x,1-w)}g(),f()}u(h,"generateUVs");function f(){for(let b=0;b<o.length;b+=6){const _=o[b+0],x=o[b+2],w=o[b+4],M=Math.max(_,x,w),C=Math.min(_,x,w);M>.9&&C<.1&&(_<.2&&(o[b+0]+=1),x<.2&&(o[b+2]+=1),w<.2&&(o[b+4]+=1))}}u(f,"correctSeam");function d(b){r.push(b.x,b.y,b.z)}u(d,"pushVertex");function p(b,_){const x=b*3;_.x=e[x+0],_.y=e[x+1],_.z=e[x+2]}u(p,"getVertexByIndex");function g(){const b=new T,_=new T,x=new T,w=new T,M=new ke,C=new ke,A=new ke;for(let P=0,D=0;P<r.length;P+=9,D+=6){b.set(r[P+0],r[P+1],r[P+2]),_.set(r[P+3],r[P+4],r[P+5]),x.set(r[P+6],r[P+7],r[P+8]),M.set(o[D+0],o[D+1]),C.set(o[D+2],o[D+3]),A.set(o[D+4],o[D+5]),w.copy(b).add(_).add(x).divideScalar(3);const k=v(w);m(M,D+0,b,k),m(C,D+2,_,k),m(A,D+4,x,k)}}u(g,"correctUVs");function m(b,_,x,w){w<0&&b.x===1&&(o[_]=b.x-1),x.x===0&&x.z===0&&(o[_]=w/2/Math.PI+.5)}u(m,"correctUV");function v(b){return Math.atan2(b.z,-b.x)}u(v,"azimuth");function y(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}u(y,"inclination")}static fromJSON(e){return new D0(e.vertices,e.indices,e.radius,e.details)}}u(D0,"PolyhedronGeometry");class L0 extends D0{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new L0(e.radius,e.detail)}}u(L0,"OctahedronGeometry");class O0 extends it{constructor(e=1,t=32,i=16,s=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const h=[],f=new T,d=new T,p=[],g=[],m=[],v=[];for(let y=0;y<=i;y++){const b=[],_=y/i;let x=0;y==0&&o==0?x=.5/t:y==i&&l==Math.PI&&(x=-.5/t);for(let w=0;w<=t;w++){const M=w/t;f.x=-e*Math.cos(s+M*r)*Math.sin(o+_*a),f.y=e*Math.cos(o+_*a),f.z=e*Math.sin(s+M*r)*Math.sin(o+_*a),g.push(f.x,f.y,f.z),d.copy(f).normalize(),m.push(d.x,d.y,d.z),v.push(M+x,1-_),b.push(c++)}h.push(b)}for(let y=0;y<i;y++)for(let b=0;b<t;b++){const _=h[y][b+1],x=h[y][b],w=h[y+1][b],M=h[y+1][b+1];(y!==0||o>0)&&p.push(_,x,M),(y!==i-1||l<Math.PI)&&p.push(x,w,M)}this.setIndex(p),this.setAttribute("position",new Ve(g,3)),this.setAttribute("normal",new Ve(m,3)),this.setAttribute("uv",new Ve(v,2))}static fromJSON(e){return new O0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}u(O0,"SphereGeometry$2");class xa extends it{constructor(e=1,t=.4,i=8,s=6,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const o=[],a=[],l=[],c=[],h=new T,f=new T,d=new T;for(let p=0;p<=i;p++)for(let g=0;g<=s;g++){const m=g/s*r,v=p/i*Math.PI*2;f.x=(e+t*Math.cos(v))*Math.cos(m),f.y=(e+t*Math.cos(v))*Math.sin(m),f.z=t*Math.sin(v),a.push(f.x,f.y,f.z),h.x=e*Math.cos(m),h.y=e*Math.sin(m),d.subVectors(f,h).normalize(),l.push(d.x,d.y,d.z),c.push(g/s),c.push(p/i)}for(let p=1;p<=i;p++)for(let g=1;g<=s;g++){const m=(s+1)*p+g-1,v=(s+1)*(p-1)+g-1,y=(s+1)*(p-1)+g,b=(s+1)*p+g;o.push(m,v,b),o.push(v,y,b)}this.setIndex(o),this.setAttribute("position",new Ve(a,3)),this.setAttribute("normal",new Ve(l,3)),this.setAttribute("uv",new Ve(c,2))}static fromJSON(e){return new xa(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}u(xa,"TorusGeometry");class Ks extends Zi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Te(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gd,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(Ks,"MeshStandardMaterial");class Ga extends Ks{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ke(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return _i(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Te(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Te(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Te(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}u(Ga,"MeshPhysicalMaterial");class id extends Zi{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Te(16777215),this.specular=new Te(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gd,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=x0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(id,"MeshPhongMaterial");class Mb extends Zi{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Gd,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=x0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(Mb,"MeshLambertMaterial");function ea(n,e,t){return OP(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)}u(ea,"arraySlice");function $p(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}u($p,"convertArray");function OP(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}u(OP,"isTypedArray");function rV(n){function e(s,r){return n[s]-n[r]}u(e,"compareTime");const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}u(rV,"getKeyframeOrder");function C2(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=n[a+l]}return s}u(C2,"sortedArray");function kP(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=n[s++];while(r!==void 0)}u(kP,"flattenJSON");class ch{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];e:{t:{let o;n:{i:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<r)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=t[++i],e<s)break t}o=t.length;break n}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=t[--i-1],e>=r)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}u(ch,"Interpolant");class NP extends ch{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:RM,endingEnd:RM}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case IM:r=e,a=2*t-i;break;case DM:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case IM:o=e,l=2*i-t;break;case DM:o=1,l=i+s[1]-s[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,f=this._offsetNext,d=this._weightPrev,p=this._weightNext,g=(i-t)/(s-t),m=g*g,v=m*g,y=-d*v+2*d*m-d*g,b=(1+d)*v+(-1.5-2*d)*m+(-.5+d)*g+1,_=(-1-p)*v+(1.5+p)*m+.5*g,x=p*v-p*m;for(let w=0;w!==a;++w)r[w]=y*o[h+w]+b*o[c+w]+_*o[l+w]+x*o[f+w];return r}}u(NP,"CubicInterpolant");class FP extends ch{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(s-t),f=1-h;for(let d=0;d!==a;++d)r[d]=o[c+d]*f+o[l+d]*h;return r}}u(FP,"LinearInterpolant");class zP extends ch{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}u(zP,"DiscreteInterpolant");class br{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=$p(t,this.TimeBufferType),this.values=$p(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:$p(e.times,Array),values:$p(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new zP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new FP(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new NP(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Iu:t=this.InterpolantFactoryMethodDiscrete;break;case Vl:t=this.InterpolantFactoryMethodLinear;break;case z1:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Iu;case this.InterpolantFactoryMethodLinear:return Vl;case this.InterpolantFactoryMethodSmooth:return z1}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=ea(i,r,o),this.values=ea(this.values,r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(s!==void 0&&OP(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=ea(this.times),t=ea(this.values),i=this.getValueSize(),s=this.getInterpolation()===z1,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(s)l=!0;else{const f=a*i,d=f-i,p=f+i;for(let g=0;g!==i;++g){const m=t[f+g];if(m!==t[d+g]||m!==t[p+g]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const f=a*i,d=o*i;for(let p=0;p!==i;++p)t[d+p]=t[f+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=ea(e,0,o),this.values=ea(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=ea(this.times,0),t=ea(this.values,0),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}u(br,"KeyframeTrack");br.prototype.TimeBufferType=Float32Array;br.prototype.ValueBufferType=Float32Array;br.prototype.DefaultInterpolation=Vl;class sc extends br{}u(sc,"BooleanKeyframeTrack");sc.prototype.ValueTypeName="bool";sc.prototype.ValueBufferType=Array;sc.prototype.DefaultInterpolation=Iu;sc.prototype.InterpolantFactoryMethodLinear=void 0;sc.prototype.InterpolantFactoryMethodSmooth=void 0;class Sb extends br{}u(Sb,"ColorKeyframeTrack");Sb.prototype.ValueTypeName="color";class Gl extends br{}u(Gl,"NumberKeyframeTrack");Gl.prototype.ValueTypeName="number";class BP extends ch{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(s-t);let c=e*a;for(let h=c+a;c!==h;c+=4)je.slerpFlat(r,0,o,c-a,o,c,l);return r}}u(BP,"QuaternionLinearInterpolant");class Oo extends br{InterpolantFactoryMethodLinear(e){return new BP(this.times,this.values,this.getValueSize(),e)}}u(Oo,"QuaternionKeyframeTrack");Oo.prototype.ValueTypeName="quaternion";Oo.prototype.DefaultInterpolation=Vl;Oo.prototype.InterpolantFactoryMethodSmooth=void 0;class rc extends br{}u(rc,"StringKeyframeTrack");rc.prototype.ValueTypeName="string";rc.prototype.ValueBufferType=Array;rc.prototype.DefaultInterpolation=Iu;rc.prototype.InterpolantFactoryMethodLinear=void 0;rc.prototype.InterpolantFactoryMethodSmooth=void 0;class Hl extends br{}u(Hl,"VectorKeyframeTrack");Hl.prototype.ValueTypeName="vector";class Cb{constructor(e,t=-1,i,s=ez){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=pr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(aV(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(br.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=rV(l);l=C2(l,1,h),c=C2(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Gl(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const f=h[1];let d=s[f];d||(s[f]=d=[]),d.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=u(function(f,d,p,g,m){if(p.length!==0){const v=[],y=[];kP(p,v,y,g),v.length!==0&&m.push(new f(d,v,y))}},"addNonemptyTrack"),s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let f=0;f<c.length;f++){const d=c[f].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let g;for(g=0;g<d.length;g++)if(d[g].morphTargets)for(let m=0;m<d[g].morphTargets.length;m++)p[d[g].morphTargets[m]]=-1;for(const m in p){const v=[],y=[];for(let b=0;b!==d[g].morphTargets.length;++b){const _=d[g];v.push(_.time),y.push(_.morphTarget===m?1:0)}s.push(new Gl(".morphTargetInfluence["+m+"]",v,y))}l=p.length*o}else{const p=".bones["+t[f].name+"]";i(Hl,p+".position",d,"pos",s),i(Oo,p+".quaternion",d,"rot",s),i(Hl,p+".scale",d,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}u(Cb,"AnimationClip");function oV(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Gl;case"vector":case"vector2":case"vector3":case"vector4":return Hl;case"color":return Sb;case"quaternion":return Oo;case"bool":case"boolean":return sc;case"string":return rc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}u(oV,"getTrackTypeForValueTypeName");function aV(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=oV(n.type);if(n.times===void 0){const t=[],i=[];kP(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}u(aV,"parseKeyframeTrack");const Nu={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Eb{constructor(e,t,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,f){return c.push(h,f),this},this.removeHandler=function(h){const f=c.indexOf(h);return f!==-1&&c.splice(f,2),this},this.getHandler=function(h){for(let f=0,d=c.length;f<d;f+=2){const p=c[f],g=c[f+1];if(p.global&&(p.lastIndex=0),p.test(h))return g}return null}}}u(Eb,"LoadingManager");const lV=new Eb;class Ha{constructor(e){this.manager=e!==void 0?e:lV,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}u(Ha,"Loader");const Qr={};class UP extends Error{constructor(e,t){super(e),this.response=t}}u(UP,"HttpError");class jd extends Ha{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Nu.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Qr[e]!==void 0){Qr[e].push({onLoad:t,onProgress:i,onError:s});return}Qr[e]=[],Qr[e].push({onLoad:t,onProgress:i,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||c.body===void 0||c.body.getReader===void 0)return c;const h=Qr[e],f=c.body.getReader(),d=c.headers.get("Content-Length"),p=d?parseInt(d):0,g=p!==0;let m=0;const v=new ReadableStream({start(y){b();function b(){f.read().then(({done:_,value:x})=>{if(_)y.close();else{m+=x.byteLength;const w=new ProgressEvent("progress",{lengthComputable:g,loaded:m,total:p});for(let M=0,C=h.length;M<C;M++){const A=h[M];A.onProgress&&A.onProgress(w)}y.enqueue(x),b()}})}u(b,"readData")}});return new Response(v)}else throw new UP(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const f=/charset="?([^;"\s]*)"?/i.exec(a),d=f&&f[1]?f[1].toLowerCase():void 0,p=new TextDecoder(d);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{Nu.add(e,c);const h=Qr[e];delete Qr[e];for(let f=0,d=h.length;f<d;f++){const p=h[f];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=Qr[e];if(h===void 0)throw this.manager.itemError(e),c;delete Qr[e];for(let f=0,d=h.length;f<d;f++){const p=h[f];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}u(jd,"FileLoader");class $P extends Ha{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Nu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=_d("img");function l(){h(),Nu.add(e,this),t&&t(this),r.manager.itemEnd(e)}u(l,"onImageLoad");function c(f){h(),s&&s(f),r.manager.itemError(e),r.manager.itemEnd(e)}u(c,"onImageError");function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return u(h,"removeEventListeners"),a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}u($P,"ImageLoader");class Xd extends Ha{constructor(e){super(e)}load(e,t,i,s){const r=new ii,o=new $P(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}u(Xd,"TextureLoader");class uh extends Pt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Te(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}u(uh,"Light");class VP extends uh{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.groundColor=new Te(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}u(VP,"HemisphereLight");const hv=new ve,E2=new T,T2=new T;class k0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ke(512,512),this.map=null,this.mapPass=null,this.matrix=new ve,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Hd,this._frameExtents=new ke(1,1),this._viewportCount=1,this._viewports=[new Dt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;E2.setFromMatrixPosition(e.matrixWorld),t.position.copy(E2),T2.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(T2),t.updateMatrixWorld(),hv.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hv),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(hv)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}u(k0,"LightShadow");class GP extends k0{constructor(){super(new di(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=yd*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}u(GP,"SpotLightShadow");class N0 extends uh{constructor(e,t,i=0,s=Math.PI/3,r=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.target=new Pt,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new GP}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}u(N0,"SpotLight");const P2=new ve,Oh=new T,fv=new T;class HP extends k0{constructor(){super(new di(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ke(4,2),this._viewportCount=6,this._viewports=[new Dt(2,1,1,1),new Dt(0,1,1,1),new Dt(3,1,1,1),new Dt(1,1,1,1),new Dt(3,0,1,1),new Dt(1,0,1,1)],this._cubeDirections=[new T(1,0,0),new T(-1,0,0),new T(0,0,1),new T(0,0,-1),new T(0,1,0),new T(0,-1,0)],this._cubeUps=[new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,1,0),new T(0,0,1),new T(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Oh.setFromMatrixPosition(e.matrixWorld),i.position.copy(Oh),fv.copy(i.position),fv.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(fv),i.updateMatrixWorld(),s.makeTranslation(-Oh.x,-Oh.y,-Oh.z),P2.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(P2)}}u(HP,"PointLightShadow");class Ra extends uh{constructor(e,t,i=0,s=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new HP}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}u(Ra,"PointLight");class WP extends k0{constructor(){super(new Va(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}u(WP,"DirectionalLightShadow");class F0 extends uh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Pt.DefaultUp),this.updateMatrix(),this.target=new Pt,this.shadow=new WP}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}u(F0,"DirectionalLight");class z0 extends uh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}u(z0,"AmbientLight");class mr{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}u(mr,"LoaderUtils");class jP extends Ha{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Nu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Nu.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){s&&s(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}u(jP,"ImageBitmapLoader");class XP{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=R2(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=R2();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}u(XP,"Clock");function R2(){return(typeof performance=="undefined"?Date:performance).now()}u(R2,"now");const Tb="\\[\\]\\.:\\/",cV=new RegExp("["+Tb+"]","g"),Pb="[^"+Tb+"]",uV="[^"+Tb.replace("\\.","")+"]",hV=/((?:WC+[\/:])*)/.source.replace("WC",Pb),fV=/(WCOD+)?/.source.replace("WCOD",uV),dV=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Pb),pV=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Pb),mV=new RegExp("^"+hV+fV+dV+pV+"$"),gV=["material","materials","bones","map"];class YP{constructor(e,t,i){const s=i||bt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}u(YP,"Composite");class bt{constructor(e,t,i){this.path=t,this.parsedPath=i||bt.parseTrackName(t),this.node=bt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new bt.Composite(e,t,i):new bt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(cV,"")}static parseTrackName(e){const t=mV.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);gV.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=u(function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},"searchNodeSubtree"),s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=bt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}u(bt,"PropertyBinding");bt.Composite=YP;bt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};bt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};bt.prototype.GetterByBindingType=[bt.prototype._getValue_direct,bt.prototype._getValue_array,bt.prototype._getValue_arrayElement,bt.prototype._getValue_toArray];bt.prototype.SetterByBindingTypeAndVersioning=[[bt.prototype._setValue_direct,bt.prototype._setValue_direct_setNeedsUpdate,bt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_array,bt.prototype._setValue_array_setNeedsUpdate,bt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_arrayElement,bt.prototype._setValue_arrayElement_setNeedsUpdate,bt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_fromArray,bt.prototype._setValue_fromArray_setNeedsUpdate,bt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class qP{constructor(e,t,i=0,s=1/0){this.ray=new $a(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new S0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return v_(e,this,i,t),i.sort(I2),i}intersectObjects(e,t=!0,i=[]){for(let s=0,r=e.length;s<r;s++)v_(e[s],this,i,t);return i.sort(I2),i}}u(qP,"Raycaster");function I2(n,e){return n.distance-e.distance}u(I2,"ascSort");function v_(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const s=n.children;for(let r=0,o=s.length;r<o;r++)v_(s[r],e,t,!0)}}u(v_,"intersectObject");const D2=new T;class ZP extends Pt{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new it,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new Ve(s,3));const r=new Di({fog:!1,toneMapped:!1});this.cone=new vr(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),D2.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(D2),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}u(ZP,"SpotLightHelper");class KP extends We{constructor(e,t,i){const s=new O0(t,4,2),r=new ji({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}u(KP,"PointLightHelper");const vV=new T,L2=new Te,O2=new Te;class QP extends Pt{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const s=new L0(t);s.rotateY(Math.PI*.5),this.material=new ji({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new mn(o,3)),this.add(new We(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");L2.copy(this.light.color),O2.copy(this.light.groundColor);for(let i=0,s=t.count;i<s;i++){const r=i<s/2?L2:O2;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(vV.setFromMatrixPosition(this.light.matrixWorld).negate())}}u(QP,"HemisphereLightHelper");const k2=new T,Vp=new T,N2=new T;class JP extends Pt{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,t===void 0&&(t=1);let s=new it;s.setAttribute("position",new Ve([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Di({fog:!1,toneMapped:!1});this.lightPlane=new js(s,r),this.add(this.lightPlane),s=new it,s.setAttribute("position",new Ve([0,0,0,0,0,1],3)),this.targetLine=new js(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){k2.setFromMatrixPosition(this.light.matrixWorld),Vp.setFromMatrixPosition(this.light.target.matrixWorld),N2.subVectors(Vp,k2),this.lightPlane.lookAt(Vp),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Vp),this.targetLine.scale.z=N2.length()}}u(JP,"DirectionalLightHelper");const Gp=new T,An=new T0;class eR extends vr{constructor(e){const t=new it,i=new Di({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(g,m){l(g),l(m)}u(a,"addLine");function l(g){s.push(0,0,0),r.push(0,0,0),o[g]===void 0&&(o[g]=[]),o[g].push(s.length/3-1)}u(l,"addPoint"),t.setAttribute("position",new Ve(s,3)),t.setAttribute("color",new Ve(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new Te(16755200),h=new Te(16711680),f=new Te(43775),d=new Te(16777215),p=new Te(3355443);this.setColors(c,h,f,d,p)}setColors(e,t,i,s,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,s=1;An.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Pn("c",t,e,An,0,0,-1),Pn("t",t,e,An,0,0,1),Pn("n1",t,e,An,-i,-s,-1),Pn("n2",t,e,An,i,-s,-1),Pn("n3",t,e,An,-i,s,-1),Pn("n4",t,e,An,i,s,-1),Pn("f1",t,e,An,-i,-s,1),Pn("f2",t,e,An,i,-s,1),Pn("f3",t,e,An,-i,s,1),Pn("f4",t,e,An,i,s,1),Pn("u1",t,e,An,i*.7,s*1.1,-1),Pn("u2",t,e,An,-i*.7,s*1.1,-1),Pn("u3",t,e,An,0,s*2,-1),Pn("cf1",t,e,An,-i,0,1),Pn("cf2",t,e,An,i,0,1),Pn("cf3",t,e,An,0,-s,1),Pn("cf4",t,e,An,0,s,1),Pn("cn1",t,e,An,-i,0,-1),Pn("cn2",t,e,An,i,0,-1),Pn("cn3",t,e,An,0,-s,-1),Pn("cn4",t,e,An,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}u(eR,"CameraHelper");function Pn(n,e,t,i,s,r,o){Gp.set(s,r,o).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],Gp.x,Gp.y,Gp.z)}}u(Pn,"setPoint");typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:db}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=db);var yV=Object.defineProperty,wg=u((n,e)=>yV(n,"name",{value:e,configurable:!0}),"__name$3m");function Wl(n,e,t){let i,s,r=wg(a=>e(a),"_onDragMove"),o=wg(a=>(document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",i),document.removeEventListener("pointerout",s),t&&t(a)),"_onDragEnd");i=o,s=wg(a=>{(!a.relatedTarget||a.relatedTarget.nodeName==="HTML")&&o(a)},"onPointerOut"),document.addEventListener("pointermove",r),document.addEventListener("pointerup",i),document.addEventListener("pointerout",s),n&&r(n)}u(Wl,"addGlobalDragListener");wg(Wl,"addGlobalDragListener");var _V=Object.defineProperty,Hp=u((n,e)=>_V(n,"name",{value:e,configurable:!0}),"__name$3l");const F2="color-box",z2="color-box-active";var bV=zt({props:{value:{type:Array,default:[1,1,1]},colorBox:Boolean},emits:["update:value"],setup(n,e){const t=Ge(),i=Ge(),s=160/2,r=13,o=To(new Te),a=To({h:0,s:0,l:0}),l=Ge(0),c=Ge(0),h=Ge(0),f=Ge(0),d=To([16777215,16777215,16777215,16777215,16777215,16777215,16777215,16777215]);try{const M=localStorage.getItem(F2);if(M){const A=JSON.parse(M);for(let P=0,D=d.length;P<D;++P)d[P]=A[P]}const C=localStorage.getItem(z2);C&&(f.value=JSON.parse(C))}catch(M){console.error(M)}qi(d,function(){!n.colorBox||localStorage.setItem(F2,JSON.stringify(d))},{deep:!0}),qi(f,function(){!n.colorBox||localStorage.setItem(z2,JSON.stringify(f.value))}),qi(()=>n.value,function(){o.setRGB(n.value[0],n.value[1],n.value[2]),o.getHSL(a);let M=a.h,C=a.s,A=a.l,P=C*Math.min(A,1-A)+A;C=P?2-2*A/P:0,(C||P||h.value&&!C&&!P)&&(c.value=C,h.value=P),C&&(l.value=M),d[f.value]=o.getHex()},{immediate:!0});const p=st(function(){return o.getHexString()}),g=st(function(){return d.map(M=>new Te().setHex(M).getHexString())}),m=st(function(){return{transform:`rotate(${Math.round(l.value*360)-60}deg)`,"transform-origin":`0 ${s}px`}}),v=st(function(){return{"background-color":`#${new Te().setHSL(l.value,1,.5).getHexString()}`}}),y=st(function(){return{left:`${Math.round(100*c.value)}%`,top:`${Math.round(100*(1-h.value))}%`}});function b(M){M.stopPropagation();const C=t.value.getBoundingClientRect(),A=s,P=s,D=M.clientX-C.left,k=M.clientY-C.top,O=Math.sqrt((D-A)**2+(k-P)**2);O>=s-r&&O<=s&&Wl(M,N=>{const E=N.clientX-C.left-A,B=N.clientY-C.top-P,Z=(Math.atan2(B,E)/Math.PI*180+360*2+90+60)%360/360,ne=new Te().setHSL(Z,a.s,a.l);e.emit("update:value",[ne.r,ne.g,ne.b]),l.value=Z})}u(b,"onHueRingMouseDown"),Hp(b,"onHueRingMouseDown");function _(M){M.stopPropagation();const C=i.value.getBoundingClientRect();Wl(M,A=>{let P=Math.min(Math.max(A.clientX-C.left,0),C.width)/C.width,D=1-Math.min(Math.max(A.clientY-C.top,0),C.height)/C.height;c.value=P,h.value=D;let k=D-D*P/2,O=Math.min(k,1-k);P=O?(D-k)/O:0;const N=new Te().setHSL(l.value,P,k);e.emit("update:value",[N.r,N.g,N.b])})}u(_,"onSvRectMouseDown"),Hp(_,"onSvRectMouseDown");function x(M){const A=(M.target.value||"").trim();if(/^([a-fA-F0-9]{6})$/.test(A)){const P=Number.parseInt(A.substring(0,6),16),D=new Te().setHex(P);e.emit("update:value",[D.r,D.g,D.b])}}u(x,"onTextInput"),Hp(x,"onTextInput");function w(M){f.value=M;const C=new Te().setHex(d[M]);e.emit("update:value",[C.r,C.g,C.b])}return u(w,"onBoxClick"),Hp(w,"onBoxClick"),{hueRing:t,svRect:i,activeBox:f,hex:p,colorBoxHex:g,hueRingHandlerStyle:m,svRectStyle:v,svRectHandlerStyle:y,onHueRingMouseDown:b,onSvRectMouseDown:_,onTextInput:x,onBoxClick:w}}});const Rb=u(n=>(Fa("data-v-3618be33"),n=n(),za(),n),"_withScopeId$6"),wV={class:"color-picker"},xV={class:"hue-ring-inner"},AV=Rb(()=>ue("div",{class:"bg1 bg"},null,-1)),MV=Rb(()=>ue("div",{class:"bg2 bg"},null,-1)),SV={class:"color-value"},CV=Rb(()=>ue("span",null,"#",-1)),EV=["value"],TV={key:0,class:"color-box"},PV=["onClick"];function RV(n,e,t,i,s,r){return Ce(),Be("div",wV,[ue("div",{class:"hue-ring",onPointerdown:e[1]||(e[1]=(...o)=>n.onHueRingMouseDown&&n.onHueRingMouseDown(...o)),ref:"hueRing"},[ue("div",{class:"hue-ring-handler",style:ti(n.hueRingHandlerStyle)},null,4),ue("div",xV,[ue("div",{class:"sv-rect",style:ti(n.svRectStyle),onPointerdown:e[0]||(e[0]=(...o)=>n.onSvRectMouseDown&&n.onSvRectMouseDown(...o)),ref:"svRect"},[AV,MV,ue("div",{class:"sv-rect-handler",style:ti(n.svRectHandlerStyle)},null,4)],36)])],544),ue("div",SV,[ue("div",{class:"block",style:ti({"background-color":`#${n.hex}`})},null,4),CV,ue("input",{type:"text",value:n.hex,onInput:e[2]||(e[2]=(...o)=>n.onTextInput&&n.onTextInput(...o))},null,40,EV)]),n.colorBox?(Ce(),Be("div",TV,[(Ce(!0),Be(Nt,null,Ta(n.colorBoxHex,(o,a)=>(Ce(),Be("div",{class:bn(["color",{active:n.activeBox===a}]),style:ti({"background-color":`#${o}`}),onClick:l=>n.onBoxClick(a)},null,14,PV))),256))])):tt("",!0)])}u(RV,"_sfc_render$s");var tR=Wt(bV,[["render",RV],["__scopeId","data-v-3618be33"]]);const IV={},DV=u(n=>(Fa("data-v-488ada72"),n=n(),za(),n),"_withScopeId$5"),LV=DV(()=>ue("div",{class:"fullscreen-loading"},[ue("div",{class:"lds-dual-ring"})],-1));function OV(n,e){return Ce(),sn(cb,{to:"body"},[LV])}u(OV,"_sfc_render$r");var kV=Wt(IV,[["render",OV],["__scopeId","data-v-488ada72"]]),NV=Object.defineProperty,FV=u((n,e)=>NV(n,"name",{value:e,configurable:!0}),"__name$3k"),zV=zt({props:{value:Boolean,label:String},emits:["input"],setup(n,e){function t(){e.emit("input",!n.value)}return u(t,"flip"),FV(t,"flip"),{flip:t}}});const BV={class:"input-boolean"};function UV(n,e,t,i,s,r){return Ce(),Be("div",BV,[ue("div",{class:bn(["input-boolean__checkbox",{checked:!!n.value}]),onClick:e[0]||(e[0]=(...o)=>n.flip&&n.flip(...o))},null,2),n.label?(Ce(),Be("div",{key:0,class:"input-boolean__label",onClick:e[1]||(e[1]=(...o)=>n.flip&&n.flip(...o))},Tn(n.label),1)):tt("",!0)])}u(UV,"_sfc_render$q");var $o=Wt(zV,[["render",UV],["__scopeId","data-v-271a8ef3"]]),$V=Object.defineProperty,Wp=u((n,e)=>$V(n,"name",{value:e,configurable:!0}),"__name$3j"),VV=zt({props:{value:Number,readonly:Boolean,disabled:Boolean,min:Number,max:Number,step:Number,resettable:Boolean,defaultValue:Number},emits:["input"],setup(n,e){const t=Ge();let i=!1;function s(){i&&(o(),document.removeEventListener("mousedown",s))}u(s,"postOnMouseDown"),Wp(s,"postOnMouseDown");function r(){i||(i=!0,document.addEventListener("mousedown",s))}u(r,"onChange"),Wp(r,"onChange"),Ba(function(){document.removeEventListener("mousedown",s)});function o(){if(i){i=!1;const l=t.value;if(l){const c=l.value;let h=Number(c);isFinite(h)||(h=0),n.step!=null&&(h=Math.round(h/n.step)*n.step),n.min!=null&&(h=Math.max(n.min,h)),n.max!=null&&(h=Math.min(n.max,h)),e.emit("input",h)}}}u(o,"onPost"),Wp(o,"onPost");function a(){e.emit("input",n.defaultValue||0)}return u(a,"onReset"),Wp(a,"onReset"),{inputDom:t,onChange:r,onPost:o,onReset:a}}}),B0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFxJREFUSIntlEsOACEIQ2Xuf+e6MkFiLCN+Nryl0AoxtZQkiSLeRgDohCJuLTW25vZ8VHebrw7Q+JZu/jHAGbEitME1jr1BCChY36xON9gWKIsOEQvajPdfRZJQKkl2V7+RNsIHAAAAAElFTkSuQmCC";const GV=u(n=>(Fa("data-v-3550c3d4"),n=n(),za(),n),"_withScopeId$4"),HV={class:"input-number"},WV=["value","readonly","disabled"],jV=GV(()=>ue("img",{src:B0,alt:""},null,-1)),XV=[jV];function YV(n,e,t,i,s,r){return Ce(),Be("div",HV,[ue("input",{type:"text",value:n.value,readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,WV),n.resettable?(Ce(),Be("button",{key:0,class:"normal-button",onClick:e[3]||(e[3]=(...o)=>n.onReset&&n.onReset(...o))},XV)):tt("",!0)])}u(YV,"_sfc_render$p");var Jn=Wt(VV,[["render",YV],["__scopeId","data-v-3550c3d4"]]),qV=Object.defineProperty,B2=u((n,e)=>qV(n,"name",{value:e,configurable:!0}),"__name$3i"),ZV=zt({props:{value:{type:Number,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},fractionDigits:Number,label:String},emits:["update:value"],setup(n,e){const t=Ge(),i=st(function(){return n.value.toFixed(n.fractionDigits)}),s=st(function(){return{width:`${Math.round((n.value-n.min)/(n.max-n.min)*100)}%`}});function r(a){Wl(a,function(l){const c=t.value.getBoundingClientRect();let f=Math.max(0,Math.min(1,(l.clientX-c.left)/c.width))*(n.max-n.min)+n.min;f=Math.round(f/n.step)*n.step,e.emit("update:value",f)})}u(r,"onMouseDown"),B2(r,"onMouseDown");function o(a){switch(a.key){case"ArrowLeft":e.emit("update:value",Math.max(n.min,n.value-n.step));break;case"ArrowRight":e.emit("update:value",Math.min(n.max,n.value+n.step));break}}return u(o,"onKeyDown"),B2(o,"onKeyDown"),{dom:t,valueText:i,barStyle:s,onMouseDown:r,onKeyDown:o}}});const KV={class:"label"},QV={class:"value"};function JV(n,e,t,i,s,r){return Ce(),Be("div",{class:"label-range",onPointerdown:e[0]||(e[0]=(...o)=>n.onMouseDown&&n.onMouseDown(...o)),ref:"dom",tabindex:"0",onKeydown:e[1]||(e[1]=(...o)=>n.onKeyDown&&n.onKeyDown(...o))},[ue("div",{class:"bar",style:ti(n.barStyle)},null,4),ue("div",KV,Tn(n.label),1),ue("div",QV,Tn(n.valueText),1)],544)}u(JV,"_sfc_render$o");var e8=Wt(ZV,[["render",JV],["__scopeId","data-v-2e301f78"]]);const Gg={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class hh{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}u(hh,"Pass");const t8=new Va(-1,1,1,-1,0,1),Ib=new it;Ib.setAttribute("position",new Ve([-1,3,0,-1,-1,0,3,-1,0],3));Ib.setAttribute("uv",new Ve([0,2,0,0,2,0],2));class Db{constructor(e){this._mesh=new We(Ib,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,t8)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}u(Db,"FullScreenQuad");class y_ extends hh{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Ti?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=E0.clone(e.uniforms),this.material=new Ti({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Db(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}u(y_,"ShaderPass");class __ extends hh{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),r.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(s.EQUAL,1,4294967295),r.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),r.buffers.stencil.setLocked(!0)}}u(__,"MaskPass");class nR extends hh{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}u(nR,"ClearMaskPass");class iR{constructor(e,t){if(this.renderer=e,t===void 0){const i=e.getSize(new ke);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,t=new yi(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Gg===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),y_===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new y_(Gg),this.clock=new XP}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let s=0,r=this.passes.length;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}__!==void 0&&(o instanceof __?i=!0:o instanceof nR&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ke);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}u(iR,"EffectComposer");new Va(-1,1,1,-1,0,1);const sR=new it;sR.setAttribute("position",new Ve([-1,3,0,-1,-1,0,3,-1,0],3));sR.setAttribute("uv",new Ve([0,2,0,0,2,0],2));class zr extends hh{constructor(e,t,i,s){super(),this.renderScene=t,this.renderCamera=i,this.selectedObjects=s!==void 0?s:[],this.visibleEdgeColor=new Te(1,1,1),this.hiddenEdgeColor=new Te(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new ke(e.x,e.y):new ke(256,256);const r=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new yi(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new wb,this.depthMaterial.side=Ts,this.depthMaterial.depthPacking=aP,this.depthMaterial.blending=Br,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Ts,this.prepareMaskMaterial.fragmentShader=h(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new yi(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new yi(r,o),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new yi(r,o),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new yi(Math.round(r/2),Math.round(o/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new yi(r,o),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new yi(Math.round(r/2),Math.round(o/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const a=4,l=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(a),this.separableBlurMaterial1.uniforms.texSize.value.set(r,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(l),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(r/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=l,this.overlayMaterial=this.getOverlayMaterial(),Gg===void 0&&console.error("THREE.OutlinePass relies on CopyShader");const c=Gg;this.copyUniforms=E0.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Ti({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:Br,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Te,this.oldClearAlpha=1,this.fsQuad=new Db(null),this.tempPulseColor1=new Te,this.tempPulseColor2=new Te,this.textureMatrix=new ve;function h(f,d){const p=d.isPerspectiveCamera?"perspective":"orthographic";return f.replace(/DEPTH_TO_VIEW_Z/g,p+"DepthToViewZ")}u(h,"replaceDepthToViewZ")}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let i=Math.round(e/this.downSampleRatio),s=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,s),this.renderTargetBlurBuffer1.setSize(i,s),this.renderTargetEdgeBuffer1.setSize(i,s),this.separableBlurMaterial1.uniforms.texSize.value.set(i,s),i=Math.round(i/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(i,s),this.renderTargetEdgeBuffer2.setSize(i,s),this.separableBlurMaterial2.uniforms.texSize.value.set(i,s)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function i(s){s.isMesh&&(e===!0?s.visible=t.get(s):(t.set(s,s.visible),s.visible=e))}u(i,"gatherSelectedMeshesCallBack");for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(i)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,i=[];function s(o){o.isMesh&&i.push(o)}u(s,"gatherSelectedMeshesCallBack");for(let o=0;o<this.selectedObjects.length;o++)this.selectedObjects[o].traverse(s);function r(o){if(o.isMesh||o.isSprite){let a=!1;for(let l=0;l<i.length;l++)if(i[l].id===o.id){a=!0;break}if(a===!1){const l=o.visible;(e===!1||t.get(o)===!0)&&(o.visible=e),t.set(o,l)}}else(o.isPoints||o.isLine)&&(e===!0?o.visible=t.get(o):(t.set(o,o.visible),o.visible=e))}u(r,"VisibilityChangeCallBack"),this.renderScene.traverse(r)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,i,s,r){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,r&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+Math.cos(performance.now()*.01/this.pulsePeriod)*.75/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=zr.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=zr.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=zr.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=zr.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(i),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new Ti({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new ke(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new Ti({uniforms:{maskTexture:{value:null},texSize:{value:new ke(.5,.5)},visibleEdgeColor:{value:new T(1,1,1)},hiddenEdgeColor:{value:new T(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new Ti({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new ke(.5,.5)},direction:{value:new ke(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new Ti({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:a_,depthTest:!1,depthWrite:!1,transparent:!0})}}u(zr,"OutlinePass");zr.BlurDirectionX=new ke(1,0);zr.BlurDirectionY=new ke(0,1);class rR extends hh{constructor(e,t,i,s,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Te}render(e,t,i){const s=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=s}}u(rR,"RenderPass");var n8=Object.defineProperty,i8=u((n,e)=>n8(n,"name",{value:e,configurable:!0}),"__name$3h");class Lb{constructor(){S(this,"shadingMode","solid");S(this,"enablePressure",!0);S(this,"remeshVoxelSize",.003);S(this,"paintColor",[1,0,1]);S(this,"allowSelectingInvisibleObjectByClicking",!0);S(this,"keepTransformUnchangedWhileMoving",!0);S(this,"useLocalSpaceForTransformControl",!0);S(this,"takeGeometryCenterAsTransformOrigin",!0);S(this,"allowModifyingBoneLengthWhenBindingIk",!0);S(this,"keepInternalTransformWhenBindingIk",!0);S(this,"keepBothEndsOfClayNodesWhenStretching",!0);S(this,"quadView",!1);S(this,"outlineSelected",!0);S(this,"showGrids",!0);S(this,"showLightHelpers",!1);S(this,"showIkBones",!1);S(this,"tools",{})}}u(Lb,"EditorOptions");i8(Lb,"EditorOptions");var s8=Object.defineProperty,r8=u((n,e)=>s8(n,"name",{value:e,configurable:!0}),"__name$3g");const U2=new lt,o8=new T,dv=new je;class Ob{constructor(){S(this,"perspective",!0);S(this,"perspectiveCamera",new di(45,1,.1,2e3));S(this,"orthographicCamera",new Va(-1,1,-1,1,0,2e3));S(this,"target",new T);S(this,"distance",1);S(this,"alpha",0);S(this,"beta",0);S(this,"_position",new T);S(this,"_up",new T);S(this,"_dir",new T)}get(){return this.perspective?this.perspectiveCamera:this.orthographicCamera}update(e,t){U2.set(0,this.beta,-this.alpha),dv.setFromEuler(U2),this._position.set(this.distance,0,0),this._position.applyQuaternion(dv),this._position.add(this.target);const i=this.get();if(i.position.copy(this._position),this._up.set(0,1,0),this._dir.subVectors(this._position,this.target).normalize(),o8.crossVectors(this._up,this._dir).lengthSq()<1e-8&&this._up.applyQuaternion(dv),i.up.copy(this._up),i.lookAt(this.target),this.perspective)this.perspectiveCamera.aspect=e/t;else{const s=this.distance/850,r=e/2*s,o=t/2*s;this.orthographicCamera.left=-r,this.orthographicCamera.right=+r,this.orthographicCamera.bottom=-o,this.orthographicCamera.top=+o}i.updateProjectionMatrix()}}u(Ob,"ArcRotateCamera");r8(Ob,"ArcRotateCamera");var a8=Object.defineProperty,Ds=u((n,e)=>a8(n,"name",{value:e,configurable:!0}),"__name$3f");const Ht=function(){const n=new T,e=new T;return function(t,i,s,r,o){n.subVectors(s,i);const a=n.length();if(a<1e-8)return!1;n.divideScalar(a);const l=n.dot(o);if(Math.abs(l)<1e-8)return!1;e.subVectors(r,i);const c=e.dot(o)/l;return t.copy(i),t.addScaledVector(n,c),!0}}();function b_(n,e,t,i,s){let r=t.x-e.x,o=t.y-e.y,a=t.z-e.z;const l=e.x-i.x,c=e.y-i.y,h=e.z-i.z,f=r**2+o**2+a**2,d=2*(r*l+o*c+a*h),p=l**2+c**2+h**2-s**2,g=d**2-4*f*p;if(g<0)return!1;const m=Math.sqrt(g),v=(-d+m)/(2*f),y=(-d-m)/(2*f),b=Math.min(v,y);return n.x=e.x+r*b,n.y=e.y+o*b,n.z=e.z+a*b,!0}u(b_,"raySphereIntersect");Ds(b_,"raySphereIntersect");const xd=new T,Ad=new je,Fu=new T;function zu(n,e){return e.decompose(xd,Ad,Fu),n.copy(xd),n}u(zu,"getTranslation");Ds(zu,"getTranslation");function oR(n,e){return e.decompose(xd,Ad,Fu),n.copy(Ad),n}u(oR,"getRotation");Ds(oR,"getRotation");function aR(n,e){return e.decompose(xd,Ad,Fu),n.copy(Fu),n}u(aR,"getScale");Ds(aR,"getScale");function Sa(n){return n.decompose(xd,Ad,Fu),Fu.x}u(Sa,"getScaleScalar");Ds(Sa,"getScaleScalar");function Ao(n,e,t,i,s,r){let o=t.x,a=t.y,l=t.z,c=i.x,h=i.y,f=i.z,d=s.x,p=s.y,g=s.z,m=r.x,v=r.y,y=r.z,b=c**2*v**2+c**2*y**2-2*c*h*m*v-2*c*f*m*y+h**2*m**2+h**2*y**2-2*h*f*v*y+f**2*m**2+f**2*v**2,_=!1,x=(c*m*v*a-c*m*v*p+c*m*y*l-c*m*y*g-c*v**2*o+c*v**2*d-c*y**2*o+c*y**2*d-h*m**2*a+h*m**2*p+h*m*v*o-h*m*v*d+h*v*y*l-h*v*y*g-h*y**2*a+h*y**2*p-f*m**2*l+f*m**2*g+f*m*y*o-f*m*y*d-f*v**2*l+f*v**2*g+f*v*y*a-f*v*y*p)/b;isFinite(x)||(_=!0,x=0);let w=o+c*x,M=a+h*x,C=l+f*x;if(n&&(n.x=w,n.y=M,n.z=C),e){let A=(-c*v*l+c*v*g+c*y*a-c*y*p+h*m*l-h*m*g-h*y*o+h*y*d-f*m*a+f*m*p+f*v*o-f*v*d)/b;if(isFinite(A)){let P=h*y-f*v,D=-c*y+f*m,k=c*v-h*m;e.x=w+P*A,e.y=M+D*A,e.z=C+k*A}else{_=!0;let P=h*(l-g)-f*(a-p),D=-c*(l-g)+f*(o-d),k=c*(a-p)-h*(o-d);e.x=w+h*k-f*D,e.y=M+-c*k+f*P,e.z=C+c*D-h*P}}return _}u(Ao,"closestPointsBetweenTwoLines");Ds(Ao,"closestPointsBetweenTwoLines");const Oa=function(){const n=new T,e=new T,t=new ve;return function(i,s,r){return n.crossVectors(r,s).normalize(),e.crossVectors(s,n).normalize(),t.set(n.x,n.y,n.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,0,0,0,0,1).transpose(),i.setFromRotationMatrix(t)}}();function bu(n,e){return n.x=Math.round(n.x/e)*e,n.y=Math.round(n.y/e)*e,n.z=Math.round(n.z/e)*e,n}u(bu,"snapPoint");Ds(bu,"snapPoint");function wr(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8}u(wr,"vectorsEqual");Ds(wr,"vectorsEqual");function lR(n,e,t){const i=Math.min(e.x,t.x),s=Math.max(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.y,t.y),a=n.x,l=n.y;return!(a<i||a>s||l<r||l>o)}u(lR,"intersectPointRect");Ds(lR,"intersectPointRect");const l8=function(){const n=new T,e=new T,t=new T;return function(i,s,r,o,a,l,c,h){n.subVectors(s,r);const f=l.dot(n),d=c.dot(n);if(f<=0&&d<=0)return i.copy(r);e.subVectors(s,o);const p=l.dot(e),g=c.dot(e);if(p>=0&&g<=p)return i.copy(o);t.subVectors(s,a);const m=l.dot(t),v=c.dot(t);if(v>=0&&m<=v)return i.copy(a);const y=f*g-p*d;if(y<=0&&f>=0&&p<=0){const C=f/(f-p);return i.copy(r).addScaledVector(l,C)}const b=m*d-f*v;if(b<=0&&d>=0&&v<=0){const C=d/(d-v);return i.copy(r).addScaledVector(c,C)}const _=p*v-m*g;if(_<=0&&g-p>=0&&m-v>=0){const C=(g-p)/(g-p+(m-v));return i.copy(o).addScaledVector(h,C)}const x=1/(_+b+y),w=b*x,M=y*x;return i.copy(r).addScaledVector(l,w).addScaledVector(c,M)}}(),c8=function(){const n=new T,e=new T,t=new T,i=new T;return function(s,r,o,a,l){e.crossVectors(a,l);let c=r.dot(e),h;if(c>0)h=1;else if(c<0)h=-1,c=-c;else return-1;n.subVectors(s,o);const f=h*r.dot(i.crossVectors(n,l));if(f<0)return-1;const d=h*r.dot(t.crossVectors(a,n));if(d<0||d+f>c)return-1;const p=-h*n.dot(e);return p<0?-1:p/c}}(),cR=function(){const n=new T;return function(e,t,i,s){return e.copy(t).addScaledVector(i,n.subVectors(s,t).dot(i))}}(),Tl=function(){const n=new T;return function(e,t,i){return Math.atan2(n.crossVectors(t,i).dot(e),t.dot(i))}}();function Po(n,e){const t=Math.acos(e.w)*2,i=Math.sin(t/2);return i>1e-6?n.set(e.x,e.y,e.z).multiplyScalar(1/i):n.set(1,0,0),t}u(Po,"getAxisAngle");Ds(Po,"getAxisAngle");function au(n){return n=n%(Math.PI*2),n<0&&(n+=Math.PI*2),n}u(au,"simplifyAngle");Ds(au,"simplifyAngle");function w_(n,e){return Math.PI-Math.abs(Math.abs(e-n)%(Math.PI*2)-Math.PI)}u(w_,"absAngleDiff");Ds(w_,"absAngleDiff");function kb(n,e,t){if(n=au(n),t-e>1e-8&&au(t-e)<1e-8)return n;if(e=au(e),t=au(t),t<e){if(n>=0&&n<=t||n>=e)return n}else if(n>=e&&n<=t)return n;const i=w_(n,e),s=w_(n,t);return i<=s?e:t}u(kb,"clampAngle");Ds(kb,"clampAngle");var u8=Object.defineProperty,h8=u((n,e)=>u8(n,"name",{value:e,configurable:!0}),"__name$3e");const f8=16135762,d8=7316763,p8=3113955,es=new ji({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5}),Nb=new ji({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),Bf=Nb.clone();Bf.color.setHex(f8);const Uf=Nb.clone();Uf.color.setHex(d8);const $f=Nb.clone();$f.color.setHex(p8);const ar=.035,pv=.5+.04,ps=.1+ar,lu=.5-.04,m8=lu-.02,$2=.5,ta=.06,kh=lu-.06,na=.08,Jr=new T,eo=new T,to=new T,hn=new T,ci=new T,mv=new T,Nh=new T,V2=new ve,Mi=new T,ts=new je,Fh=new T,zh=new T,jp=new T,Xp=new T;class Fb extends ni{constructor(){super();S(this,"translateArrowX");S(this,"translateArrowY");S(this,"translateArrowZ");S(this,"translatePickerX");S(this,"translatePickerY");S(this,"translatePickerZ");S(this,"translateArrowXN");S(this,"translateArrowYN");S(this,"translateArrowZN");S(this,"translatePickerXN");S(this,"translatePickerYN");S(this,"translatePickerZN");S(this,"freeTranslateHandler");S(this,"freeTranslatePicker");S(this,"rotateCircleX");S(this,"rotateCircleY");S(this,"rotateCircleZ");S(this,"rotatePickerX");S(this,"rotatePickerY");S(this,"rotatePickerZ");S(this,"rotateHandlerX");S(this,"rotateHandlerY");S(this,"rotateHandlerZ");S(this,"freeRotatePicker");S(this,"viewRotateCircle");S(this,"viewRotatePicker");S(this,"scaleHandlers");S(this,"scaleCubeX");S(this,"scaleCubeY");S(this,"scaleCubeZ");S(this,"scaleAxisX");S(this,"scaleAxisY");S(this,"scaleAxisZ");S(this,"scalePickerX");S(this,"scalePickerY");S(this,"scalePickerZ");S(this,"scalePickerYZ");S(this,"scalePickerXZ");S(this,"scalePickerXY");S(this,"pickers");S(this,"size",.25);S(this,"orientation","local");S(this,"forcePositiveScale",!0);S(this,"translateSnap",.1);S(this,"rotateSnap",45/180*Math.PI);S(this,"enableTranslate",!0);S(this,"enableRotate",!0);S(this,"enableScale",!0);S(this,"dragStart",!1);S(this,"dragging",!1);S(this,"mode");S(this,"handler");S(this,"position0",new T);S(this,"rotation0",new je);S(this,"scale0",new T);S(this,"position1",new T);S(this,"rotation1",new je);S(this,"scale1",new T);S(this,"detTranslation",new T);S(this,"detRotation",new je);S(this,"detScale",new T);S(this,"mouse0",new T);S(this,"axis",new T);S(this,"raycastPanel",!1);this.renderOrder=1;const t=new ku(0,.04,.1,12);t.translate(0,.1/2,0),this.translateArrowX=new We(t,Bf.clone()),this.translateArrowY=new We(t,Uf.clone()),this.translateArrowZ=new We(t,$f.clone()),this.translateArrowX.position.set(pv,0,0),this.translateArrowX.rotation.set(0,0,-Math.PI/2),this.translateArrowY.position.set(0,pv,0),this.translateArrowY.rotation.set(0,0,0),this.translateArrowZ.position.set(0,0,pv),this.translateArrowZ.rotation.set(Math.PI/2,0,0),this.add(this.translateArrowX),this.add(this.translateArrowY),this.add(this.translateArrowZ),this.translateArrowXN=this.translateArrowX.clone(),this.translateArrowYN=this.translateArrowY.clone(),this.translateArrowZN=this.translateArrowZ.clone(),this.translateArrowXN.position.negate(),this.translateArrowYN.position.negate(),this.translateArrowZN.position.negate(),this.translateArrowXN.rotation.set(0,0,Math.PI/2),this.translateArrowYN.rotation.set(Math.PI,0,0),this.translateArrowZN.rotation.set(-Math.PI/2,0,0),this.add(this.translateArrowXN),this.add(this.translateArrowYN),this.add(this.translateArrowZN);const i=new ku(ar,.04+ar,.1+ar,12);i.translate(0,.1/2,0),this.translatePickerX=new We(i,es),this.translatePickerY=new We(i,es),this.translatePickerZ=new We(i,es),this.translatePickerX.position.copy(this.translateArrowX.position),this.translatePickerX.rotation.copy(this.translateArrowX.rotation),this.translatePickerY.position.copy(this.translateArrowY.position),this.translatePickerY.rotation.copy(this.translateArrowY.rotation),this.translatePickerZ.position.copy(this.translateArrowZ.position),this.translatePickerZ.rotation.copy(this.translateArrowZ.rotation),this.add(this.translatePickerX),this.add(this.translatePickerY),this.add(this.translatePickerZ),this.translatePickerX.visible=!1,this.translatePickerY.visible=!1,this.translatePickerZ.visible=!1,this.translatePickerX.userData.name="translate-x",this.translatePickerY.userData.name="translate-y",this.translatePickerZ.userData.name="translate-z",this.translatePickerXN=this.translatePickerX.clone(),this.translatePickerYN=this.translatePickerY.clone(),this.translatePickerZN=this.translatePickerZ.clone(),this.translatePickerXN.position.negate(),this.translatePickerYN.position.negate(),this.translatePickerZN.position.negate(),this.translatePickerXN.rotation.set(0,0,Math.PI/2),this.translatePickerYN.rotation.set(Math.PI,0,0),this.translatePickerZN.rotation.set(-Math.PI/2,0,0),this.add(this.translatePickerXN),this.add(this.translatePickerYN),this.add(this.translatePickerZN),this.translatePickerXN.userData.name="translate-x",this.translatePickerYN.userData.name="translate-y",this.translatePickerZN.userData.name="translate-z",this.freeTranslateHandler=new We(new xa(ps,.0075,3,64,Math.PI*2),es.clone()),this.add(this.freeTranslateHandler),this.freeTranslatePicker=new We(new Ou(ps,64),es.clone()),this.add(this.freeTranslatePicker),this.freeTranslatePicker.visible=!1,this.freeTranslatePicker.userData.name="translate-free",this.scaleHandlers=new ni,this.add(this.scaleHandlers);const s=new ur(ta,ta,ta);this.scaleCubeX=new We(s,Bf.clone()),this.scaleCubeY=new We(s,Uf.clone()),this.scaleCubeZ=new We(s,$f.clone()),this.scaleCubeX.position.set(kh,0,0),this.scaleCubeY.position.set(0,kh,0),this.scaleCubeZ.position.set(0,0,kh),this.scaleHandlers.add(this.scaleCubeX),this.scaleHandlers.add(this.scaleCubeY),this.scaleHandlers.add(this.scaleCubeZ);const r=new ur(kh-ps-ta/2,.01,.01);r.translate((kh-ps-ta/2)/2,0,0),this.scaleAxisX=new We(r,this.scaleCubeX.material),this.scaleAxisY=new We(r,this.scaleCubeY.material),this.scaleAxisZ=new We(r,this.scaleCubeZ.material),this.scaleAxisX.position.set(ps,0,0),this.scaleAxisY.position.set(0,ps,0),this.scaleAxisZ.position.set(0,0,ps),this.scaleAxisX.rotation.set(0,0,0),this.scaleAxisY.rotation.set(0,0,Math.PI/2),this.scaleAxisZ.rotation.set(0,-Math.PI/2,0),this.scaleHandlers.add(this.scaleAxisX),this.scaleHandlers.add(this.scaleAxisY),this.scaleHandlers.add(this.scaleAxisZ);const o=new ur(ta+ar,ta+ar,ta+ar);this.scalePickerX=new We(o,es),this.scalePickerY=new We(o,es),this.scalePickerZ=new We(o,es),this.scalePickerX.position.copy(this.scaleCubeX.position),this.scalePickerY.position.copy(this.scaleCubeY.position),this.scalePickerZ.position.copy(this.scaleCubeZ.position),this.scaleHandlers.add(this.scalePickerX),this.scaleHandlers.add(this.scalePickerY),this.scaleHandlers.add(this.scalePickerZ),this.scalePickerX.visible=!1,this.scalePickerY.visible=!1,this.scalePickerZ.visible=!1,this.scalePickerX.userData.name="scale-x",this.scalePickerY.userData.name="scale-y",this.scalePickerZ.userData.name="scale-z";const a=new ur(1e-7,na,na);this.scalePickerYZ=new We(a,Bf.clone()),this.scalePickerXZ=new We(a,Uf.clone()),this.scalePickerXY=new We(a,$f.clone()),this.scalePickerYZ.rotation.set(0,0,0),this.scalePickerYZ.position.set(0,ps+na/2,ps+na/2),this.scalePickerXZ.rotation.set(0,0,Math.PI/2),this.scalePickerXZ.position.set(ps+na/2,0,ps+na/2),this.scalePickerXY.rotation.set(0,Math.PI/2,0),this.scalePickerXY.position.set(ps+na/2,ps+na/2,0),this.scaleHandlers.add(this.scalePickerYZ),this.scaleHandlers.add(this.scalePickerXZ),this.scaleHandlers.add(this.scalePickerXY),this.scalePickerYZ.userData.name="scale-yz",this.scalePickerXZ.userData.name="scale-xz",this.scalePickerXY.userData.name="scale-xy",this.viewRotateCircle=new We(new xa($2,.0075,3,64,Math.PI*2),es),this.add(this.viewRotateCircle),this.viewRotatePicker=new We(new xa($2-ar,.0075+ar,3,64,Math.PI*2),es),this.add(this.viewRotatePicker),this.viewRotatePicker.visible=!1,this.viewRotatePicker.userData.name="rotate-view",this.freeRotatePicker=new We(new Ou(m8,64),es.clone()),this.freeRotatePicker.material.opacity=.2,this.add(this.freeRotatePicker),this.freeRotatePicker.visible=!1,this.freeRotatePicker.userData.name="rotate-free",this.rotateHandlerX=new Pt,this.rotateHandlerY=new Pt,this.rotateHandlerZ=new Pt,this.add(this.rotateHandlerX),this.add(this.rotateHandlerY),this.add(this.rotateHandlerZ);const l=new xa(lu,.0075,3,64,Math.PI);l.rotateY(Math.PI/2),l.rotateX(Math.PI/2),this.rotateCircleX=new We(l,Bf.clone()),this.rotateCircleY=new We(l,Uf.clone()),this.rotateCircleZ=new We(l,$f.clone()),this.rotateCircleX.rotation.set(0,0,0),this.rotateCircleY.rotation.set(0,0,-Math.PI/2),this.rotateCircleZ.rotation.set(0,Math.PI/2,0),this.rotateHandlerX.add(this.rotateCircleX),this.rotateHandlerY.add(this.rotateCircleY),this.rotateHandlerZ.add(this.rotateCircleZ);const c=new xa(.45-ar,.0075+ar,3,64,Math.PI);c.rotateY(Math.PI/2),c.rotateX(Math.PI/2),this.rotatePickerX=new We(c,es),this.rotatePickerY=new We(c,es),this.rotatePickerZ=new We(c,es),this.rotatePickerY.rotation.copy(this.rotateCircleY.rotation),this.rotatePickerX.rotation.copy(this.rotateCircleX.rotation),this.rotatePickerZ.rotation.copy(this.rotateCircleZ.rotation),this.rotateHandlerX.add(this.rotatePickerX),this.rotateHandlerY.add(this.rotatePickerY),this.rotateHandlerZ.add(this.rotatePickerZ),this.rotatePickerX.visible=!1,this.rotatePickerY.visible=!1,this.rotatePickerZ.visible=!1,this.rotatePickerX.userData.name="rotate-x",this.rotatePickerY.userData.name="rotate-y",this.rotatePickerZ.userData.name="rotate-z",this.pickers=[this.translatePickerX,this.translatePickerY,this.translatePickerZ,this.translatePickerXN,this.translatePickerYN,this.translatePickerZN,this.freeTranslatePicker,this.rotatePickerX,this.rotatePickerY,this.rotatePickerZ,this.freeRotatePicker,this.viewRotatePicker,this.scalePickerX,this.scalePickerY,this.scalePickerZ,this.scalePickerYZ,this.scalePickerXZ,this.scalePickerXY]}setTargetTransform(t,i,s){this.dragging||(this.position0.copy(t),this.rotation0.copy(i),this.scale0.copy(s))}setTargetTransformFromMatrix(t){this.dragging||(t.decompose(this.position0,this.rotation0,this.scale0),this.rotation0.normalize())}update(t,i,s,r,o,a){if(!this.visible)return;this.position.copy(this.dragging?this.position1:this.position0),this.orientation==="local"?(this.quaternion.copy(this.dragging?this.rotation1:this.rotation0),this.scaleHandlers.quaternion.set(0,0,0,1)):(this.quaternion.set(0,0,0,1),this.scaleHandlers.quaternion.copy(this.dragging?this.rotation1:this.rotation0)),this.updateWorldMatrix(!1,!1),Jr.set(1,0,0).transformDirection(this.matrixWorld),eo.set(0,1,0).transformDirection(this.matrixWorld),to.set(0,0,1).transformDirection(this.matrixWorld),V2.copy(this.matrixWorld).invert(),Nh.copy(t._dir).transformDirection(V2);let l;if(t.perspective){const d=t.perspectiveCamera;l=this.position.distanceTo(d.position)*Math.min(1.9*Math.tan(Math.PI*d.fov/360)/d.zoom,7)}else{const d=t.orthographicCamera;l=(d.top-d.bottom)/d.zoom}this.scale.setScalar(l*this.size),hn.set(1,0,0),ci.set(0,0,1),this.rotateHandlerX.quaternion.setFromAxisAngle(hn,Tl(hn,ci,Nh)),hn.set(0,1,0),ci.set(0,0,1),this.rotateHandlerY.quaternion.setFromAxisAngle(hn,Tl(hn,ci,Nh)),hn.set(0,0,1),ci.set(1,0,0),this.rotateHandlerZ.quaternion.setFromAxisAngle(hn,Tl(hn,ci,Nh)),hn.set(0,0,1),this.viewRotateCircle.quaternion.setFromUnitVectors(hn,Nh),this.viewRotatePicker.quaternion.copy(this.viewRotateCircle.quaternion),this.freeTranslateHandler.quaternion.copy(this.viewRotateCircle.quaternion),this.freeTranslatePicker.quaternion.copy(this.freeTranslateHandler.quaternion),this.freeRotatePicker.quaternion.copy(this.viewRotateCircle.quaternion);for(let d of this.children)d.updateWorldMatrix(!1,!0);const c=mv.crossVectors(t._dir,Jr).lengthSq()>1e-6,h=mv.crossVectors(t._dir,eo).lengthSq()>1e-6,f=mv.crossVectors(t._dir,to).lengthSq()>1e-6;if(this.dragStart=!1,this.dragging)if(this.translateArrowX.visible=this.translateArrowXN.visible=this.handler==="translate-x",this.translateArrowY.visible=this.translateArrowYN.visible=this.handler==="translate-y",this.translateArrowZ.visible=this.translateArrowZN.visible=this.handler==="translate-z",this.freeTranslateHandler.visible=!0,this.rotateCircleX.visible=this.handler==="rotate-x",this.rotateCircleY.visible=this.handler==="rotate-y",this.rotateCircleZ.visible=this.handler==="rotate-z",this.scaleCubeX.visible=this.scaleAxisX.visible=this.handler==="scale-x",this.scaleCubeY.visible=this.scaleAxisY.visible=this.handler==="scale-y",this.scaleCubeZ.visible=this.scaleAxisZ.visible=this.handler==="scale-z",this.scalePickerYZ.visible=this.handler==="scale-yz",this.scalePickerXZ.visible=this.handler==="scale-xz",this.scalePickerXY.visible=this.handler==="scale-xy",this.viewRotateCircle.visible=!0,this.freeRotatePicker.visible=!1,s.mouseLeft)switch(this.mode){case"translate":this.handler==="translate-free"?Ht(Mi,r,o,this.position0,a):Ao(Mi,null,this.position0,this.axis,r,a),this.detTranslation.subVectors(Mi,this.mouse0),s.isKeyPressed("Shift")&&bu(this.detTranslation,this.translateSnap),this.position1.addVectors(this.position0,this.detTranslation),this.position.copy(this.position1),this.updateMatrix();break;case"rotate":switch(this.handler){case"rotate-free":b_(Mi,r,o,this.position0,lu*l*this.size)||Ht(Mi,r,o,this.position0,t._dir),hn.subVectors(this.mouse0,this.position0).normalize(),ci.subVectors(Mi,this.position0).normalize(),ts.setFromUnitVectors(hn,ci),this.detRotation.copy(ts),jp.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(ts),Xp.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(ts),Oa(this.rotation1,jp,Xp);break;case"rotate-view":{Ht(Mi,r,o,this.position0,a),hn.subVectors(this.mouse0,this.position0),ci.subVectors(Mi,this.position0);const d=t._dir;let p=Tl(d,hn,ci);s.isKeyPressed("Shift")&&(p=Math.round(p/this.rotateSnap)*this.rotateSnap),ts.setFromAxisAngle(d,p),this.detRotation.copy(ts),jp.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(ts),Xp.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(ts),Oa(this.rotation1,jp,Xp)}break;default:{switch(this.handler){case"rotate-x":Fh.set(1,0,0);break;case"rotate-y":Fh.set(0,1,0);break;case"rotate-z":Fh.set(0,0,1);break}if(this.raycastPanel){Ht(Mi,r,o,this.position0,a),hn.subVectors(this.mouse0,this.position0),ci.subVectors(Mi,this.position0);let d=Tl(this.axis,hn,ci)||0;s.isKeyPressed("Shift")&&(d=Math.round(d/this.rotateSnap)*this.rotateSnap),ts.setFromAxisAngle(Fh,d),this.detRotation.copy(ts),this.rotation1.multiplyQuaternions(this.rotation0,ts)}else{const d=lu*l*this.size;zh.crossVectors(this.axis,t._dir).normalize(),Ao(Mi,null,this.position0,zh,r,a);const p=.25;let g=hn.subVectors(Mi,this.mouse0).dot(zh)/d*Math.PI/2*p;s.isKeyPressed("Shift")&&(g=Math.round(g/this.rotateSnap)*this.rotateSnap),ts.setFromAxisAngle(Fh,g),this.detRotation.copy(ts),this.rotation1.multiplyQuaternions(this.rotation0,ts)}}break}break;case"scale":if(this.raycastPanel){Ht(Mi,r,o,this.position0,this.axis);let d=1,p=1,g=1;switch(hn.subVectors(this.mouse0,this.position0).negate(),ci.subVectors(Mi,this.position0).negate(),s.isKeyPressed("Shift")?d=p=g=ci.length()/hn.length():(Jr.set(1,0,0).applyQuaternion(this.scaleHandlers.quaternion),eo.set(0,1,0).applyQuaternion(this.scaleHandlers.quaternion),to.set(0,0,1).applyQuaternion(this.scaleHandlers.quaternion),d=ci.dot(Jr)/hn.dot(Jr),p=ci.dot(eo)/hn.dot(eo),g=ci.dot(to)/hn.dot(to),this.forcePositiveScale&&(d=Math.abs(d),p=Math.abs(p),g=Math.abs(g))),this.handler){case"scale-yz":d=1;break;case"scale-xz":p=1;break;case"scale-xy":g=1;break}this.detScale.set(d,p,g),this.scale1.copy(this.scale0).multiply(this.detScale)}else{Ao(Mi,null,this.position0,this.axis,r,a);const d=-hn.subVectors(this.mouse0,this.position0).dot(this.axis);let g=-ci.subVectors(Mi,this.position0).dot(this.axis)/d;if(this.forcePositiveScale&&(g=Math.abs(g)),s.isKeyPressed("Shift"))this.detScale.setScalar(g),this.scale1.copy(this.scale0).multiplyScalar(g);else switch(this.scale1.copy(this.scale0),this.handler){case"scale-x":this.detScale.set(g,1,1),this.scale1.x*=g;break;case"scale-y":this.detScale.set(1,g,1),this.scale1.y*=g;break;case"scale-z":this.detScale.set(1,1,g),this.scale1.z*=g;break}}break}else this.dragging=!1,this.mode=void 0,this.position0.copy(this.position1),this.rotation0.copy(this.rotation1),this.scale0.copy(this.scale1);else{let d=!1,p=!1,g=!1,m,v;for(let y of i.intersectObjects(this.pickers))switch(y.object.userData.name){case"translate-x":!m&&c&&this.enableTranslate&&(m="translate-x");break;case"translate-y":!m&&h&&this.enableTranslate&&(m="translate-y");break;case"translate-z":!m&&f&&this.enableTranslate&&(m="translate-z");break;case"translate-free":this.enableTranslate&&(d=!0);break;case"rotate-x":!v&&this.enableRotate&&(v="rotate-x");break;case"rotate-y":!v&&this.enableRotate&&(v="rotate-y");break;case"rotate-z":!v&&this.enableRotate&&(v="rotate-z");break;case"rotate-view":this.enableRotate&&(g=!0);break;case"rotate-free":this.enableRotate&&(p=!0);break;case"scale-x":!m&&c&&this.enableScale&&(m="scale-x");break;case"scale-y":!m&&h&&this.enableScale&&(m="scale-y");break;case"scale-z":!m&&f&&this.enableScale&&(m="scale-z");break;case"scale-yz":!m&&h&&f&&this.enableScale&&(m="scale-yz");break;case"scale-xz":!m&&c&&f&&this.enableScale&&(m="scale-xz");break;case"scale-xy":!m&&c&&h&&this.enableScale&&(m="scale-xy");break}if(this.handler=void 0,m?this.handler=m:v?this.handler=v:d?this.handler="translate-free":p?this.handler="rotate-free":g&&(this.handler="rotate-view"),this.updateOpacity(this.translateArrowX,this.handler==="translate-x"||!this.handler),this.updateOpacity(this.translateArrowY,this.handler==="translate-y"||!this.handler),this.updateOpacity(this.translateArrowZ,this.handler==="translate-z"||!this.handler),this.updateOpacity(this.rotateCircleX,this.handler==="rotate-x"||!this.handler),this.updateOpacity(this.rotateCircleY,this.handler==="rotate-y"||!this.handler),this.updateOpacity(this.rotateCircleZ,this.handler==="rotate-z"||!this.handler),this.updateOpacity(this.scaleCubeX,this.handler==="scale-x"||!this.handler),this.updateOpacity(this.scaleCubeY,this.handler==="scale-y"||!this.handler),this.updateOpacity(this.scaleCubeZ,this.handler==="scale-z"||!this.handler),this.updateOpacity(this.scaleAxisX,this.handler==="scale-x"||!this.handler),this.updateOpacity(this.scaleAxisY,this.handler==="scale-y"||!this.handler),this.updateOpacity(this.scaleAxisZ,this.handler==="scale-z"||!this.handler),this.updateOpacity(this.scalePickerYZ,this.handler==="scale-yz"||!this.handler),this.updateOpacity(this.scalePickerXZ,this.handler==="scale-xz"||!this.handler),this.updateOpacity(this.scalePickerXY,this.handler==="scale-xy"||!this.handler),this.updateOpacity(this.viewRotateCircle,this.handler==="rotate-view"||!this.handler),this.updateOpacity(this.freeTranslateHandler,this.handler==="translate-free"||!this.handler),this.freeRotatePicker.visible=this.handler==="rotate-free"&&this.enableRotate,this.translateArrowX.visible=this.translateArrowXN.visible=c&&this.enableTranslate,this.translateArrowY.visible=this.translateArrowYN.visible=h&&this.enableTranslate,this.translateArrowZ.visible=this.translateArrowZN.visible=f&&this.enableTranslate,this.rotateCircleX.visible=this.enableRotate,this.rotateCircleY.visible=this.enableRotate,this.rotateCircleZ.visible=this.enableRotate,this.scaleCubeX.visible=this.scaleAxisX.visible=c&&this.enableScale,this.scaleCubeY.visible=this.scaleAxisY.visible=h&&this.enableScale,this.scaleCubeZ.visible=this.scaleAxisZ.visible=f&&this.enableScale,this.scalePickerYZ.visible=h&&f&&this.enableScale,this.scalePickerXZ.visible=c&&f&&this.enableScale,this.scalePickerXY.visible=c&&h&&this.enableScale,this.viewRotateCircle.visible=!0,this.freeTranslateHandler.visible=!0,s.mouseLeftDownThisFrame&&this.handler){switch(this.dragStart=!0,this.dragging=!0,this.handler){case"translate-x":case"translate-y":case"translate-z":this.mode="translate",this.axis.copy(this.handler==="translate-x"?Jr:this.handler==="translate-y"?eo:to),Ao(this.mouse0,null,this.position0,this.axis,r,a);break;case"translate-free":this.mode="translate",Ht(this.mouse0,r,o,this.position0,a);break;case"rotate-x":case"rotate-y":case"rotate-z":{this.mode="rotate",this.axis.copy(this.handler==="rotate-x"?Jr:this.handler==="rotate-y"?eo:to);let y=au(Math.abs(a.angleTo(this.axis)));y=y/Math.PI*180,this.raycastPanel=Math.abs(y-90)>15,this.raycastPanel?Ht(this.mouse0,r,o,this.position0,a):(zh.crossVectors(this.axis,t._dir).normalize(),Ao(this.mouse0,null,this.position0,zh,r,a))}break;case"rotate-free":this.mode="rotate",b_(this.mouse0,r,o,this.position0,lu*l*this.size)||Ht(this.mouse0,r,o,this.position0,t._dir);break;case"rotate-view":this.mode="rotate",Ht(this.mouse0,r,o,this.position0,a);break;case"scale-x":case"scale-y":case"scale-z":{switch(this.mode="scale",this.raycastPanel=!1,this.handler){case"scale-x":this.axis.copy(Jr);break;case"scale-y":this.axis.copy(eo);break;case"scale-z":this.axis.copy(to);break}this.axis.applyQuaternion(this.scaleHandlers.quaternion),Ao(this.mouse0,null,this.position0,this.axis,r,a)}break;case"scale-yz":case"scale-xz":case"scale-xy":{switch(this.mode="scale",this.raycastPanel=!0,this.handler){case"scale-yz":this.axis.copy(Jr);break;case"scale-xz":this.axis.copy(eo);break;case"scale-xy":this.axis.copy(to);break}this.axis.applyQuaternion(this.scaleHandlers.quaternion),Ht(this.mouse0,r,o,this.position0,this.axis)}break}this.position1.copy(this.position0),this.rotation1.copy(this.rotation0),this.scale1.copy(this.scale0)}}}updateOpacity(t,i,s=.35,r=1){const o=t.material;o.opacity=i?r:s}}u(Fb,"Gizmo");h8(Fb,"Gizmo");var g8=Object.defineProperty,v8=u((n,e)=>g8(n,"name",{value:e,configurable:!0}),"__name$3d");class zb{constructor(){S(this,"element");S(this,"pointerOver",!1);S(this,"pointerX",0);S(this,"pointerY",0);S(this,"pressure",0);S(this,"mouseLeft",!1);S(this,"mouseLeftDownThisFrame",!1);S(this,"mouseRight",!1);S(this,"mouseRightDownThisFrame",!1);S(this,"mouseMiddle",!1);S(this,"mouseMiddleDownThisFrame",!1);S(this,"doubleClick",!1);S(this,"wheelDetX",0);S(this,"wheelDetY",0);S(this,"onContextmenu");S(this,"onPointerMove");S(this,"onPointerDown");S(this,"onPointerUp");S(this,"onPointerLeave");S(this,"onPointerOut");S(this,"onDblClick");S(this,"onWheel");S(this,"onKeyDown");S(this,"onKeyUp");S(this,"onBlur");S(this,"keyMap",new Map);S(this,"timestamp",0);this.onContextmenu=e=>{e.target===this.element&&e.preventDefault()},this.onPointerMove=e=>{e.target===this.element&&(this.pressure=e.pressure,this.pointerOver=!0,this.pointerX=e.offsetX,this.pointerY=e.offsetY)},this.onPointerDown=e=>{if(e.target===this.element)switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!0,this.mouseLeftDownThisFrame=!0;break;case 1:this.mouseMiddle=!0,this.mouseMiddleDownThisFrame=!0;break;case 2:this.mouseRight=!0,this.mouseRightDownThisFrame=!0;break}},this.onPointerUp=e=>{switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1;break;case 1:this.mouseMiddle=!1,this.mouseMiddleDownThisFrame=!1;break;case 2:this.mouseRight=!1,this.mouseLeftDownThisFrame=!1;break}},this.onPointerLeave=()=>{this.pressure=0,this.pointerOver=!1},this.onPointerOut=e=>{(e.clientY<=0||e.clientX<=0||e.clientX>=window.innerWidth||e.clientY>=window.innerHeight)&&(this.pressure=0,this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1,this.mouseRight=!1,this.mouseLeftDownThisFrame=!1)},this.onDblClick=e=>{this.doubleClick=!0},this.onWheel=e=>{e.preventDefault(),this.wheelDetX+=e.deltaX/100,this.wheelDetY+=e.deltaY/100},this.onKeyDown=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||((e.altKey||e.ctrlKey||e.key==="Tab")&&e.preventDefault(),this.keyMap.has(e.key)||this.keyMap.set(e.key,this.timestamp))},this.onKeyUp=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||this.keyMap.delete(e.key)},this.onBlur=()=>{this.keyMap.clear()}}setup(e){this.unload(),this.element=e,e.addEventListener("contextmenu",this.onContextmenu),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerleave",this.onPointerLeave),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointerout",this.onPointerOut),e.addEventListener("dblclick",this.onDblClick),e.addEventListener("wheel",this.onWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}unload(){const e=this.element;!e||(e.removeEventListener("contextmenu",this.onContextmenu),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerleave",this.onPointerLeave),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointerout",this.onPointerOut),e.removeEventListener("dblclick",this.onDblClick),e.removeEventListener("wheel",this.onWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur),this.element=void 0)}update(){this.mouseLeftDownThisFrame=!1,this.mouseRightDownThisFrame=!1,this.mouseMiddleDownThisFrame=!1,this.doubleClick=!1,this.wheelDetX=0,this.wheelDetY=0,this.timestamp=Date.now()}isKeyPressed(e){return this.keyMap.has(e)}isKeyPressedThisFrame(e){return this.keyMap.get(e)===this.timestamp}isKeyRepeated(e,t=150){const i=this.keyMap.get(e);if(i==null)return!1;const s=this.timestamp-i;return s>=t||s===0?(this.keyMap.set(e,this.timestamp),!0):!1}}u(zb,"Input");v8(zb,"Input");var y8=Object.defineProperty,uR=u((n,e)=>y8(n,"name",{value:e,configurable:!0}),"__name$3c");class cu{constructor(e,t,i,s,r,o){S(this,"ctx");S(this,"index");S(this,"enabled",!0);S(this,"element");S(this,"camera",new Ob);S(this,"zoomLevel",0);S(this,"left",0);S(this,"bottom",0);S(this,"width",0);S(this,"height",0);S(this,"input",new zb);S(this,"mouseScr",new ke);S(this,"mouseNdc",new T);S(this,"mouseRay0",new T);S(this,"mouseRay1",new T);S(this,"mouseRayN",new T);S(this,"raycaster",new qP);S(this,"gizmo",new Fb);S(this,"gizmoEnabled",!1);S(this,"defaultLights");S(this,"defaultLight1");S(this,"defaultLight2");S(this,"defaultLight3");this.ctx=e,this.index=t,this.element=i,this.input.setup(i),this.camera.alpha=s,this.camera.beta=r,this.camera.perspective=o,e.scene.add(this.gizmo),this.gizmo.visible=!1,this.defaultLights=new ni,e.scene.add(this.defaultLights),this.defaultLight1=new Ra(16777215,.35),this.defaultLight2=new Ra(16777215,.35),this.defaultLight3=new Ra(16777215,.35),this.defaultLight1.position.set(0,2,0),this.defaultLight2.position.set(-2,-1,0),this.defaultLight3.position.set(2,-1,0),this.defaultLights.add(this.defaultLight1),this.defaultLights.add(this.defaultLight2),this.defaultLights.add(this.defaultLight3)}update(){const e=this.element.getBoundingClientRect();this.left=e.left,this.bottom=e.bottom,this.width=e.width,this.height=e.height,this.width&&this.height?this.camera.update(this.width,this.height):this.enabled=!1}dispose(){this.defaultLight1.dispose(),this.defaultLight2.dispose(),this.defaultLight3.dispose(),this.input.unload()}mousePick(e){return this.raycaster.intersectObjects(this.ctx.readonlyRef().scene.children.filter(t=>{if(!t.visible)return!1;const i=t.userData.node;return i!=null&&i.visible?!e||i.type===e:!1})).filter(t=>{const i=t.object.userData.node;return i==null?void 0:i.visible})}mousePickVisible(){const e=this.ctx.readonlyRef().scene.children.filter(s=>{if(!s.visible)return!1;const r=s.userData.node;return r==null?void 0:r.visible}),t=uR((s,r,o)=>{if(!!s.visible){s.layers.test(r.layers)&&s.raycast(r,o);for(let a of s.children)t(a,r,o)}},"intersectObjects"),i=[];for(let s of e)t(s,this.raycaster,i);return i.sort((s,r)=>s.distance-r.distance)}}u(cu,"EditorView");uR(cu,"EditorView");var _8=Object.defineProperty,U0=u((n,e)=>_8(n,"name",{value:e,configurable:!0}),"__name$3b");async function Md(n){return new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(new Blob([n]))})}u(Md,"bufferToDataUrl");U0(Md,"bufferToDataUrl");async function Bb(n){return(await fetch(n)).arrayBuffer()}u(Bb,"dataUrlToArrayBuffer");U0(Bb,"dataUrlToArrayBuffer");const Hg=new DataView(new ArrayBuffer(4));function Ub(n){const e=new Uint8Array(n.length*4);for(let t=0,i=n.length;t<i;++t){Hg.setFloat32(0,n[t]);const s=t*4;for(let r=0;r<4;++r)e[s+r]=Hg.getUint8(r)}return e}u(Ub,"float32ArrayToBytes");U0(Ub,"float32ArrayToBytes");function $b(n){const e=new Float32Array(n.length/4);for(let t=0,i=e.length;t<i;++t){const s=t*4;for(let r=0;r<4;++r)Hg.setUint8(r,n[s+r]);e[t]=Hg.getFloat32(0)}return e}u($b,"bytesToFloat32Array");U0($b,"bytesToFloat32Array");var b8=Object.defineProperty,w8=u((n,e)=>b8(n,"name",{value:e,configurable:!0}),"__name$3a");class Ne{onRemoved(){}}u(Ne,"ModelNodeComponent");w8(Ne,"ModelNodeComponent");var x8=Object.defineProperty,Vb=u((n,e)=>x8(n,"name",{value:e,configurable:!0}),"__name$39"),Ie=(n=>(n[n.NUMBER=1]="NUMBER",n[n.STRING=2]="STRING",n[n.BOOLEAN=3]="BOOLEAN",n[n.NUMBER_ARRAY=4]="NUMBER_ARRAY",n[n.BYTES=5]="BYTES",n))(Ie||{});const Gb={};function ze(n){return function(e){if(!e.name.startsWith("C"))throw new Error('Component class name should be prefixed with "C"');if(n.storable&&n.dataType==null)throw new Error(`Component [${e.name}] missing data type`);Gb[e.name]=Object.assign({constructor:e},n)}}u(ze,"registerModelComponent");Vb(ze,"registerModelComponent");function hR(n){return!!Gb[n]}u(hR,"isModelNodeComponentDefExists");Vb(hR,"isModelNodeComponentDefExists");function Ki(n){const e=Gb[n];if(!e)throw new Error(`Component def [${n}] not found`);return e}u(Ki,"getModelNodeComponentDef");Vb(Ki,"getModelNodeComponentDef");var fR=Object.defineProperty,A8=Object.getOwnPropertyDescriptor,M8=u((n,e)=>fR(n,"name",{value:e,configurable:!0}),"__name$38"),S8=u((n,e,t,i)=>{for(var s=i>1?void 0:i?A8(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&fR(e,t,s),s},"__decorateClass$1a");let yr=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new Float32Array);S(this,"dirty",!0);S(this,"partialUpdate",!1)}},"CColors");M8(yr,"CColors");yr=S8([ze({storable:!0,dataType:Ie.BYTES,clone(n){return new Float32Array(n)},serialize:Ub,deserialize:$b})],yr);var dR=Object.defineProperty,C8=Object.getOwnPropertyDescriptor,E8=u((n,e)=>dR(n,"name",{value:e,configurable:!0}),"__name$37"),T8=u((n,e,t,i)=>{for(var s=i>1?void 0:i?C8(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&dR(e,t,s),s},"__decorateClass$19");let Un=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new T)}},"CFlipDirection");E8(Un,"CFlipDirection");Un=T8([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,instanceable:!0,equal:wr,clone(n){return new T().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new T(n[0],n[1],n[2])}})],Un);var pR=Object.defineProperty,P8=Object.getOwnPropertyDescriptor,R8=u((n,e)=>pR(n,"name",{value:e,configurable:!0}),"__name$36"),I8=u((n,e,t,i)=>{for(var s=i>1?void 0:i?P8(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&pR(e,t,s),s},"__decorateClass$18");let He=u(class extends Ne{constructor(){super(...arguments);S(this,"value",null);S(this,"dirty",!0);S(this,"matrix",new ve);S(this,"matDirty",!0);S(this,"placeholder");S(this,"useTempMat",!1);S(this,"tempMat",new ve)}onRemoved(){this.placeholder&&this.placeholder.removeFromParent()}},"CGeom3");R8(He,"CGeom3");He=I8([ze({})],He);var mR=Object.defineProperty,D8=Object.getOwnPropertyDescriptor,Hb=u((n,e)=>mR(n,"name",{value:e,configurable:!0}),"__name$35"),L8=u((n,e,t,i)=>{for(var s=i>1?void 0:i?D8(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&mR(e,t,s),s},"__decorateClass$17");let Me=u(class extends Ne{constructor(){super(...arguments);S(this,"value",null);S(this,"parentChanged",!0);S(this,"localTransformChanged",!0);S(this,"worldTransformChanged",!0);S(this,"mesh");S(this,"instance",!1);S(this,"usePlainMaterial",!1)}onRemoved(){this.dispose()}dispose(){this.value&&(this.instance||jl(this.value),this.value.removeFromParent(),this.value=null)}},"CObject3D");Hb(Me,"CObject3D");Me=L8([ze({})],Me);function jl(n){for(let t of n.children)jl(t);if(n.isInstancedMesh)return;if("geometry"in n){const t=n.geometry;t&&t.dispose()}if("material"in n){const t=n.material;t&&(t instanceof Array?t.forEach(eu):eu(t))}const e=n;e.__originalMaterial&&(e.__originalMaterial instanceof Array?e.__originalMaterial.forEach(eu):eu(e.__originalMaterial)),e.__plainMaterial&&eu(e.__plainMaterial)}u(jl,"disposeObject3D");Hb(jl,"disposeObject3D");function eu(n){Object.keys(n).forEach(e=>{const t=n[e];t&&typeof t=="object"&&typeof t.dispose=="function"&&t.dispose()}),n.dispose()}u(eu,"disposeMaterial");Hb(eu,"disposeMaterial");var gR=Object.defineProperty,O8=Object.getOwnPropertyDescriptor,k8=u((n,e)=>gR(n,"name",{value:e,configurable:!0}),"__name$34"),N8=u((n,e,t,i)=>{for(var s=i>1?void 0:i?O8(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&gR(e,t,s),s},"__decorateClass$16");let gn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new Float32Array);S(this,"dirty",!0);S(this,"partialUpdate",!1)}},"CVertices");k8(gn,"CVertices");gn=N8([ze({storable:!0,dataType:Ie.BYTES,clone(n){return new Float32Array(n)},serialize:Ub,deserialize:$b})],gn);var F8=Object.defineProperty,Bh=u((n,e)=>F8(n,"name",{value:e,configurable:!0}),"__name$33"),z8=zt({components:{InputNumber:Jn},props:{value:{type:Array,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},maxDet:{type:Number,required:!0},step:{type:Number,default:1}},emits:["input"],setup(n,e){const t=Ge(),i=st(function(){let d=n.min,p=n.max;return{left:(n.value[0]-d)/(p-d)*100+"%"}}),s=st(function(){let d=n.min,p=n.max;return{left:(n.value[1]-d)/(p-d)*100+"%"}}),r=st(function(){let d=n.min,p=n.max;return{left:(n.value[0]-d)/(p-d)*100+"%",width:(n.value[1]-n.value[0])/(p-d)*100+"%"}});function o(d){let p=Math.min(n.max,Math.max(n.min,Math.round(d/n.step)*n.step)),g=n.value[1];g<p&&(g=p),g-p>n.maxDet&&(g=Math.min(n.max,Math.max(n.min,p+n.maxDet))),e.emit("input",[p,g])}u(o,"inputValue1"),Bh(o,"inputValue1");function a(d){let p=n.value[0],g=Math.min(n.max,Math.max(n.min,Math.round(d/n.step)*n.step));p>g&&(p=g),g-p>n.maxDet&&(p=Math.min(n.max,Math.max(n.min,g-n.maxDet))),e.emit("input",[p,g])}u(a,"inputValue2"),Bh(a,"inputValue2");let l="bar";function c(){switch(l){case"bar":let d=Math.min(n.max,Math.max(n.min,Math.round((n.value[0]-n.step)/n.step)*n.step));if(d>=n.min){let p=Math.min(n.max,Math.max(n.min,Math.round((n.value[1]+(d-n.value[0]))/n.step)*n.step));e.emit("input",[d,p])}break;case"val1":o(n.value[0]-n.step);break;case"val2":a(n.value[1]-n.step);break}}u(c,"moveLeft"),Bh(c,"moveLeft");function h(){switch(l){case"bar":let d=Math.min(n.max,Math.max(n.min,Math.round((n.value[1]+n.step)/n.step)*n.step));if(d<=n.max){let p=Math.min(n.max,Math.max(n.min,Math.round((n.value[0]+(d-n.value[1]))/n.step)*n.step));e.emit("input",[p,d])}break;case"val1":o(n.value[0]+n.step);break;case"val2":a(n.value[1]+n.step);break}}u(h,"moveRight"),Bh(h,"moveRight");function f(d){const g=t.value.getBoundingClientRect(),m=d.clientX-g.left,v=n.value[0],y=n.value[1],b=n.min,_=n.max;l="bar",m<=(n.value[0]-b)/(_-b)*g.width+2&&(l="val1"),m>=(n.value[1]-b)/(_-b)*g.width-2&&(l="val2"),Wl(d,x=>{const M=t.value.getBoundingClientRect(),C=x.clientX-M.left,A=Math.min(1,Math.max(0,C/M.width)),P=(n.max-n.min)*A+n.min;switch(l){case"bar":const D=(C-m)/M.width*(n.max-n.min);if(D<0){let k=Math.min(n.max,Math.max(n.min,Math.round((v+D)/n.step)*n.step));if(k>=n.min){let O=Math.min(n.max,Math.max(n.min,Math.round((y+(k-v))/n.step)*n.step));e.emit("input",[k,O])}}else{let k=Math.min(n.max,Math.max(n.min,Math.round((y+D)/n.step)*n.step));if(k<=n.max){let O=Math.min(n.max,Math.max(n.min,Math.round((v+(k-y))/n.step)*n.step));e.emit("input",[O,k])}}break;case"val1":P<=n.value[1]&&n.value[1]-P<=n.maxDet&&o(P);break;case"val2":P>=n.value[0]&&P-n.value[0]<=n.maxDet&&a(P);break}})}return u(f,"onPointerDown"),Bh(f,"onPointerDown"),{bar:t,slider1Style:i,slider2Style:s,sliderBarStyle:r,inputValue1:o,inputValue2:a,moveLeft:c,moveRight:h,onPointerDown:f}}});const B8={class:"input-double-range"},U8={class:"input-double-range__slider-container",ref:"bar"};function $8(n,e,t,i,s,r){const o=pn("input-number");return Ce(),Be("div",B8,[Ee(o,{value:n.value[0],onInput:n.inputValue1},null,8,["value","onInput"]),ue("div",{class:"input-double-range__bar",tabindex:"0",onKeydown:[e[0]||(e[0]=En((...a)=>n.moveLeft&&n.moveLeft(...a),["left"])),e[1]||(e[1]=En((...a)=>n.moveRight&&n.moveRight(...a),["right"]))],onPointerdown:e[2]||(e[2]=(...a)=>n.onPointerDown&&n.onPointerDown(...a))},[ue("div",U8,[ue("div",{class:"input-double-range__slider-bar",style:ti(n.sliderBarStyle)},null,4),ue("div",{class:"input-double-range__slider",style:ti(n.slider1Style)},null,4),ue("div",{class:"input-double-range__slider",style:ti(n.slider2Style)},null,4)],512)],32),Ee(o,{value:n.value[1],onInput:n.inputValue2},null,8,["value","onInput"])])}u($8,"_sfc_render$n");var vR=Wt(z8,[["render",$8],["__scopeId","data-v-5aca574d"]]),yR=Object.defineProperty,V8=Object.getOwnPropertyDescriptor,G8=u((n,e)=>yR(n,"name",{value:e,configurable:!0}),"__name$32"),H8=u((n,e,t,i)=>{for(var s=i>1?void 0:i?V8(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&yR(e,t,s),s},"__decorateClass$15");let Bu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",[0,360])}},"CAngleRange");G8(Bu,"CAngleRange");Bu=H8([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,label:"Angle",inputComponent:vR,inputComponentProps:{min:0,max:360,maxDet:360}})],Bu);var W8=Object.defineProperty,Uh=u((n,e)=>W8(n,"name",{value:e,configurable:!0}),"__name$31"),j8=zt({props:{value:{type:T,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean,defaultValue:T},emits:["input"],setup(n,e){const t=Ge(),i=Ge(),s=Ge();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}u(o,"postOnMouseDown"),Uh(o,"postOnMouseDown");function a(f){return Number(f.toFixed(3))}u(a,"format"),Uh(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}u(l,"onChange"),Uh(l,"onChange"),Ba(function(){document.removeEventListener("mousedown",o)});function c(){var f,d,p;if(r){r=!1;let g=Number(((f=t.value)==null?void 0:f.value)||"0")||0,m=Number(((d=i.value)==null?void 0:d.value)||"0")||0,v=Number(((p=s.value)==null?void 0:p.value)||"0")||0;e.emit("input",new T(g,m,v))}}u(c,"onPost"),Uh(c,"onPost");function h(){const f=new T;n.defaultValue&&f.copy(n.defaultValue),e.emit("input",f)}return u(h,"onReset"),Uh(h,"onReset"),{input0:t,input1:i,input2:s,format:a,onChange:l,onPost:c,onReset:h}}});const X8=u(n=>(Fa("data-v-792b48dc"),n=n(),za(),n),"_withScopeId$3"),Y8={class:"input-vec3"},q8=["value","readonly","disabled"],Z8=["value","readonly","disabled"],K8=["value","readonly","disabled"],Q8=X8(()=>ue("img",{src:B0,alt:""},null,-1)),J8=[Q8];function eG(n,e,t,i,s,r){return Ce(),Be("div",Y8,[ue("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,q8),ue("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,Z8),ue("input",{type:"text",placeholder:"z",value:n.format(n.value.z),readonly:n.readonly,disabled:n.disabled,onInput:e[6]||(e[6]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[8]||(e[8]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input2"},null,40,K8),n.resettable?(Ce(),Be("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>n.onReset&&n.onReset(...o))},J8)):tt("",!0)])}u(eG,"_sfc_render$m");var Yd=Wt(j8,[["render",eG],["__scopeId","data-v-792b48dc"]]),_R=Object.defineProperty,tG=Object.getOwnPropertyDescriptor,nG=u((n,e)=>_R(n,"name",{value:e,configurable:!0}),"__name$30"),iG=u((n,e,t,i)=>{for(var s=i>1?void 0:i?tG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&_R(e,t,s),s},"__decorateClass$14");let Gs=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new T(1,1,1));S(this,"dirty",!0)}},"CBoxSize");nG(Gs,"CBoxSize");Gs=iG([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,equal:wr,label:"Size",inputComponent:Yd,clone(n){return new T().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new T(n[0],n[1],n[2])}})],Gs);var bR=Object.defineProperty,sG=Object.getOwnPropertyDescriptor,rG=u((n,e)=>bR(n,"name",{value:e,configurable:!0}),"__name$2$"),oG=u((n,e,t,i)=>{for(var s=i>1?void 0:i?sG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&bR(e,t,s),s},"__decorateClass$13");let Nn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!0)}},"CCastShadow");rG(Nn,"CCastShadow");Nn=oG([ze({storable:!0,dataType:Ie.BOOLEAN,instanceable:!0,label:"Cast Shadow",inlineLabel:!0,inputComponent:$o})],Nn);var aG=Object.defineProperty,lG=u((n,e)=>aG(n,"name",{value:e,configurable:!0}),"__name$2_");class Wb{constructor(e,t){S(this,"root");S(this,"zIndex",1e3);S(this,"show");S(this,"hide");S(this,"currentVisibleSubMenu");this.show=e,this.hide=t}handleMenuItemMouseOver(e,t){var i,s,r;(s=(i=this.currentVisibleSubMenu)==null?void 0:i.subMenu)==null||s.hide(),this.currentVisibleSubMenu=e,(r=e.subMenu)==null||r.show(t,"right")}hideAll(){this.root?this.root.hide():this.hide()}}u(Wb,"PopupMenuContext");lG(Wb,"PopupMenuContext");var cG=Object.defineProperty,$h=u((n,e)=>cG(n,"name",{value:e,configurable:!0}),"__name$2Z");let Yp=[];var uG=zt({props:{title:String,triggerBy:{type:String,default:"mousedown"},position:{type:String,default:"bottom"},disabled:Boolean,className:String,dynamicSize:Boolean},setup(n){const e=Ge(),t=Ge(),i=Ge({left:0,top:0,width:"auto",height:"auto"}),s=Ge(!1),r=Ge(!1),o=new Wb(f,d),a=Ii("popupMenuItemContext",null);a&&(a.parent&&(o.root=a.parent.root||a.parent,o.zIndex=a.parent.zIndex+1),a.subMenu=o),vu("popupMenuContext",o),m0(function(){o.root||Yp.push(o)}),g0(function(){o.root||(Yp=Yp.filter(p=>p!==o)),document.body.removeEventListener("mousedown",d)});function l(p){n.triggerBy==="mousedown"&&(r.value?d():f(e.value,n.position))}u(l,"onTriggerMouseDown"),$h(l,"onTriggerMouseDown");function c(){if(n.triggerBy==="hover"||n.triggerBy==="mouseover")return f(e.value,n.position)}u(c,"onTriggerMouseOver"),$h(c,"onTriggerMouseOver");function h(p){p.key==="Escape"&&(o.root?o.hide():d())}u(h,"onKeyDown"),$h(h,"onKeyDown");async function f(p,g){if(n.disabled)return;o.root||Yp.forEach(P=>P.hideAll());const m=document.body.getBoundingClientRect(),v=p.getBoundingClientRect(),y=m.width,b=m.height;r.value=!0,s.value=!1,i.value={left:0,top:0,width:"auto",height:"auto"},await Vs(),document.body.addEventListener("mousedown",d),t.value.focus();const _=t.value.getBoundingClientRect();let x,w;const M=_.right-_.left,C=_.bottom-_.top;if(typeof g=="object")x=g.x,w=g.y;else switch(g){case"bottom":x=v.left,w=v.bottom;break;default:x=v.right,w=v.top;break}const A={"z-index":o.zIndex};if(n.dynamicSize?(A.width="auto",A.height="auto",s.value=!1):(A.width=Math.floor(M)+"px",A.height=Math.floor(C)+"px",A.overflow="hidden",s.value=!0),x+M>y?A.right=0:A.left=Math.floor(x)+"px",w+C>b){const P=Math.floor(Math.max(0,b-C));A.top=P+"px",A.height=Math.floor(b-P)+"px"}else A.top=Math.floor(w)+"px";i.value=A}u(f,"show"),$h(f,"show");function d(){var p,g;document.body.removeEventListener("mousedown",d),r.value=!1,(g=(p=o.currentVisibleSubMenu)==null?void 0:p.subMenu)==null||g.hide(),o.currentVisibleSubMenu=void 0}return u(d,"hide"),$h(d,"hide"),{trigger:e,menu:t,onTriggerMouseDown:l,onTriggerMouseOver:c,onKeyDown:h,style:i,scrollable:s,visible:r,show:f,hide:d}}});const hG=["disabled"],fG={class:"scroll"};function dG(n,e,t,i,s,r){return Ce(),Be(Nt,null,[n.title?(Ce(),Be("button",{key:0,class:bn(["popup-menu-trigger",n.className]),disabled:n.disabled,onMousedown:e[0]||(e[0]=Fn((...o)=>n.onTriggerMouseDown&&n.onTriggerMouseDown(...o),["stop"])),onMouseover:e[1]||(e[1]=(...o)=>n.onTriggerMouseOver&&n.onTriggerMouseOver(...o)),ref:"trigger"},Tn(n.title),43,hG)):tt("",!0),(Ce(),sn(cb,{to:"body"},[n.visible?(Ce(),Be("div",{key:0,class:bn(["popup-menu",{scrollable:n.scrollable}]),style:ti(n.style),ref:"menu",tabindex:"0",onMousedown:e[2]||(e[2]=Fn(()=>{},["stop"])),onContextmenu:e[3]||(e[3]=Fn(()=>{},["prevent"])),onKeydown:e[4]||(e[4]=(...o)=>n.onKeyDown&&n.onKeyDown(...o))},[ue("div",fG,[dd(n.$slots,"default",{},void 0,!0)])],38)):tt("",!0)]))],64)}u(dG,"_sfc_render$l");var jb=Wt(uG,[["render",dG],["__scopeId","data-v-e883b650"]]),pG=Object.defineProperty,mG=u((n,e)=>pG(n,"name",{value:e,configurable:!0}),"__name$2Y"),gG=zt({components:{ColorPicker:tR,PopupMenu:jb},props:{value:Array},emits:["input"],setup(n,e){const t=st(function(){const s=n.value||[1,1,1];return{"background-color":`#${new Te().setRGB(s[0],s[1],s[2]).getHexString()}`}});function i(s){e.emit("input",s)}return u(i,"onInput"),mG(i,"onInput"),{style:t,onInput:i}}});const vG={style:{padding:"8px 8px 0 8px"}};function yG(n,e,t,i,s,r){const o=pn("color-picker"),a=pn("popup-menu");return Ce(),Be("div",{class:"input-color",style:ti(n.style)},[Ee(a,{title:" "},{default:an(()=>[ue("div",vG,[Ee(o,{value:n.value,"onUpdate:value":n.onInput},null,8,["value","onUpdate:value"])])]),_:1})],4)}u(yG,"_sfc_render$k");var $0=Wt(gG,[["render",yG],["__scopeId","data-v-1ea277a0"]]),wR=Object.defineProperty,_G=Object.getOwnPropertyDescriptor,bG=u((n,e)=>wR(n,"name",{value:e,configurable:!0}),"__name$2X"),wG=u((n,e,t,i)=>{for(var s=i>1?void 0:i?_G(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&wR(e,t,s),s},"__decorateClass$12");let Ot=u(class extends Ne{constructor(){super(...arguments);S(this,"value",[1,1,1])}},"CColor");bG(Ot,"CColor");Ot=wG([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,equal:(n,e)=>new Te().setRGB(n[0],n[1],n[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Color",inlineLabel:!0,inputComponent:$0,clone(n){return[...n]}})],Ot);var xG=zt({props:{value:Object},setup(){}});const AG={key:0,class:"credit-info"},MG=["href"],SG=["href"],CG=["href"];function EG(n,e,t,i,s,r){return n.value?(Ce(),Be("div",AG,[Mo(" This work is based on "),ue("a",{href:n.value.url,target:"_blank"},Tn(n.value.name),9,MG),Mo(" by "),ue("a",{href:n.value.user.url,target:"_blank"},Tn(n.value.user.name),9,SG),Mo(" licensed under "),ue("a",{href:n.value.license.url,target:"_blank"},Tn(n.value.license.name),9,CG),Mo(". ")])):tt("",!0)}u(EG,"_sfc_render$j");var TG=Wt(xG,[["render",EG],["__scopeId","data-v-64ad5277"]]),PG=Object.defineProperty,RG=u((n,e)=>PG(n,"name",{value:e,configurable:!0}),"__name$2W");function sd(n){if(typeof n!="object"||!n)return n;if(Array.isArray(n))return n.map(sd);const e={};for(let t in n)if(n.hasOwnProperty(t)){const i=n[t];typeof i=="object"?ArrayBuffer.isView(i)?e[t]=i:Array.isArray(i)?e[t]=i.map(sd):e[t]=sd(i):e[t]=i}return e}u(sd,"deepClone");RG(sd,"deepClone");var xR=Object.defineProperty,IG=Object.getOwnPropertyDescriptor,DG=u((n,e)=>xR(n,"name",{value:e,configurable:!0}),"__name$2V"),LG=u((n,e,t,i)=>{for(var s=i>1?void 0:i?IG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&xR(e,t,s),s},"__decorateClass$11");let Sd=u(class extends Ne{constructor(){super(...arguments);S(this,"value",null)}},"CCredit");DG(Sd,"CCredit");Sd=LG([ze({storable:!0,dataType:Ie.STRING,clone:sd,label:"Credit",inputComponent:TG,serialize(n){return n?JSON.stringify(n):""},deserialize(n){return n?JSON.parse(n):null}})],Sd);var AR=Object.defineProperty,OG=Object.getOwnPropertyDescriptor,kG=u((n,e)=>AR(n,"name",{value:e,configurable:!0}),"__name$2U"),NG=u((n,e,t,i)=>{for(var s=i>1?void 0:i?OG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&AR(e,t,s),s},"__decorateClass$10");let Mn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",[0,0,0])}},"CEmissive");kG(Mn,"CEmissive");Mn=NG([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,equal:(n,e)=>new Te().setRGB(n[0],n[1],n[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Emissive",inlineLabel:!0,inputComponent:$0,clone(n){return[...n]}})],Mn);var FG=Object.defineProperty,Vh=u((n,e)=>FG(n,"name",{value:e,configurable:!0}),"__name$2T"),zG=zt({props:{value:{type:ke,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean,defaultValue:ke},emits:["input"],setup(n,e){const t=Ge(),i=Ge();let s=!1;function r(){s&&(l(),document.removeEventListener("mousedown",r))}u(r,"postOnMouseDown"),Vh(r,"postOnMouseDown");function o(h){return Number(h.toFixed(3))}u(o,"format"),Vh(o,"format");function a(){s||(s=!0,document.addEventListener("mousedown",r))}u(a,"onChange"),Vh(a,"onChange"),Ba(function(){document.removeEventListener("mousedown",r)});function l(){var h,f;if(s){s=!1;let d=Number(((h=t.value)==null?void 0:h.value)||"0")||0,p=Number(((f=i.value)==null?void 0:f.value)||"0")||0;e.emit("input",new ke(d,p))}}u(l,"onPost"),Vh(l,"onPost");function c(){const h=new ke;n.defaultValue&&h.copy(n.defaultValue),e.emit("input",h)}return u(c,"onReset"),Vh(c,"onReset"),{input0:t,input1:i,format:o,onChange:a,onPost:l,onReset:c}}});const BG=u(n=>(Fa("data-v-24b0778d"),n=n(),za(),n),"_withScopeId$2"),UG={class:"input-vec2"},$G=["value","readonly","disabled"],VG=["value","readonly","disabled"],GG=BG(()=>ue("img",{src:B0,alt:""},null,-1)),HG=[GG];function WG(n,e,t,i,s,r){return Ce(),Be("div",UG,[ue("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,$G),ue("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,VG),n.resettable?(Ce(),Be("button",{key:0,class:"normal-button",onClick:e[6]||(e[6]=(...o)=>n.onReset&&n.onReset(...o))},HG)):tt("",!0)])}u(WG,"_sfc_render$i");var V0=Wt(zG,[["render",WG],["__scopeId","data-v-24b0778d"]]),MR=Object.defineProperty,jG=Object.getOwnPropertyDescriptor,XG=u((n,e)=>MR(n,"name",{value:e,configurable:!0}),"__name$2S"),YG=u((n,e,t,i)=>{for(var s=i>1?void 0:i?jG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&MR(e,t,s),s},"__decorateClass$$");let Xl=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new ke(.5,.5))}},"CEndRadius2");XG(Xl,"CEndRadius2");Xl=YG([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,instanceable:!0,equal:wr,label:"End Radius",inputComponent:V0,clone(n){return new ke().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new ke(n[0],n[1])}})],Xl);var SR=Object.defineProperty,qG=Object.getOwnPropertyDescriptor,ZG=u((n,e)=>SR(n,"name",{value:e,configurable:!0}),"__name$2R"),KG=u((n,e,t,i)=>{for(var s=i>1?void 0:i?qG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&SR(e,t,s),s},"__decorateClass$_");let Cd=u(class extends Ne{constructor(){super(...arguments);S(this,"value",[1,1,1])}},"CGroundColor");ZG(Cd,"CGroundColor");Cd=KG([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,equal:(n,e)=>new Te().setRGB(n[0],n[1],n[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Ground Color",inputComponent:$0,clone(n){return[...n]}})],Cd);var CR=Object.defineProperty,QG=Object.getOwnPropertyDescriptor,JG=u((n,e)=>CR(n,"name",{value:e,configurable:!0}),"__name$2Q"),eH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?QG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&CR(e,t,s),s},"__decorateClass$Z");let nn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.5)}},"CHeight");JG(nn,"CHeight");nn=eH([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,label:"Height",inputComponent:Jn,inputComponentProps:{min:0,step:.001}})],nn);var ER=Object.defineProperty,tH=Object.getOwnPropertyDescriptor,nH=u((n,e)=>ER(n,"name",{value:e,configurable:!0}),"__name$2P"),iH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?tH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&ER(e,t,s),s},"__decorateClass$Y");let ka=u(class extends Ne{constructor(){super(...arguments);S(this,"value",[-180,180])}},"CHingeAngleRange");nH(ka,"CHingeAngleRange");ka=iH([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,label:"Hinge Limit",inputComponent:vR,inputComponentProps:{min:-360,max:360,maxDet:360}})],ka);var sH=Object.defineProperty,rH=u((n,e)=>sH(n,"name",{value:e,configurable:!0}),"__name$2O"),oH=zt({props:{value:String,disabled:Boolean,options:Array},emits:["input"],setup(n,e){const t=Ge();function i(){const s=t.value;s&&e.emit("input",s.value)}return u(i,"onChange"),rH(i,"onChange"),{selectDom:t,onChange:i}}});const aH=["value","disabled"],lH=["value"];function cH(n,e,t,i,s,r){return Ce(),Be("select",{class:"input-select",value:n.value,disabled:n.disabled,onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),ref:"selectDom"},[(Ce(!0),Be(Nt,null,Ta(n.options,o=>(Ce(),Be("option",{key:o,value:o},Tn(o),9,lH))),128))],40,aH)}u(cH,"_sfc_render$h");var oc=Wt(oH,[["render",cH],["__scopeId","data-v-f534510c"]]),TR=Object.defineProperty,uH=Object.getOwnPropertyDescriptor,hH=u((n,e)=>TR(n,"name",{value:e,configurable:!0}),"__name$2N"),fH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?uH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&TR(e,t,s),s},"__decorateClass$X");let cs=u(class extends Ne{constructor(){super(...arguments);S(this,"value","none")}},"CHingeAxis");hH(cs,"CHingeAxis");cs=fH([ze({storable:!0,dataType:Ie.STRING,autoCopy:!0,label:"Hinge",inputComponent:oc,inputComponentProps:{options:["none","horizontal","vertical"]}})],cs);var PR=Object.defineProperty,dH=Object.getOwnPropertyDescriptor,pH=u((n,e)=>PR(n,"name",{value:e,configurable:!0}),"__name$2M"),mH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?dH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&PR(e,t,s),s},"__decorateClass$W");const gv=24,Si=new T;let xt=u(class extends Ne{constructor(){super(...arguments);S(this,"value");S(this,"dirty",!0);S(this,"start",new T);S(this,"end",new T);S(this,"quaternion",new je);S(this,"boneMesh");S(this,"hingeIndicator");S(this,"moveHandler");S(this,"rotateHandler");S(this,"moveHandlerHovered",!1);S(this,"moveHandlerZ",0);S(this,"rotateHandlerHovered",!1);S(this,"rotateHandlerZ",0);S(this,"hingeEnabled",!1)}onRemoved(){var e,t;this.boneMesh&&(jl(this.boneMesh),this.boneMesh.removeFromParent()),this.hingeIndicator&&(jl(this.hingeIndicator),this.hingeIndicator.removeFromParent()),this.moveHandler&&(this.moveHandler.geometry.dispose(),(e=this.moveHandler.material)==null||e.dispose(),this.moveHandler.removeFromParent()),this.rotateHandler&&(this.rotateHandler.geometry.dispose(),(t=this.rotateHandler.material)==null||t.dispose(),this.rotateHandler.removeFromParent())}updateHandlersHoverState(e,t){var i,s;(i=this.moveHandler)!=null&&i.visible&&(Si.copy(this.start).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),Si.x+=1,Si.y+=1,Si.x*=t.width/2,Si.y*=t.height/2,this.moveHandlerZ=Si.z,Math.abs(t.mouseScr.x-Si.x)<=gv/2&&Math.abs(t.mouseScr.y-Si.y)<=gv/2&&(this.moveHandlerHovered=!0)),(s=this.rotateHandler)!=null&&s.visible&&(Si.copy(this.end).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),Si.x+=1,Si.y+=1,Si.x*=t.width/2,Si.y*=t.height/2,this.rotateHandlerZ=Si.z,Math.sqrt((t.mouseScr.x-Si.x)**2+(t.mouseScr.y-Si.y)**2)<=gv/2&&(this.rotateHandlerHovered=!0)),this.moveHandlerHovered&&this.rotateHandlerHovered&&(this.moveHandlerZ<this.rotateHandlerZ?this.rotateHandlerHovered=!1:this.moveHandlerHovered=!1)}resetHandlers(e){this.moveHandlerHovered=!1,this.rotateHandlerHovered=!1,this.boneMesh&&(this.boneMesh.visible=e.options.showIkBones),this.hingeIndicator&&(this.hingeIndicator.visible=e.options.showIkBones&&this.hingeEnabled),this.moveHandler&&(this.moveHandler.visible=!1),this.rotateHandler&&(this.rotateHandler.visible=!1)}},"CIkNode");pH(xt,"CIkNode");xt=mH([ze({})],xt);var RR=Object.defineProperty,gH=Object.getOwnPropertyDescriptor,vH=u((n,e)=>RR(n,"name",{value:e,configurable:!0}),"__name$2L"),yH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?gH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&RR(e,t,s),s},"__decorateClass$V");let Xi=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.2)}},"CIkNodeLength");vH(Xi,"CIkNodeLength");Xi=yH([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Length",inputComponent:Jn,inputComponentProps:{min:0}})],Xi);var _H=Object.defineProperty,Gh=u((n,e)=>_H(n,"name",{value:e,configurable:!0}),"__name$2K"),bH=zt({props:{value:{type:lt,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean},emits:["input"],setup(n,e){const t=Ge(),i=Ge(),s=Ge();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}u(o,"postOnMouseDown"),Gh(o,"postOnMouseDown");function a(f){return Number((f/Math.PI*180).toFixed(1))}u(a,"format"),Gh(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}u(l,"onChange"),Gh(l,"onChange"),Ba(function(){document.removeEventListener("mousedown",o)});function c(){var f,d,p;if(r){r=!1;let g=Number(((f=t.value)==null?void 0:f.value)||"0")||0,m=Number(((d=i.value)==null?void 0:d.value)||"0")||0,v=Number(((p=s.value)==null?void 0:p.value)||"0")||0;e.emit("input",new lt(g/180*Math.PI,m/180*Math.PI,v/180*Math.PI))}}u(c,"onPost"),Gh(c,"onPost");function h(){e.emit("input",new lt)}return u(h,"onReset"),Gh(h,"onReset"),{input0:t,input1:i,input2:s,format:a,onChange:l,onPost:c,onReset:h}}});const wH=u(n=>(Fa("data-v-6ff85571"),n=n(),za(),n),"_withScopeId$1"),xH={class:"input-euler"},AH=["value","readonly","disabled"],MH=["value","readonly","disabled"],SH=["value","readonly","disabled"],CH=wH(()=>ue("img",{src:B0,alt:""},null,-1)),EH=[CH];function TH(n,e,t,i,s,r){return Ce(),Be("div",xH,[ue("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,AH),ue("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,MH),ue("input",{type:"text",placeholder:"z",value:n.format(n.value.z),readonly:n.readonly,disabled:n.disabled,onInput:e[6]||(e[6]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[8]||(e[8]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input2"},null,40,SH),n.resettable?(Ce(),Be("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>n.onReset&&n.onReset(...o))},EH)):tt("",!0)])}u(TH,"_sfc_render$g");var IR=Wt(bH,[["render",TH],["__scopeId","data-v-6ff85571"]]),DR=Object.defineProperty,PH=Object.getOwnPropertyDescriptor,RH=u((n,e)=>DR(n,"name",{value:e,configurable:!0}),"__name$2J"),IH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?PH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&DR(e,t,s),s},"__decorateClass$U");let wn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new lt)}},"CIkNodeRotation");RH(wn,"CIkNodeRotation");wn=IH([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,instanceable:!0,equal(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8},label:"Rotation",inputComponent:IR,inputComponentProps:{resettable:!0},clone(n){return new lt().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new lt(n[0],n[1],n[2])}})],wn);var DH=Object.defineProperty,LH=u((n,e)=>DH(n,"name",{value:e,configurable:!0}),"__name$2I"),OH=zt({props:{value:String,accept:String},emits:["input"],setup(n,e){const t=Ge();async function i(){var o;if(!((o=t.value)!=null&&o.files))return;const s=t.value.files[0];if(!s)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsDataURL(s)});t.value.value="",e.emit("input",r)}return u(i,"onChange"),LH(i,"onChange"),{input:t,onChange:i}}});const kH={class:"input-file normal-button"},NH=["accept"];function FH(n,e,t,i,s,r){return Ce(),Be("div",null,[ue("label",kH,[ue("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),accept:n.accept},null,40,NH),Mo(" ... ")])])}u(FH,"_sfc_render$f");var LR=Wt(OH,[["render",FH],["__scopeId","data-v-cd0c5822"]]),OR=Object.defineProperty,zH=Object.getOwnPropertyDescriptor,BH=u((n,e)=>OR(n,"name",{value:e,configurable:!0}),"__name$2H"),UH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?zH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&OR(e,t,s),s},"__decorateClass$T");let Gr=u(class extends Ne{constructor(){super(...arguments);S(this,"value","");S(this,"dirty",!0);S(this,"texture")}onRemoved(){this.texture&&this.texture.dispose()}},"CImage");BH(Gr,"CImage");Gr=UH([ze({storable:!0,dataType:Ie.STRING,label:"Image File",inputComponent:LR,inputComponentProps:{accept:"image/png, image/jpeg, image/webp"}})],Gr);var kR=Object.defineProperty,$H=Object.getOwnPropertyDescriptor,VH=u((n,e)=>kR(n,"name",{value:e,configurable:!0}),"__name$2G"),GH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?$H(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&kR(e,t,s),s},"__decorateClass$S");let ko=u(class extends Ne{constructor(){super(...arguments);S(this,"value","");S(this,"dirty",!0)}},"CImportFbx");VH(ko,"CImportFbx");ko=GH([ze({storable:!0,dataType:Ie.STRING,label:".fbx File",inputComponent:LR,inputComponentProps:{accept:".fbx"}})],ko);var HH=Object.defineProperty,WH=u((n,e)=>HH(n,"name",{value:e,configurable:!0}),"__name$2F"),jH=zt({props:{value:String,accept:String},emits:["input"],setup(n,e){const t=Ge();async function i(){var o;if(!((o=t.value)!=null&&o.files))return;const s=t.value.files[0];if(!s)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsText(s)});t.value.value="",e.emit("input",r)}return u(i,"onChange"),WH(i,"onChange"),{input:t,onChange:i}}});const XH={class:"input-file normal-button"},YH=["accept"];function qH(n,e,t,i,s,r){return Ce(),Be("div",null,[ue("label",XH,[ue("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),accept:n.accept},null,40,YH),Mo(" ... ")])])}u(qH,"_sfc_render$e");var ZH=Wt(jH,[["render",qH],["__scopeId","data-v-51992a25"]]),NR=Object.defineProperty,KH=Object.getOwnPropertyDescriptor,QH=u((n,e)=>NR(n,"name",{value:e,configurable:!0}),"__name$2E"),JH=u((n,e,t,i)=>{for(var s=i>1?void 0:i?KH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&NR(e,t,s),s},"__decorateClass$R");let No=u(class extends Ne{constructor(){super(...arguments);S(this,"value","");S(this,"dirty",!0)}},"CImportObj");QH(No,"CImportObj");No=JH([ze({storable:!0,dataType:Ie.STRING,label:".obj File",inputComponent:ZH,inputComponentProps:{accept:".obj"}})],No);var FR=Object.defineProperty,e7=Object.getOwnPropertyDescriptor,t7=u((n,e)=>FR(n,"name",{value:e,configurable:!0}),"__name$2D"),n7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?e7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&FR(e,t,s),s},"__decorateClass$Q");let Fo=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new Uint8Array);S(this,"dirty",!0)}},"CImportReadonlyGltf");t7(Fo,"CImportReadonlyGltf");Fo=n7([ze({storable:!0,dataType:Ie.BYTES})],Fo);var zR=Object.defineProperty,i7=Object.getOwnPropertyDescriptor,s7=u((n,e)=>zR(n,"name",{value:e,configurable:!0}),"__name$2C"),r7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?i7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&zR(e,t,s),s},"__decorateClass$P");let Yl=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.25)}},"CInnerRadius");s7(Yl,"CInnerRadius");Yl=r7([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Section Radius",inputComponent:Jn,inputComponentProps:{min:0,step:.001}})],Yl);var o7=Object.defineProperty,qp=u((n,e)=>o7(n,"name",{value:e,configurable:!0}),"__name$2B"),a7=zt({props:{value:Number,min:{type:Number,required:!0},max:{type:Number,required:!0},step:Number},emits:["input"],setup(n,e){const t=st(function(){return n.step?Math.round(n.min/n.step):n.min}),i=st(function(){return n.step?Math.round(n.max/n.step):n.max}),s=st(function(){const d=n.value==null?0:n.value;return n.step?Math.round(d/n.step):d}),r=st(function(){const d=n.value==null?0:n.value;return n.step?d.toFixed(-Math.log10(n.step)):d});function o(d){let p=Number(d.target.value);n.step&&(p*=n.step),e.emit("input",p)}u(o,"onRangeInput"),qp(o,"onRangeInput");const a=Ge();let l=!1;function c(){l&&(f(),document.removeEventListener("mousedown",c))}u(c,"postOnMouseDown"),qp(c,"postOnMouseDown");function h(){l||(l=!0,document.addEventListener("mousedown",c))}u(h,"onChange"),qp(h,"onChange"),Ba(function(){document.removeEventListener("mousedown",c)});function f(){if(l){l=!1;const d=a.value;if(d){const p=d.value;let g=Number(p);isFinite(g)||(g=0),n.step!=null&&(g=Math.round(g/n.step)*n.step),n.min!=null&&(g=Math.max(n.min,g)),n.max!=null&&(g=Math.min(n.max,g)),e.emit("input",g)}}}return u(f,"onPost"),qp(f,"onPost"),{inputDom:a,onChange:h,onPost:f,iMin:t,iMax:i,iValue:s,text:r,onRangeInput:o}}});const l7={class:"input-range"},c7=["value","min","max"],u7=["value"];function h7(n,e,t,i,s,r){return Ce(),Be("div",l7,[ue("input",{class:"range",type:"range",value:n.iValue,min:n.iMin,max:n.iMax,onInput:e[0]||(e[0]=(...o)=>n.onRangeInput&&n.onRangeInput(...o))},null,40,c7),ue("input",{class:"num",type:"text",value:n.text,onInput:e[1]||(e[1]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[2]||(e[2]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[3]||(e[3]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,u7)])}u(h7,"_sfc_render$d");var Wa=Wt(a7,[["render",h7],["__scopeId","data-v-63841fa7"]]),BR=Object.defineProperty,f7=Object.getOwnPropertyDescriptor,d7=u((n,e)=>BR(n,"name",{value:e,configurable:!0}),"__name$2A"),p7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?f7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&BR(e,t,s),s},"__decorateClass$O");let Uu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",0)}},"CInnerRotation");d7(Uu,"CInnerRotation");Uu=p7([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,label:"Section Rotation",inputComponent:Wa,inputComponentProps:{min:0,max:360,step:.1}})],Uu);var UR=Object.defineProperty,m7=Object.getOwnPropertyDescriptor,g7=u((n,e)=>UR(n,"name",{value:e,configurable:!0}),"__name$2z"),v7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?m7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&UR(e,t,s),s},"__decorateClass$N");let $u=u(class extends Ne{constructor(){super(...arguments);S(this,"value",32)}},"CInnerSegments");g7($u,"CInnerSegments");$u=v7([ze({storable:!0,dataType:Ie.NUMBER,label:"Section Segments",inlineLabel:!0,inputComponent:Jn})],$u);var $R=Object.defineProperty,y7=Object.getOwnPropertyDescriptor,_7=u((n,e)=>$R(n,"name",{value:e,configurable:!0}),"__name$2y"),b7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?y7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&$R(e,t,s),s},"__decorateClass$M");let $i=u(class extends Ne{constructor(){super(...arguments);S(this,"value",1)}},"CIntensity");_7($i,"CIntensity");$i=b7([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Intensity",inputComponent:Jn,inputComponentProps:{min:0,step:.001}})],$i);var VR=Object.defineProperty,w7=Object.getOwnPropertyDescriptor,x7=u((n,e)=>VR(n,"name",{value:e,configurable:!0}),"__name$2x"),A7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?w7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&VR(e,t,s),s},"__decorateClass$L");let Yi=u(class extends Ne{constructor(){super(...arguments);S(this,"value",null);S(this,"camera",null)}onRemoved(){this.value&&(jl(this.value),this.value.removeFromParent(),this.value=null),this.camera&&(jl(this.camera),this.camera.removeFromParent(),this.camera=null)}},"CLightHelper");x7(Yi,"CLightHelper");Yi=A7([ze({})],Yi);var GR=Object.defineProperty,M7=Object.getOwnPropertyDescriptor,S7=u((n,e)=>GR(n,"name",{value:e,configurable:!0}),"__name$2w"),C7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?M7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&GR(e,t,s),s},"__decorateClass$K");let Ed=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!1)}},"CLockEnd");S7(Ed,"CLockEnd");Ed=C7([ze({storable:!0,dataType:Ie.BOOLEAN,autoCopy:!0,label:"Lock End",inlineLabel:!0,inputComponent:$o})],Ed);var HR=Object.defineProperty,E7=Object.getOwnPropertyDescriptor,T7=u((n,e)=>HR(n,"name",{value:e,configurable:!0}),"__name$2v"),P7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?E7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&HR(e,t,s),s},"__decorateClass$J");let Ro=u(class extends Ne{constructor(){super(...arguments);S(this,"value","512")}},"CMapSize");T7(Ro,"CMapSize");Ro=P7([ze({storable:!0,dataType:Ie.STRING,autoCopy:!0,label:"Shadow Quality",inputComponent:oc,inputComponentProps:{options:["128","256","512","1024","2048"]}})],Ro);var WR=Object.defineProperty,R7=Object.getOwnPropertyDescriptor,I7=u((n,e)=>WR(n,"name",{value:e,configurable:!0}),"__name$2u"),D7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?R7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&WR(e,t,s),s},"__decorateClass$I");let Sn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",0)}},"CMetalness");I7(Sn,"CMetalness");Sn=D7([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Metalness",inputComponent:Wa,inputComponentProps:{min:0,max:1,step:.01}})],Sn);var L7=Object.defineProperty,vv=u((n,e)=>L7(n,"name",{value:e,configurable:!0}),"__name$2t"),O7=zt({props:{value:String,readonly:Boolean,disabled:Boolean},emits:["input"],setup(n,e){const t=Ge();let i=!1;function s(){i&&(o(),document.removeEventListener("mousedown",s))}u(s,"postOnMouseDown"),vv(s,"postOnMouseDown");function r(){i||(i=!0,document.addEventListener("mousedown",s))}u(r,"onChange"),vv(r,"onChange"),Ba(function(){document.removeEventListener("mousedown",s)});function o(){if(i){i=!1;const a=t.value;a&&e.emit("input",a.value)}}return u(o,"onPost"),vv(o,"onPost"),{inputDom:t,onChange:r,onPost:o}}});const k7=["value","readonly","disabled"];function N7(n,e,t,i,s,r){return Ce(),Be("input",{class:"input-string",type:"text",value:n.value,readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=En((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,k7)}u(N7,"_sfc_render$c");var F7=Wt(O7,[["render",N7],["__scopeId","data-v-07fa832a"]]),jR=Object.defineProperty,z7=Object.getOwnPropertyDescriptor,B7=u((n,e)=>jR(n,"name",{value:e,configurable:!0}),"__name$2s"),U7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?z7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&jR(e,t,s),s},"__decorateClass$H");let Rt=u(class extends Ne{constructor(){super(...arguments);S(this,"value","")}},"CName");B7(Rt,"CName");Rt=U7([ze({storable:!0,dataType:Ie.STRING,instanceable:!0,label:"Name",inputComponent:F7})],Rt);var XR=Object.defineProperty,$7=Object.getOwnPropertyDescriptor,V7=u((n,e)=>XR(n,"name",{value:e,configurable:!0}),"__name$2r"),G7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?$7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&XR(e,t,s),s},"__decorateClass$G");let Vu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",30)}},"CNumOfSlices");V7(Vu,"CNumOfSlices");Vu=G7([ze({storable:!0,dataType:Ie.NUMBER,label:"Curve Segments",inlineLabel:!0,inputComponent:Jn})],Vu);var YR=Object.defineProperty,H7=Object.getOwnPropertyDescriptor,W7=u((n,e)=>YR(n,"name",{value:e,configurable:!0}),"__name$2q"),j7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?H7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&YR(e,t,s),s},"__decorateClass$F");let Jt=u(class extends Ne{constructor(){super(...arguments);S(this,"value",1)}},"COpacity");W7(Jt,"COpacity");Jt=j7([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Opacity",inputComponent:Wa,inputComponentProps:{min:0,max:1,step:.01}})],Jt);var qR=Object.defineProperty,X7=Object.getOwnPropertyDescriptor,Y7=u((n,e)=>qR(n,"name",{value:e,configurable:!0}),"__name$2p"),q7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?X7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&qR(e,t,s),s},"__decorateClass$E");let ql=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.5)}},"COuterRadius");Y7(ql,"COuterRadius");ql=q7([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Radius",inputComponent:Jn,inputComponentProps:{min:0,step:.001}})],ql);var ZR=Object.defineProperty,Z7=Object.getOwnPropertyDescriptor,K7=u((n,e)=>ZR(n,"name",{value:e,configurable:!0}),"__name$2o"),Q7=u((n,e,t,i)=>{for(var s=i>1?void 0:i?Z7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&ZR(e,t,s),s},"__decorateClass$D");let Gu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",360)}},"COuterRotation");K7(Gu,"COuterRotation");Gu=Q7([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,label:"Angle",inputComponent:Wa,inputComponentProps:{min:0,max:360,step:.1}})],Gu);var KR=Object.defineProperty,J7=Object.getOwnPropertyDescriptor,e9=u((n,e)=>KR(n,"name",{value:e,configurable:!0}),"__name$2n"),t9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?J7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&KR(e,t,s),s},"__decorateClass$C");let Hu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",32)}},"COuterSegments");e9(Hu,"COuterSegments");Hu=t9([ze({storable:!0,dataType:Ie.NUMBER,label:"Segments",inlineLabel:!0,inputComponent:Jn})],Hu);var QR=Object.defineProperty,n9=Object.getOwnPropertyDescriptor,i9=u((n,e)=>QR(n,"name",{value:e,configurable:!0}),"__name$2m"),s9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?n9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&QR(e,t,s),s},"__decorateClass$B");let Td=u(class extends Ne{constructor(){super(...arguments);S(this,"value",0)}},"CPenumbra");i9(Td,"CPenumbra");Td=s9([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,label:"Edge Softness",inputComponent:Wa,inputComponentProps:{min:0,max:1,step:.01}})],Td);var JR=Object.defineProperty,r9=Object.getOwnPropertyDescriptor,o9=u((n,e)=>JR(n,"name",{value:e,configurable:!0}),"__name$2l"),a9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?r9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&JR(e,t,s),s},"__decorateClass$A");let Le=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new T)}},"CPosition");o9(Le,"CPosition");Le=a9([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,instanceable:!0,equal:wr,label:"Position",inputComponent:Yd,inputComponentProps:{resettable:!0},clone(n){return new T().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new T(n[0],n[1],n[2])}})],Le);var eI=Object.defineProperty,l9=Object.getOwnPropertyDescriptor,c9=u((n,e)=>eI(n,"name",{value:e,configurable:!0}),"__name$2k"),u9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?l9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&eI(e,t,s),s},"__decorateClass$z");let as=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.5)}},"CRadius");c9(as,"CRadius");as=u9([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Radius",inputComponent:Jn,inputComponentProps:{min:0,step:.001}})],as);var tI=Object.defineProperty,h9=Object.getOwnPropertyDescriptor,f9=u((n,e)=>tI(n,"name",{value:e,configurable:!0}),"__name$2j"),d9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?h9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&tI(e,t,s),s},"__decorateClass$y");let hr=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new T(.5,.5,.5))}},"CRadius3");f9(hr,"CRadius3");hr=d9([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,equal:wr,label:"Radius",inputComponent:Yd,clone(n){return new T().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new T(n[0],n[1],n[2])}})],hr);var nI=Object.defineProperty,p9=Object.getOwnPropertyDescriptor,m9=u((n,e)=>nI(n,"name",{value:e,configurable:!0}),"__name$2i"),g9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?p9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&nI(e,t,s),s},"__decorateClass$x");let Ui=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!0)}},"CReceiveShadow");m9(Ui,"CReceiveShadow");Ui=g9([ze({storable:!0,dataType:Ie.BOOLEAN,instanceable:!0,label:"Receive Shadow",inlineLabel:!0,inputComponent:$o})],Ui);var iI=Object.defineProperty,v9=Object.getOwnPropertyDescriptor,y9=u((n,e)=>iI(n,"name",{value:e,configurable:!0}),"__name$2h"),_9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?v9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&iI(e,t,s),s},"__decorateClass$w");let Qe=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new lt)}},"CRotation");y9(Qe,"CRotation");Qe=_9([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,instanceable:!0,equal(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8},label:"Rotation",inputComponent:IR,inputComponentProps:{resettable:!0},clone(n){return new lt().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new lt(n[0],n[1],n[2])}})],Qe);var sI=Object.defineProperty,b9=Object.getOwnPropertyDescriptor,w9=u((n,e)=>sI(n,"name",{value:e,configurable:!0}),"__name$2g"),x9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?b9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&sI(e,t,s),s},"__decorateClass$v");let Cn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",1)}},"CRoughness");w9(Cn,"CRoughness");Cn=x9([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Roughness",inputComponent:Wa,inputComponentProps:{min:0,max:1,step:.01}})],Cn);var rI=Object.defineProperty,A9=Object.getOwnPropertyDescriptor,M9=u((n,e)=>rI(n,"name",{value:e,configurable:!0}),"__name$2f"),S9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?A9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&rI(e,t,s),s},"__decorateClass$u");let Ps=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.05)}},"CRoundRadius");M9(Ps,"CRoundRadius");Ps=S9([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Round Radius",inputComponent:Jn,inputComponentProps:{min:0,step:.001}})],Ps);var oI=Object.defineProperty,C9=Object.getOwnPropertyDescriptor,E9=u((n,e)=>oI(n,"name",{value:e,configurable:!0}),"__name$2e"),T9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?C9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&oI(e,t,s),s},"__decorateClass$t");let Ft=u(class extends Ne{constructor(){super(...arguments);S(this,"value",1)}},"CScale");E9(Ft,"CScale");Ft=T9([ze({storable:!0,dataType:Ie.NUMBER,instanceable:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Scale",inputComponent:Jn,inputComponentProps:{resettable:!0,defaultValue:1}})],Ft);var aI=Object.defineProperty,P9=Object.getOwnPropertyDescriptor,R9=u((n,e)=>aI(n,"name",{value:e,configurable:!0}),"__name$2d"),I9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?P9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&aI(e,t,s),s},"__decorateClass$s");let St=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new T(1,1,1))}},"CScale3");R9(St,"CScale3");St=I9([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,instanceable:!0,equal:wr,label:"Scale",inputComponent:Yd,inputComponentProps:{resettable:!0,defaultValue:new T(1,1,1)},clone(n){return new T().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new T(n[0],n[1],n[2])}})],St);var lI=Object.defineProperty,D9=Object.getOwnPropertyDescriptor,L9=u((n,e)=>lI(n,"name",{value:e,configurable:!0}),"__name$2c"),O9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?D9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&lI(e,t,s),s},"__decorateClass$r");let Cs=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!0);S(this,"throttleHash","")}},"CSdfDirty");L9(Cs,"CSdfDirty");Cs=O9([ze({})],Cs);var cI=Object.defineProperty,k9=Object.getOwnPropertyDescriptor,N9=u((n,e)=>cI(n,"name",{value:e,configurable:!0}),"__name$2b"),F9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?k9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&cI(e,t,s),s},"__decorateClass$q");let Wu=u(class extends Ne{constructor(){super(...arguments);S(this,"value","add")}},"CSdfOperator");N9(Wu,"CSdfOperator");Wu=F9([ze({storable:!0,dataType:Ie.STRING,label:"Operator",inputComponent:oc,inputComponentProps:{options:["add","subtract"]}})],Wu);var uI=Object.defineProperty,z9=Object.getOwnPropertyDescriptor,B9=u((n,e)=>uI(n,"name",{value:e,configurable:!0}),"__name$2a"),U9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?z9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&uI(e,t,s),s},"__decorateClass$p");let Zn=u(class extends Ne{constructor(){super(...arguments);S(this,"value",32)}},"CSegments");B9(Zn,"CSegments");Zn=U9([ze({storable:!0,dataType:Ie.NUMBER,label:"Segments",inlineLabel:!0,inputComponent:Jn})],Zn);var hI=Object.defineProperty,$9=Object.getOwnPropertyDescriptor,V9=u((n,e)=>hI(n,"name",{value:e,configurable:!0}),"__name$29"),G9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?$9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&hI(e,t,s),s},"__decorateClass$o");let Pd=u(class extends Ne{constructor(){super(...arguments);S(this,"value",10)}},"CShadowMappingRange");V9(Pd,"CShadowMappingRange");Pd=G9([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,label:"Shadow Mapping Range",inputComponent:Jn,inputComponentProps:{min:0}})],Pd);var fI=Object.defineProperty,H9=Object.getOwnPropertyDescriptor,W9=u((n,e)=>fI(n,"name",{value:e,configurable:!0}),"__name$28"),j9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?H9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&fI(e,t,s),s},"__decorateClass$n");let ju=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!1)}},"CShowMoveHandler");W9(ju,"CShowMoveHandler");ju=j9([ze({storable:!0,dataType:Ie.BOOLEAN,autoCopy:!0,label:"Move Handler",inlineLabel:!0,inputComponent:$o})],ju);var dI=Object.defineProperty,X9=Object.getOwnPropertyDescriptor,Y9=u((n,e)=>dI(n,"name",{value:e,configurable:!0}),"__name$27"),q9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?X9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&dI(e,t,s),s},"__decorateClass$m");let Xu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!0)}},"CShowRotateHandler");Y9(Xu,"CShowRotateHandler");Xu=q9([ze({storable:!0,dataType:Ie.BOOLEAN,autoCopy:!0,label:"Rotate Handler",inlineLabel:!0,inputComponent:$o})],Xu);var pI=Object.defineProperty,Z9=Object.getOwnPropertyDescriptor,K9=u((n,e)=>pI(n,"name",{value:e,configurable:!0}),"__name$26"),Q9=u((n,e,t,i)=>{for(var s=i>1?void 0:i?Z9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&pI(e,t,s),s},"__decorateClass$l");let gi=u(class extends Ne{constructor(){super(...arguments);S(this,"value","positive")}},"CSign");K9(gi,"CSign");gi=Q9([ze({storable:!0,dataType:Ie.STRING,instanceable:!0,label:"Sign",inlineLabel:!0,inputComponent:oc,inputComponentProps:{options:["positive","negative"]}})],gi);var mI=Object.defineProperty,J9=Object.getOwnPropertyDescriptor,eW=u((n,e)=>mI(n,"name",{value:e,configurable:!0}),"__name$25"),tW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?J9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&mI(e,t,s),s},"__decorateClass$k");let Hs=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new T(1,1,1))}},"CSize3");eW(Hs,"CSize3");Hs=tW([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,equal:wr,label:"Size",inputComponent:Yd,inputComponentProps:{resettable:!0},clone(n){return new T().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new T(n[0],n[1],n[2])}})],Hs);var gI=Object.defineProperty,nW=Object.getOwnPropertyDescriptor,iW=u((n,e)=>gI(n,"name",{value:e,configurable:!0}),"__name$24"),sW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?nW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&gI(e,t,s),s},"__decorateClass$j");let Rd=u(class extends Ne{constructor(){super(...arguments);S(this,"value",[1,1,1])}},"CSkyColor");iW(Rd,"CSkyColor");Rd=sW([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,autoCopy:!0,equal:(n,e)=>new Te().setRGB(n[0],n[1],n[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Sky Color",inputComponent:$0,clone(n){return[...n]}})],Rd);var vI=Object.defineProperty,rW=Object.getOwnPropertyDescriptor,oW=u((n,e)=>vI(n,"name",{value:e,configurable:!0}),"__name$23"),aW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?rW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&vI(e,t,s),s},"__decorateClass$i");let Yu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",0)}},"CSliceAngleEnd");oW(Yu,"CSliceAngleEnd");Yu=aW([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Angle End",inlineLabel:!0,inputComponent:Jn})],Yu);var yI=Object.defineProperty,lW=Object.getOwnPropertyDescriptor,cW=u((n,e)=>yI(n,"name",{value:e,configurable:!0}),"__name$22"),uW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?lW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&yI(e,t,s),s},"__decorateClass$h");let qu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",0)}},"CSliceAngleStart");cW(qu,"CSliceAngleStart");qu=uW([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Angle Start",inlineLabel:!0,inputComponent:Jn})],qu);var _I=Object.defineProperty,hW=Object.getOwnPropertyDescriptor,fW=u((n,e)=>_I(n,"name",{value:e,configurable:!0}),"__name$21"),dW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?hW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&_I(e,t,s),s},"__decorateClass$g");let Zu=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.5)}},"CSliceInnerRadius");fW(Zu,"CSliceInnerRadius");Zu=dW([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Star Inner Radius",inputComponent:Wa,inputComponentProps:{min:0,max:1,step:.001}})],Zu);var bI=Object.defineProperty,pW=Object.getOwnPropertyDescriptor,mW=u((n,e)=>bI(n,"name",{value:e,configurable:!0}),"__name$20"),gW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?pW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&bI(e,t,s),s},"__decorateClass$f");let Ku=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!1)}},"CSlicePreventTwisting");mW(Ku,"CSlicePreventTwisting");Ku=gW([ze({storable:!0,dataType:Ie.BOOLEAN,label:"Prevent Twisting",inlineLabel:!0,inputComponent:$o})],Ku);var wI=Object.defineProperty,vW=Object.getOwnPropertyDescriptor,yW=u((n,e)=>wI(n,"name",{value:e,configurable:!0}),"__name$1$"),_W=u((n,e,t,i)=>{for(var s=i>1?void 0:i?vW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&wI(e,t,s),s},"__decorateClass$e");let Qu=u(class extends Ne{constructor(){super(...arguments);S(this,"value","ellipse")}},"CSliceShape");yW(Qu,"CSliceShape");Qu=_W([ze({storable:!0,dataType:Ie.STRING,label:"Shape",inlineLabel:!0,inputComponent:oc,inputComponentProps:{options:["ellipse","rectangle","star"]}})],Qu);var xI=Object.defineProperty,bW=Object.getOwnPropertyDescriptor,wW=u((n,e)=>xI(n,"name",{value:e,configurable:!0}),"__name$1_"),xW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?bW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&xI(e,t,s),s},"__decorateClass$d");let Zl=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new ke(.1,.1))}},"CSliceSize2End");wW(Zl,"CSliceSize2End");Zl=xW([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,equal(n,e){return n.equals(e)},label:"End Size",inputComponent:V0,clone(n){return new ke().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new ke(n[0],n[1])}})],Zl);var AI=Object.defineProperty,AW=Object.getOwnPropertyDescriptor,MW=u((n,e)=>AI(n,"name",{value:e,configurable:!0}),"__name$1Z"),SW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?AW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&AI(e,t,s),s},"__decorateClass$c");let Kl=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new ke(.1,.1))}},"CSliceSize2Start");MW(Kl,"CSliceSize2Start");Kl=SW([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,equal(n,e){return n.equals(e)},label:"Start Size",inputComponent:V0,clone(n){return new ke().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new ke(n[0],n[1])}})],Kl);var MI=Object.defineProperty,CW=Object.getOwnPropertyDescriptor,EW=u((n,e)=>MI(n,"name",{value:e,configurable:!0}),"__name$1Y"),TW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?CW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&MI(e,t,s),s},"__decorateClass$b");let Ju=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.006)}},"CSmooth");EW(Ju,"CSmooth");Ju=TW([ze({storable:!0,dataType:Ie.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Smooth",inputComponent:Jn,inputComponentProps:{min:0}})],Ju);var SI=Object.defineProperty,PW=Object.getOwnPropertyDescriptor,RW=u((n,e)=>SI(n,"name",{value:e,configurable:!0}),"__name$1X"),IW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?PW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&SI(e,t,s),s},"__decorateClass$a");let Id=u(class extends Ne{constructor(){super(...arguments);S(this,"value",30)}},"CSpotLightAngle");RW(Id,"CSpotLightAngle");Id=IW([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,label:"Angle",inputComponent:Wa,inputComponentProps:{min:0,max:90,step:.1}})],Id);var CI=Object.defineProperty,DW=Object.getOwnPropertyDescriptor,LW=u((n,e)=>CI(n,"name",{value:e,configurable:!0}),"__name$1W"),OW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?DW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&CI(e,t,s),s},"__decorateClass$9");let Ql=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new ke(.5,.5))}},"CStartRadius2");LW(Ql,"CStartRadius2");Ql=OW([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,instanceable:!0,equal:wr,label:"Start Radius",inputComponent:V0,clone(n){return new ke().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new ke(n[0],n[1])}})],Ql);var EI=Object.defineProperty,kW=Object.getOwnPropertyDescriptor,NW=u((n,e)=>EI(n,"name",{value:e,configurable:!0}),"__name$1V"),FW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?kW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&EI(e,t,s),s},"__decorateClass$8");let eh=u(class extends Ne{constructor(){super(...arguments);S(this,"value",5)}},"CStarVertices");NW(eh,"CStarVertices");eh=FW([ze({storable:!0,dataType:Ie.NUMBER,label:"Star Vertices",inputComponent:Jn})],eh);var TI=Object.defineProperty,zW=Object.getOwnPropertyDescriptor,BW=u((n,e)=>TI(n,"name",{value:e,configurable:!0}),"__name$1U"),UW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?zW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&TI(e,t,s),s},"__decorateClass$7");let Li=u(class extends Ne{constructor(){super(...arguments);S(this,"value","none")}},"CSymmetry");BW(Li,"CSymmetry");Li=UW([ze({storable:!0,dataType:Ie.STRING,label:"Symmetry",inputComponent:oc,inputComponentProps:{options:["none","x","y","z"]}})],Li);var PI=Object.defineProperty,$W=Object.getOwnPropertyDescriptor,VW=u((n,e)=>PI(n,"name",{value:e,configurable:!0}),"__name$1T"),GW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?$W(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&PI(e,t,s),s},"__decorateClass$6");let _r=u(class extends Ne{constructor(){super(...arguments);S(this,"value",new T(1,1,1))}},"CTemporaryScale");VW(_r,"CTemporaryScale");_r=GW([ze({autoCopy:!0,clone(n){return new T().copy(n)}})],_r);var RI=Object.defineProperty,HW=Object.getOwnPropertyDescriptor,WW=u((n,e)=>RI(n,"name",{value:e,configurable:!0}),"__name$1S"),jW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?HW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&RI(e,t,s),s},"__decorateClass$5");let Dd=u(class extends Ne{constructor(){super(...arguments);S(this,"value","512")}},"CTextureSize");WW(Dd,"CTextureSize");Dd=jW([ze({storable:!0,dataType:Ie.STRING,autoCopy:!0,label:"Texture Quality",inputComponent:oc,inputComponentProps:{options:["128","256","512","1024","2048"]}})],Dd);var II=Object.defineProperty,XW=Object.getOwnPropertyDescriptor,DI=u((n,e)=>II(n,"name",{value:e,configurable:!0}),"__name$1R"),YW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?XW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&II(e,t,s),s},"__decorateClass$4");function Xb(n){return n.map(e=>({radius:e.radius,position:new T().copy(e.position)}))}u(Xb,"cloneTube");DI(Xb,"cloneTube");const rd=new Di({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:2273612,opacity:.75}),Wg=rd.clone();Wg.color.setHex(16776960);Wg.opacity=1;const od=rd.clone();od.color.setHex(15964205);od.opacity=1;var kf;let ft=u((kf=class extends Ne{constructor(){super(...arguments);S(this,"value",[]);S(this,"dirty",!0);S(this,"group");S(this,"pickers",[]);S(this,"circles",[]);S(this,"lines",[]);S(this,"hovered",-1);S(this,"selected",[]);S(this,"draggingStartValue");S(this,"draggingStartMatrix");S(this,"draggingStartInvMatrix");S(this,"draggingStartNodeIndex",-1)}onRemoved(){var e;(e=this.group)==null||e.removeFromParent()}updateColor(){for(let e=0,t=this.circles.length;e<t;++e){const i=this.circles[e];if(this.selected.includes(e)||e===this.draggingStartNodeIndex?i.material=od:e===this.hovered?i.material=Wg:i.material=rd,e<t-1){const s=this.lines[e];this.selected.includes(e)&&this.selected.includes(e+1)?s.material=od:s.material=rd}}}addSelection(e){this.selected.includes(e)||this.selected.push(e)}clone(e=this.value){return Xb(e)}},S(kf,"normalMaterial",rd),S(kf,"hoveredMaterial",Wg),S(kf,"selectedMaterial",od),kf),"CTube");DI(ft,"CTube");ft=YW([ze({storable:!0,dataType:Ie.NUMBER_ARRAY,equal(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;++t){const s=n[t],r=e[t];if(Math.abs(s.radius-r.radius)>1e-8||!wr(s.position,r.position))return!1}return!0},clone:Xb,serialize(n){const e=[];for(let t of n)e.push(t.radius,t.position.x,t.position.y,t.position.z);return e},deserialize(n){const e=[];for(let t=0,i=n.length;t<i;t+=4)e.push({radius:n[t],position:new T(n[t+1],n[t+2],n[t+3])});return e}})],ft);var LI=Object.defineProperty,qW=Object.getOwnPropertyDescriptor,ZW=u((n,e)=>LI(n,"name",{value:e,configurable:!0}),"__name$1Q"),KW=u((n,e,t,i)=>{for(var s=i>1?void 0:i?qW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&LI(e,t,s),s},"__decorateClass$3");let Xs=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!1)}},"CUsePlainMaterial");ZW(Xs,"CUsePlainMaterial");Xs=KW([ze({storable:!0,dataType:Ie.BOOLEAN,label:"Use Plain Material",inlineLabel:!0,inputComponent:$o})],Xs);var OI=Object.defineProperty,QW=Object.getOwnPropertyDescriptor,JW=u((n,e)=>OI(n,"name",{value:e,configurable:!0}),"__name$1P"),ej=u((n,e,t,i)=>{for(var s=i>1?void 0:i?QW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&OI(e,t,s),s},"__decorateClass$2");let ht=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!0)}},"CVisible");JW(ht,"CVisible");ht=ej([ze({storable:!0,dataType:Ie.BOOLEAN,instanceable:!0})],ht);var kI=Object.defineProperty,tj=Object.getOwnPropertyDescriptor,nj=u((n,e)=>kI(n,"name",{value:e,configurable:!0}),"__name$1O"),ij=u((n,e,t,i)=>{for(var s=i>1?void 0:i?tj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&kI(e,t,s),s},"__decorateClass$1");let Ld=u(class extends Ne{constructor(){super(...arguments);S(this,"value",.5)}},"CWidth");nj(Ld,"CWidth");Ld=ij([ze({storable:!0,dataType:Ie.NUMBER,autoCopy:!0,label:"Width",inputComponent:Jn,inputComponentProps:{min:0,step:.001}})],Ld);var sj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntlDEOACEIBMH4/y/PNVqK6xEbw9TLbDQEs6LI4koIQJK5S75jOYNr8ijb/w5Odt+yLFCGlRe2XSBLFTxSALDauHRBJDcLbtHV+1O8xQcgdTP9QsaHuQAAAABJRU5ErkJggg==",rj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGJJREFUSIntlMEOwCAMQsX4/7/cXU1cIwM9rRyb8tBIbK1UcgVmKSJiMQKY5wAoFgV/m2d7EvzIvnIi2iNd93ZA5hlfQRk4a1F3A3b1tANkse+gFoIyW/AdhIVbfxHjLf1ADzNkU8v8yWLDAAAAAElFTkSuQmCC",oj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGlJREFUSIntk8EOwCAIQ8X//+futEQZSgnsRi8m+KCKOEarlZUwEAC4hUSoWmbxm8G7xxwinKzjFne8VrQtAEC3yWuLZhh+S1xXljvxUwei0+DxH4NqlRjcHjht4E1PyoAZzbJ/0Gr9pwf7m2fK2pb3HwAAAABJRU5ErkJggg==",aj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGJJREFUSIntlEsOABAMRFXc/8pjg1gYoZ+NeDsJr60JKX2eRyyHAWCIREyurXy17mTXql6sumUTFI3U9b7ROC1+LffcFyI/zoCJVXmwrjChbYwWMEt3Mos8/CXTgEI/ss9bVP0SW8Od0GmxAAAAAElFTkSuQmCC",lj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAEVJREFUSIljYBgFo2AUMJKi+P/////hGhkZSdJLkuHY+FQ1nKqWEDKEkDwTxS4gAGhuAVGApnGAyzBiDR88+WAUjIKBAwBuly/fa4hrDAAAAABJRU5ErkJggg==",cj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntlDEOACEIBMH4/y/PNVqK6xEbw9TLbDQEs6LI4koIQJK5S75jOYNr8ijb/w5Odt+yLFCGlRe2XSBLFTxSALDauHRBJDcLbtHV+1O8xQcgdTP9QsaHuQAAAABJRU5ErkJggg==",uj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFJJREFUSIljYBgFwx4wEqPo/////7FqZmQkSj9eg3EZTow8QcOpoZaFGI24goIYR+C1AGYwoTgg2wfoBpEDmMjVOGrBqAXEAWoUFQNb2I2C4QEA1pU/86LVRNwAAAAASUVORK5CYII=",hj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFpJREFUSIljYBgFwx4wEqvw/////1E0MjISrZdkw3GJYQMslFhCFYDPYGIsZaKucwbAAryAmCAgpGboB9HAxQEp6R6f2oFPRYQyGiGfElVg4TKEqgXeKBi6AABeBzvf6MK7nQAAAABJRU5ErkJggg==",fj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFJJREFUSIljYBgFwx4wEqvw/////1E0MjISrZegweiG4xMn2XBqqKFYIz61TGTZTikgx9u49NDcB0PfApxgaKciGKBpRkM2gJKiYuALu1Ew9AEAikNPxTqns+wAAAAASUVORK5CYII=",dj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntk0sOABAMRI24/5VrJREZMagF8TaiUdNvCJ/nATOamUnOAPUfogioQcSlCCY4LkBp0y93dtYsC8wE0SKViDmrEyQJsM9cp+hIBnXzAKDXaBd2Fu/+RUvqQ9eaf94iA4BHZ8IWGlTXAAAAAElFTkSuQmCC",pj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGRJREFUSIntlEEKACEMA63//3O9iQetTcyyCM5NbDKiYCmPv7Fo0929D5qFszBj+WwtLZdLoiKJZFdyLMkUHEmyYVqCBCkJGoIlzKmgDHu3s1xlihA+FyxRPXT6N90h/20f99AAFR1frx4A45oAAAAASUVORK5CYII=",mj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFdJREFUSIljYBgFAw0Y8Un+////P1whIyNetSQDZMOx8alqOCWWMFHunFELBrsFLKRqwJWSSMon5CRHkvSQm6mw6Rv6kYwTkBpMOCOfWpZQvbQdBUMHAADHwTPtL/6pwwAAAABJRU5ErkJggg==",gj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFtJREFUSIntlEsOABAQQ9X971xbkRkpIoh5m9n1k4aUgn8hSeUuiR/lmgZYMQQAkqyv5NoKWgZqy+wlk5IIhqbBzAZeqO0NTKF2uN7Io0GmueZdnAmx9eML3qcABu5vvYZpbJgAAAAASUVORK5CYII=",vj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntk8EOwCAIQ63Z//8yO5kYB1iCiTvwjkhbotJaUfweME0iIqoYoPSusWXOnG/NNTPNNBwyC6wp1zodEhXt+juVmuDxDgFgTLX+GKtO4d259ybpkBO9H2F2D+5uclFQvCsPj41FND51AAAAAElFTkSuQmCC",yj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntkcEKwCAMQxvx/3+5ngo63KK2wg59pyIkMa1IkvwezB5VVY/MgKlfSMCbpjCRCfu5N2Sf+QwQGWsDwG47GuCFBjzXYo2sDTvs8YrM3H0DL1sBKytZNorS1MiQJLlDA/9ET+yIPaCNAAAAAElFTkSuQmCC",_j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHBJREFUSIntlMEOwCAIQ2X//8/dZVuMoZt0eNDYG4J9hBBK2VpexhIA8BSZ0TpJtbkXp5r3QHDJyx0KrK0JjfCrUxaHxtgzJtm8/uR99N5/LUFryKAygIGGABTz1zWNwtIA6afjlrI94U6GHsGtOXUCrECLjc6LLwMAAAAASUVORK5CYII=",bj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntkkEKACAIBLP//9lOhgdJSlc6ODdhmYFojKaJQt6AmXmPidz9FVpu3any18iMxEKcpGnBsoglS3+2sgj061pSSEDEIodFtBwegQaav1kXY2ucLK26fgAAAABJRU5ErkJggg==",wj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF9JREFUSIntk0EOwCAIBN2m///y9m4WLIKJB+ZiRN0hRsdomuuBKpLkVhgg80oE1pknGhRlKdi9rl8CkgSArEQGz6HR+VLg1eexTKDWlCwlsPYffabeB3u9rirkTZPnA+JpX7qX66AGAAAAAElFTkSuQmCC",xj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFtJREFUSIntk0EKACAIBN3o/1+2a5iVqEQH5yJI7oopUVF8D7QkM7NLDFD1Ugx2Nd1SCABzlG9OnTeLuCYmo8sgg7DB7b9MBieRv0c0bw+R/z4WntxBWrdFEWYA0ho4CpvAbnEAAAAASUVORK5CYII=",Hh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGNJREFUSIljYBgFAw0YiVX4/////ygaGRmJ1kvQYHTD8YmTbDilapgocgElgBTv41NLtA+QDaE47HEZiByxVLFwaEcyDNA0HyAbRowYNjDwQQQD5KYaFnItGTRg4IvrUUBzAAC2uXOjDxKDVAAAAABJRU5ErkJggg==",Aj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntk8EKACEIRDP2/3959hRI4DqNnRbfLQqfNjVG83ss2gAAuohZWCeEFWTnHkXoO866pwWn4sWsCjLoCaQgTwRqBtQV7S/Fr+GQBYr4ioCBykANOBV8/VJWGgoqXTfNXV4/VTgWLIRfCQAAAABJRU5ErkJggg==",Mj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntkkkKACEMBO1h/v/l8jIDIlGJC3hInVzoVCKmFATXI+sQYKqYZNbbImhlHk+QD08zXQGAJJVF6v2I4QSruAX/VMcE1z2RSf1zynXvbkqwmnl3SoLgDBnHw1PSkFB0SwAAAABJRU5ErkJggg==",Sj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAE5JREFUSIljYBgFwx4w4pP8////fxTFjIx41ZME0A3HJUY1w6lqCSFDKLaEGAMosoRYzaOWDC5LaJ6yaJ4/aJrL8RlOVuFF00JwFAw9AACJKmejS/9FQQAAAABJRU5ErkJggg==",Cj="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFdJREFUSIljYBgFo4BSwEiswv/////H0MzISLR+og3HxaaK4cTwKTKcFDGyDCdHnIlkm0kEOFMBOd4mKVUNmSDCC2iainBppmo+wGYIqTl5cJRFo2BoAwCKVWuoeE0X9QAAAABJRU5ErkJggg==",Ej="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAEVJREFUSIljYBgFo2AUMJKi+P/////hGhkZSdJLkuHY+FQ1nKqWEDKEkDwTxS4gAGhuAVGApnGAyzBiDR88+WAUjIKBAwBuly/fa4hrDAAAAABJRU5ErkJggg==",NI=Object.defineProperty,Tj=Object.getOwnPropertyDescriptor,Pj=u((n,e)=>NI(n,"name",{value:e,configurable:!0}),"__name$1N"),Rj=u((n,e,t,i)=>{for(var s=i>1?void 0:i?Tj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&NI(e,t,s),s},"__decorateClass");let qt=u(class extends Ne{constructor(){super(...arguments);S(this,"value",!1)}},"CDisableFlip");Pj(qt,"CDisableFlip");qt=Rj([ze({storable:!0,dataType:Ie.BOOLEAN,instanceable:!0,label:"Disable Flip",inlineLabel:!0,inputComponent:$o})],qt);var Ij=Object.defineProperty,FI=u((n,e)=>Ij(n,"name",{value:e,configurable:!0}),"__name$1M");const zI=[{name:"Container",label:"Container",icon:oj,showInList:!0,instanceable:!0,components:[Rt,ht,qt,Le,Qe,Ft,Jt,Me],canBeRoot:!0,validChildTypes:["Container","IKChain","Image","CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier","ObjModel","FbxModel","ImportModel","Box","Shape","Clay","Mirror","AmbientLight","HemisphereLight","DirectionalLight","PointLight","SpotLight"]},{name:"IKChain",label:"IK Chain",icon:_j,showInList:!0,instanceable:!0,components:[Rt,ht,qt,Le,Qe,Ft,Jt,Me,ju,Ed],canBeRoot:!0,validChildTypes:["IKNode"]},{name:"IKNode",label:"IK Node",icon:bj,showInList:!0,instanceable:!0,components:[Rt,ht,qt,Jt,Me,xt,Xi,wn,Xu,cs,ka],canBeRoot:!1,validChildTypes:["Container","IKChain","Image","CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier","ObjModel","FbxModel","ImportModel","Box","Shape","Clay","Mirror","AmbientLight","HemisphereLight","DirectionalLight","PointLight","SpotLight"]},{name:"CsgGroup",label:"Union",icon:dj,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi,Li],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgIntersect",label:"Intersect",icon:gj,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgHull",label:"Hull",icon:pj,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgHullChain",label:"Hull Chain",icon:mj,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgCuboid",label:"Cuboid",icon:cj,showInList:!0,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi,Hs,Ps,Zn],canBeRoot:!0,validChildTypes:[],defaultData:{[Ps.name]:0,[Hs.name]:new T(.2,.2,.2)}},{name:"CsgEllipsoid",label:"Ellipsoid",icon:fj,showInList:!0,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi,hr,Zn],canBeRoot:!0,validChildTypes:[],defaultData:{[hr.name]:new T(.1,.1,.1)}},{name:"CsgCylinder",label:"Cylinder",icon:uj,showInList:!0,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi,nn,as,Ps,Zn],canBeRoot:!0,validChildTypes:[],defaultData:{[Ps.name]:0,[nn.name]:.2,[as.name]:.1}},{name:"CsgCylinderElliptic",label:"Cylinder Elliptic",icon:hj,showInList:!0,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi,nn,Ql,Xl,Bu,Zn],canBeRoot:!0,validChildTypes:[],defaultData:{[nn.name]:.2,[Ql.name]:new ke(.1,.1),[Xl.name]:new ke(0,0)}},{name:"CsgTorus",label:"Torus",icon:vj,showInList:!0,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi,ql,Hu,Gu,Yl,$u,Uu],canBeRoot:!0,validChildTypes:[],defaultData:{[ql.name]:.1,[Yl.name]:.05}},{name:"CsgBezier",label:"Curve",icon:aj,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[Rt,ht,qt,Le,Qe,St,Jt,Me,Cn,Sn,Ot,Mn,He,gi,Qu,Kl,Zl,eh,Zu,qu,Yu,Vu,Zn,Ku],canBeRoot:!0,validChildTypes:["CsgBezierControlPoint"],defaultData:{[Kl.name]:new ke(.05,.05),[Zl.name]:new ke(.05,.05)},defaultChildren:[{type:"CsgBezierControlPoint",data:{[Le.name]:new T(0,0,0)}},{type:"CsgBezierControlPoint",data:{[Le.name]:new T(.2,0,0)}}]},{name:"CsgBezierControlPoint",label:"Control Point",icon:lj,showInList:!0,instanceable:!1,components:[Le,Me,He],canBeRoot:!1,validChildTypes:[]},{name:"Box",label:"Box",icon:sj,showInList:!0,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Nn,Ui,Le,Qe,Ft,Ot,Mn,Cn,Sn,Jt,Me,Gs],canBeRoot:!0,validChildTypes:[],defaultData:{[Gs.name]:new T(.2,.2,.2)}},{name:"Shape",label:"Tube",icon:Sj,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[Rt,ht,qt,Nn,Ui,Le,Qe,Ft,Ot,Mn,Cn,Sn,Jt,Me,Cs,Ju,Li],canBeRoot:!0,validChildTypes:["Tube"]},{name:"Tube",label:"Tube Node",icon:Ej,showInList:!0,components:[Rt,Me,Wu,ft],canBeRoot:!1,validChildTypes:[]},{name:"Clay",label:"Clay",icon:rj,showInList:!0,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Nn,Ui,Le,Qe,Ft,Cn,Sn,Ot,Mn,Jt,Me,gn,yr,Li,_r],canBeRoot:!0,validChildTypes:[]},{name:"Image",label:"Image",icon:wj,showInList:!1,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Nn,Ui,Le,Qe,Ft,Jt,Me,Gr],canBeRoot:!0,defaultData:{[Nn.name]:!1,[Ui.name]:!1},validChildTypes:[]},{name:"ObjModel",label:"Obj Model",icon:Mj,showInList:!1,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Nn,Ui,Le,Qe,Ft,Xs,Cn,Sn,Ot,Mn,Jt,Me,No],canBeRoot:!0,validChildTypes:[]},{name:"FbxModel",label:"Fbx Model",icon:yj,showInList:!1,instanceable:!0,mesh:!0,components:[Rt,ht,qt,Nn,Ui,Le,Qe,Ft,Xs,Cn,Sn,Ot,Mn,Jt,Me,ko],canBeRoot:!0,validChildTypes:[]},{name:"ImportModel",label:"Import Model",icon:xj,showInList:!1,instanceable:!0,mesh:!0,components:[Sd,Rt,ht,qt,Nn,Ui,Le,Qe,Ft,Xs,Cn,Sn,Ot,Mn,Jt,Me,Fo],canBeRoot:!0,validChildTypes:[]},{name:"Mirror",label:"Mirror",icon:Aj,showInList:!0,mesh:!0,components:[Rt,ht,qt,Dd,Le,Qe,Ft,Me,Ld,nn,Ot],canBeRoot:!0,validChildTypes:[]},{name:"Target",label:"Target",icon:Cj,showInList:!1,instanceable:!0,fixed:!0,unique:!0,components:[Le,Me],canBeRoot:!1,validChildTypes:[]},{name:"AmbientLight",label:"Ambient Light",icon:Hh,showInList:!0,instanceable:!0,light:!0,components:[Rt,ht,Me,$i,Ot],canBeRoot:!0,defaultData:{[$i.name]:.2},validChildTypes:[]},{name:"HemisphereLight",label:"Hemisphere Light",icon:Hh,showInList:!0,instanceable:!0,light:!0,components:[Rt,ht,Le,Me,Yi,$i,Rd,Cd],canBeRoot:!0,validChildTypes:[],defaultData:{[$i.name]:.2,[Le.name]:new T(0,1,0)}},{name:"DirectionalLight",label:"Directional Light",icon:Hh,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,light:!0,components:[Rt,ht,Nn,Ro,Pd,Le,Me,Yi,$i,Ot],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[Le.name]:new T(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]},{name:"PointLight",label:"Point Light",icon:Hh,showInList:!0,instanceable:!0,light:!0,components:[Rt,ht,Nn,Ro,Le,Me,Yi,$i,Ot],canBeRoot:!0,validChildTypes:[],defaultData:{[Le.name]:new T(0,1,0)}},{name:"SpotLight",label:"Spot Light",icon:Hh,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,light:!0,components:[Rt,ht,Nn,Ro,Td,Id,Le,Me,Yi,$i,Ot],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[Le.name]:new T(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]}],BI={};for(let n of zI)BI[n.name]=n;function Kn(n){const e=BI[n];if(!e)throw new Error(`Node def [${n}] not found`);return e}u(Kn,"getModelNodeDef");FI(Kn,"getModelNodeDef");function Yb(n){return Kn(n.type).validChildTypes.map(Kn).filter(t=>t.unique?!n.children.find(i=>i.type===t.name):!0)}u(Yb,"getValidChildNodeDefs");FI(Yb,"getValidChildNodeDefs");var Dj=Object.defineProperty,Lj=u((n,e)=>Dj(n,"name",{value:e,configurable:!0}),"__name$1L");const Zp=new ve;class Bl{constructor(){S(this,"id",0);S(this,"type","");S(this,"expanded",!0);S(this,"components",{});S(this,"parent",null);S(this,"children",[]);S(this,"dirty",!0);S(this,"deleted",!1);S(this,"opacity",1);S(this,"visible",!0);S(this,"instanceId",0);S(this,"instanceMeshDirty",!0);S(this,"instanceMeshRebuild",!0);S(this,"mirrorGeometry",{})}get(e){const t=this.components[e.name];if(!t)throw new Error(`Component [${e.name}] not found`);return t}has(e){return this.components[e.name]!=null}value(e){return this.get(e).value}cloneValue(e){const t=this.get(e).value,i=Ki(e.name);return i.clone?i.clone(t):t}forEach(e){const t=[this];for(;;){const i=t.pop();if(!i)break;if(e(i)===!1)return!1;for(let s=i.children.length;s--;)t.push(i.children[s])}}getLocalMatrix(){if(this.has(Me)){const e=this.value(Me);if(e)return e.matrix}return this.parent?this.parent.getLocalMatrix():Zp}getWorldMatrix(){if(this.has(Me)){const e=this.value(Me);if(e)return e.matrixWorld}return this.parent?this.parent.getWorldMatrix():Zp}getParentWorldMatrix(){return this.type==="Target"?Zp:this.parent?this.parent.getWorldMatrix():Zp}async toJson(){var t;const e=[];for(let i of this.children)e.push(await i.toJson());return{type:this.type,expanded:this.expanded,parentId:(t=this.parent)==null?void 0:t.id,instanceId:this.instanceId,data:await this.getComponentsDataJson(),children:e}}getComponentData(e){const t={};for(let i in this.components){const s=Ki(i);if(!(e&&!(s.instanceable||s.autoCopy))&&s.storable){let o=this.components[i].value;s.clone&&(o=s.clone(o)),t[i]=o}}return t}async getComponentsDataJson(){const e={};for(let t in this.components){const i=Ki(t);if(i.storable){let r=this.components[t].value;i.serialize&&(r=i.serialize(r)),r&&i.dataType===Ie.BYTES&&(r=await Md(r)),e[t]=r}}return e}isValidChild(e){return!!Yb(this).find(t=>t.name===e)}}u(Bl,"ModelNode");Lj(Bl,"ModelNode");var Oj=Object.defineProperty,kj=u((n,e)=>Oj(n,"name",{value:e,configurable:!0}),"__name$1K");class qb{onValueChanged(e,t,i){i===Gs&&(t.get(Gs).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(qb,"BoxWatcher");kj(qb,"BoxWatcher");var Nj=Object.defineProperty,Fj=u((n,e)=>Nj(n,"name",{value:e,configurable:!0}),"__name$1J");class Zb{onValueChanged(e,t,i){i===gn?t.get(gn).dirty=!0:i===yr&&(t.get(yr).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(Zb,"ClayWatcher");Fj(Zb,"ClayWatcher");var zj=Object.defineProperty,Bj=u((n,e)=>zj(n,"name",{value:e,configurable:!0}),"__name$1I");const Uj={CsgGroup:[Li],CsgCuboid:[Hs,Ps,Zn],CsgEllipsoid:[hr,Zn],CsgCylinder:[nn,as,Ps,Zn],CsgCylinderElliptic:[nn,Ql,Xl,Bu,Zn],CsgRoundedCuboid:[Hs,Ps,Zn],CsgRoundedCylinder:[nn,as,Ps,Zn],CsgTorus:[Yl,ql,$u,Hu,Uu,Gu],CsgBezier:[Qu,Kl,Zl,eh,Zu,qu,Yu,Vu,Zn,Ku],CsgBezierControlPoint:[Le]};class Kb{onValueChanged(e,t,i){var s;if(!!t.has(He)){if([Le,Qe,Ft,St].includes(i)){const r=t.get(He);r.matDirty=!0,this.markCsgNodeDirty(t.parent);return}if([ht,gi].includes(i)){this.markCsgNodeDirty(t.parent);return}(s=Uj[t.type])!=null&&s.includes(i)&&this.markCsgNodeDirty(t)}}onChildAdded(e,t,i){this.markCsgNodeDirty(t)}onBeforeChildRemoved(e,t,i){this.markCsgNodeDirty(t)}onMoved(e,t,i,s){this.markCsgNodeDirty(i),this.markCsgNodeDirty(s)}markCsgNodeDirty(e){for(;e&&e.has(He);){e.dirty=!0;const t=e.get(He);t.dirty=!0,e=e.parent}}}u(Kb,"CsgWatcher");Bj(Kb,"CsgWatcher");var $j=Object.defineProperty,UI=u((n,e)=>$j(n,"name",{value:e,configurable:!0}),"__name$1H");const Vj=[Xi,wn,cs,ka];function tu(n,e){if(!n)return;n.dirty=!0;let t=Math.max(0,e?n.children.indexOf(e):0);for(let i=n.children.length;t<i;++t){const s=n.children[t],r=s.get(xt);r&&(s.dirty=!0,r.dirty=!0);const o=s.get(Me);o&&(o.localTransformChanged=!0,o.worldTransformChanged=!0)}}u(tu,"markIkChainDirty");UI(tu,"markIkChainDirty");class Qb{onValueChanged(e,t,i){Vj.includes(i)&&tu(t.parent,t)}onMoved(e,t,i,s){t.has(xt)&&(tu(i),tu(s,t))}onChildAdded(e,t,i){i.has(xt)&&tu(t,i)}onBeforeChildRemoved(e,t,i){i.has(xt)&&tu(t,i)}}u(Qb,"IkNodeWatcher");UI(Qb,"IkNodeWatcher");var Gj=Object.defineProperty,Hj=u((n,e)=>Gj(n,"name",{value:e,configurable:!0}),"__name$1G");class Jb{onValueChanged(e,t,i){i===Gr&&(t.get(Gr).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(Jb,"ImageWatcher");Hj(Jb,"ImageWatcher");var Wj=Object.defineProperty,jj=u((n,e)=>Wj(n,"name",{value:e,configurable:!0}),"__name$1F");class ew{onValueChanged(e,t,i){i===No?t.get(No).dirty=!0:i===ko?t.get(ko).dirty=!0:i===Fo&&(t.get(Fo).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(ew,"ImportModelWatcher");jj(ew,"ImportModelWatcher");var Xj=Object.defineProperty,Yj=u((n,e)=>Xj(n,"name",{value:e,configurable:!0}),"__name$1E");class tw{onValueChanged(e,t,i){i===Xs&&!t.instanceId&&e.instanceMeshUpdated(t.id,!1)}onMoved(e,t,i,s){}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}}u(tw,"MaterialWatcher");Yj(tw,"MaterialWatcher");var qj=Object.defineProperty,Zj=u((n,e)=>qj(n,"name",{value:e,configurable:!0}),"__name$1D");class nw{onValueChanged(e,t,i){i===Jt&&t.forEach(s=>s.dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){t.forEach(r=>r.dirty=!0)}}u(nw,"OpacityWatcher");Zj(nw,"OpacityWatcher");var Kj=Object.defineProperty,Qj=u((n,e)=>Kj(n,"name",{value:e,configurable:!0}),"__name$1C");class iw{onValueChanged(e,t,i){i===ft?(t.get(ft).dirty=!0,t.parent&&(t.parent.dirty=!0,t.parent.get(Cs).value=!0)):i===Wu?t.parent&&(t.parent.dirty=!0,t.parent.get(Cs).value=!0):(i===Li||i===Ju)&&t.type==="Shape"&&(t.get(Cs).value=!0)}onChildAdded(e,t,i){t.type==="Shape"&&(t.dirty=!0,t.get(Cs).value=!0)}onBeforeChildRemoved(e,t,i){t.type==="Shape"&&(t.dirty=!0,t.get(Cs).value=!0)}onMoved(e,t,i,s){(i==null?void 0:i.type)==="Shape"&&(i.dirty=!0,i.get(Cs).value=!0),(s==null?void 0:s.type)==="Shape"&&(s.dirty=!0,s.get(Cs).value=!0)}}u(iw,"SdfShapeWatcher");Qj(iw,"SdfShapeWatcher");var Jj=Object.defineProperty,eX=u((n,e)=>Jj(n,"name",{value:e,configurable:!0}),"__name$1B");const tX=[Le,Qe,Ft,St,_r];class sw{onValueChanged(e,t,i){if(tX.includes(i)){if(t.has(Me)){const s=t.get(Me);s.localTransformChanged=!0,s.worldTransformChanged=!0}if(t.has(He)){const s=t.get(He);s.matDirty=!0}}t.type==="Target"&&t.parent&&(t.parent.dirty=!0)}onMoved(e,t,i,s){if(t.has(Me)){t.dirty=!0;const r=t.get(Me);r.parentChanged=!0,r.worldTransformChanged=!0}}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}}u(sw,"TransformWatcher");eX(sw,"TransformWatcher");var nX=Object.defineProperty,iX=u((n,e)=>nX(n,"name",{value:e,configurable:!0}),"__name$1A");class qd{constructor(){S(this,"nodesMap",new Map);S(this,"nodes",[]);S(this,"cameraFov",45);S(this,"cameraPerspective",!0);S(this,"cameras",[]);S(this,"watchers",[new sw,new Qb,new nw,new Jb,new ew,new qb,new iw,new Kb,new Zb,new tw]);S(this,"dirty",!0);S(this,"instanceDirty",!0);S(this,"referenceMap",new Map);S(this,"selected",[])}reset(){this.selected=[],this.dirty=!1,this.instanceDirty=!1,this.referenceMap.clear();for(let e of this.nodes.map(t=>t.id))this.removeNode(e);this.cameras=[]}addSelection(e){this.selected.includes(e)||this.selected.push(e)}isNodeExists(e,t){if(t){const i=this.nodesMap.get(e);return(i==null?void 0:i.type)===t}return this.nodesMap.has(e)}forEach(e){for(let t of this.nodes)if(t.forEach(e)===!1)return!1}getNode(e){const t=this.nodesMap.get(e);if(!t)throw new Error(`Node #${e} does not exist`);return t}getSelectedNodes(){return this.selected.map(e=>this.getNode(e))}getTopmostSelectedNodes(){const e=[];for(let t of this.selected){const i=this.getNode(t);let s=!0;for(let r=i.parent;r;r=r.parent)if(this.selected.includes(r.id)){s=!1;break}s&&e.push(i)}return e}createNode(e,t,i=null,s=null,r,o){if(this.isNodeExists(e))throw new Error(`Node #${e} already exists`);const a=Kn(t),l=new Bl;l.id=e,l.type=t;for(let h of a.components)l.components[h.name]=new h;if(l.parent=nt(i),this.instanceMeshUpdated(e,!0),o&&(l.instanceId=o,this.referenceMap.has(o)?this.referenceMap.get(o).push(e):this.referenceMap.set(o,[e]),this.instanceDirty=!0),r)for(let h in r){let f=l.components[h];if(!f&&o&&h===Un.name&&(f=l.components[h]=new Un),f){const d=Ki(h);f.value=d.clone?d.clone(r[h]):r[h]}}const c=i?i.children:this.nodes;if(s!=null?c.splice(s,0,l):c.push(l),this.nodesMap.set(e,l),i)for(let h of this.watchers)h.onChildAdded(this,i,l);return this.dirty=!0,l}removeNode(e){var r;if(!this.isNodeExists(e))return;const t=this.getNode(e);if(t.parent)for(let o of this.watchers)o.onBeforeChildRemoved(this,t.parent,t);t.deleted=!0,this.instanceMeshUpdated(e,!0),t.forEach(o=>{if(o.instanceId){const a=this.referenceMap.get(o.instanceId);a&&this.referenceMap.set(o.instanceId,a.filter(l=>l!==o.id)),this.instanceDirty=!0}});for(let o in t.mirrorGeometry)(r=t.mirrorGeometry[o])==null||r.dispose(),delete t.mirrorGeometry[o];t.forEach(o=>{this.nodesMap.delete(o.id);const a=this.selected.indexOf(o.id);a>=0&&this.selected.splice(a,1)});const i=t.parent?t.parent.children:this.nodes,s=i.indexOf(t);s>=0&&i.splice(s,1),t.forEach(o=>{for(let a in o.components)o.components[a].onRemoved()}),this.dirty=!0}moveNode(e,t,i,s){const r=e.parent,o=r?r.children:this.nodes;o.splice(o.indexOf(e),1);const a=t?t.children:this.nodes;if(e.parent=t,i){const l=a.indexOf(i);s?a.splice(l+1,0,e):a.splice(l,0,e)}else s?a.push(e):a.unshift(e);e.dirty=!0,this.dirty=!0;for(let l of this.watchers)l.onMoved(this,e,r,t)}setValue(e,t,i){e.get(t).value=i,e.dirty=!0,this.dirty=!0;for(let r of this.watchers)r.onValueChanged(this,e,t);if(Ki(t.name).autoCopy){const r=this.referenceMap.get(e.id);if(r)for(let o of r){const a=this.getNode(o);a.get(t).value=i,a.dirty=!0;for(let l of this.watchers)l.onValueChanged(this,a,t)}}}updateVertices(e,t,i,s){const r=e.get(t),o=r.value,a=e.get(Me);if(a.mesh){const l=a.mesh;if(t===gn){l.updateVertices(i,s);for(let c=0,h=o.length;c<h;++c)o[c]=l.aPosition[c]}else if(t===yr){l.updateColors(i,s);for(let c=0,h=o.length;c<h;++c)o[c]=l.aColor[c]}}for(let l=0,c=i.length;l<c;++l){const h=i[l];for(let f=0;f<3;++f)o[h*3+f]=s[l*3+f]}e.dirty=!0,this.dirty=!0,r.partialUpdate=!0;for(let l of this.watchers)l.onValueChanged(this,e,t)}instanceMeshUpdated(e,t){var s;const i=this.referenceMap.get(e);if(i){this.instanceDirty=!0;for(let r of i)if(this.isNodeExists(r)){const o=this.getNode(r);if(o.instanceMeshDirty=!0,o.instanceMeshRebuild=t,o.has(He)){let a=o.parent;for(;a&&(!a.instanceId&&a.has(He));){this.dirty=!0,a.dirty=!0;const l=a.get(He);l.dirty=!0,a=a.parent}}}}if(this.isNodeExists(e)){const r=this.getNode(e);for(let o in r.mirrorGeometry)t&&((s=r.mirrorGeometry[o])==null||s.dispose()),delete r.mirrorGeometry[o]}}}u(qd,"Model");iX(qd,"Model");var sX=Object.defineProperty,xg=u((n,e)=>sX(n,"name",{value:e,configurable:!0}),"__name$1z");const rX=200;class rw{constructor(e){S(this,"model");S(this,"enableMerge",!0);S(this,"currentFrameRecords",[]);S(this,"redoStack",[]);S(this,"undoStack",[]);S(this,"nextNodeId",0);S(this,"deletedNodes",new Set);S(this,"dirty",!1);S(this,"lastEventTarget",null);S(this,"onPointerDown",u(e=>{this.lastEventTarget=e.target,this.enableMerge=!1},"onPointerDown"));S(this,"onKeyDown",u(e=>{this.lastEventTarget!==e.target&&(this.lastEventTarget=e.target,this.enableMerge=!1)},"onKeyDown"));this.model=e}setup(){window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("keydown",this.onKeyDown)}unload(){window.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("keydown",this.onKeyDown)}clear(){this.dirty=!1,this.currentFrameRecords.length=0,this.redoStack.length=0,this.undoStack.length=0}save(){this.dirty=!1}update(){if(this.nextNodeId=0,!this.currentFrameRecords.length)return;if(!this.currentFrameRecords.find(l=>!l.empty)){this.currentFrameRecords.length=0;return}this.redoStack.length=0;const e=[],t=[];let i,s;for(let l of this.currentFrameRecords)e.push(l.redo),t.push(l.undo),i=i||l.getCtx,s=s||l.setCtx;let r=xg(()=>{for(let l of e)l()},"redo"),o=xg(()=>{for(let l of t)l()},"undo");r();const a=this.currentFrameRecords.map(l=>l.hash).sort().join("@");if(this.enableMerge)for(;this.undoStack.length;){const l=this.undoStack[this.undoStack.length-1];if(l.hash===a)s&&l.getCtx?s(l.getCtx()):o=l.undo,this.undoStack.pop();else break}else{const l=this.undoStack[this.undoStack.length-1];l&&!l.hash.endsWith("!")&&(l.hash+="!")}this.enableMerge=!0,this.undoStack.push({hash:a,redo:r,undo:o,getCtx:i,setCtx:s}),this.undoStack.length>=rX&&this.undoStack.shift(),this.deletedNodes.clear(),this.currentFrameRecords.length=0,this.dirty=!0}undo(){const e=this.undoStack.pop();!e||(this.redoStack.push(e),this.model.selected=[],e.undo(),this.dirty=!0)}redo(){const e=this.redoStack.pop();!e||(this.undoStack.push(e),e.redo(),this.dirty=!0)}getNextNodeId(){if(this.nextNodeId)return this.nextNodeId;let e=0;return this.model.forEach(t=>{e=Math.max(e,t.id)}),e}createNode(e){const t=this.getNextNodeId()+1;if(this.currentFrameRecords.push({hash:"$createNode",redo:()=>{let i=t;if(e.parentId){let r=this.model.getNode(e.parentId);for(;r;r=r.parent)r.expanded=!0}const s=this.model.createNode(i++,e.type,e.parentId?this.model.getNode(e.parentId):null,null,e.data,e.instanceId);if(e.expanded!=null&&(s.expanded=e.expanded),(e.selected==null||e.selected)&&this.model.addSelection(s.id),e.children){const r=[];for(let o of e.children)r.push([s,o]);for(;r.length;){const o=r.shift();if(!o)break;const a=o[0],l=o[1],c=this.model.createNode(i++,l.type,a,null,l.data,l.instanceId);if(l.expanded!=null&&(c.expanded=l.expanded),(l.selected==null||l.selected)&&this.model.addSelection(c.id),l.children){const h=[];for(let f of l.children)h.push([c,f]);r.unshift(...h)}}}},undo:()=>{this.model.removeNode(t)}}),this.enableMerge=!1,this.nextNodeId=t,e.children){const i=[...e.children];for(;;){const s=i.pop();if(!s)break;this.nextNodeId+=1,s.children&&i.push(...s.children)}}return t}removeNode(e){if(!this.model.isNodeExists(e)||this.deletedNodes.has(e))return;class t{constructor(a,l){S(this,"id");S(this,"type");S(this,"expanded");S(this,"parentId",0);S(this,"instanceId",0);S(this,"index",0);S(this,"data");S(this,"children");this.id=a.id,this.type=a.type,this.expanded=a.expanded,a.parent&&(this.parentId=a.parent.id),this.instanceId=a.instanceId;const c=a.parent?a.parent.children:l.nodes;this.index=c.indexOf(a),this.data=a.getComponentData(),this.children=a.children.map(h=>new t(h,l))}}u(t,"NodeRecord"),xg(t,"NodeRecord");const i=new t(this.model.getNode(e),this.model),s=[i];for(;s.length;){const o=s.pop();if(!o)break;this.deletedNodes.add(o.id),s.push(...o.children)}this.currentFrameRecords.push({hash:"$removeNode",redo:()=>{this.model.removeNode(e)},undo:()=>{const o=this.model.createNode(i.id,i.type,i.parentId?this.model.getNode(i.parentId):null,i.index,i.data,i.instanceId);this.model.addSelection(o.id);const a=[[o,i.children]];for(;;){const l=a.pop();if(!l)break;const c=l[0],h=l[1];for(let f of h){const d=this.model.createNode(f.id,f.type,c,null,f.data,f.instanceId);d.expanded=f.expanded,this.model.addSelection(d.id),f.children.length&&a.push([d,f.children])}}}}),this.enableMerge=!1;const r=this.model.referenceMap.get(e);if(r)for(let o of r)this.removeNode(o)}moveNode(e,t,i,s,r){const o=e.id,a=t?t.id:0,l=i?i.id:0,c=s,h=e.parent?e.parent.id:0;let f=0,d=!1;const p=e.parent?e.parent.children:this.model.nodes,g=p.indexOf(e);if(g>0&&(f=p[g-1].id,d=!0),this.currentFrameRecords.push({hash:"$moveNode",redo:()=>{this.model.moveNode(this.model.getNode(o),a?this.model.getNode(a):null,l?this.model.getNode(l):null,c)},undo:()=>{this.model.moveNode(this.model.getNode(o),h?this.model.getNode(h):null,f?this.model.getNode(f):null,d),this.model.addSelection(o)}}),this.enableMerge=!1,r&&h!==a){if(e.has(Le)||e.has(Qe)||e.has(Ft)||e.has(St)){let m=e.getWorldMatrix();t&&(m=new ve().copy(t.getWorldMatrix()).invert().multiply(m));const v=new T,y=new je,b=new T;m.decompose(v,y,b),e.has(Le)&&this.setValue(e,Le,v),e.has(Qe)&&this.setValue(e,Qe,new lt().setFromQuaternion(y)),e.has(Ft)&&this.setValue(e,Ft,b.x),e.has(St)&&this.setValue(e,St,b)}else if(e.has(ft)){let m=e.getWorldMatrix();t&&(m=new ve().copy(t.getWorldMatrix()).invert().multiply(m));const v=Sa(m),y=e.get(ft).clone();for(let b of y)b.position.applyMatrix4(m),b.radius*=v;this.setValue(e,ft,y)}}}setValue(e,t,i,s){const r=e.id,o=e.value(t),a=r+"#"+(s||t.name),l=Ki(t.name);return(l.equal?l.equal(o,i):o===i)?(this.currentFrameRecords.push({hash:a,empty:!0,redo(){},undo:()=>{this.model.setValue(this.model.getNode(r),t,o),this.model.addSelection(r)}}),!1):(this.currentFrameRecords=this.currentFrameRecords.filter(c=>c.hash!==a),this.currentFrameRecords.push({hash:a,redo:()=>{this.model.setValue(this.model.getNode(r),t,i)},undo:()=>{this.model.setValue(this.model.getNode(r),t,o),this.model.addSelection(r)}}),!0)}mergeLastRecord(e){const t=this.undoStack[this.undoStack.length-1];if(!t)return;const i=[];for(let o of e)i.push(o.node.id+"#"+(o.hashName||o.componentClass.name));let s=i.sort().join("@"),r=t.hash;r.endsWith("!")&&(r=r.substring(0,r.length-1)),s===r&&(this.undoStack.pop(),t.hash=r,this.currentFrameRecords.push(t))}updateVertices(e,t,i,s){if(!i.length)return!1;const r=e.id,o=e.value(t);let a=new Float32Array(s.length);for(let d=0,p=i.length;d<p;++d){const g=i[d];for(let m=0;m<3;++m)a[d*3+m]=o[g*3+m]}let l=i,c=i,h=s;const f=r+"#"+t.name;return this.currentFrameRecords=this.currentFrameRecords.filter(d=>d.hash!==f),this.currentFrameRecords.push({hash:f,redo:()=>{this.model.updateVertices(this.model.getNode(r),t,c,h)},undo:()=>{this.model.updateVertices(this.model.getNode(r),t,l,a),this.model.addSelection(r)},setCtx:([d,p,g,m])=>{{const v=new Set([...d,...l]),y=new Float32Array(v.size*3);for(let w=0,M=p.length;w<M;++w)y[w]=p[w];const b=[...d],_=new Set(d);let x=p.length;for(let w=0,M=l.length;w<M;++w){const C=l[w];if(!_.has(C)){b.push(C);for(let A=0;A<3;++A)y[x+A]=a[w*3+A];x+=3}}l=b,a=y}{const v=new Set([...c,...g]),y=new Float32Array(v.size*3);for(let w=0,M=h.length;w<M;++w)y[w]=h[w];const b=[...c],_=new Set(c);let x=h.length;for(let w=0,M=g.length;w<M;++w){const C=g[w];if(!_.has(C)){b.push(C);for(let A=0;A<3;++A)y[x+A]=m[w*3+A];x+=3}}c=b,h=y}},getCtx:()=>[l,a,c,h]}),!0}}u(rw,"ModelHistory");xg(rw,"ModelHistory");var oX=Object.defineProperty,aX=u((n,e)=>oX(n,"name",{value:e,configurable:!0}),"__name$1y");class Ls{constructor(){S(this,"subSystems",[])}setup(e){}dispose(){}sub(...e){return this.subSystems.push(...e),this}update(e){this.begin(e);for(let t of this.subSystems)t.update(e);this.end(e)}}u(Ls,"UpdateSystem");aX(Ls,"UpdateSystem");var lX=Object.defineProperty,cX=u((n,e)=>lX(n,"name",{value:e,configurable:!0}),"__name$1x");class ow extends Ls{begin(e){for(let i of e.nextFrameCallbacks)i();e.nextFrameCallbacks.length=0;const t=Date.now();for(let i of e.throttleTasks.entries())i[1].time<=t&&(i[1].callback(),e.throttleTasks.delete(i[0]))}end(e){}}u(ow,"CallbackFireSystem");cX(ow,"CallbackFireSystem");var uX=Object.defineProperty,$I=u((n,e)=>uX(n,"name",{value:e,configurable:!0}),"__name$1w");class uu{constructor(){S(this,"mouseNdc0",new T);S(this,"rotating",!1);S(this,"eulerX0",0);S(this,"eulerY0",0);S(this,"moving",!1);S(this,"target0",new T);S(this,"mouseRayN0",new T)}}u(uu,"CameraDraggingState");$I(uu,"CameraDraggingState");const Kp=new T,Qp=new T,G2=new T,H2=new T,W2=new T,hX=40,j2=-20,yv=2.5;class aw extends Ls{constructor(){super(...arguments);S(this,"states",[new uu,new uu,new uu,new uu])}begin(t){if(t.disableCameraDraggingThisFrame){t.disableCameraDraggingThisFrame=!1;return}let i=-1;for(let s of t.views){const r=this.states[s.index];if(!s.enabled){r.rotating=!1,r.moving=!1;continue}const o=s.input;if(s.index===t.mainViewIndex)if(o.mouseRight)if(r.rotating){const a=s.mouseNdc.x-r.mouseNdc0.x,l=s.mouseNdc.y-r.mouseNdc0.y;s.camera.alpha=Math.max(-Math.PI/2,Math.min(Math.PI/2,r.eulerX0+l*Math.PI/2)),s.camera.beta=(r.eulerY0-a*Math.PI/2)%(Math.PI*2)}else o.pointerOver&&o.mouseRightDownThisFrame&&(r.rotating=!0,r.mouseNdc0.copy(s.mouseNdc),r.eulerX0=s.camera.alpha,r.eulerY0=s.camera.beta);else r.rotating=!1;o.mouseMiddle?r.moving?(Kp.copy(r.mouseNdc0),Kp.z=-1,Kp.unproject(s.camera.get()),Qp.copy(r.mouseNdc0),Qp.z=1,Qp.unproject(s.camera.get()),Ht(G2,Kp,Qp,r.target0,r.mouseRayN0),Ht(H2,s.mouseRay0,s.mouseRay1,r.target0,r.mouseRayN0),W2.subVectors(H2,G2),s.camera.target.subVectors(r.target0,W2),i=s.index):o.pointerOver&&o.mouseMiddleDownThisFrame&&(r.moving=!0,r.target0.copy(s.camera.target),r.mouseNdc0.copy(s.mouseNdc),r.mouseRayN0.copy(s.mouseRayN)):r.moving=!1,o.wheelDetY&&o.pointerOver&&(s.zoomLevel=Math.max(j2,Math.min(hX,s.zoomLevel+o.wheelDetY)),i=s.index)}if(i>=0){const s=t.views[i];for(let r of t.views)r.index!==i&&r.enabled&&(r.camera.target.copy(s.camera.target),r.zoomLevel=s.zoomLevel)}for(let s of t.views)s.enabled&&(s.camera.distance=s.zoomLevel>=0?yv+s.zoomLevel:yv-s.zoomLevel/j2*yv)}end(t){}}u(aw,"CameraDraggingSystem");$I(aw,"CameraDraggingSystem");var Jp=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function em(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}u(em,"commonjsRequire");const fX=u(n=>{if(!Array.isArray(n))throw new Error("Bezier points must be a valid array/");if(n.length<2)throw new Error("Bezier points must contain at least 2 values.");const e=dX(n);return{points:n,pointType:e,dimensions:e==="float_single"?0:n[0].length,permutations:X2(n.length-1),tangentPermutations:X2(n.length-2)}},"create$I"),dX=u(function(n){let e=null;return n.forEach(t=>{let i="";if(Number.isFinite(t))i="float_single";else if(Array.isArray(t))t.forEach(s=>{if(!Number.isFinite(s))throw new Error("Bezier point values must all be numbers.")}),i="float_"+t.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(e==null)e=i;else if(e!==i)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.")}),e},"getPointType"),X2=u(function(n){const e=[];for(let t=0;t<=n;t++)e.push(_v(n)/(_v(t)*_v(n-t)));return e},"getPermutations"),_v=u(function(n){let e=1;for(let t=2;t<=n;t++)e*=t;return e},"factorial");var pX=fX;const mX=u((n,e)=>{if(n<0||n>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(e.pointType==="float_single")return Y2(e,e.points,n);{const t=[];for(let i=0;i<e.dimensions;i++){const s=[];for(let r=0;r<e.points.length;r++)s.push(e.points[r][i]);t.push(Y2(e,s,n))}return t}},"valueAt"),Y2=u(function(n,e,t){const i=e.length-1;let s=0;for(let r=0;r<=i;r++)s+=n.permutations[r]*Math.pow(1-t,i-r)*Math.pow(t,r)*e[r];return s},"bezierFunction");var gX=mX;const vX=u((n,e)=>{if(n<0||n>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(e.pointType==="float_single")return q2(e,e.points,n);{const t=[];for(let i=0;i<e.dimensions;i++){const s=[];for(let r=0;r<e.points.length;r++)s.push(e.points[r][i]);t.push(q2(e,s,n))}return t}},"tangentAt"),q2=u(function(n,e,t){const i=e.length-1;let s=0;for(let r=0;r<i;r++){const o=i*(e[r+1]-e[r]);s+=n.tangentPermutations[r]*Math.pow(1-t,i-1-r)*Math.pow(t,r)*o}return s},"bezierTangent");var yX=vX,bv={create:pX,valueAt:gX,tangentAt:yX};const _X=1e5,bX=1e-5,wX=1e-13,xX=Math.PI*2;var at={EPS:bX,NEPS:wX,TAU:xX,spatialResolution:_X};const VI=u(n=>n.reduce((e,t)=>Array.isArray(t)?e.concat(VI(t)):e.concat(t),[]),"flatten$t");var jt=VI;const AX=u(n=>Object.assign({},n),"clone$b");var MX=AX;const SX=u((n,e,t)=>(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n),"add$3");var CX=SX;const EX=u(()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"create$H");var lw=EX;const TX=lw,PX=u(n=>{const e=TX();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},"clone$a");var RX=PX;const IX=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n),"copy$7");var GI=IX;const DX=u((n,e)=>{const t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=t*a-i*o,_=t*l-s*o,x=t*c-r*o,w=i*l-s*a,M=i*c-r*a,C=s*c-r*l,A=h*m-f*g,P=h*v-d*g,D=h*y-p*g,k=f*v-d*m,O=f*y-p*m,N=d*y-p*v;let E=b*N-_*O+x*k+w*D-M*P+C*A;return E?(E=1/E,n[0]=(a*N-l*O+c*k)*E,n[1]=(s*O-i*N-r*k)*E,n[2]=(m*C-v*M+y*w)*E,n[3]=(d*M-f*C-p*w)*E,n[4]=(l*D-o*N-c*P)*E,n[5]=(t*N-s*D+r*P)*E,n[6]=(v*x-g*C-y*_)*E,n[7]=(h*C-d*x+p*_)*E,n[8]=(o*O-a*D+c*A)*E,n[9]=(i*D-t*O-r*A)*E,n[10]=(g*M-m*x+y*b)*E,n[11]=(f*x-h*M-p*b)*E,n[12]=(a*P-o*k-l*A)*E,n[13]=(t*k-i*P+s*A)*E,n[14]=(m*_-g*w-v*b)*E,n[15]=(h*w-f*_+d*b)*E,n):null},"invert$2");var LX=DX;const OX=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15],"equals$8");var kX=OX;const{NEPS:NX}=at,HI=u(n=>Math.abs(n)<NX?0:n,"rezero"),FX=u(n=>HI(Math.sin(n)),"sin$f"),zX=u(n=>HI(Math.cos(n)),"cos$f");var wi={sin:FX,cos:zX};const BX=u(n=>(n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n),"identity$1");var WI=BX;const{EPS:UX}=at,{sin:$X,cos:VX}=wi,GX=WI,HX=u((n,e,t)=>{let[i,s,r]=t;const o=i*i+s*s+r*r;if(Math.abs(o)<UX)return GX(n);const a=1/Math.sqrt(o);i*=a,s*=a,r*=a;const l=$X(e),c=VX(e),h=1-c;return n[0]=i*i*h+c,n[1]=s*i*h+r*l,n[2]=r*i*h-s*l,n[3]=0,n[4]=i*s*h-r*l,n[5]=s*s*h+c,n[6]=r*s*h+i*l,n[7]=0,n[8]=i*r*h+s*l,n[9]=s*r*h-i*l,n[10]=r*r*h+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromRotation$1");var jI=HX;const WX=u((n,e)=>(n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n),"fromScaling");var jX=WX;const{sin:wv,cos:xv}=wi,XX=u((n,e,t,i)=>{const s=wv(e),r=xv(e),o=wv(t),a=xv(t),l=wv(i),c=xv(i);return n[0]=a*r,n[1]=a*s,n[2]=-o,n[3]=0,n[4]=l*o*r-c*s,n[5]=c*r+l*o*s,n[6]=l*a,n[7]=0,n[8]=l*s+c*o*r,n[9]=c*o*s-l*r,n[10]=c*a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromTaitBryanRotation");var YX=XX;const qX=u((n,e)=>(n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n),"fromTranslation");var ZX=qX;const KX=lw,QX=u((n,e,t,i,s,r,o,a,l,c,h,f,d,p,g,m)=>{const v=KX();return v[0]=n,v[1]=e,v[2]=t,v[3]=i,v[4]=s,v[5]=r,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=f,v[12]=d,v[13]=p,v[14]=g,v[15]=m,v},"fromValues$5");var JX=QX;const eY=u((n,e)=>(n[0]=Math.abs(e[0]),n[1]=Math.abs(e[1]),n[2]=Math.abs(e[2]),n),"abs$2");var XI=eY;const tY=u((n,e,t)=>(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n),"add$2");var YI=tY;const nY=u((n,e)=>n[0]*e[0]+n[1]*e[1]+n[2]*e[2],"dot$5");var G0=nY;const iY=G0,sY=u((n,e)=>{const t=n[0],i=n[1],s=n[2],r=e[0],o=e[1],a=e[2],l=Math.sqrt(t*t+i*i+s*s),c=Math.sqrt(r*r+o*o+a*a),h=l*c,f=h&&iY(n,e)/h;return Math.acos(Math.min(Math.max(f,-1),1))},"angle$1");var rY=sY;const oY=u(()=>[0,0,0],"create$E");var H0=oY;const aY=H0,lY=u(n=>{const e=aY();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},"clone$9");var cY=lY;const uY=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n),"copy$6");var qI=uY;const hY=u((n,e,t)=>{const i=e[0],s=e[1],r=e[2],o=t[0],a=t[1],l=t[2];return n[0]=s*l-r*a,n[1]=r*o-i*l,n[2]=i*a-s*o,n},"cross$5");var Zd=hY;const fY=u((n,e)=>{const t=e[0]-n[0],i=e[1]-n[1],s=e[2]-n[2];return Math.sqrt(t*t+i*i+s*s)},"distance$2");var ZI=fY;const dY=u((n,e,t)=>(n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n),"divide$1");var pY=dY;const mY=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],"equals$7");var gY=mY;const vY=u((n,e)=>(n[0]=e,n[1]=e,n[2]=e,n),"fromScalar$2");var yY=vY;const _Y=H0,bY=u((n,e,t)=>{const i=_Y();return i[0]=n,i[1]=e,i[2]=t,i},"fromValues$4");var wY=bY;const xY=u((n,e,t=0)=>(n[0]=e[0],n[1]=e[1],n[2]=t,n),"fromVector2");var AY=xY;const MY=u(n=>{const e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)},"length$2");var KI=MY;const SY=u((n,e,t,i)=>(n[0]=e[0]+i*(t[0]-e[0]),n[1]=e[1]+i*(t[1]-e[1]),n[2]=e[2]+i*(t[2]-e[2]),n),"lerp$1");var CY=SY;const EY=u((n,e,t)=>(n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n),"max$2");var QI=EY;const TY=u((n,e,t)=>(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n),"min$1");var JI=TY;const PY=u((n,e,t)=>(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n),"multiply$2");var RY=PY;const IY=u((n,e)=>(n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n),"negate$1");var DY=IY;const LY=u((n,e)=>{const t=e[0],i=e[1],s=e[2];let r=t*t+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),n[0]=t*r,n[1]=i*r,n[2]=s*r,n},"normalize$3");var cw=LY;const OY=XI,kY=H0,NY=Zd,FY=u((n,e)=>{const t=OY(kY(),e),i=0+(t[0]<t[1]&&t[0]<t[2]),s=0+(t[1]<=t[0]&&t[1]<t[2]),r=0+(t[2]<=t[0]&&t[2]<=t[1]);return NY(n,e,[i,s,r])},"orthogonal");var zY=FY;const BY=u((n,e,t,i)=>{const s=[],r=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],r[0]=s[0],r[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),r[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n},"rotateX$2");var UY=BY;const $Y=u((n,e,t,i)=>{const s=[],r=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],r[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),r[1]=s[1],r[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n},"rotateY$2");var VY=$Y;const GY=u((n,e,t,i)=>{const s=[],r=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],r[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),r[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=e[2],n},"rotateZ$2");var HY=GY;const WY=u((n,e,t)=>(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n),"scale$4");var eD=WY;const jY=u((n,e,t)=>(n[0]=Math.round(e[0]/t)*t+0,n[1]=Math.round(e[1]/t)*t+0,n[2]=Math.round(e[2]/t)*t+0,n),"snap$1");var XY=jY;const YY=u((n,e)=>{const t=e[0]-n[0],i=e[1]-n[1],s=e[2]-n[2];return t*t+i*i+s*s},"squaredDistance$2");var tD=YY;const qY=u(n=>{const e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i},"squaredLength$2");var nD=qY;const ZY=u((n,e,t)=>(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n),"subtract$9");var W0=ZY;const KY=u(n=>`[${n[0].toFixed(7)}, ${n[1].toFixed(7)}, ${n[2].toFixed(7)}]`,"toString$9");var QY=KY;const JY=u((n,e,t)=>{const i=e[0],s=e[1],r=e[2];let o=t[3]*i+t[7]*s+t[11]*r+t[15];return o=o||1,n[0]=(t[0]*i+t[4]*s+t[8]*r+t[12])/o,n[1]=(t[1]*i+t[5]*s+t[9]*r+t[13])/o,n[2]=(t[2]*i+t[6]*s+t[10]*r+t[14])/o,n},"transform$a");var eq=JY,pt={abs:XI,add:YI,angle:rY,clone:cY,copy:qI,create:H0,cross:Zd,distance:ZI,divide:pY,dot:G0,equals:gY,fromScalar:yY,fromValues:wY,fromVec2:AY,length:KI,lerp:CY,max:QI,min:JI,multiply:RY,negate:DY,normalize:cw,orthogonal:zY,rotateX:UY,rotateY:VY,rotateZ:HY,scale:eD,snap:XY,squaredDistance:tD,squaredLength:nD,subtract:W0,toString:QY,transform:eq};const ia=pt,tq=jI,nq=u((n,e,t)=>{const i=ia.normalize(ia.create(),e),s=ia.normalize(ia.create(),t),r=ia.cross(ia.create(),s,i),o=ia.dot(s,i);if(o===-1)return tq(n,Math.PI,ia.orthogonal(r,i));const a=1/(1+o);return n[0]=r[0]*r[0]*a+o,n[1]=r[1]*r[0]*a-r[2],n[2]=r[2]*r[0]*a+r[1],n[3]=0,n[4]=r[0]*r[1]*a+r[2],n[5]=r[1]*r[1]*a+o,n[6]=r[2]*r[1]*a-r[0],n[7]=0,n[8]=r[0]*r[2]*a-r[1],n[9]=r[1]*r[2]*a+r[0],n[10]=r[2]*r[2]*a+o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromVectorRotation");var iq=nq;const{sin:sq,cos:rq}=wi,oq=u((n,e)=>{const t=sq(e),i=rq(e);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=t,n[7]=0,n[8]=0,n[9]=-t,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromXRotation");var aq=oq;const{sin:lq,cos:cq}=wi,uq=u((n,e)=>{const t=lq(e),i=cq(e);return n[0]=i,n[1]=0,n[2]=-t,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=t,n[9]=0,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromYRotation");var hq=uq;const{sin:fq,cos:dq}=wi,pq=u((n,e)=>{const t=fq(e),i=dq(e);return n[0]=i,n[1]=t,n[2]=0,n[3]=0,n[4]=-t,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromZRotation");var mq=pq;const gq=u(n=>n[0]===1&&n[1]===0&&n[2]===0&&n[3]===0&&n[4]===0&&n[5]===1&&n[6]===0&&n[7]===0&&n[8]===0&&n[9]===0&&n[10]===1&&n[11]===0&&n[12]===0&&n[13]===0&&n[14]===0&&n[15]===1,"isIdentity");var vq=gq;const yq=u(n=>no(n[1])&&no(n[2])&&no(n[3])&&no(n[4])&&no(n[6])&&no(n[7])&&no(n[8])&&no(n[9])&&no(n[11])&&n[15]===1,"isOnlyTransformScale"),no=u(n=>Math.abs(n)<Number.EPSILON,"isZero");var _q=yq;const bq=u(n=>{const e=n[4]*n[9]-n[8]*n[5],t=n[8]*n[1]-n[0]*n[9],i=n[0]*n[5]-n[4]*n[1];return e*n[2]+t*n[6]+i*n[10]<0},"isMirroring");var wq=bq;const xq=u((n,e)=>{const[t,i,s,r]=e;return n[0]=1-2*t*t,n[1]=-2*i*t,n[2]=-2*s*t,n[3]=0,n[4]=-2*t*i,n[5]=1-2*i*i,n[6]=-2*s*i,n[7]=0,n[8]=-2*t*s,n[9]=-2*i*s,n[10]=1-2*s*s,n[11]=0,n[12]=2*t*r,n[13]=2*i*r,n[14]=2*s*r,n[15]=1,n},"mirrorByPlane");var Aq=xq;const Mq=u((n,e,t)=>{const i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],f=e[8],d=e[9],p=e[10],g=e[11],m=e[12],v=e[13],y=e[14],b=e[15];let _=t[0],x=t[1],w=t[2],M=t[3];return n[0]=_*i+x*a+w*f+M*m,n[1]=_*s+x*l+w*d+M*v,n[2]=_*r+x*c+w*p+M*y,n[3]=_*o+x*h+w*g+M*b,_=t[4],x=t[5],w=t[6],M=t[7],n[4]=_*i+x*a+w*f+M*m,n[5]=_*s+x*l+w*d+M*v,n[6]=_*r+x*c+w*p+M*y,n[7]=_*o+x*h+w*g+M*b,_=t[8],x=t[9],w=t[10],M=t[11],n[8]=_*i+x*a+w*f+M*m,n[9]=_*s+x*l+w*d+M*v,n[10]=_*r+x*c+w*p+M*y,n[11]=_*o+x*h+w*g+M*b,_=t[12],x=t[13],w=t[14],M=t[15],n[12]=_*i+x*a+w*f+M*m,n[13]=_*s+x*l+w*d+M*v,n[14]=_*r+x*c+w*p+M*y,n[15]=_*o+x*h+w*g+M*b,n},"multiply$1");var Sq=Mq;const{EPS:Cq}=at,{sin:Eq,cos:Tq}=wi,Pq=GI,Rq=u((n,e,t,i)=>{let[s,r,o]=i;const a=s*s+r*r+o*o;if(Math.abs(a)<Cq)return Pq(n,e);const l=1/Math.sqrt(a);s*=l,r*=l,o*=l;const c=Eq(t),h=Tq(t),f=1-h,d=e[0],p=e[1],g=e[2],m=e[3],v=e[4],y=e[5],b=e[6],_=e[7],x=e[8],w=e[9],M=e[10],C=e[11],A=s*s*f+h,P=r*s*f+o*c,D=o*s*f-r*c,k=s*r*f-o*c,O=r*r*f+h,N=o*r*f+s*c,E=s*o*f+r*c,B=r*o*f-s*c,W=o*o*f+h;return n[0]=d*A+v*P+x*D,n[1]=p*A+y*P+w*D,n[2]=g*A+b*P+M*D,n[3]=m*A+_*P+C*D,n[4]=d*k+v*O+x*N,n[5]=p*k+y*O+w*N,n[6]=g*k+b*O+M*N,n[7]=m*k+_*O+C*N,n[8]=d*E+v*B+x*W,n[9]=p*E+y*B+w*W,n[10]=g*E+b*B+M*W,n[11]=m*E+_*B+C*W,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},"rotate$4");var Iq=Rq;const{sin:Dq,cos:Lq}=wi,Oq=u((n,e,t)=>{const i=Dq(t),s=Lq(t),r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=r*s+c*i,n[5]=o*s+h*i,n[6]=a*s+f*i,n[7]=l*s+d*i,n[8]=c*s-r*i,n[9]=h*s-o*i,n[10]=f*s-a*i,n[11]=d*s-l*i,n},"rotateX$1");var kq=Oq;const{sin:Nq,cos:Fq}=wi,zq=u((n,e,t)=>{const i=Nq(t),s=Fq(t),r=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],f=e[10],d=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*s-c*i,n[1]=o*s-h*i,n[2]=a*s-f*i,n[3]=l*s-d*i,n[8]=r*i+c*s,n[9]=o*i+h*s,n[10]=a*i+f*s,n[11]=l*i+d*s,n},"rotateY$1");var Bq=zq;const{sin:Uq,cos:$q}=wi,Vq=u((n,e,t)=>{const i=Uq(t),s=$q(t),r=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],f=e[6],d=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*s+c*i,n[1]=o*s+h*i,n[2]=a*s+f*i,n[3]=l*s+d*i,n[4]=c*s-r*i,n[5]=h*s-o*i,n[6]=f*s-a*i,n[7]=d*s-l*i,n},"rotateZ$1");var Gq=Vq;const Hq=u((n,e,t)=>{const i=t[0],s=t[1],r=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*r,n[9]=e[9]*r,n[10]=e[10]*r,n[11]=e[11]*r,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},"scale$3");var Wq=Hq;const jq=u((n,e,t)=>(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n),"subtract$8");var Xq=jq;const Yq=u(n=>n.map(e=>e.toFixed(7)).toString(),"toString$8");var qq=Yq;const Zq=u((n,e,t)=>{const i=t[0],s=t[1],r=t[2];let o,a,l,c,h,f,d,p,g,m,v,y;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*r+e[12],n[13]=e[1]*i+e[5]*s+e[9]*r+e[13],n[14]=e[2]*i+e[6]*s+e[10]*r+e[14],n[15]=e[3]*i+e[7]*s+e[11]*r+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],f=e[5],d=e[6],p=e[7],g=e[8],m=e[9],v=e[10],y=e[11],n[0]=o,n[1]=a,n[2]=l,n[3]=c,n[4]=h,n[5]=f,n[6]=d,n[7]=p,n[8]=g,n[9]=m,n[10]=v,n[11]=y,n[12]=o*i+h*s+g*r+e[12],n[13]=a*i+f*s+m*r+e[13],n[14]=l*i+d*s+v*r+e[14],n[15]=c*i+p*s+y*r+e[15]),n},"translate$4");var Kq=Zq,tn={add:CX,clone:RX,copy:GI,create:lw,invert:LX,equals:kX,fromRotation:jI,fromScaling:jX,fromTaitBryanRotation:YX,fromTranslation:ZX,fromValues:JX,fromVectorRotation:iq,fromXRotation:aq,fromYRotation:hq,fromZRotation:mq,identity:WI,isIdentity:vq,isOnlyTransformScale:_q,isMirroring:wq,mirrorByPlane:Aq,multiply:Sq,rotate:Iq,rotateX:kq,rotateY:Bq,rotateZ:Gq,scale:Wq,subtract:Xq,toString:qq,translate:Kq};const Qq=tn,Jq=u(n=>(n===void 0&&(n=[]),{sides:n,transforms:Qq.create()}),"create$A");var j0=Jq;const eZ=u((n,e)=>(n[0]=Math.abs(e[0]),n[1]=Math.abs(e[1]),n),"abs");var tZ=eZ;const nZ=u((n,e,t)=>(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n),"add$1");var iZ=nZ;const sZ=u(n=>Math.atan2(n[1],n[0]),"angleRadians$1");var uw=sZ,rZ=uw;const oZ=uw,aZ=u(n=>oZ(n)*57.29577951308232,"angleDegrees");var lZ=aZ;const cZ=u(()=>[0,0],"create$z");var X0=cZ;const uZ=X0,hZ=u(n=>{const e=uZ();return e[0]=n[0],e[1]=n[1],e},"clone$8");var fZ=hZ;const dZ=u((n,e)=>(n[0]=e[0],n[1]=e[1],n),"copy$4");var pZ=dZ;const mZ=u((n,e,t)=>(n[0]=0,n[1]=0,n[2]=e[0]*t[1]-e[1]*t[0],n),"cross$3");var gZ=mZ;const vZ=u((n,e)=>{const t=e[0]-n[0],i=e[1]-n[1];return Math.sqrt(t*t+i*i)},"distance$1");var yZ=vZ;const _Z=u((n,e,t)=>(n[0]=e[0]/t[0],n[1]=e[1]/t[1],n),"divide");var bZ=_Z;const wZ=u((n,e)=>n[0]*e[0]+n[1]*e[1],"dot$3");var xZ=wZ;const AZ=u((n,e)=>n[0]===e[0]&&n[1]===e[1],"equals$6");var MZ=AZ;const{sin:SZ,cos:CZ}=wi,EZ=u((n,e)=>(n[0]=CZ(e),n[1]=SZ(e),n),"fromAngleRadians$1");var iD=EZ;const TZ=iD,PZ=u((n,e)=>TZ(n,e*.017453292519943295),"fromAngleDegrees");var RZ=PZ;const IZ=u((n,e)=>(n[0]=e,n[1]=e,n),"fromScalar$1");var DZ=IZ;const LZ=X0,OZ=u((n,e)=>{const t=LZ();return t[0]=n,t[1]=e,t},"fromValues$3");var kZ=OZ;const NZ=u(n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),"length$1");var FZ=NZ;const zZ=u((n,e,t,i)=>{const s=e[0],r=e[1];return n[0]=s+i*(t[0]-s),n[1]=r+i*(t[1]-r),n},"lerp");var BZ=zZ;const UZ=u((n,e,t)=>(n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n),"max$1");var $Z=UZ;const VZ=u((n,e,t)=>(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n),"min");var GZ=VZ;const HZ=u((n,e,t)=>(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n),"multiply");var WZ=HZ;const jZ=u((n,e)=>(n[0]=-e[0],n[1]=-e[1],n),"negate");var XZ=jZ;const YZ=u((n,e,t,i)=>{const s=e[0]-t[0],r=e[1]-t[1],o=Math.cos(i),a=Math.sin(i);return n[0]=s*o-r*a+t[0],n[1]=s*a+r*o+t[1],n},"rotate$3");var sD=YZ;const{TAU:qZ}=at,ZZ=X0,KZ=sD,QZ=u((n,e)=>KZ(n,e,ZZ(),qZ/4),"normal");var JZ=QZ;const eK=u((n,e)=>{const t=e[0],i=e[1];let s=t*t+i*i;return s>0&&(s=1/Math.sqrt(s)),n[0]=t*s,n[1]=i*s,n},"normalize$2");var tK=eK;const nK=u((n,e,t)=>(n[0]=e[0]*t,n[1]=e[1]*t,n),"scale$2");var iK=nK;const sK=u((n,e,t)=>(n[0]=Math.round(e[0]/t)*t+0,n[1]=Math.round(e[1]/t)*t+0,n),"snap");var rK=sK;const oK=u((n,e)=>{const t=e[0]-n[0],i=e[1]-n[1];return t*t+i*i},"squaredDistance$1");var aK=oK;const lK=u(n=>{const e=n[0],t=n[1];return e*e+t*t},"squaredLength$1");var cK=lK;const uK=u((n,e,t)=>(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n),"subtract$7");var hK=uK;const fK=u(n=>`[${n[0].toFixed(7)}, ${n[1].toFixed(7)}]`,"toString$7");var dK=fK;const pK=u((n,e,t)=>{const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n},"transform$9");var mK=pK,gt={abs:tZ,add:iZ,angle:rZ,angleDegrees:lZ,angleRadians:uw,clone:fZ,copy:pZ,create:X0,cross:gZ,distance:yZ,divide:bZ,dot:xZ,equals:MZ,fromAngleDegrees:RZ,fromAngleRadians:iD,fromScalar:DZ,fromValues:kZ,length:FZ,lerp:BZ,max:$Z,min:GZ,multiply:WZ,negate:XZ,normal:JZ,normalize:tK,rotate:sD,scale:iK,snap:rK,squaredDistance:aK,squaredLength:cK,subtract:hK,toString:dK,transform:mK};const Av=gt,gK=j0,vK=u(n=>{if(!Array.isArray(n))throw new Error("the given points must be an array");let e=n.length;if(e<3)throw new Error("the given points must define a closed geometry with three or more points");Av.equals(n[0],n[e-1])&&--e;const t=[];let i=n[e-1];for(let s=0;s<e;s++){const r=n[s];t.push([Av.clone(i),Av.clone(r)]),i=r}return gK(t)},"fromPoints$a");var yK=vK;const _K=tn,Z2=gt,bK=j0,wK=u(n=>{if(n[0]!==0)throw new Error("invalid compact binary data");const e=bK();e.transforms=_K.clone(n.slice(1,17));for(let t=21;t<n.length;t+=4){const i=Z2.fromValues(n[t+0],n[t+1]),s=Z2.fromValues(n[t+2],n[t+3]);e.sides.push([i,s])}return n[17]>=0&&(e.color=[n[17],n[18],n[19],n[20]]),e},"fromCompactBinary$2");var xK=wK;const AK=u(n=>!!(n&&typeof n=="object"&&"sides"in n&&"transforms"in n&&Array.isArray(n.sides)&&"length"in n.transforms),"isA$8");var rD=AK;const K2=tn,tm=gt,MK=u(n=>(K2.isIdentity(n.transforms)||(n.sides=n.sides.map(e=>{const t=tm.transform(tm.create(),e[0],n.transforms),i=tm.transform(tm.create(),e[1],n.transforms);return[t,i]}),n.transforms=K2.create()),n),"applyTransforms$5");var SK=MK;const CK=SK,EK=u(n=>CK(n).sides,"toSides$4");var Kd=EK;const TK=j0,PK=Kd,RK=u(n=>{const t=PK(n).map(i=>[i[1],i[0]]);return t.reverse(),TK(t)},"reverse$3");var IK=RK;const Wh=gt,DK=Kd,LK=u(n=>{const e=new Map,t=u(i=>{const s=i.toString();return e.has(s)?e.get(s):(e.set(s,i),i)},"getUniqueVertex");return n.map(i=>i.map(t))},"toSharedVertices"),OK=u(n=>{const e=new Map;return LK(n).forEach(i=>{e.has(i[0])?e.get(i[0]).push(i):e.set(i[0],[i])}),e},"toVertexMap"),kK=u(n=>{const e=OK(DK(n)),t=[];for(;;){let i;for(const[o,a]of e){if(i=a.shift(),!i){e.delete(o);continue}break}if(i===void 0)break;const s=[],r=i[0];for(;;){s.push(i[0]);const o=i[1];if(o===r)break;const a=e.get(o);if(!a)throw new Error(`geometry is not closed at vertex ${o}`);const l=NK(i,a);a.length===0&&e.delete(o),i=l}s.length>0&&s.push(s.shift()),t.push(s)}return e.clear(),t},"toOutlines$2"),NK=u((n,e)=>{if(e.length===1)return e.pop();const t=Wh.create(),i=Wh.angleDegrees(Wh.subtract(t,n[1],n[0]));let s,r;e.forEach((a,l)=>{let h=Wh.angleDegrees(Wh.subtract(t,a[1],a[0]))-i;h<-180&&(h+=360),h>=180&&(h-=360),(r===void 0||h>s)&&(r=l,s=h)});const o=e[r];return e.splice(r,1),o},"popNextSide");var oD=kK;const FK=Kd,zK=u(n=>{const t=FK(n).map(i=>i[0]);return t.length>0&&t.push(t.shift()),t},"toPoints$8");var BK=zK;const Q2=gt,UK=Kd,$K=u(n=>{const e=UK(n);let t="geom2 ("+e.length+` sides):
[
`;return e.forEach(i=>{t+="  ["+Q2.toString(i[0])+", "+Q2.toString(i[1])+`]
`}),t+=`]
`,t},"toString$6");var VK=$K;const GK=u(n=>{const e=n.sides,t=n.transforms;let i=[-1,-1,-1,-1];n.color&&(i=n.color);const s=new Float32Array(1+16+4+e.length*4);s[0]=0,s[1]=t[0],s[2]=t[1],s[3]=t[2],s[4]=t[3],s[5]=t[4],s[6]=t[5],s[7]=t[6],s[8]=t[7],s[9]=t[8],s[10]=t[9],s[11]=t[10],s[12]=t[11],s[13]=t[12],s[14]=t[13],s[15]=t[14],s[16]=t[15],s[17]=i[0],s[18]=i[1],s[19]=i[2],s[20]=i[3];for(let r=0;r<e.length;r++){const o=r*4+21,a=e[r][0],l=e[r][1];s[o+0]=a[0],s[o+1]=a[1],s[o+2]=l[0],s[o+3]=l[1]}return s},"toCompactBinary$2");var HK=GK;const J2=tn,WK=u((n,e)=>{const t=J2.multiply(J2.create(),n,e.transforms);return Object.assign({},e,{transforms:t})},"transform$8");var jK=WK;const XK=gt,YK=rD,qK=oD,ZK=u(n=>{if(!YK(n))throw new Error("invalid geom2 structure");if(qK(n),n.sides.forEach(e=>{if(XK.equals(e[0],e[1]))throw new Error(`geom2 self-edge ${e[0]}`)}),!n.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${n.transforms}`)},"validate$3");var KK=ZK,Ct={clone:MX,create:j0,fromPoints:yK,fromCompactBinary:xK,isA:rD,reverse:IK,toOutlines:oD,toPoints:BK,toSides:Kd,toString:VK,toCompactBinary:HK,transform:jK,validate:KK};const QK=u(n=>Object.assign({},n),"clone$7");var JK=QK;const eQ=tn,tQ=u(n=>(n===void 0&&(n=[]),{polygons:n,transforms:eQ.create()}),"create$s");var Y0=tQ;const nQ=u(n=>((n===void 0||n.length<3)&&(n=[]),{vertices:n}),"create$r");var fh=nQ;const iQ=fh,sQ=pt,rQ=u((...n)=>{let e,t;return n.length===1?(e=iQ(),t=n[0]):(e=n[0],t=n[1]),e.vertices=t.vertices.map(i=>sQ.clone(i)),e},"clone$6");var oQ=rQ;const aQ=pt,lQ=fh,cQ=u(n=>{const e=n.map(t=>aQ.clone(t));return lQ(e)},"fromPoints$9");var uQ=cQ;const hQ=fh,fQ=u((n,e)=>{const t=hQ(n);return t.plane=e,t},"fromPointsAndPlane");var dQ=fQ;const pQ=u(()=>[0,0,0,0],"create$n");var q0=pQ;const mQ=q0,gQ=u(n=>{const e=mQ();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e},"clone$5");var aD=gQ;const vQ=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n),"copy$3");var lD=vQ;const yQ=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3],"equals$5");var cD=yQ;const _Q=u((n,e)=>(n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=-e[3],n),"flip$3");var uD=_Q;const Mv=pt,bQ=u((n,e,t)=>{const i=Mv.normalize(Mv.create(),e),s=Mv.dot(t,i);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=s,n},"fromNormalAndPoint");var wQ=bQ;const xQ=q0,AQ=u((n,e,t,i)=>{const s=xQ();return s[0]=n,s[1]=e,s[2]=t,s[3]=i,s},"fromValues$2");var hD=AQ;const Mr=pt,MQ=u((n,...e)=>{const t=e.length,i=Mr.create(),s=Mr.create(),r=u(o=>{const a=e[o],l=e[(o+1)%t],c=e[(o+2)%t];return Mr.subtract(i,l,a),Mr.subtract(s,c,a),Mr.cross(i,i,s),Mr.normalize(i,i),i},"vertexNormal");return n[0]=0,n[1]=0,n[2]=0,t===3?Mr.copy(n,r(0)):(e.forEach((o,a)=>{Mr.add(n,n,r(a))}),Mr.normalize(n,n)),n[3]=Mr.dot(n,e[0]),n},"fromPoints$8");var fD=MQ;const{EPS:Sv}=at,Ni=pt,SQ=u((n,e,t,i)=>{let s=Ni.subtract(Ni.create(),t,e),r=Ni.subtract(Ni.create(),i,e);Ni.length(s)<Sv&&(s=Ni.orthogonal(s,r)),Ni.length(r)<Sv&&(r=Ni.orthogonal(r,s));let o=Ni.cross(Ni.create(),s,r);Ni.length(o)<Sv&&(r=Ni.orthogonal(r,s),o=Ni.cross(o,s,r)),o=Ni.normalize(o,o);const a=Ni.dot(o,e);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=a,n},"fromPointsRandom");var CQ=SQ;const EQ=pt,TQ=u((n,e)=>{const t=e[0]*n[0]+e[1]*n[1]+e[2]*n[2]-n[3],i=e[0]-t*n[0],s=e[1]-t*n[1],r=e[2]-t*n[2];return EQ.fromValues(i,s,r)},"projectionOfPoint");var PQ=TQ;const RQ=pt,IQ=u((n,e)=>RQ.dot(n,e)-n[3],"signedDistanceToPoint$1");var dD=IQ;const DQ=u(n=>`(${n[0].toFixed(9)}, ${n[1].toFixed(9)}, ${n[2].toFixed(9)}, ${n[3].toFixed(9)})`,"toString$5");var pD=DQ;const LQ=tn,Fi=pt,OQ=fD,kQ=uD,NQ=u((n,e,t)=>{const i=LQ.isMirroring(t),s=Fi.orthogonal(Fi.create(),e),r=Fi.cross(s,e,s),o=Fi.cross(Fi.create(),e,r);let a=Fi.fromScalar(Fi.create(),e[3]);Fi.multiply(a,a,e);let l=Fi.add(Fi.create(),a,r),c=Fi.add(Fi.create(),a,o);return a=Fi.transform(a,a,t),l=Fi.transform(l,l,t),c=Fi.transform(c,c,t),OQ(n,a,l,c),i&&kQ(n,n),n},"transform$7");var FQ=NQ,Vo={clone:aD,copy:lD,create:q0,equals:cD,flip:uD,fromNormalAndPoint:wQ,fromValues:hD,fromPoints:fD,fromPointsRandom:CQ,projectionOfPoint:PQ,signedDistanceToPoint:dD,toString:pD,transform:FQ};const eS=Vo,zQ=fh,BQ=u(n=>{const e=n.vertices.slice().reverse(),t=zQ(e);return n.plane&&(t.plane=eS.flip(eS.create(),n.plane)),t},"invert$1");var UQ=BQ;const $Q=u(n=>!!(n&&typeof n=="object"&&"vertices"in n&&Array.isArray(n.vertices)),"isA$6");var mD=$Q;const tS=Vo,nl=pt,VQ=u(n=>GQ(n.vertices),"isConvex$1"),GQ=u(n=>{const e=n.length;if(e>2){const t=tS.fromPoints(tS.create(),...n);let i=n[e-2],s=n[e-1];for(let r=0;r<e;r++){const o=n[r];if(!HQ(i,s,o,t))return!1;i=s,s=o}}return!0},"areVerticesConvex"),HQ=u((n,e,t,i)=>{const s=nl.cross(nl.create(),nl.subtract(nl.create(),e,n),nl.subtract(nl.create(),t,e));return nl.dot(s,i)>=0},"isConvexPoint");var gD=VQ;const nS=Vo,WQ=u(n=>(n.plane||(n.plane=nS.fromPoints(nS.create(),...n.vertices)),n.plane),"plane$8");var hw=WQ;const jQ=hw,XQ=u(n=>{const e=n.vertices.length;if(e<3)return 0;const t=n.vertices,i=jQ(n),s=Math.abs(i[0]),r=Math.abs(i[1]),o=Math.abs(i[2]);if(s+r+o===0)return 0;let a=3;s>r&&s>o?a=1:r>o&&(a=2);let l=0,c=0,h=1,f=2;switch(a){case 1:for(h=1;h<e;h++)c=h-1,f=(h+1)%e,l+=t[h][1]*(t[f][2]-t[c][2]);l+=t[0][1]*(t[1][2]-t[e-1][2]),l/=2*i[0];break;case 2:for(h=1;h<e;h++)c=h-1,f=(h+1)%e,l+=t[h][2]*(t[f][0]-t[c][0]);l+=t[0][2]*(t[1][0]-t[e-1][0]),l/=2*i[1];break;case 3:default:for(h=1;h<e;h++)c=h-1,f=(h+1)%e,l+=t[h][0]*(t[f][1]-t[c][1]);l+=t[0][0]*(t[1][1]-t[e-1][1]),l/=2*i[2];break}return l},"measureArea$3");var vD=XQ;const jh=pt,YQ=u(n=>{const e=n.vertices,t=e.length,i=t===0?jh.create():jh.clone(e[0]),s=jh.clone(i);for(let r=1;r<t;r++)jh.min(i,i,e[r]),jh.max(s,s,e[r]);return[i,s]},"measureBoundingBox$5");var qQ=YQ;const ZQ=u((n,e)=>n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3],"dot$2");var KQ=ZQ;const QQ=u((n,e)=>(n[0]=e,n[1]=e,n[2]=e,n[3]=e,n),"fromScalar");var JQ=QQ;const eJ=u((n,e,t)=>{const[i,s,r,o]=e;return n[0]=t[0]*i+t[4]*s+t[8]*r+t[12]*o,n[1]=t[1]*i+t[5]*s+t[9]*r+t[13]*o,n[2]=t[2]*i+t[6]*s+t[10]*r+t[14]*o,n[3]=t[3]*i+t[7]*s+t[11]*r+t[15]*o,n},"transform$6");var tJ=eJ,nJ={clone:aD,copy:lD,create:q0,dot:KQ,equals:cD,fromScalar:JQ,fromValues:hD,toString:pD,transform:tJ};const iJ=nJ,iS=new WeakMap,sJ=u(n=>{let e=iS.get(n);if(e)return e;const t=n.vertices,i=iJ.create();if(t.length===0)return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i;let s=t[0],r=s,o=s,a=s,l=s,c=s;t.forEach(p=>{s[0]>p[0]&&(s=p),r[1]>p[1]&&(r=p),o[2]>p[2]&&(o=p),a[0]<p[0]&&(a=p),l[1]<p[1]&&(l=p),c[2]<p[2]&&(c=p)}),i[0]=(s[0]+a[0])*.5,i[1]=(r[1]+l[1])*.5,i[2]=(o[2]+c[2])*.5;const h=i[0]-a[0],f=i[1]-l[1],d=i[2]-c[2];return i[3]=Math.sqrt(h*h+f*f+d*d),iS.set(n,i),i},"measureBoundingSphere");var rJ=sJ;const Cv=pt,oJ=u(n=>{let e=0;const t=n.vertices,i=Cv.create();for(let s=0;s<t.length-2;s++)Cv.cross(i,t[s+1],t[s+2]),e+=Cv.dot(t[0],i);return e/=6,e},"measureSignedVolume");var aJ=oJ;const lJ=u(n=>n.vertices,"toPoints$7");var cJ=lJ;const uJ=pt,hJ=u(n=>{let e="poly3: vertices: [";return n.vertices.forEach(t=>{e+=`${uJ.toString(t)}, `}),e+="]",e},"toString$4");var fJ=hJ;const dJ=tn,sS=pt,pJ=fh,mJ=u((n,e)=>{const t=e.vertices.map(i=>sS.transform(sS.create(),i,n));return dJ.isMirroring(n)&&t.reverse(),pJ(t)},"transform$5");var gJ=mJ;const vJ=dD,{NEPS:yJ}=at,_J=pt,bJ=mD,wJ=gD,xJ=vD,AJ=hw,MJ=u(n=>{if(!bJ(n))throw new Error("invalid poly3 structure");if(n.vertices.length<3)throw new Error(`poly3 not enough vertices ${n.vertices.length}`);if(xJ(n)<=0)throw new Error("poly3 area must be greater than zero");for(let e=0;e<n.vertices.length;e++)if(_J.equals(n.vertices[e],n.vertices[(e+1)%n.vertices.length]))throw new Error(`poly3 duplicate vertex ${n.vertices[e]}`);if(!wJ(n))throw new Error("poly3 must be convex");if(n.vertices.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${e}`)}),n.vertices.length>3){const e=AJ(n);n.vertices.forEach(t=>{const i=Math.abs(vJ(e,t));if(i>yJ)throw new Error(`poly3 must be coplanar: vertex ${t} distance ${i}`)})}},"validate$2");var SJ=MJ,Yt={clone:oQ,create:fh,fromPoints:uQ,fromPointsAndPlane:dQ,invert:UQ,isA:mD,isConvex:gD,measureArea:vD,measureBoundingBox:qQ,measureBoundingSphere:rJ,measureSignedVolume:aJ,plane:hw,toPoints:cJ,toString:fJ,transform:gJ,validate:SJ};const CJ=Yt,EJ=Y0,TJ=u(n=>{if(!Array.isArray(n))throw new Error("the given points must be an array");const e=n.map((i,s)=>CJ.create(i));return EJ(e)},"fromPoints$6");var PJ=TJ;const RJ=pt,IJ=tn,DJ=Yt,LJ=Y0,OJ=u(n=>{if(n[0]!==1)throw new Error("invalid compact binary data");const e=LJ();e.transforms=IJ.clone(n.slice(1,17));const t=n[21];let i=22,s=n.length-t*3;for(;s<n.length;){const r=n[i];i++;const o=[];for(let a=0;a<r;a++)o.push(RJ.fromValues(n[s],n[s+1],n[s+2])),s+=3;e.polygons.push(DJ.create(o))}return n[17]>=0&&(e.color=[n[17],n[18],n[19],n[20]]),e},"fromCompactBinary$1");var kJ=OJ;const rS=tn,NJ=Yt,FJ=u(n=>(rS.isIdentity(n.transforms)||(n.polygons=n.polygons.map(e=>NJ.transform(n.transforms,e)),n.transforms=rS.create()),n),"applyTransforms$3");var zJ=FJ;const BJ=zJ,UJ=u(n=>BJ(n).polygons,"toPolygons$4");var Z0=UJ;const $J=Yt,VJ=Y0,GJ=Z0,HJ=u(n=>{const t=GJ(n).map(i=>$J.invert(i));return VJ(t)},"invert");var WJ=HJ;const jJ=u(n=>!!(n&&typeof n=="object"&&"polygons"in n&&"transforms"in n&&Array.isArray(n.polygons)&&"length"in n.transforms),"isA$4");var yD=jJ;const XJ=Yt,YJ=Z0,qJ=u(n=>YJ(n).map(i=>XJ.toPoints(i)),"toPoints$6");var ZJ=qJ;const KJ=Yt,QJ=Z0,JJ=u(n=>{const e=QJ(n);let t="geom3 ("+e.length+` polygons):
`;return e.forEach(i=>{t+="  "+KJ.toString(i)+`
`}),t},"toString$3");var eee=JJ;const tee=Yt,nee=u(n=>{const e=n.polygons,t=n.transforms,i=e.length,s=e.reduce((c,h)=>c+h.vertices.length,0);let r=[-1,-1,-1,-1];n.color&&(r=n.color);const o=new Float32Array(1+16+4+1+i+s*3);o[0]=1,o[1]=t[0],o[2]=t[1],o[3]=t[2],o[4]=t[3],o[5]=t[4],o[6]=t[5],o[7]=t[6],o[8]=t[7],o[9]=t[8],o[10]=t[9],o[11]=t[10],o[12]=t[11],o[13]=t[12],o[14]=t[13],o[15]=t[14],o[16]=t[15],o[17]=r[0],o[18]=r[1],o[19]=r[2],o[20]=r[3],o[21]=s;let a=22,l=a+i;return e.forEach(c=>{const h=tee.toPoints(c);o[a]=h.length,a++;for(let f=0;f<h.length;f++){const d=h[f];o[l+0]=d[0],o[l+1]=d[1],o[l+2]=d[2],l+=3}}),o},"toCompactBinary$1");var iee=nee;const oS=tn,see=u((n,e)=>{const t=oS.multiply(oS.create(),n,e.transforms);return Object.assign({},e,{transforms:t})},"transform$4");var ree=see;const oee=Yt,aee=yD,lee=u(n=>{if(!aee(n))throw new Error("invalid geom3 structure");if(n.polygons.forEach(oee.validate),cee(n),!n.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${n.transforms}`)},"validate$1"),cee=u(n=>{const e=new Map;n.polygons.forEach(({vertices:i})=>{i.forEach((s,r)=>{const o=`${s}`,a=`${i[(r+1)%i.length]}`,l=`${o}/${a}`,c=e.has(l)?e.get(l):0;e.set(l,c+1)})});const t=[];if(e.forEach((i,s)=>{const r=s.split("/").reverse().join("/"),o=e.get(r);i!==o&&t.push(s.replace("/"," -> "))}),t.length>0)throw new Error(`non-manifold edges ${t.length}
${t.join(`
`)}`)},"validateManifold");var uee=lee,At={clone:JK,create:Y0,fromPoints:PJ,fromCompactBinary:kJ,invert:WJ,isA:yD,toPoints:ZJ,toPolygons:Z0,toString:eee,toCompactBinary:iee,transform:ree,validate:uee};const hee=u(n=>Object.assign({},n),"clone$4");var fw=hee;const{EPS:aS}=at,fee=gt,dee=fw,pee=u(n=>{if(n.isClosed)return n;const e=dee(n);if(e.isClosed=!0,e.points.length>1){const t=e.points,i=t[0];let s=t[t.length-1];for(;fee.distance(i,s)<aS*aS&&(t.pop(),t.length!==1);)s=t[t.length-1]}return e},"close$1");var _D=pee;const mee=tn,gee=u(n=>(n===void 0&&(n=[]),{points:n,isClosed:!1,transforms:mee.create()}),"create$f");var K0=gee;const{EPS:lS}=at,cS=gt,vee=_D,yee=K0,_ee=u((n,e)=>{const t={closed:!1};let{closed:i}=Object.assign({},t,n),s=yee();if(s.points=e.map(r=>cS.clone(r)),s.points.length>1){const r=s.points[0],o=s.points[s.points.length-1];cS.distance(r,o)<lS*lS&&(i=!0)}return i===!0&&(s=vee(s)),s},"fromPoints$5");var dw=_ee;const uS=tn,hS=gt,bee=u(n=>(uS.isIdentity(n.transforms)||(n.points=n.points.map(e=>hS.transform(hS.create(),e,n.transforms)),n.transforms=uS.create()),n),"applyTransforms$1");var wee=bee;const xee=wee,Aee=u(n=>xee(n).points,"toPoints$5");var dh=Aee;const{TAU:nm}=at,Xn=gt,Mee=dw,See=dh,Cee=u((n,e)=>{const t={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16};let{endpoint:i,radius:s,xaxisrotation:r,clockwise:o,large:a,segments:l}=Object.assign({},t,n);if(!Array.isArray(i))throw new Error("endpoint must be an array of X and Y values");if(i.length<2)throw new Error("endpoint must contain X and Y values");if(i=Xn.clone(i),!Array.isArray(s))throw new Error("radius must be an array of X and Y values");if(s.length<2)throw new Error("radius must contain X and Y values");if(l<4)throw new Error("segments must be four or more");const c=1e5;if(e.isClosed)throw new Error("the given path cannot be closed");const h=See(e);if(h.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let f=s[0],d=s[1];const p=h[h.length-1];f=Math.round(f*c)/c,d=Math.round(d*c)/c,i=Xn.fromValues(Math.round(i[0]*c)/c,Math.round(i[1]*c)/c);const g=!o;let m=[];if(f===0||d===0)m.push(i);else{f=Math.abs(f),d=Math.abs(d);const y=r,b=Math.cos(y),_=Math.sin(y),x=Xn.subtract(Xn.create(),p,i);Xn.scale(x,x,.5);const w=Math.round((b*x[0]+_*x[1])*c)/c,M=Math.round((-_*x[0]+b*x[1])*c)/c,C=Xn.fromValues(w,M),A=C[0]*C[0]/(f*f)+C[1]*C[1]/(d*d);if(A>1){const ne=Math.sqrt(A);f*=ne,d*=ne,f=Math.round(f*c)/c,d=Math.round(d*c)/c}let P=Math.sqrt((f*f*d*d-f*f*C[1]*C[1]-d*d*C[0]*C[0])/(f*f*C[1]*C[1]+d*d*C[0]*C[0]));g===a&&(P=-P);const D=Xn.fromValues(f*C[1]/d,-d*C[0]/f);Xn.scale(D,D,P);let k=Xn.fromValues(b*D[0]-_*D[1],_*D[0]+b*D[1]);k=Xn.add(k,k,Xn.scale(Xn.create(),Xn.add(Xn.create(),p,i),.5));const O=Xn.fromValues((C[0]-D[0])/f,(C[1]-D[1])/d),N=Xn.fromValues((-C[0]-D[0])/f,(-C[1]-D[1])/d),E=Xn.angleRadians(O);let W=Xn.angleRadians(N)-E;W=W%nm,!g&&W>0?W-=nm:g&&W<0&&(W+=nm);let Z=Math.ceil(Math.abs(W)/nm*l)+1;Z<1&&(Z=1);for(let ne=1;ne<Z;ne++){const j=E+ne/Z*W,ie=Math.cos(j),K=Math.sin(j),$=Xn.fromValues(b*f*ie-_*d*K,_*f*ie+b*d*K);Xn.add($,$,k),m.push($)}Z&&m.push(n.endpoint)}return m=h.concat(m),Mee({},m)},"appendArc");var Eee=Cee;const Tee=dw,Pee=dh,{equals:Ree}=gt,Iee=u((...n)=>{let e=!1,t=[];return n.forEach((i,s)=>{const r=Pee(i).slice();if(t.length>0&&r.length>0&&Ree(r[0],t[t.length-1])&&r.shift(),r.length>0&&e)throw new Error(`Cannot concatenate to a closed path; check the ${s}th path`);e=i.isClosed,t=t.concat(r)}),Tee({closed:e},t)},"concat$1");var bD=Iee;const Dee=bD,Lee=K0,Oee=u((n,e)=>Dee(e,Lee(n)),"appendPoints$1");var wD=Oee;const{TAU:kee}=at,ms=gt,Nee=gt,Fee=wD,zee=dh,Bee=u((n,e)=>{const t={segments:16};let{controlPoints:i,segments:s}=Object.assign({},t,n);if(!Array.isArray(i))throw new Error("controlPoints must be an array of one or more points");if(i.length<1)throw new Error("controlPoints must be an array of one or more points");if(s<4)throw new Error("segments must be four or more");if(e.isClosed)throw new Error("the given geometry cannot be closed");const r=zee(e);if(r.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(i=i.slice(),i[0]===null){if(i.length<2)throw new Error("a null control point must be passed with one more control points");let M=r[r.length-2];if("lastBezierControlPoint"in e&&(M=e.lastBezierControlPoint),!Array.isArray(M))throw new Error("the given path must contain TWO or more points if given a null control point");const C=ms.scale(ms.create(),r[r.length-1],2);ms.subtract(C,C,M),i[0]=C}i.unshift(r[r.length-1]);const a=i.length-1,l=[];let c=1;for(let M=0;M<=a;++M)M>0&&(c*=M),l.push(c);const h=[];for(let M=0;M<=a;++M){const C=l[a]/(l[M]*l[a-M]);h.push(C)}const f=ms.create(),d=ms.create(),p=Nee.create(),g=u(M=>{let C=1,A=Math.pow(1-M,a);const P=M!==1?1/(1-M):1,D=ms.create();for(let k=0;k<=a;++k){k===a&&(A=1);const O=h[k]*C*A,N=ms.scale(f,i[k],O);ms.add(D,D,N),C*=M,A*=P}return D},"getPointForT"),m=[],v=[],y=a+1;for(let M=0;M<y;++M){const C=M/(y-1),A=g(C);m.push(A),v.push(C)}let b=1;const _=kee/s,x=Math.sin(_);for(;b<m.length-1;){const M=ms.subtract(f,m[b],m[b-1]);ms.normalize(M,M);const C=ms.subtract(d,m[b+1],m[b]);ms.normalize(C,C);const A=ms.cross(p,M,C);if(Math.abs(A[2])>x){const P=v[b-1],D=v[b+1],k=P+(D-P)*1/3,O=P+(D-P)*2/3,N=g(k),E=g(O);m.splice(b,1,N,E),v.splice(b,1,k,O),b--,b<1&&(b=1)}else++b}m.shift();const w=Fee(m,e);return w.lastBezierControlPoint=i[i.length-2],w},"appendBezier");var Uee=Bee;const $ee=gt,fS=dh,Vee=u((n,e)=>{if(n.isClosed!==e.isClosed||n.points.length!==e.points.length)return!1;const t=fS(n),i=fS(e),s=t.length;let r=0;do{let o=!1;for(let a=0;a<s;a++)if(!$ee.equals(t[a],i[(a+r)%s])){o=!0;break}if(o===!1)return!0;if(!n.isClosed)return!1}while(++r<s);return!1},"equals$3");var Gee=Vee;const Hee=tn,Wee=gt,jee=K0,Xee=u(n=>{if(n[0]!==2)throw new Error("invalid compact binary data");const e=jee();e.transforms=Hee.clone(n.slice(1,17)),e.isClosed=!!n[17];for(let t=22;t<n.length;t+=2){const i=Wee.fromValues(n[t],n[t+1]);e.points.push(i)}return n[18]>=0&&(e.color=[n[18],n[19],n[20],n[21]]),e},"fromCompactBinary");var Yee=Xee;const qee=u(n=>!!(n&&typeof n=="object"&&"points"in n&&"transforms"in n&&"isClosed"in n&&Array.isArray(n.points)&&"length"in n.transforms),"isA$2");var xD=qee;const Zee=fw,Kee=u(n=>{const e=Zee(n);return e.points=n.points.slice().reverse(),e},"reverse$2");var Qee=Kee;const Jee=gt,ete=dh,tte=u(n=>{const e=ete(n);let t="path ("+e.length+" points, "+n.isClosed+`):
[
`;return e.forEach(i=>{t+="  "+Jee.toString(i)+`,
`}),t+=`]
`,t},"toString$2");var nte=tte;const ite=u(n=>{const e=n.points,t=n.transforms;let i=[-1,-1,-1,-1];n.color&&(i=n.color);const s=new Float32Array(1+16+1+4+e.length*2);s[0]=2,s[1]=t[0],s[2]=t[1],s[3]=t[2],s[4]=t[3],s[5]=t[4],s[6]=t[5],s[7]=t[6],s[8]=t[7],s[9]=t[8],s[10]=t[9],s[11]=t[10],s[12]=t[11],s[13]=t[12],s[14]=t[13],s[15]=t[14],s[16]=t[15],s[17]=n.isClosed?1:0,s[18]=i[0],s[19]=i[1],s[20]=i[2],s[21]=i[3];for(let r=0;r<e.length;r++){const o=r*2+22,a=e[r];s[o]=a[0],s[o+1]=a[1]}return s},"toCompactBinary");var ste=ite;const dS=tn,rte=u((n,e)=>{const t=dS.multiply(dS.create(),n,e.transforms);return Object.assign({},e,{transforms:t})},"transform$3");var ote=rte;const ate=gt,lte=xD,cte=u(n=>{if(!lte(n))throw new Error("invalid path2 structure");if(n.points.length>1){for(let e=0;e<n.points.length;e++)if(ate.equals(n.points[e],n.points[(e+1)%n.points.length]))throw new Error(`path2 duplicate points ${n.points[e]}`)}if(n.points.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`path2 invalid point ${e}`)}),!n.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${n.transforms}`)},"validate");var ute=cte,Vn={appendArc:Eee,appendBezier:Uee,appendPoints:wD,clone:fw,close:_D,concat:bD,create:K0,equals:Gee,fromPoints:dw,fromCompactBinary:Yee,isA:xD,reverse:Qee,toPoints:dh,toString:nte,toCompactBinary:ste,transform:ote,validate:ute};const hte=Ct,fte=At,dte=Vn,pte=u(n=>{let e;for(const t of n){let i=0;if(hte.isA(t)&&(i=1),fte.isA(t)&&(i=2),dte.isA(t)&&(i=3),e&&i!==e)return!1;e=i}return!0},"areAllShapesTheSameType$4");var Qd=pte;const mte=u(n=>{let e=0;for(let t=0;t<n.length;t++){const i=(t+1)%n.length;e+=n[t][0]*n[i][1],e-=n[i][0]*n[t][1]}return e/2},"area$9");var Q0=mte;const gte=Q0,vte=u(n=>gte(n.vertices),"measureArea$1");var AD=vte;const yte=u(n=>((n===void 0||n.length<3)&&(n=[]),{vertices:n}),"create$b");var MD=yte;const _te=MD,bte=u(n=>{const e=n.vertices.slice().reverse();return _te(e)},"flip$1");var SD=bte;const wte=AD,xte=SD,Ate=u((n,e)=>{if(n.length===0)return 0;const t=e.vertices;return t.length<3?0:(wte(e)<0&&(e=xte(e)),n.reduce((s,r)=>s+Mte(r,t),0)===n.length?1:0)},"arePointsInside$1"),Mte=u((n,e)=>{const t=e.length,i=n[0],s=n[1];let r=e[t-1],o=e[0],a=r[1]>s,l=0,c=0;for(let h=t+1;--h;){const f=o[1]>s;if(a!==f){const d=r[0]>i,p=o[0]>i;(d&&p||o[0]-(o[1]-s)*(r[0]-o[0])/(r[1]-o[1])>=i)&&(l=!l)}a=f,r=o,o=e[++c]}return l},"isPointInside");var Ste=Ate,CD={arePointsInside:Ste,create:MD,flip:SD,measureArea:AD},Cte={geom2:Ct,geom3:At,path2:Vn,poly2:CD,poly3:Yt};const{EPS:Ete}=at,Tte=u((n,e)=>{let t=0;for(let i=0;i<e;i++)t+=n[1][i]-n[0][i];return Ete*t/e},"calculateEpsilonFromBounds$1");var Pte=Tte;const Rte=jt,kr=gt,Xh=pt,ED=Ct,TD=At,PD=Vn,pS=Yt,th=new WeakMap,Ite=u(n=>{let e=th.get(n);if(e)return e;const t=PD.toPoints(n);let i;t.length===0?i=kr.create():i=kr.clone(t[0]);let s=kr.clone(i);return t.forEach(r=>{kr.min(i,i,r),kr.max(s,s,r)}),i=[i[0],i[1],0],s=[s[0],s[1],0],e=[i,s],th.set(n,e),e},"measureBoundingBoxOfPath2"),Dte=u(n=>{let e=th.get(n);if(e)return e;const t=ED.toPoints(n);let i;t.length===0?i=kr.create():i=kr.clone(t[0]);let s=kr.clone(i);return t.forEach(r=>{kr.min(i,i,r),kr.max(s,s,r)}),i=[i[0],i[1],0],s=[s[0],s[1],0],e=[i,s],th.set(n,e),e},"measureBoundingBoxOfGeom2"),Lte=u(n=>{let e=th.get(n);if(e)return e;const t=TD.toPolygons(n);let i=Xh.create();if(t.length>0){const r=pS.toPoints(t[0]);Xh.copy(i,r[0])}let s=Xh.clone(i);return t.forEach(r=>{pS.toPoints(r).forEach(o=>{Xh.min(i,i,o),Xh.max(s,s,o)})}),i=[i[0],i[1],i[2]],s=[s[0],s[1],s[2]],e=[i,s],th.set(n,e),e},"measureBoundingBoxOfGeom3"),Ote=u((...n)=>{if(n=Rte(n),n.length===0)throw new Error("wrong number of arguments");const e=n.map(t=>PD.isA(t)?Ite(t):ED.isA(t)?Dte(t):TD.isA(t)?Lte(t):[[0,0,0],[0,0,0]]);return e.length===1?e[0]:e},"measureBoundingBox$4");var J0=Ote;const kte=jt,{geom2:Nte,geom3:Fte,path2:zte}=Cte,pw=Pte,mw=J0,Bte=u(n=>pw(mw(n),2),"measureEpsilonOfPath2"),Ute=u(n=>pw(mw(n),2),"measureEpsilonOfGeom2"),$te=u(n=>pw(mw(n),3),"measureEpsilonOfGeom3"),Vte=u((...n)=>{if(n=kte(n),n.length===0)throw new Error("wrong number of arguments");const e=n.map(t=>zte.isA(t)?Bte(t):Nte.isA(t)?Ute(t):Fte.isA(t)?$te(t):0);return e.length===1?e[0]:e},"measureEpsilon$5");var Jd=Vte;const mS=gt,Gte=Ct,Hte=u((n,e)=>{if(e.vertices.length<4)return null;const t=[],i=e.vertices.filter((o,a)=>o[2]>0?(t.push(a),!0):!1);if(i.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");const s=i.map(o=>{const a=Math.round(o[0]/n)*n+0,l=Math.round(o[1]/n)*n+0;return mS.fromValues(a,l)});if(mS.equals(s[0],s[1]))return null;const r=t[1]-t[0];if(r===1||r===3)r===1&&s.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return s},"fromFakePolygon"),Wte=u((n,e)=>{const t=e.map(i=>Hte(n,i)).filter(i=>i!==null);return Gte.create(t)},"fromFakePolygons$3");var gw=Wte;const sa=pt,jte=Ct,Xte=At,Yte=Yt,qte=u((n,e,t)=>{const i=[sa.fromVec2(sa.create(),t[0],n),sa.fromVec2(sa.create(),t[1],n),sa.fromVec2(sa.create(),t[1],e),sa.fromVec2(sa.create(),t[0],e)];return Yte.create(i)},"to3DWall"),Zte=u((n,e)=>{const i=jte.toSides(e).map(r=>qte(n.z0,n.z1,r));return Xte.create(i)},"to3DWalls$3");var vw=Zte;const{NEPS:Ev}=at,Kte=u((n,e)=>Math.abs(n[0]-e[0])<=Ev&&Math.abs(n[1]-e[1])<=Ev&&Math.abs(n[2]-e[2])<=Ev,"aboutEqualNormals$2");var yw=Kte;const Qte=u(()=>[0,1,0],"create$9");var _w=Qte;const Jte=_w,ene=u(n=>{const e=Jte();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},"clone$1");var tne=ene;const Tv=gt,nne=u(n=>{const e=Tv.normal(Tv.create(),n);return Tv.negate(e,e),e},"direction$2");var bw=nne;const gS=gt,ine=u(n=>gS.scale(gS.create(),n,n[2]),"origin$3");var e1=ine;const sne=gt,rne=bw,one=e1,ane=u((n,e)=>{const t=one(n),i=rne(n),s=(i[1]-t[1])/(i[0]-t[0]),r=t[1]-s*t[0],o=-1/s,l=(e[1]-o*e[0]-r)/(s-o),c=s*l+r;return sne.fromValues(l,c)},"closestPoint");var lne=ane;const cne=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n),"copy$2");var RD=cne;const une=gt,hne=u((n,e)=>{let t=une.dot(e,n);return t=Math.abs(t-n[2]),t},"distanceToPoint");var fne=hne;const dne=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],"equals$2");var pne=dne;const Yh=gt,mne=u((n,e,t)=>{const i=Yh.subtract(Yh.create(),t,e);Yh.normal(i,i),Yh.normalize(i,i);const s=Yh.dot(e,i);return n[0]=i[0],n[1]=i[1],n[2]=s,n},"fromPoints$2");var ID=mne;const gne=_w,vne=u((n,e,t)=>{const i=gne();return i[0]=n,i[1]=e,i[2]=t,i},"fromValues$1");var DD=vne;const yne=u((n,e,t)=>{let i=t-n[1],s=e[1]-n[1];s<0&&(i=-i,s=-s);let r;return i<=0?r=0:i>=s?r=1:s<1e-10?r=.5:r=i/s,n[0]+r*(e[0]-n[0])},"interpolateBetween2DPointsForY$1");var LD=yne;const _ne=u((n,e,t,i)=>{if(n[0]===e[0]&&n[1]===e[1]||t[0]===i[0]&&t[1]===i[1])return;const s=(i[1]-t[1])*(e[0]-n[0])-(i[0]-t[0])*(e[1]-n[1]);if(Math.abs(s)<Number.MIN_VALUE)return;const r=((i[0]-t[0])*(n[1]-t[1])-(i[1]-t[1])*(n[0]-t[0]))/s,o=((e[0]-n[0])*(n[1]-t[1])-(e[1]-n[1])*(n[0]-t[0]))/s;if(r<0||r>1||o<0||o>1)return;const a=n[0]+r*(e[0]-n[0]),l=n[1]+r*(e[1]-n[1]);return[a,l]},"intersect$5");var OD=_ne;const bne=u((n,e,t,i,s,r)=>{const o=n*i-e*t,a=1/o;let l=s*i-e*r,c=-s*t+n*r;return l*=a,c*=a,[l,c]},"solve2Linear$1");var wne=bne,ww={aboutEqualNormals:yw,area:Q0,cos:wi.cos,interpolateBetween2DPointsForY:LD,intersect:OD,sin:wi.sin,solve2Linear:wne};const xne=gt,{solve2Linear:Ane}=ww,Mne=u((n,e)=>{const t=Ane(n[0],n[1],e[0],e[1],n[2],e[2]);return xne.clone(t)},"intersectToLine");var Sne=Mne;const vS=gt,Cne=RD,Ene=DD,Tne=u((n,e)=>{const t=vS.negate(vS.create(),e),i=-e[2];return Cne(n,Ene(t[0],t[1],i))},"reverse$1");var Pne=Tne;const Rne=u(n=>`line2: (${n[0].toFixed(7)}, ${n[1].toFixed(7)}, ${n[2].toFixed(7)})`,"toString$1");var Ine=Rne;const yS=gt,Dne=ID,Lne=e1,One=bw,kne=u((n,e,t)=>{const i=Lne(e),s=One(e);return yS.transform(i,i,t),yS.transform(s,s,t),Dne(n,i,s)},"transform$2");var Nne=kne;const Fne=e1,zne=u((n,e)=>{let t=(n[2]-n[1]*e)/n[0];return Number.isNaN(t)&&(t=Fne(n)[0]),t},"xAtY");var Bne=zne,kD={clone:tne,closestPoint:lne,copy:RD,create:_w,direction:bw,distanceToPoint:fne,equals:pne,fromPoints:ID,fromValues:DD,intersectPointOfLines:Sne,origin:e1,reverse:Pne,toString:Ine,transform:Nne,xAtY:Bne};const _S=tn,Une=gt,Yn=pt,Jl=u(function(n,e){arguments.length<2&&(e=Yn.orthogonal(Yn.create(),n)),this.v=Yn.normalize(Yn.create(),Yn.cross(Yn.create(),n,e)),this.u=Yn.cross(Yn.create(),this.v,n),this.plane=n,this.planeorigin=Yn.scale(Yn.create(),n,n[3])},"OrthoNormalBasis$1");Jl.GetCartesian=function(n,e){const t=n+"/"+e;let i,s;if(t==="X/Y")i=[0,0,1],s=[1,0,0];else if(t==="Y/-X")i=[0,0,1],s=[0,1,0];else if(t==="-X/-Y")i=[0,0,1],s=[-1,0,0];else if(t==="-Y/X")i=[0,0,1],s=[0,-1,0];else if(t==="-X/Y")i=[0,0,-1],s=[-1,0,0];else if(t==="-Y/-X")i=[0,0,-1],s=[0,-1,0];else if(t==="X/-Y")i=[0,0,-1],s=[1,0,0];else if(t==="Y/X")i=[0,0,-1],s=[0,1,0];else if(t==="X/Z")i=[0,-1,0],s=[1,0,0];else if(t==="Z/-X")i=[0,-1,0],s=[0,0,1];else if(t==="-X/-Z")i=[0,-1,0],s=[-1,0,0];else if(t==="-Z/X")i=[0,-1,0],s=[0,0,-1];else if(t==="-X/Z")i=[0,1,0],s=[-1,0,0];else if(t==="-Z/-X")i=[0,1,0],s=[0,0,-1];else if(t==="X/-Z")i=[0,1,0],s=[1,0,0];else if(t==="Z/X")i=[0,1,0],s=[0,0,1];else if(t==="Y/Z")i=[1,0,0],s=[0,1,0];else if(t==="Z/-Y")i=[1,0,0],s=[0,0,1];else if(t==="-Y/-Z")i=[1,0,0],s=[0,-1,0];else if(t==="-Z/Y")i=[1,0,0],s=[0,0,-1];else if(t==="-Y/Z")i=[-1,0,0],s=[0,-1,0];else if(t==="-Z/-Y")i=[-1,0,0],s=[0,0,-1];else if(t==="Y/-Z")i=[-1,0,0],s=[0,1,0];else if(t==="Z/Y")i=[-1,0,0],s=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new Jl(new Plane(new Vector3D(i),0),new Vector3D(s))};Jl.Z0Plane=function(){const n=new Plane(new Vector3D([0,0,1]),0);return new Jl(n,new Vector3D([1,0,0]))};Jl.prototype={getProjectionMatrix:function(){return _S.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1)},getInverseProjectionMatrix:function(){const n=Yn.scale(Yn.create(),this.plane,this.plane[3]);return _S.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,n[0],n[1],n[2],1)},to2D:function(n){return Une.fromValues(Yn.dot(n,this.u),Yn.dot(n,this.v))},to3D:function(n){const e=Yn.scale(Yn.create(),this.u,n[0]),t=Yn.scale(Yn.create(),this.v,n[1]),i=Yn.add(e,e,this.planeorigin);return Yn.add(t,t,i)},line3Dto2D:function(n){const e=n.point,t=n.direction.plus(e),i=this.to2D(e),s=this.to2D(t);return Line2D.fromPoints(i,s)},line2Dto3D:function(n){const e=n.origin(),t=n.direction().plus(e),i=this.to3D(e),s=this.to3D(t);return Line3D.fromPoints(i,s)},transform:function(n){const e=this.plane.transform(n),t=this.u.transform(n),i=new Vector3D(0,0,0).transform(n),s=t.minus(i);return new Jl(e,s)}};var $ne=Jl;const Vne=u(n=>n*.017453292519943295,"degToRad");var Gne=Vne;const Hne=u((n,e)=>n-e,"fnNumberSort$2");var ND=Hne;const Wne=u((n,e,t)=>{let i=0,s=n.length;for(;s>i;){const r=Math.floor((i+s)/2),o=n[r];t(e,o)>0?i=r+1:s=r}n.splice(i,0,e)},"insertSorted$1");var jne=Wne;const{TAU:bS}=at,Xne=u((n,e,t)=>{const i=e>0?n*bS/e:0,s=t>0?bS/t:0;return Math.ceil(Math.max(i,s,4))},"radiusToSegments");var Yne=Xne;const qne=u(n=>n*57.29577951308232,"radToDeg");var Zne=qne,Kne={areAllShapesTheSameType:Qd,degToRad:Gne,flatten:jt,fnNumberSort:ND,insertSorted:jne,radiusToSegments:Yne,radToDeg:Zne};const{EPS:io}=at,ra=kD,nr=gt,Qne=$ne,Ec=LD,{insertSorted:Jne,fnNumberSort:eie}=Kne,wS=Yt,tie=u(n=>{if(n.length<2)return n;const e=[],t=n.length,i=wS.plane(n[0]),s=new Qne(i),r=[],o=[],a=new Map,l=new Map,c=new Map,h=10/io;for(let g=0;g<t;g++){const m=n[g];let v=[],y=m.vertices.length,b=-1;if(y>0){let _,x;for(let w=0;w<y;w++){let M=s.to2D(m.vertices[w]);const C=Math.floor(M[1]*h);let A;c.has(C)?A=c.get(C):c.has(C+1)?A=c.get(C+1):c.has(C-1)?A=c.get(C-1):(A=M[1],c.set(C,M[1])),M=nr.fromValues(M[0],A),v.push(M);const P=M[1];(w===0||P<_)&&(_=P,b=w),(w===0||P>x)&&(x=P);let D=l.get(P);D||(D={},l.set(P,D)),D[g]=!0}if(_>=x)v=[],y=0,b=-1;else{let w=a.get(_);w||(w=[],a.set(_,w)),w.push(g)}}v.reverse(),b=y-b-1,r.push(v),o.push(b)}const f=[];l.forEach((g,m)=>f.push(m)),f.sort(eie);let d=[],p=[];for(let g=0;g<f.length;g++){const m=[],v=f[g],y=l.get(v);for(let _=0;_<d.length;++_){const x=d[_],w=x.polygonindex;if(y[w]){const M=r[w],C=M.length;let A=x.leftvertexindex,P=x.rightvertexindex;for(;;){let k=A+1;if(k>=C&&(k=0),M[k][1]!==v)break;A=k}let D=P-1;if(D<0&&(D=C-1),M[D][1]===v&&(P=D),A!==x.leftvertexindex&&A===P)d.splice(_,1),--_;else{x.leftvertexindex=A,x.rightvertexindex=P,x.topleft=M[A],x.topright=M[P];let k=A+1;k>=C&&(k=0),x.bottomleft=M[k];let O=P-1;O<0&&(O=C-1),x.bottomright=M[O]}}}let b;if(g>=f.length-1)d=[],b=null;else{b=Number(f[g+1]);const _=.5*(v+b),x=a.get(v);for(const w in x){const M=x[w],C=r[M],A=C.length,P=o[M];let D=P;for(;;){let B=D+1;if(B>=A&&(B=0),C[B][1]!==v||B===P)break;D=B}let k=P;for(;;){let B=k-1;if(B<0&&(B=A-1),C[B][1]!==v||B===D)break;k=B}let O=D+1;O>=A&&(O=0);let N=k-1;N<0&&(N=A-1);const E={polygonindex:M,leftvertexindex:D,rightvertexindex:k,topleft:C[D],topright:C[k],bottomleft:C[O],bottomright:C[N]};Jne(d,E,(B,W)=>{const Z=Ec(B.topleft,B.bottomleft,_),ne=Ec(W.topleft,W.bottomleft,_);return Z>ne?1:Z<ne?-1:0})}}for(const _ in d){const x=d[_];let w=Ec(x.topleft,x.bottomleft,v);const M=nr.fromValues(w,v);w=Ec(x.topright,x.bottomright,v);const C=nr.fromValues(w,v);w=Ec(x.topleft,x.bottomleft,b);const A=nr.fromValues(w,b);w=Ec(x.topright,x.bottomright,b);const P=nr.fromValues(w,b),D={topleft:M,topright:C,bottomleft:A,bottomright:P,leftline:ra.fromPoints(ra.create(),M,A),rightline:ra.fromPoints(ra.create(),P,C)};if(m.length>0){const k=m[m.length-1],O=nr.distance(D.topleft,k.topright),N=nr.distance(D.bottomleft,k.bottomright);O<io&&N<io&&(D.topleft=k.topleft,D.leftline=k.leftline,D.bottomleft=k.bottomleft,m.splice(m.length-1,1))}m.push(D)}if(g>0){const _=new Set,x=new Set;for(let w=0;w<m.length;w++){const M=m[w];for(let C=0;C<p.length;C++)if(!x.has(C)){const A=p[C];if(nr.distance(A.bottomleft,M.topleft)<io&&nr.distance(A.bottomright,M.topright)<io){x.add(C);const P=ra.direction(M.leftline),D=ra.direction(A.leftline),k=P[0]-D[0],O=ra.direction(M.rightline),N=ra.direction(A.rightline),E=O[0]-N[0],B=Math.abs(k)<io,W=Math.abs(E)<io,Z=B||k>=0,ne=W||E>=0;Z&&ne&&(M.outpolygon=A.outpolygon,M.leftlinecontinues=B,M.rightlinecontinues=W,_.add(C));break}}}for(let w=0;w<p.length;w++)if(!_.has(w)){const M=p[w];M.outpolygon.rightpoints.push(M.bottomright),nr.distance(M.bottomright,M.bottomleft)>io&&M.outpolygon.leftpoints.push(M.bottomleft),M.outpolygon.leftpoints.reverse();const A=M.outpolygon.rightpoints.concat(M.outpolygon.leftpoints).map(D=>s.to3D(D)),P=wS.fromPointsAndPlane(A,i);P.vertices.length&&e.push(P)}}for(let _=0;_<m.length;_++){const x=m[_];x.outpolygon?(x.leftlinecontinues||x.outpolygon.leftpoints.push(x.topleft),x.rightlinecontinues||x.outpolygon.rightpoints.push(x.topright)):(x.outpolygon={leftpoints:[],rightpoints:[]},x.outpolygon.leftpoints.push(x.topleft),nr.distance(x.topleft,x.topright)>io&&x.outpolygon.rightpoints.push(x.topright))}p=m}return e},"reTesselateCoplanarPolygons$1");var nie=tie;const xS=At,AS=Yt,iie=yw,sie=nie,rie=u((n,e)=>Math.abs(n[3]-e[3])<15e-8?iie(n,e):!1,"coplanar"),oie=u(n=>{if(n.isRetesselated)return n;const e=xS.toPolygons(n),t=[];e.forEach(r=>{const o=t.find(a=>rie(a[0],AS.plane(r)));o?o[1].push(r):t.push([AS.plane(r),[r]])});let i=[];t.forEach(r=>{const o=r[1],a=sie(o);i=i.concat(a)});const s=xS.create(i);return s.isRetesselated=!0,s},"retessellate$4");var t1=oie;const{EPS:Tc}=at,MS=J0,aie=u((n,e)=>{if(n.polygons.length===0||e.polygons.length===0)return!1;const t=MS(n),i=t[0],s=t[1],r=MS(e),o=r[0],a=r[1];return!(o[0]-s[0]>Tc||i[0]-a[0]>Tc||o[1]-s[1]>Tc||i[1]-a[1]>Tc||o[2]-s[2]>Tc||i[2]-a[2]>Tc)},"mayOverlap$3");var xw=aie;const SS=Vo,lie=Yt;class Od{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=e}invert(){const e=[this];let t;for(let i=0;i<e.length;i++){t=e[i],t.plane&&(t.plane=SS.flip(SS.create(),t.plane)),t.front&&e.push(t.front),t.back&&e.push(t.back);const s=t.front;t.front=t.back,t.back=s}}clipPolygons(e,t){let i={node:this,polygontreenodes:e},s;const r=[];do{if(s=i.node,e=i.polygontreenodes,s.plane){const o=s.plane,a=[],l=[],c=t?a:l,h=e.length;for(let d=0;d<h;d++){const p=e[d];p.isRemoved()||p.splitByPlane(o,c,a,l,a)}s.front&&l.length>0&&r.push({node:s.front,polygontreenodes:l});const f=a.length;if(s.back&&f>0)r.push({node:s.back,polygontreenodes:a});else for(let d=0;d<f;d++)a[d].remove()}i=r.pop()}while(i!==void 0)}clipTo(e,t){let i=this;const s=[];do i.polygontreenodes.length>0&&e.rootnode.clipPolygons(i.polygontreenodes,t),i.front&&s.push(i.front),i.back&&s.push(i.back),i=s.pop();while(i!==void 0)}addPolygonTreeNodes(e){let t={node:this,polygontreenodes:e};const i=[];do{const s=t.node,r=t.polygontreenodes;if(r.length===0){t=i.pop();continue}if(!s.plane){let c=0;c=Math.floor(r.length/2);const h=r[c].getPolygon();s.plane=lie.plane(h)}const o=[],a=[],l=r.length;for(let c=0;c<l;++c)r[c].splitByPlane(s.plane,s.polygontreenodes,a,o,a);o.length>0&&(s.front||(s.front=new Od(s)),l===o.length&&a.length===0?s.front.polygontreenodes=o:i.push({node:s.front,polygontreenodes:o})),a.length>0&&(s.back||(s.back=new Od(s)),l===a.length&&o.length===0?s.back.polygontreenodes=a:i.push({node:s.back,polygontreenodes:a})),t=i.pop()}while(t!==void 0)}}u(Od,"Node$3");var cie=Od;const Pc=pt,uie=u((n,e,t)=>{const i=Pc.subtract(Pc.create(),t,e);let s=(n[3]-Pc.dot(n,e))/Pc.dot(n,i);return Number.isNaN(s)&&(s=0),s>1&&(s=1),s<0&&(s=0),Pc.scale(i,i,s),Pc.add(i,e,i),i},"splitLineSegmentByPlane$1");var hie=uie;const{EPS:im}=at,fie=Vo,sm=pt,Pv=Yt,die=hie,pie=u((n,e)=>{const t={type:null,front:null,back:null},i=e.vertices,s=i.length,r=Pv.plane(e);if(fie.equals(r,n))t.type=0;else{let o=!1,a=!1;const l=[],c=-im;for(let h=0;h<s;h++){const f=sm.dot(n,i[h])-n[3],d=f<c;l.push(d),f>im&&(o=!0),f<c&&(a=!0)}if(!o&&!a){const h=sm.dot(n,r);t.type=h>=0?0:1}else if(!a)t.type=2;else if(!o)t.type=3;else{t.type=4;const h=[],f=[];let d=l[0];for(let g=0;g<s;g++){const m=i[g];let v=g+1;v>=s&&(v=0);const y=l[v];if(d===y)d?f.push(m):h.push(m);else{const b=i[v],_=die(n,m,b);d?(f.push(m),f.push(_),h.push(_)):(h.push(m),h.push(_),f.push(_))}d=y}const p=im*im;if(f.length>=3){let g=f[f.length-1];for(let m=0;m<f.length;m++){const v=f[m];sm.squaredDistance(v,g)<p&&(f.splice(m,1),m--),g=v}}if(h.length>=3){let g=h[h.length-1];for(let m=0;m<h.length;m++){const v=h[m];sm.squaredDistance(v,g)<p&&(h.splice(m,1),m--),g=v}}h.length>=3&&(t.front=Pv.fromPointsAndPlane(h,r)),f.length>=3&&(t.back=Pv.fromPointsAndPlane(f,r))}}return t},"splitPolygonByPlane$1");var mie=pie;const{EPS:gie}=at,vie=pt,CS=Yt,yie=mie;class n1{constructor(e,t){this.parent=e,this.children=[],this.polygon=t,this.removed=!1}addPolygons(e){if(!this.isRootNode())throw new Error("Assertion failed");const t=this;e.forEach(i=>{t.addChild(i)})}remove(){if(!this.removed){this.removed=!0,this.polygon=null;const e=this.parent.children,t=e.indexOf(this);if(t<0)throw new Error("Assertion failed");e.splice(t,1),this.parent.recursivelyInvalidatePolygon()}}isRemoved(){return this.removed}isRootNode(){return!this.parent}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon}getPolygons(e){let t=[this];const i=[t];let s,r,o,a;for(s=0;s<i.length;++s)for(t=i[s],r=0,o=t.length;r<o;r++)a=t[r],a.polygon?e.push(a.polygon):a.children.length>0&&i.push(a.children)}splitByPlane(e,t,i,s,r){if(this.children.length){const o=[this.children];let a,l,c,h,f;for(a=0;a<o.length;a++)for(f=o[a],l=0,c=f.length;l<c;l++)h=f[l],h.children.length>0?o.push(h.children):h._splitByPlane(e,t,i,s,r)}else this._splitByPlane(e,t,i,s,r)}_splitByPlane(e,t,i,s,r){const o=this.polygon;if(o){const a=CS.measureBoundingSphere(o),l=a[3]+gie,c=a,h=vie.dot(e,c)-e[3];if(h>l)s.push(this);else if(h<-l)r.push(this);else{const f=yie(e,o);switch(f.type){case 0:t.push(this);break;case 1:i.push(this);break;case 2:s.push(this);break;case 3:r.push(this);break;case 4:if(f.front){const d=this.addChild(f.front);s.push(d)}if(f.back){const d=this.addChild(f.back);r.push(d)}break}}}}addChild(e){const t=new n1(this,e);return this.children.push(t),t}invertSub(){let e=[this];const t=[e];let i,s,r,o;for(i=0;i<t.length;i++)for(e=t[i],s=0,r=e.length;s<r;s++)o=e[s],o.polygon&&(o.polygon=CS.invert(o.polygon)),o.children.length>0&&t.push(o.children)}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon()}clear(){let e=[this];const t=[e];for(let i=0;i<t.length;++i){e=t[i];const s=e.length;for(let r=0;r<s;r++){const o=e[r];o.polygon&&(o.polygon=null),o.parent&&(o.parent=null),o.children.length>0&&t.push(o.children),o.children=[]}}}toString(){let e="",t=[this];const i=[t];let s,r,o,a;for(s=0;s<i.length;++s){t=i[s];const l=" ".repeat(s);for(r=0,o=t.length;r<o;r++)a=t[r],e+=`${l}PolygonTreeNode (${a.isRootNode()}): ${a.children.length}`,a.polygon?e+=`
 ${l}polygon: ${a.polygon.vertices}
`:e+=`
`,a.children.length>0&&i.push(a.children)}return e}}u(n1,"PolygonTreeNode$1");var _ie=n1;const bie=cie,wie=_ie;class FD{constructor(e){this.polygonTree=new wie,this.rootnode=new bie(null),e&&this.addPolygons(e)}invert(){this.polygonTree.invert(),this.rootnode.invert()}clipTo(e,t=!1){this.rootnode.clipTo(e,t)}allPolygons(){const e=[];return this.polygonTree.getPolygons(e),e}addPolygons(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=this.polygonTree.addChild(e[i]);this.rootnode.addPolygonTreeNodes(t)}clear(){this.polygonTree.clear()}toString(){return"Tree: "+this.polygonTree.toString("")}}u(FD,"Tree$3");var xie=FD,Aw={Tree:xie};const rm=At,Aie=xw,{Tree:ES}=Aw,Mie=u((n,e)=>{if(!Aie(n,e))return rm.create();const t=new ES(rm.toPolygons(n)),i=new ES(rm.toPolygons(e));t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.addPolygons(i.allPolygons()),t.invert();const s=t.allPolygons();return rm.create(s)},"intersectGeom3Sub");var Sie=Mie;const Cie=jt,Eie=t1,Tie=Sie,Pie=u((...n)=>{n=Cie(n);let e=n.shift();return n.forEach(t=>{e=Tie(e,t)}),e=Eie(e),e},"intersect$4");var zD=Pie;const Rie=jt,Iie=At,Die=Jd,Lie=gw,Oie=vw,kie=zD,Nie=u((...n)=>{n=Rie(n);const e=n.map(s=>Oie({z0:-1,z1:1},s)),t=kie(e),i=Die(t);return Lie(i,Iie.toPolygons(t))},"intersect$3");var Fie=Nie;const zie=jt,Bie=Qd,Uie=Ct,$ie=At,Vie=Fie,Gie=zD,Hie=u((...n)=>{if(n=zie(n),n.length===0)throw new Error("wrong number of arguments");if(!Bie(n))throw new Error("only intersect of the types are supported");const e=n[0];return Uie.isA(e)?Vie(n):$ie.isA(e)?Gie(n):e},"intersect$2");var Wie=Hie;const Rv=pt,jie=Jd,TS=At,Xie=u(n=>n.sort((e,t)=>e-t).filter((e,t,i)=>!t||e!==i[t-1]),"sortNb"),Yie=u((n,e,t)=>{const i=`${e}`,s=n.get(i);s===void 0?n.set(i,[t]):s.push(t)},"insertMapping"),qie=u((n,e)=>{const t=`${e}`;return n.get(t)},"findMapping"),Zie=u(n=>{const e=jie(n),t=TS.toPolygons(n),i=t.length,s=new Map,r=Rv.create();t.forEach((h,f)=>{h.vertices.forEach(d=>{Yie(s,Rv.snap(r,d,e),f)})});const o=t.map(h=>{let f=[];return h.vertices.forEach(d=>{f=f.concat(qie(s,Rv.snap(r,d,e)))}),{e:1,d:Xie(f)}});s.clear();let a=0;const l=o.length;for(let h=0;h<l;h++){const f=o[h];if(f.e>0){const d=new Array(i);d[h]=!0;do a=0,d.forEach((p,g)=>{const m=o[g];if(m.e>0){m.e=-1;for(let v=0;v<m.d.length;v++)d[m.d[v]]=!0;a++}});while(a>0);f.indexes=d}}const c=[];for(let h=0;h<l;h++)if(o[h].indexes){const f=[];o[h].indexes.forEach((d,p)=>f.push(t[p])),c.push(TS.create(f))}return c},"scissionGeom3$1");var Kie=Zie;const Qie=jt,Jie=At,ese=Kie,tse=u((...n)=>{if(n=Qie(n),n.length===0)throw new Error("wrong number of arguments");const e=n.map(t=>Jie.isA(t)?ese(t):t);return e.length===1?e[0]:e},"scission");var nse=tse;const om=At,ise=xw,{Tree:PS}=Aw,sse=u((n,e)=>{if(!ise(n,e))return om.clone(n);const t=new PS(om.toPolygons(n)),i=new PS(om.toPolygons(e));t.invert(),t.clipTo(i),i.clipTo(t,!0),t.addPolygons(i.allPolygons()),t.invert();const s=t.allPolygons();return om.create(s)},"subtractGeom3Sub");var rse=sse;const ose=jt,ase=t1,lse=rse,cse=u((...n)=>{n=ose(n);let e=n.shift();return n.forEach(t=>{e=lse(e,t)}),e=ase(e),e},"subtract$6");var BD=cse;const use=jt,hse=At,fse=Jd,dse=gw,pse=vw,mse=BD,gse=u((...n)=>{n=use(n);const e=n.map(s=>pse({z0:-1,z1:1},s)),t=mse(e),i=fse(t);return dse(i,hse.toPolygons(t))},"subtract$5");var vse=gse;const yse=jt,_se=Qd,bse=Ct,wse=At,xse=vse,Ase=BD,Mse=u((...n)=>{if(n=yse(n),n.length===0)throw new Error("wrong number of arguments");if(!_se(n))throw new Error("only subtract of the types are supported");const e=n[0];return bse.isA(e)?xse(n):wse.isA(e)?Ase(n):e},"subtract$4");var Sse=Mse;const wu=At,Cse=xw,{Tree:RS}=Aw,Ese=u((n,e)=>{if(!Cse(n,e))return Tse(n,e);const t=new RS(wu.toPolygons(n)),i=new RS(wu.toPolygons(e));t.clipTo(i,!1),i.clipTo(t),i.invert(),i.clipTo(t),i.invert();const s=t.allPolygons().concat(i.allPolygons());return wu.create(s)},"unionSub$1"),Tse=u((n,e)=>{let t=wu.toPolygons(n);return t=t.concat(wu.toPolygons(e)),wu.create(t)},"unionForNonIntersecting");var UD=Ese;const Pse=jt,Rse=t1,Ise=UD,Dse=u((...n)=>{n=Pse(n);let e;for(e=1;e<n.length;e+=2)n.push(Ise(n[e-1],n[e]));let t=n[e-1];return t=Rse(t),t},"union$4");var $D=Dse;const Lse=jt,Ose=At,kse=Jd,Nse=gw,Fse=vw,zse=$D,Bse=u((...n)=>{n=Lse(n);const e=n.map(s=>Fse({z0:-1,z1:1},s)),t=zse(e),i=kse(t);return Nse(i,Ose.toPolygons(t))},"union$3");var VD=Bse;const Use=jt,$se=Qd,Vse=Ct,Gse=At,Hse=VD,Wse=$D,jse=u((...n)=>{if(n=Use(n),n.length===0)throw new Error("wrong number of arguments");if(!$se(n))throw new Error("only unions of the same type are supported");const e=n[0];return Vse.isA(e)?Hse(n):Gse.isA(e)?Wse(n):e},"union$2");var Mw=jse,ir={intersect:Wie,scission:nse,subtract:Sse,union:Mw};const IS=Vo,il=pt,Xse=u(n=>{const e=n.edges;if(e.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");const t=e.reduce((o,a)=>il.add(il.create(),o,a[0]),il.create());il.scale(t,t,1/e.length);let i,s=0;e.forEach(o=>{if(!il.equals(o[0],o[1])){const a=il.squaredDistance(t,o[0]);a>s&&(i=o,s=a)}});const r=e.find(o=>il.equals(o[1],i[0]));return IS.fromPoints(IS.create(),r[0],i[0],i[1])},"calculatePlane$1");var GD=Xse;const Yse=u(n=>(n||(n=[]),{edges:n}),"create$6");var ac=Yse;const qse=ac,DS=pt,Zse=u((...n)=>{let e,t;return n.length===1?(e=qse(),t=n[0]):(e=n[0],t=n[1]),e.edges=t.edges.map(i=>[DS.clone(i[0]),DS.clone(i[1])]),e},"clone");var Kse=Zse;const Qse=pt,Jse=u((n,e)=>{const t=n.edges,i=e.edges;return t.length!==i.length?!1:t.reduce((r,o,a)=>{const l=i[a],c=Qse.squaredDistance(o[0],l[0]);return r&&c<Number.EPSILON},!0)},"equals$1");var ere=Jse;const am=pt,tre=ac,nre=u(n=>{if(!Array.isArray(n))throw new Error("the given points must be an array");if(n.length<3)throw new Error("the given points must contain THREE or more points");const e=[];let t=n[n.length-1];return n.forEach(i=>{i.length===2&&e.push([am.fromVec2(am.create(),t),am.fromVec2(am.create(),i)]),i.length===3&&e.push([t,i]),t=i}),tre(e)},"fromPoints");var ire=nre;const lm=pt,sre=ac,rre=u(n=>{if(!Array.isArray(n))throw new Error("the given sides must be an array");const e=[];return n.forEach(t=>{e.push([lm.fromVec2(lm.create(),t[0]),lm.fromVec2(lm.create(),t[1])])}),sre(e)},"fromSides");var ore=rre;const are=u(n=>!!(n&&typeof n=="object"&&"edges"in n&&Array.isArray(n.edges)),"isA");var lre=are;const cre=ac,ure=u((...n)=>{let e,t;return n.length===1?(e=cre(),t=n[0]):(e=n[0],t=n[1]),e.edges=t.edges.map(i=>[i[1],i[0]]),e},"reverse");var hre=ure;const fre=u(n=>n.edges,"toEdges");var dre=fre;const pre=u((n,e)=>{let t,i,s,r,o,a=1;do{i=n,n=null;let l=null;for(o=0;i;){o++,s=i;let c=0;for(t=0;t<a&&(c++,s=s.nextZ,!!s);t++);let h=a;for(;c>0||h>0&&s;)c!==0&&(h===0||!s||e(i)<=e(s))?(r=i,i=i.nextZ,c--):(r=s,s=s.nextZ,h--),l?l.nextZ=r:n=r,r.prevZ=l,l=r;i=s}l.nextZ=null,a*=2}while(o>1);return n},"sortLinked$2");var mre=pre;const gre=mre;class Sw{constructor(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}u(Sw,"Node$1");const vre=u((n,e,t,i)=>{const s=new Sw(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s},"insertNode$1"),yre=u(n=>{n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)},"removeNode$2");var HD={Node:Sw,insertNode:vre,removeNode:yre,sortLinked:gre};const _re=u((n,e,t,i,s,r,o,a)=>(s-o)*(e-a)-(n-o)*(r-a)>=0&&(n-o)*(i-a)-(t-o)*(e-a)>=0&&(t-o)*(r-a)-(s-o)*(i-a)>=0,"pointInTriangle$2"),bre=u((n,e,t)=>(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),"area$7");var Cw={area:bre,pointInTriangle:_re};const{Node:LS,insertNode:OS,removeNode:jg}=HD,{area:ls}=Cw,wre=u((n,e,t,i,s)=>{let r;if(s===Ere(n,e,t,i)>0)for(let o=e;o<t;o+=i)r=OS(o,n[o],n[o+1],r);else for(let o=t-i;o>=e;o-=i)r=OS(o,n[o],n[o+1],r);return r&&i1(r,r.next)&&(jg(r),r=r.next),r},"linkedPolygon$2"),WD=u((n,e)=>{if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(i1(t,t.next)||ls(t.prev,t,t.next)===0)){if(jg(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e},"filterPoints$2"),xre=u((n,e,t)=>{let i=n;do{const s=i.prev,r=i.next.next;!i1(s,r)&&jD(s,i,i.next,r)&&kd(s,r)&&kd(r,s)&&(e.push(s.i/t),e.push(i.i/t),e.push(r.i/t),jg(i),jg(i.next),i=n=r),i=i.next}while(i!==n);return WD(i)},"cureLocalIntersections$1"),Are=u((n,e)=>{let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&jD(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1},"intersectsPolygon"),kd=u((n,e)=>ls(n.prev,n,n.next)<0?ls(n,e,n.next)>=0&&ls(n,n.prev,e)>=0:ls(n,e,n.prev)<0||ls(n,n.next,e)<0,"locallyInside$1"),Mre=u((n,e)=>{let t=n,i=!1;const s=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&s<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i},"middleInside"),Sre=u((n,e)=>{const t=new LS(n.i,n.x,n.y),i=new LS(e.i,e.x,e.y),s=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i},"splitPolygon$2"),Cre=u((n,e)=>n.next.i!==e.i&&n.prev.i!==e.i&&!Are(n,e)&&(kd(n,e)&&kd(e,n)&&Mre(n,e)&&(ls(n.prev,n,e.prev)||ls(n,e.prev,e))||i1(n,e)&&ls(n.prev,n,n.next)>0&&ls(e.prev,e,e.next)>0),"isValidDiagonal$1"),jD=u((n,e,t,i)=>{const s=Math.sign(ls(n,e,t)),r=Math.sign(ls(n,e,i)),o=Math.sign(ls(t,i,n)),a=Math.sign(ls(t,i,e));return!!(s!==r&&o!==a||s===0&&cm(n,t,e)||r===0&&cm(n,i,e)||o===0&&cm(t,n,i)||a===0&&cm(t,e,i))},"intersects"),cm=u((n,e,t)=>e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y),"onSegment"),Ere=u((n,e,t,i)=>{let s=0;for(let r=e,o=t-i;r<t;r+=i)s+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return s},"signedArea"),i1=u((n,e)=>n.x===e.x&&n.y===e.y,"equals");var XD={cureLocalIntersections:xre,filterPoints:WD,isValidDiagonal:Cre,linkedPolygon:wre,locallyInside:kd,splitPolygon:Sre};const{filterPoints:x_,linkedPolygon:Tre,locallyInside:Pre,splitPolygon:Rre}=XD,{area:kS,pointInTriangle:Ire}=Cw,Dre=u((n,e,t,i)=>{const s=[];for(let r=0,o=e.length;r<o;r++){const a=e[r]*i,l=r<o-1?e[r+1]*i:n.length,c=Tre(n,a,l,i,!1);c===c.next&&(c.steiner=!0),s.push(Nre(c))}s.sort((r,o)=>r.x-o.x);for(let r=0;r<s.length;r++)t=Lre(s[r],t),t=x_(t,t.next);return t},"eliminateHoles$1"),Lre=u((n,e)=>{const t=Ore(n,e);if(!t)return e;const i=Rre(t,n),s=x_(t,t.next);return x_(i,i.next),e===t?s:e},"eliminateHole"),Ore=u((n,e)=>{let t=e;const i=n.x,s=n.y;let r=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const f=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=i&&f>r){if(r=f,f===i){if(s===t.y)return t;if(s===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(i===r)return o;const a=o,l=o.x,c=o.y;let h=1/0;t=o;do{if(i>=t.x&&t.x>=l&&i!==t.x&&Ire(s<c?i:r,s,l,c,s<c?r:i,s,t.x,t.y)){const f=Math.abs(s-t.y)/(i-t.x);Pre(t,n)&&(f<h||f===h&&(t.x>o.x||t.x===o.x&&kre(o,t)))&&(o=t,h=f)}t=t.next}while(t!==a);return o},"findHoleBridge"),kre=u((n,e)=>kS(n.prev,n,e.prev)<0&&kS(e.next,n,n.next)<0,"sectorContainsSector"),Nre=u(n=>{let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t},"getLeftmost");var Fre=Dre;const zre=Fre,{removeNode:Bre,sortLinked:Ure}=HD,{cureLocalIntersections:$re,filterPoints:Xg,isValidDiagonal:Vre,linkedPolygon:Gre,splitPolygon:Hre}=XD,{area:Pl,pointInTriangle:Vf}=Cw,Wre=u((n,e,t=2)=>{const i=e&&e.length,s=i?e[0]*t:n.length;let r=Gre(n,0,s,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,f;if(i&&(r=zre(n,e,r,t)),n.length>80*t){a=c=n[0],l=h=n[1];for(let d=t;d<s;d+=t){const p=n[d],g=n[d+1];p<a&&(a=p),g<l&&(l=g),p>c&&(c=p),g>h&&(h=g)}f=Math.max(c-a,h-l),f=f!==0?1/f:0}return Nd(r,o,t,a,l,f),o},"triangulate"),Nd=u((n,e,t,i,s,r,o)=>{if(!n)return;!o&&r&&qre(n,i,s,r);let a=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,r?Xre(n,i,s,r):jre(n)){e.push(l.i/t),e.push(n.i/t),e.push(c.i/t),Bre(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=$re(Xg(n),e,t),Nd(n,e,t,i,s,r,2)):o===2&&Yre(n,e,t,i,s,r):Nd(Xg(n),e,t,i,s,r,1);break}}},"earcutLinked"),jre=u(n=>{const e=n.prev,t=n,i=n.next;if(Pl(e,t,i)>=0)return!1;let s=n.next.next;for(;s!==n.prev;){if(Vf(e.x,e.y,t.x,t.y,i.x,i.y,s.x,s.y)&&Pl(s.prev,s,s.next)>=0)return!1;s=s.next}return!0},"isEar"),Xre=u((n,e,t,i)=>{const s=n.prev,r=n,o=n.next;if(Pl(s,r,o)>=0)return!1;const a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,l=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,c=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,h=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,f=A_(a,l,e,t,i),d=A_(c,h,e,t,i);let p=n.prevZ,g=n.nextZ;for(;p&&p.z>=f&&g&&g.z<=d;){if(p!==n.prev&&p!==n.next&&Vf(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Pl(p.prev,p,p.next)>=0||(p=p.prevZ,g!==n.prev&&g!==n.next&&Vf(s.x,s.y,r.x,r.y,o.x,o.y,g.x,g.y)&&Pl(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;p&&p.z>=f;){if(p!==n.prev&&p!==n.next&&Vf(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Pl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=d;){if(g!==n.prev&&g!==n.next&&Vf(s.x,s.y,r.x,r.y,o.x,o.y,g.x,g.y)&&Pl(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0},"isEarHashed"),Yre=u((n,e,t,i,s,r)=>{let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Vre(o,a)){let l=Hre(o,a);o=Xg(o,o.next),l=Xg(l,l.next),Nd(o,e,t,i,s,r),Nd(l,e,t,i,s,r);return}a=a.next}o=o.next}while(o!==n)},"splitEarcut"),qre=u((n,e,t,i)=>{let s=n;do s.z===null&&(s.z=A_(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,Ure(s,r=>r.z)},"indexCurve"),A_=u((n,e,t,i,s)=>(n=32767*(n-t)*s,e=32767*(e-i)*s,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1),"zOrder");var Zre=Wre;const{area:Kre}=ww,{toOutlines:Qre}=Ct,{arePointsInside:Jre}=CD,eoe=u(n=>{const e=Qre(n),t=[],i=[];e.forEach((o,a)=>{const l=Kre(o);l<0?i.push(a):l>0&&t.push(a)});const s=[],r=[];return t.forEach((o,a)=>{const l=e[o];s[a]=[],i.forEach((c,h)=>{const f=e[c];Jre([f[0]],{vertices:l})&&(s[a].push(c),r[h]||(r[h]=[]),r[h].push(a))})}),i.forEach((o,a)=>{if(r[a]&&r[a].length>1){const l=toe(r[a],c=>s[c].length);r[a].forEach((c,h)=>{h!==l&&(s[c]=s[c].filter(f=>f!==o))})}}),s.map((o,a)=>({solid:e[t[a]],holes:o.map(l=>e[l])}))},"assignHoles$1"),toe=u((n,e)=>{let t,i;return n.forEach((s,r)=>{const o=e(s);(i===void 0||o<i)&&(t=r,i=o)}),t},"minIndex");var noe=eoe;const ioe=Ct,NS=Vo,soe=gt,mi=pt,roe=GD,ooe=noe;class YD{constructor(e){this.plane=roe(e);const t=mi.orthogonal(mi.create(),this.plane),i=mi.cross(mi.create(),this.plane,t);this.v=mi.normalize(i,i),this.u=mi.cross(mi.create(),this.v,this.plane),this.basisMap=new Map;const s=e.edges.map(o=>o.map(a=>this.to2D(a))),r=ioe.create(s);this.roots=ooe(r)}to2D(e){const t=soe.fromValues(mi.dot(e,this.u),mi.dot(e,this.v));return this.basisMap.set(t,e),t}to3D(e){const t=this.basisMap.get(e);if(t)return t;{console.log("Warning: point not in original slice");const i=mi.scale(mi.create(),this.u,e[0]),s=mi.scale(mi.create(),this.v,e[1]),r=mi.scale(mi.create(),NS,NS[3]),o=mi.add(i,i,r);return mi.add(s,s,o)}}}u(YD,"PolygonHierarchy$1");var aoe=YD;const loe=Yt,coe=Zre,uoe=aoe,hoe=u(n=>{const e=new uoe(n),t=[];return e.roots.forEach(({solid:i,holes:s})=>{let r=i.length;const o=[];s.forEach((f,d)=>{o.push(r),r+=f.length});const a=[i,...s].flat(),l=a.flat(),c=u(f=>e.to3D(a[f]),"getVertex"),h=coe(l,o);for(let f=0;f<h.length;f+=3){const d=h.slice(f,f+3).map(c);t.push(loe.fromPointsAndPlane(d,e.plane))}}),t},"toPolygons");var foe=hoe;const FS=pt,doe=u(n=>n.reduce((e,t)=>e+=`[${FS.toString(t[0])}, ${FS.toString(t[1])}], `,""),"edgesToString"),poe=u(n=>`[${doe(n.edges)}]`,"toString");var moe=poe;const um=pt,goe=ac,voe=u((n,e)=>{const t=e.edges.map(i=>[um.transform(um.create(),i[0],n),um.transform(um.create(),i[1],n)]);return goe(t)},"transform$1");var yoe=voe,ph={calculatePlane:GD,clone:Kse,create:ac,equals:ere,fromPoints:ire,fromSides:ore,isA:lre,reverse:hre,toEdges:dre,toPolygons:foe,toString:moe,transform:yoe};const zS=pt,_oe=ac,boe=u(n=>{if(!n.edges)return n;let e=n.edges;const t=new Map,i=new Map;e=e.filter(o=>!zS.equals(o[0],o[1])),e.forEach(o=>{const a=o[0].toString(),l=o[1].toString();t.set(a,o[0]),t.set(l,o[1]),i.set(a,(i.get(a)||0)+1),i.set(l,(i.get(l)||0)-1)});const s=[],r=[];return i.forEach((o,a)=>{o<0&&s.push(a),o>0&&r.push(a)}),s.forEach(o=>{const a=t.get(o);let l=1/0,c;r.forEach(h=>{const f=t.get(h),d=zS.distance(a,f);d<l&&(l=d,c=f)}),console.warn(`slice.repair: repairing vertex gap ${a} to ${c} distance ${l}`),e=e.map(h=>h[0].toString()===o?[c,h[1]]:h[1].toString()===o?[h[0],c]:h)}),_oe(e)},"repair");var woe=boe;const{EPS:BS}=at,Rc=pt,hm=Yt,US=ph,M_=u((n,e)=>n===e?n:n<e?M_(e,n):e===1?1:e===0?n:M_(e,n%e),"gcd"),xoe=u((n,e)=>n*e/M_(n,e),"lcm"),$S=u((n,e)=>{const t=n/e.length;if(t===1)return e;const i=Rc.fromValues(t,t,t),s=[];return e.forEach(r=>{const o=Rc.subtract(Rc.create(),r[1],r[0]);Rc.divide(o,o,i);let a=r[0];for(let l=1;l<=t;++l){const c=Rc.add(Rc.create(),a,o);s.push([a,c]),a=c}}),s},"repartitionEdges"),VS=BS*BS/2*Math.sin(Math.PI/3),Aoe=u((n,e)=>{let t=US.toEdges(n),i=US.toEdges(e);if(t.length!==i.length){const r=xoe(t.length,i.length);r!==t.length&&(t=$S(r,t)),r!==i.length&&(i=$S(r,i))}const s=[];return t.forEach((r,o)=>{const a=i[o],l=hm.create([r[0],r[1],a[1]]),c=hm.measureArea(l);Number.isFinite(c)&&c>VS&&s.push(l);const h=hm.create([r[0],a[1],a[0]]),f=hm.measureArea(h);Number.isFinite(f)&&f>VS&&s.push(h)}),s},"extrudeWalls$1");var Moe=Aoe;const GS=tn,HS=Ct,Soe=At,S_=Yt,Aa=ph,Coe=woe,WS=Moe,Eoe=u((n,e,t)=>{let i=null;return HS.isA(t)&&(i=Aa.fromSides(HS.toSides(t))),S_.isA(t)&&(i=Aa.fromPoints(S_.toPoints(t))),n===0||n===1?Aa.transform(GS.fromTranslation(GS.create(),[0,0,n]),i):null},"defaultCallback"),Toe=u((n,e)=>{const t={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:Eoe},{numberOfSlices:i,capStart:s,capEnd:r,close:o,repair:a,callback:l}=Object.assign({},t,n);if(i<2)throw new Error("numberOfSlices must be 2 or more");a&&(e=Coe(e));const c=i-1;let h=null,f=null,d=null,p=[];for(let g=0;g<i;g++){const m=l(g/c,g,e);if(m){if(!Aa.isA(m))throw new Error("the callback function must return slice objects");if(Aa.toEdges(m).length===0)throw new Error("the callback function must return slices with one or more edges");d&&(p=p.concat(WS(d,m))),g===0&&(h=m),g===i-1&&(f=m),d=m}}if(r){const g=Aa.toPolygons(f);p=p.concat(g)}if(s){const g=Aa.toPolygons(h).map(S_.invert);p=p.concat(g)}return!s&&!r&&o&&!Aa.equals(f,h)&&(p=p.concat(WS(f,h))),Soe.create(p)},"extrudeFromSlices$3");var s1=Toe;const qh=tn,Iv=pt,Poe=Ct,Dv=ph,Roe=s1,Ioe=u((n,e)=>{const t={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0};let{offset:i,twistAngle:s,twistSteps:r,repair:o}=Object.assign({},t,n);if(r<1)throw new Error("twistSteps must be 1 or more");s===0&&(r=1);const a=Iv.clone(i),l=Poe.toSides(e);if(l.length===0)throw new Error("the given geometry cannot be empty");const c=Dv.fromSides(l);a[2]<0&&Dv.reverse(c,c);const h=qh.create(),f=u((d,p,g)=>{const m=p/r*s,v=Iv.scale(Iv.create(),a,p/r);return qh.multiply(h,qh.fromZRotation(h,m),qh.fromTranslation(qh.create(),v)),Dv.transform(h,g)},"createTwist");return n={numberOfSlices:r+1,capStart:!0,capEnd:!0,repair:o,callback:f},Roe(n,c)},"extrudeGeom2");var r1=Ioe;const Doe=Ct,Loe=Vn,Ooe=r1,koe=u((n,e)=>{if(!e.isClosed)throw new Error("extruded path must be closed");const t=Loe.toPoints(e),i=Doe.fromPoints(t);return Ooe(n,i)},"extrudePath2");var Noe=koe;const Foe=jt,zoe=Ct,Boe=Vn,Uoe=r1,$oe=Noe,Voe=u((n,...e)=>{const t={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:i,twistAngle:s,twistSteps:r,repair:o}=Object.assign({},t,n);if(e=Foe(e),e.length===0)throw new Error("wrong number of arguments");n={offset:[0,0,i],twistAngle:s,twistSteps:r,repair:o};const a=e.map(l=>Boe.isA(l)?$oe(n,l):zoe.isA(l)?Uoe(n,l):l);return a.length===1?a[0]:a},"extrudeLinear");var Goe=Voe;const{EPS:Hoe,TAU:Woe}=at,jS=OD,Zh=kD,yn=gt,joe=Q0,Xoe=u((n,e)=>{const t={delta:1,corners:"edge",closed:!1,segments:16};let{delta:i,corners:s,closed:r,segments:o}=Object.assign({},t,n);if(Math.abs(i)<Hoe)return e;let a=n.closed?joe(e):1;a===0&&(a=1);const l=a>0&&i>=0||a<0&&i<0;i=Math.abs(i);let c=null,h=[];const f=[],d=yn.create(),p=e.length;for(let g=0;g<p;g++){const m=(g+1)%p,v=e[g],y=e[m];l?yn.subtract(d,v,y):yn.subtract(d,y,v),yn.normal(d,d),yn.normalize(d,d),yn.scale(d,d,i);const b=yn.add(yn.create(),v,d),_=yn.add(yn.create(),y,d),x=[b,_];if(c!=null&&(r||!r&&m!==0)){const w=jS(c[0],c[1],x[0],x[1]);w?(h.pop(),x[0]=w):f.push({c:v,s0:c,s1:x})}c=[b,_],!(m===0&&!r)&&(h.push(x[0]),h.push(x[1]))}if(r&&c!=null){const g=h[0],m=h[1],v=jS(c[0],c[1],g,m);if(v)h[0]=v,h.pop();else{const y=e[0],b=[g,m];f.push({c:y,s0:c,s1:b})}}if(s==="edge"){const g=new Map;h.forEach((y,b)=>g.set(y,b));const m=Zh.create(),v=Zh.create();f.forEach(y=>{Zh.fromPoints(m,y.s0[0],y.s0[1]),Zh.fromPoints(v,y.s1[0],y.s1[1]);const b=Zh.intersectPointOfLines(m,v);if(Number.isFinite(b[0])&&Number.isFinite(b[1])){const _=y.s0[1],x=g.get(_);h[x]=b,h[(x+1)%h.length]=void 0}else{const _=y.s1[0],x=g.get(_);h[x]=void 0}}),h=h.filter(y=>y!==void 0)}if(s==="round"){let g=Math.floor(o/4);const m=yn.create();f.forEach(v=>{let y=yn.angle(yn.subtract(m,v.s1[0],v.c));if(y-=yn.angle(yn.subtract(m,v.s0[1],v.c)),l&&y<0&&(y=y+Math.PI,y<0&&(y=y+Math.PI)),!l&&y>0&&(y=y-Math.PI,y>0&&(y=y-Math.PI)),y!==0){g=Math.floor(o*(Math.abs(y)/Woe));const b=y/g,_=yn.angle(yn.subtract(m,v.s0[1],v.c)),x=[];for(let w=1;w<g;w++){const M=_+b*w,C=yn.fromAngleRadians(yn.create(),M);yn.scale(C,C,i),yn.add(C,C,v.c),x.push(C)}if(x.length>0){const w=v.s0[1];let M=h.findIndex(C=>yn.equals(w,C));M=(M+1)%h.length,h.splice(M,0,...x)}}else{const b=v.s1[0],_=h.findIndex(x=>yn.equals(b,x));h.splice(_,1)}})}return h},"offsetFromPoints$2");var qD=Xoe;const fm=Ct,Yoe=qD,qoe=u((n,e)=>{const t={delta:1,corners:"edge",segments:16},{delta:i,corners:s,segments:r}=Object.assign({},t,n);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const l=fm.toOutlines(e).map(c=>(n={delta:i,corners:s,closed:!0,segments:r},Yoe(n,c))).reduce((c,h)=>c.concat(fm.toSides(fm.fromPoints(h))),[]);return fm.create(l)},"expandGeom2$1");var Zoe=qoe;const Koe=u((n,e)=>Array.isArray(n)&&n.length>=e?n.every(t=>Number.isFinite(t)):!1,"isNumberArray$c"),Qoe=u((n,e)=>Number.isFinite(n)&&n>e,"isGT$d"),Joe=u((n,e)=>Number.isFinite(n)&&n>=e,"isGTE$a");var oi={isNumberArray:Koe,isGT:Qoe,isGTE:Joe};const{TAU:XS}=at,Ze=pt,eae=At,YS=Yt,{sin:qS,cos:ZS}=wi,{isGTE:tae,isNumberArray:KS}=oi,nae=u(n=>{const e={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:i,segments:s,axes:r}=Object.assign({},e,n);if(!KS(t,3))throw new Error("center must be an array of X, Y and Z values");if(!KS(i,3))throw new Error("radius must be an array of X, Y and Z values");if(!i.every(g=>g>0))throw new Error("radius values must be greater than zero");if(!tae(s,4))throw new Error("segments must be four or more");const o=Ze.scale(Ze.create(),Ze.normalize(Ze.create(),r[0]),i[0]),a=Ze.scale(Ze.create(),Ze.normalize(Ze.create(),r[1]),i[1]),l=Ze.scale(Ze.create(),Ze.normalize(Ze.create(),r[2]),i[2]),c=Math.round(s/4);let h;const f=[],d=Ze.create(),p=Ze.create();for(let g=0;g<=s;g++){const m=XS*g/s,v=Ze.add(Ze.create(),Ze.scale(d,o,ZS(m)),Ze.scale(p,a,qS(m)));if(g>0){let y,b;for(let _=0;_<=c;_++){const x=XS/4*_/c,w=ZS(x),M=qS(x);if(_>0){let C=[],A;A=Ze.subtract(Ze.create(),Ze.scale(d,h,y),Ze.scale(p,l,b)),C.push(Ze.add(A,A,t)),A=Ze.subtract(Ze.create(),Ze.scale(d,v,y),Ze.scale(p,l,b)),C.push(Ze.add(A,A,t)),_<c&&(A=Ze.subtract(Ze.create(),Ze.scale(d,v,w),Ze.scale(p,l,M)),C.push(Ze.add(A,A,t))),A=Ze.subtract(Ze.create(),Ze.scale(d,h,w),Ze.scale(p,l,M)),C.push(Ze.add(A,A,t)),f.push(YS.create(C)),C=[],A=Ze.add(Ze.create(),Ze.scale(d,h,y),Ze.scale(p,l,b)),C.push(Ze.add(Ze.create(),t,A)),A=Ze.add(A,Ze.scale(d,v,y),Ze.scale(p,l,b)),C.push(Ze.add(Ze.create(),t,A)),_<c&&(A=Ze.add(A,Ze.scale(d,v,w),Ze.scale(p,l,M)),C.push(Ze.add(Ze.create(),t,A))),A=Ze.add(A,Ze.scale(d,h,w),Ze.scale(p,l,M)),C.push(Ze.add(Ze.create(),t,A)),C.reverse(),f.push(YS.create(C))}y=w,b=M}}h=v}return eae.create(f)},"ellipsoid$1");var Ew=nae;const iae=Ew,{isGT:sae}=oi,rae=u(n=>{const e={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]};let{center:t,radius:i,segments:s,axes:r}=Object.assign({},e,n);if(!sae(i,0))throw new Error("radius must be greater than zero");return i=[i,i,i],iae({center:t,radius:i,segments:s,axes:r})},"sphere$2");var ZD=rae;const QS=tn,oae=pt,aae=At,Kh=Yt,lae=u((n,e)=>{oae.dot(Kh.plane(e),n)>0&&(e=Kh.invert(e));const i=[e],s=Kh.transform(QS.fromTranslation(QS.create(),n),e),r=e.vertices.length;for(let o=0;o<r;o++){const a=o<r-1?o+1:0,l=Kh.create([e.vertices[o],s.vertices[o],s.vertices[a],e.vertices[a]]);i.push(l)}return i.push(Kh.invert(s)),aae.create(i)},"extrudePolygon$1");var cae=lae;const{EPS:uae,TAU:Lv}=at,JS=tn,Kt=pt,hae=ND,Ov=At,sl=Yt,fae=ZD,dae=t1,kv=UD,pae=cae,mae=u((n,e,t)=>{const i=e.toString();if(n.has(i))n.get(i)[1].push(t);else{const s=[e,[t]];n.set(i,s)}},"mapPlaneToVertex"),gae=u((n,e,t)=>{const i=e[0].toString(),s=e[1].toString(),r=i<s?`${i},${s}`:`${s},${i}`;if(n.has(r))n.get(r)[1].push(t);else{const o=[e,[t]];n.set(r,o)}},"mapPlaneToEdge"),Nv=u((n,e)=>{n.findIndex(i=>i===e)<0&&n.push(e)},"addUniqueAngle"),vae=u((n,e)=>{const t={delta:1,segments:12},{delta:i,segments:s}=Object.assign({},t,n);let r=Ov.create();const o=new Map,a=new Map,l=Kt.create(),c=Kt.create();return Ov.toPolygons(e).forEach((f,d)=>{const p=Kt.scale(Kt.create(),sl.plane(f),2*i),g=sl.transform(JS.fromTranslation(JS.create(),Kt.scale(Kt.create(),p,-.5)),f),m=pae(p,g);r=kv(r,m);const v=f.vertices;for(let y=0;y<v.length;y++){mae(o,v[y],sl.plane(f));const b=(y+1)%v.length,_=[v[y],v[b]];gae(a,_,sl.plane(f))}}),a.forEach(f=>{const d=f[0],p=f[1],g=d[0],m=d[1],v=Kt.subtract(Kt.create(),m,g);Kt.normalize(v,v);const y=p[0],b=Kt.cross(Kt.create(),y,v);let _=[];for(let k=0;k<s;k++)Nv(_,k*Lv/s);for(let k=0,O=p.length;k<O;k++){const N=p[k],E=Kt.dot(b,N),B=Kt.dot(y,N);let W=Math.atan2(E,B);W<0&&(W+=Lv),Nv(_,W),W=Math.atan2(-E,-B),W<0&&(W+=Lv),Nv(_,W)}_=_.sort(hae);const x=_.length;let w,M;const C=[],A=[],P=[];for(let k=-1;k<x;k++){const O=_[k<0?k+x:k],N=Math.sin(O),E=Math.cos(O);Kt.scale(l,y,E*i),Kt.scale(c,b,N*i),Kt.add(l,l,c);const B=Kt.add(Kt.create(),g,l),W=Kt.add(Kt.create(),m,l);let Z=!1;if(k>=0&&Kt.distance(B,w)<uae&&(Z=!0),!Z){if(k>=0){C.push(B),A.push(W);const ne=[M,W,B,w],j=sl.create(ne);P.push(j)}w=B,M=W}}A.reverse(),P.push(sl.create(C)),P.push(sl.create(A));const D=Ov.create(P);r=kv(r,D)}),o.forEach(f=>{const d=f[0],p=f[1],g=p[0];let m=null,v=0;for(let x=1;x<p.length;x++){const w=p[x],M=Kt.cross(l,g,w),C=Kt.length(M);C>.05&&C>v&&(v=C,m=w)}m||(m=Kt.orthogonal(l,g));const y=Kt.cross(l,g,m);Kt.normalize(y,y);const b=Kt.cross(c,y,g),_=fae({center:[d[0],d[1],d[2]],radius:i,segments:s,axes:[g,y,b]});r=kv(r,_)}),dae(r)},"expandShell$1");var yae=vae;const _ae=At,bae=Mw,wae=yae,xae=u((n,e)=>{const t={delta:1,corners:"round",segments:12},{delta:i,corners:s,segments:r}=Object.assign({},t,n);if(s!=="round")throw new Error('corners must be "round" for 3D geometries');if(_ae.toPolygons(e).length===0)throw new Error("the given geometry cannot be empty");n={delta:i,corners:s,segments:r};const a=wae(n,e);return bae(e,a)},"expandGeom3$1");var Aae=xae;const Mae=Q0,ns=gt,nu=Ct,Gf=Vn,eC=qD,Sae=u(n=>{let{external:e,internal:t}=n;Mae(e)<0?e=e.reverse():t=t.reverse();const i=Gf.fromPoints({closed:!0},e),s=Gf.fromPoints({closed:!0},t),r=nu.toSides(nu.fromPoints(Gf.toPoints(i))),o=nu.toSides(nu.fromPoints(Gf.toPoints(s)));return r.push(...o),nu.create(r)},"createGeometryFromClosedOffsets"),Cae=u((n,e,t,i)=>{const{points:s,external:r,internal:o}=n,a=Math.floor(e/2),l=[],c=[];if(t==="round"&&a>0){const f=Math.PI/a,d=s[s.length-1],p=ns.angle(ns.subtract(ns.create(),r[r.length-1],d)),g=s[0],m=ns.angle(ns.subtract(ns.create(),o[0],g));for(let v=1;v<a;v++){let y=p+f*v,b=ns.fromAngleRadians(ns.create(),y);ns.scale(b,b,i),ns.add(b,b,d),l.push(b),y=m+f*v,b=ns.fromAngleRadians(ns.create(),y),ns.scale(b,b,i),ns.add(b,b,g),c.push(b)}}const h=[];return h.push(...r,...l,...o.reverse(),...c),nu.fromPoints(h)},"createGeometryFromExpandedOpenPath"),Eae=u((n,e)=>{n=Object.assign({},{delta:1,corners:"edge",segments:16},n);const{delta:i,corners:s,segments:r}=n;if(i<=0)throw new Error("the given delta must be positive for paths");if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const o=e.isClosed,a=Gf.toPoints(e);if(a.length===0)throw new Error("the given geometry cannot be empty");const l={points:a,external:eC({delta:i,corners:s,segments:r,closed:o},a),internal:eC({delta:-i,corners:s,segments:r,closed:o},a)};return e.isClosed?Sae(l):Cae(l,r,s,i)},"expandPath2$1");var Tae=Eae;const Pae=jt,Rae=Ct,Iae=At,Dae=Vn,Lae=Zoe,Oae=Aae,kae=Tae,Nae=u((n,...e)=>{if(e=Pae(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(i=>Dae.isA(i)?kae(n,i):Rae.isA(i)?Lae(n,i):Iae.isA(i)?Oae(n,i):i);return t.length===1?t[0]:t},"expand$2");var KD=Nae;const Fae=Vn,zae=KD,Bae=r1,Uae=u((n,e)=>{const t={size:1,height:1},{size:i,height:s}=Object.assign({},t,n);if(n.delta=i,n.offset=[0,0,s],Fae.toPoints(e).length===0)throw new Error("the given geometry cannot be empty");const o=zae(n,e);return Bae(n,o)},"extrudeRectangularPath2$1");var $ae=Uae;const{area:Vae}=ww,Fv=Ct,Gae=Vn,Hae=KD,Wae=r1,jae=u((n,e)=>{const t={size:1,height:1},{size:i,height:s}=Object.assign({},t,n);n.delta=i,n.offset=[0,0,s];const r=Fv.toOutlines(e);if(r.length===0)throw new Error("the given geometry cannot be empty");const a=r.map(c=>(Vae(c)<0&&c.reverse(),Hae(n,Gae.fromPoints({closed:!0},c)))).reduce((c,h)=>c.concat(Fv.toSides(h)),[]),l=Fv.create(a);return Wae(n,l)},"extrudeRectangularGeom2$1");var Xae=jae;const Yae=jt,qae=Ct,Zae=Vn,Kae=$ae,Qae=Xae,Jae=u((n,...e)=>{const t={size:1,height:1},{size:i,height:s}=Object.assign({},t,n);if(e=Yae(e),e.length===0)throw new Error("wrong number of arguments");if(i<=0)throw new Error("size must be positive");if(s<=0)throw new Error("height must be positive");const r=e.map(o=>Zae.isA(o)?Kae(n,o):qae.isA(o)?Qae(n,o):o);return r.length===1?r[0]:r},"extrudeRectangular");var ele=Jae;const tle=jt,tC=tn,nC=Vo,iC=Ct,sC=At,rC=Vn,o1=u((n,...e)=>{const t={origin:[0,0,0],normal:[0,0,1]},{origin:i,normal:s}=Object.assign({},t,n);if(e=tle(e),e.length===0)throw new Error("wrong number of arguments");const r=nC.fromNormalAndPoint(nC.create(),s,i);if(Number.isNaN(r[0]))throw new Error("the given origin and normal do not define a proper plane");const o=tC.mirrorByPlane(tC.create(),r),a=e.map(l=>rC.isA(l)?rC.transform(o,l):iC.isA(l)?iC.transform(o,l):sC.isA(l)?sC.transform(o,l):l);return a.length===1?a[0]:a},"mirror"),nle=u((...n)=>o1({normal:[1,0,0]},n),"mirrorX$1"),ile=u((...n)=>o1({normal:[0,1,0]},n),"mirrorY"),sle=u((...n)=>o1({normal:[0,0,1]},n),"mirrorZ");var Hf={mirror:o1,mirrorX:nle,mirrorY:ile,mirrorZ:sle};const{TAU:gs}=at,Qh=tn,{mirrorX:rle}=Hf,Jh=Ct,zv=ph,ole=s1,ale=u((n,e)=>{const t={segments:12,startAngle:0,angle:gs,overflow:"cap"};let{segments:i,startAngle:s,angle:r,overflow:o}=Object.assign({},t,n);if(i<3)throw new Error("segments must be greater then 3");s=Math.abs(s)>gs?s%gs:s,r=Math.abs(r)>gs?r%gs:r;let a=s+r;if(a=Math.abs(a)>gs?a%gs:a,a<s){const b=s;s=a,a=b}let l=a-s;if(l<=0&&(l=gs),Math.abs(l)<gs){const b=gs/i;i=Math.floor(Math.abs(l)/b),Math.abs(l)>i*b&&i++}let c=Jh.toSides(e);if(c.length===0)throw new Error("the given geometry cannot be empty");const h=c.filter(b=>b[0][0]<0),f=c.filter(b=>b[0][0]>=0);h.length>0&&f.length>0&&o==="cap"&&(h.length>f.length?(c=c.map(b=>{let _=b[0],x=b[1];return _=[Math.min(_[0],0),_[1]],x=[Math.min(x[0],0),x[1]],[_,x]}),e=Jh.reverse(Jh.create(c)),e=rle(e)):f.length>=h.length&&(c=c.map(b=>{let _=b[0],x=b[1];return _=[Math.max(_[0],0),_[1]],x=[Math.max(x[0],0),x[1]],[_,x]}),e=Jh.create(c)));const p=l/i,g=Math.abs(l)<gs,m=zv.fromSides(Jh.toSides(e));zv.reverse(m,m);const v=Qh.create(),y=u((b,_,x)=>{let w=p*_+s;return l===gs&&_===i&&(w=s),Qh.multiply(v,Qh.fromZRotation(v,w),Qh.fromXRotation(Qh.create(),gs/4)),zv.transform(v,x)},"createSlice");return n={numberOfSlices:i+1,capStart:g,capEnd:g,close:!g,callback:y},ole(n,m)},"extrudeRotate$1");var QD=ale;const{TAU:ef}=at,Bv=ph,Sr=tn,lle=s1,cle=Ct,ule=u((n,e)=>{const t={angle:ef,startAngle:0,pitch:10,endOffset:0,segmentsPerRotation:32},{angle:i,endOffset:s,segmentsPerRotation:r,startAngle:o}=Object.assign({},t,n);let a;if(!n.pitch&&n.height?a=n.height/(i/ef):a=n.pitch?n.pitch:t.pitch,r<3)throw new Error("The number of segments per rotation needs to be at least 3.");let c=cle.toSides(e);if(c.length===0)throw new Error("the given geometry cannot be empty");const h=c.filter(y=>y[0][0]>=0);let f=Bv.fromSides(c);h.length===0&&(f=Bv.reverse(f));const d=Math.round(r/ef*Math.abs(i)),p=d>=2?d:2,g=Sr.create();let m;const v=u((y,b,_)=>{const x=o+i/p*b,w=s/p*b,M=(x-o)/ef*a;return Sr.multiply(g,Sr.fromTranslation(Sr.create(),[w,0,M*Math.sign(i)]),Sr.fromXRotation(Sr.create(),-ef/4*Math.sign(i))),m=Sr.create(),Sr.multiply(m,Sr.fromZRotation(Sr.create(),x),g),Bv.transform(m,_)},"sliceCallback");return lle({numberOfSlices:p+1,callback:v},f)},"extrudeHelical");var hle=ule;const fle=jt,oC=yw,Uv=Vo,aC=tn,lC=Ct,JD=At,Ic=Yt,dle=Jd,ple=VD,mle=u((n,e)=>{const t=Uv.fromNormalAndPoint(Uv.create(),n.axis,n.origin);if(Number.isNaN(t[0])||Number.isNaN(t[1])||Number.isNaN(t[2])||Number.isNaN(t[3]))throw new Error("project: invalid axis or origin");const i=dle(e),s=i*i*Math.sqrt(3)/4;if(i===0)return lC.create();const r=JD.toPolygons(e);let o=[];for(let l=0;l<r.length;l++){const c=r[l].vertices.map(d=>Uv.projectionOfPoint(t,d)),h=Ic.create(c),f=Ic.plane(h);!oC(t,f)||Ic.measureArea(h)<s||o.push(h)}if(!oC(t,[0,0,1])){const l=aC.fromVectorRotation(aC.create(),t,[0,0,1]);o=o.map(c=>Ic.transform(l,c))}o=o.sort((l,c)=>Ic.measureArea(c)-Ic.measureArea(l));const a=o.map(l=>lC.fromPoints(l.vertices));return ple(a)},"projectGeom3"),gle=u((n,...e)=>{const t={axis:[0,0,1],origin:[0,0,0]},{axis:i,origin:s}=Object.assign({},t,n);if(e=fle(e),e.length===0)throw new Error("wrong number of arguments");n={axis:i,origin:s};const r=e.map(o=>JD.isA(o)?mle(n,o):o);return r.length===1?r[0]:r},"project");var vle=gle,dm={extrudeFromSlices:s1,extrudeLinear:Goe,extrudeRectangular:ele,extrudeRotate:QD,extrudeHelical:hle,project:vle,slice:ph};const cC=gt,yle=u(n=>{let e=cC.fromValues(1/0,1/0);n.forEach(s=>{(s[1]<e[1]||s[1]===e[1]&&s[0]<e[0])&&(e=s)});const t=[];n.forEach(s=>{const r=ble(s[1]-e[1],s[0]-e[0]),o=cC.squaredDistance(s,e);t.push({point:s,angle:r,distSq:o})}),t.sort((s,r)=>s.angle<r.angle?-1:s.angle>r.angle?1:s.distSq<r.distSq?-1:s.distSq>r.distSq?1:0);const i=[];return t.forEach(s=>{let r=i.length;for(;r>1&&_le(i[r-2],i[r-1],s.point)<=Number.EPSILON;)i.pop(),r=i.length;i.push(s.point)}),i},"hullPoints2$2"),_le=u((n,e,t)=>(e[0]-n[0])*(t[1]-n[1])-(e[1]-n[1])*(t[0]-n[0]),"ccw"),ble=u((n,e)=>n===0&&e===0?-1/0:-e/n,"fakeAtan2");var eL=yle;const uC=Ct,hC=At,fC=Vn,wle=u(n=>{const e=new Set,t=[],i=u(s=>{const r=s.toString();e.has(r)||(t.push(s),e.add(r))},"addPoint");return n.forEach(s=>{uC.isA(s)?uC.toPoints(s).forEach(i):hC.isA(s)?hC.toPoints(s).forEach(r=>r.forEach(i)):fC.isA(s)&&fC.toPoints(s).forEach(i)}),t},"toUniquePoints$3");var Tw=wle;const xle=jt,Ale=Vn,Mle=eL,Sle=Tw,Cle=u((...n)=>{n=xle(n);const e=Sle(n),t=Mle(e);return Ale.fromPoints({closed:!0},t)},"hullPath2$1");var Ele=Cle;const Tle=jt,dC=Ct,Ple=eL,Rle=Tw,Ile=u((...n)=>{n=Tle(n);const e=Rle(n),t=Ple(e);return t.length<3?dC.create():dC.fromPoints(t)},"hullGeom2$1");var Dle=Ile;const Lle=Zd,pC=W0,mC=nD,Ole=u((n,e,t)=>{const i=[],s=[],r=[];pC(i,t,e),pC(s,n,e);const o=mC(Lle(r,s,i)),a=mC(i);if(a===0)throw Error("a and b are the same point");return o/a},"distanceSquared"),kle=u((n,e,t)=>Math.sqrt(Ole(n,e,t)),"pointLineDistance$1");var Nle=kle;const Fle=Zd,zle=cw,gC=W0,Ble=u((n,e,t,i)=>{const s=[0,0,0];return gC(n,e,t),gC(s,t,i),Fle(n,n,s),zle(n,n)},"planeNormal");var Ule=Ble;class tL{constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}first(){return this.head}isEmpty(){return!this.head}}u(tL,"VertexList$1");var $le=tL;class nL{constructor(e,t){this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null}}u(nL,"Vertex$1");var Vle=nL;const Gle=ZI,Hle=tD;class iL{constructor(e,t){this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?Gle(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?Hle(this.tail().point,this.head().point):-1}setOpposite(e){this.opposite=e,e.opposite=this}}u(iL,"HalfEdge$1");var Wle=iL;const $v=YI,jle=qI,Xle=Zd,Vv=G0,Yle=KI,qle=cw,pm=eD,Gv=W0,Hv=Wle,sL=0,Zle=1,C_=2;class a1{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=sL,this.edge=null,this.nVertices=0}getEdge(e){if(typeof e!="number")throw Error("requires a number");let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}computeNormal(){const e=this.edge,t=e.next;let i=t.next;const s=Gv([],t.head().point,e.head().point),r=[],o=[];for(this.nVertices=2,this.normal=[0,0,0];i!==e;)jle(o,s),Gv(s,i.head().point,e.head().point),$v(this.normal,this.normal,Xle(r,o,s)),i=i.next,this.nVertices+=1;this.area=Yle(this.normal),this.normal=pm(this.normal,this.normal,1/this.area)}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let t,i=0,s=this.edge;do{const h=s.lengthSquared();h>i&&(t=s,i=h),s=s.next}while(s!==this.edge);const r=t.tail().point,o=t.head().point,a=Gv([],o,r),l=Math.sqrt(i);pm(a,a,1/l);const c=Vv(this.normal,a);pm(a,a,-c),$v(this.normal,this.normal,a),qle(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do $v(this.centroid,this.centroid,e.head().point),e=e.next;while(e!==this.edge);pm(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(e){typeof e!="undefined"?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=Vv(this.normal,this.centroid)}distanceToPlane(e){return Vv(this.normal,e)-this.offset}connectHalfEdges(e,t){let i;if(e.opposite.face===t.opposite.face){const s=t.opposite.face;let r;e===this.edge&&(this.edge=t),s.nVertices===3?(r=t.opposite.prev.opposite,s.mark=C_,i=s):(r=t.opposite.next,s.edge===r.prev&&(s.edge=r),r.prev=r.prev.prev,r.prev.next=r),t.prev=e.prev,t.prev.next=t,t.setOpposite(r),s.computeNormalAndCentroid()}else e.next=t,t.prev=e;return i}mergeAdjacentFaces(e,t){const i=e.opposite,s=i.face;t.push(s),s.mark=C_;let r=e.prev,o=e.next,a=i.prev,l=i.next;for(;r.opposite.face===s;)r=r.prev,l=l.next;for(;o.opposite.face===s;)o=o.next,a=a.prev;let c;for(c=l;c!==a.next;c=c.next)c.face=this;this.edge=o;let h;return h=this.connectHalfEdges(a,o),h&&t.push(h),h=this.connectHalfEdges(r,l),h&&t.push(h),this.computeNormalAndCentroid(),t}collectIndices(){const e=[];let t=this.edge;do e.push(t.head().index),t=t.next;while(t!==this.edge);return e}static createTriangle(e,t,i,s=0){const r=new a1,o=new Hv(e,r),a=new Hv(t,r),l=new Hv(i,r);return o.next=l.prev=a,a.next=o.prev=l,l.next=a.prev=o,r.edge=o,r.computeNormalAndCentroid(s),r}}u(a1,"Face$1");var Kle={VISIBLE:sL,NON_CONVEX:Zle,DELETED:C_,Face:a1};const Wv=G0,Qle=Nle,Jle=Ule,vC=$le,ece=Vle,{Face:so,VISIBLE:Dc,NON_CONVEX:yC,DELETED:tce}=Kle,nce=1,_C=2;class rL{constructor(e){if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=e.length,this.faces=[],this.newFaces=[],this.claimed=new vC,this.unclaimed=new vC,this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new ece(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}deleteFaceVertices(e,t){const i=this.removeAllVerticesFromFace(e);if(i)if(!t)this.unclaimed.addAll(i);else{let s;for(let r=i;r;r=s)s=r.next,t.distanceToPlane(r.point)>this.tolerance?this.addVertexToFace(r,t):this.unclaimed.add(r)}}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let i=t;i;i=t){t=i.next;let s=this.tolerance,r;for(let o=0;o<e.length;o+=1){const a=e[o];if(a.mark===Dc){const l=a.distanceToPlane(i.point);if(l>s&&(s=l,r=a),s>1e3*this.tolerance)break}}r&&this.addVertexToFace(i,r)}}computeExtremes(){const e=[],t=[],i=[],s=[];let r,o;for(r=0;r<3;r+=1)i[r]=s[r]=this.vertices[0];for(r=0;r<3;r+=1)e[r]=t[r]=this.vertices[0].point[r];for(r=1;r<this.vertices.length;r+=1){const a=this.vertices[r],l=a.point;for(o=0;o<3;o+=1)l[o]<e[o]&&(e[o]=l[o],i[o]=a);for(o=0;o<3;o+=1)l[o]>t[o]&&(t[o]=l[o],s[o]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e[0]),Math.abs(t[0]))+Math.max(Math.abs(e[1]),Math.abs(t[1]))+Math.max(Math.abs(e[2]),Math.abs(t[2]))),[i,s]}createInitialSimplex(){const e=this.vertices,[t,i]=this.computeExtremes();let s,r,o,a,l=0,c=0;for(o=0;o<3;o+=1){const m=i[o].point[o]-t[o].point[o];m>l&&(l=m,c=o)}const h=t[c],f=i[c];for(l=0,o=0;o<this.vertices.length;o+=1){const m=this.vertices[o];if(m!==h&&m!==f){const v=Qle(m.point,h.point,f.point);v>l&&(l=v,s=m)}}const d=Jle([],h.point,f.point,s.point),p=Wv(h.point,d);for(l=-1,o=0;o<this.vertices.length;o+=1){const m=this.vertices[o];if(m!==h&&m!==f&&m!==s){const v=Math.abs(Wv(d,m.point)-p);v>l&&(l=v,r=m)}}const g=[];if(Wv(r.point,d)-p<0)for(g.push(so.createTriangle(h,f,s),so.createTriangle(r,f,h),so.createTriangle(r,s,f),so.createTriangle(r,h,s)),o=0;o<3;o+=1){const m=(o+1)%3;g[o+1].getEdge(2).setOpposite(g[0].getEdge(m)),g[o+1].getEdge(1).setOpposite(g[m+1].getEdge(0))}else for(g.push(so.createTriangle(h,s,f),so.createTriangle(r,h,f),so.createTriangle(r,f,s),so.createTriangle(r,s,h)),o=0;o<3;o+=1){const m=(o+1)%3;g[o+1].getEdge(2).setOpposite(g[0].getEdge((3-o)%3)),g[o+1].getEdge(0).setOpposite(g[m+1].getEdge(1))}for(o=0;o<4;o+=1)this.faces.push(g[o]);for(o=0;o<e.length;o+=1){const m=e[o];if(m!==h&&m!==f&&m!==s&&m!==r){l=this.tolerance;let v;for(a=0;a<4;a+=1){const y=g[a].distanceToPlane(m.point);y>l&&(l=y,v=g[a])}v&&this.addVertexToFace(m,v)}}}reindexFaceAndVertices(){const e=[];for(let t=0;t<this.faces.length;t+=1){const i=this.faces[t];i.mark===Dc&&e.push(i)}this.faces=e}collectFaces(e){const t=[];for(let i=0;i<this.faces.length;i+=1){if(this.faces[i].mark!==Dc)throw Error("attempt to include a destroyed face in the hull");const s=this.faces[i].collectIndices();if(e)t.push(s);else for(let r=0;r<s.length-2;r+=1)t.push([s[0],s[r+1],s[r+2]])}return t}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,i=0;const s=this.claimed.first().face;for(t=s.outside;t&&t.face===s;t=t.next){const r=s.distanceToPlane(t.point);r>i&&(i=r,e=t)}return e}}computeHorizon(e,t,i,s){this.deleteFaceVertices(i),i.mark=tce;let r;t?r=t.next:r=t=i.getEdge(0);do{const o=r.opposite,a=o.face;a.mark===Dc&&(a.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,o,a,s):s.push(r)),r=r.next}while(r!==t)}addAdjoiningFace(e,t){const i=so.createTriangle(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setOpposite(t.opposite),i.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let i,s;for(let r=0;r<t.length;r+=1){const o=t[r],a=this.addAdjoiningFace(e,o);i?a.next.setOpposite(s):i=a,this.newFaces.push(a.face),s=a}i.next.setOpposite(s)}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid)}doAdjacentMerge(e,t){let i=e.edge,s=!0,r=0;do{if(r>=e.nVertices)throw Error("merge recursion limit exceeded");const o=i.opposite.face;let a=!1;if(t===_C?(this.oppositeFaceDistance(i)>-this.tolerance||this.oppositeFaceDistance(i.opposite)>-this.tolerance)&&(a=!0):e.area>o.area?this.oppositeFaceDistance(i)>-this.tolerance?a=!0:this.oppositeFaceDistance(i.opposite)>-this.tolerance&&(s=!1):this.oppositeFaceDistance(i.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(i)>-this.tolerance&&(s=!1),a){const l=e.mergeAdjacentFaces(i,[]);for(let c=0;c<l.length;c+=1)this.deleteFaceVertices(l[c],e);return!0}i=i.next,r+=1}while(i!==e.edge);return s||(e.mark=yC),!1}addVertexToHull(e){const t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t);for(let i=0;i<this.newFaces.length;i+=1){const s=this.newFaces[i];if(s.mark===Dc)for(;this.doAdjacentMerge(s,nce););}for(let i=0;i<this.newFaces.length;i+=1){const s=this.newFaces[i];if(s.mark===yC)for(s.mark=Dc;this.doAdjacentMerge(s,_C););}this.resolveUnclaimedPoints(this.newFaces)}build(){let e;for(this.createInitialSimplex();e=this.nextVertexToAdd();)this.addVertexToHull(e);this.reindexFaceAndVertices()}}u(rL,"QuickHull$1");var ice=rL;const sce=ice,rce=u((n,e={})=>{const t=new sce(n);return t.build(),t.collectFaces(e.skipTriangulation)},"runner");var oce=rce;const ace=jt,lce=At,cce=Yt,uce=oce,hce=Tw,fce=u((...n)=>{if(n=ace(n),n.length===1)return n[0];const e=hce(n),i=uce(e,{skipTriangulation:!0}).map(s=>{const r=s.map(o=>e[o]);return cce.create(r)});return lce.create(i)},"hullGeom3$1");var dce=fce;const pce=jt,mce=Qd,gce=Ct,vce=At,yce=Vn,_ce=Ele,bce=Dle,wce=dce,xce=u((...n)=>{if(n=pce(n),n.length===0)throw new Error("wrong number of arguments");if(!mce(n))throw new Error("only hulls of the same type are supported");const e=n[0];return yce.isA(e)?_ce(n):gce.isA(e)?bce(n):vce.isA(e)?wce(n):e},"hull$1");var oL=xce;const Ace=jt,Mce=Mw,Sce=oL,Cce=u((...n)=>{if(n=Ace(n),n.length<2)throw new Error("wrong number of arguments");const e=[];for(let t=1;t<n.length;t++)e.push(Sce(n[t-1],n[t]));return Mce(e)},"hullChain");var Ece=Cce,bC={hull:oL,hullChain:Ece};const Tce=u((n,e,t)=>{for(n=n.slice();n.length<t;)n.push(e);return n},"padArrayToLength$1");var Pce=Tce;const Rce=jt,Ice=JI,Dce=QI,Lce=J0,Oce=u((...n)=>{if(n=Rce(n),n.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");const e=Lce(n);if(n.length===1)return e;const t=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return e.reduce((i,s)=>(i=[Ice(i[0],i[0],s[0]),Dce(i[1],i[1],s[1])],i),t)},"measureAggregateBoundingBox$1");var kce=Oce;const Nce=jt,wC=tn,xC=Ct,AC=At,MC=Vn,l1=u((n,...e)=>{if(!Array.isArray(n))throw new Error("offset must be an array");if(e=Nce(e),e.length===0)throw new Error("wrong number of arguments");for(n=n.slice();n.length<3;)n.push(0);const t=wC.fromTranslation(wC.create(),n),i=e.map(s=>MC.isA(s)?MC.transform(t,s):xC.isA(s)?xC.transform(t,s):AC.isA(s)?AC.transform(t,s):s);return i.length===1?i[0]:i},"translate$3"),Fce=u((n,...e)=>l1([n,0,0],e),"translateX"),zce=u((n,...e)=>l1([0,n,0],e),"translateY"),Bce=u((n,...e)=>l1([0,0,n],e),"translateZ");var Ll={translate:l1,translateX:Fce,translateY:zce,translateZ:Bce};const Uce=jt,SC=Pce,aL=kce,{translate:$ce}=Ll,Vce=u(n=>{if(!Array.isArray(n.modes)||n.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(n.modes=SC(n.modes,"none",3),n.modes.filter(e=>["center","max","min","none"].includes(e)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(n.relativeTo)||n.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(n.relativeTo=SC(n.relativeTo,0,3),n.relativeTo.filter(e=>Number.isFinite(e)||e==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof n.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return n},"validateOptions"),Gce=u((n,e,t)=>{for(let i=0;i<3;i++)n[i]==null&&(e[i]==="center"?n[i]=(t[0][i]+t[1][i])/2:e[i]==="max"?n[i]=t[1][i]:e[i]==="min"&&(n[i]=t[0][i]));return n},"populateRelativeToFromBounds"),CC=u((n,e,t)=>{const i=aL(n),s=[0,0,0];for(let r=0;r<3;r++)e[r]==="center"?s[r]=t[r]-(i[0][r]+i[1][r])/2:e[r]==="max"?s[r]=t[r]-i[1][r]:e[r]==="min"&&(s[r]=t[r]-i[0][r]);return $ce(s,n)},"alignGeometries"),Hce=u((n,...e)=>{n=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},n),n=Vce(n);let{modes:i,relativeTo:s,grouped:r}=n;if(e=Uce(e),e.length===0)throw new Error("align(): No geometries were provided to act upon");if(s.filter(o=>o==null).length){const o=aL(e);s=Gce(s,i,o)}return r?e=CC(e,i,s):e=e.map(o=>CC(o,i,s)),e.length===1?e[0]:e},"align");var Wce=Hce;const jce=jt,Xce=Ct,Yce=At,qce=Vn,Zce=J0,{translate:Kce}=Ll,jv=u((n,e)=>{const t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:i,relativeTo:s}=Object.assign({},t,n),r=Zce(e),o=[0,0,0];return i[0]&&(o[0]=s[0]-(r[0][0]+(r[1][0]-r[0][0])/2)),i[1]&&(o[1]=s[1]-(r[0][1]+(r[1][1]-r[0][1])/2)),i[2]&&(o[2]=s[2]-(r[0][2]+(r[1][2]-r[0][2])/2)),Kce(o,e)},"centerGeometry"),c1=u((n,...e)=>{const t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:i,relativeTo:s}=Object.assign({},t,n);if(e=jce(e),e.length===0)throw new Error("wrong number of arguments");if(s.length!==3)throw new Error("relativeTo must be an array of length 3");n={axes:i,relativeTo:s};const r=e.map(o=>qce.isA(o)||Xce.isA(o)||Yce.isA(o)?jv(n,o):o);return r.length===1?r[0]:r},"center"),Qce=u((...n)=>c1({axes:[!0,!1,!1]},n),"centerX"),Jce=u((...n)=>c1({axes:[!1,!0,!1]},n),"centerY"),eue=u((...n)=>c1({axes:[!1,!1,!0]},n),"centerZ");var mm={center:c1,centerX:Qce,centerY:Jce,centerZ:eue};const tue=jt,EC=tn,TC=Ct,PC=At,RC=Vn,u1=u((n,...e)=>{if(!Array.isArray(n))throw new Error("angles must be an array");if(e=tue(e),e.length===0)throw new Error("wrong number of arguments");for(n=n.slice();n.length<3;)n.push(0);const t=n[2],i=n[1],s=n[0],r=EC.fromTaitBryanRotation(EC.create(),t,i,s),o=e.map(a=>RC.isA(a)?RC.transform(r,a):TC.isA(a)?TC.transform(r,a):PC.isA(a)?PC.transform(r,a):a);return o.length===1?o[0]:o},"rotate$1"),nue=u((n,...e)=>u1([n,0,0],e),"rotateX"),iue=u((n,...e)=>u1([0,n,0],e),"rotateY"),sue=u((n,...e)=>u1([0,0,n],e),"rotateZ");var Wf={rotate:u1,rotateX:nue,rotateY:iue,rotateZ:sue};const rue=jt,IC=tn,DC=Ct,LC=At,OC=Vn,h1=u((n,...e)=>{if(!Array.isArray(n))throw new Error("factors must be an array");if(e=rue(e),e.length===0)throw new Error("wrong number of arguments");for(n=n.slice();n.length<3;)n.push(1);if(n[0]<=0||n[1]<=0||n[2]<=0)throw new Error("factors must be positive");const t=IC.fromScaling(IC.create(),n),i=e.map(s=>OC.isA(s)?OC.transform(t,s):DC.isA(s)?DC.transform(t,s):LC.isA(s)?LC.transform(t,s):s);return i.length===1?i[0]:i},"scale"),oue=u((n,...e)=>h1([n,1,1],e),"scaleX"),aue=u((n,...e)=>h1([1,n,1],e),"scaleY"),lue=u((n,...e)=>h1([1,1,n],e),"scaleZ");var gm={scale:h1,scaleX:oue,scaleY:aue,scaleZ:lue};const cue=jt,kC=Ct,NC=At,FC=Vn,uue=u((n,...e)=>{if(e=cue(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(i=>FC.isA(i)?FC.transform(n,i):kC.isA(i)?kC.transform(n,i):NC.isA(i)?NC.transform(n,i):i);return t.length===1?t[0]:t},"transform");var hue=uue,Xv={align:Wce,center:mm.center,centerX:mm.centerX,centerY:mm.centerY,centerZ:mm.centerZ,mirror:Hf.mirror,mirrorX:Hf.mirrorX,mirrorY:Hf.mirrorY,mirrorZ:Hf.mirrorZ,rotate:Wf.rotate,rotateX:Wf.rotateX,rotateY:Wf.rotateY,rotateZ:Wf.rotateZ,scale:gm.scale,scaleX:gm.scaleX,scaleY:gm.scaleY,scaleZ:gm.scaleZ,transform:hue,translate:Ll.translate,translateX:Ll.translateX,translateY:Ll.translateY,translateZ:Ll.translateZ};const{EPS:zC,TAU:Lc}=at,ro=gt,fue=Vn,{isGT:due,isGTE:Yv,isNumberArray:pue}=oi,mue=u(n=>{const e={center:[0,0],radius:1,startAngle:0,endAngle:Lc,makeTangent:!1,segments:32};let{center:t,radius:i,startAngle:s,endAngle:r,makeTangent:o,segments:a}=Object.assign({},e,n);if(!pue(t,2))throw new Error("center must be an array of X and Y values");if(!due(i,0))throw new Error("radius must be greater than zero");if(!Yv(s,0))throw new Error("startAngle must be positive");if(!Yv(r,0))throw new Error("endAngle must be positive");if(!Yv(a,4))throw new Error("segments must be four or more");s=s%Lc,r=r%Lc;let l=Lc;s<r&&(l=r-s),s>r&&(l=r+(Lc-s));const c=Math.acos((i*i+i*i-zC*zC)/(2*i*i)),h=ro.clone(t);let f;const d=[];if(l<c)f=ro.fromAngleRadians(ro.create(),s),ro.scale(f,f,i),ro.add(f,f,h),d.push(f);else{const p=Math.max(1,Math.floor(a*(l/Lc)))+1;let g=p*.5/l;g>.25&&(g=.25);const m=o?p+2:p;for(let v=0;v<=m;v++){let y=v;o&&(y=(v-1)*(p-2*g)/p+g,y<0&&(y=0),y>p&&(y=p));const b=s+y*(l/p);f=ro.fromAngleRadians(ro.create(),b),ro.scale(f,f,i),ro.add(f,f,h),d.push(f)}}return fue.fromPoints({closed:!1},d)},"arc");var gue=mue;const{EPS:BC,TAU:oa}=at,qv=gt,vue=Ct,{sin:yue,cos:_ue}=wi,{isGTE:Zv,isNumberArray:UC}=oi,bue=u(n=>{const e={center:[0,0],radius:[1,1],startAngle:0,endAngle:oa,segments:32};let{center:t,radius:i,startAngle:s,endAngle:r,segments:o}=Object.assign({},e,n);if(!UC(t,2))throw new Error("center must be an array of X and Y values");if(!UC(i,2))throw new Error("radius must be an array of X and Y values");if(!i.every(p=>p>0))throw new Error("radius values must be greater than zero");if(!Zv(s,0))throw new Error("startAngle must be positive");if(!Zv(r,0))throw new Error("endAngle must be positive");if(!Zv(o,3))throw new Error("segments must be three or more");s=s%oa,r=r%oa;let a=oa;s<r&&(a=r-s),s>r&&(a=r+(oa-s));const l=Math.min(i[0],i[1]),c=Math.acos((l*l+l*l-BC*BC)/(2*l*l));if(a<c)throw new Error("startAngle and endAngle do not define a significant rotation");o=Math.floor(o*(a/oa));const h=qv.clone(t),f=a/o,d=[];o=a<oa?o+1:o;for(let p=0;p<o;p++){const g=f*p+s,m=qv.fromValues(i[0]*_ue(g),i[1]*yue(g));qv.add(m,h,m),d.push(m)}return a<oa&&d.push(h),vue.fromPoints(d)},"ellipse$1");var lL=bue;const{TAU:wue}=at,xue=lL,{isGT:Aue}=oi,Mue=u(n=>{const e={center:[0,0],radius:1,startAngle:0,endAngle:wue,segments:32};let{center:t,radius:i,startAngle:s,endAngle:r,segments:o}=Object.assign({},e,n);if(!Aue(i,0))throw new Error("radius must be greater than zero");return i=[i,i],xue({center:t,radius:i,startAngle:s,endAngle:r,segments:o})},"circle$1");var cL=Mue;const Sue=At,Cue=Yt,{isNumberArray:$C}=oi,Eue=u(n=>{const e={center:[0,0,0],size:[2,2,2]},{center:t,size:i}=Object.assign({},e,n);if(!$C(t,3))throw new Error("center must be an array of X, Y and Z values");if(!$C(i,3))throw new Error("size must be an array of width, depth and height values");if(!i.every(r=>r>0))throw new Error("size values must be greater than zero");return Sue.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(r=>{const o=r[0].map(a=>[t[0]+i[0]/2*(2*!!(a&1)-1),t[1]+i[1]/2*(2*!!(a&2)-1),t[2]+i[2]/2*(2*!!(a&4)-1)]);return Cue.create(o)}))},"cuboid$1");var uL=Eue;const Tue=uL,{isGT:Pue}=oi,Rue=u(n=>{const e={center:[0,0,0],size:2};let{center:t,size:i}=Object.assign({},e,n);if(!Pue(i,0))throw new Error("size must be greater than zero");return i=[i,i,i],Tue({center:t,size:i})},"cube");var Iue=Rue;const{EPS:VC,TAU:aa}=at,ui=pt,Due=At,Lue=Yt,{sin:Oue,cos:kue}=wi,{isGT:Nue,isGTE:Kv,isNumberArray:Qv}=oi,Fue=u(n=>{const e={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:aa,segments:32};let{center:t,height:i,startRadius:s,startAngle:r,endRadius:o,endAngle:a,segments:l}=Object.assign({},e,n);if(!Qv(t,3))throw new Error("center must be an array of X, Y and Z values");if(!Nue(i,0))throw new Error("height must be greater then zero");if(!Qv(s,2))throw new Error("startRadius must be an array of X and Y values");if(!s.every(P=>P>=0))throw new Error("startRadius values must be positive");if(!Qv(o,2))throw new Error("endRadius must be an array of X and Y values");if(!o.every(P=>P>=0))throw new Error("endRadius values must be positive");if(o.every(P=>P===0)&&s.every(P=>P===0))throw new Error("at least one radius must be positive");if(!Kv(r,0))throw new Error("startAngle must be positive");if(!Kv(a,0))throw new Error("endAngle must be positive");if(!Kv(l,4))throw new Error("segments must be four or more");r=r%aa,a=a%aa;let c=aa;r<a&&(c=a-r),r>a&&(c=a+(aa-r));const h=Math.min(s[0],s[1],o[0],o[1]),f=Math.acos((h*h+h*h-VC*VC)/(2*h*h));if(c<f)throw new Error("startAngle and endAngle do not define a significant rotation");const d=Math.floor(l*(c/aa)),p=ui.fromValues(0,0,-(i/2)),g=ui.fromValues(0,0,i/2),m=ui.subtract(ui.create(),g,p),v=ui.fromValues(1,0,0),y=ui.fromValues(0,1,0),b=ui.create(),_=ui.create(),x=ui.create(),w=u((P,D,k)=>{const O=D*c+r;return ui.scale(b,v,k[0]*kue(O)),ui.scale(_,y,k[1]*Oue(O)),ui.add(b,b,_),ui.scale(x,m,P),ui.add(x,x,p),ui.add(ui.create(),b,x)},"point"),M=u((...P)=>{const D=P.map(k=>ui.add(ui.create(),k,t));return Lue.create(D)},"fromPoints"),C=[];for(let P=0;P<d;P++){const D=P/d;let k=(P+1)/d;c===aa&&P===d-1&&(k=0),o[0]===s[0]&&o[1]===s[1]?(C.push(M(p,w(0,k,o),w(0,D,o))),C.push(M(w(0,k,o),w(1,k,o),w(1,D,o),w(0,D,o))),C.push(M(g,w(1,D,o),w(1,k,o)))):(s[0]>0&&s[1]>0&&C.push(M(p,w(0,k,s),w(0,D,s))),(s[0]>0||s[1]>0)&&C.push(M(w(0,D,s),w(0,k,s),w(1,D,o))),o[0]>0&&o[1]>0&&C.push(M(g,w(1,D,o),w(1,k,o))),(o[0]>0||o[1]>0)&&C.push(M(w(1,D,o),w(0,k,s),w(1,k,o))))}return c<aa&&(C.push(M(p,w(0,0,s),g)),C.push(M(w(0,0,s),w(1,0,o),g)),C.push(M(p,g,w(0,1,s))),C.push(M(w(0,1,s),g,w(1,1,o)))),Due.create(C)},"cylinderElliptic$1");var hL=Fue;const zue=hL,{isGT:Bue}=oi,Uue=u(n=>{const e={center:[0,0,0],height:2,radius:1,segments:32},{center:t,height:i,radius:s,segments:r}=Object.assign({},e,n);if(!Bue(s,0))throw new Error("radius must be greater than zero");return zue({center:t,height:i,startRadius:[s,s],endRadius:[s,s],segments:r})},"cylinder");var $ue=Uue;const Vue=At,Gue=Yt,{isNumberArray:GC}=oi,Hue=u(n=>{const e={points:[],faces:[],colors:void 0,orientation:"outward"},{points:t,faces:i,colors:s,orientation:r}=Object.assign({},e,n);if(!(Array.isArray(t)&&Array.isArray(i)))throw new Error("points and faces must be arrays");if(t.length<3)throw new Error("three or more points are required");if(i.length<1)throw new Error("one or more faces are required");if(s){if(!Array.isArray(s))throw new Error("colors must be an array");if(s.length!==i.length)throw new Error("faces and colors must have the same length")}t.forEach((a,l)=>{if(!GC(a,3))throw new Error(`point ${l} must be an array of X, Y, Z values`)}),i.forEach((a,l)=>{if(a.length<3)throw new Error(`face ${l} must contain 3 or more indexes`);if(!GC(a,a.length))throw new Error(`face ${l} must be an array of numbers`)}),r!=="outward"&&i.forEach(a=>a.reverse());const o=i.map((a,l)=>{const c=Gue.create(a.map(h=>t[h]));return s&&s[l]&&(c.color=s[l]),c});return Vue.create(o)},"polyhedron$1");var fL=Hue;const HC=tn,WC=pt,Wue=At,jue=fL,{isGT:Xue,isGTE:Yue}=oi,que=u(n=>{const e={radius:1,frequency:6};let{radius:t,frequency:i}=Object.assign({},e,n);if(!Xue(t,0))throw new Error("radius must be greater than zero");if(!Yue(i,6))throw new Error("frequency must be six or more");i=Math.floor(i/6);const s=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],r=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],o=u((d,p,g)=>{const m=d[0],v=d[1],y=d[2];let b=g;const _=[],x=[];for(let w=0;w<p;w++)for(let M=0;M<p-w;M++){const C=w/p,A=(w+1)/p,P=M/(p-w),D=(M+1)/(p-w),k=p-w-1?M/(p-w-1):1,O=[];O[0]=a(a(m,v,P),y,C),O[1]=a(a(m,v,D),y,C),O[2]=a(a(m,v,k),y,A);for(let N=0;N<3;N++){const E=WC.length(O[N]);for(let B=0;B<3;B++)O[N][B]/=E}if(_.push(O[0],O[1],O[2]),x.push([b,b+1,b+2]),b+=3,M<p-w-1){const N=p-w-1?(M+1)/(p-w-1):1;O[0]=a(a(m,v,D),y,C),O[1]=a(a(m,v,N),y,A),O[2]=a(a(m,v,k),y,A);for(let E=0;E<3;E++){const B=WC.length(O[E]);for(let W=0;W<3;W++)O[E][W]/=B}_.push(O[0],O[1],O[2]),x.push([b,b+1,b+2]),b+=3}}return{points:_,triangles:x,offset:b}},"geodesicSubDivide"),a=u((d,p,g)=>{const m=1-g,v=[];for(let y=0;y<3;y++)v[y]=d[y]*m+p[y]*g;return v},"mix3");let l=[],c=[],h=0;for(let d=0;d<r.length;d++){const p=o([s[r[d][0]],s[r[d][1]],s[r[d][2]]],i,h);l=l.concat(p.points),c=c.concat(p.triangles),h=p.offset}let f=jue({points:l,faces:c,orientation:"inward"});return t!==1&&(f=Wue.transform(HC.fromScaling(HC.create(),[t,t,t]),f)),f},"geodesicSphere");var Zue=que;const Kue=Vn,Que=u(n=>{if(!Array.isArray(n))throw new Error("points must be an array");return Kue.fromPoints({},n)},"line$2");var Jue=Que;const Jv=Ct,ehe=u(n=>{const e={points:[],paths:[]},{points:t,paths:i}=Object.assign({},e,n);if(!(Array.isArray(t)&&Array.isArray(i)))throw new Error("points and paths must be arrays");let s=t;Array.isArray(t[0])&&(Array.isArray(t[0][0])||(s=[t])),s.forEach((l,c)=>{if(!Array.isArray(l))throw new Error("list of points "+c+" must be an array");if(l.length<3)throw new Error("list of points "+c+" must contain three or more points");l.forEach((h,f)=>{if(!Array.isArray(h))throw new Error("list of points "+c+", point "+f+" must be an array");if(h.length<2)throw new Error("list of points "+c+", point "+f+" must contain by X and Y values")})});let r=i;if(i.length===0){let l=0;r=s.map(c=>c.map(h=>l++))}const o=[];s.forEach(l=>l.forEach(c=>o.push(c)));let a=[];return r.forEach(l=>{const c=l.map(f=>o[f]),h=Jv.fromPoints(c);a=a.concat(Jv.toSides(h))}),Jv.create(a)},"polygon");var the=ehe;const la=gt,nhe=Ct,{isNumberArray:jC}=oi,ihe=u(n=>{const e={center:[0,0],size:[2,2]},{center:t,size:i}=Object.assign({},e,n);if(!jC(t,2))throw new Error("center must be an array of X and Y values");if(!jC(i,2))throw new Error("size must be an array of X and Y values");if(!i.every(a=>a>0))throw new Error("size values must be greater than zero");const s=[i[0]/2,i[1]/2],r=[s[0],-s[1]],o=[la.subtract(la.create(),t,s),la.add(la.create(),t,r),la.add(la.create(),t,s),la.subtract(la.create(),t,r)];return nhe.fromPoints(o)},"rectangle$1");var dL=ihe;const{EPS:Ag,TAU:tf}=at,ey=gt,Rn=pt,she=At,nh=Yt,{sin:rhe,cos:ohe}=wi,{isGT:ahe,isGTE:lhe,isNumberArray:XC}=oi,YC=u((n,e,t,i,s,r)=>{const o=tf/4*s/i,a=ohe(o),l=rhe(o),c=i-s;let h=t*a,f=e[2]-(t-t*l);r||(f=t-t*l-e[2]),h=h>Ag?h:0;const d=Rn.add(Rn.create(),n,[e[0]-t,e[1]-t,f]),p=Rn.add(Rn.create(),n,[t-e[0],e[1]-t,f]),g=Rn.add(Rn.create(),n,[t-e[0],t-e[1],f]),m=Rn.add(Rn.create(),n,[e[0]-t,t-e[1],f]),v=[],y=[],b=[],_=[];for(let x=0;x<=c;x++){const w=c>0?tf/4*x/c:0,M=ey.fromAngleRadians(ey.create(),w);ey.scale(M,M,h);const C=Rn.fromVec2(Rn.create(),M);v.push(Rn.add(Rn.create(),d,C)),Rn.rotateZ(C,C,[0,0,0],tf/4),y.push(Rn.add(Rn.create(),p,C)),Rn.rotateZ(C,C,[0,0,0],tf/4),b.push(Rn.add(Rn.create(),g,C)),Rn.rotateZ(C,C,[0,0,0],tf/4),_.push(Rn.add(Rn.create(),m,C))}return r?[v,y,b,_]:(v.reverse(),y.reverse(),b.reverse(),_.reverse(),[_,b,y,v])},"createCorners"),qC=u((n,e)=>{const t=[];for(let i=0;i<n.length;i++){const s=n[i],r=e[i];for(let o=0;o<s.length-1;o++)t.push(nh.create([s[o],s[o+1],r[o]])),o<r.length-1&&t.push(nh.create([r[o],s[o+1],r[o+1]]))}return t},"stitchCorners"),ZC=u((n,e)=>{const t=[];for(let i=0;i<n.length;i++){let s=n[i],r=e[i];const o=s[s.length-1],a=r[r.length-1],l=(i+1)%n.length;s=n[l],r=e[l];const c=s[0],h=r[0];t.push(nh.create([o,c,h,a]))}return t},"stitchWalls"),che=u((n,e)=>{n=[n[3],n[2],n[1],n[0]],n=n.map(r=>r.slice().reverse());const t=[];n.forEach(r=>{r.forEach(o=>t.push(o))});const i=[];e.forEach(r=>{r.forEach(o=>i.push(o))});const s=[];for(let r=0;r<i.length;r++){const o=(r+1)%i.length;s.push(nh.create([t[r],t[o],i[o],i[r]]))}return s},"stitchSides"),uhe=u(n=>{const e={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32};let{center:t,size:i,roundRadius:s,segments:r}=Object.assign({},e,n);if(!XC(t,3))throw new Error("center must be an array of X, Y and Z values");if(!XC(i,3))throw new Error("size must be an array of X, Y and Z values");if(!i.every(c=>c>0))throw new Error("size values must be greater than zero");if(!ahe(s,0))throw new Error("roundRadius must be greater than zero");if(!lhe(r,4))throw new Error("segments must be four or more");if(i=i.map(c=>c/2),s>i[0]-Ag||s>i[1]-Ag||s>i[2]-Ag)throw new Error("roundRadius must be smaller then the radius of all dimensions");r=Math.floor(r/4);let o=null,a=null,l=[];for(let c=0;c<=r;c++){const h=YC(t,i,s,r,c,!0),f=YC(t,i,s,r,c,!1);if(c===0&&(l=l.concat(che(f,h))),o&&(l=l.concat(qC(o,h),ZC(o,h))),a&&(l=l.concat(qC(a,f),ZC(a,f))),c===r){let d=h.map(p=>p[0]);l.push(nh.create(d)),d=f.map(p=>p[0]),l.push(nh.create(d))}o=h,a=f}return she.create(l)},"roundedCuboid");var hhe=uhe;const{EPS:KC,TAU:QC}=at,De=pt,fhe=At,dhe=Yt,{sin:JC,cos:e3}=wi,{isGT:ty,isGTE:phe,isNumberArray:mhe}=oi,ghe=u(n=>{const e={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:t,height:i,radius:s,roundRadius:r,segments:o}=Object.assign({},e,n);if(!mhe(t,3))throw new Error("center must be an array of X, Y and Z values");if(!ty(i,0))throw new Error("height must be greater then zero");if(!ty(s,0))throw new Error("radius must be greater then zero");if(!ty(r,0))throw new Error("roundRadius must be greater then zero");if(r>s-KC)throw new Error("roundRadius must be smaller then the radius");if(!phe(o,4))throw new Error("segments must be four or more");const a=[0,0,-(i/2)],l=[0,0,i/2],c=De.subtract(De.create(),l,a),h=De.length(c);if(2*r>h-KC)throw new Error("height must be larger than twice roundRadius");let f;Math.abs(c[0])>Math.abs(c[1])?f=De.fromValues(0,1,0):f=De.fromValues(1,0,0);const d=De.scale(De.create(),De.normalize(De.create(),c),r),p=De.scale(De.create(),De.normalize(De.create(),De.cross(De.create(),d,f)),s),g=De.scale(De.create(),De.normalize(De.create(),De.cross(De.create(),p,d)),s);De.add(a,a,d),De.subtract(l,l,d);const m=Math.floor(.25*o),v=u(M=>{const C=M.map(A=>De.add(A,A,t));return dhe.create(C)},"fromPoints"),y=[],b=De.create(),_=De.create();let x;for(let M=0;M<=o;M++){const C=QC*M/o,A=De.add(De.create(),De.scale(b,p,e3(C)),De.scale(_,g,JC(C)));if(M>0){let P=[];P.push(De.add(De.create(),a,A)),P.push(De.add(De.create(),a,x)),P.push(De.add(De.create(),l,x)),P.push(De.add(De.create(),l,A)),y.push(v(P));let D,k;for(let O=0;O<=m;O++){const N=QC/4*O/m,E=e3(N),B=JC(N);if(O>0){P=[];let W;W=De.add(De.create(),a,De.subtract(b,De.scale(b,x,D),De.scale(_,d,k))),P.push(W),W=De.add(De.create(),a,De.subtract(b,De.scale(b,A,D),De.scale(_,d,k))),P.push(W),O<m&&(W=De.add(De.create(),a,De.subtract(b,De.scale(b,A,E),De.scale(_,d,B))),P.push(W)),W=De.add(De.create(),a,De.subtract(b,De.scale(b,x,E),De.scale(_,d,B))),P.push(W),y.push(v(P)),P=[],W=De.add(De.create(),De.scale(b,x,D),De.scale(_,d,k)),De.add(W,W,l),P.push(W),W=De.add(De.create(),De.scale(b,A,D),De.scale(_,d,k)),De.add(W,W,l),P.push(W),O<m&&(W=De.add(De.create(),De.scale(b,A,E),De.scale(_,d,B)),De.add(W,W,l),P.push(W)),W=De.add(De.create(),De.scale(b,x,E),De.scale(_,d,B)),De.add(W,W,l),P.push(W),P.reverse(),y.push(v(P))}D=E,k=B}}x=A}return fhe.create(y)},"roundedCylinder");var vhe=ghe;const{EPS:t3,TAU:vm}=at,rn=gt,yhe=Ct,{isGT:_he,isGTE:bhe,isNumberArray:n3}=oi,whe=u(n=>{const e={center:[0,0],size:[2,2],roundRadius:.2,segments:32};let{center:t,size:i,roundRadius:s,segments:r}=Object.assign({},e,n);if(!n3(t,2))throw new Error("center must be an array of X and Y values");if(!n3(i,2))throw new Error("size must be an array of X and Y values");if(!i.every(m=>m>0))throw new Error("size values must be greater than zero");if(!_he(s,0))throw new Error("roundRadius must be greater than zero");if(!bhe(r,4))throw new Error("segments must be four or more");if(i=i.map(m=>m/2),s>i[0]-t3||s>i[1]-t3)throw new Error("roundRadius must be smaller then the radius of all dimensions");const o=Math.floor(r/4),a=rn.add(rn.create(),t,[i[0]-s,i[1]-s]),l=rn.add(rn.create(),t,[s-i[0],i[1]-s]),c=rn.add(rn.create(),t,[s-i[0],s-i[1]]),h=rn.add(rn.create(),t,[i[0]-s,s-i[1]]),f=[],d=[],p=[],g=[];for(let m=0;m<=o;m++){const v=vm/4*m/o,y=rn.fromAngleRadians(rn.create(),v);rn.scale(y,y,s),f.push(rn.add(rn.create(),a,y)),rn.rotate(y,y,rn.create(),vm/4),d.push(rn.add(rn.create(),l,y)),rn.rotate(y,y,rn.create(),vm/4),p.push(rn.add(rn.create(),c,y)),rn.rotate(y,y,rn.create(),vm/4),g.push(rn.add(rn.create(),h,y))}return yhe.fromPoints(f.concat(d,p,g))},"roundedRectangle");var xhe=whe;const Ahe=dL,{isGT:Mhe}=oi,She=u(n=>{const e={center:[0,0],size:2};let{center:t,size:i}=Object.assign({},e,n);if(!Mhe(i,0))throw new Error("size must be greater than zero");return i=[i,i],Ahe({center:t,size:i})},"square");var Che=She;const{TAU:pL}=at,jf=gt,Ehe=Ct,{isGT:The,isGTE:ym,isNumberArray:Phe}=oi,Rhe=u((n,e)=>n>0&&e>1&&e<n/2?Math.cos(Math.PI*e/n)/Math.cos(Math.PI*(e-1)/n):0,"getRadiusRatio"),i3=u((n,e,t,i)=>{const s=pL/n,r=[];for(let o=0;o<n;o++){const a=jf.fromAngleRadians(jf.create(),s*o+t);jf.scale(a,a,e),jf.add(a,i,a),r.push(a)}return r},"getPoints"),Ihe=u(n=>{const e={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0};let{center:t,vertices:i,outerRadius:s,innerRadius:r,density:o,startAngle:a}=Object.assign({},e,n);if(!Phe(t,2))throw new Error("center must be an array of X and Y values");if(!ym(i,2))throw new Error("vertices must be two or more");if(!The(s,0))throw new Error("outerRadius must be greater than zero");if(!ym(r,0))throw new Error("innerRadius must be greater than zero");if(!ym(a,0))throw new Error("startAngle must be greater than zero");if(i=Math.floor(i),o=Math.floor(o),a=a%pL,r===0){if(!ym(o,2))throw new Error("density must be two or more");r=s*Rhe(i,o)}const l=jf.clone(t),c=i3(i,s,a,l),h=i3(i,r,a+Math.PI/i,l),f=[];for(let d=0;d<i;d++)f.push(c[d]),f.push(h[d]);return Ehe.fromPoints(f)},"star");var Dhe=Ihe;const{TAU:Lhe}=at,Ohe=QD,{rotate:khe}=Wf,{translate:Nhe}=Ll,Fhe=cL,{isGT:ny,isGTE:iy}=oi,zhe=u(n=>{const e={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:Lhe},{innerRadius:t,innerSegments:i,outerRadius:s,outerSegments:r,innerRotation:o,startAngle:a,outerRotation:l}=Object.assign({},e,n);if(!ny(t,0))throw new Error("innerRadius must be greater than zero");if(!iy(i,3))throw new Error("innerSegments must be three or more");if(!ny(s,0))throw new Error("outerRadius must be greater than zero");if(!iy(r,3))throw new Error("outerSegments must be three or more");if(!iy(a,0))throw new Error("startAngle must be positive");if(!ny(l,0))throw new Error("outerRotation must be greater than zero");if(t>=s)throw new Error("inner circle is two large to rotate about the outer circle");let c=Fhe({radius:t,segments:i});return o!==0&&(c=khe([0,0,o],c)),c=Nhe([s,0],c),Ohe({startAngle:a,angle:l,segments:r},c)},"torus");var Bhe=zhe;const{NEPS:ih}=at,nf=gt,Uhe=Ct,{isNumberArray:$he}=oi,E_=u((n,e,t)=>Math.acos((n*n+e*e-t*t)/(2*n*e)),"solveAngleFromSSS"),Vhe=u((n,e,t)=>e>ih?Math.sqrt(n*n+t*t-2*n*t*Math.cos(e)):Math.sqrt((n-t)*(n-t)+n*t*e*e*(1-e*e/12)),"solveSideFromSAS"),Ghe=u(n=>{if(Math.abs(n[0]+n[1]+n[2]-Math.PI)>ih)throw new Error("AAA triangles require angles that sum to PI");const t=n[0],i=n[1],s=Math.PI-t-i,r=1,o=r/Math.sin(s)*Math.sin(t),a=r/Math.sin(s)*Math.sin(i);return mh(t,i,s,o,a,r)},"solveAAA"),Hhe=u(n=>{const e=n[0],t=n[1],i=Math.PI+ih-e-t;if(i<ih)throw new Error("AAS triangles require angles that sum to PI");const s=n[2],r=s/Math.sin(e)*Math.sin(t),o=s/Math.sin(e)*Math.sin(i);return mh(e,t,i,s,r,o)},"solveAAS"),Whe=u(n=>{const e=n[0],t=n[2],i=Math.PI+ih-e-t;if(i<ih)throw new Error("ASA triangles require angles that sum to PI");const s=n[1],r=s/Math.sin(i)*Math.sin(e),o=s/Math.sin(i)*Math.sin(t);return mh(e,t,i,r,o,s)},"solveASA"),jhe=u(n=>{const e=n[0],t=n[1],i=n[2],s=Vhe(e,t,i),r=E_(s,e,i),o=Math.PI-r-t;return mh(r,t,o,i,s,e)},"solveSAS"),Xhe=u(n=>{const e=n[0],t=n[1],i=n[2],s=Math.asin(t*Math.sin(i)/e),r=Math.PI-s-i,o=e/Math.sin(i)*Math.sin(r);return mh(s,r,i,t,o,e)},"solveSSA"),Yhe=u(n=>{const e=n[1],t=n[2],i=n[0];if(e+t<=i||t+i<=e||i+e<=t)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");const s=E_(t,i,e),r=E_(i,e,t),o=Math.PI-s-r;return mh(s,r,o,e,t,i)},"solveSSS"),mh=u((n,e,t,i,s,r)=>{const o=nf.fromValues(0,0),a=nf.fromValues(r,0),l=nf.fromValues(i,0);return nf.add(l,nf.rotate(l,l,[0,0],Math.PI-e),a),Uhe.fromPoints([o,a,l])},"createTriangle"),qhe=u(n=>{const e={type:"SSS",values:[1,1,1]};let{type:t,values:i}=Object.assign({},e,n);if(typeof t!="string")throw new Error("triangle type must be a string");if(t=t.toUpperCase(),!((t[0]==="A"||t[0]==="S")&&(t[1]==="A"||t[1]==="S")&&(t[2]==="A"||t[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!$he(i,3))throw new Error("triangle values must contain three values");if(!i.every(s=>s>0))throw new Error("triangle values must be greater than zero");switch(t){case"AAA":return Ghe(i);case"AAS":return Hhe(i);case"ASA":return Whe(i);case"SAS":return jhe(i);case"SSA":return Xhe(i);case"SSS":return Yhe(i);default:throw new Error("invalid triangle type, try again")}},"triangle");var Zhe=qhe,oo={arc:gue,circle:cL,cube:Iue,cuboid:uL,cylinder:$ue,cylinderElliptic:hL,ellipse:lL,ellipsoid:Ew,geodesicSphere:Zue,line:Jue,polygon:the,polyhedron:fL,rectangle:dL,roundedCuboid:hhe,roundedCylinder:vhe,roundedRectangle:xhe,sphere:ZD,square:Che,star:Dhe,torus:Bhe,triangle:Zhe};class f1 extends it{constructor(e=(s,r,o)=>o.set(s,r,Math.cos(s)*Math.sin(r)),t=8,i=8){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};const s=[],r=[],o=[],a=[],l=1e-5,c=new T,h=new T,f=new T,d=new T,p=new T,g=t+1;for(let m=0;m<=i;m++){const v=m/i;for(let y=0;y<=t;y++){const b=y/t;e(b,v,h),r.push(h.x,h.y,h.z),b-l>=0?(e(b-l,v,f),d.subVectors(h,f)):(e(b+l,v,f),d.subVectors(f,h)),v-l>=0?(e(b,v-l,f),p.subVectors(h,f)):(e(b,v+l,f),p.subVectors(f,h)),c.crossVectors(d,p).normalize(),o.push(c.x,c.y,c.z),a.push(b,v)}}for(let m=0;m<i;m++)for(let v=0;v<t;v++){const y=m*g+v,b=m*g+v+1,_=(m+1)*g+v+1,x=(m+1)*g+v;s.push(y,b,x),s.push(b,_,x)}this.setIndex(s),this.setAttribute("position",new Ve(r,3)),this.setAttribute("normal",new Ve(o,3)),this.setAttribute("uv",new Ve(a,2))}}u(f1,"ParametricGeometry");const ec={klein:function(n,e,t){e*=Math.PI,n*=2*Math.PI,e=e*2;let i,s;e<Math.PI?(i=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(e)*Math.cos(n),s=-8*Math.sin(e)-2*(1-Math.cos(e)/2)*Math.sin(e)*Math.cos(n)):(i=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(n+Math.PI),s=-8*Math.sin(e));const r=-2*(1-Math.cos(e)/2)*Math.sin(n);t.set(i,r,s)},plane:function(n,e){return function(t,i,s){const r=t*n,o=0,a=i*e;s.set(r,o,a)}},mobius:function(n,e,t){n=n-.5;const i=2*Math.PI*e,s=2,r=Math.cos(i)*(s+n*Math.cos(i/2)),o=Math.sin(i)*(s+n*Math.cos(i/2)),a=n*Math.sin(i/2);t.set(r,o,a)},mobius3d:function(n,e,t){n*=Math.PI,e*=2*Math.PI,n=n*2;const i=n/2,s=2.25,r=.125,o=.65;let a=r*Math.cos(e)*Math.cos(i)-o*Math.sin(e)*Math.sin(i);const l=r*Math.cos(e)*Math.sin(i)+o*Math.sin(e)*Math.cos(i),c=(s+a)*Math.sin(n);a=(s+a)*Math.cos(n),t.set(a,c,l)}};ec.TubeGeometry=u(class extends f1{constructor(e,t=64,i=1,s=8,r=!1){const o=t+1,a=e.computeFrenetFrames(t,r),l=a.tangents,c=a.normals,h=a.binormals,f=new T;function d(p,g,m){g*=2*Math.PI;const v=Math.floor(p*(o-1));e.getPointAt(p,f);const y=c[v],b=h[v],_=-i*Math.cos(g),x=i*Math.sin(g);f.x+=_*y.x+x*b.x,f.y+=_*y.y+x*b.y,f.z+=_*y.z+x*b.z,m.copy(f)}u(d,"ParametricTube"),super(d,t,s),this.tangents=l,this.normals=c,this.binormals=h,this.path=e,this.segments=t,this.radius=i,this.segmentsRadius=s,this.closed=r}},"TubeGeometry");ec.TorusKnotGeometry=u(class extends ec.TubeGeometry{constructor(e=200,t=40,i=64,s=8,r=2,o=3){class a extends Ab{getPoint(d,p=new T){const g=p;d*=Math.PI*2;const m=.5,v=(1+m*Math.cos(o*d))*Math.cos(r*d),y=(1+m*Math.cos(o*d))*Math.sin(r*d),b=m*Math.sin(o*d);return g.set(v,y,b).multiplyScalar(e)}}u(a,"TorusKnotCurve");const l=i,c=s,h=new a;super(h,l,t,c,!0,!1),this.radius=e,this.tube=t,this.segmentsT=i,this.segmentsR=s,this.p=r,this.q=o}},"TorusKnotGeometry");ec.SphereGeometry=u(class extends f1{constructor(e,t,i){function s(r,o,a){r*=Math.PI,o*=2*Math.PI;const l=e*Math.sin(r)*Math.cos(o),c=e*Math.sin(r)*Math.sin(o),h=e*Math.cos(r);a.set(l,c,h)}u(s,"sphere"),super(s,t,i)}},"SphereGeometry");ec.PlaneGeometry=u(class extends f1{constructor(e,t,i,s){function r(o,a,l){const c=o*e,h=0,f=a*t;l.set(c,h,f)}u(r,"plane"),super(r,i,s)}},"PlaneGeometry");var Khe=Object.defineProperty,mL=u((n,e)=>Khe(n,"name",{value:e,configurable:!0}),"__name$1v");const _m=new T,Qhe=[1,1,1];function gL(n){const e=[],t=[],i=[],s=[];let r=0;for(let o of n.polygons){vL(_m,o);const a=o.color||n.color||Qhe;for(let c of o.vertices)e.push(...c),t.push(_m.x,_m.y,_m.z),i.push(a[0],a[1],a[2]);const l=o.vertices.length;for(let c=2;c<l;++c)s.push(r,r+c-1,r+c);r+=l}return new it().setAttribute("position",new Ve(new Float32Array(e),3)).setAttribute("normal",new Ve(new Float32Array(t),3)).setAttribute("color",new Ve(new Float32Array(i),3)).setIndex(s)}u(gL,"geom3ToBufferGeometry");mL(gL,"geom3ToBufferGeometry");const sy=new T,s3=new T,r3=new T,o3=new T,a3=new T;function vL(n,e){const t=e.vertices;return sy.fromArray(t[0]),s3.fromArray(t[1]),r3.fromArray(t[2]),o3.subVectors(s3,sy),a3.subVectors(r3,sy),n.crossVectors(o3,a3),n.normalize(),n}u(vL,"calculatePoly3Normal");mL(vL,"calculatePoly3Normal");var Jhe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAOJJREFUSImtVUkSBCEIS6bm322/nD6MWi7I0jUclZBQBiFiUZLnPb6RwiJyaZckXaITwVSY5K0lDfdHIo2gKIVVha3wQqTmjsWlJpmJK27B2sW9xAz2o2WTvGvbEZIiItfpnTYFzlkaZ9m0kERVB4VoVG6JcJW+6a7fe4MG7J0gqhzwJ3kjAfp8uMWBg4v+GeEORisaD/+KYHOL465jEc0VlltCGHMOHLd4c2IqyvxHJk51Ucbn+HXS/q6cmgig4ZDoukiNAFFR8qdQN9phU20R2Xw6clZoLX1zpUYIJqLEeY8HyX71TroxJVAAAAAASUVORK5CYII=",efe=Object.defineProperty,tfe=u((n,e)=>efe(n,"name",{value:e,configurable:!0}),"__name$1u");const nfe=ec.SphereGeometry,rl=new T,ao=new je,ca=new T,Oc=new T(0,0,1),ol=new T,l3=new je,bm=new ve,wm=new Array(16).fill(0),c3=new Ks({toneMapped:!1,color:15114812,transparent:!0,opacity:.5,depthTest:!1}),ife=new Ks({toneMapped:!1,transparent:!0,opacity:0,depthTest:!1,depthWrite:!1}),sfe=new Xd,T_=sfe.load(Jhe);T_.minFilter=T_.magFilter=zn;const rfe=new Fr({map:T_,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24});class Pw extends Ls{begin(e){const t=e.readonlyRef().model;if(!t.dirty)return;const i=[...t.nodes];for(;i.length;){const s=i.pop();if(!s)break;s.has(He)?(this.updateMatrix(s),s.instanceId||e.throttle(`#${s.id}-update-csg`,50,()=>{this.updateGeometry(t,s)},!1)):i.push(...s.children)}}updateMatrix(e){if(!e.has(He))return;const t=e.get(He);if(t.dirty&&!e.instanceId)for(let i of e.children)this.updateMatrix(i);t.matDirty&&(t.matDirty=!1,e.has(Le)?rl.copy(e.value(Le)):rl.set(0,0,0),e.has(Qe)?ao.setFromEuler(e.value(Qe)):ao.set(0,0,0,1),e.has(St)?ca.copy(e.value(St)):e.has(Ft)?ca.setScalar(e.value(Ft)):ca.setScalar(1),t.matrix.compose(rl,ao,ca),!e.instanceId&&!t.dirty&&t.value&&t.matrix.toArray(t.value.transforms=[...t.value.transforms]))}updateGeometry(e,t){if(!t.has(He))return;const i=t.get(He);if(i.dirty){if(i.dirty=!1,!t.instanceId){for(let r of t.children)this.updateGeometry(e,r);switch(t.type){case"CsgGroup":{let r=null,o=!0,a=[];for(let l of t.children){if(!l.value(ht))continue;let c=null;if(l.instanceId){if(c=e.getNode(l.instanceId).value(He),!c)continue;c=Object.assign({},c),c.transforms=[...c.transforms],l.get(He).matrix.toArray(c.transforms)}else{if(c=l.value(He),!c)continue;c=Object.assign({},c)}const h=l.value(gi)==="positive";o===h?a.push(c):(o?(r&&(a=[r,...a]),a.length&&(r=ir.union(...a))):r&&(r=ir.subtract(r,...a)),a=[c],o=h)}if(a.length&&(o?(r&&(a=[r,...a]),r=ir.union(...a)):r&&(r=ir.subtract(r,...a))),r)switch(t.value(Li)){case"x":r=ir.union(r,Xv.mirrorX(r));break;case"y":r=ir.union(r,Xv.mirrorY(r));break;case"z":r=ir.union(r,Xv.mirrorZ(r));break}i.value=r}break;case"CsgIntersect":{const r=[];for(let o of t.children){if(!o.value(ht))continue;let a=null;if(o.instanceId){if(a=e.getNode(o.instanceId).value(He),!a)continue;a=Object.assign({},a),a.transforms=[...a.transforms],o.get(He).matrix.toArray(a.transforms)}else{if(a=o.value(He),!a)continue;a=Object.assign({},a)}r.push(Object.assign({},a))}r.length?i.value=r.length>1?ir.intersect(...r):ir.union(r[0]):i.value=null}break;case"CsgHull":{const r=[];for(let o of t.children){if(!o.value(ht))continue;let a=null;if(o.instanceId){if(a=e.getNode(o.instanceId).value(He),!a)continue;a=Object.assign({},a),a.transforms=[...a.transforms],o.get(He).matrix.toArray(a.transforms)}else{if(a=o.value(He),!a)continue;a=Object.assign({},a)}r.push(Object.assign({},a))}r.length?i.value=r.length>1?bC.hull(...r):ir.union(r[0]):i.value=null}break;case"CsgHullChain":{const r=[];for(let o of t.children){if(!o.value(ht))continue;let a=null;if(o.instanceId){if(a=e.getNode(o.instanceId).value(He),!a)continue;a=Object.assign({},a),a.transforms=[...a.transforms],o.get(He).matrix.toArray(a.transforms)}else{if(a=o.value(He),!a)continue;a=Object.assign({},a)}r.push(Object.assign({},a))}r.length?i.value=r.length>1?bC.hullChain(...r):ir.union(r[0]):i.value=null}break;case"CsgEllipsoid":{const r=t.value(hr),o=Math.max(4,t.value(Zn));r.x>0&&r.y>0&&r.z>0?i.value=Ew({radius:[r.x,r.y,r.z],segments:o}):i.value=null}break;case"CsgCuboid":{const r=t.value(Hs),o=Math.min(t.value(Ps),r.x/2-1e-5,r.y/2-1e-5,r.z/2-1e-5),a=Math.max(4,t.value(Zn));r.x>0&&r.y>0&&r.z>0?o>0?i.value=oo.roundedCuboid({size:[r.x,r.y,r.z],roundRadius:o,segments:a}):i.value=oo.cuboid({size:[r.x,r.y,r.z]}):i.value=null}break;case"CsgCylinder":{const r=t.value(nn),o=t.value(as),a=Math.min(t.value(Ps),o-1e-5,r/2-1e-5),l=Math.max(4,t.value(Zn));r>0&&o>0?a>0?i.value=oo.roundedCylinder({height:r,radius:o,roundRadius:a,segments:l}):i.value=oo.cylinder({height:r,radius:o,segments:l}):i.value=null}break;case"CsgCylinderElliptic":{const r=t.value(nn),o=t.value(Ql),a=t.value(Xl),l=Math.max(4,t.value(Zn)),c=t.value(Bu);r>0&&(o.x>0||o.y>0||a.x>0||a.y>0)&&c[1]>c[0]?i.value=oo.cylinderElliptic({height:r,startRadius:[o.x,o.y],endRadius:[a.x,a.y],segments:l,startAngle:c[0]/180*Math.PI,endAngle:c[1]/180*Math.PI}):i.value=null}break;case"CsgTorus":{const r=t.value(Yl),o=t.value(ql),a=Math.max(3,t.value($u)),l=Math.max(3,t.value(Hu)),c=t.value(Uu)/180*Math.PI,h=t.value(Gu)/180*Math.PI;r>0&&o>0&&o>r&&h>0?i.value=oo.torus({innerRadius:r,outerRadius:o,innerSegments:a,outerSegments:l,innerRotation:c,outerRotation:h}):i.value=null}break;case"CsgBezier":{const r=t.value(Qu),o=t.value(Kl),a=t.value(Zl),l=t.value(Zu),c=Math.max(3,t.value(eh)),h=t.value(qu)/180*Math.PI,f=t.value(Yu)/180*Math.PI,d=Math.max(3,t.value(Zn)),p=Math.max(2,t.value(Vu));if(o.x>=0&&o.y>=0&&a.x>=0&&a.y>=0&&(o.x||o.y||a.x||a.y)&&!(r==="star"&&l===0)&&t.children.length>1){const g=[];for(let b of t.children)g.push(b.value(Le).toArray([0,0,0]));let m;switch(r){case"ellipse":m=oo.ellipse({radius:[Math.max(at.EPS,o.x),Math.max(at.EPS,o.y)],segments:d});break;case"rectangle":m=oo.rectangle({size:[Math.max(at.EPS,o.x),Math.max(at.EPS,o.y)]});break;case"star":m=oo.star({outerRadius:Math.max(at.EPS,o.x),innerRadius:Math.max(at.EPS,o.x*l),vertices:c});break;default:throw new Error(`Unknown shape ${r}`)}const v=bv.create(g);let y=dm.slice.fromSides(m.sides);t.value(Ku)?(ol.set(g[1][0]-g[0][0],g[1][1]-g[0][1],g[1][2]-g[0][2]).normalize(),ol.lengthSq()<.5&&ol.set(0,0,1),Oc.set(0,0,1),rl.set(0,0,0),ao.setFromUnitVectors(Oc,ol),ca.set(1,1,1),bm.compose(rl,ao,ca),bm.toArray(wm),y=dm.slice.transform(wm,y),Oc.copy(ol)):Oc.set(0,0,1),i.value=dm.extrudeFromSlices({numberOfSlices:p,capStart:!0,capEnd:!0,callback:(b,_,x)=>{const w=bv.valueAt(b,v),M=bv.tangentAt(b,v);rl.fromArray(w),ol.fromArray(M).normalize(),ao.setFromUnitVectors(Oc,ol);const C=(h-f)*b+h;l3.setFromAxisAngle(Oc,C),ao.multiplyQuaternions(ao,l3);let A=(a.x-o.x)*b+o.x,P=(a.y-o.y)*b+o.y;return A=A/Math.max(o.x,at.EPS),P=P/Math.max(o.y,at.EPS),r==="star"&&(P*=o.y/Math.max(at.EPS,o.x)),ca.set(Math.max(at.EPS,A),Math.max(at.EPS,P),1),bm.compose(rl,ao,ca),bm.toArray(wm),dm.slice.transform(wm,x)}},y)}else i.value=null}break;case"CsgBezierControlPoint":i.value=null;break;default:throw new Error(`Unknown csg node type [${t.type}]`)}}const s=t.get(Me);if(t.type==="CsgBezierControlPoint")t.instanceId||(s.value||(s.value=new We(new nfe(.001,8,8),ife),s.value.visible=!1),i.placeholder=new Pa(new it().setFromPoints([new T]),rfe),i.placeholder.renderOrder=2);else if(t.instanceId){const r=e.getNode(t.instanceId).get(He).placeholder;if(r){const o=r;o.isMesh&&(i.placeholder=new We(o.geometry,c3))}}else{const r=i.value?gL(i.value):new it;if(s.value){const o=s.value.children[0];o.geometry.dispose(),o.geometry=r,r.computeBoundingSphere()}else{const o=s.value=new ni;o.userData.node=t;const a=new We(r,new Ks);a.userData.node=t,o.add(a)}i.placeholder&&(i.placeholder.removeFromParent(),delete i.placeholder),r&&(i.placeholder=new We(r,c3)),e.instanceMeshUpdated(t.id,!0)}i.useTempMat=!1,t.instanceId||(i.value&&i.matrix.toArray(i.value.transforms=[...i.value.transforms]),e.dirty=!0,t.dirty=!0,s.parentChanged=!0,s.localTransformChanged=!0,s.worldTransformChanged=!0)}}end(e){}}u(Pw,"CsgUpdateSystem");tfe(Pw,"CsgUpdateSystem");var ofe=Object.defineProperty,afe=u((n,e)=>ofe(n,"name",{value:e,configurable:!0}),"__name$1t");class Rw extends Ls{begin(e){e.history.update()}end(e){}}u(Rw,"HistorySystem");afe(Rw,"HistorySystem");var lfe=Object.defineProperty,cfe=u((n,e)=>lfe(n,"name",{value:e,configurable:!0}),"__name$1s");class Iw extends Ls{constructor(){super(...arguments);S(this,"showIkBones",!1)}setup(t){this.showIkBones=t.options.showIkBones}begin(t){t=t.readonlyRef(),t.options.showIkBones!==this.showIkBones&&(this.showIkBones=t.options.showIkBones,t.model.forEach(i=>{if(i.has(xt)){const s=i.get(xt);s.boneMesh&&(s.boneMesh.visible=t.options.showIkBones),s.hingeIndicator&&(s.hingeIndicator.visible=t.options.showIkBones&&s.hingeEnabled)}}))}end(t){}}u(Iw,"IkBoneVisibleUpdateSystem");cfe(Iw,"IkBoneVisibleUpdateSystem");var ufe=Object.defineProperty,hfe=u((n,e)=>ufe(n,"name",{value:e,configurable:!0}),"__name$1r");class Dw extends Ls{constructor(){super(...arguments);S(this,"ambientLight",new z0(16777215,.05))}setup(t){t.scene.add(this.ambientLight)}begin(t){if(t=t.readonlyRef(),t.options.shadingMode==="solid"){t.renderer.physicallyCorrectLights=!1,this.ambientLight.visible=!0;for(let r of t.views){if(!r.enabled)continue;const o=r.defaultLights;o.position.copy(r.camera._position).addScaledVector(r.camera._dir,2),o.up.copy(r.camera._up),o.lookAt(r.camera.target)}}else this.ambientLight.visible=!1,t.renderer.physicallyCorrectLights=!0;const i=t.options.shadingMode==="rendered",s=t.options.showLightHelpers;t.model.forEach(r=>{if(Kn(r.type).light){const o=r.value(Me),a=r.visible;if(o&&(o.visible=i&&a),r.has(Yi)){const l=r.get(Yi),c=t.model.selected.includes(r.id)||!!r.children.length&&t.model.selected.includes(r.children[0].id);l.value&&(l.value.visible=a&&(s||c)),l.camera&&(l.camera.visible=i&&o.castShadow&&a&&(s||c))}}})}end(t){}}u(Dw,"LightUpdateSystem");hfe(Dw,"LightUpdateSystem");var ffe=Object.defineProperty,dfe=u((n,e)=>ffe(n,"name",{value:e,configurable:!0}),"__name$1q");class Lw{update(e,t){if(t.instanceId||t.type!=="Box")return;const i=t.get(Gs);if(!i.dirty)return;i.dirty=!1;const s=t.get(Me),r=i.value,o=new ur(r.x,r.y,r.z);if(s.value){const a=s.value;a.geometry.dispose(),a.geometry=o}else s.value=new We(o,new Ks),s.value.userData={node:t},s.parentChanged=!0,s.localTransformChanged=!0;o.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)}}u(Lw,"BoxUpdateFilter");dfe(Lw,"BoxUpdateFilter");var pfe=Object.defineProperty,mfe=u((n,e)=>pfe(n,"name",{value:e,configurable:!0}),"__name$1p");class $r{constructor(e=0){S(this,"bits");this.bits=new Uint32Array((e>>>5)+1)}checkCapacity(e){if(e>this.bits.length){const t=new Uint32Array(e);t.set(this.bits,0),this.bits=t}}expandCapacity(e){this.checkCapacity((e>>>5)+1)}clear(){for(let e=0,t=this.bits.length;e<t;++e)this.bits[e]=0}set(e){const t=e>>>5;this.checkCapacity(t+1),this.bits[t]=(this.bits[t]|1<<(e&31))>>>0}get(e){const t=e>>>5;return t>=this.bits.length?!1:(this.bits[t]&1<<(e&31))!==0}clearBit(e){const t=e>>>5;t>=this.bits.length||(this.bits[t]=(this.bits[t]&~(1<<(e&31)))>>>0)}setBit(e,t){t?this.set(e):this.clearBit(e)}and(e){const t=Math.min(this.bits.length,e.bits.length);for(let i=0;i<t;++i)this.bits[i]=(this.bits[i]&e.bits[i])>>>0;if(this.bits.length>t)for(let i=t,s=this.bits.length;i<s;++i)this.bits[i]=0}or(e){const t=Math.min(this.bits.length,e.bits.length);for(let i=0;i<t;++i)this.bits[i]=(this.bits[i]|e.bits[i])>>>0;if(e.bits.length>t){this.checkCapacity(e.bits.length);for(let i=t,s=e.bits.length;i<s;++i)this.bits[i]=e.bits[i]}}equals(e){const t=this.bits.length>=e.bits.length?this:e,i=t===this?e:this;for(let s=0,r=i.bits.length;s<r;++s)if(t.bits[s]!==i.bits[s])return!1;for(let s=t.bits.length-i.bits.length+1,r=t.bits.length;s<r;++s)if(t.bits[s])return!1;return!0}intersects(e){for(let t=0,i=Math.min(this.bits.length,e.bits.length);t<i;++t)if((this.bits[t]&e.bits[t])!==0)return!0;return!1}containsAll(e){if(e.bits.length>this.bits.length){for(let t=this.bits.length,i=e.bits.length;t<i;++t)if(e.bits[t]!==0)return!1}for(let t=0,i=Math.min(this.bits.length,e.bits.length);t<i;++t)if((this.bits[t]&e.bits[t])!==e.bits[t])return!1;return!0}isEmpty(){for(let e=0,t=this.bits.length;e<t;++e)if(this.bits[e]!==0)return!1;return!0}clone(){const e=new $r;return e.bits=this.bits.slice(),e}}u($r,"Bits");mfe($r,"Bits");var gfe=Object.defineProperty,yL=u((n,e)=>gfe(n,"name",{value:e,configurable:!0}),"__name$1o");const Ol=new DataView(new ArrayBuffer(12)),u3=new Array(8),h3=new Array(8);function P_(n,e){Ol.setUint32(0,n),Ol.setUint32(4,e);for(let t=0;t<8;++t)u3[t]=String.fromCharCode(Ol.getUint8(t));return u3.join("")}u(P_,"hashUint32x2");yL(P_,"hashUint32x2");function Ow(n,e,t){Ol.setFloat32(0,n||0),Ol.setFloat32(4,e||0),Ol.setFloat32(8,t||0);for(let i=0;i<12;++i)h3[i]=String.fromCharCode(Ol.getUint8(i));return h3.join("")}u(Ow,"hashFloat32x3");yL(Ow,"hashFloat32x3");var vfe=Object.defineProperty,_L=u((n,e)=>vfe(n,"name",{value:e,configurable:!0}),"__name$1n");const vi=new T,ry=new Qn,xm=new Qn,f3=new T,d3=new T,p3=new T,yfe=new T;function R_(n,e){if(e.isLeaf=!1,e.depth>=Nr.MAX_DEPTH){e.isLeaf=!0;return}if(e.indices.length<=Nr.MAX_TRI_PER_NODE){e.isLeaf=!0;return}if(!e.indices.length){e.isLeaf=!0;return}xm.makeEmpty();for(let t of e.indices)xm.expandByPoint(n.getTriangleCenter(vi,t));e.splitCenter.copy(xm.min).add(xm.max).multiplyScalar(.5),e.children.length=0;for(let t=0;t<8;++t){const i=new Nr;i.depth=e.depth+1,e.children.push(i)}for(let t of e.indices)n.getTriangleCenter(vi,t),vi.x<e.splitCenter.x?vi.y<e.splitCenter.y?vi.z<e.splitCenter.z?e.children[0].indices.push(t):e.children[1].indices.push(t):vi.z<e.splitCenter.z?e.children[2].indices.push(t):e.children[3].indices.push(t):vi.y<e.splitCenter.y?vi.z<e.splitCenter.z?e.children[4].indices.push(t):e.children[5].indices.push(t):vi.z<e.splitCenter.z?e.children[6].indices.push(t):e.children[7].indices.push(t)}u(R_,"constructChildren");_L(R_,"constructChildren");const s0=class{constructor(){S(this,"depth",1);S(this,"children",[]);S(this,"box",new Qn);S(this,"splitCenter",new T);S(this,"isLeaf",!1);S(this,"indices",[])}build(e){this.indices.length=0;for(let i=0;i<e.triNum;++i)this.indices.push(i);const t=[this];for(;t.length;){const i=t.pop();if(!i)break;i.recomputeBox(e),R_(e,i),i.isLeaf||t.push(...i.children)}}recomputeBox(e){this.box.makeEmpty();for(let t of this.indices)this.box.union(e.getTriangleBox(ry,t));this.box.expandByScalar(1e-7)}update(e,t){if(!t.length)return;const i=new $r(e.triNum);for(let r of t)i.set(r);const s=new Set;{const r=[this];for(;r.length;){const o=r.pop();if(!o)break;let a=!1;if(o.depth===1)a=!0;else{const l=o.indices.filter(c=>!i.get(c));a=l.length!==o.indices.length,o.indices=l}a&&(o.indices.length?(s.add(o),r.push(...o.children)):(o.box.makeEmpty(),o.isLeaf=!0,o.children.length=0))}}{const r=[[this,t]];for(;r.length;){const o=r.pop();if(!o)break;const a=o[0],l=o[1];if(s.add(a),a.depth!==1&&a.indices.push(...l),a.isLeaf){if(a.indices.length<=s0.MAX_TRI_PER_NODE||a.depth>=s0.MAX_DEPTH)continue;const y=[a];for(;y.length;){const b=y.pop();if(!b)break;b.recomputeBox(e),R_(e,b),b.isLeaf||y.push(...b.children)}continue}const c=[],h=[],f=[],d=[],p=[],g=[],m=[],v=[];for(let y of l)e.getTriangleCenter(vi,y),vi.x<a.splitCenter.x?vi.y<a.splitCenter.y?vi.z<a.splitCenter.z?c.push(y):h.push(y):vi.z<a.splitCenter.z?f.push(y):d.push(y):vi.y<a.splitCenter.y?vi.z<a.splitCenter.z?p.push(y):g.push(y):vi.z<a.splitCenter.z?m.push(y):v.push(y);c.length&&r.push([a.children[0],c]),h.length&&r.push([a.children[1],h]),f.length&&r.push([a.children[2],f]),d.length&&r.push([a.children[3],d]),p.length&&r.push([a.children[4],p]),g.length&&r.push([a.children[5],g]),m.length&&r.push([a.children[6],m]),v.length&&r.push([a.children[7],v])}}for(let r of s)r.recomputeBox(e)}raycast(e,t,i){const s=[],r=[this],o=1/t.direction.x,a=1/t.direction.y,l=1/t.direction.z;for(;r.length;){const c=r.pop();if(!c)break;const h=(c.box.min.x-t.origin.x)*o,f=(c.box.max.x-t.origin.x)*o,d=(c.box.min.y-t.origin.y)*a,p=(c.box.max.y-t.origin.y)*a,g=(c.box.min.z-t.origin.z)*l,m=(c.box.max.z-t.origin.z)*l,v=Math.max(Math.min(h,f),Math.min(d,p),Math.min(g,m)),y=Math.min(Math.max(h,f),Math.max(d,p),Math.max(g,m));if(!(y<0||v>y))if(c.isLeaf)for(let b of c.indices){e.getTriangle(f3,d3,p3,b);const _=t.intersectTriangle(f3,d3,p3,i,yfe);if(_){const x=new T().copy(_),w=e.getNormal(new T,b),M=t.origin.distanceTo(x);s.push({point:x,normal:w,distance:M,triangleIndex:b})}}else r.push(...c.children)}return s.sort((c,h)=>c.distance-h.distance)}intersectSphere(e,t){const i=[this],s=[];for(;i.length;){const r=i.pop();if(!r)break;if(!!r.box.intersectsSphere(t))if(r.isLeaf)for(let o of r.indices)e.getTriangleBox(ry,o),ry.intersectsSphere(t)&&s.push(o);else i.push(...r.children)}return s}};let Nr=s0;u(Nr,"OctreeNode"),S(Nr,"MAX_DEPTH",8),S(Nr,"MAX_TRI_PER_NODE",100);_L(Nr,"OctreeNode");var _fe=Object.defineProperty,bL=u((n,e)=>_fe(n,"name",{value:e,configurable:!0}),"__name$1m");const In=new T,_n=new T,Dn=new T,Am=new T,Cr=new T,lo=new T,bfe=new T,fi=1e-7;function Mg(n,e){let t=n.x,i=n.y,s=n.z,r=e.x,o=e.y,a=e.z;return t=Math.round(t/fi)*fi,i=Math.round(i/fi)*fi,s=Math.round(s/fi)*fi,r=Math.round(r/fi)*fi,o=Math.round(o/fi)*fi,a=Math.round(a/fi)*fi,t===r&&i===o&&s===a}u(Mg,"isSameVertex");bL(Mg,"isSameVertex");class kw{constructor(){S(this,"aPosition",new Float32Array);S(this,"aColor",new Float32Array);S(this,"aNormal",new Float32Array);S(this,"triCenter",new Float32Array);S(this,"triBox",new Float32Array);S(this,"triNum",0);S(this,"sharedVertexMap",new Uint32Array);S(this,"sharedVertexIndices",new Map);S(this,"edgeNeighborMap",new Uint32Array);S(this,"holes",new Uint8Array);S(this,"octree",new Nr);S(this,"dirtyTriangles",[]);S(this,"dirtyTrianglesMask",new $r);S(this,"positionNeedsUpdate",!1);S(this,"colorNeedsUpdate",!1)}buildFromTriangles(e,t){const i=this.aPosition=new Float32Array(e.length),s=this.aNormal=new Float32Array(e.length),r=this.aColor=new Float32Array(e.length);(t==null?void 0:t.length)!==r.length&&(t=void 0);let o=0;for(let a=0,l=e.length/9;a<l;++a)if(In.fromArray(e,a*9),_n.fromArray(e,a*9+3),Dn.fromArray(e,a*9+6),!(Mg(In,_n)||Mg(In,Dn)||Mg(_n,Dn))){for(let c=0;c<9;++c)i[o*9+c]=e[a*9+c];if(t)for(let c=0;c<9;++c)r[o*9+c]=t[a*9+c];else for(let c=0;c<9;++c)r[o*9+c]=1;Am.subVectors(In,_n),Cr.subVectors(Dn,_n),Cr.cross(Am).normalize();for(let c=0;c<3;++c){const h=o*9+c*3;s[h]=Cr.x,s[h+1]=Cr.y,s[h+2]=Cr.z}o+=1}o<e.length/9&&(this.aPosition=i.subarray(0,o*9),this.aNormal=s.subarray(0,o*9),this.aColor=r.subarray(0,o*9),console.info(`Discard ${e.length/9-o} zero area triangles`)),this.init()}init(){const e=this.aPosition,t=this.triNum=e.length/9,i=this.triCenter=new Float32Array(t*3),s=this.triBox=new Float32Array(t*6);for(let r=0;r<t;++r)In.fromArray(e,r*9),_n.fromArray(e,r*9+3),Dn.fromArray(e,r*9+6),lo.copy(In).add(_n).add(Dn).multiplyScalar(1/3),i[r*3]=lo.x,i[r*3+1]=lo.y,i[r*3+2]=lo.z,s[r*6]=Math.min(In.x,_n.x,Dn.x),s[r*6+1]=Math.min(In.y,_n.y,Dn.y),s[r*6+2]=Math.min(In.z,_n.z,Dn.z),s[r*6+3]=Math.max(In.x,_n.x,Dn.x),s[r*6+4]=Math.max(In.y,_n.y,Dn.y),s[r*6+5]=Math.max(In.z,_n.z,Dn.z);this.buildTriangleNeighborEdgeMap(),this.octree.build(this),this.dirtyTrianglesMask.expandCapacity(t)}buildTriangleNeighborEdgeMap(){const e=this.triNum,t=this.aPosition,i=this.sharedVertexMap=new Uint32Array(e*3),s=this.sharedVertexIndices;s.clear();const r=new Map;for(let p=0,g=e*3;p<g;++p){let m=t[p*3],v=t[p*3+1],y=t[p*3+2];m=Math.round(m/fi)*fi,v=Math.round(v/fi)*fi,y=Math.round(y/fi)*fi;const b=Ow(m,v,y);let _=r.get(b);_==null?(_=p,r.set(b,_),s.set(_,[])):s.get(_).push(p),i[p]=_}const o=new Map,a=new Uint8Array(e);let l=0,c=0;for(let p=0;p<e;++p){let g=!1;for(let m=0;m<3;++m){const v=p*3+m,y=i[v],b=i[p*3+(m+1)%3];if(y===b){g=!0;break}}if(g){c+=1,a[p]=1;continue}for(let m=0;m<3;++m){const v=p*3+m,y=i[v],b=i[p*3+(m+1)%3],_=P_(y,b);o.get(_)==null?o.set(_,v):l+=1}}c&&console.warn(`Mesh has ${c} zero area triangles`),l&&console.warn(`Mesh has ${l} duplicate edges (embedded faces may exist)`);const h=this.edgeNeighborMap=new Uint32Array(e*3),f=this.holes=new Uint8Array(e*3);let d=0;for(let p=0;p<e;++p)if(!a[p])for(let g=0;g<3;++g){const m=p*3+g,v=i[m],y=i[p*3+(g+1)%3],b=P_(y,v),_=o.get(b);_==null?(f[m]=1,d+=1):h[m]=_}d&&console.warn(`Mesh has ${d} edges border hole`)}getTriangleCenter(e,t){return e.fromArray(this.triCenter,t*3),e}getTriangleBox(e,t){return e.min.fromArray(this.triBox,t*6),e.max.fromArray(this.triBox,t*6+3),e}getTriangle(e,t,i,s){e.fromArray(this.aPosition,this.sharedVertexMap[s*3]*3),t.fromArray(this.aPosition,this.sharedVertexMap[s*3+1]*3),i.fromArray(this.aPosition,this.sharedVertexMap[s*3+2]*3)}getVertex(e,t){return e.fromArray(this.aPosition,t*3)}getNormal(e,t){return e.fromArray(this.aNormal,t*3*3),e}getAverageNormal(e,t){e.set(0,0,0);for(let i of t)e.add(this.getNormal(bfe,i));return e.normalize()}getAverageCenter(e,t){e.set(0,0,0);for(let i of t)e.add(this.getTriangleCenter(lo,i));return e.divideScalar(t.length)}toThree(e){if(e){const t=e,i=t.geometry.getAttribute("position");if(i.array===this.aPosition){if(this.positionNeedsUpdate){this.positionNeedsUpdate=!1,i.needsUpdate=!0;const s=t.geometry.getAttribute("normal");s.needsUpdate=!0}if(this.colorNeedsUpdate){this.colorNeedsUpdate=!1;const s=t.geometry.getAttribute("color");s.needsUpdate=!0}}else t.geometry.dispose(),t.geometry=new it,t.geometry.setAttribute("position",new Ve(this.aPosition,3)),t.geometry.setAttribute("normal",new Ve(this.aNormal,3)),t.geometry.setAttribute("color",new Ve(this.aColor,3));return t}else return new We(new it().setAttribute("position",new mn(this.aPosition,3)).setAttribute("normal",new mn(this.aNormal,3)).setAttribute("color",new mn(this.aColor,3)),new Ks({vertexColors:!0}))}raycast(e,t){return this.octree.raycast(this,e,t)}intersectSphere(e){return this.octree.intersectSphere(this,e)}getVertexTriangleIndex(e){return(e-e%3)/3}markTriangleDirty(e){this.dirtyTrianglesMask.get(e)||(this.dirtyTrianglesMask.set(e),this.dirtyTriangles.push(e))}updateVertices(e,t){const i=this.aPosition;for(let s=0,r=e.length;s<r;++s){const o=this.sharedVertexMap[e[s]];this.markTriangleDirty(this.getVertexTriangleIndex(o));for(let l=0;l<3;++l)i[o*3+l]=t[s*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a){this.markTriangleDirty(this.getVertexTriangleIndex(l));for(let c=0;c<3;++c)i[l*3+c]=t[s*3+c]}}this.positionNeedsUpdate=!0}updateColors(e,t){const i=this.aColor;for(let s=0,r=e.length;s<r;++s){const o=this.sharedVertexMap[e[s]];for(let l=0;l<3;++l)i[o*3+l]=t[s*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a)for(let c=0;c<3;++c)i[l*3+c]=t[s*3+c]}this.colorNeedsUpdate=!0}update(e){const t=this.dirtyTriangles,i=this.aPosition,s=this.aNormal,r=this.triCenter,o=this.triBox;let a=0,l=0,c=0,h=0,f=0,d=0,p=!1;if(e!=null&&e.boundingSphere){p=!0;const g=e.boundingSphere.center,m=e.boundingSphere.radius;a=g.x-m,l=g.y-m,c=g.z-m,h=g.x+m,f=g.y+m,d=g.z+m}for(let g of t){In.fromArray(i,g*9),_n.fromArray(i,g*9+3),Dn.fromArray(i,g*9+6),Am.subVectors(In,_n),Cr.subVectors(Dn,_n),Cr.cross(Am).normalize();for(let m=0;m<3;++m){const v=g*9+m*3;s[v]=Cr.x,s[v+1]=Cr.y,s[v+2]=Cr.z}lo.copy(In).add(_n).add(Dn).multiplyScalar(1/3),r[g*3]=lo.x,r[g*3+1]=lo.y,r[g*3+2]=lo.z,o[g*6]=Math.min(In.x,_n.x,Dn.x),o[g*6+1]=Math.min(In.y,_n.y,Dn.y),o[g*6+2]=Math.min(In.z,_n.z,Dn.z),o[g*6+3]=Math.max(In.x,_n.x,Dn.x),o[g*6+4]=Math.max(In.y,_n.y,Dn.y),o[g*6+5]=Math.max(In.z,_n.z,Dn.z),p&&(a=Math.min(o[g*6],a),l=Math.min(o[g*6+1],l),c=Math.min(o[g*6+2],c),h=Math.max(o[g*6+3],h),f=Math.max(o[g*6+4],f),d=Math.max(o[g*6+5],d))}if(p){const g=e.boundingSphere;g.center.set((h+a)/2,(f+l)/2,(d+c)/2),g.radius=Math.max(h-g.center.x,g.center.x-a,f-g.center.y,g.center.y-l,d-g.center.z,g.center.z-c)}this.octree.update(this,t),this.dirtyTriangles.length=0,this.dirtyTrianglesMask.clear()}}u(kw,"DynamicMesh");bL(kw,"DynamicMesh");var wfe=Object.defineProperty,wL=u((n,e)=>wfe(n,"name",{value:e,configurable:!0}),"__name$1l");const oy=new Int8Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),vs=new Uint16Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);function As(n,e){return n/(n-e)}u(As,"getAlpha");wL(As,"getAlpha");const rt=new Float32Array(12*3),ot=new Float32Array(12*3),Ye=new T,fn=new T;function Nw(n,e,t,i,s,r,o,a,l,c,h,f,d,p,g,m,v){const y=a[c],b=a[h],_=a[f],x=a[d],w=a[p],M=a[g],C=a[m],A=a[v],P=!!(t&&l);let D=0;if(y<0&&(D|=1<<0),b<0&&(D|=1<<1),_<0&&(D|=1<<2),x<0&&(D|=1<<3),w<0&&(D|=1<<4),M<0&&(D|=1<<5),C<0&&(D|=1<<6),A<0&&(D|=1<<7),vs[D]!==0){if(vs[D]&1<<0){const k=As(y,b);rt[0]=i+k*o,rt[1]=s,rt[2]=r,P&&(Ye.fromArray(l,c*3),fn.fromArray(l,h*3),Ye.lerp(fn,k),ot[0]=Ye.x,ot[1]=Ye.y,ot[2]=Ye.z)}if(vs[D]&1<<1){const k=As(b,_);rt[3]=i+o,rt[3+1]=s,rt[3+2]=r+k*o,P&&(Ye.fromArray(l,h*3),fn.fromArray(l,f*3),Ye.lerp(fn,k),ot[3]=Ye.x,ot[3+1]=Ye.y,ot[3+2]=Ye.z)}if(vs[D]&1<<2){const k=As(x,_);rt[3*2]=i+k*o,rt[3*2+1]=s,rt[3*2+2]=r+o,P&&(Ye.fromArray(l,d*3),fn.fromArray(l,f*3),Ye.lerp(fn,k),ot[3*2]=Ye.x,ot[3*2+1]=Ye.y,ot[3*2+2]=Ye.z)}if(vs[D]&1<<3){const k=As(y,x);rt[3*3]=i,rt[3*3+1]=s,rt[3*3+2]=r+k*o,P&&(Ye.fromArray(l,c*3),fn.fromArray(l,d*3),Ye.lerp(fn,k),ot[3*3]=Ye.x,ot[3*3+1]=Ye.y,ot[3*3+2]=Ye.z)}if(vs[D]&1<<4){const k=As(w,M);rt[3*4]=i+k*o,rt[3*4+1]=s+o,rt[3*4+2]=r,P&&(Ye.fromArray(l,p*3),fn.fromArray(l,g*3),Ye.lerp(fn,k),ot[3*4]=Ye.x,ot[3*4+1]=Ye.y,ot[3*4+2]=Ye.z)}if(vs[D]&1<<5){const k=As(M,C);rt[3*5]=i+o,rt[3*5+1]=s+o,rt[3*5+2]=r+k*o,P&&(Ye.fromArray(l,g*3),fn.fromArray(l,m*3),Ye.lerp(fn,k),ot[3*5]=Ye.x,ot[3*5+1]=Ye.y,ot[3*5+2]=Ye.z)}if(vs[D]&1<<6){const k=As(A,C);rt[3*6]=i+k*o,rt[3*6+1]=s+o,rt[3*6+2]=r+o,P&&(Ye.fromArray(l,v*3),fn.fromArray(l,m*3),Ye.lerp(fn,k),ot[3*6]=Ye.x,ot[3*6+1]=Ye.y,ot[3*6+2]=Ye.z)}if(vs[D]&1<<7){const k=As(w,A);rt[3*7]=i,rt[3*7+1]=s+o,rt[3*7+2]=r+k*o,P&&(Ye.fromArray(l,p*3),fn.fromArray(l,v*3),Ye.lerp(fn,k),ot[3*7]=Ye.x,ot[3*7+1]=Ye.y,ot[3*7+2]=Ye.z)}if(vs[D]&1<<8){const k=As(y,w);rt[3*8]=i,rt[3*8+1]=s+k*o,rt[3*8+2]=r,P&&(Ye.fromArray(l,c*3),fn.fromArray(l,p*3),Ye.lerp(fn,k),ot[3*8]=Ye.x,ot[3*8+1]=Ye.y,ot[3*8+2]=Ye.z)}if(vs[D]&1<<9){const k=As(b,M);rt[3*9]=i+o,rt[3*9+1]=s+k*o,rt[3*9+2]=r,P&&(Ye.fromArray(l,h*3),fn.fromArray(l,g*3),Ye.lerp(fn,k),ot[3*9]=Ye.x,ot[3*9+1]=Ye.y,ot[3*9+2]=Ye.z)}if(vs[D]&1<<10){const k=As(_,C);rt[3*10]=i+o,rt[3*10+1]=s+k*o,rt[3*10+2]=r+o,P&&(Ye.fromArray(l,f*3),fn.fromArray(l,m*3),Ye.lerp(fn,k),ot[3*10]=Ye.x,ot[3*10+1]=Ye.y,ot[3*10+2]=Ye.z)}if(vs[D]&1<<11){const k=As(x,A);rt[3*11]=i,rt[3*11+1]=s+k*o,rt[3*11+2]=r+o,P&&(Ye.fromArray(l,d*3),fn.fromArray(l,v*3),Ye.lerp(fn,k),ot[3*11]=Ye.x,ot[3*11+1]=Ye.y,ot[3*11+2]=Ye.z)}for(let k=0;;k+=3){const O=oy[D*16+k];if(O===-1)break;const N=oy[D*16+k+1],E=oy[D*16+k+2],B=rt[O*3],W=rt[O*3+1],Z=rt[O*3+2],ne=rt[N*3],j=rt[N*3+1],ie=rt[N*3+2],K=rt[E*3],$=rt[E*3+1],le=rt[E*3+2];if(n.push(B,W,Z,ne,j,ie,K,$,le),P&&t.push(ot[O*3],ot[O*3+1],ot[O*3+2],ot[N*3],ot[N*3+1],ot[N*3+2],ot[E*3],ot[E*3+1],ot[E*3+2]),e){const ae=ne-B,J=j-W,te=ie-Z,ge=ne-K,he=j-$,we=ie-le,xe=J*we-te*he,Se=te*ge-ae*we,V=ae*he-J*ge,Y=1/Math.sqrt(xe**2+Se**2+V**2),R=-xe*Y,ee=-Se*Y,Q=-V*Y;e.push(R,ee,Q,R,ee,Q,R,ee,Q)}}}}u(Nw,"marchingCubes");wL(Nw,"marchingCubes");var xfe=Object.defineProperty,ja=u((n,e)=>xfe(n,"name",{value:e,configurable:!0}),"__name$1k");function xL(n,e,t,i,s,r,o){return Math.sqrt((n-i)**2+(e-s)**2+(t-r)**2)-o}u(xL,"sphere");ja(xL,"sphere");function AL(n,e,t,i,s,r,o,a,l,c,h){const f=a-i,d=l-s,p=c-r,g=f**2+d**2+p**2,m=o-h,v=g-m**2,y=1/g,b=n-i,_=e-s,x=t-r,w=b*f+_*d+x*p,M=w-g,C=(b*g-f*w)**2+(_*g-d*w)**2+(x*g-p*w)**2,A=w**2*g,P=M**2*g,D=Math.sign(m)*m*m*C;return Math.sign(M)*v*P>D?Math.sqrt(C+P)*y-h:Math.sign(w)*v*A<D?Math.sqrt(C+A)*y-o:(Math.sqrt(C*v*y)+w*m)*y-o}u(AL,"roundCone");ja(AL,"roundCone");function Afe(n,e){return Math.min(n,e)}u(Afe,"merge");ja(Afe,"merge");function ML(n,e,t){const i=Math.max(0,Math.min(1,.5+.5*(e-n)/t));return e*(1-i)+n*i-t*i*(1-i)}u(ML,"mergeSmooth");ja(ML,"mergeSmooth");function SL(n,e){return Math.max(n,e)}u(SL,"intersect");ja(SL,"intersect");function CL(n,e,t){const i=Math.max(0,Math.min(1,.5-.5*(e-n)/t));return e*(1-i)+n*i+t*i*(1-i)}u(CL,"intersectSmooth");ja(CL,"intersectSmooth");function Mfe(n,e){return SL(n,-e)}u(Mfe,"subtract");ja(Mfe,"subtract");function EL(n,e,t){return CL(n,-e,t)}u(EL,"subtractSmooth");ja(EL,"subtractSmooth");var Sfe=Object.defineProperty,Fw=u((n,e)=>Sfe(n,"name",{value:e,configurable:!0}),"__name$1j");class ep{constructor(e,t,i){S(this,"position");S(this,"radius");S(this,"operator");S(this,"bb");S(this,"fatBb",new Qn);this.position=e,this.radius=t,this.operator=i,this.bb=new Qn().expandByPoint(e).expandByScalar(t)}createSymmetry(e){const t=new T().copy(this.position);return t.setComponent(e,-t.getComponent(e)),new ep(t,this.radius,this.operator)}sdf(e,t,i){return xL(e,t,i,this.position.x,this.position.y,this.position.z,this.radius)}}u(ep,"SdfSphere");Fw(ep,"SdfSphere");class tp{constructor(e,t,i,s,r){S(this,"p1");S(this,"r1");S(this,"p2");S(this,"r2");S(this,"operator");S(this,"bb");S(this,"fatBb",new Qn);this.p1=e,this.r1=t,this.p2=i,this.r2=s,this.operator=r,this.bb=new Qn().union(new Qn().expandByPoint(e).expandByScalar(t)).union(new Qn().expandByPoint(i).expandByScalar(s))}createSymmetry(e){const t=new T().copy(this.p1).setComponent(e,-this.p1.getComponent(e)),i=new T().copy(this.p2).setComponent(e,-this.p2.getComponent(e));return new tp(t,this.r1,i,this.r2,this.operator)}sdf(e,t,i){return AL(e,t,i,this.p1.x,this.p1.y,this.p1.z,this.r1,this.p2.x,this.p2.y,this.p2.z,this.r2)}}u(tp,"SdfRoundCone");Fw(tp,"SdfRoundCone");const kc=new T;class d1{constructor(){S(this,"resolution",.003);S(this,"maxResolutionSeg",100);S(this,"symmetryAxis",-1);S(this,"smoothRange",.01);S(this,"shapes",[])}sphere(e,t,i){if(t<=0)return;const s=new ep(e,t,i);this.shapes.push(s),this.symmetryAxis>=0&&this.shapes.push(s.createSymmetry(this.symmetryAxis))}roundCone(e,t,i,s,r){if(t<=0&&s<=0)return;if(kc.subVectors(e,i).length()+Math.min(t,s)<=Math.max(t,s))return t>s?this.sphere(e,t,r):this.sphere(i,s,r);const a=new tp(e,t,i,s,r);this.shapes.push(a),this.symmetryAxis>=0&&this.shapes.push(a.createSymmetry(this.symmetryAxis))}build(){const e=new Qn;for(let y of this.shapes)y.operator&&e.union(y.bb);if(e.isEmpty())return{position:[],normal:[]};e.getSize(kc);let t=Math.max(this.resolution,Math.max(kc.x,kc.y,kc.z)/this.maxResolutionSeg);const i=this.smoothRange;for(let y of this.shapes)y.fatBb.copy(y.bb).expandByScalar(t+i);const s=e.min.x-t-i,r=e.min.y-t-i,o=e.min.z-t-i,a=e.max.x+t+i,l=e.max.y+t+i,c=e.max.z+t+i,h=Math.ceil((a-s)/t),f=Math.ceil((l-r)/t),d=Math.ceil((c-o)/t),p=new Float32Array(h*f*d),g=new $r(p.length);for(let y=0;y<h;++y){const b=s+y*t;for(let _=0;_<f;++_){const x=r+_*t;for(let w=0;w<d;++w){const M=o+w*t,C=y*f*d+_*d+w;for(let A of this.shapes)if(!!A.fatBb.containsPoint(kc.set(b,x,M)))if(A.operator)g.get(C)?p[C]=ML(p[C],A.sdf(b,x,M),i):(g.set(C),p[C]=A.sdf(b,x,M));else{if(!g.get(C))continue;p[C]=EL(p[C],A.sdf(b,x,M),i)}}}}const m=[],v=[];for(let y=0;y<h-1;++y){const b=s+y*t;for(let _=0;_<f-1;++_){const x=r+_*t;for(let w=0;w<d-1;++w){const M=o+w*t;!g.get(y*f*d+_*d+w)||Nw(m,v,null,b,x,M,t,p,null,y*f*d+_*d+w,(y+1)*f*d+_*d+w,(y+1)*f*d+_*d+(w+1),y*f*d+_*d+(w+1),y*f*d+(_+1)*d+w,(y+1)*f*d+(_+1)*d+w,(y+1)*f*d+(_+1)*d+(w+1),y*f*d+(_+1)*d+(w+1))}}}return{position:m,normal:v}}}u(d1,"SdfMeshBuilder");Fw(d1,"SdfMeshBuilder");var Cfe=Object.defineProperty,Efe=u((n,e)=>Cfe(n,"name",{value:e,configurable:!0}),"__name$1i");class zw{update(e,t){var l;if(t.instanceId||t.type!=="Clay")return;const i=t.get(gn),s=t.get(yr);if(!i.dirty&&!s.dirty)return;i.dirty=!1,s.dirty=!1;const r=i.partialUpdate||s.partialUpdate;if(i.partialUpdate=!1,s.partialUpdate=!1,i.value.length===0){const c=new d1;c.sphere(new T(0,0,0),.25,!0);const{position:h}=c.build();i.value=new Float32Array(h),s.value=new Float32Array(h.length);for(let f=0,d=s.value.length;f<d;++f)s.value[f]=1}const o=t.get(Me);!o.mesh||!r?(o.mesh=new kw,o.mesh.buildFromTriangles(i.value,s.value),i.value=new Float32Array(o.mesh.aPosition),s.value=new Float32Array(o.mesh.aColor)):o.mesh.update((l=o.value)==null?void 0:l.geometry),r||o.dispose();const a=o.value;o.value?o.mesh.toThree(o.value):(o.value=o.mesh.toThree(),o.value.userData={node:t},o.parentChanged=!0,o.localTransformChanged=!0),e.model.instanceMeshUpdated(t.id,a!==o.value)}}u(zw,"ClayUpdateFilter");Efe(zw,"ClayUpdateFilter");var Tfe=Object.defineProperty,Pfe=u((n,e)=>Tfe(n,"name",{value:e,configurable:!0}),"__name$1h");class Bw{update(e,t){if(t.type==="Container"){const i=t.get(Me);i.value||(i.value=new ni,i.value.userData={node:t}),t.instanceId&&(t.instanceMeshDirty=!1)}}}u(Bw,"ContainerUpdateFilter");Pfe(Bw,"ContainerUpdateFilter");var Rfe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntlsEOwCAIQ8vCf+u+HC8z0WnUMEh2oDc09PVkJQAZjmIAEJHkYU5EN7eDpXkNzbPDr2rD8upSo3fIAfAoK/2HvUtpdKwABCAAAfgDwPo13QOs67MDWNdmB3Arfjh/WwpBzho97mV7igAAAABJRU5ErkJggg==",Ife="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAALhJREFUSIntVdsOwjAIHcb/HvtyfAFCESjVGmPieVuBc8k2CkcPuHiuuHeIieiMigAwFcoEBmIAuKImU58KDeTE4AF99vD1SMAnQCI6xfFCAu3nNGESFBfeYZXW9/sk6UtmVxW5OgWA9EMI3TeI2xy3F4j2KO/i+niCv8D3BQS//R+UDt6dTXeR2YxHIYbSm/FYAZSlFazr1ATX7bqeLsmtF05sbf3KvOxcRyAUehouiLsCg9DCueIBQtEIj3OkCCMAAAAASUVORK5CYII=",Dfe=Object.defineProperty,Lfe=u((n,e)=>Dfe(n,"name",{value:e,configurable:!0}),"__name$1g");const TL=new Xd,I_=TL.load(Rfe);I_.minFilter=I_.magFilter=zn;const D_=TL.load(Ife);D_.minFilter=D_.magFilter=zn;class Uw{update(e,t){var s,r,o,a;if(t.type!=="IKChain")return;t.instanceId&&(t.instanceMeshDirty=!1);const i=t.get(Me);i.value||(i.value=new ni,i.value.userData={node:t});for(let l=0,c=t.children.length;l<c;++l){const h=t.children[l];h.instanceId&&(h.instanceMeshDirty=!1);const f=h.get(Me);f.value||(f.value=new ni,f.value.userData={node:h});const d=h.get(xt);if(!d.dirty)continue;if(!d.boneMesh){const M=d.boneMesh=new We;M.material=new ji({depthWrite:!1,depthTest:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5,color:7829367}),M.renderOrder=1,M.visible=e.options.showIkBones,f.value.add(M)}const p=d.boneMesh,g=h.value(Xi),m=p.geometry;((s=m==null?void 0:m.parameters)==null?void 0:s.height)!==g&&((r=p.geometry)==null||r.dispose(),p.geometry=new I0(.003,g,6).translate(0,h.value(Xi)/2,0).rotateZ(-Math.PI/2));const v=h.value(ka);let y=v[0]/180*Math.PI,b=v[1]/180*Math.PI;if(h.instanceId&&h.has(Un)){const M=h.value(Un);switch(h.value(cs)){case"horizontal":M.z>1e-6&&([y,b]=[-b,-y]);break;case"vertical":M.y>1e-6&&([y,b]=[-b,-y]);break}}if(!d.hingeIndicator){const M=d.hingeIndicator=new We;M.material=new ji({depthWrite:!1,depthTest:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5,color:16777215,side:Ts}),M.renderOrder=1}const _=d.hingeIndicator;_.visible=e.options.showIkBones&&h.value(cs)!=="none";const x=l===0?t.value(Me):t.children[l-1].value(Me);_.parent!==x&&x.add(_);const w=_.geometry;switch((!w||((o=w==null?void 0:w.parameters)==null?void 0:o.thetaStart)!==y||((a=w==null?void 0:w.parameters)==null?void 0:a.thetaLength)!==b-y)&&(w==null||w.dispose(),_.geometry=new Ou(.025,32,y,b-y)),h.value(cs)){case"horizontal":_.rotation.set(-Math.PI/2,0,0),d.hingeEnabled=!0,_.material.color.setHex(65535);break;case"vertical":_.rotation.set(0,0,0),d.hingeEnabled=!0,_.material.color.setHex(16776960);break;default:d.hingeEnabled=!1;break}if(l===0?_.position.set(0,0,0):_.position.set(t.children[l-1].value(Xi),0,0),d.moveHandler||(d.moveHandler=new Pa(new it().setFromPoints([new T]),new Fr({map:I_,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),d.moveHandler.renderOrder=2,f.value.add(d.moveHandler),d.moveHandler.visible=!1),d.rotateHandler||(d.rotateHandler=new Pa(new it().setFromPoints([new T]),new Fr({map:D_,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),d.rotateHandler.renderOrder=2,f.value.add(d.rotateHandler),d.rotateHandler.visible=!1),d.dirty=!1,d.quaternion.setFromEuler(h.value(wn)),l>0){const M=t.children[l-1].get(xt);d.start.copy(M.end),d.quaternion.multiplyQuaternions(M.quaternion,d.quaternion).normalize()}else d.start.set(0,0,0);d.end.set(h.value(Xi),0,0).applyQuaternion(d.quaternion).add(d.start),d.rotateHandler.position.set(g,0,0)}}}u(Uw,"IkChainUpdateFilter");Lfe(Uw,"IkChainUpdateFilter");var Ofe=Object.defineProperty,kfe=u((n,e)=>Ofe(n,"name",{value:e,configurable:!0}),"__name$1f");class $w extends it{constructor(e=1,t=1,i=1,s=1){super(),this.type="DoubleSidedPlaneGeometry";const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(s),c=a+1,h=l+1,f=e/a,d=t/l,p=[],g=[],m=[],v=[];for(let b=0;b<2;++b)for(let _=0;_<h;_++){const x=_*d-o;for(let w=0;w<c;w++){const M=w*f-r;g.push(M,-x,0),m.push(0,0,b===0?1:-1),v.push(w/a),v.push(1-_/l)}}const y=c*h;for(let b=0;b<l;b++)for(let _=0;_<a;_++){const x=_+c*b,w=_+c*(b+1),M=_+1+c*(b+1),C=_+1+c*b;p.push(x,w,C),p.push(w,M,C),p.push(x+y,C+y,M+y),p.push(x+y,M+y,w+y)}this.setIndex(p),this.setAttribute("position",new Ve(g,3)),this.setAttribute("normal",new Ve(m,3)),this.setAttribute("uv",new Ve(v,2))}}u($w,"DoubleSidedPlaneGeometry");kfe($w,"DoubleSidedPlaneGeometry");var Nfe=Object.defineProperty,Ffe=u((n,e)=>Nfe(n,"name",{value:e,configurable:!0}),"__name$1e");class Vw{update(e,t){if(t.instanceId||!t.has(Gr))return;const i=t.get(Gr);if(!i.dirty||(i.dirty=!1,!i.value))return;const s=new Image;s.onload=function(){if(t.deleted||s.src!==i.value)return;i.texture&&i.texture.dispose();const r=i.texture=new ii;if(i.texture.image=s,i.texture.needsUpdate=!0,t.type!=="Image")return;const o=t.get(Me);o.dispose();const a=1,l=s.height/s.width*a;o.value=new We(new $w(a,l),new Mb({map:r})),o.value.userData={node:t},e.model.dirty=!0,t.dirty=!0,o.parentChanged=!0,o.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)},s.src=i.value}}u(Vw,"ImageUpdateFilter");Ffe(Vw,"ImageUpdateFilter");var PL={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,e){(function(t){n.exports=t()})(function(){return u(function t(i,s,r){function o(c,h){if(!s[c]){if(!i[c]){var f=typeof em=="function"&&em;if(!h&&f)return f(c,!0);if(a)return a(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var p=s[c]={exports:{}};i[c][0].call(p.exports,function(g){var m=i[c][1][g];return o(m||g)},p,p.exports,t,i,s,r)}return s[c].exports}u(o,"u");for(var a=typeof em=="function"&&em,l=0;l<r.length;l++)o(r[l]);return o},"s")({1:[function(t,i,s){var r=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var c,h,f,d,p,g,m,v=[],y=0,b=l.length,_=b,x=r.getTypeOf(l)!=="string";y<l.length;)_=b-y,f=x?(c=l[y++],h=y<b?l[y++]:0,y<b?l[y++]:0):(c=l.charCodeAt(y++),h=y<b?l.charCodeAt(y++):0,y<b?l.charCodeAt(y++):0),d=c>>2,p=(3&c)<<4|h>>4,g=1<_?(15&h)<<2|f>>6:64,m=2<_?63&f:64,v.push(a.charAt(d)+a.charAt(p)+a.charAt(g)+a.charAt(m));return v.join("")},s.decode=function(l){var c,h,f,d,p,g,m=0,v=0,y="data:";if(l.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&_--,l.charAt(l.length-2)===a.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|_):new Array(0|_);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(d=a.indexOf(l.charAt(m++)))>>4,h=(15&d)<<4|(p=a.indexOf(l.charAt(m++)))>>2,f=(3&p)<<6|(g=a.indexOf(l.charAt(m++))),b[v++]=c,p!==64&&(b[v++]=h),g!==64&&(b[v++]=f);return b}},{"./support":30,"./utils":32}],2:[function(t,i,s){var r=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(h,f,d,p,g){this.compressedSize=h,this.uncompressedSize=f,this.crc32=d,this.compression=p,this.compressedContent=g}u(c,"o"),c.prototype={getContentWorker:function(){var h=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),f=this;return h.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,f,d){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(f.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",f)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,s){var r=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,s){var r=t("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();i.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,h,f,d){var p=o,g=d+f;c^=-1;for(var m=d;m<g;m++)c=c>>>8^p[255&(c^h[m])];return-1^c}(0|l,a,a.length,0):function(c,h,f,d){var p=o,g=d+f;c^=-1;for(var m=d;m<g;m++)c=c>>>8^p[255&(c^h.charCodeAt(m))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,i,s){var r=null;r=typeof Promise!="undefined"?Promise:t("lie"),i.exports={Promise:r}},{lie:37}],7:[function(t,i,s){var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",o=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=r?"uint8array":"array";function h(f,d){l.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=d,this.meta={}}u(h,"h"),s.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,f.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(d){f.push({data:d,meta:f.meta})}},s.compressWorker=function(f){return new h("Deflate",f)},s.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,s){function r(p,g){var m,v="";for(m=0;m<g;m++)v+=String.fromCharCode(255&p),p>>>=8;return v}u(r,"A");function o(p,g,m,v,y,b){var _,x,w=p.file,M=p.compression,C=b!==c.utf8encode,A=a.transformTo("string",b(w.name)),P=a.transformTo("string",c.utf8encode(w.name)),D=w.comment,k=a.transformTo("string",b(D)),O=a.transformTo("string",c.utf8encode(D)),N=P.length!==w.name.length,E=O.length!==D.length,B="",W="",Z="",ne=w.dir,j=w.date,ie={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(ie.crc32=p.crc32,ie.compressedSize=p.compressedSize,ie.uncompressedSize=p.uncompressedSize);var K=0;g&&(K|=8),C||!N&&!E||(K|=2048);var $=0,le=0;ne&&($|=16),y==="UNIX"?(le=798,$|=function(J,te){var ge=J;return J||(ge=te?16893:33204),(65535&ge)<<16}(w.unixPermissions,ne)):(le=20,$|=function(J){return 63&(J||0)}(w.dosPermissions)),_=j.getUTCHours(),_<<=6,_|=j.getUTCMinutes(),_<<=5,_|=j.getUTCSeconds()/2,x=j.getUTCFullYear()-1980,x<<=4,x|=j.getUTCMonth()+1,x<<=5,x|=j.getUTCDate(),N&&(W=r(1,1)+r(h(A),4)+P,B+="up"+r(W.length,2)+W),E&&(Z=r(1,1)+r(h(k),4)+O,B+="uc"+r(Z.length,2)+Z);var ae="";return ae+=`
\0`,ae+=r(K,2),ae+=M.magic,ae+=r(_,2),ae+=r(x,2),ae+=r(ie.crc32,4),ae+=r(ie.compressedSize,4),ae+=r(ie.uncompressedSize,4),ae+=r(A.length,2),ae+=r(B.length,2),{fileRecord:f.LOCAL_FILE_HEADER+ae+A+B,dirRecord:f.CENTRAL_FILE_HEADER+r(le,2)+ae+r(k.length,2)+"\0\0\0\0"+r($,4)+r(v,4)+A+B+k}}u(o,"n");var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),h=t("../crc32"),f=t("../signature");function d(p,g,m,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=v,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}u(d,"s"),a.inherits(d,l),d.prototype.push=function(p){var g=p.meta.percent||0,m=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-v-1))/m:100}}))},d.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var g=this.streamFiles&&!p.file.dir;if(g){var m=o(p,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(p){this.accumulate=!1;var g=this.streamFiles&&!p.file.dir,m=o(p,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(v){return f.DATA_DESCRIPTOR+r(v.crc32,4)+r(v.compressedSize,4)+r(v.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var p=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-p,v=function(y,b,_,x,w){var M=a.transformTo("string",w(x));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(y,2)+r(y,2)+r(b,4)+r(_,4)+r(M.length,2)+M}(this.dirRecords.length,m,p,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(p){this._sources.push(p);var g=this;return p.on("data",function(m){g.processChunk(m)}),p.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),p.on("error",function(m){g.error(m)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(p){var g=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var m=0;m<g.length;m++)try{g[m].error(p)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,g=0;g<p.length;g++)p[g].lock()},i.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,s){var r=t("../compressions"),o=t("./ZipFileWorker");s.generateWorker=function(a,l,c){var h=new o(l.streamFiles,c,l.platform,l.encodeFileName),f=0;try{a.forEach(function(d,p){f++;var g=function(b,_){var x=b||_,w=r[x];if(!w)throw new Error(x+" is not a valid compression method !");return w}(p.options.compression,l.compression),m=p.options.compressionOptions||l.compressionOptions||{},v=p.dir,y=p.date;p._compressWorker(g,m).withStreamInfo("file",{name:d,dir:v,date:y,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(h)}),h.entriesCount=f}catch(d){h.error(d)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,s){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}u(r,"n"),(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=t("./external"),i.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,s){var r=t("./utils"),o=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function f(d){return new o.Promise(function(p,g){var m=d.decompressed.getContentWorker().pipe(new c);m.on("error",function(v){g(v)}).on("end",function(){m.streamInfo.crc32!==d.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}u(f,"f"),i.exports=function(d,p){var g=this;return p=r.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",d,!0,p.optimizedBinaryString,p.base64).then(function(m){var v=new l(p);return v.load(m),v}).then(function(m){var v=[o.Promise.resolve(m)],y=m.files;if(p.checkCRC32)for(var b=0;b<y.length;b++)v.push(f(y[b]));return o.Promise.all(v)}).then(function(m){for(var v=m.shift(),y=v.files,b=0;b<y.length;b++){var _=y[b],x=_.fileNameStr,w=r.resolve(_.fileNameStr);g.file(w,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:p.createFolders}),_.dir||(g.file(w).unsafeOriginalName=x)}return v.zipComment.length&&(g.comment=v.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,s){var r=t("../utils"),o=t("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}u(a,"s"),r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,s){var r=t("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var h=this;a.on("data",function(f,d){h.push(f)||h._helper.pause(),c&&c(d)}).on("error",function(f){h.emit("error",f)}).on("end",function(){h.push(null)})}u(o,"n"),t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,i,s){i.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,i,s){function r(w,M,C){var A,P=a.getTypeOf(M),D=a.extend(C||{},h);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(w=y(w)),D.createFolders&&(A=v(w))&&b.call(this,A,!0);var k=P==="string"&&D.binary===!1&&D.base64===!1;C&&C.binary!==void 0||(D.binary=!k),(M instanceof f&&M.uncompressedSize===0||D.dir||!M||M.length===0)&&(D.base64=!1,D.binary=!0,M="",D.compression="STORE",P="string");var O=null;O=M instanceof f||M instanceof l?M:g.isNode&&g.isStream(M)?new m(w,M):a.prepareContent(w,M,D.binary,D.optimizedBinaryString,D.base64);var N=new d(w,O,D);this.files[w]=N}u(r,"s");var o=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),h=t("./defaults"),f=t("./compressedObject"),d=t("./zipObject"),p=t("./generate"),g=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),v=u(function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var M=w.lastIndexOf("/");return 0<M?w.substring(0,M):""},"_"),y=u(function(w){return w.slice(-1)!=="/"&&(w+="/"),w},"g"),b=u(function(w,M){return M=M!==void 0?M:h.createFolders,w=y(w),this.files[w]||r.call(this,w,null,{dir:!0,createFolders:M}),this.files[w]},"b");function _(w){return Object.prototype.toString.call(w)==="[object RegExp]"}u(_,"h");var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var M,C,A;for(M in this.files)A=this.files[M],(C=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&w(C,A)},filter:function(w){var M=[];return this.forEach(function(C,A){w(C,A)&&M.push(A)}),M},file:function(w,M,C){if(arguments.length!==1)return w=this.root+w,r.call(this,w,M,C),this;if(_(w)){var A=w;return this.filter(function(D,k){return!k.dir&&A.test(D)})}var P=this.files[this.root+w];return P&&!P.dir?P:null},folder:function(w){if(!w)return this;if(_(w))return this.filter(function(P,D){return D.dir&&w.test(P)});var M=this.root+w,C=b.call(this,M),A=this.clone();return A.root=C.name,A},remove:function(w){w=this.root+w;var M=this.files[w];if(M||(w.slice(-1)!=="/"&&(w+="/"),M=this.files[w]),M&&!M.dir)delete this.files[w];else for(var C=this.filter(function(P,D){return D.name.slice(0,w.length)===w}),A=0;A<C.length;A++)delete this.files[C[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var M,C={};try{if((C=a.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var A=C.comment||this.comment||"";M=p.generateWorker(this,C,A)}catch(P){(M=new l("error")).error(P)}return new c(M,C.type||"string",C.mimeType)},generateAsync:function(w,M){return this.generateInternalStream(w).accumulate(M)},generateNodeStream:function(w,M){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(M)}};i.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,s){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,s){var r=t("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}u(o,"i"),t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),f=a.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===c&&this.data[d+2]===h&&this.data[d+3]===f)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),f=a.charCodeAt(3),d=this.readData(4);return l===d[0]&&c===d[1]&&h===d[2]&&f===d[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,i,s){var r=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}u(o,"i"),o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},i.exports=o},{"../utils":32}],19:[function(t,i,s){var r=t("./Uint8ArrayReader");function o(a){r.call(this,a)}u(o,"i"),t("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,s){var r=t("./DataReader");function o(a){r.call(this,a)}u(o,"i"),t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,i,s){var r=t("./ArrayReader");function o(a){r.call(this,a)}u(o,"i"),t("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,s){var r=t("../utils"),o=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");i.exports=function(f){var d=r.getTypeOf(f);return r.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new c(f):o.uint8array?new h(r.transformTo("uint8array",f)):new a(r.transformTo("array",f)):new l(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,s){var r=t("./GenericWorker"),o=t("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}u(a,"s"),o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,s){var r=t("./GenericWorker"),o=t("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}u(a,"s"),t("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,s){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}u(a,"s"),r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,s){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}u(a,"s"),r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,s){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}u(r,"n"),r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=r},{}],29:[function(t,i,s){var r=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),h=t("../external"),f=null;if(c.nodestream)try{f=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(g,m){return new h.Promise(function(v,y){var b=[],_=g._internalType,x=g._outputType,w=g._mimeType;g.on("data",function(M,C){b.push(M),m&&m(C)}).on("error",function(M){b=[],y(M)}).on("end",function(){try{var M=function(C,A,P){switch(C){case"blob":return r.newBlob(r.transformTo("arraybuffer",A),P);case"base64":return l.encode(A);default:return r.transformTo(C,A)}}(x,function(C,A){var P,D=0,k=null,O=0;for(P=0;P<A.length;P++)O+=A[P].length;switch(C){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(k=new Uint8Array(O),P=0;P<A.length;P++)k.set(A[P],D),D+=A[P].length;return k;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+C+"'")}}(_,b),w);v(M)}catch(C){y(C)}b=[]}).resume()})}u(d,"l");function p(g,m,v){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=v,r.checkSupport(y),this._worker=g.pipe(new o(y)),g.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}u(p,"f"),p.prototype={accumulate:function(g){return d(this,g)},on:function(g,m){var v=this;return g==="data"?this._worker.on(g,function(y){m.call(v,y.data,y.meta)}):this._worker.on(g,function(){r.delay(m,arguments,v)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},g)}},i.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",s.nodebuffer=typeof Buffer!="undefined",s.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")s.blob=!1;else{var r=new ArrayBuffer(0);try{s.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),s.blob=o.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,s){for(var r=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function f(){l.call(this,"utf-8 decode"),this.leftOver=null}u(f,"a");function d(){l.call(this,"utf-8 encode")}u(d,"l"),s.utf8encode=function(p){return o.nodebuffer?a.newBufferFrom(p,"utf-8"):function(g){var m,v,y,b,_,x=g.length,w=0;for(b=0;b<x;b++)(64512&(v=g.charCodeAt(b)))==55296&&b+1<x&&(64512&(y=g.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),b++),w+=v<128?1:v<2048?2:v<65536?3:4;for(m=o.uint8array?new Uint8Array(w):new Array(w),b=_=0;_<w;b++)(64512&(v=g.charCodeAt(b)))==55296&&b+1<x&&(64512&(y=g.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),b++),v<128?m[_++]=v:(v<2048?m[_++]=192|v>>>6:(v<65536?m[_++]=224|v>>>12:(m[_++]=240|v>>>18,m[_++]=128|v>>>12&63),m[_++]=128|v>>>6&63),m[_++]=128|63&v);return m}(p)},s.utf8decode=function(p){return o.nodebuffer?r.transformTo("nodebuffer",p).toString("utf-8"):function(g){var m,v,y,b,_=g.length,x=new Array(2*_);for(m=v=0;m<_;)if((y=g[m++])<128)x[v++]=y;else if(4<(b=c[y]))x[v++]=65533,m+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&m<_;)y=y<<6|63&g[m++],b--;1<b?x[v++]=65533:y<65536?x[v++]=y:(y-=65536,x[v++]=55296|y>>10&1023,x[v++]=56320|1023&y)}return x.length!==v&&(x.subarray?x=x.subarray(0,v):x.length=v),r.applyFromCharCode(x)}(p=r.transformTo(o.uint8array?"uint8array":"array",p))},r.inherits(f,l),f.prototype.processChunk=function(p){var g=r.transformTo(o.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var v=function(b,_){var x;for((_=_||b.length)>b.length&&(_=b.length),x=_-1;0<=x&&(192&b[x])==128;)x--;return x<0||x===0?_:x+c[b[x]]>_?x:_}(g),y=g;v!==g.length&&(o.uint8array?(y=g.subarray(0,v),this.leftOver=g.subarray(v,g.length)):(y=g.slice(0,v),this.leftOver=g.slice(v,g.length))),this.push({data:s.utf8decode(y),meta:p.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=f,r.inherits(d,l),d.prototype.processChunk=function(p){this.push({data:s.utf8encode(p.data),meta:p.meta})},s.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,s){var r=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(m){return m}u(c,"n");function h(m,v){for(var y=0;y<m.length;++y)v[y]=255&m.charCodeAt(y);return v}u(h,"l"),t("setimmediate"),s.newBlob=function(m,v){s.checkSupport("blob");try{return new Blob([m],{type:v})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(m,v,y){var b=[],_=0,x=m.length;if(x<=y)return String.fromCharCode.apply(null,m);for(;_<x;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(_,Math.min(_+y,x)))):b.push(String.fromCharCode.apply(null,m.subarray(_,Math.min(_+y,x)))),_+=y;return b.join("")},stringifyByChar:function(m){for(var v="",y=0;y<m.length;y++)v+=String.fromCharCode(m[y]);return v},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function d(m){var v=65536,y=s.getTypeOf(m),b=!0;if(y==="uint8array"?b=f.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=f.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return f.stringifyByChunk(m,y,v)}catch{v=Math.floor(v/2)}return f.stringifyByChar(m)}u(d,"s");function p(m,v){for(var y=0;y<m.length;y++)v[y]=m[y];return v}u(p,"f"),s.applyFromCharCode=d;var g={};g.string={string:c,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:function(m){return h(m,a.allocBuffer(m.length))}},g.array={string:d,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},g.arraybuffer={string:function(m){return d(new Uint8Array(m))},array:function(m){return p(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:d,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},g.nodebuffer={string:d,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return p(m,new Uint8Array(m.length))},nodebuffer:c},s.transformTo=function(m,v){if(v=v||"",!m)return v;s.checkSupport(m);var y=s.getTypeOf(v);return g[y][m](v)},s.resolve=function(m){for(var v=m.split("/"),y=[],b=0;b<v.length;b++){var _=v[b];_==="."||_===""&&b!==0&&b!==v.length-1||(_===".."?y.pop():y.push(_))}return y.join("/")},s.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(m){var v,y,b="";for(y=0;y<(m||"").length;y++)b+="\\x"+((v=m.charCodeAt(y))<16?"0":"")+v.toString(16).toUpperCase();return b},s.delay=function(m,v,y){setImmediate(function(){m.apply(y||null,v||[])})},s.inherits=function(m,v){function y(){}u(y,"r"),y.prototype=v.prototype,m.prototype=new y},s.extend=function(){var m,v,y={};for(m=0;m<arguments.length;m++)for(v in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],v)&&y[v]===void 0&&(y[v]=arguments[m][v]);return y},s.prepareContent=function(m,v,y,b,_){return l.Promise.resolve(v).then(function(x){return r.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader!="undefined"?new l.Promise(function(w,M){var C=new FileReader;C.onload=function(A){w(A.target.result)},C.onerror=function(A){M(A.target.error)},C.readAsArrayBuffer(x)}):x}).then(function(x){var w=s.getTypeOf(x);return w?(w==="arraybuffer"?x=s.transformTo("uint8array",x):w==="string"&&(_?x=o.decode(x):y&&b!==!0&&(x=function(M){return h(M,r.uint8array?new Uint8Array(M.length):new Array(M.length))}(x))),x):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,s){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function h(f){this.files=[],this.loadOptions=f}u(h,"h"),h.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(f)+")")}},isSignature:function(f,d){var p=this.reader.index;this.reader.setIndex(f);var g=this.reader.readString(4)===d;return this.reader.setIndex(p),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),d=c.uint8array?"uint8array":"array",p=o.transformTo(d,f);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,d,p,g=this.zip64EndOfCentralSize-44;0<g;)f=this.reader.readInt(2),d=this.reader.readInt(4),p=this.reader.readData(d),this.zip64ExtensibleData[f]={id:f,length:d,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,d;for(f=0;f<this.files.length;f++)d=this.files[f],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var d=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var g=d-p;if(0<g)this.isSignature(d,a.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(f){this.reader=r(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,s){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),h=t("./compressions"),f=t("./support");function d(p,g){this.options=p,this.loadOptions=g}u(d,"l"),d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var g,m;if(p.skip(22),this.fileNameLength=p.readInt(2),m=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(v){for(var y in h)if(Object.prototype.hasOwnProperty.call(h,y)&&h[y].magic===v)return h[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,g,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var g=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(g),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var g,m,v,y=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<y;)g=p.readInt(2),m=p.readInt(2),v=p.readData(m),this.extraFields[g]={id:g,length:m,value:v};p.setIndex(y)},handleUTF8:function(){var p=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=o.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var y=o.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var g=r(p.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var g=r(p.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(p.length-5))}return null}},i.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,s){function r(g,m,v){this.name=g,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=m,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}u(r,"n");var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),h=t("./stream/GenericWorker");r.prototype={internalStream:function(g){var m=null,v="string";try{if(!g)throw new Error("No output type specified.");var y=(v=g.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(m=m.pipe(new l.Utf8EncodeWorker)),!b&&y&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(_){(m=new h("error")).error(_)}return new o(m,v,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(v,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<f.length;p++)r.prototype[f[p]]=d;i.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,s){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(g),f=r.document.createTextNode("");h.observe(f,{characterData:!0}),o=u(function(){f.data=c=++c%2},"r")}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var d=new r.MessageChannel;d.port1.onmessage=g,o=u(function(){d.port2.postMessage(0)},"r")}var p=[];function g(){var m,v;a=!0;for(var y=p.length;y;){for(v=p,p=[],m=-1;++m<y;)v[m]();y=p.length}a=!1}u(g,"u"),i.exports=function(m){p.push(m)!==1||a||o()}}).call(this,typeof Jp!="undefined"?Jp:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(t,i,s){var r=t("immediate");function o(){}u(o,"u");var a={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function f(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,y!==o&&m(this,y)}u(f,"o");function d(y,b,_){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}u(d,"h");function p(y,b,_){r(function(){var x;try{x=b(_)}catch(w){return a.reject(y,w)}x===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,x)})}u(p,"f");function g(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}u(g,"c");function m(y,b){var _=!1;function x(C){_||(_=!0,a.reject(y,C))}u(x,"n");function w(C){_||(_=!0,a.resolve(y,C))}u(w,"i");var M=v(function(){b(w,x)});M.status==="error"&&x(M.value)}u(m,"d");function v(y,b){var _={};try{_.value=y(b),_.status="success"}catch(x){_.status="error",_.value=x}return _}u(v,"p"),(i.exports=f).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(_){return b.resolve(y()).then(function(){return _})},function(_){return b.resolve(y()).then(function(){throw _})})},f.prototype.catch=function(y){return this.then(null,y)},f.prototype.then=function(y,b){if(typeof y!="function"&&this.state===c||typeof b!="function"&&this.state===l)return this;var _=new this.constructor(o);return this.state!==h?p(_,this.state===c?y:b,this.outcome):this.queue.push(new d(_,y,b)),_},d.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},d.prototype.otherCallFulfilled=function(y){p(this.promise,this.onFulfilled,y)},d.prototype.callRejected=function(y){a.reject(this.promise,y)},d.prototype.otherCallRejected=function(y){p(this.promise,this.onRejected,y)},a.resolve=function(y,b){var _=v(g,b);if(_.status==="error")return a.reject(y,_.value);var x=_.value;if(x)m(y,x);else{y.state=c,y.outcome=b;for(var w=-1,M=y.queue.length;++w<M;)y.queue[w].callFulfilled(b)}return y},a.reject=function(y,b){y.state=l,y.outcome=b;for(var _=-1,x=y.queue.length;++_<x;)y.queue[_].callRejected(b);return y},f.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},f.reject=function(y){var b=new this(o);return a.reject(b,y)},f.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,x=!1;if(!_)return this.resolve([]);for(var w=new Array(_),M=0,C=-1,A=new this(o);++C<_;)P(y[C],C);return A;function P(D,k){b.resolve(D).then(function(O){w[k]=O,++M!==_||x||(x=!0,a.resolve(A,w))},function(O){x||(x=!0,a.reject(A,O))})}},f.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,x=!1;if(!_)return this.resolve([]);for(var w=-1,M=new this(o);++w<_;)C=y[w],b.resolve(C).then(function(A){x||(x=!0,a.resolve(M,A))},function(A){x||(x=!0,a.reject(M,A))});var C;return M}},{immediate:36}],38:[function(t,i,s){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,s){var r=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),h=Object.prototype.toString,f=0,d=-1,p=0,g=8;function m(y){if(!(this instanceof m))return new m(y);this.options=o.assign({level:d,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var _=r.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(_!==f)throw new Error(l[_]);if(b.header&&r.deflateSetHeader(this.strm,b.header),b.dictionary){var x;if(x=typeof b.dictionary=="string"?a.string2buf(b.dictionary):h.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(_=r.deflateSetDictionary(this.strm,x))!==f)throw new Error(l[_]);this._dict_set=!0}}u(m,"p");function v(y,b){var _=new m(b);if(_.push(y,!0),_.err)throw _.msg||l[_.err];return _.result}u(v,"n"),m.prototype.push=function(y,b){var _,x,w=this.strm,M=this.options.chunkSize;if(this.ended)return!1;x=b===~~b?b:b===!0?4:0,typeof y=="string"?w.input=a.string2buf(y):h.call(y)==="[object ArrayBuffer]"?w.input=new Uint8Array(y):w.input=y,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(M),w.next_out=0,w.avail_out=M),(_=r.deflate(w,x))!==1&&_!==f)return this.onEnd(_),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&_!==1);return x===4?(_=r.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===f):x!==2||(this.onEnd(f),!(w.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},s.Deflate=m,s.deflate=v,s.deflateRaw=function(y,b){return(b=b||{}).raw=!0,v(y,b)},s.gzip=function(y,b){return(b=b||{}).gzip=!0,v(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,s){var r=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),h=t("./zlib/zstream"),f=t("./zlib/gzheader"),d=Object.prototype.toString;function p(m){if(!(this instanceof p))return new p(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||m&&m.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=r.inflateInit2(this.strm,v.windowBits);if(y!==l.Z_OK)throw new Error(c[y]);this.header=new f,r.inflateGetHeader(this.strm,this.header)}u(p,"a");function g(m,v){var y=new p(v);if(y.push(m,!0),y.err)throw y.msg||c[y.err];return y.result}u(g,"o"),p.prototype.push=function(m,v){var y,b,_,x,w,M,C=this.strm,A=this.options.chunkSize,P=this.options.dictionary,D=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?C.input=a.binstring2buf(m):d.call(m)==="[object ArrayBuffer]"?C.input=new Uint8Array(m):C.input=m,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(A),C.next_out=0,C.avail_out=A),(y=r.inflate(C,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&P&&(M=typeof P=="string"?a.string2buf(P):d.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,y=r.inflateSetDictionary(this.strm,M)),y===l.Z_BUF_ERROR&&D===!0&&(y=l.Z_OK,D=!1),y!==l.Z_STREAM_END&&y!==l.Z_OK)return this.onEnd(y),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&y!==l.Z_STREAM_END&&(C.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=a.utf8border(C.output,C.next_out),x=C.next_out-_,w=a.buf2string(C.output,_),C.next_out=x,C.avail_out=A-x,x&&o.arraySet(C.output,C.output,_,x,0),this.onData(w)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(D=!0)}while((0<C.avail_in||C.avail_out===0)&&y!==l.Z_STREAM_END);return y===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(y=r.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(C.avail_out=0))},p.prototype.onData=function(m){this.chunks.push(m)},p.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},s.Inflate=p,s.inflate=g,s.inflateRaw=function(m,v){return(v=v||{}).raw=!0,g(m,v)},s.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,s){var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";s.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var f in h)h.hasOwnProperty(f)&&(l[f]=h[f])}}return l},s.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,h,f,d){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+f),d);else for(var p=0;p<f;p++)l[d+p]=c[h+p]},flattenChunks:function(l){var c,h,f,d,p,g;for(c=f=0,h=l.length;c<h;c++)f+=l[c].length;for(g=new Uint8Array(f),c=d=0,h=l.length;c<h;c++)p=l[c],g.set(p,d),d+=p.length;return g}},a={arraySet:function(l,c,h,f,d){for(var p=0;p<f;p++)l[d+p]=c[h+p]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,o)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,a))},s.setTyped(r)},{}],42:[function(t,i,s){var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(f,d){if(d<65537&&(f.subarray&&a||!f.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(f,d));for(var p="",g=0;g<d;g++)p+=String.fromCharCode(f[g]);return p}u(h,"l"),l[254]=l[254]=1,s.string2buf=function(f){var d,p,g,m,v,y=f.length,b=0;for(m=0;m<y;m++)(64512&(p=f.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=f.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),m++),b+=p<128?1:p<2048?2:p<65536?3:4;for(d=new r.Buf8(b),m=v=0;v<b;m++)(64512&(p=f.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=f.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),m++),p<128?d[v++]=p:(p<2048?d[v++]=192|p>>>6:(p<65536?d[v++]=224|p>>>12:(d[v++]=240|p>>>18,d[v++]=128|p>>>12&63),d[v++]=128|p>>>6&63),d[v++]=128|63&p);return d},s.buf2binstring=function(f){return h(f,f.length)},s.binstring2buf=function(f){for(var d=new r.Buf8(f.length),p=0,g=d.length;p<g;p++)d[p]=f.charCodeAt(p);return d},s.buf2string=function(f,d){var p,g,m,v,y=d||f.length,b=new Array(2*y);for(p=g=0;p<y;)if((m=f[p++])<128)b[g++]=m;else if(4<(v=l[m]))b[g++]=65533,p+=v-1;else{for(m&=v===2?31:v===3?15:7;1<v&&p<y;)m=m<<6|63&f[p++],v--;1<v?b[g++]=65533:m<65536?b[g++]=m:(m-=65536,b[g++]=55296|m>>10&1023,b[g++]=56320|1023&m)}return h(b,g)},s.utf8border=function(f,d){var p;for((d=d||f.length)>f.length&&(d=f.length),p=d-1;0<=p&&(192&f[p])==128;)p--;return p<0||p===0?d:p+l[f[p]]>d?p:d}},{"./common":41}],43:[function(t,i,s){i.exports=function(r,o,a,l){for(var c=65535&r|0,h=r>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;h=h+(c=c+o[l++]|0)|0,--f;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(t,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,s){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();i.exports=function(o,a,l,c){var h=r,f=c+l;o^=-1;for(var d=c;d<f;d++)o=o>>>8^h[255&(o^a[d])];return-1^o}},{}],46:[function(t,i,s){var r,o=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),h=t("./messages"),f=0,d=4,p=0,g=-2,m=-1,v=4,y=2,b=8,_=9,x=286,w=30,M=19,C=2*x+1,A=15,P=3,D=258,k=D+P+1,O=42,N=113,E=1,B=2,W=3,Z=4;function ne(R,ee){return R.msg=h[ee],ee}u(ne,"R");function j(R){return(R<<1)-(4<R?9:0)}u(j,"T");function ie(R){for(var ee=R.length;0<=--ee;)R[ee]=0}u(ie,"D");function K(R){var ee=R.state,Q=ee.pending;Q>R.avail_out&&(Q=R.avail_out),Q!==0&&(o.arraySet(R.output,ee.pending_buf,ee.pending_out,Q,R.next_out),R.next_out+=Q,ee.pending_out+=Q,R.total_out+=Q,R.avail_out-=Q,ee.pending-=Q,ee.pending===0&&(ee.pending_out=0))}u(K,"F");function $(R,ee){a._tr_flush_block(R,0<=R.block_start?R.block_start:-1,R.strstart-R.block_start,ee),R.block_start=R.strstart,K(R.strm)}u($,"N");function le(R,ee){R.pending_buf[R.pending++]=ee}u(le,"U");function ae(R,ee){R.pending_buf[R.pending++]=ee>>>8&255,R.pending_buf[R.pending++]=255&ee}u(ae,"P");function J(R,ee){var Q,U,F=R.max_chain_length,H=R.strstart,re=R.prev_length,z=R.nice_match,I=R.strstart>R.w_size-k?R.strstart-(R.w_size-k):0,L=R.window,G=R.w_mask,X=R.prev,se=R.strstart+D,de=L[H+re-1],me=L[H+re];R.prev_length>=R.good_match&&(F>>=2),z>R.lookahead&&(z=R.lookahead);do if(L[(Q=ee)+re]===me&&L[Q+re-1]===de&&L[Q]===L[H]&&L[++Q]===L[H+1]){H+=2,Q++;do;while(L[++H]===L[++Q]&&L[++H]===L[++Q]&&L[++H]===L[++Q]&&L[++H]===L[++Q]&&L[++H]===L[++Q]&&L[++H]===L[++Q]&&L[++H]===L[++Q]&&L[++H]===L[++Q]&&H<se);if(U=D-(se-H),H=se-D,re<U){if(R.match_start=ee,z<=(re=U))break;de=L[H+re-1],me=L[H+re]}}while((ee=X[ee&G])>I&&--F!=0);return re<=R.lookahead?re:R.lookahead}u(J,"L");function te(R){var ee,Q,U,F,H,re,z,I,L,G,X=R.w_size;do{if(F=R.window_size-R.lookahead-R.strstart,R.strstart>=X+(X-k)){for(o.arraySet(R.window,R.window,X,X,0),R.match_start-=X,R.strstart-=X,R.block_start-=X,ee=Q=R.hash_size;U=R.head[--ee],R.head[ee]=X<=U?U-X:0,--Q;);for(ee=Q=X;U=R.prev[--ee],R.prev[ee]=X<=U?U-X:0,--Q;);F+=X}if(R.strm.avail_in===0)break;if(re=R.strm,z=R.window,I=R.strstart+R.lookahead,L=F,G=void 0,G=re.avail_in,L<G&&(G=L),Q=G===0?0:(re.avail_in-=G,o.arraySet(z,re.input,re.next_in,G,I),re.state.wrap===1?re.adler=l(re.adler,z,G,I):re.state.wrap===2&&(re.adler=c(re.adler,z,G,I)),re.next_in+=G,re.total_in+=G,G),R.lookahead+=Q,R.lookahead+R.insert>=P)for(H=R.strstart-R.insert,R.ins_h=R.window[H],R.ins_h=(R.ins_h<<R.hash_shift^R.window[H+1])&R.hash_mask;R.insert&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[H+P-1])&R.hash_mask,R.prev[H&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=H,H++,R.insert--,!(R.lookahead+R.insert<P)););}while(R.lookahead<k&&R.strm.avail_in!==0)}u(te,"j");function ge(R,ee){for(var Q,U;;){if(R.lookahead<k){if(te(R),R.lookahead<k&&ee===f)return E;if(R.lookahead===0)break}if(Q=0,R.lookahead>=P&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+P-1])&R.hash_mask,Q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),Q!==0&&R.strstart-Q<=R.w_size-k&&(R.match_length=J(R,Q)),R.match_length>=P)if(U=a._tr_tally(R,R.strstart-R.match_start,R.match_length-P),R.lookahead-=R.match_length,R.match_length<=R.max_lazy_match&&R.lookahead>=P){for(R.match_length--;R.strstart++,R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+P-1])&R.hash_mask,Q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart,--R.match_length!=0;);R.strstart++}else R.strstart+=R.match_length,R.match_length=0,R.ins_h=R.window[R.strstart],R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+1])&R.hash_mask;else U=a._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++;if(U&&($(R,!1),R.strm.avail_out===0))return E}return R.insert=R.strstart<P-1?R.strstart:P-1,ee===d?($(R,!0),R.strm.avail_out===0?W:Z):R.last_lit&&($(R,!1),R.strm.avail_out===0)?E:B}u(ge,"Z");function he(R,ee){for(var Q,U,F;;){if(R.lookahead<k){if(te(R),R.lookahead<k&&ee===f)return E;if(R.lookahead===0)break}if(Q=0,R.lookahead>=P&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+P-1])&R.hash_mask,Q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),R.prev_length=R.match_length,R.prev_match=R.match_start,R.match_length=P-1,Q!==0&&R.prev_length<R.max_lazy_match&&R.strstart-Q<=R.w_size-k&&(R.match_length=J(R,Q),R.match_length<=5&&(R.strategy===1||R.match_length===P&&4096<R.strstart-R.match_start)&&(R.match_length=P-1)),R.prev_length>=P&&R.match_length<=R.prev_length){for(F=R.strstart+R.lookahead-P,U=a._tr_tally(R,R.strstart-1-R.prev_match,R.prev_length-P),R.lookahead-=R.prev_length-1,R.prev_length-=2;++R.strstart<=F&&(R.ins_h=(R.ins_h<<R.hash_shift^R.window[R.strstart+P-1])&R.hash_mask,Q=R.prev[R.strstart&R.w_mask]=R.head[R.ins_h],R.head[R.ins_h]=R.strstart),--R.prev_length!=0;);if(R.match_available=0,R.match_length=P-1,R.strstart++,U&&($(R,!1),R.strm.avail_out===0))return E}else if(R.match_available){if((U=a._tr_tally(R,0,R.window[R.strstart-1]))&&$(R,!1),R.strstart++,R.lookahead--,R.strm.avail_out===0)return E}else R.match_available=1,R.strstart++,R.lookahead--}return R.match_available&&(U=a._tr_tally(R,0,R.window[R.strstart-1]),R.match_available=0),R.insert=R.strstart<P-1?R.strstart:P-1,ee===d?($(R,!0),R.strm.avail_out===0?W:Z):R.last_lit&&($(R,!1),R.strm.avail_out===0)?E:B}u(he,"W");function we(R,ee,Q,U,F){this.good_length=R,this.max_lazy=ee,this.nice_length=Q,this.max_chain=U,this.func=F}u(we,"M");function xe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*M+1)),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(A+1),this.heap=new o.Buf16(2*x+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*x+1),ie(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}u(xe,"H");function Se(R){var ee;return R&&R.state?(R.total_in=R.total_out=0,R.data_type=y,(ee=R.state).pending=0,ee.pending_out=0,ee.wrap<0&&(ee.wrap=-ee.wrap),ee.status=ee.wrap?O:N,R.adler=ee.wrap===2?0:1,ee.last_flush=f,a._tr_init(ee),p):ne(R,g)}u(Se,"G");function V(R){var ee=Se(R);return ee===p&&function(Q){Q.window_size=2*Q.w_size,ie(Q.head),Q.max_lazy_match=r[Q.level].max_lazy,Q.good_match=r[Q.level].good_length,Q.nice_match=r[Q.level].nice_length,Q.max_chain_length=r[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=P-1,Q.match_available=0,Q.ins_h=0}(R.state),ee}u(V,"K");function Y(R,ee,Q,U,F,H){if(!R)return g;var re=1;if(ee===m&&(ee=6),U<0?(re=0,U=-U):15<U&&(re=2,U-=16),F<1||_<F||Q!==b||U<8||15<U||ee<0||9<ee||H<0||v<H)return ne(R,g);U===8&&(U=9);var z=new xe;return(R.state=z).strm=R,z.wrap=re,z.gzhead=null,z.w_bits=U,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=F+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+P-1)/P),z.window=new o.Buf8(2*z.w_size),z.head=new o.Buf16(z.hash_size),z.prev=new o.Buf16(z.w_size),z.lit_bufsize=1<<F+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new o.Buf8(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=ee,z.strategy=H,z.method=Q,V(R)}u(Y,"Y"),r=[new we(0,0,0,0,function(R,ee){var Q=65535;for(Q>R.pending_buf_size-5&&(Q=R.pending_buf_size-5);;){if(R.lookahead<=1){if(te(R),R.lookahead===0&&ee===f)return E;if(R.lookahead===0)break}R.strstart+=R.lookahead,R.lookahead=0;var U=R.block_start+Q;if((R.strstart===0||R.strstart>=U)&&(R.lookahead=R.strstart-U,R.strstart=U,$(R,!1),R.strm.avail_out===0)||R.strstart-R.block_start>=R.w_size-k&&($(R,!1),R.strm.avail_out===0))return E}return R.insert=0,ee===d?($(R,!0),R.strm.avail_out===0?W:Z):(R.strstart>R.block_start&&($(R,!1),R.strm.avail_out),E)}),new we(4,4,8,4,ge),new we(4,5,16,8,ge),new we(4,6,32,32,ge),new we(4,4,16,16,he),new we(8,16,32,32,he),new we(8,16,128,128,he),new we(8,32,128,256,he),new we(32,128,258,1024,he),new we(32,258,258,4096,he)],s.deflateInit=function(R,ee){return Y(R,ee,b,15,8,0)},s.deflateInit2=Y,s.deflateReset=V,s.deflateResetKeep=Se,s.deflateSetHeader=function(R,ee){return R&&R.state?R.state.wrap!==2?g:(R.state.gzhead=ee,p):g},s.deflate=function(R,ee){var Q,U,F,H;if(!R||!R.state||5<ee||ee<0)return R?ne(R,g):g;if(U=R.state,!R.output||!R.input&&R.avail_in!==0||U.status===666&&ee!==d)return ne(R,R.avail_out===0?-5:g);if(U.strm=R,Q=U.last_flush,U.last_flush=ee,U.status===O)if(U.wrap===2)R.adler=0,le(U,31),le(U,139),le(U,8),U.gzhead?(le(U,(U.gzhead.text?1:0)+(U.gzhead.hcrc?2:0)+(U.gzhead.extra?4:0)+(U.gzhead.name?8:0)+(U.gzhead.comment?16:0)),le(U,255&U.gzhead.time),le(U,U.gzhead.time>>8&255),le(U,U.gzhead.time>>16&255),le(U,U.gzhead.time>>24&255),le(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),le(U,255&U.gzhead.os),U.gzhead.extra&&U.gzhead.extra.length&&(le(U,255&U.gzhead.extra.length),le(U,U.gzhead.extra.length>>8&255)),U.gzhead.hcrc&&(R.adler=c(R.adler,U.pending_buf,U.pending,0)),U.gzindex=0,U.status=69):(le(U,0),le(U,0),le(U,0),le(U,0),le(U,0),le(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),le(U,3),U.status=N);else{var re=b+(U.w_bits-8<<4)<<8;re|=(2<=U.strategy||U.level<2?0:U.level<6?1:U.level===6?2:3)<<6,U.strstart!==0&&(re|=32),re+=31-re%31,U.status=N,ae(U,re),U.strstart!==0&&(ae(U,R.adler>>>16),ae(U,65535&R.adler)),R.adler=1}if(U.status===69)if(U.gzhead.extra){for(F=U.pending;U.gzindex<(65535&U.gzhead.extra.length)&&(U.pending!==U.pending_buf_size||(U.gzhead.hcrc&&U.pending>F&&(R.adler=c(R.adler,U.pending_buf,U.pending-F,F)),K(R),F=U.pending,U.pending!==U.pending_buf_size));)le(U,255&U.gzhead.extra[U.gzindex]),U.gzindex++;U.gzhead.hcrc&&U.pending>F&&(R.adler=c(R.adler,U.pending_buf,U.pending-F,F)),U.gzindex===U.gzhead.extra.length&&(U.gzindex=0,U.status=73)}else U.status=73;if(U.status===73)if(U.gzhead.name){F=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>F&&(R.adler=c(R.adler,U.pending_buf,U.pending-F,F)),K(R),F=U.pending,U.pending===U.pending_buf_size)){H=1;break}H=U.gzindex<U.gzhead.name.length?255&U.gzhead.name.charCodeAt(U.gzindex++):0,le(U,H)}while(H!==0);U.gzhead.hcrc&&U.pending>F&&(R.adler=c(R.adler,U.pending_buf,U.pending-F,F)),H===0&&(U.gzindex=0,U.status=91)}else U.status=91;if(U.status===91)if(U.gzhead.comment){F=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>F&&(R.adler=c(R.adler,U.pending_buf,U.pending-F,F)),K(R),F=U.pending,U.pending===U.pending_buf_size)){H=1;break}H=U.gzindex<U.gzhead.comment.length?255&U.gzhead.comment.charCodeAt(U.gzindex++):0,le(U,H)}while(H!==0);U.gzhead.hcrc&&U.pending>F&&(R.adler=c(R.adler,U.pending_buf,U.pending-F,F)),H===0&&(U.status=103)}else U.status=103;if(U.status===103&&(U.gzhead.hcrc?(U.pending+2>U.pending_buf_size&&K(R),U.pending+2<=U.pending_buf_size&&(le(U,255&R.adler),le(U,R.adler>>8&255),R.adler=0,U.status=N)):U.status=N),U.pending!==0){if(K(R),R.avail_out===0)return U.last_flush=-1,p}else if(R.avail_in===0&&j(ee)<=j(Q)&&ee!==d)return ne(R,-5);if(U.status===666&&R.avail_in!==0)return ne(R,-5);if(R.avail_in!==0||U.lookahead!==0||ee!==f&&U.status!==666){var z=U.strategy===2?function(I,L){for(var G;;){if(I.lookahead===0&&(te(I),I.lookahead===0)){if(L===f)return E;break}if(I.match_length=0,G=a._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,G&&($(I,!1),I.strm.avail_out===0))return E}return I.insert=0,L===d?($(I,!0),I.strm.avail_out===0?W:Z):I.last_lit&&($(I,!1),I.strm.avail_out===0)?E:B}(U,ee):U.strategy===3?function(I,L){for(var G,X,se,de,me=I.window;;){if(I.lookahead<=D){if(te(I),I.lookahead<=D&&L===f)return E;if(I.lookahead===0)break}if(I.match_length=0,I.lookahead>=P&&0<I.strstart&&(X=me[se=I.strstart-1])===me[++se]&&X===me[++se]&&X===me[++se]){de=I.strstart+D;do;while(X===me[++se]&&X===me[++se]&&X===me[++se]&&X===me[++se]&&X===me[++se]&&X===me[++se]&&X===me[++se]&&X===me[++se]&&se<de);I.match_length=D-(de-se),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=P?(G=a._tr_tally(I,1,I.match_length-P),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(G=a._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),G&&($(I,!1),I.strm.avail_out===0))return E}return I.insert=0,L===d?($(I,!0),I.strm.avail_out===0?W:Z):I.last_lit&&($(I,!1),I.strm.avail_out===0)?E:B}(U,ee):r[U.level].func(U,ee);if(z!==W&&z!==Z||(U.status=666),z===E||z===W)return R.avail_out===0&&(U.last_flush=-1),p;if(z===B&&(ee===1?a._tr_align(U):ee!==5&&(a._tr_stored_block(U,0,0,!1),ee===3&&(ie(U.head),U.lookahead===0&&(U.strstart=0,U.block_start=0,U.insert=0))),K(R),R.avail_out===0))return U.last_flush=-1,p}return ee!==d?p:U.wrap<=0?1:(U.wrap===2?(le(U,255&R.adler),le(U,R.adler>>8&255),le(U,R.adler>>16&255),le(U,R.adler>>24&255),le(U,255&R.total_in),le(U,R.total_in>>8&255),le(U,R.total_in>>16&255),le(U,R.total_in>>24&255)):(ae(U,R.adler>>>16),ae(U,65535&R.adler)),K(R),0<U.wrap&&(U.wrap=-U.wrap),U.pending!==0?p:1)},s.deflateEnd=function(R){var ee;return R&&R.state?(ee=R.state.status)!==O&&ee!==69&&ee!==73&&ee!==91&&ee!==103&&ee!==N&&ee!==666?ne(R,g):(R.state=null,ee===N?ne(R,-3):p):g},s.deflateSetDictionary=function(R,ee){var Q,U,F,H,re,z,I,L,G=ee.length;if(!R||!R.state||(H=(Q=R.state).wrap)===2||H===1&&Q.status!==O||Q.lookahead)return g;for(H===1&&(R.adler=l(R.adler,ee,G,0)),Q.wrap=0,G>=Q.w_size&&(H===0&&(ie(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0),L=new o.Buf8(Q.w_size),o.arraySet(L,ee,G-Q.w_size,Q.w_size,0),ee=L,G=Q.w_size),re=R.avail_in,z=R.next_in,I=R.input,R.avail_in=G,R.next_in=0,R.input=ee,te(Q);Q.lookahead>=P;){for(U=Q.strstart,F=Q.lookahead-(P-1);Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[U+P-1])&Q.hash_mask,Q.prev[U&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=U,U++,--F;);Q.strstart=U,Q.lookahead=P-1,te(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=P-1,Q.match_available=0,R.next_in=z,R.input=I,R.avail_in=re,Q.wrap=H,p},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,s){i.exports=function(r,o){var a,l,c,h,f,d,p,g,m,v,y,b,_,x,w,M,C,A,P,D,k,O,N,E,B;a=r.state,l=r.next_in,E=r.input,c=l+(r.avail_in-5),h=r.next_out,B=r.output,f=h-(o-r.avail_out),d=h+(r.avail_out-257),p=a.dmax,g=a.wsize,m=a.whave,v=a.wnext,y=a.window,b=a.hold,_=a.bits,x=a.lencode,w=a.distcode,M=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;e:do{_<15&&(b+=E[l++]<<_,_+=8,b+=E[l++]<<_,_+=8),A=x[b&M];t:for(;;){if(b>>>=P=A>>>24,_-=P,(P=A>>>16&255)===0)B[h++]=65535&A;else{if(!(16&P)){if((64&P)==0){A=x[(65535&A)+(b&(1<<P)-1)];continue t}if(32&P){a.mode=12;break e}r.msg="invalid literal/length code",a.mode=30;break e}D=65535&A,(P&=15)&&(_<P&&(b+=E[l++]<<_,_+=8),D+=b&(1<<P)-1,b>>>=P,_-=P),_<15&&(b+=E[l++]<<_,_+=8,b+=E[l++]<<_,_+=8),A=w[b&C];n:for(;;){if(b>>>=P=A>>>24,_-=P,!(16&(P=A>>>16&255))){if((64&P)==0){A=w[(65535&A)+(b&(1<<P)-1)];continue n}r.msg="invalid distance code",a.mode=30;break e}if(k=65535&A,_<(P&=15)&&(b+=E[l++]<<_,(_+=8)<P&&(b+=E[l++]<<_,_+=8)),p<(k+=b&(1<<P)-1)){r.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=P,_-=P,(P=h-f)<k){if(m<(P=k-P)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break e}if(N=y,(O=0)===v){if(O+=g-P,P<D){for(D-=P;B[h++]=y[O++],--P;);O=h-k,N=B}}else if(v<P){if(O+=g+v-P,(P-=v)<D){for(D-=P;B[h++]=y[O++],--P;);if(O=0,v<D){for(D-=P=v;B[h++]=y[O++],--P;);O=h-k,N=B}}}else if(O+=v-P,P<D){for(D-=P;B[h++]=y[O++],--P;);O=h-k,N=B}for(;2<D;)B[h++]=N[O++],B[h++]=N[O++],B[h++]=N[O++],D-=3;D&&(B[h++]=N[O++],1<D&&(B[h++]=N[O++]))}else{for(O=h-k;B[h++]=B[O++],B[h++]=B[O++],B[h++]=B[O++],2<(D-=3););D&&(B[h++]=B[O++],1<D&&(B[h++]=B[O++]))}break}}break}}while(l<c&&h<d);l-=D=_>>3,b&=(1<<(_-=D<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<d?d-h+257:257-(h-d),a.hold=b,a.bits=_}},{}],49:[function(t,i,s){var r=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),h=1,f=2,d=0,p=-2,g=1,m=852,v=592;function y(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}u(y,"L");function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}u(b,"s");function _(O){var N;return O&&O.state?(N=O.state,O.total_in=O.total_out=N.total=0,O.msg="",N.wrap&&(O.adler=1&N.wrap),N.mode=g,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new r.Buf32(m),N.distcode=N.distdyn=new r.Buf32(v),N.sane=1,N.back=-1,d):p}u(_,"a");function x(O){var N;return O&&O.state?((N=O.state).wsize=0,N.whave=0,N.wnext=0,_(O)):p}u(x,"o");function w(O,N){var E,B;return O&&O.state?(B=O.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?p:(B.window!==null&&B.wbits!==N&&(B.window=null),B.wrap=E,B.wbits=N,x(O))):p}u(w,"h");function M(O,N){var E,B;return O?(B=new b,(O.state=B).window=null,(E=w(O,N))!==d&&(O.state=null),E):p}u(M,"u");var C,A,P=!0;function D(O){if(P){var N;for(C=new r.Buf32(512),A=new r.Buf32(32),N=0;N<144;)O.lens[N++]=8;for(;N<256;)O.lens[N++]=9;for(;N<280;)O.lens[N++]=7;for(;N<288;)O.lens[N++]=8;for(c(h,O.lens,0,288,C,0,O.work,{bits:9}),N=0;N<32;)O.lens[N++]=5;c(f,O.lens,0,32,A,0,O.work,{bits:5}),P=!1}O.lencode=C,O.lenbits=9,O.distcode=A,O.distbits=5}u(D,"j");function k(O,N,E,B){var W,Z=O.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new r.Buf8(Z.wsize)),B>=Z.wsize?(r.arraySet(Z.window,N,E-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(B<(W=Z.wsize-Z.wnext)&&(W=B),r.arraySet(Z.window,N,E-B,W,Z.wnext),(B-=W)?(r.arraySet(Z.window,N,E-B,B,0),Z.wnext=B,Z.whave=Z.wsize):(Z.wnext+=W,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=W))),0}u(k,"Z"),s.inflateReset=x,s.inflateReset2=w,s.inflateResetKeep=_,s.inflateInit=function(O){return M(O,15)},s.inflateInit2=M,s.inflate=function(O,N){var E,B,W,Z,ne,j,ie,K,$,le,ae,J,te,ge,he,we,xe,Se,V,Y,R,ee,Q,U,F=0,H=new r.Buf8(4),re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return p;(E=O.state).mode===12&&(E.mode=13),ne=O.next_out,W=O.output,ie=O.avail_out,Z=O.next_in,B=O.input,j=O.avail_in,K=E.hold,$=E.bits,le=j,ae=ie,ee=d;e:for(;;)switch(E.mode){case g:if(E.wrap===0){E.mode=13;break}for(;$<16;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(2&E.wrap&&K===35615){H[E.check=0]=255&K,H[1]=K>>>8&255,E.check=a(E.check,H,2,0),$=K=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&K)<<8)+(K>>8))%31){O.msg="incorrect header check",E.mode=30;break}if((15&K)!=8){O.msg="unknown compression method",E.mode=30;break}if($-=4,R=8+(15&(K>>>=4)),E.wbits===0)E.wbits=R;else if(R>E.wbits){O.msg="invalid window size",E.mode=30;break}E.dmax=1<<R,O.adler=E.check=1,E.mode=512&K?10:12,$=K=0;break;case 2:for(;$<16;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(E.flags=K,(255&E.flags)!=8){O.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){O.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=K>>8&1),512&E.flags&&(H[0]=255&K,H[1]=K>>>8&255,E.check=a(E.check,H,2,0)),$=K=0,E.mode=3;case 3:for(;$<32;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}E.head&&(E.head.time=K),512&E.flags&&(H[0]=255&K,H[1]=K>>>8&255,H[2]=K>>>16&255,H[3]=K>>>24&255,E.check=a(E.check,H,4,0)),$=K=0,E.mode=4;case 4:for(;$<16;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}E.head&&(E.head.xflags=255&K,E.head.os=K>>8),512&E.flags&&(H[0]=255&K,H[1]=K>>>8&255,E.check=a(E.check,H,2,0)),$=K=0,E.mode=5;case 5:if(1024&E.flags){for(;$<16;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}E.length=K,E.head&&(E.head.extra_len=K),512&E.flags&&(H[0]=255&K,H[1]=K>>>8&255,E.check=a(E.check,H,2,0)),$=K=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(j<(J=E.length)&&(J=j),J&&(E.head&&(R=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),r.arraySet(E.head.extra,B,Z,J,R)),512&E.flags&&(E.check=a(E.check,B,J,Z)),j-=J,Z+=J,E.length-=J),E.length))break e;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(j===0)break e;for(J=0;R=B[Z+J++],E.head&&R&&E.length<65536&&(E.head.name+=String.fromCharCode(R)),R&&J<j;);if(512&E.flags&&(E.check=a(E.check,B,J,Z)),j-=J,Z+=J,R)break e}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(j===0)break e;for(J=0;R=B[Z+J++],E.head&&R&&E.length<65536&&(E.head.comment+=String.fromCharCode(R)),R&&J<j;);if(512&E.flags&&(E.check=a(E.check,B,J,Z)),j-=J,Z+=J,R)break e}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;$<16;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(K!==(65535&E.check)){O.msg="header crc mismatch",E.mode=30;break}$=K=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),O.adler=E.check=0,E.mode=12;break;case 10:for(;$<32;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}O.adler=E.check=y(K),$=K=0,E.mode=11;case 11:if(E.havedict===0)return O.next_out=ne,O.avail_out=ie,O.next_in=Z,O.avail_in=j,E.hold=K,E.bits=$,2;O.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break e;case 13:if(E.last){K>>>=7&$,$-=7&$,E.mode=27;break}for(;$<3;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}switch(E.last=1&K,$-=1,3&(K>>>=1)){case 0:E.mode=14;break;case 1:if(D(E),E.mode=20,N!==6)break;K>>>=2,$-=2;break e;case 2:E.mode=17;break;case 3:O.msg="invalid block type",E.mode=30}K>>>=2,$-=2;break;case 14:for(K>>>=7&$,$-=7&$;$<32;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if((65535&K)!=(K>>>16^65535)){O.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&K,$=K=0,E.mode=15,N===6)break e;case 15:E.mode=16;case 16:if(J=E.length){if(j<J&&(J=j),ie<J&&(J=ie),J===0)break e;r.arraySet(W,B,Z,J,ne),j-=J,Z+=J,ie-=J,ne+=J,E.length-=J;break}E.mode=12;break;case 17:for(;$<14;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(E.nlen=257+(31&K),K>>>=5,$-=5,E.ndist=1+(31&K),K>>>=5,$-=5,E.ncode=4+(15&K),K>>>=4,$-=4,286<E.nlen||30<E.ndist){O.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;$<3;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}E.lens[re[E.have++]]=7&K,K>>>=3,$-=3}for(;E.have<19;)E.lens[re[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,Q={bits:E.lenbits},ee=c(0,E.lens,0,19,E.lencode,0,E.work,Q),E.lenbits=Q.bits,ee){O.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;we=(F=E.lencode[K&(1<<E.lenbits)-1])>>>16&255,xe=65535&F,!((he=F>>>24)<=$);){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(xe<16)K>>>=he,$-=he,E.lens[E.have++]=xe;else{if(xe===16){for(U=he+2;$<U;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(K>>>=he,$-=he,E.have===0){O.msg="invalid bit length repeat",E.mode=30;break}R=E.lens[E.have-1],J=3+(3&K),K>>>=2,$-=2}else if(xe===17){for(U=he+3;$<U;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}$-=he,R=0,J=3+(7&(K>>>=he)),K>>>=3,$-=3}else{for(U=he+7;$<U;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}$-=he,R=0,J=11+(127&(K>>>=he)),K>>>=7,$-=7}if(E.have+J>E.nlen+E.ndist){O.msg="invalid bit length repeat",E.mode=30;break}for(;J--;)E.lens[E.have++]=R}}if(E.mode===30)break;if(E.lens[256]===0){O.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,Q={bits:E.lenbits},ee=c(h,E.lens,0,E.nlen,E.lencode,0,E.work,Q),E.lenbits=Q.bits,ee){O.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,Q={bits:E.distbits},ee=c(f,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,Q),E.distbits=Q.bits,ee){O.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break e;case 20:E.mode=21;case 21:if(6<=j&&258<=ie){O.next_out=ne,O.avail_out=ie,O.next_in=Z,O.avail_in=j,E.hold=K,E.bits=$,l(O,ae),ne=O.next_out,W=O.output,ie=O.avail_out,Z=O.next_in,B=O.input,j=O.avail_in,K=E.hold,$=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;we=(F=E.lencode[K&(1<<E.lenbits)-1])>>>16&255,xe=65535&F,!((he=F>>>24)<=$);){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(we&&(240&we)==0){for(Se=he,V=we,Y=xe;we=(F=E.lencode[Y+((K&(1<<Se+V)-1)>>Se)])>>>16&255,xe=65535&F,!(Se+(he=F>>>24)<=$);){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}K>>>=Se,$-=Se,E.back+=Se}if(K>>>=he,$-=he,E.back+=he,E.length=xe,we===0){E.mode=26;break}if(32&we){E.back=-1,E.mode=12;break}if(64&we){O.msg="invalid literal/length code",E.mode=30;break}E.extra=15&we,E.mode=22;case 22:if(E.extra){for(U=E.extra;$<U;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}E.length+=K&(1<<E.extra)-1,K>>>=E.extra,$-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;we=(F=E.distcode[K&(1<<E.distbits)-1])>>>16&255,xe=65535&F,!((he=F>>>24)<=$);){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if((240&we)==0){for(Se=he,V=we,Y=xe;we=(F=E.distcode[Y+((K&(1<<Se+V)-1)>>Se)])>>>16&255,xe=65535&F,!(Se+(he=F>>>24)<=$);){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}K>>>=Se,$-=Se,E.back+=Se}if(K>>>=he,$-=he,E.back+=he,64&we){O.msg="invalid distance code",E.mode=30;break}E.offset=xe,E.extra=15&we,E.mode=24;case 24:if(E.extra){for(U=E.extra;$<U;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}E.offset+=K&(1<<E.extra)-1,K>>>=E.extra,$-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){O.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(ie===0)break e;if(J=ae-ie,E.offset>J){if((J=E.offset-J)>E.whave&&E.sane){O.msg="invalid distance too far back",E.mode=30;break}te=J>E.wnext?(J-=E.wnext,E.wsize-J):E.wnext-J,J>E.length&&(J=E.length),ge=E.window}else ge=W,te=ne-E.offset,J=E.length;for(ie<J&&(J=ie),ie-=J,E.length-=J;W[ne++]=ge[te++],--J;);E.length===0&&(E.mode=21);break;case 26:if(ie===0)break e;W[ne++]=E.length,ie--,E.mode=21;break;case 27:if(E.wrap){for(;$<32;){if(j===0)break e;j--,K|=B[Z++]<<$,$+=8}if(ae-=ie,O.total_out+=ae,E.total+=ae,ae&&(O.adler=E.check=E.flags?a(E.check,W,ae,ne-ae):o(E.check,W,ae,ne-ae)),ae=ie,(E.flags?K:y(K))!==E.check){O.msg="incorrect data check",E.mode=30;break}$=K=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;$<32;){if(j===0)break e;j--,K+=B[Z++]<<$,$+=8}if(K!==(4294967295&E.total)){O.msg="incorrect length check",E.mode=30;break}$=K=0}E.mode=29;case 29:ee=1;break e;case 30:ee=-3;break e;case 31:return-4;case 32:default:return p}return O.next_out=ne,O.avail_out=ie,O.next_in=Z,O.avail_in=j,E.hold=K,E.bits=$,(E.wsize||ae!==O.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&k(O,O.output,O.next_out,ae-O.avail_out)?(E.mode=31,-4):(le-=O.avail_in,ae-=O.avail_out,O.total_in+=le,O.total_out+=ae,E.total+=ae,E.wrap&&ae&&(O.adler=E.check=E.flags?a(E.check,W,ae,O.next_out-ae):o(E.check,W,ae,O.next_out-ae)),O.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(le==0&&ae===0||N===4)&&ee===d&&(ee=-5),ee)},s.inflateEnd=function(O){if(!O||!O.state)return p;var N=O.state;return N.window&&(N.window=null),O.state=null,d},s.inflateGetHeader=function(O,N){var E;return O&&O.state?(2&(E=O.state).wrap)==0?p:((E.head=N).done=!1,d):p},s.inflateSetDictionary=function(O,N){var E,B=N.length;return O&&O.state?(E=O.state).wrap!==0&&E.mode!==11?p:E.mode===11&&o(1,N,B,0)!==E.check?-3:k(O,N,B,B)?(E.mode=31,-4):(E.havedict=1,d):p},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,s){var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(h,f,d,p,g,m,v,y){var b,_,x,w,M,C,A,P,D,k=y.bits,O=0,N=0,E=0,B=0,W=0,Z=0,ne=0,j=0,ie=0,K=0,$=null,le=0,ae=new r.Buf16(16),J=new r.Buf16(16),te=null,ge=0;for(O=0;O<=15;O++)ae[O]=0;for(N=0;N<p;N++)ae[f[d+N]]++;for(W=k,B=15;1<=B&&ae[B]===0;B--);if(B<W&&(W=B),B===0)return g[m++]=20971520,g[m++]=20971520,y.bits=1,0;for(E=1;E<B&&ae[E]===0;E++);for(W<E&&(W=E),O=j=1;O<=15;O++)if(j<<=1,(j-=ae[O])<0)return-1;if(0<j&&(h===0||B!==1))return-1;for(J[1]=0,O=1;O<15;O++)J[O+1]=J[O]+ae[O];for(N=0;N<p;N++)f[d+N]!==0&&(v[J[f[d+N]]++]=N);if(C=h===0?($=te=v,19):h===1?($=o,le-=257,te=a,ge-=257,256):($=l,te=c,-1),O=E,M=m,ne=N=K=0,x=-1,w=(ie=1<<(Z=W))-1,h===1&&852<ie||h===2&&592<ie)return 1;for(;;){for(A=O-ne,D=v[N]<C?(P=0,v[N]):v[N]>C?(P=te[ge+v[N]],$[le+v[N]]):(P=96,0),b=1<<O-ne,E=_=1<<Z;g[M+(K>>ne)+(_-=b)]=A<<24|P<<16|D|0,_!==0;);for(b=1<<O-1;K&b;)b>>=1;if(b!==0?(K&=b-1,K+=b):K=0,N++,--ae[O]==0){if(O===B)break;O=f[d+v[N]]}if(W<O&&(K&w)!==x){for(ne===0&&(ne=W),M+=E,j=1<<(Z=O-ne);Z+ne<B&&!((j-=ae[Z+ne])<=0);)Z++,j<<=1;if(ie+=1<<Z,h===1&&852<ie||h===2&&592<ie)return 1;g[x=K&w]=W<<24|Z<<16|M-m|0}}return K!==0&&(g[M+K]=O-ne<<24|64<<16|0),y.bits=W,0}},{"../utils/common":41}],51:[function(t,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,s){var r=t("../utils/common"),o=0,a=1;function l(F){for(var H=F.length;0<=--H;)F[H]=0}u(l,"n");var c=0,h=29,f=256,d=f+1+h,p=30,g=19,m=2*d+1,v=15,y=16,b=7,_=256,x=16,w=17,M=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(d+2));l(k);var O=new Array(2*p);l(O);var N=new Array(512);l(N);var E=new Array(256);l(E);var B=new Array(h);l(B);var W,Z,ne,j=new Array(p);function ie(F,H,re,z,I){this.static_tree=F,this.extra_bits=H,this.extra_base=re,this.elems=z,this.max_length=I,this.has_stree=F&&F.length}u(ie,"D");function K(F,H){this.dyn_tree=F,this.max_code=0,this.stat_desc=H}u(K,"F");function $(F){return F<256?N[F]:N[256+(F>>>7)]}u($,"N");function le(F,H){F.pending_buf[F.pending++]=255&H,F.pending_buf[F.pending++]=H>>>8&255}u(le,"U");function ae(F,H,re){F.bi_valid>y-re?(F.bi_buf|=H<<F.bi_valid&65535,le(F,F.bi_buf),F.bi_buf=H>>y-F.bi_valid,F.bi_valid+=re-y):(F.bi_buf|=H<<F.bi_valid&65535,F.bi_valid+=re)}u(ae,"P");function J(F,H,re){ae(F,re[2*H],re[2*H+1])}u(J,"L");function te(F,H){for(var re=0;re|=1&F,F>>>=1,re<<=1,0<--H;);return re>>>1}u(te,"j");function ge(F,H,re){var z,I,L=new Array(v+1),G=0;for(z=1;z<=v;z++)L[z]=G=G+re[z-1]<<1;for(I=0;I<=H;I++){var X=F[2*I+1];X!==0&&(F[2*I]=te(L[X]++,X))}}u(ge,"Z");function he(F){var H;for(H=0;H<d;H++)F.dyn_ltree[2*H]=0;for(H=0;H<p;H++)F.dyn_dtree[2*H]=0;for(H=0;H<g;H++)F.bl_tree[2*H]=0;F.dyn_ltree[2*_]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}u(he,"W");function we(F){8<F.bi_valid?le(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}u(we,"M");function xe(F,H,re,z){var I=2*H,L=2*re;return F[I]<F[L]||F[I]===F[L]&&z[H]<=z[re]}u(xe,"H");function Se(F,H,re){for(var z=F.heap[re],I=re<<1;I<=F.heap_len&&(I<F.heap_len&&xe(H,F.heap[I+1],F.heap[I],F.depth)&&I++,!xe(H,z,F.heap[I],F.depth));)F.heap[re]=F.heap[I],re=I,I<<=1;F.heap[re]=z}u(Se,"G");function V(F,H,re){var z,I,L,G,X=0;if(F.last_lit!==0)for(;z=F.pending_buf[F.d_buf+2*X]<<8|F.pending_buf[F.d_buf+2*X+1],I=F.pending_buf[F.l_buf+X],X++,z===0?J(F,I,H):(J(F,(L=E[I])+f+1,H),(G=C[L])!==0&&ae(F,I-=B[L],G),J(F,L=$(--z),re),(G=A[L])!==0&&ae(F,z-=j[L],G)),X<F.last_lit;);J(F,_,H)}u(V,"K");function Y(F,H){var re,z,I,L=H.dyn_tree,G=H.stat_desc.static_tree,X=H.stat_desc.has_stree,se=H.stat_desc.elems,de=-1;for(F.heap_len=0,F.heap_max=m,re=0;re<se;re++)L[2*re]!==0?(F.heap[++F.heap_len]=de=re,F.depth[re]=0):L[2*re+1]=0;for(;F.heap_len<2;)L[2*(I=F.heap[++F.heap_len]=de<2?++de:0)]=1,F.depth[I]=0,F.opt_len--,X&&(F.static_len-=G[2*I+1]);for(H.max_code=de,re=F.heap_len>>1;1<=re;re--)Se(F,L,re);for(I=se;re=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Se(F,L,1),z=F.heap[1],F.heap[--F.heap_max]=re,F.heap[--F.heap_max]=z,L[2*I]=L[2*re]+L[2*z],F.depth[I]=(F.depth[re]>=F.depth[z]?F.depth[re]:F.depth[z])+1,L[2*re+1]=L[2*z+1]=I,F.heap[1]=I++,Se(F,L,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(me,ye){var pe,Fe,qe,Re,Ke,$e,Je=ye.dyn_tree,Bt=ye.max_code,Hn=ye.stat_desc.static_tree,oe=ye.stat_desc.has_stree,_e=ye.stat_desc.extra_bits,Pe=ye.stat_desc.extra_base,Ue=ye.stat_desc.max_length,Xe=0;for(Re=0;Re<=v;Re++)me.bl_count[Re]=0;for(Je[2*me.heap[me.heap_max]+1]=0,pe=me.heap_max+1;pe<m;pe++)Ue<(Re=Je[2*Je[2*(Fe=me.heap[pe])+1]+1]+1)&&(Re=Ue,Xe++),Je[2*Fe+1]=Re,Bt<Fe||(me.bl_count[Re]++,Ke=0,Pe<=Fe&&(Ke=_e[Fe-Pe]),$e=Je[2*Fe],me.opt_len+=$e*(Re+Ke),oe&&(me.static_len+=$e*(Hn[2*Fe+1]+Ke)));if(Xe!==0){do{for(Re=Ue-1;me.bl_count[Re]===0;)Re--;me.bl_count[Re]--,me.bl_count[Re+1]+=2,me.bl_count[Ue]--,Xe-=2}while(0<Xe);for(Re=Ue;Re!==0;Re--)for(Fe=me.bl_count[Re];Fe!==0;)Bt<(qe=me.heap[--pe])||(Je[2*qe+1]!==Re&&(me.opt_len+=(Re-Je[2*qe+1])*Je[2*qe],Je[2*qe+1]=Re),Fe--)}}(F,H),ge(L,de,F.bl_count)}u(Y,"Y");function R(F,H,re){var z,I,L=-1,G=H[1],X=0,se=7,de=4;for(G===0&&(se=138,de=3),H[2*(re+1)+1]=65535,z=0;z<=re;z++)I=G,G=H[2*(z+1)+1],++X<se&&I===G||(X<de?F.bl_tree[2*I]+=X:I!==0?(I!==L&&F.bl_tree[2*I]++,F.bl_tree[2*x]++):X<=10?F.bl_tree[2*w]++:F.bl_tree[2*M]++,L=I,de=(X=0)===G?(se=138,3):I===G?(se=6,3):(se=7,4))}u(R,"X");function ee(F,H,re){var z,I,L=-1,G=H[1],X=0,se=7,de=4;for(G===0&&(se=138,de=3),z=0;z<=re;z++)if(I=G,G=H[2*(z+1)+1],!(++X<se&&I===G)){if(X<de)for(;J(F,I,F.bl_tree),--X!=0;);else I!==0?(I!==L&&(J(F,I,F.bl_tree),X--),J(F,x,F.bl_tree),ae(F,X-3,2)):X<=10?(J(F,w,F.bl_tree),ae(F,X-3,3)):(J(F,M,F.bl_tree),ae(F,X-11,7));L=I,de=(X=0)===G?(se=138,3):I===G?(se=6,3):(se=7,4)}}u(ee,"V"),l(j);var Q=!1;function U(F,H,re,z){ae(F,(c<<1)+(z?1:0),3),function(I,L,G,X){we(I),X&&(le(I,G),le(I,~G)),r.arraySet(I.pending_buf,I.window,L,G,I.pending),I.pending+=G}(F,H,re,!0)}u(U,"J"),s._tr_init=function(F){Q||(function(){var H,re,z,I,L,G=new Array(v+1);for(I=z=0;I<h-1;I++)for(B[I]=z,H=0;H<1<<C[I];H++)E[z++]=I;for(E[z-1]=I,I=L=0;I<16;I++)for(j[I]=L,H=0;H<1<<A[I];H++)N[L++]=I;for(L>>=7;I<p;I++)for(j[I]=L<<7,H=0;H<1<<A[I]-7;H++)N[256+L++]=I;for(re=0;re<=v;re++)G[re]=0;for(H=0;H<=143;)k[2*H+1]=8,H++,G[8]++;for(;H<=255;)k[2*H+1]=9,H++,G[9]++;for(;H<=279;)k[2*H+1]=7,H++,G[7]++;for(;H<=287;)k[2*H+1]=8,H++,G[8]++;for(ge(k,d+1,G),H=0;H<p;H++)O[2*H+1]=5,O[2*H]=te(H,5);W=new ie(k,C,f+1,d,v),Z=new ie(O,A,0,p,v),ne=new ie(new Array(0),P,0,g,b)}(),Q=!0),F.l_desc=new K(F.dyn_ltree,W),F.d_desc=new K(F.dyn_dtree,Z),F.bl_desc=new K(F.bl_tree,ne),F.bi_buf=0,F.bi_valid=0,he(F)},s._tr_stored_block=U,s._tr_flush_block=function(F,H,re,z){var I,L,G=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(X){var se,de=4093624447;for(se=0;se<=31;se++,de>>>=1)if(1&de&&X.dyn_ltree[2*se]!==0)return o;if(X.dyn_ltree[18]!==0||X.dyn_ltree[20]!==0||X.dyn_ltree[26]!==0)return a;for(se=32;se<f;se++)if(X.dyn_ltree[2*se]!==0)return a;return o}(F)),Y(F,F.l_desc),Y(F,F.d_desc),G=function(X){var se;for(R(X,X.dyn_ltree,X.l_desc.max_code),R(X,X.dyn_dtree,X.d_desc.max_code),Y(X,X.bl_desc),se=g-1;3<=se&&X.bl_tree[2*D[se]+1]===0;se--);return X.opt_len+=3*(se+1)+5+5+4,se}(F),I=F.opt_len+3+7>>>3,(L=F.static_len+3+7>>>3)<=I&&(I=L)):I=L=re+5,re+4<=I&&H!==-1?U(F,H,re,z):F.strategy===4||L===I?(ae(F,2+(z?1:0),3),V(F,k,O)):(ae(F,4+(z?1:0),3),function(X,se,de,me){var ye;for(ae(X,se-257,5),ae(X,de-1,5),ae(X,me-4,4),ye=0;ye<me;ye++)ae(X,X.bl_tree[2*D[ye]+1],3);ee(X,X.dyn_ltree,se-1),ee(X,X.dyn_dtree,de-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,G+1),V(F,F.dyn_ltree,F.dyn_dtree)),he(F),z&&we(F)},s._tr_tally=function(F,H,re){return F.pending_buf[F.d_buf+2*F.last_lit]=H>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&H,F.pending_buf[F.l_buf+F.last_lit]=255&re,F.last_lit++,H===0?F.dyn_ltree[2*re]++:(F.matches++,H--,F.dyn_ltree[2*(E[re]+f+1)]++,F.dyn_dtree[2*$(H)]++),F.last_lit===F.lit_bufsize-1},s._tr_align=function(F){ae(F,2,3),J(F,_,k),function(H){H.bi_valid===16?(le(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):8<=H.bi_valid&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(t,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,s){(function(r){(function(o,a){if(!o.setImmediate){var l,c,h,f,d=1,p={},g=!1,m=o.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(o);v=v&&v.setTimeout?v:o,l={}.toString.call(o.process)==="[object process]"?function(x){process.nextTick(function(){b(x)})}:function(){if(o.postMessage&&!o.importScripts){var x=!0,w=o.onmessage;return o.onmessage=function(){x=!1},o.postMessage("","*"),o.onmessage=w,x}}()?(f="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",_,!1):o.attachEvent("onmessage",_),function(x){o.postMessage(f+x,"*")}):o.MessageChannel?((h=new MessageChannel).port1.onmessage=function(x){b(x.data)},function(x){h.port2.postMessage(x)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(x){var w=m.createElement("script");w.onreadystatechange=function(){b(x),w.onreadystatechange=null,c.removeChild(w),w=null},c.appendChild(w)}):function(x){setTimeout(b,0,x)},v.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var w=new Array(arguments.length-1),M=0;M<w.length;M++)w[M]=arguments[M+1];var C={callback:x,args:w};return p[d]=C,l(d),d++},v.clearImmediate=y}function y(x){delete p[x]}u(y,"f");function b(x){if(g)setTimeout(b,0,x);else{var w=p[x];if(w){g=!0;try{(function(M){var C=M.callback,A=M.args;switch(A.length){case 0:C();break;case 1:C(A[0]);break;case 2:C(A[0],A[1]);break;case 3:C(A[0],A[1],A[2]);break;default:C.apply(a,A)}})(w)}finally{y(x),g=!1}}}}u(b,"c");function _(x){x.source===o&&typeof x.data=="string"&&x.data.indexOf(f)===0&&b(+x.data.slice(f.length))}u(_,"d")})(typeof self=="undefined"?r===void 0?this:r:self)}).call(this,typeof Jp!="undefined"?Jp:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(PL);var zfe=PL.exports;/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var m3={},L_=u(function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))},"durl"),RL=u(function(n){return new Worker(n)},"cwk");try{URL.revokeObjectURL(L_(""))}catch{L_=u(function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},"durl"),RL=u(function(e){return new Worker(e,{type:"module"})},"cwk")}var Bfe=u(function(n,e,t,i,s){var r=RL(m3[e]||(m3[e]=L_(n)));return r.onerror=function(o){return s(o.error,null)},r.onmessage=function(o){return s(null,o.data)},r.postMessage(t,i),r},"wk"),Tt=Uint8Array,pi=Uint16Array,zo=Uint32Array,gh=new Tt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vh=new Tt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fd=new Tt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),IL=u(function(n,e){for(var t=new pi(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var s=new zo(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)s[r]=r-t[i]<<5|i;return[t,s]},"freb"),DL=IL(gh,2),Gw=DL[0],Yg=DL[1];Gw[28]=258,Yg[258]=28;var LL=IL(vh,0),OL=LL[0],O_=LL[1],zd=new pi(32768);for(var cn=0;cn<32768;++cn){var ua=(cn&43690)>>>1|(cn&21845)<<1;ua=(ua&52428)>>>2|(ua&13107)<<2,ua=(ua&61680)>>>4|(ua&3855)<<4,zd[cn]=((ua&65280)>>>8|(ua&255)<<8)>>>1}var Ys=u(function(n,e,t){for(var i=n.length,s=0,r=new pi(e);s<i;++s)++r[n[s]-1];var o=new pi(e);for(s=0;s<e;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(t){a=new pi(1<<e);var l=15-e;for(s=0;s<i;++s)if(n[s])for(var c=s<<4|n[s],h=e-n[s],f=o[n[s]-1]++<<h,d=f|(1<<h)-1;f<=d;++f)a[zd[f]>>>l]=c}else for(a=new pi(i),s=0;s<i;++s)n[s]&&(a[s]=zd[o[n[s]-1]++]>>>15-n[s]);return a},"hMap"),Bo=new Tt(288);for(var cn=0;cn<144;++cn)Bo[cn]=8;for(var cn=144;cn<256;++cn)Bo[cn]=9;for(var cn=256;cn<280;++cn)Bo[cn]=7;for(var cn=280;cn<288;++cn)Bo[cn]=8;var sh=new Tt(32);for(var cn=0;cn<32;++cn)sh[cn]=5;var kL=Ys(Bo,9,0),NL=Ys(Bo,9,1),FL=Ys(sh,5,0),zL=Ys(sh,5,1),Sg=u(function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},"max"),Bs=u(function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},"bits"),Cg=u(function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},"bits16"),np=u(function(n){return(n/8|0)+(n&7&&1)},"shft"),qs=u(function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var i=new(n instanceof pi?pi:n instanceof zo?zo:Tt)(t-e);return i.set(n.subarray(e,t)),i},"slc"),ip=u(function(n,e,t){var i=n.length;if(!i||t&&!t.l&&i<5)return e||new Tt(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new Tt(i*3));var o=u(function(te){var ge=e.length;if(te>ge){var he=new Tt(Math.max(ge*2,te));he.set(e),e=he}},"cbuf"),a=t.f||0,l=t.p||0,c=t.b||0,h=t.l,f=t.d,d=t.m,p=t.n,g=i*8;do{if(!h){t.f=a=Bs(n,l,1);var m=Bs(n,l+1,3);if(l+=3,m)if(m==1)h=NL,f=zL,d=9,p=5;else if(m==2){var _=Bs(n,l,31)+257,x=Bs(n,l+10,15)+4,w=_+Bs(n,l+5,31)+1;l+=14;for(var M=new Tt(w),C=new Tt(19),A=0;A<x;++A)C[Fd[A]]=Bs(n,l+A*3,7);l+=x*3;for(var P=Sg(C),D=(1<<P)-1,k=Ys(C,P,1),A=0;A<w;){var O=k[Bs(n,l,D)];l+=O&15;var v=O>>>4;if(v<16)M[A++]=v;else{var N=0,E=0;for(v==16?(E=3+Bs(n,l,3),l+=2,N=M[A-1]):v==17?(E=3+Bs(n,l,7),l+=3):v==18&&(E=11+Bs(n,l,127),l+=7);E--;)M[A++]=N}}var B=M.subarray(0,_),W=M.subarray(_);d=Sg(B),p=Sg(W),h=Ys(B,d,1),f=Ys(W,p,1)}else throw"invalid block type";else{var v=np(l)+4,y=n[v-4]|n[v-3]<<8,b=v+y;if(b>i){if(r)throw"unexpected EOF";break}s&&o(c+y),e.set(n.subarray(v,b),c),t.b=c+=y,t.p=l=b*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}s&&o(c+131072);for(var Z=(1<<d)-1,ne=(1<<p)-1,j=l;;j=l){var N=h[Cg(n,l)&Z],ie=N>>>4;if(l+=N&15,l>g){if(r)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(ie<256)e[c++]=ie;else if(ie==256){j=l,h=null;break}else{var K=ie-254;if(ie>264){var A=ie-257,$=gh[A];K=Bs(n,l,(1<<$)-1)+Gw[A],l+=$}var le=f[Cg(n,l)&ne],ae=le>>>4;if(!le)throw"invalid distance";l+=le&15;var W=OL[ae];if(ae>3){var $=vh[ae];W+=Cg(n,l)&(1<<$)-1,l+=$}if(l>g){if(r)throw"unexpected EOF";break}s&&o(c+131072);for(var J=c+K;c<J;c+=4)e[c]=e[c-W],e[c+1]=e[c+1-W],e[c+2]=e[c+2-W],e[c+3]=e[c+3-W];c=J}}t.l=h,t.p=j,t.b=c,h&&(a=1,t.m=d,t.d=f,t.n=p)}while(!a);return c==e.length?e:qs(e,0,c)},"inflt"),Rr=u(function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8},"wbits"),iu=u(function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8,n[i+2]|=t>>>16},"wbits16"),Eg=u(function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var s=t.length,r=t.slice();if(!s)return[Co,0];if(s==1){var o=new Tt(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(w,M){return w.f-M.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,h=1,f=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};h!=s-1;)a=t[t[c].f<t[f].f?c++:f++],l=t[c!=h&&t[c].f<t[f].f?c++:f++],t[h++]={s:-1,f:a.f+l.f,l:a,r:l};for(var d=r[0].s,i=1;i<s;++i)r[i].s>d&&(d=r[i].s);var p=new pi(d+1),g=qg(t[h-1],p,0);if(g>e){var i=0,m=0,v=g-e,y=1<<v;for(r.sort(function(M,C){return p[C.s]-p[M.s]||M.f-C.f});i<s;++i){var b=r[i].s;if(p[b]>e)m+=y-(1<<g-p[b]),p[b]=e;else break}for(m>>>=v;m>0;){var _=r[i].s;p[_]<e?m-=1<<e-p[_]++-1:++i}for(;i>=0&&m;--i){var x=r[i].s;p[x]==e&&(--p[x],++m)}g=e}return[new Tt(p),g]},"hTree"),qg=u(function(n,e,t){return n.s==-1?Math.max(qg(n.l,e,t+1),qg(n.r,e,t+1)):e[n.s]=t},"ln"),k_=u(function(n){for(var e=n.length;e&&!n[--e];);for(var t=new pi(++e),i=0,s=n[0],r=1,o=u(function(l){t[i++]=l},"w"),a=1;a<=e;++a)if(n[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(s),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(s);r=1,s=n[a]}return[t.subarray(0,i),e]},"lc"),su=u(function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},"clen"),ad=u(function(n,e,t){var i=t.length,s=np(e+2);n[s]=i&255,n[s+1]=i>>>8,n[s+2]=n[s]^255,n[s+3]=n[s+1]^255;for(var r=0;r<i;++r)n[s+r+4]=t[r];return(s+4+i)*8},"wfblk"),N_=u(function(n,e,t,i,s,r,o,a,l,c,h){Rr(e,h++,t),++s[256];for(var f=Eg(s,15),d=f[0],p=f[1],g=Eg(r,15),m=g[0],v=g[1],y=k_(d),b=y[0],_=y[1],x=k_(m),w=x[0],M=x[1],C=new pi(19),A=0;A<b.length;++A)C[b[A]&31]++;for(var A=0;A<w.length;++A)C[w[A]&31]++;for(var P=Eg(C,7),D=P[0],k=P[1],O=19;O>4&&!D[Fd[O-1]];--O);var N=c+5<<3,E=su(s,Bo)+su(r,sh)+o,B=su(s,d)+su(r,m)+o+14+3*O+su(C,D)+(2*C[16]+3*C[17]+7*C[18]);if(N<=E&&N<=B)return ad(e,h,n.subarray(l,l+c));var W,Z,ne,j;if(Rr(e,h,1+(B<E)),h+=2,B<E){W=Ys(d,p,0),Z=d,ne=Ys(m,v,0),j=m;var ie=Ys(D,k,0);Rr(e,h,_-257),Rr(e,h+5,M-1),Rr(e,h+10,O-4),h+=14;for(var A=0;A<O;++A)Rr(e,h+3*A,D[Fd[A]]);h+=3*O;for(var K=[b,w],$=0;$<2;++$)for(var le=K[$],A=0;A<le.length;++A){var ae=le[A]&31;Rr(e,h,ie[ae]),h+=D[ae],ae>15&&(Rr(e,h,le[A]>>>5&127),h+=le[A]>>>12)}}else W=kL,Z=Bo,ne=FL,j=sh;for(var A=0;A<a;++A)if(i[A]>255){var ae=i[A]>>>18&31;iu(e,h,W[ae+257]),h+=Z[ae+257],ae>7&&(Rr(e,h,i[A]>>>23&31),h+=gh[ae]);var J=i[A]&31;iu(e,h,ne[J]),h+=j[J],J>3&&(iu(e,h,i[A]>>>5&8191),h+=vh[J])}else iu(e,h,W[i[A]]),h+=Z[i[A]];return iu(e,h,W[256]),h+Z[256]},"wblk"),BL=new zo([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Co=new Tt(0),UL=u(function(n,e,t,i,s,r){var o=n.length,a=new Tt(i+o+5*(1+Math.ceil(o/7e3))+s),l=a.subarray(i,a.length-s),c=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var f=h+65535;f<o?c=ad(l,c,n.subarray(h,f)):(l[h]=r,c=ad(l,c,n.subarray(h,o)))}else{for(var d=BL[e-1],p=d>>>13,g=d&8191,m=(1<<t)-1,v=new pi(32768),y=new pi(m+1),b=Math.ceil(t/3),_=2*b,x=u(function(R){return(n[R]^n[R+1]<<b^n[R+2]<<_)&m},"hsh"),w=new zo(25e3),M=new pi(288),C=new pi(32),A=0,P=0,h=0,D=0,k=0,O=0;h<o;++h){var N=x(h),E=h&32767,B=y[N];if(v[E]=B,y[N]=E,k<=h){var W=o-h;if((A>7e3||D>24576)&&W>423){c=N_(n,l,0,w,M,C,P,D,O,h-O,c),D=A=P=0,O=h;for(var Z=0;Z<286;++Z)M[Z]=0;for(var Z=0;Z<30;++Z)C[Z]=0}var ne=2,j=0,ie=g,K=E-B&32767;if(W>2&&N==x(h-K))for(var $=Math.min(p,W)-1,le=Math.min(32767,h),ae=Math.min(258,W);K<=le&&--ie&&E!=B;){if(n[h+ne]==n[h+ne-K]){for(var J=0;J<ae&&n[h+J]==n[h+J-K];++J);if(J>ne){if(ne=J,j=K,J>$)break;for(var te=Math.min(K,J-2),ge=0,Z=0;Z<te;++Z){var he=h-K+Z+32768&32767,we=v[he],xe=he-we+32768&32767;xe>ge&&(ge=xe,B=he)}}}E=B,B=v[E],K+=E-B+32768&32767}if(j){w[D++]=268435456|Yg[ne]<<18|O_[j];var Se=Yg[ne]&31,V=O_[j]&31;P+=gh[Se]+vh[V],++M[257+Se],++C[V],k=h+ne,++A}else w[D++]=n[h],++M[n[h]]}}c=N_(n,l,r,w,M,C,P,D,O,h-O,c),!r&&c&7&&(c=ad(l,c+1,Co))}return qs(a,0,i+np(c)+s)},"dflt"),$L=function(){for(var n=new zo(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;n[e]=t}return n}(),yh=u(function(){var n=-1;return{p:function(e){for(var t=n,i=0;i<e.length;++i)t=$L[t&255^e[i]]^t>>>8;n=t},d:function(){return~n}}},"crc"),Hw=u(function(){var n=1,e=0;return{p:function(t){for(var i=n,s=e,r=t.length,o=0;o!=r;){for(var a=Math.min(o+2655,r);o<a;++o)s+=i+=t[o];i=(i&65535)+15*(i>>16),s=(s&65535)+15*(s>>16)}n=i,e=s},d:function(){return n%=65521,e%=65521,(n&255)<<24|n>>>8<<16|(e&255)<<8|e>>>8}}},"adler"),lc=u(function(n,e,t,i,s){return UL(n,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+e.mem,t,i,!s)},"dopt"),sp=u(function(n,e){var t={};for(var i in n)t[i]=n[i];for(var i in e)t[i]=e[i];return t},"mrg"),g3=u(function(n,e,t){for(var i=n(),s=n.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=r[o];if(typeof a=="function"){e+=";"+l+"=";var c=a.toString();if(a.prototype)if(c.indexOf("[native code]")!=-1){var h=c.indexOf(" ",8)+1;e+=c.slice(h,c.indexOf("(",h))}else{e+=c;for(var f in a.prototype)e+=";"+l+".prototype."+f+"="+a.prototype[f].toString()}else e+=c}else t[l]=a}return[e,t]},"wcln"),Mm=[],Ufe=u(function(n){var e=[];for(var t in n)(n[t]instanceof Tt||n[t]instanceof pi||n[t]instanceof zo)&&e.push((n[t]=new n[t].constructor(n[t])).buffer);return e},"cbfs"),VL=u(function(n,e,t,i){var s;if(!Mm[t]){for(var r="",o={},a=n.length-1,l=0;l<a;++l)s=g3(n[l],r,o),r=s[0],o=s[1];Mm[t]=g3(n[a],r,o)}var c=sp({},Mm[t][1]);return Bfe(Mm[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,Ufe(c),i)},"wrkr"),_h=u(function(){return[Tt,pi,zo,gh,vh,Fd,Gw,OL,NL,zL,zd,Ys,Sg,Bs,Cg,np,qs,ip,Ah,Xa,Ww]},"bInflt"),bh=u(function(){return[Tt,pi,zo,gh,vh,Fd,Yg,O_,kL,Bo,FL,sh,zd,BL,Co,Ys,Rr,iu,Eg,qg,k_,su,ad,N_,np,qs,UL,lc,rp,Xa]},"bDflt"),GL=u(function(){return[jw,Yw,Gt,yh,$L]},"gze"),HL=u(function(){return[Xw,XL]},"guze"),WL=u(function(){return[qw,Gt,Hw]},"zle"),jL=u(function(){return[YL]},"zule"),Xa=u(function(n){return postMessage(n,[n.buffer])},"pbf"),Ww=u(function(n){return n&&n.size&&new Tt(n.size)},"gu8"),wh=u(function(n,e,t,i,s,r){var o=VL(t,i,s,function(a,l){o.terminate(),r(a,l)});return o.postMessage([n,e],e.consume?[n.buffer]:[]),function(){o.terminate()}},"cbify"),Zs=u(function(n){return n.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return n.push(e.data[0],e.data[1])}},"astrm"),xh=u(function(n,e,t,i,s){var r,o=VL(n,i,s,function(a,l){a?(o.terminate(),e.ondata.call(e,a)):(l[1]&&o.terminate(),e.ondata.call(e,a,l[0],l[1]))});o.postMessage(t),e.push=function(a,l){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([a,r=l],[a.buffer])},e.terminate=function(){o.terminate()}},"astrmify"),Hi=u(function(n,e){return n[e]|n[e+1]<<8},"b2"),Bn=u(function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},"b4"),ay=u(function(n,e){return Bn(n,e)+Bn(n,e+4)*4294967296},"b8"),Gt=u(function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},"wbytes"),jw=u(function(n,e){var t=e.filename;if(n[0]=31,n[1]=139,n[2]=8,n[8]=e.level<2?4:e.level==9?2:0,n[9]=3,e.mtime!=0&&Gt(n,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){n[3]=8;for(var i=0;i<=t.length;++i)n[i+10]=t.charCodeAt(i)}},"gzh"),Xw=u(function(n){if(n[0]!=31||n[1]!=139||n[2]!=8)throw"invalid gzip data";var e=n[3],t=10;e&4&&(t+=n[10]|(n[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!n[t++]);return t+(e&2)},"gzs"),XL=u(function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},"gzl"),Yw=u(function(n){return 10+(n.filename&&n.filename.length+1||0)},"gzhl"),qw=u(function(n,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;n[0]=120,n[1]=i<<6|(i?32-2*i:1)},"zlh"),YL=u(function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"},"zlv");function Zw(n,e){return!e&&typeof n=="function"&&(e=n,n={}),this.ondata=e,n}u(Zw,"AsyncCmpStrm");var Hr=function(){function n(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return u(n,"Deflate"),n.prototype.p=function(e,t){this.ondata(lc(e,this.o,0,0,!t),t)},n.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},n}(),qL=function(){function n(e,t){xh([bh,function(){return[Zs,Hr]}],this,Zw.call(this,e,t),function(i){var s=new Hr(i.data);onmessage=Zs(s)},6)}return u(n,"AsyncDeflate"),n}();function ZL(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return wh(n,e,[bh],function(i){return Xa(rp(i.data[0],i.data[1]))},0,t)}u(ZL,"deflate");function rp(n,e){return lc(n,e||{},0,0)}u(rp,"deflateSync");var us=function(){function n(e){this.s={},this.p=new Tt(0),this.ondata=e}return u(n,"Inflate"),n.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,i=new Tt(t+e.length);i.set(this.p),i.set(e,t),this.p=i},n.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,i=ip(this.p,this.o,this.s);this.ondata(qs(i,t,this.s.b),this.d),this.o=qs(i,this.s.b-32768),this.s.b=this.o.length,this.p=qs(this.p,this.s.p/8|0),this.s.p&=7},n.prototype.push=function(e,t){this.e(e),this.c(t)},n}(),Kw=function(){function n(e){this.ondata=e,xh([_h,function(){return[Zs,us]}],this,0,function(){var t=new us;onmessage=Zs(t)},7)}return u(n,"AsyncInflate"),n}();function Qw(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return wh(n,e,[_h],function(i){return Xa(Ah(i.data[0],Ww(i.data[1])))},1,t)}u(Qw,"inflate");function Ah(n,e){return ip(n,e)}u(Ah,"inflateSync");var Zg=function(){function n(e,t){this.c=yh(),this.l=0,this.v=1,Hr.call(this,e,t)}return u(n,"Gzip"),n.prototype.push=function(e,t){Hr.prototype.push.call(this,e,t)},n.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var i=lc(e,this.o,this.v&&Yw(this.o),t&&8,!t);this.v&&(jw(i,this.o),this.v=0),t&&(Gt(i,i.length-8,this.c.d()),Gt(i,i.length-4,this.l)),this.ondata(i,t)},n}(),v3=function(){function n(e,t){xh([bh,GL,function(){return[Zs,Hr,Zg]}],this,Zw.call(this,e,t),function(i){var s=new Zg(i.data);onmessage=Zs(s)},8)}return u(n,"AsyncGzip"),n}();function y3(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return wh(n,e,[bh,GL,function(){return[Kg]}],function(i){return Xa(Kg(i.data[0],i.data[1]))},2,t)}u(y3,"gzip");function Kg(n,e){e||(e={});var t=yh(),i=n.length;t.p(n);var s=lc(n,e,Yw(e),8),r=s.length;return jw(s,e),Gt(s,r-8,t.d()),Gt(s,r-4,i),s}u(Kg,"gzipSync");var Qg=function(){function n(e){this.v=1,us.call(this,e)}return u(n,"Gunzip"),n.prototype.push=function(e,t){if(us.prototype.e.call(this,e),this.v){var i=this.p.length>3?Xw(this.p):4;if(i>=this.p.length&&!t)return;this.p=this.p.subarray(i),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}us.prototype.c.call(this,t)},n}(),KL=function(){function n(e){this.ondata=e,xh([_h,HL,function(){return[Zs,us,Qg]}],this,0,function(){var t=new Qg;onmessage=Zs(t)},9)}return u(n,"AsyncGunzip"),n}();function QL(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return wh(n,e,[_h,HL,function(){return[Jg]}],function(i){return Xa(Jg(i.data[0]))},3,t)}u(QL,"gunzip");function Jg(n,e){return ip(n.subarray(Xw(n),-8),e||new Tt(XL(n)))}u(Jg,"gunzipSync");var F_=function(){function n(e,t){this.c=Hw(),this.v=1,Hr.call(this,e,t)}return u(n,"Zlib"),n.prototype.push=function(e,t){Hr.prototype.push.call(this,e,t)},n.prototype.p=function(e,t){this.c.p(e);var i=lc(e,this.o,this.v&&2,t&&4,!t);this.v&&(qw(i,this.o),this.v=0),t&&Gt(i,i.length-4,this.c.d()),this.ondata(i,t)},n}(),$fe=function(){function n(e,t){xh([bh,WL,function(){return[Zs,Hr,F_]}],this,Zw.call(this,e,t),function(i){var s=new F_(i.data);onmessage=Zs(s)},10)}return u(n,"AsyncZlib"),n}();function Vfe(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return wh(n,e,[bh,WL,function(){return[z_]}],function(i){return Xa(z_(i.data[0],i.data[1]))},4,t)}u(Vfe,"zlib");function z_(n,e){e||(e={});var t=Hw();t.p(n);var i=lc(n,e,2,4);return qw(i,e),Gt(i,i.length-4,t.d()),i}u(z_,"zlibSync");var e0=function(){function n(e){this.v=1,us.call(this,e)}return u(n,"Unzlib"),n.prototype.push=function(e,t){if(us.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}us.prototype.c.call(this,t)},n}(),JL=function(){function n(e){this.ondata=e,xh([_h,jL,function(){return[Zs,us,e0]}],this,0,function(){var t=new e0;onmessage=Zs(t)},11)}return u(n,"AsyncUnzlib"),n}();function eO(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return wh(n,e,[_h,jL,function(){return[Bd]}],function(i){return Xa(Bd(i.data[0],Ww(i.data[1])))},5,t)}u(eO,"unzlib");function Bd(n,e){return ip((YL(n),n.subarray(2,-4)),e)}u(Bd,"unzlibSync");var tO=function(){function n(e){this.G=Qg,this.I=us,this.Z=e0,this.ondata=e}return u(n,"Decompress"),n.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var i=new Tt(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var s=this,r=u(function(){s.ondata.apply(s,arguments)},"cb");this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},n}(),Gfe=function(){function n(e){this.G=KL,this.I=Kw,this.Z=JL,this.ondata=e}return u(n,"AsyncDecompress"),n.prototype.push=function(e,t){tO.prototype.push.call(this,e,t)},n}();function Hfe(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return n[0]==31&&n[1]==139&&n[2]==8?QL(n,e,t):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?Qw(n,e,t):eO(n,e,t)}u(Hfe,"decompress");function Wfe(n,e){return n[0]==31&&n[1]==139&&n[2]==8?Jg(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?Ah(n,e):Bd(n,e)}u(Wfe,"decompressSync");var Jw=u(function(n,e,t,i){for(var s in n){var r=n[s],o=e+s;r instanceof Tt?t[o]=[r,i]:Array.isArray(r)?t[o]=[r[0],sp(i,r[1])]:Jw(r,o+"/",t,i)}},"fltn"),_3=typeof TextEncoder!="undefined"&&new TextEncoder,B_=typeof TextDecoder!="undefined"&&new TextDecoder,nO=0;try{B_.decode(Co,{stream:!0}),nO=1}catch{}var iO=u(function(n){for(var e="",t=0;;){var i=n[t++],s=(i>127)+(i>223)+(i>239);if(t+s>n.length)return[e,qs(n,t-1)];s?s==3?(i=((i&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|i>>10,56320|i&1023)):s&1?e+=String.fromCharCode((i&31)<<6|n[t++]&63):e+=String.fromCharCode((i&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(i)}},"dutf8"),jfe=function(){function n(e){this.ondata=e,nO?this.t=new TextDecoder:this.p=Co}return u(n,"DecodeUTF8"),n.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var i=new Tt(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length);var s=iO(i),r=s[0],o=s[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(r,t)},n}(),Xfe=function(){function n(e){this.ondata=e}return u(n,"EncodeUTF8"),n.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Na(e),this.d=t||!1)},n}();function Na(n,e){if(e){for(var t=new Tt(n.length),i=0;i<n.length;++i)t[i]=n.charCodeAt(i);return t}if(_3)return _3.encode(n);for(var s=n.length,r=new Tt(n.length+(n.length>>1)),o=0,a=u(function(h){r[o++]=h},"w"),i=0;i<s;++i){if(o+5>r.length){var l=new Tt(o+8+(s-i<<1));l.set(r),r=l}var c=n.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|n.charCodeAt(++i)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return qs(r,0,o)}u(Na,"strToU8");function ex(n,e){if(e){for(var t="",i=0;i<n.length;i+=16384)t+=String.fromCharCode.apply(null,n.subarray(i,i+16384));return t}else{if(B_)return B_.decode(n);var s=iO(n),r=s[0],o=s[1];if(o.length)throw"invalid utf-8 data";return r}}u(ex,"strFromU8");var sO=u(function(n){return n==1?3:n<6?2:n==9?1:0},"dbf"),rO=u(function(n,e){return e+30+Hi(n,e+26)+Hi(n,e+28)},"slzh"),oO=u(function(n,e,t){var i=Hi(n,e+28),s=ex(n.subarray(e+46,e+46+i),!(Hi(n,e+8)&2048)),r=e+46+i,o=Bn(n,e+20),a=t&&o==4294967295?aO(n,r):[o,Bn(n,e+24),Bn(n,e+42)],l=a[0],c=a[1],h=a[2];return[Hi(n,e+10),l,c,s,r+Hi(n,e+30)+Hi(n,e+32),h]},"zh"),aO=u(function(n,e){for(;Hi(n,e)!=1;e+=4+Hi(n,e+2));return[ay(n,e+12),ay(n,e+4),ay(n,e+20)]},"z64e"),Ia=u(function(n){var e=0;if(n)for(var t in n){var i=n[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},"exfl"),rh=u(function(n,e,t,i,s,r,o,a){var l=i.length,c=t.extra,h=a&&a.length,f=Ia(c);Gt(n,e,o!=null?33639248:67324752),e+=4,o!=null&&(n[e++]=20,n[e++]=t.os),n[e]=20,e+=2,n[e++]=t.flag<<1|(r==null&&8),n[e++]=s&&8,n[e++]=t.compression&255,n[e++]=t.compression>>8;var d=new Date(t.mtime==null?Date.now():t.mtime),p=d.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Gt(n,e,p<<25|d.getMonth()+1<<21|d.getDate()<<16|d.getHours()<<11|d.getMinutes()<<5|d.getSeconds()>>>1),e+=4,r!=null&&(Gt(n,e,t.crc),Gt(n,e+4,r),Gt(n,e+8,t.size)),Gt(n,e+12,l),Gt(n,e+14,f),e+=16,o!=null&&(Gt(n,e,h),Gt(n,e+6,t.attrs),Gt(n,e+10,o),e+=14),n.set(i,e),e+=l,f)for(var g in c){var m=c[g],v=m.length;Gt(n,e,+g),Gt(n,e+2,v),n.set(m,e+4),e+=4+v}return h&&(n.set(a,e),e+=h),e},"wzh"),tx=u(function(n,e,t,i,s){Gt(n,e,101010256),Gt(n,e+8,t),Gt(n,e+10,t),Gt(n,e+12,i),Gt(n,e+16,s)},"wzf"),Ud=function(){function n(e){this.filename=e,this.c=yh(),this.size=0,this.compression=0}return u(n,"ZipPassThrough"),n.prototype.process=function(e,t){this.ondata(null,e,t)},n.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},n}(),Yfe=function(){function n(e,t){var i=this;t||(t={}),Ud.call(this,e),this.d=new Hr(t,function(s,r){i.ondata(null,s,r)}),this.compression=8,this.flag=sO(t.level)}return u(n,"ZipDeflate"),n.prototype.process=function(e,t){try{this.d.push(e,t)}catch(i){this.ondata(i,null,t)}},n.prototype.push=function(e,t){Ud.prototype.push.call(this,e,t)},n}(),qfe=function(){function n(e,t){var i=this;t||(t={}),Ud.call(this,e),this.d=new qL(t,function(s,r,o){i.ondata(s,r,o)}),this.compression=8,this.flag=sO(t.level),this.terminate=this.d.terminate}return u(n,"AsyncZipDeflate"),n.prototype.process=function(e,t){this.d.push(e,t)},n.prototype.push=function(e,t){Ud.prototype.push.call(this,e,t)},n}(),Zfe=function(){function n(e){this.ondata=e,this.u=[],this.d=1}return u(n,"Zip"),n.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var i=Na(e.filename),s=i.length,r=e.comment,o=r&&Na(r),a=s!=e.filename.length||o&&r.length!=o.length,l=s+Ia(e.extra)+30;if(s>65535)throw"filename too long";var c=new Tt(l);rh(c,0,e,i,a);var h=[c],f=u(function(){for(var v=0,y=h;v<y.length;v++){var b=y[v];t.ondata(null,b,!1)}h=[]},"pAll"),d=this.d;this.d=0;var p=this.u.length,g=sp(e,{f:i,u:a,o,t:function(){e.terminate&&e.terminate()},r:function(){if(f(),d){var v=t.u[p+1];v?v.r():t.d=1}d=1}}),m=0;e.ondata=function(v,y,b){if(v)t.ondata(v,y,b),t.terminate();else if(m+=y.length,h.push(y),b){var _=new Tt(16);Gt(_,0,134695760),Gt(_,4,e.crc),Gt(_,8,m),Gt(_,12,e.size),h.push(_),g.c=m,g.b=l+m+16,g.crc=e.crc,g.size=e.size,d&&g.r(),d=1}else d&&f()},this.u.push(g)},n.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},n.prototype.e=function(){for(var e=0,t=0,i=0,s=0,r=this.u;s<r.length;s++){var o=r[s];i+=46+o.f.length+Ia(o.extra)+(o.o?o.o.length:0)}for(var a=new Tt(i+22),l=0,c=this.u;l<c.length;l++){var o=c[l];rh(a,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+Ia(o.extra)+(o.o?o.o.length:0),t+=o.b}tx(a,e,this.u.length,i,t),this.ondata(null,a,!0),this.d=2},n.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var i=t[e];i.t()}this.d=2},n}();function Kfe(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var i={};Jw(n,"",i,e);var s=Object.keys(i),r=s.length,o=0,a=0,l=r,c=new Array(r),h=[],f=u(function(){for(var m=0;m<h.length;++m)h[m]()},"tAll"),d=u(function(){var m=new Tt(a+22),v=o,y=a-o;a=0;for(var b=0;b<l;++b){var _=c[b];try{var x=_.c.length;rh(m,a,_,_.f,_.u,x);var w=30+_.f.length+Ia(_.extra),M=a+w;m.set(_.c,M),rh(m,o,_,_.f,_.u,x,a,_.m),o+=16+w+(_.m?_.m.length:0),a=M+x}catch(C){return t(C,null)}}tx(m,o,c.length,y,v),t(null,m)},"cbf");r||d();for(var p=u(function(m){var v=s[m],y=i[v],b=y[0],_=y[1],x=yh(),w=b.length;x.p(b);var M=Na(v),C=M.length,A=_.comment,P=A&&Na(A),D=P&&P.length,k=Ia(_.extra),O=_.level==0?0:8,N=u(function(E,B){if(E)f(),t(E,null);else{var W=B.length;c[m]=sp(_,{size:w,crc:x.d(),c:B,f:M,m:P,u:C!=v.length||P&&A.length!=D,compression:O}),o+=30+C+k+W,a+=76+2*(C+k)+(D||0)+W,--r||d()}},"cbl");if(C>65535&&N("filename too long",null),!O)N(null,b);else if(w<16e4)try{N(null,rp(b,_))}catch(E){N(E,null)}else h.push(ZL(b,_,N))},"_loop_1"),g=0;g<l;++g)p(g);return f}u(Kfe,"zip");function Qfe(n,e){e||(e={});var t={},i=[];Jw(n,"",t,e);var s=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],h=c.level==0?0:8,f=Na(o),d=f.length,p=c.comment,g=p&&Na(p),m=g&&g.length,v=Ia(c.extra);if(d>65535)throw"filename too long";var y=h?rp(l,c):l,b=y.length,_=yh();_.p(l),i.push(sp(c,{size:l.length,crc:_.d(),c:y,f,m:g,u:d!=o.length||g&&p.length!=m,o:s,compression:h})),s+=30+d+v+b,r+=76+2*(d+v)+(m||0)+b}for(var x=new Tt(r+22),w=s,M=r-s,C=0;C<i.length;++C){var f=i[C];rh(x,f.o,f,f.f,f.u,f.c.length);var A=30+f.f.length+Ia(f.extra);x.set(f.c,f.o+A),rh(x,s,f,f.f,f.u,f.c.length,f.o,f.m),s+=16+A+(f.m?f.m.length:0)}return tx(x,s,i.length,M,w),x}u(Qfe,"zipSync");var lO=function(){function n(){}return u(n,"UnzipPassThrough"),n.prototype.push=function(e,t){this.ondata(null,e,t)},n.compression=0,n}(),Jfe=function(){function n(){var e=this;this.i=new us(function(t,i){e.ondata(null,t,i)})}return u(n,"UnzipInflate"),n.prototype.push=function(e,t){try{this.i.push(e,t)}catch(i){this.ondata(i,e,t)}},n.compression=8,n}(),ede=function(){function n(e,t){var i=this;t<32e4?this.i=new us(function(s,r){i.ondata(null,s,r)}):(this.i=new Kw(function(s,r,o){i.ondata(s,r,o)}),this.terminate=this.i.terminate)}return u(n,"AsyncUnzipInflate"),n.prototype.push=function(e,t){this.i.terminate&&(e=qs(e,0)),this.i.push(e,t)},n.compression=8,n}(),tde=function(){function n(e){this.onfile=e,this.k=[],this.o={0:lO},this.p=Co}return u(n,"Unzip"),n.prototype.push=function(e,t){var i=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var s=Math.min(this.c,e.length),r=e.subarray(0,s);if(this.c-=s,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(s),e.length)return this.push(e,t)}else{var o=0,a=0,l=void 0,c=void 0;this.p.length?e.length?(c=new Tt(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var h=c.length,f=this.c,d=f&&this.d,p=u(function(){var y,b=Bn(c,a);if(b==67324752){o=1,l=a,g.d=null,g.c=0;var _=Hi(c,a+6),x=Hi(c,a+8),w=_&2048,M=_&8,C=Hi(c,a+26),A=Hi(c,a+28);if(h>a+30+C+A){var P=[];g.k.unshift(P),o=2;var D=Bn(c,a+18),k=Bn(c,a+22),O=ex(c.subarray(a+30,a+=30+C),!w);D==4294967295?(y=M?[-2]:aO(c,a),D=y[0],k=y[1]):M&&(D=-1),a+=A,g.c=D;var N,E={name:O,compression:x,start:function(){if(!E.ondata)throw"no callback";if(!D)E.ondata(null,Co,!0);else{var B=i.o[x];if(!B)throw"unknown compression type "+x;N=D<0?new B(O):new B(O,D,k),N.ondata=function(j,ie,K){E.ondata(j,ie,K)};for(var W=0,Z=P;W<Z.length;W++){var ne=Z[W];N.push(ne,!1)}i.k[0]==P&&i.c?i.d=N:N.push(Co,!0)}},terminate:function(){N&&N.terminate&&N.terminate()}};D>=0&&(E.size=D,E.originalSize=k),g.onfile(E)}return"break"}else if(f){if(b==134695760)return l=a+=12+(f==-2&&8),o=3,g.c=0,"break";if(b==33639248)return l=a-=4,o=3,g.c=0,"break"}},"_loop_2"),g=this;a<h-4;++a){var m=p();if(m==="break")break}if(this.p=Co,f<0){var v=o?c.subarray(0,l-12-(f==-2&&8)-(Bn(c,l-16)==134695760&&4)):c.subarray(0,a);d?d.push(v,!!o):this.k[+(o==2)].push(v)}if(o&2)return this.push(c.subarray(a),t);this.p=c.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},n.prototype.register=function(e){this.o[e.compression]=e},n}();function nde(n,e){if(typeof e!="function")throw"no callback";for(var t=[],i=u(function(){for(var d=0;d<t.length;++d)t[d]()},"tAll"),s={},r=n.length-22;Bn(n,r)!=101010256;--r)if(!r||n.length-r>65558){e("invalid zip file",null);return}var o=Hi(n,r+8);o||e(null,{});var a=o,l=Bn(n,r+16),c=l==4294967295;if(c){if(r=Bn(n,r-12),Bn(n,r)!=101075792){e("invalid zip file",null);return}a=o=Bn(n,r+32),l=Bn(n,r+48)}for(var h=u(function(d){var p=oO(n,l,c),g=p[0],m=p[1],v=p[2],y=p[3],b=p[4],_=p[5],x=rO(n,_);l=b;var w=u(function(C,A){C?(i(),e(C,null)):(s[y]=A,--o||e(null,s))},"cbl");if(!g)w(null,qs(n,x,x+m));else if(g==8){var M=n.subarray(x,x+m);if(m<32e4)try{w(null,Ah(M,new Tt(v)))}catch(C){w(C,null)}else t.push(Qw(M,{size:v},w))}else w("unknown compression type "+g,null)},"_loop_3"),f=0;f<a;++f)h();return i}u(nde,"unzip");function ide(n){for(var e={},t=n.length-22;Bn(n,t)!=101010256;--t)if(!t||n.length-t>65558)throw"invalid zip file";var i=Hi(n,t+8);if(!i)return{};var s=Bn(n,t+16),r=s==4294967295;if(r){if(t=Bn(n,t-12),Bn(n,t)!=101075792)throw"invalid zip file";i=Bn(n,t+32),s=Bn(n,t+48)}for(var o=0;o<i;++o){var a=oO(n,s,r),l=a[0],c=a[1],h=a[2],f=a[3],d=a[4],p=a[5],g=rO(n,p);if(s=d,!l)e[f]=qs(n,g,g+c);else if(l==8)e[f]=Ah(n.subarray(g,g+c),new Tt(h));else throw"unknown compression type "+l}return e}u(ide,"unzipSync");var sde=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Hr,AsyncDeflate:qL,deflate:ZL,deflateSync:rp,Inflate:us,AsyncInflate:Kw,inflate:Qw,inflateSync:Ah,Gzip:Zg,AsyncGzip:v3,gzip:y3,gzipSync:Kg,Gunzip:Qg,AsyncGunzip:KL,gunzip:QL,gunzipSync:Jg,Zlib:F_,AsyncZlib:$fe,zlib:Vfe,zlibSync:z_,Unzlib:e0,AsyncUnzlib:JL,unzlib:eO,unzlibSync:Bd,compress:y3,AsyncCompress:v3,compressSync:Kg,Compress:Zg,Decompress:tO,AsyncDecompress:Gfe,decompress:Hfe,decompressSync:Wfe,DecodeUTF8:jfe,EncodeUTF8:Xfe,strToU8:Na,strFromU8:ex,ZipPassThrough:Ud,ZipDeflate:Yfe,AsyncZipDeflate:qfe,Zip:Zfe,zip:Kfe,zipSync:Qfe,UnzipPassThrough:lO,UnzipInflate:Jfe,AsyncUnzipInflate:ede,Unzip:tde,unzip:nde,unzipSync:ide},Symbol.toStringTag,{value:"Module"}));function cO(n,e,t){const i=t.length-n-1;if(e>=t[i])return i-1;if(e<=t[n])return n;let s=n,r=i,o=Math.floor((s+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}u(cO,"findSpan");function rde(n,e,t,i){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-i[n+1-a],o[a]=i[n+a]-e;let l=0;for(let c=0;c<a;++c){const h=o[c+1],f=r[a-c],d=s[c]/(h+f);s[c]=l+h*d,l=f*d}s[a]=l}return s}u(rde,"calcBasisFunctions");function ode(n,e,t,i){const s=cO(n,i,e),r=rde(s,i,n,e),o=new Dt(0,0,0,0);for(let a=0;a<=n;++a){const l=t[s-n+a],c=r[a],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o}u(ode,"calcBSplinePoint");function ade(n,e,t,i,s){const r=[];for(let f=0;f<=t;++f)r[f]=0;const o=[];for(let f=0;f<=i;++f)o[f]=r.slice(0);const a=[];for(let f=0;f<=t;++f)a[f]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let f=1;f<=t;++f){l[f]=e-s[n+1-f],c[f]=s[n+f]-e;let d=0;for(let p=0;p<f;++p){const g=c[p+1],m=l[f-p];a[f][p]=g+m;const v=a[p][f-1]/a[f][p];a[p][f]=d+g*v,d=m*v}a[f][f]=d}for(let f=0;f<=t;++f)o[0][f]=a[f][t];for(let f=0;f<=t;++f){let d=0,p=1;const g=[];for(let m=0;m<=t;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=i;++m){let v=0;const y=f-m,b=t-m;f>=m&&(g[p][0]=g[d][0]/a[b+1][y],v=g[p][0]*a[y][b]);const _=y>=-1?1:-y,x=f-1<=b?m-1:t-f;for(let M=_;M<=x;++M)g[p][M]=(g[d][M]-g[d][M-1])/a[b+1][y+M],v+=g[p][M]*a[y+M][b];f<=b&&(g[p][m]=-g[d][m-1]/a[b+1][f],v+=g[p][m]*a[f][b]),o[m][f]=v;const w=d;d=p,p=w}}let h=t;for(let f=1;f<=i;++f){for(let d=0;d<=t;++d)o[f][d]*=h;h*=t-f}return o}u(ade,"calcBasisFunctionDerivatives");function lde(n,e,t,i,s){const r=s<n?s:n,o=[],a=cO(n,i,e),l=ade(a,i,n,r,e),c=[];for(let h=0;h<t.length;++h){const f=t[h].clone(),d=f.w;f.x*=d,f.y*=d,f.z*=d,c[h]=f}for(let h=0;h<=r;++h){const f=c[a-n].clone().multiplyScalar(l[h][0]);for(let d=1;d<=n;++d)f.add(c[a-n+d].clone().multiplyScalar(l[h][d]));o[h]=f}for(let h=r+1;h<=s+1;++h)o[h]=new Dt(0,0,0);return o}u(lde,"calcBSplineDerivatives");function cde(n,e){let t=1;for(let s=2;s<=n;++s)t*=s;let i=1;for(let s=2;s<=e;++s)i*=s;for(let s=2;s<=n-e;++s)i*=s;return t/i}u(cde,"calcKoverI");function ude(n){const e=n.length,t=[],i=[];for(let r=0;r<e;++r){const o=n[r];t[r]=new T(o.x,o.y,o.z),i[r]=o.w}const s=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(s[r-a].clone().multiplyScalar(cde(r,a)*i[a]));s[r]=o.divideScalar(i[0])}return s}u(ude,"calcRationalCurveDerivatives");function hde(n,e,t,i,s){const r=lde(n,e,t,i,s);return ude(r)}u(hde,"calcNURBSDerivatives");class U_ extends Ab{constructor(e,t,i,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new Dt(a.x,a.y,a.z,a.w)}}getPoint(e,t=new T){const i=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=ode(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new T){const i=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=hde(this.degree,this.knots,this.controlPoints,s,1);return i.copy(r[1]).normalize(),i}}u(U_,"NURBSCurve");let Mt,kn,rs;class uO extends Ha{constructor(e){super(e)}load(e,t,i,s){const r=this,o=r.path===""?mr.extractUrlBase(e):r.path,a=new jd(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},i,s)}parse(e,t){if(fde(e))Mt=new mO().parse(e);else{const s=yO(e);if(!dde(s))throw new Error("THREE.FBXLoader: Unknown format.");if(b3(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+b3(s));Mt=new pO().parse(s)}const i=new Xd(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new hO(i,this.manager).parse(Mt)}}u(uO,"FBXLoader");class hO{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){kn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),r=new fO().parse(s);return this.parseScene(s,r,i),rs}parseConnections(){const e=new Map;return"Connections"in Mt&&Mt.Connections.connections.forEach(function(i){const s=i[0],r=i[1],o=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in Mt.Objects){const i=Mt.Objects.Video;for(const s in i){const r=i[s],o=parseInt(s);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(i[s]);t[r.RelativeFilename||r.Filename]=c}}}}for(const i in e){const s=e[i];t[s]!==void 0?e[i]=t[s]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Mt.Objects){const i=Mt.Objects.Texture;for(const s in i){const r=this.parseTexture(i[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,o=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(i.wrapS=o===0?Do:Gi,i.wrapT=a===0?Do:Gi,"Scaling"in e){const l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(e,t){let i;const s=this.textureLoader.path,r=kn.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(i=t[r[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new ii):(l.setPath(this.textureLoader.path),o=l.load(i))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new ii):o=this.textureLoader.load(i);return this.textureLoader.setPath(s),o}parseMaterials(e){const t=new Map;if("Material"in Mt.Objects){const i=Mt.Objects.Material;for(const s in i){const r=this.parseMaterial(i[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const i=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!kn.has(i))return null;const o=this.parseParameters(e,t,i);let a;switch(r.toLowerCase()){case"phong":a=new id;break;case"lambert":a=new Mb;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new id;break}return a.setValues(o),a.name=s,a}parseParameters(e,t,i){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new Te().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new Te().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new Te().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new Te().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new Te().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new Te().fromArray(e.SpecularColor.value));const r=this;return kn.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,o.ID),s.map!==void 0&&(s.map.encoding=It);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.encoding=It);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,o.ID),s.envMap!==void 0&&(s.envMap.mapping=Bg,s.envMap.encoding=It);break;case"SpecularColor":s.specularMap=r.getTexture(t,o.ID),s.specularMap!==void 0&&(s.specularMap.encoding=It);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,t){return"LayeredTexture"in Mt.Objects&&t in Mt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=kn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Mt.Objects){const i=Mt.Objects.Deformer;for(const s in i){const r=i[s],o=kn.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(o,i),a.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new ve().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=kn.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,t,i){rs=new ni;const s=this.parseModels(e.skeletons,t,i),r=Mt.Objects.Model,o=this;s.forEach(function(l){const c=r[l.ID];o.setLookAtProperties(l,c),kn.get(l.ID).parents.forEach(function(f){const d=s.get(f.ID);d!==void 0&&d.add(l)}),l.parent===null&&rs.add(l)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),rs.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=gO(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new dO().parse();rs.children.length===1&&rs.children[0].isGroup&&(rs.children[0].animations=a,rs=rs.children[0]),rs.animations=a}parseModels(e,t,i){const s=new Map,r=Mt.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=kn.get(a);let h=this.buildSkeleton(c,e,a,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,i);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new wd;break;case"Null":default:h=new ni;break}h.name=l.attrName?bt.sanitizeNodeName(l.attrName):"",h.ID=a}this.getTransformData(h,l),s.set(a,h)}return s}buildSkeleton(e,t,i,s){let r=null;return e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,h){if(c.ID===o.ID){const f=r;r=new wd,r.matrixWorld.copy(c.transformLink),r.name=s?bt.sanitizeNodeName(s):"",r.ID=i,l.bones[h]=r,f!==null&&r.add(f)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(s){const r=Mt.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new Pt;else{let s=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(s=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const c=a/l;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const f=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:t=new di(h,c,r,o),f!==null&&t.setFocalLength(f);break;case 1:t=new Va(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new Pt;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(s){const r=Mt.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new Pt;else{let s;i.LightType===void 0?s=0:s=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new Te().fromArray(i.Color.value));let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(s){case 0:t=new Ra(r,o,a,l);break;case 1:t=new F0(r,o);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=$s.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=$s.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new N0(r,o,a,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new Ra(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let s,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new id({color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(s=new xb(r,o),s.normalizeSkinWeights()):s=new We(r,o),s}createCurve(e,t){const i=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),s=new Di({color:3342591,linewidth:1});return new js(i,s)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=vO(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&kn.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=Mt.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),rs.add(e.target)):e.lookAt(new T().fromArray(o))}}})}bindSkeleton(e,t,i){const s=this.parsePoseNodes();for(const r in e){const o=e[r];kn.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;kn.get(c).parents.forEach(function(f){i.has(f.ID)&&i.get(f.ID).bind(new Wd(o.bones),s[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Mt.Objects){const t=Mt.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const s=t[i].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new ve().fromArray(r.Matrix.a)}):e[s.Node]=new ve().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Mt&&"AmbientColor"in Mt.GlobalSettings){const e=Mt.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],s=e[2];if(t!==0||i!==0||s!==0){const r=new Te(t,i,s);rs.add(new z0(r,1))}}}}u(hO,"FBXTreeParser");class fO{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Mt.Objects){const i=Mt.Objects.Geometry;for(const s in i){const r=kn.get(parseInt(s)),o=this.parseGeometry(r,i[s],e);t.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const s=i.skeletons,r=[],o=e.parents.map(function(f){return Mt.Objects.Model[f.ID]});if(o.length===0)return;const a=e.children.reduce(function(f,d){return s[d.ID]!==void 0&&(f=s[d.ID]),f},null);e.children.forEach(function(f){i.morphTargets[f.ID]!==void 0&&r.push(i.morphTargets[f.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=vO(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=gO(c);return this.genGeometry(t,a,r,h)}genGeometry(e,t,i,s){const r=new it;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new Ve(a.vertex,3);if(l.applyMatrix4(s),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new Ve(a.colors,3)),t&&(r.setAttribute("skinIndex",new C0(a.weightsIndices,4)),r.setAttribute("skinWeight",new Ve(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new Wi().getNormalMatrix(s),h=new Ve(a.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(a.uvs.forEach(function(c,h){let f="uv"+(h+1).toString();h===0&&(f="uv"),r.setAttribute(f,new Ve(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(f,d){f!==c&&(r.addGroup(h,d-h,c),c=f,h=d)}),r.groups.length>0){const f=r.groups[r.groups.length-1],d=f.start+f.count;d!==a.materialIndex.length&&r.addGroup(d,a.materialIndex.length-d,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,i,s),r}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:s.weights[a]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,s=0,r=!1,o=[],a=[],l=[],c=[],h=[],f=[];const d=this;return e.vertexIndices.forEach(function(p,g){let m,v=!1;p<0&&(p=p^-1,v=!0);let y=[],b=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const _=Sm(g,i,p,e.color);l.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(_){b.push(_.weight),y.push(_.id)}),b.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],x=[0,0,0,0];b.forEach(function(w,M){let C=w,A=y[M];x.forEach(function(P,D,k){if(C>P){k[D]=C,C=P;const O=_[D];_[D]=A,A=O}})}),y=_,b=x}for(;b.length<4;)b.push(0),y.push(0);for(let _=0;_<4;++_)h.push(b[_]),f.push(y[_])}if(e.normal){const _=Sm(g,i,p,e.normal);a.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=Sm(g,i,p,e.material)[0],m<0&&(d.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(_,x){const w=Sm(g,i,p,_);c[x]===void 0&&(c[x]=[]),c[x].push(w[0]),c[x].push(w[1])}),s++,v&&(d.genFace(t,e,o,m,a,l,c,h,f,s),i++,s=0,o=[],a=[],l=[],c=[],h=[],f=[])}),t}genFace(e,t,i,s,r,o,a,l,c,h){for(let f=2;f<h;f++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[(f-1)*3]]),e.vertex.push(t.vertexPositions[i[(f-1)*3+1]]),e.vertex.push(t.vertexPositions[i[(f-1)*3+2]]),e.vertex.push(t.vertexPositions[i[f*3]]),e.vertex.push(t.vertexPositions[i[f*3+1]]),e.vertex.push(t.vertexPositions[i[f*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(f-1)*4]),e.vertexWeights.push(l[(f-1)*4+1]),e.vertexWeights.push(l[(f-1)*4+2]),e.vertexWeights.push(l[(f-1)*4+3]),e.vertexWeights.push(l[f*4]),e.vertexWeights.push(l[f*4+1]),e.vertexWeights.push(l[f*4+2]),e.vertexWeights.push(l[f*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(f-1)*4]),e.weightsIndices.push(c[(f-1)*4+1]),e.weightsIndices.push(c[(f-1)*4+2]),e.weightsIndices.push(c[(f-1)*4+3]),e.weightsIndices.push(c[f*4]),e.weightsIndices.push(c[f*4+1]),e.weightsIndices.push(c[f*4+2]),e.weightsIndices.push(c[f*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(f-1)*3]),e.colors.push(o[(f-1)*3+1]),e.colors.push(o[(f-1)*3+2]),e.colors.push(o[f*3]),e.colors.push(o[f*3+1]),e.colors.push(o[f*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(f-1)*3]),e.normal.push(r[(f-1)*3+1]),e.normal.push(r[(f-1)*3+2]),e.normal.push(r[f*3]),e.normal.push(r[f*3+1]),e.normal.push(r[f*3+2])),t.uv&&t.uv.forEach(function(d,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(f-1)*2]),e.uvs[p].push(a[p][(f-1)*2+1]),e.uvs[p].push(a[p][f*2]),e.uvs[p].push(a[p][f*2+1])})}addMorphTargets(e,t,i,s){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=Mt.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,s,a.name)})})}genMorphGeometry(e,t,i,s,r){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],c=e.attributes.position.count*3,h=new Float32Array(c);for(let g=0;g<l.length;g++){const m=l[g]*3;h[m]=a[g*3],h[m+1]=a[g*3+1],h[m+2]=a[g*3+2]}const f={vertexIndices:o,vertexPositions:h},d=this.genBuffers(f),p=new Ve(d.vertex,3);p.name=r||i.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a;let r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Colors.a;let r=[];return i==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const s=e.Materials.a,r=[];for(let o=0;o<s.length;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){if(U_===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new it;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new it;const i=t-1,s=e.KnotVector.a,r=[],o=e.Points.a;for(let f=0,d=o.length;f<d;f+=4)r.push(new Dt().fromArray(o,f));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=i,l=s.length-1-a;for(let f=0;f<i;++f)r.push(r[f])}const h=new U_(i,s,r,a,l).getPoints(r.length*12);return new it().setFromPoints(h)}}u(fO,"GeometryParser");class dO{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const s=t[i],r=this.addClip(s);e.push(r)}return e}parseClips(){if(Mt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Mt.Objects.AnimationCurveNode,t=new Map;for(const i in e){const s=e[i];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=Mt.Objects.AnimationCurve;for(const i in t){const s={id:t[i].id,times:t[i].KeyTime.a.map(pde),values:t[i].KeyValueFloat.a},r=kn.get(s.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=s:a.match(/Y/)?e.get(o).curves.y=s:a.match(/Z/)?e.get(o).curves.z=s:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=s)}}}parseAnimationLayers(e){const t=Mt.Objects.AnimationLayer,i=new Map;for(const s in t){const r=[],o=kn.get(parseInt(s));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const f=kn.get(l.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(f!==void 0){const d=Mt.Objects.Model[f.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:d.attrName?bt.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};rs.traverse(function(g){g.ID===d.id&&(p.transform=g.matrix,g.userData.transformData&&(p.eulerOrder=g.userData.transformData.eulerOrder))}),p.transform||(p.transform=new ve),"PreRotation"in d&&(p.preRotation=d.PreRotation.value),"PostRotation"in d&&(p.postRotation=d.PostRotation.value),r[c]=p}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const f=kn.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,d=kn.get(f).parents[0].ID,p=kn.get(d).parents[0].ID,g=kn.get(p).parents[0].ID,m=Mt.Objects.Model[g],v={modelName:m.attrName?bt.sanitizeNodeName(m.attrName):"",morphName:Mt.Objects.Deformer[f].attrName};r[c]=v}r[c][h.attr]=h}}}),i.set(parseInt(s),r))}return i}parseAnimStacks(e){const t=Mt.Objects.AnimationStack,i={};for(const s in t){const r=kn.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);i[s]={name:t[s].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(s){t=t.concat(i.generateTracks(s))}),new Cb(e.name,-1,t)}generateTracks(e){const t=[];let i=new T,s=new je,r=new T;if(e.transform&&e.transform.decompose(i,s,r),i=i.toArray(),s=new lt().setFromQuaternion(s,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,i,s){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new Hl(e+"."+s,r,o)}generateRotationTrack(e,t,i,s,r,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map($s.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map($s.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map($s.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,i);s!==void 0&&(s=s.map($s.degToRad),s.push(o),s=new lt().fromArray(s),s=new je().setFromEuler(s)),r!==void 0&&(r=r.map($s.degToRad),r.push(o),r=new lt().fromArray(r),r=new je().setFromEuler(r).invert());const c=new je,h=new lt,f=[];for(let d=0;d<l.length;d+=3)h.set(l[d],l[d+1],l[d+2],o),c.setFromEuler(h),s!==void 0&&c.premultiply(s),r!==void 0&&c.multiply(r),c.toArray(f,d/3*4);return new Oo(e+".quaternion",a,f)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),s=rs.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Gl(e.modelName+".morphTargetInfluences["+s+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,s){return i-s}),t.length>1){let i=1,s=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==s&&(t[i]=o,s=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const s=i,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const h=t.x.values[o];r.push(h),s[0]=h}else r.push(s[0]);if(a!==-1){const h=t.y.values[a];r.push(h),s[1]=h}else r.push(s[1]);if(l!==-1){const h=t.z.values[l];r.push(h),s[2]=h}else r.push(s[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const i=e.values[t-1],s=e.values[t]-i,r=Math.abs(s);if(r>=180){const o=r/180,a=s/o;let l=i+a;const c=e.times[t-1],f=(e.times[t]-c)/o;let d=c+f;const p=[],g=[];for(;d<e.times[t];)p.push(d),d+=f,g.push(l),l+=a;e.times=w3(e.times,t,p),e.values=w3(e.values,t,g)}}}}u(dO,"AnimationParser");class pO{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new nx,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(s,r){const o=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(o||a)return;const l=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(s,l):c?t.parseNodeProperty(s,c,i[++r]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in a?(i==="PoseNode"?a.PoseNode.push(r):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=r)):typeof o.id=="number"?(a[i]={},a[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?a[i]=[r]:a[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let f=r.split(",").slice(3);f=f.map(function(d){return d.trim().replace(/^"/,"")}),s="connections",r=[c,h],gde(r,f),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=r),s in o&&Array.isArray(o[s])?o[s].push(r):s!=="a"?o[s]=r:o.a=r,this.setCurrentProp(o,s),s==="a"&&r.slice(-1)!==","&&(o.a=cy(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=cy(t.a))}parseNodeSpecialProperty(e,t,i){const s=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],o=s[1],a=s[2],l=s[3];let c=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=cy(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}u(pO,"TextParser");class mO{parse(e){const t=new $_(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const s=new nx;for(;!this.endOfContent(t);){const r=this.parseNode(t,i);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(s===0)return null;const l=[];for(let d=0;d<r;d++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",f=l.length>2?l[2]:"";for(i.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const d=this.parseNode(e,t);d!==null&&this.parseSubNode(a,i,d)}return i.propertyList=l,typeof c=="number"&&(i.id=c),h!==""&&(i.attrName=h),f!==""&&(i.attrType=f),a!==""&&(i.name=a),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const s=i.propertyList[0];Array.isArray(s)?(t[i.name]=i,i.a=s):t[i.name]=s}else if(e==="Connections"&&i.name==="C"){const s=[];i.propertyList.forEach(function(r,o){o!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let s=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],t[s]={type:r,type2:o,flag:a,value:l}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}typeof sde=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=Bd(new Uint8Array(e.getArrayBuffer(o))),l=new $_(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}u(mO,"BinaryParser");class $_{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let s=0;s<e;s++)t[s]=this.getUint8();const i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),mr.decodeText(new Uint8Array(t))}}u($_,"BinaryReader");class nx{add(e,t){this[e]=t}}u(nx,"FBXTree");function fde(n){const e="Kaydara FBX Binary  \0";return n.byteLength>=e.length&&e===yO(n,0,e.length)}u(fde,"isFbxFormatBinary");function dde(n){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(s){const r=n[s-1];return n=n.slice(t+s),t++,r}u(i,"read");for(let s=0;s<e.length;++s)if(i(1)===e[s])return!1;return!0}u(dde,"isFbxFormatASCII");function b3(n){const e=/FBXVersion: (\d+)/,t=n.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}u(b3,"getFbxVersion");function pde(n){return n/46186158e3}u(pde,"convertFBXTimeToSeconds");const mde=[];function Sm(n,e,t,i){let s;switch(i.mappingType){case"ByPolygonVertex":s=n;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(s=i.indices[s]);const r=s*i.dataSize,o=r+i.dataSize;return vde(mde,i.buffer,r,o)}u(Sm,"getData");const ly=new lt,Nc=new T;function gO(n){const e=new ve,t=new ve,i=new ve,s=new ve,r=new ve,o=new ve,a=new ve,l=new ve,c=new ve,h=new ve,f=new ve,d=new ve,p=n.inheritType?n.inheritType:0;if(n.translation&&e.setPosition(Nc.fromArray(n.translation)),n.preRotation){const D=n.preRotation.map($s.degToRad);D.push(n.eulerOrder||lt.DefaultOrder),t.makeRotationFromEuler(ly.fromArray(D))}if(n.rotation){const D=n.rotation.map($s.degToRad);D.push(n.eulerOrder||lt.DefaultOrder),i.makeRotationFromEuler(ly.fromArray(D))}if(n.postRotation){const D=n.postRotation.map($s.degToRad);D.push(n.eulerOrder||lt.DefaultOrder),s.makeRotationFromEuler(ly.fromArray(D)),s.invert()}n.scale&&r.scale(Nc.fromArray(n.scale)),n.scalingOffset&&a.setPosition(Nc.fromArray(n.scalingOffset)),n.scalingPivot&&o.setPosition(Nc.fromArray(n.scalingPivot)),n.rotationOffset&&l.setPosition(Nc.fromArray(n.rotationOffset)),n.rotationPivot&&c.setPosition(Nc.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(f.copy(n.parentMatrix),h.copy(n.parentMatrixWorld));const g=t.clone().multiply(i).multiply(s),m=new ve;m.extractRotation(h);const v=new ve;v.copyPosition(h);const y=v.clone().invert().multiply(h),b=m.clone().invert().multiply(y),_=r,x=new ve;if(p===0)x.copy(m).multiply(g).multiply(b).multiply(_);else if(p===1)x.copy(m).multiply(b).multiply(g).multiply(_);else{const k=new ve().scale(new T().setFromMatrixScale(f)).clone().invert(),O=b.clone().multiply(k);x.copy(m).multiply(g).multiply(O).multiply(_)}const w=c.clone().invert(),M=o.clone().invert();let C=e.clone().multiply(l).multiply(c).multiply(t).multiply(i).multiply(s).multiply(w).multiply(a).multiply(o).multiply(r).multiply(M);const A=new ve().copyPosition(C),P=h.clone().multiply(A);return d.copyPosition(P),C=d.clone().multiply(x),C.premultiply(h.invert()),C}u(gO,"generateTransform");function vO(n){n=n||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[n]}u(vO,"getEulerOrder");function cy(n){return n.split(",").map(function(t){return parseFloat(t)})}u(cy,"parseNumberArray");function yO(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=n.byteLength),mr.decodeText(new Uint8Array(n,e,t))}u(yO,"convertArrayBufferToString");function gde(n,e){for(let t=0,i=n.length,s=e.length;t<s;t++,i++)n[i]=e[t]}u(gde,"append");function vde(n,e,t,i){for(let s=t,r=0;s<i;s++,r++)n[r]=e[s];return n}u(vde,"slice");function w3(n,e,t){return n.slice(0,e).concat(t).concat(n.slice(e))}u(w3,"inject");class _O extends Ha{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new AO(t)}),this.register(function(t){return new RO(t)}),this.register(function(t){return new IO(t)}),this.register(function(t){return new SO(t)}),this.register(function(t){return new CO(t)}),this.register(function(t){return new EO(t)}),this.register(function(t){return new TO(t)}),this.register(function(t){return new xO(t)}),this.register(function(t){return new PO(t)}),this.register(function(t){return new MO(t)}),this.register(function(t){return new bO(t)}),this.register(function(t){return new DO(t)}),this.register(function(t){return new LO(t)})}load(e,t,i,s){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=mr.extractUrlBase(e),this.manager.itemStart(e);const a=u(function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},"_onError"),l=new jd(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let r;const o={},a={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(mr.decodeText(new Uint8Array(e,0,4))===OO){try{o[wt.KHR_BINARY_GLTF]=new kO(e)}catch(h){s&&s(h);return}r=JSON.parse(o[wt.KHR_BINARY_GLTF].content)}else r=JSON.parse(mr.decodeText(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new $O(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](l);a[h.name]=h,o[h.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const h=r.extensionsUsed[c],f=r.extensionsRequired||[];switch(h){case wt.KHR_MATERIALS_UNLIT:o[h]=new wO;break;case wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[h]=new zO;break;case wt.KHR_DRACO_MESH_COMPRESSION:o[h]=new NO(r,this.dracoLoader);break;case wt.KHR_TEXTURE_TRANSFORM:o[h]=new FO;break;case wt.KHR_MESH_QUANTIZATION:o[h]=new BO;break;default:f.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,t,s,r)})}}u(_O,"GLTFLoader");function yde(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}u(yde,"GLTFRegistry");const wt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class bO{constructor(e){this.parser=e,this.name=wt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new Te(16777215);l.color!==void 0&&h.fromArray(l.color);const f=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new F0(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Ra(h),c.distance=f;break;case"spot":c=new N0(h),c.distance=f,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(i,s),s}createNodeAttachment(e){const t=this,i=this.parser,r=i.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}u(bO,"GLTFLightsExtension");class wO{constructor(){this.name=wt.KHR_MATERIALS_UNLIT}getMaterialType(){return ji}extendParams(e,t,i){const s=[];e.color=new Te(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",r.baseColorTexture,It))}return Promise.all(s)}}u(wO,"GLTFMaterialsUnlitExtension$1");class xO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}u(xO,"GLTFMaterialsEmissiveStrengthExtension");class AO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Ga}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ke(a,a)}return Promise.all(r)}}u(AO,"GLTFMaterialsClearcoatExtension$1");class MO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Ga}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}u(MO,"GLTFMaterialsIridescenceExtension$1");class SO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Ga}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Te(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,It)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}u(SO,"GLTFMaterialsSheenExtension");class CO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Ga}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}u(CO,"GLTFMaterialsTransmissionExtension$1");class EO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Ga}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Te(a[0],a[1],a[2]),Promise.all(r)}}u(EO,"GLTFMaterialsVolumeExtension$1");class TO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Ga}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}u(TO,"GLTFMaterialsIorExtension");class PO{constructor(e){this.parser=e,this.name=wt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Ga}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Te(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&r.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,It)),Promise.all(r)}}u(PO,"GLTFMaterialsSpecularExtension");class RO{constructor(e){this.parser=e,this.name=wt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}u(RO,"GLTFTextureBasisUExtension");class IO{constructor(e){this.parser=e,this.name=wt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}u(IO,"GLTFTextureWebPExtension");class DO{constructor(e){this.name=wt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,f=s.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,f,d,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*f);return o.decodeGltfBuffer(new Uint8Array(p),h,f,d,s.mode,s.filter),p})})}else return null}}u(DO,"GLTFMeshoptCompression");class LO{constructor(e){this.name=wt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const c of s.primitives)if(c.mode!==Us.TRIANGLES&&c.mode!==Us.TRIANGLE_STRIP&&c.mode!==Us.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),f=h.isGroup?h.children:[h],d=c[0].count,p=[];for(const g of f){const m=new ve,v=new T,y=new je,b=new T(1,1,1),_=new DP(g.geometry,g.material,d);for(let x=0;x<d;x++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,x),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,x),l.SCALE&&b.fromBufferAttribute(l.SCALE,x),_.setMatrixAt(x,m.compose(v,y,b));for(const x in l)x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&g.geometry.setAttribute(x,l[x]);Pt.prototype.copy.call(_,g),_.frustumCulled=!1,this.parser.assignFinalMaterial(_),p.push(_)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}u(LO,"GLTFMeshGpuInstancing");const OO="glTF",sf=12,x3={JSON:1313821514,BIN:5130562};class kO{constructor(e){this.name=wt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,sf);if(this.header={magic:mr.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==OO)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-sf,s=new DataView(e,sf);let r=0;for(;r<i;){const o=s.getUint32(r,!0);r+=4;const a=s.getUint32(r,!0);if(r+=4,a===x3.JSON){const l=new Uint8Array(e,sf+r,o);this.content=mr.decodeText(l)}else if(a===x3.BIN){const l=sf+r;this.body=e.slice(l,l+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}u(kO,"GLTFBinaryExtension");class NO{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=wt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const f=V_[h]||h.toLowerCase();a[f]=o[h]}for(const h in e.attributes){const f=V_[h]||h.toLowerCase();if(o[h]!==void 0){const d=i.accessors[e.attributes[h]],p=$d[d.componentType];c[f]=p.name,l[f]=d.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(f){s.decodeDracoFile(h,function(d){for(const p in d.attributes){const g=d.attributes[p],m=l[p];m!==void 0&&(g.normalized=m)}f(d)},a,c)})})}}u(NO,"GLTFDracoMeshCompressionExtension");class FO{constructor(){this.name=wt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}u(FO,"GLTFTextureTransformExtension");class t0 extends Ks{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new Te().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(l){for(const c in a)l.uniforms[c]=a[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(l){a.specular.value=l}},specularMap:{get:function(){return a.specularMap.value},set:function(l){a.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(l){a.glossiness.value=l}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(l){a.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}u(t0,"GLTFMeshStandardSGMaterial");class zO{constructor(){this.name=wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return t0}extendParams(e,t,i){const s=t.extensions[this.name];e.color=new Te(1,1,1),e.opacity=1;const r=[];if(Array.isArray(s.diffuseFactor)){const o=s.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(s.diffuseTexture!==void 0&&r.push(i.assignTexture(e,"map",s.diffuseTexture,It)),e.emissive=new Te(0,0,0),e.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,e.specular=new Te(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const o=s.specularGlossinessTexture;r.push(i.assignTexture(e,"glossinessMap",o)),r.push(i.assignTexture(e,"specularMap",o,It))}return Promise.all(r)}createMaterial(e){const t=new t0(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=Gd,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}u(zO,"GLTFMaterialsPbrSpecularGlossinessExtension");class BO{constructor(){this.name=wt.KHR_MESH_QUANTIZATION}}u(BO,"GLTFMeshQuantizationExtension");class ix extends ch{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=i[r+o];return t}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=s-t,f=(i-t)/h,d=f*f,p=d*f,g=e*c,m=g-c,v=-2*p+3*d,y=p-d,b=1-v,_=y-d+f;for(let x=0;x!==a;x++){const w=o[m+x+a],M=o[m+x+l]*h,C=o[g+x+a],A=o[g+x]*h;r[x]=b*w+_*M+v*C+y*A}return r}}u(ix,"GLTFCubicSplineInterpolant");const _de=new je;class UO extends ix{interpolate_(e,t,i,s){const r=super.interpolate_(e,t,i,s);return _de.fromArray(r).normalize().toArray(r),r}}u(UO,"GLTFCubicSplineQuaternionInterpolant");const Us={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},$d={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A3={9728:zn,9729:Vi,9984:Ug,9985:pb,9986:$g,9987:nc},M3={33071:Gi,33648:vd,10497:Do},S3={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},V_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ha={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},bde={CUBICSPLINE:void 0,LINEAR:Vl,STEP:Iu},uy={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function wde(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Ks({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ul})),n.DefaultMaterial}u(wde,"createDefaultMaterial");function rf(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}u(rf,"addUnknownExtensionsToUserData");function Ml(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}u(Ml,"assignExtrasToUserData");function xde(n,e,t){let i=!1,s=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const f=e[c];if(f.POSITION!==void 0&&(i=!0),f.NORMAL!==void 0&&(s=!0),f.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const f=e[c];if(i){const d=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):n.attributes.position;o.push(d)}if(s){const d=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):n.attributes.normal;a.push(d)}if(r){const d=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):n.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],f=c[1],d=c[2];return i&&(n.morphAttributes.position=h),s&&(n.morphAttributes.normal=f),r&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}u(xde,"addMorphTargets");function Ade(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}u(Ade,"updateMorphTargets");function Mde(n){const e=n.extensions&&n.extensions[wt.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+C3(e.attributes):t=n.indices+":"+C3(n.attributes)+":"+n.mode,t}u(Mde,"createPrimitiveKey");function C3(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}u(C3,"createAttributesKey");function G_(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}u(G_,"getNormalizedComponentScale");function Sde(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}u(Sde,"getImageURIMimeType");class $O{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new yde,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||i||s&&r<98?this.textureLoader=new Xd(this.options.manager):this.textureLoader=new jP(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new jd(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};rf(r,a,s),Ml(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),r=u((o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])},"updateMappings");return r(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&i.push(r)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[wt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(mr.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,r=t.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=S3[s.type],c=$d[s.componentType],h=c.BYTES_PER_ELEMENT,f=h*l,d=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let m,v;if(p&&p!==f){const y=Math.floor(d/p),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let _=t.cache.get(b);_||(m=new c(a,y*p,s.count*p/h),_=new RP(m,p/h),t.cache.add(b,_)),v=new R0(_,l,d%p/h,g)}else a===null?m=new c(s.count*l):m=new c(a,d,s.count*l),v=new mn(m,l,g);if(s.sparse!==void 0){const y=S3.SCALAR,b=$d[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,w=new b(o[1],_,s.sparse.count*y),M=new c(o[2],x,s.sparse.count*l);a!==null&&(v=new mn(v.array.slice(),v.itemSize,v.normalized));for(let C=0,A=w.length;C<A;C++){const P=w[C];if(v.setX(P,M[C*l]),l>=2&&v.setY(P,M[C*l+1]),l>=3&&v.setZ(P,M[C*l+2]),l>=4&&v.setW(P,M[C*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,i=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,i){const s=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"";const d=(r.samplers||{})[o.sampler]||{};return h.magFilter=A3[d.magFilter]||Vi,h.minFilter=A3[d.minFilter]||nc,h.wrapS=M3[d.wrapS]||Do,h.wrapT=M3[d.wrapT]||Do,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const i=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const o=s.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(f){c=!0;const d=new Blob([f],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(f){return new Promise(function(d,p){let g=d;t.isImageBitmapLoader===!0&&(g=u(function(m){const v=new ii(m);v.needsUpdate=!0,d(v)},"onLoad")),t.load(mr.resolveURL(f,r.path),g,void 0,p)})}).then(function(f){return c===!0&&a.revokeObjectURL(l),f.userData.mimeType=o.mimeType||Sde(o.uri),f}).catch(function(f){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),f});return this.sourceCache[e]=h,h}assignTexture(e,t,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(i.texCoord!==void 0&&i.texCoord!=0&&!(t==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),r.extensions[wt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[wt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[wt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.encoding=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Fr,Zi.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Di,Zi.prototype.copy.call(l,i),l.color.copy(i.color),this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}i.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=i}getMaterialType(){return Ks}loadMaterial(e){const t=this,i=this.json,s=this.extensions,r=i.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const f=s[wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=f.getMaterialType(),c.push(f.extendParams(a,r,t))}else if(l[wt.KHR_MATERIALS_UNLIT]){const f=s[wt.KHR_MATERIALS_UNLIT];o=f.getMaterialType(),c.push(f.extendParams(a,r,t))}else{const f=r.pbrMetallicRoughness||{};if(a.color=new Te(1,1,1),a.opacity=1,Array.isArray(f.baseColorFactor)){const d=f.baseColorFactor;a.color.fromArray(d),a.opacity=d[3]}f.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",f.baseColorTexture,It)),a.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,a.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",f.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",f.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Ts);const h=r.alphaMode||uy.OPAQUE;if(h===uy.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===uy.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==ji&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new ke(1,1),r.normalTexture.scale!==void 0)){const f=r.normalTexture.scale;a.normalScale.set(f,f)}return r.occlusionTexture!==void 0&&o!==ji&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==ji&&(a.emissive=new Te().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==ji&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,It)),Promise.all(c).then(function(){let f;return o===t0?f=s[wt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):f=new o(a),r.name&&(f.name=r.name),Ml(f,r),t.associations.set(f,{materials:e}),r.extensions&&rf(s,f,r),f})}createUniqueName(e){const t=bt.sanitizeNodeName(e||"");let i=t;for(let s=1;this.nodeNamesUsed[i];++s)i=t+"_"+s;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[wt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return E3(l,a,t)})}u(r,"createDracoPrimitive");const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=Mde(c),f=s[h];if(f)o.push(f.promise);else{let d;c.extensions&&c.extensions[wt.KHR_DRACO_MESH_COMPRESSION]?d=r(c):d=E3(new it,c,t),s[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,s=this.extensions,r=i.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?wde(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],f=[];for(let p=0,g=h.length;p<g;p++){const m=h[p],v=o[p];let y;const b=c[p];if(v.mode===Us.TRIANGLES||v.mode===Us.TRIANGLE_STRIP||v.mode===Us.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new xb(m,b):new We(m,b),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),v.mode===Us.TRIANGLE_STRIP?y.geometry=T3(y.geometry,tz):v.mode===Us.TRIANGLE_FAN&&(y.geometry=T3(y.geometry,oP));else if(v.mode===Us.LINES)y=new vr(m,b);else if(v.mode===Us.LINE_STRIP)y=new js(m,b);else if(v.mode===Us.LINE_LOOP)y=new LP(m,b);else if(v.mode===Us.POINTS)y=new Pa(m,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&Ade(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Ml(y,r),v.extensions&&rf(s,y,v),t.assignFinalMaterial(y),f.push(y)}for(let p=0,g=f.length;p<g;p++)t.associations.set(f[p],{meshes:e,primitives:p});if(f.length===1)return f[0];const d=new ni;t.associations.set(d,{meshes:e});for(let p=0,g=f.length;p<g;p++)d.add(f[p]);return d})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new di($s.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new Va(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Ml(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return i.inverseBindMatrices=s,i})}loadAnimation(e){const i=this.json.animations[e],s=[],r=[],o=[],a=[],l=[];for(let c=0,h=i.channels.length;c<h;c++){const f=i.channels[c],d=i.samplers[f.sampler],p=f.target,g=p.node,m=i.parameters!==void 0?i.parameters[d.input]:d.input,v=i.parameters!==void 0?i.parameters[d.output]:d.output;s.push(this.getDependency("node",g)),r.push(this.getDependency("accessor",m)),o.push(this.getDependency("accessor",v)),a.push(d),l.push(p)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],f=c[1],d=c[2],p=c[3],g=c[4],m=[];for(let y=0,b=h.length;y<b;y++){const _=h[y],x=f[y],w=d[y],M=p[y],C=g[y];if(_===void 0)continue;_.updateMatrix();let A;switch(ha[C.path]){case ha.weights:A=Gl;break;case ha.rotation:A=Oo;break;case ha.position:case ha.scale:default:A=Hl;break}const P=_.name?_.name:_.uuid,D=M.interpolation!==void 0?bde[M.interpolation]:Vl,k=[];ha[C.path]===ha.weights?_.traverse(function(N){N.morphTargetInfluences&&k.push(N.name?N.name:N.uuid)}):k.push(P);let O=w.array;if(w.normalized){const N=G_(O.constructor),E=new Float32Array(O.length);for(let B=0,W=O.length;B<W;B++)E[B]=O[B]*N;O=E}for(let N=0,E=k.length;N<E;N++){const B=new A(k[N]+"."+ha[C.path],x.array,O,D);M.interpolation==="CUBICSPLINE"&&(B.createInterpolant=u(function(Z){const ne=this instanceof Oo?UO:ix;return new ne(this.times,this.values,this.getValueSize()/3,Z)},"InterpolantFactoryMethodGLTFCubicSpline"),B.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(B)}}const v=i.name?i.name:"animation_"+e;return new Cb(v,void 0,m)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(!!a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(e){const t=this.json,i=this.extensions,s=this,r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"";return function(){const a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let l;if(r.isBone===!0?l=new wd:a.length>1?l=new ni:a.length===1?l=a[0]:l=new Pt,l!==a[0])for(let c=0,h=a.length;c<h;c++)l.add(a[c]);if(r.name&&(l.userData.name=r.name,l.name=o),Ml(l,r),r.extensions&&rf(i,l,r),r.matrix!==void 0){const c=new ve;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return s.associations.has(l)||s.associations.set(l,{}),s.associations.get(l).nodes=e,l})}loadScene(e){const t=this.json,i=this.extensions,s=this.json.scenes[e],r=this,o=new ni;s.name&&(o.name=r.createUniqueName(s.name)),Ml(o,s),s.extensions&&rf(i,o,s);const a=s.nodes||[],l=[];for(let c=0,h=a.length;c<h;c++)l.push(VO(a[c],o,t,r));return Promise.all(l).then(function(){const c=u(h=>{const f=new Map;for(const[d,p]of r.associations)(d instanceof Zi||d instanceof ii)&&f.set(d,p);return h.traverse(d=>{const p=r.associations.get(d);p!=null&&f.set(d,p)}),f},"reduceAssociations");return r.associations=c(o),o})}}u($O,"GLTFParser");function VO(n,e,t,i){const s=t.nodes[n];return i.getDependency("node",n).then(function(r){if(s.skin===void 0)return r;let o;return i.getDependency("skin",s.skin).then(function(a){o=a;const l=[];for(let c=0,h=o.joints.length;c<h;c++)l.push(i.getDependency("node",o.joints[c]));return Promise.all(l)}).then(function(a){return r.traverse(function(l){if(!l.isMesh)return;const c=[],h=[];for(let f=0,d=a.length;f<d;f++){const p=a[f];if(p){c.push(p);const g=new ve;o.inverseBindMatrices!==void 0&&g.fromArray(o.inverseBindMatrices.array,f*16),h.push(g)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[f])}l.bind(new Wd(c,h),l.matrixWorld)}),r})}).then(function(r){e.add(r);const o=[];if(s.children){const a=s.children;for(let l=0,c=a.length;l<c;l++){const h=a[l];o.push(VO(h,r,t,i))}}return Promise.all(o)})}u(VO,"buildNodeHierarchy");function Cde(n,e,t){const i=e.attributes,s=new Qn;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(s.set(new T(l[0],l[1],l[2]),new T(c[0],c[1],c[2])),a.normalized){const h=G_($d[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new T,l=new T;for(let c=0,h=r.length;c<h;c++){const f=r[c];if(f.POSITION!==void 0){const d=t.json.accessors[f.POSITION],p=d.min,g=d.max;if(p!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),d.normalized){const m=G_($d[d.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new Ua;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}u(Cde,"computeBounds");function E3(n,e,t){const i=e.attributes,s=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}u(r,"assignAttributeAccessor");for(const o in i){const a=V_[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});s.push(o)}return Ml(n,e),Cde(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?xde(n,e.targets,t):n})}u(E3,"addPrimitiveAttributes");function T3(n,e){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(e===oP)for(let o=1;o<=i;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r}u(T3,"toTrianglesDrawMode");const Ede=/^[og]\s*(.+)?/,Tde=/^mtllib /,Pde=/^usemtl /,Rde=/^usemap /,P3=/\s+/,R3=new T,hy=new T,I3=new T,D3=new T,Fs=new T,Cm=new Te;function Ide(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},i&&i.name&&typeof i.clone=="function"){const s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addFaceNormal:function(e,t,i){const s=this.vertices,r=this.object.geometry.normals;R3.fromArray(s,e),hy.fromArray(s,t),I3.fromArray(s,i),Fs.subVectors(I3,hy),D3.subVectors(R3,hy),Fs.cross(D3),Fs.normalize(),r.push(Fs.x,Fs.y,Fs.z),r.push(Fs.x,Fs.y,Fs.z),r.push(Fs.x,Fs.y,Fs.z)},addColor:function(e,t,i){const s=this.colors,r=this.object.geometry.colors;s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[i]!==void 0&&r.push(s[i+0],s[i+1],s[i+2])},addUV:function(e,t,i){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[i+0],s[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,s,r,o,a,l,c){const h=this.vertices.length;let f=this.parseVertexIndex(e,h),d=this.parseVertexIndex(t,h),p=this.parseVertexIndex(i,h);if(this.addVertex(f,d,p),this.addColor(f,d,p),a!==void 0&&a!==""){const g=this.normals.length;f=this.parseNormalIndex(a,g),d=this.parseNormalIndex(l,g),p=this.parseNormalIndex(c,g),this.addNormal(f,d,p)}else this.addFaceNormal(f,d,p);if(s!==void 0&&s!==""){const g=this.uvs.length;f=this.parseUVIndex(s,g),d=this.parseUVIndex(r,g),p=this.parseUVIndex(o,g),this.addUV(f,d,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,s=e.length;i<s;i++){const r=this.parseVertexIndex(e[i],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,s=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],s))}};return n.startObject("",!1),n}u(Ide,"ParserState");class GO extends Ha{constructor(e){super(e),this.materials=null}load(e,t,i,s){const r=this,o=new jd(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(a))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new Ide;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let s=[];for(let a=0,l=i.length;a<l;a++){const c=i[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const f=c.split(P3);switch(f[0]){case"v":t.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?(Cm.setRGB(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])).convertSRGBToLinear(),t.colors.push(Cm.r,Cm.g,Cm.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":t.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if(h==="f"){const d=c.slice(1).trim().split(P3),p=[];for(let m=0,v=d.length;m<v;m++){const y=d[m];if(y.length>0){const b=y.split("/");p.push(b)}}const g=p[0];for(let m=1,v=p.length-1;m<v;m++){const y=p[m],b=p[m+1];t.addFace(g[0],y[0],b[0],g[1],y[1],b[1],g[2],y[2],b[2])}}else if(h==="l"){const f=c.substring(1).trim().split(" ");let d=[];const p=[];if(c.indexOf("/")===-1)d=f;else for(let g=0,m=f.length;g<m;g++){const v=f[g].split("/");v[0]!==""&&d.push(v[0]),v[1]!==""&&p.push(v[1])}t.addLineGeometry(d,p)}else if(h==="p"){const d=c.slice(1).trim().split(" ");t.addPointGeometry(d)}else if((s=Ede.exec(c))!==null){const f=(" "+s[0].slice(1).trim()).slice(1);t.startObject(f)}else if(Pde.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(Tde.test(c))t.materialLibraries.push(c.substring(7).trim());else if(Rde.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(s=c.split(" "),s.length>1){const d=s[1].trim().toLowerCase();t.object.smooth=d!=="0"&&d!=="off"}else t.object.smooth=!0;const f=t.object.currentMaterial();f&&(f.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();const r=new ni;if(r.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=t.objects.length;a<l;a++){const c=t.objects[a],h=c.geometry,f=c.materials,d=h.type==="Line",p=h.type==="Points";let g=!1;if(h.vertices.length===0)continue;const m=new it;m.setAttribute("position",new Ve(h.vertices,3)),h.normals.length>0&&m.setAttribute("normal",new Ve(h.normals,3)),h.colors.length>0&&(g=!0,m.setAttribute("color",new Ve(h.colors,3))),h.hasUVIndices===!0&&m.setAttribute("uv",new Ve(h.uvs,2));const v=[];for(let b=0,_=f.length;b<_;b++){const x=f[b],w=x.name+"_"+x.smooth+"_"+g;let M=t.materials[w];if(this.materials!==null){if(M=this.materials.create(x.name),d&&M&&!(M instanceof Di)){const C=new Di;Zi.prototype.copy.call(C,M),C.color.copy(M.color),M=C}else if(p&&M&&!(M instanceof Fr)){const C=new Fr({size:10,sizeAttenuation:!1});Zi.prototype.copy.call(C,M),C.color.copy(M.color),C.map=M.map,M=C}}M===void 0&&(d?M=new Di:p?M=new Fr({size:1,sizeAttenuation:!1}):M=new id,M.name=x.name,M.flatShading=!x.smooth,M.vertexColors=g,t.materials[w]=M),v.push(M)}let y;if(v.length>1){for(let b=0,_=f.length;b<_;b++){const x=f[b];m.addGroup(x.groupStart,x.groupCount,b)}d?y=new vr(m,v):p?y=new Pa(m,v):y=new We(m,v)}else d?y=new vr(m,v[0]):p?y=new Pa(m,v[0]):y=new We(m,v[0]);y.name=c.name,r.add(y)}else if(t.vertices.length>0){const a=new Fr({size:1,sizeAttenuation:!1}),l=new it;l.setAttribute("position",new Ve(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new Ve(t.colors,3)),a.vertexColors=!0);const c=new Pa(l,a);r.add(c)}return r}}u(GO,"OBJLoader");var Dde=Object.defineProperty,Lde=u((n,e)=>Dde(n,"name",{value:e,configurable:!0}),"__name$1d");class sx{update(e,t){if(!t.instanceId){if(t.has(No)){const i=t.get(No);if(!i.dirty||(i.dirty=!1,!i.value))return;const s=t.get(Me);s.dispose(),s.value=new GO().parse(i.value),s.value.userData={node:t};for(let r of s.value.children)r.userData={node:t};s.parentChanged=!0,s.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)}else if(t.has(ko)){const i=t.get(ko);if(!i.dirty||(i.dirty=!1,!i.value))return;const s=t.get(Me);s.dispose(),Bb(i.value).then(function(r){if(t.deleted)return;s.value=new uO().parse(r,void 0);const o=[s.value];for(;o.length;){const a=o.pop();if(!a)break;a.userData={node:t},o.push(...a.children)}s.parentChanged=!0,s.localTransformChanged=!0,t.dirty=!0,e.model.dirty=!0,e.model.instanceMeshUpdated(t.id,!0)})}else if(t.has(Fo)){const i=t.get(Fo);if(!i.dirty||(i.dirty=!1,!i.value.length))return;const s=t.get(Me);s.dispose(),console.info("Loading gltf zip"),zfe.loadAsync(i.value).then(async function(r){if(t.deleted)return;const o=Object.values(r.files).filter(d=>!d.dir),a=o.find(d=>d.name.toLocaleLowerCase().endsWith(".gltf"));if(!a){console.error("Failed to find entry file");return}const l={};for(let d of o){console.info(`Loading ${d.name}`);const p=await d.async("blob");if(t.deleted)return;l[d.name]=URL.createObjectURL(p)}const c=new Eb;c.setURLModifier(d=>{const p=new URL(d),g=p.pathname.replace(p.origin+"/","");return l[g]||d});const h=new _O(c),f=l[a.name];h.load(f,d=>{if(t.deleted)return;s.value=d.scene;const p=[d.scene];for(;p.length;){const g=p.pop();if(!g)break;g.userData={node:t},p.push(...g.children)}s.parentChanged=!0,s.localTransformChanged=!0,t.dirty=!0,e.model.dirty=!0,e.model.instanceMeshUpdated(t.id,!0)})})}}}}u(sx,"ImportModelUpdateFilter");Lde(sx,"ImportModelUpdateFilter");var Ode=Object.defineProperty,kde=u((n,e)=>Ode(n,"name",{value:e,configurable:!0}),"__name$1c");class rx{update(e,t){if(t.instanceId){const i=e.model.getNode(t.instanceId);for(let s in t.components)Ki(s).autoCopy&&(t.components[s].value=i.components[s].value)}}}u(rx,"InstanceNodeUpdateFilter");kde(rx,"InstanceNodeUpdateFilter");var Nde=Object.defineProperty,Fde=u((n,e)=>Nde(n,"name",{value:e,configurable:!0}),"__name$1b");class ox{update(e,t){if(t.has(Yi)){const i=t.get(Yi),s=i.value;s&&s.update();const r=i.camera;r&&r.update()}}}u(ox,"LightHelperUpdateFilter");Fde(ox,"LightHelperUpdateFilter");var zde=Object.defineProperty,Bde=u((n,e)=>zde(n,"name",{value:e,configurable:!0}),"__name$1a");class ax{update(e,t){var i,s,r,o;switch(t.type){case"AmbientLight":{const a=t.get(Me);a.value||(a.value=new z0);const l=a.value,c=t.value(Ot);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value($i)}break;case"HemisphereLight":{const a=t.get(Me);a.value||(a.value=new VP);const l=a.value,c=t.value(Rd);l.color.setRGB(c[0],c[1],c[2]);const h=t.value(Cd);l.groundColor.setRGB(h[0],h[1],h[2]),l.intensity=t.value($i);const f=t.get(Yi);f.value||(f.value=new QP(l,.25),e.scene.add(f.value))}break;case"DirectionalLight":{const a=t.get(Me);a.value||(a.value=new F0);const l=a.value;l.castShadow=t.value(Nn);const c=t.value(Ot);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value($i);const h=Number.parseInt(t.value(Ro));l.shadow.mapSize.x!==h&&(l.shadow.mapSize.set(h,h),(i=l.shadow.map)==null||i.setSize(h,h),(s=l.shadow.mapPass)==null||s.setSize(h,h),l.shadow.dispose());const f=t.value(Pd)/2;l.shadow.camera.top=+f,l.shadow.camera.right=+f,l.shadow.camera.bottom=-f,l.shadow.camera.left=-f,l.shadow.camera.near=0,l.shadow.camera.updateProjectionMatrix();const d=t.get(Yi);d.value||(d.value=new JP(l),e.scene.add(d.value)),d.camera||(d.camera=new eR(l.shadow.camera),e.scene.add(d.camera));const g=t.children[0].get(Me);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break;case"PointLight":{const a=t.get(Me);let l=a.value;const c=Number.parseInt(t.value(Ro));l&&l.shadow.mapSize.x!==c&&(l.dispose(),l.removeFromParent(),a.value=null,a.localTransformChanged=!0,a.worldTransformChanged=!0,a.parentChanged=!0),a.value||(l=a.value=new Ra,l.shadow.mapSize.set(c,c)),l.castShadow=t.value(Nn);const h=t.value(Ot);l.color.setRGB(h[0],h[1],h[2]),l.intensity=t.value($i);const f=.005;l.shadow.camera.near!==f&&(l.shadow.camera.near=f,l.shadow.camera.updateProjectionMatrix());const d=t.get(Yi);let p=d.value;p&&p.light!==l&&(p.dispose(),p.removeFromParent(),d.value=null),d.value||(d.value=new KP(l,.25),e.scene.add(d.value))}break;case"SpotLight":{const a=t.get(Me);a.value||(a.value=new N0);const l=a.value;l.castShadow=t.value(Nn);const c=t.value(Ot);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value($i),l.angle=t.value(Id)/180*Math.PI,l.penumbra=t.value(Td);const h=Number.parseInt(t.value(Ro));l.shadow.mapSize.x!==h&&(l.shadow.mapSize.set(h,h),(r=l.shadow.map)==null||r.setSize(h,h),(o=l.shadow.mapPass)==null||o.setSize(h,h),l.shadow.dispose());const f=.005;l.shadow.camera.near!==f&&(l.shadow.camera.near=f,l.shadow.camera.updateProjectionMatrix());const d=t.get(Yi);d.value||(d.value=new ZP(l),e.scene.add(d.value));const g=t.children[0].get(Me);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break}}}u(ax,"LightUpdateFilter");Bde(ax,"LightUpdateFilter");var Ude=Object.defineProperty,$de=u((n,e)=>Ude(n,"name",{value:e,configurable:!0}),"__name$19");class lx{update(e,t){var i;if(!t.instanceId&&t.has(Me)){const s=t.value(Me);if(!s)return;if(t.has(Xs)){const r=t.value(Xs);t.get(Me).usePlainMaterial=r;const o=[s];for(;o.length;){const a=o.pop();if(!a)break;const l=a;l.isMesh&&(r?(l.__plainMaterial||(l.__originalMaterial=l.material,l.__plainMaterial=new Ks),l.material=l.__plainMaterial,this.updateMaterial(t,l.__plainMaterial)):l.__originalMaterial&&(l.material=l.__originalMaterial)),o.push(...a.children)}}else{const r=[s];for(;r.length;){const o=r.pop();if(!o)break;if(((i=o.userData.node)==null?void 0:i.id)!==t.id)continue;const a=o;if(a.isMesh){const l=a.material;l.isMeshStandardMaterial&&this.updateMaterial(t,l)}else r.push(...o.children)}if(!s.isMesh)return}}}updateMaterial(e,t){if(e.has(Ot)){const i=e.value(Ot);t.color.setRGB(i[0],i[1],i[2])}if(e.has(Mn)){const i=e.value(Mn);t.emissive.setRGB(i[0],i[1],i[2])}e.has(Cn)&&(t.roughness=e.value(Cn)),e.has(Sn)&&(t.metalness=e.value(Sn))}}u(lx,"MaterialUpdateFilter");$de(lx,"MaterialUpdateFilter");class op extends We{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new di;const i=this,s=t.color!==void 0?new Te(t.color):new Te(8355711),r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,l=t.shader||op.ReflectorShader,c=t.multisample!==void 0?t.multisample:4,h=new xo,f=new T,d=new T,p=new T,g=new ve,m=new T(0,0,-1),v=new Dt,y=new T,b=new T,_=new Dt,x=new ve,w=this.camera,M=new yi(r,o,{samples:c,type:Pu}),C=new Ti({uniforms:E0.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});C.uniforms.tDiffuse.value=M.texture,C.uniforms.color.value=s,C.uniforms.textureMatrix.value=x,this.material=C,this.onBeforeRender=function(A,P,D){if(d.setFromMatrixPosition(i.matrixWorld),p.setFromMatrixPosition(D.matrixWorld),g.extractRotation(i.matrixWorld),f.set(0,0,1),f.applyMatrix4(g),y.subVectors(d,p),y.dot(f)>0)return;y.reflect(f).negate(),y.add(d),g.extractRotation(D.matrixWorld),m.set(0,0,-1),m.applyMatrix4(g),m.add(p),b.subVectors(d,m),b.reflect(f).negate(),b.add(d),w.position.copy(y),w.up.set(0,1,0),w.up.applyMatrix4(g),w.up.reflect(f),w.lookAt(b),w.far=D.far,w.updateMatrixWorld(),w.projectionMatrix.copy(D.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(w.projectionMatrix),x.multiply(w.matrixWorldInverse),x.multiply(i.matrixWorld),h.setFromNormalAndCoplanarPoint(f,d),h.applyMatrix4(w.matrixWorldInverse),v.set(h.normal.x,h.normal.y,h.normal.z,h.constant);const k=w.projectionMatrix;_.x=(Math.sign(v.x)+k.elements[8])/k.elements[0],_.y=(Math.sign(v.y)+k.elements[9])/k.elements[5],_.z=-1,_.w=(1+k.elements[10])/k.elements[14],v.multiplyScalar(2/v.dot(_)),k.elements[2]=v.x,k.elements[6]=v.y,k.elements[10]=v.z+1-a,k.elements[14]=v.w,i.visible=!1;const O=A.getRenderTarget(),N=A.xr.enabled,E=A.shadowMap.autoUpdate,B=A.outputEncoding,W=A.toneMapping;A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.outputEncoding=Lo,A.toneMapping=Ur,A.setRenderTarget(M),A.state.buffers.depth.setMask(!0),A.autoClear===!1&&A.clear(),A.render(P,w),A.xr.enabled=N,A.shadowMap.autoUpdate=E,A.outputEncoding=B,A.toneMapping=W,A.setRenderTarget(O);const Z=D.viewport;Z!==void 0&&A.state.viewport(Z),i.visible=!0},this.getRenderTarget=function(){return M},this.dispose=function(){M.dispose(),i.material.dispose()}}}u(op,"Reflector");op.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <encodings_fragment>

		}`};var Vde=Object.defineProperty,Gde=u((n,e)=>Vde(n,"name",{value:e,configurable:!0}),"__name$18");class cx{update(e,t){if(t.type!=="Mirror")return;const i=t.value(Ld),s=t.value(nn),r=t.get(Me);if(!r.value){const f=t.value(Ot);r.value=new op(new Lu(i,s),{color:new Te().setRGB(f[0],f[1],f[2])}),r.value.userData.node=t;return}const o=r.value,a=o.geometry;(a.parameters.width!==i||a.parameters.height!==s)&&(a.dispose(),r.value.geometry=new Lu(i,s));const l=o.material.uniforms.color.value,c=t.value(Ot);l.setRGB(c[0],c[1],c[2]);const h=Number.parseInt(t.value(Dd));o.getRenderTarget().setSize(h,h)}}u(cx,"MirrorUpdateFilter");Gde(cx,"MirrorUpdateFilter");var Hde=Object.defineProperty,Wde=u((n,e)=>Hde(n,"name",{value:e,configurable:!0}),"__name$17");class ux{update(e,t){var i;if(t.has(Me)){const s=t.get(Me);if(s.parentChanged){const o=s.value;if(o){o.removeFromParent();const a=nt(t.parent);if(a){if(a.has(Me)){const l=a.value(Me);l&&l.add(o)}}else e.scene.add(o)}s.parentChanged=!1}let r=t.has(ht)?t.value(ht):!0;t.has(He)&&((i=t.parent)==null?void 0:i.has(He))&&(r=!1),s.value&&(s.value.visible=r)}}}u(ux,"Object3DRelationshipUpdateFilter");Wde(ux,"Object3DRelationshipUpdateFilter");var jde=Object.defineProperty,HO=u((n,e)=>jde(n,"name",{value:e,configurable:!0}),"__name$16");function hx(n,e){const t=n;if(t.isMesh)if(Array.isArray(t.material))for(let i of t.material)i.opacity!==e&&(i.opacity=e,i.transparent=i.opacity<1,i.needsUpdate=!0);else t.material.opacity!==e&&(t.material.opacity=e,t.material.transparent=t.material.opacity<1,t.material.needsUpdate=!0);for(let i of n.children)hx(i,e)}u(hx,"setOpacity");HO(hx,"setOpacity");class fx{update(e,t){if(t.instanceId)return;if(t.opacity=(t.parent?t.parent.opacity:1)*(t.has(Jt)?t.value(Jt):1),Kn(t.type).mesh){const s=t.get(Me);s.value&&hx(s.value,t.opacity)}}}u(fx,"OpacityUpdateFilter");HO(fx,"OpacityUpdateFilter");var Xde=Object.defineProperty,Yde=u((n,e)=>Xde(n,"name",{value:e,configurable:!0}),"__name$15");class dx{update(e,t){if(t.instanceId||t.type!=="Shape"||!t.value(Cs))return;const i=t.get(Cs);i.value=!1;const s=t.get(Me);s.value||(s.value=new We(new it,new Ks),s.value.userData={node:t}),i.throttleHash=`#${t.id}-update-sdf-shape-geometry`,e.throttle(i.throttleHash,25,function(){if(t.deleted)return;i.throttleHash="";const r=new d1;switch(r.smoothRange=t.value(Ju),t.value(Li)){case"x":r.symmetryAxis=0;break;case"y":r.symmetryAxis=1;break;case"z":r.symmetryAxis=2;break}for(let h of t.children){const f=h.value(ft),d=h.value(Wu)==="add";if(f.length===1)r.sphere(f[0].position,f[0].radius,d);else for(let p=0;p+1<f.length;++p){const g=f[p],m=f[p+1];r.roundCone(g.position,g.radius,m.position,m.radius,d)}}const{position:o,normal:a}=r.build(),c=s.value.geometry;c.setAttribute("position",new Ve(o,3)),c.setAttribute("normal",new Ve(a,3)),c.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)},!1)}}u(dx,"SdfShapeUpdateFilter");Yde(dx,"SdfShapeUpdateFilter");var qde=Object.defineProperty,Zde=u((n,e)=>qde(n,"name",{value:e,configurable:!0}),"__name$14");class px{update(e,t){if(!t.has(Me)||!t.has(Nn)&&!t.has(Ui))return;const i=t.value(Me);if(!i)return;const s=t.has(Nn)?t.value(Nn):null,r=t.has(Ui)?t.value(Ui):null,o=[i];for(;o.length;){const a=o.pop();if(!a)break;s!=null&&(a.castShadow=s),r!=null&&(a.receiveShadow=r),o.push(...a.children)}}}u(px,"ShadowUpdateFilter");Zde(px,"ShadowUpdateFilter");var Kde=Object.defineProperty,Qde=u((n,e)=>Kde(n,"name",{value:e,configurable:!0}),"__name$13");class mx{update(e,t){if(t.has(Me)){const i=t.get(Me),s=i.value;if(s){if(i.localTransformChanged){if(t.has(Le)&&s.position.copy(t.value(Le)),t.has(Qe)&&s.rotation.copy(t.value(Qe)),t.has(Ft)&&(s.scale.x=s.scale.y=s.scale.z=t.value(Ft)),t.has(St)&&s.scale.copy(t.value(St)),t.has(_r)&&s.scale.multiply(t.value(_r)),t.has(xt)){const r=t.get(xt);s.position.copy(r.start),s.quaternion.copy(r.quaternion)}t.has(He)?s.matrix.copy(t.get(He).matrix):s.updateMatrix(),i.localTransformChanged=!1}i.worldTransformChanged&&(s.updateMatrixWorld(!0),i.worldTransformChanged=!1,t.forEach(r=>{if(r.has(ft)){const o=r.get(ft);o.group&&(o.group.matrixAutoUpdate=!1,o.group.matrix.copy(r.getWorldMatrix()))}}))}}}}u(mx,"TransformUpdateFilter");Qde(mx,"TransformUpdateFilter");var Jde=Object.defineProperty,epe=u((n,e)=>Jde(n,"name",{value:e,configurable:!0}),"__name$12");function n0(n=1,e=20){const t=[];let i=0,s=n;const r=Math.PI*2/e,o=Math.cos(r),a=Math.sin(r);for(let l=0;l<e;++l){const c=i*o-s*a,h=i*a+s*o;t.push(new T(i,s,0),new T(c,h,0)),i=c,s=h}return t}u(n0,"xyCirclePoints");epe(n0,"xyCirclePoints");var tpe=Object.defineProperty,npe=u((n,e)=>tpe(n,"name",{value:e,configurable:!0}),"__name$11");class p1 extends it{constructor(e=1,t=20){super(),this.setFromPoints(n0(e,t)),this.type="CircleEdgeGeometry"}}u(p1,"CircleEdgeGeometry");npe(p1,"CircleEdgeGeometry");var ipe=Object.defineProperty,spe=u((n,e)=>ipe(n,"name",{value:e,configurable:!0}),"__name$10");const rpe=ec.SphereGeometry,ope=new rpe(1,20,20),ape=new p1,lpe=new it().setFromPoints([new T,new T(1,0,0)]),cpe=new T(1,0,0),fy=new T;class gx{update(e,t){if(!t.has(ft))return;const i=t.get(ft);if(!i.dirty)return;i.dirty=!1,i.group||(i.group=new ni,i.group.visible=!1,e.scene.add(i.group));const s=i.value;for(;s.length<i.pickers.length;){const o=i.pickers.pop();o==null||o.removeFromParent()}for(;s.length<i.circles.length;){const o=i.circles.pop();o==null||o.removeFromParent()}for(;i.lines.length&&s.length-1<i.lines.length;){const o=i.lines.pop();o==null||o.removeFromParent()}for(;s.length>i.pickers.length;){const o=new We(ope);o.visible=!1;const a=i.pickers.push(o);o.userData={index:a-1},i.group.add(o)}for(;s.length>i.circles.length;){const o=new js(ape,ft.normalMaterial);i.circles.push(o),i.group.add(o)}for(;s.length-1>i.lines.length;){const o=new js(lpe,ft.normalMaterial);i.lines.push(o),i.group.add(o)}for(let o=0,a=s.length;o<a;++o){const l=s[o],c=i.circles[o];c.position.copy(l.position),c.scale.setScalar(l.radius);const h=i.pickers[o];if(h.position.copy(l.position),h.scale.setScalar(l.radius),o<a-1){const f=i.lines[o];f.position.copy(l.position),fy.subVectors(s[o+1].position,l.position);const d=fy.length();f.scale.setScalar(d),d>1e-8&&f.quaternion.setFromUnitVectors(cpe,fy.divideScalar(d))}}const r=t.get(Me);r.value||(r.value=new Pt,r.value.userData={node:t},r.parentChanged=!0,r.localTransformChanged=!0)}}u(gx,"TubeUpdateFilter");spe(gx,"TubeUpdateFilter");var upe=Object.defineProperty,hpe=u((n,e)=>upe(n,"name",{value:e,configurable:!0}),"__name$$");const Em=[],Er=new T,dy=new T,Tm=new je,Pm=new ve,py=new ve,Rm=new T;class vx extends Ls{constructor(t){super();S(this,"filters");this.filters=t}begin(t){t=t.readonlyRef();const i=nt(this);if(t.model.dirty){t.model.forEach(s=>{s.parent&&!s.parent.visible?s.visible=!1:s.visible=s.has(ht)?s.value(ht):!0,s.dirty&&Em.push(s)});for(let s of i.filters)for(let r of Em)s.update(t,r);for(let s of Em)s.dirty=!1;Em.length=0,t.model.dirty=!1}t.model.instanceDirty&&(t.model.instanceDirty=!1,t.model.forEach(s=>{if(s.instanceId){if(s.instanceMeshDirty){if(s.instanceMeshDirty=!1,!Kn(s.type).mesh)return;let o=s.instanceMeshRebuild;s.instanceMeshRebuild&&(s.instanceMeshRebuild=!1,i.recreateInstanceMesh(t,s)),s.has(Un)&&t.throttle(`#${s.id}-update-instance-mirror-geometry`,250,()=>{s.deleted||i.updateInstanceMirrorGeometry(t,s)},s.visible&&o)}i.updateInstanceMaterial(t,s)}}),t.model.dirty=!0)}end(t){}recreateInstanceMesh(t,i){if(!i.has(Me))return;const s=i.get(Me);if(s.instance=!0,s.dispose(),!t.model.isNodeExists(i.instanceId))return;const r=t.model.getNode(i.instanceId),o=r.value(Me);if(!o)return;const a=[[o,null]];let l=0;for(;a.length;){const c=a.pop();if(!c)break;const h=c[0],f=c[1];let d;if(h.isMesh){const p=h;d=new We(p.geometry,p.material)}else d=new Pt;d.visible=h.visible,d.position.copy(h.position),d.quaternion.copy(h.quaternion),d.scale.copy(h.scale),d.updateMatrix(),d.updateMatrixWorld(!0),d.userData={node:i,origin:h,instanceId:l++},f?f.add(d):s.value=d;for(let p of h.children)a.push([p,d])}i.dirty=!0,s.parentChanged=!0,s.localTransformChanged=!0,s.worldTransformChanged=!0,s.usePlainMaterial=r.get(Me).usePlainMaterial}updateInstanceMaterial(t,i){if(!i.has(Me)||!i.has(Xs))return;const s=t.model.getNode(i.instanceId),r=i.get(Me),o=s.get(Me);if(r.usePlainMaterial===o.usePlainMaterial||(r.usePlainMaterial=o.usePlainMaterial,!r.value)||!o.value)return;const a=[[r.value,o.value]];for(;a.length;){const l=a.pop();if(!l)break;const c=l[0],h=l[1];if(c.isMesh&&(c.material=h.material),c.children.length===h.children.length)for(let f=0,d=c.children.length;f<d;++f)a.push([c.children[f],h.children[f]])}}updateInstanceMirrorGeometry(t,i){if(!i.has(Un))return;const s=i.value(Un),r=i.value(Me);if(!r)return;const o=t.model.getNode(i.instanceId);if(!o.value(Me))return;const l=1e-6,c=Ow(Math.round(s.x/l)*l,Math.round(s.y/l)*l,Math.round(s.z/l)*l),h=r,f=[h];for(;f.length;){const d=f.shift();if(!d)break;const p=d.userData;if(p.relatedMatOrigin||(p.relatedMatOrigin=new ve,p.relatedMatFlipped=new ve),d!==h){const g=d.parent.userData;Pm.copy(g.relatedMatOrigin),py.copy(g.relatedMatFlipped).invert();const m=p.origin;dy.copy(m.position),dy.applyMatrix4(Pm).reflect(s).applyMatrix4(py),Tm.copy(m.quaternion);const v=Po(Rm,Tm);Rm.applyMatrix4(Pm).reflect(s).applyMatrix4(py),Rm.normalize(),Tm.setFromAxisAngle(Rm,-v),d.position.copy(dy),d.quaternion.copy(Tm),d.updateMatrix(),d.updateMatrixWorld(!0),p.relatedMatOrigin.multiplyMatrices(Pm,m.matrix),p.relatedMatFlipped.multiplyMatrices(g.relatedMatFlipped,d.matrix)}d.isMesh&&this.mirrorMesh(o,c+"/"+p.instanceId,d,p.origin,s),f.push(...d.children)}}mirrorMesh(t,i,s,r,o){if(!(!(s!=null&&s.geometry)||!(r!=null&&r.geometry))){if(t.mirrorGeometry[i]){s.geometry=t.mirrorGeometry[i];return}if(s.geometry===r.geometry){s.geometry=new it;const a=r.geometry.getIndex();a&&(s.geometry.index=new mn(new Uint32Array(a.array.length),a.itemSize),this.flipIndex(s.geometry.index,a));const l=r.geometry.getAttribute("position");l&&s.geometry.setAttribute("position",new Ve(new Float32Array(l.array),l.itemSize));const c=r.geometry.getAttribute("normal");c&&s.geometry.setAttribute("normal",new Ve(new Float32Array(c.array),c.itemSize));const h=r.geometry.getAttribute("color");h&&s.geometry.setAttribute("color",new Ve(new Float32Array(h.array),h.itemSize));const f=r.geometry.getAttribute("uv");f&&s.geometry.setAttribute("uv",f.clone())}this.mirrorGeometry(s.geometry,r.geometry,o),s.geometry.boundingSphere=null,t.mirrorGeometry[i]=s.geometry}}flipIndex(t,i){const s=t.array,r=i.array;for(let o=0,a=r.length;o<a;o+=3)s[o]=r[o+2],s[o+1]=r[o+1],s[o+2]=r[o]}mirrorGeometry(t,i,s){const r=!t.getIndex();this.mirrorAttribute(t.getAttribute("position"),i.getAttribute("position"),s,r),this.mirrorAttribute(t.getAttribute("normal"),i.getAttribute("normal"),s,r),r&&this.flipTriangles(t.getAttribute("color"),i.getAttribute("color"))}mirrorAttribute(t,i,s,r){if(!t||!i||t.itemSize!==3)return;const o=t.array,a=i.array;if(r)for(let l=0,c=a.length;l<c;l+=9)for(let h=0;h<9;h+=3)Er.fromArray(a,l+6-h),Er.reflect(s),o[l+h]=Er.x,o[l+h+1]=Er.y,o[l+h+2]=Er.z;else for(let l=0,c=a.length;l<c;l+=3)Er.fromArray(a,l),Er.reflect(s),o[l]=Er.x,o[l+1]=Er.y,o[l+2]=Er.z;t.needsUpdate=!0}flipTriangles(t,i){if(!t||!i||t.itemSize!==3)return;const s=t.array,r=i.array;for(let o=0,a=r.length;o<a;o+=9)for(let l=0;l<9;l+=3)s[o+l]=r[o+6-l],s[o+l+1]=r[o+6-l+1],s[o+l+2]=r[o+6-l+2];t.needsUpdate=!0}}u(vx,"ModelUpdateSystem");hpe(vx,"ModelUpdateSystem");var fpe=Object.defineProperty,dpe=u((n,e)=>fpe(n,"name",{value:e,configurable:!0}),"__name$_");class yx extends Ls{begin(e){e=e.readonlyRef();for(let t of e.views)t.enabled&&(t.mouseScr.x=t.input.pointerX,t.mouseScr.y=t.height-t.input.pointerY,t.mouseNdc.x=t.mouseScr.x/t.width*2-1,t.mouseNdc.y=t.mouseScr.y/t.height*2-1,t.mouseRay0.copy(t.mouseNdc),t.mouseRay0.z=-1,t.mouseRay0.unproject(t.camera.get()),t.mouseRay1.copy(t.mouseNdc),t.mouseRay1.z=1,t.mouseRay1.unproject(t.camera.get()),t.mouseRayN.subVectors(t.mouseRay1,t.mouseRay0).normalize(),t.raycaster.setFromCamera(t.mouseNdc,t.camera.get()))}end(e){}}u(yx,"MouseSystem");dpe(yx,"MouseSystem");var ppe=Object.defineProperty,mpe=u((n,e)=>ppe(n,"name",{value:e,configurable:!0}),"__name$Z");class _x extends Ls{constructor(){super(...arguments);S(this,"selectedObjs",[]);S(this,"visibilityCache",new Map)}setup(t){t.outlinePass.render=(i,s,r,o,a)=>{this.visibilityCache.clear();for(let l of this.selectedObjs){let c=l;for(;c;)this.visibilityCache.has(c)||this.visibilityCache.set(c,c.visible),c.visible=!0,c=c.parent}zr.prototype.render.call(t.outlinePass,i,s,r,o,a);for(let l of this.selectedObjs){let c=l;for(;c;)c.visible=!!this.visibilityCache.get(c),c=c.parent}}}begin(t){if(!t.options.outlineSelected){t.outlinePass.selectedObjects.length=0,t.outlinePass.enabled=!1;return}const i=t.readonlyRef().model.getTopmostSelectedNodes();this.selectedObjs.length=0;for(let s of i)if(s.has(Me)&&s.visible&&s.type!=="CsgBezierControlPoint"){const r=s.value(Me);r&&this.selectedObjs.push(r)}t.outlinePass.selectedObjects=this.selectedObjs,t.outlinePass.enabled=!!this.selectedObjs.length}end(t){}}u(_x,"OutlineUpdateSystem");mpe(_x,"OutlineUpdateSystem");var gpe=Object.defineProperty,vpe=u((n,e)=>gpe(n,"name",{value:e,configurable:!0}),"__name$Y");class hu extends vr{constructor(e=10,t=10,i=4473924,s=4473924,r=8947848,o=!0){const a=new Te(i),l=new Te(s),c=new Te(r),h=t/2,f=e/t,d=e/2,p=[],g=[];for(let y=0,b=0,_=-d;y<=t;y++,_+=f){p.push(-d,0,_,d,0,_),p.push(_,0,-d,_,0,d);const x=y===h?a:c,w=y===h?l:c;x.toArray(g,b),b+=3,x.toArray(g,b),b+=3,w.toArray(g,b),b+=3,w.toArray(g,b),b+=3}const m=new it;m.setAttribute("position",new Ve(p,3)),m.setAttribute("color",new Ve(g,3));const v=new Di({vertexColors:!0,toneMapped:!1,depthWrite:o});super(m,v),this.type="Grids"}dispose(){this.geometry.dispose(),this.material.dispose()}}u(hu,"Grids");vpe(hu,"Grids");var ype=Object.defineProperty,WO=u((n,e)=>ype(n,"name",{value:e,configurable:!0}),"__name$X");const fa=200,_pe=new T(1,0,0),bpe=new T(0,1,0),wpe=new T(0,0,1),xpe=new T;function Tg(n,e){return xpe.crossVectors(n._dir,e).lengthSq()<1e-8}u(Tg,"isCameraParallelTo");WO(Tg,"isCameraParallelTo");class bx extends Ls{constructor(){super(...arguments);S(this,"groundGrids",new hu(fa,fa,16135762,3113955,5592405));S(this,"xzGrids",new hu(fa,fa,16135762,3113955,5592405,!1));S(this,"xyGrids",new hu(fa,fa,16135762,7316763,5592405,!1).rotateX(Math.PI/2));S(this,"yzGrids",new hu(fa,fa,7316763,3113955,5592405,!1).rotateZ(Math.PI/2))}setup(t){t.scene.add(this.groundGrids),t.scene.add(this.xzGrids),t.scene.add(this.xyGrids),t.scene.add(this.yzGrids)}begin(t){t=t.readonlyRef();const i=t.canvas.getBoundingClientRect(),s=t.renderer,r=t.composer,o=t.renderPass,a=t.outlinePass;s.setScissorTest(!0),s.setClearColor(0,0),s.clear();const l=t.options.shadingMode==="solid";for(let c of t.views){for(let h of t.views){const f=c===h;h.gizmo.visible=f&&h.gizmoEnabled,h.gizmo.size=t.options.quadView?1/2:1/4,h.defaultLights.visible=l&&f}if(c.enabled&&c.width&&c.height){const h=c.camera;this.xzGrids.visible=t.options.showGrids&&Tg(h,bpe),this.xyGrids.visible=t.options.showGrids&&Tg(h,wpe),this.yzGrids.visible=t.options.showGrids&&Tg(h,_pe),this.groundGrids.visible=t.options.showGrids&&!(this.xzGrids.visible||this.xyGrids.visible||this.yzGrids.visible),t.tool.beforeRender(t,c);const f=-i.left+c.left,d=i.bottom-c.bottom,p=c.width,g=c.height;s.setViewport(f,d,p,g),s.setScissor(f,d,p,g),o.camera=h.get(),a.renderCamera=h.get(),r.setSize(p,g),r.render()}}t.tool.afterRender(t)}end(t){}}u(bx,"RenderSystem");WO(bx,"RenderSystem");var Ape=Object.defineProperty,Mpe=u((n,e)=>Ape(n,"name",{value:e,configurable:!0}),"__name$W");const L3=new T(0,0,1),of=new T,my=new ve,da=new T,gy=new $a;class wx extends Ls{constructor(){super(...arguments);S(this,"prevTool");S(this,"dragMovedFramesCount",0);S(this,"sculptPicked",!1);S(this,"sculptStroked",!1);S(this,"sculptIndicator",new vr(new it().setFromPoints([...n0(1),...n0(.05)]),new Di({fog:!1,toneMapped:!1,transparent:!0,color:15964205,opacity:1})));S(this,"sculptIndicatorSym",new vr(this.sculptIndicator.geometry.clone(),this.sculptIndicator.material.clone()))}setup(t){this.sculptIndicator.visible=!1,t.scene.add(this.sculptIndicator),this.sculptIndicatorSym.visible=!1,this.sculptIndicatorSym.material.opacity=.33,t.scene.add(this.sculptIndicatorSym)}begin(t){var s,r,o;const i=nt(t.tool);if(t.selectionRectSetThisFrame=!1,i.enableSelectionRect)for(let a of t.views){if(a=nt(a),!a.enabled)continue;const l=a.input;if(l.pointerOver&&l.mouseLeft){const c=Math.max(-1,Math.min(1,a.mouseNdc.x)),h=Math.max(-1,Math.min(1,a.mouseNdc.y));t.selectionRectDragging?(t.selectionRect.setPoint2(c,h),t.selectionEnd.set(c,h),this.dragMovedFramesCount<2&&(t.selectionRect.hide(),(this.dragMovedFramesCount||!t.selectionStart.equals(t.selectionEnd))&&(this.dragMovedFramesCount+=1))):(t.selectionRectDragging=!0,t.selectionRectViewIndex=a.index,t.selectionRect.attach(a.element),t.selectionRect.setPoint1(c,h),t.selectionRect.setPoint2(c,h),t.selectionStart.set(c,h),t.selectionEnd.set(c,h),this.dragMovedFramesCount=0)}if(t.selectionRectDragging&&t.selectionRectViewIndex===a.index&&!l.mouseLeft&&(t.selectionRectDragging=!1,t.selectionRectSetThisFrame=!0,t.selectionRect.hide(),i.enableDefaultSelectionBehavior))if(t.selectionStart.equals(t.selectionEnd)){const c=a.mousePick();let h=0;for(let f of c){const d=f.object.userData.node;if(d!=null&&d.visible){if(!t.options.allowSelectingInvisibleObjectByClicking&&d.has(He)&&((s=d.parent)==null?void 0:s.has(He)))continue;h=d.id;break}}if(h){if(t.model.selected.includes(h)?a.input.isKeyPressed("Control")&&(t.model.selected=t.model.selected.filter(f=>f!==h)):(a.input.isKeyPressed("Control")||(t.model.selected=[]),t.model.addSelection(h)),l.doubleClick){let f=t.model.getNode(h);for(f=f.parent;f;)f.expanded=!0,f=f.parent}}else a.input.isKeyPressed("Control")||(t.model.selected=[])}else{const c=t.selectionRect.select(a.camera.get(),t.readonlyRef().scene.children.filter(h=>h.visible&&!!h.userData.node));a.input.isKeyPressed("Control")||(t.model.selected=[]);for(let h of c){const f=h.userData.node;if(f){if(!t.options.allowSelectingInvisibleObjectByClicking&&f.has(He)&&((r=f.parent)==null?void 0:r.has(He)))continue;t.model.addSelection(f.id)}}}}else t.selectionRect.hide(),t.selectionRectDragging=!1;do{if(this.sculptIndicator.visible=!1,this.sculptIndicatorSym.visible=!1,t.sculptNodeId=0,t.sculptSym=!1,t.sculptMoved=!1,this.sculptPicked){let c=!1;for(let h of t.views)if(h.input.mouseLeft){c=!0;break}c||(this.sculptPicked=!1);break}if(!i.sculpt)break;const a=t.readonlyRef().model.getSelectedNodes().filter(c=>c.type==="Clay"&&!c.instanceId&&c.visible)[0];if(!a)break;const l=a.get(Me).mesh;if(!l)break;t.sculptNodeId=a.id,t.sculptSym=a.value(Li)!=="none";for(let c of t.views){if(c=nt(c),!c.enabled)continue;const h=c.input;if(h.mouseLeft)(h.pointerOver||t.sculptActiveView===c.index)&&(t.sculptActiveView=c.index,h.mouseLeftDownThisFrame?(t.sculptMoved=!0,t.sculptStartThisFrame=!0,t.sculptX0=t.sculptX1=h.pointerX,t.sculptY0=t.sculptY1=h.pointerY,this.sculptStroked=!1):(t.sculptX1!==h.pointerX||t.sculptY1!==h.pointerY)&&(t.sculptMoved=!0,t.sculptStartThisFrame=!1,t.sculptX0=t.sculptX1,t.sculptY0=t.sculptY1,t.sculptX1=h.pointerX,t.sculptY1=h.pointerY,this.sculptStroked=!0));else if(t.sculptActiveView===c.index&&(t.sculptActiveView=-1,!this.sculptStroked&&h.pointerOver)){t.model.selected.length=0;for(let g of c.mousePick()){const m=g.object.userData.node;if((m==null?void 0:m.type)==="Clay"){t.model.addSelection(m.id),this.sculptPicked=!0,t.sculptActiveView=-1;break}}}if(!h.pointerOver)continue;const f=a.getWorldMatrix();my.copy(f).invert(),gy.copy(c.raycaster.ray),gy.applyMatrix4(my);const d=l.raycast(gy,!0)[0];if(!d)break;h.mouseLeft?this.sculptStroked=!0:(this.sculptIndicator.visible=!0,this.sculptIndicatorSym.visible=t.sculptSym),this.sculptIndicator.position.copy(d.point).applyMatrix4(f),da.copy(d.normal).transformDirection(f),this.sculptIndicator.quaternion.setFromUnitVectors(L3,da);let p=i.brushRadius/c.height;if(c.camera.perspective?p*=this.sculptIndicator.position.distanceTo(c.camera._position):p*=c.camera.orthographicCamera.top-c.camera.orthographicCamera.bottom,this.sculptIndicator.scale.setScalar(p),t.sculptLocalRadius=p*Sa(my),this.sculptIndicatorSym.visible){switch(of.copy(d.point),da.copy(d.normal),a.value(Li)){case"x":of.x*=-1,da.x*=-1;break;case"y":of.y*=-1,da.y*=-1;break;case"z":of.z*=-1,da.z*=-1;break}this.sculptIndicatorSym.position.copy(of).applyMatrix4(f),da.transformDirection(f),this.sculptIndicatorSym.quaternion.setFromUnitVectors(L3,da),this.sculptIndicatorSym.scale.copy(this.sculptIndicator.scale)}break}}while(!1);i.begin(t);for(let a of t.views)a=nt(a),a.enabled&&i.update(t,a);if(i.end(t),i.sculpt&&!t.sculptNodeId)for(let a of t.views){a=nt(a);const l=a.input;if(l.pointerOver&&l.mouseLeftDownThisFrame)for(let c of a.mousePick()){const h=c.object.userData.node;if((h==null?void 0:h.type)==="Clay"){t.model.addSelection(h.id),this.sculptPicked=!0,t.sculptActiveView=-1;break}}}if(nt(this.prevTool)!==i&&((o=this.prevTool)==null||o.onUnselected(t),this.prevTool=i,t.statusBarMessage=i.tips),i.optionsProps.length){const a=t.options.tools[i.constructor.name]=t.options.tools[i.constructor.name]||{};for(let l of i.optionsProps)a[l]=i[l]}}end(t){}}u(wx,"ToolSystem");Mpe(wx,"ToolSystem");var Spe=Object.defineProperty,xx=u((n,e)=>Spe(n,"name",{value:e,configurable:!0}),"__name$V");const pa=new T,af=new T,Fc=new T,lf=new T,Im=new T,Dm=new T,Lm=new T,Om=new T,vy=new T,yy=new T,_y=new T,cf=new T;function H_(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(H_,"vertex$2");xx(H_,"vertex");function Ms(n,e,t,i){return e=H_(n,e,t),H_(n,e,i)}u(Ms,"line$1");xx(Ms,"line");class Ax extends vr{constructor(){const t=new it,i=new Array(12*2*3).fill(0),s=new Array(12*2*3).fill(1);t.setAttribute("position",new Ve(i,3)),t.setAttribute("color",new Ve(s,3));const r=new Di({vertexColors:!0,toneMapped:!1,color:16776960});super(t,r);S(this,"point1",new T);S(this,"point2",new T);S(this,"normal1",new T);S(this,"normal2",new T);S(this,"length",0);S(this,"width",0);S(this,"height",0);S(this,"dirty",!1);this.type="BoxEdge"}setPoint1(t){this.point1.equals(t)||(this.dirty=!0,this.point1.copy(t))}setPoint2(t){this.point2.equals(t)||(this.dirty=!0,this.point2.copy(t))}setNormal1(t){this.normal1.equals(t)||(this.dirty=!0,this.normal1.copy(t))}setNormal2(t){this.normal2.equals(t)||(this.dirty=!0,this.normal2.copy(t))}setHeight(t){t!==this.height&&(this.dirty=!0,this.height=t)}getLength(){return this.length}getWidth(){return this.width}updateGeometry(){if(!this.dirty)return;this.dirty=!1;const t=this.geometry.attributes.position,i=t.array;pa.copy(this.point1),Fc.copy(this.point2),yy.copy(this.normal1).normalize(),_y.crossVectors(this.normal1,this.normal2).normalize(),vy.subVectors(Fc,pa),af.copy(pa).addScaledVector(yy,this.width=vy.dot(yy)),lf.copy(pa).addScaledVector(_y,this.length=vy.dot(_y)),cf.copy(this.normal2).normalize().multiplyScalar(this.height),Im.addVectors(pa,cf),Dm.addVectors(af,cf),Lm.addVectors(Fc,cf),Om.addVectors(lf,cf);let s=0;s=Ms(i,s,pa,af),s=Ms(i,s,af,Fc),s=Ms(i,s,Fc,lf),s=Ms(i,s,lf,pa),s=Ms(i,s,pa,Im),s=Ms(i,s,af,Dm),s=Ms(i,s,Fc,Lm),s=Ms(i,s,lf,Om),s=Ms(i,s,Im,Dm),s=Ms(i,s,Dm,Lm),s=Ms(i,s,Lm,Om),Ms(i,s,Om,Im),t.needsUpdate=!0}}u(Ax,"BoxEdge");xx(Ax,"BoxEdge");var Cpe=Object.defineProperty,Mx=u((n,e)=>Cpe(n,"name",{value:e,configurable:!0}),"__name$U");const on=new T,ys=new T,_s=new T,bs=new T,al=new T,ll=new T,cl=new T,ul=new T,hl=new T;function _o(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(_o,"vertex$1");Mx(_o,"vertex");function jO(n,e,t,i,s,r,o){let a=0;_o(n,a,t),a=_o(e,a,o),_o(n,a,i),a=_o(e,a,o),_o(n,a,s),a=_o(e,a,o),_o(n,a,r),_o(e,a,o)}u(jO,"face");Mx(jO,"face");const Qt=class extends We{constructor(){const t=new it,i=new Float32Array(4*3),s=new Float32Array(4*3);t.setAttribute("position",new Ve(i,3)),t.setAttribute("normal",new Ve(s,3)),t.setIndex([0,1,3,0,3,2]);const r=new ji({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16776960,opacity:.75});super(t,r);S(this,"size",new T(1,1,1));S(this,"face",Qt.Right);S(this,"dirty",!0);this.type="BoxFace"}setSize(t){this.size.equals(t)||(this.dirty=!0,this.size.copy(t))}setFace(t){t!==this.face&&(this.dirty=!0,this.face=t)}getFace(){return this.face}setFaceFromNormal(t){t.x<-1e-6?this.setFace(Qt.Left):t.x>1e-6?this.setFace(Qt.Right):t.y<-1e-6?this.setFace(Qt.Bottom):t.y>1e-6?this.setFace(Qt.Top):t.z<-1e-6?this.setFace(Qt.Back):this.setFace(Qt.Front)}getFaceNormal(t){switch(this.face){case Qt.Left:t.set(-1,0,0);break;case Qt.Right:t.set(1,0,0);break;case Qt.Bottom:t.set(0,-1,0);break;case Qt.Top:t.set(0,1,0);break;case Qt.Back:t.set(0,0,-1);break;case Qt.Front:t.set(0,0,1);break}return t}getFaceTangent(t){switch(this.face){case Qt.Left:t.set(0,0,-1);break;case Qt.Right:t.set(0,0,1);break;case Qt.Bottom:t.set(-1,0,0);break;case Qt.Top:t.set(1,0,0);break;case Qt.Back:t.set(0,-1,0);break;case Qt.Front:t.set(0,1,0);break}return t}updateGeometry(){if(!this.dirty)return;this.dirty=!1,on.copy(this.size).multiplyScalar(-.5),ys.set(this.size.x,0,0),_s.set(0,this.size.y,0),bs.set(0,0,this.size.z);const t=this.geometry.attributes.position,i=this.geometry.attributes.normal,s=t.array,r=i.array;switch(t.needsUpdate=!0,i.needsUpdate=!0,this.face){case Qt.Left:al.copy(on),ll.copy(on).add(bs),cl.copy(on).add(_s),ul.copy(on).add(bs).add(_s),hl.set(-1,0,0);break;case Qt.Right:al.copy(on).add(ys),ll.copy(on).add(_s).add(ys),cl.copy(on).add(bs).add(ys),ul.copy(on).add(bs).add(_s).add(ys),hl.set(1,0,0);break;case Qt.Bottom:al.copy(on),ll.copy(on).add(ys),cl.copy(on).add(bs),ul.copy(on).add(bs).add(ys),hl.set(0,-1,0);break;case Qt.Top:al.copy(on).add(_s),ll.copy(on).add(bs).add(_s),cl.copy(on).add(ys).add(_s),ul.copy(on).add(bs).add(ys).add(_s),hl.set(0,1,0);break;case Qt.Back:al.copy(on),ll.copy(on).add(_s),cl.copy(on).add(ys),ul.copy(on).add(_s).add(ys),hl.set(0,0,-1);break;case Qt.Front:al.copy(on).add(bs),ll.copy(on).add(ys).add(bs),cl.copy(on).add(_s).add(bs),ul.copy(on).add(_s).add(ys).add(bs),hl.set(0,0,1);break}jO(s,r,al,ll,cl,ul,hl)}};let qn=Qt;u(qn,"BoxFace"),S(qn,"Right",0),S(qn,"Left",1),S(qn,"Top",2),S(qn,"Bottom",3),S(qn,"Front",4),S(qn,"Back",5);Mx(qn,"BoxFace");var Epe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntlDkOADEIxCDa/3/Z26TKBbmUBtcZD4oQIsFr1HoAMCVUNZ1LcjLX5FOZFXkv9+1OY/15VeAJlcOMSB7RDlEQBX4AWut9pKAnP1Iwkos0zvXV8xw84QcGmUP1JGS0xQAAAABJRU5ErkJggg==",Tpe=Object.defineProperty,Ppe=u((n,e)=>Tpe(n,"name",{value:e,configurable:!0}),"__name$T");function XO(n,e,t,i,s){let r,o,a,l,c=t-n,h=i-e,f=Math.abs(c),d=Math.abs(h),p=2*d-f,g=2*f-d;if(d<=f){c>=0?(r=n,o=e,a=t):(r=t,o=i,a=n),s(r,o);for(let m=0;r<a;m++)r=r+1,p<0?p=p+2*d:(c<0&&h<0||c>0&&h>0?o=o+1:o=o-1,p=p+2*(d-f)),s(r,o)}else{h>=0?(r=n,o=e,l=i):(r=t,o=i,l=e),s(r,o);for(let m=0;o<l;m++)o=o+1,g<=0?g=g+2*f:(c<0&&h<0||c>0&&h>0?r=r+1:r=r-1,g=g+2*(f-d)),s(r,o)}}u(XO,"pixelLine");Ppe(XO,"pixelLine");var Rpe=Object.defineProperty,Ipe=u((n,e)=>Rpe(n,"name",{value:e,configurable:!0}),"__name$S");const fl=new Ua,is=new $a,O3=new ve,km=new T;class Gn{constructor(){S(this,"sep",!1);S(this,"tips","");S(this,"enableDefaultDeleteShortcut",!0);S(this,"enableSelectionRect",!1);S(this,"enableDefaultSelectionBehavior",!1);S(this,"sculpt",!1);S(this,"brushRadius",50);S(this,"brushStepSpacingRadiusRatio",.2);S(this,"brushStrength",.5);S(this,"hasDirection",!1);S(this,"hasThirdDirection",!1);S(this,"brushDirection",1);S(this,"brushHardness",.5);S(this,"hasHardness",!1);S(this,"hasColor",!1);S(this,"frontFacesOnly",!1);S(this,"optionsProps",[])}setup(e){}dispose(){}begin(e){}update(e,t){}end(e){}beforeRender(e,t){}afterRender(e){}onUnselected(e){}sculptPickStrokeVertices(e,t,i,s,r){e=e.readonlyRef(),O3.copy(t.getWorldMatrix()).invert();const o=new Set,a=[],l=Math.max(1,Math.floor(this.brushRadius*this.brushStepSpacingRadiusRatio));e.sculptStartThisFrame&&(e.sculptAccWalkedPixels=l);const c=t.value(Li);XO(e.sculptX0,e.sculptY0,e.sculptX1,e.sculptY1,(p,g)=>{if(e.sculptAccWalkedPixels+=1,e.sculptAccWalkedPixels<l)return;e.sculptAccWalkedPixels=0,is.origin.set(p/i.width*2-1,(i.height-g)/i.height*2-1,-1),is.direction.copy(is.origin).setZ(1),is.origin.unproject(i.camera.get()),is.direction.unproject(i.camera.get()),is.direction.sub(is.origin).normalize(),is.applyMatrix4(O3);const m=s.raycast(is,!0)[0];if(!m)return;fl.set(m.point,e.sculptLocalRadius);const v=s.intersectSphere(fl),y=[],b=new Set;for(let w of v)if(!(r&&(s.getNormal(km,w),km.dot(is.direction)>=0)))for(let M=0;M<3;++M){const C=s.sharedVertexMap[w*3+M];b.has(C)||(b.add(C),y.push(C),o.add(C))}switch(c){case"x":fl.center.x*=-1,is.direction.x*=-1;break;case"y":fl.center.y*=-1,is.direction.y*=-1;break;case"z":fl.center.z*=-1,is.direction.z*=-1;break;default:{a.push({center:m.point,triangles:v,indices:y});return}}const _=s.intersectSphere(fl),x=[];b.clear();for(let w of _)if(!(r&&(s.getNormal(km,w),km.dot(is.direction)>=0)))for(let M=0;M<3;++M){const C=s.sharedVertexMap[w*3+M];b.has(C)||(b.add(C),x.push(C),o.add(C))}a.push({center:m.point,triangles:v,indices:y,centerSym:new T().copy(fl.center),trianglesSym:_,indicesSym:x})});const h=Array.from(o),f=new Map,d=new Float32Array(h.length*3);for(let p=0,g=h.length;p<g;++p){const m=h[p];for(let v=0;v<3;++v)d[p*3+v]=s.aPosition[m*3+v];f.set(m,p*3)}return{indices:h,offset:f,position:d,track:a}}sculptFalloff(e){return(3*e-4)*e**3+1}}u(Gn,"EditorTool");Ipe(Gn,"EditorTool");var Dpe=Object.defineProperty,Lpe=u((n,e)=>Dpe(n,"name",{value:e,configurable:!0}),"__name$R");const Nm=new T,uf=new T,k3=new T,by=new T,Ln=new T,hf=new T,ff=new T,N3=new T,Ope=new T,dl=new ve,Fm=new T,F3=new T,pl=new T,ma=new T,df=new T,ws=.25;class ap extends Gn{constructor(){super(...arguments);S(this,"name",ap.name);S(this,"label","Box");S(this,"icon",Epe);S(this,"tips","Hold [Alt] to create a box");S(this,"boxEdge",new Ax);S(this,"boxFace",new qn);S(this,"activeViewIndex",-1);S(this,"draggingFace",!1);S(this,"draggingFaceNodeId",0);S(this,"draggingFaceIndex",0);S(this,"draggingFaceNormal",new T);S(this,"faceNormalWorld0",new T);S(this,"position0",new T);S(this,"boxSize0",new T);S(this,"localMat0",new ve);S(this,"invWorldMat0",new ve);S(this,"mouse0",new T);S(this,"local0",new T);S(this,"creating",!1);S(this,"point2Set",!1);S(this,"point1",new T);S(this,"point2",new T);S(this,"normal1",new T);S(this,"normal2",new T);S(this,"boxHeight",0)}setup(t){this.boxEdge.visible=!1,t.scene.add(this.boxEdge),this.boxFace.visible=!1,t.scene.add(this.boxFace)}begin(t){this.draggingFace||(this.boxFace.visible=!1),this.creating||(this.boxEdge.visible=!1)}update(t,i){var r;const s=i.input;if(this.draggingFace){if(this.activeViewIndex!==i.index)return;if(s.pointerOver&&s.mouseLeft&&t.model.isNodeExists(this.draggingFaceNodeId,"Box")){if(N3.crossVectors(this.faceNormalWorld0,i.mouseRayN).lengthSq()<1e-6)return;Ao(Nm,null,this.mouse0,this.faceNormalWorld0,i.mouseRay0,i.mouseRayN),uf.copy(Nm).applyMatrix4(this.invWorldMat0);const o=k3.subVectors(uf,this.local0).dot(this.draggingFaceNormal);by.copy(this.position0),Ln.copy(this.boxSize0);const a=t.model.getNode(this.draggingFaceNodeId);switch(this.draggingFaceIndex){case qn.Left:case qn.Right:{Ln.x=Math.max(0,o+Ln.x),s.isKeyPressed("Shift")&&(Ln.x=Math.round(Ln.x/ws)*ws);const l=this.draggingFaceIndex===qn.Left?1:-1;hf.set(l*this.boxSize0.x/2,0,0),ff.set(l*Ln.x/2,0,0)}break;case qn.Bottom:case qn.Top:{Ln.y=Math.max(0,o+Ln.y),s.isKeyPressed("Shift")&&(Ln.y=Math.round(Ln.y/ws)*ws);const l=this.draggingFaceIndex===qn.Bottom?1:-1;hf.set(0,l*this.boxSize0.y/2,0),ff.set(0,l*Ln.y/2,0)}break;case qn.Back:case qn.Front:{Ln.z=Math.max(0,o+Ln.z),s.isKeyPressed("Shift")&&(Ln.z=Math.round(Ln.z/ws)*ws);const l=this.draggingFaceIndex===qn.Back?1:-1;hf.set(0,0,l*this.boxSize0.z/2),ff.set(0,0,l*Ln.z/2)}break}hf.applyMatrix4(this.localMat0),ff.applyMatrix4(this.localMat0),by.add(hf).sub(ff),t.history.setValue(a,Gs,new T().copy(Ln)),t.history.setValue(a,Le,new T().copy(by)),Ln.multiplyScalar(Sa(a.getWorldMatrix())),t.statusBarMessage=`${Ln.x.toFixed(2)} \xD7 ${Ln.y.toFixed(2)} \xD7 ${Ln.z.toFixed(2)}`}else this.draggingFace=!1,this.activeViewIndex=-1,this.draggingFaceNodeId=0,t.statusBarMessage=this.tips;return}if(this.creating){if(!this.point2Set){if(this.activeViewIndex!==i.index)return;if(s.mouseRightDownThisFrame&&(this.creating=!1,t.statusBarMessage=this.tips),Ht(this.point2,i.mouseRay0,i.mouseRay1,this.point1,this.normal2)){if(this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry(),s.isKeyPressed("Shift")){pl.copy(this.normal1),ma.crossVectors(this.normal1,this.normal2).normalize();let l=this.boxEdge.getWidth(),c=this.boxEdge.getLength();l=Math.round(l/ws)*ws,c=Math.round(c/ws)*ws,this.point2.copy(this.point1).addScaledVector(pl,l).addScaledVector(ma,c),this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry()}const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a}`}s.mouseLeft||(this.point2Set=!0);return}if(!s.pointerOver||(s.mouseRightDownThisFrame&&(this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips),N3.crossVectors(this.normal2,i.mouseRayN).lengthSq()<1e-8))return;if(!Ao(Nm,null,this.point2,this.normal2,i.mouseRay0,i.mouseRayN)){this.boxHeight=k3.subVectors(Nm,this.point2).dot(this.normal2),s.isKeyPressed("Shift")&&(this.boxHeight=Math.round(this.boxHeight/ws)*ws),this.boxEdge.setHeight(this.boxHeight),this.boxEdge.updateGeometry();const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2),l=Math.abs(this.boxHeight).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a} \xD7 ${l}`}if(s.mouseLeftDownThisFrame){this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips;let o=null;for(let v of t.model.getSelectedNodes())if(v.isValidChild("Box")){o=v;break}o?dl.copy(o.getWorldMatrix()).invert():dl.identity(),uf.copy(this.point1).applyMatrix4(dl),Fm.copy(this.point2).applyMatrix4(dl),F3.copy(this.point2).addScaledVector(this.normal2,this.boxHeight).applyMatrix4(dl),pl.copy(this.normal1).transformDirection(dl),ma.copy(this.normal2).transformDirection(dl),df.crossVectors(pl,ma).normalize();let a=uf.dot(pl),l=Fm.dot(pl);a>l&&([a,l]=[l,a]);let c=uf.dot(df),h=Fm.dot(df);c>h&&([c,h]=[h,c]);let f=Fm.dot(ma),d=F3.dot(ma);f>d&&([f,d]=[d,f]);const p=new lt().setFromQuaternion(Oa(new je,df,ma)),g=new T(l-a,d-f,h-c),m=new T().addScaledVector(pl,a+g.x/2).addScaledVector(ma,f+g.y/2).addScaledVector(df,c+g.z/2);t.history.createNode({type:"Box",parentId:o?o.id:0,data:{[Gs.name]:g,[Le.name]:m,[Qe.name]:p}})}return}if(s.pointerOver){for(let o of i.mousePick()){const a=o.object.userData.node;if((a==null?void 0:a.type)==="Box"){const l=(r=o.face)==null?void 0:r.normal;l&&(this.boxFace.visible=!0,this.boxFace.matrixAutoUpdate=!1,this.boxFace.matrix.copy(a.getWorldMatrix()),this.boxFace.setSize(a.value(Gs)),this.boxFace.setFaceFromNormal(l),this.boxFace.updateGeometry(),this.point1.copy(o.point),s.mouseLeftDownThisFrame&&!s.isKeyPressed("Alt")&&!a.instanceId&&(this.draggingFace=!0,this.activeViewIndex=i.index,this.draggingFaceNodeId=a.id,this.draggingFaceIndex=this.boxFace.getFace(),this.draggingFaceNormal.copy(l),this.faceNormalWorld0.copy(l).transformDirection(a.getWorldMatrix()),this.position0.copy(a.value(Le)),this.boxSize0.copy(a.value(Gs)),this.localMat0.copy(a.getLocalMatrix()),this.invWorldMat0.copy(a.getWorldMatrix()).invert(),this.mouse0.copy(o.point),this.local0.copy(this.mouse0).applyMatrix4(this.invWorldMat0)));break}}s.isKeyPressed("Alt")&&s.mouseLeftDownThisFrame&&(this.boxFace.visible?(this.creating=!0,this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2),this.normal1.transformDirection(this.boxFace.matrix),this.normal2.transformDirection(this.boxFace.matrix)):Ht(this.point1,i.mouseRay0,i.mouseRay1,this.point1.set(0,0,0),i.camera.perspective?Ope.set(0,1,0):i.mouseRayN)&&(i.camera.perspective?(this.normal1.set(1,0,0),this.normal2.set(0,1,0)):(this.boxFace.setFaceFromNormal(i.mouseRayN),this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2)),this.creating=!0),this.creating&&(s.isKeyPressed("Shift")&&bu(this.point1,ws),this.activeViewIndex=i.index,this.boxHeight=0,this.boxEdge.setPoint1(this.point1),this.boxEdge.setPoint2(this.point1),this.boxEdge.setNormal1(this.normal1),this.boxEdge.setNormal2(this.normal2),this.boxEdge.setHeight(0),this.boxEdge.updateGeometry(),this.boxEdge.visible=!0))}}onUnselected(t){this.draggingFace=!1,this.creating=!1,this.point2Set=!1,this.boxEdge.visible=!1,this.boxFace.visible=!1}}u(ap,"BoxTool");Lpe(ap,"BoxTool");var kpe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAItJREFUSIntkskRgCAMAIljIR4taP8FaAsencSPMtGBkGD4sR8zjO6C6lwlF7wpGqDXYoFika/UPBISmkZiMrMIJzKJpCS/IxLBr4j04dR9rUUcEREAICswdJOf93P1c0yoCjzy7VhQIxWBBLoWmjnYE5juWIr2FE1uiH58DvUroLse+xmce/9dFTUXvoWCImYNNpoAAAAASUVORK5CYII=",Npe=Object.defineProperty,Fpe=u((n,e)=>Npe(n,"name",{value:e,configurable:!0}),"__name$Q");class lp extends Gn{constructor(){super(...arguments);S(this,"name",lp.name);S(this,"label","Select");S(this,"icon",kpe);S(this,"enableSelectionRect",!0);S(this,"enableDefaultSelectionBehavior",!0)}}u(lp,"CursorTool");Fpe(lp,"CursorTool");var zpe=Object.defineProperty,Sx=u((n,e)=>zpe(n,"name",{value:e,configurable:!0}),"__name$P");function W_(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(W_,"vertex");Sx(W_,"vertex");function Ss(n,e,t,i){return e=W_(n,e,t),W_(n,e,i)}u(Ss,"line");Sx(Ss,"line");const ga=new T,zc=new T,ml=new T,Bc=new T,pf=new T,mf=new T,gf=new T,vf=new T;class Cx extends vr{constructor(){const t=new it,i=new Array(12*2*3).fill(0);t.setAttribute("position",new Ve(i,3));const s=new Di({toneMapped:!1,color:16777215,transparent:!0,opacity:.25});super(t,s);S(this,"box",new Qn);this.type="AabbEdge"}setBox(t){if(this.box.equals(t))return;this.box.copy(t);const i=t.max.x-t.min.x,s=t.max.y-t.min.y,r=t.max.z-t.min.z;ga.copy(t.min),zc.copy(ga),zc.x+=i,ml.copy(ga),ml.x+=i,ml.z+=r,Bc.copy(ga),Bc.z+=r,pf.copy(ga),pf.y+=s,mf.copy(zc),mf.y+=s,gf.copy(ml),gf.y+=s,vf.copy(Bc),vf.y+=s;const o=this.geometry.attributes.position,a=o.array;let l=0;l=Ss(a,l,ga,zc),l=Ss(a,l,zc,ml),l=Ss(a,l,ml,Bc),l=Ss(a,l,Bc,ga),l=Ss(a,l,ga,pf),l=Ss(a,l,zc,mf),l=Ss(a,l,ml,gf),l=Ss(a,l,Bc,vf),l=Ss(a,l,pf,mf),l=Ss(a,l,mf,gf),l=Ss(a,l,gf,vf),Ss(a,l,vf,pf),o.needsUpdate=!0}}u(Cx,"AabbEdge");Sx(Cx,"AabbEdge");var Bpe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAJNJREFUSIntVMsOwCAIo8v+/5e7kwkzgIJmO2w9+YBWiyLyYzdIMhN/VIlnhTBLDACaVM8BDHlCcj1viOI0XGWS1CezSPr96ZtkCxnlnVWCLb5740ycK6KL6SXpfav4Ip1FVe8tjmbhTaAtrggNa/NYDbx1z2svL/VMK0/znZ/skVZ6UWjRqGMud1OLbPT5tgl9BxdXU+tyUEB2ugAAAABJRU5ErkJggg==",Upe=Object.defineProperty,Ex=u((n,e)=>Upe(n,"name",{value:e,configurable:!0}),"__name$O");function Tx(...n){if(!n.length)return null;if(n.length===1)return n[0];const e=new Set;let t=n[0];for(;t;)e.add(t),t=t.parent;let i=n[1];for(;i;){if(e.has(i))return Tx(i,...n.slice(2));i=i.parent}return null}u(Tx,"getCommonParent");Ex(Tx,"getCommonParent");const $pe=function(){const n=new Qn,e=new ve;return Ex(u(function t(i,s,r){s.updateWorldMatrix(!1,!1);const o=s.geometry;o&&(o.boundingBox||o.computeBoundingBox(),n.copy(o.boundingBox),e.multiplyMatrices(r,s.matrixWorld),n.applyMatrix4(e),i.union(n));for(let a of s.children)a.visible&&t(i,a,r)},"expandBoxByVisibleObjects2"),"expandBoxByVisibleObjects")}(),zm=new Qn,va=new ve,yf=new ve,wy=new ve,On=new T,xy=new je,gl=new T,Ci=new T,z3=new ve,B3=new ve,_f=new T,Bm=new T;class Px extends Gn{constructor(){super(...arguments);S(this,"label","Transform");S(this,"icon",Bpe);S(this,"nodes",[]);S(this,"detMats",new Map);S(this,"geom3Init",new Map);S(this,"boundingBox",new Cx)}setup(t){t.scene.add(this.boundingBox),this.boundingBox.visible=!1}begin(t){const i=t.readonlyRef().model;this.nodes=i.getTopmostSelectedNodes().filter(r=>r.visible&&r.has(Me));const s=this.nodes.map(r=>r.value(Me)).filter(r=>!!r);if(s.length){this.boundingBox.visible=!0,zm.makeEmpty();const r=Tx(...s);r?(r.updateWorldMatrix(!1,!1),va.copy(r.matrixWorld),yf.copy(r.matrixWorld).invert()):(va.identity(),yf.identity());for(let o of s)$pe(zm,o,yf);this.boundingBox.setBox(zm),va.decompose(this.boundingBox.position,this.boundingBox.quaternion,this.boundingBox.scale),this.boundingBox.quaternion.normalize(),zm.applyMatrix4(va).getSize(Bm),t.statusBarMessage=`${Bm.x.toFixed(2)} \xD7 ${Bm.y.toFixed(2)} \xD7 ${Bm.z.toFixed(2)}`}else this.boundingBox.visible=!1,t.statusBarMessage="";this.enableSelectionRect=!0}update(t,i){var r,o,a,l;const s=i.gizmo;if(s.orientation=t.options.useLocalSpaceForTransformControl?"local":"world",i.gizmo.visible=!0,i.gizmoEnabled=this.boundingBox.visible,i.gizmoEnabled){if(this.boundingBox.updateMatrixWorld(),s.dragging||(t.options.takeGeometryCenterAsTransformOrigin?this.boundingBox.box.getCenter(On).applyMatrix4(this.boundingBox.matrixWorld):On.copy(this.boundingBox.position),s.setTargetTransform(On,this.boundingBox.quaternion,gl.set(1,1,1))),i.gizmo.enableTranslate=!0,i.gizmo.enableRotate=!0,i.gizmo.enableScale=!0,this.nodes.length===1){const c=this.nodes[0];i.gizmo.enableTranslate=c.has(Le),i.gizmo.enableRotate=c.has(Qe),i.gizmo.enableScale=c.has(Ft)||c.has(St)}i.gizmo.enableTranslate||i.gizmo.enableRotate||i.gizmo.enableScale?s.update(i.camera,i.raycaster,i.input,i.mouseRay0,i.mouseRay1,i.mouseRayN):i.gizmoEnabled=!1}if(s.dragging)if(this.enableSelectionRect=!1,s.dragStart){va.compose(s.position0,s.rotation0,s.scale0),yf.copy(va).invert(),this.detMats.clear(),this.geom3Init.clear();for(let c of this.nodes){const h=new ve().multiplyMatrices(yf,c.getWorldMatrix());switch(this.detMats.set(c.id,h),c.type){case"CsgCuboid":this.geom3Init.set(c.id,{[Hs.name]:c.cloneValue(Hs),[St.name]:c.cloneValue(St)});break;case"CsgEllipsoid":this.geom3Init.set(c.id,{[hr.name]:c.cloneValue(hr),[St.name]:c.cloneValue(St)});break;case"CsgCylinder":this.geom3Init.set(c.id,{[nn.name]:c.cloneValue(nn),[St.name]:c.cloneValue(St),[as.name]:c.cloneValue(as)});break;case"CsgCylinderElliptic":this.geom3Init.set(c.id,{[nn.name]:c.cloneValue(nn),[St.name]:c.cloneValue(St)});break}}}else{z3.compose(s.position0,s.rotation0,s.scale0),va.compose(s.position1,s.rotation1,s.scale1);for(let c of this.nodes){const h=this.detMats.get(c.id);if(!h)continue;wy.copy(c.getParentWorldMatrix()).invert().multiply(va).multiply(h),wy.decompose(On,xy,gl),c.has(Le)&&t.history.setValue(c,Le,new T().copy(On)),c.has(Qe)&&t.history.setValue(c,Qe,new lt().setFromQuaternion(xy));let f=!1;if(s.mode==="scale"){const d=this.geom3Init.get(c.id);if(d&&Math.abs(xy.length()-1)<1e-8){const p=d[St.name];switch(Ci.copy(gl).divide(p),c.type){case"CsgCuboid":{const g=new T().copy(d[Hs.name]);g.multiply(Ci),t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,Hs,g),f=!0}break;case"CsgEllipsoid":{const g=new T().copy(d[hr.name]);g.multiply(Ci),t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,hr,g),f=!0}break;case"CsgCylinder":if(Math.abs(Ci.x-1)<1e-7&&Math.abs(Ci.y-1)<1e-7&&Math.abs(Ci.z-1)>1e-7){let g=d[nn.name];g*=Ci.z,t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,nn,g),t.history.setValue(c,St,new T().copy(p)),f=!0}else if(Math.abs(Ci.x-1)>1e-7&&Math.abs(Ci.y-Ci.x)<1e-7&&Math.abs(Ci.z-1)<1e-7){let g=d[as.name];g*=Ci.x,t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,as,g),t.history.setValue(c,St,new T().copy(p)),f=!0}else t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,nn,d[nn.name]),t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,as,d[as.name]);break;case"CsgCylinderElliptic":if(Math.abs(Ci.x-1)<1e-7&&Math.abs(Ci.y-1)<1e-7&&Math.abs(Ci.z-1)>1e-7){let g=d[nn.name];g*=Ci.z,t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,nn,g),t.history.setValue(c,St,new T().copy(p)),f=!0}else t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,nn,d[nn.name]);break}}}if(!f)if(c.has(Ft)){B3.copy(c.getParentWorldMatrix()).invert().multiply(z3).multiply(h),aR(_f,B3);const d=(gl.x/_f.x||1)*(gl.y/_f.y||1)*(gl.z/_f.z||1)*_f.x;t.history.setValue(c,Ft,d)}else c.has(St)&&t.history.setValue(c,St,new T().copy(gl));if(c.has(He)){const d=c.get(He);f?(d.useTempMat=!0,d.tempMat.copy(wy)):d.useTempMat=!1;let p=c;for(;p&&(p.parent&&p.parent.has(He));)p=p.parent;t.delayThrottle(`#${p.id}-update-csg`,50)}}}else if(t.selectionRectSetThisFrame&&t.selectionRectViewIndex===i.index){const c=t.readonlyRef().selectionRect;if(Math.abs(c.x0-c.x1)<1e-6&&Math.abs(c.y0-c.y1)<1e-6){const h=i.raycaster.intersectObjects(t.readonlyRef().scene.children.filter(v=>!!v.userData.node));let f=!1,d=null;for(let v of h)if((r=v.object.userData.node)!=null&&r.visible){const y=v.object.userData.node;if(!t.options.allowSelectingInvisibleObjectByClicking&&y.has(He)&&((o=y.parent)==null?void 0:o.has(He)))continue;if(d||(d=y),!f&&t.model.selected.includes(y.id)){f=!0;break}}const p=new Set;for(let v of this.nodes)if(v.type==="CsgBezierControlPoint")for(let y of v.parent.children)p.add(y);let g=1/0;const m=i.camera.get();for(let v of p)zu(On,v.getWorldMatrix()),On.project(m),!(On.z>g)&&(On.x+=1,On.y+=1,On.x*=i.width/2,On.y*=i.height/2,Math.sqrt((i.mouseScr.x-On.x)**2+(i.mouseScr.y-On.y)**2)<=24/2&&(g=On.z,d=v));f||(i.input.isKeyPressed("Control")||(t.model.selected.length=0),d&&t.model.addSelection(d.id))}else{const h=new Set;for(let f of this.nodes)if(f.type==="CsgBezierControlPoint")for(let d of f.parent.children)h.add(d);if(h.size){const f=i.camera.get();i.input.isKeyPressed("Control")||(t.model.selected.length=0);const d=Math.min(c.x0,c.x1),p=Math.min(c.y0,c.y1),g=Math.max(c.x0,c.x1),m=Math.max(c.y0,c.y1);for(let v of h)zu(On,v.getWorldMatrix()),On.project(f),On.x>=d&&On.x<=g&&On.y>=p&&On.y<=m&&t.model.selected.push(v.id)}else{const f=c.select(i.camera.get(),t.readonlyRef().scene.children.filter(d=>!!d.userData.node));i.input.isKeyPressed("Control")||(t.model.selected.length=0);for(let d of f)if((a=d.userData.node)!=null&&a.visible){const p=d.userData.node;if(!t.options.allowSelectingInvisibleObjectByClicking&&p.has(He)&&((l=p.parent)==null?void 0:l.has(He)))continue;t.model.addSelection(p.id)}}}}}end(t){var s;const i=new Set;for(let r of this.nodes)if(r.type==="CsgBezierControlPoint")for(let o of r.parent.children)i.add(o);else{if(!r.has(He))continue;const o=r.get(He);let a=r,l=!1;if(o.useTempMat)l=!0;else for(;a&&a.has(He);){if(a.has(gi)&&((s=a==null?void 0:a.parent)==null?void 0:s.has(He))&&a.value(gi)==="negative"){l=!0;break}a=a.parent}l&&i.add(r)}for(let r of i){const o=r.get(Me);if(!o.value)continue;const a=r.get(He),l=a.placeholder;l&&(l.parent||t.scene.add(l),l.visible=!0,l.matrixAutoUpdate=!1,a.useTempMat?l.matrix.multiplyMatrices(r.getParentWorldMatrix(),a.tempMat):l.matrix.copy(o.value.matrixWorld))}}afterRender(t){for(let i of this.nodes)if(i.type==="CsgBezierControlPoint")for(let s of i.parent.children){const r=s.get(He);r.placeholder&&(r.placeholder.visible=!1)}else if(i.has(He)){const s=i.get(He);s.placeholder&&(s.placeholder.visible=!1)}}onUnselected(t){this.boundingBox.visible=!1;for(let i of t.views)i.gizmoEnabled=!1,i.gizmo.visible=!1,i.gizmo.dragging=!1;t.selectionRect.hide(),this.nodes=[],this.detMats.clear(),this.geom3Init.clear()}}u(Px,"GizmoTool");Ex(Px,"GizmoTool");var Vpe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntk0sOwCAIRB3vf2e6aqJN+AnEJjpLJfNQhtaudgvcBRHRVAiwtW59zbmzNPMIpGuwaOcioERaxymzyJ6DyygN4IGMYXAHw7ITo7nUmBnCQUOxliDSC8x7AABaurQak5b/+ZeQUsALKQWcoQdg9q9krk0nEQAAAABJRU5ErkJggg==",Gpe=Object.defineProperty,Hpe=u((n,e)=>Gpe(n,"name",{value:e,configurable:!0}),"__name$N");const Ay=new T,Um=new T,$m=new T,vl=new T,Vm=new ve,Uc=new ve,Gm=new ve,$c=new T,sr=new je,My=new je,Wpe=new je,U3=new je,Hm=new T,$3=new T,Wm=new T,V3=new T,G3=new T,Sy=new T,jm=new je,H3=new T;class Rx extends Gn{constructor(){super(...arguments);S(this,"label","IK Bind");S(this,"icon",Vpe);S(this,"activeView",-1);S(this,"ikChains",[]);S(this,"node");S(this,"rotate",!1);S(this,"mouse0",new T);S(this,"nodeInvMat",new ve);S(this,"chainInvMat",new ve);S(this,"chainPosition0",new T);S(this,"nodeStart0",new T);S(this,"nodeEnd0",new T);S(this,"nodeRotation0",new je);S(this,"nodeLocalMat0",new Map);S(this,"objWorldMat0",new Map)}begin(t){this.cleanup(t);const i=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?i.add(s):s.type==="IKNode"&&s.parent&&i.add(s.parent);this.ikChains=Array.from(i);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const l=s.children[r].get(xt);l.boneMesh&&(l.boneMesh.visible=!0),l.hingeIndicator&&(l.hingeIndicator.visible=l.hingeEnabled),r===0&&l.moveHandler&&(l.moveHandler.visible=!0),l.rotateHandler&&(l.rotateHandler.visible=!0)}}update(t,i){const s=i.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null;for(let l of this.ikChains)for(let c of l.children){const h=c.get(xt);h.updateHandlersHoverState(c,i),h.moveHandlerHovered&&h.moveHandlerZ<r&&(r=h.moveHandlerZ,o=c,a=h),h.rotateHandlerHovered&&h.rotateHandlerZ<r&&(r=h.rotateHandlerZ,o=c,a=h)}if(o&&a){this.node=o,this.rotate=a.rotateHandlerHovered,this.activeView=i.index;const l=o.parent,c=l.getWorldMatrix();this.mouse0.copy(this.rotate?a.end:a.start).applyMatrix4(c),Ht(this.mouse0,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),this.nodeInvMat.copy(c).invert(),this.chainInvMat.copy(l.getParentWorldMatrix()).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.nodeRotation0.copy(a.quaternion),this.chainPosition0.copy(l.value(Le)),this.nodeLocalMat0.clear(),this.objWorldMat0.clear();for(let h of l.children){this.nodeLocalMat0.set(h.id,new ve().copy(h.getLocalMatrix()));for(let f of h.children)this.objWorldMat0.set(f.id,new ve().copy(f.getWorldMatrix()))}t.model.addSelection(this.node.id)}else{let l;for(let c of i.mousePick()){for(l=c.object.userData.node;l&&!l.has(xt);)l=l.parent||void 0;if(l){this.mouse0.copy(c.point);break}}if(!l){t.model.selected=[];return}t.model.selected=[l.id]}}}else if(this.activeView===i.index&&this.node&&!this.node.deleted){const r=this.node.parent;if(Ht(Ay,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),this.rotate){Um.copy(this.mouse0).applyMatrix4(this.nodeInvMat),$m.copy(Ay).applyMatrix4(this.nodeInvMat),vl.subVectors($m,Um),$3.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),Wm.copy(this.nodeEnd0).add(vl).sub(this.nodeStart0);let o=Wm.length();Wm.normalize(),My.setFromUnitVectors($3,Wm),V3.set(0,0,1).applyQuaternion(this.nodeRotation0).applyQuaternion(My),G3.set(0,1,0).applyQuaternion(this.nodeRotation0).applyQuaternion(My),Oa(sr,V3,G3),jm.copy(sr);const a=r.children.indexOf(this.node);if(a>0){const c=r.children[a-1];U3.copy(c.get(xt).quaternion).invert(),sr.multiplyQuaternions(U3,sr)}let l=t.history.setValue(this.node,wn,new lt().setFromQuaternion(sr));if(t.options.allowModifyingBoneLengthWhenBindingIk&&(l=t.history.setValue(this.node,Xi,o)||l),l&&t.options.keepInternalTransformWhenBindingIk){let c=r.children.indexOf(this.node);if(c<0)return;Sy.copy(this.node.get(xt).start),H3.set(1,1,1);const h=r.getWorldMatrix();for(let f=r.children.length;c<f;++c){const d=r.children[c];Uc.compose(Sy,jm,H3),Uc.multiplyMatrices(h,Uc).invert();for(let g of d.children){const m=this.objWorldMat0.get(g.id);!m||(Gm.multiplyMatrices(Uc,m),Gm.decompose($c,sr,Hm),g.has(Le)&&t.history.setValue(g,Le,new T().copy($c)),g.has(Qe)&&t.history.setValue(g,Qe,new lt().setFromQuaternion(sr)))}const p=c+1;if(p<f){vl.set(o,0,0).applyQuaternion(jm),Sy.add(vl);const g=r.children[p];jm.multiply(Wpe.setFromEuler(g.value(wn))),o=g.value(Xi)}}}}else if(Um.copy(this.mouse0).applyMatrix4(this.chainInvMat),$m.copy(Ay).applyMatrix4(this.chainInvMat),vl.subVectors($m,Um),t.history.setValue(r,Le,new T().copy(this.chainPosition0).add(vl))&&t.options.keepInternalTransformWhenBindingIk){$c.copy(this.chainPosition0).add(vl),sr.setFromEuler(r.value(Qe)),Hm.setScalar(r.value(Ft)),Vm.compose($c,sr,Hm),Vm.multiplyMatrices(r.getParentWorldMatrix(),Vm);for(let a of r.children){const l=this.nodeLocalMat0.get(a.id);if(!!l){Uc.multiplyMatrices(Vm,l).invert();for(let c of a.children){const h=this.objWorldMat0.get(c.id);!h||(Gm.multiplyMatrices(Uc,h),Gm.decompose($c,sr,Hm),c.has(Le)&&t.history.setValue(c,Le,new T().copy($c)),c.has(Qe)&&t.history.setValue(c,Qe,new lt().setFromQuaternion(sr)))}}}}}}else this.activeView===i.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let i of this.ikChains)if(!i.deleted)for(let s of i.children){if(s.deleted)continue;s.get(xt).resetHandlers(t)}this.ikChains.length=0}}u(Rx,"IkBindTool");Hpe(Rx,"IkBindTool");var jpe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntktsOwCAIQ+3+/5/xyWRbVrATNVl23kRCubSUn92AfZiZXRIBmitzL85iacVHRI5IbLRzV0Chu5Eokd1HmvbNHVj8cUUAkOYaD6VbaYJGxiShi7at6/yWXdQj4gmmiExd2zKR6cdf4q7vUwFJaZOIR/7h8gAAAABJRU5ErkJggg==",Xpe=Object.defineProperty,Ype=u((n,e)=>Xpe(n,"name",{value:e,configurable:!0}),"__name$M");const ss=new T,W3=new ve;class Ix extends Gn{constructor(){super(...arguments);S(this,"label","Stretch Joint");S(this,"icon",jpe);S(this,"node",null);S(this,"dragging",!1);S(this,"draggedPrevFrame",!1);S(this,"length0",0);S(this,"childrenPosition0",new Map);S(this,"scale",new T)}begin(t){this.cleanup(t),this.node=null;for(let s of t.model.getSelectedNodes())if(!s.instanceId){this.node=s;break}for(;this.node&&!(this.node.type==="IKNode"&&!this.node.instanceId);)this.node=this.node.parent;if(!this.node){for(let s of t.views)s.gizmoEnabled=!1,s.gizmo.visible=!1,s.gizmo.dragging=!1;return}const i=this.node.parent;for(let s=0,r=i.children.length;s<r;++s){const a=i.children[s].get(xt);a.boneMesh&&(a.boneMesh.visible=!0)}if(!this.dragging){this.length0=this.node.value(Xi),this.childrenPosition0.clear();for(let s of this.node.children)s.has(Le)&&this.childrenPosition0.set(s.id,new T().copy(s.value(Le)))}this.draggedPrevFrame=this.dragging,this.dragging=!1}update(t,i){if(this.node&&(i.gizmoEnabled=!0,i.gizmo.visible=!0,i.gizmo.orientation="local",i.gizmo.enableTranslate=!1,i.gizmo.enableRotate=!1,i.gizmo.enableScale=!0,i.gizmo.dragging||(i.gizmo.setTargetTransformFromMatrix(this.node.getWorldMatrix()),i.gizmo.scale0.set(1,1,1)),i.gizmo.update(i.camera,i.raycaster,i.input,i.mouseRay0,i.mouseRay1,i.mouseRayN),i.gizmo.dragging)){this.dragging=!0,this.scale.copy(i.gizmo.scale1),this.scale.x=Math.max(this.scale.x,0),t.history.setValue(this.node,Xi,this.length0*this.scale.x);for(let r of this.childrenPosition0){const o=t.model.getNode(r[0]),a=r[1],l=new T().copy(a);l.x*=this.scale.x,t.history.setValue(o,Le,l)}for(let r of this.node.children)r.type==="Clay"&&t.model.setValue(r,_r,new T().copy(this.scale));return}const s=i.input;if(s.pointerOver&&s.mouseLeftDownThisFrame)for(let r of i.mousePick()){const o=r.object.userData.node;if(o&&!o.instanceId){t.model.selected=[o.id];break}}}end(t){if(this.draggedPrevFrame&&!this.dragging&&this.node){const i=this.scale,s=this.length0,r=i.x*s,o=r-s,a=t.options.keepBothEndsOfClayNodesWhenStretching;let l=!1;for(let c of this.node.children)if(c.type==="Clay"){l=!0;const h=c.getLocalMatrix();W3.copy(h).invert();const f=c.cloneValue(gn);for(let d=0,p=f.length;d<p;d+=3)ss.fromArray(f,d),ss.applyMatrix4(h),i.x>1&&a?ss.x>0&&ss.x<r?ss.x*=i.x:ss.x>=r&&(ss.x+=o):ss.x*=i.x,ss.y*=i.y,ss.z*=i.z,ss.applyMatrix4(W3),f[d]=ss.x,f[d+1]=ss.y,f[d+2]=ss.z;t.history.setValue(c,gn,f)}if(l){const c=[];c.push({node:this.node,componentClass:Xi});for(let h of this.childrenPosition0){const f=t.model.getNode(h[0]);c.push({node:f,componentClass:Le})}t.history.mergeLastRecord(c)}}}onUnselected(t){for(let i of t.views)i.gizmoEnabled=!1,i.gizmo.visible=!1,i.gizmo.dragging=!1;this.cleanup(t),this.node=null,this.dragging=!1,this.draggedPrevFrame=!1,this.scale.setScalar(1),this.childrenPosition0.clear()}cleanup(t){if(this.node){for(let s of this.node.children)s.type==="Clay"&&t.model.setValue(s,_r,new T(1,1,1));const i=this.node.parent;for(let s=0,r=i.children.length;s<r;++s)i.children[s].get(xt).resetHandlers(t)}}}u(Ix,"IkJointStretchTool");Ype(Ix,"IkJointStretchTool");var qpe=Object.defineProperty,Zpe=u((n,e)=>qpe(n,"name",{value:e,configurable:!0}),"__name$L");class Dx{constructor(){S(this,"length",0);S(this,"localRotation",new je);S(this,"start",new T);S(this,"end",new T);S(this,"rotation",new je);S(this,"hingeEnabled",!1);S(this,"hingeAxis",new T(1,0,0));S(this,"lowerAngle",-Math.PI);S(this,"upperAngle",+Math.PI)}}u(Dx,"CcdJoint");Zpe(Dx,"CcdJoint");var Kpe=Object.defineProperty,Qpe=u((n,e)=>Kpe(n,"name",{value:e,configurable:!0}),"__name$K");const Cy=new T,j3=new T,X3=new T,bf=new je,Y3=new T,q3=new T,Xm=new je,Ym=new T;class Lx{constructor(){S(this,"joints",[]);S(this,"iterLimit",20);S(this,"precision",1e-4)}resize(e){this.joints.length=e;for(let t=0;t<e;++t)this.joints[t]||(this.joints[t]=new Dx)}resolve(e){const t=this.joints.length;if(!t)return;for(let s=0;s<t;++s){const r=this.joints[s];if(s>0){const o=this.joints[s-1];r.rotation.multiplyQuaternions(o.rotation,r.localRotation),r.start.copy(o.end)}else r.rotation.copy(r.localRotation),r.start.set(0,0,0);r.end.set(r.length,0,0).applyQuaternion(r.rotation).add(r.start)}const i=this.joints[t-1];Cy.copy(i.end);for(let s=0;s<this.iterLimit;++s){for(let r=t-1;r>=0;--r){const o=this.joints[r];if(j3.subVectors(i.end,o.start).normalize(),X3.subVectors(e,o.start).normalize(),bf.setFromUnitVectors(j3,X3),Y3.set(0,0,1).applyQuaternion(o.rotation).applyQuaternion(bf),q3.set(0,1,0).applyQuaternion(o.rotation).applyQuaternion(bf),Oa(o.localRotation,Y3,q3),r>0){const a=this.joints[r-1];Xm.copy(a.rotation).invert(),o.localRotation.multiplyQuaternions(Xm,o.localRotation)}if(o.hingeEnabled){Xm.copy(o.localRotation).invert(),Ym.copy(o.hingeAxis).applyQuaternion(Xm),bf.setFromUnitVectors(o.hingeAxis,Ym),o.localRotation.multiply(bf).normalize();let a=Po(Ym,o.localRotation);const l=Math.sign(Ym.dot(o.hingeAxis));a=kb(a*l,o.lowerAngle,o.upperAngle),o.localRotation.setFromAxisAngle(o.hingeAxis,a)}for(let a=r;a<t;++a){const l=this.joints[a];if(a>0){const c=this.joints[a-1];l.rotation.multiplyQuaternions(c.rotation,l.localRotation),l.start.copy(c.end)}else l.rotation.copy(l.localRotation),l.start.set(0,0,0);l.end.set(l.length,0,0).applyQuaternion(l.rotation).add(l.start)}}if(i.end.distanceToSquared(Cy)<=this.precision||i.end.distanceToSquared(e)<=this.precision)break;Cy.copy(i.end)}}}u(Lx,"CcdChain");Qpe(Lx,"CcdChain");var Jpe=Object.defineProperty,Go=u((n,e)=>Jpe(n,"name",{value:e,configurable:!0}),"__name$J");class Ox{constructor(e){S(this,"node");S(this,"length",0);S(this,"localRotation",new je);S(this,"localRotation0",new je);S(this,"hingeEnabled",!1);S(this,"hingeAxis",new T(1,0,0));S(this,"lowerAngle",-Math.PI);S(this,"upperAngle",+Math.PI);S(this,"localMat",new ve);S(this,"worldMat",new ve);S(this,"hasLockEndChild",!1);S(this,"children",[]);S(this,"parent",null);S(this,"start",new T);S(this,"end",new T);S(this,"rotation",new je);this.node=e}}u(Ox,"VirtualIkNode");Go(Ox,"VirtualIkNode");class kx{constructor(){S(this,"localMat",new ve);S(this,"worldMat",new ve);S(this,"hasLockEndChild",!1);S(this,"children",[]);S(this,"parent",null)}}u(kx,"VirtualContainer");Go(kx,"VirtualContainer");class m1{constructor(){S(this,"children",[]);S(this,"localMat",new ve);S(this,"worldMat",new ve);S(this,"hasLockEndChild",!1);S(this,"lockEnd",!1);S(this,"endWorld",new T);S(this,"parent",null)}}u(m1,"VirtualIkChain");Go(m1,"VirtualIkChain");function Nx(n){const e=[];let t=!1;for(let i of n.children){const s=Nx(i);s&&(e.push(s),(s.hasLockEndChild||s.lockEnd)&&(t=!0))}switch(n.type){case"Container":{const i=new kx;i.localMat.copy(n.getLocalMatrix()),i.worldMat.copy(n.getWorldMatrix()),i.hasLockEndChild=t,i.children=e;for(let s of i.children)s.parent=i;return i}case"IKChain":{const i=new m1;if(i.localMat.copy(n.getLocalMatrix()),i.worldMat.copy(n.getWorldMatrix()),i.lockEnd=n.value(Ed),i.hasLockEndChild=t,i.children=e,i.lockEnd&&n.children.length){const s=n.children[n.children.length-1];i.endWorld.copy(s.get(xt).end),i.endWorld.applyMatrix4(i.worldMat)}for(let s of i.children)s.parent=i;return i}case"IKNode":{const i=new Ox(n);switch(i.localMat.copy(n.getLocalMatrix()),i.worldMat.copy(n.getWorldMatrix()),i.length=n.value(Xi),i.localRotation.setFromEuler(n.value(wn)),i.localRotation0.copy(i.localRotation),n.value(cs)){case"horizontal":i.hingeEnabled=!0,i.hingeAxis.set(0,1,0);break;case"vertical":i.hingeEnabled=!0,i.hingeAxis.set(0,0,1);break;default:i.hingeEnabled=!1;break}const s=n.value(ka);if(i.lowerAngle=s[0]/180*Math.PI,i.upperAngle=s[1]/180*Math.PI,n.instanceId&&n.has(Un)){const r=n.value(Un);switch(n.value(cs)){case"horizontal":r.z>1e-6&&([i.lowerAngle,i.upperAngle]=[-i.upperAngle,-i.lowerAngle]);break;case"vertical":r.y>1e-6&&([i.lowerAngle,i.upperAngle]=[-i.upperAngle,-i.lowerAngle]);break}}i.hasLockEndChild=t,i.children=e;for(let r of i.children)r.parent=i;return i}}return null}u(Nx,"createVirtualNode");Go(Nx,"createVirtualNode");function YO(n){return Nx(n)}u(YO,"saveIkChainState");Go(YO,"saveIkChainState");const qm=new Lx,eme=new T(1,1,1);function Fx(n,e,t,i){qm.resize(t+1);for(let s=0;s<=t;++s){const r=qm.joints[s],o=e.children[s];r.length=o.length,r.localRotation.copy(o.localRotation),r.hingeEnabled=o.hingeEnabled,r.hingeAxis.copy(o.hingeAxis),r.lowerAngle=o.lowerAngle,r.upperAngle=o.upperAngle}qm.resolve(i);for(let s=0;s<=t;++s){const r=qm.joints[s],o=e.children[s];o.localRotation.copy(r.localRotation),n.history.setValue(o.node,wn,new lt().setFromQuaternion(o.localRotation))}zx(e)}u(Fx,"resolveIkChain");Go(Fx,"resolveIkChain");function zx(n){for(let e=0,t=n.children.length;e<t;++e){const i=n.children[e];if(e===0)i.rotation.copy(i.localRotation),i.start.set(0,0,0);else{const s=n.children[e-1];i.rotation.multiplyQuaternions(s.rotation,i.localRotation),i.start.copy(s.end)}i.end.set(i.length,0,0).applyQuaternion(i.rotation).add(i.start),i.localMat.compose(i.start,i.rotation,eme)}}u(zx,"updateIkChainLocalMatrices");Go(zx,"updateIkChainLocalMatrices");const Z3=new ve,K3=new T;function i0(n,e){if((e.hasLockEndChild||e.lockEnd)&&e.parent&&e.worldMat.multiplyMatrices(e.parent.worldMat,e.localMat),e.lockEnd){const t=e;Z3.copy(t.worldMat).invert(),K3.copy(t.endWorld).applyMatrix4(Z3),Fx(n,t,t.children.length-1,K3)}if(e.hasLockEndChild)for(let t of e.children)i0(n,t)}u(i0,"resolveLockedEnds");Go(i0,"resolveLockedEnds");function Bx(n){if(n instanceof m1)for(let e of n.children)e.localRotation.copy(e.localRotation0);if(n.hasLockEndChild)for(let e of n.children)Bx(e)}u(Bx,"resetIkChains");Go(Bx,"resetIkChains");var tme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHlJREFUSIntU0EOwDAIqvv/n9m1MzjRNlmylCNSsFHHOPgaxkgAeIjMqK4Fbx5x28xXQ643w8xU0YQBGQCgPBulY6+bOeVH6RyYOau1Qjwf/aQVUlnfckjVqLTSHZO5VlrTbRetmEYzajWhDpzx8iXOj9kFZ/WDH+MGbSHHUbX+Pw0AAAAASUVORK5CYII=",nme=Object.defineProperty,ime=u((n,e)=>nme(n,"name",{value:e,configurable:!0}),"__name$I");const co=new T,uo=new T,Vc=new T,Gc=new T,Q3=new T,wf=new T,yl=new je,Zm=new je,J3=new T,eE=new T,_l=new T,Ey=new T,tE=new je,nE=new T;class Ux extends Gn{constructor(){super(...arguments);S(this,"label","Move IK Chain");S(this,"icon",tme);S(this,"activeView",-1);S(this,"ikChains",[]);S(this,"node");S(this,"action","swing");S(this,"mouse0",new T);S(this,"origin",new T);S(this,"boneAxis",new T);S(this,"invMat",new ve);S(this,"nodeEnd0",new T);S(this,"rotation0",new je);S(this,"position0",new T);S(this,"chain0",null)}begin(t){this.cleanup(t);const i=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?i.add(s):s.type==="IKNode"&&s.parent&&i.add(s.parent);this.ikChains=Array.from(i);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const a=s.children[r],l=a.get(xt);r===0&&l.moveHandler&&(l.moveHandler.visible=s.value(ju)),l.rotateHandler&&(l.rotateHandler.visible=a.value(Xu))}}update(t,i){const s=i.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null,l=!1;for(let c of this.ikChains)for(let h of c.children){const f=h.get(xt);f.updateHandlersHoverState(h,i),f.moveHandlerHovered&&f.moveHandlerZ<r&&(r=f.moveHandlerZ,o=h,a=f,l=!1),f.rotateHandlerHovered&&f.rotateHandlerZ<r&&(r=f.rotateHandlerZ,o=h,a=f,l=!0)}if(o&&a){this.node=o,this.action=l?"swing":"move",this.activeView=i.index;const c=o.parent,h=c.getWorldMatrix();l?this.mouse0.copy(a.end).applyMatrix4(h):(this.position0.copy(c.value(Le)),zu(this.mouse0,c.getWorldMatrix())),Ht(this.mouse0,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),l?(this.invMat.copy(h).invert(),this.nodeEnd0.copy(a.end)):this.invMat.copy(c.getParentWorldMatrix()).invert(),t.model.addSelection(this.node.id)}else{let c;for(let d of i.mousePickVisible()){for(c=d.object.userData.node;c&&!c.has(xt);)c=c.parent||void 0;if(c){this.mouse0.copy(d.point);break}}if(!c){t.model.selected=[];return}if(t.model.selected=[c.id],c.value(cs)!=="none")return;this.node=c,this.action="twist",this.activeView=i.index;const h=c.getParentWorldMatrix();this.invMat.copy(h).invert(),uo.copy(this.mouse0).applyMatrix4(this.invMat);const f=c.get(xt);this.boneAxis.subVectors(f.end,f.start).normalize(),cR(this.origin,f.start,this.boneAxis,uo),this.boneAxis.transformDirection(h),this.rotation0.copy(f.quaternion),this.origin.distanceTo(uo)<1e-8?this.node=void 0:this.origin.applyMatrix4(h)}this.node&&(this.chain0=YO(this.node.parent))}}else if(this.activeView===i.index&&this.node&&!this.node.deleted&&this.chain0){let r=!1;if(this.action==="move"){Ht(co,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),uo.copy(this.mouse0).applyMatrix4(this.invMat),Vc.copy(co).applyMatrix4(this.invMat),Gc.subVectors(Vc,uo);const o=this.node.parent,a=new T().addVectors(this.position0,Gc);r=t.history.setValue(o,Le,a),yl.setFromEuler(o.value(Qe)),nE.setScalar(o.value(Ft)),this.chain0.localMat.compose(a,yl,nE),this.chain0.worldMat.multiplyMatrices(o.getParentWorldMatrix(),this.chain0.localMat)}else if(this.action==="swing"){if(Ht(co,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),uo.copy(this.mouse0).applyMatrix4(this.invMat),Vc.copy(co).applyMatrix4(this.invMat),Gc.subVectors(Vc,uo),Gc.lengthSq()<1e-6)return;wf.copy(this.nodeEnd0).add(Gc),this.mouse0.copy(co),this.nodeEnd0.copy(wf);const o=this.chain0.children.findIndex(a=>a.node.id===this.node.id);Fx(t,this.chain0,o,wf),r=!0}else{if(Math.acos(Math.abs(this.boneAxis.dot(i.mouseRayN)))*180/Math.PI>45){if(!Ht(co,i.mouseRay0,i.mouseRay1,this.origin,i.mouseRayN))return;_l.crossVectors(this.boneAxis,i.mouseRayN).normalize();const c=this.mouse0.distanceTo(this.origin),h=.4,f=-Gc.subVectors(co,this.mouse0).dot(_l)/c*Math.PI/2*h;_l.copy(this.boneAxis).transformDirection(this.invMat),Zm.setFromAxisAngle(_l,f)}else{if(!Ht(co,i.mouseRay0,i.mouseRay1,this.origin,this.boneAxis))return;uo.copy(this.mouse0).applyMatrix4(this.invMat),Vc.copy(co).applyMatrix4(this.invMat),Ey.copy(this.origin).applyMatrix4(this.invMat),Q3.subVectors(uo,Ey).normalize(),wf.subVectors(Vc,Ey).normalize(),_l.copy(this.boneAxis).transformDirection(this.invMat);const c=Tl(_l,Q3,wf);Zm.setFromAxisAngle(_l,c)}J3.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(Zm),eE.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(Zm),Oa(yl,J3,eE);const o=this.node.parent,a=o.children.indexOf(this.node);if(a>0){const c=o.children[a-1];tE.copy(c.get(xt).quaternion).invert(),yl.multiplyQuaternions(tE,yl)}r=t.history.setValue(this.node,wn,new lt().setFromQuaternion(yl)),this.chain0.children.find(c=>c.node.id===this.node.id).localRotation.copy(yl),zx(this.chain0)}if(r){for(let o of this.chain0.children)Bx(o);if(this.node.id===this.chain0.children[this.chain0.children.length-1].node.id)for(let o of this.chain0.children)i0(t,o);else i0(t,this.chain0)}}}else this.activeView===i.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let i of this.ikChains)if(!i.deleted)for(let s of i.children){if(s.deleted)continue;s.get(xt).resetHandlers(t)}this.ikChains.length=0}}u(Ux,"IkMoveTool");ime(Ux,"IkMoveTool");var sme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhJREFUSIntk0sOgDAIRDve/864ra0DJUM1Mc4SKI9Pae3X2wJzmJldAgEam9aYnNnKkiuQI4KplbuALYoqZn7r1NunDgBAGcvyb/Mq9eyp4rKQO7+7ZHVcIaAKsqQRUn2Q00MGlLtliSqu3oWwQ5Mg25f/yO/6vk5YzaN81PvS3QAAAABJRU5ErkJggg==",rme=Object.defineProperty,ome=u((n,e)=>rme(n,"name",{value:e,configurable:!0}),"__name$H");const ya=new T,ho=new T,Hc=new T,xf=new T,Km=new T,Qm=new T,_a=new je,bl=new je,iE=new T,sE=new T,wl=new T,Ty=new T,Jm=new je,eg=new T,Wc=new T;class $x extends Gn{constructor(){super(...arguments);S(this,"label","Move Single Joint (Ignore IK)");S(this,"icon",sme);S(this,"activeView",-1);S(this,"ikChains",[]);S(this,"node");S(this,"action","swing");S(this,"mouse0",new T);S(this,"origin",new T);S(this,"boneAxis",new T);S(this,"invMat",new ve);S(this,"nodeStart0",new T);S(this,"nodeEnd0",new T);S(this,"rotation0",new je);S(this,"position0",new T)}begin(t){this.cleanup(t);const i=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?i.add(s):s.type==="IKNode"&&s.parent&&i.add(s.parent);this.ikChains=Array.from(i);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const a=s.children[r],l=a.get(xt);r===0&&l.moveHandler&&(l.moveHandler.visible=s.value(ju)),l.rotateHandler&&(l.rotateHandler.visible=a.value(Xu))}}update(t,i){const s=i.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null,l=!1;for(let c of this.ikChains)for(let h of c.children){const f=h.get(xt);f.updateHandlersHoverState(h,i),f.moveHandlerHovered&&f.moveHandlerZ<r&&(r=f.moveHandlerZ,o=h,a=f,l=!1),f.rotateHandlerHovered&&f.rotateHandlerZ<r&&(r=f.rotateHandlerZ,o=h,a=f,l=!0)}if(o&&a){this.node=o,this.action=l?"swing":"move",this.activeView=i.index;const c=o.parent,h=c.getWorldMatrix();l?this.mouse0.copy(a.end).applyMatrix4(h):(this.position0.copy(c.value(Le)),zu(this.mouse0,c.getWorldMatrix())),Ht(this.mouse0,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),l?(this.invMat.copy(h).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.rotation0.copy(a.quaternion)):this.invMat.copy(c.getParentWorldMatrix()).invert(),t.model.addSelection(this.node.id)}else{let c;for(let d of i.mousePickVisible()){for(c=d.object.userData.node;c&&!c.has(xt);)c=c.parent||void 0;if(c){this.mouse0.copy(d.point);break}}if(!c){t.model.selected=[];return}if(t.model.selected=[c.id],c.value(cs)!=="none")return;this.node=c,this.action="twist",this.activeView=i.index;const h=c.getParentWorldMatrix();this.invMat.copy(h).invert(),ho.copy(this.mouse0).applyMatrix4(this.invMat);const f=c.get(xt);this.boneAxis.subVectors(f.end,f.start).normalize(),cR(this.origin,f.start,this.boneAxis,ho),this.boneAxis.transformDirection(h),this.rotation0.copy(f.quaternion),this.origin.distanceTo(ho)<1e-8?this.node=void 0:this.origin.applyMatrix4(h)}}}else if(this.activeView===i.index&&this.node&&!this.node.deleted)if(this.action==="move"){Ht(ya,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),ho.copy(this.mouse0).applyMatrix4(this.invMat),Hc.copy(ya).applyMatrix4(this.invMat),xf.subVectors(Hc,ho);const r=this.node.parent;t.history.setValue(r,Le,new T().addVectors(this.position0,xf))}else{if(this.action==="swing")Ht(ya,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),ho.copy(this.mouse0).applyMatrix4(this.invMat),Hc.copy(ya).applyMatrix4(this.invMat),xf.subVectors(Hc,ho),Km.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),Qm.subVectors(this.nodeEnd0,this.nodeStart0).add(xf).normalize(),bl.setFromUnitVectors(Km,Qm);else if(Math.acos(Math.abs(this.boneAxis.dot(i.mouseRayN)))*180/Math.PI>45){if(!Ht(ya,i.mouseRay0,i.mouseRay1,this.origin,i.mouseRayN))return;wl.crossVectors(this.boneAxis,i.mouseRayN).normalize();const l=this.mouse0.distanceTo(this.origin),c=.4,h=-xf.subVectors(ya,this.mouse0).dot(wl)/l*Math.PI/2*c;wl.copy(this.boneAxis).transformDirection(this.invMat),bl.setFromAxisAngle(wl,h)}else{if(!Ht(ya,i.mouseRay0,i.mouseRay1,this.origin,this.boneAxis))return;ho.copy(this.mouse0).applyMatrix4(this.invMat),Hc.copy(ya).applyMatrix4(this.invMat),Ty.copy(this.origin).applyMatrix4(this.invMat),Km.subVectors(ho,Ty).normalize(),Qm.subVectors(Hc,Ty).normalize(),wl.copy(this.boneAxis).transformDirection(this.invMat);const l=Tl(wl,Km,Qm);bl.setFromAxisAngle(wl,l)}iE.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(bl),sE.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(bl),Oa(_a,iE,sE);const r=this.node.parent,o=r.children.indexOf(this.node);if(o>0){const l=r.children[o-1];Jm.copy(l.get(xt).quaternion).invert(),_a.multiplyQuaternions(Jm,_a)}let a=!1;switch(this.node.value(cs)){case"horizontal":Wc.set(0,1,0),a=!0;break;case"vertical":Wc.set(0,0,1),a=!0;break}if(a){Jm.copy(_a).invert(),eg.copy(Wc).applyQuaternion(Jm),bl.setFromUnitVectors(Wc,eg),_a.multiply(bl).normalize();let l=Po(eg,_a);const c=Math.sign(eg.dot(Wc)),h=this.node.value(ka);let f=h[0],d=h[1];if(this.node.instanceId&&this.node.has(Un)){const p=this.node.value(Un);switch(this.node.value(cs)){case"horizontal":p.z>1e-6&&([f,d]=[-d,-f]);break;case"vertical":p.y>1e-6&&([f,d]=[-d,-f]);break}}l=kb(l*c,f/180*Math.PI,d/180*Math.PI),_a.setFromAxisAngle(Wc,l)}t.history.setValue(this.node,wn,new lt().setFromQuaternion(_a))}}else this.activeView===i.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let i of this.ikChains)if(!i.deleted)for(let s of i.children){if(s.deleted)continue;s.get(xt).resetHandlers(t)}this.ikChains.length=0}}u($x,"IkRotateTool");ome($x,"IkRotateTool");var ame="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntVEEOwCAIs2b///J2GQkh6VZQD1vsxaClIAFa2/gdzhtmH6qTtwGA8QAg8uVsnu7NTolLxM+K+zJlEpLInvPG79GRdcgUjGTPfKU5iCJ2Kr9NBZhSvlRHCD6dPSxFZdCWBCmLewF12TFIXaGu640SLqrDp4K4/n+JAAAAAElFTkSuQmCC",lme=Object.defineProperty,cme=u((n,e)=>lme(n,"name",{value:e,configurable:!0}),"__name$G");const rE=new T;class Vx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Brush");S(this,"icon",ame);S(this,"sculpt",!0);S(this,"hasDirection",!0);S(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.01,h=new T,f=new T,d=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);for(let p of d.track)this.stroke(p.indices,c,a.getAverageNormal(f,p.triangles),a.getAverageCenter(h,p.triangles),t.sculptLocalRadius,d.offset,d.position),t.sculptSym&&this.stroke(p.indicesSym,c,a.getAverageNormal(f,p.trianglesSym),a.getAverageCenter(h,p.trianglesSym),t.sculptLocalRadius,d.offset,d.position);t.history.updateVertices(r,gn,d.indices,d.position)}stroke(t,i,s,r,o,a,l){r.addScaledVector(s,-o*Math.sign(i)*.5);for(let c of t)this.strokeVertex(s,r,o,i,l,a.get(c))}strokeVertex(t,i,s,r,o,a){rE.fromArray(o,a);const l=rE.distanceTo(i)/s;if(l>=1)return;const c=this.sculptFalloff(l)*r;o[a]+=t.x*c,o[a+1]+=t.y*c,o[a+2]+=t.z*c}}u(Vx,"SculptBrushTool");cme(Vx,"SculptBrushTool");var ume="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntlMEKgDAMQ1Px/39ZLwoSZk2j87K9S2G0SQehwORvtoNu4tda3irbzhK/E+R3W7zSN4i4OsA9sklXcaWZk9NKErNWzc8aEaHMyQaq4CPOHclmlnfrmFR+YV9OJ7KWiXLsMqRksNhniZoAwA6iu8NUWhw/8AAAAABJRU5ErkJggg==",hme=Object.defineProperty,fme=u((n,e)=>hme(n,"name",{value:e,configurable:!0}),"__name$F");const tg=new T,ng=new T;class Gx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Crease");S(this,"icon",ume);S(this,"sculpt",!0);S(this,"hasDirection",!0);S(this,"brushStrength",.25);S(this,"brushStepSpacingRadiusRatio",.1);S(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.1,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),f=new T;for(let d of h.track)this.stroke(d.indices,c,a.getAverageNormal(f,d.triangles),d.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(d.indicesSym,c,a.getAverageNormal(f,d.trianglesSym),d.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,gn,h.indices,h.position)}stroke(t,i,s,r,o,a,l){for(let c of t)this.strokeVertex(s,r,o,i,l,a.get(c))}strokeVertex(t,i,s,r,o,a){tg.fromArray(o,a);const l=tg.distanceTo(i)/s;if(l>=1)return;const c=this.sculptFalloff(l),h=c**5*r*-.01;o[a]+=t.x*h,o[a+1]+=t.y*h,o[a+2]+=t.z*h,tg.fromArray(o,a),ng.subVectors(i,tg);const f=c*r*.1;o[a]+=ng.x*f,o[a+1]+=ng.y*f,o[a+2]+=ng.z*f}}u(Gx,"SculptCreaseTool");fme(Gx,"SculptCreaseTool");var dme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntlMEOwCAIQ2H//8/stMQZcC1gdrE3I7w2RBE5+ltaaTYze8FUczwbNJ5no9kQBkfJSyarQg+M9sJwNAB3Kd/pywZsCBr+1KVM2GdGj4h+xxL/iTaDyGiLiaerA5JaEdvgTGN5nKtlh8Kh/d2294883Y/A1zVqqAZoAAAAAElFTkSuQmCC",pme=Object.defineProperty,mme=u((n,e)=>pme(n,"name",{value:e,configurable:!0}),"__name$E");const oE=new T,Py=new T,Af=new T,ig=new T;class Hx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Drag");S(this,"icon",dme);S(this,"sculpt",!0);S(this,"brushRadius",100);S(this,"brushStrength",1);S(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);S(this,"nodeId",0);S(this,"stroke0");S(this,"mouse0",new T);S(this,"local0",new T);S(this,"invMat",new ve)}begin(t){t.sculptActiveView===-1&&(this.nodeId=0,this.stroke0=void 0)}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh,l=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);if(l.track.length&&(this.nodeId=r.id,this.stroke0=l,this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert()),this.nodeId!==r.id||!this.stroke0||!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}if(!Ht(oE,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN))return;Py.copy(oE).applyMatrix4(this.invMat).sub(this.local0);const c=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(Af.copy(Py),r.value(Li)){case"x":Af.x*=-1;break;case"y":Af.y*=-1;break;case"z":Af.z*=-1;break}const h=t.options.enablePressure?1:s.pressure;this.stroke(this.stroke0.indices,this.brushStrength*h,t.sculptSym,Py,Af,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,c),t.history.updateVertices(r,gn,this.stroke0.indices,c)}stroke(t,i,s,r,o,a,l,c,h,f){for(let d of t)this.strokeVertex(s,r,o,a,l,c,i,f,h.get(d))}strokeVertex(t,i,s,r,o,a,l,c,h){if(ig.fromArray(c,h),t){const f=ig.distanceTo(r)/a,d=ig.distanceTo(o)/a;if(f>=1){if(d>=1)return;const p=this.sculptFalloff(d)*l;c[h]+=s.x*p,c[h+1]+=s.y*p,c[h+2]+=s.z*p}else if(d>=1){const p=this.sculptFalloff(f)*l;c[h]+=i.x*p,c[h+1]+=i.y*p,c[h+2]+=i.z*p}else{const p=1-f+(1-d),g=this.sculptFalloff(f)*l*(1-f)/p,m=this.sculptFalloff(d)*l*(1-d)/p;c[h]+=i.x*g+s.x*m,c[h+1]+=i.y*g+s.y*m,c[h+2]+=i.z*g+s.z*m}}else{const f=ig.distanceTo(r)/a;if(f>=1)return;const d=this.sculptFalloff(f)*l;c[h]+=i.x*d,c[h+1]+=i.y*d,c[h+2]+=i.z*d}}}u(Hx,"SculptDragTool");mme(Hx,"SculptDragTool");var gme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIVJREFUSIntVUEOgCAMo8T/f1kvmujMRjvYSXtCmKVjHbT2owL7iXJiZpPOEl9jAMjJc4itytG3xRaRL1VryZX1KP5Vg1LlIzVRnGfdboMy6mnrqs3j9cV9znURAznbFe1vs3jUAAAym0g2nQUlUskifazMj9M185pHeQ8om1my0qvkezgA21OnjKJcGJgAAAAASUVORK5CYII=",vme=Object.defineProperty,yme=u((n,e)=>vme(n,"name",{value:e,configurable:!0}),"__name$D");const Ry=new T,_me=new T;class Wx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Flatten");S(this,"icon",gme);S(this,"sculpt",!0);S(this,"brushStrength",.2);S(this,"hasDirection",!0);S(this,"hasThirdDirection",!0);S(this,"brushDirection",0);S(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh,l=new T,c=new T,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),f=t.options.enablePressure?1:s.pressure;for(let d of h.track)this.stroke(d.indices,this.brushStrength*f,a.getAverageNormal(c,d.triangles),a.getAverageCenter(l,d.triangles),d.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(d.indicesSym,this.brushStrength*f,a.getAverageNormal(c,d.trianglesSym),a.getAverageCenter(l,d.trianglesSym),d.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,gn,h.indices,h.position)}stroke(t,i,s,r,o,a,l,c){for(let h of t)this.strokeVertex(s,r,o,a,i,c,l.get(h))}strokeVertex(t,i,s,r,o,a,l){Ry.fromArray(a,l);const c=Ry.distanceTo(s)/r;if(c>=1)return;const h=_me.subVectors(i,Ry).dot(t);if(this.brushDirection===-Math.sign(h))return;const f=this.sculptFalloff(c)*o*h;a[l]+=t.x*f,a[l+1]+=t.y*f,a[l+2]+=t.z*f}}u(Wx,"SculptFlattenTool");yme(Wx,"SculptFlattenTool");var bme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHNJREFUSIntVEEOgDAIW43//zJeXKJkakujB7MegbaMMFqb+D3AFEVEnEgARrljnELsuIrn3KiW7prNUyZSJyrfFc8aiytWdn5FQzVgtmhVBDMAQPoHzohobsXkjvPtFnUoryiPlSHaa/107BgN+1xP2NgAXJmHlymbSbgAAAAASUVORK5CYII=",wme=Object.defineProperty,xme=u((n,e)=>wme(n,"name",{value:e,configurable:!0}),"__name$C");const Iy=new T,Dy=new Set,jc=new T,aE=new T,lE=new T;class jx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Inflate");S(this,"icon",bme);S(this,"sculpt",!0);S(this,"brushStrength",.2);S(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*l*.01,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);for(let f of h.track)this.stroke(a,f.indices,c,f.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(a,f.indicesSym,c,f.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,gn,h.indices,h.position)}stroke(t,i,s,r,o,a,l){for(let c of i)this.strokeVertex(t,c,r,o,s,l,a.get(c))}strokeVertex(t,i,s,r,o,a,l){Iy.fromArray(a,l);const c=Iy.distanceTo(s)/r;if(c>=1)return;jc.set(0,0,0);let h=t.getVertexTriangleIndex(t.edgeNeighborMap[i]);const f=h;let d=50;Dy.clear();do{Dy.add(h),t.getNormal(aE,h),t.getTriangleCenter(lE,h),jc.addScaledVector(aE,Iy.distanceTo(lE));const g=h;for(let m=0;m<3;++m){const v=h*3+m;if(t.holes[v])continue;const y=t.getVertexTriangleIndex(t.edgeNeighborMap[v]);if(h===y||Dy.has(y))continue;let b=!1;for(let _=0;_<3;++_)if(t.sharedVertexMap[y*3+_]===i){b=!0;break}if(b){h=y;break}}if(g===h)break;if(d--<=0){console.warn("Loop limit reached");break}}while(f!==h);jc.normalize();const p=this.sculptFalloff(c)*o;a[l]+=jc.x*p,a[l+1]+=jc.y*p,a[l+2]+=jc.z*p}}u(jx,"SculptInflateTool");xme(jx,"SculptInflateTool");var Ame="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHpJREFUSIntVUkKwDAI1NL/f3l6aS6hLhMNFNq5heAsUYzIDxEBAOtOO8lVtcwXisw4WYJWl7jhCUZn0w0APLn1nmOGmTYiYRLQ5GzNwZKVsOreGoYWAapuVcBDWw+2pnjPFA0wKZb7liksD4W37LLkqdU7k237WL6JC85mj5JuLIckAAAAAElFTkSuQmCC",Mme=Object.defineProperty,Sme=u((n,e)=>Mme(n,"name",{value:e,configurable:!0}),"__name$B");const cE=new T,Ly=new T,Mf=new T,sg=new T;class Xx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Move");S(this,"icon",Ame);S(this,"sculpt",!0);S(this,"brushStrength",1);S(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);S(this,"nodeId",0);S(this,"stroke0");S(this,"mouse0",new T);S(this,"local0",new T);S(this,"invMat",new ve)}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh;if(t.sculptStartThisFrame){if(this.nodeId=r.id,this.stroke0=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert();return}else if(this.nodeId!==r.id){this.nodeId=0,this.stroke0=void 0;return}if(!this.stroke0||!this.stroke0.track.length||!Ht(cE,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN))return;Ly.copy(cE).applyMatrix4(this.invMat).sub(this.local0);const l=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(Mf.copy(Ly),r.value(Li)){case"x":Mf.x*=-1;break;case"y":Mf.y*=-1;break;case"z":Mf.z*=-1;break}const c=t.options.enablePressure?1:s.pressure;this.stroke(this.stroke0.indices,this.brushStrength*c,t.sculptSym,Ly,Mf,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,l),t.history.updateVertices(r,gn,this.stroke0.indices,l)}stroke(t,i,s,r,o,a,l,c,h,f){for(let d of t)this.strokeVertex(s,r,o,a,l,c,i,f,h.get(d))}strokeVertex(t,i,s,r,o,a,l,c,h){if(sg.fromArray(c,h),t){const f=sg.distanceTo(r)/a,d=sg.distanceTo(o)/a;if(f>=1){if(d>=1)return;const p=this.sculptFalloff(d)*l;c[h]+=s.x*p,c[h+1]+=s.y*p,c[h+2]+=s.z*p}else if(d>=1){const p=this.sculptFalloff(f)*l;c[h]+=i.x*p,c[h+1]+=i.y*p,c[h+2]+=i.z*p}else{const p=1-f+(1-d),g=this.sculptFalloff(f)*l*(1-f)/p,m=this.sculptFalloff(d)*l*(1-d)/p;c[h]+=i.x*g+s.x*m,c[h+1]+=i.y*g+s.y*m,c[h+2]+=i.z*g+s.z*m}}else{const f=sg.distanceTo(r)/a;if(f>=1)return;const d=this.sculptFalloff(f)*l;c[h]+=i.x*d,c[h+1]+=i.y*d,c[h+2]+=i.z*d}}}u(Xx,"SculptMoveTool");Sme(Xx,"SculptMoveTool");var Cme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIFJREFUSIntVMsOwCAIo/v/f2YnE8MQqMHsYi9GbcsrQeTib6BCUlX9CIGSNjX2zLO/snknLxSx9y3z1UkH8YgVs1KAmcT21mpdfdYGJrEwwBFz1tS2oVT17jCplkZz8BJg55UaVngzHvsAAEPQstBW6MheJFnXs3hUYw2PVnnRgheBggsc8NK3TAAAAABJRU5ErkJggg==",Eme=Object.defineProperty,Tme=u((n,e)=>Eme(n,"name",{value:e,configurable:!0}),"__name$A");const uE=new T,zs=new T,Sf=new T,rg=new $a,hE=new ve;class Yx extends Gn{constructor(){super(...arguments);S(this,"label","Paint");S(this,"icon",Cme);S(this,"tips","Press [P] to pick color");S(this,"sculpt",!0);S(this,"brushRadius",25);S(this,"brushStrength",1);S(this,"hasHardness",!0);S(this,"hasColor",!0);S(this,"frontFacesOnly",!0);S(this,"optionsProps",["brushRadius","brushStrength","brushHardness","frontFacesOnly"])}update(t,i){if(!t.sculptNodeId)return;const s=i.input;if(s.pointerOver&&s.isKeyPressed("p")){const d=t.model.getNode(t.sculptNodeId),g=d.get(Me).mesh;hE.copy(d.getWorldMatrix()).invert(),rg.origin.copy(i.mouseRay0),rg.direction.copy(i.mouseRayN),rg.applyMatrix4(hE);const m=g.raycast(rg,!0)[0];if(m){const v=m.triangleIndex;zs.set(0,0,0),zs.add(Sf.fromArray(g.aColor,v*9)),zs.add(Sf.fromArray(g.aColor,v*9+3)),zs.add(Sf.fromArray(g.aColor,v*9+6)),zs.divideScalar(3),t.options.paintColor=[zs.x,zs.y,zs.z]}return}if(t=t.readonlyRef(),!t.sculptMoved||i.index!==t.sculptActiveView||!s.mouseLeft)return;const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*l,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),f=new Float32Array(h.position);for(let d=0,p=h.indices.length;d<p;++d){const g=h.indices[d];for(let m=0;m<3;++m)f[d*3+m]=a.aColor[g*3+m]}Sf.set(t.options.paintColor[0],t.options.paintColor[1],t.options.paintColor[2]);for(let d of h.track)this.stroke(d.indices,c,d.center,t.sculptLocalRadius,h.offset,h.position,f),t.sculptSym&&this.stroke(d.indicesSym,c,d.centerSym,t.sculptLocalRadius,h.offset,h.position,f);t.history.updateVertices(r,yr,h.indices,f)}stroke(t,i,s,r,o,a,l){for(let c of t)this.strokeVertex(s,r,i,a,l,o.get(c))}strokeVertex(t,i,s,r,o,a){uE.fromArray(r,a);const l=uE.distanceTo(t)/i;if(l>=1)return;const h=Math.pow(1-l,2*(1-this.brushHardness))*s;zs.fromArray(o,a).lerp(Sf,h),o[a]=zs.x,o[a+1]=zs.y,o[a+2]=zs.z}}u(Yx,"SculptPaintTool");Tme(Yx,"SculptPaintTool");var Pme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIJJREFUSIntVUEOwCAIk2X//zI7kbiFxpbhzZ4US2tEcYyDBUxNcHd/CZjJGrR4xAItwplgjGWT1c4yYdqEISLOHL8RISvenFguLrOrmLNcepG9LZDDFqhsolyz0hFVHgt6E20GyGiLSYarQ6TUIraJK4m/jxMVTmnPVD/5irV+MgcPCvzbPZirI9cAAAAASUVORK5CYII=",Rme=Object.defineProperty,Ime=u((n,e)=>Rme(n,"name",{value:e,configurable:!0}),"__name$z");const Oy=new T,og=new T;class qx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Pinch");S(this,"icon",Pme);S(this,"sculpt",!0);S(this,"hasDirection",!0);S(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Me).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.1,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);for(let f of h.track)this.stroke(f.indices,c,f.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(f.indicesSym,c,f.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,gn,h.indices,h.position)}stroke(t,i,s,r,o,a){for(let l of t)this.strokeVertex(s,r,i,a,o.get(l))}strokeVertex(t,i,s,r,o){Oy.fromArray(r,o);const a=Oy.distanceTo(t)/i;if(a>=1)return;og.subVectors(t,Oy);const l=this.sculptFalloff(a)*s;r[o]+=og.x*l,r[o+1]+=og.y*l,r[o+2]+=og.z*l}}u(qx,"SculptPinchTool");Ime(qx,"SculptPinchTool");var Dme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHxJREFUSIntVMsOgDAIG8b//2W8zGRBgcrD03pcoAVWGGNDgJn5V5GjW+xEgmTbRESogBl4E0tC+R4q4MtnrbE80Ubu5mfJwwLWGNLkGvGao83+4Q7PAVoR5c5BUbbJcHGRLqyc9lv0iugulIukTaF5G7o3E9DZzZzrDRcXkCuzdkeSNcIAAAAASUVORK5CYII=",Lme=Object.defineProperty,Ome=u((n,e)=>Lme(n,"name",{value:e,configurable:!0}),"__name$y");const Xc=new T,Cf=new T,ky=new Set;class Zx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Smooth (Shift)");S(this,"icon",Dme);S(this,"sculpt",!0);S(this,"brushStrength",1);S(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,i){t=t.readonlyRef(),!(!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView||!i.input.mouseLeft)&&this.doStroke(t,i)}doStroke(t,i){const s=t.model.getNode(t.sculptNodeId),o=s.get(Me).mesh,a=this.sculptPickStrokeVertices(t,s,i,o,this.frontFacesOnly),l=t.options.enablePressure?1:i.input.pressure;for(let c of a.track)this.stroke(o,c.indices,this.brushStrength*l,c.center,t.sculptLocalRadius,a.offset,a.position),t.sculptSym&&this.stroke(o,c.indicesSym,this.brushStrength*l,c.centerSym,t.sculptLocalRadius,a.offset,a.position);t.history.updateVertices(s,gn,a.indices,a.position)}stroke(t,i,s,r,o,a,l){for(let c of i)this.strokeVertex(t,c,r,o,s,l,a.get(c))}strokeVertex(t,i,s,r,o,a,l){Xc.fromArray(a,l);const c=Xc.distanceTo(s)/r;if(c>=1)return;let h=t.getVertexTriangleIndex(t.edgeNeighborMap[i]);const f=h;let d=0,p=0,g=0,m=0,v=50;ky.clear();do{ky.add(h);for(let _=0;_<3;++_){const x=t.sharedVertexMap[h*3+_];if(x!==i){t.getVertex(Cf,x);const w=Cf.distanceTo(Xc);d+=Cf.x*w,p+=Cf.y*w,g+=Cf.z*w,m+=w}}const b=h;for(let _=0;_<3;++_){const x=h*3+_;if(t.holes[x])continue;const w=t.getVertexTriangleIndex(t.edgeNeighborMap[x]);if(h===w||ky.has(w))continue;let M=!1;for(let C=0;C<3;++C)if(t.sharedVertexMap[w*3+C]===i){M=!0;break}if(M){h=w;break}}if(b===h)break;if(v--<=0){console.warn("Loop limit reached");break}}while(f!==h);if(m=1/m,!isFinite(m))return;d*=m,p*=m,g*=m;const y=this.sculptFalloff(c)*o;a[l]+=(d-Xc.x)*y,a[l+1]+=(p-Xc.y)*y,a[l+2]+=(g-Xc.z)*y}}u(Zx,"SculptSmoothTool");Ome(Zx,"SculptSmoothTool");var kme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAH1JREFUSIntlEEWwDAEROnr/a+sq2xSw6jaZZbCJ0FEjqZlZhad619wVXVZVIK9SgQrJ1hgBGRukMKRfT9H9gtBvIqyhnp+rwQILsI/Q+jHVrl8l+gAFs7q7gSXp+jLDUoxnSca7UMU4+7BuKqjOpakPdZoiSrLNf5dH6V6APeKi6uPxERhAAAAAElFTkSuQmCC",Nme=Object.defineProperty,Fme=u((n,e)=>Nme(n,"name",{value:e,configurable:!0}),"__name$x");const Yc=new ve,fE=new T,dE=new je,pE=new T;class Kx extends Gn{constructor(){super(...arguments);S(this,"label","Sculpt Transform");S(this,"icon",kme);S(this,"node",null);S(this,"invMat",new ve)}begin(t){this.node=null;for(let i of t.model.getSelectedNodes())if(i.type==="Clay"&&!i.instanceId){this.node=i;break}if(!this.node){for(let i of t.views)i.gizmoEnabled=!1,i.gizmo.visible=!1,i.gizmo.dragging=!1;return}}update(t,i){if(this.node&&(i.gizmoEnabled=!0,i.gizmo.visible=!0,i.gizmo.orientation=t.options.useLocalSpaceForTransformControl?"local":"world",i.gizmo.enableTranslate=!0,i.gizmo.enableRotate=!0,i.gizmo.enableScale=!0,i.gizmo.dragging||(i.gizmo.setTargetTransformFromMatrix(this.node.getWorldMatrix()),this.invMat.copy(this.node.getParentWorldMatrix()).invert()),i.gizmo.update(i.camera,i.raycaster,i.input,i.mouseRay0,i.mouseRay1,i.mouseRayN),i.gizmo.dragging)){Yc.compose(i.gizmo.position1,i.gizmo.rotation1,i.gizmo.scale1),Yc.multiplyMatrices(this.invMat,Yc),Yc.decompose(fE,dE,pE);const r=this.node;t.history.setValue(r,Le,new T().copy(fE)),t.history.setValue(r,Qe,new lt().setFromQuaternion(dE)),t.model.setValue(r,_r,new T().copy(pE)),t.throttle(`#${r.id}-apply-transform`,100,()=>{if(r.deleted)return;Yc.copy(r.getLocalMatrix());const o=r.cloneValue(gn),a=new T;for(let l=0,c=o.length;l<c;l+=3)a.fromArray(o,l),a.applyMatrix4(Yc),o[l]=a.x,o[l+1]=a.y,o[l+2]=a.z;t.history.setValue(r,gn,o),t.history.setValue(r,Le,new T),t.history.setValue(r,Qe,new lt),t.history.setValue(r,Ft,1),t.nextFrameEnd(()=>{r.deleted||t.model.setValue(r,_r,new T(1,1,1))})});return}const s=i.input;if(s.pointerOver&&s.mouseLeftDownThisFrame)for(let r of i.mousePick()){const o=r.object.userData.node;if(o&&!o.instanceId&&o.type==="Clay"){t.model.selected=[o.id];break}}}onUnselected(t){for(let i of t.views)i.gizmoEnabled=!1,i.gizmo.visible=!1,i.gizmo.dragging=!1;this.node=null}}u(Kx,"SculptTransformTool");Fme(Kx,"SculptTransformTool");var zme=Object.defineProperty,Bme=u((n,e)=>zme(n,"name",{value:e,configurable:!0}),"__name$w");const lA=class extends Gn{constructor(){super(...arguments);S(this,"icon","");S(this,"label","");S(this,"sep",!0)}};let Eo=lA;u(Eo,"ToolSeperator"),S(Eo,"instance",new lA);Bme(Eo,"ToolSeperator");var Ume="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGRJREFUSIntlMESABAIROX//znXGKJajBl7JG8LldLXbZG2ycxcBROp8Sa18NEaDA4zWQFYTHIoG49Ws3NfleXgdpPQgx8zQf8qFwDSgLNq3uhyCdo6q0bAnkF4/EoodJx/wVQASvh7kexwAhUAAAAASUVORK5CYII=",$me=Object.defineProperty,Vme=u((n,e)=>$me(n,"name",{value:e,configurable:!0}),"__name$v");const xs=new T,mE=new T,fo=new T,gE=new je,vE=new T(1,0,0),po=new ve,yE=.003,_E=.003,bE=5,Ny=.05;class Qx extends Gn{constructor(){super(...arguments);S(this,"label","Tube");S(this,"icon",Ume);S(this,"tips","Hold [Alt] to create/insert a tube node. Resize tube node with mouse wheel.");S(this,"enableDefaultDeleteShortcut",!1);S(this,"enableSelectionRect",!0);S(this,"enableDefaultSelectionBehavior",!1);S(this,"nodes",[]);S(this,"enableDeleteThisFrame",!0);S(this,"dragging",!1);S(this,"draggingActiveViewIndex",-1);S(this,"mouse0",new T);S(this,"circle",new js(new p1,new Di({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16711935})));S(this,"line1",new js(new it().setFromPoints([new T(0,0,0),new T(1,0,0)]),this.circle.material.clone()));S(this,"line2",new js(this.line1.geometry.clone(),this.line1.material.clone()));S(this,"creating",!1);S(this,"radius",.1);S(this,"lastNodeId",0)}setup(t){this.circle.visible=!1,t.scene.add(this.circle),this.line1.visible=!1,t.scene.add(this.line1),this.line2.visible=!1,t.scene.add(this.line2)}begin(t){t=t.readonlyRef();for(let i of this.nodes){if(i.deleted)continue;const s=i.get(ft);s.group&&(s.group.visible=!1),t.model.selected.includes(i.id)?s.selected=s.selected.filter(r=>r<s.value.length):s.selected.length=0}this.enableDefaultDeleteShortcut=!0,this.enableDeleteThisFrame=!0,this.nodes=t.model.getSelectedNodes().filter(i=>i.has(ft)&&!i.instanceId);for(let i of this.nodes){const s=i.get(ft);s.group&&(s.group.visible=!0),s.hovered=-1,s.selected.length&&(this.enableDefaultDeleteShortcut=!1),i.id===this.lastNodeId&&s.value.length&&(s.selected=[0],this.lastNodeId=0)}this.enableSelectionRect=!0,this.creating||(this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1,this.lastNodeId=0)}update(t,i){const s=i.input;if(s.isKeyPressed("Delete")&&this.enableDeleteThisFrame){this.enableDeleteThisFrame=!1;for(let r of this.nodes){const o=r.get(ft);if(o.selected.length){const a=o.clone().filter((l,c)=>!o.selected.includes(c));o.selected.length=0,a.length===0?t.history.removeNode(r.id):t.history.setValue(r,ft,a)}}return}if(this.dragging&&i.index===this.draggingActiveViewIndex)if(this.enableSelectionRect=!1,s.mouseLeft){if(Ht(mE,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN)){fo.subVectors(mE,this.mouse0);let r=!0;for(let o of this.nodes){const a=o.get(ft);if(a.draggingStartNodeIndex>=0){r=a.selected.includes(a.draggingStartNodeIndex);break}}for(let o of this.nodes){const a=o.get(ft);if(a.selected.length||a.draggingStartNodeIndex>=0){const l=a.clone(a.draggingStartValue);if(r)for(let c of a.selected)l[c].position.applyMatrix4(a.draggingStartMatrix).add(fo).applyMatrix4(a.draggingStartInvMatrix),s.isKeyPressed("Shift")&&bu(l[c].position,Ny);a.draggingStartNodeIndex>=0&&!r&&(l[a.draggingStartNodeIndex].position.applyMatrix4(a.draggingStartMatrix).add(fo).applyMatrix4(a.draggingStartInvMatrix),s.isKeyPressed("Shift")&&bu(l[a.draggingStartNodeIndex].position,Ny)),t.history.setValue(o,ft,l)}}if(!r)for(let o of this.nodes){const a=o.get(ft);a.draggingStartNodeIndex>=0?a.selected=[a.draggingStartNodeIndex]:a.selected=[]}}}else{this.dragging=!1,this.draggingActiveViewIndex=-1;for(let r of this.nodes){const o=r.get(ft);o.draggingStartNodeIndex=-1}}if(s.pointerOver&&!(this.dragging||this.creating)){let r=!1;for(let o of this.nodes){const a=o.get(ft),l=i.raycaster.intersectObjects(a.pickers);if(l.length){const c=l[0].object.userData.index;if(a.hovered=c==null?-1:c,s.mouseLeftDownThisFrame)this.dragging=!0,this.draggingActiveViewIndex=i.index,this.mouse0.copy(l[0].point),a.draggingStartNodeIndex=a.hovered;else if(s.wheelDetY)for(let h of l){const f=h.object.userData.index;if(f!=null&&a.selected.includes(f)){r=!0;break}}}else a.hovered=-1}if(this.dragging&&i.index===this.draggingActiveViewIndex)for(let o of this.nodes){const a=o.get(ft);(a.selected.length||a.draggingStartNodeIndex>=0)&&(a.draggingStartMatrix=new ve().copy(o.getWorldMatrix()),a.draggingStartInvMatrix=new ve().copy(o.getWorldMatrix()).invert(),a.draggingStartValue=a.clone())}if(r){t.disableCameraDraggingThisFrame=!0;for(let o of this.nodes){const a=o.get(ft);if(a.selected.length){const l=a.clone();for(let c of a.selected)l[c].radius=Math.max(yE,Math.min(bE,l[c].radius-s.wheelDetY*_E));t.history.setValue(o,ft,l)}}}if(!this.dragging&&!this.creating&&s.isKeyPressed("Alt")){this.creating=!0;for(let o of this.nodes){const a=o.get(ft);if(a.selected.length){this.radius=a.value[a.selected[0]].radius,this.radius*=Sa(o.getWorldMatrix());break}}}}if(this.creating)if(s.isKeyPressed("Alt")){if(this.enableSelectionRect=!1,s.pointerOver){let r=null,o=null,a=-1;for(let l of this.nodes){const c=l.get(ft);if(c.selected.length){r=l,o=c,a=c.selected[0];break}}if(r)xs.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix());else for(let l of t.readonlyRef().model.getSelectedNodes())if(l.isValidChild("Tube")){xs.setFromMatrixPosition(l.getWorldMatrix());break}if(Ht(this.circle.position,i.mouseRay0,i.mouseRay1,xs,i.mouseRayN),s.isKeyPressed("Shift")&&bu(this.circle.position,Ny),s.wheelDetY&&(this.radius=Math.min(bE,Math.max(yE,-s.wheelDetY*_E+this.radius)),t.disableCameraDraggingThisFrame=!0),this.circle.scale.setScalar(this.radius),this.circle.visible=!0,this.line1.visible=!1,this.line2.visible=!1,r&&(this.line1.position.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix()),fo.subVectors(this.circle.position,this.line1.position),this.line1.scale.setScalar(fo.length()),this.line1.quaternion.setFromUnitVectors(vE,fo.normalize()),this.line1.visible=!0,a<o.value.length-1&&(this.line2.position.copy(o.value[a+1].position).applyMatrix4(r.getWorldMatrix()),fo.subVectors(this.circle.position,this.line2.position),this.line2.scale.setScalar(fo.length()),this.line2.quaternion.setFromUnitVectors(vE,fo.normalize()),this.line2.visible=!0,o.lines[a].visible=!1,t.nextFrameEnd(()=>{const l=o==null?void 0:o.lines[a];l&&(l.visible=!0)}))),s.mouseLeftDownThisFrame){xs.copy(this.circle.position);let l=this.radius;if(!r&&this.nodes.length&&this.nodes[0].value(ft).length===0&&(r=this.nodes[0]),r){po.copy(r.getWorldMatrix()).invert(),xs.applyMatrix4(po),l*=Sa(po);let c;o?(c=o.clone(),c.splice(a+1,0,{position:new T().copy(xs),radius:l}),o.selected=[a+1]):(c=[{position:new T().copy(xs),radius:l}],this.lastNodeId=r.id),t.history.setValue(r,ft,c)}else{let c=null;if(this.nodes.length)c=this.nodes[0].parent;else for(let f of t.model.getSelectedNodes())if(f.isValidChild("Tube")){c=f;break}if(!c){for(let f of t.model.getSelectedNodes())if(f.isValidChild("Shape")){c=f;break}c&&(po.copy(c.getWorldMatrix()).invert(),xs.applyMatrix4(po),l*=Sa(po)),t.model.selected=[],this.lastNodeId=t.history.createNode({type:"Shape",parentId:c?c.id:0,data:{},children:[{type:"Tube",data:{[ft.name]:[{radius:l,position:new T().copy(xs)}]}}]})+1}else c&&(po.copy(c.getWorldMatrix()).invert(),xs.applyMatrix4(po),l*=Sa(po)),t.model.selected=[],this.lastNodeId=t.history.createNode({type:"Tube",parentId:c?c.id:0,data:{[ft.name]:[{radius:l,position:new T().copy(xs)}]}})}this.creating=!1}}}else this.creating=!1;if(t.selectionRectSetThisFrame&&t.selectionRectViewIndex===i.index)if(t.selectionStart.equals(t.selectionEnd)){let r=!1;for(let o of this.nodes){const a=o.get(ft);a.selected.length&&(r=!0),a.selected.includes(a.hovered)?s.isKeyPressed("Control")&&(a.selected=a.selected.filter(l=>l!==a.hovered),r=!0):(s.isKeyPressed("Control")||(a.selected.length=0),a.hovered>=0&&(a.addSelection(a.hovered),r=!0))}if(!r){const o=i.mousePick("Shape");let a=null;for(let l of o){const c=o[0].object.userData.node;if(c){a=c;break}}a?t.model.selected=a.children.map(l=>l.id):t.model.selected=[]}}else{const r=i.camera.get();for(let o of this.nodes){const a=o.get(ft);s.isKeyPressed("Control")||(a.selected.length=0);for(let l of a.pickers)if(xs.setFromMatrixPosition(l.matrixWorld).project(r),lR(xs,t.selectionStart,t.selectionEnd)){const c=l.userData.index;c!=null&&a.addSelection(c)}}}}end(t){for(let i of this.nodes)i.get(ft).updateColor()}beforeRender(t,i){for(let s of this.nodes){const r=s.get(ft);oR(gE,s.getWorldMatrix()).invert();for(let o of r.circles)o.quaternion.copy(gE).multiply(i.camera.get().quaternion)}this.circle.visible&&this.circle.quaternion.copy(i.camera.get().quaternion)}onUnselected(t){this.dragging=!1,this.creating=!1,this.lastNodeId=0,this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1;for(let i of this.nodes){if(i.deleted)continue;const s=i.get(ft);s.group&&(s.group.visible=!1),s.selected.length=0}this.nodes.length=0}}u(Qx,"TubeTool");Vme(Qx,"TubeTool");var Gme=Object.defineProperty,Hme=u((n,e)=>Gme(n,"name",{value:e,configurable:!0}),"__name$u");const Fy=new Hd,qc=new T,Zc=new T,rr=new T,mo=new T,Tr=new T,go=new T,vo=new T,Ef=new T,Tf=new T,Pf=new T,ag=new T,Rf=new T,If=new T,Df=new T,wE=new ve,Wme=new je,jme=new T;class Jx{constructor(){S(this,"dom");S(this,"parent");S(this,"x0",0);S(this,"y0",0);S(this,"x1",0);S(this,"y1",0);const e=this.dom=document.createElement("div");e.style.pointerEvents="none",e.style.position="absolute",e.style.zIndex="20",e.style.border="dashed 1px #fff",e.style.background="rgba(255, 255, 255, .1)",e.style.boxSizing="border-box"}attach(e){this.parent=e,e.appendChild(this.dom)}detach(){this.parent=void 0,this.dom.remove()}show(){this.dom.style.display="block"}hide(){this.dom.style.display="none"}setPoint1(e,t){this.x0=e,this.y0=t}setPoint2(e,t){if(this.x1=e,this.y1=t,!this.parent)return;const i=(this.x0+1)/2,s=(this.x1+1)/2,r=(this.y0+1)/2,o=(this.y1+1)/2,a=this.parent.getBoundingClientRect(),l=Math.round(a.width*Math.max(Math.min(i,s),0)),c=Math.round(a.width*Math.min(1-Math.max(i,s),1)),h=Math.round(a.height*Math.max(1-Math.max(r,o),0)),f=Math.round(a.height*Math.min(r,o,1));this.dom.style.left=`${l}px`,this.dom.style.right=`${c}px`,this.dom.style.top=`${h}px`,this.dom.style.bottom=`${f}px`,i!==s||r!==o?this.show():this.hide()}select(e,t){let i=this.x0,s=this.y0,r=this.x1,o=this.y1;i===r&&(r+=Number.EPSILON),s===o&&(o+=Number.EPSILON);const a=0,l=1,c=Number.MAX_VALUE;if(e.updateProjectionMatrix(),e.updateMatrixWorld(),e.isPerspectiveCamera){Zc.set(i,s,a),Zc.x=Math.min(i,r),Zc.y=Math.max(s,o),r=Math.max(i,r),o=Math.min(s,o),rr.setFromMatrixPosition(e.matrixWorld),mo.copy(Zc),Tr.set(r,Zc.y,0),go.set(r,o,l),vo.set(Zc.x,o,0),mo.unproject(e),Tr.unproject(e),go.unproject(e),vo.unproject(e),Rf.copy(mo).sub(rr),If.copy(Tr).sub(rr),Df.copy(go).sub(rr),Rf.normalize(),If.normalize(),Df.normalize(),Rf.multiplyScalar(c),If.multiplyScalar(c),Df.multiplyScalar(c),Rf.add(rr),If.add(rr),Df.add(rr);const d=Fy.planes;d[0].setFromCoplanarPoints(rr,mo,Tr),d[1].setFromCoplanarPoints(rr,Tr,go),d[2].setFromCoplanarPoints(go,vo,rr),d[3].setFromCoplanarPoints(vo,mo,rr),d[4].setFromCoplanarPoints(Tr,go,vo),d[5].setFromCoplanarPoints(Df,If,Rf),d[5].normal.multiplyScalar(-1)}else if(e.isOrthographicCamera){const d=Math.min(i,r),p=Math.max(s,o),g=Math.max(i,r),m=Math.min(s,o);mo.set(d,p,-1),Tr.set(g,p,-1),go.set(g,m,-1),vo.set(d,m,-1),Ef.set(d,p,1),Tf.set(g,p,1),Pf.set(g,m,1),ag.set(d,m,1),mo.unproject(e),Tr.unproject(e),go.unproject(e),vo.unproject(e),Ef.unproject(e),Tf.unproject(e),Pf.unproject(e),ag.unproject(e);const v=Fy.planes;v[0].setFromCoplanarPoints(mo,Ef,Tf),v[1].setFromCoplanarPoints(Tr,Tf,Pf),v[2].setFromCoplanarPoints(Pf,ag,vo),v[3].setFromCoplanarPoints(ag,Ef,mo),v[4].setFromCoplanarPoints(Tr,go,vo),v[5].setFromCoplanarPoints(Pf,Tf,Ef),v[5].normal.multiplyScalar(-1)}const h=[],f={};for(let d of t)this.searchChildInFrustum(h,f,Fy,d);return h}searchChildInFrustum(e,t,i,s){if(s.isMesh||s.isLine||s.isPoints)if(s.isInstancedMesh){const r=s;t[r.uuid]=[];for(let o=0;o<r.count;o++)r.getMatrixAt(o,wE),wE.decompose(qc,Wme,jme),qc.applyMatrix4(r.matrixWorld),i.containsPoint(qc)&&t[r.uuid].push(o)}else{const r=s;r.geometry.boundingSphere===null&&r.geometry.computeBoundingSphere(),qc.copy(r.geometry.boundingSphere.center),qc.applyMatrix4(s.matrixWorld),i.containsPoint(qc)&&e.push(s)}if(s.children.length>0)for(let r=0;r<s.children.length;r++)this.searchChildInFrustum(e,t,i,s.children[r])}}u(Jx,"SelectionRect");Hme(Jx,"SelectionRect");var Xme=Object.defineProperty,Yme=u((n,e)=>Xme(n,"name",{value:e,configurable:!0}),"__name$t");class cp{constructor(e,t,i,s,r){S(this,"systems",[new Pw,new vx([new rx,new ax,new Vw,new sx,new Lw,new dx,new gx,new zw,new cx,new Bw,new Uw,new ux,new mx,new px,new ox,new lx,new fx]),new yx,new wx,new Rw,new Iw,new Dw,new _x,new bx,new aw,new ow]);S(this,"sculptSmoothTool",new Zx);S(this,"tools",[new lp,new Px,Eo.instance,new $x,new Ux,Eo.instance,new Rx,new Ix,Eo.instance,new ap,new Qx,Eo.instance,new Vx,new jx,new Gx,new qx,new Wx,new Xx,new Hx,this.sculptSmoothTool,new Kx,new Yx]);S(this,"sculptNodeId",0);S(this,"sculptActiveView",-1);S(this,"sculptSym",!1);S(this,"sculptLocalRadius",0);S(this,"sculptMoved",!1);S(this,"sculptStartThisFrame",!1);S(this,"sculptAccWalkedPixels",0);S(this,"sculptX0",0);S(this,"sculptY0",0);S(this,"sculptX1",0);S(this,"sculptY1",0);S(this,"canvas");S(this,"renderer");S(this,"composer");S(this,"renderPass");S(this,"outlinePass");S(this,"scene",new bd);S(this,"views");S(this,"mainViewIndex");S(this,"disableCameraDraggingThisFrame",!1);S(this,"selectionRect",new Jx);S(this,"selectionRectDragging",!1);S(this,"selectionRectViewIndex",-1);S(this,"selectionRectSetThisFrame",!1);S(this,"selectionStart",new ke);S(this,"selectionEnd",new ke);S(this,"model",new qd);S(this,"history",new rw(this.model));S(this,"fps",0);S(this,"detSec",0);S(this,"lastTimestamp",0);S(this,"statusBarMessage","");S(this,"tool",this.tools[0]);S(this,"nextFrameCallbacks",[]);S(this,"throttleTasks",new Map);S(this,"options",new Lb);this.history.setup(),this.canvas=e,this.renderer=new TP({canvas:e}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=tP,this.mainViewIndex=1,this.views=[new cu(this,0,t,-Math.PI/2,-Math.PI/2,!1),new cu(this,1,i,-Math.PI/8,-Math.PI/4,!0),new cu(this,2,s,0,-Math.PI/2,!1),new cu(this,3,r,0,0,!1)],this.composer=new iR(this.renderer),this.renderPass=new rR(this.scene,this.views[this.mainViewIndex].camera.get()),this.composer.addPass(this.renderPass),this.outlinePass=new zr(new ke,this.scene,this.renderPass.camera),this.outlinePass.visibleEdgeColor.setHex(15964205),this.composer.addPass(this.outlinePass);for(let o of this.systems)o.setup(this);for(let o of this.tools)o.setup(this)}dispose(){this.history.unload();for(let e of this.views)e.dispose();for(let e of this.systems)e.dispose();for(let e of this.tools)e.dispose();this.renderer.dispose()}update(){const e=Date.now();this.detSec=(e-this.lastTimestamp)/1e3,this.fps=Math.floor(1/this.detSec),this.lastTimestamp=e;for(let t=0;t<this.views.length;++t){const i=this.views[t];if(i.enabled=t===this.mainViewIndex||this.options.quadView,t===this.mainViewIndex){const s=i.camera;s.perspective=this.model.cameraPerspective&&(Math.abs(s.alpha%(Math.PI/2))>1e-8||Math.abs(s.beta%(Math.PI/2))>1e-8),s.perspectiveCamera.fov=this.model.cameraFov}}for(let t of this.views)t=nt(t),t.enabled&&t.update();for(let t of this.systems)t.update(this);for(let t of this.views)t=nt(t),t.input.update()}reset(){this.views[this.mainViewIndex].camera.alpha=-Math.PI/8,this.views[this.mainViewIndex].camera.beta=-Math.PI/4;for(let e of this.views)e.camera.target.set(0,0,0),e.zoomLevel=0;this.model.reset(),this.history.clear()}readonlyRef(){return nt(this)}nextFrameEnd(e){this.nextFrameCallbacks.push(e)}throttle(e,t,i,s=!1){const r=this.throttleTasks.get(e);r?(s||(r.time=Date.now()+t),r.callback=i):s?(i(),this.throttleTasks.set(e,{time:Date.now()+t,callback:()=>{}})):this.throttleTasks.set(e,{time:Date.now()+t,callback:i})}delayThrottle(e,t){const i=this.throttleTasks.get(e);i&&(i.time=Date.now()+t)}load(e){this.reset();for(let t=0;t<4;++t){const i=e.views[t],s=this.views[t];s.zoomLevel=i.zoomLevel,s.camera.alpha=i.alpha,s.camera.beta=i.beta,s.camera.target.set(...i.target),t===this.mainViewIndex&&(s.camera.perspective=i.perspective,s.camera.perspectiveCamera.fov=i.fov,this.model.cameraPerspective=i.perspective,this.model.cameraFov=i.fov)}this.model.cameras=e.cameras;for(let t of e.nodes){const i=this.model.createNode(t.id,t.type,t.parentId?this.model.getNode(t.parentId):null,null,t.data,t.instanceId);i.expanded=t.expanded}}}u(cp,"EditorContext");Yme(cp,"EditorContext");var qme=Object.defineProperty,Zme=u((n,e)=>qme(n,"name",{value:e,configurable:!0}),"__name$s"),Kme=zt({props:{editorContext:{type:cp,required:!0}},emits:["setData"],setup(n,e){const t=st(function(){return n.editorContext.model.selected.join(",")}),i=st(function(){const r=n.editorContext.model.getSelectedNodes();if(!r.length)return[];const o=[],a=new Set;let l=r[0];const c=Kn(l.type);for(let h of c.components)Ki(h.name).inputComponent&&a.add(h.name);for(let h=1,f=r.length;h<f;++h){let d=r[h];const p=Kn(d.type),g=new Set;for(let m of p.components)Ki(m.name).inputComponent&&g.add(m.name);for(let m of a)g.has(m)||a.delete(m)}for(let h of a){const f=Ki(h);let d;l.instanceId&&!f.instanceable?d=n.editorContext.model.getNode(l.instanceId).value(f.constructor):d=l.value(f.constructor),o.push({name:h,componentClass:f.constructor,label:f.label||h,inlineLabel:f.inlineLabel||!1,inputComponent:f.inputComponent,inputComponentProps:f.inputComponentProps,value:d})}return o});function s(r,o){e.emit("setData",n.editorContext.model.getSelectedNodes().map(a=>({node:a,type:r,value:o})))}return u(s,"onInput"),Zme(s,"onInput"),{key:t,properties:i,onInput:s}}});function Qme(n,e,t,i,s,r){return Ce(),Be("div",{class:"properties",key:n.key},[(Ce(!0),Be(Nt,null,Ta(n.properties,o=>(Ce(),Be("div",{class:bn(["property",{inline:o.inlineLabel}])},[ue("label",null,Tn(o.label),1),(Ce(),sn(HN(o.inputComponent),FT({class:"value",value:o.value,onInput:a=>n.onInput(o.componentClass,a)},o.inputComponentProps),null,16,["value","onInput"]))],2))),256))])}u(Qme,"_sfc_render$b");var Jme=Wt(Kme,[["render",Qme]]),ege=Object.defineProperty,tge=u((n,e)=>ege(n,"name",{value:e,configurable:!0}),"__name$r");class eA{constructor(){S(this,"parent");S(this,"subMenu")}}u(eA,"PopupMenuItemContext");tge(eA,"PopupMenuItemContext");var nge=Object.defineProperty,xE=u((n,e)=>nge(n,"name",{value:e,configurable:!0}),"__name$q"),ige=zt({props:{title:String,icon:String,hotkey:String,disabled:Boolean,sep:Boolean,popup:Boolean,checked:Boolean},setup(n,e){const t=Ge(),i=st(function(){return!!e.slots.default}),s=new eA;vu("popupMenuItemContext",s),s.parent=Ii("popupMenuContext",null)||void 0;function r(){var a;(a=s.parent)==null||a.handleMenuItemMouseOver(s,t.value)}u(r,"onMouseOver"),xE(r,"onMouseOver");function o(a){var l;n.disabled||n.sep||i.value||(l=s.parent)==null||l.hideAll()}return u(o,"onClick"),xE(o,"onClick"),{menuItem:t,hasChild:i,onMouseOver:r,onClick:o}}});const sge=["src"],rge={class:"title"},oge={key:0,class:"hotkey"};function age(n,e,t,i,s,r){return Ce(),Be("div",{class:bn(["popup-menu-item",{"has-child":n.hasChild,disabled:n.disabled,sep:n.sep,popup:n.popup}]),ref:"menuItem",onMouseover:e[0]||(e[0]=Fn((...o)=>n.onMouseOver&&n.onMouseOver(...o),["stop"])),onClick:e[1]||(e[1]=(...o)=>n.onClick&&n.onClick(...o))},[n.sep?tt("",!0):(Ce(),Be(Nt,{key:0},[ue("div",{class:bn(["icon",{checked:n.checked,img:!!n.icon}])},[n.icon&&!n.checked?(Ce(),Be("img",{key:0,src:n.icon,alt:""},null,8,sge)):tt("",!0)],2),ue("div",rge,Tn(n.title),1),n.hotkey?(Ce(),Be("div",oge,Tn(n.hotkey),1)):tt("",!0),dd(n.$slots,"default",{},void 0,!0)],64))],34)}u(age,"_sfc_render$a");var qO=Wt(ige,[["render",age],["__scopeId","data-v-4eb751b0"]]),lge=Object.defineProperty,or=u((n,e)=>lge(n,"name",{value:e,configurable:!0}),"__name$p"),cge=zt({name:"model-tree-node",props:{model:{type:qd,required:!0},node:{type:Bl,required:!0},depth:{type:Number,required:!0},draggingNode:Bl,dragOverNode:Bl,dropPosition:String},emits:["setValue","setSelection","dragStart","dragOver","contextmenu","rangeSelect"],setup(n,e){const t=Ge(),i=st(function(){const _=n.node;return(_.has(Rt)?_.value(Rt):"")||`${Kn(_.type).label} #${_.id}`}),s=st(function(){return Kn(n.node.type).icon}),r=st(function(){return n.node.has(ht)}),o=st(function(){return r.value&&n.node.value(ht)});function a(_,x,w){e.emit("setValue",_,x,w)}u(a,"onSetValue"),or(a,"onSetValue");function l(){a(n.node,ht,!o.value)}u(l,"toggleVisible"),or(l,"toggleVisible");function c(){n.node.expanded=!n.node.expanded}u(c,"toggleExpanded"),or(c,"toggleExpanded");function h(_){e.emit("setSelection",_)}u(h,"onSetSelection"),or(h,"onSetSelection");function f(_){const x=n.node.id;if(_.ctrlKey){const w=n.model.selected;w.includes(x)?e.emit("setSelection",w.filter(M=>M!==x)):e.emit("setSelection",[...w,x])}else _.shiftKey?b(x):e.emit("setSelection",[x])}u(f,"onNodeClick"),or(f,"onNodeClick");function d(_){if(!_.shiftKey){if(!n.model.selected.includes(n.node.id)){if(_.ctrlKey)return;e.emit("setSelection",[n.node.id])}g(n.node)}}u(d,"onMouseDown"),or(d,"onMouseDown");function p(_){if(n.draggingNode&&t.value){const x=t.value.getBoundingClientRect(),w=_.clientY-x.top,M=6;let C=w<=M?"before":w>=x.height-M?"after":"atLast";C==="after"&&n.node.children.length&&n.node.expanded&&(C="atFirst"),e.emit("dragOver",n.node,C)}}u(p,"onMouseMove"),or(p,"onMouseMove");function g(_){e.emit("dragStart",_)}u(g,"onDragStart"),or(g,"onDragStart");function m(_,x){e.emit("dragOver",_,x)}u(m,"onDragOver"),or(m,"onDragOver");const v=st(function(){const _=n.node,x=n.draggingNode===_,w=n.dragOverNode===_,M=n.dropPosition;return{selected:n.model.selected.includes(_.id),dragging:x,"drag-over-before":w&&M==="before","drag-over-inside":w&&(M==="atFirst"||M==="atLast"),"drag-over-after":w&&M==="after",instance:!!_.instanceId}});function y(_,x){e.emit("contextmenu",_,x)}u(y,"onContextMenu"),or(y,"onContextMenu");function b(_){e.emit("rangeSelect",_)}return u(b,"onRangeSelect"),or(b,"onRangeSelect"),{dom:t,name:i,icon:s,hasVisible:r,visible:o,onSetValue:a,toggleVisible:l,toggleExpanded:c,onSetSelection:h,onNodeClick:f,onMouseDown:d,onMouseMove:p,onDragStart:g,onDragOver:m,classnames:v,onContextMenu:y,onRangeSelect:b}}});const uge={class:"visibility"},hge={class:"expand"},fge=["src"],dge={class:"node-name"};function pge(n,e,t,i,s,r){const o=pn("model-tree-node",!0);return Ce(),Be(Nt,null,[ue("div",{class:bn(["model-tree-node",n.classnames]),onMousedown:e[3]||(e[3]=Fn((...a)=>n.onMouseDown&&n.onMouseDown(...a),["left"])),onMousemove:e[4]||(e[4]=(...a)=>n.onMouseMove&&n.onMouseMove(...a)),onContextmenu:e[5]||(e[5]=Fn(a=>n.onContextMenu(n.node,a),["prevent"])),ref:"dom"},[ue("div",uge,[n.hasVisible?(Ce(),Be("div",{key:0,class:bn(["icon",[n.visible?"visible":"invisible"]]),onClick:e[0]||(e[0]=Fn((...a)=>n.toggleVisible&&n.toggleVisible(...a),["stop"]))},null,2)):tt("",!0)]),ue("div",{class:"name",style:ti({"padding-left":`${n.depth*16+2}px`}),onClick:e[2]||(e[2]=(...a)=>n.onNodeClick&&n.onNodeClick(...a))},[ue("div",hge,[n.node.children.length?(Ce(),Be("div",{key:0,class:bn(["icon",[n.node.expanded?"collapse":"expand"]]),onClick:e[1]||(e[1]=Fn((...a)=>n.toggleExpanded&&n.toggleExpanded(...a),["stop"]))},null,2)):tt("",!0)]),ue("img",{class:"node-icon",src:n.icon,alt:""},null,8,fge),ue("span",dge,Tn(n.name),1)],4)],34),n.node.expanded?(Ce(!0),Be(Nt,{key:0},Ta(n.node.children,a=>(Ce(),sn(o,{key:a.id,model:n.model,node:a,depth:n.depth+1,onSetValue:n.onSetValue,onSetSelection:n.onSetSelection,onRangeSelect:n.onRangeSelect,"dragging-node":n.draggingNode,"drag-over-node":n.dragOverNode,"drop-position":n.dropPosition,onDragStart:n.onDragStart,onDragOver:n.onDragOver,onContextmenu:n.onContextMenu},null,8,["model","node","depth","onSetValue","onSetSelection","onRangeSelect","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu"]))),128)):tt("",!0)],64)}u(pge,"_sfc_render$9");var mge=Wt(cge,[["render",pge],["__scopeId","data-v-6a76ea03"]]),gge=Object.defineProperty,hi=u((n,e)=>gge(n,"name",{value:e,configurable:!0}),"__name$o"),vge=zt({components:{PopupMenu:jb,PopupMenuItem:qO,ModelTreeNode:mge},props:{model:{type:qd,required:!0}},emits:["setValue","moveNode","select","focus","cut","copy","paste","delete","convertToClay","applyTransformation","createInstance","flip","copyPose","pastePose"],setup(n,e){const t=Ge();function i(B,W,Z){e.emit("setValue",B,W,Z)}u(i,"onSetValue"),hi(i,"onSetValue");let s=!1;const r=Ge(),o=Ge(),a=Ge("");function l(B){r.value=B,o.value=void 0;const W=hi(function(){r.value!==o.value&&r.value&&o.value&&e.emit("moveNode",o.value,a.value),r.value=void 0,o.value=void 0,document.removeEventListener("mouseup",W)},"onMouseUp");document.addEventListener("mouseup",W)}u(l,"onDragStart"),hi(l,"onDragStart");function c(B,W){B!==o.value&&(s=!0),o.value=B,a.value=W}u(c,"onDragOver"),hi(c,"onDragOver");function h(B){if(s){s=!1;return}e.emit("select",B)}u(h,"onSetSelection"),hi(h,"onSetSelection");function f(B){const W=nt(n.model),Z=new Set(W.selected);if(!Z.size){h([B]);return}const ne=[];let j=!1,ie=!1;W.forEach(K=>{if(j&&ie)return!1;!ie&&Z.has(K.id)&&(ie=!0),K.id===B&&(j=!0),(ie||j)&&ne.push(K.id)}),h(ne)}u(f,"onRangeSelect"),hi(f,"onRangeSelect");const d=Ge();function p(B,W){d.value=B,t.value.show(W.target,{x:W.clientX,y:W.clientY})}u(p,"onContextMenu"),hi(p,"onContextMenu");function g(){e.emit("focus",d.value)}u(g,"onFocus"),hi(g,"onFocus");function m(){e.emit("cut")}u(m,"onCut"),hi(m,"onCut");function v(){e.emit("copy")}u(v,"onCopy"),hi(v,"onCopy");function y(){e.emit("paste",d.value)}u(y,"onPaste"),hi(y,"onPaste");function b(){e.emit("delete")}u(b,"onDelete"),hi(b,"onDelete");const _=st(function(){const B=d.value;return B?Kn(B.type).mesh:!1});function x(){e.emit("convertToClay",d.value)}u(x,"onConvertToClay"),hi(x,"onConvertToClay");const w=st(function(){const B=d.value;return B?!B.instanceId&&B.type==="Clay":!1});function M(){e.emit("applyTransformation",d.value)}u(M,"onApplyTransformation"),hi(M,"onApplyTransformation");const C=st(function(){const B=d.value;if(!B)return!1;const W=Kn(B.type);return!!W.instanceable&&!W.unique}),A=st(function(){const B=d.value;return B?!B.has(Un):!1});function P(B){e.emit("createInstance",d.value,B)}u(P,"onCreateInstance"),hi(P,"onCreateInstance");const D=st(function(){const B=d.value;return B?["Container","IKChain","IKNode"].includes(B.type):!1});function k(B){e.emit("flip",d.value,B)}u(k,"onFlip"),hi(k,"onFlip");const O=st(function(){const B=d.value;return B?["IKChain"].includes(B.type):!1});function N(){e.emit("copyPose",d.value)}u(N,"onCopyPose"),hi(N,"onCopyPose");function E(){e.emit("pastePose",d.value)}return u(E,"onPastePose"),hi(E,"onPastePose"),{contextMenu:t,onSetValue:i,onSetSelection:h,draggingNode:r,dragOverNode:o,dropPosition:a,onDragStart:l,onDragOver:c,onRangeSelect:f,onContextMenu:p,contextMenuNode:d,onFocus:g,onCut:m,onCopy:v,onPaste:y,onDelete:b,canConvertToClay:_,onConvertToClay:x,canApplyTransformation:w,onApplyTransformation:M,canCreateInstance:C,canCreateMirrorInstance:A,onCreateInstance:P,canFlip:D,onFlip:k,hasPose:O,onCopyPose:N,onPastePose:E}}});function yge(n,e,t,i,s,r){const o=pn("model-tree-node"),a=pn("popup-menu-item"),l=pn("popup-menu");return Ce(),Be("div",{class:"model-tree",onClick:e[6]||(e[6]=Fn(c=>n.onSetSelection([]),["left","self"])),onContextmenu:e[7]||(e[7]=Fn(c=>n.onContextMenu(void 0,c),["self","prevent"]))},[(Ce(!0),Be(Nt,null,Ta(n.model.nodes,c=>(Ce(),sn(o,{key:c.id,model:n.model,node:c,depth:0,onSetValue:n.onSetValue,onSetSelection:n.onSetSelection,"dragging-node":n.draggingNode,"drag-over-node":n.dragOverNode,"drop-position":n.dropPosition,onDragStart:n.onDragStart,onDragOver:n.onDragOver,onContextmenu:n.onContextMenu,onRangeSelect:n.onRangeSelect},null,8,["model","node","onSetValue","onSetSelection","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu","onRangeSelect"]))),128)),Ee(l,{ref:"contextMenu"},{default:an(()=>[Ee(a,{title:"Focus",onClick:n.onFocus,disabled:!n.contextMenuNode},null,8,["onClick","disabled"]),n.canFlip?(Ce(),Be(Nt,{key:0},[Ee(a,{title:"Flip",onClick:e[0]||(e[0]=c=>n.onFlip("flip"))}),Ee(a,{title:"Flip Left to Right",onClick:e[1]||(e[1]=c=>n.onFlip("left-to-right"))}),Ee(a,{title:"Flip Right to Left",onClick:e[2]||(e[2]=c=>n.onFlip("right-to-left"))})],64)):tt("",!0),n.canConvertToClay||n.canApplyTransformation||n.canCreateInstance?(Ce(),Be(Nt,{key:1},[Ee(a,{sep:""}),n.canConvertToClay?(Ce(),sn(a,{key:0,title:"Convert to Clay",onClick:n.onConvertToClay},null,8,["onClick"])):tt("",!0),n.canApplyTransformation?(Ce(),sn(a,{key:1,title:"Apply Transformation",onClick:n.onApplyTransformation},null,8,["onClick"])):tt("",!0),n.canCreateInstance?(Ce(),Be(Nt,{key:2},[Ee(a,{title:"Create Shadow Node",onClick:e[3]||(e[3]=c=>n.onCreateInstance("none"))}),n.canCreateMirrorInstance?(Ce(),Be(Nt,{key:0},[Ee(a,{title:"Create Mirror Shadow Node",onClick:e[4]||(e[4]=c=>n.onCreateInstance("z"))}),Ee(a,{title:"Create Vertical Mirror Shadow Node",onClick:e[5]||(e[5]=c=>n.onCreateInstance("y"))})],64)):tt("",!0)],64)):tt("",!0)],64)):tt("",!0),n.hasPose?(Ce(),Be(Nt,{key:2},[Ee(a,{sep:""}),Ee(a,{title:"Copy Pose",onClick:n.onCopyPose},null,8,["onClick"]),Ee(a,{title:"Paste Pose",onClick:n.onPastePose},null,8,["onClick"])],64)):tt("",!0),Ee(a,{sep:""}),Ee(a,{title:"Cut",hotkey:"Ctrl+X",onClick:n.onCut,disabled:!n.model.selected.length},null,8,["onClick","disabled"]),Ee(a,{title:"Copy",hotkey:"Ctrl+C",onClick:n.onCopy,disabled:!n.model.selected.length},null,8,["onClick","disabled"]),Ee(a,{title:"Paste",hotkey:"Ctrl+V",onClick:n.onPaste},null,8,["onClick"]),Ee(a,{title:"Delete",hotkey:"Delete",onClick:n.onDelete,disabled:!n.model.selected.length},null,8,["onClick","disabled"])]),_:1},512)],32)}u(yge,"_sfc_render$8");var _ge=Wt(vge,[["render",yge],["__scopeId","data-v-5aa4f4ef"]]),bge=Object.defineProperty,AE=u((n,e)=>bge(n,"name",{value:e,configurable:!0}),"__name$n"),wge=zt({props:{modal:Boolean,title:String,width:String,height:String,closable:Boolean,visible:Boolean,x:Number,y:Number},emits:["update:visible","update:x","update:y","close"],setup(n,e){const t=Ge(),i=Ge(0),s=Ge(0),r=st(function(){const l={};return l.left=Math.round(i.value)+"px",l.top=Math.round(s.value)+"px",n.width&&(l.width=n.width),n.height&&(l.height=n.height),l});qi([()=>n.x,()=>n.y],function([l,c]){l!=null&&c!=null&&(i.value=l,s.value=c)},{immediate:!0}),qi(()=>n.visible,async function(l){if(l&&(n.x==null||n.y==null)&&(i.value=0,s.value=0,await Vs(),t.value)){const c=document.body.getBoundingClientRect(),h=t.value.getBoundingClientRect();i.value=(c.width-h.width)/2,s.value=(c.height-h.height)/2}},{immediate:!0});function o(){e.emit("update:visible",!1),e.emit("close")}u(o,"close"),AE(o,"close");function a(l){const c=l.clientX,h=l.clientY,f=i.value,d=s.value;Wl(l,p=>{if(t.value){const g=p.clientX-c,m=p.clientY-h,v=document.body.getBoundingClientRect(),y=t.value.getBoundingClientRect();i.value=Math.max(0,Math.min(v.width-y.width,f+g)),s.value=Math.max(0,Math.min(v.height-y.height,d+m)),e.emit("update:x",i.value),e.emit("update:y",s.value)}})}return u(a,"onTitleMouseDown"),AE(a,"onTitleMouseDown"),{dialog:t,style:r,close:o,onTitleMouseDown:a}}});const xge={class:"popup-dialog__title-text"},Age={class:"popup-dialog__body"},Mge={key:0,class:"popup-dialog__buttons"};function Sge(n,e,t,i,s,r){return Ce(),sn(cb,{to:"body"},[ue("div",{class:bn(["popup-dialog__mask",{modal:n.modal,visible:n.visible}])},[ue("div",{class:"popup-dialog",style:ti(n.style),ref:"dialog"},[ue("div",{class:"popup-dialog__title",onPointerdown:e[2]||(e[2]=(...o)=>n.onTitleMouseDown&&n.onTitleMouseDown(...o))},[ue("div",xge,Tn(n.title),1),n.closable?(Ce(),Be("button",{key:0,class:"popup-dialog__btn-close",onMousedown:e[0]||(e[0]=Fn(()=>{},["stop"])),onClick:e[1]||(e[1]=(...o)=>n.close&&n.close(...o))},null,32)):tt("",!0)],32),ue("div",Age,[dd(n.$slots,"default",{},void 0,!0)]),n.$slots.buttons?(Ce(),Be("div",Mge,[dd(n.$slots,"buttons",{},void 0,!0)])):tt("",!0)],4)],2)])}u(Sge,"_sfc_render$7");var g1=Wt(wge,[["render",Sge],["__scopeId","data-v-4be1c5cb"]]),Cge=Object.defineProperty,Ege=u((n,e)=>Cge(n,"name",{value:e,configurable:!0}),"__name$m"),Tge=zt({props:{alpha:Number,beta:Number},emits:["setView"],setup(n,e){const t=st(function(){const s=(n.alpha||0)/Math.PI*180,r=-(n.beta||0)/Math.PI*180-90;return{transform:`rotateX(${s}deg) rotateY(${r}deg)`}});function i(s){e.emit("setView",s)}return u(i,"setView"),Ege(i,"setView"),{cubeStyle:t,setView:i}}});function Pge(n,e,t,i,s,r){return Ce(),Be("div",{class:"view-rotation-handler",onContextmenu:e[6]||(e[6]=Fn(()=>{},["prevent"]))},[ue("div",{class:"cube",style:ti(n.cubeStyle)},[ue("div",{class:"face front",onClick:e[0]||(e[0]=o=>n.setView("front"))},"+Z"),ue("div",{class:"face back",onClick:e[1]||(e[1]=o=>n.setView("back"))},"-Z"),ue("div",{class:"face top",onClick:e[2]||(e[2]=o=>n.setView("top"))},"+Y"),ue("div",{class:"face bottom",onClick:e[3]||(e[3]=o=>n.setView("bottom"))},"-Y"),ue("div",{class:"face right",onClick:e[4]||(e[4]=o=>n.setView("right"))},"+X"),ue("div",{class:"face left",onClick:e[5]||(e[5]=o=>n.setView("left"))},"-X")],4)],32)}u(Pge,"_sfc_render$6");var Rge=Wt(Tge,[["render",Pge],["__scopeId","data-v-308c1057"]]),Ige=Object.defineProperty,ME=u((n,e)=>Ige(n,"name",{value:e,configurable:!0}),"__name$l"),Dge=zt({components:{ViewRotationHandler:Rge},props:{editorContext:cp,quadView:Boolean,mainView:Number},emits:["mounted","beforeUnmount","setView"],setup(n,e){const t=Ge(),i=Ge(),s=Ge(),r=Ge(),o=Ge(),a=Ge(),l=Ge(),c=Ge(),h=Ge(),f=Ge();let d;qi(()=>n.quadView,function(){p()}),m0(function(){p(),d=setInterval(p,50),e.emit("mounted",i.value,l.value,c.value,h.value,f.value)}),Ba(function(){clearInterval(d),e.emit("beforeUnmount")});function p(){const m=t.value.getBoundingClientRect(),v=i.value;(v.width!==m.width||v.height!==m.height)&&(v.width=m.width,v.height=m.height)}u(p,"resize"),ME(p,"resize");function g(m){e.emit("setView",m)}return u(g,"setView"),ME(g,"setView"),{wrapper:t,canvas:i,view1:s,view2:r,view3:o,view4:a,view1Control:l,view2Control:c,view3Control:h,view4Control:f,setView:g}}});const Lge={ref:"canvas"},Oge={class:"view v1",ref:"view1",tabindex:"0"},kge={class:"control",ref:"view1Control"},Nge={class:"view v2",ref:"view2",tabindex:"0"},Fge={class:"control",ref:"view2Control"},zge={class:"view v3",ref:"view3",tabindex:"0"},Bge={class:"control",ref:"view3Control"},Uge={class:"view v4",ref:"view4",tabindex:"0"},$ge={class:"control",ref:"view4Control"};function Vge(n,e,t,i,s,r){const o=pn("view-rotation-handler");return Ce(),Be("div",{class:bn(["canvas-wrapper",{"quad-view":n.quadView}]),ref:"wrapper"},[ue("canvas",Lge,null,512),ru(ue("div",Oge,[ue("div",kge,null,512),n.editorContext?(Ce(),sn(o,{key:0,alpha:n.editorContext.views[0].camera.alpha,beta:n.editorContext.views[0].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[vp,n.quadView||n.mainView===0]]),ru(ue("div",Nge,[ue("div",Fge,null,512),n.editorContext?(Ce(),sn(o,{key:0,alpha:n.editorContext.views[1].camera.alpha,beta:n.editorContext.views[1].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[vp,n.quadView||n.mainView===1]]),ru(ue("div",zge,[ue("div",Bge,null,512),n.editorContext?(Ce(),sn(o,{key:0,alpha:n.editorContext.views[2].camera.alpha,beta:n.editorContext.views[2].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[vp,n.quadView||n.mainView===2]]),ru(ue("div",Uge,[ue("div",$ge,null,512),n.editorContext?(Ce(),sn(o,{key:0,alpha:n.editorContext.views[3].camera.alpha,beta:n.editorContext.views[3].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[vp,n.quadView||n.mainView===3]])],2)}u(Vge,"_sfc_render$5");var Gge=Wt(Dge,[["render",Vge],["__scopeId","data-v-5bd07d3d"]]),Hge=Object.defineProperty,Wge=u((n,e)=>Hge(n,"name",{value:e,configurable:!0}),"__name$k"),jge=zt({props:{width:{type:Number,default:250},minWidth:{type:Number,default:50},maxWidth:{type:Number,default:500},direction:{type:String,default:"left"}},setup(n,e){function t(i){if(i.button!==0)return;const s=n.width,r=i.clientX;Wl(i,function(o){const a=(o.clientX-r)*(n.direction==="left"?-1:1),l=Math.min(Math.max(s+a,n.minWidth),n.maxWidth);e.emit("update:width",l)})}return u(t,"onResize"),Wge(t,"onResize"),{onResize:t}}});const Xge={class:"side-panel-content"};function Yge(n,e,t,i,s,r){return Ce(),Be("div",{class:"side-panel",style:ti({width:`${n.width}px`})},[ue("div",Xge,[dd(n.$slots,"default",{},void 0,!0)]),n.direction==="left"?(Ce(),Be("div",{key:0,class:"resizer-handler left",onPointerdown:e[0]||(e[0]=(...o)=>n.onResize&&n.onResize(...o))},null,32)):tt("",!0),n.direction==="right"?(Ce(),Be("div",{key:1,class:"resizer-handler right",onPointerdown:e[1]||(e[1]=(...o)=>n.onResize&&n.onResize(...o))},null,32)):tt("",!0)],4)}u(Yge,"_sfc_render$4");var qge=Wt(jge,[["render",Yge],["__scopeId","data-v-64397c11"]]),Zge=Object.defineProperty,Kge=u((n,e)=>Zge(n,"name",{value:e,configurable:!0}),"__name$j");function v1(n,e){const t=VT(n);e&&e(t);const i=document.createElement("div");return document.body.appendChild(i),t.mount(i),function(){t.unmount(),i.remove()}}u(v1,"createComponentInstance");Kge(v1,"createComponentInstance");var Qge=Object.defineProperty,Jge=u((n,e)=>Qge(n,"name",{value:e,configurable:!0}),"__name$i"),e0e=zt({components:{PopupDialog:g1},setup(){const n=Ge(!1),e=Ge(""),t=Ii("context",null);t&&(n.value=t.visible,e.value=t.content),qi(n,s=>{s||t==null||t.onCloseCallback()});function i(){n.value=!1}return u(i,"ok"),Jge(i,"ok"),{visible:n,content:e,ok:i}}});const t0e={style:{"white-space":"pre-wrap"}};function n0e(n,e,t,i,s,r){const o=pn("popup-dialog");return Ce(),sn(o,{modal:"",title:"Message",closable:"",visible:n.visible,"onUpdate:visible":e[1]||(e[1]=a=>n.visible=a)},{buttons:an(()=>[ue("button",{onClick:e[0]||(e[0]=(...a)=>n.ok&&n.ok(...a))},"Ok")]),default:an(()=>[ue("div",t0e,Tn(n.content),1)]),_:1},8,["visible"])}u(n0e,"_sfc_render$3");var i0e=Wt(e0e,[["render",n0e]]),s0e=Object.defineProperty,SE=u((n,e)=>s0e(n,"name",{value:e,configurable:!0}),"__name$h"),r0e=zt({components:{PopupDialog:g1},setup(){const n=Ge(!1),e=Ge("");let t=!1;const i=Ii("context",null);i&&(n.value=i.visible,e.value=i.content),qi(n,o=>{o||i==null||i.onCloseCallback(t)});function s(){t=!0,n.value=!1}u(s,"yes"),SE(s,"yes");function r(){n.value=!1}return u(r,"no"),SE(r,"no"),{visible:n,content:e,yes:s,no:r}}});const o0e={style:{"white-space":"pre-wrap"}};function a0e(n,e,t,i,s,r){const o=pn("popup-dialog");return Ce(),sn(o,{modal:"",title:"Confirm",closable:"",visible:n.visible,"onUpdate:visible":e[2]||(e[2]=a=>n.visible=a)},{buttons:an(()=>[ue("button",{onClick:e[0]||(e[0]=(...a)=>n.yes&&n.yes(...a))},"Yes"),ue("button",{onClick:e[1]||(e[1]=(...a)=>n.no&&n.no(...a))},"No")]),default:an(()=>[ue("div",o0e,Tn(n.content),1)]),_:1},8,["visible"])}u(a0e,"_sfc_render$2");var l0e=Wt(r0e,[["render",a0e]]),c0e=Object.defineProperty,CE=u((n,e)=>c0e(n,"name",{value:e,configurable:!0}),"__name$g"),u0e=zt({components:{PopupDialog:g1},setup(){const n=Ge(!1),e=Ge(""),t=Ge(),i=Ge(null);let s=!1;const r=Ii("context",null);r&&(n.value=r.visible,e.value=r.title,i.value=r.value),qi(n,async l=>{var c,h;l?(await Vs(),(c=t.value)==null||c.focus(),(h=t.value)==null||h.select()):r==null||r.onCloseCallback(s?i.value:null)},{immediate:!0});function o(){s=!0,n.value=!1}u(o,"ok"),CE(o,"ok");function a(){s=!1,n.value=!1}return u(a,"cancel"),CE(a,"cancel"),{visible:n,title:e,input:t,value:i,ok:o,cancel:a}}});function h0e(n,e,t,i,s,r){const o=pn("popup-dialog");return Ce(),sn(o,{modal:"",title:n.title,closable:"",visible:n.visible,"onUpdate:visible":e[3]||(e[3]=a=>n.visible=a)},{buttons:an(()=>[ue("button",{onClick:e[1]||(e[1]=(...a)=>n.ok&&n.ok(...a))},"Ok"),ue("button",{onClick:e[2]||(e[2]=(...a)=>n.cancel&&n.cancel(...a))},"Cancel")]),default:an(()=>[ru(ue("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),style:{width:"100%"},ref:"input"},null,512),[[$T,n.value]])]),_:1},8,["title","visible"])}u(h0e,"_sfc_render$1");var f0e=Wt(u0e,[["render",h0e]]),d0e=Object.defineProperty,Mh=u((n,e)=>d0e(n,"name",{value:e,configurable:!0}),"__name$f");class tA{constructor(e,t,i){S(this,"visible");S(this,"content");S(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=i}}u(tA,"AlertDialogContext");Mh(tA,"AlertDialogContext");function ld(n){let e;return new Promise(function(t){const i=new tA(!0,n,function(){e(),t()});e=v1(i0e,s=>{s.provide("context",i)})})}u(ld,"showAlertDialog");Mh(ld,"showAlertDialog");class nA{constructor(e,t,i){S(this,"visible");S(this,"content");S(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=i}}u(nA,"ConfirmDialogContext");Mh(nA,"ConfirmDialogContext");function ZO(n){let e;return new Promise(function(t){const i=new nA(!0,n,function(s){e(),t(s)});e=v1(l0e,s=>{s.provide("context",i)})})}u(ZO,"showConfirmDialog");Mh(ZO,"showConfirmDialog");class iA{constructor(e,t,i,s){S(this,"visible");S(this,"title");S(this,"value");S(this,"onCloseCallback");this.visible=e,this.title=t,this.value=i,this.onCloseCallback=s}}u(iA,"PromptDialogContext");Mh(iA,"PromptDialogContext");function p0e(n,e){let t;return new Promise(function(i){const s=new iA(!0,n,e==null?null:e,function(r){t(),i(r)});t=v1(f0e,r=>{r.provide("context",s)})})}u(p0e,"showPromptDialog");Mh(p0e,"showPromptDialog");var m0e=Object.defineProperty,Vd=u((n,e)=>m0e(n,"name",{value:e,configurable:!0}),"__name$e");async function KO(n,e){const t=await sA(n,e);if(t){for(let i of t)n.history.removeNode(i.id);return!0}return!1}u(KO,"cutModelSelected");Vd(KO,"cutModelSelected");async function sA(n,e){var s;if(((s=e==null?void 0:e.target)==null?void 0:s.tagName)==="INPUT")return;const t=n.model.getTopmostSelectedNodes(),i=[];for(let r of t)i.push(await r.toJson());return await navigator.clipboard.writeText(JSON.stringify(i)),t}u(sA,"copyModelSelected");Vd(sA,"copyModelSelected");async function QO(n,e){var t;if(e&&"target"in e&&((t=e.target)==null?void 0:t.tagName)==="INPUT")return!1;try{let i=u(function(f){f=f.filter(d=>d.instanceId?a.isNodeExists(d.instanceId)?d.type===d.type:!1:!0);for(let d of f)d.children&&(d.children=i(d.children));return f},"filterInvalidInstancedNodes");Vd(i,"filterInvalidInstancedNodes");const s=(await navigator.clipboard.read())[0];for(let f of s.types)if(f.startsWith("image/")){const d=await s.getType(f),p=await Md(d);return n.history.createNode({type:"Image",data:{[Gr.name]:p}}),!0}let r=JSON.parse(await navigator.clipboard.readText());if(!Array.isArray(r))return!1;async function o(f){for(let d of f){for(let p in d.data){const g=Ki(p);let m=d.data[p];g.dataType===Ie.BYTES&&(m=new Uint8Array(await Bb(m))),g.deserialize&&(m=g.deserialize(m)),d.data[p]=m}d.children&&await o(d.children),d.selected=!1}}u(o,"convertJsonToRealDataType"),Vd(o,"convertJsonToRealDataType"),await o(r);const a=n.model;let l=e instanceof Bl?e:void 0;l||a.forEach(f=>{if(a.selected.includes(f.id))return l=f,!1}),r=i(r);let c=!1;const h=n.history;for(let f of r)if(f.selected=!0,l){if(l.isValidChild(f.type)){const d={...f};d.parentId=l.id,h.createNode(d),c=!0}}else if(Kn(f.type).canBeRoot){const p={...f};p.parentId=void 0,h.createNode(p),c=!0}return c&&(a.selected=[]),!0}catch(i){return console.error(i),!1}}u(QO,"pastedModelNodes");Vd(QO,"pastedModelNodes");var g0e=Object.defineProperty,v0e=u((n,e)=>g0e(n,"name",{value:e,configurable:!0}),"__name$d");const EE=new T,zy=new je,TE=new T,PE=new ve,lg=new ve;function JO(n,e){e=nt(e);const t=e.parent;if(!e.has(Me))return;const i=e.value(Me);if(!i)return;PE.copy(e.getParentWorldMatrix()).invert();const s=[i],r=[];for(;s.length;){const o=s.pop();if(!o)break;const a=o.userData.node;a&&a.id!==e.id||!o.visible||(o.isMesh&&r.push(o),s.push(...o.children))}for(let o of r){const a=o.geometry,l=[];let c=null;if(a.index){const d=a.getAttribute("position");if((d==null?void 0:d.itemSize)!==3)continue;const p=a.index.array,g=d.array;for(let v=0,y=p.length;v<y;++v){const _=p[v]*3;l.push(g[_],g[_+1],g[_+2])}const m=a.getAttribute("color");if(m){const v=m.array;c=[];for(let y=0,b=p.length,_=m.itemSize;y<b;++y){const w=p[y]*_;c.push(v[w],v[w+1],v[w+2])}}}else{const d=a.getAttribute("position");if((d==null?void 0:d.itemSize)!==3)continue;const p=d.array;for(let m=0,v=p.length;m<v;m+=3)l.push(p[m],p[m+1],p[m+2]);const g=a.getAttribute("color");if(g){c=[];const m=g.array;for(let v=0,y=m.length,b=g.itemSize;v<y;v+=b)c.push(m[v],m[v+1],m[v+2])}}if(!l.length)continue;const h={};h[gn.name]=new Float32Array(l),c&&(h[yr.name]=new Float32Array(c));const f=[Rt,Nn,Ui,Cn,Sn,Ot,Mn,Jt,Li];for(let d of f)e.has(d)&&(h[d.name]=e.cloneValue(d));o.updateWorldMatrix(!0,!1),lg.copy(o.matrixWorld),lg.multiplyMatrices(PE,lg),lg.decompose(EE,zy,TE),zy.identity(),h[Le.name]=new T().copy(EE),h[Qe.name]=new lt().setFromQuaternion(zy),h[Ft.name]=TE.x,n.history.createNode({type:"Clay",parentId:t==null?void 0:t.id,data:h})}n.history.removeNode(e.id)}u(JO,"convertModelNodeToClay");v0e(JO,"convertModelNodeToClay");var y0e=Object.defineProperty,y1=u((n,e)=>y0e(n,"name",{value:e,configurable:!0}),"__name$c");async function ek(n){function e(t){const i={type:t.type,children:[]};if(t.has(wn)){const s=t.value(wn);i.euler={x:s.x,y:s.y,z:s.z}}return i.children=t.children.map(e),i}u(e,"getPoseJson"),y1(e,"getPoseJson"),await navigator.clipboard.writeText(JSON.stringify(e(n)))}u(ek,"copyPose");y1(ek,"copyPose");async function tk(n,e){try{let t=u(function(s,r){if(r.type===s.type&&(r.euler&&s.has(wn)&&n.history.setValue(s,wn,new lt(r.euler.x,r.euler.y,r.euler.z)),s.children.length===r.children.length))for(let o=0,a=s.children.length;o<a;++o)t(s.children[o],r.children[o])},"applyPose");y1(t,"applyPose");let i=JSON.parse(await navigator.clipboard.readText());if(!("type"in i))return;t(e,i)}catch(t){console.error(t)}}u(tk,"pastePose");y1(tk,"pastePose");var _0e=Object.defineProperty,nk=u((n,e)=>_0e(n,"name",{value:e,configurable:!0}),"__name$b");function ik(n,e,t){var v;e=nt(e);const i=new ve,s=new ve,r=new T,o=new T,a=new T;if(t!=="none"){switch(i.copy(e.getParentWorldMatrix()),s.copy(i).invert(),t){case"x":r.set(1,0,0);break;case"y":r.set(0,1,0);break;case"z":r.set(0,0,1);break}o.copy(r).transformDirection(i),a.applyMatrix4(i)}const l=new T,c=new je,h=new T,f=new ve,d=new T,p=new je;function g(y,b,_,x,w){const M={type:y.type,instanceId:y.instanceId||y.id};M.data=y.getComponentData(!0);let C;if(t!=="none"){if(b=b,_=_,x=x,y.instanceId&&y.has(Un)&&wr(y.value(Un),r)?delete M.data[Un.name]:M.data[Un.name]=new T().copy(r),l.set(0,0,0),c.set(0,0,0,1),h.set(1,1,1),y.has(Le)){const A=M.data[Le.name];A.applyMatrix4(b),A.sub(a),A.reflect(o),A.add(a),A.applyMatrix4(x),l.copy(A)}if(y.has(Qe)){const A=M.data[Qe.name];c.setFromEuler(A);const P=Po(d,c);d.applyMatrix4(b),d.sub(a),d.reflect(o),d.add(a),d.applyMatrix4(x),d.normalize(),c.setFromAxisAngle(d,-P),A.setFromQuaternion(c)}if(y.has(xt)){if(t==="x")throw new Error("Flipping on x axis will broke the ik chain");const A=y.get(xt);l.copy(A.start),l.applyMatrix4(b),l.sub(a),l.reflect(o),l.add(a),l.applyMatrix4(x);let P=Po(d,A.quaternion);d.applyMatrix4(b),d.sub(a),d.reflect(o),d.add(a),d.applyMatrix4(x),d.normalize(),c.setFromAxisAngle(d,-P);const D=M.data[wn.name];w?(p.multiplyQuaternions(w,c),D.setFromQuaternion(p)):D.setFromQuaternion(c)}y.has(Ft)&&h.setScalar(y.value(Ft)),f.compose(l,c,h),_=new ve().multiplyMatrices(_,f),x=new ve().copy(_).invert(),b=y.getWorldMatrix(),C=new je().copy(c).invert()}if(M.children=[],!Kn(y.type).preventCreatingInstanceChild){let A;for(let P of y.children){const D=g(P,b,_,x,A);A=D.invQuat1,M.children.push(D.creationInfo)}}return M.expanded=y.expanded,M.selected=!1,{creationInfo:M,invQuat1:C}}u(g,"makeNewNode"),nk(g,"makeNewNode");const m=g(e,i,i,s).creationInfo;m.parentId=(v=e.parent)==null?void 0:v.id,m.selected=!0,n.model.selected=[],n.history.createNode(m)}u(ik,"createInstanceNode");nk(ik,"createInstanceNode");class _1{constructor(){this.pluginCallbacks=[],this.register(function(e){return new ok(e)}),this.register(function(e){return new ak(e)}),this.register(function(e){return new lk(e)}),this.register(function(e){return new hk(e)}),this.register(function(e){return new fk(e)}),this.register(function(e){return new ck(e)}),this.register(function(e){return new uk(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const r=new rk,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,s,r,t)})}}u(_1,"GLTFExporter");const Zt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Rs={};Rs[zn]=Zt.NEAREST;Rs[Ug]=Zt.NEAREST_MIPMAP_NEAREST;Rs[$g]=Zt.NEAREST_MIPMAP_LINEAR;Rs[Vi]=Zt.LINEAR;Rs[pb]=Zt.LINEAR_MIPMAP_NEAREST;Rs[nc]=Zt.LINEAR_MIPMAP_LINEAR;Rs[Gi]=Zt.CLAMP_TO_EDGE;Rs[Do]=Zt.REPEAT;Rs[vd]=Zt.MIRRORED_REPEAT;const RE={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},IE=12,b0e=1179937895,w0e=2,DE=8,x0e=1313821514,A0e=5130562;function Xf(n,e){return n.length===e.length&&n.every(function(t,i){return t===e[i]})}u(Xf,"equalArray");function M0e(n){return new TextEncoder().encode(n).buffer}u(M0e,"stringToArrayBuffer");function S0e(n){return Xf(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}u(S0e,"isIdentityMatrix");function C0e(n,e,t){const i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+t;s++)for(let r=0;r<n.itemSize;r++){let o;n.itemSize>4?o=n.array[s*n.itemSize+r]:r===0?o=n.getX(s):r===1?o=n.getY(s):r===2?o=n.getZ(s):r===3&&(o=n.getW(s)),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}u(C0e,"getMinMax");function sk(n){return Math.ceil(n/4)*4}u(sk,"getPaddedBufferSize");function By(n,e=0){const t=sk(n.byteLength);if(t!==n.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(n)),e!==0)for(let s=n.byteLength;s<t;s++)i[s]=e;return i.buffer}return n}u(By,"getPaddedArrayBuffer");function LE(){return typeof document=="undefined"&&typeof OffscreenCanvas!="undefined"?new OffscreenCanvas(1,1):document.createElement("canvas")}u(LE,"getCanvas");function OE(n,e){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}u(OE,"getToBlobPromise");class rk{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,r=s.buffers,o=s.json;i=s.options;const a=s.extensionsUsed,l=new Blob(r,{type:"application/octet-stream"}),c=Object.keys(a);if(c.length>0&&(o.extensionsUsed=c),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),i.binary===!0){const h=new FileReader;h.readAsArrayBuffer(l),h.onloadend=function(){const f=By(h.result),d=new DataView(new ArrayBuffer(DE));d.setUint32(0,f.byteLength,!0),d.setUint32(4,A0e,!0);const p=By(M0e(JSON.stringify(o)),32),g=new DataView(new ArrayBuffer(DE));g.setUint32(0,p.byteLength,!0),g.setUint32(4,x0e,!0);const m=new ArrayBuffer(IE),v=new DataView(m);v.setUint32(0,b0e,!0),v.setUint32(4,w0e,!0);const y=IE+g.byteLength+p.byteLength+d.byteLength+f.byteLength;v.setUint32(8,y,!0);const b=new Blob([m,g,p,d,f],{type:"application/octet-stream"}),_=new FileReader;_.readAsArrayBuffer(b),_.onloadend=function(){t(_.result)}}}else if(o.buffers&&o.buffers.length>0){const h=new FileReader;h.readAsDataURL(l),h.onloadend=function(){const f=h.result;o.buffers[0].uri=f,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],s[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new T;for(let s=0,r=e.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new T;for(let r=0,o=i.count;r<o;r++)s.fromBufferAttribute(i,r),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(r,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};(t.offset.x!==0||t.offset.y!==0)&&(s.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(s.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(p){return p.encoding===It?u(function(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)},"SRGBToLinear"):u(function(m){return m},"LinearToLinear")}u(i,"getEncodingConversion"),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const s=e==null?void 0:e.image,r=t==null?void 0:t.image,o=Math.max((s==null?void 0:s.width)||0,(r==null?void 0:r.width)||0),a=Math.max((s==null?void 0:s.height)||0,(r==null?void 0:r.height)||0),l=LE();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const h=c.getImageData(0,0,o,a);if(s){c.drawImage(s,0,0,o,a);const p=i(e),g=c.getImageData(0,0,o,a).data;for(let m=2;m<g.length;m+=4)h.data[m]=p(g[m]/256)*256}if(r){c.drawImage(r,0,0,o,a);const p=i(t),g=c.getImageData(0,0,o,a).data;for(let m=1;m<g.length;m+=4)h.data[m]=p(g[m]/256)*256}c.putImageData(h,0,0);const d=(e||t).clone();return d.source=new M0(l),d.encoding=Lo,d}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;t===Zt.UNSIGNED_BYTE?a=1:t===Zt.UNSIGNED_SHORT?a=2:a=4;const l=sk(s*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let h=0;for(let p=i;p<i+s;p++)for(let g=0;g<e.itemSize;g++){let m;e.itemSize>4?m=e.array[p*e.itemSize+g]:g===0?m=e.getX(p):g===1?m=e.getY(p):g===2?m=e.getZ(p):g===3&&(m=e.getW(p)),t===Zt.FLOAT?c.setFloat32(h,m,!0):t===Zt.UNSIGNED_INT?c.setUint32(h,m,!0):t===Zt.UNSIGNED_SHORT?c.setUint16(h,m,!0):t===Zt.UNSIGNED_BYTE&&c.setUint8(h,m),h+=a}const f={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(f.target=r),r===Zt.ARRAY_BUFFER&&(f.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(f),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=By(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,s){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Zt.FLOAT;else if(e.array.constructor===Uint32Array)a=Zt.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)a=Zt.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)a=Zt.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(i===void 0&&(i=0),s===void 0&&(s=e.count),s===0)return null;const l=C0e(e,i,s);let c;t!==void 0&&(c=e===t.index?Zt.ELEMENT_ARRAY_BUFFER:Zt.ARRAY_BUFFER);const h=this.processBufferView(e,a,i,s,c),f={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:s,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(f.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(f)-1}processImage(e,t,i,s="image/png"){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),f=s+":flipY/"+i.toString();if(h[f]!==void 0)return h[f];a.images||(a.images=[]);const d={mimeType:s},p=LE();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const g=p.getContext("2d");if(i===!0&&(g.translate(0,p.height),g.scale(1,-1)),e.data!==void 0){t!==Es&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const v=new Uint8ClampedArray(e.height*e.width*4);for(let y=0;y<v.length;y+=4)v[y+0]=e.data[y+0],v[y+1]=e.data[y+1],v[y+2]=e.data[y+2],v[y+3]=e.data[y+3];g.putImageData(new ImageData(v,e.width,e.height),0,0)}else g.drawImage(e,0,0,p.width,p.height);l.binary===!0?c.push(OE(p,s).then(v=>r.processBufferViewImage(v)).then(v=>{d.bufferView=v})):p.toDataURL!==void 0?d.uri=p.toDataURL(s):c.push(OE(p,s).then(v=>new FileReader().readAsDataURL(v)).then(v=>{d.uri=v}));const m=a.images.push(d)-1;return h[f]=m,m}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Rs[e.magFilter],minFilter:Rs[e.minFilter],wrapS:Rs[e.wrapS],wrapT:Rs[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(r.name=e.name),this._invokeAll(function(a){a.writeTexture&&a.writeTexture(e,r)});const o=i.textures.push(r)-1;return t.textures.set(e,o),o}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(Xf(r,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(a)};this.applyTextureTransform(l,a),s.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){const a={index:this.processTexture(e.map)};this.applyTextureTransform(a,e.map),s.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive.clone().multiplyScalar(e.emissiveIntensity),l=Math.max(a.r,a.g,a.b);if(l>1&&(a.multiplyScalar(1/l),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),l>0&&(s.emissiveFactor=a.toArray()),e.emissiveMap){const c={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(c,e.emissiveMap),s.emissiveTexture=c}}if(e.normalMap){const a={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),s.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),s.occlusionTexture=a}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===Ts&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,s)});const o=i.materials.push(s)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,x=e.material.length;_<x;_++)s.push(e.material[_].uuid);else s.push(e.material.uuid);const r=s.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let a;e.isLineSegments?a=Zt.LINES:e.isLineLoop?a=Zt.LINE_LOOP:e.isLine?a=Zt.LINE_STRIP:e.isPoints?a=Zt.POINTS:a=e.material.wireframe?Zt.LINES:Zt.TRIANGLES;const l={},c={},h=[],f=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let g=null;for(let _ in o.attributes){if(_.slice(0,5)==="morph")continue;const x=o.attributes[_];if(_=d[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),t.attributes.has(this.getUID(x))){c[_]=t.attributes.get(this.getUID(x));continue}g=null;const M=x.array;_==="JOINTS_0"&&!(M instanceof Uint16Array)&&!(M instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new mn(new Uint16Array(M),x.itemSize,x.normalized));const C=this.processAccessor(g||x,o);C!==null&&(c[_]=C,t.attributes.set(this.getUID(x),C))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],x=[],w={};if(e.morphTargetDictionary!==void 0)for(const M in e.morphTargetDictionary)w[e.morphTargetDictionary[M]]=M;for(let M=0;M<e.morphTargetInfluences.length;++M){const C={};let A=!1;for(const P in o.morphAttributes){if(P!=="position"&&P!=="normal"){A||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),A=!0);continue}const D=o.morphAttributes[P][M],k=P.toUpperCase(),O=o.attributes[P];if(t.attributes.has(this.getUID(D,!0))){C[k]=t.attributes.get(this.getUID(D,!0));continue}const N=D.clone();if(!o.morphTargetsRelative)for(let E=0,B=D.count;E<B;E++)N.setXYZ(E,D.getX(E)-O.getX(E),D.getY(E)-O.getY(E),D.getZ(E)-O.getZ(E));C[k]=this.processAccessor(N,o),t.attributes.set(this.getUID(O,!0),C[k])}f.push(C),_.push(e.morphTargetInfluences[M]),e.morphTargetDictionary!==void 0&&x.push(w[M])}l.weights=_,x.length>0&&(l.extras={},l.extras.targetNames=x)}const m=Array.isArray(e.material);if(m&&o.groups.length===0)return null;const v=m?e.material:[e.material],y=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,x=y.length;_<x;_++){const w={mode:a,attributes:c};if(this.serializeUserData(o,w),f.length>0&&(w.targets=f),o.index!==null){let C=this.getUID(o.index);(y[_].start!==void 0||y[_].count!==void 0)&&(C+=":"+y[_].start+":"+y[_].count),t.attributes.has(C)?w.indices=t.attributes.get(C):(w.indices=this.processAccessor(o.index,o,y[_].start,y[_].count),t.attributes.set(C,w.indices)),w.indices===null&&delete w.indices}const M=this.processMaterial(v[y[_].materialIndex]);M!==null&&(w.material=M),h.push(w)}l.primitives=h,i.meshes||(i.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,l)});const b=i.meshes.push(l)-1;return t.meshes.set(r,b),b}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:$s.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),e=_1.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],h=bt.parseTrackName(c.name);let f=bt.findNode(t,h.nodeName);const d=RE[h.propertyName];if(h.objectName==="bones"&&(f.isSkinnedMesh===!0?f=f.skeleton.getBoneByName(h.objectIndex):f=void 0),!f||!d)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let g=c.values.length/c.times.length;d===RE.morphTargetInfluences&&(g/=f.morphTargetInfluences.length);let m;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(m="CUBICSPLINE",g/=3):c.getInterpolation()===Iu?m="STEP":m="LINEAR",a.push({input:this.processAccessor(new mn(c.times,p)),output:this.processAccessor(new mn(c.values,g)),interpolation:m}),o.push({sampler:a.length-1,target:{node:s.get(f),path:d}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new ve;for(let f=0;f<r.bones.length;++f)a.push(i.get(r.bones[f])),c.copy(r.boneInverses[f]),c.multiply(e.bindMatrix).toArray(l,f*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new mn(l,16)),joints:a,skeleton:i.get(o)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(i.trs){const a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();Xf(a,[0,0,0,1])||(r.rotation=a),Xf(l,[0,0,0])||(r.translation=l),Xf(c,[1,1,1])||(r.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),S0e(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(r.mesh=a)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let l=0,c=e.children.length;l<c;l++){const h=e.children[l];if(h.visible||i.onlyVisible===!1){const f=this.processNode(h);f!==null&&a.push(f)}}a.length>0&&(r.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,r)});const o=t.nodes.push(r)-1;return s.set(e,o),o}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||i.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(s.nodes=r),this.serializeUserData(e,s)}processObjects(e){const t=new bd;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const i=[];for(let s=0;s<e.length;s++)e[s]instanceof bd?this.processScene(e[s]):i.push(e[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}u(rk,"GLTFWriter");class ok{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,s=i.json,r=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},r[this.name]=!0);const a=s.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}u(ok,"GLTFLightExtension");class ak{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}u(ak,"GLTFMaterialsUnlitExtension");class lk{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const i=this.writer,s=i.extensionsUsed,r={};t.pbrMetallicRoughness.baseColorFactor&&(r.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const o=[1,1,1];if(e.specular.toArray(o,0),r.specularFactor=o,r.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(r.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const a={index:i.processTexture(e.specularMap)};i.applyTextureTransform(a,e.specularMap),r.specularGlossinessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(lk,"GLTFMaterialsPBRSpecularGlossiness");class ck{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap)};i.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap)};i.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap)};i.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(ck,"GLTFMaterialsClearcoatExtension");class uk{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap)};i.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap)};i.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(uk,"GLTFMaterialsIridescenceExtension");class hk{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap)};i.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(hk,"GLTFMaterialsTransmissionExtension");class fk{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap)};i.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(fk,"GLTFMaterialsVolumeExtension");_1.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;s[0]=e,s.set(n.times,1),r.set(o.evaluate(e),0),r.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;s[s.length-1]=e,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(e),n.values.length),a=s.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){s.set(n.times.slice(0,l+1),0),s[l+1]=e,s.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,e){const t=[],i={},s=n.tracks;for(let r=0;r<s.length;++r){let o=s[r];const a=bt.parseTrackName(o.name),l=bt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Vl)}const c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let f;if(i[l.uuid]===void 0){f=o.clone();const p=new f.ValueBufferType(c*f.times.length);for(let g=0;g<f.times.length;g++)p[g*c+h]=f.values[g];f.name=(a.nodeName||"")+".morphTargetInfluences",f.values=p,i[l.uuid]=f,t.push(f);continue}const d=o.createInterpolant(new o.ValueBufferType(1));f=i[l.uuid];for(let p=0;p<f.times.length;p++)f.values[p*c+h]=d.evaluate(f.times[p]);for(let p=0;p<o.times.length;p++){const g=this.insertKeyframe(f,o.times[p]);f.values[g*c+h]=o.values[p]}}return n.tracks=t,n}};class dk{parse(e){let t="",i=0,s=0,r=0;const o=new T,a=new Te,l=new T,c=new ke,h=[];function f(g){let m=0,v=0,y=0;const b=g.geometry,_=new Wi,x=b.getAttribute("position"),w=b.getAttribute("normal"),M=b.getAttribute("uv"),C=b.getIndex();if(t+="o "+g.name+`
`,g.material&&g.material.name&&(t+="usemtl "+g.material.name+`
`),x!==void 0)for(let A=0,P=x.count;A<P;A++,m++)o.fromBufferAttribute(x,A),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(M!==void 0)for(let A=0,P=M.count;A<P;A++,y++)c.fromBufferAttribute(M,A),t+="vt "+c.x+" "+c.y+`
`;if(w!==void 0){_.getNormalMatrix(g.matrixWorld);for(let A=0,P=w.count;A<P;A++,v++)l.fromBufferAttribute(w,A),l.applyMatrix3(_).normalize(),t+="vn "+l.x+" "+l.y+" "+l.z+`
`}if(C!==null)for(let A=0,P=C.count;A<P;A+=3){for(let D=0;D<3;D++){const k=C.getX(A+D)+1;h[D]=i+k+(w||M?"/"+(M?s+k:"")+(w?"/"+(r+k):""):"")}t+="f "+h.join(" ")+`
`}else for(let A=0,P=x.count;A<P;A+=3){for(let D=0;D<3;D++){const k=A+D+1;h[D]=i+k+(w||M?"/"+(M?s+k:"")+(w?"/"+(r+k):""):"")}t+="f "+h.join(" ")+`
`}i+=m,s+=y,r+=v}u(f,"parseMesh");function d(g){let m=0;const v=g.geometry,y=g.type,b=v.getAttribute("position");if(t+="o "+g.name+`
`,b!==void 0)for(let _=0,x=b.count;_<x;_++,m++)o.fromBufferAttribute(b,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(y==="Line"){t+="l ";for(let _=1,x=b.count;_<=x;_++)t+=i+_+" ";t+=`
`}if(y==="LineSegments")for(let _=1,x=_+1,w=b.count;_<w;_+=2,x=_+1)t+="l "+(i+_)+" "+(i+x)+`
`;i+=m}u(d,"parseLine");function p(g){let m=0;const v=g.geometry,y=v.getAttribute("position"),b=v.getAttribute("color");if(t+="o "+g.name+`
`,y!==void 0){for(let _=0,x=y.count;_<x;_++,m++)o.fromBufferAttribute(y,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z,b!==void 0&&(a.fromBufferAttribute(b,_).convertLinearToSRGB(),t+=" "+a.r+" "+a.g+" "+a.b),t+=`
`;t+="p ";for(let _=1,x=y.count;_<=x;_++)t+=i+_+" ";t+=`
`}i+=m}return u(p,"parsePoints"),e.traverse(function(g){g.isMesh===!0&&f(g),g.isLine===!0&&d(g),g.isPoints===!0&&p(g)}),t}}u(dk,"OBJExporter");var E0e=Object.defineProperty,Pg=u((n,e)=>E0e(n,"name",{value:e,configurable:!0}),"__name$a");async function pk(n,e,t){function i(){const r=new bd;r.traverse=function(o){a(r);function a(l){for(let c of l.children)c.visible&&(o(c),a(c))}u(a,"traverseVisible"),Pg(a,"traverseVisible")};for(let o of n.readonlyRef().model.nodes)if(o.has(Me)){const a=o.value(Me);a&&r.children.push(a)}return r}u(i,"getExportScene"),Pg(i,"getExportScene");async function s(r){try{n.statusBarMessage="Exporting...",e.value=!0,await Vs(),await r(async function(){n.statusBarMessage="Writing files...",await Vs()}),n.statusBarMessage="File exported."}catch(o){console.error(o),n.statusBarMessage="Failed to export."}finally{e.value=!1}}switch(u(s,"process"),Pg(s,"process"),t){case"obj":try{const r=await showSaveFilePicker({types:[{accept:{"application/object":[".obj"]}}]});await s(async function(o){const a=i(),l=new dk().parse(a);await o();const c=await r.createWritable({keepExistingData:!1});await c.write(l),await c.close()})}catch{return}break;case"glb":try{const r=await showSaveFilePicker({types:[{accept:{"application/object":[".glb"]}}]});await s(async function(o){const a=i(),c=await new _1().parseAsync(a,{onlyVisible:!0,binary:!0});await o();const h=await r.createWritable({keepExistingData:!1});await h.write(c),await h.close()})}catch{return}break;default:return}}u(pk,"exportModel");Pg(pk,"exportModel");var T0e=Object.defineProperty,Rg=u((n,e)=>T0e(n,"name",{value:e,configurable:!0}),"__name$9");const dn=new T,yo=new je,cg=new T(1,0,0),Lf=new T(0,1,0),kE=new T(0,0,1);function mk(n,e,t){e=nt(e);let i;if(e.type==="IKNode"){const a=e.parent,l=a.children.findIndex(c=>c.id===e.id);if(l){const h=a.children[l-1].get(xt);i=new je().copy(h.quaternion).invert()}}s(e,new T,new T(0,0,1),new ve,new ve,new ve,i);function s(a,l,c,h,f,d,p){const g=a.getLocalMatrix(),m=new T,v=new je,y=new T;if(!(a.has(qt)&&a.value(qt))){g.decompose(m,v,y);const _=new ve().multiplyMatrices(h,g);if(t==="flip"){const A=Po(dn,v);dn.applyMatrix4(h),dn.sub(l),dn.reflect(c),dn.add(l),dn.applyMatrix4(d),dn.normalize(),v.setFromAxisAngle(dn,-A),m.applyMatrix4(h),m.sub(l),m.reflect(c),m.add(l),m.applyMatrix4(d)}else cg.set(1,0,0).applyQuaternion(v),Lf.set(0,1,0).applyQuaternion(v),cg.z=0,cg.normalize(),Lf.z=0,Lf.normalize(),kE.crossVectors(cg,Lf).normalize(),Oa(v,kE,Lf),m.z=0;a.has(Qe)&&n.history.setValue(a,Qe,new lt().setFromQuaternion(v)),a.has(wn)&&(p?yo.multiplyQuaternions(p,v):yo.copy(v),n.history.setValue(a,wn,new lt().setFromQuaternion(yo)));const x=new ve().compose(m,v,y);x.multiplyMatrices(f,x);const w=new ve().copy(x).invert(),M=new Set;let C;for(let A of a.children){if(M.has(A.id))continue;M.add(A.id);const P=o(A,a);if(P){M.add(P.id);let D=A,k=P;A.has(Le)&&A.value(Le).z>0&&(k=A,D=P),r(l,c,D,h,f,d,C,k,h,f,d,C)}else{const{rotation:D}=s(A,l,c,_,x,w,C);C=new je().copy(D).invert()}}}return{rotation:v}}u(s,"processMiddleNode"),Rg(s,"processMiddleNode");function r(a,l,c,h,f,d,p,g,m,v,y,b){const _=c.getLocalMatrix(),x=new T,w=new je,M=new T;_.decompose(x,w,M);const C=new ve().multiplyMatrices(h,_),A=g.getLocalMatrix(),P=new T,D=new je,k=new T;A.decompose(P,D,k);const O=new ve().multiplyMatrices(m,A);if(!(e.has(qt)&&e.value(qt))){if(t==="flip"||t==="left-to-right"){const ie=Po(dn,w);dn.applyMatrix4(h),dn.sub(a),dn.reflect(l),dn.add(a),dn.applyMatrix4(d),dn.normalize(),w.setFromAxisAngle(dn,-ie),x.applyMatrix4(h),x.sub(a),x.reflect(l),x.add(a),x.applyMatrix4(d),g.has(Qe)&&n.history.setValue(g,Qe,new lt().setFromQuaternion(w)),g.has(wn)&&(p?yo.multiplyQuaternions(p,w):yo.copy(w),n.history.setValue(g,wn,new lt().setFromQuaternion(yo)))}if(t==="flip"||t==="right-to-left"){const ie=Po(dn,D);dn.applyMatrix4(m),dn.sub(a),dn.reflect(l),dn.add(a),dn.applyMatrix4(y),dn.normalize(),D.setFromAxisAngle(dn,-ie),P.applyMatrix4(m),P.sub(a),P.reflect(l),P.add(a),P.applyMatrix4(y),c.has(Qe)&&n.history.setValue(c,Qe,new lt().setFromQuaternion(D)),c.has(wn)&&(b?yo.multiplyQuaternions(b,D):yo.copy(D),n.history.setValue(c,wn,new lt().setFromQuaternion(yo)))}const E=new ve().compose(x,w,M);E.multiplyMatrices(f,E);const B=new ve().copy(E).invert(),W=new ve().compose(P,D,k);W.multiplyMatrices(v,W);const Z=new ve().copy(W).invert();let ne,j;for(let ie of c.children){const K=o(ie,g);if(K){const{rotationLeft:$,rotationRight:le}=r(a,l,ie,C,E,B,ne,K,O,W,Z,j);ne=new je().copy($).invert(),j=new je().copy(le).invert()}}}return{rotationLeft:w,rotationRight:D}}u(r,"processMirrorNode"),Rg(r,"processMirrorNode");function o(a,l){var f;if(a.type==="IKNode"&&((f=a.parent)==null?void 0:f.id)===l.id)return null;const c=a.has(Le)?a.value(Le):null;if(a.has(Un)){for(let d of l.children)if(a.id!==d.id&&a.type===d.type&&(a.instanceId===d.id||a.instanceId===d.instanceId)&&(!c||h(c,d.value(Le))))return d}else for(let d of l.children)if(a.id!==d.id&&a.type===d.type&&d.has(Un)&&(d.instanceId===a.id||d.instanceId===a.instanceId)&&(!c||h(c,d.value(Le))))return d;return null;function h(d,p){return Math.abs(d.x-p.x)<1e-8&&Math.abs(d.y-p.y)<1e-8&&Math.abs(d.z+p.z)<1e-8}}u(o,"findMirrorNode"),Rg(o,"findMirrorNode")}u(mk,"flipNode");Rg(mk,"flipNode");var P0e=Object.defineProperty,R0e=u((n,e)=>P0e(n,"name",{value:e,configurable:!0}),"__name$8");const gk=2016834916,vk=2,ug=new DataView(new ArrayBuffer(8));class rA{constructor(){S(this,"buffer",new Uint8Array(64));S(this,"size",0)}expandCapacity(e){const t=e+this.size;if(this.buffer.length<t){const i=new Uint8Array(Math.pow(2,Math.ceil(Math.log2(t))));for(let s=0,r=this.size;s<r;++s)i[s]=this.buffer[s];this.buffer=i}}writeUint32(e){this.expandCapacity(4),ug.setUint32(0,e);for(let t=0;t<4;++t)this.buffer[this.size+t]=ug.getUint8(t);this.size+=4}writeFloat64(e){this.expandCapacity(8),ug.setFloat64(0,e);for(let t=0;t<8;++t)this.buffer[this.size+t]=ug.getUint8(t);this.size+=8}writeBoolean(e){this.writeUint32(e?1:0)}writeString(e){const i=new TextEncoder().encode(e);this.writeUint32(i.length),this.expandCapacity(i.length);for(let s=0,r=i.length;s<r;++s)this.buffer[this.size+s]=i[s];this.size+=i.length}writeBytes(e){this.writeUint32(e.length),this.expandCapacity(e.length);for(let t=0,i=e.length;t<i;++t)this.buffer[this.size+t]=e[t];this.size+=e.length}writeNumberArray(e){this.writeUint32(e.length);for(let t of e)this.writeFloat64(t)}write(e){e=e.readonlyRef(),this.writeUint32(gk),this.writeUint32(vk);for(let i of e.views)this.writeFloat64(i.zoomLevel),this.writeFloat64(i.camera.alpha),this.writeFloat64(i.camera.beta),this.writeFloat64(i.camera.target.x),this.writeFloat64(i.camera.target.y),this.writeFloat64(i.camera.target.z),this.writeBoolean(i.index===e.mainViewIndex?e.model.cameraPerspective:i.camera.perspective),this.writeFloat64(i.camera.perspectiveCamera.fov);const t=e.model;this.writeUint32(t.cameras.length);for(let i of t.cameras)this.writeString(i.name),this.writeFloat64(i.zoomLevel),this.writeFloat64(i.alpha),this.writeFloat64(i.beta),this.writeFloat64(i.target[0]),this.writeFloat64(i.target[1]),this.writeFloat64(i.target[2]),this.writeBoolean(i.perspective),this.writeFloat64(i.fov);return e.model.forEach(i=>{var r;this.writeUint32(i.id),this.writeString(i.type),this.writeBoolean(i.expanded),this.writeUint32(((r=i.parent)==null?void 0:r.id)||0),this.writeUint32(i.instanceId);const s=[];for(let o in i.components){const a=i.components[o],l=Ki(o);if(l.storable){if(i.instanceId&&!l.instanceable)continue;const c=l.serialize?l.serialize(a.value):a.value;c!=null&&s.push([l.dataType,o,c])}}this.writeUint32(s.length);for(let o of s){const a=o[0],l=o[1],c=o[2];switch(this.writeUint32(a),this.writeString(l.substring(1)),a){case Ie.NUMBER:this.writeFloat64(c);break;case Ie.STRING:this.writeString(c);break;case Ie.BOOLEAN:this.writeBoolean(c);break;case Ie.NUMBER_ARRAY:this.writeNumberArray(c);break;case Ie.BYTES:this.writeBytes(c);break;default:throw new Error(`Unimplemented data type of component [${l}]`)}}}),this}getBytes(){return this.buffer.subarray(0,this.size)}}u(rA,"ProjectWriter");R0e(rA,"ProjectWriter");var I0e=Object.defineProperty,D0e=u((n,e)=>I0e(n,"name",{value:e,configurable:!0}),"__name$7");const hg=new DataView(new ArrayBuffer(8));class b1{constructor(e){S(this,"buffer");S(this,"index",0);this.buffer=e}end(){return this.index>=this.buffer.length}readUint32(){for(let t=0;t<4;++t)hg.setUint8(t,this.buffer[this.index+t]);const e=hg.getUint32(0);return this.index+=4,e}readFloat64(){for(let t=0;t<8;++t)hg.setUint8(t,this.buffer[this.index+t]);const e=hg.getFloat64(0);return this.index+=8,e}readBoolean(){return!!this.readUint32()}readString(){const e=new TextDecoder,t=this.readUint32(),i=this.buffer.subarray(this.index,this.index+t),s=e.decode(i);return this.index+=t,s}readBytes(){const e=this.readUint32(),t=this.buffer.subarray(this.index,this.index+e);return this.index+=e,t}readNumberArray(){const e=this.readUint32(),t=[];for(let i=0;i<e;++i)t.push(this.readFloat64());return t}read(){if(this.readUint32()!==gk)throw new Error("Failed to read magic header");const t=this.readUint32();if(t>vk)throw new Error("Unknown file version");const i={views:[],cameras:[],nodes:[]};for(let s=0;s<4;++s){const r=this.readFloat64(),o=this.readFloat64(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),h=this.readFloat64();let f=s===1,d=45;t>=2&&(f=this.readBoolean(),d=this.readFloat64()),i.views.push({zoomLevel:r,alpha:o,beta:a,target:[l,c,h],perspective:f,fov:d})}if(t>=2){const s=this.readUint32();for(let r=0;r<s;++r){const o=this.readString(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),h=this.readFloat64(),f=this.readFloat64(),d=this.readFloat64(),p=this.readBoolean(),g=this.readFloat64();i.cameras.push({name:o,zoomLevel:a,alpha:l,beta:c,target:[h,f,d],perspective:p,fov:g})}}for(;!this.end();){const s=this.readUint32(),r=this.readString(),o=this.readBoolean(),a=this.readUint32(),l=this.readUint32(),c=this.readUint32(),h={};for(let f=0;f<c;++f){const d=this.readUint32(),p="C"+this.readString();let g;switch(d){case Ie.NUMBER:g=this.readFloat64();break;case Ie.STRING:g=this.readString();break;case Ie.BOOLEAN:g=this.readBoolean();break;case Ie.NUMBER_ARRAY:g=this.readNumberArray();break;case Ie.BYTES:g=this.readBytes();break;default:throw new Error(`Unimplemented data type [${d}]`)}if(hR(p)){const m=Ki(p);m.deserialize&&(g=m.deserialize(g)),h[p]=g}}i.nodes.push({id:s,type:r,expanded:o,parentId:a,instanceId:l,data:h})}return i}}u(b1,"ProjectReader");D0e(b1,"ProjectReader");var L0e=Object.defineProperty,O0e=u((n,e)=>L0e(n,"name",{value:e,configurable:!0}),"__name$6");async function yk(n,e,t,i){let s=null;const r=[t,{description:"Wavefront",accept:{"application/object":[".obj"]}},{description:"FBX",accept:{"application/fbx":[".fbx"]}},{description:"Image",accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".jfif",".pjpeg",".pjp"],"image/bmp":[".bmp"],"image/webp":[".webp"]}}];try{[s]=await showOpenFilePicker({types:[{description:"All Supported",accept:r.reduce((o,a)=>Object.assign(o,a.accept),{})},...r],multiple:!1})}catch{return}try{n.statusBarMessage="Loading...",e.value=!0,await Vs();const o=await s.getFile(),a=o.name.substring(o.name.lastIndexOf(".")).toLowerCase();switch(a){case i:{const l=new b1(new Uint8Array(await o.arrayBuffer())).read(),c={};let h=n.history.getNextNodeId()+1;for(let p of l.nodes)c[p.id]=h++;const f={};for(let p of l.nodes)f[p.id]={originId:p.id,type:p.type,data:p.data,expanded:p.expanded,instanceId:p.instanceId?c[p.instanceId]:0};const d=[];for(let p of l.nodes)if(p.parentId){const g=f[p.parentId];g.children=g.children||[],g.children.push(f[p.id])}else d.push(f[p.id]);for(let p of d)n.history.createNode(p)}break;case".obj":{const l=await o.text();n.history.createNode({type:"ObjModel",data:{[No.name]:l,[Xs.name]:!0}})}break;case".fbx":{const l=await o.arrayBuffer(),c=await Md(new Blob([l]));n.history.createNode({type:"FbxModel",data:{[ko.name]:c,[Xs.name]:!0}})}break;case".jpg":case".jpeg":case".jfif":case".pjpeg":case".pjp":case".png":case".apng":case".gif":case".avif":case".webp":case".bmp":{const l=await o.arrayBuffer(),c=await Md(new Blob([l]));n.history.createNode({type:"Image",data:{[Gr.name]:c}})}break;default:await ld(`Unsupported file format ${a}`)}focus(),n.statusBarMessage=""}catch(o){console.error(o),n.statusBarMessage="Failed to import file: "+o}finally{e.value=!1}}u(yk,"importModel");O0e(yk,"importModel");var k0e=Object.defineProperty,N0e=u((n,e)=>k0e(n,"name",{value:e,configurable:!0}),"__name$5");const Of=new T,fg=new T,dg=new T,NE=new T,FE=new T,zE=new T,pg=new T,Uy=new T,$y=new T,BE=new T,mg=new T,UE=new T,Vy=new T,Gy=new T(1,0,0);function _k(n,e,t,i,s=.005){const r=Math.max(i.max.x-i.min.x,i.max.y-i.min.y,i.max.z-i.min.z),o=r/(Math.ceil(r/s)+.5),a=1/o,l=n.length/9,c=i.min.x-o,h=i.min.y-o,f=i.min.z-o,d=i.max.x+o,p=i.max.y+o,g=i.max.z+o,m=Math.floor(c*a),v=Math.floor(h*a),y=Math.floor(f*a),b=Math.ceil(d*a),_=Math.ceil(p*a),x=Math.ceil(g*a),w=b-m,M=_-v,C=x-y,A=w*M*C,P=new Float32Array(A),D=new Float32Array(A*3);for(let $=0;$<A;++$)P[$]=o;const k=new $r(A),O=new $r(A*3);for(let $=0;$<l;++$){const le=t[$*6]-o,ae=t[$*6+1]-o,J=t[$*6+2]-o,te=t[$*6+3]+o,ge=t[$*6+4]+o,he=t[$*6+5]+o,we=Math.floor(le*a),xe=Math.floor(ae*a),Se=Math.floor(J*a),V=Math.ceil(te*a),Y=Math.ceil(ge*a),R=Math.ceil(he*a),ee=V-we,Q=Y-xe,U=R-Se;Of.fromArray(n,$*9),fg.fromArray(n,$*9+3),dg.fromArray(n,$*9+6),NE.fromArray(e,$*9),FE.fromArray(e,$*9+3),zE.fromArray(e,$*9+6),pg.addVectors(NE,FE).add(zE).multiplyScalar(1/3),Uy.subVectors(fg,Of),$y.subVectors(dg,Of),BE.subVectors(dg,fg);for(let F=0;F<ee;++F){const H=F+we-m,re=c+H*o;for(let z=0;z<Q;++z){const I=z+xe-v,L=h+I*o;for(let G=0;G<U;++G){const X=G+Se-y,se=f+X*o,de=H*M*C+I*C+X;mg.set(re,L,se),l8(UE,mg,Of,fg,dg,Uy,$y,BE),Vy.subVectors(UE,mg);const me=Vy.length();if(!(me>o)){k.set(de),me<=P[de]&&(P[de]=me,D[de*3]=pg.x,D[de*3+1]=pg.y,D[de*3+2]=pg.z);for(let ye=0;ye<3;++ye){const pe=Vy.getComponent(ye);if(pe<0||pe>o)continue;const Fe=de*3+ye;if(O.get(Fe))continue;Gy.set(0,0,0),Gy.setComponent(ye,1);const qe=c8(mg,Gy,Of,Uy,$y);qe<0||qe>o||O.set(Fe)}}}}}}const N=new $r(P.length),E=[0],B=M*C,W=C,Z=1,ne=[-B,+B,-W,+W,-Z,+Z],j=[0,0,1,1,2,2];for(;E.length;){const $=E.pop();if($==null)break;if(k.get($)){let le=!1;for(let ae=0;ae<6;++ae){const J=ne[ae],te=$+J;te<0||te>=A||N.get(te)||!k.get(te)||(O.get((J>0?$:te)*3+j[ae])?le=!0:(N.set(te),E.push(te)))}le&&N.set($)}else{N.set($);for(let le=0;le<6;++le){const ae=$+ne[le];ae<0||ae>=A||N.get(ae)||(N.set(ae),E.push(ae))}}}for(let $=0;$<A;++$)N.get($)||(P[$]=-P[$]);const ie=[],K=[];for(let $=0;$<w-1;++$){const le=c+$*o;for(let ae=0;ae<M-1;++ae){const J=h+ae*o;for(let te=0;te<C-1;++te){const ge=f+te*o;Nw(ie,null,K,le,J,ge,o,P,D,$*M*C+ae*C+te,($+1)*M*C+ae*C+te,($+1)*M*C+ae*C+(te+1),$*M*C+ae*C+(te+1),$*M*C+(ae+1)*C+te,($+1)*M*C+(ae+1)*C+te,($+1)*M*C+(ae+1)*C+(te+1),$*M*C+(ae+1)*C+(te+1))}}}return{position:new Float32Array(ie),color:new Float32Array(K)}}u(_k,"voxelizeRemesh");N0e(_k,"voxelizeRemesh");var F0e=Object.defineProperty,z0e=u((n,e)=>F0e(n,"name",{value:e,configurable:!0}),"__name$4");async function bk(n,e,t,i){const s=await fetch(n);if(!s.body)throw new Error("Failed to get response body");const r=s.body.getReader();i||(i=Number.parseInt(s.headers.get("Content-Length")||"0"));let o=0;const a=[];for(;;){const{done:h,value:f}=await r.read();if(h||!f)break;if(a.push(f),o+=f.length,e(o,i),t!=null&&t.value)return await r.cancel(),r.releaseLock(),null}const l=new Uint8Array(o);let c=0;for(let h of a)l.set(h,c),c+=h.length;return l}u(bk,"progressiveDownload");z0e(bk,"progressiveDownload");var B0e=Object.defineProperty,U0e=u((n,e)=>B0e(n,"name",{value:e,configurable:!0}),"__name$3");class oA{constructor(e){S(this,"running",!1);S(this,"keepLoop",!1);S(this,"lastTimestamp",0);S(this,"onUpdate");this.onUpdate=e}start(){this.running||(this.running=!0,this.keepLoop=!0,this.lastTimestamp=new Date().valueOf(),requestAnimationFrame(()=>this.loop()))}stop(){this.keepLoop=!1}loop(){const e=new Date().valueOf();try{this.keepLoop&&this.onUpdate(Math.max(e-this.lastTimestamp,1)/1e3)}catch(t){throw this.running=!1,this.keepLoop=!1,t}this.lastTimestamp=e,this.keepLoop?requestAnimationFrame(()=>this.loop()):this.running=!1}}u(oA,"RenderLoop");U0e(oA,"RenderLoop");var $0e=Object.defineProperty,V0e=u((n,e)=>$0e(n,"name",{value:e,configurable:!0}),"__name$2");const G0e="gYxItIxQuvELUDHlN23TLnKHSMC47FjIJmWce1uK",H0e=`https://sketchfab.com/oauth2/authorize/?response_type=token&client_id=${G0e}`,Hy="sketchfab-token",wk=To({token:{accessToken:"",expires:0},user:{displayName:"",username:""},loadLocalStorage(){const n=localStorage.getItem(Hy);if(!n)return;const e=JSON.parse(n);if(e.expires>Date.now())try{this.getUser(),this.token=e}catch(t){console.error(t)}},login(){window.location.replace(H0e)},logout(){this.token={accessToken:"",expires:0},localStorage.removeItem(Hy)},parseRouterPath(n){n=n||"",n.startsWith("/")&&(n=n.substring(1));const e=n.split("&"),t={accessToken:"",expires:0};for(let i of e){const s=i.split("=");if(s.length<2)continue;const r=s[0],o=s[1];switch(r){case"access_token":t.accessToken=o;break;case"expires_in":t.expires=Number.parseInt(o)*1e3+Date.now();break}}t.accessToken&&t.accessToken!==this.token.accessToken&&(this.token=t,localStorage.setItem(Hy,JSON.stringify(t)),this.getUser())},async fetch(n,e="get"){return fetch(n,{method:e,headers:{Authorization:`Bearer ${this.token.accessToken}`},mode:"cors"})},async getUser(){const n=await this.fetch("https://api.sketchfab.com/v3/me");this.user=await n.json()},async getModelDownloadUrl(n){var r,o,a,l;const e=new URL(n).pathname.split("-"),t=e[e.length-1];if(!t)return;const i=await(await this.fetch(`https://api.sketchfab.com/v3/models/${t}/download`)).json(),s=await(await this.fetch(`https://api.sketchfab.com/v3/models/${t}`)).json();return{download:i,info:{name:s==null?void 0:s.name,url:s==null?void 0:s.viewerUrl,license:{name:(r=s==null?void 0:s.license)==null?void 0:r.label,url:(o=s==null?void 0:s.license)==null?void 0:o.url},user:{name:(a=s==null?void 0:s.user)==null?void 0:a.displayName,url:(l=s==null?void 0:s.user)==null?void 0:l.profileUrl}}}}});wk.loadLocalStorage();function xk(){return wk}u(xk,"useSketchfabClient");V0e(xk,"useSketchfabClient");var W0e=Object.defineProperty,Ak=u((n,e)=>W0e(n,"name",{value:e,configurable:!0}),"__name$1");function Mk(n,e=300){let t=Date.now(),i=0;function s(){const r=Date.now();i+=r-t,t=r;const o=Math.min(1,i/e);n(o),o<1&&requestAnimationFrame(s)}u(s,"step"),Ak(s,"step"),s()}u(Mk,"createTransitionAnimation");Ak(Mk,"createTransitionAnimation");var j0e=Object.defineProperty,mt=u((n,e)=>j0e(n,"name",{value:e,configurable:!0}),"__name");const Ig=".doll",Wy={description:"Figure Doll Model",accept:{"application/figure-doll-editor":[Ig]}},$E="figure-doll-editor-options";var X0e=zt({components:{ColorPicker:tR,FullscreenLoading:kV,InputBoolean:$o,InputNumber:Jn,LabelRange:e8,ModelNodeProperties:Jme,ModelTree:_ge,PopupDialog:g1,PopupMenu:jb,PopupMenuItem:qO,QuadView:Gge,SidePanel:qge},setup(){const n=u5(),e=xk(),t=Ge(),i=Ge(),s=new oA(function(){var z;(z=i.value)==null||z.update()}),r=Ge({showTools:!0,showModelTree:!0,showProperties:!0,showStatusBar:!0,modelTreePanelWidth:200,modelNodePropertiesPanelWidth:200,colorPanelX:250,colorPanelY:50}),o=Ge(!1),a=Ge(null);let l=null;const c=st(function(){var I;const z=(I=i.value)==null?void 0:I.model;return z?z.selected.length===0?zI.filter(L=>!L.canBeRoot||!L.showInList?!1:L.unique?!z.nodes.find(G=>G.type===L.name):!0):z.selected.length>1?[]:Yb(z.getSelectedNodes()[0]).filter(L=>L.showInList):[]}),h=st(function(){var I;const z=(I=i.value)==null?void 0:I.model;return z?z.getSelectedNodes().filter(L=>!Kn(L.type).fixed).length:!1});qi([a,()=>{var z,I;return(I=(z=i.value)==null?void 0:z.history)==null?void 0:I.dirty}],function([z,I]){z&&z.endsWith(Ig)&&(z=z.substring(0,z.length-Ig.length)),document.title=(z||"Untitled")+(I?"*":"")+" - Figure Doll Editor"},{immediate:!0}),qi([r,()=>{var z;return(z=i.value)==null?void 0:z.options}],function(){var z;localStorage.setItem($E,JSON.stringify({ui:r.value,options:(z=i.value)==null?void 0:z.options}))},{deep:!0}),m0(async function(){"showOpenFilePicker"in window||await ld(`This application is only available in Chrome or Edge.
Cannot open or save files in the current browser.`),e.parseRouterPath(n.currentRoute.value.fullPath),n.currentRoute.value.fullPath.length>1&&await n.push("/")});function f(){var z;(z=t.value)==null||z.focus()}u(f,"focus"),mt(f,"focus");function d(z,I,L,G,X){i.value=new cp(z,I,L,G,X);try{const se=localStorage.getItem($E);if(se){const de=JSON.parse(se);if("ui"in de&&Object.assign(r.value,de.ui),"options"in de){Object.assign(i.value.options,de.options);for(let me in i.value.options.tools){const ye=i.value.options.tools[me],pe=i.value.tools.find(Fe=>Fe.constructor.name===me);if(pe)for(let Fe in ye)pe[Fe]=ye[Fe]}}}}catch(se){console.error(se)}s.start(),window.ctx=i.value.readonlyRef()}u(d,"onCanvasMounted"),mt(d,"onCanvasMounted");function p(){var z;(z=i.value)==null||z.dispose(),i.value=void 0}u(p,"onBeforeCanvasUnmount"),mt(p,"onBeforeCanvasUnmount");function g(z){var I;((I=z==null?void 0:z.target)==null?void 0:I.tagName)!=="INPUT"&&(i.value.history.undo(),f())}u(g,"onUndo"),mt(g,"onUndo");function m(z){var I;((I=z==null?void 0:z.target)==null?void 0:I.tagName)!=="INPUT"&&(i.value.history.redo(),f())}u(m,"onRedo"),mt(m,"onRedo");async function v(){return i.value.history.dirty?await ZO(`Unsaved changes will be lost.
Are you sure you want to continue?`):!0}u(v,"historyConfirm"),mt(v,"historyConfirm");async function y(){await v()&&(a.value=null,l=null,i.value.reset(),f(),i.value.statusBarMessage="")}u(y,"onNew"),mt(y,"onNew");async function b(){try{[l]=await showOpenFilePicker({types:[Wy],multiple:!1})}catch{return}if(await v())try{i.value.statusBarMessage="Loading...",o.value=!0,await Vs();const z=await l.getFile();a.value=z.name;const I=new b1(new Uint8Array(await z.arrayBuffer())).read();i.value.load(I),f(),i.value.statusBarMessage=""}catch(z){console.error(z),i.value.statusBarMessage="Failed to open file."}finally{o.value=!1}}u(b,"onOpen"),mt(b,"onOpen");async function _(){await yk(i.value,o,Wy,Ig)}u(_,"onImport"),mt(_,"onImport");async function x(z){await pk(i.value,o,z)}u(x,"onExport"),mt(x,"onExport");async function w(z){z!=null&&z.shiftKey?await M():(l?await C():await M(),f())}u(w,"onSave"),mt(w,"onSave");async function M(){try{l=await showSaveFilePicker({types:[Wy],suggestedName:a.value||void 0})}catch{return}const z=await l.getFile();a.value=z.name,await C(),f()}u(M,"onSaveAs"),mt(M,"onSaveAs");async function C(){if(!!l)try{i.value.statusBarMessage="Saving...",o.value=!0,await Vs();const z=await l.createWritable({keepExistingData:!1}),I=new rA().write(i.value).getBytes();i.value.statusBarMessage="Writing files...",await Vs(),await z.write(I),await z.close(),i.value.history.save(),i.value.statusBarMessage="File saved."}catch{i.value.statusBarMessage="Failed to save file."}finally{o.value=!1}}u(C,"saveFile"),mt(C,"saveFile");function A(z){const I=i.value,G=I.views[I.mainViewIndex].camera;let X=G.alpha,se=G.beta;switch(z){case"front":X=0,se=-Math.PI/2,Math.abs(X-G.alpha)<1e-8&&Math.abs(se-G.beta)<1e-8&&(X=0,se=+Math.PI/2);break;case"back":X=0,se=+Math.PI/2,Math.abs(X-G.alpha)<1e-8&&Math.abs(se-G.beta)<1e-8&&(X=0,se=-Math.PI/2);break;case"top":X=-Math.PI/2,se=-Math.PI/2,Math.abs(X-G.alpha)<1e-8&&Math.abs(se-G.beta)<1e-8&&(X=+Math.PI/2,se=-Math.PI/2);break;case"bottom":X=+Math.PI/2,se=-Math.PI/2,Math.abs(X-G.alpha)<1e-8&&Math.abs(se-G.beta)<1e-8&&(X=-Math.PI/2,se=-Math.PI/2);break;case"right":X=0,se=0,Math.abs(X-G.alpha)<1e-8&&Math.abs(se-G.beta)<1e-8&&(X=0,se=Math.PI);break;case"left":X=0,se=Math.PI,Math.abs(X-G.alpha)<1e-8&&Math.abs(se-G.beta)<1e-8&&(X=0,se=0);break}const de=X-G.alpha,me=se-G.beta;Mk(function(ye){G.alpha=X-de*(1-ye),G.beta=se-me*(1-ye)},100)}u(A,"onSetView"),mt(A,"onSetView");function P(z,I,L){i.value.history.setValue(z,I,L)}u(P,"onSetValue"),mt(P,"onSetValue");function D(z,I){z=nt(z);const L=i.value;let X=nt(L.model).getSelectedNodes();const se=I==="before"||I==="after"?z.parent:z;X=X.filter(me=>{let ye=!0,pe=me.parent;for(;ye&&pe;){if(!pe.expanded){ye=!1;break}pe=pe.parent}return!ye||me.parent&&X.includes(me.parent)?!1:!Kn(me.type).fixed});for(let me of X)if(!de(se,me))return;for(let me of X){const ye=L.options.keepTransformUnchangedWhileMoving;I==="before"||I==="after"?L.history.moveNode(me,se,z,I==="after",ye):L.history.moveNode(me,se,null,I==="atLast",ye)}function de(me,ye){const pe=Kn(ye.type);if(!me)return pe.canBeRoot;if(!me.isValidChild(ye.type))return!1;for(;me;me=me.parent)if(me.id===ye.id)return!1;return!0}u(de,"isValidChild"),mt(de,"isValidChild")}u(D,"onMoveNode"),mt(D,"onMoveNode");function k(z){const I=i.value.model,L=I.selected[0];I.selected=[];const G={type:z,parentId:L},X=Kn(z);X.defaultData&&(G.data=X.defaultData),X.defaultChildren&&(G.children=X.defaultChildren),i.value.history.createNode(G),f()}u(k,"onAddNode"),mt(k,"onAddNode");function O(z){var G;if((z==null?void 0:z.key)==="Backspace"||((G=z==null?void 0:z.target)==null?void 0:G.tagName)==="INPUT"||!i.value.tool.enableDefaultDeleteShortcut&&(z==null?void 0:z.key)==="Delete")return;const L=i.value.model.getTopmostSelectedNodes();for(let X of L)Kn(X.type).fixed||i.value.history.removeNode(X.id);f()}u(O,"onDelete"),mt(O,"onDelete");function N(z){i.value.nextFrameEnd(function(){i.value.model.selected=z})}u(N,"onSelect"),mt(N,"onSelect");function E(z){const I=new Set;for(let L of z){let G=L.node;G.instanceId&&(Ki(L.type.name).instanceable||(G=i.value.model.getNode(G.instanceId)));const X=`${G.id}#${L.type.name}`;I.has(X)||(I.add(X),i.value.history.setValue(G,L.type,L.value))}}u(E,"onSetNodesProperties"),mt(E,"onSetNodesProperties");function B(z){if(!z)return;const I=new T;if(zu(I,z.getWorldMatrix()),z.has(Me)){const L=z.value(Me);if(L){const G=L.geometry;G&&(G.boundingSphere||G.computeBoundingSphere(),I.copy(G.boundingSphere.center),I.applyMatrix4(z.getWorldMatrix()))}}for(let L of i.value.views)L.camera.target.copy(I)}u(B,"onFocus"),mt(B,"onFocus");async function W(z){await KO(i.value,z)&&f()}u(W,"onCut"),mt(W,"onCut");async function Z(z){await sA(i.value,z)&&f()}u(Z,"onCopy"),mt(Z,"onCopy");async function ne(z){await QO(i.value,z)&&f()}u(ne,"onPaste"),mt(ne,"onPaste");function j(z){JO(i.value,z)}u(j,"onConvertToClay"),mt(j,"onConvertToClay");function ie(z){z=nt(z);const I=i.value,L=z.getLocalMatrix(),G=z.cloneValue(gn),X=new T;for(let se=0,de=G.length;se<de;se+=3)X.fromArray(G,se),X.applyMatrix4(L),G[se]=X.x,G[se+1]=X.y,G[se+2]=X.z;I.history.setValue(z,gn,G),I.history.setValue(z,Le,new T),I.history.setValue(z,Qe,new lt),I.history.setValue(z,Ft,1)}u(ie,"onApplyTransformation"),mt(ie,"onApplyTransformation");const K=st(function(){const z=i.value;if(!z)return!1;const I=z.model.selected[0];return I?z.model.getNode(I).type==="Clay":!1});async function $(){var se;const z=(se=i.value)==null?void 0:se.readonlyRef();if(!z)return;const I=z.model.selected[0];if(!I)return;const L=z.model.getNode(I),X=L.get(Me).mesh;if(!!X)try{o.value=!0,await Vs(),await new Promise(function(me){setTimeout(me,50)});const de=_k(X.aPosition,X.aColor,X.triBox,X.octree.box,z.options.remeshVoxelSize);z.history.enableMerge=!1,z.history.setValue(L,gn,de.position,"remesh-position"),z.history.setValue(L,yr,de.color,"remesh-color")}finally{o.value=!1}}u($,"onRemesh"),mt($,"onRemesh");function le(z,I){ik(i.value,z,I)}u(le,"onCreateInstance"),mt(le,"onCreateInstance");function ae(z,I){mk(i.value,z,I)}u(ae,"onFlip"),mt(ae,"onFlip");function J(z){return ek(z)}u(J,"onCopyPose"),mt(J,"onCopyPose");function te(z){return tk(i.value,z)}u(te,"onPastePose"),mt(te,"onPastePose");function ge(z){const I=i.value,L=I.model,G=I.views[I.mainViewIndex];G.zoomLevel=z.zoomLevel,G.camera.alpha=z.alpha,G.camera.beta=z.beta,G.camera.target.set(z.target[0],z.target[1],z.target[2]),L.cameraPerspective=z.perspective,L.cameraFov=z.fov}u(ge,"onLoadCamera"),mt(ge,"onLoadCamera");function he(z){i.value.model.cameras.splice(z,1),i.value.history.dirty=!0}u(he,"onDeleteCamera"),mt(he,"onDeleteCamera");function we(){const z=i.value,I=z.model,L=z.views[z.mainViewIndex];I.cameras.push({name:new Date().toISOString().replace("T"," ").replace(/\.[0-9]+Z/,""),zoomLevel:L.zoomLevel,alpha:L.camera.alpha,beta:L.camera.beta,target:[L.camera.target.x,L.camera.target.y,L.camera.target.z],perspective:I.cameraPerspective,fov:I.cameraFov}),z.history.dirty=!0}u(we,"onSaveCamera"),mt(we,"onSaveCamera");const xe=Ge("");async function Se(){await v()&&e.login()}u(Se,"onSketchfabLogin"),mt(Se,"onSketchfabLogin");function V(){e.logout()}u(V,"onSketchfabLogout"),mt(V,"onSketchfabLogout");const Y=Ge(!1),R=Ge(""),ee=Ge(""),Q=Ge(!1),U=Ge(0);async function F(){var z;if(!!xe.value)try{i.value.statusBarMessage="Fetching model download url...",o.value=!0;const{info:I,download:L}=await e.getModelDownloadUrl(xe.value);if((z=L.gltf)!=null&&z.url){xe.value="",i.value.statusBarMessage="Downloading model...",o.value=!1,Y.value=!0,Q.value=!1,U.value=0,R.value="0.0MB",ee.value=(L.gltf.size/1024/1024).toFixed(1)+"MB";const G=await bk(L.gltf.url,(X,se)=>{U.value=Math.round(X/se*100),R.value=(X/1024/1024).toFixed(1)+"MB"},Q,L.gltf.size);if(!G){i.value.statusBarMessage="Download canceled.";return}i.value.history.createNode({type:"ImportModel",data:{[Rt.name]:I.name,[Sd.name]:I,[Fo.name]:G}}),i.value.statusBarMessage="Model imported."}else i.value.statusBarMessage="Failed to download model.",L.detail?await ld("Could not download model: "+L.detail):await ld("Failed to get model download url.")}catch{i.value.statusBarMessage="Failed to import model."}finally{o.value=!1,Y.value=!1}}u(F,"onSketchfabImportModel"),mt(F,"onSketchfabImportModel");function H(){window.open("https://github.com/x6ud/figure-doll-editor/issues")}u(H,"onOpenFeedback"),mt(H,"onOpenFeedback");function re(){window.open("https://github.com/x6ud/figure-doll-editor#download-models")}return u(re,"onOpenTutorial"),mt(re,"onOpenTutorial"),{dom:t,sketchfabClient:e,editorCtx:i,fullscreenLoading:o,uiOptions:r,validChildNodeDefs:c,canDelete:h,canRemesh:K,sketchfabModelUrl:xe,downloadProgressDialog:Y,downloadProgressText:R,downloadTotalText:ee,downloadCancelFlag:Q,downloadProgressPercent:U,onCanvasMounted:d,onBeforeCanvasUnmount:p,onUndo:g,onRedo:m,onNew:y,onOpen:b,onImport:_,onExport:x,onSave:w,onSaveAs:M,onSetView:A,onSetValue:P,onMoveNode:D,onAddNode:k,onDelete:O,onSelect:N,onSetNodesProperties:E,onFocus:B,onCut:W,onCopy:Z,onPaste:ne,onConvertToClay:j,onApplyTransformation:ie,onRemesh:$,onCreateInstance:le,onFlip:ae,onCopyPose:J,onPastePose:te,onLoadCamera:ge,onDeleteCamera:he,onSaveCamera:we,onSketchfabLogin:Se,onSketchfabLogout:V,onSketchfabImportModel:F,onOpenFeedback:H,onOpenTutorial:re}}}),Y0e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAPYElEQVR42u1be1RU1ff/nLkz4Ixo4AM1FTF8P6CwfKJo9FIyAzEUtbQkDTMrM7Ny3XXTwge4VktSVrpKMzHSJMon6nKVpqQpShhCKC41zRe+ZgCZuXf//vh9z133ztwZEOlbra9nrVlc7p17ztmfs/c+n733GUZE+F9u7B4A9wC4B8A9AP7qJkkSAUBoaCjMZjMAQFGU/58AY7q/AGAymeBwOFBZWQmHw4G5c+eyfyUAXPAOHTogICAAsiwjMTGRAUBubi6NGjXKQ7CcnBwqLCxE9+7dUVxcrHsmiiL7VwAwf/58uv/++9GqVSvIsgxFUVBYWOghwO7du2nfvn0AgKioKDidTvz888/q97799lsSBAEjR45kmZmZdPHixQYHoUEBWLRoEYWFhcFsNsPf3x8AIAgCTCYTBEFQPyaTCXl5eYiJiUFUVBTbv38/DRw40Ktg27dvJ7vdjuPHj8NisUAQBMyZM4f9YwD4/PPPyWw2w2w2o7S0FP3794efnx+GDRvGuBm4t+HDh8NisYCIwBiDy+UCEUFRFPWv9kNEkGUZjz/+OAOApUuX0ptvvsn+VgCWL19OZrMZL7/8siqoKIps586dZLPZsGvXLoiiyCRJIq66x44dIwAgIgiCACJCeHg4KywsJMYYevfuzbT+g7fHHnsMu3btQr9+/VSzOn36NARBQEpKCvuvA5CZmUkmk0kVngs6ePBg7N27FyNGjMAjjzzCAODXX38lPk54eDgDgJKSEuratSsDgBMnTlC3bt0YABw/fpwYY+jRo4dOe3h/2nvh4eFQFAUVFRVITk5m/zUAFi9eTK1bt0Z5ebnufnR0NIYOHcokSaL4+Hj1/qZNmzyc1++//06dO3dmAFBWVkadOnXSrfxzzz0Hxhg4MMeOHaOIiAidNvHr7OxsIiI4nU5MnDiR/aUALFiwgNq0aYOAgACcOHFC3Z727t1LgwcPVoXnDq9r1666SQPA6dOnKTQ0lGm3y0mTJmH16tUeQJWWlhIAyLIMl8sFp9MJp9OJmpoa1NTU4Pbt26ipqcGzzz7L1q9fT+PGjfvrAOCrExISgsDAQMTFxTEA+Omnn2jQoEE6O+YqfurUKXrggQfUSZ07d47atWunU2VRFBm/7z5meXk5cUfYuXNnDzC1c+vduzcqKiowZcoU1uAAaCccGhqKFi1aIDY2lh04cIAGDBjACgsLidu3Vq0lSaKXXnoJXOjk5GSsXLnSY6X//PNPat26tXrv/PnzJMsy2rdvb9in+/tbt26lQ4cOAQCCg4PxyiuvsAYHQBRF9uWXX9KECRPYzp07qWnTpujXrx/j9qn9PldzDtzUqVMhCIJKe7XUt3nz5gwArly5QnwLbNWqlaEAZWVltG7dOkNSFRMTo/qGoKAgvPbaa6xBANAinpWVRe3atcOQIUNYQUEBMcbw4IMPegx09uxZ+uyzz1QVv3r1KjVv3pxVVFRQs2bNdPY/Y8YM9T0+n4yMDK/zGT9+PNxB4D5I22/jxo3x1ltvsQYDIDs7mxITE1l+fj75+fkhMjKSeTMVruocAK3gN27coPvuu8/j3evXr1NgYKBOGzgowcHBOr/BQeDtqaeewvbt2z3m7u/vj3feeYfdFQCpqak0d+5ctmHDBhozZgw7fPgw9enThxkJzlfl4sWL1KpVK9VetcIBwK1bt6hJkyYeE3O/rzUhbh6rVq2CKIpMu30WFBTQQw89pOtvxYoVZLfbUV1djXnz5rF6A5Cenk4dO3ZEfHw8O3jwIFksFnDq+/XXX3tEapIk0fTp09GiRQsGADdv3qSmTZt6TKCyspJsNpvuvsPhoMaNGzN3QN3Ni4PhdDqRlZWF0aNHo1evXmzPnj3kcDhgt9sxduxYlp6eTna73WsQVScAli1bRu3atUObNm3Qv39/da/v3bs3O3nyJIWFhTF3c9GqvLfVBoDq6mpq1KiR6rxmz56NJUuWeJ2w+w5w8uRJ4nGC3W6Hu2ZmZGTQ1atX6w/AypUrKTk5meXm5lJwcDDy8vIgiiL77bffqEePHoyvSPv27XXbE1d5u91O6enpPsPY27dv08KFCyGKItMCUhsA586dI5fLhdDQUFZSUkJfffWVhzZ++umndOHChfoDsGbNGmrWrBmCgoIQFRWldqLl8nwfFwQBLVu21Km9w+GgtLQ0jwm4EyGn00kWi4VxQPz9/b1qQEpKCmRZhpY3aGMKLUhr1qyh06dP1x+A9evXU9u2bTFkyBCPDrj6awe8du0aBQUFMbvdTiaTCTabzYO/e7Ntl8tFZrOZ1dTUkJ+fn8fzGzdukKIoCAoKMhSmuLiYunfvrhuna9euGDt2rFcGWSsA27ZtI6vViqFDhxrS1I4dO3p0fuvWLRIEAYwxWK1WD9rrazyXy0VEBK4NAFBVVUWKooA7R199HD9+nHr27Mk0gRjFx8fXD4DNmzeT1WoFZ1hG7cyZMxQSEuLxvKqqijjjM5lMKvszSoJ+8MEHunfff/99EJG67WnNoTYAioqKqFevXgwAtmzZQrGxsT53FJ8A5OXl0YEDB7yunCRJNGXKFLRt29bDvt9++20sXrwYc+fORWpqqs+VJ80kuOD8mmeDFi5cWOegLS4uDjk5ORg4cCD279/vM6nqE4Dt27eTv78/fvzxR0MnJooiu3DhArVp08bDvqurq2nRokUQRZG5XC5ijEEQhDpHabIsE/8+B1RRFDUbJMuyGkMYtaNHj9KNGzcQHR3N0tLSyOFw3DkAW7ZsIavVCn9/f5jNZvTr148ZqeHFixcpMzNTN4AWAP59RVHIZDLVCQRFUWj+/Pm6lTMaV5ZlNVcgyzK0zLCqqgrnz59HQkJC/XzA999/T0eOHMGwYcPU4Oe7776Du0dPSUlRtz9u/4sXL/Zgh//5nw/oc6+fN28e3MEyEsLdvouLi8nlcqmAPPzww8yX7/AKQE5ODsXFxTFJkigmJga7d+8GACQkJGDjxo26lbly5Qpx2lsHAFRzdwdBK4yRtvhygNpnRUVF5HK5UFNTg759+9bPCW7cuJG0qnPgwAHKy8sDACQlJUEQBGgzPVrqa8TxvUxeBcHouRaE2rw/zxW4XC41j5ifn0+culssFrz77rt1B4CHvtqM7/Dhw9G3b1+mDUp4xoYTICPhaxHAq0m4O0JvAJw9e5ZkWYY2ASOKolpwSU9Pp1mzZt0ZE8zKyqKkpCQdALGxsapNGaWyrl+/ThaLBY0bN64VAAO19DCJ2gC4dOkSybIMvgsZjbd37146evQoZsyYcWcArF27liZOnOhR2XnmmWfgHndfuXKFtOWvgIAArxPyZY+cD7D/sCROjd0BuH79OimKAm1myZtfiI6ORklJCaZOnVp3AFavXk2TJk3y2NslSaJRo0YZpsB4AMQYg1Ho661E5t5EUWR85XmAxIW32+1ERGjSpAmra39RUVE4c+YMJk+efHcaoF09ngtwF/D111+HyWRSqa87BXanwwYagAULFgAA3nvvPSiKgtTUVMyZMweKomDJkiV3VCqXJIkGDBiAy5cvY/z48XcGQGZmJgUFBcFsNqOoqEhHaCRJooSEBPCgwyjt5XA4CIDqD3ypvrvdczqsjQe0DJDv8S6XC0a1BO2ctm3bRna7HWPGjLkzAD755BOaPn06W7duHTVt2hQjR47UsSltQkSbBVq2bJluhSorKwmAunp1re/zPt0TJO7OsLy8nHi1yP1TU1MDp9MJRVHw9NNP3xkAH3/8Mc2cOZPx3WDHjh2Un5+vY4GJiYnIzs5WtUObBzQKjnhoXBsI2u944xS+wOTv79ixg1wuF2JjY+uXFeYJRZ5U2LNnDwmCoCZH3NNQly5douDgYK87QFVVFQGA1WplvqpPWpBnzZpluKv4osbR0dGQZRn79u1Dz549kZCQUD8AFi1aRNXV1RBFUU2JS5JETz75pJocHTduHLp06cKMyltGE+WJTyLS8QVvwrzxxhswyigbvZefn0+yLGPQoEHqWN26dVPPJd0xAB999BE5nU51Rb755hviDvHw4cO0efNmlRp37tyZ/fHHH+SeGzACgF/zbW3p0qVew233eoJRKygoIFmWsWXLFo/4o1OnTl53gFoBMLI1nmLiNXuTyYRGjRohKysLL774oq6Y6WtltbvKzZs3iYigrRYZpdfd+0hISICiKNi0aZPh9qjlM/WuDC1YsIAEQVDP6kmSRBERETh27JguBOXFEm3dv64hLG/Xrl0jRVGQkZGhPrt8+TItX75cN6ekpCQoiqKePdAKrx1v1apVVFupvM61QZvNhtmzZ6tn/I4ePaoToKysTJcD5EB4iwF8tZSUFHChp02bplaKy8vLiYjUKNSbafHrzMxMmjZt2t0DwDsNDAzEzJkzmSRJFBkZiZEjR+oEGzt2rFoCt1gsHmzQqDRuxAaJCCaTSb3mJKhDhw668R599FHdKZHbt2/rrokIr776asMAwAdt2bIlLl++DADo06ePjmBoU9JlZWVERMjKyjIkQL5OeoiiyM6fP09aAHiWR0tyeIrOvb8VK1aQLMu1Cl+vM0KSJFHbtm0hCAImT57MeOqZJyK1gZIkSZSUlKSupLaS5Ms5au+dOnWK1q5d62HfRvNq3749ZFnG1atXfZbE7woAPpjFYkFISAgmTJjAtm7dSiNGjGCHDh2irVu3eiQxud0nJiaCiKCt3nhLePJWWlpK69ev9xkErVu3jmRZxvPPP18npnnXAPAJ+/n5ISwsDAEBARgxYoSagfHm5fn9hIQENcjh54q8OUsedLmDCQA9evSAoig4ceJErRrS4ADwSfr7+6NLly6wWq2w2WyIjo5mdeHq/HrUqFFQFAWRkZGGJTRuVlrhcnNziR/Ads8l3KkMDXJWeOHChcQYQ0REBARB0FVj6tpiY2OhKIou5wgABw8epG3btoGHtoqiIDY2lnGafjfCNxgAfFWtVivCw8N9JkGMaoP8dCkAPPHEE+oBacYYoqKi2K5du0hRFFy6dAnV1dWoqqpCRUXFXQne4ABoQQgJCUFJSQkiIyN1J75Hjx5tuAv88MMPutogbyaTCbIso7KyEr/88gtqyyn+7QBoD1W88MILHpmgDRs2kBYQbZBi5AQjIyNx5MgRiKLIPvzwQ3K5XP/sH0xoW0ZGBjkcDmjt1N1hffHFF8RZ3rlz53QrHBYWhpMnT8Jms0GW5Trv6/8YAAAgLS2NjGze6J7NZlM1Q5Zl+Pn5weFwoCF+FPG3AfBvaPcAuAfAPQD+twH4PyYSYSaTaCiyAAAAAElFTkSuQmCC",q0e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAZNJREFUOI3Fk79rU1EUxz/nvgZiqkMRgkKGDMlQCDRgXbpZgrSIQ5ZM/gHB3exFcLB0kQ6OLkIgW6wubdA2mTIEApVAoWPgpQ/E16bxx+u7xyHk0Te1kMEDl8s5XD7fc773XpgzRFXnAph5O5gbIMCLTCazk0wmbwUbj8cT13UPgS1VPQV43+v19DYxGo3U8zxtt9uay+V+AMsGEBGZ4v8GcHwK/hiCKzg+Af8iUi8Wi5N0Ov21Xq/TaDSWROTNQqy/tx/g+wnccWBpEUYu3EvCzmtIpQA8a+26iHyp1Wqb+Xz+SRzgDcG5hCCEMw9MCJMLOPdngMg7x3FIJBIJA2j0FjbWwEzA/ALzB+QKVh/Bg4cwPXhfRPaq1eqG7/sMBoOjhRhg8ylc/oRPzWm+UoTqy0i20+ncdRznmeu6lMtl31r7CmC32+3G7f68p7r7TjUIYuVSqWSz2ewZ8BHIz4S3W63WjVc4HA5VRPZVletLgMeFQuFbpVJJGWNms0a7tZYwDGk2m7/7/f5zVT2IufnfP9M/jW8Tm1+fCIsAAAAASUVORK5CYII=",Z0e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFBJREFUOI1jYBgF6OA/FFBsCDJNH0P+owGyDaGKS3BppqohuAxjwmUgIyMjIy4+0QYhA0YoICmqsXkNH5skw8gyBJ8GQobgDEB0jYQCe/ABAKCQl4Lg46L9AAAAAElFTkSuQmCC",K0e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFRJREFUOI3lkjsOACAIQ8V4/yvXCUIMH4kbdqWUl5Qx2oq8AQCky0Syv6IQbaweEZNn9uZkmSIxJQBo4pkiXqpxkFl/JK+QMhE3df5YuX4r5InoI21GkSwM7aEiTgAAAABJRU5ErkJggg==",Q0e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAC5JREFUOI1jYBgFwxT8////PyE1TNSyjGoGMeKSwOcdRkZGnPrwgqEZRqOAjgAAfNwMAvOaLCwAAAAASUVORK5CYII=",J0e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAADBJREFUOI1jYBgFgwf8hwKKDcHGJtsQYgxjIsuWkWUQXkCVWEM2gGJDRgEDAwMDAwA87SfhU+Y3UgAAAABJRU5ErkJggg==",e1e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAACJJREFUOI1jYBgFo2AQAUZcEv////+PUxMjI059o2AUUAIA4coEAgSS2PIAAAAASUVORK5CYII=",t1e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAEVJREFUOI1jYBi2gBGf5P////+jKGZkxKseqwHohuATJ8oVxKphIsp0UgHRzsailmouGnwGYYDBFWvINpKaIGmbRYYHAAC8Mj/Vvda64QAAAABJRU5ErkJggg==",n1e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAGFJREFUOI3dk0EOwCAIBMH0/19er4ILKqaHlqOsw6hR5LelWRMATFg1zNOGB0ybCLBVICwzgaplQCubzOodox2Ta1AGESHPz+7JQwDArz2V6VtGoxUziQYffZHQpnCCD1UHNO0sGtTVHO8AAAAASUVORK5CYII=";const Ji=u(n=>(Fa("data-v-68c59bc7"),n=n(),za(),n),"_withScopeId"),i1e={class:"toolbar"},s1e={class:"properties"},r1e={class:"cols",style:{"align-items":"center","margin-bottom":"8px"}},o1e={class:"cols",style:{"align-items":"center"}},a1e=Ji(()=>ue("div",{class:"fill"},null,-1)),l1e={style:{"margin-right":"4px"}},c1e={class:"properties"},u1e={class:"cols",style:{"align-items":"center","margin-bottom":"8px"}},h1e=Ji(()=>ue("div",{style:{"margin-right":"4px"}},"FOV",-1)),f1e={class:"camera-list"},d1e={class:"item"},p1e=["onClick"],m1e=["onClick"],g1e=Ji(()=>ue("div",{class:"properties cols"},[ue("div",null,[ue("img",{src:Y0e,alt:""})]),ue("div",{style:{padding:"4px 6px 4px 8px"}},[ue("div",{style:{"margin-bottom":"6px"}},[ue("span",{style:{"font-size":"16px","font-weight":"bold"}}," Figure Doll Editor "),Mo(" Ver 20230322 ")]),ue("div",{style:{"margin-bottom":"6px"}},"Author: x6udpngx"),ue("div",{style:{"margin-bottom":"6px"}},[ue("a",{href:"https://github.com/x6ud/figure-doll-editor",target:"_blank"}," Source ")]),ue("div",null,[ue("a",{href:"https://ko-fi.com/x6udpngx",target:"_blank"},[ue("img",{src:q0e,alt:"",style:{"vertical-align":"text-bottom"}}),Mo(" Support Me on Ko-fi ")])])])],-1)),v1e=Ji(()=>ue("div",{class:"separator"},null,-1)),y1e=Ji(()=>ue("img",{src:Z0e,alt:""},null,-1)),_1e=[y1e],b1e=Ji(()=>ue("img",{src:K0e,alt:""},null,-1)),w1e=[b1e],x1e={key:1,class:"button-group cols",style:{"margin-right":"6px"},title:"Direction"},A1e=Ji(()=>ue("img",{src:Q0e,alt:""},null,-1)),M1e=[A1e],S1e=Ji(()=>ue("img",{src:J0e,alt:""},null,-1)),C1e=[S1e],E1e=Ji(()=>ue("img",{src:e1e,alt:""},null,-1)),T1e=[E1e],P1e={class:"properties"},R1e={class:"property inline"},I1e=Ji(()=>ue("label",null,"Voxel size",-1)),D1e=Ji(()=>ue("span",null,"\xA0m",-1)),L1e=Ji(()=>ue("div",{class:"fill"},null,-1)),O1e={class:"button-group cols"},k1e=Ji(()=>ue("img",{src:t1e,alt:""},null,-1)),N1e=[k1e],F1e=Ji(()=>ue("img",{src:n1e,alt:""},null,-1)),z1e=[F1e],B1e={class:"cols fill"},U1e={key:0,class:"tools scrollable"},$1e={class:"scroll"},V1e={key:0},G1e={key:0},H1e=["title","onClick"],W1e=["src"],j1e={key:0,class:"rows",style:{width:"100%",height:"100%"}},X1e=["disabled"],Y1e={key:0,class:"status-bar cols"},q1e=Ji(()=>ue("div",{class:"fill"},null,-1)),Z1e={class:"cols",style:{"align-items":"center"}},K1e={class:"progress-bar",style:{width:"260px","margin-right":"4px"}},Q1e={class:"text"};function J1e(n,e,t,i,s,r){var b,_,x;const o=pn("popup-menu-item"),a=pn("popup-menu"),l=pn("input-number"),c=pn("input-boolean"),h=pn("label-range"),f=pn("model-tree"),d=pn("side-panel"),p=pn("model-node-properties"),g=pn("quad-view"),m=pn("color-picker"),v=pn("popup-dialog"),y=pn("fullscreen-loading");return Ce(),Be(Nt,null,[ue("div",{class:"container rows",tabindex:"0",onKeydown:[e[44]||(e[44]=En(Fn((...w)=>n.onUndo&&n.onUndo(...w),["ctrl"]),["z"])),e[45]||(e[45]=En(Fn((...w)=>n.onRedo&&n.onRedo(...w),["ctrl"]),["y"])),e[46]||(e[46]=En(Fn((...w)=>n.onOpen&&n.onOpen(...w),["ctrl","prevent"]),["o"])),e[47]||(e[47]=En(Fn((...w)=>n.onSave&&n.onSave(...w),["ctrl","prevent"]),["s"])),e[48]||(e[48]=En(Fn((...w)=>n.onCut&&n.onCut(...w),["ctrl"]),["x"])),e[49]||(e[49]=En(Fn((...w)=>n.onCopy&&n.onCopy(...w),["ctrl"]),["c"])),e[50]||(e[50]=En(Fn((...w)=>n.onPaste&&n.onPaste(...w),["ctrl"]),["v"])),e[51]||(e[51]=En((...w)=>n.onDelete&&n.onDelete(...w),["delete"]))],onContextmenu:e[52]||(e[52]=Fn(()=>{},["prevent"])),ref:"dom"},[ue("div",i1e,[n.editorCtx?(Ce(),Be(Nt,{key:0},[Ee(a,{title:"File"},{default:an(()=>[Ee(o,{title:"New",onClick:n.onNew},null,8,["onClick"]),Ee(o,{title:"Open",popup:"",hotkey:"Ctrl+O",onClick:n.onOpen},null,8,["onClick"]),Ee(o,{sep:""}),Ee(o,{title:"Save",hotkey:"Ctrl+S",onClick:n.onSave},null,8,["onClick"]),Ee(o,{title:"Save As",popup:"",hotkey:"Shirt+Ctrl+S",onClick:n.onSaveAs},null,8,["onClick"]),Ee(o,{sep:""}),Ee(o,{title:"Import",popup:"",onClick:n.onImport},null,8,["onClick"]),Ee(o,{title:"Export"},{default:an(()=>[Ee(a,null,{default:an(()=>[Ee(o,{title:"glTF 2.0 Binary (.glb)",popup:"",onClick:e[0]||(e[0]=w=>n.onExport("glb"))}),Ee(o,{title:"Wavefront (.obj)",popup:"",onClick:e[1]||(e[1]=w=>n.onExport("obj"))})]),_:1})]),_:1})]),_:1}),Ee(a,{title:"Edit"},{default:an(()=>[Ee(o,{title:"Undo",hotkey:"Ctrl+Z",onClick:n.onUndo},null,8,["onClick"]),Ee(o,{title:"Redo",hotkey:"Ctrl+Y",onClick:n.onRedo},null,8,["onClick"]),Ee(o,{sep:""}),Ee(o,{title:"Cut",hotkey:"Ctrl+X",onClick:n.onCut},null,8,["onClick"]),Ee(o,{title:"Copy",hotkey:"Ctrl+C",onClick:n.onCopy},null,8,["onClick"]),Ee(o,{title:"Paste",hotkey:"Ctrl+V",onClick:n.onPaste},null,8,["onClick"]),Ee(o,{title:"Delete",hotkey:"Delete",onClick:n.onDelete},null,8,["onClick"]),Ee(o,{sep:""}),Ee(o,{title:"Moving Nodes: Keep World Position Unchanged",onClick:e[2]||(e[2]=w=>n.editorCtx.options.keepTransformUnchangedWhileMoving=!n.editorCtx.options.keepTransformUnchangedWhileMoving),checked:n.editorCtx.options.keepTransformUnchangedWhileMoving},null,8,["checked"]),Ee(o,{sep:""}),Ee(o,{title:"Selecting: Allow Clicking Negative Objects",onClick:e[3]||(e[3]=w=>n.editorCtx.options.allowSelectingInvisibleObjectByClicking=!n.editorCtx.options.allowSelectingInvisibleObjectByClicking),checked:n.editorCtx.options.allowSelectingInvisibleObjectByClicking},null,8,["checked"]),Ee(o,{sep:""}),Ee(o,{title:"Transform: Use Local Space for Controls",onClick:e[4]||(e[4]=w=>n.editorCtx.options.useLocalSpaceForTransformControl=!n.editorCtx.options.useLocalSpaceForTransformControl),checked:n.editorCtx.options.useLocalSpaceForTransformControl},null,8,["checked"]),Ee(o,{title:"Transform: Take Geometry Center as Origin",onClick:e[5]||(e[5]=w=>n.editorCtx.options.takeGeometryCenterAsTransformOrigin=!n.editorCtx.options.takeGeometryCenterAsTransformOrigin),checked:n.editorCtx.options.takeGeometryCenterAsTransformOrigin},null,8,["checked"]),Ee(o,{sep:""}),Ee(o,{title:"IK Binding: Allow Modification of Joint Length",onClick:e[6]||(e[6]=w=>n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk=!n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk),checked:n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk},null,8,["checked"]),Ee(o,{title:"IK Binding: Keep Internal Object Position Unchanged",onClick:e[7]||(e[7]=w=>n.editorCtx.options.keepInternalTransformWhenBindingIk=!n.editorCtx.options.keepInternalTransformWhenBindingIk),checked:n.editorCtx.options.keepInternalTransformWhenBindingIk},null,8,["checked"]),Ee(o,{sep:""}),Ee(o,{title:"Stretching Joints: Keep Both Ends of Clay Nodes Unchanged",onClick:e[8]||(e[8]=w=>n.editorCtx.options.keepBothEndsOfClayNodesWhenStretching=!n.editorCtx.options.keepBothEndsOfClayNodesWhenStretching),checked:n.editorCtx.options.keepBothEndsOfClayNodesWhenStretching},null,8,["checked"])]),_:1}),Ee(a,{title:"View"},{default:an(()=>[Ee(o,{title:"Window"},{default:an(()=>[Ee(a,null,{default:an(()=>[Ee(o,{title:"Tools",checked:n.uiOptions.showTools,onClick:e[9]||(e[9]=w=>n.uiOptions.showTools=!n.uiOptions.showTools)},null,8,["checked"]),Ee(o,{title:"Nodes Panel",checked:n.uiOptions.showModelTree,onClick:e[10]||(e[10]=w=>n.uiOptions.showModelTree=!n.uiOptions.showModelTree)},null,8,["checked"]),Ee(o,{title:"Properties Panel",checked:n.uiOptions.showProperties,onClick:e[11]||(e[11]=w=>n.uiOptions.showProperties=!n.uiOptions.showProperties)},null,8,["checked"]),Ee(o,{title:"Status Bar",checked:n.uiOptions.showStatusBar,onClick:e[12]||(e[12]=w=>n.uiOptions.showStatusBar=!n.uiOptions.showStatusBar)},null,8,["checked"])]),_:1})]),_:1}),Ee(o,{sep:""}),Ee(o,{title:"Quad Views",checked:n.editorCtx.options.quadView,onClick:e[13]||(e[13]=w=>n.editorCtx.options.quadView=!n.editorCtx.options.quadView)},null,8,["checked"]),Ee(o,{title:"Outline Selected",checked:n.editorCtx.options.outlineSelected,onClick:e[14]||(e[14]=w=>n.editorCtx.options.outlineSelected=!n.editorCtx.options.outlineSelected)},null,8,["checked"]),Ee(o,{sep:""}),Ee(o,{title:"Grids",checked:n.editorCtx.options.showGrids,onClick:e[15]||(e[15]=w=>n.editorCtx.options.showGrids=!n.editorCtx.options.showGrids)},null,8,["checked"]),Ee(o,{title:"Light Indicators",checked:n.editorCtx.options.showLightHelpers,onClick:e[16]||(e[16]=w=>n.editorCtx.options.showLightHelpers=!n.editorCtx.options.showLightHelpers)},null,8,["checked"]),Ee(o,{title:"IK Joint Indicators",checked:n.editorCtx.options.showIkBones,onClick:e[17]||(e[17]=w=>n.editorCtx.options.showIkBones=!n.editorCtx.options.showIkBones)},null,8,["checked"])]),_:1}),Ee(a,{title:"Sketchfab","dynamic-size":""},{default:an(()=>[ue("div",s1e,[n.sketchfabClient.token.accessToken?(Ce(),Be(Nt,{key:0},[ue("div",r1e,[ru(ue("input",{type:"text",placeholder:"Sketchfab Model URL",style:{"margin-right":"4px",width:"260px"},"onUpdate:modelValue":e[18]||(e[18]=w=>n.sketchfabModelUrl=w),onKeydown:e[19]||(e[19]=En((...w)=>n.onSketchfabImportModel&&n.onSketchfabImportModel(...w),["enter"]))},null,544),[[$T,n.sketchfabModelUrl]]),ue("button",{class:"normal-button",style:{"font-size":"8px",padding:"2px 6px"},onClick:e[20]||(e[20]=(...w)=>n.onSketchfabImportModel&&n.onSketchfabImportModel(...w))}," Import ")]),ue("div",o1e,[a1e,ue("div",l1e,Tn(n.sketchfabClient.user.displayName),1),ue("button",{class:"normal-button",onClick:e[21]||(e[21]=(...w)=>n.onSketchfabLogout&&n.onSketchfabLogout(...w)),style:{"font-size":"8px",padding:"2px 6px"}}," Logout ")])],64)):(Ce(),Be("button",{key:1,class:"normal-button",onClick:e[22]||(e[22]=(...w)=>n.onSketchfabLogin&&n.onSketchfabLogin(...w))}," Sketchfab Login "))])]),_:1}),Ee(a,{title:"Camera","dynamic-size":""},{default:an(()=>[ue("div",c1e,[ue("div",u1e,[h1e,Ee(l,{style:{width:"4em","margin-right":"8px"},min:4,max:90,value:n.editorCtx.model.cameraFov,onInput:e[23]||(e[23]=w=>n.editorCtx.model.cameraFov=w)},null,8,["value"]),Ee(c,{label:"Orthographic",value:!n.editorCtx.model.cameraPerspective,onInput:e[24]||(e[24]=w=>n.editorCtx.model.cameraPerspective=!w)},null,8,["value"])]),ue("div",f1e,[(Ce(!0),Be(Nt,null,Ta(n.editorCtx.model.cameras,(w,M)=>(Ce(),Be("div",d1e,[ue("div",{class:"name normal-button",onClick:C=>n.onLoadCamera(w)},Tn(w.name),9,p1e),ue("button",{class:"icon-button",onClick:C=>n.onDeleteCamera(M)},"\xD7",8,m1e)]))),256))]),ue("button",{class:"normal-button",style:{width:"100%","margin-top":"4px"},onClick:e[25]||(e[25]=(...w)=>n.onSaveCamera&&n.onSaveCamera(...w))}," Save Current ")])]),_:1}),Ee(a,{title:"About","dynamic-size":""},{default:an(()=>[g1e]),_:1}),ue("button",{class:"popup-menu-trigger",onClick:e[26]||(e[26]=(...w)=>n.onOpenFeedback&&n.onOpenFeedback(...w)),style:{cursor:"pointer"}}," Feedback "),ue("button",{class:"popup-menu-trigger",onClick:e[27]||(e[27]=(...w)=>n.onOpenTutorial&&n.onOpenTutorial(...w)),style:{cursor:"pointer"}}," Tutorial "),n.editorCtx.tool.sculpt?(Ce(),Be(Nt,{key:0},[v1e,Ee(h,{style:{"margin-right":"6px"},value:n.editorCtx.tool.brushRadius,"onUpdate:value":e[28]||(e[28]=w=>n.editorCtx.tool.brushRadius=w),label:"Radius",min:1,max:200,step:1,"fraction-digits":0},null,8,["value"]),n.editorCtx.tool.hasHardness?(Ce(),sn(h,{key:0,style:{"margin-right":"6px"},value:n.editorCtx.tool.brushHardness,"onUpdate:value":e[29]||(e[29]=w=>n.editorCtx.tool.brushHardness=w),label:"Hardness",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"])):tt("",!0),Ee(h,{style:{"margin-right":"2px"},value:n.editorCtx.tool.brushStrength,"onUpdate:value":e[30]||(e[30]=w=>n.editorCtx.tool.brushStrength=w),label:"Strength",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"]),ue("button",{class:bn(["normal-button toggle-button",{active:n.editorCtx.options.enablePressure}]),title:"Enable Tablet Pressure Sensitivity",style:{"margin-right":"6px",padding:"0"},onClick:e[31]||(e[31]=w=>n.editorCtx.options.enablePressure=!n.editorCtx.options.enablePressure)},_1e,2),ue("button",{class:bn(["normal-button toggle-button",{active:n.editorCtx.tool.frontFacesOnly}]),title:"Front Faces Only",style:{"margin-right":"6px",padding:"0"},onClick:e[32]||(e[32]=w=>n.editorCtx.tool.frontFacesOnly=!n.editorCtx.tool.frontFacesOnly)},w1e,2),n.editorCtx.tool.hasDirection?(Ce(),Be("div",x1e,[ue("button",{class:bn(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===1}]),style:{padding:"0"},onClick:e[33]||(e[33]=w=>n.editorCtx.tool.brushDirection=1)},M1e,2),n.editorCtx.tool.hasThirdDirection?(Ce(),Be("button",{key:0,class:bn(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===0}]),style:{padding:"0"},onClick:e[34]||(e[34]=w=>n.editorCtx.tool.brushDirection=0)},C1e,2)):tt("",!0),ue("button",{class:bn(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===-1}]),style:{padding:"0"},onClick:e[35]||(e[35]=w=>n.editorCtx.tool.brushDirection=-1)},T1e,2)])):tt("",!0),n.canRemesh?(Ce(),sn(a,{key:2,title:"Remesh","class-name":"normal-button dropdown"},{default:an(()=>[ue("div",P1e,[ue("div",R1e,[I1e,Ee(l,{class:"value",style:{width:"6em"},min:1e-4,max:1,value:n.editorCtx.options.remeshVoxelSize,onInput:e[36]||(e[36]=w=>n.editorCtx.options.remeshVoxelSize=w)},null,8,["min","value"]),D1e]),ue("button",{class:"normal-button",style:{width:"100%"},onClick:e[37]||(e[37]=(...w)=>n.onRemesh&&n.onRemesh(...w))}," Remesh ")])]),_:1})):tt("",!0)],64)):tt("",!0),L1e,ue("div",O1e,[ue("button",{class:bn(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="solid"}]),title:"Shadow Off",style:{padding:"0"},onClick:e[38]||(e[38]=w=>n.editorCtx.options.shadingMode="solid")},N1e,2),ue("button",{class:bn(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="rendered"}]),title:"Shadow On",style:{padding:"0"},onClick:e[39]||(e[39]=w=>n.editorCtx.options.shadingMode="rendered")},z1e,2)])],64)):tt("",!0)]),ue("div",B1e,[n.uiOptions.showTools?(Ce(),Be("div",U1e,[ue("div",$1e,[n.editorCtx?(Ce(),Be("div",V1e,[(Ce(!0),Be(Nt,null,Ta(n.editorCtx.tools,w=>(Ce(),Be(Nt,null,[w.sep?(Ce(),Be("hr",G1e)):tt("",!0),w.sep?tt("",!0):(Ce(),Be("button",{key:1,class:bn(["tool icon-button toggle-button",{active:n.editorCtx.tool===w}]),title:w.label,onClick:M=>n.editorCtx.tool=w},[ue("img",{src:w.icon,alt:""},null,8,W1e)],10,H1e))],64))),256))])):tt("",!0)])])):tt("",!0),n.uiOptions.showModelTree?(Ce(),sn(d,{key:1,direction:"right",width:n.uiOptions.modelTreePanelWidth,"onUpdate:width":e[42]||(e[42]=w=>n.uiOptions.modelTreePanelWidth=w),style:{"border-left":"none"}},{default:an(()=>[n.editorCtx?(Ce(),Be("div",j1e,[ue("div",{class:"toolbar",onClick:e[41]||(e[41]=Fn(w=>n.onSelect([]),["self"]))},[Ee(a,{title:"Add",disabled:!n.validChildNodeDefs.length},{default:an(()=>[(Ce(!0),Be(Nt,null,Ta(n.validChildNodeDefs,w=>(Ce(),sn(o,{key:w.name,title:w.label,icon:w.icon,onClick:M=>n.onAddNode(w.name)},null,8,["title","icon","onClick"]))),128))]),_:1},8,["disabled"]),ue("button",{disabled:!n.canDelete,onClick:e[40]||(e[40]=(...w)=>n.onDelete&&n.onDelete(...w))}," Delete ",8,X1e)]),Ee(f,{class:"fill",model:n.editorCtx.model,onSelect:n.onSelect,onSetValue:n.onSetValue,onMoveNode:n.onMoveNode,onFocus:n.onFocus,onCut:n.onCut,onCopy:n.onCopy,onPaste:n.onPaste,onDelete:n.onDelete,onConvertToClay:n.onConvertToClay,onApplyTransformation:n.onApplyTransformation,onCreateInstance:n.onCreateInstance,onFlip:n.onFlip,onCopyPose:n.onCopyPose,onPastePose:n.onPastePose},null,8,["model","onSelect","onSetValue","onMoveNode","onFocus","onCut","onCopy","onPaste","onDelete","onConvertToClay","onApplyTransformation","onCreateInstance","onFlip","onCopyPose","onPastePose"])])):tt("",!0)]),_:1},8,["width"])):tt("",!0),n.uiOptions.showProperties?(Ce(),sn(d,{key:2,direction:"right",width:n.uiOptions.modelNodePropertiesPanelWidth,"onUpdate:width":e[43]||(e[43]=w=>n.uiOptions.modelNodePropertiesPanelWidth=w),style:{"border-left":"none"}},{default:an(()=>[n.editorCtx?(Ce(),sn(p,{key:0,"editor-context":n.editorCtx,onSetData:n.onSetNodesProperties},null,8,["editor-context","onSetData"])):tt("",!0)]),_:1},8,["width"])):tt("",!0),Ee(g,{class:"fill","editor-context":n.editorCtx,"quad-view":(_=(b=n.editorCtx)==null?void 0:b.options)==null?void 0:_.quadView,"main-view":(x=n.editorCtx)==null?void 0:x.mainViewIndex,onMounted:n.onCanvasMounted,onBeforeUnmount:n.onBeforeCanvasUnmount,onSetView:n.onSetView},null,8,["editor-context","quad-view","main-view","onMounted","onBeforeUnmount","onSetView"])]),n.uiOptions.showStatusBar&&n.editorCtx?(Ce(),Be("div",Y1e,[ue("div",null,Tn(n.editorCtx.statusBarMessage),1),q1e,ue("div",null,"FPS: "+Tn(n.editorCtx.fps),1)])):tt("",!0)],544),n.editorCtx?(Ce(),sn(v,{key:0,title:"Color",visible:n.editorCtx.tool.hasColor,x:n.uiOptions.colorPanelX,"onUpdate:x":e[54]||(e[54]=w=>n.uiOptions.colorPanelX=w),y:n.uiOptions.colorPanelY,"onUpdate:y":e[55]||(e[55]=w=>n.uiOptions.colorPanelY=w)},{default:an(()=>[Ee(m,{value:n.editorCtx.options.paintColor,"onUpdate:value":e[53]||(e[53]=w=>n.editorCtx.options.paintColor=w),"color-box":""},null,8,["value"])]),_:1},8,["visible","x","y"])):tt("",!0),n.downloadProgressDialog?(Ce(),sn(v,{key:1,visible:n.downloadProgressDialog,modal:"",title:"Downloading"},{default:an(()=>[ue("div",Z1e,[ue("div",K1e,[ue("div",{class:"progress",style:ti({width:`${n.downloadProgressPercent}%`})},null,4),ue("div",Q1e,Tn(n.downloadProgressText)+" / "+Tn(n.downloadTotalText),1)]),ue("button",{class:"normal-button",onClick:e[56]||(e[56]=w=>n.downloadCancelFlag=!0)},"Cancel")])]),_:1},8,["visible"])):tt("",!0),n.fullscreenLoading?(Ce(),sn(y,{key:2})):tt("",!0)],64)}u(J1e,"_sfc_render");var eve=Wt(X0e,[["render",J1e],["__scopeId","data-v-68c59bc7"]]);const tve=l5({history:MF(),routes:[{path:"/:pathMatch(.*)",component:eve}]}),aA=VT(iF),Sk=new hb;aA.config.errorHandler=function(n,e,t){Sk.dispatch(n)};aA.provide("errorSignal",Sk);aA.use(tve).mount("#app");
//# sourceMappingURL=index.b92d7ece.js.map
