var W1=Object.defineProperty;var kA=(n,e,t)=>e in n?W1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e)=>W1(n,"name",{value:e,configurable:!0});var M=(n,e,t)=>(kA(n,typeof e!="symbol"?e+"":e,t),t);const zA=u(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}u(t,"getFetchOpts");function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}u(i,"processPreload")},"polyfill");zA();function cg(n,e){const t=Object.create(null),i=n.split(",");for(let s=0;s<i.length;s++)t[i[s]]=!0;return e?s=>!!t[s.toLowerCase()]:s=>!!t[s]}u(cg,"makeMap");function Jn(n){if(Ye(n)){const e={};for(let t=0;t<n.length;t++){const i=n[t],s=ln(i)?HA(i):Jn(i);if(s)for(const r in s)e[r]=s[r]}return e}else{if(ln(n))return n;if(Ot(n))return n}}u(Jn,"normalizeStyle");const BA=/;(?![^(]*\))/g,UA=/:([^]+)/,VA=/\/\*.*?\*\//gs;function HA(n){const e={};return n.replace(VA,"").split(BA).forEach(t=>{if(t){const i=t.split(UA);i.length>1&&(e[i[0].trim()]=i[1].trim())}}),e}u(HA,"parseStringStyle");function qt(n){let e="";if(ln(n))e=n;else if(Ye(n))for(let t=0;t<n.length;t++){const i=qt(n[t]);i&&(e+=i+" ")}else if(Ot(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}u(qt,"normalizeClass");const GA="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",$A=cg(GA);function Yx(n){return!!n||n===""}u(Yx,"includeBooleanAttr");function WA(n,e){if(n.length!==e.length)return!1;let t=!0;for(let i=0;t&&i<n.length;i++)t=Xd(n[i],e[i]);return t}u(WA,"looseCompareArrays");function Xd(n,e){if(n===e)return!0;let t=j1(n),i=j1(e);if(t||i)return t&&i?n.getTime()===e.getTime():!1;if(t=Lc(n),i=Lc(e),t||i)return n===e;if(t=Ye(n),i=Ye(e),t||i)return t&&i?WA(n,e):!1;if(t=Ot(n),i=Ot(e),t||i){if(!t||!i)return!1;const s=Object.keys(n).length,r=Object.keys(e).length;if(s!==r)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!Xd(n[o],e[o]))return!1}}return String(n)===String(e)}u(Xd,"looseEqual");function jA(n,e){return n.findIndex(t=>Xd(t,e))}u(jA,"looseIndexOf");const $n=u(n=>ln(n)?n:n==null?"":Ye(n)||Ot(n)&&(n.toString===Zx||!it(n.toString))?JSON.stringify(n,qx,2):String(n),"toDisplayString"),qx=u((n,e)=>e&&e.__v_isRef?qx(n,e.value):Fa(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[i,s])=>(t[`${i} =>`]=s,t),{})}:qd(e)?{[`Set(${e.size})`]:[...e.values()]}:Ot(e)&&!Ye(e)&&!Qx(e)?String(e):e,"replacer"),Ut={},La=[],ss=u(()=>{},"NOOP"),XA=u(()=>!1,"NO"),YA=/^on[^a-z]/,Yd=u(n=>YA.test(n),"isOn"),ug=u(n=>n.startsWith("onUpdate:"),"isModelListener"),ri=Object.assign,hg=u((n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},"remove"),qA=Object.prototype.hasOwnProperty,xt=u((n,e)=>qA.call(n,e),"hasOwn"),Ye=Array.isArray,Fa=u(n=>lu(n)==="[object Map]","isMap"),qd=u(n=>lu(n)==="[object Set]","isSet"),j1=u(n=>lu(n)==="[object Date]","isDate"),it=u(n=>typeof n=="function","isFunction"),ln=u(n=>typeof n=="string","isString"),Lc=u(n=>typeof n=="symbol","isSymbol"),Ot=u(n=>n!==null&&typeof n=="object","isObject"),Kx=u(n=>Ot(n)&&it(n.then)&&it(n.catch),"isPromise"),Zx=Object.prototype.toString,lu=u(n=>Zx.call(n),"toTypeString"),KA=u(n=>lu(n).slice(8,-1),"toRawType"),Qx=u(n=>lu(n)==="[object Object]","isPlainObject"),dg=u(n=>ln(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,"isIntegerKey"),rd=cg(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Kd=u(n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},"cacheStringFunction"),ZA=/-(\w)/g,Ts=Kd(n=>n.replace(ZA,(e,t)=>t?t.toUpperCase():"")),QA=/\B([A-Z])/g,No=Kd(n=>n.replace(QA,"-$1").toLowerCase()),Zd=Kd(n=>n.charAt(0).toUpperCase()+n.slice(1)),Uf=Kd(n=>n?`on${Zd(n)}`:""),Fc=u((n,e)=>!Object.is(n,e),"hasChanged"),od=u((n,e)=>{for(let t=0;t<n.length;t++)n[t](e)},"invokeArrayFns"),_d=u((n,e,t)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value:t})},"def"),Oc=u(n=>{const e=parseFloat(n);return isNaN(e)?n:e},"toNumber");let X1;const JA=u(()=>X1||(X1=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{}),"getGlobalThis");let gs;class Jx{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=gs,!e&&gs&&(this.index=(gs.scopes||(gs.scopes=[])).push(this)-1)}run(e){if(this.active){const t=gs;try{return gs=this,e()}finally{gs=t}}}on(){gs=this}off(){gs=this.parent}stop(e){if(this.active){let t,i;for(t=0,i=this.effects.length;t<i;t++)this.effects[t].stop();for(t=0,i=this.cleanups.length;t<i;t++)this.cleanups[t]();if(this.scopes)for(t=0,i=this.scopes.length;t<i;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this.active=!1}}}u(Jx,"EffectScope");function e2(n,e=gs){e&&e.active&&e.effects.push(n)}u(e2,"recordEffectScope");const fg=u(n=>{const e=new Set(n);return e.w=0,e.n=0,e},"createDep"),eb=u(n=>(n.w&Fr)>0,"wasTracked"),tb=u(n=>(n.n&Fr)>0,"newTracked"),t2=u(({deps:n})=>{if(n.length)for(let e=0;e<n.length;e++)n[e].w|=Fr},"initDepMarkers"),n2=u(n=>{const{deps:e}=n;if(e.length){let t=0;for(let i=0;i<e.length;i++){const s=e[i];eb(s)&&!tb(s)?s.delete(n):e[t++]=s,s.w&=~Fr,s.n&=~Fr}e.length=t}},"finalizeDepMarkers"),ym=new WeakMap;let dc=0,Fr=1;const _m=30;let es;const To=Symbol(""),xm=Symbol("");class Qd{constructor(e,t=null,i){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,e2(this,i)}run(){if(!this.active)return this.fn();let e=es,t=Cr;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=es,es=this,Cr=!0,Fr=1<<++dc,dc<=_m?t2(this):Y1(this),this.fn()}finally{dc<=_m&&n2(this),Fr=1<<--dc,es=this.parent,Cr=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){es===this?this.deferStop=!0:this.active&&(Y1(this),this.onStop&&this.onStop(),this.active=!1)}}u(Qd,"ReactiveEffect");function Y1(n){const{deps:e}=n;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(n);e.length=0}}u(Y1,"cleanupEffect");let Cr=!0;const nb=[];function ul(){nb.push(Cr),Cr=!1}u(ul,"pauseTracking");function hl(){const n=nb.pop();Cr=n===void 0?!0:n}u(hl,"resetTracking");function Ri(n,e,t){if(Cr&&es){let i=ym.get(n);i||ym.set(n,i=new Map);let s=i.get(t);s||i.set(t,s=fg()),ib(s)}}u(Ri,"track");function ib(n,e){let t=!1;dc<=_m?tb(n)||(n.n|=Fr,t=!eb(n)):t=!n.has(es),t&&(n.add(es),es.deps.push(n))}u(ib,"trackEffects");function qs(n,e,t,i,s,r){const o=ym.get(n);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(t==="length"&&Ye(n)){const l=Oc(i);o.forEach((c,h)=>{(h==="length"||h>=l)&&a.push(c)})}else switch(t!==void 0&&a.push(o.get(t)),e){case"add":Ye(n)?dg(t)&&a.push(o.get("length")):(a.push(o.get(To)),Fa(n)&&a.push(o.get(xm)));break;case"delete":Ye(n)||(a.push(o.get(To)),Fa(n)&&a.push(o.get(xm)));break;case"set":Fa(n)&&a.push(o.get(To));break}if(a.length===1)a[0]&&bm(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);bm(fg(l))}}u(qs,"trigger");function bm(n,e){const t=Ye(n)?n:[...n];for(const i of t)i.computed&&q1(i);for(const i of t)i.computed||q1(i)}u(bm,"triggerEffects");function q1(n,e){(n!==es||n.allowRecurse)&&(n.scheduler?n.scheduler():n.run())}u(q1,"triggerEffect");const i2=cg("__proto__,__v_isRef,__isVue"),sb=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Lc)),s2=pg(),r2=pg(!1,!0),o2=pg(!0),K1=a2();function a2(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const i=Ze(this);for(let r=0,o=this.length;r<o;r++)Ri(i,"get",r+"");const s=i[e](...t);return s===-1||s===!1?i[e](...t.map(Ze)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){ul();const i=Ze(this)[e].apply(this,t);return hl(),i}}),n}u(a2,"createArrayInstrumentations");function pg(n=!1,e=!1){return u(function(i,s,r){if(s==="__v_isReactive")return!n;if(s==="__v_isReadonly")return n;if(s==="__v_isShallow")return e;if(s==="__v_raw"&&r===(n?e?M2:cb:e?lb:ab).get(i))return i;const o=Ye(i);if(!n&&o&&xt(K1,s))return Reflect.get(K1,s,r);const a=Reflect.get(i,s,r);return(Lc(s)?sb.has(s):i2(s))||(n||Ri(i,"get",s),e)?a:Hn(a)?o&&dg(s)?a:a.value:Ot(a)?n?ub(a):Tr(a):a},"get")}u(pg,"createGetter");const l2=rb(),c2=rb(!0);function rb(n=!1){return u(function(t,i,s,r){let o=t[i];if(Ha(o)&&Hn(o)&&!Hn(s))return!1;if(!n&&(!xd(s)&&!Ha(s)&&(o=Ze(o),s=Ze(s)),!Ye(t)&&Hn(o)&&!Hn(s)))return o.value=s,!0;const a=Ye(t)&&dg(i)?Number(i)<t.length:xt(t,i),l=Reflect.set(t,i,s,r);return t===Ze(r)&&(a?Fc(s,o)&&qs(t,"set",i,s):qs(t,"add",i,s)),l},"set")}u(rb,"createSetter");function u2(n,e){const t=xt(n,e);n[e];const i=Reflect.deleteProperty(n,e);return i&&t&&qs(n,"delete",e,void 0),i}u(u2,"deleteProperty");function h2(n,e){const t=Reflect.has(n,e);return(!Lc(e)||!sb.has(e))&&Ri(n,"has",e),t}u(h2,"has");function d2(n){return Ri(n,"iterate",Ye(n)?"length":To),Reflect.ownKeys(n)}u(d2,"ownKeys");const ob={get:s2,set:l2,deleteProperty:u2,has:h2,ownKeys:d2},f2={get:o2,set(n,e){return!0},deleteProperty(n,e){return!0}},p2=ri({},ob,{get:r2,set:c2}),mg=u(n=>n,"toShallow"),Jd=u(n=>Reflect.getPrototypeOf(n),"getProto");function Eu(n,e,t=!1,i=!1){n=n.__v_raw;const s=Ze(n),r=Ze(e);t||(e!==r&&Ri(s,"get",e),Ri(s,"get",r));const{has:o}=Jd(s),a=i?mg:t?yg:Nc;if(o.call(s,e))return a(n.get(e));if(o.call(s,r))return a(n.get(r));n!==s&&n.get(e)}u(Eu,"get$1");function Pu(n,e=!1){const t=this.__v_raw,i=Ze(t),s=Ze(n);return e||(n!==s&&Ri(i,"has",n),Ri(i,"has",s)),n===s?t.has(n):t.has(n)||t.has(s)}u(Pu,"has$1");function Iu(n,e=!1){return n=n.__v_raw,!e&&Ri(Ze(n),"iterate",To),Reflect.get(n,"size",n)}u(Iu,"size");function Z1(n){n=Ze(n);const e=Ze(this);return Jd(e).has.call(e,n)||(e.add(n),qs(e,"add",n,n)),this}u(Z1,"add");function Q1(n,e){e=Ze(e);const t=Ze(this),{has:i,get:s}=Jd(t);let r=i.call(t,n);r||(n=Ze(n),r=i.call(t,n));const o=s.call(t,n);return t.set(n,e),r?Fc(e,o)&&qs(t,"set",n,e):qs(t,"add",n,e),this}u(Q1,"set$1");function J1(n){const e=Ze(this),{has:t,get:i}=Jd(e);let s=t.call(e,n);s||(n=Ze(n),s=t.call(e,n)),i&&i.call(e,n);const r=e.delete(n);return s&&qs(e,"delete",n,void 0),r}u(J1,"deleteEntry");function ev(){const n=Ze(this),e=n.size!==0,t=n.clear();return e&&qs(n,"clear",void 0,void 0),t}u(ev,"clear");function Ru(n,e){return u(function(i,s){const r=this,o=r.__v_raw,a=Ze(o),l=e?mg:n?yg:Nc;return!n&&Ri(a,"iterate",To),o.forEach((c,h)=>i.call(s,l(c),l(h),r))},"forEach")}u(Ru,"createForEach");function Du(n,e,t){return function(...i){const s=this.__v_raw,r=Ze(s),o=Fa(r),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...i),h=t?mg:e?yg:Nc;return!e&&Ri(r,"iterate",l?xm:To),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[h(d[0]),h(d[1])]:h(d),done:f}},[Symbol.iterator](){return this}}}}u(Du,"createIterableMethod");function sr(n){return function(...e){return n==="delete"?!1:this}}u(sr,"createReadonlyMethod");function m2(){const n={get(r){return Eu(this,r)},get size(){return Iu(this)},has:Pu,add:Z1,set:Q1,delete:J1,clear:ev,forEach:Ru(!1,!1)},e={get(r){return Eu(this,r,!1,!0)},get size(){return Iu(this)},has:Pu,add:Z1,set:Q1,delete:J1,clear:ev,forEach:Ru(!1,!0)},t={get(r){return Eu(this,r,!0)},get size(){return Iu(this,!0)},has(r){return Pu.call(this,r,!0)},add:sr("add"),set:sr("set"),delete:sr("delete"),clear:sr("clear"),forEach:Ru(!0,!1)},i={get(r){return Eu(this,r,!0,!0)},get size(){return Iu(this,!0)},has(r){return Pu.call(this,r,!0)},add:sr("add"),set:sr("set"),delete:sr("delete"),clear:sr("clear"),forEach:Ru(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=Du(r,!1,!1),t[r]=Du(r,!0,!1),e[r]=Du(r,!1,!0),i[r]=Du(r,!0,!0)}),[n,t,e,i]}u(m2,"createInstrumentations");const[g2,v2,y2,_2]=m2();function gg(n,e){const t=e?n?_2:y2:n?v2:g2;return(i,s,r)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?i:Reflect.get(xt(t,s)&&s in i?t:i,s,r)}u(gg,"createInstrumentationGetter");const x2={get:gg(!1,!1)},b2={get:gg(!1,!0)},w2={get:gg(!0,!1)},ab=new WeakMap,lb=new WeakMap,cb=new WeakMap,M2=new WeakMap;function S2(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}u(S2,"targetTypeMap");function A2(n){return n.__v_skip||!Object.isExtensible(n)?0:S2(KA(n))}u(A2,"getTargetType");function Tr(n){return Ha(n)?n:vg(n,!1,ob,x2,ab)}u(Tr,"reactive");function C2(n){return vg(n,!1,p2,b2,lb)}u(C2,"shallowReactive");function ub(n){return vg(n,!0,f2,w2,cb)}u(ub,"readonly");function vg(n,e,t,i,s){if(!Ot(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const r=s.get(n);if(r)return r;const o=A2(n);if(o===0)return n;const a=new Proxy(n,o===2?i:t);return s.set(n,a),a}u(vg,"createReactiveObject");function Oa(n){return Ha(n)?Oa(n.__v_raw):!!(n&&n.__v_isReactive)}u(Oa,"isReactive");function Ha(n){return!!(n&&n.__v_isReadonly)}u(Ha,"isReadonly");function xd(n){return!!(n&&n.__v_isShallow)}u(xd,"isShallow");function hb(n){return Oa(n)||Ha(n)}u(hb,"isProxy");function Ze(n){const e=n&&n.__v_raw;return e?Ze(e):n}u(Ze,"toRaw");function db(n){return _d(n,"__v_skip",!0),n}u(db,"markRaw");const Nc=u(n=>Ot(n)?Tr(n):n,"toReactive"),yg=u(n=>Ot(n)?ub(n):n,"toReadonly");function fb(n){Cr&&es&&(n=Ze(n),ib(n.dep||(n.dep=fg())))}u(fb,"trackRefValue");function pb(n,e){n=Ze(n),n.dep&&bm(n.dep)}u(pb,"triggerRefValue");function Hn(n){return!!(n&&n.__v_isRef===!0)}u(Hn,"isRef");function ze(n){return mb(n,!1)}u(ze,"ref");function T2(n){return mb(n,!0)}u(T2,"shallowRef");function mb(n,e){return Hn(n)?n:new gb(n,e)}u(mb,"createRef");class gb{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:Ze(e),this._value=t?e:Nc(e)}get value(){return fb(this),this._value}set value(e){const t=this.__v_isShallow||xd(e)||Ha(e);e=t?e:Ze(e),Fc(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:Nc(e),pb(this))}}u(gb,"RefImpl");function Na(n){return Hn(n)?n.value:n}u(Na,"unref");const E2={get:(n,e,t)=>Na(Reflect.get(n,e,t)),set:(n,e,t,i)=>{const s=n[e];return Hn(s)&&!Hn(t)?(s.value=t,!0):Reflect.set(n,e,t,i)}};function vb(n){return Oa(n)?n:new Proxy(n,E2)}u(vb,"proxyRefs");var yb;class _b{constructor(e,t,i,s){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[yb]=!1,this._dirty=!0,this.effect=new Qd(e,()=>{this._dirty||(this._dirty=!0,pb(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=i}get value(){const e=Ze(this);return fb(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}u(_b,"ComputedRefImpl");yb="__v_isReadonly";function P2(n,e,t=!1){let i,s;const r=it(n);return r?(i=n,s=ss):(i=n.get,s=n.set),new _b(i,s,r||!s,t)}u(P2,"computed$1");function Er(n,e,t,i){let s;try{s=i?n(...i):n()}catch(r){ef(r,e,t)}return s}u(Er,"callWithErrorHandling");function rs(n,e,t,i){if(it(n)){const r=Er(n,e,t,i);return r&&Kx(r)&&r.catch(o=>{ef(o,e,t)}),r}const s=[];for(let r=0;r<n.length;r++)s.push(rs(n[r],e,t,i));return s}u(rs,"callWithAsyncErrorHandling");function ef(n,e,t,i=!0){const s=e?e.vnode:null;if(e){let r=e.parent;const o=e.proxy,a=t;for(;r;){const c=r.ec;if(c){for(let h=0;h<c.length;h++)if(c[h](n,o,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){Er(l,null,10,[n,o,a]);return}}I2(n,t,s,i)}u(ef,"handleError");function I2(n,e,t,i=!0){console.error(n)}u(I2,"logError");let kc=!1,wm=!1;const Un=[];let xs=0;const ka=[];let Gs=null,_o=0;const xb=Promise.resolve();let _g=null;function Bi(n){const e=_g||xb;return n?e.then(this?n.bind(this):n):e}u(Bi,"nextTick");function R2(n){let e=xs+1,t=Un.length;for(;e<t;){const i=e+t>>>1;zc(Un[i])<n?e=i+1:t=i}return e}u(R2,"findInsertionIndex");function xg(n){(!Un.length||!Un.includes(n,kc&&n.allowRecurse?xs+1:xs))&&(n.id==null?Un.push(n):Un.splice(R2(n.id),0,n),bb())}u(xg,"queueJob");function bb(){!kc&&!wm&&(wm=!0,_g=xb.then(Mb))}u(bb,"queueFlush");function D2(n){const e=Un.indexOf(n);e>xs&&Un.splice(e,1)}u(D2,"invalidateJob");function L2(n){Ye(n)?ka.push(...n):(!Gs||!Gs.includes(n,n.allowRecurse?_o+1:_o))&&ka.push(n),bb()}u(L2,"queuePostFlushCb");function tv(n,e=kc?xs+1:0){for(;e<Un.length;e++){const t=Un[e];t&&t.pre&&(Un.splice(e,1),e--,t())}}u(tv,"flushPreFlushCbs");function wb(n){if(ka.length){const e=[...new Set(ka)];if(ka.length=0,Gs){Gs.push(...e);return}for(Gs=e,Gs.sort((t,i)=>zc(t)-zc(i)),_o=0;_o<Gs.length;_o++)Gs[_o]();Gs=null,_o=0}}u(wb,"flushPostFlushCbs");const zc=u(n=>n.id==null?1/0:n.id,"getId"),F2=u((n,e)=>{const t=zc(n)-zc(e);if(t===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return t},"comparator");function Mb(n){wm=!1,kc=!0,Un.sort(F2);const e=ss;try{for(xs=0;xs<Un.length;xs++){const t=Un[xs];t&&t.active!==!1&&Er(t,null,14)}}finally{xs=0,Un.length=0,wb(),kc=!1,_g=null,(Un.length||ka.length)&&Mb()}}u(Mb,"flushJobs");function O2(n,e,...t){if(n.isUnmounted)return;const i=n.vnode.props||Ut;let s=t;const r=e.startsWith("update:"),o=r&&e.slice(7);if(o&&o in i){const h=`${o==="modelValue"?"model":o}Modifiers`,{number:d,trim:f}=i[h]||Ut;f&&(s=t.map(p=>ln(p)?p.trim():p)),d&&(s=t.map(Oc))}let a,l=i[a=Uf(e)]||i[a=Uf(Ts(e))];!l&&r&&(l=i[a=Uf(No(e))]),l&&rs(l,n,6,s);const c=i[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,rs(c,n,6,s)}}u(O2,"emit$1");function Sb(n,e,t=!1){const i=e.emitsCache,s=i.get(n);if(s!==void 0)return s;const r=n.emits;let o={},a=!1;if(!it(n)){const l=u(c=>{const h=Sb(c,e,!0);h&&(a=!0,ri(o,h))},"extendEmits");!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!r&&!a?(Ot(n)&&i.set(n,null),null):(Ye(r)?r.forEach(l=>o[l]=null):ri(o,r),Ot(n)&&i.set(n,o),o)}u(Sb,"normalizeEmitsOptions");function tf(n,e){return!n||!Yd(e)?!1:(e=e.slice(2).replace(/Once$/,""),xt(n,e[0].toLowerCase()+e.slice(1))||xt(n,No(e))||xt(n,e))}u(tf,"isEmitListener");let Gn=null,nf=null;function bd(n){const e=Gn;return Gn=n,nf=n&&n.type.__scopeId||null,e}u(bd,"setCurrentRenderingInstance");function ko(n){nf=n}u(ko,"pushScopeId");function zo(){nf=null}u(zo,"popScopeId");function kt(n,e=Gn,t){if(!e||n._n)return n;const i=u((...s)=>{i._d&&hv(-1);const r=bd(e);let o;try{o=n(...s)}finally{bd(r),i._d&&hv(1)}return o},"renderFnWithContext");return i._n=!0,i._c=!0,i._d=!0,i}u(kt,"withCtx");function Vf(n){const{type:e,vnode:t,proxy:i,withProxy:s,props:r,propsOptions:[o],slots:a,attrs:l,emit:c,render:h,renderCache:d,data:f,setupState:p,ctx:g,inheritAttrs:m}=n;let v,y;const w=bd(n);try{if(t.shapeFlag&4){const A=s||i;v=ys(h.call(A,A,d,r,p,f,g)),y=l}else{const A=e;v=ys(A.length>1?A(r,{attrs:l,slots:a,emit:c}):A(r,null)),y=e.props?l:N2(l)}}catch(A){wc.length=0,ef(A,n,1),v=Pe(Or)}let _=v;if(y&&m!==!1){const A=Object.keys(y),{shapeFlag:x}=_;A.length&&x&7&&(o&&A.some(ug)&&(y=k2(y,o)),_=Ga(_,y))}return t.dirs&&(_=Ga(_),_.dirs=_.dirs?_.dirs.concat(t.dirs):t.dirs),t.transition&&(_.transition=t.transition),v=_,bd(w),v}u(Vf,"renderComponentRoot");const N2=u(n=>{let e;for(const t in n)(t==="class"||t==="style"||Yd(t))&&((e||(e={}))[t]=n[t]);return e},"getFunctionalFallthrough"),k2=u((n,e)=>{const t={};for(const i in n)(!ug(i)||!(i.slice(9)in e))&&(t[i]=n[i]);return t},"filterModelListeners");function z2(n,e,t){const{props:i,children:s,component:r}=n,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return i?nv(i,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let d=0;d<h.length;d++){const f=h[d];if(o[f]!==i[f]&&!tf(c,f))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:i===o?!1:i?o?nv(i,o,c):!0:!!o;return!1}u(z2,"shouldUpdateComponent");function nv(n,e,t){const i=Object.keys(e);if(i.length!==Object.keys(n).length)return!0;for(let s=0;s<i.length;s++){const r=i[s];if(e[r]!==n[r]&&!tf(t,r))return!0}return!1}u(nv,"hasPropsChanged");function B2({vnode:n,parent:e},t){for(;e&&e.subTree===n;)(n=e.vnode).el=t,e=e.parent}u(B2,"updateHOCHostEl");const U2=u(n=>n.__isSuspense,"isSuspense");function V2(n,e){e&&e.pendingBranch?Ye(n)?e.effects.push(...n):e.effects.push(n):L2(n)}u(V2,"queueEffectWithSuspense");function za(n,e){if(Ln){let t=Ln.provides;const i=Ln.parent&&Ln.parent.provides;i===t&&(t=Ln.provides=Object.create(i)),t[n]=e}}u(za,"provide");function ii(n,e,t=!1){const i=Ln||Gn;if(i){const s=i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides;if(s&&n in s)return s[n];if(arguments.length>1)return t&&it(e)?e.call(i.proxy):e}}u(ii,"inject$1");const Lu={};function si(n,e,t){return Ab(n,e,t)}u(si,"watch");function Ab(n,e,{immediate:t,deep:i,flush:s,onTrack:r,onTrigger:o}=Ut){const a=Ln;let l,c=!1,h=!1;if(Hn(n)?(l=u(()=>n.value,"getter"),c=xd(n)):Oa(n)?(l=u(()=>n,"getter"),i=!0):Ye(n)?(h=!0,c=n.some(_=>Oa(_)||xd(_)),l=u(()=>n.map(_=>{if(Hn(_))return _.value;if(Oa(_))return Mo(_);if(it(_))return Er(_,a,2)}),"getter")):it(n)?e?l=u(()=>Er(n,a,2),"getter"):l=u(()=>{if(!(a&&a.isUnmounted))return d&&d(),rs(n,a,3,[f])},"getter"):l=ss,e&&i){const _=l;l=u(()=>Mo(_()),"getter")}let d,f=u(_=>{d=y.onStop=()=>{Er(_,a,4)}},"onCleanup"),p;if(Vc)if(f=ss,e?t&&rs(e,a,3,[l(),h?[]:void 0,f]):l(),s==="sync"){const _=DC();p=_.__watcherHandles||(_.__watcherHandles=[])}else return ss;let g=h?new Array(n.length).fill(Lu):Lu;const m=u(()=>{if(!!y.active)if(e){const _=y.run();(i||c||(h?_.some((A,x)=>Fc(A,g[x])):Fc(_,g)))&&(d&&d(),rs(e,a,3,[_,g===Lu?void 0:h&&g[0]===Lu?[]:g,f]),g=_)}else y.run()},"job");m.allowRecurse=!!e;let v;s==="sync"?v=m:s==="post"?v=u(()=>ui(m,a&&a.suspense),"scheduler"):(m.pre=!0,a&&(m.id=a.uid),v=u(()=>xg(m),"scheduler"));const y=new Qd(l,v);e?t?m():g=y.run():s==="post"?ui(y.run.bind(y),a&&a.suspense):y.run();const w=u(()=>{y.stop(),a&&a.scope&&hg(a.scope.effects,y)},"unwatch");return p&&p.push(w),w}u(Ab,"doWatch");function H2(n,e,t){const i=this.proxy,s=ln(n)?n.includes(".")?Cb(i,n):()=>i[n]:n.bind(i,i);let r;it(e)?r=e:(r=e.handler,t=e);const o=Ln;$a(this);const a=Ab(s,r.bind(i),t);return o?$a(o):Eo(),a}u(H2,"instanceWatch");function Cb(n,e){const t=e.split(".");return()=>{let i=n;for(let s=0;s<t.length&&i;s++)i=i[t[s]];return i}}u(Cb,"createPathGetter");function Mo(n,e){if(!Ot(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),Hn(n))Mo(n.value,e);else if(Ye(n))for(let t=0;t<n.length;t++)Mo(n[t],e);else if(qd(n)||Fa(n))n.forEach(t=>{Mo(t,e)});else if(Qx(n))for(const t in n)Mo(n[t],e);return n}u(Mo,"traverse");function Pt(n){return it(n)?{setup:n,name:n.name}:n}u(Pt,"defineComponent");const _c=u(n=>!!n.type.__asyncLoader,"isAsyncWrapper"),Tb=u(n=>n.type.__isKeepAlive,"isKeepAlive");function G2(n,e){Eb(n,"a",e)}u(G2,"onActivated");function $2(n,e){Eb(n,"da",e)}u($2,"onDeactivated");function Eb(n,e,t=Ln){const i=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(sf(e,i,t),t){let s=t.parent;for(;s&&s.parent;)Tb(s.parent.vnode)&&W2(i,e,t,s),s=s.parent}}u(Eb,"registerKeepAliveHook");function W2(n,e,t,i){const s=sf(e,n,i,!0);of(()=>{hg(i[e],s)},t)}u(W2,"injectToKeepAliveRoot");function sf(n,e,t=Ln,i=!1){if(t){const s=t[n]||(t[n]=[]),r=e.__weh||(e.__weh=(...o)=>{if(t.isUnmounted)return;ul(),$a(t);const a=rs(e,t,n,o);return Eo(),hl(),a});return i?s.unshift(r):s.push(r),r}}u(sf,"injectHook");const er=u(n=>(e,t=Ln)=>(!Vc||n==="sp")&&sf(n,(...i)=>e(...i),t),"createHook"),j2=er("bm"),rf=er("m"),X2=er("bu"),Y2=er("u"),Bo=er("bum"),of=er("um"),q2=er("sp"),K2=er("rtg"),Z2=er("rtc");function Q2(n,e=Ln){sf("ec",n,e)}u(Q2,"onErrorCaptured");function Ea(n,e){const t=Gn;if(t===null)return n;const i=cf(t)||t.proxy,s=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[o,a,l,c=Ut]=e[r];o&&(it(o)&&(o={mounted:o,updated:o}),o.deep&&Mo(a),s.push({dir:o,instance:i,value:a,oldValue:void 0,arg:l,modifiers:c}))}return n}u(Ea,"withDirectives");function Xr(n,e,t,i){const s=n.dirs,r=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];r&&(a.oldValue=r[o].value);let l=a.dir[i];l&&(ul(),rs(l,t,8,[n.el,a,n,e]),hl())}}u(Xr,"invokeDirectiveHook");const bg="components";function Yt(n,e){return Ib(bg,n,!0,e)||n}u(Yt,"resolveComponent");const Pb=Symbol();function J2(n){return ln(n)?Ib(bg,n,!1)||n:n||Pb}u(J2,"resolveDynamicComponent");function Ib(n,e,t=!0,i=!1){const s=Gn||Ln;if(s){const r=s.type;if(n===bg){const a=PC(r,!1);if(a&&(a===e||a===Ts(e)||a===Zd(Ts(e))))return r}const o=iv(s[n]||r[n],e)||iv(s.appContext[n],e);return!o&&i?r:o}}u(Ib,"resolveAsset");function iv(n,e){return n&&(n[e]||n[Ts(e)]||n[Zd(Ts(e))])}u(iv,"resolve");function Pr(n,e,t,i){let s;const r=t&&t[i];if(Ye(n)||ln(n)){s=new Array(n.length);for(let o=0,a=n.length;o<a;o++)s[o]=e(n[o],o,void 0,r&&r[o])}else if(typeof n=="number"){s=new Array(n);for(let o=0;o<n;o++)s[o]=e(o+1,o,void 0,r&&r[o])}else if(Ot(n))if(n[Symbol.iterator])s=Array.from(n,(o,a)=>e(o,a,void 0,r&&r[a]));else{const o=Object.keys(n);s=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];s[a]=e(n[c],c,a,r&&r[a])}}else s=[];return t&&(t[i]=s),s}u(Pr,"renderList");function Bc(n,e,t={},i,s){if(Gn.isCE||Gn.parent&&_c(Gn.parent)&&Gn.parent.isCE)return e!=="default"&&(t.name=e),Pe("slot",t,i&&i());let r=n[e];r&&r._c&&(r._d=!1),Te();const o=r&&Rb(r(t)),a=Wt(Tt,{key:t.key||o&&o.key||`_${e}`},o||(i?i():[]),o&&n._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}u(Bc,"renderSlot");function Rb(n){return n.some(e=>Md(e)?!(e.type===Or||e.type===Tt&&!Rb(e.children)):!0)?n:null}u(Rb,"ensureValidVNode");const Mm=u(n=>n?Gb(n)?cf(n)||n.proxy:Mm(n.parent):null,"getPublicInstance"),xc=ri(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Mm(n.parent),$root:n=>Mm(n.root),$emit:n=>n.emit,$options:n=>wg(n),$forceUpdate:n=>n.f||(n.f=()=>xg(n.update)),$nextTick:n=>n.n||(n.n=Bi.bind(n.proxy)),$watch:n=>H2.bind(n)}),Hf=u((n,e)=>n!==Ut&&!n.__isScriptSetup&&xt(n,e),"hasSetupBinding"),eC={get({_:n},e){const{ctx:t,setupState:i,data:s,props:r,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const p=o[e];if(p!==void 0)switch(p){case 1:return i[e];case 2:return s[e];case 4:return t[e];case 3:return r[e]}else{if(Hf(i,e))return o[e]=1,i[e];if(s!==Ut&&xt(s,e))return o[e]=2,s[e];if((c=n.propsOptions[0])&&xt(c,e))return o[e]=3,r[e];if(t!==Ut&&xt(t,e))return o[e]=4,t[e];Sm&&(o[e]=0)}}const h=xc[e];let d,f;if(h)return e==="$attrs"&&Ri(n,"get",e),h(n);if((d=a.__cssModules)&&(d=d[e]))return d;if(t!==Ut&&xt(t,e))return o[e]=4,t[e];if(f=l.config.globalProperties,xt(f,e))return f[e]},set({_:n},e,t){const{data:i,setupState:s,ctx:r}=n;return Hf(s,e)?(s[e]=t,!0):i!==Ut&&xt(i,e)?(i[e]=t,!0):xt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(r[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:i,appContext:s,propsOptions:r}},o){let a;return!!t[o]||n!==Ut&&xt(n,o)||Hf(e,o)||(a=r[0])&&xt(a,o)||xt(i,o)||xt(xc,o)||xt(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:xt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};let Sm=!0;function tC(n){const e=wg(n),t=n.proxy,i=n.ctx;Sm=!1,e.beforeCreate&&sv(e.beforeCreate,n,"bc");const{data:s,computed:r,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:d,mounted:f,beforeUpdate:p,updated:g,activated:m,deactivated:v,beforeDestroy:y,beforeUnmount:w,destroyed:_,unmounted:A,render:x,renderTracked:C,renderTriggered:T,errorCaptured:S,serverPrefetch:I,expose:D,inheritAttrs:B,components:Q,directives:U,filters:z}=e;if(c&&nC(c,i,null,n.appContext.config.unwrapInjectedRef),o)for(const J in o){const X=o[J];it(X)&&(i[J]=X.bind(t))}if(s){const J=s.call(t,t);Ot(J)&&(n.data=Tr(J))}if(Sm=!0,r)for(const J in r){const X=r[J],V=it(X)?X.bind(t,t):it(X.get)?X.get.bind(t,t):ss,Z=!it(X)&&it(X.set)?X.set.bind(t):ss,de=at({get:V,set:Z});Object.defineProperty(i,J,{enumerable:!0,configurable:!0,get:()=>de.value,set:Y=>de.value=Y})}if(a)for(const J in a)Db(a[J],i,t,J);if(l){const J=it(l)?l.call(t):l;Reflect.ownKeys(J).forEach(X=>{za(X,J[X])})}h&&sv(h,n,"c");function ee(J,X){Ye(X)?X.forEach(V=>J(V.bind(t))):X&&J(X.bind(t))}if(u(ee,"registerLifecycleHook"),ee(j2,d),ee(rf,f),ee(X2,p),ee(Y2,g),ee(G2,m),ee($2,v),ee(Q2,S),ee(Z2,C),ee(K2,T),ee(Bo,w),ee(of,A),ee(q2,I),Ye(D))if(D.length){const J=n.exposed||(n.exposed={});D.forEach(X=>{Object.defineProperty(J,X,{get:()=>t[X],set:V=>t[X]=V})})}else n.exposed||(n.exposed={});x&&n.render===ss&&(n.render=x),B!=null&&(n.inheritAttrs=B),Q&&(n.components=Q),U&&(n.directives=U)}u(tC,"applyOptions");function nC(n,e,t=ss,i=!1){Ye(n)&&(n=Am(n));for(const s in n){const r=n[s];let o;Ot(r)?"default"in r?o=ii(r.from||s,r.default,!0):o=ii(r.from||s):o=ii(r),Hn(o)&&i?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[s]=o}}u(nC,"resolveInjections");function sv(n,e,t){rs(Ye(n)?n.map(i=>i.bind(e.proxy)):n.bind(e.proxy),e,t)}u(sv,"callHook");function Db(n,e,t,i){const s=i.includes(".")?Cb(t,i):()=>t[i];if(ln(n)){const r=e[n];it(r)&&si(s,r)}else if(it(n))si(s,n.bind(t));else if(Ot(n))if(Ye(n))n.forEach(r=>Db(r,e,t,i));else{const r=it(n.handler)?n.handler.bind(t):e[n.handler];it(r)&&si(s,r,n)}}u(Db,"createWatcher");function wg(n){const e=n.type,{mixins:t,extends:i}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:o}}=n.appContext,a=r.get(e);let l;return a?l=a:!s.length&&!t&&!i?l=e:(l={},s.length&&s.forEach(c=>wd(l,c,o,!0)),wd(l,e,o)),Ot(e)&&r.set(e,l),l}u(wg,"resolveMergedOptions");function wd(n,e,t,i=!1){const{mixins:s,extends:r}=e;r&&wd(n,r,t,!0),s&&s.forEach(o=>wd(n,o,t,!0));for(const o in e)if(!(i&&o==="expose")){const a=iC[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}u(wd,"mergeOptions$1");const iC={data:rv,props:go,emits:go,methods:go,computed:go,beforeCreate:Yn,created:Yn,beforeMount:Yn,mounted:Yn,beforeUpdate:Yn,updated:Yn,beforeDestroy:Yn,beforeUnmount:Yn,destroyed:Yn,unmounted:Yn,activated:Yn,deactivated:Yn,errorCaptured:Yn,serverPrefetch:Yn,components:go,directives:go,watch:rC,provide:rv,inject:sC};function rv(n,e){return e?n?u(function(){return ri(it(n)?n.call(this,this):n,it(e)?e.call(this,this):e)},"mergedDataFn"):e:n}u(rv,"mergeDataFn");function sC(n,e){return go(Am(n),Am(e))}u(sC,"mergeInject");function Am(n){if(Ye(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}u(Am,"normalizeInject");function Yn(n,e){return n?[...new Set([].concat(n,e))]:e}u(Yn,"mergeAsArray");function go(n,e){return n?ri(ri(Object.create(null),n),e):e}u(go,"mergeObjectOptions");function rC(n,e){if(!n)return e;if(!e)return n;const t=ri(Object.create(null),n);for(const i in e)t[i]=Yn(n[i],e[i]);return t}u(rC,"mergeWatchOptions");function oC(n,e,t,i=!1){const s={},r={};_d(r,lf,1),n.propsDefaults=Object.create(null),Lb(n,e,s,r);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=i?s:C2(s):n.type.props?n.props=s:n.props=r,n.attrs=r}u(oC,"initProps");function aC(n,e,t,i){const{props:s,attrs:r,vnode:{patchFlag:o}}=n,a=Ze(s),[l]=n.propsOptions;let c=!1;if((i||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let d=0;d<h.length;d++){let f=h[d];if(tf(n.emitsOptions,f))continue;const p=e[f];if(l)if(xt(r,f))p!==r[f]&&(r[f]=p,c=!0);else{const g=Ts(f);s[g]=Cm(l,a,g,p,n,!1)}else p!==r[f]&&(r[f]=p,c=!0)}}}else{Lb(n,e,s,r)&&(c=!0);let h;for(const d in a)(!e||!xt(e,d)&&((h=No(d))===d||!xt(e,h)))&&(l?t&&(t[d]!==void 0||t[h]!==void 0)&&(s[d]=Cm(l,a,d,void 0,n,!0)):delete s[d]);if(r!==a)for(const d in r)(!e||!xt(e,d)&&!0)&&(delete r[d],c=!0)}c&&qs(n,"set","$attrs")}u(aC,"updateProps");function Lb(n,e,t,i){const[s,r]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(rd(l))continue;const c=e[l];let h;s&&xt(s,h=Ts(l))?!r||!r.includes(h)?t[h]=c:(a||(a={}))[h]=c:tf(n.emitsOptions,l)||(!(l in i)||c!==i[l])&&(i[l]=c,o=!0)}if(r){const l=Ze(t),c=a||Ut;for(let h=0;h<r.length;h++){const d=r[h];t[d]=Cm(s,l,d,c[d],n,!xt(c,d))}}return o}u(Lb,"setFullProps");function Cm(n,e,t,i,s,r){const o=n[t];if(o!=null){const a=xt(o,"default");if(a&&i===void 0){const l=o.default;if(o.type!==Function&&it(l)){const{propsDefaults:c}=s;t in c?i=c[t]:($a(s),i=c[t]=l.call(null,e),Eo())}else i=l}o[0]&&(r&&!a?i=!1:o[1]&&(i===""||i===No(t))&&(i=!0))}return i}u(Cm,"resolvePropValue");function Fb(n,e,t=!1){const i=e.propsCache,s=i.get(n);if(s)return s;const r=n.props,o={},a=[];let l=!1;if(!it(n)){const h=u(d=>{l=!0;const[f,p]=Fb(d,e,!0);ri(o,f),p&&a.push(...p)},"extendProps");!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!r&&!l)return Ot(n)&&i.set(n,La),La;if(Ye(r))for(let h=0;h<r.length;h++){const d=Ts(r[h]);ov(d)&&(o[d]=Ut)}else if(r)for(const h in r){const d=Ts(h);if(ov(d)){const f=r[h],p=o[d]=Ye(f)||it(f)?{type:f}:Object.assign({},f);if(p){const g=cv(Boolean,p.type),m=cv(String,p.type);p[0]=g>-1,p[1]=m<0||g<m,(g>-1||xt(p,"default"))&&a.push(d)}}}const c=[o,a];return Ot(n)&&i.set(n,c),c}u(Fb,"normalizePropsOptions");function ov(n){return n[0]!=="$"}u(ov,"validatePropName");function av(n){const e=n&&n.toString().match(/^\s*function (\w+)/);return e?e[1]:n===null?"null":""}u(av,"getType");function lv(n,e){return av(n)===av(e)}u(lv,"isSameType");function cv(n,e){return Ye(e)?e.findIndex(t=>lv(t,n)):it(e)&&lv(e,n)?0:-1}u(cv,"getTypeIndex");const Ob=u(n=>n[0]==="_"||n==="$stable","isInternalKey"),Mg=u(n=>Ye(n)?n.map(ys):[ys(n)],"normalizeSlotValue"),lC=u((n,e,t)=>{if(e._n)return e;const i=kt((...s)=>Mg(e(...s)),t);return i._c=!1,i},"normalizeSlot$1"),Nb=u((n,e,t)=>{const i=n._ctx;for(const s in n){if(Ob(s))continue;const r=n[s];if(it(r))e[s]=lC(s,r,i);else if(r!=null){const o=Mg(r);e[s]=()=>o}}},"normalizeObjectSlots"),kb=u((n,e)=>{const t=Mg(e);n.slots.default=()=>t},"normalizeVNodeSlots"),cC=u((n,e)=>{if(n.vnode.shapeFlag&32){const t=e._;t?(n.slots=Ze(e),_d(e,"_",t)):Nb(e,n.slots={})}else n.slots={},e&&kb(n,e);_d(n.slots,lf,1)},"initSlots"),uC=u((n,e,t)=>{const{vnode:i,slots:s}=n;let r=!0,o=Ut;if(i.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:(ri(s,e),!t&&a===1&&delete s._):(r=!e.$stable,Nb(e,s)),o=e}else e&&(kb(n,e),o={default:1});if(r)for(const a in s)!Ob(a)&&!(a in o)&&delete s[a]},"updateSlots");function zb(){return{app:null,config:{isNativeTag:XA,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}u(zb,"createAppContext");let hC=0;function dC(n,e){return u(function(i,s=null){it(i)||(i=Object.assign({},i)),s!=null&&!Ot(s)&&(s=null);const r=zb(),o=new Set;let a=!1;const l=r.app={_uid:hC++,_component:i,_props:s,_container:null,_context:r,_instance:null,version:LC,get config(){return r.config},set config(c){},use(c,...h){return o.has(c)||(c&&it(c.install)?(o.add(c),c.install(l,...h)):it(c)&&(o.add(c),c(l,...h))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,h){return h?(r.components[c]=h,l):r.components[c]},directive(c,h){return h?(r.directives[c]=h,l):r.directives[c]},mount(c,h,d){if(!a){const f=Pe(i,s);return f.appContext=r,h&&e?e(f,c):n(f,c,d),a=!0,l._container=c,c.__vue_app__=l,cf(f.component)||f.component.proxy}},unmount(){a&&(n(null,l._container),delete l._container.__vue_app__)},provide(c,h){return r.provides[c]=h,l}};return l},"createApp")}u(dC,"createAppAPI");function Tm(n,e,t,i,s=!1){if(Ye(n)){n.forEach((f,p)=>Tm(f,e&&(Ye(e)?e[p]:e),t,i,s));return}if(_c(i)&&!s)return;const r=i.shapeFlag&4?cf(i.component)||i.component.proxy:i.el,o=s?null:r,{i:a,r:l}=n,c=e&&e.r,h=a.refs===Ut?a.refs={}:a.refs,d=a.setupState;if(c!=null&&c!==l&&(ln(c)?(h[c]=null,xt(d,c)&&(d[c]=null)):Hn(c)&&(c.value=null)),it(l))Er(l,a,12,[o,h]);else{const f=ln(l),p=Hn(l);if(f||p){const g=u(()=>{if(n.f){const m=f?xt(d,l)?d[l]:h[l]:l.value;s?Ye(m)&&hg(m,r):Ye(m)?m.includes(r)||m.push(r):f?(h[l]=[r],xt(d,l)&&(d[l]=h[l])):(l.value=[r],n.k&&(h[n.k]=l.value))}else f?(h[l]=o,xt(d,l)&&(d[l]=o)):p&&(l.value=o,n.k&&(h[n.k]=o))},"doSet");o?(g.id=-1,ui(g,t)):g()}}}u(Tm,"setRef");const ui=V2;function fC(n){return pC(n)}u(fC,"createRenderer");function pC(n,e){const t=JA();t.__VUE__=!0;const{insert:i,remove:s,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:d,nextSibling:f,setScopeId:p=ss,insertStaticContent:g}=n,m=u((E,L,G,K=null,oe=null,ge=null,xe=!1,le=null,_e=!!L.dynamicChildren)=>{if(E===L)return;E&&!Cl(E,L)&&(K=H(E),Y(E,oe,ge,!0),E=null),L.patchFlag===-2&&(_e=!1,L.dynamicChildren=null);const{type:ce,ref:R,shapeFlag:P}=L;switch(ce){case af:v(E,L,G,K);break;case Or:y(E,L,G,K);break;case Gf:E==null&&w(L,G,K,xe);break;case Tt:Q(E,L,G,K,oe,ge,xe,le,_e);break;default:P&1?x(E,L,G,K,oe,ge,xe,le,_e):P&6?U(E,L,G,K,oe,ge,xe,le,_e):(P&64||P&128)&&ce.process(E,L,G,K,oe,ge,xe,le,_e,te)}R!=null&&oe&&Tm(R,E&&E.ref,ge,L||E,!L)},"patch"),v=u((E,L,G,K)=>{if(E==null)i(L.el=a(L.children),G,K);else{const oe=L.el=E.el;L.children!==E.children&&c(oe,L.children)}},"processText"),y=u((E,L,G,K)=>{E==null?i(L.el=l(L.children||""),G,K):L.el=E.el},"processCommentNode"),w=u((E,L,G,K)=>{[E.el,E.anchor]=g(E.children,L,G,K,E.el,E.anchor)},"mountStaticNode"),_=u(({el:E,anchor:L},G,K)=>{let oe;for(;E&&E!==L;)oe=f(E),i(E,G,K),E=oe;i(L,G,K)},"moveStaticNode"),A=u(({el:E,anchor:L})=>{let G;for(;E&&E!==L;)G=f(E),s(E),E=G;s(L)},"removeStaticNode"),x=u((E,L,G,K,oe,ge,xe,le,_e)=>{xe=xe||L.type==="svg",E==null?C(L,G,K,oe,ge,xe,le,_e):I(E,L,oe,ge,xe,le,_e)},"processElement"),C=u((E,L,G,K,oe,ge,xe,le)=>{let _e,ce;const{type:R,props:P,shapeFlag:j,transition:re,dirs:pe}=E;if(_e=E.el=o(E.type,ge,P&&P.is,P),j&8?h(_e,E.children):j&16&&S(E.children,_e,null,K,oe,ge&&R!=="foreignObject",xe,le),pe&&Xr(E,null,K,"created"),P){for(const Se in P)Se!=="value"&&!rd(Se)&&r(_e,Se,null,P[Se],ge,E.children,K,oe,F);"value"in P&&r(_e,"value",null,P.value),(ce=P.onVnodeBeforeMount)&&hs(ce,K,E)}T(_e,E,E.scopeId,xe,K),pe&&Xr(E,null,K,"beforeMount");const be=(!oe||oe&&!oe.pendingBranch)&&re&&!re.persisted;be&&re.beforeEnter(_e),i(_e,L,G),((ce=P&&P.onVnodeMounted)||be||pe)&&ui(()=>{ce&&hs(ce,K,E),be&&re.enter(_e),pe&&Xr(E,null,K,"mounted")},oe)},"mountElement"),T=u((E,L,G,K,oe)=>{if(G&&p(E,G),K)for(let ge=0;ge<K.length;ge++)p(E,K[ge]);if(oe){let ge=oe.subTree;if(L===ge){const xe=oe.vnode;T(E,xe,xe.scopeId,xe.slotScopeIds,oe.parent)}}},"setScopeId"),S=u((E,L,G,K,oe,ge,xe,le,_e=0)=>{for(let ce=_e;ce<E.length;ce++){const R=E[ce]=le?xr(E[ce]):ys(E[ce]);m(null,R,L,G,K,oe,ge,xe,le)}},"mountChildren"),I=u((E,L,G,K,oe,ge,xe)=>{const le=L.el=E.el;let{patchFlag:_e,dynamicChildren:ce,dirs:R}=L;_e|=E.patchFlag&16;const P=E.props||Ut,j=L.props||Ut;let re;G&&Yr(G,!1),(re=j.onVnodeBeforeUpdate)&&hs(re,G,L,E),R&&Xr(L,E,G,"beforeUpdate"),G&&Yr(G,!0);const pe=oe&&L.type!=="foreignObject";if(ce?D(E.dynamicChildren,ce,le,G,K,pe,ge):xe||X(E,L,le,null,G,K,pe,ge,!1),_e>0){if(_e&16)B(le,L,P,j,G,K,oe);else if(_e&2&&P.class!==j.class&&r(le,"class",null,j.class,oe),_e&4&&r(le,"style",P.style,j.style,oe),_e&8){const be=L.dynamicProps;for(let Se=0;Se<be.length;Se++){const we=be[Se],ue=P[we],Be=j[we];(Be!==ue||we==="value")&&r(le,we,ue,Be,oe,E.children,G,K,F)}}_e&1&&E.children!==L.children&&h(le,L.children)}else!xe&&ce==null&&B(le,L,P,j,G,K,oe);((re=j.onVnodeUpdated)||R)&&ui(()=>{re&&hs(re,G,L,E),R&&Xr(L,E,G,"updated")},K)},"patchElement"),D=u((E,L,G,K,oe,ge,xe)=>{for(let le=0;le<L.length;le++){const _e=E[le],ce=L[le],R=_e.el&&(_e.type===Tt||!Cl(_e,ce)||_e.shapeFlag&70)?d(_e.el):G;m(_e,ce,R,null,K,oe,ge,xe,!0)}},"patchBlockChildren"),B=u((E,L,G,K,oe,ge,xe)=>{if(G!==K){if(G!==Ut)for(const le in G)!rd(le)&&!(le in K)&&r(E,le,G[le],null,xe,L.children,oe,ge,F);for(const le in K){if(rd(le))continue;const _e=K[le],ce=G[le];_e!==ce&&le!=="value"&&r(E,le,ce,_e,xe,L.children,oe,ge,F)}"value"in K&&r(E,"value",G.value,K.value)}},"patchProps"),Q=u((E,L,G,K,oe,ge,xe,le,_e)=>{const ce=L.el=E?E.el:a(""),R=L.anchor=E?E.anchor:a("");let{patchFlag:P,dynamicChildren:j,slotScopeIds:re}=L;re&&(le=le?le.concat(re):re),E==null?(i(ce,G,K),i(R,G,K),S(L.children,G,R,oe,ge,xe,le,_e)):P>0&&P&64&&j&&E.dynamicChildren?(D(E.dynamicChildren,j,G,oe,ge,xe,le),(L.key!=null||oe&&L===oe.subTree)&&Sg(E,L,!0)):X(E,L,G,R,oe,ge,xe,le,_e)},"processFragment"),U=u((E,L,G,K,oe,ge,xe,le,_e)=>{L.slotScopeIds=le,E==null?L.shapeFlag&512?oe.ctx.activate(L,G,K,xe,_e):z(L,G,K,oe,ge,xe,_e):q(E,L,_e)},"processComponent"),z=u((E,L,G,K,oe,ge,xe)=>{const le=E.component=SC(E,K,oe);if(Tb(E)&&(le.ctx.renderer=te),AC(le),le.asyncDep){if(oe&&oe.registerDep(le,ee),!E.el){const _e=le.subTree=Pe(Or);y(null,_e,L,G)}return}ee(le,E,L,G,oe,ge,xe)},"mountComponent"),q=u((E,L,G)=>{const K=L.component=E.component;if(z2(E,L,G))if(K.asyncDep&&!K.asyncResolved){J(K,L,G);return}else K.next=L,D2(K.update),K.update();else L.el=E.el,K.vnode=L},"updateComponent"),ee=u((E,L,G,K,oe,ge,xe)=>{const le=u(()=>{if(E.isMounted){let{next:R,bu:P,u:j,parent:re,vnode:pe}=E,be=R,Se;Yr(E,!1),R?(R.el=pe.el,J(E,R,xe)):R=pe,P&&od(P),(Se=R.props&&R.props.onVnodeBeforeUpdate)&&hs(Se,re,R,pe),Yr(E,!0);const we=Vf(E),ue=E.subTree;E.subTree=we,m(ue,we,d(ue.el),H(ue),E,oe,ge),R.el=we.el,be===null&&B2(E,we.el),j&&ui(j,oe),(Se=R.props&&R.props.onVnodeUpdated)&&ui(()=>hs(Se,re,R,pe),oe)}else{let R;const{el:P,props:j}=L,{bm:re,m:pe,parent:be}=E,Se=_c(L);if(Yr(E,!1),re&&od(re),!Se&&(R=j&&j.onVnodeBeforeMount)&&hs(R,be,L),Yr(E,!0),P&&ae){const we=u(()=>{E.subTree=Vf(E),ae(P,E.subTree,E,oe,null)},"hydrateSubTree");Se?L.type.__asyncLoader().then(()=>!E.isUnmounted&&we()):we()}else{const we=E.subTree=Vf(E);m(null,we,G,K,E,oe,ge),L.el=we.el}if(pe&&ui(pe,oe),!Se&&(R=j&&j.onVnodeMounted)){const we=L;ui(()=>hs(R,be,we),oe)}(L.shapeFlag&256||be&&_c(be.vnode)&&be.vnode.shapeFlag&256)&&E.a&&ui(E.a,oe),E.isMounted=!0,L=G=K=null}},"componentUpdateFn"),_e=E.effect=new Qd(le,()=>xg(ce),E.scope),ce=E.update=()=>_e.run();ce.id=E.uid,Yr(E,!0),ce()},"setupRenderEffect"),J=u((E,L,G)=>{L.component=E;const K=E.vnode.props;E.vnode=L,E.next=null,aC(E,L.props,K,G),uC(E,L.children,G),ul(),tv(),hl()},"updateComponentPreRender"),X=u((E,L,G,K,oe,ge,xe,le,_e=!1)=>{const ce=E&&E.children,R=E?E.shapeFlag:0,P=L.children,{patchFlag:j,shapeFlag:re}=L;if(j>0){if(j&128){Z(ce,P,G,K,oe,ge,xe,le,_e);return}else if(j&256){V(ce,P,G,K,oe,ge,xe,le,_e);return}}re&8?(R&16&&F(ce,oe,ge),P!==ce&&h(G,P)):R&16?re&16?Z(ce,P,G,K,oe,ge,xe,le,_e):F(ce,oe,ge,!0):(R&8&&h(G,""),re&16&&S(P,G,K,oe,ge,xe,le,_e))},"patchChildren"),V=u((E,L,G,K,oe,ge,xe,le,_e)=>{E=E||La,L=L||La;const ce=E.length,R=L.length,P=Math.min(ce,R);let j;for(j=0;j<P;j++){const re=L[j]=_e?xr(L[j]):ys(L[j]);m(E[j],re,G,null,oe,ge,xe,le,_e)}ce>R?F(E,oe,ge,!0,!1,P):S(L,G,K,oe,ge,xe,le,_e,P)},"patchUnkeyedChildren"),Z=u((E,L,G,K,oe,ge,xe,le,_e)=>{let ce=0;const R=L.length;let P=E.length-1,j=R-1;for(;ce<=P&&ce<=j;){const re=E[ce],pe=L[ce]=_e?xr(L[ce]):ys(L[ce]);if(Cl(re,pe))m(re,pe,G,null,oe,ge,xe,le,_e);else break;ce++}for(;ce<=P&&ce<=j;){const re=E[P],pe=L[j]=_e?xr(L[j]):ys(L[j]);if(Cl(re,pe))m(re,pe,G,null,oe,ge,xe,le,_e);else break;P--,j--}if(ce>P){if(ce<=j){const re=j+1,pe=re<R?L[re].el:K;for(;ce<=j;)m(null,L[ce]=_e?xr(L[ce]):ys(L[ce]),G,pe,oe,ge,xe,le,_e),ce++}}else if(ce>j)for(;ce<=P;)Y(E[ce],oe,ge,!0),ce++;else{const re=ce,pe=ce,be=new Map;for(ce=pe;ce<=j;ce++){const De=L[ce]=_e?xr(L[ce]):ys(L[ce]);De.key!=null&&be.set(De.key,ce)}let Se,we=0;const ue=j-pe+1;let Be=!1,He=0;const Ne=new Array(ue);for(ce=0;ce<ue;ce++)Ne[ce]=0;for(ce=re;ce<=P;ce++){const De=E[ce];if(we>=ue){Y(De,oe,ge,!0);continue}let Je;if(De.key!=null)Je=be.get(De.key);else for(Se=pe;Se<=j;Se++)if(Ne[Se-pe]===0&&Cl(De,L[Se])){Je=Se;break}Je===void 0?Y(De,oe,ge,!0):(Ne[Je-pe]=ce+1,Je>=He?He=Je:Be=!0,m(De,L[Je],G,null,oe,ge,xe,le,_e),we++)}const $e=Be?mC(Ne):La;for(Se=$e.length-1,ce=ue-1;ce>=0;ce--){const De=pe+ce,Je=L[De],It=De+1<R?L[De+1].el:K;Ne[ce]===0?m(null,Je,G,It,oe,ge,xe,le,_e):Be&&(Se<0||ce!==$e[Se]?de(Je,G,It,2):Se--)}}},"patchKeyedChildren"),de=u((E,L,G,K,oe=null)=>{const{el:ge,type:xe,transition:le,children:_e,shapeFlag:ce}=E;if(ce&6){de(E.component.subTree,L,G,K);return}if(ce&128){E.suspense.move(L,G,K);return}if(ce&64){xe.move(E,L,G,te);return}if(xe===Tt){i(ge,L,G);for(let P=0;P<_e.length;P++)de(_e[P],L,G,K);i(E.anchor,L,G);return}if(xe===Gf){_(E,L,G);return}if(K!==2&&ce&1&&le)if(K===0)le.beforeEnter(ge),i(ge,L,G),ui(()=>le.enter(ge),oe);else{const{leave:P,delayLeave:j,afterLeave:re}=le,pe=u(()=>i(ge,L,G),"remove"),be=u(()=>{P(ge,()=>{pe(),re&&re()})},"performLeave");j?j(ge,pe,be):be()}else i(ge,L,G)},"move"),Y=u((E,L,G,K=!1,oe=!1)=>{const{type:ge,props:xe,ref:le,children:_e,dynamicChildren:ce,shapeFlag:R,patchFlag:P,dirs:j}=E;if(le!=null&&Tm(le,null,G,E,!0),R&256){L.ctx.deactivate(E);return}const re=R&1&&j,pe=!_c(E);let be;if(pe&&(be=xe&&xe.onVnodeBeforeUnmount)&&hs(be,L,E),R&6)N(E.component,G,K);else{if(R&128){E.suspense.unmount(G,K);return}re&&Xr(E,null,L,"beforeUnmount"),R&64?E.type.remove(E,L,G,oe,te,K):ce&&(ge!==Tt||P>0&&P&64)?F(ce,L,G,!1,!0):(ge===Tt&&P&384||!oe&&R&16)&&F(_e,L,G),K&&fe(E)}(pe&&(be=xe&&xe.onVnodeUnmounted)||re)&&ui(()=>{be&&hs(be,L,E),re&&Xr(E,null,L,"unmounted")},G)},"unmount"),fe=u(E=>{const{type:L,el:G,anchor:K,transition:oe}=E;if(L===Tt){k(G,K);return}if(L===Gf){A(E);return}const ge=u(()=>{s(G),oe&&!oe.persisted&&oe.afterLeave&&oe.afterLeave()},"performRemove");if(E.shapeFlag&1&&oe&&!oe.persisted){const{leave:xe,delayLeave:le}=oe,_e=u(()=>xe(G,ge),"performLeave");le?le(E.el,ge,_e):_e()}else ge()},"remove"),k=u((E,L)=>{let G;for(;E!==L;)G=f(E),s(E),E=G;s(L)},"removeFragment"),N=u((E,L,G)=>{const{bum:K,scope:oe,update:ge,subTree:xe,um:le}=E;K&&od(K),oe.stop(),ge&&(ge.active=!1,Y(xe,E,L,G)),le&&ui(le,L),ui(()=>{E.isUnmounted=!0},L),L&&L.pendingBranch&&!L.isUnmounted&&E.asyncDep&&!E.asyncResolved&&E.suspenseId===L.pendingId&&(L.deps--,L.deps===0&&L.resolve())},"unmountComponent"),F=u((E,L,G,K=!1,oe=!1,ge=0)=>{for(let xe=ge;xe<E.length;xe++)Y(E[xe],L,G,K,oe)},"unmountChildren"),H=u(E=>E.shapeFlag&6?H(E.component.subTree):E.shapeFlag&128?E.suspense.next():f(E.anchor||E.el),"getNextHostNode"),$=u((E,L,G)=>{E==null?L._vnode&&Y(L._vnode,null,null,!0):m(L._vnode||null,E,L,null,null,null,G),tv(),wb(),L._vnode=E},"render"),te={p:m,um:Y,m:de,r:fe,mt:z,mc:S,pc:X,pbc:D,n:H,o:n};let se,ae;return e&&([se,ae]=e(te)),{render:$,hydrate:se,createApp:dC($,se)}}u(pC,"baseCreateRenderer");function Yr({effect:n,update:e},t){n.allowRecurse=e.allowRecurse=t}u(Yr,"toggleRecurse");function Sg(n,e,t=!1){const i=n.children,s=e.children;if(Ye(i)&&Ye(s))for(let r=0;r<i.length;r++){const o=i[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=xr(s[r]),a.el=o.el),t||Sg(o,a)),a.type===af&&(a.el=o.el)}}u(Sg,"traverseStaticChildren");function mC(n){const e=n.slice(),t=[0];let i,s,r,o,a;const l=n.length;for(i=0;i<l;i++){const c=n[i];if(c!==0){if(s=t[t.length-1],n[s]<c){e[i]=s,t.push(i);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,n[t[a]]<c?r=a+1:o=a;c<n[t[r]]&&(r>0&&(e[i]=t[r-1]),t[r]=i)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}u(mC,"getSequence");const gC=u(n=>n.__isTeleport,"isTeleport"),bc=u(n=>n&&(n.disabled||n.disabled===""),"isTeleportDisabled"),uv=u(n=>typeof SVGElement!="undefined"&&n instanceof SVGElement,"isTargetSVG"),Em=u((n,e)=>{const t=n&&n.to;return ln(t)?e?e(t):null:t},"resolveTarget"),vC={__isTeleport:!0,process(n,e,t,i,s,r,o,a,l,c){const{mc:h,pc:d,pbc:f,o:{insert:p,querySelector:g,createText:m,createComment:v}}=c,y=bc(e.props);let{shapeFlag:w,children:_,dynamicChildren:A}=e;if(n==null){const x=e.el=m(""),C=e.anchor=m("");p(x,t,i),p(C,t,i);const T=e.target=Em(e.props,g),S=e.targetAnchor=m("");T&&(p(S,T),o=o||uv(T));const I=u((D,B)=>{w&16&&h(_,D,B,s,r,o,a,l)},"mount");y?I(t,C):T&&I(T,S)}else{e.el=n.el;const x=e.anchor=n.anchor,C=e.target=n.target,T=e.targetAnchor=n.targetAnchor,S=bc(n.props),I=S?t:C,D=S?x:T;if(o=o||uv(C),A?(f(n.dynamicChildren,A,I,s,r,o,a),Sg(n,e,!0)):l||d(n,e,I,D,s,r,o,a,!1),y)S||Fu(e,t,x,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const B=e.target=Em(e.props,g);B&&Fu(e,B,null,c,0)}else S&&Fu(e,C,T,c,1)}Bb(e)},remove(n,e,t,i,{um:s,o:{remove:r}},o){const{shapeFlag:a,children:l,anchor:c,targetAnchor:h,target:d,props:f}=n;if(d&&r(h),(o||!bc(f))&&(r(c),a&16))for(let p=0;p<l.length;p++){const g=l[p];s(g,e,t,!0,!!g.dynamicChildren)}},move:Fu,hydrate:yC};function Fu(n,e,t,{o:{insert:i},m:s},r=2){r===0&&i(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,d=r===2;if(d&&i(o,e,t),(!d||bc(h))&&l&16)for(let f=0;f<c.length;f++)s(c[f],e,t,2);d&&i(a,e,t)}u(Fu,"moveTeleport");function yC(n,e,t,i,s,r,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const h=e.target=Em(e.props,l);if(h){const d=h._lpa||h.firstChild;if(e.shapeFlag&16)if(bc(e.props))e.anchor=c(o(n),e,a(n),t,i,s,r),e.targetAnchor=d;else{e.anchor=o(n);let f=d;for(;f;)if(f=o(f),f&&f.nodeType===8&&f.data==="teleport anchor"){e.targetAnchor=f,h._lpa=e.targetAnchor&&o(e.targetAnchor);break}c(d,e,h,t,i,s,r)}Bb(e)}return e.anchor&&o(e.anchor)}u(yC,"hydrateTeleport");const Ag=vC;function Bb(n){const e=n.ctx;if(e&&e.ut){let t=n.children[0].el;for(;t!==n.targetAnchor;)t.nodeType===1&&t.setAttribute("data-v-owner",e.uid),t=t.nextSibling;e.ut()}}u(Bb,"updateCssVars");const Tt=Symbol(void 0),af=Symbol(void 0),Or=Symbol(void 0),Gf=Symbol(void 0),wc=[];let ns=null;function Te(n=!1){wc.push(ns=n?null:[])}u(Te,"openBlock");function _C(){wc.pop(),ns=wc[wc.length-1]||null}u(_C,"closeBlock");let Uc=1;function hv(n){Uc+=n}u(hv,"setBlockTracking");function Ub(n){return n.dynamicChildren=Uc>0?ns||La:null,_C(),Uc>0&&ns&&ns.push(n),n}u(Ub,"setupBlock");function Oe(n,e,t,i,s,r){return Ub(he(n,e,t,i,s,r,!0))}u(Oe,"createElementBlock");function Wt(n,e,t,i,s){return Ub(Pe(n,e,t,i,s,!0))}u(Wt,"createBlock");function Md(n){return n?n.__v_isVNode===!0:!1}u(Md,"isVNode");function Cl(n,e){return n.type===e.type&&n.key===e.key}u(Cl,"isSameVNodeType");const lf="__vInternal",Vb=u(({key:n})=>n!=null?n:null,"normalizeKey"),ad=u(({ref:n,ref_key:e,ref_for:t})=>n!=null?ln(n)||Hn(n)||it(n)?{i:Gn,r:n,k:e,f:!!t}:n:null,"normalizeRef");function he(n,e=null,t=null,i=0,s=null,r=n===Tt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Vb(e),ref:e&&ad(e),scopeId:nf,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Gn};return a?(Tg(l,t),r&128&&n.normalize(l)):t&&(l.shapeFlag|=ln(t)?8:16),Uc>0&&!o&&ns&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&ns.push(l),l}u(he,"createBaseVNode");const Pe=xC;function xC(n,e=null,t=null,i=0,s=null,r=!1){if((!n||n===Pb)&&(n=Or),Md(n)){const a=Ga(n,e,!0);return t&&Tg(a,t),Uc>0&&!r&&ns&&(a.shapeFlag&6?ns[ns.indexOf(n)]=a:ns.push(a)),a.patchFlag|=-2,a}if(IC(n)&&(n=n.__vccOpts),e){e=bC(e);let{class:a,style:l}=e;a&&!ln(a)&&(e.class=qt(a)),Ot(l)&&(hb(l)&&!Ye(l)&&(l=ri({},l)),e.style=Jn(l))}const o=ln(n)?1:U2(n)?128:gC(n)?64:Ot(n)?4:it(n)?2:0;return he(n,e,t,i,s,o,r,!0)}u(xC,"_createVNode");function bC(n){return n?hb(n)||lf in n?ri({},n):n:null}u(bC,"guardReactiveProps");function Ga(n,e,t=!1){const{props:i,ref:s,patchFlag:r,children:o}=n,a=e?Hb(i||{},e):i;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:a,key:a&&Vb(a),ref:e&&e.ref?t&&s?Ye(s)?s.concat(ad(e)):[s,ad(e)]:ad(e):s,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:o,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Tt?r===-1?16:r|16:r,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Ga(n.ssContent),ssFallback:n.ssFallback&&Ga(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx}}u(Ga,"cloneVNode");function Cg(n=" ",e=0){return Pe(af,null,n,e)}u(Cg,"createTextVNode");function tt(n="",e=!1){return e?(Te(),Wt(Or,null,n)):Pe(Or,null,n)}u(tt,"createCommentVNode");function ys(n){return n==null||typeof n=="boolean"?Pe(Or):Ye(n)?Pe(Tt,null,n.slice()):typeof n=="object"?xr(n):Pe(af,null,String(n))}u(ys,"normalizeVNode");function xr(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Ga(n)}u(xr,"cloneIfMounted");function Tg(n,e){let t=0;const{shapeFlag:i}=n;if(e==null)e=null;else if(Ye(e))t=16;else if(typeof e=="object")if(i&65){const s=e.default;s&&(s._c&&(s._d=!1),Tg(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!(lf in e)?e._ctx=Gn:s===3&&Gn&&(Gn.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else it(e)?(e={default:e,_ctx:Gn},t=32):(e=String(e),i&64?(t=16,e=[Cg(e)]):t=8);n.children=e,n.shapeFlag|=t}u(Tg,"normalizeChildren");function Hb(...n){const e={};for(let t=0;t<n.length;t++){const i=n[t];for(const s in i)if(s==="class")e.class!==i.class&&(e.class=qt([e.class,i.class]));else if(s==="style")e.style=Jn([e.style,i.style]);else if(Yd(s)){const r=e[s],o=i[s];o&&r!==o&&!(Ye(r)&&r.includes(o))&&(e[s]=r?[].concat(r,o):o)}else s!==""&&(e[s]=i[s])}return e}u(Hb,"mergeProps");function hs(n,e,t,i=null){rs(n,e,7,[t,i])}u(hs,"invokeVNodeHook");const wC=zb();let MC=0;function SC(n,e,t){const i=n.type,s=(e?e.appContext:n.appContext)||wC,r={uid:MC++,vnode:n,type:i,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new Jx(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Fb(i,s),emitsOptions:Sb(i,s),emit:null,emitted:null,propsDefaults:Ut,inheritAttrs:i.inheritAttrs,ctx:Ut,data:Ut,props:Ut,attrs:Ut,slots:Ut,refs:Ut,setupState:Ut,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=O2.bind(null,r),n.ce&&n.ce(r),r}u(SC,"createComponentInstance$1");let Ln=null;const $a=u(n=>{Ln=n,n.scope.on()},"setCurrentInstance"),Eo=u(()=>{Ln&&Ln.scope.off(),Ln=null},"unsetCurrentInstance");function Gb(n){return n.vnode.shapeFlag&4}u(Gb,"isStatefulComponent");let Vc=!1;function AC(n,e=!1){Vc=e;const{props:t,children:i}=n.vnode,s=Gb(n);oC(n,t,s,e),cC(n,i);const r=s?CC(n,e):void 0;return Vc=!1,r}u(AC,"setupComponent");function CC(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=db(new Proxy(n.ctx,eC));const{setup:i}=t;if(i){const s=n.setupContext=i.length>1?EC(n):null;$a(n),ul();const r=Er(i,n,0,[n.props,s]);if(hl(),Eo(),Kx(r)){if(r.then(Eo,Eo),e)return r.then(o=>{dv(n,o,e)}).catch(o=>{ef(o,n,0)});n.asyncDep=r}else dv(n,r,e)}else $b(n,e)}u(CC,"setupStatefulComponent");function dv(n,e,t){it(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:Ot(e)&&(n.setupState=vb(e)),$b(n,t)}u(dv,"handleSetupResult");let fv;function $b(n,e,t){const i=n.type;if(!n.render){if(!e&&fv&&!i.render){const s=i.template||wg(n).template;if(s){const{isCustomElement:r,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=i,c=ri(ri({isCustomElement:r,delimiters:a},o),l);i.render=fv(s,c)}}n.render=i.render||ss}$a(n),ul(),tC(n),hl(),Eo()}u($b,"finishComponentSetup");function TC(n){return new Proxy(n.attrs,{get(e,t){return Ri(n,"get","$attrs"),e[t]}})}u(TC,"createAttrsProxy");function EC(n){const e=u(i=>{n.exposed=i||{}},"expose");let t;return{get attrs(){return t||(t=TC(n))},slots:n.slots,emit:n.emit,expose:e}}u(EC,"createSetupContext");function cf(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(vb(db(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in xc)return xc[t](n)},has(e,t){return t in e||t in xc}}))}u(cf,"getExposeProxy");function PC(n,e=!0){return it(n)?n.displayName||n.name:n.name||e&&n.__name}u(PC,"getComponentName");function IC(n){return it(n)&&"__vccOpts"in n}u(IC,"isClassComponent");const at=u((n,e)=>P2(n,e,Vc),"computed");function Wb(n,e,t){const i=arguments.length;return i===2?Ot(e)&&!Ye(e)?Md(e)?Pe(n,null,[e]):Pe(n,e):Pe(n,null,e):(i>3?t=Array.prototype.slice.call(arguments,2):i===3&&Md(t)&&(t=[t]),Pe(n,e,t))}u(Wb,"h");const RC=Symbol(""),DC=u(()=>ii(RC),"useSSRContext"),LC="3.2.45",FC="http://www.w3.org/2000/svg",xo=typeof document!="undefined"?document:null,pv=xo&&xo.createElement("template"),OC={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,i)=>{const s=e?xo.createElementNS(FC,n):xo.createElement(n,t?{is:t}:void 0);return n==="select"&&i&&i.multiple!=null&&s.setAttribute("multiple",i.multiple),s},createText:n=>xo.createTextNode(n),createComment:n=>xo.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>xo.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,i,s,r){const o=t?t.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===r||!(s=s.nextSibling)););else{pv.innerHTML=i?`<svg>${n}</svg>`:n;const a=pv.content;if(i){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}};function NC(n,e,t){const i=n._vtc;i&&(e=(e?[e,...i]:[...i]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}u(NC,"patchClass");function kC(n,e,t){const i=n.style,s=ln(t);if(t&&!s){for(const r in t)Pm(i,r,t[r]);if(e&&!ln(e))for(const r in e)t[r]==null&&Pm(i,r,"")}else{const r=i.display;s?e!==t&&(i.cssText=t):e&&n.removeAttribute("style"),"_vod"in n&&(i.display=r)}}u(kC,"patchStyle");const mv=/\s*!important$/;function Pm(n,e,t){if(Ye(t))t.forEach(i=>Pm(n,e,i));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const i=zC(n,e);mv.test(t)?n.setProperty(No(i),t.replace(mv,""),"important"):n[i]=t}}u(Pm,"setStyle");const gv=["Webkit","Moz","ms"],$f={};function zC(n,e){const t=$f[e];if(t)return t;let i=Ts(e);if(i!=="filter"&&i in n)return $f[e]=i;i=Zd(i);for(let s=0;s<gv.length;s++){const r=gv[s]+i;if(r in n)return $f[e]=r}return e}u(zC,"autoPrefix");const vv="http://www.w3.org/1999/xlink";function BC(n,e,t,i,s){if(i&&e.startsWith("xlink:"))t==null?n.removeAttributeNS(vv,e.slice(6,e.length)):n.setAttributeNS(vv,e,t);else{const r=$A(e);t==null||r&&!Yx(t)?n.removeAttribute(e):n.setAttribute(e,r?"":t)}}u(BC,"patchAttr");function UC(n,e,t,i,s,r,o){if(e==="innerHTML"||e==="textContent"){i&&o(i,s,r),n[e]=t==null?"":t;return}if(e==="value"&&n.tagName!=="PROGRESS"&&!n.tagName.includes("-")){n._value=t;const l=t==null?"":t;(n.value!==l||n.tagName==="OPTION")&&(n.value=l),t==null&&n.removeAttribute(e);return}let a=!1;if(t===""||t==null){const l=typeof n[e];l==="boolean"?t=Yx(t):t==null&&l==="string"?(t="",a=!0):l==="number"&&(t=0,a=!0)}try{n[e]=t}catch{}a&&n.removeAttribute(e)}u(UC,"patchDOMProp");function bo(n,e,t,i){n.addEventListener(e,t,i)}u(bo,"addEventListener");function VC(n,e,t,i){n.removeEventListener(e,t,i)}u(VC,"removeEventListener");function HC(n,e,t,i,s=null){const r=n._vei||(n._vei={}),o=r[e];if(i&&o)o.value=i;else{const[a,l]=GC(e);if(i){const c=r[e]=jC(i,s);bo(n,a,c,l)}else o&&(VC(n,a,o,l),r[e]=void 0)}}u(HC,"patchEvent");const yv=/(?:Once|Passive|Capture)$/;function GC(n){let e;if(yv.test(n)){e={};let i;for(;i=n.match(yv);)n=n.slice(0,n.length-i[0].length),e[i[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):No(n.slice(2)),e]}u(GC,"parseName");let Wf=0;const $C=Promise.resolve(),WC=u(()=>Wf||($C.then(()=>Wf=0),Wf=Date.now()),"getNow");function jC(n,e){const t=u(i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=t.attached)return;rs(XC(i,t.value),e,5,[i])},"invoker");return t.value=n,t.attached=WC(),t}u(jC,"createInvoker");function XC(n,e){if(Ye(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(i=>s=>!s._stopped&&i&&i(s))}else return e}u(XC,"patchStopImmediatePropagation");const _v=/^on[a-z]/,YC=u((n,e,t,i,s=!1,r,o,a,l)=>{e==="class"?NC(n,i,s):e==="style"?kC(n,t,i):Yd(e)?ug(e)||HC(n,e,t,i,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):qC(n,e,i,s))?UC(n,e,i,r,o,a,l):(e==="true-value"?n._trueValue=i:e==="false-value"&&(n._falseValue=i),BC(n,e,i,s))},"patchProp");function qC(n,e,t,i){return i?!!(e==="innerHTML"||e==="textContent"||e in n&&_v.test(e)&&it(t)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA"||_v.test(e)&&ln(t)?!1:e in n}u(qC,"shouldSetAsProp");const Sd=u(n=>{const e=n.props["onUpdate:modelValue"]||!1;return Ye(e)?t=>od(e,t):e},"getModelAssigner");function KC(n){n.target.composing=!0}u(KC,"onCompositionStart");function xv(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}u(xv,"onCompositionEnd");const ZC={created(n,{modifiers:{lazy:e,trim:t,number:i}},s){n._assign=Sd(s);const r=i||s.props&&s.props.type==="number";bo(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),r&&(a=Oc(a)),n._assign(a)}),t&&bo(n,"change",()=>{n.value=n.value.trim()}),e||(bo(n,"compositionstart",KC),bo(n,"compositionend",xv),bo(n,"change",xv))},mounted(n,{value:e}){n.value=e==null?"":e},beforeUpdate(n,{value:e,modifiers:{lazy:t,trim:i,number:s}},r){if(n._assign=Sd(r),n.composing||document.activeElement===n&&n.type!=="range"&&(t||i&&n.value.trim()===e||(s||n.type==="number")&&Oc(n.value)===e))return;const o=e==null?"":e;n.value!==o&&(n.value=o)}},QC={deep:!0,created(n,{value:e,modifiers:{number:t}},i){const s=qd(e);bo(n,"change",()=>{const r=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?Oc(Ad(o)):Ad(o));n._assign(n.multiple?s?new Set(r):r:r[0])}),n._assign=Sd(i)},mounted(n,{value:e}){bv(n,e)},beforeUpdate(n,e,t){n._assign=Sd(t)},updated(n,{value:e}){bv(n,e)}};function bv(n,e){const t=n.multiple;if(!(t&&!Ye(e)&&!qd(e))){for(let i=0,s=n.options.length;i<s;i++){const r=n.options[i],o=Ad(r);if(t)Ye(e)?r.selected=jA(e,o)>-1:r.selected=e.has(o);else if(Xd(Ad(r),e)){n.selectedIndex!==i&&(n.selectedIndex=i);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}u(bv,"setSelected");function Ad(n){return"_value"in n?n._value:n.value}u(Ad,"getValue");const JC=["ctrl","shift","alt","meta"],eT={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>JC.some(t=>n[`${t}Key`]&&!e.includes(t))},on=u((n,e)=>(t,...i)=>{for(let s=0;s<e.length;s++){const r=eT[e[s]];if(r&&r(t,e))return}return n(t,...i)},"withModifiers"),tT={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},In=u((n,e)=>t=>{if(!("key"in t))return;const i=No(t.key);if(e.some(s=>s===i||tT[s]===i))return n(t)},"withKeys"),Ou={beforeMount(n,{value:e},{transition:t}){n._vod=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):Tl(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:i}){!e!=!t&&(i?e?(i.beforeEnter(n),Tl(n,!0),i.enter(n)):i.leave(n,()=>{Tl(n,!1)}):Tl(n,e))},beforeUnmount(n,{value:e}){Tl(n,e)}};function Tl(n,e){n.style.display=e?n._vod:"none"}u(Tl,"setDisplay");const nT=ri({patchProp:YC},OC);let wv;function iT(){return wv||(wv=fC(nT))}u(iT,"ensureRenderer");const jb=u((...n)=>{const e=iT().createApp(...n),{mount:t}=e;return e.mount=i=>{const s=sT(i);if(!s)return;const r=e._component;!it(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.innerHTML="";const o=t(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e},"createApp");function sT(n){return ln(n)?document.querySelector(n):n}u(sT,"normalizeContainer");var rT=Object.defineProperty,jf=u((n,e)=>rT(n,"name",{value:e,configurable:!0}),"__name$2v"),oT=Pt({setup(){const n=ii("errorSignal"),e=ze(""),t=ze(!1),i=jf(o=>{console.error(o),o instanceof Error?e.value=o.stack+"":e.value=o+"",t.value=!0},"showErrorMessageWindow"),s=jf(o=>{i(o.error)},"onError"),r=jf(o=>{i(o.reason)},"onUnhandledRejection");return n.addListener(i),window.addEventListener("error",s),window.addEventListener("unhandledrejection",r),of(()=>{n.removeListener(i),window.removeEventListener("error",s),window.removeEventListener("unhandledrejection",r)}),{errorMessage:e,errorMessageWindowVisible:t}}});var Ft=u((n,e)=>{const t=n.__vccOpts||n;for(const[i,s]of e)t[i]=s;return t},"_export_sfc");const aT=u(n=>(ko("data-v-18bfa632"),n=n(),zo(),n),"_withScopeId$6"),lT={key:0,class:"dialog-mask"},cT={class:"dialog"},uT=aT(()=>he("div",{style:{"margin-bottom":".25em"}},"An error occurred.",-1)),hT={readonly:""},dT={style:{"text-align":"right"}};function fT(n,e,t,i,s,r){const o=Yt("router-view");return Te(),Oe(Tt,null,[Pe(o),n.errorMessageWindowVisible?(Te(),Oe("div",lT,[he("div",cT,[uT,he("textarea",hT,$n(n.errorMessage),1),he("div",dT,[he("button",{onClick:e[0]||(e[0]=a=>n.errorMessageWindowVisible=!1)},"Close")])])])):tt("",!0)],64)}u(fT,"_sfc_render$q");var pT=Ft(oT,[["render",fT],["__scopeId","data-v-18bfa632"]]),mT=Object.defineProperty,gT=u((n,e)=>mT(n,"name",{value:e,configurable:!0}),"__name$2u");class Eg{constructor(){M(this,"listeners",[])}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.findIndex(i=>i===e);t>=0&&this.listeners.splice(t,1)}dispatch(e){this.listeners.forEach(t=>t(e))}}u(Eg,"Signal");gT(Eg,"Signal");/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const Ma=typeof window!="undefined";function vT(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}u(vT,"isESModule");const Ct=Object.assign;function Xf(n,e){const t={};for(const i in e){const s=e[i];t[i]=as(s)?s.map(n):n(s)}return t}u(Xf,"applyToParams");const Mc=u(()=>{},"noop"),as=Array.isArray,yT=/\/$/,_T=u(n=>n.replace(yT,""),"removeTrailingSlash");function Yf(n,e,t="/"){let i,s={},r="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(i=e.slice(0,l),r=e.slice(l+1,a>-1?a:e.length),s=n(r)),a>-1&&(i=i||e.slice(0,a),o=e.slice(a,e.length)),i=MT(i!=null?i:e,t),{fullPath:i+(r&&"?")+r+o,path:i,query:s,hash:o}}u(Yf,"parseURL");function xT(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}u(xT,"stringifyURL");function Mv(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}u(Mv,"stripBase");function bT(n,e,t){const i=e.matched.length-1,s=t.matched.length-1;return i>-1&&i===s&&Wa(e.matched[i],t.matched[s])&&Xb(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}u(bT,"isSameRouteLocation");function Wa(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}u(Wa,"isSameRouteRecord");function Xb(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!wT(n[t],e[t]))return!1;return!0}u(Xb,"isSameRouteLocationParams");function wT(n,e){return as(n)?Sv(n,e):as(e)?Sv(e,n):n===e}u(wT,"isSameRouteLocationParamsValue");function Sv(n,e){return as(e)?n.length===e.length&&n.every((t,i)=>t===e[i]):n.length===1&&n[0]===e}u(Sv,"isEquivalentArray");function MT(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),i=n.split("/");let s=t.length-1,r,o;for(r=0;r<i.length;r++)if(o=i[r],o!==".")if(o==="..")s>1&&s--;else break;return t.slice(0,s).join("/")+"/"+i.slice(r-(r===i.length?1:0)).join("/")}u(MT,"resolveRelativePath");var Hc;(function(n){n.pop="pop",n.push="push"})(Hc||(Hc={}));var Sc;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Sc||(Sc={}));function ST(n){if(!n)if(Ma){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),_T(n)}u(ST,"normalizeBase");const AT=/^[^#]+#/;function CT(n,e){return n.replace(AT,"#")+e}u(CT,"createHref");function TT(n,e){const t=document.documentElement.getBoundingClientRect(),i=n.getBoundingClientRect();return{behavior:e.behavior,left:i.left-t.left-(e.left||0),top:i.top-t.top-(e.top||0)}}u(TT,"getElementPosition");const uf=u(()=>({left:window.pageXOffset,top:window.pageYOffset}),"computeScrollPosition");function ET(n){let e;if("el"in n){const t=n.el,i=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?i?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=TT(s,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}u(ET,"scrollToPosition");function Av(n,e){return(history.state?history.state.position-e:-1)+n}u(Av,"getScrollKey");const Im=new Map;function PT(n,e){Im.set(n,e)}u(PT,"saveScrollPosition");function IT(n){const e=Im.get(n);return Im.delete(n),e}u(IT,"getSavedScrollPosition");let RT=u(()=>location.protocol+"//"+location.host,"createBaseLocation");function Yb(n,e){const{pathname:t,search:i,hash:s}=e,r=n.indexOf("#");if(r>-1){let a=s.includes(n.slice(r))?n.slice(r).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),Mv(l,"")}return Mv(t,n)+i+s}u(Yb,"createCurrentLocation");function DT(n,e,t,i){let s=[],r=[],o=null;const a=u(({state:f})=>{const p=Yb(n,location),g=t.value,m=e.value;let v=0;if(f){if(t.value=p,e.value=f,o&&o===g){o=null;return}v=m?f.position-m.position:0}else i(p);s.forEach(y=>{y(t.value,g,{delta:v,type:Hc.pop,direction:v?v>0?Sc.forward:Sc.back:Sc.unknown})})},"popStateHandler");function l(){o=t.value}u(l,"pauseListeners");function c(f){s.push(f);const p=u(()=>{const g=s.indexOf(f);g>-1&&s.splice(g,1)},"teardown");return r.push(p),p}u(c,"listen");function h(){const{history:f}=window;!f.state||f.replaceState(Ct({},f.state,{scroll:uf()}),"")}u(h,"beforeUnloadListener");function d(){for(const f of r)f();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return u(d,"destroy"),window.addEventListener("popstate",a),window.addEventListener("beforeunload",h),{pauseListeners:l,listen:c,destroy:d}}u(DT,"useHistoryListeners");function Cv(n,e,t,i=!1,s=!1){return{back:n,current:e,forward:t,replaced:i,position:window.history.length,scroll:s?uf():null}}u(Cv,"buildState");function LT(n){const{history:e,location:t}=window,i={value:Yb(n,t)},s={value:e.state};s.value||r(i.value,{back:null,current:i.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(l,c,h){const d=n.indexOf("#"),f=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+l:RT()+n+l;try{e[h?"replaceState":"pushState"](c,"",f),s.value=c}catch(p){console.error(p),t[h?"replace":"assign"](f)}}u(r,"changeLocation");function o(l,c){const h=Ct({},e.state,Cv(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});r(l,h,!0),i.value=l}u(o,"replace");function a(l,c){const h=Ct({},s.value,e.state,{forward:l,scroll:uf()});r(h.current,h,!0);const d=Ct({},Cv(i.value,l,null),{position:h.position+1},c);r(l,d,!1),i.value=l}return u(a,"push"),{location:i,state:s,push:a,replace:o}}u(LT,"useHistoryStateNavigation");function FT(n){n=ST(n);const e=LT(n),t=DT(n,e.state,e.location,e.replace);function i(r,o=!0){o||t.pauseListeners(),history.go(r)}u(i,"go");const s=Ct({location:"",base:n,go:i,createHref:CT.bind(null,n)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}u(FT,"createWebHistory");function OT(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),FT(n)}u(OT,"createWebHashHistory");function NT(n){return typeof n=="string"||n&&typeof n=="object"}u(NT,"isRouteLocation");function qb(n){return typeof n=="string"||typeof n=="symbol"}u(qb,"isRouteName");const rr={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},Kb=Symbol("");var Tv;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(Tv||(Tv={}));function ja(n,e){return Ct(new Error,{type:n,[Kb]:!0},e)}u(ja,"createRouterError");function Is(n,e){return n instanceof Error&&Kb in n&&(e==null||!!(n.type&e))}u(Is,"isNavigationFailure");const Ev="[^/]+?",kT={sensitive:!1,strict:!1,start:!0,end:!0},zT=/[.+*?^${}()[\]/\\]/g;function BT(n,e){const t=Ct({},kT,e),i=[];let s=t.start?"^":"";const r=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let d=0;d<c.length;d++){const f=c[d];let p=40+(t.sensitive?.25:0);if(f.type===0)d||(s+="/"),s+=f.value.replace(zT,"\\$&"),p+=40;else if(f.type===1){const{value:g,repeatable:m,optional:v,regexp:y}=f;r.push({name:g,repeatable:m,optional:v});const w=y||Ev;if(w!==Ev){p+=10;try{new RegExp(`(${w})`)}catch(A){throw new Error(`Invalid custom RegExp for param "${g}" (${w}): `+A.message)}}let _=m?`((?:${w})(?:/(?:${w}))*)`:`(${w})`;d||(_=v&&c.length<2?`(?:/${_})`:"/"+_),v&&(_+="?"),s+=_,p+=20,v&&(p+=-8),m&&(p+=-20),w===".*"&&(p+=-50)}h.push(p)}i.push(h)}if(t.strict&&t.end){const c=i.length-1;i[c][i[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const h=c.match(o),d={};if(!h)return null;for(let f=1;f<h.length;f++){const p=h[f]||"",g=r[f-1];d[g.name]=p&&g.repeatable?p.split("/"):p}return d}u(a,"parse");function l(c){let h="",d=!1;for(const f of n){(!d||!h.endsWith("/"))&&(h+="/"),d=!1;for(const p of f)if(p.type===0)h+=p.value;else if(p.type===1){const{value:g,repeatable:m,optional:v}=p,y=g in c?c[g]:"";if(as(y)&&!m)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const w=as(y)?y.join("/"):y;if(!w)if(v)f.length<2&&(h.endsWith("/")?h=h.slice(0,-1):d=!0);else throw new Error(`Missing required param "${g}"`);h+=w}}return h||"/"}return u(l,"stringify"),{re:o,score:i,keys:r,parse:a,stringify:l}}u(BT,"tokensToParser");function UT(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=e[t]-n[t];if(i)return i;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}u(UT,"compareScoreArray");function VT(n,e){let t=0;const i=n.score,s=e.score;for(;t<i.length&&t<s.length;){const r=UT(i[t],s[t]);if(r)return r;t++}if(Math.abs(s.length-i.length)===1){if(Pv(i))return 1;if(Pv(s))return-1}return s.length-i.length}u(VT,"comparePathParserScore");function Pv(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}u(Pv,"isLastScoreNegative");const HT={type:0,value:""},GT=/[a-zA-Z0-9_]/;function $T(n){if(!n)return[[]];if(n==="/")return[[HT]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(p){throw new Error(`ERR (${t})/"${c}": ${p}`)}u(e,"crash");let t=0,i=t;const s=[];let r;function o(){r&&s.push(r),r=[]}u(o,"finalizeSegment");let a=0,l,c="",h="";function d(){!c||(t===0?r.push({type:0,value:c}):t===1||t===2||t===3?(r.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}u(d,"consumeBuffer");function f(){c+=l}for(u(f,"addCharToBuffer");a<n.length;){if(l=n[a++],l==="\\"&&t!==2){i=t,t=4;continue}switch(t){case 0:l==="/"?(c&&d(),o()):l===":"?(d(),t=1):f();break;case 4:f(),t=i;break;case 1:l==="("?t=2:GT.test(l)?f():(d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),d(),o(),s}u($T,"tokenizePath");function WT(n,e,t){const i=BT($T(n.path),t),s=Ct(i,{record:n,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}u(WT,"createRouteRecordMatcher");function jT(n,e){const t=[],i=new Map;e=Dv({strict:!1,end:!0,sensitive:!1},e);function s(h){return i.get(h)}u(s,"getRecordMatcher");function r(h,d,f){const p=!f,g=XT(h);g.aliasOf=f&&f.record;const m=Dv(e,h),v=[g];if("alias"in h){const _=typeof h.alias=="string"?[h.alias]:h.alias;for(const A of _)v.push(Ct({},g,{components:f?f.record.components:g.components,path:A,aliasOf:f?f.record:g}))}let y,w;for(const _ of v){const{path:A}=_;if(d&&A[0]!=="/"){const x=d.record.path,C=x[x.length-1]==="/"?"":"/";_.path=d.record.path+(A&&C+A)}if(y=WT(_,d,m),f?f.alias.push(y):(w=w||y,w!==y&&w.alias.push(y),p&&h.name&&!Rv(y)&&o(h.name)),g.children){const x=g.children;for(let C=0;C<x.length;C++)r(x[C],y,f&&f.children[C])}f=f||y,(y.record.components&&Object.keys(y.record.components).length||y.record.name||y.record.redirect)&&l(y)}return w?()=>{o(w)}:Mc}u(r,"addRoute");function o(h){if(qb(h)){const d=i.get(h);d&&(i.delete(h),t.splice(t.indexOf(d),1),d.children.forEach(o),d.alias.forEach(o))}else{const d=t.indexOf(h);d>-1&&(t.splice(d,1),h.record.name&&i.delete(h.record.name),h.children.forEach(o),h.alias.forEach(o))}}u(o,"removeRoute");function a(){return t}u(a,"getRoutes");function l(h){let d=0;for(;d<t.length&&VT(h,t[d])>=0&&(h.record.path!==t[d].record.path||!Zb(h,t[d]));)d++;t.splice(d,0,h),h.record.name&&!Rv(h)&&i.set(h.record.name,h)}u(l,"insertMatcher");function c(h,d){let f,p={},g,m;if("name"in h&&h.name){if(f=i.get(h.name),!f)throw ja(1,{location:h});m=f.record.name,p=Ct(Iv(d.params,f.keys.filter(w=>!w.optional).map(w=>w.name)),h.params&&Iv(h.params,f.keys.map(w=>w.name))),g=f.stringify(p)}else if("path"in h)g=h.path,f=t.find(w=>w.re.test(g)),f&&(p=f.parse(g),m=f.record.name);else{if(f=d.name?i.get(d.name):t.find(w=>w.re.test(d.path)),!f)throw ja(1,{location:h,currentLocation:d});m=f.record.name,p=Ct({},d.params,h.params),g=f.stringify(p)}const v=[];let y=f;for(;y;)v.unshift(y.record),y=y.parent;return{name:m,path:g,params:p,matched:v,meta:qT(v)}}return u(c,"resolve"),n.forEach(h=>r(h)),{addRoute:r,resolve:c,removeRoute:o,getRoutes:a,getRecordMatcher:s}}u(jT,"createRouterMatcher");function Iv(n,e){const t={};for(const i of e)i in n&&(t[i]=n[i]);return t}u(Iv,"paramsFromLocation");function XT(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:YT(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}u(XT,"normalizeRouteRecord");function YT(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const i in n.components)e[i]=typeof t=="boolean"?t:t[i];return e}u(YT,"normalizeRecordProps");function Rv(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}u(Rv,"isAliasRecord");function qT(n){return n.reduce((e,t)=>Ct(e,t.meta),{})}u(qT,"mergeMetaFields");function Dv(n,e){const t={};for(const i in n)t[i]=i in e?e[i]:n[i];return t}u(Dv,"mergeOptions");function Zb(n,e){return e.children.some(t=>t===n||Zb(n,t))}u(Zb,"isRecordChildOf");const Qb=/#/g,KT=/&/g,ZT=/\//g,QT=/=/g,JT=/\?/g,Jb=/\+/g,e3=/%5B/g,t3=/%5D/g,ew=/%5E/g,n3=/%60/g,tw=/%7B/g,i3=/%7C/g,nw=/%7D/g,s3=/%20/g;function Pg(n){return encodeURI(""+n).replace(i3,"|").replace(e3,"[").replace(t3,"]")}u(Pg,"commonEncode");function r3(n){return Pg(n).replace(tw,"{").replace(nw,"}").replace(ew,"^")}u(r3,"encodeHash");function Rm(n){return Pg(n).replace(Jb,"%2B").replace(s3,"+").replace(Qb,"%23").replace(KT,"%26").replace(n3,"`").replace(tw,"{").replace(nw,"}").replace(ew,"^")}u(Rm,"encodeQueryValue");function o3(n){return Rm(n).replace(QT,"%3D")}u(o3,"encodeQueryKey");function a3(n){return Pg(n).replace(Qb,"%23").replace(JT,"%3F")}u(a3,"encodePath");function l3(n){return n==null?"":a3(n).replace(ZT,"%2F")}u(l3,"encodeParam");function Cd(n){try{return decodeURIComponent(""+n)}catch{}return""+n}u(Cd,"decode");function c3(n){const e={};if(n===""||n==="?")return e;const i=(n[0]==="?"?n.slice(1):n).split("&");for(let s=0;s<i.length;++s){const r=i[s].replace(Jb," "),o=r.indexOf("="),a=Cd(o<0?r:r.slice(0,o)),l=o<0?null:Cd(r.slice(o+1));if(a in e){let c=e[a];as(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}u(c3,"parseQuery");function Lv(n){let e="";for(let t in n){const i=n[t];if(t=o3(t),i==null){i!==void 0&&(e+=(e.length?"&":"")+t);continue}(as(i)?i.map(r=>r&&Rm(r)):[i&&Rm(i)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}u(Lv,"stringifyQuery");function u3(n){const e={};for(const t in n){const i=n[t];i!==void 0&&(e[t]=as(i)?i.map(s=>s==null?null:""+s):i==null?i:""+i)}return e}u(u3,"normalizeQuery");const h3=Symbol(""),Fv=Symbol(""),Ig=Symbol(""),iw=Symbol(""),Dm=Symbol("");function El(){let n=[];function e(i){return n.push(i),()=>{const s=n.indexOf(i);s>-1&&n.splice(s,1)}}u(e,"add");function t(){n=[]}return u(t,"reset"),{add:e,list:()=>n,reset:t}}u(El,"useCallbacks");function br(n,e,t,i,s){const r=i&&(i.enterCallbacks[s]=i.enterCallbacks[s]||[]);return()=>new Promise((o,a)=>{const l=u(d=>{d===!1?a(ja(4,{from:t,to:e})):d instanceof Error?a(d):NT(d)?a(ja(2,{from:e,to:d})):(r&&i.enterCallbacks[s]===r&&typeof d=="function"&&r.push(d),o())},"next"),c=n.call(i&&i.instances[s],e,t,l);let h=Promise.resolve(c);n.length<3&&(h=h.then(l)),h.catch(d=>a(d))})}u(br,"guardToPromiseFn");function qf(n,e,t,i){const s=[];for(const r of n)for(const o in r.components){let a=r.components[o];if(!(e!=="beforeRouteEnter"&&!r.instances[o]))if(d3(a)){const c=(a.__vccOpts||a)[e];c&&s.push(br(c,t,i,r,o))}else{let l=a();s.push(()=>l.then(c=>{if(!c)return Promise.reject(new Error(`Couldn't resolve component "${o}" at "${r.path}"`));const h=vT(c)?c.default:c;r.components[o]=h;const f=(h.__vccOpts||h)[e];return f&&br(f,t,i,r,o)()}))}}return s}u(qf,"extractComponentsGuards");function d3(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}u(d3,"isRouteComponent");function Ov(n){const e=ii(Ig),t=ii(iw),i=at(()=>e.resolve(Na(n.to))),s=at(()=>{const{matched:l}=i.value,{length:c}=l,h=l[c-1],d=t.matched;if(!h||!d.length)return-1;const f=d.findIndex(Wa.bind(null,h));if(f>-1)return f;const p=Nv(l[c-2]);return c>1&&Nv(h)===p&&d[d.length-1].path!==p?d.findIndex(Wa.bind(null,l[c-2])):f}),r=at(()=>s.value>-1&&g3(t.params,i.value.params)),o=at(()=>s.value>-1&&s.value===t.matched.length-1&&Xb(t.params,i.value.params));function a(l={}){return m3(l)?e[Na(n.replace)?"replace":"push"](Na(n.to)).catch(Mc):Promise.resolve()}return u(a,"navigate"),{route:i,href:at(()=>i.value.href),isActive:r,isExactActive:o,navigate:a}}u(Ov,"useLink");const f3=Pt({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ov,setup(n,{slots:e}){const t=Tr(Ov(n)),{options:i}=ii(Ig),s=at(()=>({[kv(n.activeClass,i.linkActiveClass,"router-link-active")]:t.isActive,[kv(n.exactActiveClass,i.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&e.default(t);return n.custom?r:Wb("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},r)}}}),p3=f3;function m3(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}u(m3,"guardEvent");function g3(n,e){for(const t in e){const i=e[t],s=n[t];if(typeof i=="string"){if(i!==s)return!1}else if(!as(s)||s.length!==i.length||i.some((r,o)=>r!==s[o]))return!1}return!0}u(g3,"includesParams");function Nv(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}u(Nv,"getOriginalPath");const kv=u((n,e,t)=>n!=null?n:e!=null?e:t,"getLinkClass"),v3=Pt({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const i=ii(Dm),s=at(()=>n.route||i.value),r=ii(Fv,0),o=at(()=>{let c=Na(r);const{matched:h}=s.value;let d;for(;(d=h[c])&&!d.components;)c++;return c}),a=at(()=>s.value.matched[o.value]);za(Fv,at(()=>o.value+1)),za(h3,a),za(Dm,s);const l=ze();return si(()=>[l.value,a.value,n.name],([c,h,d],[f,p,g])=>{h&&(h.instances[d]=c,p&&p!==h&&c&&c===f&&(h.leaveGuards.size||(h.leaveGuards=p.leaveGuards),h.updateGuards.size||(h.updateGuards=p.updateGuards))),c&&h&&(!p||!Wa(h,p)||!f)&&(h.enterCallbacks[d]||[]).forEach(m=>m(c))},{flush:"post"}),()=>{const c=s.value,h=n.name,d=a.value,f=d&&d.components[h];if(!f)return zv(t.default,{Component:f,route:c});const p=d.props[h],g=p?p===!0?c.params:typeof p=="function"?p(c):p:null,v=Wb(f,Ct({},g,e,{onVnodeUnmounted:u(y=>{y.component.isUnmounted&&(d.instances[h]=null)},"onVnodeUnmounted"),ref:l}));return zv(t.default,{Component:v,route:c})||v}}});function zv(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}u(zv,"normalizeSlot");const y3=v3;function _3(n){const e=jT(n.routes,n),t=n.parseQuery||c3,i=n.stringifyQuery||Lv,s=n.history,r=El(),o=El(),a=El(),l=T2(rr);let c=rr;Ma&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=Xf.bind(null,N=>""+N),d=Xf.bind(null,l3),f=Xf.bind(null,Cd);function p(N,F){let H,$;return qb(N)?(H=e.getRecordMatcher(N),$=F):$=N,e.addRoute($,H)}u(p,"addRoute");function g(N){const F=e.getRecordMatcher(N);F&&e.removeRoute(F)}u(g,"removeRoute");function m(){return e.getRoutes().map(N=>N.record)}u(m,"getRoutes");function v(N){return!!e.getRecordMatcher(N)}u(v,"hasRoute");function y(N,F){if(F=Ct({},F||l.value),typeof N=="string"){const E=Yf(t,N,F.path),L=e.resolve({path:E.path},F),G=s.createHref(E.fullPath);return Ct(E,L,{params:f(L.params),hash:Cd(E.hash),redirectedFrom:void 0,href:G})}let H;if("path"in N)H=Ct({},N,{path:Yf(t,N.path,F.path).path});else{const E=Ct({},N.params);for(const L in E)E[L]==null&&delete E[L];H=Ct({},N,{params:d(N.params)}),F.params=d(F.params)}const $=e.resolve(H,F),te=N.hash||"";$.params=h(f($.params));const se=xT(i,Ct({},N,{hash:r3(te),path:$.path})),ae=s.createHref(se);return Ct({fullPath:se,hash:te,query:i===Lv?u3(N.query):N.query||{}},$,{redirectedFrom:void 0,href:ae})}u(y,"resolve");function w(N){return typeof N=="string"?Yf(t,N,l.value.path):Ct({},N)}u(w,"locationAsObject");function _(N,F){if(c!==N)return ja(8,{from:F,to:N})}u(_,"checkCanceledNavigation");function A(N){return T(N)}u(A,"push");function x(N){return A(Ct(w(N),{replace:!0}))}u(x,"replace");function C(N){const F=N.matched[N.matched.length-1];if(F&&F.redirect){const{redirect:H}=F;let $=typeof H=="function"?H(N):H;return typeof $=="string"&&($=$.includes("?")||$.includes("#")?$=w($):{path:$},$.params={}),Ct({query:N.query,hash:N.hash,params:"path"in $?{}:N.params},$)}}u(C,"handleRedirectRecord");function T(N,F){const H=c=y(N),$=l.value,te=N.state,se=N.force,ae=N.replace===!0,E=C(H);if(E)return T(Ct(w(E),{state:typeof E=="object"?Ct({},te,E.state):te,force:se,replace:ae}),F||H);const L=H;L.redirectedFrom=F;let G;return!se&&bT(i,$,H)&&(G=ja(16,{to:L,from:$}),Z($,$,!0,!1)),(G?Promise.resolve(G):I(L,$)).catch(K=>Is(K)?Is(K,2)?K:V(K):J(K,L,$)).then(K=>{if(K){if(Is(K,2))return T(Ct({replace:ae},w(K.to),{state:typeof K.to=="object"?Ct({},te,K.to.state):te,force:se}),F||L)}else K=B(L,$,!0,ae,te);return D(L,$,K),K})}u(T,"pushWithRedirect");function S(N,F){const H=_(N,F);return H?Promise.reject(H):Promise.resolve()}u(S,"checkCanceledNavigationAndReject");function I(N,F){let H;const[$,te,se]=x3(N,F);H=qf($.reverse(),"beforeRouteLeave",N,F);for(const E of $)E.leaveGuards.forEach(L=>{H.push(br(L,N,F))});const ae=S.bind(null,N,F);return H.push(ae),Zo(H).then(()=>{H=[];for(const E of r.list())H.push(br(E,N,F));return H.push(ae),Zo(H)}).then(()=>{H=qf(te,"beforeRouteUpdate",N,F);for(const E of te)E.updateGuards.forEach(L=>{H.push(br(L,N,F))});return H.push(ae),Zo(H)}).then(()=>{H=[];for(const E of N.matched)if(E.beforeEnter&&!F.matched.includes(E))if(as(E.beforeEnter))for(const L of E.beforeEnter)H.push(br(L,N,F));else H.push(br(E.beforeEnter,N,F));return H.push(ae),Zo(H)}).then(()=>(N.matched.forEach(E=>E.enterCallbacks={}),H=qf(se,"beforeRouteEnter",N,F),H.push(ae),Zo(H))).then(()=>{H=[];for(const E of o.list())H.push(br(E,N,F));return H.push(ae),Zo(H)}).catch(E=>Is(E,8)?E:Promise.reject(E))}u(I,"navigate");function D(N,F,H){for(const $ of a.list())$(N,F,H)}u(D,"triggerAfterEach");function B(N,F,H,$,te){const se=_(N,F);if(se)return se;const ae=F===rr,E=Ma?history.state:{};H&&($||ae?s.replace(N.fullPath,Ct({scroll:ae&&E&&E.scroll},te)):s.push(N.fullPath,te)),l.value=N,Z(N,F,H,ae),V()}u(B,"finalizeNavigation");let Q;function U(){Q||(Q=s.listen((N,F,H)=>{if(!k.listening)return;const $=y(N),te=C($);if(te){T(Ct(te,{replace:!0}),$).catch(Mc);return}c=$;const se=l.value;Ma&&PT(Av(se.fullPath,H.delta),uf()),I($,se).catch(ae=>Is(ae,12)?ae:Is(ae,2)?(T(ae.to,$).then(E=>{Is(E,20)&&!H.delta&&H.type===Hc.pop&&s.go(-1,!1)}).catch(Mc),Promise.reject()):(H.delta&&s.go(-H.delta,!1),J(ae,$,se))).then(ae=>{ae=ae||B($,se,!1),ae&&(H.delta&&!Is(ae,8)?s.go(-H.delta,!1):H.type===Hc.pop&&Is(ae,20)&&s.go(-1,!1)),D($,se,ae)}).catch(Mc)}))}u(U,"setupListeners");let z=El(),q=El(),ee;function J(N,F,H){V(N);const $=q.list();return $.length?$.forEach(te=>te(N,F,H)):console.error(N),Promise.reject(N)}u(J,"triggerError");function X(){return ee&&l.value!==rr?Promise.resolve():new Promise((N,F)=>{z.add([N,F])})}u(X,"isReady");function V(N){return ee||(ee=!N,U(),z.list().forEach(([F,H])=>N?H(N):F()),z.reset()),N}u(V,"markAsReady");function Z(N,F,H,$){const{scrollBehavior:te}=n;if(!Ma||!te)return Promise.resolve();const se=!H&&IT(Av(N.fullPath,0))||($||!H)&&history.state&&history.state.scroll||null;return Bi().then(()=>te(N,F,se)).then(ae=>ae&&ET(ae)).catch(ae=>J(ae,N,F))}u(Z,"handleScroll");const de=u(N=>s.go(N),"go");let Y;const fe=new Set,k={currentRoute:l,listening:!0,addRoute:p,removeRoute:g,hasRoute:v,getRoutes:m,resolve:y,options:n,push:A,replace:x,go:de,back:()=>de(-1),forward:()=>de(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:q.add,isReady:X,install(N){const F=this;N.component("RouterLink",p3),N.component("RouterView",y3),N.config.globalProperties.$router=F,Object.defineProperty(N.config.globalProperties,"$route",{enumerable:!0,get:()=>Na(l)}),Ma&&!Y&&l.value===rr&&(Y=!0,A(s.location).catch(te=>{}));const H={};for(const te in rr)H[te]=at(()=>l.value[te]);N.provide(Ig,F),N.provide(iw,Tr(H)),N.provide(Dm,l);const $=N.unmount;fe.add(N),N.unmount=function(){fe.delete(N),fe.size<1&&(c=rr,Q&&Q(),Q=null,l.value=rr,Y=!1,ee=!1),$()}}};return k}u(_3,"createRouter");function Zo(n){return n.reduce((e,t)=>e.then(()=>t()),Promise.resolve())}u(Zo,"runGuardQueue");function x3(n,e){const t=[],i=[],s=[],r=Math.max(e.matched.length,n.matched.length);for(let o=0;o<r;o++){const a=e.matched[o];a&&(n.matched.find(c=>Wa(c,a))?i.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Wa(c,l))||s.push(l))}return[t,i,s]}u(x3,"extractChangingRecords");/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Rg="146",b3=0,Bv=1,w3=2,sw=1,rw=2,fc=3,Xa=0,Vi=1,Ui=2,Ss=0,Ba=1,Lm=2,Uv=3,Vv=4,M3=5,Sa=100,S3=101,A3=102,Hv=103,Gv=104,C3=200,T3=201,E3=202,P3=203,ow=204,aw=205,I3=206,R3=207,D3=208,L3=209,F3=210,O3=0,N3=1,k3=2,Fm=3,z3=4,B3=5,U3=6,V3=7,hf=0,H3=1,G3=2,As=0,$3=1,W3=2,j3=3,X3=4,Y3=5,lw=300,Ya=301,qa=302,Td=303,Om=304,df=306,Ka=1e3,pi=1001,Ed=1002,yn=1003,Nm=1004,km=1005,Ci=1006,cw=1007,cu=1008,Lo=1009,q3=1010,K3=1011,uw=1012,Z3=1013,So=1014,Mr=1015,Za=1016,Q3=1017,J3=1018,Ua=1020,eE=1021,tE=1022,Ti=1023,nE=1024,iE=1025,Po=1026,Qa=1027,sE=1028,rE=1029,oE=1030,aE=1031,lE=1033,Kf=33776,Zf=33777,Qf=33778,Jf=33779,$v=35840,Wv=35841,jv=35842,Xv=35843,cE=36196,Yv=37492,qv=37496,Kv=37808,Zv=37809,Qv=37810,Jv=37811,ey=37812,ty=37813,ny=37814,iy=37815,sy=37816,ry=37817,oy=37818,ay=37819,ly=37820,cy=37821,uy=36492,Gc=2300,$c=2301,ep=2302,hy=2400,dy=2401,fy=2402,uE=2500,Ks=3e3,Dt=3001,hE=3200,hw=3201,ff=0,dE=1,$s="srgb",Ao="srgb-linear",tp=7680,fE=519,py=35044,my="300 es",zm=1035;class Uo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}u(Uo,"EventDispatcher");const kn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let gy=1234567;const Ac=Math.PI/180,Wc=180/Math.PI;function Ur(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(kn[n&255]+kn[n>>8&255]+kn[n>>16&255]+kn[n>>24&255]+"-"+kn[e&255]+kn[e>>8&255]+"-"+kn[e>>16&15|64]+kn[e>>24&255]+"-"+kn[t&63|128]+kn[t>>8&255]+"-"+kn[t>>16&255]+kn[t>>24&255]+kn[i&255]+kn[i>>8&255]+kn[i>>16&255]+kn[i>>24&255]).toLowerCase()}u(Ur,"generateUUID");function Bn(n,e,t){return Math.max(e,Math.min(t,n))}u(Bn,"clamp");function Dg(n,e){return(n%e+e)%e}u(Dg,"euclideanModulo");function pE(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}u(pE,"mapLinear");function mE(n,e,t){return n!==e?(t-n)/(e-n):0}u(mE,"inverseLerp");function Cc(n,e,t){return(1-t)*n+t*e}u(Cc,"lerp");function gE(n,e,t,i){return Cc(n,e,1-Math.exp(-t*i))}u(gE,"damp");function vE(n,e=1){return e-Math.abs(Dg(n,e*2)-e)}u(vE,"pingpong");function yE(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}u(yE,"smoothstep");function _E(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}u(_E,"smootherstep");function xE(n,e){return n+Math.floor(Math.random()*(e-n+1))}u(xE,"randInt");function bE(n,e){return n+Math.random()*(e-n)}u(bE,"randFloat");function wE(n){return n*(.5-Math.random())}u(wE,"randFloatSpread");function ME(n){n!==void 0&&(gy=n);let e=gy+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}u(ME,"seededRandom");function SE(n){return n*Ac}u(SE,"degToRad");function AE(n){return n*Wc}u(AE,"radToDeg");function Bm(n){return(n&n-1)===0&&n!==0}u(Bm,"isPowerOfTwo");function dw(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}u(dw,"ceilPowerOfTwo");function Pd(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}u(Pd,"floorPowerOfTwo");function CE(n,e,t,i,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+i)/2),h=o((e+i)/2),d=r((e-i)/2),f=o((e-i)/2),p=r((i-e)/2),g=o((i-e)/2);switch(s){case"XYX":n.set(a*h,l*d,l*f,a*c);break;case"YZY":n.set(l*f,a*h,l*d,a*c);break;case"ZXZ":n.set(l*d,l*f,a*h,a*c);break;case"XZX":n.set(a*h,l*g,l*p,a*c);break;case"YXY":n.set(l*p,a*h,l*g,a*c);break;case"ZYZ":n.set(l*g,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}u(CE,"setQuaternionFromProperEuler");function pc(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}u(pc,"denormalize");function li(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}u(li,"normalize");var ts=Object.freeze({__proto__:null,DEG2RAD:Ac,RAD2DEG:Wc,generateUUID:Ur,clamp:Bn,euclideanModulo:Dg,mapLinear:pE,inverseLerp:mE,lerp:Cc,damp:gE,pingpong:vE,smoothstep:yE,smootherstep:_E,randInt:xE,randFloat:bE,randFloatSpread:wE,seededRandom:ME,degToRad:SE,radToDeg:AE,isPowerOfTwo:Bm,ceilPowerOfTwo:dw,floorPowerOfTwo:Pd,setQuaternionFromProperEuler:CE,normalize:li,denormalize:pc});class Ge{constructor(e=0,t=0){Ge.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*i-o*s+e.x,this.y=r*s+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}u(Ge,"Vector2");class ti{constructor(){ti.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,s,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=s,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],d=i[7],f=i[2],p=i[5],g=i[8],m=s[0],v=s[3],y=s[6],w=s[1],_=s[4],A=s[7],x=s[2],C=s[5],T=s[8];return r[0]=o*m+a*w+l*x,r[3]=o*v+a*_+l*C,r[6]=o*y+a*A+l*T,r[1]=c*m+h*w+d*x,r[4]=c*v+h*_+d*C,r[7]=c*y+h*A+d*T,r[2]=f*m+p*w+g*x,r[5]=f*v+p*_+g*C,r[8]=f*y+p*A+g*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-i*r*h+i*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=a*l-h*r,p=c*r-o*l,g=t*d+i*f+s*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/g;return e[0]=d*m,e[1]=(s*c-h*i)*m,e[2]=(a*i-s*o)*m,e[3]=f*m,e[4]=(h*t-s*l)*m,e[5]=(s*r-a*t)*m,e[6]=p*m,e[7]=(i*l-c*t)*m,e[8]=(o*t-i*r)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.elements,r=s[0],o=s[3],a=s[6],l=s[1],c=s[4],h=s[7];return s[0]=t*r+i*l,s[3]=t*o+i*c,s[6]=t*a+i*h,s[1]=-i*r+t*l,s[4]=-i*o+t*c,s[7]=-i*a+t*h,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}u(ti,"Matrix3");function fw(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}u(fw,"arrayNeedsUint32");function jc(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}u(jc,"createElementNS");function Io(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}u(Io,"SRGBToLinear");function ld(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}u(ld,"LinearToSRGB");const np={[$s]:{[Ao]:Io},[Ao]:{[$s]:ld}},Xi={legacyMode:!0,get workingColorSpace(){return Ao},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(np[e]&&np[e][t]!==void 0){const i=np[e][t];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},pw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},mn={r:0,g:0,b:0},Yi={h:0,s:0,l:0},Nu={h:0,s:0,l:0};function ip(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}u(ip,"hue2rgb");function ku(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}u(ku,"toComponents");class Ie{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=$s){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Xi.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=Ao){return this.r=e,this.g=t,this.b=i,Xi.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=Ao){if(e=Dg(e,1),t=Bn(t,0,1),i=Bn(i,0,1),t===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+t):i+t-i*t,o=2*i-r;this.r=ip(o,r,e+1/3),this.g=ip(o,r,e),this.b=ip(o,r,e-1/3)}return Xi.toWorkingColorSpace(this,s),this}setStyle(e,t=$s){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}u(i,"handleAlpha");let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,Xi.toWorkingColorSpace(this,t),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,Xi.toWorkingColorSpace(this,t),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(r[1])/360,c=parseFloat(r[2])/100,h=parseFloat(r[3])/100;return i(r[4]),this.setHSL(l,c,h,t)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,Xi.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,Xi.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=$s){const i=pw[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Io(e.r),this.g=Io(e.g),this.b=Io(e.b),this}copyLinearToSRGB(e){return this.r=ld(e.r),this.g=ld(e.g),this.b=ld(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=$s){return Xi.fromWorkingColorSpace(ku(this,mn),e),Bn(mn.r*255,0,255)<<16^Bn(mn.g*255,0,255)<<8^Bn(mn.b*255,0,255)<<0}getHexString(e=$s){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ao){Xi.fromWorkingColorSpace(ku(this,mn),t);const i=mn.r,s=mn.g,r=mn.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=h<=.5?d/(o+a):d/(2-o-a),o){case i:l=(s-r)/d+(s<r?6:0);break;case s:l=(r-i)/d+2;break;case r:l=(i-s)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=Ao){return Xi.fromWorkingColorSpace(ku(this,mn),t),e.r=mn.r,e.g=mn.g,e.b=mn.b,e}getStyle(e=$s){return Xi.fromWorkingColorSpace(ku(this,mn),e),e!==$s?`color(${e} ${mn.r} ${mn.g} ${mn.b})`:`rgb(${mn.r*255|0},${mn.g*255|0},${mn.b*255|0})`}offsetHSL(e,t,i){return this.getHSL(Yi),Yi.h+=e,Yi.s+=t,Yi.l+=i,this.setHSL(Yi.h,Yi.s,Yi.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Yi),e.getHSL(Nu);const i=Cc(Yi.h,Nu.h,t),s=Cc(Yi.s,Nu.s,t),r=Cc(Yi.l,Nu.l,t);return this.setHSL(i,s,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}u(Ie,"Color");Ie.NAMES=pw;let Qo;class Lg{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Qo===void 0&&(Qo=jc("canvas")),Qo.width=e.width,Qo.height=e.height;const i=Qo.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Qo}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=jc("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=Io(r[o]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Io(t[i]/255)*255):t[i]=Io(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}u(Lg,"ImageUtils");class pf{constructor(e=null){this.isSource=!0,this.uuid=Ur(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(sp(s[o].image)):r.push(sp(s[o]))}else r=sp(s);i.url=r}return t||(e.images[this.uuid]=i),i}}u(pf,"Source");function sp(n){return typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&n instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?Lg.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}u(sp,"serializeImage");let TE=0;class On extends Uo{constructor(e=On.DEFAULT_IMAGE,t=On.DEFAULT_MAPPING,i=pi,s=pi,r=Ci,o=cu,a=Ti,l=Lo,c=1,h=Ks){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:TE++}),this.uuid=Ur(),this.name="",this.source=new pf(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Ge(0,0),this.repeat=new Ge(1,1),this.center=new Ge(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ti,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==lw)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ka:e.x=e.x-Math.floor(e.x);break;case pi:e.x=e.x<0?0:1;break;case Ed:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ka:e.y=e.y-Math.floor(e.y);break;case pi:e.y=e.y<0?0:1;break;case Ed:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}u(On,"Texture");On.DEFAULT_IMAGE=null;On.DEFAULT_MAPPING=lw;class gt{constructor(e=0,t=0,i=0,s=1){gt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,r;const l=e.elements,c=l[0],h=l[4],d=l[8],f=l[1],p=l[5],g=l[9],m=l[2],v=l[6],y=l[10];if(Math.abs(h-f)<.01&&Math.abs(d-m)<.01&&Math.abs(g-v)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+m)<.1&&Math.abs(g+v)<.1&&Math.abs(c+p+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,A=(p+1)/2,x=(y+1)/2,C=(h+f)/4,T=(d+m)/4,S=(g+v)/4;return _>A&&_>x?_<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(_),s=C/i,r=T/i):A>x?A<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(A),i=C/s,r=S/s):x<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(x),i=T/r,s=S/r),this.set(i,s,r,t),this}let w=Math.sqrt((v-g)*(v-g)+(d-m)*(d-m)+(f-h)*(f-h));return Math.abs(w)<.001&&(w=1),this.x=(v-g)/w,this.y=(d-m)/w,this.z=(f-h)/w,this.w=Math.acos((c+p+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}u(gt,"Vector4");class Rn extends Uo{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new gt(0,0,e,t),this.scissorTest=!1,this.viewport=new gt(0,0,e,t);const s={width:e,height:t,depth:1};this.texture=new On(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:Ci,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new pf(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}u(Rn,"WebGLRenderTarget");class Fg extends On{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=yn,this.minFilter=yn,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(Fg,"DataArrayTexture");class mw extends On{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=yn,this.minFilter=yn,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(mw,"Data3DTexture");class Ve{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],d=i[s+3];const f=r[o+0],p=r[o+1],g=r[o+2],m=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=g,e[t+3]=m;return}if(d!==m||l!==f||c!==p||h!==g){let v=1-a;const y=l*f+c*p+h*g+d*m,w=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const x=Math.sqrt(_),C=Math.atan2(x,y*w);v=Math.sin(v*C)/x,a=Math.sin(a*C)/x}const A=a*w;if(l=l*v+f*A,c=c*v+p*A,h=h*v+g*A,d=d*v+m*A,v===1-a){const x=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=x,c*=x,h*=x,d*=x}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],d=r[o],f=r[o+1],p=r[o+2],g=r[o+3];return e[t]=a*g+h*d+l*p-c*f,e[t+1]=l*g+h*f+c*d-a*p,e[t+2]=c*g+h*p+a*f-l*d,e[t+3]=h*g-a*d-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),d=a(r/2),f=l(i/2),p=l(s/2),g=l(r/2);switch(o){case"XYZ":this._x=f*h*d+c*p*g,this._y=c*p*d-f*h*g,this._z=c*h*g+f*p*d,this._w=c*h*d-f*p*g;break;case"YXZ":this._x=f*h*d+c*p*g,this._y=c*p*d-f*h*g,this._z=c*h*g-f*p*d,this._w=c*h*d+f*p*g;break;case"ZXY":this._x=f*h*d-c*p*g,this._y=c*p*d+f*h*g,this._z=c*h*g+f*p*d,this._w=c*h*d-f*p*g;break;case"ZYX":this._x=f*h*d-c*p*g,this._y=c*p*d+f*h*g,this._z=c*h*g-f*p*d,this._w=c*h*d+f*p*g;break;case"YZX":this._x=f*h*d+c*p*g,this._y=c*p*d+f*h*g,this._z=c*h*g-f*p*d,this._w=c*h*d-f*p*g;break;case"XZY":this._x=f*h*d-c*p*g,this._y=c*p*d-f*h*g,this._z=c*h*g+f*p*d,this._w=c*h*d+f*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],d=t[10],f=i+a+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-s)*p}else if(i>a&&i>d){const p=2*Math.sqrt(1+i-a-d);this._w=(h-l)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+c)/p}else if(a>d){const p=2*Math.sqrt(1+a-i-d);this._w=(r-c)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+d-i-a);this._w=(o-s)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Bn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+i*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*i+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-t)*h)/c,f=Math.sin(t*h)/c;return this._w=o*d+this._w*f,this._x=i*d+this._x*f,this._y=s*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),i*Math.sin(r),i*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}u(Ve,"Quaternion");class b{constructor(e=0,t=0,i=0){b.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(vy.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(vy.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*s,this.y=r[1]*t+r[4]*i+r[7]*s,this.z=r[2]*t+r[5]*i+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*s-a*i,h=l*i+a*t-r*s,d=l*s+r*i-o*t,f=-r*t-o*i-a*s;return this.x=c*l+f*-r+h*-a-d*-o,this.y=h*l+f*-o+d*-r-c*-a,this.z=d*l+f*-a+c*-o-h*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s,this.y=r[1]*t+r[5]*i+r[9]*s,this.z=r[2]*t+r[6]*i+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-i*l,this.z=i*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return rp.copy(this).projectOnVector(e),this.sub(rp)}reflect(e){return this.sub(rp.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Bn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}u(b,"Vector3");const rp=new b,vy=new Ve;class Fn{constructor(e=new b(1/0,1/0,1/0),t=new b(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const h=e[l],d=e[l+1],f=e[l+2];h<t&&(t=h),d<i&&(i=d),f<s&&(s=f),h>r&&(r=h),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,i,s),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const h=e.getX(l),d=e.getY(l),f=e.getZ(l);h<t&&(t=h),d<i&&(i=d),f<s&&(s=f),h>r&&(r=h),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,i,s),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=qr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0)if(t&&i.attributes!=null&&i.attributes.position!==void 0){const r=i.attributes.position;for(let o=0,a=r.count;o<a;o++)qr.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(qr)}else i.boundingBox===null&&i.computeBoundingBox(),op.copy(i.boundingBox),op.applyMatrix4(e.matrixWorld),this.union(op);const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,qr),qr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Pl),zu.subVectors(this.max,Pl),Jo.subVectors(e.a,Pl),ea.subVectors(e.b,Pl),ta.subVectors(e.c,Pl),or.subVectors(ea,Jo),ar.subVectors(ta,ea),Kr.subVectors(Jo,ta);let t=[0,-or.z,or.y,0,-ar.z,ar.y,0,-Kr.z,Kr.y,or.z,0,-or.x,ar.z,0,-ar.x,Kr.z,0,-Kr.x,-or.y,or.x,0,-ar.y,ar.x,0,-Kr.y,Kr.x,0];return!ap(t,Jo,ea,ta,zu)||(t=[1,0,0,0,1,0,0,0,1],!ap(t,Jo,ea,ta,zu))?!1:(Bu.crossVectors(or,ar),t=[Bu.x,Bu.y,Bu.z],ap(t,Jo,ea,ta,zu))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return qr.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(qr).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Rs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Rs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Rs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Rs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Rs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Rs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Rs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Rs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Rs),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}u(Fn,"Box3");const Rs=[new b,new b,new b,new b,new b,new b,new b,new b],qr=new b,op=new Fn,Jo=new b,ea=new b,ta=new b,or=new b,ar=new b,Kr=new b,Pl=new b,zu=new b,Bu=new b,Zr=new b;function ap(n,e,t,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){Zr.fromArray(n,r);const a=s.x*Math.abs(Zr.x)+s.y*Math.abs(Zr.y)+s.z*Math.abs(Zr.z),l=e.dot(Zr),c=t.dot(Zr),h=i.dot(Zr);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}u(ap,"satForAxes");const EE=new Fn,Il=new b,lp=new b;class Vo{constructor(e=new b,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):EE.setFromPoints(e).getCenter(i);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Il.subVectors(e,this.center);const t=Il.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(Il,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(lp.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Il.copy(e.center).add(lp)),this.expandByPoint(Il.copy(e.center).sub(lp))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}u(Vo,"Sphere");const Ds=new b,cp=new b,Uu=new b,lr=new b,up=new b,Vu=new b,hp=new b;class Vr{constructor(e=new b,t=new b(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ds)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ds.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ds.copy(this.direction).multiplyScalar(t).add(this.origin),Ds.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){cp.copy(e).add(t).multiplyScalar(.5),Uu.copy(t).sub(e).normalize(),lr.copy(this.origin).sub(cp);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Uu),a=lr.dot(this.direction),l=-lr.dot(Uu),c=lr.lengthSq(),h=Math.abs(1-o*o);let d,f,p,g;if(h>0)if(d=o*l-a,f=o*a-l,g=r*h,d>=0)if(f>=-g)if(f<=g){const m=1/h;d*=m,f*=m,p=d*(d+o*f+2*a)+f*(o*d+f+2*l)+c}else f=r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f=-r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f<=-g?(d=Math.max(0,-(-o*r+a)),f=d>0?-r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c):f<=g?(d=0,f=Math.min(Math.max(-r,-l),r),p=f*(f+2*l)+c):(d=Math.max(0,-(o*r+a)),f=d>0?r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c);else f=o>0?-r:r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;return i&&i.copy(this.direction).multiplyScalar(d).add(this.origin),s&&s.copy(Uu).multiplyScalar(f).add(cp),p}intersectSphere(e,t){Ds.subVectors(e.center,this.origin);const i=Ds.dot(this.direction),s=Ds.dot(Ds)-i*i,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(i=(e.min.x-f.x)*c,s=(e.max.x-f.x)*c):(i=(e.max.x-f.x)*c,s=(e.min.x-f.x)*c),h>=0?(r=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(r=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),d>=0?(a=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,Ds)!==null}intersectTriangle(e,t,i,s,r){up.subVectors(t,e),Vu.subVectors(i,e),hp.crossVectors(up,Vu);let o=this.direction.dot(hp),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;lr.subVectors(this.origin,e);const l=a*this.direction.dot(Vu.crossVectors(lr,Vu));if(l<0)return null;const c=a*this.direction.dot(up.cross(lr));if(c<0||l+c>o)return null;const h=-a*lr.dot(hp);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}u(Vr,"Ray");class Me{constructor(){Me.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,s,r,o,a,l,c,h,d,f,p,g,m,v){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=s,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=d,y[14]=f,y[3]=p,y[7]=g,y[11]=m,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Me().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/na.setFromMatrixColumn(e,0).length(),r=1/na.setFromMatrixColumn(e,1).length(),o=1/na.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,r=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(s),c=Math.sin(s),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const f=o*h,p=o*d,g=a*h,m=a*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=p+g*c,t[5]=f-m*c,t[9]=-a*l,t[2]=m-f*c,t[6]=g+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*h,p=l*d,g=c*h,m=c*d;t[0]=f+m*a,t[4]=g*a-p,t[8]=o*c,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=p*a-g,t[6]=m+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*h,p=l*d,g=c*h,m=c*d;t[0]=f-m*a,t[4]=-o*d,t[8]=g+p*a,t[1]=p+g*a,t[5]=o*h,t[9]=m-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*h,p=o*d,g=a*h,m=a*d;t[0]=l*h,t[4]=g*c-p,t[8]=f*c+m,t[1]=l*d,t[5]=m*c+f,t[9]=p*c-g,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*h,t[4]=m-f*d,t[8]=g*d+p,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*d+g,t[10]=f-m*d}else if(e.order==="XZY"){const f=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=f*d+m,t[5]=o*h,t[9]=p*d-g,t[2]=g*d-p,t[6]=a*h,t[10]=m*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(PE,e,IE)}lookAt(e,t,i){const s=this.elements;return vi.subVectors(e,t),vi.lengthSq()===0&&(vi.z=1),vi.normalize(),cr.crossVectors(i,vi),cr.lengthSq()===0&&(Math.abs(i.z)===1?vi.x+=1e-4:vi.z+=1e-4,vi.normalize(),cr.crossVectors(i,vi)),cr.normalize(),Hu.crossVectors(vi,cr),s[0]=cr.x,s[4]=Hu.x,s[8]=vi.x,s[1]=cr.y,s[5]=Hu.y,s[9]=vi.y,s[2]=cr.z,s[6]=Hu.z,s[10]=vi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],d=i[5],f=i[9],p=i[13],g=i[2],m=i[6],v=i[10],y=i[14],w=i[3],_=i[7],A=i[11],x=i[15],C=s[0],T=s[4],S=s[8],I=s[12],D=s[1],B=s[5],Q=s[9],U=s[13],z=s[2],q=s[6],ee=s[10],J=s[14],X=s[3],V=s[7],Z=s[11],de=s[15];return r[0]=o*C+a*D+l*z+c*X,r[4]=o*T+a*B+l*q+c*V,r[8]=o*S+a*Q+l*ee+c*Z,r[12]=o*I+a*U+l*J+c*de,r[1]=h*C+d*D+f*z+p*X,r[5]=h*T+d*B+f*q+p*V,r[9]=h*S+d*Q+f*ee+p*Z,r[13]=h*I+d*U+f*J+p*de,r[2]=g*C+m*D+v*z+y*X,r[6]=g*T+m*B+v*q+y*V,r[10]=g*S+m*Q+v*ee+y*Z,r[14]=g*I+m*U+v*J+y*de,r[3]=w*C+_*D+A*z+x*X,r[7]=w*T+_*B+A*q+x*V,r[11]=w*S+_*Q+A*ee+x*Z,r[15]=w*I+_*U+A*J+x*de,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],d=e[6],f=e[10],p=e[14],g=e[3],m=e[7],v=e[11],y=e[15];return g*(+r*l*d-s*c*d-r*a*f+i*c*f+s*a*p-i*l*p)+m*(+t*l*p-t*c*f+r*o*f-s*o*p+s*c*h-r*l*h)+v*(+t*c*d-t*a*p-r*o*d+i*o*p+r*a*h-i*c*h)+y*(-s*a*h-t*l*d+t*a*f+s*o*d-i*o*f+i*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],w=d*v*c-m*f*c+m*l*p-a*v*p-d*l*y+a*f*y,_=g*f*c-h*v*c-g*l*p+o*v*p+h*l*y-o*f*y,A=h*m*c-g*d*c+g*a*p-o*m*p-h*a*y+o*d*y,x=g*d*l-h*m*l-g*a*f+o*m*f+h*a*v-o*d*v,C=t*w+i*_+s*A+r*x;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/C;return e[0]=w*T,e[1]=(m*f*r-d*v*r-m*s*p+i*v*p+d*s*y-i*f*y)*T,e[2]=(a*v*r-m*l*r+m*s*c-i*v*c-a*s*y+i*l*y)*T,e[3]=(d*l*r-a*f*r-d*s*c+i*f*c+a*s*p-i*l*p)*T,e[4]=_*T,e[5]=(h*v*r-g*f*r+g*s*p-t*v*p-h*s*y+t*f*y)*T,e[6]=(g*l*r-o*v*r-g*s*c+t*v*c+o*s*y-t*l*y)*T,e[7]=(o*f*r-h*l*r+h*s*c-t*f*c-o*s*p+t*l*p)*T,e[8]=A*T,e[9]=(g*d*r-h*m*r-g*i*p+t*m*p+h*i*y-t*d*y)*T,e[10]=(o*m*r-g*a*r+g*i*c-t*m*c-o*i*y+t*a*y)*T,e[11]=(h*a*r-o*d*r-h*i*c+t*d*c+o*i*p-t*a*p)*T,e[12]=x*T,e[13]=(h*m*s-g*d*s+g*i*f-t*m*f-h*i*v+t*d*v)*T,e[14]=(g*a*s-o*m*s-g*i*l+t*m*l+o*i*v-t*a*v)*T,e[15]=(o*d*s-h*a*s+h*i*l-t*d*l-o*i*f+t*a*f)*T,this}scale(e){const t=this.elements,i=e.x,s=e.y,r=e.z;return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),r=1-i,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-s*l,c*l+s*a,0,c*a+s*l,h*a+i,h*l-s*o,0,c*l-s*a,h*l+s*o,r*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,r,o){return this.set(1,i,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,d=a+a,f=r*c,p=r*h,g=r*d,m=o*h,v=o*d,y=a*d,w=l*c,_=l*h,A=l*d,x=i.x,C=i.y,T=i.z;return s[0]=(1-(m+y))*x,s[1]=(p+A)*x,s[2]=(g-_)*x,s[3]=0,s[4]=(p-A)*C,s[5]=(1-(f+y))*C,s[6]=(v+w)*C,s[7]=0,s[8]=(g+_)*T,s[9]=(v-w)*T,s[10]=(1-(f+m))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let r=na.set(s[0],s[1],s[2]).length();const o=na.set(s[4],s[5],s[6]).length(),a=na.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],qi.copy(this);const c=1/r,h=1/o,d=1/a;return qi.elements[0]*=c,qi.elements[1]*=c,qi.elements[2]*=c,qi.elements[4]*=h,qi.elements[5]*=h,qi.elements[6]*=h,qi.elements[8]*=d,qi.elements[9]*=d,qi.elements[10]*=d,t.setFromRotationMatrix(qi),i.x=r,i.y=o,i.z=a,this}makePerspective(e,t,i,s,r,o){const a=this.elements,l=2*r/(t-e),c=2*r/(i-s),h=(t+e)/(t-e),d=(i+s)/(i-s),f=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=f,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,s,r,o){const a=this.elements,l=1/(t-e),c=1/(i-s),h=1/(o-r),d=(t+e)*l,f=(i+s)*c,p=(o+r)*h;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-f,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}u(Me,"Matrix4");const na=new b,qi=new Me,PE=new b(0,0,0),IE=new b(1,1,1),cr=new b,Hu=new b,vi=new b,yy=new Me,_y=new Ve;class mt{constructor(e=0,t=0,i=0,s=mt.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],h=s[9],d=s[2],f=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(Bn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Bn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Bn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Bn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Bn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Bn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return yy.makeRotationFromQuaternion(e),this.setFromRotationMatrix(yy,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _y.setFromEuler(this),this.setFromQuaternion(_y,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}u(mt,"Euler");mt.DefaultOrder="XYZ";mt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class mf{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}u(mf,"Layers");let RE=0;const xy=new b,ia=new Ve,Ls=new Me,Gu=new b,Rl=new b,DE=new b,LE=new Ve,by=new b(1,0,0),wy=new b(0,1,0),My=new b(0,0,1),FE={type:"added"},Sy={type:"removed"};class yt extends Uo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:RE++}),this.uuid=Ur(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=yt.DefaultUp.clone();const e=new b,t=new mt,i=new Ve,s=new b(1,1,1);function r(){i.setFromEuler(t,!1)}u(r,"onRotationChange");function o(){t.setFromQuaternion(i,void 0,!1)}u(o,"onQuaternionChange"),t._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Me},normalMatrix:{value:new ti}}),this.matrix=new Me,this.matrixWorld=new Me,this.matrixAutoUpdate=yt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=yt.DefaultMatrixWorldAutoUpdate,this.layers=new mf,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ia.setFromAxisAngle(e,t),this.quaternion.multiply(ia),this}rotateOnWorldAxis(e,t){return ia.setFromAxisAngle(e,t),this.quaternion.premultiply(ia),this}rotateX(e){return this.rotateOnAxis(by,e)}rotateY(e){return this.rotateOnAxis(wy,e)}rotateZ(e){return this.rotateOnAxis(My,e)}translateOnAxis(e,t){return xy.copy(e).applyQuaternion(this.quaternion),this.position.add(xy.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(by,e)}translateY(e){return this.translateOnAxis(wy,e)}translateZ(e){return this.translateOnAxis(My,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ls.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Gu.copy(e):Gu.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Rl.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ls.lookAt(Rl,Gu,this.up):Ls.lookAt(Gu,Rl,this.up),this.quaternion.setFromRotationMatrix(Ls),s&&(Ls.extractRotation(s.matrixWorld),ia.setFromRotationMatrix(Ls),this.quaternion.premultiply(ia.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(FE)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Sy)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Sy)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ls.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ls.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ls),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rl,e,DE),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rl,LE,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++){const r=t[i];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++){const a=s[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(u(r,"serialize"),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),d=o(e.shapes),f=o(e.skeletons),p=o(e.animations),g=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),d.length>0&&(i.shapes=d),f.length>0&&(i.skeletons=f),p.length>0&&(i.animations=p),g.length>0&&(i.nodes=g)}return i.object=s,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}u(o,"extractFromCache")}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}u(yt,"Object3D");yt.DefaultUp=new b(0,1,0);yt.DefaultMatrixAutoUpdate=!0;yt.DefaultMatrixWorldAutoUpdate=!0;const Ki=new b,Fs=new b,dp=new b,Os=new b,sa=new b,ra=new b,Ay=new b,fp=new b,pp=new b,mp=new b;class bs{constructor(e=new b,t=new b,i=new b){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),Ki.subVectors(e,t),s.cross(Ki);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,i,s,r){Ki.subVectors(s,t),Fs.subVectors(i,t),dp.subVectors(e,t);const o=Ki.dot(Ki),a=Ki.dot(Fs),l=Ki.dot(dp),c=Fs.dot(Fs),h=Fs.dot(dp),d=o*c-a*a;if(d===0)return r.set(-2,-1,-1);const f=1/d,p=(c*l-a*h)*f,g=(o*h-a*l)*f;return r.set(1-p-g,g,p)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Os),Os.x>=0&&Os.y>=0&&Os.x+Os.y<=1}static getUV(e,t,i,s,r,o,a,l){return this.getBarycoord(e,t,i,s,Os),l.set(0,0),l.addScaledVector(r,Os.x),l.addScaledVector(o,Os.y),l.addScaledVector(a,Os.z),l}static isFrontFacing(e,t,i,s){return Ki.subVectors(i,t),Fs.subVectors(e,t),Ki.cross(Fs).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ki.subVectors(this.c,this.b),Fs.subVectors(this.a,this.b),Ki.cross(Fs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return bs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return bs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,s,r){return bs.getUV(e,this.a,this.b,this.c,t,i,s,r)}containsPoint(e){return bs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return bs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,r=this.c;let o,a;sa.subVectors(s,i),ra.subVectors(r,i),fp.subVectors(e,i);const l=sa.dot(fp),c=ra.dot(fp);if(l<=0&&c<=0)return t.copy(i);pp.subVectors(e,s);const h=sa.dot(pp),d=ra.dot(pp);if(h>=0&&d<=h)return t.copy(s);const f=l*d-h*c;if(f<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(i).addScaledVector(sa,o);mp.subVectors(e,r);const p=sa.dot(mp),g=ra.dot(mp);if(g>=0&&p<=g)return t.copy(r);const m=p*c-l*g;if(m<=0&&c>=0&&g<=0)return a=c/(c-g),t.copy(i).addScaledVector(ra,a);const v=h*g-p*d;if(v<=0&&d-h>=0&&p-g>=0)return Ay.subVectors(r,s),a=(d-h)/(d-h+(p-g)),t.copy(s).addScaledVector(Ay,a);const y=1/(v+m+f);return o=m*y,a=f*y,t.copy(i).addScaledVector(sa,o).addScaledVector(ra,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}u(bs,"Triangle");let OE=0;class $i extends Uo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:OE++}),this.uuid=Ur(),this.name="",this.type="Material",this.blending=Ba,this.side=Xa,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ow,this.blendDst=aw,this.blendEquation=Sa,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Fm,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=fE,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=tp,this.stencilZFail=tp,this.stencilZPass=tp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const s=this[t];if(s===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ba&&(i.blending=this.blending),this.side!==Xa&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(u(s,"extractFromCache"),t){const r=s(e.textures),o=s(e.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}u($i,"Material");class tr extends $i{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ie(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hf,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}u(tr,"MeshBasicMaterial");const hn=new b,$u=new Ge;class fn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=py,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)$u.fromBufferAttribute(this,t),$u.applyMatrix3(e),this.setXY(t,$u.x,$u.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)hn.fromBufferAttribute(this,t),hn.applyMatrix3(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)hn.fromBufferAttribute(this,t),hn.applyMatrix4(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)hn.fromBufferAttribute(this,t),hn.applyNormalMatrix(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)hn.fromBufferAttribute(this,t),hn.transformDirection(e),this.setXYZ(t,hn.x,hn.y,hn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=pc(t,this.array)),t}setX(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=pc(t,this.array)),t}setY(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=pc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=pc(t,this.array)),t}setW(e,t){return this.normalized&&(t=li(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),i=li(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),i=li(i,this.array),s=li(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,r){return e*=this.itemSize,this.normalized&&(t=li(t,this.array),i=li(i,this.array),s=li(s,this.array),r=li(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==py&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}u(fn,"BufferAttribute");class gf extends fn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}u(gf,"Uint16BufferAttribute");class Og extends fn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}u(Og,"Uint32BufferAttribute");class Fe extends fn{constructor(e,t,i){super(new Float32Array(e),t,i)}}u(Fe,"Float32BufferAttribute");let NE=0;const Fi=new Me,gp=new yt,oa=new b,yi=new Fn,Dl=new Fn,Mn=new b;class Qe extends Uo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:NE++}),this.uuid=Ur(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(fw(e)?Og:gf)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new ti().getNormalMatrix(e);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Fi.makeRotationFromQuaternion(e),this.applyMatrix4(Fi),this}rotateX(e){return Fi.makeRotationX(e),this.applyMatrix4(Fi),this}rotateY(e){return Fi.makeRotationY(e),this.applyMatrix4(Fi),this}rotateZ(e){return Fi.makeRotationZ(e),this.applyMatrix4(Fi),this}translate(e,t,i){return Fi.makeTranslation(e,t,i),this.applyMatrix4(Fi),this}scale(e,t,i){return Fi.makeScale(e,t,i),this.applyMatrix4(Fi),this}lookAt(e){return gp.lookAt(e),gp.updateMatrix(),this.applyMatrix4(gp.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(oa).negate(),this.translate(oa.x,oa.y,oa.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Fe(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Fn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new b(-1/0,-1/0,-1/0),new b(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const r=t[i];yi.setFromBufferAttribute(r),this.morphTargetsRelative?(Mn.addVectors(this.boundingBox.min,yi.min),this.boundingBox.expandByPoint(Mn),Mn.addVectors(this.boundingBox.max,yi.max),this.boundingBox.expandByPoint(Mn)):(this.boundingBox.expandByPoint(yi.min),this.boundingBox.expandByPoint(yi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new b,1/0);return}if(e){const i=this.boundingSphere.center;if(yi.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Dl.setFromBufferAttribute(a),this.morphTargetsRelative?(Mn.addVectors(yi.min,Dl.min),yi.expandByPoint(Mn),Mn.addVectors(yi.max,Dl.max),yi.expandByPoint(Mn)):(yi.expandByPoint(Dl.min),yi.expandByPoint(Dl.max))}yi.getCenter(i);let s=0;for(let r=0,o=e.count;r<o;r++)Mn.fromBufferAttribute(e,r),s=Math.max(s,i.distanceToSquared(Mn));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Mn.fromBufferAttribute(a,c),l&&(oa.fromBufferAttribute(e,c),Mn.add(oa)),s=Math.max(s,i.distanceToSquared(Mn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,s=t.position.array,r=t.normal.array,o=t.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new fn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],h=[];for(let D=0;D<a;D++)c[D]=new b,h[D]=new b;const d=new b,f=new b,p=new b,g=new Ge,m=new Ge,v=new Ge,y=new b,w=new b;function _(D,B,Q){d.fromArray(s,D*3),f.fromArray(s,B*3),p.fromArray(s,Q*3),g.fromArray(o,D*2),m.fromArray(o,B*2),v.fromArray(o,Q*2),f.sub(d),p.sub(d),m.sub(g),v.sub(g);const U=1/(m.x*v.y-v.x*m.y);!isFinite(U)||(y.copy(f).multiplyScalar(v.y).addScaledVector(p,-m.y).multiplyScalar(U),w.copy(p).multiplyScalar(m.x).addScaledVector(f,-v.x).multiplyScalar(U),c[D].add(y),c[B].add(y),c[Q].add(y),h[D].add(w),h[B].add(w),h[Q].add(w))}u(_,"handleTriangle");let A=this.groups;A.length===0&&(A=[{start:0,count:i.length}]);for(let D=0,B=A.length;D<B;++D){const Q=A[D],U=Q.start,z=Q.count;for(let q=U,ee=U+z;q<ee;q+=3)_(i[q+0],i[q+1],i[q+2])}const x=new b,C=new b,T=new b,S=new b;function I(D){T.fromArray(r,D*3),S.copy(T);const B=c[D];x.copy(B),x.sub(T.multiplyScalar(T.dot(B))).normalize(),C.crossVectors(S,B);const U=C.dot(h[D])<0?-1:1;l[D*4]=x.x,l[D*4+1]=x.y,l[D*4+2]=x.z,l[D*4+3]=U}u(I,"handleVertex");for(let D=0,B=A.length;D<B;++D){const Q=A[D],U=Q.start,z=Q.count;for(let q=U,ee=U+z;q<ee;q+=3)I(i[q+0]),I(i[q+1]),I(i[q+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new fn(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let f=0,p=i.count;f<p;f++)i.setXYZ(f,0,0,0);const s=new b,r=new b,o=new b,a=new b,l=new b,c=new b,h=new b,d=new b;if(e)for(let f=0,p=e.count;f<p;f+=3){const g=e.getX(f+0),m=e.getX(f+1),v=e.getX(f+2);s.fromBufferAttribute(t,g),r.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),h.subVectors(o,r),d.subVectors(s,r),h.cross(d),a.fromBufferAttribute(i,g),l.fromBufferAttribute(i,m),c.fromBufferAttribute(i,v),a.add(h),l.add(h),c.add(h),i.setXYZ(g,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z),i.setXYZ(v,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)s.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),h.subVectors(o,r),d.subVectors(s,r),h.cross(d),i.setXYZ(f+0,h.x,h.y,h.z),i.setXYZ(f+1,h.x,h.y,h.z),i.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Mn.fromBufferAttribute(e,t),Mn.normalize(),e.setXYZ(t,Mn.x,Mn.y,Mn.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,d=a.normalized,f=new c.constructor(l.length*h);let p=0,g=0;for(let m=0,v=l.length;m<v;m++){a.isInterleavedBufferAttribute?p=l[m]*a.data.stride+a.offset:p=l[m]*h;for(let y=0;y<h;y++)f[g++]=c[p++]}return new fn(f,h,d)}if(u(e,"convertBufferAttribute"),this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Qe,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,i);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,d=c.length;h<d;h++){const f=c[h],p=e(f,i);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,f=c.length;d<f;d++){const p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],d=r[c];for(let f=0,p=d.length;f<p;f++)h.push(d[f].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}u(Qe,"BufferGeometry");const Cy=new Me,aa=new Vr,vp=new Vo,ur=new b,hr=new b,dr=new b,yp=new b,_p=new b,xp=new b,Wu=new b,ju=new b,Xu=new b,Yu=new Ge,qu=new Ge,Ku=new Ge,bp=new b,Zu=new b;class Ee extends yt{constructor(e=new Qe,t=new tr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}raycast(e,t){const i=this.geometry,s=this.material,r=this.matrixWorld;if(s===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),vp.copy(i.boundingSphere),vp.applyMatrix4(r),e.ray.intersectsSphere(vp)===!1)||(Cy.copy(r).invert(),aa.copy(e.ray).applyMatrix4(Cy),i.boundingBox!==null&&aa.intersectsBox(i.boundingBox)===!1))return;let o;const a=i.index,l=i.attributes.position,c=i.morphAttributes.position,h=i.morphTargetsRelative,d=i.attributes.uv,f=i.attributes.uv2,p=i.groups,g=i.drawRange;if(a!==null)if(Array.isArray(s))for(let m=0,v=p.length;m<v;m++){const y=p[m],w=s[y.materialIndex],_=Math.max(y.start,g.start),A=Math.min(a.count,Math.min(y.start+y.count,g.start+g.count));for(let x=_,C=A;x<C;x+=3){const T=a.getX(x),S=a.getX(x+1),I=a.getX(x+2);o=Qu(this,w,e,aa,l,c,h,d,f,T,S,I),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(a.count,g.start+g.count);for(let y=m,w=v;y<w;y+=3){const _=a.getX(y),A=a.getX(y+1),x=a.getX(y+2);o=Qu(this,s,e,aa,l,c,h,d,f,_,A,x),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(s))for(let m=0,v=p.length;m<v;m++){const y=p[m],w=s[y.materialIndex],_=Math.max(y.start,g.start),A=Math.min(l.count,Math.min(y.start+y.count,g.start+g.count));for(let x=_,C=A;x<C;x+=3){const T=x,S=x+1,I=x+2;o=Qu(this,w,e,aa,l,c,h,d,f,T,S,I),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(l.count,g.start+g.count);for(let y=m,w=v;y<w;y+=3){const _=y,A=y+1,x=y+2;o=Qu(this,s,e,aa,l,c,h,d,f,_,A,x),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}}}u(Ee,"Mesh");function kE(n,e,t,i,s,r,o,a){let l;if(e.side===Vi?l=i.intersectTriangle(o,r,s,!0,a):l=i.intersectTriangle(s,r,o,e.side!==Ui,a),l===null)return null;Zu.copy(a),Zu.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Zu);return c<t.near||c>t.far?null:{distance:c,point:Zu.clone(),object:n}}u(kE,"checkIntersection");function Qu(n,e,t,i,s,r,o,a,l,c,h,d){ur.fromBufferAttribute(s,c),hr.fromBufferAttribute(s,h),dr.fromBufferAttribute(s,d);const f=n.morphTargetInfluences;if(r&&f){Wu.set(0,0,0),ju.set(0,0,0),Xu.set(0,0,0);for(let g=0,m=r.length;g<m;g++){const v=f[g],y=r[g];v!==0&&(yp.fromBufferAttribute(y,c),_p.fromBufferAttribute(y,h),xp.fromBufferAttribute(y,d),o?(Wu.addScaledVector(yp,v),ju.addScaledVector(_p,v),Xu.addScaledVector(xp,v)):(Wu.addScaledVector(yp.sub(ur),v),ju.addScaledVector(_p.sub(hr),v),Xu.addScaledVector(xp.sub(dr),v)))}ur.add(Wu),hr.add(ju),dr.add(Xu)}n.isSkinnedMesh&&(n.boneTransform(c,ur),n.boneTransform(h,hr),n.boneTransform(d,dr));const p=kE(n,e,t,i,ur,hr,dr,bp);if(p){a&&(Yu.fromBufferAttribute(a,c),qu.fromBufferAttribute(a,h),Ku.fromBufferAttribute(a,d),p.uv=bs.getUV(bp,ur,hr,dr,Yu,qu,Ku,new Ge)),l&&(Yu.fromBufferAttribute(l,c),qu.fromBufferAttribute(l,h),Ku.fromBufferAttribute(l,d),p.uv2=bs.getUV(bp,ur,hr,dr,Yu,qu,Ku,new Ge));const g={a:c,b:h,c:d,normal:new b,materialIndex:0};bs.getNormal(ur,hr,dr,g.normal),p.face=g}return p}u(Qu,"checkBufferGeometryIntersection");class Qt extends Qe{constructor(e=1,t=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],d=[];let f=0,p=0;g("z","y","x",-1,-1,i,t,e,o,r,0),g("z","y","x",1,-1,i,t,-e,o,r,1),g("x","z","y",1,1,e,i,t,s,o,2),g("x","z","y",1,-1,e,i,-t,s,o,3),g("x","y","z",1,-1,e,t,i,s,r,4),g("x","y","z",-1,-1,e,t,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new Fe(c,3)),this.setAttribute("normal",new Fe(h,3)),this.setAttribute("uv",new Fe(d,2));function g(m,v,y,w,_,A,x,C,T,S,I){const D=A/T,B=x/S,Q=A/2,U=x/2,z=C/2,q=T+1,ee=S+1;let J=0,X=0;const V=new b;for(let Z=0;Z<ee;Z++){const de=Z*B-U;for(let Y=0;Y<q;Y++){const fe=Y*D-Q;V[m]=fe*w,V[v]=de*_,V[y]=z,c.push(V.x,V.y,V.z),V[m]=0,V[v]=0,V[y]=C>0?1:-1,h.push(V.x,V.y,V.z),d.push(Y/T),d.push(1-Z/S),J+=1}}for(let Z=0;Z<S;Z++)for(let de=0;de<T;de++){const Y=f+de+q*Z,fe=f+de+q*(Z+1),k=f+(de+1)+q*(Z+1),N=f+(de+1)+q*Z;l.push(Y,fe,N),l.push(fe,k,N),X+=6}a.addGroup(p,X,I),p+=X,f+=J}u(g,"buildPlane")}static fromJSON(e){return new Qt(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}u(Qt,"BoxGeometry");function Ja(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}u(Ja,"cloneUniforms");function qn(n){const e={};for(let t=0;t<n.length;t++){const i=Ja(n[t]);for(const s in i)e[s]=i[s]}return e}u(qn,"mergeUniforms");function zE(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}u(zE,"cloneUniformsGroups");const vf={clone:Ja,merge:qn};var BE=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,UE=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Vn extends $i{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=BE,this.fragmentShader=UE,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ja(e.uniforms),this.uniformsGroups=zE(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}u(Vn,"ShaderMaterial");class yf extends yt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Me,this.projectionMatrix=new Me,this.projectionMatrixInverse=new Me}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}u(yf,"Camera");class Dn extends yf{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Wc*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Ac*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Wc*2*Math.atan(Math.tan(Ac*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Ac*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,t-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}u(Dn,"PerspectiveCamera");const la=90,ca=1;class gw extends yt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const s=new Dn(la,ca,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new b(1,0,0)),this.add(s);const r=new Dn(la,ca,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new b(-1,0,0)),this.add(r);const o=new Dn(la,ca,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new b(0,1,0)),this.add(o);const a=new Dn(la,ca,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new b(0,-1,0)),this.add(a);const l=new Dn(la,ca,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new b(0,0,1)),this.add(l);const c=new Dn(la,ca,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new b(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const i=this.renderTarget,[s,r,o,a,l,c]=this.children,h=e.getRenderTarget(),d=e.toneMapping,f=e.xr.enabled;e.toneMapping=As,e.xr.enabled=!1;const p=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,s),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=p,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(h),e.toneMapping=d,e.xr.enabled=f,i.texture.needsPMREMUpdate=!0}}u(gw,"CubeCamera");class Ng extends On{constructor(e,t,i,s,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:Ya,super(e,t,i,s,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}u(Ng,"CubeTexture");class vw extends Rn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new Ng(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ci}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Qt(5,5,5),r=new Vn({name:"CubemapFromEquirect",uniforms:Ja(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Vi,blending:Ss});r.uniforms.tEquirect.value=t;const o=new Ee(s,r),a=t.minFilter;return t.minFilter===cu&&(t.minFilter=Ci),new gw(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,s);e.setRenderTarget(r)}}u(vw,"WebGLCubeRenderTarget");const wp=new b,VE=new b,HE=new ti;class Ws{constructor(e=new b(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=wp.subVectors(i,t).cross(VE.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(wp),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||HE.getNormalMatrix(e),s=this.coplanarPoint(wp).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}u(Ws,"Plane");const ua=new Vo,Ju=new b;class uu{constructor(e=new Ws,t=new Ws,i=new Ws,s=new Ws,r=new Ws,o=new Ws){this.planes=[e,t,i,s,r,o]}set(e,t,i,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,s=i[0],r=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],d=i[7],f=i[8],p=i[9],g=i[10],m=i[11],v=i[12],y=i[13],w=i[14],_=i[15];return t[0].setComponents(a-s,d-l,m-f,_-v).normalize(),t[1].setComponents(a+s,d+l,m+f,_+v).normalize(),t[2].setComponents(a+r,d+c,m+p,_+y).normalize(),t[3].setComponents(a-r,d-c,m-p,_-y).normalize(),t[4].setComponents(a-o,d-h,m-g,_-w).normalize(),t[5].setComponents(a+o,d+h,m+g,_+w).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),ua.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ua)}intersectsSprite(e){return ua.center.set(0,0,0),ua.radius=.7071067811865476,ua.applyMatrix4(e.matrixWorld),this.intersectsSphere(ua)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(Ju.x=s.normal.x>0?e.max.x:e.min.x,Ju.y=s.normal.y>0?e.max.y:e.min.y,Ju.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Ju)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}u(uu,"Frustum");function yw(){let n=null,e=!1,t=null,i=null;function s(r,o){t(r,o),i=n.requestAnimationFrame(s)}return u(s,"onAnimationFrame"),{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}u(yw,"WebGLAnimation");function GE(n,e){const t=e.isWebGL2,i=new WeakMap;function s(c,h){const d=c.array,f=c.usage,p=n.createBuffer();n.bindBuffer(h,p),n.bufferData(h,d,f),c.onUploadCallback();let g;if(d instanceof Float32Array)g=5126;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(d instanceof Int16Array)g=5122;else if(d instanceof Uint32Array)g=5125;else if(d instanceof Int32Array)g=5124;else if(d instanceof Int8Array)g=5120;else if(d instanceof Uint8Array)g=5121;else if(d instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:p,type:g,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}u(s,"createBuffer");function r(c,h,d){const f=h.array,p=h.updateRange;n.bindBuffer(d,c),p.count===-1?n.bufferSubData(d,0,f):(t?n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1)}u(r,"updateBuffer");function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)}u(o,"get");function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=i.get(c);h&&(n.deleteBuffer(h.buffer),i.delete(c))}u(a,"remove");function l(c,h){if(c.isGLBufferAttribute){const f=i.get(c);(!f||f.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=i.get(c);d===void 0?i.set(c,s(c,h)):d.version<c.version&&(r(d.buffer,c,h),d.version=c.version)}return u(l,"update"),{get:o,remove:a,update:l}}u(GE,"WebGLAttributes");class Fo extends Qe{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(s),c=a+1,h=l+1,d=e/a,f=t/l,p=[],g=[],m=[],v=[];for(let y=0;y<h;y++){const w=y*f-o;for(let _=0;_<c;_++){const A=_*d-r;g.push(A,-w,0),m.push(0,0,1),v.push(_/a),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let w=0;w<a;w++){const _=w+c*y,A=w+c*(y+1),x=w+1+c*(y+1),C=w+1+c*y;p.push(_,A,C),p.push(A,x,C)}this.setIndex(p),this.setAttribute("position",new Fe(g,3)),this.setAttribute("normal",new Fe(m,3)),this.setAttribute("uv",new Fe(v,2))}static fromJSON(e){return new Fo(e.width,e.height,e.widthSegments,e.heightSegments)}}u(Fo,"PlaneGeometry");var $E=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,WE=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,jE=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,XE=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,YE=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,qE=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,KE="vec3 transformed = vec3( position );",ZE=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,QE=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,JE=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,eP=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,tP=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,nP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,iP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,sP=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,rP=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,oP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,aP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,lP=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,cP=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,uP=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,hP=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,dP=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,fP=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,pP=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,mP=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,gP="gl_FragColor = linearToOutputTexel( gl_FragColor );",vP=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,yP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,_P=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,xP=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,bP=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,wP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,MP=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,SP=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,AP=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,CP=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,TP=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,EP=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,PP=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,IP=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,RP=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,DP=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,LP=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,FP=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,OP=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,NP=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,kP=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,zP=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,BP=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,UP=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,VP=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,HP=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,GP=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,$P=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,WP=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,jP=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,XP=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,YP=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,qP=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,KP=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,ZP=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,QP=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,JP=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,eI=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,tI=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,nI=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,iI=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,sI=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,rI=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,oI=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,aI=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,lI=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,cI=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,uI=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,hI=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,dI=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,fI=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,pI=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,mI=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,gI=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,vI=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,yI=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,_I=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,xI=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,bI=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,wI=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,MI=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,SI=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,AI=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,CI=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,TI=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,EI=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,PI=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,II=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,RI=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,DI=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,LI=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,FI=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,OI=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,NI=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,kI=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,zI=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,BI=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,UI=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,VI=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const HI=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,GI=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,$I=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,WI=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,jI=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,XI=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,YI=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,qI=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,KI=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ZI=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,QI=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,JI=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,eR=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,tR=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,nR=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,iR=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,sR=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rR=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oR=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,aR=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lR=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,cR=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,uR=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hR=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,dR=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fR=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pR=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mR=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gR=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,vR=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,yR=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,_R=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,xR=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,bR=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ot={alphamap_fragment:$E,alphamap_pars_fragment:WE,alphatest_fragment:jE,alphatest_pars_fragment:XE,aomap_fragment:YE,aomap_pars_fragment:qE,begin_vertex:KE,beginnormal_vertex:ZE,bsdfs:QE,iridescence_fragment:JE,bumpmap_pars_fragment:eP,clipping_planes_fragment:tP,clipping_planes_pars_fragment:nP,clipping_planes_pars_vertex:iP,clipping_planes_vertex:sP,color_fragment:rP,color_pars_fragment:oP,color_pars_vertex:aP,color_vertex:lP,common:cP,cube_uv_reflection_fragment:uP,defaultnormal_vertex:hP,displacementmap_pars_vertex:dP,displacementmap_vertex:fP,emissivemap_fragment:pP,emissivemap_pars_fragment:mP,encodings_fragment:gP,encodings_pars_fragment:vP,envmap_fragment:yP,envmap_common_pars_fragment:_P,envmap_pars_fragment:xP,envmap_pars_vertex:bP,envmap_physical_pars_fragment:LP,envmap_vertex:wP,fog_vertex:MP,fog_pars_vertex:SP,fog_fragment:AP,fog_pars_fragment:CP,gradientmap_pars_fragment:TP,lightmap_fragment:EP,lightmap_pars_fragment:PP,lights_lambert_fragment:IP,lights_lambert_pars_fragment:RP,lights_pars_begin:DP,lights_toon_fragment:FP,lights_toon_pars_fragment:OP,lights_phong_fragment:NP,lights_phong_pars_fragment:kP,lights_physical_fragment:zP,lights_physical_pars_fragment:BP,lights_fragment_begin:UP,lights_fragment_maps:VP,lights_fragment_end:HP,logdepthbuf_fragment:GP,logdepthbuf_pars_fragment:$P,logdepthbuf_pars_vertex:WP,logdepthbuf_vertex:jP,map_fragment:XP,map_pars_fragment:YP,map_particle_fragment:qP,map_particle_pars_fragment:KP,metalnessmap_fragment:ZP,metalnessmap_pars_fragment:QP,morphcolor_vertex:JP,morphnormal_vertex:eI,morphtarget_pars_vertex:tI,morphtarget_vertex:nI,normal_fragment_begin:iI,normal_fragment_maps:sI,normal_pars_fragment:rI,normal_pars_vertex:oI,normal_vertex:aI,normalmap_pars_fragment:lI,clearcoat_normal_fragment_begin:cI,clearcoat_normal_fragment_maps:uI,clearcoat_pars_fragment:hI,iridescence_pars_fragment:dI,output_fragment:fI,packing:pI,premultiplied_alpha_fragment:mI,project_vertex:gI,dithering_fragment:vI,dithering_pars_fragment:yI,roughnessmap_fragment:_I,roughnessmap_pars_fragment:xI,shadowmap_pars_fragment:bI,shadowmap_pars_vertex:wI,shadowmap_vertex:MI,shadowmask_pars_fragment:SI,skinbase_vertex:AI,skinning_pars_vertex:CI,skinning_vertex:TI,skinnormal_vertex:EI,specularmap_fragment:PI,specularmap_pars_fragment:II,tonemapping_fragment:RI,tonemapping_pars_fragment:DI,transmission_fragment:LI,transmission_pars_fragment:FI,uv_pars_fragment:OI,uv_pars_vertex:NI,uv_vertex:kI,uv2_pars_fragment:zI,uv2_pars_vertex:BI,uv2_vertex:UI,worldpos_vertex:VI,background_vert:HI,background_frag:GI,backgroundCube_vert:$I,backgroundCube_frag:WI,cube_vert:jI,cube_frag:XI,depth_vert:YI,depth_frag:qI,distanceRGBA_vert:KI,distanceRGBA_frag:ZI,equirect_vert:QI,equirect_frag:JI,linedashed_vert:eR,linedashed_frag:tR,meshbasic_vert:nR,meshbasic_frag:iR,meshlambert_vert:sR,meshlambert_frag:rR,meshmatcap_vert:oR,meshmatcap_frag:aR,meshnormal_vert:lR,meshnormal_frag:cR,meshphong_vert:uR,meshphong_frag:hR,meshphysical_vert:dR,meshphysical_frag:fR,meshtoon_vert:pR,meshtoon_frag:mR,points_vert:gR,points_frag:vR,shadow_vert:yR,shadow_frag:_R,sprite_vert:xR,sprite_frag:bR},Re={common:{diffuse:{value:new Ie(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ti},uv2Transform:{value:new ti},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ge(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ie(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ie(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ti}},sprite:{diffuse:{value:new Ie(16777215)},opacity:{value:1},center:{value:new Ge(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ti}}},_s={basic:{uniforms:qn([Re.common,Re.specularmap,Re.envmap,Re.aomap,Re.lightmap,Re.fog]),vertexShader:ot.meshbasic_vert,fragmentShader:ot.meshbasic_frag},lambert:{uniforms:qn([Re.common,Re.specularmap,Re.envmap,Re.aomap,Re.lightmap,Re.emissivemap,Re.bumpmap,Re.normalmap,Re.displacementmap,Re.fog,Re.lights,{emissive:{value:new Ie(0)}}]),vertexShader:ot.meshlambert_vert,fragmentShader:ot.meshlambert_frag},phong:{uniforms:qn([Re.common,Re.specularmap,Re.envmap,Re.aomap,Re.lightmap,Re.emissivemap,Re.bumpmap,Re.normalmap,Re.displacementmap,Re.fog,Re.lights,{emissive:{value:new Ie(0)},specular:{value:new Ie(1118481)},shininess:{value:30}}]),vertexShader:ot.meshphong_vert,fragmentShader:ot.meshphong_frag},standard:{uniforms:qn([Re.common,Re.envmap,Re.aomap,Re.lightmap,Re.emissivemap,Re.bumpmap,Re.normalmap,Re.displacementmap,Re.roughnessmap,Re.metalnessmap,Re.fog,Re.lights,{emissive:{value:new Ie(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag},toon:{uniforms:qn([Re.common,Re.aomap,Re.lightmap,Re.emissivemap,Re.bumpmap,Re.normalmap,Re.displacementmap,Re.gradientmap,Re.fog,Re.lights,{emissive:{value:new Ie(0)}}]),vertexShader:ot.meshtoon_vert,fragmentShader:ot.meshtoon_frag},matcap:{uniforms:qn([Re.common,Re.bumpmap,Re.normalmap,Re.displacementmap,Re.fog,{matcap:{value:null}}]),vertexShader:ot.meshmatcap_vert,fragmentShader:ot.meshmatcap_frag},points:{uniforms:qn([Re.points,Re.fog]),vertexShader:ot.points_vert,fragmentShader:ot.points_frag},dashed:{uniforms:qn([Re.common,Re.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ot.linedashed_vert,fragmentShader:ot.linedashed_frag},depth:{uniforms:qn([Re.common,Re.displacementmap]),vertexShader:ot.depth_vert,fragmentShader:ot.depth_frag},normal:{uniforms:qn([Re.common,Re.bumpmap,Re.normalmap,Re.displacementmap,{opacity:{value:1}}]),vertexShader:ot.meshnormal_vert,fragmentShader:ot.meshnormal_frag},sprite:{uniforms:qn([Re.sprite,Re.fog]),vertexShader:ot.sprite_vert,fragmentShader:ot.sprite_frag},background:{uniforms:{uvTransform:{value:new ti},t2D:{value:null}},vertexShader:ot.background_vert,fragmentShader:ot.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0}},vertexShader:ot.backgroundCube_vert,fragmentShader:ot.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ot.cube_vert,fragmentShader:ot.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ot.equirect_vert,fragmentShader:ot.equirect_frag},distanceRGBA:{uniforms:qn([Re.common,Re.displacementmap,{referencePosition:{value:new b},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ot.distanceRGBA_vert,fragmentShader:ot.distanceRGBA_frag},shadow:{uniforms:qn([Re.lights,Re.fog,{color:{value:new Ie(0)},opacity:{value:1}}]),vertexShader:ot.shadow_vert,fragmentShader:ot.shadow_frag}};_s.physical={uniforms:qn([_s.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ge(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ie(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ge},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ie(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ie(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag};function wR(n,e,t,i,s,r,o){const a=new Ie(0);let l=r===!0?0:1,c,h,d=null,f=0,p=null;function g(v,y){let w=!1,_=y.isScene===!0?y.background:null;_&&_.isTexture&&(_=(y.backgroundBlurriness>0?t:e).get(_));const A=n.xr,x=A.getSession&&A.getSession();x&&x.environmentBlendMode==="additive"&&(_=null),_===null?m(a,l):_&&_.isColor&&(m(_,1),w=!0),(n.autoClear||w)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),_&&(_.isCubeTexture||_.mapping===df)?(h===void 0&&(h=new Ee(new Qt(1,1,1),new Vn({name:"BackgroundCubeMaterial",uniforms:Ja(_s.backgroundCube.uniforms),vertexShader:_s.backgroundCube.vertexShader,fragmentShader:_s.backgroundCube.fragmentShader,side:Vi,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(C,T,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,(d!==_||f!==_.version||p!==n.toneMapping)&&(h.material.needsUpdate=!0,d=_,f=_.version,p=n.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new Ee(new Fo(2,2),new Vn({name:"BackgroundMaterial",uniforms:Ja(_s.background.uniforms),vertexShader:_s.background.vertexShader,fragmentShader:_s.background.fragmentShader,side:Xa,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(d!==_||f!==_.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,d=_,f=_.version,p=n.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}u(g,"render");function m(v,y){i.buffers.color.setClear(v.r,v.g,v.b,y,o)}return u(m,"setClear"),{getClearColor:function(){return a},setClearColor:function(v,y=1){a.set(v),l=y,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,m(a,l)},render:g}}u(wR,"WebGLBackground");function MR(n,e,t,i){const s=n.getParameter(34921),r=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||r!==null,a={},l=v(null);let c=l,h=!1;function d(z,q,ee,J,X){let V=!1;if(o){const Z=m(J,ee,q);c!==Z&&(c=Z,p(c.object)),V=y(z,J,ee,X),V&&w(z,J,ee,X)}else{const Z=q.wireframe===!0;(c.geometry!==J.id||c.program!==ee.id||c.wireframe!==Z)&&(c.geometry=J.id,c.program=ee.id,c.wireframe=Z,V=!0)}X!==null&&t.update(X,34963),(V||h)&&(h=!1,S(z,q,ee,J),X!==null&&n.bindBuffer(34963,t.get(X).buffer))}u(d,"setup");function f(){return i.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}u(f,"createVertexArrayObject");function p(z){return i.isWebGL2?n.bindVertexArray(z):r.bindVertexArrayOES(z)}u(p,"bindVertexArrayObject");function g(z){return i.isWebGL2?n.deleteVertexArray(z):r.deleteVertexArrayOES(z)}u(g,"deleteVertexArrayObject");function m(z,q,ee){const J=ee.wireframe===!0;let X=a[z.id];X===void 0&&(X={},a[z.id]=X);let V=X[q.id];V===void 0&&(V={},X[q.id]=V);let Z=V[J];return Z===void 0&&(Z=v(f()),V[J]=Z),Z}u(m,"getBindingState");function v(z){const q=[],ee=[],J=[];for(let X=0;X<s;X++)q[X]=0,ee[X]=0,J[X]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:q,enabledAttributes:ee,attributeDivisors:J,object:z,attributes:{},index:null}}u(v,"createBindingState");function y(z,q,ee,J){const X=c.attributes,V=q.attributes;let Z=0;const de=ee.getAttributes();for(const Y in de)if(de[Y].location>=0){const k=X[Y];let N=V[Y];if(N===void 0&&(Y==="instanceMatrix"&&z.instanceMatrix&&(N=z.instanceMatrix),Y==="instanceColor"&&z.instanceColor&&(N=z.instanceColor)),k===void 0||k.attribute!==N||N&&k.data!==N.data)return!0;Z++}return c.attributesNum!==Z||c.index!==J}u(y,"needsUpdate");function w(z,q,ee,J){const X={},V=q.attributes;let Z=0;const de=ee.getAttributes();for(const Y in de)if(de[Y].location>=0){let k=V[Y];k===void 0&&(Y==="instanceMatrix"&&z.instanceMatrix&&(k=z.instanceMatrix),Y==="instanceColor"&&z.instanceColor&&(k=z.instanceColor));const N={};N.attribute=k,k&&k.data&&(N.data=k.data),X[Y]=N,Z++}c.attributes=X,c.attributesNum=Z,c.index=J}u(w,"saveCache");function _(){const z=c.newAttributes;for(let q=0,ee=z.length;q<ee;q++)z[q]=0}u(_,"initAttributes");function A(z){x(z,0)}u(A,"enableAttribute");function x(z,q){const ee=c.newAttributes,J=c.enabledAttributes,X=c.attributeDivisors;ee[z]=1,J[z]===0&&(n.enableVertexAttribArray(z),J[z]=1),X[z]!==q&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](z,q),X[z]=q)}u(x,"enableAttributeAndDivisor");function C(){const z=c.newAttributes,q=c.enabledAttributes;for(let ee=0,J=q.length;ee<J;ee++)q[ee]!==z[ee]&&(n.disableVertexAttribArray(ee),q[ee]=0)}u(C,"disableUnusedAttributes");function T(z,q,ee,J,X,V){i.isWebGL2===!0&&(ee===5124||ee===5125)?n.vertexAttribIPointer(z,q,ee,X,V):n.vertexAttribPointer(z,q,ee,J,X,V)}u(T,"vertexAttribPointer");function S(z,q,ee,J){if(i.isWebGL2===!1&&(z.isInstancedMesh||J.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;_();const X=J.attributes,V=ee.getAttributes(),Z=q.defaultAttributeValues;for(const de in V){const Y=V[de];if(Y.location>=0){let fe=X[de];if(fe===void 0&&(de==="instanceMatrix"&&z.instanceMatrix&&(fe=z.instanceMatrix),de==="instanceColor"&&z.instanceColor&&(fe=z.instanceColor)),fe!==void 0){const k=fe.normalized,N=fe.itemSize,F=t.get(fe);if(F===void 0)continue;const H=F.buffer,$=F.type,te=F.bytesPerElement;if(fe.isInterleavedBufferAttribute){const se=fe.data,ae=se.stride,E=fe.offset;if(se.isInstancedInterleavedBuffer){for(let L=0;L<Y.locationSize;L++)x(Y.location+L,se.meshPerAttribute);z.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=se.meshPerAttribute*se.count)}else for(let L=0;L<Y.locationSize;L++)A(Y.location+L);n.bindBuffer(34962,H);for(let L=0;L<Y.locationSize;L++)T(Y.location+L,N/Y.locationSize,$,k,ae*te,(E+N/Y.locationSize*L)*te)}else{if(fe.isInstancedBufferAttribute){for(let se=0;se<Y.locationSize;se++)x(Y.location+se,fe.meshPerAttribute);z.isInstancedMesh!==!0&&J._maxInstanceCount===void 0&&(J._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let se=0;se<Y.locationSize;se++)A(Y.location+se);n.bindBuffer(34962,H);for(let se=0;se<Y.locationSize;se++)T(Y.location+se,N/Y.locationSize,$,k,N*te,N/Y.locationSize*se*te)}}else if(Z!==void 0){const k=Z[de];if(k!==void 0)switch(k.length){case 2:n.vertexAttrib2fv(Y.location,k);break;case 3:n.vertexAttrib3fv(Y.location,k);break;case 4:n.vertexAttrib4fv(Y.location,k);break;default:n.vertexAttrib1fv(Y.location,k)}}}}C()}u(S,"setupVertexAttributes");function I(){Q();for(const z in a){const q=a[z];for(const ee in q){const J=q[ee];for(const X in J)g(J[X].object),delete J[X];delete q[ee]}delete a[z]}}u(I,"dispose");function D(z){if(a[z.id]===void 0)return;const q=a[z.id];for(const ee in q){const J=q[ee];for(const X in J)g(J[X].object),delete J[X];delete q[ee]}delete a[z.id]}u(D,"releaseStatesOfGeometry");function B(z){for(const q in a){const ee=a[q];if(ee[z.id]===void 0)continue;const J=ee[z.id];for(const X in J)g(J[X].object),delete J[X];delete ee[z.id]}}u(B,"releaseStatesOfProgram");function Q(){U(),h=!0,c!==l&&(c=l,p(c.object))}u(Q,"reset");function U(){l.geometry=null,l.program=null,l.wireframe=!1}return u(U,"resetDefaultState"),{setup:d,reset:Q,resetDefaultState:U,dispose:I,releaseStatesOfGeometry:D,releaseStatesOfProgram:B,initAttributes:_,enableAttribute:A,disableUnusedAttributes:C}}u(MR,"WebGLBindingStates");function SR(n,e,t,i){const s=i.isWebGL2;let r;function o(c){r=c}u(o,"setMode");function a(c,h){n.drawArrays(r,c,h),t.update(h,r,1)}u(a,"render");function l(c,h,d){if(d===0)return;let f,p;if(s)f=n,p="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[p](r,c,h,d),t.update(h,r,d)}u(l,"renderInstances"),this.setMode=o,this.render=a,this.renderInstances=l}u(SR,"WebGLBufferRenderer");function AR(n,e,t){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const T=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}u(s,"getMaxAnisotropy");function r(T){if(T==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";T="mediump"}return T==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}u(r,"getMaxPrecision");const o=typeof WebGL2RenderingContext!="undefined"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&n instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,d=n.getParameter(34930),f=n.getParameter(35660),p=n.getParameter(3379),g=n.getParameter(34076),m=n.getParameter(34921),v=n.getParameter(36347),y=n.getParameter(36348),w=n.getParameter(36349),_=f>0,A=o||e.has("OES_texture_float"),x=_&&A,C=o?n.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:s,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:w,vertexTextures:_,floatFragmentTextures:A,floatVertexTextures:x,maxSamples:C}}u(AR,"WebGLCapabilities");function CR(n){const e=this;let t=null,i=0,s=!1,r=!1;const o=new Ws,a=new ti,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f,p){const g=d.length!==0||f||i!==0||s;return s=f,t=h(d,p,0),i=d.length,g},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,c()},this.setState=function(d,f,p){const g=d.clippingPlanes,m=d.clipIntersection,v=d.clipShadows,y=n.get(d);if(!s||g===null||g.length===0||r&&!v)r?h(null):c();else{const w=r?0:i,_=w*4;let A=y.clippingState||null;l.value=A,A=h(g,f,_,p);for(let x=0;x!==_;++x)A[x]=t[x];y.clippingState=A,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=w}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}u(c,"resetGlobalState");function h(d,f,p,g){const m=d!==null?d.length:0;let v=null;if(m!==0){if(v=l.value,g!==!0||v===null){const y=p+m*4,w=f.matrixWorldInverse;a.getNormalMatrix(w),(v===null||v.length<y)&&(v=new Float32Array(y));for(let _=0,A=p;_!==m;++_,A+=4)o.copy(d[_]).applyMatrix4(w,a),o.normal.toArray(v,A),v[A+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,v}u(h,"projectPlanes")}u(CR,"WebGLClipping");function TR(n){let e=new WeakMap;function t(o,a){return a===Td?o.mapping=Ya:a===Om&&(o.mapping=qa),o}u(t,"mapTextureMapping");function i(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===Td||a===Om)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new vw(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",s),t(c.texture,o.mapping)}else return null}}return o}u(i,"get");function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}u(s,"onTextureDispose");function r(){e=new WeakMap}return u(r,"dispose"),{get:i,dispose:r}}u(TR,"WebGLCubeMaps");class Ho extends yf{constructor(e=-1,t=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-e,o=i+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}u(Ho,"OrthographicCamera");const Pa=4,Ty=[.125,.215,.35,.446,.526,.582],wo=20,Mp=new Ho,Ey=new Ie;let Sp=null;const vo=(1+Math.sqrt(5))/2,ha=1/vo,Py=[new b(1,1,1),new b(-1,1,1),new b(1,1,-1),new b(-1,1,-1),new b(0,vo,ha),new b(0,vo,-ha),new b(ha,0,vo),new b(-ha,0,vo),new b(vo,ha,0),new b(-vo,ha,0)];class Um{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){Sp=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Dy(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Ry(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Sp),e.scissorTest=!1,eh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ya||e.mapping===qa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Sp=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ci,minFilter:Ci,generateMipmaps:!1,type:Za,format:Ti,encoding:Ks,depthBuffer:!1},s=Iy(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Iy(e,t,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=ER(r)),this._blurMaterial=PR(r,e,t)}return s}_compileMaterial(e){const t=new Ee(this._lodPlanes[0],e);this._renderer.compile(t,Mp)}_sceneToCubeUV(e,t,i,s){const a=new Dn(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(Ey),h.toneMapping=As,h.autoClear=!1;const p=new tr({name:"PMREM.Background",side:Vi,depthWrite:!1,depthTest:!1}),g=new Ee(new Qt,p);let m=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,m=!0):(p.color.copy(Ey),m=!0);for(let y=0;y<6;y++){const w=y%3;w===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):w===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const _=this._cubeSize;eh(s,w*_,y>2?_:0,_,_),h.setRenderTarget(s),m&&h.render(g,a),h.render(e,a)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=v}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===Ya||e.mapping===qa;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=Dy()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Ry());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new Ee(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;eh(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Mp)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=Py[(s-1)%Py.length];this._blur(e,s-1,s,r,o)}t.autoClear=i}_blur(e,t,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,s,"latitudinal",r),this._halfBlur(o,e,i,i,s,"longitudinal",r)}_halfBlur(e,t,i,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new Ee(this._lodPlanes[s],c),f=c.uniforms,p=this._sizeLods[i]-1,g=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*wo-1),m=r/g,v=isFinite(r)?1+Math.floor(h*m):wo;v>wo&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${wo}`);const y=[];let w=0;for(let T=0;T<wo;++T){const S=T/m,I=Math.exp(-S*S/2);y.push(I),T===0?w+=I:T<v&&(w+=2*I)}for(let T=0;T<y.length;T++)y[T]=y[T]/w;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=y,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:_}=this;f.dTheta.value=g,f.mipInt.value=_-i;const A=this._sizeLods[s],x=3*A*(s>_-Pa?s-_+Pa:0),C=4*(this._cubeSize-A);eh(t,x,C,3*A,2*A),l.setRenderTarget(t),l.render(d,Mp)}}u(Um,"PMREMGenerator");function ER(n){const e=[],t=[],i=[];let s=n;const r=n-Pa+1+Ty.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);t.push(a);let l=1/a;o>n-Pa?l=Ty[o-n+Pa-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],p=6,g=6,m=3,v=2,y=1,w=new Float32Array(m*g*p),_=new Float32Array(v*g*p),A=new Float32Array(y*g*p);for(let C=0;C<p;C++){const T=C%3*2/3-1,S=C>2?0:-1,I=[T,S,0,T+2/3,S,0,T+2/3,S+1,0,T,S,0,T+2/3,S+1,0,T,S+1,0];w.set(I,m*g*C),_.set(f,v*g*C);const D=[C,C,C,C,C,C];A.set(D,y*g*C)}const x=new Qe;x.setAttribute("position",new fn(w,m)),x.setAttribute("uv",new fn(_,v)),x.setAttribute("faceIndex",new fn(A,y)),e.push(x),s>Pa&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}u(ER,"_createPlanes");function Iy(n,e,t){const i=new Rn(n,e,t);return i.texture.mapping=df,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}u(Iy,"_createRenderTarget");function eh(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}u(eh,"_setViewport");function PR(n,e,t){const i=new Float32Array(wo),s=new b(0,1,0);return new Vn({name:"SphericalGaussianBlur",defines:{n:wo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:kg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ss,depthTest:!1,depthWrite:!1})}u(PR,"_getBlurShader");function Ry(){return new Vn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:kg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ss,depthTest:!1,depthWrite:!1})}u(Ry,"_getEquirectMaterial");function Dy(){return new Vn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:kg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ss,depthTest:!1,depthWrite:!1})}u(Dy,"_getCubemapMaterial");function kg(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}u(kg,"_getCommonVertexShader");function IR(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===Td||l===Om,h=l===Ya||l===qa;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new Um(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||h&&d&&s(d)){t===null&&(t=new Um(n));const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}u(i,"get");function s(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}u(s,"isCubeTextureComplete");function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}u(r,"onTextureDispose");function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return u(o,"dispose"),{get:i,dispose:o}}u(IR,"WebGLCubeUVMaps");function RR(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return u(t,"getExtension"),{has:function(i){return t(i)!==null},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const s=t(i);return s===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}u(RR,"WebGLExtensions");function DR(n,e,t,i){const s={},r=new WeakMap;function o(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);f.removeEventListener("dispose",o),delete s[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),i.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}u(o,"onGeometryDispose");function a(d,f){return s[f.id]===!0||(f.addEventListener("dispose",o),s[f.id]=!0,t.memory.geometries++),f}u(a,"get");function l(d){const f=d.attributes;for(const g in f)e.update(f[g],34962);const p=d.morphAttributes;for(const g in p){const m=p[g];for(let v=0,y=m.length;v<y;v++)e.update(m[v],34962)}}u(l,"update");function c(d){const f=[],p=d.index,g=d.attributes.position;let m=0;if(p!==null){const w=p.array;m=p.version;for(let _=0,A=w.length;_<A;_+=3){const x=w[_+0],C=w[_+1],T=w[_+2];f.push(x,C,C,T,T,x)}}else{const w=g.array;m=g.version;for(let _=0,A=w.length/3-1;_<A;_+=3){const x=_+0,C=_+1,T=_+2;f.push(x,C,C,T,T,x)}}const v=new(fw(f)?Og:gf)(f,1);v.version=m;const y=r.get(d);y&&e.remove(y),r.set(d,v)}u(c,"updateWireframeAttribute");function h(d){const f=r.get(d);if(f){const p=d.index;p!==null&&f.version<p.version&&c(d)}else c(d);return r.get(d)}return u(h,"getWireframeAttribute"),{get:a,update:l,getWireframeAttribute:h}}u(DR,"WebGLGeometries");function LR(n,e,t,i){const s=i.isWebGL2;let r;function o(f){r=f}u(o,"setMode");let a,l;function c(f){a=f.type,l=f.bytesPerElement}u(c,"setIndex");function h(f,p){n.drawElements(r,p,a,f*l),t.update(p,r,1)}u(h,"render");function d(f,p,g){if(g===0)return;let m,v;if(s)m=n,v="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[v](r,p,a,f*l,g),t.update(p,r,g)}u(d,"renderInstances"),this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=d}u(LR,"WebGLIndexedBufferRenderer");function FR(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}u(i,"update");function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return u(s,"reset"),{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}u(FR,"WebGLInfo");function OR(n,e){return n[0]-e[0]}u(OR,"numericalSort");function NR(n,e){return Math.abs(e[1])-Math.abs(n[1])}u(NR,"absNumericalSort");function kR(n,e,t){const i={},s=new Float32Array(8),r=new WeakMap,o=new gt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,d,f){const p=c.morphTargetInfluences;if(e.isWebGL2===!0){const m=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,v=m!==void 0?m.length:0;let y=r.get(h);if(y===void 0||y.count!==v){let ee=function(){z.dispose(),r.delete(h),h.removeEventListener("dispose",ee)};var g=ee;u(ee,"disposeTexture"),y!==void 0&&y.texture.dispose();const A=h.morphAttributes.position!==void 0,x=h.morphAttributes.normal!==void 0,C=h.morphAttributes.color!==void 0,T=h.morphAttributes.position||[],S=h.morphAttributes.normal||[],I=h.morphAttributes.color||[];let D=0;A===!0&&(D=1),x===!0&&(D=2),C===!0&&(D=3);let B=h.attributes.position.count*D,Q=1;B>e.maxTextureSize&&(Q=Math.ceil(B/e.maxTextureSize),B=e.maxTextureSize);const U=new Float32Array(B*Q*4*v),z=new Fg(U,B,Q,v);z.type=Mr,z.needsUpdate=!0;const q=D*4;for(let J=0;J<v;J++){const X=T[J],V=S[J],Z=I[J],de=B*Q*4*J;for(let Y=0;Y<X.count;Y++){const fe=Y*q;A===!0&&(o.fromBufferAttribute(X,Y),U[de+fe+0]=o.x,U[de+fe+1]=o.y,U[de+fe+2]=o.z,U[de+fe+3]=0),x===!0&&(o.fromBufferAttribute(V,Y),U[de+fe+4]=o.x,U[de+fe+5]=o.y,U[de+fe+6]=o.z,U[de+fe+7]=0),C===!0&&(o.fromBufferAttribute(Z,Y),U[de+fe+8]=o.x,U[de+fe+9]=o.y,U[de+fe+10]=o.z,U[de+fe+11]=Z.itemSize===4?o.w:1)}}y={count:v,texture:z,size:new Ge(B,Q)},r.set(h,y),h.addEventListener("dispose",ee)}let w=0;for(let A=0;A<p.length;A++)w+=p[A];const _=h.morphTargetsRelative?1:1-w;f.getUniforms().setValue(n,"morphTargetBaseInfluence",_),f.getUniforms().setValue(n,"morphTargetInfluences",p),f.getUniforms().setValue(n,"morphTargetsTexture",y.texture,t),f.getUniforms().setValue(n,"morphTargetsTextureSize",y.size)}else{const m=p===void 0?0:p.length;let v=i[h.id];if(v===void 0||v.length!==m){v=[];for(let x=0;x<m;x++)v[x]=[x,0];i[h.id]=v}for(let x=0;x<m;x++){const C=v[x];C[0]=x,C[1]=p[x]}v.sort(NR);for(let x=0;x<8;x++)x<m&&v[x][1]?(a[x][0]=v[x][0],a[x][1]=v[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(OR);const y=h.morphAttributes.position,w=h.morphAttributes.normal;let _=0;for(let x=0;x<8;x++){const C=a[x],T=C[0],S=C[1];T!==Number.MAX_SAFE_INTEGER&&S?(y&&h.getAttribute("morphTarget"+x)!==y[T]&&h.setAttribute("morphTarget"+x,y[T]),w&&h.getAttribute("morphNormal"+x)!==w[T]&&h.setAttribute("morphNormal"+x,w[T]),s[x]=S,_+=S):(y&&h.hasAttribute("morphTarget"+x)===!0&&h.deleteAttribute("morphTarget"+x),w&&h.hasAttribute("morphNormal"+x)===!0&&h.deleteAttribute("morphNormal"+x),s[x]=0)}const A=h.morphTargetsRelative?1:1-_;f.getUniforms().setValue(n,"morphTargetBaseInfluence",A),f.getUniforms().setValue(n,"morphTargetInfluences",s)}}return u(l,"update"),{update:l}}u(kR,"WebGLMorphtargets");function zR(n,e,t,i){let s=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,d=e.get(l,h);return s.get(d)!==c&&(e.update(d),s.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}u(r,"update");function o(){s=new WeakMap}u(o,"dispose");function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return u(a,"onInstancedMeshDispose"),{update:r,dispose:o}}u(zR,"WebGLObjects");const _w=new On,xw=new Fg,bw=new mw,ww=new Ng,Ly=[],Fy=[],Oy=new Float32Array(16),Ny=new Float32Array(9),ky=new Float32Array(4);function dl(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let r=Ly[s];if(r===void 0&&(r=new Float32Array(s),Ly[s]=r),e!==0){i.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(r,a)}return r}u(dl,"flatten");function _n(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}u(_n,"arraysEqual");function xn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}u(xn,"copyArray");function _f(n,e){let t=Fy[e];t===void 0&&(t=new Int32Array(e),Fy[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}u(_f,"allocTexUnits");function BR(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}u(BR,"setValueV1f");function UR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(_n(t,e))return;n.uniform2fv(this.addr,e),xn(t,e)}}u(UR,"setValueV2f");function VR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(_n(t,e))return;n.uniform3fv(this.addr,e),xn(t,e)}}u(VR,"setValueV3f");function HR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(_n(t,e))return;n.uniform4fv(this.addr,e),xn(t,e)}}u(HR,"setValueV4f");function GR(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(_n(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),xn(t,e)}else{if(_n(t,i))return;ky.set(i),n.uniformMatrix2fv(this.addr,!1,ky),xn(t,i)}}u(GR,"setValueM2");function $R(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(_n(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),xn(t,e)}else{if(_n(t,i))return;Ny.set(i),n.uniformMatrix3fv(this.addr,!1,Ny),xn(t,i)}}u($R,"setValueM3");function WR(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(_n(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),xn(t,e)}else{if(_n(t,i))return;Oy.set(i),n.uniformMatrix4fv(this.addr,!1,Oy),xn(t,i)}}u(WR,"setValueM4");function jR(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}u(jR,"setValueV1i");function XR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(_n(t,e))return;n.uniform2iv(this.addr,e),xn(t,e)}}u(XR,"setValueV2i");function YR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(_n(t,e))return;n.uniform3iv(this.addr,e),xn(t,e)}}u(YR,"setValueV3i");function qR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(_n(t,e))return;n.uniform4iv(this.addr,e),xn(t,e)}}u(qR,"setValueV4i");function KR(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}u(KR,"setValueV1ui");function ZR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(_n(t,e))return;n.uniform2uiv(this.addr,e),xn(t,e)}}u(ZR,"setValueV2ui");function QR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(_n(t,e))return;n.uniform3uiv(this.addr,e),xn(t,e)}}u(QR,"setValueV3ui");function JR(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(_n(t,e))return;n.uniform4uiv(this.addr,e),xn(t,e)}}u(JR,"setValueV4ui");function eD(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2D(e||_w,s)}u(eD,"setValueT1");function tD(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||bw,s)}u(tD,"setValueT3D1");function nD(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||ww,s)}u(nD,"setValueT6");function iD(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||xw,s)}u(iD,"setValueT2DArray1");function sD(n){switch(n){case 5126:return BR;case 35664:return UR;case 35665:return VR;case 35666:return HR;case 35674:return GR;case 35675:return $R;case 35676:return WR;case 5124:case 35670:return jR;case 35667:case 35671:return XR;case 35668:case 35672:return YR;case 35669:case 35673:return qR;case 5125:return KR;case 36294:return ZR;case 36295:return QR;case 36296:return JR;case 35678:case 36198:case 36298:case 36306:case 35682:return eD;case 35679:case 36299:case 36307:return tD;case 35680:case 36300:case 36308:case 36293:return nD;case 36289:case 36303:case 36311:case 36292:return iD}}u(sD,"getSingularSetter");function rD(n,e){n.uniform1fv(this.addr,e)}u(rD,"setValueV1fArray");function oD(n,e){const t=dl(e,this.size,2);n.uniform2fv(this.addr,t)}u(oD,"setValueV2fArray");function aD(n,e){const t=dl(e,this.size,3);n.uniform3fv(this.addr,t)}u(aD,"setValueV3fArray");function lD(n,e){const t=dl(e,this.size,4);n.uniform4fv(this.addr,t)}u(lD,"setValueV4fArray");function cD(n,e){const t=dl(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}u(cD,"setValueM2Array");function uD(n,e){const t=dl(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}u(uD,"setValueM3Array");function hD(n,e){const t=dl(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}u(hD,"setValueM4Array");function dD(n,e){n.uniform1iv(this.addr,e)}u(dD,"setValueV1iArray");function fD(n,e){n.uniform2iv(this.addr,e)}u(fD,"setValueV2iArray");function pD(n,e){n.uniform3iv(this.addr,e)}u(pD,"setValueV3iArray");function mD(n,e){n.uniform4iv(this.addr,e)}u(mD,"setValueV4iArray");function gD(n,e){n.uniform1uiv(this.addr,e)}u(gD,"setValueV1uiArray");function vD(n,e){n.uniform2uiv(this.addr,e)}u(vD,"setValueV2uiArray");function yD(n,e){n.uniform3uiv(this.addr,e)}u(yD,"setValueV3uiArray");function _D(n,e){n.uniform4uiv(this.addr,e)}u(_D,"setValueV4uiArray");function xD(n,e,t){const i=this.cache,s=e.length,r=_f(t,s);_n(i,r)||(n.uniform1iv(this.addr,r),xn(i,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||_w,r[o])}u(xD,"setValueT1Array");function bD(n,e,t){const i=this.cache,s=e.length,r=_f(t,s);_n(i,r)||(n.uniform1iv(this.addr,r),xn(i,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||bw,r[o])}u(bD,"setValueT3DArray");function wD(n,e,t){const i=this.cache,s=e.length,r=_f(t,s);_n(i,r)||(n.uniform1iv(this.addr,r),xn(i,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||ww,r[o])}u(wD,"setValueT6Array");function MD(n,e,t){const i=this.cache,s=e.length,r=_f(t,s);_n(i,r)||(n.uniform1iv(this.addr,r),xn(i,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||xw,r[o])}u(MD,"setValueT2DArrayArray");function SD(n){switch(n){case 5126:return rD;case 35664:return oD;case 35665:return aD;case 35666:return lD;case 35674:return cD;case 35675:return uD;case 35676:return hD;case 5124:case 35670:return dD;case 35667:case 35671:return fD;case 35668:case 35672:return pD;case 35669:case 35673:return mD;case 5125:return gD;case 36294:return vD;case 36295:return yD;case 36296:return _D;case 35678:case 36198:case 36298:case 36306:case 35682:return xD;case 35679:case 36299:case 36307:return bD;case 35680:case 36300:case 36308:case 36293:return wD;case 36289:case 36303:case 36311:case 36292:return MD}}u(SD,"getPureArraySetter");class Mw{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=sD(t.type)}}u(Mw,"SingleUniform");class Sw{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=SD(t.type)}}u(Sw,"PureArrayUniform");class Aw{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(e,t[a.id],i)}}}u(Aw,"StructuredUniform");const Ap=/(\w+)(\])?(\[|\.)?/g;function zy(n,e){n.seq.push(e),n.map[e.id]=e}u(zy,"addUniform");function AD(n,e,t){const i=n.name,s=i.length;for(Ap.lastIndex=0;;){const r=Ap.exec(i),o=Ap.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){zy(t,c===void 0?new Mw(a,n,e):new Sw(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new Aw(a),zy(t,d)),t=d}}}u(AD,"parseUniform");class Tc{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let s=0;s<i;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);AD(r,o,this)}}setValue(e,t,i,s){const r=this.map[t];r!==void 0&&r.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&i.push(o)}return i}}u(Tc,"WebGLUniforms");function By(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}u(By,"WebGLShader");let CD=0;function TD(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}u(TD,"handleSource");function ED(n){switch(n){case Ks:return["Linear","( value )"];case Dt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}u(ED,"getEncodingComponents");function Uy(n,e,t){const i=n.getShaderParameter(e,35713),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+TD(n.getShaderSource(e),o)}else return s}u(Uy,"getShaderErrors");function PD(n,e){const t=ED(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}u(PD,"getTexelEncodingFunction");function ID(n,e){let t;switch(e){case $3:t="Linear";break;case W3:t="Reinhard";break;case j3:t="OptimizedCineon";break;case X3:t="ACESFilmic";break;case Y3:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}u(ID,"getToneMappingFunction");function RD(n){return[n.extensionDerivatives||!!n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(mc).join(`
`)}u(RD,"generateExtensions");function DD(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}u(DD,"generateDefines");function LD(n,e){const t={},i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const r=n.getActiveAttrib(e,s),o=r.name;let a=1;r.type===35674&&(a=2),r.type===35675&&(a=3),r.type===35676&&(a=4),t[o]={type:r.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}u(LD,"fetchAttributeLocations");function mc(n){return n!==""}u(mc,"filterEmptyLine");function Vy(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}u(Vy,"replaceLightNums");function Hy(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}u(Hy,"replaceClippingPlaneNums");const FD=/^[ \t]*#include +<([\w\d./]+)>/gm;function Vm(n){return n.replace(FD,OD)}u(Vm,"resolveIncludes");function OD(n,e){const t=ot[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Vm(t)}u(OD,"includeReplacer");const ND=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Gy(n){return n.replace(ND,kD)}u(Gy,"unrollLoops");function kD(n,e,t,i){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}u(kD,"loopReplacer");function $y(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}u($y,"generatePrecision");function zD(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===sw?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===rw?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===fc&&(e="SHADOWMAP_TYPE_VSM"),e}u(zD,"generateShadowMapTypeDefine");function BD(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ya:case qa:e="ENVMAP_TYPE_CUBE";break;case df:e="ENVMAP_TYPE_CUBE_UV";break}return e}u(BD,"generateEnvMapTypeDefine");function UD(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case qa:e="ENVMAP_MODE_REFRACTION";break}return e}u(UD,"generateEnvMapModeDefine");function VD(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case hf:e="ENVMAP_BLENDING_MULTIPLY";break;case H3:e="ENVMAP_BLENDING_MIX";break;case G3:e="ENVMAP_BLENDING_ADD";break}return e}u(VD,"generateEnvMapBlendingDefine");function HD(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}u(HD,"generateCubeUVSize");function GD(n,e,t,i){const s=n.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=zD(t),c=BD(t),h=UD(t),d=VD(t),f=HD(t),p=t.isWebGL2?"":RD(t),g=DD(r),m=s.createProgram();let v,y,w=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[g].filter(mc).join(`
`),v.length>0&&(v+=`
`),y=[p,g].filter(mc).join(`
`),y.length>0&&(y+=`
`)):(v=[$y(t),"#define SHADER_NAME "+t.shaderName,g,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(mc).join(`
`),y=[p,$y(t),"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==As?"#define TONE_MAPPING":"",t.toneMapping!==As?ot.tonemapping_pars_fragment:"",t.toneMapping!==As?ID("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ot.encodings_pars_fragment,PD("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(mc).join(`
`)),o=Vm(o),o=Vy(o,t),o=Hy(o,t),a=Vm(a),a=Vy(a,t),a=Hy(a,t),o=Gy(o),a=Gy(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===my?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===my?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const _=w+v+o,A=w+y+a,x=By(s,35633,_),C=By(s,35632,A);if(s.attachShader(m,x),s.attachShader(m,C),t.index0AttributeName!==void 0?s.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),n.debug.checkShaderErrors){const I=s.getProgramInfoLog(m).trim(),D=s.getShaderInfoLog(x).trim(),B=s.getShaderInfoLog(C).trim();let Q=!0,U=!0;if(s.getProgramParameter(m,35714)===!1){Q=!1;const z=Uy(s,x,"vertex"),q=Uy(s,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+`

Program Info Log: `+I+`
`+z+`
`+q)}else I!==""?console.warn("THREE.WebGLProgram: Program Info Log:",I):(D===""||B==="")&&(U=!1);U&&(this.diagnostics={runnable:Q,programLog:I,vertexShader:{log:D,prefix:v},fragmentShader:{log:B,prefix:y}})}s.deleteShader(x),s.deleteShader(C);let T;this.getUniforms=function(){return T===void 0&&(T=new Tc(s,m)),T};let S;return this.getAttributes=function(){return S===void 0&&(S=LD(s,m)),S},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=CD++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=C,this}u(GD,"WebGLProgram");let $D=0;class Cw{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new Tw(e),t.set(e,i)),i}}u(Cw,"WebGLShaderCache");class Tw{constructor(e){this.id=$D++,this.code=e,this.usedTimes=0}}u(Tw,"WebGLShaderStage");function WD(n,e,t,i,s,r,o){const a=new mf,l=new Cw,c=[],h=s.isWebGL2,d=s.logarithmicDepthBuffer,f=s.vertexTextures;let p=s.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(S,I,D,B,Q){const U=B.fog,z=Q.geometry,q=S.isMeshStandardMaterial?B.environment:null,ee=(S.isMeshStandardMaterial?t:e).get(S.envMap||q),J=!!ee&&ee.mapping===df?ee.image.height:null,X=g[S.type];S.precision!==null&&(p=s.getMaxPrecision(S.precision),p!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",p,"instead."));const V=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,Z=V!==void 0?V.length:0;let de=0;z.morphAttributes.position!==void 0&&(de=1),z.morphAttributes.normal!==void 0&&(de=2),z.morphAttributes.color!==void 0&&(de=3);let Y,fe,k,N;if(X){const ae=_s[X];Y=ae.vertexShader,fe=ae.fragmentShader}else Y=S.vertexShader,fe=S.fragmentShader,l.update(S),k=l.getVertexShaderID(S),N=l.getFragmentShaderID(S);const F=n.getRenderTarget(),H=S.alphaTest>0,$=S.clearcoat>0,te=S.iridescence>0;return{isWebGL2:h,shaderID:X,shaderName:S.type,vertexShader:Y,fragmentShader:fe,defines:S.defines,customVertexShaderID:k,customFragmentShaderID:N,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:p,instancing:Q.isInstancedMesh===!0,instancingColor:Q.isInstancedMesh===!0&&Q.instanceColor!==null,supportsVertexTextures:f,outputEncoding:F===null?n.outputEncoding:F.isXRRenderTarget===!0?F.texture.encoding:Ks,map:!!S.map,matcap:!!S.matcap,envMap:!!ee,envMapMode:ee&&ee.mapping,envMapCubeUVHeight:J,lightMap:!!S.lightMap,aoMap:!!S.aoMap,emissiveMap:!!S.emissiveMap,bumpMap:!!S.bumpMap,normalMap:!!S.normalMap,objectSpaceNormalMap:S.normalMapType===dE,tangentSpaceNormalMap:S.normalMapType===ff,decodeVideoTexture:!!S.map&&S.map.isVideoTexture===!0&&S.map.encoding===Dt,clearcoat:$,clearcoatMap:$&&!!S.clearcoatMap,clearcoatRoughnessMap:$&&!!S.clearcoatRoughnessMap,clearcoatNormalMap:$&&!!S.clearcoatNormalMap,iridescence:te,iridescenceMap:te&&!!S.iridescenceMap,iridescenceThicknessMap:te&&!!S.iridescenceThicknessMap,displacementMap:!!S.displacementMap,roughnessMap:!!S.roughnessMap,metalnessMap:!!S.metalnessMap,specularMap:!!S.specularMap,specularIntensityMap:!!S.specularIntensityMap,specularColorMap:!!S.specularColorMap,opaque:S.transparent===!1&&S.blending===Ba,alphaMap:!!S.alphaMap,alphaTest:H,gradientMap:!!S.gradientMap,sheen:S.sheen>0,sheenColorMap:!!S.sheenColorMap,sheenRoughnessMap:!!S.sheenRoughnessMap,transmission:S.transmission>0,transmissionMap:!!S.transmissionMap,thicknessMap:!!S.thicknessMap,combine:S.combine,vertexTangents:!!S.normalMap&&!!z.attributes.tangent,vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,vertexUvs:!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatMap||!!S.clearcoatRoughnessMap||!!S.clearcoatNormalMap||!!S.iridescenceMap||!!S.iridescenceThicknessMap||!!S.displacementMap||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||!!S.sheenColorMap||!!S.sheenRoughnessMap,uvsVertexOnly:!(!!S.map||!!S.bumpMap||!!S.normalMap||!!S.specularMap||!!S.alphaMap||!!S.emissiveMap||!!S.roughnessMap||!!S.metalnessMap||!!S.clearcoatNormalMap||!!S.iridescenceMap||!!S.iridescenceThicknessMap||S.transmission>0||!!S.transmissionMap||!!S.thicknessMap||!!S.specularIntensityMap||!!S.specularColorMap||S.sheen>0||!!S.sheenColorMap||!!S.sheenRoughnessMap)&&!!S.displacementMap,fog:!!U,useFog:S.fog===!0,fogExp2:U&&U.isFogExp2,flatShading:!!S.flatShading,sizeAttenuation:S.sizeAttenuation,logarithmicDepthBuffer:d,skinning:Q.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:Z,morphTextureStride:de,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:S.dithering,shadowMapEnabled:n.shadowMap.enabled&&D.length>0,shadowMapType:n.shadowMap.type,toneMapping:S.toneMapped?n.toneMapping:As,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===Ui,flipSided:S.side===Vi,useDepthPacking:!!S.depthPacking,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:S.extensions&&S.extensions.derivatives,extensionFragDepth:S.extensions&&S.extensions.fragDepth,extensionDrawBuffers:S.extensions&&S.extensions.drawBuffers,extensionShaderTextureLOD:S.extensions&&S.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}u(m,"getParameters");function v(S){const I=[];if(S.shaderID?I.push(S.shaderID):(I.push(S.customVertexShaderID),I.push(S.customFragmentShaderID)),S.defines!==void 0)for(const D in S.defines)I.push(D),I.push(S.defines[D]);return S.isRawShaderMaterial===!1&&(y(I,S),w(I,S),I.push(n.outputEncoding)),I.push(S.customProgramCacheKey),I.join()}u(v,"getProgramCacheKey");function y(S,I){S.push(I.precision),S.push(I.outputEncoding),S.push(I.envMapMode),S.push(I.envMapCubeUVHeight),S.push(I.combine),S.push(I.vertexUvs),S.push(I.fogExp2),S.push(I.sizeAttenuation),S.push(I.morphTargetsCount),S.push(I.morphAttributeCount),S.push(I.numDirLights),S.push(I.numPointLights),S.push(I.numSpotLights),S.push(I.numSpotLightMaps),S.push(I.numHemiLights),S.push(I.numRectAreaLights),S.push(I.numDirLightShadows),S.push(I.numPointLightShadows),S.push(I.numSpotLightShadows),S.push(I.numSpotLightShadowsWithMaps),S.push(I.shadowMapType),S.push(I.toneMapping),S.push(I.numClippingPlanes),S.push(I.numClipIntersection),S.push(I.depthPacking)}u(y,"getProgramCacheKeyParameters");function w(S,I){a.disableAll(),I.isWebGL2&&a.enable(0),I.supportsVertexTextures&&a.enable(1),I.instancing&&a.enable(2),I.instancingColor&&a.enable(3),I.map&&a.enable(4),I.matcap&&a.enable(5),I.envMap&&a.enable(6),I.lightMap&&a.enable(7),I.aoMap&&a.enable(8),I.emissiveMap&&a.enable(9),I.bumpMap&&a.enable(10),I.normalMap&&a.enable(11),I.objectSpaceNormalMap&&a.enable(12),I.tangentSpaceNormalMap&&a.enable(13),I.clearcoat&&a.enable(14),I.clearcoatMap&&a.enable(15),I.clearcoatRoughnessMap&&a.enable(16),I.clearcoatNormalMap&&a.enable(17),I.iridescence&&a.enable(18),I.iridescenceMap&&a.enable(19),I.iridescenceThicknessMap&&a.enable(20),I.displacementMap&&a.enable(21),I.specularMap&&a.enable(22),I.roughnessMap&&a.enable(23),I.metalnessMap&&a.enable(24),I.gradientMap&&a.enable(25),I.alphaMap&&a.enable(26),I.alphaTest&&a.enable(27),I.vertexColors&&a.enable(28),I.vertexAlphas&&a.enable(29),I.vertexUvs&&a.enable(30),I.vertexTangents&&a.enable(31),I.uvsVertexOnly&&a.enable(32),S.push(a.mask),a.disableAll(),I.fog&&a.enable(0),I.useFog&&a.enable(1),I.flatShading&&a.enable(2),I.logarithmicDepthBuffer&&a.enable(3),I.skinning&&a.enable(4),I.morphTargets&&a.enable(5),I.morphNormals&&a.enable(6),I.morphColors&&a.enable(7),I.premultipliedAlpha&&a.enable(8),I.shadowMapEnabled&&a.enable(9),I.physicallyCorrectLights&&a.enable(10),I.doubleSided&&a.enable(11),I.flipSided&&a.enable(12),I.useDepthPacking&&a.enable(13),I.dithering&&a.enable(14),I.specularIntensityMap&&a.enable(15),I.specularColorMap&&a.enable(16),I.transmission&&a.enable(17),I.transmissionMap&&a.enable(18),I.thicknessMap&&a.enable(19),I.sheen&&a.enable(20),I.sheenColorMap&&a.enable(21),I.sheenRoughnessMap&&a.enable(22),I.decodeVideoTexture&&a.enable(23),I.opaque&&a.enable(24),S.push(a.mask)}u(w,"getProgramCacheKeyBooleans");function _(S){const I=g[S.type];let D;if(I){const B=_s[I];D=vf.clone(B.uniforms)}else D=S.uniforms;return D}u(_,"getUniforms");function A(S,I){let D;for(let B=0,Q=c.length;B<Q;B++){const U=c[B];if(U.cacheKey===I){D=U,++D.usedTimes;break}}return D===void 0&&(D=new GD(n,I,S,r),c.push(D)),D}u(A,"acquireProgram");function x(S){if(--S.usedTimes===0){const I=c.indexOf(S);c[I]=c[c.length-1],c.pop(),S.destroy()}}u(x,"releaseProgram");function C(S){l.remove(S)}u(C,"releaseShaderCache");function T(){l.dispose()}return u(T,"dispose"),{getParameters:m,getProgramCacheKey:v,getUniforms:_,acquireProgram:A,releaseProgram:x,releaseShaderCache:C,programs:c,dispose:T}}u(WD,"WebGLPrograms");function jD(){let n=new WeakMap;function e(r){let o=n.get(r);return o===void 0&&(o={},n.set(r,o)),o}u(e,"get");function t(r){n.delete(r)}u(t,"remove");function i(r,o,a){n.get(r)[o]=a}u(i,"update");function s(){n=new WeakMap}return u(s,"dispose"),{get:e,remove:t,update:i,dispose:s}}u(jD,"WebGLProperties");function XD(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}u(XD,"painterSortStable");function Wy(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}u(Wy,"reversePainterSortStable");function jy(){const n=[];let e=0;const t=[],i=[],s=[];function r(){e=0,t.length=0,i.length=0,s.length=0}u(r,"init");function o(d,f,p,g,m,v){let y=n[e];return y===void 0?(y={id:d.id,object:d,geometry:f,material:p,groupOrder:g,renderOrder:d.renderOrder,z:m,group:v},n[e]=y):(y.id=d.id,y.object=d,y.geometry=f,y.material=p,y.groupOrder=g,y.renderOrder=d.renderOrder,y.z=m,y.group=v),e++,y}u(o,"getNextRenderItem");function a(d,f,p,g,m,v){const y=o(d,f,p,g,m,v);p.transmission>0?i.push(y):p.transparent===!0?s.push(y):t.push(y)}u(a,"push");function l(d,f,p,g,m,v){const y=o(d,f,p,g,m,v);p.transmission>0?i.unshift(y):p.transparent===!0?s.unshift(y):t.unshift(y)}u(l,"unshift");function c(d,f){t.length>1&&t.sort(d||XD),i.length>1&&i.sort(f||Wy),s.length>1&&s.sort(f||Wy)}u(c,"sort");function h(){for(let d=e,f=n.length;d<f;d++){const p=n[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return u(h,"finish"),{opaque:t,transmissive:i,transparent:s,init:r,push:a,unshift:l,finish:h,sort:c}}u(jy,"WebGLRenderList");function YD(){let n=new WeakMap;function e(i,s){const r=n.get(i);let o;return r===void 0?(o=new jy,n.set(i,[o])):s>=r.length?(o=new jy,r.push(o)):o=r[s],o}u(e,"get");function t(){n=new WeakMap}return u(t,"dispose"),{get:e,dispose:t}}u(YD,"WebGLRenderLists");function qD(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new b,color:new Ie};break;case"SpotLight":t={position:new b,direction:new b,color:new Ie,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new b,color:new Ie,distance:0,decay:0};break;case"HemisphereLight":t={direction:new b,skyColor:new Ie,groundColor:new Ie};break;case"RectAreaLight":t={color:new Ie,position:new b,halfWidth:new b,halfHeight:new b};break}return n[e.id]=t,t}}}u(qD,"UniformsCache");function KD(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ge};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ge};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ge,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}u(KD,"ShadowUniformsCache");let ZD=0;function QD(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}u(QD,"shadowCastingAndTexturingLightsFirst");function JD(n,e){const t=new qD,i=KD(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)s.probe.push(new b);const r=new b,o=new Me,a=new Me;function l(h,d){let f=0,p=0,g=0;for(let B=0;B<9;B++)s.probe[B].set(0,0,0);let m=0,v=0,y=0,w=0,_=0,A=0,x=0,C=0,T=0,S=0;h.sort(QD);const I=d!==!0?Math.PI:1;for(let B=0,Q=h.length;B<Q;B++){const U=h[B],z=U.color,q=U.intensity,ee=U.distance,J=U.shadow&&U.shadow.map?U.shadow.map.texture:null;if(U.isAmbientLight)f+=z.r*q*I,p+=z.g*q*I,g+=z.b*q*I;else if(U.isLightProbe)for(let X=0;X<9;X++)s.probe[X].addScaledVector(U.sh.coefficients[X],q);else if(U.isDirectionalLight){const X=t.get(U);if(X.color.copy(U.color).multiplyScalar(U.intensity*I),U.castShadow){const V=U.shadow,Z=i.get(U);Z.shadowBias=V.bias,Z.shadowNormalBias=V.normalBias,Z.shadowRadius=V.radius,Z.shadowMapSize=V.mapSize,s.directionalShadow[m]=Z,s.directionalShadowMap[m]=J,s.directionalShadowMatrix[m]=U.shadow.matrix,A++}s.directional[m]=X,m++}else if(U.isSpotLight){const X=t.get(U);X.position.setFromMatrixPosition(U.matrixWorld),X.color.copy(z).multiplyScalar(q*I),X.distance=ee,X.coneCos=Math.cos(U.angle),X.penumbraCos=Math.cos(U.angle*(1-U.penumbra)),X.decay=U.decay,s.spot[y]=X;const V=U.shadow;if(U.map&&(s.spotLightMap[T]=U.map,T++,V.updateMatrices(U),U.castShadow&&S++),s.spotLightMatrix[y]=V.matrix,U.castShadow){const Z=i.get(U);Z.shadowBias=V.bias,Z.shadowNormalBias=V.normalBias,Z.shadowRadius=V.radius,Z.shadowMapSize=V.mapSize,s.spotShadow[y]=Z,s.spotShadowMap[y]=J,C++}y++}else if(U.isRectAreaLight){const X=t.get(U);X.color.copy(z).multiplyScalar(q),X.halfWidth.set(U.width*.5,0,0),X.halfHeight.set(0,U.height*.5,0),s.rectArea[w]=X,w++}else if(U.isPointLight){const X=t.get(U);if(X.color.copy(U.color).multiplyScalar(U.intensity*I),X.distance=U.distance,X.decay=U.decay,U.castShadow){const V=U.shadow,Z=i.get(U);Z.shadowBias=V.bias,Z.shadowNormalBias=V.normalBias,Z.shadowRadius=V.radius,Z.shadowMapSize=V.mapSize,Z.shadowCameraNear=V.camera.near,Z.shadowCameraFar=V.camera.far,s.pointShadow[v]=Z,s.pointShadowMap[v]=J,s.pointShadowMatrix[v]=U.shadow.matrix,x++}s.point[v]=X,v++}else if(U.isHemisphereLight){const X=t.get(U);X.skyColor.copy(U.color).multiplyScalar(q*I),X.groundColor.copy(U.groundColor).multiplyScalar(q*I),s.hemi[_]=X,_++}}w>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=Re.LTC_FLOAT_1,s.rectAreaLTC2=Re.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=Re.LTC_HALF_1,s.rectAreaLTC2=Re.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=f,s.ambient[1]=p,s.ambient[2]=g;const D=s.hash;(D.directionalLength!==m||D.pointLength!==v||D.spotLength!==y||D.rectAreaLength!==w||D.hemiLength!==_||D.numDirectionalShadows!==A||D.numPointShadows!==x||D.numSpotShadows!==C||D.numSpotMaps!==T)&&(s.directional.length=m,s.spot.length=y,s.rectArea.length=w,s.point.length=v,s.hemi.length=_,s.directionalShadow.length=A,s.directionalShadowMap.length=A,s.pointShadow.length=x,s.pointShadowMap.length=x,s.spotShadow.length=C,s.spotShadowMap.length=C,s.directionalShadowMatrix.length=A,s.pointShadowMatrix.length=x,s.spotLightMatrix.length=C+T-S,s.spotLightMap.length=T,s.numSpotLightShadowsWithMaps=S,D.directionalLength=m,D.pointLength=v,D.spotLength=y,D.rectAreaLength=w,D.hemiLength=_,D.numDirectionalShadows=A,D.numPointShadows=x,D.numSpotShadows=C,D.numSpotMaps=T,s.version=ZD++)}u(l,"setup");function c(h,d){let f=0,p=0,g=0,m=0,v=0;const y=d.matrixWorldInverse;for(let w=0,_=h.length;w<_;w++){const A=h[w];if(A.isDirectionalLight){const x=s.directional[f];x.direction.setFromMatrixPosition(A.matrixWorld),r.setFromMatrixPosition(A.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(y),f++}else if(A.isSpotLight){const x=s.spot[g];x.position.setFromMatrixPosition(A.matrixWorld),x.position.applyMatrix4(y),x.direction.setFromMatrixPosition(A.matrixWorld),r.setFromMatrixPosition(A.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(y),g++}else if(A.isRectAreaLight){const x=s.rectArea[m];x.position.setFromMatrixPosition(A.matrixWorld),x.position.applyMatrix4(y),a.identity(),o.copy(A.matrixWorld),o.premultiply(y),a.extractRotation(o),x.halfWidth.set(A.width*.5,0,0),x.halfHeight.set(0,A.height*.5,0),x.halfWidth.applyMatrix4(a),x.halfHeight.applyMatrix4(a),m++}else if(A.isPointLight){const x=s.point[p];x.position.setFromMatrixPosition(A.matrixWorld),x.position.applyMatrix4(y),p++}else if(A.isHemisphereLight){const x=s.hemi[v];x.direction.setFromMatrixPosition(A.matrixWorld),x.direction.transformDirection(y),v++}}}return u(c,"setupView"),{setup:l,setupView:c,state:s}}u(JD,"WebGLLights");function Xy(n,e){const t=new JD(n,e),i=[],s=[];function r(){i.length=0,s.length=0}u(r,"init");function o(d){i.push(d)}u(o,"pushLight");function a(d){s.push(d)}u(a,"pushShadow");function l(d){t.setup(i,d)}u(l,"setupLights");function c(d){t.setupView(i,d)}return u(c,"setupLightsView"),{init:r,state:{lightsArray:i,shadowsArray:s,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}u(Xy,"WebGLRenderState");function eL(n,e){let t=new WeakMap;function i(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new Xy(n,e),t.set(r,[l])):o>=a.length?(l=new Xy(n,e),a.push(l)):l=a[o],l}u(i,"get");function s(){t=new WeakMap}return u(s,"dispose"),{get:i,dispose:s}}u(eL,"WebGLRenderStates");class zg extends $i{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=hE,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}u(zg,"MeshDepthMaterial");class Ew extends $i{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new b,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}u(Ew,"MeshDistanceMaterial");const tL=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,nL=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function iL(n,e,t){let i=new uu;const s=new Ge,r=new Ge,o=new gt,a=new zg({depthPacking:hw}),l=new Ew,c={},h=t.maxTextureSize,d={0:Vi,1:Xa,2:Ui},f=new Vn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ge},radius:{value:4}},vertexShader:tL,fragmentShader:nL}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const g=new Qe;g.setAttribute("position",new fn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Ee(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=sw,this.render=function(A,x,C){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||A.length===0)return;const T=n.getRenderTarget(),S=n.getActiveCubeFace(),I=n.getActiveMipmapLevel(),D=n.state;D.setBlending(Ss),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);for(let B=0,Q=A.length;B<Q;B++){const U=A[B],z=U.shadow;if(z===void 0){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(z.autoUpdate===!1&&z.needsUpdate===!1)continue;s.copy(z.mapSize);const q=z.getFrameExtents();if(s.multiply(q),r.copy(z.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/q.x),s.x=r.x*q.x,z.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/q.y),s.y=r.y*q.y,z.mapSize.y=r.y)),z.map===null){const J=this.type!==fc?{minFilter:yn,magFilter:yn}:{};z.map=new Rn(s.x,s.y,J),z.map.texture.name=U.name+".shadowMap",z.camera.updateProjectionMatrix()}n.setRenderTarget(z.map),n.clear();const ee=z.getViewportCount();for(let J=0;J<ee;J++){const X=z.getViewport(J);o.set(r.x*X.x,r.y*X.y,r.x*X.z,r.y*X.w),D.viewport(o),z.updateMatrices(U,J),i=z.getFrustum(),_(x,C,z.camera,U,this.type)}z.isPointLightShadow!==!0&&this.type===fc&&y(z,C),z.needsUpdate=!1}v.needsUpdate=!1,n.setRenderTarget(T,S,I)};function y(A,x){const C=e.update(m);f.defines.VSM_SAMPLES!==A.blurSamples&&(f.defines.VSM_SAMPLES=A.blurSamples,p.defines.VSM_SAMPLES=A.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new Rn(s.x,s.y)),f.uniforms.shadow_pass.value=A.map.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,n.setRenderTarget(A.mapPass),n.clear(),n.renderBufferDirect(x,null,C,f,m,null),p.uniforms.shadow_pass.value=A.mapPass.texture,p.uniforms.resolution.value=A.mapSize,p.uniforms.radius.value=A.radius,n.setRenderTarget(A.map),n.clear(),n.renderBufferDirect(x,null,C,p,m,null)}u(y,"VSMPass");function w(A,x,C,T,S,I){let D=null;const B=C.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(B!==void 0?D=B:D=C.isPointLight===!0?l:a,n.localClippingEnabled&&x.clipShadows===!0&&Array.isArray(x.clippingPlanes)&&x.clippingPlanes.length!==0||x.displacementMap&&x.displacementScale!==0||x.alphaMap&&x.alphaTest>0){const Q=D.uuid,U=x.uuid;let z=c[Q];z===void 0&&(z={},c[Q]=z);let q=z[U];q===void 0&&(q=D.clone(),z[U]=q),D=q}return D.visible=x.visible,D.wireframe=x.wireframe,I===fc?D.side=x.shadowSide!==null?x.shadowSide:x.side:D.side=x.shadowSide!==null?x.shadowSide:d[x.side],D.alphaMap=x.alphaMap,D.alphaTest=x.alphaTest,D.clipShadows=x.clipShadows,D.clippingPlanes=x.clippingPlanes,D.clipIntersection=x.clipIntersection,D.displacementMap=x.displacementMap,D.displacementScale=x.displacementScale,D.displacementBias=x.displacementBias,D.wireframeLinewidth=x.wireframeLinewidth,D.linewidth=x.linewidth,C.isPointLight===!0&&D.isMeshDistanceMaterial===!0&&(D.referencePosition.setFromMatrixPosition(C.matrixWorld),D.nearDistance=T,D.farDistance=S),D}u(w,"getDepthMaterial");function _(A,x,C,T,S){if(A.visible===!1)return;if(A.layers.test(x.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&S===fc)&&(!A.frustumCulled||i.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,A.matrixWorld);const B=e.update(A),Q=A.material;if(Array.isArray(Q)){const U=B.groups;for(let z=0,q=U.length;z<q;z++){const ee=U[z],J=Q[ee.materialIndex];if(J&&J.visible){const X=w(A,J,T,C.near,C.far,S);n.renderBufferDirect(C,null,B,X,A,ee)}}}else if(Q.visible){const U=w(A,Q,T,C.near,C.far,S);n.renderBufferDirect(C,null,B,U,A,null)}}const D=A.children;for(let B=0,Q=D.length;B<Q;B++)_(D[B],x,C,T,S)}u(_,"renderObject")}u(iL,"WebGLShadowMap");function sL(n,e,t){const i=t.isWebGL2;function s(){let W=!1;const ve=new gt;let Ae=null;const Le=new gt(0,0,0,0);return{setMask:function(Ue){Ae!==Ue&&!W&&(n.colorMask(Ue,Ue,Ue,Ue),Ae=Ue)},setLocked:function(Ue){W=Ue},setClear:function(Ue,wt,wn,Nn,$r){$r===!0&&(Ue*=Nn,wt*=Nn,wn*=Nn),ve.set(Ue,wt,wn,Nn),Le.equals(ve)===!1&&(n.clearColor(Ue,wt,wn,Nn),Le.copy(ve))},reset:function(){W=!1,Ae=null,Le.set(-1,0,0,0)}}}u(s,"ColorBuffer");function r(){let W=!1,ve=null,Ae=null,Le=null;return{setTest:function(Ue){Ue?H(2929):$(2929)},setMask:function(Ue){ve!==Ue&&!W&&(n.depthMask(Ue),ve=Ue)},setFunc:function(Ue){if(Ae!==Ue){switch(Ue){case O3:n.depthFunc(512);break;case N3:n.depthFunc(519);break;case k3:n.depthFunc(513);break;case Fm:n.depthFunc(515);break;case z3:n.depthFunc(514);break;case B3:n.depthFunc(518);break;case U3:n.depthFunc(516);break;case V3:n.depthFunc(517);break;default:n.depthFunc(515)}Ae=Ue}},setLocked:function(Ue){W=Ue},setClear:function(Ue){Le!==Ue&&(n.clearDepth(Ue),Le=Ue)},reset:function(){W=!1,ve=null,Ae=null,Le=null}}}u(r,"DepthBuffer");function o(){let W=!1,ve=null,Ae=null,Le=null,Ue=null,wt=null,wn=null,Nn=null,$r=null;return{setTest:function(Ht){W||(Ht?H(2960):$(2960))},setMask:function(Ht){ve!==Ht&&!W&&(n.stencilMask(Ht),ve=Ht)},setFunc:function(Ht,Ps,Di){(Ae!==Ht||Le!==Ps||Ue!==Di)&&(n.stencilFunc(Ht,Ps,Di),Ae=Ht,Le=Ps,Ue=Di)},setOp:function(Ht,Ps,Di){(wt!==Ht||wn!==Ps||Nn!==Di)&&(n.stencilOp(Ht,Ps,Di),wt=Ht,wn=Ps,Nn=Di)},setLocked:function(Ht){W=Ht},setClear:function(Ht){$r!==Ht&&(n.clearStencil(Ht),$r=Ht)},reset:function(){W=!1,ve=null,Ae=null,Le=null,Ue=null,wt=null,wn=null,Nn=null,$r=null}}}u(o,"StencilBuffer");const a=new s,l=new r,c=new o,h=new WeakMap,d=new WeakMap;let f={},p={},g=new WeakMap,m=[],v=null,y=!1,w=null,_=null,A=null,x=null,C=null,T=null,S=null,I=!1,D=null,B=null,Q=null,U=null,z=null;const q=n.getParameter(35661);let ee=!1,J=0;const X=n.getParameter(7938);X.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(X)[1]),ee=J>=1):X.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(X)[1]),ee=J>=2);let V=null,Z={};const de=n.getParameter(3088),Y=n.getParameter(2978),fe=new gt().fromArray(de),k=new gt().fromArray(Y);function N(W,ve,Ae){const Le=new Uint8Array(4),Ue=n.createTexture();n.bindTexture(W,Ue),n.texParameteri(W,10241,9728),n.texParameteri(W,10240,9728);for(let wt=0;wt<Ae;wt++)n.texImage2D(ve+wt,0,6408,1,1,0,6408,5121,Le);return Ue}u(N,"createTexture");const F={};F[3553]=N(3553,3553,1),F[34067]=N(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),H(2929),l.setFunc(Fm),oe(!1),ge(Bv),H(2884),G(Ss);function H(W){f[W]!==!0&&(n.enable(W),f[W]=!0)}u(H,"enable");function $(W){f[W]!==!1&&(n.disable(W),f[W]=!1)}u($,"disable");function te(W,ve){return p[W]!==ve?(n.bindFramebuffer(W,ve),p[W]=ve,i&&(W===36009&&(p[36160]=ve),W===36160&&(p[36009]=ve)),!0):!1}u(te,"bindFramebuffer");function se(W,ve){let Ae=m,Le=!1;if(W)if(Ae=g.get(ve),Ae===void 0&&(Ae=[],g.set(ve,Ae)),W.isWebGLMultipleRenderTargets){const Ue=W.texture;if(Ae.length!==Ue.length||Ae[0]!==36064){for(let wt=0,wn=Ue.length;wt<wn;wt++)Ae[wt]=36064+wt;Ae.length=Ue.length,Le=!0}}else Ae[0]!==36064&&(Ae[0]=36064,Le=!0);else Ae[0]!==1029&&(Ae[0]=1029,Le=!0);Le&&(t.isWebGL2?n.drawBuffers(Ae):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ae))}u(se,"drawBuffers");function ae(W){return v!==W?(n.useProgram(W),v=W,!0):!1}u(ae,"useProgram");const E={[Sa]:32774,[S3]:32778,[A3]:32779};if(i)E[Hv]=32775,E[Gv]=32776;else{const W=e.get("EXT_blend_minmax");W!==null&&(E[Hv]=W.MIN_EXT,E[Gv]=W.MAX_EXT)}const L={[C3]:0,[T3]:1,[E3]:768,[ow]:770,[F3]:776,[D3]:774,[I3]:772,[P3]:769,[aw]:771,[L3]:775,[R3]:773};function G(W,ve,Ae,Le,Ue,wt,wn,Nn){if(W===Ss){y===!0&&($(3042),y=!1);return}if(y===!1&&(H(3042),y=!0),W!==M3){if(W!==w||Nn!==I){if((_!==Sa||C!==Sa)&&(n.blendEquation(32774),_=Sa,C=Sa),Nn)switch(W){case Ba:n.blendFuncSeparate(1,771,1,771);break;case Lm:n.blendFunc(1,1);break;case Uv:n.blendFuncSeparate(0,769,0,1);break;case Vv:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",W);break}else switch(W){case Ba:n.blendFuncSeparate(770,771,1,771);break;case Lm:n.blendFunc(770,1);break;case Uv:n.blendFuncSeparate(0,769,0,1);break;case Vv:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",W);break}A=null,x=null,T=null,S=null,w=W,I=Nn}return}Ue=Ue||ve,wt=wt||Ae,wn=wn||Le,(ve!==_||Ue!==C)&&(n.blendEquationSeparate(E[ve],E[Ue]),_=ve,C=Ue),(Ae!==A||Le!==x||wt!==T||wn!==S)&&(n.blendFuncSeparate(L[Ae],L[Le],L[wt],L[wn]),A=Ae,x=Le,T=wt,S=wn),w=W,I=null}u(G,"setBlending");function K(W,ve){W.side===Ui?$(2884):H(2884);let Ae=W.side===Vi;ve&&(Ae=!Ae),oe(Ae),W.blending===Ba&&W.transparent===!1?G(Ss):G(W.blending,W.blendEquation,W.blendSrc,W.blendDst,W.blendEquationAlpha,W.blendSrcAlpha,W.blendDstAlpha,W.premultipliedAlpha),l.setFunc(W.depthFunc),l.setTest(W.depthTest),l.setMask(W.depthWrite),a.setMask(W.colorWrite);const Le=W.stencilWrite;c.setTest(Le),Le&&(c.setMask(W.stencilWriteMask),c.setFunc(W.stencilFunc,W.stencilRef,W.stencilFuncMask),c.setOp(W.stencilFail,W.stencilZFail,W.stencilZPass)),le(W.polygonOffset,W.polygonOffsetFactor,W.polygonOffsetUnits),W.alphaToCoverage===!0?H(32926):$(32926)}u(K,"setMaterial");function oe(W){D!==W&&(W?n.frontFace(2304):n.frontFace(2305),D=W)}u(oe,"setFlipSided");function ge(W){W!==b3?(H(2884),W!==B&&(W===Bv?n.cullFace(1029):W===w3?n.cullFace(1028):n.cullFace(1032))):$(2884),B=W}u(ge,"setCullFace");function xe(W){W!==Q&&(ee&&n.lineWidth(W),Q=W)}u(xe,"setLineWidth");function le(W,ve,Ae){W?(H(32823),(U!==ve||z!==Ae)&&(n.polygonOffset(ve,Ae),U=ve,z=Ae)):$(32823)}u(le,"setPolygonOffset");function _e(W){W?H(3089):$(3089)}u(_e,"setScissorTest");function ce(W){W===void 0&&(W=33984+q-1),V!==W&&(n.activeTexture(W),V=W)}u(ce,"activeTexture");function R(W,ve,Ae){Ae===void 0&&(V===null?Ae=33984+q-1:Ae=V);let Le=Z[Ae];Le===void 0&&(Le={type:void 0,texture:void 0},Z[Ae]=Le),(Le.type!==W||Le.texture!==ve)&&(V!==Ae&&(n.activeTexture(Ae),V=Ae),n.bindTexture(W,ve||F[W]),Le.type=W,Le.texture=ve)}u(R,"bindTexture");function P(){const W=Z[V];W!==void 0&&W.type!==void 0&&(n.bindTexture(W.type,null),W.type=void 0,W.texture=void 0)}u(P,"unbindTexture");function j(){try{n.compressedTexImage2D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(j,"compressedTexImage2D");function re(){try{n.compressedTexImage3D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(re,"compressedTexImage3D");function pe(){try{n.texSubImage2D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(pe,"texSubImage2D");function be(){try{n.texSubImage3D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(be,"texSubImage3D");function Se(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(Se,"compressedTexSubImage2D");function we(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(we,"compressedTexSubImage3D");function ue(){try{n.texStorage2D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(ue,"texStorage2D");function Be(){try{n.texStorage3D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(Be,"texStorage3D");function He(){try{n.texImage2D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(He,"texImage2D");function Ne(){try{n.texImage3D.apply(n,arguments)}catch(W){console.error("THREE.WebGLState:",W)}}u(Ne,"texImage3D");function $e(W){fe.equals(W)===!1&&(n.scissor(W.x,W.y,W.z,W.w),fe.copy(W))}u($e,"scissor");function De(W){k.equals(W)===!1&&(n.viewport(W.x,W.y,W.z,W.w),k.copy(W))}u(De,"viewport");function Je(W,ve){let Ae=d.get(ve);Ae===void 0&&(Ae=new WeakMap,d.set(ve,Ae));let Le=Ae.get(W);Le===void 0&&(Le=n.getUniformBlockIndex(ve,W.name),Ae.set(W,Le))}u(Je,"updateUBOMapping");function It(W,ve){const Le=d.get(ve).get(W);h.get(W)!==Le&&(n.uniformBlockBinding(ve,Le,W.__bindingPointIndex),h.set(W,Le))}u(It,"uniformBlockBinding");function bn(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),i===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},V=null,Z={},p={},g=new WeakMap,m=[],v=null,y=!1,w=null,_=null,A=null,x=null,C=null,T=null,S=null,I=!1,D=null,B=null,Q=null,U=null,z=null,fe.set(0,0,n.canvas.width,n.canvas.height),k.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return u(bn,"reset"),{buffers:{color:a,depth:l,stencil:c},enable:H,disable:$,bindFramebuffer:te,drawBuffers:se,useProgram:ae,setBlending:G,setMaterial:K,setFlipSided:oe,setCullFace:ge,setLineWidth:xe,setPolygonOffset:le,setScissorTest:_e,activeTexture:ce,bindTexture:R,unbindTexture:P,compressedTexImage2D:j,compressedTexImage3D:re,texImage2D:He,texImage3D:Ne,updateUBOMapping:Je,uniformBlockBinding:It,texStorage2D:ue,texStorage3D:Be,texSubImage2D:pe,texSubImage3D:be,compressedTexSubImage2D:Se,compressedTexSubImage3D:we,scissor:$e,viewport:De,reset:bn}}u(sL,"WebGLState");function rL(n,e,t,i,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,h=s.maxTextureSize,d=s.maxSamples,f=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(typeof navigator=="undefined"?"":navigator.userAgent),g=new WeakMap;let m;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function w(R,P){return y?new OffscreenCanvas(R,P):jc("canvas")}u(w,"createCanvas");function _(R,P,j,re){let pe=1;if((R.width>re||R.height>re)&&(pe=re/Math.max(R.width,R.height)),pe<1||P===!0)if(typeof HTMLImageElement!="undefined"&&R instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&R instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&R instanceof ImageBitmap){const be=P?Pd:Math.floor,Se=be(pe*R.width),we=be(pe*R.height);m===void 0&&(m=w(Se,we));const ue=j?w(Se,we):m;return ue.width=Se,ue.height=we,ue.getContext("2d").drawImage(R,0,0,Se,we),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+R.width+"x"+R.height+") to ("+Se+"x"+we+")."),ue}else return"data"in R&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+R.width+"x"+R.height+")."),R;return R}u(_,"resizeImage");function A(R){return Bm(R.width)&&Bm(R.height)}u(A,"isPowerOfTwo$1");function x(R){return a?!1:R.wrapS!==pi||R.wrapT!==pi||R.minFilter!==yn&&R.minFilter!==Ci}u(x,"textureNeedsPowerOfTwo");function C(R,P){return R.generateMipmaps&&P&&R.minFilter!==yn&&R.minFilter!==Ci}u(C,"textureNeedsGenerateMipmaps");function T(R){n.generateMipmap(R)}u(T,"generateMipmap");function S(R,P,j,re,pe=!1){if(a===!1)return P;if(R!==null){if(n[R]!==void 0)return n[R];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+R+"'")}let be=P;return P===6403&&(j===5126&&(be=33326),j===5131&&(be=33325),j===5121&&(be=33321)),P===33319&&(j===5126&&(be=33328),j===5131&&(be=33327),j===5121&&(be=33323)),P===6408&&(j===5126&&(be=34836),j===5131&&(be=34842),j===5121&&(be=re===Dt&&pe===!1?35907:32856),j===32819&&(be=32854),j===32820&&(be=32855)),(be===33325||be===33326||be===33327||be===33328||be===34842||be===34836)&&e.get("EXT_color_buffer_float"),be}u(S,"getInternalFormat");function I(R,P,j){return C(R,j)===!0||R.isFramebufferTexture&&R.minFilter!==yn&&R.minFilter!==Ci?Math.log2(Math.max(P.width,P.height))+1:R.mipmaps!==void 0&&R.mipmaps.length>0?R.mipmaps.length:R.isCompressedTexture&&Array.isArray(R.image)?P.mipmaps.length:1}u(I,"getMipLevels");function D(R){return R===yn||R===Nm||R===km?9728:9729}u(D,"filterFallback");function B(R){const P=R.target;P.removeEventListener("dispose",B),U(P),P.isVideoTexture&&g.delete(P)}u(B,"onTextureDispose");function Q(R){const P=R.target;P.removeEventListener("dispose",Q),q(P)}u(Q,"onRenderTargetDispose");function U(R){const P=i.get(R);if(P.__webglInit===void 0)return;const j=R.source,re=v.get(j);if(re){const pe=re[P.__cacheKey];pe.usedTimes--,pe.usedTimes===0&&z(R),Object.keys(re).length===0&&v.delete(j)}i.remove(R)}u(U,"deallocateTexture");function z(R){const P=i.get(R);n.deleteTexture(P.__webglTexture);const j=R.source,re=v.get(j);delete re[P.__cacheKey],o.memory.textures--}u(z,"deleteTexture");function q(R){const P=R.texture,j=i.get(R),re=i.get(P);if(re.__webglTexture!==void 0&&(n.deleteTexture(re.__webglTexture),o.memory.textures--),R.depthTexture&&R.depthTexture.dispose(),R.isWebGLCubeRenderTarget)for(let pe=0;pe<6;pe++)n.deleteFramebuffer(j.__webglFramebuffer[pe]),j.__webglDepthbuffer&&n.deleteRenderbuffer(j.__webglDepthbuffer[pe]);else{if(n.deleteFramebuffer(j.__webglFramebuffer),j.__webglDepthbuffer&&n.deleteRenderbuffer(j.__webglDepthbuffer),j.__webglMultisampledFramebuffer&&n.deleteFramebuffer(j.__webglMultisampledFramebuffer),j.__webglColorRenderbuffer)for(let pe=0;pe<j.__webglColorRenderbuffer.length;pe++)j.__webglColorRenderbuffer[pe]&&n.deleteRenderbuffer(j.__webglColorRenderbuffer[pe]);j.__webglDepthRenderbuffer&&n.deleteRenderbuffer(j.__webglDepthRenderbuffer)}if(R.isWebGLMultipleRenderTargets)for(let pe=0,be=P.length;pe<be;pe++){const Se=i.get(P[pe]);Se.__webglTexture&&(n.deleteTexture(Se.__webglTexture),o.memory.textures--),i.remove(P[pe])}i.remove(P),i.remove(R)}u(q,"deallocateRenderTarget");let ee=0;function J(){ee=0}u(J,"resetTextureUnits");function X(){const R=ee;return R>=l&&console.warn("THREE.WebGLTextures: Trying to use "+R+" texture units while this GPU supports only "+l),ee+=1,R}u(X,"allocateTextureUnit");function V(R){const P=[];return P.push(R.wrapS),P.push(R.wrapT),P.push(R.wrapR||0),P.push(R.magFilter),P.push(R.minFilter),P.push(R.anisotropy),P.push(R.internalFormat),P.push(R.format),P.push(R.type),P.push(R.generateMipmaps),P.push(R.premultiplyAlpha),P.push(R.flipY),P.push(R.unpackAlignment),P.push(R.encoding),P.join()}u(V,"getTextureCacheKey");function Z(R,P){const j=i.get(R);if(R.isVideoTexture&&_e(R),R.isRenderTargetTexture===!1&&R.version>0&&j.__version!==R.version){const re=R.image;if(re===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{$(j,R,P);return}}t.bindTexture(3553,j.__webglTexture,33984+P)}u(Z,"setTexture2D");function de(R,P){const j=i.get(R);if(R.version>0&&j.__version!==R.version){$(j,R,P);return}t.bindTexture(35866,j.__webglTexture,33984+P)}u(de,"setTexture2DArray");function Y(R,P){const j=i.get(R);if(R.version>0&&j.__version!==R.version){$(j,R,P);return}t.bindTexture(32879,j.__webglTexture,33984+P)}u(Y,"setTexture3D");function fe(R,P){const j=i.get(R);if(R.version>0&&j.__version!==R.version){te(j,R,P);return}t.bindTexture(34067,j.__webglTexture,33984+P)}u(fe,"setTextureCube");const k={[Ka]:10497,[pi]:33071,[Ed]:33648},N={[yn]:9728,[Nm]:9984,[km]:9986,[Ci]:9729,[cw]:9985,[cu]:9987};function F(R,P,j){if(j?(n.texParameteri(R,10242,k[P.wrapS]),n.texParameteri(R,10243,k[P.wrapT]),(R===32879||R===35866)&&n.texParameteri(R,32882,k[P.wrapR]),n.texParameteri(R,10240,N[P.magFilter]),n.texParameteri(R,10241,N[P.minFilter])):(n.texParameteri(R,10242,33071),n.texParameteri(R,10243,33071),(R===32879||R===35866)&&n.texParameteri(R,32882,33071),(P.wrapS!==pi||P.wrapT!==pi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(R,10240,D(P.magFilter)),n.texParameteri(R,10241,D(P.minFilter)),P.minFilter!==yn&&P.minFilter!==Ci&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const re=e.get("EXT_texture_filter_anisotropic");if(P.type===Mr&&e.has("OES_texture_float_linear")===!1||a===!1&&P.type===Za&&e.has("OES_texture_half_float_linear")===!1)return;(P.anisotropy>1||i.get(P).__currentAnisotropy)&&(n.texParameterf(R,re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(P.anisotropy,s.getMaxAnisotropy())),i.get(P).__currentAnisotropy=P.anisotropy)}}u(F,"setTextureParameters");function H(R,P){let j=!1;R.__webglInit===void 0&&(R.__webglInit=!0,P.addEventListener("dispose",B));const re=P.source;let pe=v.get(re);pe===void 0&&(pe={},v.set(re,pe));const be=V(P);if(be!==R.__cacheKey){pe[be]===void 0&&(pe[be]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,j=!0),pe[be].usedTimes++;const Se=pe[R.__cacheKey];Se!==void 0&&(pe[R.__cacheKey].usedTimes--,Se.usedTimes===0&&z(P)),R.__cacheKey=be,R.__webglTexture=pe[be].texture}return j}u(H,"initTexture");function $(R,P,j){let re=3553;(P.isDataArrayTexture||P.isCompressedArrayTexture)&&(re=35866),P.isData3DTexture&&(re=32879);const pe=H(R,P),be=P.source;t.bindTexture(re,R.__webglTexture,33984+j);const Se=i.get(be);if(be.version!==Se.__version||pe===!0){t.activeTexture(33984+j),n.pixelStorei(37440,P.flipY),n.pixelStorei(37441,P.premultiplyAlpha),n.pixelStorei(3317,P.unpackAlignment),n.pixelStorei(37443,0);const we=x(P)&&A(P.image)===!1;let ue=_(P.image,we,!1,h);ue=ce(P,ue);const Be=A(ue)||a,He=r.convert(P.format,P.encoding);let Ne=r.convert(P.type),$e=S(P.internalFormat,He,Ne,P.encoding,P.isVideoTexture);F(re,P,Be);let De;const Je=P.mipmaps,It=a&&P.isVideoTexture!==!0,bn=Se.__version===void 0||pe===!0,W=I(P,ue,Be);if(P.isDepthTexture)$e=6402,a?P.type===Mr?$e=36012:P.type===So?$e=33190:P.type===Ua?$e=35056:$e=33189:P.type===Mr&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),P.format===Po&&$e===6402&&P.type!==uw&&P.type!==So&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),P.type=So,Ne=r.convert(P.type)),P.format===Qa&&$e===6402&&($e=34041,P.type!==Ua&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),P.type=Ua,Ne=r.convert(P.type))),bn&&(It?t.texStorage2D(3553,1,$e,ue.width,ue.height):t.texImage2D(3553,0,$e,ue.width,ue.height,0,He,Ne,null));else if(P.isDataTexture)if(Je.length>0&&Be){It&&bn&&t.texStorage2D(3553,W,$e,Je[0].width,Je[0].height);for(let ve=0,Ae=Je.length;ve<Ae;ve++)De=Je[ve],It?t.texSubImage2D(3553,ve,0,0,De.width,De.height,He,Ne,De.data):t.texImage2D(3553,ve,$e,De.width,De.height,0,He,Ne,De.data);P.generateMipmaps=!1}else It?(bn&&t.texStorage2D(3553,W,$e,ue.width,ue.height),t.texSubImage2D(3553,0,0,0,ue.width,ue.height,He,Ne,ue.data)):t.texImage2D(3553,0,$e,ue.width,ue.height,0,He,Ne,ue.data);else if(P.isCompressedTexture)if(P.isCompressedArrayTexture){It&&bn&&t.texStorage3D(35866,W,$e,Je[0].width,Je[0].height,ue.depth);for(let ve=0,Ae=Je.length;ve<Ae;ve++)De=Je[ve],P.format!==Ti?He!==null?It?t.compressedTexSubImage3D(35866,ve,0,0,0,De.width,De.height,ue.depth,He,De.data,0,0):t.compressedTexImage3D(35866,ve,$e,De.width,De.height,ue.depth,0,De.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):It?t.texSubImage3D(35866,ve,0,0,0,De.width,De.height,ue.depth,He,Ne,De.data):t.texImage3D(35866,ve,$e,De.width,De.height,ue.depth,0,He,Ne,De.data)}else{It&&bn&&t.texStorage2D(3553,W,$e,Je[0].width,Je[0].height);for(let ve=0,Ae=Je.length;ve<Ae;ve++)De=Je[ve],P.format!==Ti?He!==null?It?t.compressedTexSubImage2D(3553,ve,0,0,De.width,De.height,He,De.data):t.compressedTexImage2D(3553,ve,$e,De.width,De.height,0,De.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):It?t.texSubImage2D(3553,ve,0,0,De.width,De.height,He,Ne,De.data):t.texImage2D(3553,ve,$e,De.width,De.height,0,He,Ne,De.data)}else if(P.isDataArrayTexture)It?(bn&&t.texStorage3D(35866,W,$e,ue.width,ue.height,ue.depth),t.texSubImage3D(35866,0,0,0,0,ue.width,ue.height,ue.depth,He,Ne,ue.data)):t.texImage3D(35866,0,$e,ue.width,ue.height,ue.depth,0,He,Ne,ue.data);else if(P.isData3DTexture)It?(bn&&t.texStorage3D(32879,W,$e,ue.width,ue.height,ue.depth),t.texSubImage3D(32879,0,0,0,0,ue.width,ue.height,ue.depth,He,Ne,ue.data)):t.texImage3D(32879,0,$e,ue.width,ue.height,ue.depth,0,He,Ne,ue.data);else if(P.isFramebufferTexture){if(bn)if(It)t.texStorage2D(3553,W,$e,ue.width,ue.height);else{let ve=ue.width,Ae=ue.height;for(let Le=0;Le<W;Le++)t.texImage2D(3553,Le,$e,ve,Ae,0,He,Ne,null),ve>>=1,Ae>>=1}}else if(Je.length>0&&Be){It&&bn&&t.texStorage2D(3553,W,$e,Je[0].width,Je[0].height);for(let ve=0,Ae=Je.length;ve<Ae;ve++)De=Je[ve],It?t.texSubImage2D(3553,ve,0,0,He,Ne,De):t.texImage2D(3553,ve,$e,He,Ne,De);P.generateMipmaps=!1}else It?(bn&&t.texStorage2D(3553,W,$e,ue.width,ue.height),t.texSubImage2D(3553,0,0,0,He,Ne,ue)):t.texImage2D(3553,0,$e,He,Ne,ue);C(P,Be)&&T(re),Se.__version=be.version,P.onUpdate&&P.onUpdate(P)}R.__version=P.version}u($,"uploadTexture");function te(R,P,j){if(P.image.length!==6)return;const re=H(R,P),pe=P.source;t.bindTexture(34067,R.__webglTexture,33984+j);const be=i.get(pe);if(pe.version!==be.__version||re===!0){t.activeTexture(33984+j),n.pixelStorei(37440,P.flipY),n.pixelStorei(37441,P.premultiplyAlpha),n.pixelStorei(3317,P.unpackAlignment),n.pixelStorei(37443,0);const Se=P.isCompressedTexture||P.image[0].isCompressedTexture,we=P.image[0]&&P.image[0].isDataTexture,ue=[];for(let ve=0;ve<6;ve++)!Se&&!we?ue[ve]=_(P.image[ve],!1,!0,c):ue[ve]=we?P.image[ve].image:P.image[ve],ue[ve]=ce(P,ue[ve]);const Be=ue[0],He=A(Be)||a,Ne=r.convert(P.format,P.encoding),$e=r.convert(P.type),De=S(P.internalFormat,Ne,$e,P.encoding),Je=a&&P.isVideoTexture!==!0,It=be.__version===void 0||re===!0;let bn=I(P,Be,He);F(34067,P,He);let W;if(Se){Je&&It&&t.texStorage2D(34067,bn,De,Be.width,Be.height);for(let ve=0;ve<6;ve++){W=ue[ve].mipmaps;for(let Ae=0;Ae<W.length;Ae++){const Le=W[Ae];P.format!==Ti?Ne!==null?Je?t.compressedTexSubImage2D(34069+ve,Ae,0,0,Le.width,Le.height,Ne,Le.data):t.compressedTexImage2D(34069+ve,Ae,De,Le.width,Le.height,0,Le.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Je?t.texSubImage2D(34069+ve,Ae,0,0,Le.width,Le.height,Ne,$e,Le.data):t.texImage2D(34069+ve,Ae,De,Le.width,Le.height,0,Ne,$e,Le.data)}}}else{W=P.mipmaps,Je&&It&&(W.length>0&&bn++,t.texStorage2D(34067,bn,De,ue[0].width,ue[0].height));for(let ve=0;ve<6;ve++)if(we){Je?t.texSubImage2D(34069+ve,0,0,0,ue[ve].width,ue[ve].height,Ne,$e,ue[ve].data):t.texImage2D(34069+ve,0,De,ue[ve].width,ue[ve].height,0,Ne,$e,ue[ve].data);for(let Ae=0;Ae<W.length;Ae++){const Ue=W[Ae].image[ve].image;Je?t.texSubImage2D(34069+ve,Ae+1,0,0,Ue.width,Ue.height,Ne,$e,Ue.data):t.texImage2D(34069+ve,Ae+1,De,Ue.width,Ue.height,0,Ne,$e,Ue.data)}}else{Je?t.texSubImage2D(34069+ve,0,0,0,Ne,$e,ue[ve]):t.texImage2D(34069+ve,0,De,Ne,$e,ue[ve]);for(let Ae=0;Ae<W.length;Ae++){const Le=W[Ae];Je?t.texSubImage2D(34069+ve,Ae+1,0,0,Ne,$e,Le.image[ve]):t.texImage2D(34069+ve,Ae+1,De,Ne,$e,Le.image[ve])}}}C(P,He)&&T(34067),be.__version=pe.version,P.onUpdate&&P.onUpdate(P)}R.__version=P.version}u(te,"uploadCubeTexture");function se(R,P,j,re,pe){const be=r.convert(j.format,j.encoding),Se=r.convert(j.type),we=S(j.internalFormat,be,Se,j.encoding);i.get(P).__hasExternalTextures||(pe===32879||pe===35866?t.texImage3D(pe,0,we,P.width,P.height,P.depth,0,be,Se,null):t.texImage2D(pe,0,we,P.width,P.height,0,be,Se,null)),t.bindFramebuffer(36160,R),le(P)?f.framebufferTexture2DMultisampleEXT(36160,re,pe,i.get(j).__webglTexture,0,xe(P)):(pe===3553||pe>=34069&&pe<=34074)&&n.framebufferTexture2D(36160,re,pe,i.get(j).__webglTexture,0),t.bindFramebuffer(36160,null)}u(se,"setupFrameBufferTexture");function ae(R,P,j){if(n.bindRenderbuffer(36161,R),P.depthBuffer&&!P.stencilBuffer){let re=33189;if(j||le(P)){const pe=P.depthTexture;pe&&pe.isDepthTexture&&(pe.type===Mr?re=36012:pe.type===So&&(re=33190));const be=xe(P);le(P)?f.renderbufferStorageMultisampleEXT(36161,be,re,P.width,P.height):n.renderbufferStorageMultisample(36161,be,re,P.width,P.height)}else n.renderbufferStorage(36161,re,P.width,P.height);n.framebufferRenderbuffer(36160,36096,36161,R)}else if(P.depthBuffer&&P.stencilBuffer){const re=xe(P);j&&le(P)===!1?n.renderbufferStorageMultisample(36161,re,35056,P.width,P.height):le(P)?f.renderbufferStorageMultisampleEXT(36161,re,35056,P.width,P.height):n.renderbufferStorage(36161,34041,P.width,P.height),n.framebufferRenderbuffer(36160,33306,36161,R)}else{const re=P.isWebGLMultipleRenderTargets===!0?P.texture:[P.texture];for(let pe=0;pe<re.length;pe++){const be=re[pe],Se=r.convert(be.format,be.encoding),we=r.convert(be.type),ue=S(be.internalFormat,Se,we,be.encoding),Be=xe(P);j&&le(P)===!1?n.renderbufferStorageMultisample(36161,Be,ue,P.width,P.height):le(P)?f.renderbufferStorageMultisampleEXT(36161,Be,ue,P.width,P.height):n.renderbufferStorage(36161,ue,P.width,P.height)}}n.bindRenderbuffer(36161,null)}u(ae,"setupRenderBufferStorage");function E(R,P){if(P&&P.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,R),!(P.depthTexture&&P.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(P.depthTexture).__webglTexture||P.depthTexture.image.width!==P.width||P.depthTexture.image.height!==P.height)&&(P.depthTexture.image.width=P.width,P.depthTexture.image.height=P.height,P.depthTexture.needsUpdate=!0),Z(P.depthTexture,0);const re=i.get(P.depthTexture).__webglTexture,pe=xe(P);if(P.depthTexture.format===Po)le(P)?f.framebufferTexture2DMultisampleEXT(36160,36096,3553,re,0,pe):n.framebufferTexture2D(36160,36096,3553,re,0);else if(P.depthTexture.format===Qa)le(P)?f.framebufferTexture2DMultisampleEXT(36160,33306,3553,re,0,pe):n.framebufferTexture2D(36160,33306,3553,re,0);else throw new Error("Unknown depthTexture format")}u(E,"setupDepthTexture");function L(R){const P=i.get(R),j=R.isWebGLCubeRenderTarget===!0;if(R.depthTexture&&!P.__autoAllocateDepthBuffer){if(j)throw new Error("target.depthTexture not supported in Cube render targets");E(P.__webglFramebuffer,R)}else if(j){P.__webglDepthbuffer=[];for(let re=0;re<6;re++)t.bindFramebuffer(36160,P.__webglFramebuffer[re]),P.__webglDepthbuffer[re]=n.createRenderbuffer(),ae(P.__webglDepthbuffer[re],R,!1)}else t.bindFramebuffer(36160,P.__webglFramebuffer),P.__webglDepthbuffer=n.createRenderbuffer(),ae(P.__webglDepthbuffer,R,!1);t.bindFramebuffer(36160,null)}u(L,"setupDepthRenderbuffer");function G(R,P,j){const re=i.get(R);P!==void 0&&se(re.__webglFramebuffer,R,R.texture,36064,3553),j!==void 0&&L(R)}u(G,"rebindTextures");function K(R){const P=R.texture,j=i.get(R),re=i.get(P);R.addEventListener("dispose",Q),R.isWebGLMultipleRenderTargets!==!0&&(re.__webglTexture===void 0&&(re.__webglTexture=n.createTexture()),re.__version=P.version,o.memory.textures++);const pe=R.isWebGLCubeRenderTarget===!0,be=R.isWebGLMultipleRenderTargets===!0,Se=A(R)||a;if(pe){j.__webglFramebuffer=[];for(let we=0;we<6;we++)j.__webglFramebuffer[we]=n.createFramebuffer()}else{if(j.__webglFramebuffer=n.createFramebuffer(),be)if(s.drawBuffers){const we=R.texture;for(let ue=0,Be=we.length;ue<Be;ue++){const He=i.get(we[ue]);He.__webglTexture===void 0&&(He.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&R.samples>0&&le(R)===!1){const we=be?P:[P];j.__webglMultisampledFramebuffer=n.createFramebuffer(),j.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,j.__webglMultisampledFramebuffer);for(let ue=0;ue<we.length;ue++){const Be=we[ue];j.__webglColorRenderbuffer[ue]=n.createRenderbuffer(),n.bindRenderbuffer(36161,j.__webglColorRenderbuffer[ue]);const He=r.convert(Be.format,Be.encoding),Ne=r.convert(Be.type),$e=S(Be.internalFormat,He,Ne,Be.encoding,R.isXRRenderTarget===!0),De=xe(R);n.renderbufferStorageMultisample(36161,De,$e,R.width,R.height),n.framebufferRenderbuffer(36160,36064+ue,36161,j.__webglColorRenderbuffer[ue])}n.bindRenderbuffer(36161,null),R.depthBuffer&&(j.__webglDepthRenderbuffer=n.createRenderbuffer(),ae(j.__webglDepthRenderbuffer,R,!0)),t.bindFramebuffer(36160,null)}}if(pe){t.bindTexture(34067,re.__webglTexture),F(34067,P,Se);for(let we=0;we<6;we++)se(j.__webglFramebuffer[we],R,P,36064,34069+we);C(P,Se)&&T(34067),t.unbindTexture()}else if(be){const we=R.texture;for(let ue=0,Be=we.length;ue<Be;ue++){const He=we[ue],Ne=i.get(He);t.bindTexture(3553,Ne.__webglTexture),F(3553,He,Se),se(j.__webglFramebuffer,R,He,36064+ue,3553),C(He,Se)&&T(3553)}t.unbindTexture()}else{let we=3553;(R.isWebGL3DRenderTarget||R.isWebGLArrayRenderTarget)&&(a?we=R.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(we,re.__webglTexture),F(we,P,Se),se(j.__webglFramebuffer,R,P,36064,we),C(P,Se)&&T(we),t.unbindTexture()}R.depthBuffer&&L(R)}u(K,"setupRenderTarget");function oe(R){const P=A(R)||a,j=R.isWebGLMultipleRenderTargets===!0?R.texture:[R.texture];for(let re=0,pe=j.length;re<pe;re++){const be=j[re];if(C(be,P)){const Se=R.isWebGLCubeRenderTarget?34067:3553,we=i.get(be).__webglTexture;t.bindTexture(Se,we),T(Se),t.unbindTexture()}}}u(oe,"updateRenderTargetMipmap");function ge(R){if(a&&R.samples>0&&le(R)===!1){const P=R.isWebGLMultipleRenderTargets?R.texture:[R.texture],j=R.width,re=R.height;let pe=16384;const be=[],Se=R.stencilBuffer?33306:36096,we=i.get(R),ue=R.isWebGLMultipleRenderTargets===!0;if(ue)for(let Be=0;Be<P.length;Be++)t.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Be,36161,null),t.bindFramebuffer(36160,we.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Be,3553,null,0);t.bindFramebuffer(36008,we.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,we.__webglFramebuffer);for(let Be=0;Be<P.length;Be++){be.push(36064+Be),R.depthBuffer&&be.push(Se);const He=we.__ignoreDepthValues!==void 0?we.__ignoreDepthValues:!1;if(He===!1&&(R.depthBuffer&&(pe|=256),R.stencilBuffer&&(pe|=1024)),ue&&n.framebufferRenderbuffer(36008,36064,36161,we.__webglColorRenderbuffer[Be]),He===!0&&(n.invalidateFramebuffer(36008,[Se]),n.invalidateFramebuffer(36009,[Se])),ue){const Ne=i.get(P[Be]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Ne,0)}n.blitFramebuffer(0,0,j,re,0,0,j,re,pe,9728),p&&n.invalidateFramebuffer(36008,be)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),ue)for(let Be=0;Be<P.length;Be++){t.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Be,36161,we.__webglColorRenderbuffer[Be]);const He=i.get(P[Be]).__webglTexture;t.bindFramebuffer(36160,we.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Be,3553,He,0)}t.bindFramebuffer(36009,we.__webglMultisampledFramebuffer)}}u(ge,"updateMultisampleRenderTarget");function xe(R){return Math.min(d,R.samples)}u(xe,"getRenderTargetSamples");function le(R){const P=i.get(R);return a&&R.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&P.__useRenderToTexture!==!1}u(le,"useMultisampledRTT");function _e(R){const P=o.render.frame;g.get(R)!==P&&(g.set(R,P),R.update())}u(_e,"updateVideoTexture");function ce(R,P){const j=R.encoding,re=R.format,pe=R.type;return R.isCompressedTexture===!0||R.isVideoTexture===!0||R.format===zm||j!==Ks&&(j===Dt?a===!1?e.has("EXT_sRGB")===!0&&re===Ti?(R.format=zm,R.minFilter=Ci,R.generateMipmaps=!1):P=Lg.sRGBToLinear(P):(re!==Ti||pe!==Lo)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",j)),P}u(ce,"verifyColorSpace"),this.allocateTextureUnit=X,this.resetTextureUnits=J,this.setTexture2D=Z,this.setTexture2DArray=de,this.setTexture3D=Y,this.setTextureCube=fe,this.rebindTextures=G,this.setupRenderTarget=K,this.updateRenderTargetMipmap=oe,this.updateMultisampleRenderTarget=ge,this.setupDepthRenderbuffer=L,this.setupFrameBufferTexture=se,this.useMultisampledRTT=le}u(rL,"WebGLTextures");function oL(n,e,t){const i=t.isWebGL2;function s(r,o=null){let a;if(r===Lo)return 5121;if(r===Q3)return 32819;if(r===J3)return 32820;if(r===q3)return 5120;if(r===K3)return 5122;if(r===uw)return 5123;if(r===Z3)return 5124;if(r===So)return 5125;if(r===Mr)return 5126;if(r===Za)return i?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===eE)return 6406;if(r===Ti)return 6408;if(r===nE)return 6409;if(r===iE)return 6410;if(r===Po)return 6402;if(r===Qa)return 34041;if(r===sE)return 6403;if(r===tE)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===zm)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===rE)return 36244;if(r===oE)return 33319;if(r===aE)return 33320;if(r===lE)return 36249;if(r===Kf||r===Zf||r===Qf||r===Jf)if(o===Dt)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===Kf)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Zf)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Qf)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Jf)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===Kf)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Zf)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Qf)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Jf)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===$v||r===Wv||r===jv||r===Xv)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===$v)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Wv)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===jv)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Xv)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===cE)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===Yv||r===qv)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===Yv)return o===Dt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===qv)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===Kv||r===Zv||r===Qv||r===Jv||r===ey||r===ty||r===ny||r===iy||r===sy||r===ry||r===oy||r===ay||r===ly||r===cy)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===Kv)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===Zv)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===Qv)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===Jv)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===ey)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===ty)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===ny)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===iy)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===sy)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===ry)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===oy)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===ay)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===ly)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===cy)return o===Dt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===uy)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===uy)return o===Dt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===Ua?i?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[r]!==void 0?n[r]:null}return u(s,"convert"),{convert:s}}u(oL,"WebGLUtils");class Pw extends Dn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}u(Pw,"ArrayCamera");class Ei extends yt{constructor(){super(),this.isGroup=!0,this.type="Group"}}u(Ei,"Group");const aL={type:"move"};class cd{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ei,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ei,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new b,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new b),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ei,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new b,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new b),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const m of e.hand.values()){const v=t.getJointPose(m,i);if(c.joints[m.jointName]===void 0){const w=new Ei;w.matrixAutoUpdate=!1,w.visible=!1,c.joints[m.jointName]=w,c.add(w)}const y=c.joints[m.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}const h=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=h.position.distanceTo(d.position),p=.02,g=.005;c.inputState.pinching&&f>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(aL)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}}u(cd,"WebXRController");class Iw extends On{constructor(e,t,i,s,r,o,a,l,c,h){if(h=h!==void 0?h:Po,h!==Po&&h!==Qa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===Po&&(i=So),i===void 0&&h===Qa&&(i=Ua),super(null,s,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:yn,this.minFilter=l!==void 0?l:yn,this.flipY=!1,this.generateMipmaps=!1}}u(Iw,"DepthTexture");class Rw extends Uo{constructor(e,t){super();const i=this;let s=null,r=1,o=null,a="local-floor",l=null,c=null,h=null,d=null,f=null,p=null;const g=t.getContextAttributes();let m=null,v=null;const y=[],w=[],_=new Dn;_.layers.enable(1),_.viewport=new gt;const A=new Dn;A.layers.enable(2),A.viewport=new gt;const x=[_,A],C=new Pw;C.layers.enable(1),C.layers.enable(2);let T=null,S=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(V){let Z=y[V];return Z===void 0&&(Z=new cd,y[V]=Z),Z.getTargetRaySpace()},this.getControllerGrip=function(V){let Z=y[V];return Z===void 0&&(Z=new cd,y[V]=Z),Z.getGripSpace()},this.getHand=function(V){let Z=y[V];return Z===void 0&&(Z=new cd,y[V]=Z),Z.getHandSpace()};function I(V){const Z=w.indexOf(V.inputSource);if(Z===-1)return;const de=y[Z];de!==void 0&&de.dispatchEvent({type:V.type,data:V.inputSource})}u(I,"onSessionEvent");function D(){s.removeEventListener("select",I),s.removeEventListener("selectstart",I),s.removeEventListener("selectend",I),s.removeEventListener("squeeze",I),s.removeEventListener("squeezestart",I),s.removeEventListener("squeezeend",I),s.removeEventListener("end",D),s.removeEventListener("inputsourceschange",B);for(let V=0;V<y.length;V++){const Z=w[V];Z!==null&&(w[V]=null,y[V].disconnect(Z))}T=null,S=null,e.setRenderTarget(m),f=null,d=null,h=null,s=null,v=null,X.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}u(D,"onSessionEnd"),this.setFramebufferScaleFactor=function(V){r=V,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(V){a=V,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(V){l=V},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(V){if(s=V,s!==null){if(m=e.getRenderTarget(),s.addEventListener("select",I),s.addEventListener("selectstart",I),s.addEventListener("selectend",I),s.addEventListener("squeeze",I),s.addEventListener("squeezestart",I),s.addEventListener("squeezeend",I),s.addEventListener("end",D),s.addEventListener("inputsourceschange",B),g.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const Z={antialias:s.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(s,t,Z),s.updateRenderState({baseLayer:f}),v=new Rn(f.framebufferWidth,f.framebufferHeight,{format:Ti,type:Lo,encoding:e.outputEncoding,stencilBuffer:g.stencil})}else{let Z=null,de=null,Y=null;g.depth&&(Y=g.stencil?35056:33190,Z=g.stencil?Qa:Po,de=g.stencil?Ua:So);const fe={colorFormat:32856,depthFormat:Y,scaleFactor:r};h=new XRWebGLBinding(s,t),d=h.createProjectionLayer(fe),s.updateRenderState({layers:[d]}),v=new Rn(d.textureWidth,d.textureHeight,{format:Ti,type:Lo,depthTexture:new Iw(d.textureWidth,d.textureHeight,de,void 0,void 0,void 0,void 0,void 0,void 0,Z),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0});const k=e.properties.get(v);k.__ignoreDepthValues=d.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(1),l=null,o=await s.requestReferenceSpace(a),X.setContext(s),X.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function B(V){for(let Z=0;Z<V.removed.length;Z++){const de=V.removed[Z],Y=w.indexOf(de);Y>=0&&(w[Y]=null,y[Y].dispatchEvent({type:"disconnected",data:de}))}for(let Z=0;Z<V.added.length;Z++){const de=V.added[Z];let Y=w.indexOf(de);if(Y===-1){for(let k=0;k<y.length;k++)if(k>=w.length){w.push(de),Y=k;break}else if(w[k]===null){w[k]=de,Y=k;break}if(Y===-1)break}const fe=y[Y];fe&&fe.dispatchEvent({type:"connected",data:de})}}u(B,"onInputSourcesChange");const Q=new b,U=new b;function z(V,Z,de){Q.setFromMatrixPosition(Z.matrixWorld),U.setFromMatrixPosition(de.matrixWorld);const Y=Q.distanceTo(U),fe=Z.projectionMatrix.elements,k=de.projectionMatrix.elements,N=fe[14]/(fe[10]-1),F=fe[14]/(fe[10]+1),H=(fe[9]+1)/fe[5],$=(fe[9]-1)/fe[5],te=(fe[8]-1)/fe[0],se=(k[8]+1)/k[0],ae=N*te,E=N*se,L=Y/(-te+se),G=L*-te;Z.matrixWorld.decompose(V.position,V.quaternion,V.scale),V.translateX(G),V.translateZ(L),V.matrixWorld.compose(V.position,V.quaternion,V.scale),V.matrixWorldInverse.copy(V.matrixWorld).invert();const K=N+L,oe=F+L,ge=ae-G,xe=E+(Y-G),le=H*F/oe*K,_e=$*F/oe*K;V.projectionMatrix.makePerspective(ge,xe,le,_e,K,oe)}u(z,"setProjectionFromUnion");function q(V,Z){Z===null?V.matrixWorld.copy(V.matrix):V.matrixWorld.multiplyMatrices(Z.matrixWorld,V.matrix),V.matrixWorldInverse.copy(V.matrixWorld).invert()}u(q,"updateCamera"),this.updateCamera=function(V){if(s===null)return;C.near=A.near=_.near=V.near,C.far=A.far=_.far=V.far,(T!==C.near||S!==C.far)&&(s.updateRenderState({depthNear:C.near,depthFar:C.far}),T=C.near,S=C.far);const Z=V.parent,de=C.cameras;q(C,Z);for(let fe=0;fe<de.length;fe++)q(de[fe],Z);C.matrixWorld.decompose(C.position,C.quaternion,C.scale),V.matrix.copy(C.matrix),V.matrix.decompose(V.position,V.quaternion,V.scale);const Y=V.children;for(let fe=0,k=Y.length;fe<k;fe++)Y[fe].updateMatrixWorld(!0);de.length===2?z(C,_,A):C.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return C},this.getFoveation=function(){if(d!==null)return d.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function(V){d!==null&&(d.fixedFoveation=V),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=V)};let ee=null;function J(V,Z){if(c=Z.getViewerPose(l||o),p=Z,c!==null){const de=c.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let Y=!1;de.length!==C.cameras.length&&(C.cameras.length=0,Y=!0);for(let fe=0;fe<de.length;fe++){const k=de[fe];let N=null;if(f!==null)N=f.getViewport(k);else{const H=h.getViewSubImage(d,k);N=H.viewport,fe===0&&(e.setRenderTargetTextures(v,H.colorTexture,d.ignoreDepthValues?void 0:H.depthStencilTexture),e.setRenderTarget(v))}let F=x[fe];F===void 0&&(F=new Dn,F.layers.enable(fe),F.viewport=new gt,x[fe]=F),F.matrix.fromArray(k.transform.matrix),F.projectionMatrix.fromArray(k.projectionMatrix),F.viewport.set(N.x,N.y,N.width,N.height),fe===0&&C.matrix.copy(F.matrix),Y===!0&&C.cameras.push(F)}}for(let de=0;de<y.length;de++){const Y=w[de],fe=y[de];Y!==null&&fe!==void 0&&fe.update(Y,Z,l||o)}ee&&ee(V,Z),p=null}u(J,"onAnimationFrame");const X=new yw;X.setAnimationLoop(J),this.setAnimationLoop=function(V){ee=V},this.dispose=function(){}}}u(Rw,"WebXRManager");function lL(n,e){function t(m,v){m.fogColor.value.copy(v.color),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)}u(t,"refreshFogUniforms");function i(m,v,y,w,_){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(m,v):v.isMeshToonMaterial?(s(m,v),h(m,v)):v.isMeshPhongMaterial?(s(m,v),c(m,v)):v.isMeshStandardMaterial?(s(m,v),d(m,v),v.isMeshPhysicalMaterial&&f(m,v,_)):v.isMeshMatcapMaterial?(s(m,v),p(m,v)):v.isMeshDepthMaterial?s(m,v):v.isMeshDistanceMaterial?(s(m,v),g(m,v)):v.isMeshNormalMaterial?s(m,v):v.isLineBasicMaterial?(r(m,v),v.isLineDashedMaterial&&o(m,v)):v.isPointsMaterial?a(m,v,y,w):v.isSpriteMaterial?l(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}u(i,"refreshMaterialUniforms");function s(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.bumpMap&&(m.bumpMap.value=v.bumpMap,m.bumpScale.value=v.bumpScale,v.side===Vi&&(m.bumpScale.value*=-1)),v.displacementMap&&(m.displacementMap.value=v.displacementMap,m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap),v.normalMap&&(m.normalMap.value=v.normalMap,m.normalScale.value.copy(v.normalScale),v.side===Vi&&m.normalScale.value.negate()),v.specularMap&&(m.specularMap.value=v.specularMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const y=e.get(v).envMap;if(y&&(m.envMap.value=y,m.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio),v.lightMap){m.lightMap.value=v.lightMap;const A=n.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=v.lightMapIntensity*A}v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity);let w;v.map?w=v.map:v.specularMap?w=v.specularMap:v.displacementMap?w=v.displacementMap:v.normalMap?w=v.normalMap:v.bumpMap?w=v.bumpMap:v.roughnessMap?w=v.roughnessMap:v.metalnessMap?w=v.metalnessMap:v.alphaMap?w=v.alphaMap:v.emissiveMap?w=v.emissiveMap:v.clearcoatMap?w=v.clearcoatMap:v.clearcoatNormalMap?w=v.clearcoatNormalMap:v.clearcoatRoughnessMap?w=v.clearcoatRoughnessMap:v.iridescenceMap?w=v.iridescenceMap:v.iridescenceThicknessMap?w=v.iridescenceThicknessMap:v.specularIntensityMap?w=v.specularIntensityMap:v.specularColorMap?w=v.specularColorMap:v.transmissionMap?w=v.transmissionMap:v.thicknessMap?w=v.thicknessMap:v.sheenColorMap?w=v.sheenColorMap:v.sheenRoughnessMap&&(w=v.sheenRoughnessMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),m.uvTransform.value.copy(w.matrix));let _;v.aoMap?_=v.aoMap:v.lightMap&&(_=v.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uv2Transform.value.copy(_.matrix))}u(s,"refreshUniformsCommon");function r(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity}u(r,"refreshUniformsLine");function o(m,v){m.dashSize.value=v.dashSize,m.totalSize.value=v.dashSize+v.gapSize,m.scale.value=v.scale}u(o,"refreshUniformsDash");function a(m,v,y,w){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.size.value=v.size*y,m.scale.value=w*.5,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let _;v.map?_=v.map:v.alphaMap&&(_=v.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uvTransform.value.copy(_.matrix))}u(a,"refreshUniformsPoints");function l(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.rotation.value=v.rotation,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let y;v.map?y=v.map:v.alphaMap&&(y=v.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix))}u(l,"refreshUniformsSprites");function c(m,v){m.specular.value.copy(v.specular),m.shininess.value=Math.max(v.shininess,1e-4)}u(c,"refreshUniformsPhong");function h(m,v){v.gradientMap&&(m.gradientMap.value=v.gradientMap)}u(h,"refreshUniformsToon");function d(m,v){m.roughness.value=v.roughness,m.metalness.value=v.metalness,v.roughnessMap&&(m.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(m.metalnessMap.value=v.metalnessMap),e.get(v).envMap&&(m.envMapIntensity.value=v.envMapIntensity)}u(d,"refreshUniformsStandard");function f(m,v,y){m.ior.value=v.ior,v.sheen>0&&(m.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),m.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(m.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(m.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(m.clearcoat.value=v.clearcoat,m.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(m.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),m.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===Vi&&m.clearcoatNormalScale.value.negate())),v.iridescence>0&&(m.iridescence.value=v.iridescence,m.iridescenceIOR.value=v.iridescenceIOR,m.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(m.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(m.transmission.value=v.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),v.transmissionMap&&(m.transmissionMap.value=v.transmissionMap),m.thickness.value=v.thickness,v.thicknessMap&&(m.thicknessMap.value=v.thicknessMap),m.attenuationDistance.value=v.attenuationDistance,m.attenuationColor.value.copy(v.attenuationColor)),m.specularIntensity.value=v.specularIntensity,m.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(m.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(m.specularColorMap.value=v.specularColorMap)}u(f,"refreshUniformsPhysical");function p(m,v){v.matcap&&(m.matcap.value=v.matcap)}u(p,"refreshUniformsMatcap");function g(m,v){m.referencePosition.value.copy(v.referencePosition),m.nearDistance.value=v.nearDistance,m.farDistance.value=v.farDistance}return u(g,"refreshUniformsDistance"),{refreshFogUniforms:t,refreshMaterialUniforms:i}}u(lL,"WebGLMaterials");function cL(n,e,t,i){let s={},r={},o=[];const a=t.isWebGL2?n.getParameter(35375):0;function l(w,_){const A=_.program;i.uniformBlockBinding(w,A)}u(l,"bind");function c(w,_){let A=s[w.id];A===void 0&&(g(w),A=h(w),s[w.id]=A,w.addEventListener("dispose",v));const x=_.program;i.updateUBOMapping(w,x);const C=e.render.frame;r[w.id]!==C&&(f(w),r[w.id]=C)}u(c,"update");function h(w){const _=d();w.__bindingPointIndex=_;const A=n.createBuffer(),x=w.__size,C=w.usage;return n.bindBuffer(35345,A),n.bufferData(35345,x,C),n.bindBuffer(35345,null),n.bindBufferBase(35345,_,A),A}u(h,"createBuffer");function d(){for(let w=0;w<a;w++)if(o.indexOf(w)===-1)return o.push(w),w;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}u(d,"allocateBindingPointIndex");function f(w){const _=s[w.id],A=w.uniforms,x=w.__cache;n.bindBuffer(35345,_);for(let C=0,T=A.length;C<T;C++){const S=A[C];if(p(S,C,x)===!0){const I=S.value,D=S.__offset;typeof I=="number"?(S.__data[0]=I,n.bufferSubData(35345,D,S.__data)):(S.value.isMatrix3?(S.__data[0]=S.value.elements[0],S.__data[1]=S.value.elements[1],S.__data[2]=S.value.elements[2],S.__data[3]=S.value.elements[0],S.__data[4]=S.value.elements[3],S.__data[5]=S.value.elements[4],S.__data[6]=S.value.elements[5],S.__data[7]=S.value.elements[0],S.__data[8]=S.value.elements[6],S.__data[9]=S.value.elements[7],S.__data[10]=S.value.elements[8],S.__data[11]=S.value.elements[0]):I.toArray(S.__data),n.bufferSubData(35345,D,S.__data))}}n.bindBuffer(35345,null)}u(f,"updateBufferData");function p(w,_,A){const x=w.value;if(A[_]===void 0)return typeof x=="number"?A[_]=x:A[_]=x.clone(),!0;if(typeof x=="number"){if(A[_]!==x)return A[_]=x,!0}else{const C=A[_];if(C.equals(x)===!1)return C.copy(x),!0}return!1}u(p,"hasUniformChanged");function g(w){const _=w.uniforms;let A=0;const x=16;let C=0;for(let T=0,S=_.length;T<S;T++){const I=_[T],D=m(I);if(I.__data=new Float32Array(D.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=A,T>0){C=A%x;const B=x-C;C!==0&&B-D.boundary<0&&(A+=x-C,I.__offset=A)}A+=D.storage}return C=A%x,C>0&&(A+=x-C),w.__size=A,w.__cache={},this}u(g,"prepareUniformsGroup");function m(w){const _=w.value,A={boundary:0,storage:0};return typeof _=="number"?(A.boundary=4,A.storage=4):_.isVector2?(A.boundary=8,A.storage=8):_.isVector3||_.isColor?(A.boundary=16,A.storage=12):_.isVector4?(A.boundary=16,A.storage=16):_.isMatrix3?(A.boundary=48,A.storage=48):_.isMatrix4?(A.boundary=64,A.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),A}u(m,"getUniformSize");function v(w){const _=w.target;_.removeEventListener("dispose",v);const A=o.indexOf(_.__bindingPointIndex);o.splice(A,1),n.deleteBuffer(s[_.id]),delete s[_.id],delete r[_.id]}u(v,"onUniformsGroupsDispose");function y(){for(const w in s)n.deleteBuffer(s[w]);o=[],s={},r={}}return u(y,"dispose"),{bind:l,update:c,dispose:y}}u(cL,"WebGLUniformsGroups");function uL(){const n=jc("canvas");return n.style.display="block",n}u(uL,"createCanvasElement");function Dw(n={}){this.isWebGLRenderer=!0;const e=n.canvas!==void 0?n.canvas:uL(),t=n.context!==void 0?n.context:null,i=n.depth!==void 0?n.depth:!0,s=n.stencil!==void 0?n.stencil:!0,r=n.antialias!==void 0?n.antialias:!1,o=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,a=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,l=n.powerPreference!==void 0?n.powerPreference:"default",c=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let h;t!==null?h=t.getContextAttributes().alpha:h=n.alpha!==void 0?n.alpha:!1;let d=null,f=null;const p=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ks,this.physicallyCorrectLights=!1,this.toneMapping=As,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let v=!1,y=0,w=0,_=null,A=-1,x=null;const C=new gt,T=new gt;let S=null,I=e.width,D=e.height,B=1,Q=null,U=null;const z=new gt(0,0,I,D),q=new gt(0,0,I,D);let ee=!1;const J=new uu;let X=!1,V=!1,Z=null;const de=new Me,Y=new Ge,fe=new b,k={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function N(){return _===null?B:1}u(N,"getTargetPixelRatio");let F=t;function H(O,ie){for(let me=0;me<O.length;me++){const ne=O[me],ye=e.getContext(ne,ie);if(ye!==null)return ye}return null}u(H,"getContext");try{const O={alpha:!0,depth:i,stencil:s,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Rg}`),e.addEventListener("webglcontextlost",$e,!1),e.addEventListener("webglcontextrestored",De,!1),e.addEventListener("webglcontextcreationerror",Je,!1),F===null){const ie=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&ie.shift(),F=H(ie,O),F===null)throw H(ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}F.getShaderPrecisionFormat===void 0&&(F.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(O){throw console.error("THREE.WebGLRenderer: "+O.message),O}let $,te,se,ae,E,L,G,K,oe,ge,xe,le,_e,ce,R,P,j,re,pe,be,Se,we,ue,Be;function He(){$=new RR(F),te=new AR(F,$,n),$.init(te),we=new oL(F,$,te),se=new sL(F,$,te),ae=new FR,E=new jD,L=new rL(F,$,se,E,te,we,ae),G=new TR(m),K=new IR(m),oe=new GE(F,te),ue=new MR(F,$,oe,te),ge=new DR(F,oe,ae,ue),xe=new zR(F,ge,oe,ae),pe=new kR(F,te,L),P=new CR(E),le=new WD(m,G,K,$,te,ue,P),_e=new lL(m,E),ce=new YD,R=new eL($,te),re=new wR(m,G,K,se,xe,h,o),j=new iL(m,xe,te),Be=new cL(F,ae,te,se),be=new SR(F,$,ae,te),Se=new LR(F,$,ae,te),ae.programs=le.programs,m.capabilities=te,m.extensions=$,m.properties=E,m.renderLists=ce,m.shadowMap=j,m.state=se,m.info=ae}u(He,"initGLContext"),He();const Ne=new Rw(m,F);this.xr=Ne,this.getContext=function(){return F},this.getContextAttributes=function(){return F.getContextAttributes()},this.forceContextLoss=function(){const O=$.get("WEBGL_lose_context");O&&O.loseContext()},this.forceContextRestore=function(){const O=$.get("WEBGL_lose_context");O&&O.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(O){O!==void 0&&(B=O,this.setSize(I,D,!1))},this.getSize=function(O){return O.set(I,D)},this.setSize=function(O,ie,me){if(Ne.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}I=O,D=ie,e.width=Math.floor(O*B),e.height=Math.floor(ie*B),me!==!1&&(e.style.width=O+"px",e.style.height=ie+"px"),this.setViewport(0,0,O,ie)},this.getDrawingBufferSize=function(O){return O.set(I*B,D*B).floor()},this.setDrawingBufferSize=function(O,ie,me){I=O,D=ie,B=me,e.width=Math.floor(O*me),e.height=Math.floor(ie*me),this.setViewport(0,0,O,ie)},this.getCurrentViewport=function(O){return O.copy(C)},this.getViewport=function(O){return O.copy(z)},this.setViewport=function(O,ie,me,ne){O.isVector4?z.set(O.x,O.y,O.z,O.w):z.set(O,ie,me,ne),se.viewport(C.copy(z).multiplyScalar(B).floor())},this.getScissor=function(O){return O.copy(q)},this.setScissor=function(O,ie,me,ne){O.isVector4?q.set(O.x,O.y,O.z,O.w):q.set(O,ie,me,ne),se.scissor(T.copy(q).multiplyScalar(B).floor())},this.getScissorTest=function(){return ee},this.setScissorTest=function(O){se.setScissorTest(ee=O)},this.setOpaqueSort=function(O){Q=O},this.setTransparentSort=function(O){U=O},this.getClearColor=function(O){return O.copy(re.getClearColor())},this.setClearColor=function(){re.setClearColor.apply(re,arguments)},this.getClearAlpha=function(){return re.getClearAlpha()},this.setClearAlpha=function(){re.setClearAlpha.apply(re,arguments)},this.clear=function(O=!0,ie=!0,me=!0){let ne=0;O&&(ne|=16384),ie&&(ne|=256),me&&(ne|=1024),F.clear(ne)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",$e,!1),e.removeEventListener("webglcontextrestored",De,!1),e.removeEventListener("webglcontextcreationerror",Je,!1),ce.dispose(),R.dispose(),E.dispose(),G.dispose(),K.dispose(),xe.dispose(),ue.dispose(),Be.dispose(),le.dispose(),Ne.dispose(),Ne.removeEventListener("sessionstart",Le),Ne.removeEventListener("sessionend",Ue),Z&&(Z.dispose(),Z=null),wt.stop()};function $e(O){O.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}u($e,"onContextLost");function De(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const O=ae.autoReset,ie=j.enabled,me=j.autoUpdate,ne=j.needsUpdate,ye=j.type;He(),ae.autoReset=O,j.enabled=ie,j.autoUpdate=me,j.needsUpdate=ne,j.type=ye}u(De,"onContextRestore");function Je(O){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",O.statusMessage)}u(Je,"onContextCreationError");function It(O){const ie=O.target;ie.removeEventListener("dispose",It),bn(ie)}u(It,"onMaterialDispose");function bn(O){W(O),E.remove(O)}u(bn,"deallocateMaterial");function W(O){const ie=E.get(O).programs;ie!==void 0&&(ie.forEach(function(me){le.releaseProgram(me)}),O.isShaderMaterial&&le.releaseShaderCache(O))}u(W,"releaseMaterialProgramReferences"),this.renderBufferDirect=function(O,ie,me,ne,ye,We){ie===null&&(ie=k);const et=ye.isMesh&&ye.matrixWorld.determinant()<0,ct=LA(O,ie,me,ne,ye);se.setMaterial(ne,et);let rt=me.index;const Mt=me.attributes.position;if(rt===null){if(Mt===void 0||Mt.count===0)return}else if(rt.count===0)return;let ft=1;ne.wireframe===!0&&(rt=ge.getWireframeAttribute(me),ft=2),ue.setup(ye,ne,ct,me,rt);let _t,Kt=be;rt!==null&&(_t=oe.get(rt),Kt=Se,Kt.setIndex(_t));const Wr=rt!==null?rt.count:Mt.count,Yo=me.drawRange.start*ft,qo=me.drawRange.count*ft,us=We!==null?We.start*ft:0,St=We!==null?We.count*ft:1/0,Ko=Math.max(Yo,us),un=Math.min(Wr,Yo+qo,us+St)-1,Li=Math.max(0,un-Ko+1);if(Li!==0){if(ye.isMesh)ne.wireframe===!0?(se.setLineWidth(ne.wireframeLinewidth*N()),Kt.setMode(1)):Kt.setMode(4);else if(ye.isLine){let ir=ne.linewidth;ir===void 0&&(ir=1),se.setLineWidth(ir*N()),ye.isLineSegments?Kt.setMode(1):ye.isLineLoop?Kt.setMode(2):Kt.setMode(3)}else ye.isPoints?Kt.setMode(0):ye.isSprite&&Kt.setMode(4);if(ye.isInstancedMesh)Kt.renderInstances(Ko,Li,ye.count);else if(me.isInstancedBufferGeometry){const ir=Math.min(me.instanceCount,me._maxInstanceCount);Kt.renderInstances(Ko,Li,ir)}else Kt.render(Ko,Li)}},this.compile=function(O,ie){function me(ne,ye,We){ne.transparent===!0&&ne.side===Ui?(ne.side=Vi,ne.needsUpdate=!0,Di(ne,ye,We),ne.side=Xa,ne.needsUpdate=!0,Di(ne,ye,We),ne.side=Ui):Di(ne,ye,We)}u(me,"prepare"),f=R.get(O),f.init(),g.push(f),O.traverseVisible(function(ne){ne.isLight&&ne.layers.test(ie.layers)&&(f.pushLight(ne),ne.castShadow&&f.pushShadow(ne))}),f.setupLights(m.physicallyCorrectLights),O.traverse(function(ne){const ye=ne.material;if(ye)if(Array.isArray(ye))for(let We=0;We<ye.length;We++){const et=ye[We];me(et,O,ne)}else me(ye,O,ne)}),g.pop(),f=null};let ve=null;function Ae(O){ve&&ve(O)}u(Ae,"onAnimationFrame");function Le(){wt.stop()}u(Le,"onXRSessionStart");function Ue(){wt.start()}u(Ue,"onXRSessionEnd");const wt=new yw;wt.setAnimationLoop(Ae),typeof self!="undefined"&&wt.setContext(self),this.setAnimationLoop=function(O){ve=O,Ne.setAnimationLoop(O),O===null?wt.stop():wt.start()},Ne.addEventListener("sessionstart",Le),Ne.addEventListener("sessionend",Ue),this.render=function(O,ie){if(ie!==void 0&&ie.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;O.matrixWorldAutoUpdate===!0&&O.updateMatrixWorld(),ie.parent===null&&ie.matrixWorldAutoUpdate===!0&&ie.updateMatrixWorld(),Ne.enabled===!0&&Ne.isPresenting===!0&&(Ne.cameraAutoUpdate===!0&&Ne.updateCamera(ie),ie=Ne.getCamera()),O.isScene===!0&&O.onBeforeRender(m,O,ie,_),f=R.get(O,g.length),f.init(),g.push(f),de.multiplyMatrices(ie.projectionMatrix,ie.matrixWorldInverse),J.setFromProjectionMatrix(de),V=this.localClippingEnabled,X=P.init(this.clippingPlanes,V,ie),d=ce.get(O,p.length),d.init(),p.push(d),wn(O,ie,0,m.sortObjects),d.finish(),m.sortObjects===!0&&d.sort(Q,U),X===!0&&P.beginShadows();const me=f.state.shadowsArray;if(j.render(me,O,ie),X===!0&&P.endShadows(),this.info.autoReset===!0&&this.info.reset(),re.render(d,O),f.setupLights(m.physicallyCorrectLights),ie.isArrayCamera){const ne=ie.cameras;for(let ye=0,We=ne.length;ye<We;ye++){const et=ne[ye];Nn(d,O,et,et.viewport)}}else Nn(d,O,ie);_!==null&&(L.updateMultisampleRenderTarget(_),L.updateRenderTargetMipmap(_)),O.isScene===!0&&O.onAfterRender(m,O,ie),ue.resetDefaultState(),A=-1,x=null,g.pop(),g.length>0?f=g[g.length-1]:f=null,p.pop(),p.length>0?d=p[p.length-1]:d=null};function wn(O,ie,me,ne){if(O.visible===!1)return;if(O.layers.test(ie.layers)){if(O.isGroup)me=O.renderOrder;else if(O.isLOD)O.autoUpdate===!0&&O.update(ie);else if(O.isLight)f.pushLight(O),O.castShadow&&f.pushShadow(O);else if(O.isSprite){if(!O.frustumCulled||J.intersectsSprite(O)){ne&&fe.setFromMatrixPosition(O.matrixWorld).applyMatrix4(de);const et=xe.update(O),ct=O.material;ct.visible&&d.push(O,et,ct,me,fe.z,null)}}else if((O.isMesh||O.isLine||O.isPoints)&&(O.isSkinnedMesh&&O.skeleton.frame!==ae.render.frame&&(O.skeleton.update(),O.skeleton.frame=ae.render.frame),!O.frustumCulled||J.intersectsObject(O))){ne&&fe.setFromMatrixPosition(O.matrixWorld).applyMatrix4(de);const et=xe.update(O),ct=O.material;if(Array.isArray(ct)){const rt=et.groups;for(let Mt=0,ft=rt.length;Mt<ft;Mt++){const _t=rt[Mt],Kt=ct[_t.materialIndex];Kt&&Kt.visible&&d.push(O,et,Kt,me,fe.z,_t)}}else ct.visible&&d.push(O,et,ct,me,fe.z,null)}}const We=O.children;for(let et=0,ct=We.length;et<ct;et++)wn(We[et],ie,me,ne)}u(wn,"projectObject");function Nn(O,ie,me,ne){const ye=O.opaque,We=O.transmissive,et=O.transparent;f.setupLightsView(me),We.length>0&&$r(ye,ie,me),ne&&se.viewport(C.copy(ne)),ye.length>0&&Ht(ye,ie,me),We.length>0&&Ht(We,ie,me),et.length>0&&Ht(et,ie,me),se.buffers.depth.setTest(!0),se.buffers.depth.setMask(!0),se.buffers.color.setMask(!0),se.setPolygonOffset(!1)}u(Nn,"renderScene");function $r(O,ie,me){const ne=te.isWebGL2;Z===null&&(Z=new Rn(1,1,{generateMipmaps:!0,type:$.has("EXT_color_buffer_half_float")?Za:Lo,minFilter:cu,samples:ne&&r===!0?4:0})),m.getDrawingBufferSize(Y),ne?Z.setSize(Y.x,Y.y):Z.setSize(Pd(Y.x),Pd(Y.y));const ye=m.getRenderTarget();m.setRenderTarget(Z),m.clear();const We=m.toneMapping;m.toneMapping=As,Ht(O,ie,me),m.toneMapping=We,L.updateMultisampleRenderTarget(Z),L.updateRenderTargetMipmap(Z),m.setRenderTarget(ye)}u($r,"renderTransmissionPass");function Ht(O,ie,me){const ne=ie.isScene===!0?ie.overrideMaterial:null;for(let ye=0,We=O.length;ye<We;ye++){const et=O[ye],ct=et.object,rt=et.geometry,Mt=ne===null?et.material:ne,ft=et.group;ct.layers.test(me.layers)&&Ps(ct,ie,me,rt,Mt,ft)}}u(Ht,"renderObjects");function Ps(O,ie,me,ne,ye,We){O.onBeforeRender(m,ie,me,ne,ye,We),O.modelViewMatrix.multiplyMatrices(me.matrixWorldInverse,O.matrixWorld),O.normalMatrix.getNormalMatrix(O.modelViewMatrix),ye.onBeforeRender(m,ie,me,ne,O,We),ye.transparent===!0&&ye.side===Ui?(ye.side=Vi,ye.needsUpdate=!0,m.renderBufferDirect(me,ie,ne,ye,O,We),ye.side=Xa,ye.needsUpdate=!0,m.renderBufferDirect(me,ie,ne,ye,O,We),ye.side=Ui):m.renderBufferDirect(me,ie,ne,ye,O,We),O.onAfterRender(m,ie,me,ne,ye,We)}u(Ps,"renderObject");function Di(O,ie,me){ie.isScene!==!0&&(ie=k);const ne=E.get(O),ye=f.state.lights,We=f.state.shadowsArray,et=ye.state.version,ct=le.getParameters(O,ye.state,We,ie,me),rt=le.getProgramCacheKey(ct);let Mt=ne.programs;ne.environment=O.isMeshStandardMaterial?ie.environment:null,ne.fog=ie.fog,ne.envMap=(O.isMeshStandardMaterial?K:G).get(O.envMap||ne.environment),Mt===void 0&&(O.addEventListener("dispose",It),Mt=new Map,ne.programs=Mt);let ft=Mt.get(rt);if(ft!==void 0){if(ne.currentProgram===ft&&ne.lightsStateVersion===et)return G1(O,ct),ft}else ct.uniforms=le.getUniforms(O),O.onBuild(me,ct,m),O.onBeforeCompile(ct,m),ft=le.acquireProgram(ct,rt),Mt.set(rt,ft),ne.uniforms=ct.uniforms;const _t=ne.uniforms;(!O.isShaderMaterial&&!O.isRawShaderMaterial||O.clipping===!0)&&(_t.clippingPlanes=P.uniform),G1(O,ct),ne.needsLights=OA(O),ne.lightsStateVersion=et,ne.needsLights&&(_t.ambientLightColor.value=ye.state.ambient,_t.lightProbe.value=ye.state.probe,_t.directionalLights.value=ye.state.directional,_t.directionalLightShadows.value=ye.state.directionalShadow,_t.spotLights.value=ye.state.spot,_t.spotLightShadows.value=ye.state.spotShadow,_t.rectAreaLights.value=ye.state.rectArea,_t.ltc_1.value=ye.state.rectAreaLTC1,_t.ltc_2.value=ye.state.rectAreaLTC2,_t.pointLights.value=ye.state.point,_t.pointLightShadows.value=ye.state.pointShadow,_t.hemisphereLights.value=ye.state.hemi,_t.directionalShadowMap.value=ye.state.directionalShadowMap,_t.directionalShadowMatrix.value=ye.state.directionalShadowMatrix,_t.spotShadowMap.value=ye.state.spotShadowMap,_t.spotLightMatrix.value=ye.state.spotLightMatrix,_t.spotLightMap.value=ye.state.spotLightMap,_t.pointShadowMap.value=ye.state.pointShadowMap,_t.pointShadowMatrix.value=ye.state.pointShadowMatrix);const Kt=ft.getUniforms(),Wr=Tc.seqWithValue(Kt.seq,_t);return ne.currentProgram=ft,ne.uniformsList=Wr,ft}u(Di,"getProgram");function G1(O,ie){const me=E.get(O);me.outputEncoding=ie.outputEncoding,me.instancing=ie.instancing,me.skinning=ie.skinning,me.morphTargets=ie.morphTargets,me.morphNormals=ie.morphNormals,me.morphColors=ie.morphColors,me.morphTargetsCount=ie.morphTargetsCount,me.numClippingPlanes=ie.numClippingPlanes,me.numIntersection=ie.numClipIntersection,me.vertexAlphas=ie.vertexAlphas,me.vertexTangents=ie.vertexTangents,me.toneMapping=ie.toneMapping}u(G1,"updateCommonMaterialProperties");function LA(O,ie,me,ne,ye){ie.isScene!==!0&&(ie=k),L.resetTextureUnits();const We=ie.fog,et=ne.isMeshStandardMaterial?ie.environment:null,ct=_===null?m.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:Ks,rt=(ne.isMeshStandardMaterial?K:G).get(ne.envMap||et),Mt=ne.vertexColors===!0&&!!me.attributes.color&&me.attributes.color.itemSize===4,ft=!!ne.normalMap&&!!me.attributes.tangent,_t=!!me.morphAttributes.position,Kt=!!me.morphAttributes.normal,Wr=!!me.morphAttributes.color,Yo=ne.toneMapped?m.toneMapping:As,qo=me.morphAttributes.position||me.morphAttributes.normal||me.morphAttributes.color,us=qo!==void 0?qo.length:0,St=E.get(ne),Ko=f.state.lights;if(X===!0&&(V===!0||O!==x)){const gi=O===x&&ne.id===A;P.setState(ne,O,gi)}let un=!1;ne.version===St.__version?(St.needsLights&&St.lightsStateVersion!==Ko.state.version||St.outputEncoding!==ct||ye.isInstancedMesh&&St.instancing===!1||!ye.isInstancedMesh&&St.instancing===!0||ye.isSkinnedMesh&&St.skinning===!1||!ye.isSkinnedMesh&&St.skinning===!0||St.envMap!==rt||ne.fog===!0&&St.fog!==We||St.numClippingPlanes!==void 0&&(St.numClippingPlanes!==P.numPlanes||St.numIntersection!==P.numIntersection)||St.vertexAlphas!==Mt||St.vertexTangents!==ft||St.morphTargets!==_t||St.morphNormals!==Kt||St.morphColors!==Wr||St.toneMapping!==Yo||te.isWebGL2===!0&&St.morphTargetsCount!==us)&&(un=!0):(un=!0,St.__version=ne.version);let Li=St.currentProgram;un===!0&&(Li=Di(ne,ie,ye));let ir=!1,Al=!1,kf=!1;const Xn=Li.getUniforms(),jr=St.uniforms;if(se.useProgram(Li.program)&&(ir=!0,Al=!0,kf=!0),ne.id!==A&&(A=ne.id,Al=!0),ir||x!==O){if(Xn.setValue(F,"projectionMatrix",O.projectionMatrix),te.logarithmicDepthBuffer&&Xn.setValue(F,"logDepthBufFC",2/(Math.log(O.far+1)/Math.LN2)),x!==O&&(x=O,Al=!0,kf=!0),ne.isShaderMaterial||ne.isMeshPhongMaterial||ne.isMeshToonMaterial||ne.isMeshStandardMaterial||ne.envMap){const gi=Xn.map.cameraPosition;gi!==void 0&&gi.setValue(F,fe.setFromMatrixPosition(O.matrixWorld))}(ne.isMeshPhongMaterial||ne.isMeshToonMaterial||ne.isMeshLambertMaterial||ne.isMeshBasicMaterial||ne.isMeshStandardMaterial||ne.isShaderMaterial)&&Xn.setValue(F,"isOrthographic",O.isOrthographicCamera===!0),(ne.isMeshPhongMaterial||ne.isMeshToonMaterial||ne.isMeshLambertMaterial||ne.isMeshBasicMaterial||ne.isMeshStandardMaterial||ne.isShaderMaterial||ne.isShadowMaterial||ye.isSkinnedMesh)&&Xn.setValue(F,"viewMatrix",O.matrixWorldInverse)}if(ye.isSkinnedMesh){Xn.setOptional(F,ye,"bindMatrix"),Xn.setOptional(F,ye,"bindMatrixInverse");const gi=ye.skeleton;gi&&(te.floatVertexTextures?(gi.boneTexture===null&&gi.computeBoneTexture(),Xn.setValue(F,"boneTexture",gi.boneTexture,L),Xn.setValue(F,"boneTextureSize",gi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const zf=me.morphAttributes;if((zf.position!==void 0||zf.normal!==void 0||zf.color!==void 0&&te.isWebGL2===!0)&&pe.update(ye,me,ne,Li),(Al||St.receiveShadow!==ye.receiveShadow)&&(St.receiveShadow=ye.receiveShadow,Xn.setValue(F,"receiveShadow",ye.receiveShadow)),ne.isMeshGouraudMaterial&&ne.envMap!==null&&(jr.envMap.value=rt,jr.flipEnvMap.value=rt.isCubeTexture&&rt.isRenderTargetTexture===!1?-1:1),Al&&(Xn.setValue(F,"toneMappingExposure",m.toneMappingExposure),St.needsLights&&FA(jr,kf),We&&ne.fog===!0&&_e.refreshFogUniforms(jr,We),_e.refreshMaterialUniforms(jr,ne,B,D,Z),Tc.upload(F,St.uniformsList,jr,L)),ne.isShaderMaterial&&ne.uniformsNeedUpdate===!0&&(Tc.upload(F,St.uniformsList,jr,L),ne.uniformsNeedUpdate=!1),ne.isSpriteMaterial&&Xn.setValue(F,"center",ye.center),Xn.setValue(F,"modelViewMatrix",ye.modelViewMatrix),Xn.setValue(F,"normalMatrix",ye.normalMatrix),Xn.setValue(F,"modelMatrix",ye.matrixWorld),ne.isShaderMaterial||ne.isRawShaderMaterial){const gi=ne.uniformsGroups;for(let Bf=0,NA=gi.length;Bf<NA;Bf++)if(te.isWebGL2){const $1=gi[Bf];Be.update($1,Li),Be.bind($1,Li)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Li}u(LA,"setProgram");function FA(O,ie){O.ambientLightColor.needsUpdate=ie,O.lightProbe.needsUpdate=ie,O.directionalLights.needsUpdate=ie,O.directionalLightShadows.needsUpdate=ie,O.pointLights.needsUpdate=ie,O.pointLightShadows.needsUpdate=ie,O.spotLights.needsUpdate=ie,O.spotLightShadows.needsUpdate=ie,O.rectAreaLights.needsUpdate=ie,O.hemisphereLights.needsUpdate=ie}u(FA,"markUniformsLightsNeedsUpdate");function OA(O){return O.isMeshLambertMaterial||O.isMeshToonMaterial||O.isMeshPhongMaterial||O.isMeshStandardMaterial||O.isShadowMaterial||O.isShaderMaterial&&O.lights===!0}u(OA,"materialNeedsLights"),this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(O,ie,me){E.get(O.texture).__webglTexture=ie,E.get(O.depthTexture).__webglTexture=me;const ne=E.get(O);ne.__hasExternalTextures=!0,ne.__hasExternalTextures&&(ne.__autoAllocateDepthBuffer=me===void 0,ne.__autoAllocateDepthBuffer||$.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ne.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(O,ie){const me=E.get(O);me.__webglFramebuffer=ie,me.__useDefaultFramebuffer=ie===void 0},this.setRenderTarget=function(O,ie=0,me=0){_=O,y=ie,w=me;let ne=!0,ye=null,We=!1,et=!1;if(O){const rt=E.get(O);rt.__useDefaultFramebuffer!==void 0?(se.bindFramebuffer(36160,null),ne=!1):rt.__webglFramebuffer===void 0?L.setupRenderTarget(O):rt.__hasExternalTextures&&L.rebindTextures(O,E.get(O.texture).__webglTexture,E.get(O.depthTexture).__webglTexture);const Mt=O.texture;(Mt.isData3DTexture||Mt.isDataArrayTexture||Mt.isCompressedArrayTexture)&&(et=!0);const ft=E.get(O).__webglFramebuffer;O.isWebGLCubeRenderTarget?(ye=ft[ie],We=!0):te.isWebGL2&&O.samples>0&&L.useMultisampledRTT(O)===!1?ye=E.get(O).__webglMultisampledFramebuffer:ye=ft,C.copy(O.viewport),T.copy(O.scissor),S=O.scissorTest}else C.copy(z).multiplyScalar(B).floor(),T.copy(q).multiplyScalar(B).floor(),S=ee;if(se.bindFramebuffer(36160,ye)&&te.drawBuffers&&ne&&se.drawBuffers(O,ye),se.viewport(C),se.scissor(T),se.setScissorTest(S),We){const rt=E.get(O.texture);F.framebufferTexture2D(36160,36064,34069+ie,rt.__webglTexture,me)}else if(et){const rt=E.get(O.texture),Mt=ie||0;F.framebufferTextureLayer(36160,36064,rt.__webglTexture,me||0,Mt)}A=-1},this.readRenderTargetPixels=function(O,ie,me,ne,ye,We,et){if(!(O&&O.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ct=E.get(O).__webglFramebuffer;if(O.isWebGLCubeRenderTarget&&et!==void 0&&(ct=ct[et]),ct){se.bindFramebuffer(36160,ct);try{const rt=O.texture,Mt=rt.format,ft=rt.type;if(Mt!==Ti&&we.convert(Mt)!==F.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const _t=ft===Za&&($.has("EXT_color_buffer_half_float")||te.isWebGL2&&$.has("EXT_color_buffer_float"));if(ft!==Lo&&we.convert(ft)!==F.getParameter(35738)&&!(ft===Mr&&(te.isWebGL2||$.has("OES_texture_float")||$.has("WEBGL_color_buffer_float")))&&!_t){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ie>=0&&ie<=O.width-ne&&me>=0&&me<=O.height-ye&&F.readPixels(ie,me,ne,ye,we.convert(Mt),we.convert(ft),We)}finally{const rt=_!==null?E.get(_).__webglFramebuffer:null;se.bindFramebuffer(36160,rt)}}},this.copyFramebufferToTexture=function(O,ie,me=0){const ne=Math.pow(2,-me),ye=Math.floor(ie.image.width*ne),We=Math.floor(ie.image.height*ne);L.setTexture2D(ie,0),F.copyTexSubImage2D(3553,me,0,0,O.x,O.y,ye,We),se.unbindTexture()},this.copyTextureToTexture=function(O,ie,me,ne=0){const ye=ie.image.width,We=ie.image.height,et=we.convert(me.format),ct=we.convert(me.type);L.setTexture2D(me,0),F.pixelStorei(37440,me.flipY),F.pixelStorei(37441,me.premultiplyAlpha),F.pixelStorei(3317,me.unpackAlignment),ie.isDataTexture?F.texSubImage2D(3553,ne,O.x,O.y,ye,We,et,ct,ie.image.data):ie.isCompressedTexture?F.compressedTexSubImage2D(3553,ne,O.x,O.y,ie.mipmaps[0].width,ie.mipmaps[0].height,et,ie.mipmaps[0].data):F.texSubImage2D(3553,ne,O.x,O.y,et,ct,ie.image),ne===0&&me.generateMipmaps&&F.generateMipmap(3553),se.unbindTexture()},this.copyTextureToTexture3D=function(O,ie,me,ne,ye=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const We=O.max.x-O.min.x+1,et=O.max.y-O.min.y+1,ct=O.max.z-O.min.z+1,rt=we.convert(ne.format),Mt=we.convert(ne.type);let ft;if(ne.isData3DTexture)L.setTexture3D(ne,0),ft=32879;else if(ne.isDataArrayTexture)L.setTexture2DArray(ne,0),ft=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}F.pixelStorei(37440,ne.flipY),F.pixelStorei(37441,ne.premultiplyAlpha),F.pixelStorei(3317,ne.unpackAlignment);const _t=F.getParameter(3314),Kt=F.getParameter(32878),Wr=F.getParameter(3316),Yo=F.getParameter(3315),qo=F.getParameter(32877),us=me.isCompressedTexture?me.mipmaps[0]:me.image;F.pixelStorei(3314,us.width),F.pixelStorei(32878,us.height),F.pixelStorei(3316,O.min.x),F.pixelStorei(3315,O.min.y),F.pixelStorei(32877,O.min.z),me.isDataTexture||me.isData3DTexture?F.texSubImage3D(ft,ye,ie.x,ie.y,ie.z,We,et,ct,rt,Mt,us.data):me.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),F.compressedTexSubImage3D(ft,ye,ie.x,ie.y,ie.z,We,et,ct,rt,us.data)):F.texSubImage3D(ft,ye,ie.x,ie.y,ie.z,We,et,ct,rt,Mt,us),F.pixelStorei(3314,_t),F.pixelStorei(32878,Kt),F.pixelStorei(3316,Wr),F.pixelStorei(3315,Yo),F.pixelStorei(32877,qo),ye===0&&ne.generateMipmaps&&F.generateMipmap(ft),se.unbindTexture()},this.initTexture=function(O){O.isCubeTexture?L.setTextureCube(O,0):O.isData3DTexture?L.setTexture3D(O,0):O.isDataArrayTexture||O.isCompressedArrayTexture?L.setTexture2DArray(O,0):L.setTexture2D(O,0),se.unbindTexture()},this.resetState=function(){y=0,w=0,_=null,se.reset(),ue.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}u(Dw,"WebGLRenderer");class Lw extends Dw{}u(Lw,"WebGL1Renderer");Lw.prototype.isWebGL1Renderer=!0;class Xc extends yt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.backgroundBlurriness=this.backgroundBlurriness),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}u(Xc,"Scene");const Yy=new b,qy=new gt,Ky=new gt,hL=new b,Zy=new Me;class Fw extends Ee{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Me,this.bindMatrixInverse=new Me}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new gt,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,s=this.geometry;qy.fromBufferAttribute(s.attributes.skinIndex,e),Ky.fromBufferAttribute(s.attributes.skinWeight,e),Yy.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=Ky.getComponent(r);if(o!==0){const a=qy.getComponent(r);Zy.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(hL.copy(Yy).applyMatrix4(Zy),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}u(Fw,"SkinnedMesh");class Id extends yt{constructor(){super(),this.isBone=!0,this.type="Bone"}}u(Id,"Bone");class Ow extends On{constructor(e=null,t=1,i=1,s,r,o,a,l,c=yn,h=yn,d,f){super(null,o,a,l,c,h,s,r,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(Ow,"DataTexture");const Qy=new Me,dL=new Me;class xf{constructor(e=[],t=[]){this.uuid=Ur(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Me)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Me;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:dL;Qy.multiplyMatrices(a,t[r]),Qy.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new xf(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=dw(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new Ow(t,e,e,Ti,Mr);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const r=e.bones[i];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Id),this.bones.push(o),this.boneInverses.push(new Me().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}u(xf,"Skeleton");class Wn extends $i{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ie(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}u(Wn,"LineBasicMaterial");const Jy=new b,e_=new b,t_=new Me,Cp=new Vr,th=new Vo;class gn extends yt{constructor(e=new Qe,t=new Wn){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,r=t.count;s<r;s++)Jy.fromBufferAttribute(t,s-1),e_.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=Jy.distanceTo(e_);e.setAttribute("lineDistance",new Fe(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),th.copy(i.boundingSphere),th.applyMatrix4(s),th.radius+=r,e.ray.intersectsSphere(th)===!1)return;t_.copy(s).invert(),Cp.copy(e.ray).applyMatrix4(t_);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new b,h=new b,d=new b,f=new b,p=this.isLineSegments?2:1,g=i.index,v=i.attributes.position;if(g!==null){const y=Math.max(0,o.start),w=Math.min(g.count,o.start+o.count);for(let _=y,A=w-1;_<A;_+=p){const x=g.getX(_),C=g.getX(_+1);if(c.fromBufferAttribute(v,x),h.fromBufferAttribute(v,C),Cp.distanceSqToSegment(c,h,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(f);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),w=Math.min(v.count,o.start+o.count);for(let _=y,A=w-1;_<A;_+=p){if(c.fromBufferAttribute(v,_),h.fromBufferAttribute(v,_+1),Cp.distanceSqToSegment(c,h,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const C=e.ray.origin.distanceTo(f);C<e.near||C>e.far||t.push({distance:C,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}u(gn,"Line");const n_=new b,i_=new b;class Zs extends gn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,r=t.count;s<r;s+=2)n_.fromBufferAttribute(t,s),i_.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+n_.distanceTo(i_);e.setAttribute("lineDistance",new Fe(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}u(Zs,"LineSegments");class Sr extends $i{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ie(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}u(Sr,"PointsMaterial");const s_=new Me,Hm=new Vr,nh=new Vo,ih=new b;class Va extends yt{constructor(e=new Qe,t=new Sr){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),nh.copy(i.boundingSphere),nh.applyMatrix4(s),nh.radius+=r,e.ray.intersectsSphere(nh)===!1)return;s_.copy(s).invert(),Hm.copy(e.ray).applyMatrix4(s_);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,d=i.attributes.position;if(c!==null){const f=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let g=f,m=p;g<m;g++){const v=c.getX(g);ih.fromBufferAttribute(d,v),r_(ih,v,l,s,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let g=f,m=p;g<m;g++)ih.fromBufferAttribute(d,g),r_(ih,g,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}u(Va,"Points");function r_(n,e,t,i,s,r,o){const a=Hm.distanceSqToPoint(n);if(a<t){const l=new b;Hm.closestPointToPoint(n,l),l.applyMatrix4(i);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}u(r_,"testPoint");class Bg{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),r+=i.distanceTo(s),t.push(r),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const r=i.length;let o;t?o=t:o=e*i[r-1];let a=0,l=r-1,c;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),c=i[s]-o,c<0)a=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,i[s]===o)return s/(r-1);const h=i[s],f=i[s+1]-h,p=(o-h)/f;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=t||(o.isVector2?new Ge:new b);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new b,s=[],r=[],o=[],a=new b,l=new Me;for(let p=0;p<=e;p++){const g=p/e;s[p]=this.getTangentAt(g,new b)}r[0]=new b,o[0]=new b;let c=Number.MAX_VALUE;const h=Math.abs(s[0].x),d=Math.abs(s[0].y),f=Math.abs(s[0].z);h<=c&&(c=h,i.set(1,0,0)),d<=c&&(c=d,i.set(0,1,0)),f<=c&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(s[p-1],s[p]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(Bn(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,g))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(Bn(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let g=1;g<=e;g++)r[g].applyMatrix4(l.makeRotationAxis(s[g],p*g)),o[g].crossVectors(s[g],r[g])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}u(Bg,"Curve");class Sn extends Qe{constructor(e=1,t=1,i=1,s=8,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const h=[],d=[],f=[],p=[];let g=0;const m=[],v=i/2;let y=0;w(),o===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new Fe(d,3)),this.setAttribute("normal",new Fe(f,3)),this.setAttribute("uv",new Fe(p,2));function w(){const A=new b,x=new b;let C=0;const T=(t-e)/i;for(let S=0;S<=r;S++){const I=[],D=S/r,B=D*(t-e)+e;for(let Q=0;Q<=s;Q++){const U=Q/s,z=U*l+a,q=Math.sin(z),ee=Math.cos(z);x.x=B*q,x.y=-D*i+v,x.z=B*ee,d.push(x.x,x.y,x.z),A.set(q,T,ee).normalize(),f.push(A.x,A.y,A.z),p.push(U,1-D),I.push(g++)}m.push(I)}for(let S=0;S<s;S++)for(let I=0;I<r;I++){const D=m[I][S],B=m[I+1][S],Q=m[I+1][S+1],U=m[I][S+1];h.push(D,B,U),h.push(B,Q,U),C+=6}c.addGroup(y,C,0),y+=C}u(w,"generateTorso");function _(A){const x=g,C=new Ge,T=new b;let S=0;const I=A===!0?e:t,D=A===!0?1:-1;for(let Q=1;Q<=s;Q++)d.push(0,v*D,0),f.push(0,D,0),p.push(.5,.5),g++;const B=g;for(let Q=0;Q<=s;Q++){const z=Q/s*l+a,q=Math.cos(z),ee=Math.sin(z);T.x=I*ee,T.y=v*D,T.z=I*q,d.push(T.x,T.y,T.z),f.push(0,D,0),C.x=q*.5+.5,C.y=ee*.5*D+.5,p.push(C.x,C.y),g++}for(let Q=0;Q<s;Q++){const U=x+Q,z=B+Q;A===!0?h.push(z,z+1,U):h.push(z+1,z,U),S+=3}c.addGroup(y,S,A===!0?1:2),y+=S}u(_,"generateCap")}static fromJSON(e){return new Sn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}u(Sn,"CylinderGeometry");class bf extends Sn{constructor(e=1,t=1,i=8,s=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,i,s,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new bf(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}u(bf,"ConeGeometry");class wf extends Qe{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const r=[],o=[];a(s),c(i),h(),this.setAttribute("position",new Fe(r,3)),this.setAttribute("normal",new Fe(r.slice(),3)),this.setAttribute("uv",new Fe(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(w){const _=new b,A=new b,x=new b;for(let C=0;C<t.length;C+=3)p(t[C+0],_),p(t[C+1],A),p(t[C+2],x),l(_,A,x,w)}u(a,"subdivide");function l(w,_,A,x){const C=x+1,T=[];for(let S=0;S<=C;S++){T[S]=[];const I=w.clone().lerp(A,S/C),D=_.clone().lerp(A,S/C),B=C-S;for(let Q=0;Q<=B;Q++)Q===0&&S===C?T[S][Q]=I:T[S][Q]=I.clone().lerp(D,Q/B)}for(let S=0;S<C;S++)for(let I=0;I<2*(C-S)-1;I++){const D=Math.floor(I/2);I%2===0?(f(T[S][D+1]),f(T[S+1][D]),f(T[S][D])):(f(T[S][D+1]),f(T[S+1][D+1]),f(T[S+1][D]))}}u(l,"subdivideFace");function c(w){const _=new b;for(let A=0;A<r.length;A+=3)_.x=r[A+0],_.y=r[A+1],_.z=r[A+2],_.normalize().multiplyScalar(w),r[A+0]=_.x,r[A+1]=_.y,r[A+2]=_.z}u(c,"applyRadius");function h(){const w=new b;for(let _=0;_<r.length;_+=3){w.x=r[_+0],w.y=r[_+1],w.z=r[_+2];const A=v(w)/2/Math.PI+.5,x=y(w)/Math.PI+.5;o.push(A,1-x)}g(),d()}u(h,"generateUVs");function d(){for(let w=0;w<o.length;w+=6){const _=o[w+0],A=o[w+2],x=o[w+4],C=Math.max(_,A,x),T=Math.min(_,A,x);C>.9&&T<.1&&(_<.2&&(o[w+0]+=1),A<.2&&(o[w+2]+=1),x<.2&&(o[w+4]+=1))}}u(d,"correctSeam");function f(w){r.push(w.x,w.y,w.z)}u(f,"pushVertex");function p(w,_){const A=w*3;_.x=e[A+0],_.y=e[A+1],_.z=e[A+2]}u(p,"getVertexByIndex");function g(){const w=new b,_=new b,A=new b,x=new b,C=new Ge,T=new Ge,S=new Ge;for(let I=0,D=0;I<r.length;I+=9,D+=6){w.set(r[I+0],r[I+1],r[I+2]),_.set(r[I+3],r[I+4],r[I+5]),A.set(r[I+6],r[I+7],r[I+8]),C.set(o[D+0],o[D+1]),T.set(o[D+2],o[D+3]),S.set(o[D+4],o[D+5]),x.copy(w).add(_).add(A).divideScalar(3);const B=v(x);m(C,D+0,w,B),m(T,D+2,_,B),m(S,D+4,A,B)}}u(g,"correctUVs");function m(w,_,A,x){x<0&&w.x===1&&(o[_]=w.x-1),A.x===0&&A.z===0&&(o[_]=x/2/Math.PI+.5)}u(m,"correctUV");function v(w){return Math.atan2(w.z,-w.x)}u(v,"azimuth");function y(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}u(y,"inclination")}static fromJSON(e){return new wf(e.vertices,e.indices,e.radius,e.details)}}u(wf,"PolyhedronGeometry");class Ar extends wf{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Ar(e.radius,e.detail)}}u(Ar,"OctahedronGeometry");class hu extends Qe{constructor(e=1,t=32,i=16,s=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const h=[],d=new b,f=new b,p=[],g=[],m=[],v=[];for(let y=0;y<=i;y++){const w=[],_=y/i;let A=0;y==0&&o==0?A=.5/t:y==i&&l==Math.PI&&(A=-.5/t);for(let x=0;x<=t;x++){const C=x/t;d.x=-e*Math.cos(s+C*r)*Math.sin(o+_*a),d.y=e*Math.cos(o+_*a),d.z=e*Math.sin(s+C*r)*Math.sin(o+_*a),g.push(d.x,d.y,d.z),f.copy(d).normalize(),m.push(f.x,f.y,f.z),v.push(C+A,1-_),w.push(c++)}h.push(w)}for(let y=0;y<i;y++)for(let w=0;w<t;w++){const _=h[y][w+1],A=h[y][w],x=h[y+1][w],C=h[y+1][w+1];(y!==0||o>0)&&p.push(_,A,C),(y!==i-1||l<Math.PI)&&p.push(A,x,C)}this.setIndex(p),this.setAttribute("position",new Fe(g,3)),this.setAttribute("normal",new Fe(m,3)),this.setAttribute("uv",new Fe(v,2))}static fromJSON(e){return new hu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}u(hu,"SphereGeometry$1");class wr extends Qe{constructor(e=1,t=.4,i=8,s=6,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:r},i=Math.floor(i),s=Math.floor(s);const o=[],a=[],l=[],c=[],h=new b,d=new b,f=new b;for(let p=0;p<=i;p++)for(let g=0;g<=s;g++){const m=g/s*r,v=p/i*Math.PI*2;d.x=(e+t*Math.cos(v))*Math.cos(m),d.y=(e+t*Math.cos(v))*Math.sin(m),d.z=t*Math.sin(v),a.push(d.x,d.y,d.z),h.x=e*Math.cos(m),h.y=e*Math.sin(m),f.subVectors(d,h).normalize(),l.push(f.x,f.y,f.z),c.push(g/s),c.push(p/i)}for(let p=1;p<=i;p++)for(let g=1;g<=s;g++){const m=(s+1)*p+g-1,v=(s+1)*(p-1)+g-1,y=(s+1)*(p-1)+g,w=(s+1)*p+g;o.push(m,v,w),o.push(v,y,w)}this.setIndex(o),this.setAttribute("position",new Fe(a,3)),this.setAttribute("normal",new Fe(l,3)),this.setAttribute("uv",new Fe(c,2))}static fromJSON(e){return new wr(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}u(wr,"TorusGeometry");class Mf extends $i{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ie(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ie(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ff,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(Mf,"MeshStandardMaterial");class Ec extends $i{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ie(16777215),this.specular=new Ie(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ie(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ff,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hf,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(Ec,"MeshPhongMaterial");class Ug extends $i{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ie(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ie(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ff,this.normalScale=new Ge(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=hf,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(Ug,"MeshLambertMaterial");function fr(n,e,t){return Nw(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)}u(fr,"arraySlice");function sh(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}u(sh,"convertArray");function Nw(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}u(Nw,"isTypedArray");function fL(n){function e(s,r){return n[s]-n[r]}u(e,"compareTime");const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}u(fL,"getKeyframeOrder");function o_(n,e,t){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=n[a+l]}return s}u(o_,"sortedArray");function kw(n,e,t,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(e.push(r.time),t.push(o)),r=n[s++];while(r!==void 0)}u(kw,"flattenJSON");class du{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],r=t[i-1];n:{e:{let o;t:{i:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<r)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=t[++i],e<s)break e}o=t.length;break t}if(!(e>=r)){const a=t[1];e<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=t[--i-1],e>=r)break e}o=i,i=0;break t}break n}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(s=t[i],r=t[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=i[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}u(du,"Interpolant");class zw extends du{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:hy,endingEnd:hy}}intervalChanged_(e,t,i){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case dy:r=e,a=2*t-i;break;case fy:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case dy:o=e,l=2*i-t;break;case fy:o=1,l=i+s[1]-s[0];break;default:o=e-1,l=t}const c=(i-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,g=(i-t)/(s-t),m=g*g,v=m*g,y=-f*v+2*f*m-f*g,w=(1+f)*v+(-1.5-2*f)*m+(-.5+f)*g+1,_=(-1-p)*v+(1.5+p)*m+.5*g,A=p*v-p*m;for(let x=0;x!==a;++x)r[x]=y*o[h+x]+w*o[c+x]+_*o[l+x]+A*o[d+x];return r}}u(zw,"CubicInterpolant");class Bw extends du{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(i-t)/(s-t),d=1-h;for(let f=0;f!==a;++f)r[f]=o[c+f]*d+o[l+f]*h;return r}}u(Bw,"LinearInterpolant");class Uw extends du{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}u(Uw,"DiscreteInterpolant");class cs{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=sh(t,this.TimeBufferType),this.values=sh(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:sh(e.times,Array),values:sh(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Uw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Bw(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new zw(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Gc:t=this.InterpolantFactoryMethodDiscrete;break;case $c:t=this.InterpolantFactoryMethodLinear;break;case ep:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Gc;case this.InterpolantFactoryMethodLinear:return $c;case this.InterpolantFactoryMethodSmooth:return ep}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<e;)++r;for(;o!==-1&&i[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=fr(i,r,o),this.values=fr(this.values,r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(s!==void 0&&Nw(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=fr(this.times),t=fr(this.values),i=this.getValueSize(),s=this.getInterpolation()===ep,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(s)l=!0;else{const d=a*i,f=d-i,p=d+i;for(let g=0;g!==i;++g){const m=t[d+g];if(m!==t[f+g]||m!==t[p+g]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,f=o*i;for(let p=0;p!==i;++p)t[f+p]=t[d+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=fr(e,0,o),this.values=fr(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=fr(this.times,0),t=fr(this.values,0),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}u(cs,"KeyframeTrack");cs.prototype.TimeBufferType=Float32Array;cs.prototype.ValueBufferType=Float32Array;cs.prototype.DefaultInterpolation=$c;class Go extends cs{}u(Go,"BooleanKeyframeTrack");Go.prototype.ValueTypeName="bool";Go.prototype.ValueBufferType=Array;Go.prototype.DefaultInterpolation=Gc;Go.prototype.InterpolantFactoryMethodLinear=void 0;Go.prototype.InterpolantFactoryMethodSmooth=void 0;class Vg extends cs{}u(Vg,"ColorKeyframeTrack");Vg.prototype.ValueTypeName="color";class el extends cs{}u(el,"NumberKeyframeTrack");el.prototype.ValueTypeName="number";class Vw extends du{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(s-t);let c=e*a;for(let h=c+a;c!==h;c+=4)Ve.slerpFlat(r,0,o,c-a,o,c,l);return r}}u(Vw,"QuaternionLinearInterpolant");class $o extends cs{InterpolantFactoryMethodLinear(e){return new Vw(this.times,this.values,this.getValueSize(),e)}}u($o,"QuaternionKeyframeTrack");$o.prototype.ValueTypeName="quaternion";$o.prototype.DefaultInterpolation=$c;$o.prototype.InterpolantFactoryMethodSmooth=void 0;class Wo extends cs{}u(Wo,"StringKeyframeTrack");Wo.prototype.ValueTypeName="string";Wo.prototype.ValueBufferType=Array;Wo.prototype.DefaultInterpolation=Gc;Wo.prototype.InterpolantFactoryMethodLinear=void 0;Wo.prototype.InterpolantFactoryMethodSmooth=void 0;class tl extends cs{}u(tl,"VectorKeyframeTrack");tl.prototype.ValueTypeName="vector";class Hw{constructor(e,t=-1,i,s=uE){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Ur(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(mL(i[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=i.length;r!==o;++r)t.push(cs.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=fL(l);l=o_(l,1,h),c=o_(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new el(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const d=h[1];let f=s[d];f||(s[d]=f=[]),f.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=u(function(d,f,p,g,m){if(p.length!==0){const v=[],y=[];kw(p,v,y,g),v.length!==0&&m.push(new d(f,v,y))}},"addNonemptyTrack"),s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const f=c[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let g;for(g=0;g<f.length;g++)if(f[g].morphTargets)for(let m=0;m<f[g].morphTargets.length;m++)p[f[g].morphTargets[m]]=-1;for(const m in p){const v=[],y=[];for(let w=0;w!==f[g].morphTargets.length;++w){const _=f[g];v.push(_.time),y.push(_.morphTarget===m?1:0)}s.push(new el(".morphTargetInfluence["+m+"]",v,y))}l=p.length*o}else{const p=".bones["+t[d].name+"]";i(tl,p+".position",f,"pos",s),i($o,p+".quaternion",f,"rot",s),i(tl,p+".scale",f,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const r=this.tracks[i];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}u(Hw,"AnimationClip");function pL(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return el;case"vector":case"vector2":case"vector3":case"vector4":return tl;case"color":return Vg;case"quaternion":return $o;case"bool":case"boolean":return Go;case"string":return Wo}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}u(pL,"getTrackTypeForValueTypeName");function mL(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=pL(n.type);if(n.times===void 0){const t=[],i=[];kw(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}u(mL,"parseKeyframeTrack");const Rd={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Gw{constructor(e,t,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,f=c.length;d<f;d+=2){const p=c[d],g=c[d+1];if(p.global&&(p.lastIndex=0),p.test(h))return g}return null}}}u(Gw,"LoadingManager");const gL=new Gw;class fl{constructor(e){this.manager=e!==void 0?e:gL,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,r){i.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}u(fl,"Loader");const Ns={};class $w extends Error{constructor(e,t){super(e),this.response=t}}u($w,"HttpError");class Hg extends fl{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Rd.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Ns[e]!==void 0){Ns[e].push({onLoad:t,onProgress:i,onError:s});return}Ns[e]=[],Ns[e].push({onLoad:t,onProgress:i,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||c.body===void 0||c.body.getReader===void 0)return c;const h=Ns[e],d=c.body.getReader(),f=c.headers.get("Content-Length"),p=f?parseInt(f):0,g=p!==0;let m=0;const v=new ReadableStream({start(y){w();function w(){d.read().then(({done:_,value:A})=>{if(_)y.close();else{m+=A.byteLength;const x=new ProgressEvent("progress",{lengthComputable:g,loaded:m,total:p});for(let C=0,T=h.length;C<T;C++){const S=h[C];S.onProgress&&S.onProgress(x)}y.enqueue(A),w()}})}u(w,"readData")}});return new Response(v)}else throw new $w(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{Rd.add(e,c);const h=Ns[e];delete Ns[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=Ns[e];if(h===void 0)throw this.manager.itemError(e),c;delete Ns[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}u(Hg,"FileLoader");class Ww extends fl{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Rd.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=jc("img");function l(){h(),Rd.add(e,this),t&&t(this),r.manager.itemEnd(e)}u(l,"onImageLoad");function c(d){h(),s&&s(d),r.manager.itemError(e),r.manager.itemEnd(e)}u(c,"onImageError");function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return u(h,"removeEventListeners"),a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}u(Ww,"ImageLoader");class Gg extends fl{constructor(e){super(e)}load(e,t,i,s){const r=new On,o=new Ww(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},i,s),r}}u(Gg,"TextureLoader");class pl extends yt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ie(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}u(pl,"Light");class jw extends pl{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(yt.DefaultUp),this.updateMatrix(),this.groundColor=new Ie(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}u(jw,"HemisphereLight");const Tp=new Me,a_=new b,l_=new b;class Sf{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ge(512,512),this.map=null,this.mapPass=null,this.matrix=new Me,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new uu,this._frameExtents=new Ge(1,1),this._viewportCount=1,this._viewports=[new gt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;a_.setFromMatrixPosition(e.matrixWorld),t.position.copy(a_),l_.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(l_),t.updateMatrixWorld(),Tp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Tp),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Tp)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}u(Sf,"LightShadow");class Xw extends Sf{constructor(){super(new Dn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=Wc*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}u(Xw,"SpotLightShadow");class $g extends pl{constructor(e,t,i=0,s=Math.PI/3,r=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(yt.DefaultUp),this.updateMatrix(),this.target=new yt,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new Xw}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}u($g,"SpotLight");const c_=new Me,Ll=new b,Ep=new b;class Yw extends Sf{constructor(){super(new Dn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ge(4,2),this._viewportCount=6,this._viewports=[new gt(2,1,1,1),new gt(0,1,1,1),new gt(3,1,1,1),new gt(1,1,1,1),new gt(3,0,1,1),new gt(1,0,1,1)],this._cubeDirections=[new b(1,0,0),new b(-1,0,0),new b(0,0,1),new b(0,0,-1),new b(0,1,0),new b(0,-1,0)],this._cubeUps=[new b(0,1,0),new b(0,1,0),new b(0,1,0),new b(0,1,0),new b(0,0,1),new b(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Ll.setFromMatrixPosition(e.matrixWorld),i.position.copy(Ll),Ep.copy(i.position),Ep.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Ep),i.updateMatrixWorld(),s.makeTranslation(-Ll.x,-Ll.y,-Ll.z),c_.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(c_)}}u(Yw,"PointLightShadow");class Dd extends pl{constructor(e,t,i=0,s=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new Yw}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}u(Dd,"PointLight");class qw extends Sf{constructor(){super(new Ho(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}u(qw,"DirectionalLightShadow");class Af extends pl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(yt.DefaultUp),this.updateMatrix(),this.target=new yt,this.shadow=new qw}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}u(Af,"DirectionalLight");class Cf extends pl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}u(Cf,"AmbientLight");class Tf{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}u(Tf,"LoaderUtils");class Kw{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=u_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=u_();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}u(Kw,"Clock");function u_(){return(typeof performance=="undefined"?Date:performance).now()}u(u_,"now");const Wg="\\[\\]\\.:\\/",vL=new RegExp("["+Wg+"]","g"),jg="[^"+Wg+"]",yL="[^"+Wg.replace("\\.","")+"]",_L=/((?:WC+[\/:])*)/.source.replace("WC",jg),xL=/(WCOD+)?/.source.replace("WCOD",yL),bL=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",jg),wL=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",jg),ML=new RegExp("^"+_L+xL+bL+wL+"$"),SL=["material","materials","bones","map"];class Zw{constructor(e,t,i){const s=i||dt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}u(Zw,"Composite");class dt{constructor(e,t,i){this.path=t,this.parsedPath=i||dt.parseTrackName(t),this.node=dt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new dt.Composite(e,t,i):new dt(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(vL,"")}static parseTrackName(e){const t=ML.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);SL.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=u(function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},"searchNodeSubtree"),s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=dt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}u(dt,"PropertyBinding");dt.Composite=Zw;dt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};dt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};dt.prototype.GetterByBindingType=[dt.prototype._getValue_direct,dt.prototype._getValue_array,dt.prototype._getValue_arrayElement,dt.prototype._getValue_toArray];dt.prototype.SetterByBindingTypeAndVersioning=[[dt.prototype._setValue_direct,dt.prototype._setValue_direct_setNeedsUpdate,dt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[dt.prototype._setValue_array,dt.prototype._setValue_array_setNeedsUpdate,dt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[dt.prototype._setValue_arrayElement,dt.prototype._setValue_arrayElement_setNeedsUpdate,dt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[dt.prototype._setValue_fromArray,dt.prototype._setValue_fromArray_setNeedsUpdate,dt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Xg{constructor(e,t,i=0,s=1/0){this.ray=new Vr(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new mf,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return Gm(e,this,i,t),i.sort(h_),i}intersectObjects(e,t=!0,i=[]){for(let s=0,r=e.length;s<r;s++)Gm(e[s],this,i,t);return i.sort(h_),i}}u(Xg,"Raycaster");function h_(n,e){return n.distance-e.distance}u(h_,"ascSort");function Gm(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),i===!0){const s=n.children;for(let r=0,o=s.length;r<o;r++)Gm(s[r],e,t,!0)}}u(Gm,"intersectObject");const d_=new b;class Qw extends yt{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new Qe,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}i.setAttribute("position",new Fe(s,3));const r=new Wn({fog:!1,toneMapped:!1});this.cone=new Zs(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),d_.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(d_),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}u(Qw,"SpotLightHelper");class Jw extends Ee{constructor(e,t,i){const s=new hu(t,4,2),r=new tr({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}u(Jw,"PointLightHelper");const AL=new b,f_=new Ie,p_=new Ie;class eM extends yt{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const s=new Ar(t);s.rotateY(Math.PI*.5),this.material=new tr({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new fn(o,3)),this.add(new Ee(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");f_.copy(this.light.color),p_.copy(this.light.groundColor);for(let i=0,s=t.count;i<s;i++){const r=i<s/2?f_:p_;t.setXYZ(i,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(AL.setFromMatrixPosition(this.light.matrixWorld).negate())}}u(eM,"HemisphereLightHelper");const m_=new b,rh=new b,g_=new b;class tM extends yt{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,t===void 0&&(t=1);let s=new Qe;s.setAttribute("position",new Fe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Wn({fog:!1,toneMapped:!1});this.lightPlane=new gn(s,r),this.add(this.lightPlane),s=new Qe,s.setAttribute("position",new Fe([0,0,0,0,0,1],3)),this.targetLine=new gn(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){m_.setFromMatrixPosition(this.light.matrixWorld),rh.setFromMatrixPosition(this.light.target.matrixWorld),g_.subVectors(rh,m_),this.lightPlane.lookAt(rh),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(rh),this.targetLine.scale.z=g_.length()}}u(tM,"DirectionalLightHelper");const oh=new b,Zt=new yf;class nM extends Zs{constructor(e){const t=new Qe,i=new Wn({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(g,m){l(g),l(m)}u(a,"addLine");function l(g){s.push(0,0,0),r.push(0,0,0),o[g]===void 0&&(o[g]=[]),o[g].push(s.length/3-1)}u(l,"addPoint"),t.setAttribute("position",new Fe(s,3)),t.setAttribute("color",new Fe(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new Ie(16755200),h=new Ie(16711680),d=new Ie(43775),f=new Ie(16777215),p=new Ie(3355443);this.setColors(c,h,d,f,p)}setColors(e,t,i,s,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,s=1;Zt.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Jt("c",t,e,Zt,0,0,-1),Jt("t",t,e,Zt,0,0,1),Jt("n1",t,e,Zt,-i,-s,-1),Jt("n2",t,e,Zt,i,-s,-1),Jt("n3",t,e,Zt,-i,s,-1),Jt("n4",t,e,Zt,i,s,-1),Jt("f1",t,e,Zt,-i,-s,1),Jt("f2",t,e,Zt,i,-s,1),Jt("f3",t,e,Zt,-i,s,1),Jt("f4",t,e,Zt,i,s,1),Jt("u1",t,e,Zt,i*.7,s*1.1,-1),Jt("u2",t,e,Zt,-i*.7,s*1.1,-1),Jt("u3",t,e,Zt,0,s*2,-1),Jt("cf1",t,e,Zt,-i,0,1),Jt("cf2",t,e,Zt,i,0,1),Jt("cf3",t,e,Zt,0,-s,1),Jt("cf4",t,e,Zt,0,s,1),Jt("cn1",t,e,Zt,-i,0,-1),Jt("cn2",t,e,Zt,i,0,-1),Jt("cn3",t,e,Zt,0,-s,-1),Jt("cn4",t,e,Zt,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}u(nM,"CameraHelper");function Jt(n,e,t,i,s,r,o){oh.set(s,r,o).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],oh.x,oh.y,oh.z)}}u(Jt,"setPoint");typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Rg}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Rg);class Ef{constructor(){this.pluginCallbacks=[],this.register(function(e){return new rM(e)}),this.register(function(e){return new oM(e)}),this.register(function(e){return new aM(e)}),this.register(function(e){return new uM(e)}),this.register(function(e){return new hM(e)}),this.register(function(e){return new lM(e)}),this.register(function(e){return new cM(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){const r=new sM,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,s).catch(i)}parseAsync(e,t){const i=this;return new Promise(function(s,r){i.parse(e,s,r,t)})}}u(Ef,"GLTFExporter");const Et={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Pi={};Pi[yn]=Et.NEAREST;Pi[Nm]=Et.NEAREST_MIPMAP_NEAREST;Pi[km]=Et.NEAREST_MIPMAP_LINEAR;Pi[Ci]=Et.LINEAR;Pi[cw]=Et.LINEAR_MIPMAP_NEAREST;Pi[cu]=Et.LINEAR_MIPMAP_LINEAR;Pi[pi]=Et.CLAMP_TO_EDGE;Pi[Ka]=Et.REPEAT;Pi[Ed]=Et.MIRRORED_REPEAT;const v_={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},y_=12,CL=1179937895,TL=2,__=8,EL=1313821514,PL=5130562;function gc(n,e){return n.length===e.length&&n.every(function(t,i){return t===e[i]})}u(gc,"equalArray");function IL(n){return new TextEncoder().encode(n).buffer}u(IL,"stringToArrayBuffer");function RL(n){return gc(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}u(RL,"isIdentityMatrix");function DL(n,e,t){const i={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+t;s++)for(let r=0;r<n.itemSize;r++){let o;n.itemSize>4?o=n.array[s*n.itemSize+r]:r===0?o=n.getX(s):r===1?o=n.getY(s):r===2?o=n.getZ(s):r===3&&(o=n.getW(s)),i.min[r]=Math.min(i.min[r],o),i.max[r]=Math.max(i.max[r],o)}return i}u(DL,"getMinMax");function iM(n){return Math.ceil(n/4)*4}u(iM,"getPaddedBufferSize");function Pp(n,e=0){const t=iM(n.byteLength);if(t!==n.byteLength){const i=new Uint8Array(t);if(i.set(new Uint8Array(n)),e!==0)for(let s=n.byteLength;s<t;s++)i[s]=e;return i.buffer}return n}u(Pp,"getPaddedArrayBuffer");function x_(){return typeof document=="undefined"&&typeof OffscreenCanvas!="undefined"?new OffscreenCanvas(1,1):document.createElement("canvas")}u(x_,"getCanvas");function b_(n,e){if(n.toBlob!==void 0)return new Promise(i=>n.toBlob(i,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}u(b_,"getToBlobPromise");class sM{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,i){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},i),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,r=s.buffers,o=s.json;i=s.options;const a=s.extensionsUsed,l=new Blob(r,{type:"application/octet-stream"}),c=Object.keys(a);if(c.length>0&&(o.extensionsUsed=c),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),i.binary===!0){const h=new FileReader;h.readAsArrayBuffer(l),h.onloadend=function(){const d=Pp(h.result),f=new DataView(new ArrayBuffer(__));f.setUint32(0,d.byteLength,!0),f.setUint32(4,PL,!0);const p=Pp(IL(JSON.stringify(o)),32),g=new DataView(new ArrayBuffer(__));g.setUint32(0,p.byteLength,!0),g.setUint32(4,EL,!0);const m=new ArrayBuffer(y_),v=new DataView(m);v.setUint32(0,CL,!0),v.setUint32(4,TL,!0);const y=y_+g.byteLength+p.byteLength+f.byteLength+d.byteLength;v.setUint32(8,y,!0);const w=new Blob([m,g,p,f,d],{type:"application/octet-stream"}),_=new FileReader;_.readAsArrayBuffer(w),_.onloadend=function(){t(_.result)}}}else if(o.buffers&&o.buffers.length>0){const h=new FileReader;h.readAsDataURL(l),h.onloadend=function(){const d=h.result;o.buffers[0].uri=d,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const i=this.options,s=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(i.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],s[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new b;for(let s=0,r=e.count;s<r;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const i=e.clone(),s=new b;for(let r=0,o=i.count;r<o;r++)s.fromBufferAttribute(i,r),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),i.setXYZ(r,s.x,s.y,s.z);return t.attributesNormalized.set(e,i),i}applyTextureTransform(e,t){let i=!1;const s={};(t.offset.x!==0||t.offset.y!==0)&&(s.offset=t.offset.toArray(),i=!0),t.rotation!==0&&(s.rotation=t.rotation,i=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(s.scale=t.repeat.toArray(),i=!0),i&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function i(p){return p.encoding===Dt?u(function(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)},"SRGBToLinear"):u(function(m){return m},"LinearToLinear")}u(i,"getEncodingConversion"),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const s=e==null?void 0:e.image,r=t==null?void 0:t.image,o=Math.max((s==null?void 0:s.width)||0,(r==null?void 0:r.width)||0),a=Math.max((s==null?void 0:s.height)||0,(r==null?void 0:r.height)||0),l=x_();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const h=c.getImageData(0,0,o,a);if(s){c.drawImage(s,0,0,o,a);const p=i(e),g=c.getImageData(0,0,o,a).data;for(let m=2;m<g.length;m+=4)h.data[m]=p(g[m]/256)*256}if(r){c.drawImage(r,0,0,o,a);const p=i(t),g=c.getImageData(0,0,o,a).data;for(let m=1;m<g.length;m+=4)h.data[m]=p(g[m]/256)*256}c.putImageData(h,0,0);const f=(e||t).clone();return f.source=new pf(l),f.encoding=Ks,f}processBuffer(e){const t=this.json,i=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),i.push(e),0}processBufferView(e,t,i,s,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;t===Et.UNSIGNED_BYTE?a=1:t===Et.UNSIGNED_SHORT?a=2:a=4;const l=iM(s*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let h=0;for(let p=i;p<i+s;p++)for(let g=0;g<e.itemSize;g++){let m;e.itemSize>4?m=e.array[p*e.itemSize+g]:g===0?m=e.getX(p):g===1?m=e.getY(p):g===2?m=e.getZ(p):g===3&&(m=e.getW(p)),t===Et.FLOAT?c.setFloat32(h,m,!0):t===Et.UNSIGNED_INT?c.setUint32(h,m,!0):t===Et.UNSIGNED_SHORT?c.setUint16(h,m,!0):t===Et.UNSIGNED_BYTE&&c.setUint8(h,m),h+=a}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(d.target=r),r===Et.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,i=t.json;return i.bufferViews||(i.bufferViews=[]),new Promise(function(s){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=Pp(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,s(i.bufferViews.push(a)-1)}})}processAccessor(e,t,i,s){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Et.FLOAT;else if(e.array.constructor===Uint32Array)a=Et.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)a=Et.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)a=Et.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(i===void 0&&(i=0),s===void 0&&(s=e.count),s===0)return null;const l=DL(e,i,s);let c;t!==void 0&&(c=e===t.index?Et.ELEMENT_ARRAY_BUFFER:Et.ARRAY_BUFFER);const h=this.processBufferView(e,a,i,s,c),d={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:s,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(e,t,i,s="image/png"){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),d=s+":flipY/"+i.toString();if(h[d]!==void 0)return h[d];a.images||(a.images=[]);const f={mimeType:s},p=x_();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const g=p.getContext("2d");if(i===!0&&(g.translate(0,p.height),g.scale(1,-1)),e.data!==void 0){t!==Ti&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const v=new Uint8ClampedArray(e.height*e.width*4);for(let y=0;y<v.length;y+=4)v[y+0]=e.data[y+0],v[y+1]=e.data[y+1],v[y+2]=e.data[y+2],v[y+3]=e.data[y+3];g.putImageData(new ImageData(v,e.width,e.height),0,0)}else g.drawImage(e,0,0,p.width,p.height);l.binary===!0?c.push(b_(p,s).then(v=>r.processBufferViewImage(v)).then(v=>{f.bufferView=v})):p.toDataURL!==void 0?f.uri=p.toDataURL(s):c.push(b_(p,s).then(v=>new FileReader().readAsDataURL(v)).then(v=>{f.uri=v}));const m=a.images.push(f)-1;return h[d]=m,m}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const i={magFilter:Pi[e.magFilter],minFilter:Pi[e.minFilter],wrapS:Pi[e.wrapS],wrapT:Pi[e.wrapT]};return t.samplers.push(i)-1}processTexture(e){const t=this.cache,i=this.json;if(t.textures.has(e))return t.textures.get(e);i.textures||(i.textures=[]);let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(r.name=e.name),this._invokeAll(function(a){a.writeTexture&&a.writeTexture(e,r)});const o=i.textures.push(r)-1;return t.textures.set(e,o),o}processMaterial(e){const t=this.cache,i=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;i.materials||(i.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(gc(r,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(a)};this.applyTextureTransform(l,a),s.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){const a={index:this.processTexture(e.map)};this.applyTextureTransform(a,e.map),s.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive.clone().multiplyScalar(e.emissiveIntensity),l=Math.max(a.r,a.g,a.b);if(l>1&&(a.multiplyScalar(1/l),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),l>0&&(s.emissiveFactor=a.toArray()),e.emissiveMap){const c={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(c,e.emissiveMap),s.emissiveTexture=c}}if(e.normalMap){const a={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),s.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),s.occlusionTexture=a}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===Ui&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,s)});const o=i.materials.push(s)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,i=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,A=e.material.length;_<A;_++)s.push(e.material[_].uuid);else s.push(e.material.uuid);const r=s.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let a;e.isLineSegments?a=Et.LINES:e.isLineLoop?a=Et.LINE_LOOP:e.isLine?a=Et.LINE_STRIP:e.isPoints?a=Et.POINTS:a=e.material.wireframe?Et.LINES:Et.TRIANGLES;const l={},c={},h=[],d=[],f={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let g=null;for(let _ in o.attributes){if(_.slice(0,5)==="morph")continue;const A=o.attributes[_];if(_=f[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),t.attributes.has(this.getUID(A))){c[_]=t.attributes.get(this.getUID(A));continue}g=null;const C=A.array;_==="JOINTS_0"&&!(C instanceof Uint16Array)&&!(C instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new fn(new Uint16Array(C),A.itemSize,A.normalized));const T=this.processAccessor(g||A,o);T!==null&&(c[_]=T,t.attributes.set(this.getUID(A),T))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],A=[],x={};if(e.morphTargetDictionary!==void 0)for(const C in e.morphTargetDictionary)x[e.morphTargetDictionary[C]]=C;for(let C=0;C<e.morphTargetInfluences.length;++C){const T={};let S=!1;for(const I in o.morphAttributes){if(I!=="position"&&I!=="normal"){S||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),S=!0);continue}const D=o.morphAttributes[I][C],B=I.toUpperCase(),Q=o.attributes[I];if(t.attributes.has(this.getUID(D,!0))){T[B]=t.attributes.get(this.getUID(D,!0));continue}const U=D.clone();if(!o.morphTargetsRelative)for(let z=0,q=D.count;z<q;z++)U.setXYZ(z,D.getX(z)-Q.getX(z),D.getY(z)-Q.getY(z),D.getZ(z)-Q.getZ(z));T[B]=this.processAccessor(U,o),t.attributes.set(this.getUID(Q,!0),T[B])}d.push(T),_.push(e.morphTargetInfluences[C]),e.morphTargetDictionary!==void 0&&A.push(x[C])}l.weights=_,A.length>0&&(l.extras={},l.extras.targetNames=A)}const m=Array.isArray(e.material);if(m&&o.groups.length===0)return null;const v=m?e.material:[e.material],y=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,A=y.length;_<A;_++){const x={mode:a,attributes:c};if(this.serializeUserData(o,x),d.length>0&&(x.targets=d),o.index!==null){let T=this.getUID(o.index);(y[_].start!==void 0||y[_].count!==void 0)&&(T+=":"+y[_].start+":"+y[_].count),t.attributes.has(T)?x.indices=t.attributes.get(T):(x.indices=this.processAccessor(o.index,o,y[_].start,y[_].count),t.attributes.set(T,x.indices)),x.indices===null&&delete x.indices}const C=this.processMaterial(v[y[_].materialIndex]);C!==null&&(x.material=C),h.push(x)}l.primitives=h,i.meshes||(i.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,l)});const w=i.meshes.push(l)-1;return t.meshes.set(r,w),w}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const i=e.isOrthographicCamera,s={type:i?"orthographic":"perspective"};return i?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:ts.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const i=this.json,s=this.nodeMap;i.animations||(i.animations=[]),e=Ef.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],h=dt.parseTrackName(c.name);let d=dt.findNode(t,h.nodeName);const f=v_[h.propertyName];if(h.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(h.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let g=c.values.length/c.times.length;f===v_.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let m;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(m="CUBICSPLINE",g/=3):c.getInterpolation()===Gc?m="STEP":m="LINEAR",a.push({input:this.processAccessor(new fn(c.times,p)),output:this.processAccessor(new fn(c.values,g)),interpolation:m}),o.push({sampler:a.length-1,target:{node:s.get(d),path:f}})}return i.animations.push({name:e.name||"clip_"+i.animations.length,samplers:a,channels:o}),i.animations.length-1}processSkin(e){const t=this.json,i=this.nodeMap,s=t.nodes[i.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new Me;for(let d=0;d<r.bones.length;++d)a.push(i.get(r.bones[d])),c.copy(r.boneInverses[d]),c.multiply(e.bindMatrix).toArray(l,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new fn(l,16)),joints:a,skeleton:i.get(o)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,i=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(i.trs){const a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();gc(a,[0,0,0,1])||(r.rotation=a),gc(l,[0,0,0])||(r.translation=l),gc(c,[1,1,1])||(r.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),RL(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(r.mesh=a)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let l=0,c=e.children.length;l<c;l++){const h=e.children[l];if(h.visible||i.onlyVisible===!1){const d=this.processNode(h);d!==null&&a.push(d)}}a.length>0&&(r.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,r)});const o=t.nodes.push(r)-1;return s.set(e,o),o}processScene(e){const t=this.json,i=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||i.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(s.nodes=r),this.serializeUserData(e,s)}processObjects(e){const t=new Xc;t.name="AuxScene";for(let i=0;i<e.length;i++)t.children.push(e[i]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const i=[];for(let s=0;s<e.length;s++)e[s]instanceof Xc?this.processScene(e[s]):i.push(e[s]);i.length>0&&this.processObjects(i);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,i=this.plugins.length;t<i;t++)e(this.plugins[t])}}u(sM,"GLTFWriter");class rM{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const i=this.writer,s=i.json,r=i.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},r[this.name]=!0);const a=s.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}u(rM,"GLTFLightExtension");class oM{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}u(oM,"GLTFMaterialsUnlitExtension");class aM{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const i=this.writer,s=i.extensionsUsed,r={};t.pbrMetallicRoughness.baseColorFactor&&(r.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const o=[1,1,1];if(e.specular.toArray(o,0),r.specularFactor=o,r.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(r.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const a={index:i.processTexture(e.specularMap)};i.applyTextureTransform(a,e.specularMap),r.specularGlossinessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(aM,"GLTFMaterialsPBRSpecularGlossiness");class lM{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:i.processTexture(e.clearcoatMap)};i.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:i.processTexture(e.clearcoatRoughnessMap)};i.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:i.processTexture(e.clearcoatNormalMap)};i.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(lM,"GLTFMaterialsClearcoatExtension");class cM{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:i.processTexture(e.iridescenceMap)};i.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:i.processTexture(e.iridescenceThicknessMap)};i.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(cM,"GLTFMaterialsIridescenceExtension");class uM{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:i.processTexture(e.transmissionMap)};i.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(uM,"GLTFMaterialsTransmissionExtension");class hM{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const i=this.writer,s=i.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:i.processTexture(e.thicknessMap)};i.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}u(hM,"GLTFMaterialsVolumeExtension");Ef.Utils={insertKeyframe:function(n,e){const i=n.getValueSize(),s=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+i),o=n.createInterpolant(new n.ValueBufferType(i));let a;if(n.times.length===0){s[0]=e;for(let l=0;l<i;l++)r[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;s[0]=e,s.set(n.times,1),r.set(o.evaluate(e),0),r.set(n.values,i),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;s[s.length-1]=e,s.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(e),n.values.length),a=s.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){s.set(n.times.slice(0,l+1),0),s[l+1]=e,s.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*i),0),r.set(o.evaluate(e),(l+1)*i),r.set(n.values.slice((l+1)*i),(l+2)*i),a=l+1;break}}return n.times=s,n.values=r,a},mergeMorphTargetTracks:function(n,e){const t=[],i={},s=n.tracks;for(let r=0;r<s.length;++r){let o=s[r];const a=dt.parseTrackName(o.name),l=dt.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation($c)}const c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(i[l.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(c*d.times.length);for(let g=0;g<d.times.length;g++)p[g*c+h]=d.values[g];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,i[l.uuid]=d,t.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=i[l.uuid];for(let p=0;p<d.times.length;p++)d.values[p*c+h]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const g=this.insertKeyframe(d,o.times[p]);d.values[g*c+h]=o.values[p]}}return n.tracks=t,n}};class dM{parse(e){let t="",i=0,s=0,r=0;const o=new b,a=new Ie,l=new b,c=new Ge,h=[];function d(g){let m=0,v=0,y=0;const w=g.geometry,_=new ti,A=w.getAttribute("position"),x=w.getAttribute("normal"),C=w.getAttribute("uv"),T=w.getIndex();if(t+="o "+g.name+`
`,g.material&&g.material.name&&(t+="usemtl "+g.material.name+`
`),A!==void 0)for(let S=0,I=A.count;S<I;S++,m++)o.fromBufferAttribute(A,S),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(C!==void 0)for(let S=0,I=C.count;S<I;S++,y++)c.fromBufferAttribute(C,S),t+="vt "+c.x+" "+c.y+`
`;if(x!==void 0){_.getNormalMatrix(g.matrixWorld);for(let S=0,I=x.count;S<I;S++,v++)l.fromBufferAttribute(x,S),l.applyMatrix3(_).normalize(),t+="vn "+l.x+" "+l.y+" "+l.z+`
`}if(T!==null)for(let S=0,I=T.count;S<I;S+=3){for(let D=0;D<3;D++){const B=T.getX(S+D)+1;h[D]=i+B+(x||C?"/"+(C?s+B:"")+(x?"/"+(r+B):""):"")}t+="f "+h.join(" ")+`
`}else for(let S=0,I=A.count;S<I;S+=3){for(let D=0;D<3;D++){const B=S+D+1;h[D]=i+B+(x||C?"/"+(C?s+B:"")+(x?"/"+(r+B):""):"")}t+="f "+h.join(" ")+`
`}i+=m,s+=y,r+=v}u(d,"parseMesh");function f(g){let m=0;const v=g.geometry,y=g.type,w=v.getAttribute("position");if(t+="o "+g.name+`
`,w!==void 0)for(let _=0,A=w.count;_<A;_++,m++)o.fromBufferAttribute(w,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(y==="Line"){t+="l ";for(let _=1,A=w.count;_<=A;_++)t+=i+_+" ";t+=`
`}if(y==="LineSegments")for(let _=1,A=_+1,x=w.count;_<x;_+=2,A=_+1)t+="l "+(i+_)+" "+(i+A)+`
`;i+=m}u(f,"parseLine");function p(g){let m=0;const v=g.geometry,y=v.getAttribute("position"),w=v.getAttribute("color");if(t+="o "+g.name+`
`,y!==void 0){for(let _=0,A=y.count;_<A;_++,m++)o.fromBufferAttribute(y,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z,w!==void 0&&(a.fromBufferAttribute(w,_).convertLinearToSRGB(),t+=" "+a.r+" "+a.g+" "+a.b),t+=`
`;t+="p ";for(let _=1,A=y.count;_<=A;_++)t+=i+_+" ";t+=`
`}i+=m}return u(p,"parsePoints"),e.traverse(function(g){g.isMesh===!0&&d(g),g.isLine===!0&&f(g),g.isPoints===!0&&p(g)}),t}}u(dM,"OBJExporter");var LL=Object.defineProperty,FL=u((n,e)=>LL(n,"name",{value:e,configurable:!0}),"__name$2t");class Yg{constructor(e){M(this,"running",!1);M(this,"keepLoop",!1);M(this,"lastTimestamp",0);M(this,"onUpdate");this.onUpdate=e}start(){this.running||(this.running=!0,this.keepLoop=!0,this.lastTimestamp=new Date().valueOf(),requestAnimationFrame(()=>this.loop()))}stop(){this.keepLoop=!1}loop(){const e=new Date().valueOf();try{this.keepLoop&&this.onUpdate(Math.max(e-this.lastTimestamp,1)/1e3)}catch(t){throw this.running=!1,this.keepLoop=!1,t}this.lastTimestamp=e,this.keepLoop?requestAnimationFrame(()=>this.loop()):this.running=!1}}u(Yg,"RenderLoop");FL(Yg,"RenderLoop");var OL=Object.defineProperty,fM=u((n,e)=>OL(n,"name",{value:e,configurable:!0}),"__name$2s");function pM(n,e=300){let t=Date.now(),i=0;function s(){const r=Date.now();i+=r-t,t=r;const o=Math.min(1,i/e);n(o),o<1&&requestAnimationFrame(s)}u(s,"step"),fM(s,"step"),s()}u(pM,"createTransitionAnimation");fM(pM,"createTransitionAnimation");var NL=Object.defineProperty,ud=u((n,e)=>NL(n,"name",{value:e,configurable:!0}),"__name$2r");function nl(n,e,t){let i,s,r=ud(a=>e(a),"_onDragMove"),o=ud(a=>(document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",i),document.removeEventListener("pointerout",s),t&&t(a)),"_onDragEnd");i=o,s=ud(a=>{(!a.relatedTarget||a.relatedTarget.nodeName==="HTML")&&o(a)},"onPointerOut"),document.addEventListener("pointermove",r),document.addEventListener("pointerup",i),document.addEventListener("pointerout",s),n&&r(n)}u(nl,"addGlobalDragListener");ud(nl,"addGlobalDragListener");var kL=Object.defineProperty,ah=u((n,e)=>kL(n,"name",{value:e,configurable:!0}),"__name$2q");const w_="color-box",M_="color-box-active";var zL=Pt({props:{value:{type:Array,default:[1,1,1]},colorBox:Boolean},emits:["update:value"],setup(n,e){const t=ze(),i=ze(),s=160/2,r=13,o=Tr(new Ie),a=Tr({h:0,s:0,l:0}),l=ze(0),c=ze(0),h=ze(0),d=ze(0),f=Tr([16777215,16777215,16777215,16777215,16777215,16777215,16777215,16777215]);try{const C=localStorage.getItem(w_);if(C){const S=JSON.parse(C);for(let I=0,D=f.length;I<D;++I)f[I]=S[I]}const T=localStorage.getItem(M_);T&&(d.value=JSON.parse(T))}catch(C){console.error(C)}si(f,function(){!n.colorBox||localStorage.setItem(w_,JSON.stringify(f))},{deep:!0}),si(d,function(){!n.colorBox||localStorage.setItem(M_,JSON.stringify(d.value))}),si(()=>n.value,function(){o.setRGB(n.value[0],n.value[1],n.value[2]),o.getHSL(a);let C=a.h,T=a.s,S=a.l,I=T*Math.min(S,1-S)+S;T=I?2-2*S/I:0,(T||I||h.value&&!T&&!I)&&(c.value=T,h.value=I),T&&(l.value=C),f[d.value]=o.getHex()},{immediate:!0});const p=at(function(){return o.getHexString()}),g=at(function(){return f.map(C=>new Ie().setHex(C).getHexString())}),m=at(function(){return{transform:`rotate(${Math.round(l.value*360)-60}deg)`,"transform-origin":`0 ${s}px`}}),v=at(function(){return{"background-color":`#${new Ie().setHSL(l.value,1,.5).getHexString()}`}}),y=at(function(){return{left:`${Math.round(100*c.value)}%`,top:`${Math.round(100*(1-h.value))}%`}});function w(C){C.stopPropagation();const T=t.value.getBoundingClientRect(),S=s,I=s,D=C.clientX-T.left,B=C.clientY-T.top,Q=Math.sqrt((D-S)**2+(B-I)**2);Q>=s-r&&Q<=s&&nl(C,U=>{const z=U.clientX-T.left-S,q=U.clientY-T.top-I,J=(Math.atan2(q,z)/Math.PI*180+360*2+90+60)%360/360,X=new Ie().setHSL(J,a.s,a.l);e.emit("update:value",[X.r,X.g,X.b]),l.value=J})}u(w,"onHueRingMouseDown"),ah(w,"onHueRingMouseDown");function _(C){C.stopPropagation();const T=i.value.getBoundingClientRect();nl(C,S=>{let I=Math.min(Math.max(S.clientX-T.left,0),T.width)/T.width,D=1-Math.min(Math.max(S.clientY-T.top,0),T.height)/T.height;c.value=I,h.value=D;let B=D-D*I/2,Q=Math.min(B,1-B);I=Q?(D-B)/Q:0;const U=new Ie().setHSL(l.value,I,B);e.emit("update:value",[U.r,U.g,U.b])})}u(_,"onSvRectMouseDown"),ah(_,"onSvRectMouseDown");function A(C){const S=(C.target.value||"").trim();if(/^([a-fA-F0-9]{6})$/.test(S)){const I=Number.parseInt(S.substring(0,6),16),D=new Ie().setHex(I);e.emit("update:value",[D.r,D.g,D.b])}}u(A,"onTextInput"),ah(A,"onTextInput");function x(C){d.value=C;const T=new Ie().setHex(f[C]);e.emit("update:value",[T.r,T.g,T.b])}return u(x,"onBoxClick"),ah(x,"onBoxClick"),{hueRing:t,svRect:i,activeBox:d,hex:p,colorBoxHex:g,hueRingHandlerStyle:m,svRectStyle:v,svRectHandlerStyle:y,onHueRingMouseDown:w,onSvRectMouseDown:_,onTextInput:A,onBoxClick:x}}});const qg=u(n=>(ko("data-v-3618be33"),n=n(),zo(),n),"_withScopeId$5"),BL={class:"color-picker"},UL={class:"hue-ring-inner"},VL=qg(()=>he("div",{class:"bg1 bg"},null,-1)),HL=qg(()=>he("div",{class:"bg2 bg"},null,-1)),GL={class:"color-value"},$L=qg(()=>he("span",null,"#",-1)),WL=["value"],jL={key:0,class:"color-box"},XL=["onClick"];function YL(n,e,t,i,s,r){return Te(),Oe("div",BL,[he("div",{class:"hue-ring",onPointerdown:e[1]||(e[1]=(...o)=>n.onHueRingMouseDown&&n.onHueRingMouseDown(...o)),ref:"hueRing"},[he("div",{class:"hue-ring-handler",style:Jn(n.hueRingHandlerStyle)},null,4),he("div",UL,[he("div",{class:"sv-rect",style:Jn(n.svRectStyle),onPointerdown:e[0]||(e[0]=(...o)=>n.onSvRectMouseDown&&n.onSvRectMouseDown(...o)),ref:"svRect"},[VL,HL,he("div",{class:"sv-rect-handler",style:Jn(n.svRectHandlerStyle)},null,4)],36)])],544),he("div",GL,[he("div",{class:"block",style:Jn({"background-color":`#${n.hex}`})},null,4),$L,he("input",{type:"text",value:n.hex,onInput:e[2]||(e[2]=(...o)=>n.onTextInput&&n.onTextInput(...o))},null,40,WL)]),n.colorBox?(Te(),Oe("div",jL,[(Te(!0),Oe(Tt,null,Pr(n.colorBoxHex,(o,a)=>(Te(),Oe("div",{class:qt(["color",{active:n.activeBox===a}]),style:Jn({"background-color":`#${o}`}),onClick:l=>n.onBoxClick(a)},null,14,XL))),256))])):tt("",!0)])}u(YL,"_sfc_render$p");var mM=Ft(zL,[["render",YL],["__scopeId","data-v-3618be33"]]);const qL={},KL=u(n=>(ko("data-v-488ada72"),n=n(),zo(),n),"_withScopeId$4"),ZL=KL(()=>he("div",{class:"fullscreen-loading"},[he("div",{class:"lds-dual-ring"})],-1));function QL(n,e){return Te(),Wt(Ag,{to:"body"},[ZL])}u(QL,"_sfc_render$o");var JL=Ft(qL,[["render",QL],["__scopeId","data-v-488ada72"]]),eF=Object.defineProperty,tF=u((n,e)=>eF(n,"name",{value:e,configurable:!0}),"__name$2p"),nF=Pt({props:{value:Boolean,label:String},emits:["input"],setup(n,e){function t(){e.emit("input",!n.value)}return u(t,"flip"),tF(t,"flip"),{flip:t}}});const iF={class:"input-boolean"};function sF(n,e,t,i,s,r){return Te(),Oe("div",iF,[he("div",{class:qt(["input-boolean__checkbox",{checked:!!n.value}]),onClick:e[0]||(e[0]=(...o)=>n.flip&&n.flip(...o))},null,2),n.label?(Te(),Oe("div",{key:0,class:"input-boolean__label",onClick:e[1]||(e[1]=(...o)=>n.flip&&n.flip(...o))},$n(n.label),1)):tt("",!0)])}u(sF,"_sfc_render$n");var Kg=Ft(nF,[["render",sF],["__scopeId","data-v-271a8ef3"]]),rF=Object.defineProperty,lh=u((n,e)=>rF(n,"name",{value:e,configurable:!0}),"__name$2o"),oF=Pt({props:{value:Number,readonly:Boolean,disabled:Boolean,min:Number,max:Number,step:Number,resettable:Boolean,defaultValue:Number},emits:["input"],setup(n,e){const t=ze();let i=!1;function s(){i&&(o(),document.removeEventListener("mousedown",s))}u(s,"postOnMouseDown"),lh(s,"postOnMouseDown");function r(){i||(i=!0,document.addEventListener("mousedown",s))}u(r,"onChange"),lh(r,"onChange"),Bo(function(){document.removeEventListener("mousedown",s)});function o(){if(i){i=!1;const l=t.value;if(l){const c=l.value;let h=Number(c);isFinite(h)||(h=0),n.step!=null&&(h=Math.round(h/n.step)*n.step),n.min!=null&&(h=Math.max(n.min,h)),n.max!=null&&(h=Math.min(n.max,h)),e.emit("input",h)}}}u(o,"onPost"),lh(o,"onPost");function a(){e.emit("input",n.defaultValue||0)}return u(a,"onReset"),lh(a,"onReset"),{inputDom:t,onChange:r,onPost:o,onReset:a}}}),Zg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFxJREFUSIntlEsOACEIQ2Xuf+e6MkFiLCN+Nryl0AoxtZQkiSLeRgDohCJuLTW25vZ8VHebrw7Q+JZu/jHAGbEitME1jr1BCChY36xON9gWKIsOEQvajPdfRZJQKkl2V7+RNsIHAAAAAElFTkSuQmCC";const aF=u(n=>(ko("data-v-3550c3d4"),n=n(),zo(),n),"_withScopeId$3"),lF={class:"input-number"},cF=["value","readonly","disabled"],uF=aF(()=>he("img",{src:Zg,alt:""},null,-1)),hF=[uF];function dF(n,e,t,i,s,r){return Te(),Oe("div",lF,[he("input",{type:"text",value:n.value,readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,cF),n.resettable?(Te(),Oe("button",{key:0,class:"normal-button",onClick:e[3]||(e[3]=(...o)=>n.onReset&&n.onReset(...o))},hF)):tt("",!0)])}u(dF,"_sfc_render$m");var jo=Ft(oF,[["render",dF],["__scopeId","data-v-3550c3d4"]]),fF=Object.defineProperty,pF=u((n,e)=>fF(n,"name",{value:e,configurable:!0}),"__name$2n"),mF=Pt({props:{value:{type:Number,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},fractionDigits:Number,label:String},emits:["update:value"],setup(n,e){const t=ze(),i=at(function(){return n.value.toFixed(n.fractionDigits)}),s=at(function(){return{width:`${Math.round((n.value-n.min)/(n.max-n.min)*100)}%`}});function r(o){nl(o,function(a){const l=t.value.getBoundingClientRect();let h=Math.max(0,Math.min(1,(a.clientX-l.left)/l.width))*(n.max-n.min)+n.min;h=Math.round(h/n.step)*n.step,e.emit("update:value",h)})}return u(r,"onMouseDown"),pF(r,"onMouseDown"),{dom:t,valueText:i,barStyle:s,onMouseDown:r}}});const gF={class:"label"},vF={class:"value"};function yF(n,e,t,i,s,r){return Te(),Oe("div",{class:"label-range",onPointerdown:e[0]||(e[0]=(...o)=>n.onMouseDown&&n.onMouseDown(...o)),ref:"dom"},[he("div",{class:"bar",style:Jn(n.barStyle)},null,4),he("div",gF,$n(n.label),1),he("div",vF,$n(n.valueText),1)],544)}u(yF,"_sfc_render$l");var _F=Ft(mF,[["render",yF],["__scopeId","data-v-763688a1"]]);const Ld={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class ml{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}u(ml,"Pass");const xF=new Ho(-1,1,1,-1,0,1),Qg=new Qe;Qg.setAttribute("position",new Fe([-1,3,0,-1,-1,0,3,-1,0],3));Qg.setAttribute("uv",new Fe([0,2,0,0,2,0],2));class Jg{constructor(e){this._mesh=new Ee(Qg,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,xF)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}u(Jg,"FullScreenQuad");class $m extends ml{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Vn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=vf.clone(e.uniforms),this.material=new Vn({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Jg(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}u($m,"ShaderPass");class Wm extends ml{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),r.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(s.EQUAL,1,4294967295),r.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),r.buffers.stencil.setLocked(!0)}}u(Wm,"MaskPass");class gM extends ml{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}u(gM,"ClearMaskPass");class vM{constructor(e,t){if(this.renderer=e,t===void 0){const i=e.getSize(new Ge);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,t=new Rn(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],Ld===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),$m===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new $m(Ld),this.clock=new Kw}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let s=0,r=this.passes.length;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Wm!==void 0&&(o instanceof Wm?i=!0:o instanceof gM&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Ge);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}u(vM,"EffectComposer");new Ho(-1,1,1,-1,0,1);const yM=new Qe;yM.setAttribute("position",new Fe([-1,3,0,-1,-1,0,3,-1,0],3));yM.setAttribute("uv",new Fe([0,2,0,0,2,0],2));class Ms extends ml{constructor(e,t,i,s){super(),this.renderScene=t,this.renderCamera=i,this.selectedObjects=s!==void 0?s:[],this.visibleEdgeColor=new Ie(1,1,1),this.hiddenEdgeColor=new Ie(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new Ge(e.x,e.y):new Ge(256,256);const r=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new Rn(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new zg,this.depthMaterial.side=Ui,this.depthMaterial.depthPacking=hw,this.depthMaterial.blending=Ss,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Ui,this.prepareMaskMaterial.fragmentShader=h(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new Rn(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new Rn(r,o),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new Rn(r,o),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new Rn(Math.round(r/2),Math.round(o/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new Rn(r,o),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new Rn(Math.round(r/2),Math.round(o/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const a=4,l=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(a),this.separableBlurMaterial1.uniforms.texSize.value.set(r,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(l),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(r/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=l,this.overlayMaterial=this.getOverlayMaterial(),Ld===void 0&&console.error("THREE.OutlinePass relies on CopyShader");const c=Ld;this.copyUniforms=vf.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Vn({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:Ss,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Ie,this.oldClearAlpha=1,this.fsQuad=new Jg(null),this.tempPulseColor1=new Ie,this.tempPulseColor2=new Ie,this.textureMatrix=new Me;function h(d,f){const p=f.isPerspectiveCamera?"perspective":"orthographic";return d.replace(/DEPTH_TO_VIEW_Z/g,p+"DepthToViewZ")}u(h,"replaceDepthToViewZ")}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let i=Math.round(e/this.downSampleRatio),s=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(i,s),this.renderTargetBlurBuffer1.setSize(i,s),this.renderTargetEdgeBuffer1.setSize(i,s),this.separableBlurMaterial1.uniforms.texSize.value.set(i,s),i=Math.round(i/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(i,s),this.renderTargetEdgeBuffer2.setSize(i,s),this.separableBlurMaterial2.uniforms.texSize.value.set(i,s)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function i(s){s.isMesh&&(e===!0?s.visible=t.get(s):(t.set(s,s.visible),s.visible=e))}u(i,"gatherSelectedMeshesCallBack");for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(i)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,i=[];function s(o){o.isMesh&&i.push(o)}u(s,"gatherSelectedMeshesCallBack");for(let o=0;o<this.selectedObjects.length;o++)this.selectedObjects[o].traverse(s);function r(o){if(o.isMesh||o.isSprite){let a=!1;for(let l=0;l<i.length;l++)if(i[l].id===o.id){a=!0;break}if(a===!1){const l=o.visible;(e===!1||t.get(o)===!0)&&(o.visible=e),t.set(o,l)}}else(o.isPoints||o.isLine)&&(e===!0?o.visible=t.get(o):(t.set(o,o.visible),o.visible=e))}u(r,"VisibilityChangeCallBack"),this.renderScene.traverse(r)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,i,s,r){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,r&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+Math.cos(performance.now()*.01/this.pulsePeriod)*.75/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ms.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ms.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ms.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ms.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(i),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=i.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new Vn({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Ge(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new Vn({uniforms:{maskTexture:{value:null},texSize:{value:new Ge(.5,.5)},visibleEdgeColor:{value:new b(1,1,1)},hiddenEdgeColor:{value:new b(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new Vn({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Ge(.5,.5)},direction:{value:new Ge(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new Vn({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:Lm,depthTest:!1,depthWrite:!1,transparent:!0})}}u(Ms,"OutlinePass");Ms.BlurDirectionX=new Ge(1,0);Ms.BlurDirectionY=new Ge(0,1);class _M extends ml{constructor(e,t,i,s,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Ie}render(e,t,i){const s=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=s}}u(_M,"RenderPass");var bF=Object.defineProperty,wF=u((n,e)=>bF(n,"name",{value:e,configurable:!0}),"__name$2m");class e0{constructor(){M(this,"shadingMode","solid");M(this,"enablePressure",!0);M(this,"symmetry","no");M(this,"remeshVoxelSize",.003);M(this,"paintColor",[1,0,1]);M(this,"keepTransformUnchangedWhileMoving",!0);M(this,"useLocalSpaceForTransformControl",!0);M(this,"allowModifyingBoneLengthWhenBindingIk",!0);M(this,"keepInternalTransformWhenBindingIk",!0);M(this,"quadView",!1);M(this,"outlineSelected",!0);M(this,"showGrids",!0);M(this,"showLightHelpers",!1);M(this,"showIkBones",!1);M(this,"tools",{})}}u(e0,"EditorOptions");wF(e0,"EditorOptions");const Qr=new Xg,hi=new b,pr=new b,$t=new Ve,S_={X:new b(1,0,0),Y:new b(0,1,0),Z:new b(0,0,1)},Ip={type:"change"},A_={type:"mouseDown"},C_={type:"mouseUp",mode:null},T_={type:"objectChange"};class xM extends yt{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new bM;this._gizmo=i,this.add(i);const s=new wM;this._plane=s,this.add(s);const r=this;function o(w,_){let A=_;Object.defineProperty(r,w,{get:function(){return A!==void 0?A:_},set:function(x){A!==x&&(A=x,s[w]=x,i[w]=x,r.dispatchEvent({type:w+"-changed",value:x}),r.dispatchEvent(Ip))}}),r[w]=_,s[w]=_,i[w]=_}u(o,"defineProperty"),o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new b,l=new b,c=new Ve,h=new Ve,d=new b,f=new Ve,p=new b,g=new b,m=new b,v=0,y=new b;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",h),o("cameraPosition",d),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",g),o("rotationAxis",m),o("rotationAngle",v),o("eye",y),this._offset=new b,this._startNorm=new b,this._endNorm=new b,this._cameraScale=new b,this._parentPosition=new b,this._parentQuaternion=new Ve,this._parentQuaternionInv=new Ve,this._parentScale=new b,this._worldScaleStart=new b,this._worldQuaternionInv=new Ve,this._worldScale=new b,this._positionStart=new b,this._quaternionStart=new Ve,this._scaleStart=new b,this._getPointer=MF.bind(this),this._onPointerDown=AF.bind(this),this._onPointerHover=SF.bind(this),this._onPointerMove=CF.bind(this),this._onPointerUp=TF.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Qr.setFromCamera(e,this.camera);const t=Rp(this._gizmo.picker[this.mode],Qr);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Qr.setFromCamera(e,this.camera);const t=Rp(this._plane,Qr,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,A_.mode=this.mode,this.dispatchEvent(A_)}}pointerMove(e){const t=this.axis,i=this.mode,s=this.object;let r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),s===void 0||t===null||this.dragging===!1||e.button!==-1)return;Qr.setFromCamera(e,this.camera);const o=Rp(this._plane,Qr,!0);if(!!o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion($t.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(hi.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(hi.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),pr.set(a,a,a)}else hi.copy(this.pointStart),pr.copy(this.pointEnd),hi.applyQuaternion(this._worldQuaternionInv),pr.applyQuaternion(this._worldQuaternionInv),pr.divide(hi),t.search("X")===-1&&(pr.x=1),t.search("Y")===-1&&(pr.y=1),t.search("Z")===-1&&(pr.z=1);s.scale.copy(this._scaleStart).multiply(pr),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(hi.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(hi.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(S_[t]),hi.copy(S_[t]),r==="local"&&hi.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(hi.cross(this.eye).normalize())*a),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply($t.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy($t.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ip),this.dispatchEvent(T_)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(C_.mode=this.mode,this.dispatchEvent(C_)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ip),this.dispatchEvent(T_),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Qr}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}u(xM,"TransformControls");function MF(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const e=this.domElement.getBoundingClientRect();return{x:(n.clientX-e.left)/e.width*2-1,y:-(n.clientY-e.top)/e.height*2+1,button:n.button}}}u(MF,"getPointer");function SF(n){if(!!this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}u(SF,"onPointerHover");function AF(n){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}u(AF,"onPointerDown");function CF(n){!this.enabled||this.pointerMove(this._getPointer(n))}u(CF,"onPointerMove");function TF(n){!this.enabled||(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}u(TF,"onPointerUp");function Rp(n,e,t){const i=e.intersectObject(n,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||t)return i[s];return!1}u(Rp,"intersectObjectWithRay");const ch=new mt,Lt=new b(0,1,0),E_=new b(0,0,0),P_=new Me,uh=new Ve,hd=new Ve,ds=new b,I_=new Me,vc=new b(1,0,0),yo=new b(0,1,0),yc=new b(0,0,1),hh=new b,Fl=new b,Ol=new b;class bM extends yt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new tr({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Wn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const s=t.clone();s.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const g=e.clone();g.color.setHex(7895160);const m=new Sn(0,.04,.1,12);m.translate(0,.05,0);const v=new Qt(.08,.08,.08);v.translate(0,.04,0);const y=new Qe;y.setAttribute("position",new Fe([0,0,0,1,0,0],3));const w=new Sn(.0075,.0075,.5,3);w.translate(0,.25,0);function _(q,ee){const J=new wr(q,.0075,3,64,ee*Math.PI*2);return J.rotateY(Math.PI/2),J.rotateX(Math.PI/2),J}u(_,"CircleGeometry");function A(){const q=new Qe;return q.setAttribute("position",new Fe([0,0,0,1,1,1],3)),q}u(A,"TranslateHelperGeometry");const x={X:[[new Ee(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new Ee(m,r),[-.5,0,0],[0,0,Math.PI/2]],[new Ee(w,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Ee(m,o),[0,.5,0]],[new Ee(m,o),[0,-.5,0],[Math.PI,0,0]],[new Ee(w,o)]],Z:[[new Ee(m,a),[0,0,.5],[Math.PI/2,0,0]],[new Ee(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new Ee(w,a),null,[Math.PI/2,0,0]]],XYZ:[[new Ee(new Ar(.1,0),d.clone()),[0,0,0]]],XY:[[new Ee(new Qt(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new Ee(new Qt(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ee(new Qt(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new Ee(new Sn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Ee(new Sn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ee(new Sn(.2,0,.6,4),i),[0,.3,0]],[new Ee(new Sn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ee(new Sn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Ee(new Sn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Ee(new Ar(.2,0),i)]],XY:[[new Ee(new Qt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Ee(new Qt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ee(new Qt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},T={START:[[new Ee(new Ar(.01,2),s),null,null,null,"helper"]],END:[[new Ee(new Ar(.01,2),s),null,null,null,"helper"]],DELTA:[[new gn(A(),s),null,null,null,"helper"]],X:[[new gn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new gn(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new gn(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},S={XYZE:[[new Ee(_(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new Ee(_(.5,.5),r)]],Y:[[new Ee(_(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new Ee(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new Ee(_(.75,1),f),null,[0,Math.PI/2,0]]]},I={AXIS:[[new gn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},D={XYZE:[[new Ee(new hu(.25,10,8),i)]],X:[[new Ee(new wr(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Ee(new wr(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Ee(new wr(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Ee(new wr(.75,.1,2,24),i)]]},B={X:[[new Ee(v,r),[.5,0,0],[0,0,-Math.PI/2]],[new Ee(w,r),[0,0,0],[0,0,-Math.PI/2]],[new Ee(v,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Ee(v,o),[0,.5,0]],[new Ee(w,o)],[new Ee(v,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Ee(v,a),[0,0,.5],[Math.PI/2,0,0]],[new Ee(w,a),[0,0,0],[Math.PI/2,0,0]],[new Ee(v,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Ee(new Qt(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new Ee(new Qt(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ee(new Qt(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ee(new Qt(.1,.1,.1),d.clone())]]},Q={X:[[new Ee(new Sn(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Ee(new Sn(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ee(new Sn(.2,0,.6,4),i),[0,.3,0]],[new Ee(new Sn(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ee(new Sn(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Ee(new Sn(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Ee(new Qt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Ee(new Qt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ee(new Qt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ee(new Qt(.2,.2,.2),i),[0,0,0]]]},U={X:[[new gn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new gn(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new gn(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function z(q){const ee=new yt;for(const J in q)for(let X=q[J].length;X--;){const V=q[J][X][0].clone(),Z=q[J][X][1],de=q[J][X][2],Y=q[J][X][3],fe=q[J][X][4];V.name=J,V.tag=fe,Z&&V.position.set(Z[0],Z[1],Z[2]),de&&V.rotation.set(de[0],de[1],de[2]),Y&&V.scale.set(Y[0],Y[1],Y[2]),V.updateMatrix();const k=V.geometry.clone();k.applyMatrix4(V.matrix),V.geometry=k,V.renderOrder=1/0,V.position.set(0,0,0),V.rotation.set(0,0,0),V.scale.set(1,1,1),ee.add(V)}return ee}u(z,"setupGizmo"),this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=z(x)),this.add(this.gizmo.rotate=z(S)),this.add(this.gizmo.scale=z(B)),this.add(this.picker.translate=z(C)),this.add(this.picker.rotate=z(D)),this.add(this.picker.scale=z(Q)),this.add(this.helper.translate=z(T)),this.add(this.helper.rotate=z(I)),this.add(this.helper.scale=z(U)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:hd;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,this.axis==="X"&&($t.setFromEuler(ch.set(0,0,0)),o.quaternion.copy(i).multiply($t),Math.abs(Lt.copy(vc).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&($t.setFromEuler(ch.set(0,0,Math.PI/2)),o.quaternion.copy(i).multiply($t),Math.abs(Lt.copy(yo).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&($t.setFromEuler(ch.set(0,Math.PI/2,0)),o.quaternion.copy(i).multiply($t),Math.abs(Lt.copy(yc).applyQuaternion(i).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&($t.setFromEuler(ch.set(0,Math.PI/2,0)),Lt.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(P_.lookAt(E_,Lt,yo)),o.quaternion.multiply($t),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),hi.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),hi.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(hi),o.visible=this.dragging):(o.quaternion.copy(i),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Lt.copy(vc).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Lt.copy(yo).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Lt.copy(yc).applyQuaternion(i).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Lt.copy(yc).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Lt.copy(vc).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Lt.copy(yo).applyQuaternion(i).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(uh.copy(i),Lt.copy(this.eye).applyQuaternion($t.copy(i).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(P_.lookAt(this.eye,E_,yo)),o.name==="X"&&($t.setFromAxisAngle(vc,Math.atan2(-Lt.y,Lt.z)),$t.multiplyQuaternions(uh,$t),o.quaternion.copy($t)),o.name==="Y"&&($t.setFromAxisAngle(yo,Math.atan2(Lt.x,Lt.z)),$t.multiplyQuaternions(uh,$t),o.quaternion.copy($t)),o.name==="Z"&&($t.setFromAxisAngle(yc,Math.atan2(Lt.y,Lt.x)),$t.multiplyQuaternions(uh,$t),o.quaternion.copy($t))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}u(bM,"TransformControlsGizmo");class wM extends Ee{constructor(){super(new Fo(1e5,1e5,2,2),new tr({visible:!1,wireframe:!0,side:Ui,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),hh.copy(vc).applyQuaternion(t==="local"?this.worldQuaternion:hd),Fl.copy(yo).applyQuaternion(t==="local"?this.worldQuaternion:hd),Ol.copy(yc).applyQuaternion(t==="local"?this.worldQuaternion:hd),Lt.copy(Fl),this.mode){case"translate":case"scale":switch(this.axis){case"X":Lt.copy(this.eye).cross(hh),ds.copy(hh).cross(Lt);break;case"Y":Lt.copy(this.eye).cross(Fl),ds.copy(Fl).cross(Lt);break;case"Z":Lt.copy(this.eye).cross(Ol),ds.copy(Ol).cross(Lt);break;case"XY":ds.copy(Ol);break;case"YZ":ds.copy(hh);break;case"XZ":Lt.copy(Ol),ds.copy(Fl);break;case"XYZ":case"E":ds.set(0,0,0);break}break;case"rotate":default:ds.set(0,0,0)}ds.length()===0?this.quaternion.copy(this.cameraQuaternion):(I_.lookAt(hi.set(0,0,0),ds,Lt),this.quaternion.setFromRotationMatrix(I_)),super.updateMatrixWorld(e)}}u(wM,"TransformControlsPlane");var EF=Object.defineProperty,PF=u((n,e)=>EF(n,"name",{value:e,configurable:!0}),"__name$2l");const R_=new mt,IF=new b,Dp=new Ve;class t0{constructor(){M(this,"perspective",!0);M(this,"perspectiveCamera",new Dn(45,1,.1,2e3));M(this,"orthographicCamera",new Ho(-1,1,-1,1,0,2e3));M(this,"target",new b);M(this,"distance",1);M(this,"alpha",0);M(this,"beta",0);M(this,"_position",new b);M(this,"_up",new b);M(this,"_dir",new b)}get(){return this.perspective?this.perspectiveCamera:this.orthographicCamera}update(e,t){R_.set(0,this.beta,-this.alpha),Dp.setFromEuler(R_),this._position.set(this.distance,0,0),this._position.applyQuaternion(Dp),this._position.add(this.target);const i=this.get();if(i.position.copy(this._position),this._up.set(0,1,0),this._dir.subVectors(this._position,this.target).normalize(),IF.crossVectors(this._up,this._dir).lengthSq()<1e-8&&this._up.applyQuaternion(Dp),i.up.copy(this._up),i.lookAt(this.target),this.perspective)this.perspectiveCamera.aspect=e/t;else{const s=this.distance/850,r=e/2*s,o=t/2*s;this.orthographicCamera.left=-r,this.orthographicCamera.right=+r,this.orthographicCamera.bottom=-o,this.orthographicCamera.top=+o}i.updateProjectionMatrix()}}u(t0,"ArcRotateCamera");PF(t0,"ArcRotateCamera");var RF=Object.defineProperty,DF=u((n,e)=>RF(n,"name",{value:e,configurable:!0}),"__name$2k");class n0{constructor(){M(this,"element");M(this,"pointerOver",!1);M(this,"pointerX",0);M(this,"pointerY",0);M(this,"pressure",0);M(this,"mouseLeft",!1);M(this,"mouseLeftDownThisFrame",!1);M(this,"mouseRight",!1);M(this,"mouseRightDownThisFrame",!1);M(this,"mouseMiddle",!1);M(this,"mouseMiddleDownThisFrame",!1);M(this,"wheelDetX",0);M(this,"wheelDetY",0);M(this,"onContextmenu");M(this,"onPointerMove");M(this,"onPointerDown");M(this,"onPointerUp");M(this,"onPointerLeave");M(this,"onPointerOut");M(this,"onWheel");M(this,"onKeyDown");M(this,"onKeyUp");M(this,"onBlur");M(this,"keyMap",new Map);M(this,"timestamp",0);this.onContextmenu=e=>{e.target===this.element&&e.preventDefault()},this.onPointerMove=e=>{e.target===this.element&&(this.pressure=e.pressure,this.pointerOver=!0,this.pointerX=e.offsetX,this.pointerY=e.offsetY)},this.onPointerDown=e=>{if(e.target===this.element)switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!0,this.mouseLeftDownThisFrame=!0;break;case 1:this.mouseMiddle=!0,this.mouseMiddleDownThisFrame=!0;break;case 2:this.mouseRight=!0,this.mouseRightDownThisFrame=!0;break}},this.onPointerUp=e=>{switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1;break;case 1:this.mouseMiddle=!1,this.mouseMiddleDownThisFrame=!1;break;case 2:this.mouseRight=!1,this.mouseLeftDownThisFrame=!1;break}},this.onPointerLeave=()=>{this.pressure=0,this.pointerOver=!1},this.onPointerOut=e=>{(e.clientY<=0||e.clientX<=0||e.clientX>=window.innerWidth||e.clientY>=window.innerHeight)&&(this.pressure=0,this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1,this.mouseRight=!1,this.mouseLeftDownThisFrame=!1)},this.onWheel=e=>{e.preventDefault(),this.wheelDetX+=e.deltaX/100,this.wheelDetY+=e.deltaY/100},this.onKeyDown=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||((e.altKey||e.ctrlKey||e.key==="Tab")&&e.preventDefault(),this.keyMap.has(e.key)||this.keyMap.set(e.key,this.timestamp))},this.onKeyUp=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||this.keyMap.delete(e.key)},this.onBlur=()=>{this.keyMap.clear()}}setup(e){this.unload(),this.element=e,e.addEventListener("contextmenu",this.onContextmenu),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerleave",this.onPointerLeave),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointerout",this.onPointerOut),e.addEventListener("wheel",this.onWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}unload(){const e=this.element;!e||(e.removeEventListener("contextmenu",this.onContextmenu),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerleave",this.onPointerLeave),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointerout",this.onPointerOut),e.removeEventListener("wheel",this.onWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur),this.element=void 0)}update(){this.mouseLeftDownThisFrame=!1,this.mouseRightDownThisFrame=!1,this.mouseMiddleDownThisFrame=!1,this.wheelDetX=0,this.wheelDetY=0,this.timestamp=Date.now()}isKeyPressed(e){return this.keyMap.has(e)}isKeyPressedThisFrame(e){return this.keyMap.get(e)===this.timestamp}isKeyRepeated(e,t=150){const i=this.keyMap.get(e);if(i==null)return!1;const s=this.timestamp-i;return s>=t||s===0?(this.keyMap.set(e,this.timestamp),!0):!1}}u(n0,"Input");DF(n0,"Input");var LF=Object.defineProperty,FF=u((n,e)=>LF(n,"name",{value:e,configurable:!0}),"__name$2j");class Ia{constructor(e,t,i,s,r,o){M(this,"ctx");M(this,"index");M(this,"enabled",!0);M(this,"element");M(this,"camera",new t0);M(this,"zoomLevel",0);M(this,"left",0);M(this,"bottom",0);M(this,"width",0);M(this,"height",0);M(this,"input",new n0);M(this,"mouseScr",new Ge);M(this,"mouseNdc",new b);M(this,"mouseRay0",new b);M(this,"mouseRay1",new b);M(this,"mouseRayN",new b);M(this,"raycaster",new Xg);M(this,"transformControls");M(this,"defaultLight");this.ctx=e,this.index=t,this.element=i,this.input.setup(i),this.camera.alpha=s,this.camera.beta=r,this.camera.perspective=o,this.transformControls=new xM(this.camera.get(),i),e.scene.add(this.transformControls),this.defaultLight=new Af,e.scene.add(this.defaultLight)}update(){const e=this.element.getBoundingClientRect();this.left=e.left,this.bottom=e.bottom,this.width=e.width,this.height=e.height,this.width&&this.height?this.camera.update(this.width,this.height):this.enabled=!1}dispose(){this.transformControls.dispose(),this.defaultLight.dispose(),this.input.unload()}mousePick(e){return this.raycaster.intersectObjects(this.ctx.readonlyRef().scene.children.filter(t=>{if(!t.visible)return!1;const i=t.userData.node;return i!=null&&i.visible?!e||i.type===e:!1}))}}u(Ia,"EditorView");FF(Ia,"EditorView");var OF=Object.defineProperty,Pf=u((n,e)=>OF(n,"name",{value:e,configurable:!0}),"__name$2i");async function MM(n){return new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(new Blob([n]))})}u(MM,"bufferToDataUrl");Pf(MM,"bufferToDataUrl");async function i0(n){return(await fetch(n)).arrayBuffer()}u(i0,"dataUrlToArrayBuffer");Pf(i0,"dataUrlToArrayBuffer");const Fd=new DataView(new ArrayBuffer(4));function s0(n){const e=new Uint8Array(n.length*4);for(let t=0,i=n.length;t<i;++t){Fd.setFloat32(0,n[t]);const s=t*4;for(let r=0;r<4;++r)e[s+r]=Fd.getUint8(r)}return e}u(s0,"float32ArrayToBytes");Pf(s0,"float32ArrayToBytes");function r0(n){const e=new Float32Array(n.length/4);for(let t=0,i=e.length;t<i;++t){const s=t*4;for(let r=0;r<4;++r)Fd.setUint8(r,n[s+r]);e[t]=Fd.getFloat32(0)}return e}u(r0,"bytesToFloat32Array");Pf(r0,"bytesToFloat32Array");var NF=Object.defineProperty,kF=u((n,e)=>NF(n,"name",{value:e,configurable:!0}),"__name$2h");class st{onRemoved(){}}u(st,"ModelNodeComponent");kF(st,"ModelNodeComponent");var zF=Object.defineProperty,o0=u((n,e)=>zF(n,"name",{value:e,configurable:!0}),"__name$2g"),Xe=(n=>(n[n.NUMBER=1]="NUMBER",n[n.STRING=2]="STRING",n[n.BOOLEAN=3]="BOOLEAN",n[n.NUMBER_ARRAY=4]="NUMBER_ARRAY",n[n.BYTES=5]="BYTES",n))(Xe||{});const a0={};function lt(n){return function(e){if(!e.name.startsWith("C"))throw new Error('Component class name should be prefixed with "C"');if(n.storable&&n.dataType==null)throw new Error(`Component [${e.name}] missing data type`);a0[e.name]=Object.assign({constructor:e},n)}}u(lt,"registerModelComponent");o0(lt,"registerModelComponent");function SM(n){return!!a0[n]}u(SM,"isModelNodeComponentDefExists");o0(SM,"isModelNodeComponentDefExists");function Ii(n){const e=a0[n];if(!e)throw new Error(`Component def [${n}] not found`);return e}u(Ii,"getModelNodeComponentDef");o0(Ii,"getModelNodeComponentDef");var AM=Object.defineProperty,BF=Object.getOwnPropertyDescriptor,UF=u((n,e)=>AM(n,"name",{value:e,configurable:!0}),"__name$2f"),VF=u((n,e,t,i)=>{for(var s=i>1?void 0:i?BF(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&AM(e,t,s),s},"__decorateClass$B");let ls=u(class extends st{constructor(){super(...arguments);M(this,"value",new Float32Array);M(this,"dirty",!0);M(this,"partialUpdate",!1)}},"CColors");UF(ls,"CColors");ls=VF([lt({storable:!0,dataType:Xe.BYTES,clone(n){return new Float32Array(n)},serialize:s0,deserialize:r0})],ls);var HF=Object.defineProperty,nr=u((n,e)=>HF(n,"name",{value:e,configurable:!0}),"__name$2e");const pn=function(){const n=new b,e=new b;return function(t,i,s,r,o){n.subVectors(s,i);const a=n.length();if(a<1e-8)return!1;n.divideScalar(a);const l=n.dot(o);if(Math.abs(l)<1e-8)return!1;e.subVectors(r,i);const c=e.dot(o)/l;return t.copy(i),t.addScaledVector(n,c),!0}}(),Yc=new b,qc=new Ve,il=new b;function fu(n,e){return e.decompose(Yc,qc,il),n.copy(Yc),n}u(fu,"getTranslation");nr(fu,"getTranslation");function Od(n,e){return e.decompose(Yc,qc,il),n.copy(qc),n}u(Od,"getRotation");nr(Od,"getRotation");function GF(n,e){return e.decompose(Yc,qc,il),n.copy(il),n}u(GF,"getScale");nr(GF,"getScale");function Ro(n){return n.decompose(Yc,qc,il),il.x}u(Ro,"getScaleScalar");nr(Ro,"getScaleScalar");function jm(n,e,t,i,s,r){let o=t.x,a=t.y,l=t.z,c=i.x,h=i.y,d=i.z,f=s.x,p=s.y,g=s.z,m=r.x,v=r.y,y=r.z,w=c**2*v**2+c**2*y**2-2*c*h*m*v-2*c*d*m*y+h**2*m**2+h**2*y**2-2*h*d*v*y+d**2*m**2+d**2*v**2,_=!1,A=(c*m*v*a-c*m*v*p+c*m*y*l-c*m*y*g-c*v**2*o+c*v**2*f-c*y**2*o+c*y**2*f-h*m**2*a+h*m**2*p+h*m*v*o-h*m*v*f+h*v*y*l-h*v*y*g-h*y**2*a+h*y**2*p-d*m**2*l+d*m**2*g+d*m*y*o-d*m*y*f-d*v**2*l+d*v**2*g+d*v*y*a-d*v*y*p)/w;isFinite(A)||(_=!0,A=0);let x=o+c*A,C=a+h*A,T=l+d*A;if(n&&(n.x=x,n.y=C,n.z=T),e){let S=(-c*v*l+c*v*g+c*y*a-c*y*p+h*m*l-h*m*g-h*y*o+h*y*f-d*m*a+d*m*p+d*v*o-d*v*f)/w;if(isFinite(S)){let I=h*y-d*v,D=-c*y+d*m,B=c*v-h*m;e.x=x+I*S,e.y=C+D*S,e.z=T+B*S}else{_=!0;let I=h*(l-g)-d*(a-p),D=-c*(l-g)+d*(o-f),B=c*(a-p)-h*(o-f);e.x=x+h*B-d*D,e.y=C+-c*B+d*I,e.z=T+c*D-h*I}}return _}u(jm,"closestPointsBetweenTwoLines");nr(jm,"closestPointsBetweenTwoLines");const pu=function(){const n=new b,e=new b,t=new Me;return function(i,s,r){return n.crossVectors(r,s).normalize(),e.crossVectors(s,n).normalize(),t.set(n.x,n.y,n.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,0,0,0,0,1).transpose(),i.setFromRotationMatrix(t)}}();function Pc(n,e){return n.x=Math.round(n.x/e)*e,n.y=Math.round(n.y/e)*e,n.z=Math.round(n.z/e)*e,n}u(Pc,"snapPoint");nr(Pc,"snapPoint");function mu(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8}u(mu,"vectorsEqual");nr(mu,"vectorsEqual");function CM(n,e,t){const i=Math.min(e.x,t.x),s=Math.max(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.y,t.y),a=n.x,l=n.y;return!(a<i||a>s||l<r||l>o)}u(CM,"intersectPointRect");nr(CM,"intersectPointRect");const $F=function(){const n=new b,e=new b,t=new b;return function(i,s,r,o,a,l,c,h){n.subVectors(s,r);const d=l.dot(n),f=c.dot(n);if(d<=0&&f<=0)return i.copy(r);e.subVectors(s,o);const p=l.dot(e),g=c.dot(e);if(p>=0&&g<=p)return i.copy(o);t.subVectors(s,a);const m=l.dot(t),v=c.dot(t);if(v>=0&&m<=v)return i.copy(a);const y=d*g-p*f;if(y<=0&&d>=0&&p<=0){const T=d/(d-p);return i.copy(r).addScaledVector(l,T)}const w=m*f-d*v;if(w<=0&&f>=0&&v<=0){const T=f/(f-v);return i.copy(r).addScaledVector(c,T)}const _=p*v-m*g;if(_<=0&&g-p>=0&&m-v>=0){const T=(g-p)/(g-p+(m-v));return i.copy(o).addScaledVector(h,T)}const A=1/(_+w+y),x=w*A,C=y*A;return i.copy(r).addScaledVector(l,x).addScaledVector(c,C)}}(),WF=function(){const n=new b,e=new b,t=new b,i=new b;return function(s,r,o,a,l){e.crossVectors(a,l);let c=r.dot(e),h;if(c>0)h=1;else if(c<0)h=-1,c=-c;else return-1;n.subVectors(s,o);const d=h*r.dot(i.crossVectors(n,l));if(d<0)return-1;const f=h*r.dot(t.crossVectors(a,n));if(f<0||f+d>c)return-1;const p=-h*n.dot(e);return p<0?-1:p/c}}(),TM=function(){const n=new b;return function(e,t,i,s){return e.copy(t).addScaledVector(i,n.subVectors(s,t).dot(i))}}(),EM=function(){const n=new b;return function(e,t,i){return Math.atan2(n.crossVectors(t,i).dot(e),t.dot(i))}}();function Xm(n,e){const t=Math.acos(e.w)*2,i=Math.sin(t/2);return i>1e-6?n.set(e.x,e.y,e.z).multiplyScalar(1/i):n.set(1,0,0),t}u(Xm,"getAxisAngle");nr(Xm,"getAxisAngle");var PM=Object.defineProperty,jF=Object.getOwnPropertyDescriptor,XF=u((n,e)=>PM(n,"name",{value:e,configurable:!0}),"__name$2d"),YF=u((n,e,t,i)=>{for(var s=i>1?void 0:i?jF(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&PM(e,t,s),s},"__decorateClass$A");let Ys=u(class extends st{constructor(){super(...arguments);M(this,"value",new b)}},"CFlipDirection");XF(Ys,"CFlipDirection");Ys=YF([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,instanceable:!0,equal:mu,clone(n){return new b().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new b(n[0],n[1],n[2])}})],Ys);var IM=Object.defineProperty,qF=Object.getOwnPropertyDescriptor,l0=u((n,e)=>IM(n,"name",{value:e,configurable:!0}),"__name$2c"),KF=u((n,e,t,i)=>{for(var s=i>1?void 0:i?qF(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&IM(e,t,s),s},"__decorateClass$z");let Ce=u(class extends st{constructor(){super(...arguments);M(this,"value",null);M(this,"parentChanged",!0);M(this,"localTransformChanged",!0);M(this,"worldTransformChanged",!0);M(this,"mesh");M(this,"instance",!1)}onRemoved(){this.dispose()}dispose(){this.value&&(this.instance||sl(this.value),this.value.removeFromParent(),this.value=null)}},"CObject3D");l0(Ce,"CObject3D");Ce=KF([lt({})],Ce);function sl(n){for(let e of n.children)sl(e);if(!n.isInstancedMesh){if("geometry"in n){const e=n.geometry;e&&e.dispose()}if("material"in n){const e=n.material;e&&(e instanceof Array?e.forEach(Ym):Ym(e))}}}u(sl,"disposeObject3D");l0(sl,"disposeObject3D");function Ym(n){Object.keys(n).forEach(e=>{const t=n[e];t&&typeof t=="object"&&typeof t.dispose=="function"&&t.dispose()}),n.dispose()}u(Ym,"disposeMaterial");l0(Ym,"disposeMaterial");var RM=Object.defineProperty,ZF=Object.getOwnPropertyDescriptor,QF=u((n,e)=>RM(n,"name",{value:e,configurable:!0}),"__name$2b"),JF=u((n,e,t,i)=>{for(var s=i>1?void 0:i?ZF(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&RM(e,t,s),s},"__decorateClass$y");let Tn=u(class extends st{constructor(){super(...arguments);M(this,"value",new Float32Array);M(this,"dirty",!0);M(this,"partialUpdate",!1)}},"CVertices");QF(Tn,"CVertices");Tn=JF([lt({storable:!0,dataType:Xe.BYTES,clone(n){return new Float32Array(n)},serialize:s0,deserialize:r0})],Tn);var eO=Object.defineProperty,Nl=u((n,e)=>eO(n,"name",{value:e,configurable:!0}),"__name$2a"),tO=Pt({props:{value:{type:b,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean},emits:["input"],setup(n,e){const t=ze(),i=ze(),s=ze();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}u(o,"postOnMouseDown"),Nl(o,"postOnMouseDown");function a(d){return Number(d.toFixed(3))}u(a,"format"),Nl(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}u(l,"onChange"),Nl(l,"onChange"),Bo(function(){document.removeEventListener("mousedown",o)});function c(){var d,f,p;if(r){r=!1;let g=Number(((d=t.value)==null?void 0:d.value)||"0")||0,m=Number(((f=i.value)==null?void 0:f.value)||"0")||0,v=Number(((p=s.value)==null?void 0:p.value)||"0")||0;e.emit("input",new b(g,m,v))}}u(c,"onPost"),Nl(c,"onPost");function h(){e.emit("input",new b)}return u(h,"onReset"),Nl(h,"onReset"),{input0:t,input1:i,input2:s,format:a,onChange:l,onPost:c,onReset:h}}});const nO=u(n=>(ko("data-v-792b48dc"),n=n(),zo(),n),"_withScopeId$2"),iO={class:"input-vec3"},sO=["value","readonly","disabled"],rO=["value","readonly","disabled"],oO=["value","readonly","disabled"],aO=nO(()=>he("img",{src:Zg,alt:""},null,-1)),lO=[aO];function cO(n,e,t,i,s,r){return Te(),Oe("div",iO,[he("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,sO),he("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,rO),he("input",{type:"text",placeholder:"z",value:n.format(n.value.z),readonly:n.readonly,disabled:n.disabled,onInput:e[6]||(e[6]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[8]||(e[8]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input2"},null,40,oO),n.resettable?(Te(),Oe("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>n.onReset&&n.onReset(...o))},lO)):tt("",!0)])}u(cO,"_sfc_render$k");var DM=Ft(tO,[["render",cO],["__scopeId","data-v-792b48dc"]]),LM=Object.defineProperty,uO=Object.getOwnPropertyDescriptor,hO=u((n,e)=>LM(n,"name",{value:e,configurable:!0}),"__name$29"),dO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?uO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&LM(e,t,s),s},"__decorateClass$x");let is=u(class extends st{constructor(){super(...arguments);M(this,"value",new b(1,1,1));M(this,"dirty",!0)}},"CBoxSize");hO(is,"CBoxSize");is=dO([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,autoCopy:!0,equal:mu,label:"Size",inputComponent:DM,clone(n){return new b().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new b(n[0],n[1],n[2])}})],is);var FM=Object.defineProperty,fO=Object.getOwnPropertyDescriptor,pO=u((n,e)=>FM(n,"name",{value:e,configurable:!0}),"__name$28"),mO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?fO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&FM(e,t,s),s},"__decorateClass$w");let rn=u(class extends st{constructor(){super(...arguments);M(this,"value",!0)}},"CCastShadow");pO(rn,"CCastShadow");rn=mO([lt({storable:!0,dataType:Xe.BOOLEAN,instanceable:!0,label:"Cast Shadow",inlineLabel:!0,inputComponent:Kg})],rn);var gO=Object.defineProperty,vO=u((n,e)=>gO(n,"name",{value:e,configurable:!0}),"__name$27");class c0{constructor(e,t){M(this,"root");M(this,"zIndex",1e3);M(this,"show");M(this,"hide");M(this,"currentVisibleSubMenu");this.show=e,this.hide=t}handleMenuItemMouseOver(e,t){var i,s,r;(s=(i=this.currentVisibleSubMenu)==null?void 0:i.subMenu)==null||s.hide(),this.currentVisibleSubMenu=e,(r=e.subMenu)==null||r.show(t,"right")}hideAll(){this.root?this.root.hide():this.hide()}}u(c0,"PopupMenuContext");vO(c0,"PopupMenuContext");var yO=Object.defineProperty,kl=u((n,e)=>yO(n,"name",{value:e,configurable:!0}),"__name$26");let dh=[];var _O=Pt({props:{title:String,triggerBy:{type:String,default:"mousedown"},position:{type:String,default:"bottom"},disabled:Boolean,className:String,dynamicSize:Boolean},setup(n){const e=ze(),t=ze(),i=ze({left:0,top:0,width:"auto",height:"auto"}),s=ze(!1),r=ze(!1),o=new c0(d,f),a=ii("popupMenuItemContext",null);a&&(a.parent&&(o.root=a.parent.root||a.parent,o.zIndex=a.parent.zIndex+1),a.subMenu=o),za("popupMenuContext",o),rf(function(){o.root||dh.push(o)}),of(function(){o.root||(dh=dh.filter(p=>p!==o)),document.body.removeEventListener("mousedown",f)});function l(p){n.triggerBy==="mousedown"&&(r.value?f():d(e.value,n.position))}u(l,"onTriggerMouseDown"),kl(l,"onTriggerMouseDown");function c(){if(n.triggerBy==="hover"||n.triggerBy==="mouseover")return d(e.value,n.position)}u(c,"onTriggerMouseOver"),kl(c,"onTriggerMouseOver");function h(p){p.key==="Escape"&&(o.root?o.hide():f())}u(h,"onKeyDown"),kl(h,"onKeyDown");async function d(p,g){if(n.disabled)return;o.root||dh.forEach(I=>I.hideAll());const m=document.body.getBoundingClientRect(),v=p.getBoundingClientRect(),y=m.width,w=m.height;r.value=!0,s.value=!1,i.value={left:0,top:0,width:"auto",height:"auto"},await Bi(),document.body.addEventListener("mousedown",f),t.value.focus();const _=t.value.getBoundingClientRect();let A,x;const C=_.right-_.left,T=_.bottom-_.top;if(typeof g=="object")A=g.x,x=g.y;else switch(g){case"bottom":A=v.left,x=v.bottom;break;default:A=v.right,x=v.top;break}const S={"z-index":o.zIndex};if(n.dynamicSize?(S.width="auto",S.height="auto",s.value=!1):(S.width=Math.floor(C)+"px",S.height=Math.floor(T)+"px",S.overflow="hidden",s.value=!0),A+C>y?S.right=0:S.left=Math.floor(A)+"px",x+T>w){const I=Math.floor(Math.max(0,w-T));S.top=I+"px",S.height=Math.floor(w-I)+"px"}else S.top=Math.floor(x)+"px";i.value=S}u(d,"show"),kl(d,"show");function f(){var p,g;document.body.removeEventListener("mousedown",f),r.value=!1,(g=(p=o.currentVisibleSubMenu)==null?void 0:p.subMenu)==null||g.hide(),o.currentVisibleSubMenu=void 0}return u(f,"hide"),kl(f,"hide"),{trigger:e,menu:t,onTriggerMouseDown:l,onTriggerMouseOver:c,onKeyDown:h,style:i,scrollable:s,visible:r,show:d,hide:f}}});const xO=["disabled"],bO={class:"scroll"};function wO(n,e,t,i,s,r){return Te(),Oe(Tt,null,[n.title?(Te(),Oe("button",{key:0,class:qt(["popup-menu-trigger",n.className]),disabled:n.disabled,onMousedown:e[0]||(e[0]=on((...o)=>n.onTriggerMouseDown&&n.onTriggerMouseDown(...o),["stop"])),onMouseover:e[1]||(e[1]=(...o)=>n.onTriggerMouseOver&&n.onTriggerMouseOver(...o)),ref:"trigger"},$n(n.title),43,xO)):tt("",!0),(Te(),Wt(Ag,{to:"body"},[n.visible?(Te(),Oe("div",{key:0,class:qt(["popup-menu",{scrollable:n.scrollable}]),style:Jn(n.style),ref:"menu",tabindex:"0",onMousedown:e[2]||(e[2]=on(()=>{},["stop"])),onContextmenu:e[3]||(e[3]=on(()=>{},["prevent"])),onKeydown:e[4]||(e[4]=(...o)=>n.onKeyDown&&n.onKeyDown(...o))},[he("div",bO,[Bc(n.$slots,"default",{},void 0,!0)])],38)):tt("",!0)]))],64)}u(wO,"_sfc_render$j");var u0=Ft(_O,[["render",wO],["__scopeId","data-v-e883b650"]]),MO=Object.defineProperty,SO=u((n,e)=>MO(n,"name",{value:e,configurable:!0}),"__name$25"),AO=Pt({components:{ColorPicker:mM,PopupMenu:u0},props:{value:Array},emits:["input"],setup(n,e){const t=at(function(){const s=n.value||[1,1,1];return{"background-color":`#${new Ie().setRGB(s[0],s[1],s[2]).getHexString()}`}});function i(s){e.emit("input",s)}return u(i,"onInput"),SO(i,"onInput"),{style:t,onInput:i}}});const CO={style:{padding:"8px 8px 0 8px"}};function TO(n,e,t,i,s,r){const o=Yt("color-picker"),a=Yt("popup-menu");return Te(),Oe("div",{class:"input-color",style:Jn(n.style)},[Pe(a,{title:" "},{default:kt(()=>[he("div",CO,[Pe(o,{value:n.value,"onUpdate:value":n.onInput},null,8,["value","onUpdate:value"])])]),_:1})],4)}u(TO,"_sfc_render$i");var If=Ft(AO,[["render",TO],["__scopeId","data-v-1ea277a0"]]),OM=Object.defineProperty,EO=Object.getOwnPropertyDescriptor,PO=u((n,e)=>OM(n,"name",{value:e,configurable:!0}),"__name$24"),IO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?EO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&OM(e,t,s),s},"__decorateClass$v");let vn=u(class extends st{constructor(){super(...arguments);M(this,"value",[1,1,1])}},"CColor");PO(vn,"CColor");vn=IO([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,equal:(n,e)=>new Ie().setRGB(n[0],n[1],n[2]).getHex()===new Ie().setRGB(e[0],e[1],e[2]).getHex(),label:"Color",inlineLabel:!0,inputComponent:If,clone(n){return[...n]}})],vn);var NM=Object.defineProperty,RO=Object.getOwnPropertyDescriptor,DO=u((n,e)=>NM(n,"name",{value:e,configurable:!0}),"__name$23"),LO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?RO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&NM(e,t,s),s},"__decorateClass$u");let Ir=u(class extends st{constructor(){super(...arguments);M(this,"value",[0,0,0])}},"CEmissive");DO(Ir,"CEmissive");Ir=LO([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,equal:(n,e)=>new Ie().setRGB(n[0],n[1],n[2]).getHex()===new Ie().setRGB(e[0],e[1],e[2]).getHex(),label:"Emissive",inlineLabel:!0,inputComponent:If,clone(n){return[...n]}})],Ir);var kM=Object.defineProperty,FO=Object.getOwnPropertyDescriptor,OO=u((n,e)=>kM(n,"name",{value:e,configurable:!0}),"__name$22"),NO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?FO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&kM(e,t,s),s},"__decorateClass$t");let Kc=u(class extends st{constructor(){super(...arguments);M(this,"value",[1,1,1])}},"CGroundColor");OO(Kc,"CGroundColor");Kc=NO([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,equal:(n,e)=>new Ie().setRGB(n[0],n[1],n[2]).getHex()===new Ie().setRGB(e[0],e[1],e[2]).getHex(),label:"Ground Color",inputComponent:If,clone(n){return[...n]}})],Kc);var zM=Object.defineProperty,kO=Object.getOwnPropertyDescriptor,zO=u((n,e)=>zM(n,"name",{value:e,configurable:!0}),"__name$21"),BO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?kO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&zM(e,t,s),s},"__decorateClass$s");let Zc=u(class extends st{constructor(){super(...arguments);M(this,"value",.5)}},"CHeight");zO(Zc,"CHeight");Zc=BO([lt({storable:!0,dataType:Xe.NUMBER,label:"Height",inputComponent:jo,inputComponentProps:{min:0,step:.001}})],Zc);var BM=Object.defineProperty,UO=Object.getOwnPropertyDescriptor,VO=u((n,e)=>BM(n,"name",{value:e,configurable:!0}),"__name$20"),HO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?UO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&BM(e,t,s),s},"__decorateClass$r");const Lp=24,zn=new b;let vt=u(class extends st{constructor(){super(...arguments);M(this,"value");M(this,"dirty",!0);M(this,"start",new b);M(this,"end",new b);M(this,"quaternion",new Ve);M(this,"boneMesh");M(this,"moveHandler");M(this,"rotateHandler");M(this,"moveHandlerHovered",!1);M(this,"moveHandlerZ",0);M(this,"rotateHandlerHovered",!1);M(this,"rotateHandlerZ",0)}onRemoved(){var e,t;this.boneMesh&&sl(this.boneMesh),this.moveHandler&&(this.moveHandler.geometry.dispose(),(e=this.moveHandler.material)==null||e.dispose()),this.rotateHandler&&(this.rotateHandler.geometry.dispose(),(t=this.rotateHandler.material)==null||t.dispose())}updateHandlersHoverState(e,t){var i,s;(i=this.moveHandler)!=null&&i.visible&&(zn.copy(this.start).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),zn.x+=1,zn.y+=1,zn.x*=t.width/2,zn.y*=t.height/2,this.moveHandlerZ=zn.z,Math.abs(t.mouseScr.x-zn.x)<=Lp/2&&Math.abs(t.mouseScr.y-zn.y)<=Lp/2&&(this.moveHandlerHovered=!0)),(s=this.rotateHandler)!=null&&s.visible&&(zn.copy(this.end).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),zn.x+=1,zn.y+=1,zn.x*=t.width/2,zn.y*=t.height/2,this.rotateHandlerZ=zn.z,Math.sqrt((t.mouseScr.x-zn.x)**2+(t.mouseScr.y-zn.y)**2)<=Lp/2&&(this.rotateHandlerHovered=!0)),this.moveHandlerHovered&&this.rotateHandlerHovered&&(this.moveHandlerZ<this.rotateHandlerZ?this.rotateHandlerHovered=!1:this.moveHandlerHovered=!1)}resetHandlers(e){this.moveHandlerHovered=!1,this.rotateHandlerHovered=!1,this.boneMesh&&(this.boneMesh.visible=e.options.showIkBones),this.moveHandler&&(this.moveHandler.visible=!1),this.rotateHandler&&(this.rotateHandler.visible=!1)}},"CIkNode");VO(vt,"CIkNode");vt=HO([lt({})],vt);var UM=Object.defineProperty,GO=Object.getOwnPropertyDescriptor,$O=u((n,e)=>UM(n,"name",{value:e,configurable:!0}),"__name$1$"),WO=u((n,e,t,i)=>{for(var s=i>1?void 0:i?GO(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&UM(e,t,s),s},"__decorateClass$q");let os=u(class extends st{constructor(){super(...arguments);M(this,"value",.2)}},"CIkNodeLength");$O(os,"CIkNodeLength");os=WO([lt({storable:!0,dataType:Xe.NUMBER,autoCopy:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Length",inputComponent:jo,inputComponentProps:{min:0}})],os);var jO=Object.defineProperty,zl=u((n,e)=>jO(n,"name",{value:e,configurable:!0}),"__name$1_"),XO=Pt({props:{value:{type:mt,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean},emits:["input"],setup(n,e){const t=ze(),i=ze(),s=ze();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}u(o,"postOnMouseDown"),zl(o,"postOnMouseDown");function a(d){return Number((d/Math.PI*180).toFixed(1))}u(a,"format"),zl(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}u(l,"onChange"),zl(l,"onChange"),Bo(function(){document.removeEventListener("mousedown",o)});function c(){var d,f,p;if(r){r=!1;let g=Number(((d=t.value)==null?void 0:d.value)||"0")||0,m=Number(((f=i.value)==null?void 0:f.value)||"0")||0,v=Number(((p=s.value)==null?void 0:p.value)||"0")||0;e.emit("input",new mt(g/180*Math.PI,m/180*Math.PI,v/180*Math.PI))}}u(c,"onPost"),zl(c,"onPost");function h(){e.emit("input",new mt)}return u(h,"onReset"),zl(h,"onReset"),{input0:t,input1:i,input2:s,format:a,onChange:l,onPost:c,onReset:h}}});const YO=u(n=>(ko("data-v-6ff85571"),n=n(),zo(),n),"_withScopeId$1"),qO={class:"input-euler"},KO=["value","readonly","disabled"],ZO=["value","readonly","disabled"],QO=["value","readonly","disabled"],JO=YO(()=>he("img",{src:Zg,alt:""},null,-1)),e4=[JO];function t4(n,e,t,i,s,r){return Te(),Oe("div",qO,[he("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,KO),he("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,ZO),he("input",{type:"text",placeholder:"z",value:n.format(n.value.z),readonly:n.readonly,disabled:n.disabled,onInput:e[6]||(e[6]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[8]||(e[8]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input2"},null,40,QO),n.resettable?(Te(),Oe("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>n.onReset&&n.onReset(...o))},e4)):tt("",!0)])}u(t4,"_sfc_render$h");var VM=Ft(XO,[["render",t4],["__scopeId","data-v-6ff85571"]]),HM=Object.defineProperty,n4=Object.getOwnPropertyDescriptor,i4=u((n,e)=>HM(n,"name",{value:e,configurable:!0}),"__name$1Z"),s4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?n4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&HM(e,t,s),s},"__decorateClass$p");let jn=u(class extends st{constructor(){super(...arguments);M(this,"value",new mt)}},"CIkNodeRotation");i4(jn,"CIkNodeRotation");jn=s4([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,instanceable:!0,equal(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8},label:"Rotation",inputComponent:VM,inputComponentProps:{resettable:!0},clone(n){return new mt().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new mt(n[0],n[1],n[2])}})],jn);var r4=Object.defineProperty,o4=u((n,e)=>r4(n,"name",{value:e,configurable:!0}),"__name$1Y"),a4=Pt({props:{value:String,accept:String},emits:["input"],setup(n,e){const t=ze();async function i(){var o;if(!((o=t.value)!=null&&o.files))return;const s=t.value.files[0];if(!s)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsDataURL(s)});t.value.value="",e.emit("input",r)}return u(i,"onChange"),o4(i,"onChange"),{input:t,onChange:i}}});const l4={class:"input-file normal-button"},c4=["accept"];function u4(n,e,t,i,s,r){return Te(),Oe("div",null,[he("label",l4,[he("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),accept:n.accept},null,40,c4),Cg(" ... ")])])}u(u4,"_sfc_render$g");var GM=Ft(a4,[["render",u4],["__scopeId","data-v-cd0c5822"]]),$M=Object.defineProperty,h4=Object.getOwnPropertyDescriptor,d4=u((n,e)=>$M(n,"name",{value:e,configurable:!0}),"__name$1X"),f4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?h4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&$M(e,t,s),s},"__decorateClass$o");let Nr=u(class extends st{constructor(){super(...arguments);M(this,"value","");M(this,"dirty",!0);M(this,"texture")}onRemoved(){this.texture&&this.texture.dispose()}},"CImage");d4(Nr,"CImage");Nr=f4([lt({storable:!0,dataType:Xe.STRING,label:"Image File",inputComponent:GM,inputComponentProps:{accept:"image/png, image/jpeg"}})],Nr);var WM=Object.defineProperty,p4=Object.getOwnPropertyDescriptor,m4=u((n,e)=>WM(n,"name",{value:e,configurable:!0}),"__name$1W"),g4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?p4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&WM(e,t,s),s},"__decorateClass$n");let kr=u(class extends st{constructor(){super(...arguments);M(this,"value","");M(this,"dirty",!0)}},"CImportFbx");m4(kr,"CImportFbx");kr=g4([lt({storable:!0,dataType:Xe.STRING,label:".fbx File",inputComponent:GM,inputComponentProps:{accept:".fbx"}})],kr);var v4=Object.defineProperty,y4=u((n,e)=>v4(n,"name",{value:e,configurable:!0}),"__name$1V"),_4=Pt({props:{value:String,accept:String},emits:["input"],setup(n,e){const t=ze();async function i(){var o;if(!((o=t.value)!=null&&o.files))return;const s=t.value.files[0];if(!s)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsText(s)});t.value.value="",e.emit("input",r)}return u(i,"onChange"),y4(i,"onChange"),{input:t,onChange:i}}});const x4={class:"input-file normal-button"},b4=["accept"];function w4(n,e,t,i,s,r){return Te(),Oe("div",null,[he("label",x4,[he("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),accept:n.accept},null,40,b4),Cg(" ... ")])])}u(w4,"_sfc_render$f");var M4=Ft(_4,[["render",w4],["__scopeId","data-v-51992a25"]]),jM=Object.defineProperty,S4=Object.getOwnPropertyDescriptor,A4=u((n,e)=>jM(n,"name",{value:e,configurable:!0}),"__name$1U"),C4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?S4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&jM(e,t,s),s},"__decorateClass$m");let zr=u(class extends st{constructor(){super(...arguments);M(this,"value","");M(this,"dirty",!0)}},"CImportObj");A4(zr,"CImportObj");zr=C4([lt({storable:!0,dataType:Xe.STRING,label:".obj File",inputComponent:M4,inputComponentProps:{accept:".obj"}})],zr);var XM=Object.defineProperty,T4=Object.getOwnPropertyDescriptor,E4=u((n,e)=>XM(n,"name",{value:e,configurable:!0}),"__name$1T"),P4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?T4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&XM(e,t,s),s},"__decorateClass$l");let Zn=u(class extends st{constructor(){super(...arguments);M(this,"value",1)}},"CIntensity");E4(Zn,"CIntensity");Zn=P4([lt({storable:!0,dataType:Xe.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Intensity",inputComponent:jo,inputComponentProps:{min:0,step:.001}})],Zn);var YM=Object.defineProperty,I4=Object.getOwnPropertyDescriptor,R4=u((n,e)=>YM(n,"name",{value:e,configurable:!0}),"__name$1S"),D4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?I4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&YM(e,t,s),s},"__decorateClass$k");let ni=u(class extends st{constructor(){super(...arguments);M(this,"value",null);M(this,"camera",null)}onRemoved(){this.value&&(sl(this.value),this.value.removeFromParent(),this.value=null),this.camera&&(sl(this.camera),this.camera.removeFromParent(),this.camera=null)}},"CLightHelper");R4(ni,"CLightHelper");ni=D4([lt({})],ni);var L4=Object.defineProperty,F4=u((n,e)=>L4(n,"name",{value:e,configurable:!0}),"__name$1R"),O4=Pt({props:{value:String,disabled:Boolean,options:Array},emits:["input"],setup(n,e){const t=ze();function i(){const s=t.value;s&&e.emit("input",s.value)}return u(i,"onChange"),F4(i,"onChange"),{selectDom:t,onChange:i}}});const N4=["value","disabled"],k4=["value"];function z4(n,e,t,i,s,r){return Te(),Oe("select",{class:"input-select",value:n.value,disabled:n.disabled,onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),ref:"selectDom"},[(Te(!0),Oe(Tt,null,Pr(n.options,o=>(Te(),Oe("option",{key:o,value:o},$n(o),9,k4))),128))],40,N4)}u(z4,"_sfc_render$e");var Rf=Ft(O4,[["render",z4],["__scopeId","data-v-f534510c"]]),qM=Object.defineProperty,B4=Object.getOwnPropertyDescriptor,U4=u((n,e)=>qM(n,"name",{value:e,configurable:!0}),"__name$1Q"),V4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?B4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&qM(e,t,s),s},"__decorateClass$j");let Oo=u(class extends st{constructor(){super(...arguments);M(this,"value","512")}},"CMapSize");U4(Oo,"CMapSize");Oo=V4([lt({storable:!0,dataType:Xe.STRING,label:"Shadow Quality",inputComponent:Rf,inputComponentProps:{options:["128","256","512","1024","2048"]}})],Oo);var H4=Object.defineProperty,fh=u((n,e)=>H4(n,"name",{value:e,configurable:!0}),"__name$1P"),G4=Pt({props:{value:Number,min:{type:Number,required:!0},max:{type:Number,required:!0},step:Number},emits:["input"],setup(n,e){const t=at(function(){return n.step?Math.round(n.min/n.step):n.min}),i=at(function(){return n.step?Math.round(n.max/n.step):n.max}),s=at(function(){const f=n.value==null?0:n.value;return n.step?Math.round(f/n.step):f}),r=at(function(){const f=n.value==null?0:n.value;return n.step?f.toFixed(-Math.log10(n.step)):f});function o(f){let p=Number(f.target.value);n.step&&(p*=n.step),e.emit("input",p)}u(o,"onRangeInput"),fh(o,"onRangeInput");const a=ze();let l=!1;function c(){l&&(d(),document.removeEventListener("mousedown",c))}u(c,"postOnMouseDown"),fh(c,"postOnMouseDown");function h(){l||(l=!0,document.addEventListener("mousedown",c))}u(h,"onChange"),fh(h,"onChange"),Bo(function(){document.removeEventListener("mousedown",c)});function d(){if(l){l=!1;const f=a.value;if(f){const p=f.value;let g=Number(p);isFinite(g)||(g=0),n.step!=null&&(g=Math.round(g/n.step)*n.step),n.min!=null&&(g=Math.max(n.min,g)),n.max!=null&&(g=Math.min(n.max,g)),e.emit("input",g)}}}return u(d,"onPost"),fh(d,"onPost"),{inputDom:a,onChange:h,onPost:d,iMin:t,iMax:i,iValue:s,text:r,onRangeInput:o}}});const $4={class:"input-range"},W4=["value","min","max"],j4=["value"];function X4(n,e,t,i,s,r){return Te(),Oe("div",$4,[he("input",{class:"range",type:"range",value:n.iValue,min:n.iMin,max:n.iMax,onInput:e[0]||(e[0]=(...o)=>n.onRangeInput&&n.onRangeInput(...o))},null,40,W4),he("input",{class:"num",type:"text",value:n.text,onInput:e[1]||(e[1]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[2]||(e[2]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[3]||(e[3]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,j4)])}u(X4,"_sfc_render$d");var gu=Ft(G4,[["render",X4],["__scopeId","data-v-79764ced"]]),KM=Object.defineProperty,Y4=Object.getOwnPropertyDescriptor,q4=u((n,e)=>KM(n,"name",{value:e,configurable:!0}),"__name$1O"),K4=u((n,e,t,i)=>{for(var s=i>1?void 0:i?Y4(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&KM(e,t,s),s},"__decorateClass$i");let Rr=u(class extends st{constructor(){super(...arguments);M(this,"value",0)}},"CMetalness");q4(Rr,"CMetalness");Rr=K4([lt({storable:!0,dataType:Xe.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Metalness",inputComponent:gu,inputComponentProps:{min:0,max:1,step:.01}})],Rr);var Z4=Object.defineProperty,Fp=u((n,e)=>Z4(n,"name",{value:e,configurable:!0}),"__name$1N"),Q4=Pt({props:{value:String,readonly:Boolean,disabled:Boolean},emits:["input"],setup(n,e){const t=ze();let i=!1;function s(){i&&(o(),document.removeEventListener("mousedown",s))}u(s,"postOnMouseDown"),Fp(s,"postOnMouseDown");function r(){i||(i=!0,document.addEventListener("mousedown",s))}u(r,"onChange"),Fp(r,"onChange"),Bo(function(){document.removeEventListener("mousedown",s)});function o(){if(i){i=!1;const a=t.value;a&&e.emit("input",a.value)}}return u(o,"onPost"),Fp(o,"onPost"),{inputDom:t,onChange:r,onPost:o}}});const J4=["value","readonly","disabled"];function eN(n,e,t,i,s,r){return Te(),Oe("input",{class:"input-string",type:"text",value:n.value,readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=In((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,J4)}u(eN,"_sfc_render$c");var tN=Ft(Q4,[["render",eN],["__scopeId","data-v-07fa832a"]]),ZM=Object.defineProperty,nN=Object.getOwnPropertyDescriptor,iN=u((n,e)=>ZM(n,"name",{value:e,configurable:!0}),"__name$1M"),sN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?nN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&ZM(e,t,s),s},"__decorateClass$h");let Xt=u(class extends st{constructor(){super(...arguments);M(this,"value","")}},"CName");iN(Xt,"CName");Xt=sN([lt({storable:!0,dataType:Xe.STRING,instanceable:!0,label:"Name",inputComponent:tN})],Xt);var QM=Object.defineProperty,rN=Object.getOwnPropertyDescriptor,oN=u((n,e)=>QM(n,"name",{value:e,configurable:!0}),"__name$1L"),aN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?rN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&QM(e,t,s),s},"__decorateClass$g");let Kn=u(class extends st{constructor(){super(...arguments);M(this,"value",1)}},"COpacity");oN(Kn,"COpacity");Kn=aN([lt({storable:!0,dataType:Xe.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Opacity",inputComponent:gu,inputComponentProps:{min:0,max:1,step:.01}})],Kn);var JM=Object.defineProperty,lN=Object.getOwnPropertyDescriptor,cN=u((n,e)=>JM(n,"name",{value:e,configurable:!0}),"__name$1K"),uN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?lN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&JM(e,t,s),s},"__decorateClass$f");let Qc=u(class extends st{constructor(){super(...arguments);M(this,"value",0)}},"CPenumbra");cN(Qc,"CPenumbra");Qc=uN([lt({storable:!0,dataType:Xe.NUMBER,label:"Edge Softness",inputComponent:gu,inputComponentProps:{min:0,max:1,step:.01}})],Qc);var eS=Object.defineProperty,hN=Object.getOwnPropertyDescriptor,dN=u((n,e)=>eS(n,"name",{value:e,configurable:!0}),"__name$1J"),fN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?hN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&eS(e,t,s),s},"__decorateClass$e");let je=u(class extends st{constructor(){super(...arguments);M(this,"value",new b)}},"CPosition");dN(je,"CPosition");je=fN([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,instanceable:!0,equal:mu,label:"Position",inputComponent:DM,inputComponentProps:{resettable:!0},clone(n){return new b().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new b(n[0],n[1],n[2])}})],je);var tS=Object.defineProperty,pN=Object.getOwnPropertyDescriptor,mN=u((n,e)=>tS(n,"name",{value:e,configurable:!0}),"__name$1I"),gN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?pN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&tS(e,t,s),s},"__decorateClass$d");let Qn=u(class extends st{constructor(){super(...arguments);M(this,"value",!0)}},"CReceiveShadow");mN(Qn,"CReceiveShadow");Qn=gN([lt({storable:!0,dataType:Xe.BOOLEAN,instanceable:!0,label:"Receive Shadow",inlineLabel:!0,inputComponent:Kg})],Qn);var nS=Object.defineProperty,vN=Object.getOwnPropertyDescriptor,yN=u((n,e)=>nS(n,"name",{value:e,configurable:!0}),"__name$1H"),_N=u((n,e,t,i)=>{for(var s=i>1?void 0:i?vN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&nS(e,t,s),s},"__decorateClass$c");let bt=u(class extends st{constructor(){super(...arguments);M(this,"value",new mt)}},"CRotation");yN(bt,"CRotation");bt=_N([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,instanceable:!0,equal(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8},label:"Rotation",inputComponent:VM,inputComponentProps:{resettable:!0},clone(n){return new mt().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new mt(n[0],n[1],n[2])}})],bt);var iS=Object.defineProperty,xN=Object.getOwnPropertyDescriptor,bN=u((n,e)=>iS(n,"name",{value:e,configurable:!0}),"__name$1G"),wN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?xN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&iS(e,t,s),s},"__decorateClass$b");let Dr=u(class extends st{constructor(){super(...arguments);M(this,"value",1)}},"CRoughness");bN(Dr,"CRoughness");Dr=wN([lt({storable:!0,dataType:Xe.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Roughness",inputComponent:gu,inputComponentProps:{min:0,max:1,step:.01}})],Dr);var sS=Object.defineProperty,MN=Object.getOwnPropertyDescriptor,SN=u((n,e)=>sS(n,"name",{value:e,configurable:!0}),"__name$1F"),AN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?MN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&sS(e,t,s),s},"__decorateClass$a");let Bt=u(class extends st{constructor(){super(...arguments);M(this,"value",1)}},"CScale");SN(Bt,"CScale");Bt=AN([lt({storable:!0,dataType:Xe.NUMBER,instanceable:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Scale",inputComponent:jo,inputComponentProps:{resettable:!0,defaultValue:1,step:.001}})],Bt);var rS=Object.defineProperty,CN=Object.getOwnPropertyDescriptor,TN=u((n,e)=>rS(n,"name",{value:e,configurable:!0}),"__name$1E"),EN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?CN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&rS(e,t,s),s},"__decorateClass$9");let di=u(class extends st{constructor(){super(...arguments);M(this,"value",!0);M(this,"throttleHash","")}},"CSdfDirty");TN(di,"CSdfDirty");di=EN([lt({})],di);var oS=Object.defineProperty,PN=Object.getOwnPropertyDescriptor,IN=u((n,e)=>oS(n,"name",{value:e,configurable:!0}),"__name$1D"),RN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?PN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&oS(e,t,s),s},"__decorateClass$8");let rl=u(class extends st{constructor(){super(...arguments);M(this,"value","add")}},"CSdfOperator");IN(rl,"CSdfOperator");rl=RN([lt({storable:!0,dataType:Xe.STRING,label:"Operator",inputComponent:Rf,inputComponentProps:{options:["add","subtract"]}})],rl);var aS=Object.defineProperty,DN=Object.getOwnPropertyDescriptor,LN=u((n,e)=>aS(n,"name",{value:e,configurable:!0}),"__name$1C"),FN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?DN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&aS(e,t,s),s},"__decorateClass$7");let ol=u(class extends st{constructor(){super(...arguments);M(this,"value","none")}},"CSdfSymmetry");LN(ol,"CSdfSymmetry");ol=FN([lt({storable:!0,dataType:Xe.STRING,label:"Symmetry",inputComponent:Rf,inputComponentProps:{options:["none","x","y","z"]}})],ol);var lS=Object.defineProperty,ON=Object.getOwnPropertyDescriptor,NN=u((n,e)=>lS(n,"name",{value:e,configurable:!0}),"__name$1B"),kN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?ON(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&lS(e,t,s),s},"__decorateClass$6");let Jc=u(class extends st{constructor(){super(...arguments);M(this,"value",10)}},"CShadowMappingRange");NN(Jc,"CShadowMappingRange");Jc=kN([lt({storable:!0,dataType:Xe.NUMBER,label:"Shadow Mapping Range",inputComponent:jo,inputComponentProps:{min:0}})],Jc);var cS=Object.defineProperty,zN=Object.getOwnPropertyDescriptor,BN=u((n,e)=>cS(n,"name",{value:e,configurable:!0}),"__name$1A"),UN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?zN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&cS(e,t,s),s},"__decorateClass$5");let eu=u(class extends st{constructor(){super(...arguments);M(this,"value",[1,1,1])}},"CSkyColor");BN(eu,"CSkyColor");eu=UN([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,equal:(n,e)=>new Ie().setRGB(n[0],n[1],n[2]).getHex()===new Ie().setRGB(e[0],e[1],e[2]).getHex(),label:"Sky Color",inputComponent:If,clone(n){return[...n]}})],eu);var uS=Object.defineProperty,VN=Object.getOwnPropertyDescriptor,HN=u((n,e)=>uS(n,"name",{value:e,configurable:!0}),"__name$1z"),GN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?VN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&uS(e,t,s),s},"__decorateClass$4");let tu=u(class extends st{constructor(){super(...arguments);M(this,"value",30)}},"CSpotLightAngle");HN(tu,"CSpotLightAngle");tu=GN([lt({storable:!0,dataType:Xe.NUMBER,label:"Angle",inputComponent:gu,inputComponentProps:{min:0,max:90,step:.1}})],tu);var hS=Object.defineProperty,$N=Object.getOwnPropertyDescriptor,WN=u((n,e)=>hS(n,"name",{value:e,configurable:!0}),"__name$1y"),jN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?$N(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&hS(e,t,s),s},"__decorateClass$3");let nu=u(class extends st{constructor(){super(...arguments);M(this,"value","512")}},"CTextureSize");WN(nu,"CTextureSize");nu=jN([lt({storable:!0,dataType:Xe.STRING,label:"Texture Quality",inputComponent:Rf,inputComponentProps:{options:["128","256","512","1024","2048"]}})],nu);var dS=Object.defineProperty,XN=Object.getOwnPropertyDescriptor,fS=u((n,e)=>dS(n,"name",{value:e,configurable:!0}),"__name$1x"),YN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?XN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&dS(e,t,s),s},"__decorateClass$2");function h0(n){return n.map(e=>({radius:e.radius,position:new b().copy(e.position)}))}u(h0,"cloneTube");fS(h0,"cloneTube");const Ic=new Wn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:2273612,opacity:.75}),Nd=Ic.clone();Nd.color.setHex(16776960);Nd.opacity=1;const Rc=Ic.clone();Rc.color.setHex(15964205);Rc.opacity=1;var hc;let nt=u((hc=class extends st{constructor(){super(...arguments);M(this,"value",[]);M(this,"dirty",!0);M(this,"group");M(this,"pickers",[]);M(this,"circles",[]);M(this,"lines",[]);M(this,"hovered",-1);M(this,"selected",[]);M(this,"draggingStartValue");M(this,"draggingStartMatrix");M(this,"draggingStartInvMatrix");M(this,"draggingStartNodeIndex",-1)}onRemoved(){var e;(e=this.group)==null||e.removeFromParent()}updateColor(){for(let e=0,t=this.circles.length;e<t;++e){const i=this.circles[e];if(this.selected.includes(e)||e===this.draggingStartNodeIndex?i.material=Rc:e===this.hovered?i.material=Nd:i.material=Ic,e<t-1){const s=this.lines[e];this.selected.includes(e)&&this.selected.includes(e+1)?s.material=Rc:s.material=Ic}}}addSelection(e){this.selected.includes(e)||this.selected.push(e)}clone(e=this.value){return h0(e)}},M(hc,"normalMaterial",Ic),M(hc,"hoveredMaterial",Nd),M(hc,"selectedMaterial",Rc),hc),"CTube");fS(nt,"CTube");nt=YN([lt({storable:!0,dataType:Xe.NUMBER_ARRAY,equal(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;++t){const s=n[t],r=e[t];if(Math.abs(s.radius-r.radius)>1e-8||!mu(s.position,r.position))return!1}return!0},clone:h0,serialize(n){const e=[];for(let t of n)e.push(t.radius,t.position.x,t.position.y,t.position.z);return e},deserialize(n){const e=[];for(let t=0,i=n.length;t<i;t+=4)e.push({radius:n[t],position:new b(n[t+1],n[t+2],n[t+3])});return e}})],nt);var pS=Object.defineProperty,qN=Object.getOwnPropertyDescriptor,KN=u((n,e)=>pS(n,"name",{value:e,configurable:!0}),"__name$1w"),ZN=u((n,e,t,i)=>{for(var s=i>1?void 0:i?qN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&pS(e,t,s),s},"__decorateClass$1");let zt=u(class extends st{constructor(){super(...arguments);M(this,"value",!0)}},"CVisible");KN(zt,"CVisible");zt=ZN([lt({storable:!0,dataType:Xe.BOOLEAN,instanceable:!0})],zt);var mS=Object.defineProperty,QN=Object.getOwnPropertyDescriptor,JN=u((n,e)=>mS(n,"name",{value:e,configurable:!0}),"__name$1v"),ek=u((n,e,t,i)=>{for(var s=i>1?void 0:i?QN(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(s=(i?o(e,t,s):o(s))||s);return i&&s&&mS(e,t,s),s},"__decorateClass");let iu=u(class extends st{constructor(){super(...arguments);M(this,"value",.5)}},"CWidth");JN(iu,"CWidth");iu=ek([lt({storable:!0,dataType:Xe.NUMBER,label:"Width",inputComponent:jo,inputComponentProps:{min:0,step:.001}})],iu);var tk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntlDEOACEIBMH4/y/PNVqK6xEbw9TLbDQEs6LI4koIQJK5S75jOYNr8ijb/w5Odt+yLFCGlRe2XSBLFTxSALDauHRBJDcLbtHV+1O8xQcgdTP9QsaHuQAAAABJRU5ErkJggg==",nk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGJJREFUSIntlMEOwCAMQsX4/7/cXU1cIwM9rRyb8tBIbK1UcgVmKSJiMQKY5wAoFgV/m2d7EvzIvnIi2iNd93ZA5hlfQRk4a1F3A3b1tANkse+gFoIyW/AdhIVbfxHjLf1ADzNkU8v8yWLDAAAAAElFTkSuQmCC",ik="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGlJREFUSIntk8EOwCAIQ8X//+futEQZSgnsRi8m+KCKOEarlZUwEAC4hUSoWmbxm8G7xxwinKzjFne8VrQtAEC3yWuLZhh+S1xXljvxUwei0+DxH4NqlRjcHjht4E1PyoAZzbJ/0Gr9pwf7m2fK2pb3HwAAAABJRU5ErkJggg==",sk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntkcEKwCAMQxvx/3+5ngo63KK2wg59pyIkMa1IkvwezB5VVY/MgKlfSMCbpjCRCfu5N2Sf+QwQGWsDwG47GuCFBjzXYo2sDTvs8YrM3H0DL1sBKytZNorS1MiQJLlDA/9ET+yIPaCNAAAAAElFTkSuQmCC",rk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHBJREFUSIntlMEOwCAIQ2X//8/dZVuMoZt0eNDYG4J9hBBK2VpexhIA8BSZ0TpJtbkXp5r3QHDJyx0KrK0JjfCrUxaHxtgzJtm8/uR99N5/LUFryKAygIGGABTz1zWNwtIA6afjlrI94U6GHsGtOXUCrECLjc6LLwMAAAAASUVORK5CYII=",ok="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntkkEKACAIBLP//9lOhgdJSlc6ODdhmYFojKaJQt6AmXmPidz9FVpu3any18iMxEKcpGnBsoglS3+2sgj061pSSEDEIodFtBwegQaav1kXY2ucLK26fgAAAABJRU5ErkJggg==",ak="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF9JREFUSIntk0EOwCAIBN2m///y9m4WLIKJB+ZiRN0hRsdomuuBKpLkVhgg80oE1pknGhRlKdi9rl8CkgSArEQGz6HR+VLg1eexTKDWlCwlsPYffabeB3u9rirkTZPnA+JpX7qX66AGAAAAAElFTkSuQmCC",Bl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGNJREFUSIljYBgFAw0YiVX4/////ygaGRmJ1kvQYHTD8YmTbDilapgocgElgBTv41NLtA+QDaE47HEZiByxVLFwaEcyDNA0HyAbRowYNjDwQQQD5KYaFnItGTRg4IvrUUBzAAC2uXOjDxKDVAAAAABJRU5ErkJggg==",lk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntk8EKACEIRDP2/3959hRI4DqNnRbfLQqfNjVG83ss2gAAuohZWCeEFWTnHkXoO866pwWn4sWsCjLoCaQgTwRqBtQV7S/Fr+GQBYr4ioCBykANOBV8/VJWGgoqXTfNXV4/VTgWLIRfCQAAAABJRU5ErkJggg==",ck="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntkkkKACEMBO1h/v/l8jIDIlGJC3hInVzoVCKmFATXI+sQYKqYZNbbImhlHk+QD08zXQGAJJVF6v2I4QSruAX/VMcE1z2RSf1zynXvbkqwmnl3SoLgDBnHw1PSkFB0SwAAAABJRU5ErkJggg==",uk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAE5JREFUSIljYBgFwx4w4pP8////fxTFjIx41ZME0A3HJUY1w6lqCSFDKLaEGAMosoRYzaOWDC5LaJ6yaJ4/aJrL8RlOVuFF00JwFAw9AACJKmejS/9FQQAAAABJRU5ErkJggg==",hk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFdJREFUSIljYBgFo4BSwEiswv/////H0MzISLR+og3HxaaK4cTwKTKcFDGyDCdHnIlkm0kEOFMBOd4mKVUNmSDCC2iainBppmo+wGYIqTl5cJRFo2BoAwCKVWuoeE0X9QAAAABJRU5ErkJggg==",dk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAEVJREFUSIljYBgFo2AUMJKi+P/////hGhkZSdJLkuHY+FQ1nKqWEDKEkDwTxS4gAGhuAVGApnGAyzBiDR88+WAUjIKBAwBuly/fa4hrDAAAAABJRU5ErkJggg==",fk=Object.defineProperty,gS=u((n,e)=>fk(n,"name",{value:e,configurable:!0}),"__name$1u");const vS=[{name:"Container",label:"Container",icon:ik,showInList:!0,instanceable:!0,components:[Xt,zt,je,bt,Bt,Kn,Ce],canBeRoot:!0,validChildTypes:["Container","IKChain","Image","ObjModel","FbxModel","Box","Shape","Clay","Mirror"]},{name:"IKChain",label:"IK Chain",icon:rk,showInList:!0,instanceable:!0,components:[Xt,zt,je,bt,Bt,Kn,Ce],canBeRoot:!0,validChildTypes:["IKNode"]},{name:"IKNode",label:"IK Node",icon:ok,showInList:!0,instanceable:!0,components:[Xt,zt,Kn,Ce,vt,os,jn],canBeRoot:!1,validChildTypes:["Container","IKChain","Image","ObjModel","FbxModel","Box","Shape","Clay","Mirror"]},{name:"Box",label:"Box",icon:tk,showInList:!0,instanceable:!0,components:[Xt,zt,rn,Qn,je,bt,Bt,vn,Ir,Dr,Rr,Kn,Ce,is],canBeRoot:!0,validChildTypes:[]},{name:"Shape",label:"SDF Shape",icon:uk,showInList:!0,instanceable:!0,components:[Xt,zt,rn,Qn,je,bt,Bt,vn,Ir,Dr,Rr,Kn,Ce,di,ol],canBeRoot:!0,validChildTypes:["Tube"]},{name:"Tube",label:"Tube",icon:dk,showInList:!0,components:[Xt,Ce,rl,nt],canBeRoot:!1,validChildTypes:[]},{name:"Clay",label:"Clay",icon:nk,showInList:!0,instanceable:!0,components:[Xt,zt,rn,Qn,je,bt,Bt,Dr,Rr,vn,Ir,Kn,Ce,Tn,ls],canBeRoot:!0,validChildTypes:[]},{name:"Image",label:"Image",icon:ak,showInList:!0,instanceable:!1,components:[Xt,zt,rn,Qn,je,bt,Bt,Kn,Ce,Nr],canBeRoot:!0,defaultData:{[rn.name]:!1,[Qn.name]:!1},validChildTypes:[]},{name:"ObjModel",label:"Import .obj",icon:ck,showInList:!0,instanceable:!0,components:[Xt,zt,rn,Qn,je,bt,Bt,Kn,Ce,zr],canBeRoot:!0,validChildTypes:[]},{name:"FbxModel",label:"Import .fbx",icon:sk,showInList:!0,instanceable:!0,components:[Xt,zt,rn,Qn,je,bt,Bt,Kn,Ce,kr],canBeRoot:!0,validChildTypes:[]},{name:"Mirror",label:"Mirror",icon:lk,showInList:!0,components:[Xt,zt,nu,je,bt,Bt,Ce,iu,Zc,vn],canBeRoot:!0,validChildTypes:[]},{name:"Target",label:"Target",icon:hk,showInList:!1,fixed:!0,unique:!0,components:[je,Ce],canBeRoot:!1,validChildTypes:[]},{name:"AmbientLight",label:"Ambient Light",icon:Bl,showInList:!0,components:[Xt,zt,Ce,Zn,vn],canBeRoot:!0,defaultData:{[Zn.name]:.2},validChildTypes:[]},{name:"HemisphereLight",label:"Hemisphere Light",icon:Bl,showInList:!0,components:[Xt,zt,je,Ce,ni,Zn,eu,Kc],canBeRoot:!0,validChildTypes:[],defaultData:{[Zn.name]:.2,[je.name]:new b(0,1,0)}},{name:"DirectionalLight",label:"Directional Light",icon:Bl,showInList:!0,components:[Xt,zt,rn,Oo,Jc,je,Ce,ni,Zn,vn],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[je.name]:new b(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]},{name:"PointLight",label:"Point Light",icon:Bl,showInList:!0,components:[Xt,zt,rn,je,Ce,ni,Zn,vn],canBeRoot:!0,validChildTypes:[],defaultData:{[je.name]:new b(0,1,0)}},{name:"SpotLight",label:"Spot Light",icon:Bl,showInList:!0,components:[Xt,zt,rn,Oo,Qc,tu,je,Ce,ni,Zn,vn],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[je.name]:new b(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]}],yS={};for(let n of vS)yS[n.name]=n;function fi(n){const e=yS[n];if(!e)throw new Error(`Node def [${n}] not found`);return e}u(fi,"getModelNodeDef");gS(fi,"getModelNodeDef");function d0(n){return fi(n.type).validChildTypes.map(fi).filter(t=>t.unique?!n.children.find(i=>i.type===t.name):!0)}u(d0,"getValidChildNodeDefs");gS(d0,"getValidChildNodeDefs");var pk=Object.defineProperty,mk=u((n,e)=>pk(n,"name",{value:e,configurable:!0}),"__name$1t");const ph=new Me;class Do{constructor(){M(this,"id",0);M(this,"type","");M(this,"expanded",!0);M(this,"components",{});M(this,"parent",null);M(this,"children",[]);M(this,"dirty",!0);M(this,"deleted",!1);M(this,"opacity",1);M(this,"visible",!0);M(this,"instanceId",0);M(this,"instanceMeshDirty",!0);M(this,"instanceMeshRebuild",!0);M(this,"mirrorGeometry",{})}get(e){const t=this.components[e.name];if(!t)throw new Error(`Component [${e.name}] not found`);return t}has(e){return this.components[e.name]!=null}value(e){return this.get(e).value}cloneValue(e){const t=this.get(e).value,i=Ii(e.name);return i.clone?i.clone(t):t}forEach(e){const t=[this];for(;;){const i=t.pop();if(!i)break;if(e(i)===!1)return!1;for(let s=i.children.length;s--;)t.push(i.children[s])}}getLocalMatrix(){if(this.has(Ce)){const e=this.value(Ce);if(e)return e.matrix}return this.parent?this.parent.getLocalMatrix():ph}getWorldMatrix(){if(this.has(Ce)){const e=this.value(Ce);if(e)return e.matrixWorld}return this.parent?this.parent.getWorldMatrix():ph}getParentWorldMatrix(){return this.type==="Target"?ph:this.parent?this.parent.getWorldMatrix():ph}async toJson(){var t;const e=[];for(let i of this.children)e.push(await i.toJson());return{type:this.type,expanded:this.expanded,parentId:(t=this.parent)==null?void 0:t.id,instanceId:this.instanceId,data:await this.getComponentsDataJson(),children:e}}getComponentData(e){const t={};for(let i in this.components){const s=Ii(i);if(!(e&&!s.instanceable)&&s.storable){let o=this.components[i].value;s.clone&&(o=s.clone(o)),t[i]=o}}return t}async getComponentsDataJson(){const e={};for(let t in this.components){const i=Ii(t);if(i.storable){let r=this.components[t].value;i.serialize&&(r=i.serialize(r)),r&&i.dataType===Xe.BYTES&&(r=await MM(r)),e[t]=r}}return e}isValidChild(e){return!!d0(this).find(t=>t.name===e)}}u(Do,"ModelNode");mk(Do,"ModelNode");var gk=Object.defineProperty,vk=u((n,e)=>gk(n,"name",{value:e,configurable:!0}),"__name$1s");class f0{onValueChanged(e,t,i){i===is&&(t.get(is).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(f0,"BoxWatcher");vk(f0,"BoxWatcher");var yk=Object.defineProperty,_k=u((n,e)=>yk(n,"name",{value:e,configurable:!0}),"__name$1r");class p0{onValueChanged(e,t,i){i===Tn?t.get(Tn).dirty=!0:i===ls&&(t.get(ls).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(p0,"ClayWatcher");_k(p0,"ClayWatcher");var xk=Object.defineProperty,bk=u((n,e)=>xk(n,"name",{value:e,configurable:!0}),"__name$1q");class m0{onValueChanged(e,t,i){i===nt?(t.get(nt).dirty=!0,t.parent&&(t.parent.dirty=!0,t.parent.get(di).value=!0)):i===rl?t.parent&&(t.parent.dirty=!0,t.parent.get(di).value=!0):i===ol&&(t.get(di).value=!0)}onChildAdded(e,t,i){t.type==="Shape"&&(t.dirty=!0,t.get(di).value=!0)}onBeforeChildRemoved(e,t,i){t.type==="Shape"&&(t.dirty=!0,t.get(di).value=!0)}onMoved(e,t,i,s){(i==null?void 0:i.type)==="Shape"&&(i.dirty=!0,i.get(di).value=!0),(s==null?void 0:s.type)==="Shape"&&(s.dirty=!0,s.get(di).value=!0)}}u(m0,"CustomShapeWatcher");bk(m0,"CustomShapeWatcher");var wk=Object.defineProperty,_S=u((n,e)=>wk(n,"name",{value:e,configurable:!0}),"__name$1p");const Mk=[os,jn];function Aa(n,e){if(!n)return;n.dirty=!0;let t=Math.max(0,e?n.children.indexOf(e):0);for(let i=n.children.length;t<i;++t){const s=n.children[t],r=s.get(vt);r&&(s.dirty=!0,r.dirty=!0);const o=s.get(Ce);o&&(o.localTransformChanged=!0,o.worldTransformChanged=!0)}}u(Aa,"markIkChainDirty");_S(Aa,"markIkChainDirty");class g0{onValueChanged(e,t,i){Mk.includes(i)&&Aa(t.parent,t)}onMoved(e,t,i,s){t.has(vt)&&(Aa(i),Aa(s,t))}onChildAdded(e,t,i){i.has(vt)&&Aa(t,i)}onBeforeChildRemoved(e,t,i){i.has(vt)&&Aa(t,i)}}u(g0,"IkNodeWatcher");_S(g0,"IkNodeWatcher");var Sk=Object.defineProperty,Ak=u((n,e)=>Sk(n,"name",{value:e,configurable:!0}),"__name$1o");class v0{onValueChanged(e,t,i){i===Nr&&(t.get(Nr).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(v0,"ImageWatcher");Ak(v0,"ImageWatcher");var Ck=Object.defineProperty,Tk=u((n,e)=>Ck(n,"name",{value:e,configurable:!0}),"__name$1n");class y0{onValueChanged(e,t,i){i===zr?t.get(zr).dirty=!0:i===kr&&(t.get(kr).dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){}}u(y0,"ImportModelWatcher");Tk(y0,"ImportModelWatcher");var Ek=Object.defineProperty,Pk=u((n,e)=>Ek(n,"name",{value:e,configurable:!0}),"__name$1m");class _0{onValueChanged(e,t,i){i===Kn&&t.forEach(s=>s.dirty=!0)}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}onMoved(e,t,i,s){t.forEach(r=>r.dirty=!0)}}u(_0,"OpacityWatcher");Pk(_0,"OpacityWatcher");var Ik=Object.defineProperty,Rk=u((n,e)=>Ik(n,"name",{value:e,configurable:!0}),"__name$1l");const Dk=[je,bt,Bt];class x0{onValueChanged(e,t,i){if(Dk.includes(i)&&t.has(Ce)){t.dirty=!0;const s=t.get(Ce);s.localTransformChanged=!0,s.worldTransformChanged=!0}t.type==="Target"&&t.parent&&(t.parent.dirty=!0)}onMoved(e,t,i,s){if(t.has(Ce)){t.dirty=!0;const r=t.get(Ce);r.parentChanged=!0,r.worldTransformChanged=!0}}onChildAdded(e,t,i){}onBeforeChildRemoved(e,t,i){}}u(x0,"TransformWatcher");Rk(x0,"TransformWatcher");var Lk=Object.defineProperty,Fk=u((n,e)=>Lk(n,"name",{value:e,configurable:!0}),"__name$1k");class vu{constructor(){M(this,"nodesMap",new Map);M(this,"nodes",[]);M(this,"cameraFov",45);M(this,"cameraPerspective",!0);M(this,"cameras",[]);M(this,"watchers",[new x0,new g0,new _0,new v0,new y0,new f0,new m0,new p0]);M(this,"dirty",!0);M(this,"instanceDirty",!0);M(this,"referenceMap",new Map);M(this,"selected",[])}reset(){this.selected=[],this.dirty=!1,this.instanceDirty=!1,this.referenceMap.clear();for(let e of this.nodes.map(t=>t.id))this.removeNode(e);this.cameras=[]}addSelection(e){this.selected.includes(e)||this.selected.push(e)}isNodeExists(e,t){if(t){const i=this.nodesMap.get(e);return(i==null?void 0:i.type)===t}return this.nodesMap.has(e)}forEach(e){for(let t of this.nodes)if(t.forEach(e)===!1)return!1}getNode(e){const t=this.nodesMap.get(e);if(!t)throw new Error(`Node #${e} does not exist`);return t}getSelectedNodes(){return this.selected.map(e=>this.getNode(e))}getTopmostSelectedNodes(){const e=[];for(let t of this.selected){const i=this.getNode(t);let s=!0;for(let r=i.parent;r;r=r.parent)if(this.selected.includes(r.id)){s=!1;break}s&&e.push(i)}return e}createNode(e,t,i=null,s=null,r,o){if(this.isNodeExists(e))throw new Error(`Node #${e} already exists`);const a=fi(t),l=new Do;l.id=e,l.type=t;for(let h of a.components)l.components[h.name]=new h;if(l.parent=i,this.instanceMeshUpdated(e,!0),o&&(l.instanceId=o,this.referenceMap.has(o)?this.referenceMap.get(o).push(e):this.referenceMap.set(o,[e]),this.instanceDirty=!0),r)for(let h in r){let d=l.components[h];if(!d&&o&&h===Ys.name&&(d=l.components[h]=new Ys),d){const f=Ii(h);d.value=f.clone?f.clone(r[h]):r[h]}}const c=i?i.children:this.nodes;if(s!=null?c.splice(s,0,l):c.push(l),this.nodesMap.set(e,l),i)for(let h of this.watchers)h.onChildAdded(this,i,l);return this.dirty=!0,l}removeNode(e){var r;if(!this.isNodeExists(e))return;const t=this.getNode(e);if(t.deleted=!0,t.parent)for(let o of this.watchers)o.onBeforeChildRemoved(this,t.parent,t);if(this.instanceMeshUpdated(e,!0),t.instanceId){const o=this.referenceMap.get(t.instanceId);o&&this.referenceMap.set(t.instanceId,o.filter(a=>a!==e)),this.instanceDirty=!0}for(let o in t.mirrorGeometry)(r=t.mirrorGeometry[o])==null||r.dispose(),delete t.mirrorGeometry[o];t.forEach(o=>{this.nodesMap.delete(o.id);const a=this.selected.indexOf(o.id);a>=0&&this.selected.splice(a,1)});const i=t.parent?t.parent.children:this.nodes,s=i.indexOf(t);s>=0&&i.splice(s,1),t.forEach(o=>{for(let a in o.components)o.components[a].onRemoved()}),this.dirty=!0}moveNode(e,t,i,s){const r=e.parent,o=r?r.children:this.nodes;o.splice(o.indexOf(e),1);const a=t?t.children:this.nodes;if(e.parent=t,i){const l=a.indexOf(i);s?a.splice(l+1,0,e):a.splice(l,0,e)}else s?a.push(e):a.unshift(e);e.dirty=!0,this.dirty=!0;for(let l of this.watchers)l.onMoved(this,e,r,t)}setValue(e,t,i){e.get(t).value=i,e.dirty=!0,this.dirty=!0;for(let r of this.watchers)r.onValueChanged(this,e,t);if(Ii(t.name).autoCopy){const r=this.referenceMap.get(e.id);if(r)for(let o of r){const a=this.getNode(o);a.get(t).value=i,a.dirty=!0;for(let l of this.watchers)l.onValueChanged(this,a,t)}}}updateVertices(e,t,i,s){const r=e.get(t),o=r.value,a=e.get(Ce);if(a.mesh){const l=a.mesh;if(t===Tn){l.updateVertices(i,s);for(let c=0,h=o.length;c<h;++c)o[c]=l.aPosition[c]}else if(t===ls){l.updateColors(i,s);for(let c=0,h=o.length;c<h;++c)o[c]=l.aColor[c]}}for(let l=0,c=i.length;l<c;++l){const h=i[l];for(let d=0;d<3;++d)o[h*3+d]=s[l*3+d]}e.dirty=!0,this.dirty=!0,r.partialUpdate=!0;for(let l of this.watchers)l.onValueChanged(this,e,t)}instanceMeshUpdated(e,t){var s;const i=this.referenceMap.get(e);if(i){this.instanceDirty=!0;for(let r of i)if(this.isNodeExists(r)){const o=this.getNode(r);o.instanceMeshDirty=!0,o.instanceMeshRebuild=t}}if(this.isNodeExists(e)){const r=this.getNode(e);for(let o in r.mirrorGeometry)t&&((s=r.mirrorGeometry[o])==null||s.dispose()),delete r.mirrorGeometry[o]}}}u(vu,"Model");Fk(vu,"Model");var Ok=Object.defineProperty,dd=u((n,e)=>Ok(n,"name",{value:e,configurable:!0}),"__name$1j");const Nk=200;class b0{constructor(e){M(this,"model");M(this,"enableMerge",!0);M(this,"currentFrameRecords",[]);M(this,"redoStack",[]);M(this,"undoStack",[]);M(this,"nextNodeId",0);M(this,"deletedNodes",new Set);M(this,"dirty",!1);M(this,"lastEventTarget",null);M(this,"onMouseDown",u(e=>{this.lastEventTarget=e.target,this.enableMerge=!1},"onMouseDown"));M(this,"onKeyDown",u(e=>{this.lastEventTarget!==e.target&&(this.lastEventTarget=e.target,this.enableMerge=!1)},"onKeyDown"));this.model=e}setup(){window.addEventListener("mousedown",this.onMouseDown),window.addEventListener("keydown",this.onKeyDown)}unload(){window.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("keydown",this.onKeyDown)}clear(){this.dirty=!1,this.currentFrameRecords.length=0,this.redoStack.length=0,this.undoStack.length=0}save(){this.dirty=!1}update(){if(this.nextNodeId=0,!this.currentFrameRecords.length)return;this.redoStack.length=0;const e=[],t=[];let i,s;for(let l of this.currentFrameRecords)e.push(l.redo),t.push(l.undo),i=i||l.getCtx,s=s||l.setCtx;let r=dd(()=>{for(let l of e)l()},"redo"),o=dd(()=>{for(let l of t)l()},"undo");r();const a=this.currentFrameRecords.map(l=>l.hash).sort().join("@");if(this.enableMerge)for(;this.undoStack.length;){const l=this.undoStack[this.undoStack.length-1];if(l.hash===a)s&&l.getCtx?s(l.getCtx()):o=l.undo,this.undoStack.pop();else break}else{const l=this.undoStack[this.undoStack.length-1];l&&!l.hash.endsWith("!")&&(l.hash+="!")}this.enableMerge=!0,this.undoStack.push({hash:a,redo:r,undo:o,getCtx:i,setCtx:s}),this.undoStack.length>=Nk&&this.undoStack.shift(),this.deletedNodes.clear(),this.currentFrameRecords.length=0,this.dirty=!0}undo(){const e=this.undoStack.pop();!e||(this.redoStack.push(e),this.model.selected=[],e.undo(),this.dirty=!0)}redo(){const e=this.redoStack.pop();!e||(this.undoStack.push(e),e.redo(),this.dirty=!0)}getNextNodeId(){if(this.nextNodeId)return this.nextNodeId;let e=0;return this.model.forEach(t=>{e=Math.max(e,t.id)}),e}createNode(e){const t=this.getNextNodeId()+1;if(this.currentFrameRecords.push({hash:"$createNode",redo:()=>{let i=t;if(e.parentId){let r=this.model.getNode(e.parentId);for(;r;r=r.parent)r.expanded=!0}const s=this.model.createNode(i++,e.type,e.parentId?this.model.getNode(e.parentId):null,null,e.data,e.instanceId);if(e.expanded!=null&&(s.expanded=e.expanded),(e.selected==null||e.selected)&&this.model.addSelection(s.id),e.children){const r=[];for(let o of e.children)r.push([s,o]);for(;r.length;){const o=r.shift();if(!o)break;const a=o[0],l=o[1],c=this.model.createNode(i++,l.type,a,null,l.data,l.instanceId);if(l.expanded!=null&&(c.expanded=l.expanded),(l.selected==null||l.selected)&&this.model.addSelection(c.id),l.children){const h=[];for(let d of l.children)h.push([c,d]);r.unshift(...h)}}}},undo:()=>{this.model.removeNode(t)}}),this.enableMerge=!1,this.nextNodeId=t,e.children){const i=[...e.children];for(;;){const s=i.pop();if(!s)break;this.nextNodeId+=1,s.children&&i.push(...s.children)}}return t}removeNode(e){if(!this.model.isNodeExists(e)||this.deletedNodes.has(e))return;class t{constructor(a,l){M(this,"id");M(this,"type");M(this,"expanded");M(this,"parentId",0);M(this,"instanceId",0);M(this,"index",0);M(this,"data");M(this,"children");this.id=a.id,this.type=a.type,this.expanded=a.expanded,a.parent&&(this.parentId=a.parent.id),this.instanceId=a.instanceId;const c=a.parent?a.parent.children:l.nodes;this.index=c.indexOf(a),this.data=a.getComponentData(),this.children=a.children.map(h=>new t(h,l))}}u(t,"NodeRecord"),dd(t,"NodeRecord");const i=new t(this.model.getNode(e),this.model),s=[i];for(;s.length;){const o=s.pop();if(!o)break;this.deletedNodes.add(o.id),s.push(...o.children)}this.currentFrameRecords.push({hash:"$removeNode",redo:()=>{this.model.removeNode(e)},undo:()=>{const o=this.model.createNode(i.id,i.type,i.parentId?this.model.getNode(i.parentId):null,i.index,i.data,i.instanceId);this.model.addSelection(o.id);const a=[[o,i.children]];for(;;){const l=a.pop();if(!l)break;const c=l[0],h=l[1];for(let d of h){const f=this.model.createNode(d.id,d.type,c,null,d.data,d.instanceId);f.expanded=d.expanded,this.model.addSelection(f.id),d.children.length&&a.push([f,d.children])}}}}),this.enableMerge=!1;const r=this.model.referenceMap.get(e);if(r)for(let o of r)this.removeNode(o)}moveNode(e,t,i,s,r){const o=e.id,a=t?t.id:0,l=i?i.id:0,c=s,h=e.parent?e.parent.id:0;let d=0,f=!1;const p=e.parent?e.parent.children:this.model.nodes,g=p.indexOf(e);if(g>0&&(d=p[g-1].id,f=!0),this.currentFrameRecords.push({hash:"$moveNode",redo:()=>{this.model.moveNode(this.model.getNode(o),a?this.model.getNode(a):null,l?this.model.getNode(l):null,c)},undo:()=>{this.model.moveNode(this.model.getNode(o),h?this.model.getNode(h):null,d?this.model.getNode(d):null,f),this.model.addSelection(o)}}),this.enableMerge=!1,r&&h!==a){if(e.has(je)||e.has(bt)||e.has(Bt)){let m=e.getWorldMatrix();if(t&&(m=new Me().copy(t.getWorldMatrix()).invert().multiply(m)),e.has(je)){const v=new b,y=new Ve,w=new b;m.decompose(v,y,w),e.has(je)&&this.setValue(e,je,v),e.has(bt)&&this.setValue(e,bt,new mt().setFromQuaternion(y)),e.has(Bt)&&this.setValue(e,Bt,w.x)}}else if(e.has(nt)){let m=e.getWorldMatrix();t&&(m=new Me().copy(t.getWorldMatrix()).invert().multiply(m));const v=Ro(m),y=e.get(nt).clone();for(let w of y)w.position.applyMatrix4(m),w.radius*=v;this.setValue(e,nt,y)}}}setValue(e,t,i,s){const r=e.id,o=e.value(t);if(o===i)return!1;const a=Ii(t.name);return a.equal&&a.equal(o,i)?!1:(s=r+"#"+(s||t.name),this.currentFrameRecords=this.currentFrameRecords.filter(l=>l.hash!==s),this.currentFrameRecords.push({hash:s,redo:()=>{this.model.setValue(this.model.getNode(r),t,i)},undo:()=>{this.model.setValue(this.model.getNode(r),t,o),this.model.addSelection(r)}}),!0)}updateVertices(e,t,i,s){if(!i.length)return!1;const r=e.id,o=e.value(t);let a=new Float32Array(s.length);for(let f=0,p=i.length;f<p;++f){const g=i[f];for(let m=0;m<3;++m)a[f*3+m]=o[g*3+m]}let l=i,c=i,h=s;const d=r+"#"+t.name;return this.currentFrameRecords=this.currentFrameRecords.filter(f=>f.hash!==d),this.currentFrameRecords.push({hash:d,redo:()=>{this.model.updateVertices(this.model.getNode(r),t,c,h)},undo:()=>{this.model.updateVertices(this.model.getNode(r),t,l,a),this.model.addSelection(r)},setCtx:([f,p,g,m])=>{{const v=new Set([...f,...l]),y=new Float32Array(v.size*3);for(let x=0,C=p.length;x<C;++x)y[x]=p[x];const w=[...f],_=new Set(f);let A=p.length;for(let x=0,C=l.length;x<C;++x){const T=l[x];if(!_.has(T)){w.push(T);for(let S=0;S<3;++S)y[A+S]=a[x*3+S];A+=3}}l=w,a=y}{const v=new Set([...c,...g]),y=new Float32Array(v.size*3);for(let x=0,C=h.length;x<C;++x)y[x]=h[x];const w=[...c],_=new Set(c);let A=h.length;for(let x=0,C=g.length;x<C;++x){const T=g[x];if(!_.has(T)){w.push(T);for(let S=0;S<3;++S)y[A+S]=m[x*3+S];A+=3}}c=w,h=y}},getCtx:()=>[l,a,c,h]}),!0}}u(b0,"ModelHistory");dd(b0,"ModelHistory");var kk=Object.defineProperty,zk=u((n,e)=>kk(n,"name",{value:e,configurable:!0}),"__name$1i");class ji{constructor(){M(this,"subSystems",[])}setup(e){}dispose(){}sub(...e){return this.subSystems.push(...e),this}update(e){this.begin(e);for(let t of this.subSystems)t.update(e);this.end(e)}}u(ji,"UpdateSystem");zk(ji,"UpdateSystem");var Bk=Object.defineProperty,Uk=u((n,e)=>Bk(n,"name",{value:e,configurable:!0}),"__name$1h");class w0 extends ji{begin(e){for(let i of e.nextFrameCallbacks)i();e.nextFrameCallbacks.length=0;const t=Date.now();for(let i of e.throttleTasks.entries())i[1].time<=t&&(i[1].callback(),e.throttleTasks.delete(i[0]))}end(e){}}u(w0,"CallbackFireSystem");Uk(w0,"CallbackFireSystem");var Vk=Object.defineProperty,xS=u((n,e)=>Vk(n,"name",{value:e,configurable:!0}),"__name$1g");class Ra{constructor(){M(this,"mouseNdc0",new b);M(this,"rotating",!1);M(this,"eulerX0",0);M(this,"eulerY0",0);M(this,"moving",!1);M(this,"target0",new b);M(this,"mouseRayN0",new b)}}u(Ra,"CameraDraggingState");xS(Ra,"CameraDraggingState");const mh=new b,gh=new b,D_=new b,L_=new b,F_=new b,Hk=40,O_=-20,Op=2.5;class M0 extends ji{constructor(){super(...arguments);M(this,"states",[new Ra,new Ra,new Ra,new Ra])}begin(t){if(t.disableCameraDraggingThisFrame){t.disableCameraDraggingThisFrame=!1;return}let i=-1;for(let s of t.views){const r=this.states[s.index];if(!s.enabled){r.rotating=!1,r.moving=!1;continue}const o=s.input;if(s.index===t.mainViewIndex)if(o.mouseRight)if(r.rotating){const a=s.mouseNdc.x-r.mouseNdc0.x,l=s.mouseNdc.y-r.mouseNdc0.y;s.camera.alpha=Math.max(-Math.PI/2,Math.min(Math.PI/2,r.eulerX0+l*Math.PI/2)),s.camera.beta=(r.eulerY0-a*Math.PI/2)%(Math.PI*2)}else o.pointerOver&&o.mouseRightDownThisFrame&&(r.rotating=!0,r.mouseNdc0.copy(s.mouseNdc),r.eulerX0=s.camera.alpha,r.eulerY0=s.camera.beta);else r.rotating=!1;o.mouseMiddle?r.moving?(mh.copy(r.mouseNdc0),mh.z=-1,mh.unproject(s.camera.get()),gh.copy(r.mouseNdc0),gh.z=1,gh.unproject(s.camera.get()),pn(D_,mh,gh,r.target0,r.mouseRayN0),pn(L_,s.mouseRay0,s.mouseRay1,r.target0,r.mouseRayN0),F_.subVectors(L_,D_),s.camera.target.subVectors(r.target0,F_),i=s.index):o.pointerOver&&o.mouseMiddleDownThisFrame&&(r.moving=!0,r.target0.copy(s.camera.target),r.mouseNdc0.copy(s.mouseNdc),r.mouseRayN0.copy(s.mouseRayN)):r.moving=!1,o.wheelDetY&&o.pointerOver&&(s.zoomLevel=Math.max(O_,Math.min(Hk,s.zoomLevel+o.wheelDetY)),i=s.index)}if(i>=0){const s=t.views[i];for(let r of t.views)r.index!==i&&r.enabled&&(r.camera.target.copy(s.camera.target),r.zoomLevel=s.zoomLevel)}for(let s of t.views)s.enabled&&(s.camera.distance=s.zoomLevel>=0?Op+s.zoomLevel:Op-s.zoomLevel/O_*Op)}end(t){}}u(M0,"CameraDraggingSystem");xS(M0,"CameraDraggingSystem");var Gk=Object.defineProperty,$k=u((n,e)=>Gk(n,"name",{value:e,configurable:!0}),"__name$1f");class S0 extends ji{begin(e){e.history.update()}end(e){}}u(S0,"HistorySystem");$k(S0,"HistorySystem");var Wk=Object.defineProperty,jk=u((n,e)=>Wk(n,"name",{value:e,configurable:!0}),"__name$1e");class A0 extends ji{constructor(){super(...arguments);M(this,"showIkBones",!1)}setup(t){this.showIkBones=t.options.showIkBones}begin(t){t=t.readonlyRef(),t.options.showIkBones!==this.showIkBones&&(this.showIkBones=t.options.showIkBones,t.model.forEach(i=>{if(i.has(vt)){const s=i.get(vt);s.boneMesh&&(s.boneMesh.visible=t.options.showIkBones)}}))}end(t){}}u(A0,"IkBoneVisibleUpdateSystem");jk(A0,"IkBoneVisibleUpdateSystem");var Xk=Object.defineProperty,Yk=u((n,e)=>Xk(n,"name",{value:e,configurable:!0}),"__name$1d");const qk=new Set(["AmbientLight","HemisphereLight","DirectionalLight","PointLight","SpotLight"]);class C0 extends ji{constructor(){super(...arguments);M(this,"ambientLight",new Cf(16777215,.5))}setup(t){t.scene.add(this.ambientLight)}begin(t){if(t=t.readonlyRef(),t.options.shadingMode==="solid"){t.renderer.physicallyCorrectLights=!1,this.ambientLight.visible=!0;for(let r of t.views){if(!r.enabled)continue;const o=r.defaultLight;o.intensity=.5,o.position.copy(r.camera._position),o.up.copy(r.camera._up),o.lookAt(r.camera.target)}}else this.ambientLight.visible=!1,t.renderer.physicallyCorrectLights=!0;const i=t.options.shadingMode==="rendered",s=t.options.showLightHelpers;for(let r of t.model.nodes)if(qk.has(r.type)){const o=r.value(Ce),a=r.visible;if(o&&(o.visible=i&&a),r.has(ni)){const l=r.get(ni),c=t.model.selected.includes(r.id)||!!r.children.length&&t.model.selected.includes(r.children[0].id);l.value&&(l.value.visible=a&&(s||c)),l.camera&&(l.camera.visible=i&&o.castShadow&&a&&(s||c))}}}end(t){}}u(C0,"LightUpdateSystem");Yk(C0,"LightUpdateSystem");var Kk=Object.defineProperty,Zk=u((n,e)=>Kk(n,"name",{value:e,configurable:!0}),"__name$1c");class T0{update(e,t){if(t.instanceId||t.type!=="Box")return;const i=t.get(is);if(!i.dirty)return;i.dirty=!1;const s=t.get(Ce),r=i.value,o=new Qt(r.x,r.y,r.z);if(s.value){const a=s.value;a.geometry.dispose(),a.geometry=o}else s.value=new Ee(o,new Mf),s.value.userData={node:t},s.parentChanged=!0,s.localTransformChanged=!0;o.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)}}u(T0,"BoxUpdateFilter");Zk(T0,"BoxUpdateFilter");var Qk=Object.defineProperty,Jk=u((n,e)=>Qk(n,"name",{value:e,configurable:!0}),"__name$1b");class Cs{constructor(e=0){M(this,"bits");this.bits=new Uint32Array((e>>>5)+1)}checkCapacity(e){if(e>this.bits.length){const t=new Uint32Array(e);t.set(this.bits,0),this.bits=t}}expandCapacity(e){this.checkCapacity((e>>>5)+1)}clear(){for(let e=0,t=this.bits.length;e<t;++e)this.bits[e]=0}set(e){const t=e>>>5;this.checkCapacity(t+1),this.bits[t]=(this.bits[t]|1<<(e&31))>>>0}get(e){const t=e>>>5;return t>=this.bits.length?!1:(this.bits[t]&1<<(e&31))!==0}clearBit(e){const t=e>>>5;t>=this.bits.length||(this.bits[t]=(this.bits[t]&~(1<<(e&31)))>>>0)}setBit(e,t){t?this.set(e):this.clearBit(e)}and(e){const t=Math.min(this.bits.length,e.bits.length);for(let i=0;i<t;++i)this.bits[i]=(this.bits[i]&e.bits[i])>>>0;if(this.bits.length>t)for(let i=t,s=this.bits.length;i<s;++i)this.bits[i]=0}or(e){const t=Math.min(this.bits.length,e.bits.length);for(let i=0;i<t;++i)this.bits[i]=(this.bits[i]|e.bits[i])>>>0;if(e.bits.length>t){this.checkCapacity(e.bits.length);for(let i=t,s=e.bits.length;i<s;++i)this.bits[i]=e.bits[i]}}equals(e){const t=this.bits.length>=e.bits.length?this:e,i=t===this?e:this;for(let s=0,r=i.bits.length;s<r;++s)if(t.bits[s]!==i.bits[s])return!1;for(let s=t.bits.length-i.bits.length+1,r=t.bits.length;s<r;++s)if(t.bits[s])return!1;return!0}intersects(e){for(let t=0,i=Math.min(this.bits.length,e.bits.length);t<i;++t)if((this.bits[t]&e.bits[t])!==0)return!0;return!1}containsAll(e){if(e.bits.length>this.bits.length){for(let t=this.bits.length,i=e.bits.length;t<i;++t)if(e.bits[t]!==0)return!1}for(let t=0,i=Math.min(this.bits.length,e.bits.length);t<i;++t)if((this.bits[t]&e.bits[t])!==e.bits[t])return!1;return!0}isEmpty(){for(let e=0,t=this.bits.length;e<t;++e)if(this.bits[e]!==0)return!1;return!0}clone(){const e=new Cs;return e.bits=this.bits.slice(),e}}u(Cs,"Bits");Jk(Cs,"Bits");var ez=Object.defineProperty,bS=u((n,e)=>ez(n,"name",{value:e,configurable:!0}),"__name$1a");const Co=new DataView(new ArrayBuffer(12)),N_=new Array(8),k_=new Array(8);function qm(n,e){Co.setUint32(0,n),Co.setUint32(4,e);for(let t=0;t<8;++t)N_[t]=String.fromCharCode(Co.getUint8(t));return N_.join("")}u(qm,"hashUint32x2");bS(qm,"hashUint32x2");function E0(n,e,t){Co.setFloat32(0,n||0),Co.setFloat32(4,e||0),Co.setFloat32(8,t||0);for(let i=0;i<12;++i)k_[i]=String.fromCharCode(Co.getUint8(i));return k_.join("")}u(E0,"hashFloat32x3");bS(E0,"hashFloat32x3");var tz=Object.defineProperty,wS=u((n,e)=>tz(n,"name",{value:e,configurable:!0}),"__name$19");const Pn=new b,Np=new Fn,vh=new Fn,z_=new b,B_=new b,U_=new b,nz=new b;function Km(n,e){if(e.isLeaf=!1,e.depth>=ws.MAX_DEPTH){e.isLeaf=!0;return}if(e.indices.length<=ws.MAX_TRI_PER_NODE){e.isLeaf=!0;return}if(!e.indices.length){e.isLeaf=!0;return}vh.makeEmpty();for(let t of e.indices)vh.expandByPoint(n.getTriangleCenter(Pn,t));e.splitCenter.copy(vh.min).add(vh.max).multiplyScalar(.5),e.children.length=0;for(let t=0;t<8;++t){const i=new ws;i.depth=e.depth+1,e.children.push(i)}for(let t of e.indices)n.getTriangleCenter(Pn,t),Pn.x<e.splitCenter.x?Pn.y<e.splitCenter.y?Pn.z<e.splitCenter.z?e.children[0].indices.push(t):e.children[1].indices.push(t):Pn.z<e.splitCenter.z?e.children[2].indices.push(t):e.children[3].indices.push(t):Pn.y<e.splitCenter.y?Pn.z<e.splitCenter.z?e.children[4].indices.push(t):e.children[5].indices.push(t):Pn.z<e.splitCenter.z?e.children[6].indices.push(t):e.children[7].indices.push(t)}u(Km,"constructChildren");wS(Km,"constructChildren");const jd=class{constructor(){M(this,"depth",1);M(this,"children",[]);M(this,"box",new Fn);M(this,"splitCenter",new b);M(this,"isLeaf",!1);M(this,"indices",[])}build(e){this.indices.length=0;for(let i=0;i<e.triNum;++i)this.indices.push(i);const t=[this];for(;t.length;){const i=t.pop();if(!i)break;i.recomputeBox(e),Km(e,i),i.isLeaf||t.push(...i.children)}}recomputeBox(e){this.box.makeEmpty();for(let t of this.indices)this.box.union(e.getTriangleBox(Np,t));this.box.expandByScalar(1e-7)}update(e,t){if(!t.length)return;const i=new Cs(e.triNum);for(let r of t)i.set(r);const s=new Set;{const r=[this];for(;r.length;){const o=r.pop();if(!o)break;let a=!1;if(o.depth===1)a=!0;else{const l=o.indices.filter(c=>!i.get(c));a=l.length!==o.indices.length,o.indices=l}a&&(o.indices.length?(s.add(o),r.push(...o.children)):(o.box.makeEmpty(),o.isLeaf=!0,o.children.length=0))}}{const r=[[this,t]];for(;r.length;){const o=r.pop();if(!o)break;const a=o[0],l=o[1];if(s.add(a),a.depth!==1&&a.indices.push(...l),a.isLeaf){if(a.indices.length<=jd.MAX_TRI_PER_NODE||a.depth>=jd.MAX_DEPTH)continue;const y=[a];for(;y.length;){const w=y.pop();if(!w)break;w.recomputeBox(e),Km(e,w),w.isLeaf||y.push(...w.children)}continue}const c=[],h=[],d=[],f=[],p=[],g=[],m=[],v=[];for(let y of l)e.getTriangleCenter(Pn,y),Pn.x<a.splitCenter.x?Pn.y<a.splitCenter.y?Pn.z<a.splitCenter.z?c.push(y):h.push(y):Pn.z<a.splitCenter.z?d.push(y):f.push(y):Pn.y<a.splitCenter.y?Pn.z<a.splitCenter.z?p.push(y):g.push(y):Pn.z<a.splitCenter.z?m.push(y):v.push(y);c.length&&r.push([a.children[0],c]),h.length&&r.push([a.children[1],h]),d.length&&r.push([a.children[2],d]),f.length&&r.push([a.children[3],f]),p.length&&r.push([a.children[4],p]),g.length&&r.push([a.children[5],g]),m.length&&r.push([a.children[6],m]),v.length&&r.push([a.children[7],v])}}for(let r of s)r.recomputeBox(e)}raycast(e,t,i){const s=[],r=[this],o=1/t.direction.x,a=1/t.direction.y,l=1/t.direction.z;for(;r.length;){const c=r.pop();if(!c)break;const h=(c.box.min.x-t.origin.x)*o,d=(c.box.max.x-t.origin.x)*o,f=(c.box.min.y-t.origin.y)*a,p=(c.box.max.y-t.origin.y)*a,g=(c.box.min.z-t.origin.z)*l,m=(c.box.max.z-t.origin.z)*l,v=Math.max(Math.min(h,d),Math.min(f,p),Math.min(g,m)),y=Math.min(Math.max(h,d),Math.max(f,p),Math.max(g,m));if(!(y<0||v>y))if(c.isLeaf)for(let w of c.indices){e.getTriangle(z_,B_,U_,w);const _=t.intersectTriangle(z_,B_,U_,i,nz);if(_){const A=new b().copy(_),x=e.getNormal(new b,w),C=t.origin.distanceTo(A);s.push({point:A,normal:x,distance:C,triangleIndex:w})}}else r.push(...c.children)}return s.sort((c,h)=>c.distance-h.distance)}intersectSphere(e,t){const i=[this],s=[];for(;i.length;){const r=i.pop();if(!r)break;if(!!r.box.intersectsSphere(t))if(r.isLeaf)for(let o of r.indices)e.getTriangleBox(Np,o),Np.intersectsSphere(t)&&s.push(o);else i.push(...r.children)}return s}};let ws=jd;u(ws,"OctreeNode"),M(ws,"MAX_DEPTH",8),M(ws,"MAX_TRI_PER_NODE",100);wS(ws,"OctreeNode");var iz=Object.defineProperty,MS=u((n,e)=>iz(n,"name",{value:e,configurable:!0}),"__name$18");const en=new b,jt=new b,tn=new b,yh=new b,fs=new b,ks=new b,sz=new b,An=1e-7;function fd(n,e){let t=n.x,i=n.y,s=n.z,r=e.x,o=e.y,a=e.z;return t=Math.round(t/An)*An,i=Math.round(i/An)*An,s=Math.round(s/An)*An,r=Math.round(r/An)*An,o=Math.round(o/An)*An,a=Math.round(a/An)*An,t===r&&i===o&&s===a}u(fd,"isSameVertex");MS(fd,"isSameVertex");class P0{constructor(){M(this,"aPosition",new Float32Array);M(this,"aColor",new Float32Array);M(this,"aNormal",new Float32Array);M(this,"triCenter",new Float32Array);M(this,"triBox",new Float32Array);M(this,"triNum",0);M(this,"sharedVertexMap",new Uint32Array);M(this,"sharedVertexIndices",new Map);M(this,"edgeNeighborMap",new Uint32Array);M(this,"holes",new Uint8Array);M(this,"octree",new ws);M(this,"dirtyTriangles",[]);M(this,"dirtyTrianglesMask",new Cs);M(this,"positionNeedsUpdate",!1);M(this,"colorNeedsUpdate",!1)}buildFromTriangles(e,t){const i=this.aPosition=new Float32Array(e.length),s=this.aNormal=new Float32Array(e.length),r=this.aColor=new Float32Array(e.length);(t==null?void 0:t.length)!==r.length&&(t=void 0);let o=0;for(let a=0,l=e.length/9;a<l;++a)if(en.fromArray(e,a*9),jt.fromArray(e,a*9+3),tn.fromArray(e,a*9+6),!(fd(en,jt)||fd(en,tn)||fd(jt,tn))){for(let c=0;c<9;++c)i[o*9+c]=e[a*9+c];if(t)for(let c=0;c<9;++c)r[o*9+c]=t[a*9+c];else for(let c=0;c<9;++c)r[o*9+c]=1;yh.subVectors(en,jt),fs.subVectors(tn,jt),fs.cross(yh).normalize();for(let c=0;c<3;++c){const h=o*9+c*3;s[h]=fs.x,s[h+1]=fs.y,s[h+2]=fs.z}o+=1}o<e.length/9&&(this.aPosition=i.subarray(0,o*9),this.aNormal=s.subarray(0,o*9),this.aColor=r.subarray(0,o*9),console.info(`Discard ${e.length/9-o} zero area triangles`)),this.init()}init(){const e=this.aPosition,t=this.triNum=e.length/9,i=this.triCenter=new Float32Array(t*3),s=this.triBox=new Float32Array(t*6);for(let r=0;r<t;++r)en.fromArray(e,r*9),jt.fromArray(e,r*9+3),tn.fromArray(e,r*9+6),ks.copy(en).add(jt).add(tn).multiplyScalar(1/3),i[r*3]=ks.x,i[r*3+1]=ks.y,i[r*3+2]=ks.z,s[r*6]=Math.min(en.x,jt.x,tn.x),s[r*6+1]=Math.min(en.y,jt.y,tn.y),s[r*6+2]=Math.min(en.z,jt.z,tn.z),s[r*6+3]=Math.max(en.x,jt.x,tn.x),s[r*6+4]=Math.max(en.y,jt.y,tn.y),s[r*6+5]=Math.max(en.z,jt.z,tn.z);this.buildTriangleNeighborEdgeMap(),this.octree.build(this),this.dirtyTrianglesMask.expandCapacity(t)}buildTriangleNeighborEdgeMap(){const e=this.triNum,t=this.aPosition,i=this.sharedVertexMap=new Uint32Array(e*3),s=this.sharedVertexIndices;s.clear();const r=new Map;for(let p=0,g=e*3;p<g;++p){let m=t[p*3],v=t[p*3+1],y=t[p*3+2];m=Math.round(m/An)*An,v=Math.round(v/An)*An,y=Math.round(y/An)*An;const w=E0(m,v,y);let _=r.get(w);_==null?(_=p,r.set(w,_),s.set(_,[])):s.get(_).push(p),i[p]=_}const o=new Map,a=new Uint8Array(e);let l=0,c=0;for(let p=0;p<e;++p){let g=!1;for(let m=0;m<3;++m){const v=p*3+m,y=i[v],w=i[p*3+(m+1)%3];if(y===w){g=!0;break}}if(g){c+=1,a[p]=1;continue}for(let m=0;m<3;++m){const v=p*3+m,y=i[v],w=i[p*3+(m+1)%3],_=qm(y,w);o.get(_)==null?o.set(_,v):l+=1}}c&&console.warn(`Mesh has ${c} zero area triangles`),l&&console.warn(`Mesh has ${l} duplicate edges (embedded faces may exist)`);const h=this.edgeNeighborMap=new Uint32Array(e*3),d=this.holes=new Uint8Array(e*3);let f=0;for(let p=0;p<e;++p)if(!a[p])for(let g=0;g<3;++g){const m=p*3+g,v=i[m],y=i[p*3+(g+1)%3],w=qm(y,v),_=o.get(w);_==null?(d[m]=1,f+=1):h[m]=_}f&&console.warn(`Mesh has ${f} edges border hole`)}getTriangleCenter(e,t){return e.fromArray(this.triCenter,t*3),e}getTriangleBox(e,t){return e.min.fromArray(this.triBox,t*6),e.max.fromArray(this.triBox,t*6+3),e}getTriangle(e,t,i,s){e.fromArray(this.aPosition,this.sharedVertexMap[s*3]*3),t.fromArray(this.aPosition,this.sharedVertexMap[s*3+1]*3),i.fromArray(this.aPosition,this.sharedVertexMap[s*3+2]*3)}getVertex(e,t){return e.fromArray(this.aPosition,t*3)}getNormal(e,t){return e.fromArray(this.aNormal,t*3*3),e}getAverageNormal(e,t){e.set(0,0,0);for(let i of t)e.add(this.getNormal(sz,i));return e.normalize()}getAverageCenter(e,t){e.set(0,0,0);for(let i of t)e.add(this.getTriangleCenter(ks,i));return e.divideScalar(t.length)}toThree(e){if(e){const t=e,i=t.geometry.getAttribute("position");if(i.array===this.aPosition){if(this.positionNeedsUpdate){this.positionNeedsUpdate=!1,i.needsUpdate=!0;const s=t.geometry.getAttribute("normal");s.needsUpdate=!0}if(this.colorNeedsUpdate){this.colorNeedsUpdate=!1;const s=t.geometry.getAttribute("color");s.needsUpdate=!0}}else t.geometry.dispose(),t.geometry=new Qe,t.geometry.setAttribute("position",new Fe(this.aPosition,3)),t.geometry.setAttribute("normal",new Fe(this.aNormal,3)),t.geometry.setAttribute("color",new Fe(this.aColor,3));return t}else return new Ee(new Qe().setAttribute("position",new fn(this.aPosition,3)).setAttribute("normal",new fn(this.aNormal,3)).setAttribute("color",new fn(this.aColor,3)),new Mf({vertexColors:!0}))}raycast(e,t){return this.octree.raycast(this,e,t)}intersectSphere(e){return this.octree.intersectSphere(this,e)}getVertexTriangleIndex(e){return(e-e%3)/3}markTriangleDirty(e){this.dirtyTrianglesMask.get(e)||(this.dirtyTrianglesMask.set(e),this.dirtyTriangles.push(e))}updateVertices(e,t){const i=this.aPosition;for(let s=0,r=e.length;s<r;++s){const o=this.sharedVertexMap[e[s]];this.markTriangleDirty(this.getVertexTriangleIndex(o));for(let l=0;l<3;++l)i[o*3+l]=t[s*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a){this.markTriangleDirty(this.getVertexTriangleIndex(l));for(let c=0;c<3;++c)i[l*3+c]=t[s*3+c]}}this.positionNeedsUpdate=!0}updateColors(e,t){const i=this.aColor;for(let s=0,r=e.length;s<r;++s){const o=this.sharedVertexMap[e[s]];for(let l=0;l<3;++l)i[o*3+l]=t[s*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a)for(let c=0;c<3;++c)i[l*3+c]=t[s*3+c]}this.colorNeedsUpdate=!0}update(e){const t=this.dirtyTriangles,i=this.aPosition,s=this.aNormal,r=this.triCenter,o=this.triBox;let a=0,l=0,c=0,h=0,d=0,f=0,p=!1;if(e!=null&&e.boundingSphere){p=!0;const g=e.boundingSphere.center,m=e.boundingSphere.radius;a=g.x-m,l=g.y-m,c=g.z-m,h=g.x+m,d=g.y+m,f=g.z+m}for(let g of t){en.fromArray(i,g*9),jt.fromArray(i,g*9+3),tn.fromArray(i,g*9+6),yh.subVectors(en,jt),fs.subVectors(tn,jt),fs.cross(yh).normalize();for(let m=0;m<3;++m){const v=g*9+m*3;s[v]=fs.x,s[v+1]=fs.y,s[v+2]=fs.z}ks.copy(en).add(jt).add(tn).multiplyScalar(1/3),r[g*3]=ks.x,r[g*3+1]=ks.y,r[g*3+2]=ks.z,o[g*6]=Math.min(en.x,jt.x,tn.x),o[g*6+1]=Math.min(en.y,jt.y,tn.y),o[g*6+2]=Math.min(en.z,jt.z,tn.z),o[g*6+3]=Math.max(en.x,jt.x,tn.x),o[g*6+4]=Math.max(en.y,jt.y,tn.y),o[g*6+5]=Math.max(en.z,jt.z,tn.z),p&&(a=Math.min(o[g*6],a),l=Math.min(o[g*6+1],l),c=Math.min(o[g*6+2],c),h=Math.max(o[g*6+3],h),d=Math.max(o[g*6+4],d),f=Math.max(o[g*6+5],f))}if(p){const g=e.boundingSphere;g.center.set((h+a)/2,(d+l)/2,(f+c)/2),g.radius=Math.max(h-g.center.x,g.center.x-a,d-g.center.y,g.center.y-l,f-g.center.z,g.center.z-c)}this.octree.update(this,t),this.dirtyTriangles.length=0,this.dirtyTrianglesMask.clear()}}u(P0,"DynamicMesh");MS(P0,"DynamicMesh");var rz=Object.defineProperty,SS=u((n,e)=>rz(n,"name",{value:e,configurable:!0}),"__name$17");const kp=new Int8Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),_i=new Uint16Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);function Si(n,e){return n/(n-e)}u(Si,"getAlpha");SS(Si,"getAlpha");const qe=new Float32Array(12*3),Ke=new Float32Array(12*3),ke=new b,Gt=new b;function I0(n,e,t,i,s,r,o,a,l,c,h,d,f,p,g,m,v){const y=a[c],w=a[h],_=a[d],A=a[f],x=a[p],C=a[g],T=a[m],S=a[v],I=!!(t&&l);let D=0;if(y<0&&(D|=1<<0),w<0&&(D|=1<<1),_<0&&(D|=1<<2),A<0&&(D|=1<<3),x<0&&(D|=1<<4),C<0&&(D|=1<<5),T<0&&(D|=1<<6),S<0&&(D|=1<<7),_i[D]!==0){if(_i[D]&1<<0){const B=Si(y,w);qe[0]=i+B*o,qe[1]=s,qe[2]=r,I&&(ke.fromArray(l,c*3),Gt.fromArray(l,h*3),ke.lerp(Gt,B),Ke[0]=ke.x,Ke[1]=ke.y,Ke[2]=ke.z)}if(_i[D]&1<<1){const B=Si(w,_);qe[3]=i+o,qe[3+1]=s,qe[3+2]=r+B*o,I&&(ke.fromArray(l,h*3),Gt.fromArray(l,d*3),ke.lerp(Gt,B),Ke[3]=ke.x,Ke[3+1]=ke.y,Ke[3+2]=ke.z)}if(_i[D]&1<<2){const B=Si(A,_);qe[3*2]=i+B*o,qe[3*2+1]=s,qe[3*2+2]=r+o,I&&(ke.fromArray(l,f*3),Gt.fromArray(l,d*3),ke.lerp(Gt,B),Ke[3*2]=ke.x,Ke[3*2+1]=ke.y,Ke[3*2+2]=ke.z)}if(_i[D]&1<<3){const B=Si(y,A);qe[3*3]=i,qe[3*3+1]=s,qe[3*3+2]=r+B*o,I&&(ke.fromArray(l,c*3),Gt.fromArray(l,f*3),ke.lerp(Gt,B),Ke[3*3]=ke.x,Ke[3*3+1]=ke.y,Ke[3*3+2]=ke.z)}if(_i[D]&1<<4){const B=Si(x,C);qe[3*4]=i+B*o,qe[3*4+1]=s+o,qe[3*4+2]=r,I&&(ke.fromArray(l,p*3),Gt.fromArray(l,g*3),ke.lerp(Gt,B),Ke[3*4]=ke.x,Ke[3*4+1]=ke.y,Ke[3*4+2]=ke.z)}if(_i[D]&1<<5){const B=Si(C,T);qe[3*5]=i+o,qe[3*5+1]=s+o,qe[3*5+2]=r+B*o,I&&(ke.fromArray(l,g*3),Gt.fromArray(l,m*3),ke.lerp(Gt,B),Ke[3*5]=ke.x,Ke[3*5+1]=ke.y,Ke[3*5+2]=ke.z)}if(_i[D]&1<<6){const B=Si(S,T);qe[3*6]=i+B*o,qe[3*6+1]=s+o,qe[3*6+2]=r+o,I&&(ke.fromArray(l,v*3),Gt.fromArray(l,m*3),ke.lerp(Gt,B),Ke[3*6]=ke.x,Ke[3*6+1]=ke.y,Ke[3*6+2]=ke.z)}if(_i[D]&1<<7){const B=Si(x,S);qe[3*7]=i,qe[3*7+1]=s+o,qe[3*7+2]=r+B*o,I&&(ke.fromArray(l,p*3),Gt.fromArray(l,v*3),ke.lerp(Gt,B),Ke[3*7]=ke.x,Ke[3*7+1]=ke.y,Ke[3*7+2]=ke.z)}if(_i[D]&1<<8){const B=Si(y,x);qe[3*8]=i,qe[3*8+1]=s+B*o,qe[3*8+2]=r,I&&(ke.fromArray(l,c*3),Gt.fromArray(l,p*3),ke.lerp(Gt,B),Ke[3*8]=ke.x,Ke[3*8+1]=ke.y,Ke[3*8+2]=ke.z)}if(_i[D]&1<<9){const B=Si(w,C);qe[3*9]=i+o,qe[3*9+1]=s+B*o,qe[3*9+2]=r,I&&(ke.fromArray(l,h*3),Gt.fromArray(l,g*3),ke.lerp(Gt,B),Ke[3*9]=ke.x,Ke[3*9+1]=ke.y,Ke[3*9+2]=ke.z)}if(_i[D]&1<<10){const B=Si(_,T);qe[3*10]=i+o,qe[3*10+1]=s+B*o,qe[3*10+2]=r+o,I&&(ke.fromArray(l,d*3),Gt.fromArray(l,m*3),ke.lerp(Gt,B),Ke[3*10]=ke.x,Ke[3*10+1]=ke.y,Ke[3*10+2]=ke.z)}if(_i[D]&1<<11){const B=Si(A,S);qe[3*11]=i,qe[3*11+1]=s+B*o,qe[3*11+2]=r+o,I&&(ke.fromArray(l,f*3),Gt.fromArray(l,v*3),ke.lerp(Gt,B),Ke[3*11]=ke.x,Ke[3*11+1]=ke.y,Ke[3*11+2]=ke.z)}for(let B=0;;B+=3){const Q=kp[D*16+B];if(Q===-1)break;const U=kp[D*16+B+1],z=kp[D*16+B+2],q=qe[Q*3],ee=qe[Q*3+1],J=qe[Q*3+2],X=qe[U*3],V=qe[U*3+1],Z=qe[U*3+2],de=qe[z*3],Y=qe[z*3+1],fe=qe[z*3+2];if(n.push(q,ee,J,X,V,Z,de,Y,fe),I&&t.push(Ke[Q*3],Ke[Q*3+1],Ke[Q*3+2],Ke[U*3],Ke[U*3+1],Ke[U*3+2],Ke[z*3],Ke[z*3+1],Ke[z*3+2]),e){const k=X-q,N=V-ee,F=Z-J,H=X-de,$=V-Y,te=Z-fe,se=N*te-F*$,ae=F*H-k*te,E=k*$-N*H,L=1/Math.sqrt(se**2+ae**2+E**2),G=-se*L,K=-ae*L,oe=-E*L;e.push(G,K,oe,G,K,oe,G,K,oe)}}}}u(I0,"marchingCubes");SS(I0,"marchingCubes");var oz=Object.defineProperty,Hr=u((n,e)=>oz(n,"name",{value:e,configurable:!0}),"__name$16");function AS(n,e,t,i,s,r,o){return Math.sqrt((n-i)**2+(e-s)**2+(t-r)**2)-o}u(AS,"sphere");Hr(AS,"sphere");function CS(n,e,t,i,s,r,o,a,l,c,h){const d=a-i,f=l-s,p=c-r,g=d**2+f**2+p**2,m=o-h,v=g-m**2,y=1/g,w=n-i,_=e-s,A=t-r,x=w*d+_*f+A*p,C=x-g,T=(w*g-d*x)**2+(_*g-f*x)**2+(A*g-p*x)**2,S=x**2*g,I=C**2*g,D=Math.sign(m)*m*m*T;return Math.sign(C)*v*I>D?Math.sqrt(T+I)*y-h:Math.sign(x)*v*S<D?Math.sqrt(T+S)*y-o:(Math.sqrt(T*v*y)+x*m)*y-o}u(CS,"roundCone");Hr(CS,"roundCone");function az(n,e){return Math.min(n,e)}u(az,"merge");Hr(az,"merge");function TS(n,e,t){const i=Math.max(0,Math.min(1,.5+.5*(e-n)/t));return e*(1-i)+n*i-t*i*(1-i)}u(TS,"mergeSmooth");Hr(TS,"mergeSmooth");function ES(n,e){return Math.max(n,e)}u(ES,"intersect");Hr(ES,"intersect");function PS(n,e,t){const i=Math.max(0,Math.min(1,.5-.5*(e-n)/t));return e*(1-i)+n*i+t*i*(1-i)}u(PS,"intersectSmooth");Hr(PS,"intersectSmooth");function lz(n,e){return ES(n,-e)}u(lz,"subtract");Hr(lz,"subtract");function IS(n,e,t){return PS(n,-e,t)}u(IS,"subtractSmooth");Hr(IS,"subtractSmooth");var cz=Object.defineProperty,R0=u((n,e)=>cz(n,"name",{value:e,configurable:!0}),"__name$15");class yu{constructor(e,t,i){M(this,"position");M(this,"radius");M(this,"operator");M(this,"bb");M(this,"fatBb",new Fn);this.position=e,this.radius=t,this.operator=i,this.bb=new Fn().expandByPoint(e).expandByScalar(t)}createSymmetry(e){const t=new b().copy(this.position);return t.setComponent(e,-t.getComponent(e)),new yu(t,this.radius,this.operator)}sdf(e,t,i){return AS(e,t,i,this.position.x,this.position.y,this.position.z,this.radius)}}u(yu,"SdfSphere");R0(yu,"SdfSphere");class _u{constructor(e,t,i,s,r){M(this,"p1");M(this,"r1");M(this,"p2");M(this,"r2");M(this,"operator");M(this,"bb");M(this,"fatBb",new Fn);this.p1=e,this.r1=t,this.p2=i,this.r2=s,this.operator=r,this.bb=new Fn().union(new Fn().expandByPoint(e).expandByScalar(t)).union(new Fn().expandByPoint(i).expandByScalar(s))}createSymmetry(e){const t=new b().copy(this.p1).setComponent(e,-this.p1.getComponent(e)),i=new b().copy(this.p2).setComponent(e,-this.p2.getComponent(e));return new _u(t,this.r1,i,this.r2,this.operator)}sdf(e,t,i){return CS(e,t,i,this.p1.x,this.p1.y,this.p1.z,this.r1,this.p2.x,this.p2.y,this.p2.z,this.r2)}}u(_u,"SdfRoundCone");R0(_u,"SdfRoundCone");const da=new b;class Df{constructor(){M(this,"resolution",.003);M(this,"maxResolutionSeg",100);M(this,"symmetryAxis",-1);M(this,"smoothRange",.01);M(this,"shapes",[])}sphere(e,t,i){if(t<=0)return;const s=new yu(e,t,i);this.shapes.push(s),this.symmetryAxis>=0&&this.shapes.push(s.createSymmetry(this.symmetryAxis))}roundCone(e,t,i,s,r){if(t<=0&&s<=0)return;if(da.subVectors(e,i).length()+Math.min(t,s)<=Math.max(t,s))return t>s?this.sphere(e,t,r):this.sphere(i,s,r);const a=new _u(e,t,i,s,r);this.shapes.push(a),this.symmetryAxis>=0&&this.shapes.push(a.createSymmetry(this.symmetryAxis))}build(){const e=new Fn;for(let y of this.shapes)y.operator&&e.union(y.bb);if(e.isEmpty())return{position:[],normal:[]};e.getSize(da);let t=Math.max(this.resolution,Math.max(da.x,da.y,da.z)/this.maxResolutionSeg);const i=this.smoothRange;for(let y of this.shapes)y.fatBb.copy(y.bb).expandByScalar(t+i);const s=e.min.x-t-i,r=e.min.y-t-i,o=e.min.z-t-i,a=e.max.x+t+i,l=e.max.y+t+i,c=e.max.z+t+i,h=Math.ceil((a-s)/t),d=Math.ceil((l-r)/t),f=Math.ceil((c-o)/t),p=new Float32Array(h*d*f),g=new Cs(p.length);for(let y=0;y<h;++y){const w=s+y*t;for(let _=0;_<d;++_){const A=r+_*t;for(let x=0;x<f;++x){const C=o+x*t,T=y*d*f+_*f+x;for(let S of this.shapes)if(!!S.fatBb.containsPoint(da.set(w,A,C)))if(S.operator)g.get(T)?p[T]=TS(p[T],S.sdf(w,A,C),i):(g.set(T),p[T]=S.sdf(w,A,C));else{if(!g.get(T))continue;p[T]=IS(p[T],S.sdf(w,A,C),i)}}}}const m=[],v=[];for(let y=0;y<h-1;++y){const w=s+y*t;for(let _=0;_<d-1;++_){const A=r+_*t;for(let x=0;x<f-1;++x){const C=o+x*t;!g.get(y*d*f+_*f+x)||I0(m,v,null,w,A,C,t,p,null,y*d*f+_*f+x,(y+1)*d*f+_*f+x,(y+1)*d*f+_*f+(x+1),y*d*f+_*f+(x+1),y*d*f+(_+1)*f+x,(y+1)*d*f+(_+1)*f+x,(y+1)*d*f+(_+1)*f+(x+1),y*d*f+(_+1)*f+(x+1))}}}return{position:m,normal:v}}}u(Df,"SdfMeshBuilder");R0(Df,"SdfMeshBuilder");var uz=Object.defineProperty,hz=u((n,e)=>uz(n,"name",{value:e,configurable:!0}),"__name$14");class D0{update(e,t){var l;if(t.instanceId||t.type!=="Clay")return;const i=t.get(Tn),s=t.get(ls);if(!i.dirty&&!s.dirty)return;i.dirty=!1,s.dirty=!1;const r=i.partialUpdate||s.partialUpdate;if(i.partialUpdate=!1,s.partialUpdate=!1,i.value.length===0){const c=new Df;c.sphere(new b(0,0,0),.25,!0);const{position:h}=c.build();i.value=new Float32Array(h),s.value=new Float32Array(h.length);for(let d=0,f=s.value.length;d<f;++d)s.value[d]=1}const o=t.get(Ce);!o.mesh||!r?(o.mesh=new P0,o.mesh.buildFromTriangles(i.value,s.value),i.value=new Float32Array(o.mesh.aPosition),s.value=new Float32Array(o.mesh.aColor)):o.mesh.update((l=o.value)==null?void 0:l.geometry),r||o.dispose();const a=o.value;o.value?o.mesh.toThree(o.value):(o.value=o.mesh.toThree(),o.value.userData={node:t},o.parentChanged=!0,o.localTransformChanged=!0),e.model.instanceMeshUpdated(t.id,a!==o.value)}}u(D0,"ClayUpdateFilter");hz(D0,"ClayUpdateFilter");var dz=Object.defineProperty,fz=u((n,e)=>dz(n,"name",{value:e,configurable:!0}),"__name$13");class L0{update(e,t){if(t.type==="Container"){const i=t.get(Ce);i.value||(i.value=new Ei,i.value.userData={node:t}),t.instanceId&&(t.instanceMeshDirty=!1)}}}u(L0,"ContainerUpdateFilter");fz(L0,"ContainerUpdateFilter");var pz=Object.defineProperty,mz=u((n,e)=>pz(n,"name",{value:e,configurable:!0}),"__name$12");class F0{update(e,t){if(t.instanceId||t.type!=="Shape"||!t.value(di))return;const i=t.get(di);i.value=!1;const s=t.get(Ce);s.value||(s.value=new Ee(new Qe,new Mf),s.value.userData={node:t}),i.throttleHash=`#${t.id}-update-custom-shape-geometry`,e.throttle(i.throttleHash,25,function(){if(t.deleted)return;i.throttleHash="";const r=new Df;switch(t.value(ol)){case"x":r.symmetryAxis=0;break;case"y":r.symmetryAxis=1;break;case"z":r.symmetryAxis=2;break}for(let h of t.children){const d=h.value(nt),f=h.value(rl)==="add";if(d.length===1)r.sphere(d[0].position,d[0].radius,f);else for(let p=0;p+1<d.length;++p){const g=d[p],m=d[p+1];r.roundCone(g.position,g.radius,m.position,m.radius,f)}}const{position:o,normal:a}=r.build(),c=s.value.geometry;c.setAttribute("position",new Fe(o,3)),c.setAttribute("normal",new Fe(a,3)),c.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)},!1)}}u(F0,"CustomShapeUpdateFilter");mz(F0,"CustomShapeUpdateFilter");var gz="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntlsEOwCAIQ8vCf+u+HC8z0WnUMEh2oDc09PVkJQAZjmIAEJHkYU5EN7eDpXkNzbPDr2rD8upSo3fIAfAoK/2HvUtpdKwABCAAAfgDwPo13QOs67MDWNdmB3Arfjh/WwpBzho97mV7igAAAABJRU5ErkJggg==",vz="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAALhJREFUSIntVdsOwjAIHcb/HvtyfAFCESjVGmPieVuBc8k2CkcPuHiuuHeIieiMigAwFcoEBmIAuKImU58KDeTE4AF99vD1SMAnQCI6xfFCAu3nNGESFBfeYZXW9/sk6UtmVxW5OgWA9EMI3TeI2xy3F4j2KO/i+niCv8D3BQS//R+UDt6dTXeR2YxHIYbSm/FYAZSlFazr1ATX7bqeLsmtF05sbf3KvOxcRyAUehouiLsCg9DCueIBQtEIj3OkCCMAAAAASUVORK5CYII=",yz=Object.defineProperty,_z=u((n,e)=>yz(n,"name",{value:e,configurable:!0}),"__name$11");const RS=new Gg,Zm=RS.load(gz);Zm.minFilter=Zm.magFilter=yn;const Qm=RS.load(vz);Qm.minFilter=Qm.magFilter=yn;class O0{update(e,t){var s;if(t.type!=="IKChain")return;t.instanceId&&(t.instanceMeshDirty=!1);const i=t.get(Ce);i.value||(i.value=new Ei,i.value.userData={node:t});for(let r=0,o=t.children.length;r<o;++r){const a=t.children[r];a.instanceId&&(a.instanceMeshDirty=!1);const l=a.get(Ce);l.value||(l.value=new Ei,l.value.userData={node:a});const c=a.get(vt);if(!c.dirty)continue;if(!c.boneMesh){const f=c.boneMesh=new Ee;f.material=new tr({depthWrite:!1,depthTest:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.75,color:7829367}),f.renderOrder=1,f.visible=e.options.showIkBones,l.value.add(f)}const h=c.boneMesh;(s=h.geometry)==null||s.dispose();const d=a.value(os);if(h.geometry=new bf(.01,d,6).translate(0,a.value(os)/2,0).rotateZ(-Math.PI/2),c.moveHandler||(c.moveHandler=new Va(new Qe().setFromPoints([new b]),new Sr({map:Zm,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),c.moveHandler.renderOrder=2,l.value.add(c.moveHandler),c.moveHandler.visible=!1),c.rotateHandler||(c.rotateHandler=new Va(new Qe().setFromPoints([new b]),new Sr({map:Qm,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),c.rotateHandler.renderOrder=2,l.value.add(c.rotateHandler),c.rotateHandler.visible=!1),c.dirty=!1,c.quaternion.setFromEuler(a.value(jn)),r>0){const f=t.children[r-1].get(vt);c.start.copy(f.end),c.quaternion.multiplyQuaternions(f.quaternion,c.quaternion).normalize()}else c.start.set(0,0,0);c.end.set(a.value(os),0,0).applyQuaternion(c.quaternion).add(c.start),c.rotateHandler.position.set(d,0,0)}}}u(O0,"IkChainUpdateFilter");_z(O0,"IkChainUpdateFilter");var xz=Object.defineProperty,bz=u((n,e)=>xz(n,"name",{value:e,configurable:!0}),"__name$10");class N0 extends Qe{constructor(e=1,t=1,i=1,s=1){super(),this.type="DoubleSidedPlaneGeometry";const r=e/2,o=t/2,a=Math.floor(i),l=Math.floor(s),c=a+1,h=l+1,d=e/a,f=t/l,p=[],g=[],m=[],v=[];for(let w=0;w<2;++w)for(let _=0;_<h;_++){const A=_*f-o;for(let x=0;x<c;x++){const C=x*d-r;g.push(C,-A,0),m.push(0,0,w===0?1:-1),v.push(x/a),v.push(1-_/l)}}const y=c*h;for(let w=0;w<l;w++)for(let _=0;_<a;_++){const A=_+c*w,x=_+c*(w+1),C=_+1+c*(w+1),T=_+1+c*w;p.push(A,x,T),p.push(x,C,T),p.push(A+y,T+y,C+y),p.push(A+y,C+y,x+y)}this.setIndex(p),this.setAttribute("position",new Fe(g,3)),this.setAttribute("normal",new Fe(m,3)),this.setAttribute("uv",new Fe(v,2))}}u(N0,"DoubleSidedPlaneGeometry");bz(N0,"DoubleSidedPlaneGeometry");var wz=Object.defineProperty,Mz=u((n,e)=>wz(n,"name",{value:e,configurable:!0}),"__name$$");class k0{update(e,t){if(t.instanceId||!t.has(Nr))return;const i=t.get(Nr);if(!i.dirty||(i.dirty=!1,!i.value))return;const s=new Image;s.onload=function(){if(t.deleted||s.src!==i.value)return;i.texture&&i.texture.dispose();const r=i.texture=new On;if(i.texture.image=s,i.texture.needsUpdate=!0,t.type!=="Image")return;const o=t.get(Ce);o.dispose();const a=1,l=s.height/s.width*a;o.value=new Ee(new N0(a,l),new Ug({map:r})),o.value.userData={node:t},e.model.dirty=!0,t.dirty=!0,o.parentChanged=!0,o.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)},s.src=i.value}}u(k0,"ImageUpdateFilter");Mz(k0,"ImageUpdateFilter");/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var V_={},Jm=u(function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))},"durl"),DS=u(function(n){return new Worker(n)},"cwk");try{URL.revokeObjectURL(Jm(""))}catch{Jm=u(function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},"durl"),DS=u(function(e){return new Worker(e,{type:"module"})},"cwk")}var Sz=u(function(n,e,t,i,s){var r=DS(V_[e]||(V_[e]=Jm(n)));return r.onerror=function(o){return s(o.error,null)},r.onmessage=function(o){return s(null,o.data)},r.postMessage(t,i),r},"wk"),pt=Uint8Array,Cn=Uint16Array,Qs=Uint32Array,gl=new pt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),vl=new pt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),su=new pt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),LS=u(function(n,e){for(var t=new Cn(31),i=0;i<31;++i)t[i]=e+=1<<n[i-1];for(var s=new Qs(t[30]),i=1;i<30;++i)for(var r=t[i];r<t[i+1];++r)s[r]=r-t[i]<<5|i;return[t,s]},"freb"),FS=LS(gl,2),z0=FS[0],kd=FS[1];z0[28]=258,kd[258]=28;var OS=LS(vl,0),NS=OS[0],eg=OS[1],ru=new Cn(32768);for(var Vt=0;Vt<32768;++Vt){var mr=(Vt&43690)>>>1|(Vt&21845)<<1;mr=(mr&52428)>>>2|(mr&13107)<<2,mr=(mr&61680)>>>4|(mr&3855)<<4,ru[Vt]=((mr&65280)>>>8|(mr&255)<<8)>>>1}var Hi=u(function(n,e,t){for(var i=n.length,s=0,r=new Cn(e);s<i;++s)++r[n[s]-1];var o=new Cn(e);for(s=0;s<e;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(t){a=new Cn(1<<e);var l=15-e;for(s=0;s<i;++s)if(n[s])for(var c=s<<4|n[s],h=e-n[s],d=o[n[s]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)a[ru[d]>>>l]=c}else for(a=new Cn(i),s=0;s<i;++s)n[s]&&(a[s]=ru[o[n[s]-1]++]>>>15-n[s]);return a},"hMap"),Js=new pt(288);for(var Vt=0;Vt<144;++Vt)Js[Vt]=8;for(var Vt=144;Vt<256;++Vt)Js[Vt]=9;for(var Vt=256;Vt<280;++Vt)Js[Vt]=7;for(var Vt=280;Vt<288;++Vt)Js[Vt]=8;var al=new pt(32);for(var Vt=0;Vt<32;++Vt)al[Vt]=5;var kS=Hi(Js,9,0),zS=Hi(Js,9,1),BS=Hi(al,5,0),US=Hi(al,5,1),pd=u(function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},"max"),zi=u(function(n,e,t){var i=e/8|0;return(n[i]|n[i+1]<<8)>>(e&7)&t},"bits"),md=u(function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},"bits16"),xu=u(function(n){return(n/8|0)+(n&7&&1)},"shft"),Gi=u(function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var i=new(n instanceof Cn?Cn:n instanceof Qs?Qs:pt)(t-e);return i.set(n.subarray(e,t)),i},"slc"),bu=u(function(n,e,t){var i=n.length;if(!i||t&&!t.l&&i<5)return e||new pt(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new pt(i*3));var o=u(function(F){var H=e.length;if(F>H){var $=new pt(Math.max(H*2,F));$.set(e),e=$}},"cbuf"),a=t.f||0,l=t.p||0,c=t.b||0,h=t.l,d=t.d,f=t.m,p=t.n,g=i*8;do{if(!h){t.f=a=zi(n,l,1);var m=zi(n,l+1,3);if(l+=3,m)if(m==1)h=zS,d=US,f=9,p=5;else if(m==2){var _=zi(n,l,31)+257,A=zi(n,l+10,15)+4,x=_+zi(n,l+5,31)+1;l+=14;for(var C=new pt(x),T=new pt(19),S=0;S<A;++S)T[su[S]]=zi(n,l+S*3,7);l+=A*3;for(var I=pd(T),D=(1<<I)-1,B=Hi(T,I,1),S=0;S<x;){var Q=B[zi(n,l,D)];l+=Q&15;var v=Q>>>4;if(v<16)C[S++]=v;else{var U=0,z=0;for(v==16?(z=3+zi(n,l,3),l+=2,U=C[S-1]):v==17?(z=3+zi(n,l,7),l+=3):v==18&&(z=11+zi(n,l,127),l+=7);z--;)C[S++]=U}}var q=C.subarray(0,_),ee=C.subarray(_);f=pd(q),p=pd(ee),h=Hi(q,f,1),d=Hi(ee,p,1)}else throw"invalid block type";else{var v=xu(l)+4,y=n[v-4]|n[v-3]<<8,w=v+y;if(w>i){if(r)throw"unexpected EOF";break}s&&o(c+y),e.set(n.subarray(v,w),c),t.b=c+=y,t.p=l=w*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}s&&o(c+131072);for(var J=(1<<f)-1,X=(1<<p)-1,V=l;;V=l){var U=h[md(n,l)&J],Z=U>>>4;if(l+=U&15,l>g){if(r)throw"unexpected EOF";break}if(!U)throw"invalid length/literal";if(Z<256)e[c++]=Z;else if(Z==256){V=l,h=null;break}else{var de=Z-254;if(Z>264){var S=Z-257,Y=gl[S];de=zi(n,l,(1<<Y)-1)+z0[S],l+=Y}var fe=d[md(n,l)&X],k=fe>>>4;if(!fe)throw"invalid distance";l+=fe&15;var ee=NS[k];if(k>3){var Y=vl[k];ee+=md(n,l)&(1<<Y)-1,l+=Y}if(l>g){if(r)throw"unexpected EOF";break}s&&o(c+131072);for(var N=c+de;c<N;c+=4)e[c]=e[c-ee],e[c+1]=e[c+1-ee],e[c+2]=e[c+2-ee],e[c+3]=e[c+3-ee];c=N}}t.l=h,t.p=V,t.b=c,h&&(a=1,t.m=f,t.d=d,t.n=p)}while(!a);return c==e.length?e:Gi(e,0,c)},"inflt"),vs=u(function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8},"wbits"),Ca=u(function(n,e,t){t<<=e&7;var i=e/8|0;n[i]|=t,n[i+1]|=t>>>8,n[i+2]|=t>>>16},"wbits16"),gd=u(function(n,e){for(var t=[],i=0;i<n.length;++i)n[i]&&t.push({s:i,f:n[i]});var s=t.length,r=t.slice();if(!s)return[js,0];if(s==1){var o=new pt(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(x,C){return x.f-C.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,h=1,d=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};h!=s-1;)a=t[t[c].f<t[d].f?c++:d++],l=t[c!=h&&t[c].f<t[d].f?c++:d++],t[h++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,i=1;i<s;++i)r[i].s>f&&(f=r[i].s);var p=new Cn(f+1),g=zd(t[h-1],p,0);if(g>e){var i=0,m=0,v=g-e,y=1<<v;for(r.sort(function(C,T){return p[T.s]-p[C.s]||C.f-T.f});i<s;++i){var w=r[i].s;if(p[w]>e)m+=y-(1<<g-p[w]),p[w]=e;else break}for(m>>>=v;m>0;){var _=r[i].s;p[_]<e?m-=1<<e-p[_]++-1:++i}for(;i>=0&&m;--i){var A=r[i].s;p[A]==e&&(--p[A],++m)}g=e}return[new pt(p),g]},"hTree"),zd=u(function(n,e,t){return n.s==-1?Math.max(zd(n.l,e,t+1),zd(n.r,e,t+1)):e[n.s]=t},"ln"),tg=u(function(n){for(var e=n.length;e&&!n[--e];);for(var t=new Cn(++e),i=0,s=n[0],r=1,o=u(function(l){t[i++]=l},"w"),a=1;a<=e;++a)if(n[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(s),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(s);r=1,s=n[a]}return[t.subarray(0,i),e]},"lc"),Ta=u(function(n,e){for(var t=0,i=0;i<e.length;++i)t+=n[i]*e[i];return t},"clen"),Dc=u(function(n,e,t){var i=t.length,s=xu(e+2);n[s]=i&255,n[s+1]=i>>>8,n[s+2]=n[s]^255,n[s+3]=n[s+1]^255;for(var r=0;r<i;++r)n[s+r+4]=t[r];return(s+4+i)*8},"wfblk"),ng=u(function(n,e,t,i,s,r,o,a,l,c,h){vs(e,h++,t),++s[256];for(var d=gd(s,15),f=d[0],p=d[1],g=gd(r,15),m=g[0],v=g[1],y=tg(f),w=y[0],_=y[1],A=tg(m),x=A[0],C=A[1],T=new Cn(19),S=0;S<w.length;++S)T[w[S]&31]++;for(var S=0;S<x.length;++S)T[x[S]&31]++;for(var I=gd(T,7),D=I[0],B=I[1],Q=19;Q>4&&!D[su[Q-1]];--Q);var U=c+5<<3,z=Ta(s,Js)+Ta(r,al)+o,q=Ta(s,f)+Ta(r,m)+o+14+3*Q+Ta(T,D)+(2*T[16]+3*T[17]+7*T[18]);if(U<=z&&U<=q)return Dc(e,h,n.subarray(l,l+c));var ee,J,X,V;if(vs(e,h,1+(q<z)),h+=2,q<z){ee=Hi(f,p,0),J=f,X=Hi(m,v,0),V=m;var Z=Hi(D,B,0);vs(e,h,_-257),vs(e,h+5,C-1),vs(e,h+10,Q-4),h+=14;for(var S=0;S<Q;++S)vs(e,h+3*S,D[su[S]]);h+=3*Q;for(var de=[w,x],Y=0;Y<2;++Y)for(var fe=de[Y],S=0;S<fe.length;++S){var k=fe[S]&31;vs(e,h,Z[k]),h+=D[k],k>15&&(vs(e,h,fe[S]>>>5&127),h+=fe[S]>>>12)}}else ee=kS,J=Js,X=BS,V=al;for(var S=0;S<a;++S)if(i[S]>255){var k=i[S]>>>18&31;Ca(e,h,ee[k+257]),h+=J[k+257],k>7&&(vs(e,h,i[S]>>>23&31),h+=gl[k]);var N=i[S]&31;Ca(e,h,X[N]),h+=V[N],N>3&&(Ca(e,h,i[S]>>>5&8191),h+=vl[N])}else Ca(e,h,ee[i[S]]),h+=J[i[S]];return Ca(e,h,ee[256]),h+J[256]},"wblk"),VS=new Qs([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),js=new pt(0),HS=u(function(n,e,t,i,s,r){var o=n.length,a=new pt(i+o+5*(1+Math.ceil(o/7e3))+s),l=a.subarray(i,a.length-s),c=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var d=h+65535;d<o?c=Dc(l,c,n.subarray(h,d)):(l[h]=r,c=Dc(l,c,n.subarray(h,o)))}else{for(var f=VS[e-1],p=f>>>13,g=f&8191,m=(1<<t)-1,v=new Cn(32768),y=new Cn(m+1),w=Math.ceil(t/3),_=2*w,A=u(function(G){return(n[G]^n[G+1]<<w^n[G+2]<<_)&m},"hsh"),x=new Qs(25e3),C=new Cn(288),T=new Cn(32),S=0,I=0,h=0,D=0,B=0,Q=0;h<o;++h){var U=A(h),z=h&32767,q=y[U];if(v[z]=q,y[U]=z,B<=h){var ee=o-h;if((S>7e3||D>24576)&&ee>423){c=ng(n,l,0,x,C,T,I,D,Q,h-Q,c),D=S=I=0,Q=h;for(var J=0;J<286;++J)C[J]=0;for(var J=0;J<30;++J)T[J]=0}var X=2,V=0,Z=g,de=z-q&32767;if(ee>2&&U==A(h-de))for(var Y=Math.min(p,ee)-1,fe=Math.min(32767,h),k=Math.min(258,ee);de<=fe&&--Z&&z!=q;){if(n[h+X]==n[h+X-de]){for(var N=0;N<k&&n[h+N]==n[h+N-de];++N);if(N>X){if(X=N,V=de,N>Y)break;for(var F=Math.min(de,N-2),H=0,J=0;J<F;++J){var $=h-de+J+32768&32767,te=v[$],se=$-te+32768&32767;se>H&&(H=se,q=$)}}}z=q,q=v[z],de+=z-q+32768&32767}if(V){x[D++]=268435456|kd[X]<<18|eg[V];var ae=kd[X]&31,E=eg[V]&31;I+=gl[ae]+vl[E],++C[257+ae],++T[E],B=h+X,++S}else x[D++]=n[h],++C[n[h]]}}c=ng(n,l,r,x,C,T,I,D,Q,h-Q,c),!r&&c&7&&(c=Dc(l,c+1,js))}return Gi(a,0,i+xu(c)+s)},"dflt"),GS=function(){for(var n=new Qs(256),e=0;e<256;++e){for(var t=e,i=9;--i;)t=(t&1&&3988292384)^t>>>1;n[e]=t}return n}(),yl=u(function(){var n=-1;return{p:function(e){for(var t=n,i=0;i<e.length;++i)t=GS[t&255^e[i]]^t>>>8;n=t},d:function(){return~n}}},"crc"),B0=u(function(){var n=1,e=0;return{p:function(t){for(var i=n,s=e,r=t.length,o=0;o!=r;){for(var a=Math.min(o+2655,r);o<a;++o)s+=i+=t[o];i=(i&65535)+15*(i>>16),s=(s&65535)+15*(s>>16)}n=i,e=s},d:function(){return n%=65521,e%=65521,(n&255)<<24|n>>>8<<16|(e&255)<<8|e>>>8}}},"adler"),Xo=u(function(n,e,t,i,s){return HS(n,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+e.mem,t,i,!s)},"dopt"),wu=u(function(n,e){var t={};for(var i in n)t[i]=n[i];for(var i in e)t[i]=e[i];return t},"mrg"),H_=u(function(n,e,t){for(var i=n(),s=n.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var a=i[o],l=r[o];if(typeof a=="function"){e+=";"+l+"=";var c=a.toString();if(a.prototype)if(c.indexOf("[native code]")!=-1){var h=c.indexOf(" ",8)+1;e+=c.slice(h,c.indexOf("(",h))}else{e+=c;for(var d in a.prototype)e+=";"+l+".prototype."+d+"="+a.prototype[d].toString()}else e+=c}else t[l]=a}return[e,t]},"wcln"),_h=[],Az=u(function(n){var e=[];for(var t in n)(n[t]instanceof pt||n[t]instanceof Cn||n[t]instanceof Qs)&&e.push((n[t]=new n[t].constructor(n[t])).buffer);return e},"cbfs"),$S=u(function(n,e,t,i){var s;if(!_h[t]){for(var r="",o={},a=n.length-1,l=0;l<a;++l)s=H_(n[l],r,o),r=s[0],o=s[1];_h[t]=H_(n[a],r,o)}var c=wu({},_h[t][1]);return Sz(_h[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,Az(c),i)},"wrkr"),_l=u(function(){return[pt,Cn,Qs,gl,vl,su,z0,NS,zS,US,ru,Hi,pd,zi,md,xu,Gi,bu,Ml,Gr,U0]},"bInflt"),xl=u(function(){return[pt,Cn,Qs,gl,vl,su,kd,eg,kS,Js,BS,al,ru,VS,js,Hi,vs,Ca,gd,zd,tg,Ta,Dc,ng,xu,Gi,HS,Xo,Mu,Gr]},"bDflt"),WS=u(function(){return[V0,G0,At,yl,GS]},"gze"),jS=u(function(){return[H0,qS]},"guze"),XS=u(function(){return[$0,At,B0]},"zle"),YS=u(function(){return[KS]},"zule"),Gr=u(function(n){return postMessage(n,[n.buffer])},"pbf"),U0=u(function(n){return n&&n.size&&new pt(n.size)},"gu8"),bl=u(function(n,e,t,i,s,r){var o=$S(t,i,s,function(a,l){o.terminate(),r(a,l)});return o.postMessage([n,e],e.consume?[n.buffer]:[]),function(){o.terminate()}},"cbify"),Wi=u(function(n){return n.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return n.push(e.data[0],e.data[1])}},"astrm"),wl=u(function(n,e,t,i,s){var r,o=$S(n,i,s,function(a,l){a?(o.terminate(),e.ondata.call(e,a)):(l[1]&&o.terminate(),e.ondata.call(e,a,l[0],l[1]))});o.postMessage(t),e.push=function(a,l){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([a,r=l],[a.buffer])},e.terminate=function(){o.terminate()}},"astrmify"),ei=u(function(n,e){return n[e]|n[e+1]<<8},"b2"),an=u(function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},"b4"),zp=u(function(n,e){return an(n,e)+an(n,e+4)*4294967296},"b8"),At=u(function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},"wbytes"),V0=u(function(n,e){var t=e.filename;if(n[0]=31,n[1]=139,n[2]=8,n[8]=e.level<2?4:e.level==9?2:0,n[9]=3,e.mtime!=0&&At(n,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){n[3]=8;for(var i=0;i<=t.length;++i)n[i+10]=t.charCodeAt(i)}},"gzh"),H0=u(function(n){if(n[0]!=31||n[1]!=139||n[2]!=8)throw"invalid gzip data";var e=n[3],t=10;e&4&&(t+=n[10]|(n[11]<<8)+2);for(var i=(e>>3&1)+(e>>4&1);i>0;i-=!n[t++]);return t+(e&2)},"gzs"),qS=u(function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},"gzl"),G0=u(function(n){return 10+(n.filename&&n.filename.length+1||0)},"gzhl"),$0=u(function(n,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;n[0]=120,n[1]=i<<6|(i?32-2*i:1)},"zlh"),KS=u(function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"},"zlv");function W0(n,e){return!e&&typeof n=="function"&&(e=n,n={}),this.ondata=e,n}u(W0,"AsyncCmpStrm");var Es=function(){function n(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return u(n,"Deflate"),n.prototype.p=function(e,t){this.ondata(Xo(e,this.o,0,0,!t),t)},n.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},n}(),ZS=function(){function n(e,t){wl([xl,function(){return[Wi,Es]}],this,W0.call(this,e,t),function(i){var s=new Es(i.data);onmessage=Wi(s)},6)}return u(n,"AsyncDeflate"),n}();function QS(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return bl(n,e,[xl],function(i){return Gr(Mu(i.data[0],i.data[1]))},0,t)}u(QS,"deflate");function Mu(n,e){return Xo(n,e||{},0,0)}u(Mu,"deflateSync");var mi=function(){function n(e){this.s={},this.p=new pt(0),this.ondata=e}return u(n,"Inflate"),n.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,i=new pt(t+e.length);i.set(this.p),i.set(e,t),this.p=i},n.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,i=bu(this.p,this.o,this.s);this.ondata(Gi(i,t,this.s.b),this.d),this.o=Gi(i,this.s.b-32768),this.s.b=this.o.length,this.p=Gi(this.p,this.s.p/8|0),this.s.p&=7},n.prototype.push=function(e,t){this.e(e),this.c(t)},n}(),j0=function(){function n(e){this.ondata=e,wl([_l,function(){return[Wi,mi]}],this,0,function(){var t=new mi;onmessage=Wi(t)},7)}return u(n,"AsyncInflate"),n}();function X0(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return bl(n,e,[_l],function(i){return Gr(Ml(i.data[0],U0(i.data[1])))},1,t)}u(X0,"inflate");function Ml(n,e){return bu(n,e)}u(Ml,"inflateSync");var Bd=function(){function n(e,t){this.c=yl(),this.l=0,this.v=1,Es.call(this,e,t)}return u(n,"Gzip"),n.prototype.push=function(e,t){Es.prototype.push.call(this,e,t)},n.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var i=Xo(e,this.o,this.v&&G0(this.o),t&&8,!t);this.v&&(V0(i,this.o),this.v=0),t&&(At(i,i.length-8,this.c.d()),At(i,i.length-4,this.l)),this.ondata(i,t)},n}(),G_=function(){function n(e,t){wl([xl,WS,function(){return[Wi,Es,Bd]}],this,W0.call(this,e,t),function(i){var s=new Bd(i.data);onmessage=Wi(s)},8)}return u(n,"AsyncGzip"),n}();function $_(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return bl(n,e,[xl,WS,function(){return[Ud]}],function(i){return Gr(Ud(i.data[0],i.data[1]))},2,t)}u($_,"gzip");function Ud(n,e){e||(e={});var t=yl(),i=n.length;t.p(n);var s=Xo(n,e,G0(e),8),r=s.length;return V0(s,e),At(s,r-8,t.d()),At(s,r-4,i),s}u(Ud,"gzipSync");var Vd=function(){function n(e){this.v=1,mi.call(this,e)}return u(n,"Gunzip"),n.prototype.push=function(e,t){if(mi.prototype.e.call(this,e),this.v){var i=this.p.length>3?H0(this.p):4;if(i>=this.p.length&&!t)return;this.p=this.p.subarray(i),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}mi.prototype.c.call(this,t)},n}(),JS=function(){function n(e){this.ondata=e,wl([_l,jS,function(){return[Wi,mi,Vd]}],this,0,function(){var t=new Vd;onmessage=Wi(t)},9)}return u(n,"AsyncGunzip"),n}();function eA(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return bl(n,e,[_l,jS,function(){return[Hd]}],function(i){return Gr(Hd(i.data[0]))},3,t)}u(eA,"gunzip");function Hd(n,e){return bu(n.subarray(H0(n),-8),e||new pt(qS(n)))}u(Hd,"gunzipSync");var ig=function(){function n(e,t){this.c=B0(),this.v=1,Es.call(this,e,t)}return u(n,"Zlib"),n.prototype.push=function(e,t){Es.prototype.push.call(this,e,t)},n.prototype.p=function(e,t){this.c.p(e);var i=Xo(e,this.o,this.v&&2,t&&4,!t);this.v&&($0(i,this.o),this.v=0),t&&At(i,i.length-4,this.c.d()),this.ondata(i,t)},n}(),Cz=function(){function n(e,t){wl([xl,XS,function(){return[Wi,Es,ig]}],this,W0.call(this,e,t),function(i){var s=new ig(i.data);onmessage=Wi(s)},10)}return u(n,"AsyncZlib"),n}();function Tz(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return bl(n,e,[xl,XS,function(){return[sg]}],function(i){return Gr(sg(i.data[0],i.data[1]))},4,t)}u(Tz,"zlib");function sg(n,e){e||(e={});var t=B0();t.p(n);var i=Xo(n,e,2,4);return $0(i,e),At(i,i.length-4,t.d()),i}u(sg,"zlibSync");var Gd=function(){function n(e){this.v=1,mi.call(this,e)}return u(n,"Unzlib"),n.prototype.push=function(e,t){if(mi.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}mi.prototype.c.call(this,t)},n}(),tA=function(){function n(e){this.ondata=e,wl([_l,YS,function(){return[Wi,mi,Gd]}],this,0,function(){var t=new Gd;onmessage=Wi(t)},11)}return u(n,"AsyncUnzlib"),n}();function nA(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return bl(n,e,[_l,YS,function(){return[ou]}],function(i){return Gr(ou(i.data[0],U0(i.data[1])))},5,t)}u(nA,"unzlib");function ou(n,e){return bu((KS(n),n.subarray(2,-4)),e)}u(ou,"unzlibSync");var iA=function(){function n(e){this.G=Vd,this.I=mi,this.Z=Gd,this.ondata=e}return u(n,"Decompress"),n.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var i=new pt(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var s=this,r=u(function(){s.ondata.apply(s,arguments)},"cb");this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},n}(),Ez=function(){function n(e){this.G=JS,this.I=j0,this.Z=tA,this.ondata=e}return u(n,"AsyncDecompress"),n.prototype.push=function(e,t){iA.prototype.push.call(this,e,t)},n}();function Pz(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return n[0]==31&&n[1]==139&&n[2]==8?eA(n,e,t):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?X0(n,e,t):nA(n,e,t)}u(Pz,"decompress");function Iz(n,e){return n[0]==31&&n[1]==139&&n[2]==8?Hd(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?Ml(n,e):ou(n,e)}u(Iz,"decompressSync");var Y0=u(function(n,e,t,i){for(var s in n){var r=n[s],o=e+s;r instanceof pt?t[o]=[r,i]:Array.isArray(r)?t[o]=[r[0],wu(i,r[1])]:Y0(r,o+"/",t,i)}},"fltn"),W_=typeof TextEncoder!="undefined"&&new TextEncoder,rg=typeof TextDecoder!="undefined"&&new TextDecoder,sA=0;try{rg.decode(js,{stream:!0}),sA=1}catch{}var rA=u(function(n){for(var e="",t=0;;){var i=n[t++],s=(i>127)+(i>223)+(i>239);if(t+s>n.length)return[e,Gi(n,t-1)];s?s==3?(i=((i&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|i>>10,56320|i&1023)):s&1?e+=String.fromCharCode((i&31)<<6|n[t++]&63):e+=String.fromCharCode((i&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(i)}},"dutf8"),Rz=function(){function n(e){this.ondata=e,sA?this.t=new TextDecoder:this.p=js}return u(n,"DecodeUTF8"),n.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var i=new pt(this.p.length+e.length);i.set(this.p),i.set(e,this.p.length);var s=rA(i),r=s[0],o=s[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(r,t)},n}(),Dz=function(){function n(e){this.ondata=e}return u(n,"EncodeUTF8"),n.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Br(e),this.d=t||!1)},n}();function Br(n,e){if(e){for(var t=new pt(n.length),i=0;i<n.length;++i)t[i]=n.charCodeAt(i);return t}if(W_)return W_.encode(n);for(var s=n.length,r=new pt(n.length+(n.length>>1)),o=0,a=u(function(h){r[o++]=h},"w"),i=0;i<s;++i){if(o+5>r.length){var l=new pt(o+8+(s-i<<1));l.set(r),r=l}var c=n.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|n.charCodeAt(++i)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return Gi(r,0,o)}u(Br,"strToU8");function q0(n,e){if(e){for(var t="",i=0;i<n.length;i+=16384)t+=String.fromCharCode.apply(null,n.subarray(i,i+16384));return t}else{if(rg)return rg.decode(n);var s=rA(n),r=s[0],o=s[1];if(o.length)throw"invalid utf-8 data";return r}}u(q0,"strFromU8");var oA=u(function(n){return n==1?3:n<6?2:n==9?1:0},"dbf"),aA=u(function(n,e){return e+30+ei(n,e+26)+ei(n,e+28)},"slzh"),lA=u(function(n,e,t){var i=ei(n,e+28),s=q0(n.subarray(e+46,e+46+i),!(ei(n,e+8)&2048)),r=e+46+i,o=an(n,e+20),a=t&&o==4294967295?cA(n,r):[o,an(n,e+24),an(n,e+42)],l=a[0],c=a[1],h=a[2];return[ei(n,e+10),l,c,s,r+ei(n,e+30)+ei(n,e+32),h]},"zh"),cA=u(function(n,e){for(;ei(n,e)!=1;e+=4+ei(n,e+2));return[zp(n,e+12),zp(n,e+4),zp(n,e+20)]},"z64e"),Lr=u(function(n){var e=0;if(n)for(var t in n){var i=n[t].length;if(i>65535)throw"extra field too long";e+=i+4}return e},"exfl"),ll=u(function(n,e,t,i,s,r,o,a){var l=i.length,c=t.extra,h=a&&a.length,d=Lr(c);At(n,e,o!=null?33639248:67324752),e+=4,o!=null&&(n[e++]=20,n[e++]=t.os),n[e]=20,e+=2,n[e++]=t.flag<<1|(r==null&&8),n[e++]=s&&8,n[e++]=t.compression&255,n[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(At(n,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(At(n,e,t.crc),At(n,e+4,r),At(n,e+8,t.size)),At(n,e+12,l),At(n,e+14,d),e+=16,o!=null&&(At(n,e,h),At(n,e+6,t.attrs),At(n,e+10,o),e+=14),n.set(i,e),e+=l,d)for(var g in c){var m=c[g],v=m.length;At(n,e,+g),At(n,e+2,v),n.set(m,e+4),e+=4+v}return h&&(n.set(a,e),e+=h),e},"wzh"),K0=u(function(n,e,t,i,s){At(n,e,101010256),At(n,e+8,t),At(n,e+10,t),At(n,e+12,i),At(n,e+16,s)},"wzf"),au=function(){function n(e){this.filename=e,this.c=yl(),this.size=0,this.compression=0}return u(n,"ZipPassThrough"),n.prototype.process=function(e,t){this.ondata(null,e,t)},n.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},n}(),Lz=function(){function n(e,t){var i=this;t||(t={}),au.call(this,e),this.d=new Es(t,function(s,r){i.ondata(null,s,r)}),this.compression=8,this.flag=oA(t.level)}return u(n,"ZipDeflate"),n.prototype.process=function(e,t){try{this.d.push(e,t)}catch(i){this.ondata(i,null,t)}},n.prototype.push=function(e,t){au.prototype.push.call(this,e,t)},n}(),Fz=function(){function n(e,t){var i=this;t||(t={}),au.call(this,e),this.d=new ZS(t,function(s,r,o){i.ondata(s,r,o)}),this.compression=8,this.flag=oA(t.level),this.terminate=this.d.terminate}return u(n,"AsyncZipDeflate"),n.prototype.process=function(e,t){this.d.push(e,t)},n.prototype.push=function(e,t){au.prototype.push.call(this,e,t)},n}(),Oz=function(){function n(e){this.ondata=e,this.u=[],this.d=1}return u(n,"Zip"),n.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var i=Br(e.filename),s=i.length,r=e.comment,o=r&&Br(r),a=s!=e.filename.length||o&&r.length!=o.length,l=s+Lr(e.extra)+30;if(s>65535)throw"filename too long";var c=new pt(l);ll(c,0,e,i,a);var h=[c],d=u(function(){for(var v=0,y=h;v<y.length;v++){var w=y[v];t.ondata(null,w,!1)}h=[]},"pAll"),f=this.d;this.d=0;var p=this.u.length,g=wu(e,{f:i,u:a,o,t:function(){e.terminate&&e.terminate()},r:function(){if(d(),f){var v=t.u[p+1];v?v.r():t.d=1}f=1}}),m=0;e.ondata=function(v,y,w){if(v)t.ondata(v,y,w),t.terminate();else if(m+=y.length,h.push(y),w){var _=new pt(16);At(_,0,134695760),At(_,4,e.crc),At(_,8,m),At(_,12,e.size),h.push(_),g.c=m,g.b=l+m+16,g.crc=e.crc,g.size=e.size,f&&g.r(),f=1}else f&&d()},this.u.push(g)},n.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},n.prototype.e=function(){for(var e=0,t=0,i=0,s=0,r=this.u;s<r.length;s++){var o=r[s];i+=46+o.f.length+Lr(o.extra)+(o.o?o.o.length:0)}for(var a=new pt(i+22),l=0,c=this.u;l<c.length;l++){var o=c[l];ll(a,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+Lr(o.extra)+(o.o?o.o.length:0),t+=o.b}K0(a,e,this.u.length,i,t),this.ondata(null,a,!0),this.d=2},n.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var i=t[e];i.t()}this.d=2},n}();function Nz(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var i={};Y0(n,"",i,e);var s=Object.keys(i),r=s.length,o=0,a=0,l=r,c=new Array(r),h=[],d=u(function(){for(var m=0;m<h.length;++m)h[m]()},"tAll"),f=u(function(){var m=new pt(a+22),v=o,y=a-o;a=0;for(var w=0;w<l;++w){var _=c[w];try{var A=_.c.length;ll(m,a,_,_.f,_.u,A);var x=30+_.f.length+Lr(_.extra),C=a+x;m.set(_.c,C),ll(m,o,_,_.f,_.u,A,a,_.m),o+=16+x+(_.m?_.m.length:0),a=C+A}catch(T){return t(T,null)}}K0(m,o,c.length,y,v),t(null,m)},"cbf");r||f();for(var p=u(function(m){var v=s[m],y=i[v],w=y[0],_=y[1],A=yl(),x=w.length;A.p(w);var C=Br(v),T=C.length,S=_.comment,I=S&&Br(S),D=I&&I.length,B=Lr(_.extra),Q=_.level==0?0:8,U=u(function(z,q){if(z)d(),t(z,null);else{var ee=q.length;c[m]=wu(_,{size:x,crc:A.d(),c:q,f:C,m:I,u:T!=v.length||I&&S.length!=D,compression:Q}),o+=30+T+B+ee,a+=76+2*(T+B)+(D||0)+ee,--r||f()}},"cbl");if(T>65535&&U("filename too long",null),!Q)U(null,w);else if(x<16e4)try{U(null,Mu(w,_))}catch(z){U(z,null)}else h.push(QS(w,_,U))},"_loop_1"),g=0;g<l;++g)p(g);return d}u(Nz,"zip");function kz(n,e){e||(e={});var t={},i=[];Y0(n,"",t,e);var s=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],h=c.level==0?0:8,d=Br(o),f=d.length,p=c.comment,g=p&&Br(p),m=g&&g.length,v=Lr(c.extra);if(f>65535)throw"filename too long";var y=h?Mu(l,c):l,w=y.length,_=yl();_.p(l),i.push(wu(c,{size:l.length,crc:_.d(),c:y,f:d,m:g,u:f!=o.length||g&&p.length!=m,o:s,compression:h})),s+=30+f+v+w,r+=76+2*(f+v)+(m||0)+w}for(var A=new pt(r+22),x=s,C=r-s,T=0;T<i.length;++T){var d=i[T];ll(A,d.o,d,d.f,d.u,d.c.length);var S=30+d.f.length+Lr(d.extra);A.set(d.c,d.o+S),ll(A,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+S+(d.m?d.m.length:0)}return K0(A,s,i.length,C,x),A}u(kz,"zipSync");var uA=function(){function n(){}return u(n,"UnzipPassThrough"),n.prototype.push=function(e,t){this.ondata(null,e,t)},n.compression=0,n}(),zz=function(){function n(){var e=this;this.i=new mi(function(t,i){e.ondata(null,t,i)})}return u(n,"UnzipInflate"),n.prototype.push=function(e,t){try{this.i.push(e,t)}catch(i){this.ondata(i,e,t)}},n.compression=8,n}(),Bz=function(){function n(e,t){var i=this;t<32e4?this.i=new mi(function(s,r){i.ondata(null,s,r)}):(this.i=new j0(function(s,r,o){i.ondata(s,r,o)}),this.terminate=this.i.terminate)}return u(n,"AsyncUnzipInflate"),n.prototype.push=function(e,t){this.i.terminate&&(e=Gi(e,0)),this.i.push(e,t)},n.compression=8,n}(),Uz=function(){function n(e){this.onfile=e,this.k=[],this.o={0:uA},this.p=js}return u(n,"Unzip"),n.prototype.push=function(e,t){var i=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var s=Math.min(this.c,e.length),r=e.subarray(0,s);if(this.c-=s,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(s),e.length)return this.push(e,t)}else{var o=0,a=0,l=void 0,c=void 0;this.p.length?e.length?(c=new pt(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var h=c.length,d=this.c,f=d&&this.d,p=u(function(){var y,w=an(c,a);if(w==67324752){o=1,l=a,g.d=null,g.c=0;var _=ei(c,a+6),A=ei(c,a+8),x=_&2048,C=_&8,T=ei(c,a+26),S=ei(c,a+28);if(h>a+30+T+S){var I=[];g.k.unshift(I),o=2;var D=an(c,a+18),B=an(c,a+22),Q=q0(c.subarray(a+30,a+=30+T),!x);D==4294967295?(y=C?[-2]:cA(c,a),D=y[0],B=y[1]):C&&(D=-1),a+=S,g.c=D;var U,z={name:Q,compression:A,start:function(){if(!z.ondata)throw"no callback";if(!D)z.ondata(null,js,!0);else{var q=i.o[A];if(!q)throw"unknown compression type "+A;U=D<0?new q(Q):new q(Q,D,B),U.ondata=function(V,Z,de){z.ondata(V,Z,de)};for(var ee=0,J=I;ee<J.length;ee++){var X=J[ee];U.push(X,!1)}i.k[0]==I&&i.c?i.d=U:U.push(js,!0)}},terminate:function(){U&&U.terminate&&U.terminate()}};D>=0&&(z.size=D,z.originalSize=B),g.onfile(z)}return"break"}else if(d){if(w==134695760)return l=a+=12+(d==-2&&8),o=3,g.c=0,"break";if(w==33639248)return l=a-=4,o=3,g.c=0,"break"}},"_loop_2"),g=this;a<h-4;++a){var m=p();if(m==="break")break}if(this.p=js,d<0){var v=o?c.subarray(0,l-12-(d==-2&&8)-(an(c,l-16)==134695760&&4)):c.subarray(0,a);f?f.push(v,!!o):this.k[+(o==2)].push(v)}if(o&2)return this.push(c.subarray(a),t);this.p=c.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},n.prototype.register=function(e){this.o[e.compression]=e},n}();function Vz(n,e){if(typeof e!="function")throw"no callback";for(var t=[],i=u(function(){for(var f=0;f<t.length;++f)t[f]()},"tAll"),s={},r=n.length-22;an(n,r)!=101010256;--r)if(!r||n.length-r>65558){e("invalid zip file",null);return}var o=ei(n,r+8);o||e(null,{});var a=o,l=an(n,r+16),c=l==4294967295;if(c){if(r=an(n,r-12),an(n,r)!=101075792){e("invalid zip file",null);return}a=o=an(n,r+32),l=an(n,r+48)}for(var h=u(function(f){var p=lA(n,l,c),g=p[0],m=p[1],v=p[2],y=p[3],w=p[4],_=p[5],A=aA(n,_);l=w;var x=u(function(T,S){T?(i(),e(T,null)):(s[y]=S,--o||e(null,s))},"cbl");if(!g)x(null,Gi(n,A,A+m));else if(g==8){var C=n.subarray(A,A+m);if(m<32e4)try{x(null,Ml(C,new pt(v)))}catch(T){x(T,null)}else t.push(X0(C,{size:v},x))}else x("unknown compression type "+g,null)},"_loop_3"),d=0;d<a;++d)h();return i}u(Vz,"unzip");function Hz(n){for(var e={},t=n.length-22;an(n,t)!=101010256;--t)if(!t||n.length-t>65558)throw"invalid zip file";var i=ei(n,t+8);if(!i)return{};var s=an(n,t+16),r=s==4294967295;if(r){if(t=an(n,t-12),an(n,t)!=101075792)throw"invalid zip file";i=an(n,t+32),s=an(n,t+48)}for(var o=0;o<i;++o){var a=lA(n,s,r),l=a[0],c=a[1],h=a[2],d=a[3],f=a[4],p=a[5],g=aA(n,p);if(s=f,!l)e[d]=Gi(n,g,g+c);else if(l==8)e[d]=Ml(n.subarray(g,g+c),new pt(h));else throw"unknown compression type "+l}return e}u(Hz,"unzipSync");var Gz=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Es,AsyncDeflate:ZS,deflate:QS,deflateSync:Mu,Inflate:mi,AsyncInflate:j0,inflate:X0,inflateSync:Ml,Gzip:Bd,AsyncGzip:G_,gzip:$_,gzipSync:Ud,Gunzip:Vd,AsyncGunzip:JS,gunzip:eA,gunzipSync:Hd,Zlib:ig,AsyncZlib:Cz,zlib:Tz,zlibSync:sg,Unzlib:Gd,AsyncUnzlib:tA,unzlib:nA,unzlibSync:ou,compress:$_,AsyncCompress:G_,compressSync:Ud,Compress:Bd,Decompress:iA,AsyncDecompress:Ez,decompress:Pz,decompressSync:Iz,DecodeUTF8:Rz,EncodeUTF8:Dz,strToU8:Br,strFromU8:q0,ZipPassThrough:au,ZipDeflate:Lz,AsyncZipDeflate:Fz,Zip:Oz,zip:Nz,zipSync:kz,UnzipPassThrough:uA,UnzipInflate:zz,AsyncUnzipInflate:Bz,Unzip:Uz,unzip:Vz,unzipSync:Hz},Symbol.toStringTag,{value:"Module"}));function hA(n,e,t){const i=t.length-n-1;if(e>=t[i])return i-1;if(e<=t[n])return n;let s=n,r=i,o=Math.floor((s+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}u(hA,"findSpan");function $z(n,e,t,i){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-i[n+1-a],o[a]=i[n+a]-e;let l=0;for(let c=0;c<a;++c){const h=o[c+1],d=r[a-c],f=s[c]/(h+d);s[c]=l+h*f,l=d*f}s[a]=l}return s}u($z,"calcBasisFunctions");function Wz(n,e,t,i){const s=hA(n,i,e),r=$z(s,i,n,e),o=new gt(0,0,0,0);for(let a=0;a<=n;++a){const l=t[s-n+a],c=r[a],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o}u(Wz,"calcBSplinePoint");function jz(n,e,t,i,s){const r=[];for(let d=0;d<=t;++d)r[d]=0;const o=[];for(let d=0;d<=i;++d)o[d]=r.slice(0);const a=[];for(let d=0;d<=t;++d)a[d]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let d=1;d<=t;++d){l[d]=e-s[n+1-d],c[d]=s[n+d]-e;let f=0;for(let p=0;p<d;++p){const g=c[p+1],m=l[d-p];a[d][p]=g+m;const v=a[p][d-1]/a[d][p];a[p][d]=f+g*v,f=m*v}a[d][d]=f}for(let d=0;d<=t;++d)o[0][d]=a[d][t];for(let d=0;d<=t;++d){let f=0,p=1;const g=[];for(let m=0;m<=t;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=i;++m){let v=0;const y=d-m,w=t-m;d>=m&&(g[p][0]=g[f][0]/a[w+1][y],v=g[p][0]*a[y][w]);const _=y>=-1?1:-y,A=d-1<=w?m-1:t-d;for(let C=_;C<=A;++C)g[p][C]=(g[f][C]-g[f][C-1])/a[w+1][y+C],v+=g[p][C]*a[y+C][w];d<=w&&(g[p][m]=-g[f][m-1]/a[w+1][d],v+=g[p][m]*a[d][w]),o[m][d]=v;const x=f;f=p,p=x}}let h=t;for(let d=1;d<=i;++d){for(let f=0;f<=t;++f)o[d][f]*=h;h*=t-d}return o}u(jz,"calcBasisFunctionDerivatives");function Xz(n,e,t,i,s){const r=s<n?s:n,o=[],a=hA(n,i,e),l=jz(a,i,n,r,e),c=[];for(let h=0;h<t.length;++h){const d=t[h].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,c[h]=d}for(let h=0;h<=r;++h){const d=c[a-n].clone().multiplyScalar(l[h][0]);for(let f=1;f<=n;++f)d.add(c[a-n+f].clone().multiplyScalar(l[h][f]));o[h]=d}for(let h=r+1;h<=s+1;++h)o[h]=new gt(0,0,0);return o}u(Xz,"calcBSplineDerivatives");function Yz(n,e){let t=1;for(let s=2;s<=n;++s)t*=s;let i=1;for(let s=2;s<=e;++s)i*=s;for(let s=2;s<=n-e;++s)i*=s;return t/i}u(Yz,"calcKoverI");function qz(n){const e=n.length,t=[],i=[];for(let r=0;r<e;++r){const o=n[r];t[r]=new b(o.x,o.y,o.z),i[r]=o.w}const s=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(s[r-a].clone().multiplyScalar(Yz(r,a)*i[a]));s[r]=o.divideScalar(i[0])}return s}u(qz,"calcRationalCurveDerivatives");function Kz(n,e,t,i,s){const r=Xz(n,e,t,i,s);return qz(r)}u(Kz,"calcNURBSDerivatives");class og extends Bg{constructor(e,t,i,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<i.length;++o){const a=i[o];this.controlPoints[o]=new gt(a.x,a.y,a.z,a.w)}}getPoint(e,t=new b){const i=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=Wz(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),i.set(r.x,r.y,r.z)}getTangent(e,t=new b){const i=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=Kz(this.degree,this.knots,this.controlPoints,s,1);return i.copy(r[1]).normalize(),i}}u(og,"NURBSCurve");let ht,sn,ci;class dA extends fl{constructor(e){super(e)}load(e,t,i,s){const r=this,o=r.path===""?Tf.extractUrlBase(e):r.path,a=new Hg(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},i,s)}parse(e,t){if(Zz(e))ht=new vA().parse(e);else{const s=xA(e);if(!Qz(s))throw new Error("THREE.FBXLoader: Unknown format.");if(j_(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+j_(s));ht=new gA().parse(s)}const i=new Gg(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new fA(i,this.manager).parse(ht)}}u(dA,"FBXLoader");class fA{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){sn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),i=this.parseMaterials(t),s=this.parseDeformers(),r=new pA().parse(s);return this.parseScene(s,r,i),ci}parseConnections(){const e=new Map;return"Connections"in ht&&ht.Connections.connections.forEach(function(i){const s=i[0],r=i[1],o=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in ht.Objects){const i=ht.Objects.Video;for(const s in i){const r=i[s],o=parseInt(s);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(i[s]);t[r.RelativeFilename||r.Filename]=c}}}}for(const i in e){const s=e[i];t[s]!==void 0?e[i]=t[s]:e[i]=e[i].split("\\").pop()}return e}parseImage(e){const t=e.Content,i=e.RelativeFilename||e.Filename,s=i.slice(i.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",i),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in ht.Objects){const i=ht.Objects.Texture;for(const s in i){const r=this.parseTexture(i[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const i=this.loadTexture(e,t);i.ID=e.id,i.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,o=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(i.wrapS=o===0?Ka:pi,i.wrapT=a===0?Ka:pi,"Scaling"in e){const l=e.Scaling.value;i.repeat.x=l[0],i.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;i.offset.x=l[0],i.offset.y=l[1]}return i}loadTexture(e,t){let i;const s=this.textureLoader.path,r=sn.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(i=t[r[0].ID],(i.indexOf("blob:")===0||i.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new On):(l.setPath(this.textureLoader.path),o=l.load(i))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new On):o=this.textureLoader.load(i);return this.textureLoader.setPath(s),o}parseMaterials(e){const t=new Map;if("Material"in ht.Objects){const i=ht.Objects.Material;for(const s in i){const r=this.parseMaterial(i[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const i=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!sn.has(i))return null;const o=this.parseParameters(e,t,i);let a;switch(r.toLowerCase()){case"phong":a=new Ec;break;case"lambert":a=new Ug;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new Ec;break}return a.setValues(o),a.name=s,a}parseParameters(e,t,i){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new Ie().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new Ie().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new Ie().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new Ie().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new Ie().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new Ie().fromArray(e.SpecularColor.value));const r=this;return sn.get(i).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,o.ID),s.map!==void 0&&(s.map.encoding=Dt);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.encoding=Dt);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,o.ID),s.envMap!==void 0&&(s.envMap.mapping=Td,s.envMap.encoding=Dt);break;case"SpecularColor":s.specularMap=r.getTexture(t,o.ID),s.specularMap!==void 0&&(s.specularMap.encoding=Dt);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,t){return"LayeredTexture"in ht.Objects&&t in ht.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=sn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in ht.Objects){const i=ht.Objects.Deformer;for(const s in i){const r=i[s],o=sn.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,i);a.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(o,i),a.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const i=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new Me().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),i.push(o)}),{rawBones:i,bones:[]}}parseMorphTargets(e,t){const i=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=sn.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,i.push(a)}return i}parseScene(e,t,i){ci=new Ei;const s=this.parseModels(e.skeletons,t,i),r=ht.Objects.Model,o=this;s.forEach(function(l){const c=r[l.ID];o.setLookAtProperties(l,c),sn.get(l.ID).parents.forEach(function(d){const f=s.get(d.ID);f!==void 0&&f.add(l)}),l.parent===null&&ci.add(l)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),ci.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=yA(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new mA().parse();ci.children.length===1&&ci.children[0].isGroup&&(ci.children[0].animations=a,ci=ci.children[0]),ci.animations=a}parseModels(e,t,i){const s=new Map,r=ht.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=sn.get(a);let h=this.buildSkeleton(c,e,a,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,i);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new Id;break;case"Null":default:h=new Ei;break}h.name=l.attrName?dt.sanitizeNodeName(l.attrName):"",h.ID=a}this.getTransformData(h,l),s.set(a,h)}return s}buildSkeleton(e,t,i,s){let r=null;return e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,h){if(c.ID===o.ID){const d=r;r=new Id,r.matrixWorld.copy(c.transformLink),r.name=s?dt.sanitizeNodeName(s):"",r.ID=i,l.bones[h]=r,d!==null&&r.add(d)}})}}),r}createCamera(e){let t,i;if(e.children.forEach(function(s){const r=ht.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new yt;else{let s=0;i.CameraProjectionType!==void 0&&i.CameraProjectionType.value===1&&(s=1);let r=1;i.NearPlane!==void 0&&(r=i.NearPlane.value/1e3);let o=1e3;i.FarPlane!==void 0&&(o=i.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;i.AspectWidth!==void 0&&i.AspectHeight!==void 0&&(a=i.AspectWidth.value,l=i.AspectHeight.value);const c=a/l;let h=45;i.FieldOfView!==void 0&&(h=i.FieldOfView.value);const d=i.FocalLength?i.FocalLength.value:null;switch(s){case 0:t=new Dn(h,c,r,o),d!==null&&t.setFocalLength(d);break;case 1:t=new Ho(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new yt;break}}return t}createLight(e){let t,i;if(e.children.forEach(function(s){const r=ht.Objects.NodeAttribute[s.ID];r!==void 0&&(i=r)}),i===void 0)t=new yt;else{let s;i.LightType===void 0?s=0:s=i.LightType.value;let r=16777215;i.Color!==void 0&&(r=new Ie().fromArray(i.Color.value));let o=i.Intensity===void 0?1:i.Intensity.value/100;i.CastLightOnObject!==void 0&&i.CastLightOnObject.value===0&&(o=0);let a=0;i.FarAttenuationEnd!==void 0&&(i.EnableFarAttenuation!==void 0&&i.EnableFarAttenuation.value===0?a=0:a=i.FarAttenuationEnd.value);const l=1;switch(s){case 0:t=new Dd(r,o,a,l);break;case 1:t=new Af(r,o);break;case 2:let c=Math.PI/3;i.InnerAngle!==void 0&&(c=ts.degToRad(i.InnerAngle.value));let h=0;i.OuterAngle!==void 0&&(h=ts.degToRad(i.OuterAngle.value),h=Math.max(h,1)),t=new $g(r,o,a,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a PointLight."),t=new Dd(r,o);break}i.CastShadows!==void 0&&i.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,i){let s,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),i.has(l.ID)&&a.push(i.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Ec({color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(s=new Fw(r,o),s.normalizeSkinWeights()):s=new Ee(r,o),s}createCurve(e,t){const i=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),s=new Wn({color:3342591,linewidth:1});return new gn(i,s)}getTransformData(e,t){const i={};"InheritType"in t&&(i.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?i.eulerOrder=_A(t.RotationOrder.value):i.eulerOrder="ZYX","Lcl_Translation"in t&&(i.translation=t.Lcl_Translation.value),"PreRotation"in t&&(i.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(i.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(i.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(i.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(i.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(i.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(i.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(i.rotationPivot=t.RotationPivot.value),e.userData.transformData=i}setLookAtProperties(e,t){"LookAtProperty"in t&&sn.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=ht.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),ci.add(e.target)):e.lookAt(new b().fromArray(o))}}})}bindSkeleton(e,t,i){const s=this.parsePoseNodes();for(const r in e){const o=e[r];sn.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;sn.get(c).parents.forEach(function(d){i.has(d.ID)&&i.get(d.ID).bind(new xf(o.bones),s[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in ht.Objects){const t=ht.Objects.Pose;for(const i in t)if(t[i].attrType==="BindPose"&&t[i].NbPoseNodes>0){const s=t[i].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new Me().fromArray(r.Matrix.a)}):e[s.Node]=new Me().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in ht&&"AmbientColor"in ht.GlobalSettings){const e=ht.GlobalSettings.AmbientColor.value,t=e[0],i=e[1],s=e[2];if(t!==0||i!==0||s!==0){const r=new Ie(t,i,s);ci.add(new Cf(r,1))}}}}u(fA,"FBXTreeParser");class pA{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in ht.Objects){const i=ht.Objects.Geometry;for(const s in i){const r=sn.get(parseInt(s)),o=this.parseGeometry(r,i[s],e);t.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,i){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,i);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,i){const s=i.skeletons,r=[],o=e.parents.map(function(d){return ht.Objects.Model[d.ID]});if(o.length===0)return;const a=e.children.reduce(function(d,f){return s[f.ID]!==void 0&&(d=s[f.ID]),d},null);e.children.forEach(function(d){i.morphTargets[d.ID]!==void 0&&r.push(i.morphTargets[d.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=_A(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=yA(c);return this.genGeometry(t,a,r,h)}genGeometry(e,t,i,s){const r=new Qe;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new Fe(a.vertex,3);if(l.applyMatrix4(s),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new Fe(a.colors,3)),t&&(r.setAttribute("skinIndex",new gf(a.weightsIndices,4)),r.setAttribute("skinWeight",new Fe(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new ti().getNormalMatrix(s),h=new Fe(a.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(a.uvs.forEach(function(c,h){let d="uv"+(h+1).toString();h===0&&(d="uv"),r.setAttribute(d,new Fe(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(d,f){d!==c&&(r.addGroup(h,f-h,c),c=d,h=f)}),r.groups.length>0){const d=r.groups[r.groups.length-1],f=d.start+d.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,i,s),r}parseGeoNode(e,t){const i={};if(i.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],i.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(i.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(i.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(i.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){i.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&i.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return i.weightTable={},t!==null&&(i.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(o,a){i.weightTable[o]===void 0&&(i.weightTable[o]=[]),i.weightTable[o].push({id:r,weight:s.weights[a]})})})),i}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,s=0,r=!1,o=[],a=[],l=[],c=[],h=[],d=[];const f=this;return e.vertexIndices.forEach(function(p,g){let m,v=!1;p<0&&(p=p^-1,v=!0);let y=[],w=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const _=xh(g,i,p,e.color);l.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(_){w.push(_.weight),y.push(_.id)}),w.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],A=[0,0,0,0];w.forEach(function(x,C){let T=x,S=y[C];A.forEach(function(I,D,B){if(T>I){B[D]=T,T=I;const Q=_[D];_[D]=S,S=Q}})}),y=_,w=A}for(;w.length<4;)w.push(0),y.push(0);for(let _=0;_<4;++_)h.push(w[_]),d.push(y[_])}if(e.normal){const _=xh(g,i,p,e.normal);a.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=xh(g,i,p,e.material)[0],m<0&&(f.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(_,A){const x=xh(g,i,p,_);c[A]===void 0&&(c[A]=[]),c[A].push(x[0]),c[A].push(x[1])}),s++,v&&(f.genFace(t,e,o,m,a,l,c,h,d,s),i++,s=0,o=[],a=[],l=[],c=[],h=[],d=[])}),t}genFace(e,t,i,s,r,o,a,l,c,h){for(let d=2;d<h;d++)e.vertex.push(t.vertexPositions[i[0]]),e.vertex.push(t.vertexPositions[i[1]]),e.vertex.push(t.vertexPositions[i[2]]),e.vertex.push(t.vertexPositions[i[(d-1)*3]]),e.vertex.push(t.vertexPositions[i[(d-1)*3+1]]),e.vertex.push(t.vertexPositions[i[(d-1)*3+2]]),e.vertex.push(t.vertexPositions[i[d*3]]),e.vertex.push(t.vertexPositions[i[d*3+1]]),e.vertex.push(t.vertexPositions[i[d*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(d-1)*4]),e.vertexWeights.push(l[(d-1)*4+1]),e.vertexWeights.push(l[(d-1)*4+2]),e.vertexWeights.push(l[(d-1)*4+3]),e.vertexWeights.push(l[d*4]),e.vertexWeights.push(l[d*4+1]),e.vertexWeights.push(l[d*4+2]),e.vertexWeights.push(l[d*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(d-1)*4]),e.weightsIndices.push(c[(d-1)*4+1]),e.weightsIndices.push(c[(d-1)*4+2]),e.weightsIndices.push(c[(d-1)*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(d-1)*3]),e.colors.push(o[(d-1)*3+1]),e.colors.push(o[(d-1)*3+2]),e.colors.push(o[d*3]),e.colors.push(o[d*3+1]),e.colors.push(o[d*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(d-1)*3]),e.normal.push(r[(d-1)*3+1]),e.normal.push(r[(d-1)*3+2]),e.normal.push(r[d*3]),e.normal.push(r[d*3+1]),e.normal.push(r[d*3+2])),t.uv&&t.uv.forEach(function(f,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(d-1)*2]),e.uvs[p].push(a[p][(d-1)*2+1]),e.uvs[p].push(a[p][d*2]),e.uvs[p].push(a[p][d*2+1])})}addMorphTargets(e,t,i,s){if(i.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;i.forEach(function(o){o.rawTargets.forEach(function(a){const l=ht.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,s,a.name)})})}genMorphGeometry(e,t,i,s,r){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=i.Vertices!==void 0?i.Vertices.a:[],l=i.Indexes!==void 0?i.Indexes.a:[],c=e.attributes.position.count*3,h=new Float32Array(c);for(let g=0;g<l.length;g++){const m=l[g]*3;h[m]=a[g*3],h[m+1]=a[g*3+1],h[m+2]=a[g*3+2]}const d={vertexIndices:o,vertexPositions:h},f=this.genBuffers(d),p=new Fe(f.vertex,3);p.name=r||i.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Normals.a;let r=[];return i==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:i}}parseUVs(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.UV.a;let r=[];return i==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:i}}parseVertexColors(e){const t=e.MappingInformationType,i=e.ReferenceInformationType,s=e.Colors.a;let r=[];return i==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:i}}parseMaterialIndices(e){const t=e.MappingInformationType,i=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const s=e.Materials.a,r=[];for(let o=0;o<s.length;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:i}}parseNurbsGeometry(e){if(og===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Qe;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Qe;const i=t-1,s=e.KnotVector.a,r=[],o=e.Points.a;for(let d=0,f=o.length;d<f;d+=4)r.push(new gt().fromArray(o,d));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=i,l=s.length-1-a;for(let d=0;d<i;++d)r.push(r[d])}const h=new og(i,s,r,a,l).getPoints(r.length*12);return new Qe().setFromPoints(h)}}u(pA,"GeometryParser");class mA{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const i in t){const s=t[i],r=this.addClip(s);e.push(r)}return e}parseClips(){if(ht.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=ht.Objects.AnimationCurveNode,t=new Map;for(const i in e){const s=e[i];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=ht.Objects.AnimationCurve;for(const i in t){const s={id:t[i].id,times:t[i].KeyTime.a.map(Jz),values:t[i].KeyValueFloat.a},r=sn.get(s.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=s:a.match(/Y/)?e.get(o).curves.y=s:a.match(/Z/)?e.get(o).curves.z=s:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=s)}}}parseAnimationLayers(e){const t=ht.Objects.AnimationLayer,i=new Map;for(const s in t){const r=[],o=sn.get(parseInt(s));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const d=sn.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(d!==void 0){const f=ht.Objects.Model[d.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:f.attrName?dt.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ci.traverse(function(g){g.ID===f.id&&(p.transform=g.matrix,g.userData.transformData&&(p.eulerOrder=g.userData.transformData.eulerOrder))}),p.transform||(p.transform=new Me),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[c]=p}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const d=sn.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,f=sn.get(d).parents[0].ID,p=sn.get(f).parents[0].ID,g=sn.get(p).parents[0].ID,m=ht.Objects.Model[g],v={modelName:m.attrName?dt.sanitizeNodeName(m.attrName):"",morphName:ht.Objects.Deformer[d].attrName};r[c]=v}r[c][h.attr]=h}}}),i.set(parseInt(s),r))}return i}parseAnimStacks(e){const t=ht.Objects.AnimationStack,i={};for(const s in t){const r=sn.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);i[s]={name:t[s].attrName,layer:o}}return i}addClip(e){let t=[];const i=this;return e.layer.forEach(function(s){t=t.concat(i.generateTracks(s))}),new Hw(e.name,-1,t)}generateTracks(e){const t=[];let i=new b,s=new Ve,r=new b;if(e.transform&&e.transform.decompose(i,s,r),i=i.toArray(),s=new mt().setFromQuaternion(s,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,i,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,i,s){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,i);return new tl(e+"."+s,r,o)}generateRotationTrack(e,t,i,s,r,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ts.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ts.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ts.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,i);s!==void 0&&(s=s.map(ts.degToRad),s.push(o),s=new mt().fromArray(s),s=new Ve().setFromEuler(s)),r!==void 0&&(r=r.map(ts.degToRad),r.push(o),r=new mt().fromArray(r),r=new Ve().setFromEuler(r).invert());const c=new Ve,h=new mt,d=[];for(let f=0;f<l.length;f+=3)h.set(l[f],l[f+1],l[f+2],o),c.setFromEuler(h),s!==void 0&&c.premultiply(s),r!==void 0&&c.multiply(r),c.toArray(d,f/3*4);return new $o(e+".quaternion",a,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,i=t.values.map(function(r){return r/100}),s=ci.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new el(e.modelName+".morphTargetInfluences["+s+"]",t.times,i)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(i,s){return i-s}),t.length>1){let i=1,s=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==s&&(t[i]=o,s=o,i++)}t=t.slice(0,i)}return t}getKeyframeTrackValues(e,t,i){const s=i,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const h=t.x.values[o];r.push(h),s[0]=h}else r.push(s[0]);if(a!==-1){const h=t.y.values[a];r.push(h),s[1]=h}else r.push(s[1]);if(l!==-1){const h=t.z.values[l];r.push(h),s[2]=h}else r.push(s[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const i=e.values[t-1],s=e.values[t]-i,r=Math.abs(s);if(r>=180){const o=r/180,a=s/o;let l=i+a;const c=e.times[t-1],d=(e.times[t]-c)/o;let f=c+d;const p=[],g=[];for(;f<e.times[t];)p.push(f),f+=d,g.push(l),l+=a;e.times=X_(e.times,t,p),e.values=X_(e.values,t,g)}}}}u(mA,"AnimationParser");class gA{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Z0,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,i=e.split(/[\r\n]+/);return i.forEach(function(s,r){const o=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(o||a)return;const l=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(s,l):c?t.parseNodeProperty(s,c,i[++r]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const i=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:i},o=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(i,r):i in a?(i==="PoseNode"?a.PoseNode.push(r):a[i].id!==void 0&&(a[i]={},a[i][a[i].id]=a[i]),o.id!==""&&(a[i][o.id]=r)):typeof o.id=="number"?(a[i]={},a[i][o.id]=r):i!=="Properties70"&&(i==="PoseNode"?a[i]=[r]:a[i]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let i="",s="";return e.length>1&&(i=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:i,type:s}}parseNodeProperty(e,t,i){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=i.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let d=r.split(",").slice(3);d=d.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",r=[c,h],tB(r,d),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=r),s in o&&Array.isArray(o[s])?o[s].push(r):s!=="a"?o[s]=r:o.a=r,this.setCurrentProp(o,s),s==="a"&&r.slice(-1)!==","&&(o.a=Up(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Up(t.a))}parseNodeSpecialProperty(e,t,i){const s=i.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],o=s[1],a=s[2],l=s[3];let c=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Up(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}u(gA,"TextParser");class vA{parse(e){const t=new ag(e);t.skip(23);const i=t.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const s=new Z0;for(;!this.endOfContent(t);){const r=this.parseNode(t,i);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const i={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(s===0)return null;const l=[];for(let f=0;f<r;f++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(i.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,i,f)}return i.propertyList=l,typeof c=="number"&&(i.id=c),h!==""&&(i.attrName=h),d!==""&&(i.attrType=d),a!==""&&(i.name=a),i}parseSubNode(e,t,i){if(i.singleProperty===!0){const s=i.propertyList[0];Array.isArray(s)?(t[i.name]=i,i.a=s):t[i.name]=s}else if(e==="Connections"&&i.name==="C"){const s=[];i.propertyList.forEach(function(r,o){o!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(i.name==="Properties70")Object.keys(i).forEach(function(r){t[r]=i[r]});else if(e==="Properties70"&&i.name==="P"){let s=i.propertyList[0],r=i.propertyList[1];const o=i.propertyList[2],a=i.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:l=i.propertyList[4],t[s]={type:r,type2:o,flag:a,value:l}}else t[i.name]===void 0?typeof i.id=="number"?(t[i.name]={},t[i.name][i.id]=i):t[i.name]=i:i.name==="PoseNode"?(Array.isArray(t[i.name])||(t[i.name]=[t[i.name]]),t[i.name].push(i)):t[i.name][i.id]===void 0&&(t[i.name][i.id]=i)}parseProperty(e){const t=e.getString(1);let i;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return i=e.getUint32(),e.getArrayBuffer(i);case"S":return i=e.getUint32(),e.getString(i);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}typeof Gz=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=ou(new Uint8Array(e.getArrayBuffer(o))),l=new ag(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}u(vA,"BinaryParser");class ag{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let i=0;i<e;i++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let i=0;i<e;i++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let s=0;s<e;s++)t[s]=this.getUint8();const i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),Tf.decodeText(new Uint8Array(t))}}u(ag,"BinaryReader");class Z0{add(e,t){this[e]=t}}u(Z0,"FBXTree");function Zz(n){const e="Kaydara FBX Binary  \0";return n.byteLength>=e.length&&e===xA(n,0,e.length)}u(Zz,"isFbxFormatBinary");function Qz(n){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function i(s){const r=n[s-1];return n=n.slice(t+s),t++,r}u(i,"read");for(let s=0;s<e.length;++s)if(i(1)===e[s])return!1;return!0}u(Qz,"isFbxFormatASCII");function j_(n){const e=/FBXVersion: (\d+)/,t=n.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}u(j_,"getFbxVersion");function Jz(n){return n/46186158e3}u(Jz,"convertFBXTimeToSeconds");const eB=[];function xh(n,e,t,i){let s;switch(i.mappingType){case"ByPolygonVertex":s=n;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}i.referenceType==="IndexToDirect"&&(s=i.indices[s]);const r=s*i.dataSize,o=r+i.dataSize;return nB(eB,i.buffer,r,o)}u(xh,"getData");const Bp=new mt,fa=new b;function yA(n){const e=new Me,t=new Me,i=new Me,s=new Me,r=new Me,o=new Me,a=new Me,l=new Me,c=new Me,h=new Me,d=new Me,f=new Me,p=n.inheritType?n.inheritType:0;if(n.translation&&e.setPosition(fa.fromArray(n.translation)),n.preRotation){const D=n.preRotation.map(ts.degToRad);D.push(n.eulerOrder||mt.DefaultOrder),t.makeRotationFromEuler(Bp.fromArray(D))}if(n.rotation){const D=n.rotation.map(ts.degToRad);D.push(n.eulerOrder||mt.DefaultOrder),i.makeRotationFromEuler(Bp.fromArray(D))}if(n.postRotation){const D=n.postRotation.map(ts.degToRad);D.push(n.eulerOrder||mt.DefaultOrder),s.makeRotationFromEuler(Bp.fromArray(D)),s.invert()}n.scale&&r.scale(fa.fromArray(n.scale)),n.scalingOffset&&a.setPosition(fa.fromArray(n.scalingOffset)),n.scalingPivot&&o.setPosition(fa.fromArray(n.scalingPivot)),n.rotationOffset&&l.setPosition(fa.fromArray(n.rotationOffset)),n.rotationPivot&&c.setPosition(fa.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(d.copy(n.parentMatrix),h.copy(n.parentMatrixWorld));const g=t.clone().multiply(i).multiply(s),m=new Me;m.extractRotation(h);const v=new Me;v.copyPosition(h);const y=v.clone().invert().multiply(h),w=m.clone().invert().multiply(y),_=r,A=new Me;if(p===0)A.copy(m).multiply(g).multiply(w).multiply(_);else if(p===1)A.copy(m).multiply(w).multiply(g).multiply(_);else{const B=new Me().scale(new b().setFromMatrixScale(d)).clone().invert(),Q=w.clone().multiply(B);A.copy(m).multiply(g).multiply(Q).multiply(_)}const x=c.clone().invert(),C=o.clone().invert();let T=e.clone().multiply(l).multiply(c).multiply(t).multiply(i).multiply(s).multiply(x).multiply(a).multiply(o).multiply(r).multiply(C);const S=new Me().copyPosition(T),I=h.clone().multiply(S);return f.copyPosition(I),T=f.clone().multiply(A),T.premultiply(h.invert()),T}u(yA,"generateTransform");function _A(n){n=n||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[n]}u(_A,"getEulerOrder");function Up(n){return n.split(",").map(function(t){return parseFloat(t)})}u(Up,"parseNumberArray");function xA(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=n.byteLength),Tf.decodeText(new Uint8Array(n,e,t))}u(xA,"convertArrayBufferToString");function tB(n,e){for(let t=0,i=n.length,s=e.length;t<s;t++,i++)n[i]=e[t]}u(tB,"append");function nB(n,e,t,i){for(let s=t,r=0;s<i;s++,r++)n[r]=e[s];return n}u(nB,"slice");function X_(n,e,t){return n.slice(0,e).concat(t).concat(n.slice(e))}u(X_,"inject");const iB=/^[og]\s*(.+)?/,sB=/^mtllib /,rB=/^usemtl /,oB=/^usemap /,Y_=/\s+/,q_=new b,Vp=new b,K_=new b,Z_=new b,Oi=new b,bh=new Ie;function aB(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},i&&i.name&&typeof i.clone=="function"){const s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseNormalIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/3)*3},parseUVIndex:function(e,t){const i=parseInt(e,10);return(i>=0?i-1:i+t/2)*2},addVertex:function(e,t,i){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[i+0],s[i+1],s[i+2])},addFaceNormal:function(e,t,i){const s=this.vertices,r=this.object.geometry.normals;q_.fromArray(s,e),Vp.fromArray(s,t),K_.fromArray(s,i),Oi.subVectors(K_,Vp),Z_.subVectors(q_,Vp),Oi.cross(Z_),Oi.normalize(),r.push(Oi.x,Oi.y,Oi.z),r.push(Oi.x,Oi.y,Oi.z),r.push(Oi.x,Oi.y,Oi.z)},addColor:function(e,t,i){const s=this.colors,r=this.object.geometry.colors;s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[i]!==void 0&&r.push(s[i+0],s[i+1],s[i+2])},addUV:function(e,t,i){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[i+0],s[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,s,r,o,a,l,c){const h=this.vertices.length;let d=this.parseVertexIndex(e,h),f=this.parseVertexIndex(t,h),p=this.parseVertexIndex(i,h);if(this.addVertex(d,f,p),this.addColor(d,f,p),a!==void 0&&a!==""){const g=this.normals.length;d=this.parseNormalIndex(a,g),f=this.parseNormalIndex(l,g),p=this.parseNormalIndex(c,g),this.addNormal(d,f,p)}else this.addFaceNormal(d,f,p);if(s!==void 0&&s!==""){const g=this.uvs.length;d=this.parseUVIndex(s,g),f=this.parseUVIndex(r,g),p=this.parseUVIndex(o,g),this.addUV(d,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,s=e.length;i<s;i++){const r=this.parseVertexIndex(e[i],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,s=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],i));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],s))}};return n.startObject("",!1),n}u(aB,"ParserState");class bA extends fl{constructor(e){super(e),this.materials=null}load(e,t,i,s){const r=this,o=new Hg(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(a))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},i,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new aB;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let s=[];for(let a=0,l=i.length;a<l;a++){const c=i[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const d=c.split(Y_);switch(d[0]){case"v":t.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7?(bh.setRGB(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6])).convertSRGBToLinear(),t.colors.push(bh.r,bh.g,bh.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":t.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(h==="f"){const f=c.slice(1).trim().split(Y_),p=[];for(let m=0,v=f.length;m<v;m++){const y=f[m];if(y.length>0){const w=y.split("/");p.push(w)}}const g=p[0];for(let m=1,v=p.length-1;m<v;m++){const y=p[m],w=p[m+1];t.addFace(g[0],y[0],w[0],g[1],y[1],w[1],g[2],y[2],w[2])}}else if(h==="l"){const d=c.substring(1).trim().split(" ");let f=[];const p=[];if(c.indexOf("/")===-1)f=d;else for(let g=0,m=d.length;g<m;g++){const v=d[g].split("/");v[0]!==""&&f.push(v[0]),v[1]!==""&&p.push(v[1])}t.addLineGeometry(f,p)}else if(h==="p"){const f=c.slice(1).trim().split(" ");t.addPointGeometry(f)}else if((s=iB.exec(c))!==null){const d=(" "+s[0].slice(1).trim()).slice(1);t.startObject(d)}else if(rB.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(sB.test(c))t.materialLibraries.push(c.substring(7).trim());else if(oB.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(s=c.split(" "),s.length>1){const f=s[1].trim().toLowerCase();t.object.smooth=f!=="0"&&f!=="off"}else t.object.smooth=!0;const d=t.object.currentMaterial();d&&(d.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();const r=new Ei;if(r.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=t.objects.length;a<l;a++){const c=t.objects[a],h=c.geometry,d=c.materials,f=h.type==="Line",p=h.type==="Points";let g=!1;if(h.vertices.length===0)continue;const m=new Qe;m.setAttribute("position",new Fe(h.vertices,3)),h.normals.length>0&&m.setAttribute("normal",new Fe(h.normals,3)),h.colors.length>0&&(g=!0,m.setAttribute("color",new Fe(h.colors,3))),h.hasUVIndices===!0&&m.setAttribute("uv",new Fe(h.uvs,2));const v=[];for(let w=0,_=d.length;w<_;w++){const A=d[w],x=A.name+"_"+A.smooth+"_"+g;let C=t.materials[x];if(this.materials!==null){if(C=this.materials.create(A.name),f&&C&&!(C instanceof Wn)){const T=new Wn;$i.prototype.copy.call(T,C),T.color.copy(C.color),C=T}else if(p&&C&&!(C instanceof Sr)){const T=new Sr({size:10,sizeAttenuation:!1});$i.prototype.copy.call(T,C),T.color.copy(C.color),T.map=C.map,C=T}}C===void 0&&(f?C=new Wn:p?C=new Sr({size:1,sizeAttenuation:!1}):C=new Ec,C.name=A.name,C.flatShading=!A.smooth,C.vertexColors=g,t.materials[x]=C),v.push(C)}let y;if(v.length>1){for(let w=0,_=d.length;w<_;w++){const A=d[w];m.addGroup(A.groupStart,A.groupCount,w)}f?y=new Zs(m,v):p?y=new Va(m,v):y=new Ee(m,v)}else f?y=new Zs(m,v[0]):p?y=new Va(m,v[0]):y=new Ee(m,v[0]);y.name=c.name,r.add(y)}else if(t.vertices.length>0){const a=new Sr({size:1,sizeAttenuation:!1}),l=new Qe;l.setAttribute("position",new Fe(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new Fe(t.colors,3)),a.vertexColors=!0);const c=new Va(l,a);r.add(c)}return r}}u(bA,"OBJLoader");var lB=Object.defineProperty,cB=u((n,e)=>lB(n,"name",{value:e,configurable:!0}),"__name$_");class Q0{update(e,t){if(!t.instanceId){if(t.has(zr)){const i=t.get(zr);if(!i.dirty||(i.dirty=!1,!i.value))return;const s=t.get(Ce);s.dispose(),s.value=new bA().parse(i.value),s.value.userData={node:t};for(let r of s.value.children)r.userData={node:t};s.parentChanged=!0,s.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)}else if(t.has(kr)){const i=t.get(kr);if(!i.dirty||(i.dirty=!1,!i.value))return;const s=t.get(Ce);s.dispose(),i0(i.value).then(function(r){if(!t.deleted){s.value=new dA().parse(r,void 0),s.value.userData={node:t};for(let o of s.value.children)o.userData={node:t};s.parentChanged=!0,s.localTransformChanged=!0,t.dirty=!0,e.model.dirty=!0,e.model.instanceMeshUpdated(t.id,!0)}})}}}}u(Q0,"ImportModelUpdateFilter");cB(Q0,"ImportModelUpdateFilter");var uB=Object.defineProperty,hB=u((n,e)=>uB(n,"name",{value:e,configurable:!0}),"__name$Z");class J0{update(e,t){if(t.has(ni)){const i=t.get(ni),s=i.value;s&&s.update();const r=i.camera;r&&r.update()}}}u(J0,"LightHelperUpdateFilter");hB(J0,"LightHelperUpdateFilter");var dB=Object.defineProperty,fB=u((n,e)=>dB(n,"name",{value:e,configurable:!0}),"__name$Y");class e1{update(e,t){var i,s,r,o;switch(t.type){case"AmbientLight":{const a=t.get(Ce);a.value||(a.value=new Cf);const l=a.value,c=t.value(vn);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(Zn)}break;case"HemisphereLight":{const a=t.get(Ce);a.value||(a.value=new jw);const l=a.value,c=t.value(eu);l.color.setRGB(c[0],c[1],c[2]);const h=t.value(Kc);l.groundColor.setRGB(h[0],h[1],h[2]),l.intensity=t.value(Zn);const d=t.get(ni);d.value||(d.value=new eM(l,.25),e.scene.add(d.value))}break;case"DirectionalLight":{const a=t.get(Ce);a.value||(a.value=new Af);const l=a.value;l.castShadow=t.value(rn);const c=t.value(vn);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(Zn);const h=Number.parseInt(t.value(Oo));l.shadow.mapSize.x!==h&&(l.shadow.mapSize.set(h,h),(i=l.shadow.map)==null||i.setSize(h,h),(s=l.shadow.mapPass)==null||s.setSize(h,h),l.shadow.dispose());const d=t.value(Jc)/2;l.shadow.camera.top=+d,l.shadow.camera.right=+d,l.shadow.camera.bottom=-d,l.shadow.camera.left=-d,l.shadow.camera.near=0,l.shadow.camera.updateProjectionMatrix();const f=t.get(ni);f.value||(f.value=new tM(l),e.scene.add(f.value)),f.camera||(f.camera=new nM(l.shadow.camera),e.scene.add(f.camera));const g=t.children[0].get(Ce);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break;case"PointLight":{const a=t.get(Ce);a.value||(a.value=new Dd);const l=a.value;l.castShadow=t.value(rn);const c=t.value(vn);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(Zn);const h=.005;l.shadow.camera.near!==h&&(l.shadow.camera.near=h,l.shadow.camera.updateProjectionMatrix());const d=t.get(ni);d.value||(d.value=new Jw(l,.25),e.scene.add(d.value))}break;case"SpotLight":{const a=t.get(Ce);a.value||(a.value=new $g);const l=a.value;l.castShadow=t.value(rn);const c=t.value(vn);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(Zn),l.angle=t.value(tu)/180*Math.PI,l.penumbra=t.value(Qc);const h=Number.parseInt(t.value(Oo));l.shadow.mapSize.x!==h&&(l.shadow.mapSize.set(h,h),(r=l.shadow.map)==null||r.setSize(h,h),(o=l.shadow.mapPass)==null||o.setSize(h,h),l.shadow.dispose());const d=.005;l.shadow.camera.near!==d&&(l.shadow.camera.near=d,l.shadow.camera.updateProjectionMatrix());const f=t.get(ni);f.value||(f.value=new Qw(l),e.scene.add(f.value));const g=t.children[0].get(Ce);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break}}}u(e1,"LightUpdateFilter");fB(e1,"LightUpdateFilter");var pB=Object.defineProperty,mB=u((n,e)=>pB(n,"name",{value:e,configurable:!0}),"__name$X");class t1{update(e,t){if(!t.instanceId&&t.has(Ce)){const i=t.value(Ce);if(!i||!i.isMesh)return;const s=i.material;if(!(s!=null&&s.isMeshStandardMaterial))return;if(t.has(vn)){const r=t.value(vn);s.color.setRGB(r[0],r[1],r[2])}if(t.has(Ir)){const r=t.value(Ir);s.emissive.setRGB(r[0],r[1],r[2])}t.has(Dr)&&(s.roughness=t.value(Dr)),t.has(Rr)&&(s.metalness=t.value(Rr))}}}u(t1,"MaterialUpdateFilter");mB(t1,"MaterialUpdateFilter");class Su extends Ee{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Dn;const i=this,s=t.color!==void 0?new Ie(t.color):new Ie(8355711),r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,l=t.shader||Su.ReflectorShader,c=t.multisample!==void 0?t.multisample:4,h=new Ws,d=new b,f=new b,p=new b,g=new Me,m=new b(0,0,-1),v=new gt,y=new b,w=new b,_=new gt,A=new Me,x=this.camera,C=new Rn(r,o,{samples:c,type:Za}),T=new Vn({uniforms:vf.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});T.uniforms.tDiffuse.value=C.texture,T.uniforms.color.value=s,T.uniforms.textureMatrix.value=A,this.material=T,this.onBeforeRender=function(S,I,D){if(f.setFromMatrixPosition(i.matrixWorld),p.setFromMatrixPosition(D.matrixWorld),g.extractRotation(i.matrixWorld),d.set(0,0,1),d.applyMatrix4(g),y.subVectors(f,p),y.dot(d)>0)return;y.reflect(d).negate(),y.add(f),g.extractRotation(D.matrixWorld),m.set(0,0,-1),m.applyMatrix4(g),m.add(p),w.subVectors(f,m),w.reflect(d).negate(),w.add(f),x.position.copy(y),x.up.set(0,1,0),x.up.applyMatrix4(g),x.up.reflect(d),x.lookAt(w),x.far=D.far,x.updateMatrixWorld(),x.projectionMatrix.copy(D.projectionMatrix),A.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),A.multiply(x.projectionMatrix),A.multiply(x.matrixWorldInverse),A.multiply(i.matrixWorld),h.setFromNormalAndCoplanarPoint(d,f),h.applyMatrix4(x.matrixWorldInverse),v.set(h.normal.x,h.normal.y,h.normal.z,h.constant);const B=x.projectionMatrix;_.x=(Math.sign(v.x)+B.elements[8])/B.elements[0],_.y=(Math.sign(v.y)+B.elements[9])/B.elements[5],_.z=-1,_.w=(1+B.elements[10])/B.elements[14],v.multiplyScalar(2/v.dot(_)),B.elements[2]=v.x,B.elements[6]=v.y,B.elements[10]=v.z+1-a,B.elements[14]=v.w,i.visible=!1;const Q=S.getRenderTarget(),U=S.xr.enabled,z=S.shadowMap.autoUpdate,q=S.outputEncoding,ee=S.toneMapping;S.xr.enabled=!1,S.shadowMap.autoUpdate=!1,S.outputEncoding=Ks,S.toneMapping=As,S.setRenderTarget(C),S.state.buffers.depth.setMask(!0),S.autoClear===!1&&S.clear(),S.render(I,x),S.xr.enabled=U,S.shadowMap.autoUpdate=z,S.outputEncoding=q,S.toneMapping=ee,S.setRenderTarget(Q);const J=D.viewport;J!==void 0&&S.state.viewport(J),i.visible=!0},this.getRenderTarget=function(){return C},this.dispose=function(){C.dispose(),i.material.dispose()}}}u(Su,"Reflector");Su.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <encodings_fragment>

		}`};var gB=Object.defineProperty,vB=u((n,e)=>gB(n,"name",{value:e,configurable:!0}),"__name$W");class n1{update(e,t){if(t.type!=="Mirror")return;const i=t.value(iu),s=t.value(Zc),r=t.get(Ce);if(!r.value){const d=t.value(vn);r.value=new Su(new Fo(i,s),{color:new Ie().setRGB(d[0],d[1],d[2])}),r.value.userData.node=t;return}const o=r.value,a=o.geometry;(a.parameters.width!==i||a.parameters.height!==s)&&(a.dispose(),r.value.geometry=new Fo(i,s));const l=o.material.uniforms.color.value,c=t.value(vn);l.setRGB(c[0],c[1],c[2]);const h=Number.parseInt(t.value(nu));o.getRenderTarget().setSize(h,h)}}u(n1,"MirrorUpdateFilter");vB(n1,"MirrorUpdateFilter");var yB=Object.defineProperty,_B=u((n,e)=>yB(n,"name",{value:e,configurable:!0}),"__name$V");class i1{update(e,t){if(t.has(Ce)){const i=t.get(Ce);if(i.parentChanged){const r=i.value;if(r){r.removeFromParent();const o=Ze(t.parent);if(o){if(o.has(Ce)){const a=o.value(Ce);a&&a.add(r)}}else e.scene.add(r)}i.parentChanged=!1}const s=t.has(zt)?t.value(zt):!0;i.value&&(i.value.visible=s)}}}u(i1,"Object3DRelationshipUpdateFilter");_B(i1,"Object3DRelationshipUpdateFilter");var xB=Object.defineProperty,wA=u((n,e)=>xB(n,"name",{value:e,configurable:!0}),"__name$U");function s1(n,e){if(n.isGroup)for(let t of n.children)s1(t,e);else{const t=n;if(t.userData.node&&t.material)if(Array.isArray(t.material))for(let i of t.material)i.opacity!==e&&(i.opacity=e,i.transparent=i.opacity<1,i.needsUpdate=!0);else t.material.opacity!==e&&(t.material.opacity=e,t.material.transparent=t.material.opacity<1,t.material.needsUpdate=!0)}}u(s1,"setOpacity");wA(s1,"setOpacity");class r1{update(e,t){if(!t.instanceId&&(t.opacity=(t.parent?t.parent.opacity:1)*(t.has(Kn)?t.value(Kn):1),t.has(Ce))){const i=t.get(Ce);i.value&&s1(i.value,t.opacity)}}}u(r1,"OpacityUpdateFilter");wA(r1,"OpacityUpdateFilter");var bB=Object.defineProperty,wB=u((n,e)=>bB(n,"name",{value:e,configurable:!0}),"__name$T");class o1{update(e,t){if(!t.has(Ce)||!t.has(rn)&&!t.has(Qn))return;const i=t.value(Ce);if(!!i)if(i.isGroup)for(let s of i.children)t.has(rn)&&(s.castShadow=t.value(rn)),t.has(Qn)&&(s.receiveShadow=t.value(Qn));else t.has(rn)&&(i.castShadow=t.value(rn)),t.has(Qn)&&(i.receiveShadow=t.value(Qn))}}u(o1,"ShadowUpdateFilter");wB(o1,"ShadowUpdateFilter");var MB=Object.defineProperty,SB=u((n,e)=>MB(n,"name",{value:e,configurable:!0}),"__name$S");class a1{update(e,t){if(t.has(Ce)){const i=t.get(Ce),s=i.value;if(s){if(i.localTransformChanged){if(t.has(je)&&s.position.copy(t.value(je)),t.has(bt)&&s.rotation.copy(t.value(bt)),t.has(Bt)&&(s.scale.x=s.scale.y=s.scale.z=t.value(Bt)),t.has(vt)){const r=t.get(vt);s.position.copy(r.start),s.quaternion.copy(r.quaternion)}s.updateMatrix(),i.localTransformChanged=!1}i.worldTransformChanged&&(s.updateMatrixWorld(!0),i.worldTransformChanged=!1,t.forEach(r=>{if(r.has(nt)){const o=r.get(nt);o.group&&(o.group.matrixAutoUpdate=!1,o.group.matrix.copy(r.getWorldMatrix()))}}))}}}}u(a1,"TransformUpdateFilter");SB(a1,"TransformUpdateFilter");class Lf extends Qe{constructor(e=(s,r,o)=>o.set(s,r,Math.cos(s)*Math.sin(r)),t=8,i=8){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i};const s=[],r=[],o=[],a=[],l=1e-5,c=new b,h=new b,d=new b,f=new b,p=new b,g=t+1;for(let m=0;m<=i;m++){const v=m/i;for(let y=0;y<=t;y++){const w=y/t;e(w,v,h),r.push(h.x,h.y,h.z),w-l>=0?(e(w-l,v,d),f.subVectors(h,d)):(e(w+l,v,d),f.subVectors(d,h)),v-l>=0?(e(w,v-l,d),p.subVectors(h,d)):(e(w,v+l,d),p.subVectors(d,h)),c.crossVectors(f,p).normalize(),o.push(c.x,c.y,c.z),a.push(w,v)}}for(let m=0;m<i;m++)for(let v=0;v<t;v++){const y=m*g+v,w=m*g+v+1,_=(m+1)*g+v+1,A=(m+1)*g+v;s.push(y,w,A),s.push(w,_,A)}this.setIndex(s),this.setAttribute("position",new Fe(r,3)),this.setAttribute("normal",new Fe(o,3)),this.setAttribute("uv",new Fe(a,2))}}u(Lf,"ParametricGeometry");const cl={klein:function(n,e,t){e*=Math.PI,n*=2*Math.PI,e=e*2;let i,s;e<Math.PI?(i=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(e)*Math.cos(n),s=-8*Math.sin(e)-2*(1-Math.cos(e)/2)*Math.sin(e)*Math.cos(n)):(i=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(n+Math.PI),s=-8*Math.sin(e));const r=-2*(1-Math.cos(e)/2)*Math.sin(n);t.set(i,r,s)},plane:function(n,e){return function(t,i,s){const r=t*n,o=0,a=i*e;s.set(r,o,a)}},mobius:function(n,e,t){n=n-.5;const i=2*Math.PI*e,s=2,r=Math.cos(i)*(s+n*Math.cos(i/2)),o=Math.sin(i)*(s+n*Math.cos(i/2)),a=n*Math.sin(i/2);t.set(r,o,a)},mobius3d:function(n,e,t){n*=Math.PI,e*=2*Math.PI,n=n*2;const i=n/2,s=2.25,r=.125,o=.65;let a=r*Math.cos(e)*Math.cos(i)-o*Math.sin(e)*Math.sin(i);const l=r*Math.cos(e)*Math.sin(i)+o*Math.sin(e)*Math.cos(i),c=(s+a)*Math.sin(n);a=(s+a)*Math.cos(n),t.set(a,c,l)}};cl.TubeGeometry=u(class extends Lf{constructor(e,t=64,i=1,s=8,r=!1){const o=t+1,a=e.computeFrenetFrames(t,r),l=a.tangents,c=a.normals,h=a.binormals,d=new b;function f(p,g,m){g*=2*Math.PI;const v=Math.floor(p*(o-1));e.getPointAt(p,d);const y=c[v],w=h[v],_=-i*Math.cos(g),A=i*Math.sin(g);d.x+=_*y.x+A*w.x,d.y+=_*y.y+A*w.y,d.z+=_*y.z+A*w.z,m.copy(d)}u(f,"ParametricTube"),super(f,t,s),this.tangents=l,this.normals=c,this.binormals=h,this.path=e,this.segments=t,this.radius=i,this.segmentsRadius=s,this.closed=r}},"TubeGeometry");cl.TorusKnotGeometry=u(class extends cl.TubeGeometry{constructor(e=200,t=40,i=64,s=8,r=2,o=3){class a extends Bg{getPoint(f,p=new b){const g=p;f*=Math.PI*2;const m=.5,v=(1+m*Math.cos(o*f))*Math.cos(r*f),y=(1+m*Math.cos(o*f))*Math.sin(r*f),w=m*Math.sin(o*f);return g.set(v,y,w).multiplyScalar(e)}}u(a,"TorusKnotCurve");const l=i,c=s,h=new a;super(h,l,t,c,!0,!1),this.radius=e,this.tube=t,this.segmentsT=i,this.segmentsR=s,this.p=r,this.q=o}},"TorusKnotGeometry");cl.SphereGeometry=u(class extends Lf{constructor(e,t,i){function s(r,o,a){r*=Math.PI,o*=2*Math.PI;const l=e*Math.sin(r)*Math.cos(o),c=e*Math.sin(r)*Math.sin(o),h=e*Math.cos(r);a.set(l,c,h)}u(s,"sphere"),super(s,t,i)}},"SphereGeometry");cl.PlaneGeometry=u(class extends Lf{constructor(e,t,i,s){function r(o,a,l){const c=o*e,h=0,d=a*t;l.set(c,h,d)}u(r,"plane"),super(r,i,s)}},"PlaneGeometry");var AB=Object.defineProperty,CB=u((n,e)=>AB(n,"name",{value:e,configurable:!0}),"__name$R");function $d(n=1,e=20){const t=[];let i=0,s=n;const r=Math.PI*2/e,o=Math.cos(r),a=Math.sin(r);for(let l=0;l<e;++l){const c=i*o-s*a,h=i*a+s*o;t.push(new b(i,s,0),new b(c,h,0)),i=c,s=h}return t}u($d,"xyCirclePoints");CB($d,"xyCirclePoints");var TB=Object.defineProperty,EB=u((n,e)=>TB(n,"name",{value:e,configurable:!0}),"__name$Q");class Ff extends Qe{constructor(e=1,t=20){super(),this.setFromPoints($d(e,t)),this.type="CircleEdgeGeometry"}}u(Ff,"CircleEdgeGeometry");EB(Ff,"CircleEdgeGeometry");var PB=Object.defineProperty,IB=u((n,e)=>PB(n,"name",{value:e,configurable:!0}),"__name$P");const RB=cl.SphereGeometry,DB=new RB(1,20,20),LB=new Ff,FB=new Qe().setFromPoints([new b,new b(1,0,0)]),OB=new b(1,0,0),Hp=new b;class l1{update(e,t){if(!t.has(nt))return;const i=t.get(nt);if(!i.dirty)return;i.dirty=!1,i.group||(i.group=new Ei,i.group.visible=!1,e.scene.add(i.group));const s=i.value;for(;s.length<i.pickers.length;){const o=i.pickers.pop();o==null||o.removeFromParent()}for(;s.length<i.circles.length;){const o=i.circles.pop();o==null||o.removeFromParent()}for(;i.lines.length&&s.length-1<i.lines.length;){const o=i.lines.pop();o==null||o.removeFromParent()}for(;s.length>i.pickers.length;){const o=new Ee(DB);o.visible=!1;const a=i.pickers.push(o);o.userData={index:a-1},i.group.add(o)}for(;s.length>i.circles.length;){const o=new gn(LB,nt.normalMaterial);i.circles.push(o),i.group.add(o)}for(;s.length-1>i.lines.length;){const o=new gn(FB,nt.normalMaterial);i.lines.push(o),i.group.add(o)}for(let o=0,a=s.length;o<a;++o){const l=s[o],c=i.circles[o];c.position.copy(l.position),c.scale.setScalar(l.radius);const h=i.pickers[o];if(h.position.copy(l.position),h.scale.setScalar(l.radius),o<a-1){const d=i.lines[o];d.position.copy(l.position),Hp.subVectors(s[o+1].position,l.position);const f=Hp.length();d.scale.setScalar(f),f>1e-8&&d.quaternion.setFromUnitVectors(OB,Hp.divideScalar(f))}}const r=t.get(Ce);r.value||(r.value=new yt,r.value.userData={node:t},r.parentChanged=!0,r.localTransformChanged=!0)}}u(l1,"TubeUpdateFilter");IB(l1,"TubeUpdateFilter");var NB=Object.defineProperty,kB=u((n,e)=>NB(n,"name",{value:e,configurable:!0}),"__name$O");const wh=[],ps=new b;class c1 extends ji{constructor(t){super();M(this,"filters");this.filters=t}begin(t){t=t.readonlyRef();const i=Ze(this);if(t.model.dirty){t.model.forEach(s=>{s.parent&&!s.parent.visible?s.visible=!1:s.visible=s.has(zt)?s.value(zt):!0,s.dirty&&wh.push(s)});for(let s of i.filters)for(let r of wh)s.update(t,r);for(let s of wh)s.dirty=!1;wh.length=0,t.model.dirty=!1}t.model.instanceDirty&&(t.model.instanceDirty=!1,t.model.forEach(s=>{if(s.instanceId&&s.instanceMeshDirty){s.instanceMeshDirty=!1;let r=s.instanceMeshRebuild;s.instanceMeshRebuild&&(s.instanceMeshRebuild=!1,i.recreateInstanceMesh(t,s)),s.has(Ys)&&t.throttle(`#${s.id}-update-instance-mirror-geometry`,250,()=>{s.deleted||i.updateInstanceMirrorGeometry(t,s)},s.visible&&r)}}),t.model.dirty=!0)}end(t){}recreateInstanceMesh(t,i){if(!i.has(Ce))return;const s=i.get(Ce);if(s.instance=!0,s.dispose(),!t.model.isNodeExists(i.instanceId))return;const o=t.model.getNode(i.instanceId).value(Ce);if(!!o){if(o.isGroup){const a=o,l=s.value=new Ei;l.userData.node=i;for(let c of a.children)if(c.isMesh){const h=c,d=new Ee(h.geometry,h.material);d.userData.node=i,l.add(d)}}else if(o.isMesh){const a=o,l=s.value=new Ee(a.geometry,a.material);l.userData.node=i}i.dirty=!0,s.parentChanged=!0,s.localTransformChanged=!0,s.worldTransformChanged=!0}}updateInstanceMirrorGeometry(t,i){if(!i.has(Ys))return;const s=i.value(Ys),r=i.value(Ce);if(!r)return;const o=t.model.getNode(i.instanceId),a=o.value(Ce);if(!a)return;const l=1e-6,c=E0(Math.round(s.x/l)*l,Math.round(s.y/l)*l,Math.round(s.z/l)*l);if(r.isGroup)for(let h=0,d=r.children.length;h<d;++h)this.mirrorMesh(o,c+"/"+h,r.children[h],a.children[h],s);else this.mirrorMesh(o,c,r,a,s)}mirrorMesh(t,i,s,r,o){if(!(!(s!=null&&s.geometry)||!(r!=null&&r.geometry))){if(t.mirrorGeometry[i]){s.geometry=t.mirrorGeometry[i];return}if(s.geometry===r.geometry){s.geometry=new Qe;const a=r.geometry.getIndex();a&&(s.geometry.index=new fn(new Uint32Array(a.array.length),a.itemSize),this.flipIndex(s.geometry.index,a));const l=r.geometry.getAttribute("position");l&&s.geometry.setAttribute("position",new Fe(new Float32Array(l.array),l.itemSize));const c=r.geometry.getAttribute("normal");c&&s.geometry.setAttribute("normal",new Fe(new Float32Array(c.array),c.itemSize));const h=r.geometry.getAttribute("color");h&&s.geometry.setAttribute("color",new Fe(new Float32Array(h.array),h.itemSize))}this.mirrorGeometry(s.geometry,r.geometry,o),s.geometry.boundingSphere=null,t.mirrorGeometry[i]=s.geometry}}flipIndex(t,i){const s=t.array,r=i.array;for(let o=0,a=r.length;o<a;o+=3)s[o]=r[o+2],s[o+1]=r[o+1],s[o+2]=r[o]}mirrorGeometry(t,i,s){const r=!t.getIndex();this.mirrorAttribute(t.getAttribute("position"),i.getAttribute("position"),s,r),this.mirrorAttribute(t.getAttribute("normal"),i.getAttribute("normal"),s,r),r&&this.flipTriangles(t.getAttribute("color"),i.getAttribute("color"))}mirrorAttribute(t,i,s,r){if(!t||!i||t.itemSize!==3)return;const o=t.array,a=i.array;if(r)for(let l=0,c=a.length;l<c;l+=9)for(let h=0;h<9;h+=3)ps.fromArray(a,l+6-h),ps.reflect(s),o[l+h]=ps.x,o[l+h+1]=ps.y,o[l+h+2]=ps.z;else for(let l=0,c=a.length;l<c;l+=3)ps.fromArray(a,l),ps.reflect(s),o[l]=ps.x,o[l+1]=ps.y,o[l+2]=ps.z;t.needsUpdate=!0}flipTriangles(t,i){if(!t||!i||t.itemSize!==3)return;const s=t.array,r=i.array;for(let o=0,a=r.length;o<a;o+=9)for(let l=0;l<9;l+=3)s[o+l]=r[o+6-l],s[o+l+1]=r[o+6-l+1],s[o+l+2]=r[o+6-l+2];t.needsUpdate=!0}}u(c1,"ModelUpdateSystem");kB(c1,"ModelUpdateSystem");var zB=Object.defineProperty,BB=u((n,e)=>zB(n,"name",{value:e,configurable:!0}),"__name$N");class u1 extends ji{begin(e){e=e.readonlyRef();for(let t of e.views)t.enabled&&(t.mouseScr.x=t.input.pointerX,t.mouseScr.y=t.height-t.input.pointerY,t.mouseNdc.x=t.mouseScr.x/t.width*2-1,t.mouseNdc.y=t.mouseScr.y/t.height*2-1,t.mouseRay0.copy(t.mouseNdc),t.mouseRay0.z=-1,t.mouseRay0.unproject(t.camera.get()),t.mouseRay1.copy(t.mouseNdc),t.mouseRay1.z=1,t.mouseRay1.unproject(t.camera.get()),t.mouseRayN.subVectors(t.mouseRay1,t.mouseRay0).normalize(),t.raycaster.setFromCamera(t.mouseNdc,t.camera.get()))}end(e){}}u(u1,"MouseSystem");BB(u1,"MouseSystem");var UB=Object.defineProperty,VB=u((n,e)=>UB(n,"name",{value:e,configurable:!0}),"__name$M");class h1 extends ji{begin(e){if(e=e.readonlyRef(),!e.options.outlineSelected){e.outlinePass.selectedObjects.length=0,e.outlinePass.enabled=!1;return}const t=e.model.getTopmostSelectedNodes(),i=[];for(let s of t)if(s.has(Ce)&&s.visible){const r=s.value(Ce);r&&i.push(r)}e.outlinePass.selectedObjects=i,e.outlinePass.enabled=!!i.length}end(e){}}u(h1,"OutlineUpdateSystem");VB(h1,"OutlineUpdateSystem");var HB=Object.defineProperty,GB=u((n,e)=>HB(n,"name",{value:e,configurable:!0}),"__name$L");class Da extends Zs{constructor(e=10,t=10,i=4473924,s=4473924,r=8947848,o=!0){const a=new Ie(i),l=new Ie(s),c=new Ie(r),h=t/2,d=e/t,f=e/2,p=[],g=[];for(let y=0,w=0,_=-f;y<=t;y++,_+=d){p.push(-f,0,_,f,0,_),p.push(_,0,-f,_,0,f);const A=y===h?a:c,x=y===h?l:c;A.toArray(g,w),w+=3,A.toArray(g,w),w+=3,x.toArray(g,w),w+=3,x.toArray(g,w),w+=3}const m=new Qe;m.setAttribute("position",new Fe(p,3)),m.setAttribute("color",new Fe(g,3));const v=new Wn({vertexColors:!0,toneMapped:!1,depthWrite:o});super(m,v),this.type="Grids"}dispose(){this.geometry.dispose(),this.material.dispose()}}u(Da,"Grids");GB(Da,"Grids");var $B=Object.defineProperty,MA=u((n,e)=>$B(n,"name",{value:e,configurable:!0}),"__name$K");const gr=200,WB=new b(1,0,0),jB=new b(0,1,0),XB=new b(0,0,1),YB=new b;function vd(n,e){return YB.crossVectors(n._dir,e).lengthSq()<1e-8}u(vd,"isCameraParallelTo");MA(vd,"isCameraParallelTo");class d1 extends ji{constructor(){super(...arguments);M(this,"groundGrids",new Da(gr,gr,16135762,3113955,5592405));M(this,"xzGrids",new Da(gr,gr,16135762,3113955,5592405,!1));M(this,"xyGrids",new Da(gr,gr,16135762,7316763,5592405,!1).rotateX(Math.PI/2));M(this,"yzGrids",new Da(gr,gr,7316763,3113955,5592405,!1).rotateZ(Math.PI/2))}setup(t){t.scene.add(this.groundGrids),t.scene.add(this.xzGrids),t.scene.add(this.xyGrids),t.scene.add(this.yzGrids)}begin(t){t=t.readonlyRef();const i=t.canvas.getBoundingClientRect(),s=t.renderer,r=t.composer,o=t.renderPass,a=t.outlinePass;s.setScissorTest(!0),s.setClearColor(0,0),s.clear();const l=t.options.shadingMode==="solid";for(let c of t.views){for(let h of t.views){const d=c===h;h.transformControls.visible=d&&t.tool.enableTransformControls,h.defaultLight.visible=l&&d}if(c.enabled&&c.width&&c.height){const h=c.camera;this.xzGrids.visible=t.options.showGrids&&vd(h,jB),this.xyGrids.visible=t.options.showGrids&&vd(h,XB),this.yzGrids.visible=t.options.showGrids&&vd(h,WB),this.groundGrids.visible=t.options.showGrids&&!(this.xzGrids.visible||this.xyGrids.visible||this.yzGrids.visible),t.tool.beforeRender(t,c);const d=-i.left+c.left,f=i.bottom-c.bottom,p=c.width,g=c.height;s.setViewport(d,f,p,g),s.setScissor(d,f,p,g),o.camera=h.get(),a.renderCamera=h.get(),r.setSize(p,g),r.render()}}}end(t){}}u(d1,"RenderSystem");MA(d1,"RenderSystem");var qB=Object.defineProperty,KB=u((n,e)=>qB(n,"name",{value:e,configurable:!0}),"__name$J");const Gp=new uu,pa=new b,ma=new b,Zi=new b,zs=new b,ms=new b,Bs=new b,Us=new b,Ul=new b,Vl=new b,Hl=new b,Mh=new b,Gl=new b,$l=new b,Wl=new b,Q_=new Me,ZB=new Ve,QB=new b;class f1{constructor(){M(this,"dom");M(this,"parent");M(this,"x0",0);M(this,"y0",0);M(this,"x1",0);M(this,"y1",0);const e=this.dom=document.createElement("div");e.style.pointerEvents="none",e.style.position="absolute",e.style.zIndex="20",e.style.border="dashed 1px #fff",e.style.background="rgba(255, 255, 255, .1)",e.style.boxSizing="border-box"}attach(e){this.parent=e,e.appendChild(this.dom)}show(){this.dom.style.display="block"}hide(){this.dom.style.display="none"}setPoint1(e,t){this.x0=e,this.y0=t}setPoint2(e,t){if(this.x1=e,this.y1=t,!this.parent)return;const i=(this.x0+1)/2,s=(this.x1+1)/2,r=(this.y0+1)/2,o=(this.y1+1)/2,a=this.parent.getBoundingClientRect(),l=Math.round(a.width*Math.min(i,s)),c=Math.round(a.width*(1-Math.max(i,s))),h=Math.round(a.height*Math.min(r,o)),d=Math.round(a.height*(1-Math.max(r,o)));this.dom.style.left=`${l}px`,this.dom.style.right=`${c}px`,this.dom.style.top=`${d}px`,this.dom.style.bottom=`${h}px`,i!==s||r!==o?this.show():this.hide()}select(e,t){let i=this.x0,s=this.y0,r=this.x1,o=this.y1;i===r&&(r+=Number.EPSILON),s===o&&(o+=Number.EPSILON);const a=0,l=1,c=Number.MAX_VALUE;if(e.updateProjectionMatrix(),e.updateMatrixWorld(),e.isPerspectiveCamera){ma.set(i,s,a),ma.x=Math.min(i,r),ma.y=Math.max(s,o),r=Math.max(i,r),o=Math.min(s,o),Zi.setFromMatrixPosition(e.matrixWorld),zs.copy(ma),ms.set(r,ma.y,0),Bs.set(r,o,l),Us.set(ma.x,o,0),zs.unproject(e),ms.unproject(e),Bs.unproject(e),Us.unproject(e),Gl.copy(zs).sub(Zi),$l.copy(ms).sub(Zi),Wl.copy(Bs).sub(Zi),Gl.normalize(),$l.normalize(),Wl.normalize(),Gl.multiplyScalar(c),$l.multiplyScalar(c),Wl.multiplyScalar(c),Gl.add(Zi),$l.add(Zi),Wl.add(Zi);const f=Gp.planes;f[0].setFromCoplanarPoints(Zi,zs,ms),f[1].setFromCoplanarPoints(Zi,ms,Bs),f[2].setFromCoplanarPoints(Bs,Us,Zi),f[3].setFromCoplanarPoints(Us,zs,Zi),f[4].setFromCoplanarPoints(ms,Bs,Us),f[5].setFromCoplanarPoints(Wl,$l,Gl),f[5].normal.multiplyScalar(-1)}else if(e.isOrthographicCamera){const f=Math.min(i,r),p=Math.max(s,o),g=Math.max(i,r),m=Math.min(s,o);zs.set(f,p,-1),ms.set(g,p,-1),Bs.set(g,m,-1),Us.set(f,m,-1),Ul.set(f,p,1),Vl.set(g,p,1),Hl.set(g,m,1),Mh.set(f,m,1),zs.unproject(e),ms.unproject(e),Bs.unproject(e),Us.unproject(e),Ul.unproject(e),Vl.unproject(e),Hl.unproject(e),Mh.unproject(e);const v=Gp.planes;v[0].setFromCoplanarPoints(zs,Ul,Vl),v[1].setFromCoplanarPoints(ms,Vl,Hl),v[2].setFromCoplanarPoints(Hl,Mh,Us),v[3].setFromCoplanarPoints(Mh,Ul,zs),v[4].setFromCoplanarPoints(ms,Bs,Us),v[5].setFromCoplanarPoints(Hl,Vl,Ul),v[5].normal.multiplyScalar(-1)}const h=[],d={};for(let f of t)this.searchChildInFrustum(h,d,Gp,f);return h}searchChildInFrustum(e,t,i,s){if(s.isMesh||s.isLine||s.isPoints)if(s.isInstancedMesh){const r=s;t[r.uuid]=[];for(let o=0;o<r.count;o++)r.getMatrixAt(o,Q_),Q_.decompose(pa,ZB,QB),pa.applyMatrix4(r.matrixWorld),i.containsPoint(pa)&&t[r.uuid].push(o)}else{const r=s;r.geometry.boundingSphere===null&&r.geometry.computeBoundingSphere(),pa.copy(r.geometry.boundingSphere.center),pa.applyMatrix4(s.matrixWorld),i.containsPoint(pa)&&e.push(s)}if(s.children.length>0)for(let r=0;r<s.children.length;r++)this.searchChildInFrustum(e,t,i,s.children[r])}}u(f1,"SelectionRect");KB(f1,"SelectionRect");var JB=Object.defineProperty,eU=u((n,e)=>JB(n,"name",{value:e,configurable:!0}),"__name$I");const J_=new b(0,0,1),jl=new b,$p=new Me,vr=new b,Wp=new Vr;class p1 extends ji{constructor(){super(...arguments);M(this,"prevTool");M(this,"selectionRect",new f1);M(this,"dragMovedFramesCount",0);M(this,"sculptIndicator",new Zs(new Qe().setFromPoints([...$d(1),...$d(.05)]),new Wn({fog:!1,toneMapped:!1,transparent:!0,color:15964205,opacity:1})));M(this,"sculptIndicatorSym",new Zs(this.sculptIndicator.geometry.clone(),this.sculptIndicator.material.clone()))}setup(t){this.sculptIndicator.visible=!1,t.scene.add(this.sculptIndicator),this.sculptIndicatorSym.visible=!1,this.sculptIndicatorSym.material.opacity=.33,t.scene.add(this.sculptIndicatorSym)}begin(t){var s;const i=Ze(t.tool);if(t.selectionRectSetThisFrame=!1,i.enableSelectionRect)for(let r of t.views){if(r=Ze(r),!r.enabled)continue;const o=r.input;if(o.pointerOver&&o.mouseLeft){const a=Math.max(-1,Math.min(1,r.mouseNdc.x)),l=Math.max(-1,Math.min(1,r.mouseNdc.y));t.selectionRectDragging?(this.selectionRect.setPoint2(a,l),t.selectionEnd.set(a,l),this.dragMovedFramesCount<2&&(this.selectionRect.hide(),(this.dragMovedFramesCount||!t.selectionStart.equals(t.selectionEnd))&&(this.dragMovedFramesCount+=1))):(t.selectionRectDragging=!0,t.selectionRectViewIndex=r.index,this.selectionRect.attach(r.element),this.selectionRect.setPoint1(a,l),this.selectionRect.setPoint2(a,l),t.selectionStart.set(a,l),t.selectionEnd.set(a,l),this.dragMovedFramesCount=0)}if(t.selectionRectDragging&&t.selectionRectViewIndex===r.index&&!o.mouseLeft&&(t.selectionRectDragging=!1,t.selectionRectSetThisFrame=!0,this.selectionRect.hide(),i.enableDefaultSelectionBehavior))if(t.selectionStart.equals(t.selectionEnd)){const a=r.mousePick();let l=0;for(let c of a){const h=c.object.userData.node;if(h!=null&&h.visible){l=h.id;break}}l?t.model.selected.includes(l)?r.input.isKeyPressed("Control")&&(t.model.selected=t.model.selected.filter(c=>c!==l)):(r.input.isKeyPressed("Control")||(t.model.selected=[]),t.model.addSelection(l)):r.input.isKeyPressed("Control")||(t.model.selected=[])}else{const a=this.selectionRect.select(r.camera.get(),t.readonlyRef().scene.children.filter(l=>l.visible&&!!l.userData.node));r.input.isKeyPressed("Control")||(t.model.selected=[]);for(let l of a){const c=l.userData.node;c&&t.model.addSelection(c.id)}}}else this.selectionRect.hide(),t.selectionRectDragging=!1;do{if(this.sculptIndicator.visible=!1,this.sculptIndicatorSym.visible=!1,t.sculptNodeId=0,t.sculptSym=t.options.symmetry!=="no",t.sculptMoved=!1,!i.sculpt)break;const r=t.readonlyRef().model.getSelectedNodes().filter(a=>a.type==="Clay"&&!a.instanceId)[0];if(!r)break;const o=r.get(Ce).mesh;if(!o)break;t.sculptNodeId=r.id;for(let a of t.views){if(a=Ze(a),!a.enabled)continue;const l=a.input;if(l.mouseLeft?(l.pointerOver||t.sculptActiveView===a.index)&&(t.sculptActiveView=a.index,l.mouseLeftDownThisFrame?(t.sculptMoved=!0,t.sculptStartThisFrame=!0,t.sculptX0=t.sculptX1=l.pointerX,t.sculptY0=t.sculptY1=l.pointerY):(t.sculptX1!==l.pointerX||t.sculptY1!==l.pointerY)&&(t.sculptMoved=!0,t.sculptStartThisFrame=!1,t.sculptX0=t.sculptX1,t.sculptY0=t.sculptY1,t.sculptX1=l.pointerX,t.sculptY1=l.pointerY)):t.sculptActiveView===a.index&&(t.sculptActiveView=-1),!l.pointerOver)continue;const c=r.getWorldMatrix();$p.copy(c).invert(),Wp.copy(a.raycaster.ray),Wp.applyMatrix4($p);const h=o.raycast(Wp,!0)[0];if(!h)break;l.mouseLeft||(this.sculptIndicator.visible=!0,this.sculptIndicatorSym.visible=t.sculptSym),this.sculptIndicator.position.copy(h.point).applyMatrix4(c),vr.copy(h.normal).transformDirection(c),this.sculptIndicator.quaternion.setFromUnitVectors(J_,vr);let d=i.brushRadius/a.height;switch(a.camera.perspective?d*=this.sculptIndicator.position.distanceTo(a.camera._position):d*=a.camera.orthographicCamera.top-a.camera.orthographicCamera.bottom,this.sculptIndicator.scale.setScalar(d),t.sculptLocalRadius=d*Ro($p),jl.copy(h.point),vr.copy(h.normal),t.options.symmetry){case"x":jl.x*=-1,vr.x*=-1;break;case"y":jl.y*=-1,vr.y*=-1;break;case"z":jl.z*=-1,vr.z*=-1;break}this.sculptIndicatorSym.visible&&(this.sculptIndicatorSym.position.copy(jl).applyMatrix4(c),vr.transformDirection(c),this.sculptIndicatorSym.quaternion.setFromUnitVectors(J_,vr),this.sculptIndicatorSym.scale.copy(this.sculptIndicator.scale));break}}while(!1);i.begin(t);for(let r of t.views)r=Ze(r),i.enableTransformControls?r.transformControls.attach(t.dummyObject):r.transformControls.detach(),r.enabled&&i.update(t,r);if(i.end(t),Ze(this.prevTool)!==i&&((s=this.prevTool)==null||s.onUnselected(t),this.prevTool=i,t.statusBarMessage=i.tips),i.optionsProps.length){const r=t.options.tools[i.constructor.name]=t.options.tools[i.constructor.name]||{};for(let o of i.optionsProps)r[o]=i[o]}}end(t){}}u(p1,"ToolSystem");eU(p1,"ToolSystem");var tU=Object.defineProperty,m1=u((n,e)=>tU(n,"name",{value:e,configurable:!0}),"__name$H");const yr=new b,Xl=new b,ga=new b,Yl=new b,Sh=new b,Ah=new b,Ch=new b,Th=new b,jp=new b,Xp=new b,Yp=new b,ql=new b;function lg(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(lg,"vertex$1");m1(lg,"vertex");function Ai(n,e,t,i){return e=lg(n,e,t),lg(n,e,i)}u(Ai,"line");m1(Ai,"line");class g1 extends Zs{constructor(){const t=new Qe,i=new Array(12*2*3).fill(0),s=new Array(12*2*3).fill(1);t.setAttribute("position",new Fe(i,3)),t.setAttribute("color",new Fe(s,3));const r=new Wn({vertexColors:!0,toneMapped:!1,color:16776960});super(t,r);M(this,"point1",new b);M(this,"point2",new b);M(this,"normal1",new b);M(this,"normal2",new b);M(this,"length",0);M(this,"width",0);M(this,"height",0);M(this,"dirty",!1);this.type="BoxEdge"}setPoint1(t){this.point1.equals(t)||(this.dirty=!0,this.point1.copy(t))}setPoint2(t){this.point2.equals(t)||(this.dirty=!0,this.point2.copy(t))}setNormal1(t){this.normal1.equals(t)||(this.dirty=!0,this.normal1.copy(t))}setNormal2(t){this.normal2.equals(t)||(this.dirty=!0,this.normal2.copy(t))}setHeight(t){t!==this.height&&(this.dirty=!0,this.height=t)}getLength(){return this.length}getWidth(){return this.width}updateGeometry(){if(!this.dirty)return;this.dirty=!1;const t=this.geometry.attributes.position,i=t.array;yr.copy(this.point1),ga.copy(this.point2),Xp.copy(this.normal1).normalize(),Yp.crossVectors(this.normal1,this.normal2).normalize(),jp.subVectors(ga,yr),Xl.copy(yr).addScaledVector(Xp,this.width=jp.dot(Xp)),Yl.copy(yr).addScaledVector(Yp,this.length=jp.dot(Yp)),ql.copy(this.normal2).normalize().multiplyScalar(this.height),Sh.addVectors(yr,ql),Ah.addVectors(Xl,ql),Ch.addVectors(ga,ql),Th.addVectors(Yl,ql);let s=0;s=Ai(i,s,yr,Xl),s=Ai(i,s,Xl,ga),s=Ai(i,s,ga,Yl),s=Ai(i,s,Yl,yr),s=Ai(i,s,yr,Sh),s=Ai(i,s,Xl,Ah),s=Ai(i,s,ga,Ch),s=Ai(i,s,Yl,Th),s=Ai(i,s,Sh,Ah),s=Ai(i,s,Ah,Ch),s=Ai(i,s,Ch,Th),Ai(i,s,Th,Sh),t.needsUpdate=!0}}u(g1,"BoxEdge");m1(g1,"BoxEdge");var nU=Object.defineProperty,v1=u((n,e)=>nU(n,"name",{value:e,configurable:!0}),"__name$G");const Nt=new b,xi=new b,bi=new b,wi=new b,Jr=new b,eo=new b,to=new b,no=new b,io=new b;function Hs(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(Hs,"vertex");v1(Hs,"vertex");function SA(n,e,t,i,s,r,o){let a=0;Hs(n,a,t),a=Hs(e,a,o),Hs(n,a,i),a=Hs(e,a,o),Hs(n,a,s),a=Hs(e,a,o),Hs(n,a,r),Hs(e,a,o)}u(SA,"face");v1(SA,"face");const Rt=class extends Ee{constructor(){const t=new Qe,i=new Float32Array(4*3),s=new Float32Array(4*3);t.setAttribute("position",new Fe(i,3)),t.setAttribute("normal",new Fe(s,3)),t.setIndex([0,1,3,0,3,2]);const r=new tr({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16776960,opacity:.75});super(t,r);M(this,"size",new b(1,1,1));M(this,"face",Rt.Right);M(this,"dirty",!0);this.type="BoxFace"}setSize(t){this.size.equals(t)||(this.dirty=!0,this.size.copy(t))}setFace(t){t!==this.face&&(this.dirty=!0,this.face=t)}getFace(){return this.face}setFaceFromNormal(t){t.x<-1e-6?this.setFace(Rt.Left):t.x>1e-6?this.setFace(Rt.Right):t.y<-1e-6?this.setFace(Rt.Bottom):t.y>1e-6?this.setFace(Rt.Top):t.z<-1e-6?this.setFace(Rt.Back):this.setFace(Rt.Front)}getFaceNormal(t){switch(this.face){case Rt.Left:t.set(-1,0,0);break;case Rt.Right:t.set(1,0,0);break;case Rt.Bottom:t.set(0,-1,0);break;case Rt.Top:t.set(0,1,0);break;case Rt.Back:t.set(0,0,-1);break;case Rt.Front:t.set(0,0,1);break}return t}getFaceTangent(t){switch(this.face){case Rt.Left:t.set(0,0,-1);break;case Rt.Right:t.set(0,0,1);break;case Rt.Bottom:t.set(-1,0,0);break;case Rt.Top:t.set(1,0,0);break;case Rt.Back:t.set(0,-1,0);break;case Rt.Front:t.set(0,1,0);break}return t}updateGeometry(){if(!this.dirty)return;this.dirty=!1,Nt.copy(this.size).multiplyScalar(-.5),xi.set(this.size.x,0,0),bi.set(0,this.size.y,0),wi.set(0,0,this.size.z);const t=this.geometry.attributes.position,i=this.geometry.attributes.normal,s=t.array,r=i.array;switch(t.needsUpdate=!0,i.needsUpdate=!0,this.face){case Rt.Left:Jr.copy(Nt),eo.copy(Nt).add(wi),to.copy(Nt).add(bi),no.copy(Nt).add(wi).add(bi),io.set(-1,0,0);break;case Rt.Right:Jr.copy(Nt).add(xi),eo.copy(Nt).add(bi).add(xi),to.copy(Nt).add(wi).add(xi),no.copy(Nt).add(wi).add(bi).add(xi),io.set(1,0,0);break;case Rt.Bottom:Jr.copy(Nt),eo.copy(Nt).add(xi),to.copy(Nt).add(wi),no.copy(Nt).add(wi).add(xi),io.set(0,-1,0);break;case Rt.Top:Jr.copy(Nt).add(bi),eo.copy(Nt).add(wi).add(bi),to.copy(Nt).add(xi).add(bi),no.copy(Nt).add(wi).add(xi).add(bi),io.set(0,1,0);break;case Rt.Back:Jr.copy(Nt),eo.copy(Nt).add(bi),to.copy(Nt).add(xi),no.copy(Nt).add(bi).add(xi),io.set(0,0,-1);break;case Rt.Front:Jr.copy(Nt).add(wi),eo.copy(Nt).add(xi).add(wi),to.copy(Nt).add(bi).add(wi),no.copy(Nt).add(bi).add(xi).add(wi),io.set(0,0,1);break}SA(s,r,Jr,eo,to,no,io)}};let dn=Rt;u(dn,"BoxFace"),M(dn,"Right",0),M(dn,"Left",1),M(dn,"Top",2),M(dn,"Bottom",3),M(dn,"Front",4),M(dn,"Back",5);v1(dn,"BoxFace");var iU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntlDkOADEIxCDa/3/Z26TKBbmUBtcZD4oQIsFr1HoAMCVUNZ1LcjLX5FOZFXkv9+1OY/15VeAJlcOMSB7RDlEQBX4AWut9pKAnP1Iwkos0zvXV8xw84QcGmUP1JGS0xQAAAABJRU5ErkJggg==",sU=Object.defineProperty,rU=u((n,e)=>sU(n,"name",{value:e,configurable:!0}),"__name$F");function AA(n,e,t,i,s){let r,o,a,l,c=t-n,h=i-e,d=Math.abs(c),f=Math.abs(h),p=2*f-d,g=2*d-f;if(f<=d){c>=0?(r=n,o=e,a=t):(r=t,o=i,a=n),s(r,o);for(let m=0;r<a;m++)r=r+1,p<0?p=p+2*f:(c<0&&h<0||c>0&&h>0?o=o+1:o=o-1,p=p+2*(f-d)),s(r,o)}else{h>=0?(r=n,o=e,l=i):(r=t,o=i,l=e),s(r,o);for(let m=0;o<l;m++)o=o+1,g<=0?g=g+2*d:(c<0&&h<0||c>0&&h>0?r=r+1:r=r-1,g=g+2*(d-f)),s(r,o)}}u(AA,"pixelLine");rU(AA,"pixelLine");var oU=Object.defineProperty,aU=u((n,e)=>oU(n,"name",{value:e,configurable:!0}),"__name$E");const so=new Vo,oi=new Vr,ex=new Me,Eh=new b;class cn{constructor(){M(this,"sep",!1);M(this,"tips","");M(this,"enableTransformControls",!1);M(this,"enableDefaultDeleteShortcut",!0);M(this,"enableSelectionRect",!1);M(this,"enableDefaultSelectionBehavior",!1);M(this,"sculpt",!1);M(this,"brushRadius",50);M(this,"brushStepSpacingRadiusRatio",.2);M(this,"brushStrength",.5);M(this,"hasDirection",!1);M(this,"hasThirdDirection",!1);M(this,"brushDirection",1);M(this,"brushHardness",.5);M(this,"hasHardness",!1);M(this,"hasColor",!1);M(this,"frontFacesOnly",!1);M(this,"optionsProps",[])}setup(e){}dispose(){}begin(e){}update(e,t){}end(e){}beforeRender(e,t){}onUnselected(e){}sculptPickStrokeVertices(e,t,i,s,r){e=e.readonlyRef(),ex.copy(t.getWorldMatrix()).invert();const o=new Set,a=[],l=Math.max(1,Math.floor(this.brushRadius*this.brushStepSpacingRadiusRatio));e.sculptStartThisFrame&&(e.sculptAccWalkedPixels=l),AA(e.sculptX0,e.sculptY0,e.sculptX1,e.sculptY1,(f,p)=>{if(e.sculptAccWalkedPixels+=1,e.sculptAccWalkedPixels<l)return;e.sculptAccWalkedPixels=0,oi.origin.set(f/i.width*2-1,(i.height-p)/i.height*2-1,-1),oi.direction.copy(oi.origin).setZ(1),oi.origin.unproject(i.camera.get()),oi.direction.unproject(i.camera.get()),oi.direction.sub(oi.origin).normalize(),oi.applyMatrix4(ex);const g=s.raycast(oi,!0)[0];if(!g)return;so.set(g.point,e.sculptLocalRadius);const m=s.intersectSphere(so),v=[],y=new Set;for(let A of m)if(!(r&&(s.getNormal(Eh,A),Eh.dot(oi.direction)>=0)))for(let x=0;x<3;++x){const C=s.sharedVertexMap[A*3+x];y.has(C)||(y.add(C),v.push(C),o.add(C))}if(!e.sculptSym){a.push({center:g.point,triangles:m,indices:v});return}switch(e.options.symmetry){case"x":so.center.x*=-1,oi.direction.x*=-1;break;case"y":so.center.y*=-1,oi.direction.y*=-1;break;case"z":so.center.z*=-1,oi.direction.z*=-1;break}const w=s.intersectSphere(so),_=[];y.clear();for(let A of w)if(!(r&&(s.getNormal(Eh,A),Eh.dot(oi.direction)>=0)))for(let x=0;x<3;++x){const C=s.sharedVertexMap[A*3+x];y.has(C)||(y.add(C),_.push(C),o.add(C))}a.push({center:g.point,triangles:m,indices:v,centerSym:new b().copy(so.center),trianglesSym:w,indicesSym:_})});const c=Array.from(o),h=new Map,d=new Float32Array(c.length*3);for(let f=0,p=c.length;f<p;++f){const g=c[f];for(let m=0;m<3;++m)d[f*3+m]=s.aPosition[g*3+m];h.set(g,f*3)}return{indices:c,offset:h,position:d,track:a}}sculptFalloff(e){return(3*e-4)*e**3+1}}u(cn,"EditorTool");aU(cn,"EditorTool");var lU=Object.defineProperty,cU=u((n,e)=>lU(n,"name",{value:e,configurable:!0}),"__name$D");const Ph=new b,Kl=new b,tx=new b,qp=new b,nn=new b,Zl=new b,Ql=new b,nx=new b,uU=new b,ro=new Me,Ih=new b,ix=new b,oo=new b,_r=new b,Jl=new b,Mi=.25;class Au extends cn{constructor(){super(...arguments);M(this,"name",Au.name);M(this,"label","Box");M(this,"icon",iU);M(this,"tips","Hold [Alt] to create a box");M(this,"boxEdge",new g1);M(this,"boxFace",new dn);M(this,"activeViewIndex",-1);M(this,"draggingFace",!1);M(this,"draggingFaceNodeId",0);M(this,"draggingFaceIndex",0);M(this,"draggingFaceNormal",new b);M(this,"faceNormalWorld0",new b);M(this,"position0",new b);M(this,"boxSize0",new b);M(this,"localMat0",new Me);M(this,"invWorldMat0",new Me);M(this,"mouse0",new b);M(this,"local0",new b);M(this,"creating",!1);M(this,"point2Set",!1);M(this,"point1",new b);M(this,"point2",new b);M(this,"normal1",new b);M(this,"normal2",new b);M(this,"boxHeight",0)}setup(t){this.boxEdge.visible=!1,t.scene.add(this.boxEdge),this.boxFace.visible=!1,t.scene.add(this.boxFace)}begin(t){this.draggingFace||(this.boxFace.visible=!1),this.creating||(this.boxEdge.visible=!1)}update(t,i){var r;const s=i.input;if(this.draggingFace){if(this.activeViewIndex!==i.index)return;if(s.pointerOver&&s.mouseLeft&&t.model.isNodeExists(this.draggingFaceNodeId,"Box")){if(nx.crossVectors(this.faceNormalWorld0,i.mouseRayN).lengthSq()<1e-6)return;jm(Ph,null,this.mouse0,this.faceNormalWorld0,i.mouseRay0,i.mouseRayN),Kl.copy(Ph).applyMatrix4(this.invWorldMat0);const o=tx.subVectors(Kl,this.local0).dot(this.draggingFaceNormal);qp.copy(this.position0),nn.copy(this.boxSize0);const a=t.model.getNode(this.draggingFaceNodeId);switch(this.draggingFaceIndex){case dn.Left:case dn.Right:{nn.x=Math.max(0,o+nn.x),s.isKeyPressed("Shift")&&(nn.x=Math.round(nn.x/Mi)*Mi);const l=this.draggingFaceIndex===dn.Left?1:-1;Zl.set(l*this.boxSize0.x/2,0,0),Ql.set(l*nn.x/2,0,0)}break;case dn.Bottom:case dn.Top:{nn.y=Math.max(0,o+nn.y),s.isKeyPressed("Shift")&&(nn.y=Math.round(nn.y/Mi)*Mi);const l=this.draggingFaceIndex===dn.Bottom?1:-1;Zl.set(0,l*this.boxSize0.y/2,0),Ql.set(0,l*nn.y/2,0)}break;case dn.Back:case dn.Front:{nn.z=Math.max(0,o+nn.z),s.isKeyPressed("Shift")&&(nn.z=Math.round(nn.z/Mi)*Mi);const l=this.draggingFaceIndex===dn.Back?1:-1;Zl.set(0,0,l*this.boxSize0.z/2),Ql.set(0,0,l*nn.z/2)}break}Zl.applyMatrix4(this.localMat0),Ql.applyMatrix4(this.localMat0),qp.add(Zl).sub(Ql),t.history.setValue(a,is,new b().copy(nn)),t.history.setValue(a,je,new b().copy(qp)),nn.multiplyScalar(Ro(a.getWorldMatrix())),t.statusBarMessage=`${nn.x.toFixed(2)} \xD7 ${nn.y.toFixed(2)} \xD7 ${nn.z.toFixed(2)}`}else this.draggingFace=!1,this.activeViewIndex=-1,this.draggingFaceNodeId=0,t.statusBarMessage=this.tips;return}if(this.creating){if(!this.point2Set){if(this.activeViewIndex!==i.index)return;if(s.mouseRightDownThisFrame&&(this.creating=!1,t.statusBarMessage=this.tips),pn(this.point2,i.mouseRay0,i.mouseRay1,this.point1,this.normal2)){if(this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry(),s.isKeyPressed("Shift")){oo.copy(this.normal1),_r.crossVectors(this.normal1,this.normal2).normalize();let l=this.boxEdge.getWidth(),c=this.boxEdge.getLength();l=Math.round(l/Mi)*Mi,c=Math.round(c/Mi)*Mi,this.point2.copy(this.point1).addScaledVector(oo,l).addScaledVector(_r,c),this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry()}const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a}`}s.mouseLeft||(this.point2Set=!0);return}if(!s.pointerOver||(s.mouseRightDownThisFrame&&(this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips),nx.crossVectors(this.normal2,i.mouseRayN).lengthSq()<1e-8))return;if(!jm(Ph,null,this.point2,this.normal2,i.mouseRay0,i.mouseRayN)){this.boxHeight=tx.subVectors(Ph,this.point2).dot(this.normal2),s.isKeyPressed("Shift")&&(this.boxHeight=Math.round(this.boxHeight/Mi)*Mi),this.boxEdge.setHeight(this.boxHeight),this.boxEdge.updateGeometry();const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2),l=Math.abs(this.boxHeight).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a} \xD7 ${l}`}if(s.mouseLeftDownThisFrame){this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips;let o=null;for(let v of t.model.getSelectedNodes())if(v.isValidChild("Box")){o=v;break}o?ro.copy(o.getWorldMatrix()).invert():ro.identity(),Kl.copy(this.point1).applyMatrix4(ro),Ih.copy(this.point2).applyMatrix4(ro),ix.copy(this.point2).addScaledVector(this.normal2,this.boxHeight).applyMatrix4(ro),oo.copy(this.normal1).transformDirection(ro),_r.copy(this.normal2).transformDirection(ro),Jl.crossVectors(oo,_r).normalize();let a=Kl.dot(oo),l=Ih.dot(oo);a>l&&([a,l]=[l,a]);let c=Kl.dot(Jl),h=Ih.dot(Jl);c>h&&([c,h]=[h,c]);let d=Ih.dot(_r),f=ix.dot(_r);d>f&&([d,f]=[f,d]);const p=new mt().setFromQuaternion(pu(new Ve,Jl,_r)),g=new b(l-a,f-d,h-c),m=new b().addScaledVector(oo,a+g.x/2).addScaledVector(_r,d+g.y/2).addScaledVector(Jl,c+g.z/2);t.history.createNode({type:"Box",parentId:o?o.id:0,data:{[is.name]:g,[je.name]:m,[bt.name]:p}})}return}if(s.pointerOver){for(let o of i.mousePick()){const a=o.object.userData.node;if((a==null?void 0:a.type)==="Box"){const l=(r=o.face)==null?void 0:r.normal;l&&(this.boxFace.visible=!0,this.boxFace.matrixAutoUpdate=!1,this.boxFace.matrix.copy(a.getWorldMatrix()),this.boxFace.setSize(a.value(is)),this.boxFace.setFaceFromNormal(l),this.boxFace.updateGeometry(),this.point1.copy(o.point),s.mouseLeftDownThisFrame&&!s.isKeyPressed("Alt")&&!a.instanceId&&(this.draggingFace=!0,this.activeViewIndex=i.index,this.draggingFaceNodeId=a.id,this.draggingFaceIndex=this.boxFace.getFace(),this.draggingFaceNormal.copy(l),this.faceNormalWorld0.copy(l).transformDirection(a.getWorldMatrix()),this.position0.copy(a.value(je)),this.boxSize0.copy(a.value(is)),this.localMat0.copy(a.getLocalMatrix()),this.invWorldMat0.copy(a.getWorldMatrix()).invert(),this.mouse0.copy(o.point),this.local0.copy(this.mouse0).applyMatrix4(this.invWorldMat0)));break}}s.isKeyPressed("Alt")&&s.mouseLeftDownThisFrame&&(this.boxFace.visible?(this.creating=!0,this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2),this.normal1.transformDirection(this.boxFace.matrix),this.normal2.transformDirection(this.boxFace.matrix)):pn(this.point1,i.mouseRay0,i.mouseRay1,this.point1.set(0,0,0),i.camera.perspective?uU.set(0,1,0):i.mouseRayN)&&(i.camera.perspective?(this.normal1.set(1,0,0),this.normal2.set(0,1,0)):(this.boxFace.setFaceFromNormal(i.mouseRayN),this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2)),this.creating=!0),this.creating&&(s.isKeyPressed("Shift")&&Pc(this.point1,Mi),this.activeViewIndex=i.index,this.boxHeight=0,this.boxEdge.setPoint1(this.point1),this.boxEdge.setPoint2(this.point1),this.boxEdge.setNormal1(this.normal1),this.boxEdge.setNormal2(this.normal2),this.boxEdge.setHeight(0),this.boxEdge.updateGeometry(),this.boxEdge.visible=!0))}}onUnselected(t){this.draggingFace=!1,this.creating=!1,this.point2Set=!1,this.boxEdge.visible=!1,this.boxFace.visible=!1}}u(Au,"BoxTool");cU(Au,"BoxTool");var hU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAItJREFUSIntkskRgCAMAIljIR4taP8FaAsencSPMtGBkGD4sR8zjO6C6lwlF7wpGqDXYoFika/UPBISmkZiMrMIJzKJpCS/IxLBr4j04dR9rUUcEREAICswdJOf93P1c0yoCjzy7VhQIxWBBLoWmjnYE5juWIr2FE1uiH58DvUroLse+xmce/9dFTUXvoWCImYNNpoAAAAASUVORK5CYII=",dU=Object.defineProperty,fU=u((n,e)=>dU(n,"name",{value:e,configurable:!0}),"__name$C");class Cu extends cn{constructor(){super(...arguments);M(this,"name",Cu.name);M(this,"label","Select");M(this,"icon",hU);M(this,"enableSelectionRect",!0);M(this,"enableDefaultSelectionBehavior",!0)}}u(Cu,"CursorTool");fU(Cu,"CursorTool");var pU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntk0sOwCAIRB3vf2e6aqJN+AnEJjpLJfNQhtaudgvcBRHRVAiwtW59zbmzNPMIpGuwaOcioERaxymzyJ6DyygN4IGMYXAHw7ITo7nUmBnCQUOxliDSC8x7AABaurQak5b/+ZeQUsALKQWcoQdg9q9krk0nEQAAAABJRU5ErkJggg==",mU=Object.defineProperty,gU=u((n,e)=>mU(n,"name",{value:e,configurable:!0}),"__name$B");const Kp=new b,Rh=new b,Dh=new b,ao=new b,Lh=new Me,va=new Me,Fh=new Me,ya=new b,Qi=new Ve,Zp=new Ve,vU=new Ve,sx=new Ve,Oh=new b,rx=new b,Nh=new b,ox=new b,ax=new b,Qp=new b,kh=new Ve,lx=new b;class y1 extends cn{constructor(){super(...arguments);M(this,"label","Bind IK Joint");M(this,"icon",pU);M(this,"activeView",-1);M(this,"ikChains",[]);M(this,"node");M(this,"rotate",!1);M(this,"mouse0",new b);M(this,"nodeInvMat",new Me);M(this,"chainInvMat",new Me);M(this,"chainPosition0",new b);M(this,"nodeStart0",new b);M(this,"nodeEnd0",new b);M(this,"nodeRotation0",new Ve);M(this,"nodeLocalMat0",new Map);M(this,"objWorldMat0",new Map)}begin(t){this.cleanup(t);const i=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?i.add(s):s.type==="IKNode"&&s.parent&&i.add(s.parent);this.ikChains=Array.from(i);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const l=s.children[r].get(vt);l.boneMesh&&(l.boneMesh.visible=!0),r===0&&l.moveHandler&&(l.moveHandler.visible=!0),l.rotateHandler&&(l.rotateHandler.visible=!0)}}update(t,i){const s=i.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null;for(let l of this.ikChains)for(let c of l.children){const h=c.get(vt);h.updateHandlersHoverState(c,i),h.moveHandlerHovered&&h.moveHandlerZ<r&&(r=h.moveHandlerZ,o=c,a=h),h.rotateHandlerHovered&&h.rotateHandlerZ<r&&(r=h.rotateHandlerZ,o=c,a=h)}if(o&&a){this.node=o,this.rotate=a.rotateHandlerHovered,this.activeView=i.index;const l=o.parent,c=l.getWorldMatrix();this.mouse0.copy(this.rotate?a.end:a.start).applyMatrix4(c),pn(this.mouse0,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),this.nodeInvMat.copy(c).invert(),this.chainInvMat.copy(l.getParentWorldMatrix()).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.nodeRotation0.copy(a.quaternion),this.chainPosition0.copy(l.value(je)),this.nodeLocalMat0.clear(),this.objWorldMat0.clear();for(let h of l.children){this.nodeLocalMat0.set(h.id,new Me().copy(h.getLocalMatrix()));for(let d of h.children)this.objWorldMat0.set(d.id,new Me().copy(d.getWorldMatrix()))}t.model.addSelection(this.node.id)}}}else if(this.activeView===i.index&&this.node&&!this.node.deleted){const r=this.node.parent;if(pn(Kp,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),this.rotate){Rh.copy(this.mouse0).applyMatrix4(this.nodeInvMat),Dh.copy(Kp).applyMatrix4(this.nodeInvMat),ao.subVectors(Dh,Rh),rx.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),Nh.copy(this.nodeEnd0).add(ao).sub(this.nodeStart0);let o=Nh.length();Nh.normalize(),Zp.setFromUnitVectors(rx,Nh),ox.set(0,0,1).applyQuaternion(this.nodeRotation0).applyQuaternion(Zp),ax.set(0,1,0).applyQuaternion(this.nodeRotation0).applyQuaternion(Zp),pu(Qi,ox,ax),kh.copy(Qi);const a=r.children.indexOf(this.node);if(a>0){const c=r.children[a-1];sx.copy(c.get(vt).quaternion).invert(),Qi.multiplyQuaternions(sx,Qi)}let l=t.history.setValue(this.node,jn,new mt().setFromQuaternion(Qi));if(t.options.allowModifyingBoneLengthWhenBindingIk&&(l=t.history.setValue(this.node,os,o)||l),l&&t.options.keepInternalTransformWhenBindingIk){let c=r.children.indexOf(this.node);if(c<0)return;Qp.copy(this.node.get(vt).start),lx.set(1,1,1);const h=r.getWorldMatrix();for(let d=r.children.length;c<d;++c){const f=r.children[c];va.compose(Qp,kh,lx),va.multiplyMatrices(h,va).invert();for(let g of f.children){const m=this.objWorldMat0.get(g.id);!m||(Fh.multiplyMatrices(va,m),Fh.decompose(ya,Qi,Oh),g.has(je)&&t.history.setValue(g,je,new b().copy(ya)),g.has(bt)&&t.history.setValue(g,bt,new mt().setFromQuaternion(Qi)))}const p=c+1;if(p<d){ao.set(o,0,0).applyQuaternion(kh),Qp.add(ao);const g=r.children[p];kh.multiply(vU.setFromEuler(g.value(jn))),o=g.value(os)}}}}else if(Rh.copy(this.mouse0).applyMatrix4(this.chainInvMat),Dh.copy(Kp).applyMatrix4(this.chainInvMat),ao.subVectors(Dh,Rh),t.history.setValue(r,je,new b().copy(this.chainPosition0).add(ao))&&t.options.keepInternalTransformWhenBindingIk){ya.copy(this.chainPosition0).add(ao),Qi.setFromEuler(r.value(bt)),Oh.setScalar(r.value(Bt)),Lh.compose(ya,Qi,Oh),Lh.multiplyMatrices(r.getParentWorldMatrix(),Lh);for(let a of r.children){const l=this.nodeLocalMat0.get(a.id);if(!!l){va.multiplyMatrices(Lh,l).invert();for(let c of a.children){const h=this.objWorldMat0.get(c.id);!h||(Fh.multiplyMatrices(va,h),Fh.decompose(ya,Qi,Oh),c.has(je)&&t.history.setValue(c,je,new b().copy(ya)),c.has(bt)&&t.history.setValue(c,bt,new mt().setFromQuaternion(Qi)))}}}}}}else this.activeView===i.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let i of this.ikChains)if(!i.deleted)for(let s of i.children){if(s.deleted)continue;s.get(vt).resetHandlers(t)}this.ikChains.length=0}}u(y1,"IkBindTool");gU(y1,"IkBindTool");var yU=Object.defineProperty,_U=u((n,e)=>yU(n,"name",{value:e,configurable:!0}),"__name$A");class _1{constructor(){M(this,"length",0);M(this,"localRotation",new Ve);M(this,"start",new b);M(this,"end",new b);M(this,"rotation",new Ve)}}u(_1,"CcdJoint");_U(_1,"CcdJoint");var xU=Object.defineProperty,bU=u((n,e)=>xU(n,"name",{value:e,configurable:!0}),"__name$z");const Jp=new b,cx=new b,ux=new b,em=new Ve,hx=new b,dx=new b,fx=new Ve;class x1{constructor(){M(this,"joints",[]);M(this,"iterLimit",20);M(this,"precision",1e-4)}resize(e){this.joints.length=e;for(let t=0;t<e;++t)this.joints[t]||(this.joints[t]=new _1)}resolve(e){const t=this.joints.length;if(!t)return;for(let s=0;s<t;++s){const r=this.joints[s];if(s>0){const o=this.joints[s-1];r.rotation.multiplyQuaternions(o.rotation,r.localRotation),r.start.copy(o.end)}else r.rotation.copy(r.localRotation),r.start.set(0,0,0);r.end.set(r.length,0,0).applyQuaternion(r.rotation).add(r.start)}const i=this.joints[t-1];Jp.copy(i.end);for(let s=0;s<this.iterLimit;++s){for(let r=t-1;r>=0;--r){const o=this.joints[r];if(cx.subVectors(i.end,o.start).normalize(),ux.subVectors(e,o.start).normalize(),em.setFromUnitVectors(cx,ux),hx.set(0,0,1).applyQuaternion(o.rotation).applyQuaternion(em),dx.set(0,1,0).applyQuaternion(o.rotation).applyQuaternion(em),pu(o.localRotation,hx,dx),r>0){const a=this.joints[r-1];fx.copy(a.rotation).invert(),o.localRotation.multiplyQuaternions(fx,o.localRotation)}for(let a=r;a<t;++a){const l=this.joints[a];if(a>0){const c=this.joints[a-1];l.rotation.multiplyQuaternions(c.rotation,l.localRotation),l.start.copy(c.end)}else l.rotation.copy(l.localRotation),l.start.set(0,0,0);l.end.set(l.length,0,0).applyQuaternion(l.rotation).add(l.start)}}if(i.end.distanceToSquared(Jp)<=this.precision||i.end.distanceToSquared(e)<=this.precision)break;Jp.copy(i.end)}}}u(x1,"CcdChain");bU(x1,"CcdChain");var wU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHlJREFUSIntU0EOwDAIqvv/n9m1MzjRNlmylCNSsFHHOPgaxkgAeIjMqK4Fbx5x28xXQ643w8xU0YQBGQCgPBulY6+bOeVH6RyYOau1Qjwf/aQVUlnfckjVqLTSHZO5VlrTbRetmEYzajWhDpzx8iXOj9kFZ/WDH+MGbSHHUbX+Pw0AAAAASUVORK5CYII=",MU=Object.defineProperty,SU=u((n,e)=>MU(n,"name",{value:e,configurable:!0}),"__name$y");const lo=new b,co=new b,zh=new b,Bh=new b,px=new b,ec=new b,Uh=new Ve,Vh=new Ve,mx=new b,gx=new b,uo=new b,tm=new b,vx=new Ve,tc=new x1;class b1 extends cn{constructor(){super(...arguments);M(this,"label","IK Move");M(this,"icon",wU);M(this,"activeView",-1);M(this,"ikChains",[]);M(this,"node");M(this,"swing",!1);M(this,"mouse0",new b);M(this,"origin",new b);M(this,"boneAxis",new b);M(this,"invMat",new Me);M(this,"nodeStart0",new b);M(this,"nodeEnd0",new b);M(this,"rotation0",new Ve);M(this,"chain0",[])}begin(t){this.cleanup(t);const i=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?i.add(s):s.type==="IKNode"&&s.parent&&i.add(s.parent);this.ikChains=Array.from(i);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const l=s.children[r].get(vt);l.rotateHandler&&(l.rotateHandler.visible=!0)}}update(t,i){const s=i.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null;for(let l of this.ikChains)for(let c of l.children){const h=c.get(vt);h.updateHandlersHoverState(c,i),h.rotateHandlerHovered&&h.rotateHandlerZ<r&&(r=h.rotateHandlerZ,o=c,a=h)}if(o&&a){this.node=o,this.swing=!0,this.activeView=i.index;const l=o.parent,c=l.getWorldMatrix();this.mouse0.copy(a.end).applyMatrix4(c),pn(this.mouse0,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),this.invMat.copy(c).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.rotation0.copy(a.quaternion),t.model.addSelection(this.node.id);const h=l.children.indexOf(o);this.chain0.length=h+1;for(let d=0;d<=h;++d){const f=l.children[d];this.chain0[d]={length:f.value(os),rotation:new Ve().setFromEuler(f.value(jn))}}}else{let l;for(let d of i.mousePick()){for(l=d.object.userData.node;l&&!l.has(vt);)l=l.parent||void 0;if(l){this.mouse0.copy(d.point);break}}if(!l){t.model.selected=[];return}this.node=l,this.swing=!1,this.activeView=i.index,t.model.selected=[l.id];const c=l.getParentWorldMatrix();this.invMat.copy(c).invert(),co.copy(this.mouse0).applyMatrix4(this.invMat);const h=l.get(vt);this.boneAxis.subVectors(h.end,h.start).normalize(),TM(this.origin,h.start,this.boneAxis,co),this.boneAxis.transformDirection(c),this.rotation0.copy(h.quaternion),this.origin.distanceTo(co)<1e-8?this.node=void 0:this.origin.applyMatrix4(c)}}}else if(this.activeView===i.index&&this.node&&!this.node.deleted)if(this.swing){if(pn(lo,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),co.copy(this.mouse0).applyMatrix4(this.invMat),zh.copy(lo).applyMatrix4(this.invMat),Bh.subVectors(zh,co),Bh.lengthSq()<1e-6)return;ec.copy(this.nodeEnd0).add(Bh),tc.resize(this.chain0.length);for(let o=0,a=this.chain0.length;o<a;++o){const l=tc.joints[o],c=this.chain0[o];l.length=c.length,l.localRotation.copy(c.rotation)}tc.resolve(ec);const r=this.node.parent;for(let o=0,a=this.chain0.length;o<a;++o){const l=tc.joints[o],c=r.children[o];t.history.setValue(c,jn,new mt().setFromQuaternion(l.localRotation))}this.mouse0.copy(lo),this.nodeEnd0.copy(ec);for(let o=0,a=this.chain0.length;o<a;++o)this.chain0[o].rotation.copy(tc.joints[o].localRotation)}else{if(Math.acos(Math.abs(this.boneAxis.dot(i.mouseRayN)))*180/Math.PI>45){if(!pn(lo,i.mouseRay0,i.mouseRay1,this.origin,i.mouseRayN))return;uo.crossVectors(this.boneAxis,i.mouseRayN).normalize();const a=this.mouse0.distanceTo(this.origin),l=.4,c=-Bh.subVectors(lo,this.mouse0).dot(uo)/a*Math.PI/2*l;uo.copy(this.boneAxis).transformDirection(this.invMat),Vh.setFromAxisAngle(uo,c)}else{if(!pn(lo,i.mouseRay0,i.mouseRay1,this.origin,this.boneAxis))return;co.copy(this.mouse0).applyMatrix4(this.invMat),zh.copy(lo).applyMatrix4(this.invMat),tm.copy(this.origin).applyMatrix4(this.invMat),px.subVectors(co,tm).normalize(),ec.subVectors(zh,tm).normalize(),uo.copy(this.boneAxis).transformDirection(this.invMat);const a=EM(uo,px,ec);Vh.setFromAxisAngle(uo,a)}mx.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(Vh),gx.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(Vh),pu(Uh,mx,gx);const r=this.node.parent,o=r.children.indexOf(this.node);if(o>0){const a=r.children[o-1];vx.copy(a.get(vt).quaternion).invert(),Uh.multiplyQuaternions(vx,Uh)}t.history.setValue(this.node,jn,new mt().setFromQuaternion(Uh))}}else this.activeView===i.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let i of this.ikChains)if(!i.deleted)for(let s of i.children){if(s.deleted)continue;s.get(vt).resetHandlers(t)}this.ikChains.length=0}}u(b1,"IkMoveTool");SU(b1,"IkMoveTool");var AU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhJREFUSIntk0sOgDAIRDve/864ra0DJUM1Mc4SKI9Pae3X2wJzmJldAgEam9aYnNnKkiuQI4KplbuALYoqZn7r1NunDgBAGcvyb/Mq9eyp4rKQO7+7ZHVcIaAKsqQRUn2Q00MGlLtliSqu3oWwQ5Mg25f/yO/6vk5YzaN81PvS3QAAAABJRU5ErkJggg==",CU=Object.defineProperty,TU=u((n,e)=>CU(n,"name",{value:e,configurable:!0}),"__name$x");const _a=new b,ho=new b,Hh=new b,nm=new b,Gh=new b,$h=new b,Wh=new Ve,nc=new Ve,yx=new b,_x=new b,fo=new b,im=new b,xx=new Ve;class w1 extends cn{constructor(){super(...arguments);M(this,"label","Rotate Joint");M(this,"icon",AU);M(this,"activeView",-1);M(this,"ikChains",[]);M(this,"node");M(this,"swing",!1);M(this,"mouse0",new b);M(this,"origin",new b);M(this,"boneAxis",new b);M(this,"invMat",new Me);M(this,"nodeStart0",new b);M(this,"nodeEnd0",new b);M(this,"rotation0",new Ve)}begin(t){this.cleanup(t);const i=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?i.add(s):s.type==="IKNode"&&s.parent&&i.add(s.parent);this.ikChains=Array.from(i);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const l=s.children[r].get(vt);l.boneMesh&&(l.boneMesh.visible=!0),l.rotateHandler&&(l.rotateHandler.visible=!0)}}update(t,i){const s=i.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null;for(let l of this.ikChains)for(let c of l.children){const h=c.get(vt);h.updateHandlersHoverState(c,i),h.rotateHandlerHovered&&h.rotateHandlerZ<r&&(r=h.rotateHandlerZ,o=c,a=h)}if(o&&a){this.node=o,this.swing=!0,this.activeView=i.index;const c=o.parent.getWorldMatrix();this.mouse0.copy(a.end).applyMatrix4(c),pn(this.mouse0,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),this.invMat.copy(c).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.rotation0.copy(a.quaternion),t.model.addSelection(this.node.id)}else{let l;for(let d of i.mousePick()){for(l=d.object.userData.node;l&&!l.has(vt);)l=l.parent||void 0;if(l){this.mouse0.copy(d.point);break}}if(!l){t.model.selected=[];return}this.node=l,this.swing=!1,this.activeView=i.index,t.model.selected=[l.id];const c=l.getParentWorldMatrix();this.invMat.copy(c).invert(),ho.copy(this.mouse0).applyMatrix4(this.invMat);const h=l.get(vt);this.boneAxis.subVectors(h.end,h.start).normalize(),TM(this.origin,h.start,this.boneAxis,ho),this.boneAxis.transformDirection(c),this.rotation0.copy(h.quaternion),this.origin.distanceTo(ho)<1e-8?this.node=void 0:this.origin.applyMatrix4(c)}}}else if(this.activeView===i.index&&this.node&&!this.node.deleted){if(this.swing)pn(_a,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN),ho.copy(this.mouse0).applyMatrix4(this.invMat),Hh.copy(_a).applyMatrix4(this.invMat),nm.subVectors(Hh,ho),Gh.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),$h.subVectors(this.nodeEnd0,this.nodeStart0).add(nm).normalize(),nc.setFromUnitVectors(Gh,$h);else if(Math.acos(Math.abs(this.boneAxis.dot(i.mouseRayN)))*180/Math.PI>45){if(!pn(_a,i.mouseRay0,i.mouseRay1,this.origin,i.mouseRayN))return;fo.crossVectors(this.boneAxis,i.mouseRayN).normalize();const a=this.mouse0.distanceTo(this.origin),l=.4,c=-nm.subVectors(_a,this.mouse0).dot(fo)/a*Math.PI/2*l;fo.copy(this.boneAxis).transformDirection(this.invMat),nc.setFromAxisAngle(fo,c)}else{if(!pn(_a,i.mouseRay0,i.mouseRay1,this.origin,this.boneAxis))return;ho.copy(this.mouse0).applyMatrix4(this.invMat),Hh.copy(_a).applyMatrix4(this.invMat),im.copy(this.origin).applyMatrix4(this.invMat),Gh.subVectors(ho,im).normalize(),$h.subVectors(Hh,im).normalize(),fo.copy(this.boneAxis).transformDirection(this.invMat);const a=EM(fo,Gh,$h);nc.setFromAxisAngle(fo,a)}yx.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(nc),_x.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(nc),pu(Wh,yx,_x);const r=this.node.parent,o=r.children.indexOf(this.node);if(o>0){const a=r.children[o-1];xx.copy(a.get(vt).quaternion).invert(),Wh.multiplyQuaternions(xx,Wh)}t.history.setValue(this.node,jn,new mt().setFromQuaternion(Wh))}}else this.activeView===i.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let i of this.ikChains)if(!i.deleted)for(let s of i.children){if(s.deleted)continue;s.get(vt).resetHandlers(t)}this.ikChains.length=0}}u(w1,"IkRotateTool");TU(w1,"IkRotateTool");var EU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIdJREFUSIntlUsOwCAIRKHp/a883TWUgsqnSRfOzhjn8VEk2pqI5QIAWkyZ2dzoAGiPo2o401k5LKP1ylLKwK11BwAAAcAMUsngNh9BUoCVyNOAiHkYAGCpsVKvazp6bFFzE0BqfEh21NwDkA60MkE+HxX/AmRKZfbAM0pcIhPghtn1IW09dAGjkjYnuN3k5AAAAABJRU5ErkJggg==",PU=Object.defineProperty,IU=u((n,e)=>PU(n,"name",{value:e,configurable:!0}),"__name$w");const ic=new Me,jh=new b,sc=new b,RU=new b(1,0,0),bx=new Me,wx=new b,Mx=new Ve,sm=new b,po=new Fn;class M1 extends cn{constructor(){super(...arguments);M(this,"label","Rescale");M(this,"icon",EU);M(this,"lineMaterial",new Wn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}));M(this,"lineGeometry",new Qe().setFromPoints([new b(0,0,0),new b(1,0,0)]));M(this,"line",new gn(this.lineGeometry,this.lineMaterial));M(this,"nodes",[]);M(this,"dragging",!1);M(this,"draggingViewIndex",-1);M(this,"mat0",new Me);M(this,"pos0",new b);M(this,"detMat",[]);M(this,"len0",0)}setup(t){this.line.visible=!1,t.scene.add(this.line)}begin(t){this.nodes=t.model.getTopmostSelectedNodes().filter(i=>i.has(Bt)),this.nodes.length&&(this.line.visible=this.dragging)}update(t,i){if(!this.nodes.length)return;const s=i.input;if(this.dragging&&this.draggingViewIndex===i.index)if(s.mouseLeft){pn(jh,i.mouseRay0,i.mouseRay1,this.pos0,i.mouseRayN),this.line.position.copy(this.pos0),sc.subVectors(jh,this.pos0);const r=sc.length();sc.divideScalar(r),this.line.scale.setScalar(r),this.line.quaternion.setFromUnitVectors(RU,sc),bx.copy(this.mat0).scale(sm.setScalar(r/this.len0));for(let o=0;o<this.nodes.length;++o){const a=this.nodes[o];ic.copy(a.getParentWorldMatrix()).invert().multiply(bx),o>0&&ic.multiply(this.detMat[o-1]),ic.decompose(wx,Mx,sm),t.history.setValue(a,Bt,sm.x),o>0&&(t.history.setValue(a,je,new b().copy(wx)),t.history.setValue(a,bt,new mt().setFromQuaternion(Mx)))}if(this.nodes[0].has(Ce)){const o=this.nodes[0].value(Ce);if(o){po.setFromObject(o);const a=(po.max.x-po.min.x).toFixed(2),l=(po.max.y-po.min.y).toFixed(2),c=(po.max.z-po.min.z).toFixed(2);t.statusBarMessage=`${a} \xD7 ${l} \xD7 ${c}`}}}else this.dragging=!1,this.draggingViewIndex=-1;else if(s.pointerOver&&s.mouseLeftDownThisFrame){if(this.mat0.copy(this.nodes[0].getWorldMatrix()),fu(this.pos0,this.mat0),this.detMat.length=this.nodes.length-1,this.detMat.length){ic.copy(this.nodes[0].getWorldMatrix()).invert();for(let r=0;r<this.detMat.length;++r)this.detMat[r]||(this.detMat[r]=new Me),this.detMat[r].multiplyMatrices(ic,this.nodes[r+1].getWorldMatrix())}pn(jh,i.mouseRay0,i.mouseRay1,this.pos0,i.mouseRayN),this.dragging=!0,this.draggingViewIndex=i.index,this.len0=sc.subVectors(jh,this.pos0).length();return}}onUnselected(t){this.nodes.length=0,this.dragging=!1,this.line.visible=!1}}u(M1,"RescaleTool");IU(M1,"RescaleTool");var DU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAKhJREFUSIntVMcRgDAMkzkGoawA+w8AK1A2CR9yl2KCwgVe6BnLilJk4EcpGAddM6gcbV0YYQAQEemaAes+e0LLNhlPUMTTrBnhsLbuc+z0NEDBiudwr3oqVqgYctwzvVknsL/oqYGke7fG8uiits5yv33k16+Iac4Vv0yyBi3Vj3CXzlRPiO+TbAcWG6o7XnSnIblvRwHiCZqatskNNNhTubO/2IP/OACgKKX6b2Wl3wAAAABJRU5ErkJggg==",LU=Object.defineProperty,FU=u((n,e)=>LU(n,"name",{value:e,configurable:!0}),"__name$v");const mo=new Me;class S1 extends cn{constructor(){super(...arguments);M(this,"label","Rotate");M(this,"icon",DU);M(this,"nodes",[]);M(this,"detMat",[]);M(this,"dragging",!1)}begin(t){if(this.nodes=t.model.getTopmostSelectedNodes().filter(i=>i.has(bt)||i.has(jn)),!this.nodes.length){this.enableTransformControls=!1;return}if(this.enableTransformControls=!0,!this.dragging&&(this.nodes[0].getWorldMatrix().decompose(t.dummyObject.position,t.dummyObject.quaternion,t.dummyObject.scale),this.detMat.length=this.nodes.length-1,this.detMat.length)){mo.copy(this.nodes[0].getWorldMatrix()).invert();for(let i=0;i<this.detMat.length;++i)this.detMat[i]||(this.detMat[i]=new Me),this.detMat[i].multiplyMatrices(mo,this.nodes[i+1].getWorldMatrix())}this.dragging=!1}update(t,i){if(!this.enableTransformControls)return;const s=i.transformControls;if(s.setMode("rotate"),s.setSpace(t.options.useLocalSpaceForTransformControl?"local":"world"),s.setRotationSnap(i.input.isKeyPressed("Shift")?.25*Math.PI:null),s.dragging){this.dragging=!0;const r=t.dummyObject.matrix;for(let o=0;o<this.nodes.length;++o){const a=this.nodes[o];if(mo.copy(a.getParentWorldMatrix()).invert().multiply(r),o>0&&mo.multiply(this.detMat[o-1]),a.has(bt)){const l=new mt().setFromQuaternion(Od(new Ve,mo));t.history.setValue(a,bt,l)}else if(a.has(jn)){const l=Od(new Ve,mo),c=a.parent,h=c.children.indexOf(a);if(h>0){const d=c.children[h-1],f=new Ve().copy(d.get(vt).quaternion).invert();l.multiplyQuaternions(f,l)}t.history.setValue(a,jn,new mt().setFromQuaternion(l))}o>0&&a.has(je)&&t.history.setValue(a,je,fu(new b,mo))}}}onUnselected(t){this.nodes.length=0,this.dragging=!1}}u(S1,"RotateTool");FU(S1,"RotateTool");var OU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntVEEOwCAIs2b///J2GQkh6VZQD1vsxaClIAFa2/gdzhtmH6qTtwGA8QAg8uVsnu7NTolLxM+K+zJlEpLInvPG79GRdcgUjGTPfKU5iCJ2Kr9NBZhSvlRHCD6dPSxFZdCWBCmLewF12TFIXaGu640SLqrDp4K4/n+JAAAAAElFTkSuQmCC",NU=Object.defineProperty,kU=u((n,e)=>NU(n,"name",{value:e,configurable:!0}),"__name$u");const Sx=new b;class A1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Brush");M(this,"icon",OU);M(this,"sculpt",!0);M(this,"hasDirection",!0);M(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.01,h=new b,d=new b,f=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);for(let p of f.track)this.stroke(p.indices,c,a.getAverageNormal(d,p.triangles),a.getAverageCenter(h,p.triangles),t.sculptLocalRadius,f.offset,f.position),t.sculptSym&&this.stroke(p.indicesSym,c,a.getAverageNormal(d,p.trianglesSym),a.getAverageCenter(h,p.trianglesSym),t.sculptLocalRadius,f.offset,f.position);t.history.updateVertices(r,Tn,f.indices,f.position)}stroke(t,i,s,r,o,a,l){r.addScaledVector(s,-o*Math.sign(i)*.5);for(let c of t)this.strokeVertex(s,r,o,i,l,a.get(c))}strokeVertex(t,i,s,r,o,a){Sx.fromArray(o,a);const l=Sx.distanceTo(i)/s;if(l>=1)return;const c=this.sculptFalloff(l)*r;o[a]+=t.x*c,o[a+1]+=t.y*c,o[a+2]+=t.z*c}}u(A1,"SculptBrushTool");kU(A1,"SculptBrushTool");var zU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntlMEKgDAMQ1Px/39ZLwoSZk2j87K9S2G0SQehwORvtoNu4tda3irbzhK/E+R3W7zSN4i4OsA9sklXcaWZk9NKErNWzc8aEaHMyQaq4CPOHclmlnfrmFR+YV9OJ7KWiXLsMqRksNhniZoAwA6iu8NUWhw/8AAAAABJRU5ErkJggg==",BU=Object.defineProperty,UU=u((n,e)=>BU(n,"name",{value:e,configurable:!0}),"__name$t");const Xh=new b,Yh=new b;class C1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Crease");M(this,"icon",zU);M(this,"sculpt",!0);M(this,"hasDirection",!0);M(this,"brushStrength",.25);M(this,"brushStepSpacingRadiusRatio",.1);M(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),d=new b;for(let f of h.track)this.stroke(f.indices,c,a.getAverageNormal(d,f.triangles),f.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(f.indicesSym,c,a.getAverageNormal(d,f.trianglesSym),f.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Tn,h.indices,h.position)}stroke(t,i,s,r,o,a,l){for(let c of t)this.strokeVertex(s,r,o,i,l,a.get(c))}strokeVertex(t,i,s,r,o,a){Xh.fromArray(o,a);const l=Xh.distanceTo(i)/s;if(l>=1)return;const c=this.sculptFalloff(l),h=c**5*r*-.01;o[a]+=t.x*h,o[a+1]+=t.y*h,o[a+2]+=t.z*h,Xh.fromArray(o,a),Yh.subVectors(i,Xh);const d=c*r*.1;o[a]+=Yh.x*d,o[a+1]+=Yh.y*d,o[a+2]+=Yh.z*d}}u(C1,"SculptCreaseTool");UU(C1,"SculptCreaseTool");var VU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntlMEOwCAIQ2H//8/stMQZcC1gdrE3I7w2RBE5+ltaaTYze8FUczwbNJ5no9kQBkfJSyarQg+M9sJwNAB3Kd/pywZsCBr+1KVM2GdGj4h+xxL/iTaDyGiLiaerA5JaEdvgTGN5nKtlh8Kh/d2294883Y/A1zVqqAZoAAAAAElFTkSuQmCC",HU=Object.defineProperty,GU=u((n,e)=>HU(n,"name",{value:e,configurable:!0}),"__name$s");const Ax=new b,rm=new b,rc=new b,qh=new b;class T1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Drag");M(this,"icon",VU);M(this,"sculpt",!0);M(this,"brushRadius",100);M(this,"brushStrength",1);M(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);M(this,"nodeId",0);M(this,"stroke0");M(this,"mouse0",new b);M(this,"local0",new b);M(this,"invMat",new Me)}begin(t){t.sculptActiveView===-1&&(this.nodeId=0,this.stroke0=void 0)}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);if(l.track.length&&(this.nodeId=r.id,this.stroke0=l,this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert()),this.nodeId!==r.id||!this.stroke0||!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}if(!pn(Ax,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN))return;rm.copy(Ax).applyMatrix4(this.invMat).sub(this.local0);const c=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(rc.copy(rm),t.options.symmetry){case"x":rc.x*=-1;break;case"y":rc.y*=-1;break;case"z":rc.z*=-1;break}const h=t.options.enablePressure?1:s.pressure;this.stroke(this.stroke0.indices,this.brushStrength*h,t.sculptSym,rm,rc,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,c),t.history.updateVertices(r,Tn,this.stroke0.indices,c)}stroke(t,i,s,r,o,a,l,c,h,d){for(let f of t)this.strokeVertex(s,r,o,a,l,c,i,d,h.get(f))}strokeVertex(t,i,s,r,o,a,l,c,h){if(qh.fromArray(c,h),t){const d=qh.distanceTo(r)/a,f=qh.distanceTo(o)/a;if(d>=1){if(f>=1)return;const p=this.sculptFalloff(f)*l;c[h]+=s.x*p,c[h+1]+=s.y*p,c[h+2]+=s.z*p}else if(f>=1){const p=this.sculptFalloff(d)*l;c[h]+=i.x*p,c[h+1]+=i.y*p,c[h+2]+=i.z*p}else{const p=1-d+(1-f),g=this.sculptFalloff(d)*l*(1-d)/p,m=this.sculptFalloff(f)*l*(1-f)/p;c[h]+=i.x*g+s.x*m,c[h+1]+=i.y*g+s.y*m,c[h+2]+=i.z*g+s.z*m}}else{const d=qh.distanceTo(r)/a;if(d>=1)return;const f=this.sculptFalloff(d)*l;c[h]+=i.x*f,c[h+1]+=i.y*f,c[h+2]+=i.z*f}}}u(T1,"SculptDragTool");GU(T1,"SculptDragTool");var $U="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIVJREFUSIntVUEOgCAMo8T/f1kvmujMRjvYSXtCmKVjHbT2owL7iXJiZpPOEl9jAMjJc4itytG3xRaRL1VryZX1KP5Vg1LlIzVRnGfdboMy6mnrqs3j9cV9znURAznbFe1vs3jUAAAym0g2nQUlUskifazMj9M185pHeQ8om1my0qvkezgA21OnjKJcGJgAAAAASUVORK5CYII=",WU=Object.defineProperty,jU=u((n,e)=>WU(n,"name",{value:e,configurable:!0}),"__name$r");const om=new b,XU=new b;class E1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Flatten");M(this,"icon",$U);M(this,"sculpt",!0);M(this,"brushStrength",.2);M(this,"hasDirection",!0);M(this,"hasThirdDirection",!0);M(this,"brushDirection",0);M(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=new b,c=new b,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),d=t.options.enablePressure?1:s.pressure;for(let f of h.track)this.stroke(f.indices,this.brushStrength*d,a.getAverageNormal(c,f.triangles),a.getAverageCenter(l,f.triangles),f.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(f.indicesSym,this.brushStrength*d,a.getAverageNormal(c,f.trianglesSym),a.getAverageCenter(l,f.trianglesSym),f.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Tn,h.indices,h.position)}stroke(t,i,s,r,o,a,l,c){for(let h of t)this.strokeVertex(s,r,o,a,i,c,l.get(h))}strokeVertex(t,i,s,r,o,a,l){om.fromArray(a,l);const c=om.distanceTo(s)/r;if(c>=1)return;const h=XU.subVectors(i,om).dot(t);if(this.brushDirection===-Math.sign(h))return;const d=this.sculptFalloff(c)*o*h;a[l]+=t.x*d,a[l+1]+=t.y*d,a[l+2]+=t.z*d}}u(E1,"SculptFlattenTool");jU(E1,"SculptFlattenTool");var YU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHNJREFUSIntVEEOgDAIW43//zJeXKJkakujB7MegbaMMFqb+D3AFEVEnEgARrljnELsuIrn3KiW7prNUyZSJyrfFc8aiytWdn5FQzVgtmhVBDMAQPoHzohobsXkjvPtFnUoryiPlSHaa/107BgN+1xP2NgAXJmHlymbSbgAAAAASUVORK5CYII=",qU=Object.defineProperty,KU=u((n,e)=>qU(n,"name",{value:e,configurable:!0}),"__name$q");const am=new b,lm=new Set,xa=new b,Cx=new b,Tx=new b;class P1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Inflate");M(this,"icon",YU);M(this,"sculpt",!0);M(this,"brushStrength",.2);M(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*l*.01,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);for(let d of h.track)this.stroke(a,d.indices,c,d.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(a,d.indicesSym,c,d.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Tn,h.indices,h.position)}stroke(t,i,s,r,o,a,l){for(let c of i)this.strokeVertex(t,c,r,o,s,l,a.get(c))}strokeVertex(t,i,s,r,o,a,l){am.fromArray(a,l);const c=am.distanceTo(s)/r;if(c>=1)return;xa.set(0,0,0);let h=t.getVertexTriangleIndex(t.edgeNeighborMap[i]);const d=h;let f=50;lm.clear();do{lm.add(h),t.getNormal(Cx,h),t.getTriangleCenter(Tx,h),xa.addScaledVector(Cx,am.distanceTo(Tx));const g=h;for(let m=0;m<3;++m){const v=h*3+m;if(t.holes[v])continue;const y=t.getVertexTriangleIndex(t.edgeNeighborMap[v]);if(h===y||lm.has(y))continue;let w=!1;for(let _=0;_<3;++_)if(t.sharedVertexMap[y*3+_]===i){w=!0;break}if(w){h=y;break}}if(g===h)break;if(f--<=0){console.warn("Loop limit reached");break}}while(d!==h);xa.normalize();const p=this.sculptFalloff(c)*o;a[l]+=xa.x*p,a[l+1]+=xa.y*p,a[l+2]+=xa.z*p}}u(P1,"SculptInflateTool");KU(P1,"SculptInflateTool");var ZU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHpJREFUSIntVUkKwDAI1NL/f3l6aS6hLhMNFNq5heAsUYzIDxEBAOtOO8lVtcwXisw4WYJWl7jhCUZn0w0APLn1nmOGmTYiYRLQ5GzNwZKVsOreGoYWAapuVcBDWw+2pnjPFA0wKZb7liksD4W37LLkqdU7k237WL6JC85mj5JuLIckAAAAAElFTkSuQmCC",QU=Object.defineProperty,JU=u((n,e)=>QU(n,"name",{value:e,configurable:!0}),"__name$p");const Ex=new b,cm=new b,oc=new b,Kh=new b;class I1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Move");M(this,"icon",ZU);M(this,"sculpt",!0);M(this,"brushStrength",1);M(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);M(this,"nodeId",0);M(this,"stroke0");M(this,"mouse0",new b);M(this,"local0",new b);M(this,"invMat",new Me)}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh;if(t.sculptStartThisFrame){if(this.nodeId=r.id,this.stroke0=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert();return}else if(this.nodeId!==r.id){this.nodeId=0,this.stroke0=void 0;return}if(!this.stroke0||!this.stroke0.track.length||!pn(Ex,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN))return;cm.copy(Ex).applyMatrix4(this.invMat).sub(this.local0);const l=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(oc.copy(cm),t.options.symmetry){case"x":oc.x*=-1;break;case"y":oc.y*=-1;break;case"z":oc.z*=-1;break}const c=t.options.enablePressure?1:s.pressure;this.stroke(this.stroke0.indices,this.brushStrength*c,t.sculptSym,cm,oc,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,l),t.history.updateVertices(r,Tn,this.stroke0.indices,l)}stroke(t,i,s,r,o,a,l,c,h,d){for(let f of t)this.strokeVertex(s,r,o,a,l,c,i,d,h.get(f))}strokeVertex(t,i,s,r,o,a,l,c,h){if(Kh.fromArray(c,h),t){const d=Kh.distanceTo(r)/a,f=Kh.distanceTo(o)/a;if(d>=1){if(f>=1)return;const p=this.sculptFalloff(f)*l;c[h]+=s.x*p,c[h+1]+=s.y*p,c[h+2]+=s.z*p}else if(f>=1){const p=this.sculptFalloff(d)*l;c[h]+=i.x*p,c[h+1]+=i.y*p,c[h+2]+=i.z*p}else{const p=1-d+(1-f),g=this.sculptFalloff(d)*l*(1-d)/p,m=this.sculptFalloff(f)*l*(1-f)/p;c[h]+=i.x*g+s.x*m,c[h+1]+=i.y*g+s.y*m,c[h+2]+=i.z*g+s.z*m}}else{const d=Kh.distanceTo(r)/a;if(d>=1)return;const f=this.sculptFalloff(d)*l;c[h]+=i.x*f,c[h+1]+=i.y*f,c[h+2]+=i.z*f}}}u(I1,"SculptMoveTool");JU(I1,"SculptMoveTool");var e5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIFJREFUSIntVMsOwCAIo/v/f2YnE8MQqMHsYi9GbcsrQeTib6BCUlX9CIGSNjX2zLO/snknLxSx9y3z1UkH8YgVs1KAmcT21mpdfdYGJrEwwBFz1tS2oVT17jCplkZz8BJg55UaVngzHvsAAEPQstBW6MheJFnXs3hUYw2PVnnRgheBggsc8NK3TAAAAABJRU5ErkJggg==",t5=Object.defineProperty,n5=u((n,e)=>t5(n,"name",{value:e,configurable:!0}),"__name$o");const Px=new b,Ni=new b,ac=new b,Zh=new Vr,Ix=new Me;class R1 extends cn{constructor(){super(...arguments);M(this,"label","Paint");M(this,"icon",e5);M(this,"tips","Press [P] to pick color");M(this,"sculpt",!0);M(this,"brushRadius",25);M(this,"brushStrength",1);M(this,"hasHardness",!0);M(this,"hasColor",!0);M(this,"frontFacesOnly",!0);M(this,"optionsProps",["brushRadius","brushStrength","brushHardness","frontFacesOnly"])}update(t,i){if(!t.sculptNodeId)return;const s=i.input;if(s.pointerOver&&s.isKeyPressed("p")){const f=t.model.getNode(t.sculptNodeId),g=f.get(Ce).mesh;Ix.copy(f.getWorldMatrix()).invert(),Zh.origin.copy(i.mouseRay0),Zh.direction.copy(i.mouseRayN),Zh.applyMatrix4(Ix);const m=g.raycast(Zh,!0)[0];if(m){const v=m.triangleIndex;Ni.set(0,0,0),Ni.add(ac.fromArray(g.aColor,v*9)),Ni.add(ac.fromArray(g.aColor,v*9+3)),Ni.add(ac.fromArray(g.aColor,v*9+6)),Ni.divideScalar(3),t.options.paintColor=[Ni.x,Ni.y,Ni.z]}return}if(t=t.readonlyRef(),!t.sculptMoved||i.index!==t.sculptActiveView||!s.mouseLeft)return;const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*l,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly),d=new Float32Array(h.position);for(let f=0,p=h.indices.length;f<p;++f){const g=h.indices[f];for(let m=0;m<3;++m)d[f*3+m]=a.aColor[g*3+m]}ac.set(t.options.paintColor[0],t.options.paintColor[1],t.options.paintColor[2]);for(let f of h.track)this.stroke(f.indices,c,f.center,t.sculptLocalRadius,h.offset,h.position,d),t.sculptSym&&this.stroke(f.indicesSym,c,f.centerSym,t.sculptLocalRadius,h.offset,h.position,d);t.history.updateVertices(r,ls,h.indices,d)}stroke(t,i,s,r,o,a,l){for(let c of t)this.strokeVertex(s,r,i,a,l,o.get(c))}strokeVertex(t,i,s,r,o,a){Px.fromArray(r,a);const l=Px.distanceTo(t)/i;if(l>=1)return;const h=Math.pow(1-l,2*(1-this.brushHardness))*s;Ni.fromArray(o,a).lerp(ac,h),o[a]=Ni.x,o[a+1]=Ni.y,o[a+2]=Ni.z}}u(R1,"SculptPaintTool");n5(R1,"SculptPaintTool");var i5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIJJREFUSIntVUEOwCAIk2X//zI7kbiFxpbhzZ4US2tEcYyDBUxNcHd/CZjJGrR4xAItwplgjGWT1c4yYdqEISLOHL8RISvenFguLrOrmLNcepG9LZDDFqhsolyz0hFVHgt6E20GyGiLSYarQ6TUIraJK4m/jxMVTmnPVD/5irV+MgcPCvzbPZirI9cAAAAASUVORK5CYII=",s5=Object.defineProperty,r5=u((n,e)=>s5(n,"name",{value:e,configurable:!0}),"__name$n");const um=new b,Qh=new b;class D1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Pinch");M(this,"icon",i5);M(this,"sculpt",!0);M(this,"hasDirection",!0);M(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,i){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView)return;const s=i.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,i);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.1,h=this.sculptPickStrokeVertices(t,r,i,a,this.frontFacesOnly);for(let d of h.track)this.stroke(d.indices,c,d.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(d.indicesSym,c,d.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Tn,h.indices,h.position)}stroke(t,i,s,r,o,a){for(let l of t)this.strokeVertex(s,r,i,a,o.get(l))}strokeVertex(t,i,s,r,o){um.fromArray(r,o);const a=um.distanceTo(t)/i;if(a>=1)return;Qh.subVectors(t,um);const l=this.sculptFalloff(a)*s;r[o]+=Qh.x*l,r[o+1]+=Qh.y*l,r[o+2]+=Qh.z*l}}u(D1,"SculptPinchTool");r5(D1,"SculptPinchTool");var o5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHxJREFUSIntVMsOgDAIG8b//2W8zGRBgcrD03pcoAVWGGNDgJn5V5GjW+xEgmTbRESogBl4E0tC+R4q4MtnrbE80Ubu5mfJwwLWGNLkGvGao83+4Q7PAVoR5c5BUbbJcHGRLqyc9lv0iugulIukTaF5G7o3E9DZzZzrDRcXkCuzdkeSNcIAAAAASUVORK5CYII=",a5=Object.defineProperty,l5=u((n,e)=>a5(n,"name",{value:e,configurable:!0}),"__name$m");const ba=new b,lc=new b,hm=new Set;class L1 extends cn{constructor(){super(...arguments);M(this,"label","Sculpt Smooth (Shift)");M(this,"icon",o5);M(this,"sculpt",!0);M(this,"brushStrength",1);M(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,i){t=t.readonlyRef(),!(!t.sculptMoved||!t.sculptNodeId||i.index!==t.sculptActiveView||!i.input.mouseLeft)&&this.doStroke(t,i)}doStroke(t,i){const s=t.model.getNode(t.sculptNodeId),o=s.get(Ce).mesh,a=this.sculptPickStrokeVertices(t,s,i,o,this.frontFacesOnly),l=t.options.enablePressure?1:i.input.pressure;for(let c of a.track)this.stroke(o,c.indices,this.brushStrength*l,c.center,t.sculptLocalRadius,a.offset,a.position),t.sculptSym&&this.stroke(o,c.indicesSym,this.brushStrength*l,c.centerSym,t.sculptLocalRadius,a.offset,a.position);t.history.updateVertices(s,Tn,a.indices,a.position)}stroke(t,i,s,r,o,a,l){for(let c of i)this.strokeVertex(t,c,r,o,s,l,a.get(c))}strokeVertex(t,i,s,r,o,a,l){ba.fromArray(a,l);const c=ba.distanceTo(s)/r;if(c>=1)return;let h=t.getVertexTriangleIndex(t.edgeNeighborMap[i]);const d=h;let f=0,p=0,g=0,m=0,v=50;hm.clear();do{hm.add(h);for(let _=0;_<3;++_){const A=t.sharedVertexMap[h*3+_];if(A!==i){t.getVertex(lc,A);const x=lc.distanceTo(ba);f+=lc.x*x,p+=lc.y*x,g+=lc.z*x,m+=x}}const w=h;for(let _=0;_<3;++_){const A=h*3+_;if(t.holes[A])continue;const x=t.getVertexTriangleIndex(t.edgeNeighborMap[A]);if(h===x||hm.has(x))continue;let C=!1;for(let T=0;T<3;++T)if(t.sharedVertexMap[x*3+T]===i){C=!0;break}if(C){h=x;break}}if(w===h)break;if(v--<=0){console.warn("Loop limit reached");break}}while(d!==h);if(m=1/m,!isFinite(m))return;f*=m,p*=m,g*=m;const y=this.sculptFalloff(c)*o;a[l]+=(f-ba.x)*y,a[l+1]+=(p-ba.y)*y,a[l+2]+=(g-ba.z)*y}}u(L1,"SculptSmoothTool");l5(L1,"SculptSmoothTool");var c5=Object.defineProperty,u5=u((n,e)=>c5(n,"name",{value:e,configurable:!0}),"__name$l");const H1=class extends cn{constructor(){super(...arguments);M(this,"icon","");M(this,"label","");M(this,"sep",!0)}};let Xs=H1;u(Xs,"ToolSeperator"),M(Xs,"instance",new H1);u5(Xs,"ToolSeperator");var h5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHZJREFUSIljYBgF1AT/oYAUPYykGI6ikZGRaL1EG47sA1J9QrRFpBrMRHVXDAoLyAlfovXgU0goDrDJMRJSQA5ATsI0jwMMQO0gIkkhPguoErw0zWhKCiaku4gUC8i1jCgL0IPl3oMzRIf54CiukS2hSTE9sgEAj0t/GHidkfcAAAAASUVORK5CYII=",d5=Object.defineProperty,f5=u((n,e)=>d5(n,"name",{value:e,configurable:!0}),"__name$k");const cc=new Me;class F1 extends cn{constructor(){super(...arguments);M(this,"label","Translate");M(this,"icon",h5);M(this,"nodes",[]);M(this,"detMat",[]);M(this,"dragging",!1)}begin(t){if(this.nodes=t.model.getTopmostSelectedNodes().filter(i=>i.has(je)),!this.nodes.length){this.enableTransformControls=!1;return}if(this.enableTransformControls=!0,!this.dragging&&(this.nodes[0].getWorldMatrix().decompose(t.dummyObject.position,t.dummyObject.quaternion,t.dummyObject.scale),this.detMat.length=this.nodes.length-1,this.detMat.length)){cc.copy(this.nodes[0].getWorldMatrix()).invert();for(let i=0;i<this.detMat.length;++i)this.detMat[i]||(this.detMat[i]=new Me),this.detMat[i].multiplyMatrices(cc,this.nodes[i+1].getWorldMatrix())}this.dragging=!1}update(t,i){if(!this.enableTransformControls)return;const s=i.transformControls;if(s.setMode("translate"),s.setSpace(t.options.useLocalSpaceForTransformControl?"local":"world"),s.setTranslationSnap(i.input.isKeyPressed("Shift")?.25:null),s.dragging){this.dragging=!0;const r=t.dummyObject.matrix;for(let o=0;o<this.nodes.length;++o){const a=this.nodes[o];cc.copy(a.getParentWorldMatrix()).invert().multiply(r),o>0&&cc.multiply(this.detMat[o-1]),t.history.setValue(a,je,fu(new b,cc))}}}onUnselected(t){this.nodes.length=0,this.dragging=!1}}u(F1,"TranslateTool");f5(F1,"TranslateTool");var p5="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGRJREFUSIntlMESABAIROX//znXGKJajBl7JG8LldLXbZG2ycxcBROp8Sa18NEaDA4zWQFYTHIoG49Ws3NfleXgdpPQgx8zQf8qFwDSgLNq3uhyCdo6q0bAnkF4/EoodJx/wVQASvh7kexwAhUAAAAASUVORK5CYII=",m5=Object.defineProperty,g5=u((n,e)=>m5(n,"name",{value:e,configurable:!0}),"__name$j");const ki=new b,Rx=new b,Vs=new b,Dx=new Ve,Lx=new b(1,0,0),wa=new Me,Fx=.005,Ox=.005,Nx=5,dm=.05;class O1 extends cn{constructor(){super(...arguments);M(this,"label","Tube");M(this,"icon",p5);M(this,"tips","Hold [Alt] to create/insert a tube node. Resize tube node with mouse wheel.");M(this,"enableDefaultDeleteShortcut",!1);M(this,"enableSelectionRect",!0);M(this,"enableDefaultSelectionBehavior",!1);M(this,"nodes",[]);M(this,"enableDeleteThisFrame",!0);M(this,"dragging",!1);M(this,"draggingActiveViewIndex",-1);M(this,"mouse0",new b);M(this,"circle",new gn(new Ff,new Wn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16711935})));M(this,"line1",new gn(new Qe().setFromPoints([new b(0,0,0),new b(1,0,0)]),this.circle.material.clone()));M(this,"line2",new gn(this.line1.geometry.clone(),this.line1.material.clone()));M(this,"creating",!1);M(this,"radius",.1);M(this,"lastNodeId",0)}setup(t){this.circle.visible=!1,t.scene.add(this.circle),this.line1.visible=!1,t.scene.add(this.line1),this.line2.visible=!1,t.scene.add(this.line2)}begin(t){t=t.readonlyRef();for(let i of this.nodes){if(i.deleted)continue;const s=i.get(nt);s.group&&(s.group.visible=!1),t.model.selected.includes(i.id)?s.selected=s.selected.filter(r=>r<s.value.length):s.selected.length=0}this.enableDefaultDeleteShortcut=!0,this.enableDeleteThisFrame=!0,this.nodes=t.model.getSelectedNodes().filter(i=>i.has(nt)&&!i.instanceId);for(let i of this.nodes){const s=i.get(nt);s.group&&(s.group.visible=!0),s.hovered=-1,s.selected.length&&(this.enableDefaultDeleteShortcut=!1),i.id===this.lastNodeId&&s.value.length&&(s.selected=[0],this.lastNodeId=0)}this.enableSelectionRect=!0,this.creating||(this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1,this.lastNodeId=0)}update(t,i){const s=i.input;if(s.isKeyPressed("Delete")&&this.enableDeleteThisFrame){this.enableDeleteThisFrame=!1;for(let r of this.nodes){const o=r.get(nt);if(o.selected.length){const a=o.clone().filter((l,c)=>!o.selected.includes(c));o.selected.length=0,a.length===0?t.history.removeNode(r.id):t.history.setValue(r,nt,a)}}return}if(this.dragging&&i.index===this.draggingActiveViewIndex)if(this.enableSelectionRect=!1,s.mouseLeft){if(pn(Rx,i.mouseRay0,i.mouseRay1,this.mouse0,i.mouseRayN)){Vs.subVectors(Rx,this.mouse0);let r=!0;for(let o of this.nodes){const a=o.get(nt);if(a.draggingStartNodeIndex>=0){r=a.selected.includes(a.draggingStartNodeIndex);break}}for(let o of this.nodes){const a=o.get(nt);if(a.selected.length||a.draggingStartNodeIndex>=0){const l=a.clone(a.draggingStartValue);if(r)for(let c of a.selected)l[c].position.applyMatrix4(a.draggingStartMatrix).add(Vs).applyMatrix4(a.draggingStartInvMatrix),s.isKeyPressed("Shift")&&Pc(l[c].position,dm);a.draggingStartNodeIndex>=0&&!r&&(l[a.draggingStartNodeIndex].position.applyMatrix4(a.draggingStartMatrix).add(Vs).applyMatrix4(a.draggingStartInvMatrix),s.isKeyPressed("Shift")&&Pc(l[a.draggingStartNodeIndex].position,dm)),t.history.setValue(o,nt,l)}}if(!r)for(let o of this.nodes){const a=o.get(nt);a.draggingStartNodeIndex>=0?a.selected=[a.draggingStartNodeIndex]:a.selected=[]}}}else{this.dragging=!1,this.draggingActiveViewIndex=-1;for(let r of this.nodes){const o=r.get(nt);o.draggingStartNodeIndex=-1}}if(s.pointerOver&&!(this.dragging||this.creating)){let r=!1;for(let o of this.nodes){const a=o.get(nt),l=i.raycaster.intersectObjects(a.pickers);if(l.length){const c=l[0].object.userData.index;if(a.hovered=c==null?-1:c,s.mouseLeftDownThisFrame)this.dragging=!0,this.draggingActiveViewIndex=i.index,this.mouse0.copy(l[0].point),a.draggingStartNodeIndex=a.hovered;else if(s.wheelDetY)for(let h of l){const d=h.object.userData.index;if(d!=null&&a.selected.includes(d)){r=!0;break}}}else a.hovered=-1}if(this.dragging&&i.index===this.draggingActiveViewIndex)for(let o of this.nodes){const a=o.get(nt);(a.selected.length||a.draggingStartNodeIndex>=0)&&(a.draggingStartMatrix=new Me().copy(o.getWorldMatrix()),a.draggingStartInvMatrix=new Me().copy(o.getWorldMatrix()).invert(),a.draggingStartValue=a.clone())}if(r){t.disableCameraDraggingThisFrame=!0;for(let o of this.nodes){const a=o.get(nt);if(a.selected.length){const l=a.clone();for(let c of a.selected)l[c].radius=Math.max(Fx,Math.min(Nx,l[c].radius-s.wheelDetY*Ox));t.history.setValue(o,nt,l)}}}if(!this.dragging&&!this.creating&&s.isKeyPressed("Alt")){this.creating=!0;for(let o of this.nodes){const a=o.get(nt);if(a.selected.length){this.radius=a.value[a.selected[0]].radius,this.radius*=Ro(o.getWorldMatrix());break}}}}if(this.creating)if(s.isKeyPressed("Alt")){if(this.enableSelectionRect=!1,s.pointerOver){let r=null,o=null,a=-1;for(let l of this.nodes){const c=l.get(nt);if(c.selected.length){r=l,o=c,a=c.selected[0];break}}if(r)ki.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix());else for(let l of t.readonlyRef().model.getSelectedNodes())if(l.isValidChild("Tube")){ki.setFromMatrixPosition(l.getWorldMatrix());break}if(pn(this.circle.position,i.mouseRay0,i.mouseRay1,ki,i.mouseRayN),s.isKeyPressed("Shift")&&Pc(this.circle.position,dm),s.wheelDetY&&(this.radius=Math.min(Nx,Math.max(Fx,-s.wheelDetY*Ox+this.radius)),t.disableCameraDraggingThisFrame=!0),this.circle.scale.setScalar(this.radius),this.circle.visible=!0,this.line1.visible=!1,this.line2.visible=!1,r&&(this.line1.position.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix()),Vs.subVectors(this.circle.position,this.line1.position),this.line1.scale.setScalar(Vs.length()),this.line1.quaternion.setFromUnitVectors(Lx,Vs.normalize()),this.line1.visible=!0,a<o.value.length-1&&(this.line2.position.copy(o.value[a+1].position).applyMatrix4(r.getWorldMatrix()),Vs.subVectors(this.circle.position,this.line2.position),this.line2.scale.setScalar(Vs.length()),this.line2.quaternion.setFromUnitVectors(Lx,Vs.normalize()),this.line2.visible=!0,o.lines[a].visible=!1,t.nextFrameEnd(()=>{const l=o==null?void 0:o.lines[a];l&&(l.visible=!0)}))),s.mouseLeftDownThisFrame){ki.copy(this.circle.position);let l=this.radius;if(!r&&this.nodes.length&&this.nodes[0].value(nt).length===0&&(r=this.nodes[0]),r){wa.copy(r.getWorldMatrix()).invert(),ki.applyMatrix4(wa),l*=Ro(wa);let c;o?(c=o.clone(),c.splice(a+1,0,{position:new b().copy(ki),radius:l}),o.selected=[a+1]):(c=[{position:new b().copy(ki),radius:l}],this.lastNodeId=r.id),t.history.setValue(r,nt,c)}else{let c=null;if(this.nodes.length)c=this.nodes[0].parent;else for(let d of t.model.getSelectedNodes())if(d.isValidChild("Tube")){c=d;break}if(c&&(wa.copy(c.getWorldMatrix()).invert(),ki.applyMatrix4(wa),l*=Ro(wa)),t.model.selected=[],!c){for(let d of t.model.getSelectedNodes())if(d.isValidChild("Shape")){c=d;break}this.lastNodeId=t.history.createNode({type:"Shape",parentId:c?c.id:0,data:{[je.name]:new b().copy(ki)},children:[{type:"Tube",data:{[nt.name]:[{radius:l,position:new b}]}}]})+1}else this.lastNodeId=t.history.createNode({type:"Tube",parentId:c?c.id:0,data:{[nt.name]:[{radius:l,position:new b().copy(ki)}]}})}this.creating=!1}}}else this.creating=!1;if(t.selectionRectSetThisFrame&&t.selectionRectViewIndex===i.index)if(t.selectionStart.equals(t.selectionEnd)){let r=!1;for(let o of this.nodes){const a=o.get(nt);a.selected.length&&(r=!0),a.selected.includes(a.hovered)?s.isKeyPressed("Control")&&(a.selected=a.selected.filter(l=>l!==a.hovered),r=!0):(s.isKeyPressed("Control")||(a.selected.length=0),a.hovered>=0&&(a.addSelection(a.hovered),r=!0))}if(!r){const o=i.mousePick("Shape");let a=null;for(let l of o){const c=o[0].object.userData.node;if(c){a=c;break}}a?t.model.selected=a.children.map(l=>l.id):t.model.selected=[]}}else{const r=i.camera.get();for(let o of this.nodes){const a=o.get(nt);s.isKeyPressed("Control")||(a.selected.length=0);for(let l of a.pickers)if(ki.setFromMatrixPosition(l.matrixWorld).project(r),CM(ki,t.selectionStart,t.selectionEnd)){const c=l.userData.index;c!=null&&a.addSelection(c)}}}}end(t){for(let i of this.nodes)i.get(nt).updateColor()}beforeRender(t,i){for(let s of this.nodes){const r=s.get(nt);Od(Dx,s.getWorldMatrix()).invert();for(let o of r.circles)o.quaternion.copy(Dx).multiply(i.camera.get().quaternion)}this.circle.visible&&this.circle.quaternion.copy(i.camera.get().quaternion)}onUnselected(t){this.dragging=!1,this.creating=!1,this.lastNodeId=0,this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1;for(let i of this.nodes){if(i.deleted)continue;const s=i.get(nt);s.group&&(s.group.visible=!1),s.selected.length=0}this.nodes.length=0}}u(O1,"TubeTool");g5(O1,"TubeTool");var v5=Object.defineProperty,y5=u((n,e)=>v5(n,"name",{value:e,configurable:!0}),"__name$i");class Tu{constructor(e,t,i,s,r){M(this,"systems",[new c1([new e1,new k0,new Q0,new T0,new F0,new l1,new D0,new n1,new L0,new O0,new i1,new a1,new o1,new J0,new r1,new t1]),new u1,new p1,new S0,new A0,new C0,new h1,new d1,new M0,new w0]);M(this,"sculptSmoothTool",new L1);M(this,"tools",[new Cu,Xs.instance,new F1,new S1,new M1,Xs.instance,new y1,new w1,new b1,Xs.instance,new Au,new O1,Xs.instance,new A1,new P1,new C1,new D1,new E1,new I1,new T1,this.sculptSmoothTool,new R1]);M(this,"sculptNodeId",0);M(this,"sculptActiveView",-1);M(this,"sculptSym",!1);M(this,"sculptLocalRadius",0);M(this,"sculptMoved",!1);M(this,"sculptStartThisFrame",!1);M(this,"sculptAccWalkedPixels",0);M(this,"sculptX0",0);M(this,"sculptY0",0);M(this,"sculptX1",0);M(this,"sculptY1",0);M(this,"canvas");M(this,"renderer");M(this,"composer");M(this,"renderPass");M(this,"outlinePass");M(this,"scene",new Xc);M(this,"views");M(this,"mainViewIndex");M(this,"dummyObject",new yt);M(this,"disableCameraDraggingThisFrame",!1);M(this,"selectionRectDragging",!1);M(this,"selectionRectViewIndex",-1);M(this,"selectionRectSetThisFrame",!1);M(this,"selectionStart",new Ge);M(this,"selectionEnd",new Ge);M(this,"model",new vu);M(this,"history",new b0(this.model));M(this,"fps",0);M(this,"detSec",0);M(this,"lastTimestamp",0);M(this,"statusBarMessage","");M(this,"tool",this.tools[0]);M(this,"nextFrameCallbacks",[]);M(this,"throttleTasks",new Map);M(this,"options",new e0);this.history.setup(),this.canvas=e,this.renderer=new Dw({canvas:e}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=rw,this.mainViewIndex=1,this.views=[new Ia(this,0,t,-Math.PI/2,-Math.PI/2,!1),new Ia(this,1,i,-Math.PI/8,-Math.PI/4,!0),new Ia(this,2,s,0,-Math.PI/2,!1),new Ia(this,3,r,0,0,!1)],this.composer=new vM(this.renderer),this.renderPass=new _M(this.scene,this.views[this.mainViewIndex].camera.get()),this.composer.addPass(this.renderPass),this.outlinePass=new Ms(new Ge,this.scene,this.renderPass.camera),this.outlinePass.visibleEdgeColor.setHex(15964205);{const o=[!1,!1,!1,!1];this.outlinePass.changeVisibilityOfNonSelectedObjects=a=>{if(a)for(let l of this.views)l.transformControls.visible=o[l.index];else for(let l of this.views)o[l.index]=l.transformControls.visible,l.transformControls.visible=!1;Ms.prototype.changeVisibilityOfNonSelectedObjects.call(this.outlinePass,a)}}this.composer.addPass(this.outlinePass),this.scene.add(this.dummyObject);for(let o of this.systems)o.setup(this);for(let o of this.tools)o.setup(this)}dispose(){this.history.unload();for(let e of this.views)e.dispose();for(let e of this.systems)e.dispose();for(let e of this.tools)e.dispose();this.renderer.dispose()}update(){const e=Date.now();this.detSec=(e-this.lastTimestamp)/1e3,this.fps=Math.floor(1/this.detSec),this.lastTimestamp=e;for(let t=0;t<this.views.length;++t){const i=this.views[t];if(i.enabled=t===this.mainViewIndex||this.options.quadView,t===this.mainViewIndex){const s=i.camera;s.perspective=this.model.cameraPerspective&&(Math.abs(s.alpha%(Math.PI/2))>1e-8||Math.abs(s.beta%(Math.PI/2))>1e-8),s.perspectiveCamera.fov=this.model.cameraFov}}for(let t of this.views)t=Ze(t),t.enabled&&t.update();for(let t of this.systems)t.update(this);for(let t of this.views)t=Ze(t),t.input.update()}reset(){this.views[this.mainViewIndex].camera.alpha=-Math.PI/8,this.views[this.mainViewIndex].camera.beta=-Math.PI/4;for(let e of this.views)e.camera.target.set(0,0,0),e.zoomLevel=0;this.model.reset(),this.history.clear()}readonlyRef(){return Ze(this)}nextFrameEnd(e){this.nextFrameCallbacks.push(e)}throttle(e,t,i,s=!1){const r=this.throttleTasks.get(e);r?(s||(r.time=Date.now()+t),r.callback=i):s?(i(),this.throttleTasks.set(e,{time:Date.now()+t,callback:()=>{}})):this.throttleTasks.set(e,{time:Date.now()+t,callback:i})}load(e){this.reset();for(let t=0;t<4;++t){const i=e.views[t],s=this.views[t];s.zoomLevel=i.zoomLevel,s.camera.alpha=i.alpha,s.camera.beta=i.beta,s.camera.target.set(...i.target),t===this.mainViewIndex&&(s.camera.perspective=i.perspective,s.camera.perspectiveCamera.fov=i.fov,this.model.cameraPerspective=i.perspective,this.model.cameraFov=i.fov)}this.model.cameras=e.cameras;for(let t of e.nodes){const i=this.model.createNode(t.id,t.type,t.parentId?this.model.getNode(t.parentId):null,null,t.data,t.instanceId);i.expanded=t.expanded}}}u(Tu,"EditorContext");y5(Tu,"EditorContext");var _5=Object.defineProperty,x5=u((n,e)=>_5(n,"name",{value:e,configurable:!0}),"__name$h"),b5=Pt({props:{editorContext:{type:Tu,required:!0}},emits:["setData"],setup(n,e){const t=at(function(){return n.editorContext.model.selected.join(",")}),i=at(function(){const r=n.editorContext.model.getSelectedNodes();if(!r.length)return[];const o=[],a=new Set,l=r[0],c=fi(l.type);for(let h of c.components){const d=Ii(h.name);l.instanceId&&!d.instanceable||d.inputComponent&&a.add(h.name)}for(let h=1,d=r.length;h<d;++h){const f=r[h],p=fi(f.type),g=new Set;for(let m of p.components){const v=Ii(m.name);f.instanceId&&!v.instanceable||v.inputComponent&&g.add(m.name)}for(let m of a)g.has(m)||a.delete(m)}for(let h of a){const d=Ii(h);o.push({name:h,componentClass:d.constructor,label:d.label||h,inlineLabel:d.inlineLabel||!1,inputComponent:d.inputComponent,inputComponentProps:d.inputComponentProps,value:l.value(d.constructor)})}return o});function s(r,o){e.emit("setData",n.editorContext.model.getSelectedNodes().map(a=>({node:a,type:r,value:o})))}return u(s,"onInput"),x5(s,"onInput"),{key:t,properties:i,onInput:s}}});function w5(n,e,t,i,s,r){return Te(),Oe("div",{class:"properties",key:n.key},[(Te(!0),Oe(Tt,null,Pr(n.properties,o=>(Te(),Oe("div",{class:qt(["property",{inline:o.inlineLabel}])},[he("label",null,$n(o.label),1),(Te(),Wt(J2(o.inputComponent),Hb({class:"value",value:o.value,onInput:a=>n.onInput(o.componentClass,a)},o.inputComponentProps),null,16,["value","onInput"]))],2))),256))])}u(w5,"_sfc_render$b");var M5=Ft(b5,[["render",w5]]),S5=Object.defineProperty,A5=u((n,e)=>S5(n,"name",{value:e,configurable:!0}),"__name$g");class N1{constructor(){M(this,"parent");M(this,"subMenu")}}u(N1,"PopupMenuItemContext");A5(N1,"PopupMenuItemContext");var C5=Object.defineProperty,kx=u((n,e)=>C5(n,"name",{value:e,configurable:!0}),"__name$f"),T5=Pt({props:{title:String,icon:String,hotkey:String,disabled:Boolean,sep:Boolean,popup:Boolean,checked:Boolean},setup(n,e){const t=ze(),i=at(function(){return!!e.slots.default}),s=new N1;za("popupMenuItemContext",s),s.parent=ii("popupMenuContext",null)||void 0;function r(){var a;(a=s.parent)==null||a.handleMenuItemMouseOver(s,t.value)}u(r,"onMouseOver"),kx(r,"onMouseOver");function o(a){var l;n.disabled||n.sep||i.value||(l=s.parent)==null||l.hideAll()}return u(o,"onClick"),kx(o,"onClick"),{menuItem:t,hasChild:i,onMouseOver:r,onClick:o}}});const E5=["src"],P5={class:"title"},I5={key:0,class:"hotkey"};function R5(n,e,t,i,s,r){return Te(),Oe("div",{class:qt(["popup-menu-item",{"has-child":n.hasChild,disabled:n.disabled,sep:n.sep,popup:n.popup}]),ref:"menuItem",onMouseover:e[0]||(e[0]=on((...o)=>n.onMouseOver&&n.onMouseOver(...o),["stop"])),onClick:e[1]||(e[1]=(...o)=>n.onClick&&n.onClick(...o))},[n.sep?tt("",!0):(Te(),Oe(Tt,{key:0},[he("div",{class:qt(["icon",{checked:n.checked,img:!!n.icon}])},[n.icon&&!n.checked?(Te(),Oe("img",{key:0,src:n.icon,alt:""},null,8,E5)):tt("",!0)],2),he("div",P5,$n(n.title),1),n.hotkey?(Te(),Oe("div",I5,$n(n.hotkey),1)):tt("",!0),Bc(n.$slots,"default",{},void 0,!0)],64))],34)}u(R5,"_sfc_render$a");var CA=Ft(T5,[["render",R5],["__scopeId","data-v-4eb751b0"]]),D5=Object.defineProperty,Ji=u((n,e)=>D5(n,"name",{value:e,configurable:!0}),"__name$e"),L5=Pt({name:"model-tree-node",props:{model:{type:vu,required:!0},node:{type:Do,required:!0},depth:{type:Number,required:!0},draggingNode:Do,dragOverNode:Do,dropPosition:String},emits:["setValue","setSelection","dragStart","dragOver","contextmenu","rangeSelect"],setup(n,e){const t=ze(),i=at(function(){const _=n.node;return(_.has(Xt)?_.value(Xt):"")||`${_.type}#${_.id}`}),s=at(function(){return fi(n.node.type).icon}),r=at(function(){return n.node.has(zt)}),o=at(function(){return r.value&&n.node.value(zt)});function a(_,A,x){e.emit("setValue",_,A,x)}u(a,"onSetValue"),Ji(a,"onSetValue");function l(){a(n.node,zt,!o.value)}u(l,"toggleVisible"),Ji(l,"toggleVisible");function c(){n.node.expanded=!n.node.expanded}u(c,"toggleExpanded"),Ji(c,"toggleExpanded");function h(_){e.emit("setSelection",_)}u(h,"onSetSelection"),Ji(h,"onSetSelection");function d(_){const A=n.node.id;if(_.ctrlKey){const x=n.model.selected;x.includes(A)?e.emit("setSelection",x.filter(C=>C!==A)):e.emit("setSelection",[...x,A])}else _.shiftKey?w(A):e.emit("setSelection",[A])}u(d,"onNodeClick"),Ji(d,"onNodeClick");function f(_){if(!_.shiftKey){if(!n.model.selected.includes(n.node.id)){if(_.ctrlKey)return;e.emit("setSelection",[n.node.id])}g(n.node)}}u(f,"onMouseDown"),Ji(f,"onMouseDown");function p(_){if(n.draggingNode&&t.value){const A=t.value.getBoundingClientRect(),x=_.clientY-A.top,C=6;let T=x<=C?"before":x>=A.height-C?"after":"atLast";T==="after"&&n.node.children.length&&n.node.expanded&&(T="atFirst"),e.emit("dragOver",n.node,T)}}u(p,"onMouseMove"),Ji(p,"onMouseMove");function g(_){e.emit("dragStart",_)}u(g,"onDragStart"),Ji(g,"onDragStart");function m(_,A){e.emit("dragOver",_,A)}u(m,"onDragOver"),Ji(m,"onDragOver");const v=at(function(){const _=n.node,A=n.draggingNode===_,x=n.dragOverNode===_,C=n.dropPosition;return{selected:n.model.selected.includes(_.id),dragging:A,"drag-over-before":x&&C==="before","drag-over-inside":x&&(C==="atFirst"||C==="atLast"),"drag-over-after":x&&C==="after",instance:!!_.instanceId}});function y(_,A){e.emit("contextmenu",_,A)}u(y,"onContextMenu"),Ji(y,"onContextMenu");function w(_){e.emit("rangeSelect",_)}return u(w,"onRangeSelect"),Ji(w,"onRangeSelect"),{dom:t,name:i,icon:s,hasVisible:r,visible:o,onSetValue:a,toggleVisible:l,toggleExpanded:c,onSetSelection:h,onNodeClick:d,onMouseDown:f,onMouseMove:p,onDragStart:g,onDragOver:m,classnames:v,onContextMenu:y,onRangeSelect:w}}});const F5={class:"visibility"},O5={class:"expand"},N5=["src"];function k5(n,e,t,i,s,r){const o=Yt("model-tree-node",!0);return Te(),Oe(Tt,null,[he("div",{class:qt(["model-tree-node",n.classnames]),onMousedown:e[3]||(e[3]=on((...a)=>n.onMouseDown&&n.onMouseDown(...a),["left"])),onMousemove:e[4]||(e[4]=(...a)=>n.onMouseMove&&n.onMouseMove(...a)),onContextmenu:e[5]||(e[5]=on(a=>n.onContextMenu(n.node,a),["prevent"])),ref:"dom"},[he("div",F5,[n.hasVisible?(Te(),Oe("div",{key:0,class:qt(["icon",[n.visible?"visible":"invisible"]]),onClick:e[0]||(e[0]=on((...a)=>n.toggleVisible&&n.toggleVisible(...a),["stop"]))},null,2)):tt("",!0)]),he("div",{class:"name",style:Jn({"padding-left":`${n.depth*16+2}px`}),onClick:e[2]||(e[2]=(...a)=>n.onNodeClick&&n.onNodeClick(...a))},[he("div",O5,[n.node.children.length?(Te(),Oe("div",{key:0,class:qt(["icon",[n.node.expanded?"collapse":"expand"]]),onClick:e[1]||(e[1]=on((...a)=>n.toggleExpanded&&n.toggleExpanded(...a),["stop"]))},null,2)):tt("",!0)]),he("img",{class:"node-icon",src:n.icon,alt:""},null,8,N5),he("span",null,$n(n.name),1)],4)],34),n.node.expanded?(Te(!0),Oe(Tt,{key:0},Pr(n.node.children,a=>(Te(),Wt(o,{key:a.id,model:n.model,node:a,depth:n.depth+1,onSetValue:n.onSetValue,onSetSelection:n.onSetSelection,onRangeSelect:n.onRangeSelect,"dragging-node":n.draggingNode,"drag-over-node":n.dragOverNode,"drop-position":n.dropPosition,onDragStart:n.onDragStart,onDragOver:n.onDragOver,onContextmenu:n.onContextMenu},null,8,["model","node","depth","onSetValue","onSetSelection","onRangeSelect","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu"]))),128)):tt("",!0)],64)}u(k5,"_sfc_render$9");var z5=Ft(L5,[["render",k5],["__scopeId","data-v-b34471c0"]]),B5=Object.defineProperty,ai=u((n,e)=>B5(n,"name",{value:e,configurable:!0}),"__name$d"),U5=Pt({components:{PopupMenu:u0,PopupMenuItem:CA,ModelTreeNode:z5},props:{model:{type:vu,required:!0}},emits:["setValue","moveNode","select","focus","cut","copy","paste","delete","convertToClay","createInstance"],setup(n,e){const t=ze();function i(T,S,I){e.emit("setValue",T,S,I)}u(i,"onSetValue"),ai(i,"onSetValue");let s=!1;const r=ze(),o=ze(),a=ze("");function l(T){r.value=T,o.value=void 0;const S=ai(function(){r.value!==o.value&&r.value&&o.value&&e.emit("moveNode",o.value,a.value),r.value=void 0,o.value=void 0,document.removeEventListener("mouseup",S)},"onMouseUp");document.addEventListener("mouseup",S)}u(l,"onDragStart"),ai(l,"onDragStart");function c(T,S){T!==o.value&&(s=!0),o.value=T,a.value=S}u(c,"onDragOver"),ai(c,"onDragOver");function h(T){if(s){s=!1;return}e.emit("select",T)}u(h,"onSetSelection"),ai(h,"onSetSelection");const d=ze();function f(T,S){d.value=T,t.value.show(S.target,{x:S.clientX,y:S.clientY})}u(f,"onContextMenu"),ai(f,"onContextMenu");function p(){e.emit("focus",d.value)}u(p,"onFocus"),ai(p,"onFocus");function g(){e.emit("cut")}u(g,"onCut"),ai(g,"onCut");function m(){e.emit("copy")}u(m,"onCopy"),ai(m,"onCopy");function v(){e.emit("paste",d.value)}u(v,"onPaste"),ai(v,"onPaste");function y(){e.emit("delete")}u(y,"onDelete"),ai(y,"onDelete");const w=at(function(){const T=d.value;return T?["Shape","Box","ObjModel","FbxModel"].includes(T.type):!1});function _(){e.emit("convertToClay",d.value)}u(_,"onConvertToClay"),ai(_,"onConvertToClay");const A=at(function(){const T=d.value;return T?!!fi(T.type).instanceable:!1});function x(T){e.emit("createInstance",d.value,T)}u(x,"onCreateInstance"),ai(x,"onCreateInstance");function C(T){const S=Ze(n.model),I=new Set(S.selected);if(!I.size){h([T]);return}const D=[];let B=!1,Q=!1;S.forEach(U=>{if(B&&Q)return!1;!Q&&I.has(U.id)&&(Q=!0),U.id===T&&(B=!0),(Q||B)&&D.push(U.id)}),h(D)}return u(C,"onRangeSelect"),ai(C,"onRangeSelect"),{contextMenu:t,onSetValue:i,onSetSelection:h,draggingNode:r,dragOverNode:o,dropPosition:a,onDragStart:l,onDragOver:c,onContextMenu:f,contextMenuNode:d,onFocus:p,onCut:g,onCopy:m,onPaste:v,onDelete:y,canConvertToClay:w,onConvertToClay:_,canCreateInstance:A,onCreateInstance:x,onRangeSelect:C}}});function V5(n,e,t,i,s,r){const o=Yt("model-tree-node"),a=Yt("popup-menu-item"),l=Yt("popup-menu");return Te(),Oe("div",{class:"model-tree",onClick:e[3]||(e[3]=on(c=>n.onSetSelection([]),["left","self"])),onContextmenu:e[4]||(e[4]=on(c=>n.onContextMenu(void 0,c),["self","prevent"]))},[(Te(!0),Oe(Tt,null,Pr(n.model.nodes,c=>(Te(),Wt(o,{key:c.id,model:n.model,node:c,depth:0,onSetValue:n.onSetValue,onSetSelection:n.onSetSelection,"dragging-node":n.draggingNode,"drag-over-node":n.dragOverNode,"drop-position":n.dropPosition,onDragStart:n.onDragStart,onDragOver:n.onDragOver,onContextmenu:n.onContextMenu,onRangeSelect:n.onRangeSelect},null,8,["model","node","onSetValue","onSetSelection","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu","onRangeSelect"]))),128)),Pe(l,{ref:"contextMenu"},{default:kt(()=>[Pe(a,{title:"Focus",onClick:n.onFocus,disabled:!n.contextMenuNode},null,8,["onClick","disabled"]),n.canConvertToClay||n.canCreateInstance?(Te(),Oe(Tt,{key:0},[Pe(a,{sep:""}),n.canConvertToClay?(Te(),Wt(a,{key:0,title:"Convert to Clay",onClick:n.onConvertToClay},null,8,["onClick"])):tt("",!0),n.canCreateInstance?(Te(),Oe(Tt,{key:1},[Pe(a,{title:"Create Shadow Node",onClick:e[0]||(e[0]=c=>n.onCreateInstance("none"))}),Pe(a,{title:"Create Y-Axis Mirroring Shadow Node",onClick:e[1]||(e[1]=c=>n.onCreateInstance("y"))}),Pe(a,{title:"Create Z-Axis Mirroring Shadow Node",onClick:e[2]||(e[2]=c=>n.onCreateInstance("z"))})],64)):tt("",!0)],64)):tt("",!0),Pe(a,{sep:""}),Pe(a,{title:"Cut",hotkey:"Ctrl+X",onClick:n.onCut,disabled:!n.model.selected.length},null,8,["onClick","disabled"]),Pe(a,{title:"Copy",hotkey:"Ctrl+C",onClick:n.onCopy,disabled:!n.model.selected.length},null,8,["onClick","disabled"]),Pe(a,{title:"Paste",hotkey:"Ctrl+V",onClick:n.onPaste},null,8,["onClick"]),Pe(a,{title:"Delete",hotkey:"Delete",onClick:n.onDelete,disabled:!n.model.selected.length},null,8,["onClick","disabled"])]),_:1},512)],32)}u(V5,"_sfc_render$8");var H5=Ft(U5,[["render",V5],["__scopeId","data-v-e887c30e"]]),G5=Object.defineProperty,zx=u((n,e)=>G5(n,"name",{value:e,configurable:!0}),"__name$c"),$5=Pt({props:{modal:Boolean,title:String,width:String,height:String,closable:Boolean,visible:Boolean,x:Number,y:Number},emits:["update:visible","update:x","update:y","close"],setup(n,e){const t=ze(),i=ze(0),s=ze(0),r=at(function(){const l={};return l.left=Math.round(i.value)+"px",l.top=Math.round(s.value)+"px",n.width&&(l.width=n.width),n.height&&(l.height=n.height),l});si([()=>n.x,()=>n.y],function([l,c]){l!=null&&c!=null&&(i.value=l,s.value=c)},{immediate:!0}),si(()=>n.visible,async function(l){if(l&&(n.x==null||n.y==null)&&(i.value=0,s.value=0,await Bi(),t.value)){const c=document.body.getBoundingClientRect(),h=t.value.getBoundingClientRect();i.value=(c.width-h.width)/2,s.value=(c.height-h.height)/2}},{immediate:!0});function o(){e.emit("update:visible",!1),e.emit("close")}u(o,"close"),zx(o,"close");function a(l){const c=l.clientX,h=l.clientY,d=i.value,f=s.value;nl(l,p=>{if(t.value){const g=p.clientX-c,m=p.clientY-h,v=document.body.getBoundingClientRect(),y=t.value.getBoundingClientRect();i.value=Math.max(0,Math.min(v.width-y.width,d+g)),s.value=Math.max(0,Math.min(v.height-y.height,f+m)),e.emit("update:x",i.value),e.emit("update:y",s.value)}})}return u(a,"onTitleMouseDown"),zx(a,"onTitleMouseDown"),{dialog:t,style:r,close:o,onTitleMouseDown:a}}});const W5={class:"popup-dialog__title-text"},j5={class:"popup-dialog__body"},X5={key:0,class:"popup-dialog__buttons"};function Y5(n,e,t,i,s,r){return Te(),Wt(Ag,{to:"body"},[he("div",{class:qt(["popup-dialog__mask",{modal:n.modal,visible:n.visible}])},[he("div",{class:"popup-dialog",style:Jn(n.style),ref:"dialog"},[he("div",{class:"popup-dialog__title",onPointerdown:e[2]||(e[2]=(...o)=>n.onTitleMouseDown&&n.onTitleMouseDown(...o))},[he("div",W5,$n(n.title),1),n.closable?(Te(),Oe("button",{key:0,class:"popup-dialog__btn-close",onMousedown:e[0]||(e[0]=on(()=>{},["stop"])),onClick:e[1]||(e[1]=(...o)=>n.close&&n.close(...o))},null,32)):tt("",!0)],32),he("div",j5,[Bc(n.$slots,"default",{},void 0,!0)]),n.$slots.buttons?(Te(),Oe("div",X5,[Bc(n.$slots,"buttons",{},void 0,!0)])):tt("",!0)],4)],2)])}u(Y5,"_sfc_render$7");var Of=Ft($5,[["render",Y5],["__scopeId","data-v-4be1c5cb"]]),q5=Object.defineProperty,K5=u((n,e)=>q5(n,"name",{value:e,configurable:!0}),"__name$b"),Z5=Pt({props:{alpha:Number,beta:Number},emits:["setView"],setup(n,e){const t=at(function(){const s=(n.alpha||0)/Math.PI*180,r=-(n.beta||0)/Math.PI*180-90;return{transform:`rotateX(${s}deg) rotateY(${r}deg)`}});function i(s){e.emit("setView",s)}return u(i,"setView"),K5(i,"setView"),{cubeStyle:t,setView:i}}});function Q5(n,e,t,i,s,r){return Te(),Oe("div",{class:"view-rotation-handler",onContextmenu:e[6]||(e[6]=on(()=>{},["prevent"]))},[he("div",{class:"cube",style:Jn(n.cubeStyle)},[he("div",{class:"face front",onClick:e[0]||(e[0]=o=>n.setView("front"))},"+Z"),he("div",{class:"face back",onClick:e[1]||(e[1]=o=>n.setView("back"))},"-Z"),he("div",{class:"face top",onClick:e[2]||(e[2]=o=>n.setView("top"))},"+Y"),he("div",{class:"face bottom",onClick:e[3]||(e[3]=o=>n.setView("bottom"))},"-Y"),he("div",{class:"face right",onClick:e[4]||(e[4]=o=>n.setView("right"))},"+X"),he("div",{class:"face left",onClick:e[5]||(e[5]=o=>n.setView("left"))},"-X")],4)],32)}u(Q5,"_sfc_render$6");var J5=Ft(Z5,[["render",Q5],["__scopeId","data-v-308c1057"]]),e6=Object.defineProperty,Bx=u((n,e)=>e6(n,"name",{value:e,configurable:!0}),"__name$a"),t6=Pt({components:{ViewRotationHandler:J5},props:{editorContext:Tu,quadView:Boolean,mainView:Number},emits:["mounted","beforeUnmount","setView"],setup(n,e){const t=ze(),i=ze(),s=ze(),r=ze(),o=ze(),a=ze(),l=ze(),c=ze(),h=ze(),d=ze();let f;si(()=>n.quadView,function(){p()}),rf(function(){p(),f=setInterval(p,50),e.emit("mounted",i.value,l.value,c.value,h.value,d.value)}),Bo(function(){clearInterval(f),e.emit("beforeUnmount")});function p(){const m=t.value.getBoundingClientRect(),v=i.value;(v.width!==m.width||v.height!==m.height)&&(v.width=m.width,v.height=m.height)}u(p,"resize"),Bx(p,"resize");function g(m){e.emit("setView",m)}return u(g,"setView"),Bx(g,"setView"),{wrapper:t,canvas:i,view1:s,view2:r,view3:o,view4:a,view1Control:l,view2Control:c,view3Control:h,view4Control:d,setView:g}}});const n6={ref:"canvas"},i6={class:"view v1",ref:"view1",tabindex:"0"},s6={class:"control",ref:"view1Control"},r6={class:"view v2",ref:"view2",tabindex:"0"},o6={class:"control",ref:"view2Control"},a6={class:"view v3",ref:"view3",tabindex:"0"},l6={class:"control",ref:"view3Control"},c6={class:"view v4",ref:"view4",tabindex:"0"},u6={class:"control",ref:"view4Control"};function h6(n,e,t,i,s,r){const o=Yt("view-rotation-handler");return Te(),Oe("div",{class:qt(["canvas-wrapper",{"quad-view":n.quadView}]),ref:"wrapper"},[he("canvas",n6,null,512),Ea(he("div",i6,[he("div",s6,null,512),n.editorContext?(Te(),Wt(o,{key:0,alpha:n.editorContext.views[0].camera.alpha,beta:n.editorContext.views[0].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Ou,n.quadView||n.mainView===0]]),Ea(he("div",r6,[he("div",o6,null,512),n.editorContext?(Te(),Wt(o,{key:0,alpha:n.editorContext.views[1].camera.alpha,beta:n.editorContext.views[1].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Ou,n.quadView||n.mainView===1]]),Ea(he("div",a6,[he("div",l6,null,512),n.editorContext?(Te(),Wt(o,{key:0,alpha:n.editorContext.views[2].camera.alpha,beta:n.editorContext.views[2].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Ou,n.quadView||n.mainView===2]]),Ea(he("div",c6,[he("div",u6,null,512),n.editorContext?(Te(),Wt(o,{key:0,alpha:n.editorContext.views[3].camera.alpha,beta:n.editorContext.views[3].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Ou,n.quadView||n.mainView===3]])],2)}u(h6,"_sfc_render$5");var d6=Ft(t6,[["render",h6],["__scopeId","data-v-5bd07d3d"]]),f6=Object.defineProperty,p6=u((n,e)=>f6(n,"name",{value:e,configurable:!0}),"__name$9"),m6=Pt({props:{width:{type:Number,default:250},minWidth:{type:Number,default:50},maxWidth:{type:Number,default:500},direction:{type:String,default:"left"}},setup(n,e){function t(i){if(i.button!==0)return;const s=n.width,r=i.clientX;nl(i,function(o){const a=(o.clientX-r)*(n.direction==="left"?-1:1),l=Math.min(Math.max(s+a,n.minWidth),n.maxWidth);e.emit("update:width",l)})}return u(t,"onResize"),p6(t,"onResize"),{onResize:t}}});const g6={class:"side-panel-content"};function v6(n,e,t,i,s,r){return Te(),Oe("div",{class:"side-panel",style:Jn({width:`${n.width}px`})},[he("div",g6,[Bc(n.$slots,"default",{},void 0,!0)]),n.direction==="left"?(Te(),Oe("div",{key:0,class:"resizer-handler left",onPointerdown:e[0]||(e[0]=(...o)=>n.onResize&&n.onResize(...o))},null,32)):tt("",!0),n.direction==="right"?(Te(),Oe("div",{key:1,class:"resizer-handler right",onPointerdown:e[1]||(e[1]=(...o)=>n.onResize&&n.onResize(...o))},null,32)):tt("",!0)],4)}u(v6,"_sfc_render$4");var y6=Ft(m6,[["render",v6],["__scopeId","data-v-64397c11"]]),_6=Object.defineProperty,x6=u((n,e)=>_6(n,"name",{value:e,configurable:!0}),"__name$8");function Nf(n,e){const t=jb(n);e&&e(t);const i=document.createElement("div");return document.body.appendChild(i),t.mount(i),function(){t.unmount(),i.remove()}}u(Nf,"createComponentInstance");x6(Nf,"createComponentInstance");var b6=Object.defineProperty,w6=u((n,e)=>b6(n,"name",{value:e,configurable:!0}),"__name$7"),M6=Pt({components:{PopupDialog:Of},setup(){const n=ze(!1),e=ze(""),t=ii("context",null);t&&(n.value=t.visible,e.value=t.content),si(n,s=>{s||t==null||t.onCloseCallback()});function i(){n.value=!1}return u(i,"ok"),w6(i,"ok"),{visible:n,content:e,ok:i}}});const S6={style:{"white-space":"pre-wrap"}};function A6(n,e,t,i,s,r){const o=Yt("popup-dialog");return Te(),Wt(o,{modal:"",title:"Message",closable:"",visible:n.visible,"onUpdate:visible":e[1]||(e[1]=a=>n.visible=a)},{buttons:kt(()=>[he("button",{onClick:e[0]||(e[0]=(...a)=>n.ok&&n.ok(...a))},"Ok")]),default:kt(()=>[he("div",S6,$n(n.content),1)]),_:1},8,["visible"])}u(A6,"_sfc_render$3");var C6=Ft(M6,[["render",A6]]),T6=Object.defineProperty,Ux=u((n,e)=>T6(n,"name",{value:e,configurable:!0}),"__name$6"),E6=Pt({components:{PopupDialog:Of},setup(){const n=ze(!1),e=ze("");let t=!1;const i=ii("context",null);i&&(n.value=i.visible,e.value=i.content),si(n,o=>{o||i==null||i.onCloseCallback(t)});function s(){t=!0,n.value=!1}u(s,"yes"),Ux(s,"yes");function r(){n.value=!1}return u(r,"no"),Ux(r,"no"),{visible:n,content:e,yes:s,no:r}}});const P6={style:{"white-space":"pre-wrap"}};function I6(n,e,t,i,s,r){const o=Yt("popup-dialog");return Te(),Wt(o,{modal:"",title:"Confirm",closable:"",visible:n.visible,"onUpdate:visible":e[2]||(e[2]=a=>n.visible=a)},{buttons:kt(()=>[he("button",{onClick:e[0]||(e[0]=(...a)=>n.yes&&n.yes(...a))},"Yes"),he("button",{onClick:e[1]||(e[1]=(...a)=>n.no&&n.no(...a))},"No")]),default:kt(()=>[he("div",P6,$n(n.content),1)]),_:1},8,["visible"])}u(I6,"_sfc_render$2");var R6=Ft(E6,[["render",I6]]),D6=Object.defineProperty,Vx=u((n,e)=>D6(n,"name",{value:e,configurable:!0}),"__name$5"),L6=Pt({components:{PopupDialog:Of},setup(){const n=ze(!1),e=ze(""),t=ze(),i=ze(null);let s=!1;const r=ii("context",null);r&&(n.value=r.visible,e.value=r.title,i.value=r.value),si(n,async l=>{var c,h;l?(await Bi(),(c=t.value)==null||c.focus(),(h=t.value)==null||h.select()):r==null||r.onCloseCallback(s?i.value:null)},{immediate:!0});function o(){s=!0,n.value=!1}u(o,"ok"),Vx(o,"ok");function a(){s=!1,n.value=!1}return u(a,"cancel"),Vx(a,"cancel"),{visible:n,title:e,input:t,value:i,ok:o,cancel:a}}});function F6(n,e,t,i,s,r){const o=Yt("popup-dialog");return Te(),Wt(o,{modal:"",title:n.title,closable:"",visible:n.visible,"onUpdate:visible":e[3]||(e[3]=a=>n.visible=a)},{buttons:kt(()=>[he("button",{onClick:e[1]||(e[1]=(...a)=>n.ok&&n.ok(...a))},"Ok"),he("button",{onClick:e[2]||(e[2]=(...a)=>n.cancel&&n.cancel(...a))},"Cancel")]),default:kt(()=>[Ea(he("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),style:{width:"100%"},ref:"input"},null,512),[[ZC,n.value]])]),_:1},8,["title","visible"])}u(F6,"_sfc_render$1");var O6=Ft(L6,[["render",F6]]),N6=Object.defineProperty,Sl=u((n,e)=>N6(n,"name",{value:e,configurable:!0}),"__name$4");class k1{constructor(e,t,i){M(this,"visible");M(this,"content");M(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=i}}u(k1,"AlertDialogContext");Sl(k1,"AlertDialogContext");function TA(n){let e;return new Promise(function(t){const i=new k1(!0,n,function(){e(),t()});e=Nf(C6,s=>{s.provide("context",i)})})}u(TA,"showAlertDialog");Sl(TA,"showAlertDialog");class z1{constructor(e,t,i){M(this,"visible");M(this,"content");M(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=i}}u(z1,"ConfirmDialogContext");Sl(z1,"ConfirmDialogContext");function EA(n){let e;return new Promise(function(t){const i=new z1(!0,n,function(s){e(),t(s)});e=Nf(R6,s=>{s.provide("context",i)})})}u(EA,"showConfirmDialog");Sl(EA,"showConfirmDialog");class B1{constructor(e,t,i,s){M(this,"visible");M(this,"title");M(this,"value");M(this,"onCloseCallback");this.visible=e,this.title=t,this.value=i,this.onCloseCallback=s}}u(B1,"PromptDialogContext");Sl(B1,"PromptDialogContext");function k6(n,e){let t;return new Promise(function(i){const s=new B1(!0,n,e==null?null:e,function(r){t(),i(r)});t=Nf(O6,r=>{r.provide("context",s)})})}u(k6,"showPromptDialog");Sl(k6,"showPromptDialog");var z6=Object.defineProperty,B6=u((n,e)=>z6(n,"name",{value:e,configurable:!0}),"__name$3");const PA=2016834916,IA=2,Jh=new DataView(new ArrayBuffer(8));class U1{constructor(){M(this,"buffer",new Uint8Array(64));M(this,"size",0)}expandCapacity(e){const t=e+this.size;if(this.buffer.length<t){const i=new Uint8Array(Math.pow(2,Math.ceil(Math.log2(t))));for(let s=0,r=this.size;s<r;++s)i[s]=this.buffer[s];this.buffer=i}}writeUint32(e){this.expandCapacity(4),Jh.setUint32(0,e);for(let t=0;t<4;++t)this.buffer[this.size+t]=Jh.getUint8(t);this.size+=4}writeFloat64(e){this.expandCapacity(8),Jh.setFloat64(0,e);for(let t=0;t<8;++t)this.buffer[this.size+t]=Jh.getUint8(t);this.size+=8}writeBoolean(e){this.writeUint32(e?1:0)}writeString(e){const i=new TextEncoder().encode(e);this.writeUint32(i.length),this.expandCapacity(i.length);for(let s=0,r=i.length;s<r;++s)this.buffer[this.size+s]=i[s];this.size+=i.length}writeBytes(e){this.writeUint32(e.length),this.expandCapacity(e.length);for(let t=0,i=e.length;t<i;++t)this.buffer[this.size+t]=e[t];this.size+=e.length}writeNumberArray(e){this.writeUint32(e.length);for(let t of e)this.writeFloat64(t)}write(e){e=e.readonlyRef(),this.writeUint32(PA),this.writeUint32(IA);for(let i of e.views)this.writeFloat64(i.zoomLevel),this.writeFloat64(i.camera.alpha),this.writeFloat64(i.camera.beta),this.writeFloat64(i.camera.target.x),this.writeFloat64(i.camera.target.y),this.writeFloat64(i.camera.target.z),this.writeBoolean(i.camera.perspective),this.writeFloat64(i.camera.perspectiveCamera.fov);const t=e.model;this.writeUint32(t.cameras.length);for(let i of t.cameras)this.writeString(i.name),this.writeFloat64(i.zoomLevel),this.writeFloat64(i.alpha),this.writeFloat64(i.beta),this.writeFloat64(i.target[0]),this.writeFloat64(i.target[1]),this.writeFloat64(i.target[2]),this.writeBoolean(i.perspective),this.writeFloat64(i.fov);return e.model.forEach(i=>{var r;this.writeUint32(i.id),this.writeString(i.type),this.writeBoolean(i.expanded),this.writeUint32(((r=i.parent)==null?void 0:r.id)||0),this.writeUint32(i.instanceId);const s=[];for(let o in i.components){const a=i.components[o],l=Ii(o);if(l.storable){if(i.instanceId&&!l.instanceable)continue;const c=l.serialize?l.serialize(a.value):a.value;c!=null&&s.push([l.dataType,o,c])}}this.writeUint32(s.length);for(let o of s){const a=o[0],l=o[1],c=o[2];switch(this.writeUint32(a),this.writeString(l.substring(1)),a){case Xe.NUMBER:this.writeFloat64(c);break;case Xe.STRING:this.writeString(c);break;case Xe.BOOLEAN:this.writeBoolean(c);break;case Xe.NUMBER_ARRAY:this.writeNumberArray(c);break;case Xe.BYTES:this.writeBytes(c);break;default:throw new Error(`Unimplemented data type of component [${l}]`)}}}),this}getBytes(){return this.buffer.subarray(0,this.size)}}u(U1,"ProjectWriter");B6(U1,"ProjectWriter");var U6=Object.defineProperty,V6=u((n,e)=>U6(n,"name",{value:e,configurable:!0}),"__name$2");const ed=new DataView(new ArrayBuffer(8));class Wd{constructor(e){M(this,"buffer");M(this,"index",0);this.buffer=e}end(){return this.index>=this.buffer.length}readUint32(){for(let t=0;t<4;++t)ed.setUint8(t,this.buffer[this.index+t]);const e=ed.getUint32(0);return this.index+=4,e}readFloat64(){for(let t=0;t<8;++t)ed.setUint8(t,this.buffer[this.index+t]);const e=ed.getFloat64(0);return this.index+=8,e}readBoolean(){return!!this.readUint32()}readString(){const e=new TextDecoder,t=this.readUint32(),i=this.buffer.subarray(this.index,this.index+t),s=e.decode(i);return this.index+=t,s}readBytes(){const e=this.readUint32(),t=this.buffer.subarray(this.index,this.index+e);return this.index+=e,t}readNumberArray(){const e=this.readUint32(),t=[];for(let i=0;i<e;++i)t.push(this.readFloat64());return t}read(){if(this.readUint32()!==PA)throw new Error("Failed to read magic header");const t=this.readUint32();if(t>IA)throw new Error("Unknown file version");const i={views:[],cameras:[],nodes:[]};for(let s=0;s<4;++s){const r=this.readFloat64(),o=this.readFloat64(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),h=this.readFloat64();let d=s===1,f=45;t>=2&&(d=this.readBoolean(),f=this.readFloat64()),i.views.push({zoomLevel:r,alpha:o,beta:a,target:[l,c,h],perspective:d,fov:f})}if(t>=2){const s=this.readUint32();for(let r=0;r<s;++r){const o=this.readString(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),h=this.readFloat64(),d=this.readFloat64(),f=this.readFloat64(),p=this.readBoolean(),g=this.readFloat64();i.cameras.push({name:o,zoomLevel:a,alpha:l,beta:c,target:[h,d,f],perspective:p,fov:g})}}for(;!this.end();){const s=this.readUint32(),r=this.readString(),o=this.readBoolean(),a=this.readUint32(),l=this.readUint32(),c=this.readUint32(),h={};for(let d=0;d<c;++d){const f=this.readUint32(),p="C"+this.readString();let g;switch(f){case Xe.NUMBER:g=this.readFloat64();break;case Xe.STRING:g=this.readString();break;case Xe.BOOLEAN:g=this.readBoolean();break;case Xe.NUMBER_ARRAY:g=this.readNumberArray();break;case Xe.BYTES:g=this.readBytes();break;default:throw new Error(`Unimplemented data type [${f}]`)}if(SM(p)){const m=Ii(p);m.deserialize&&(g=m.deserialize(g)),h[p]=g}}i.nodes.push({id:s,type:r,expanded:o,parentId:a,instanceId:l,data:h})}return i}}u(Wd,"ProjectReader");V6(Wd,"ProjectReader");var H6=Object.defineProperty,G6=u((n,e)=>H6(n,"name",{value:e,configurable:!0}),"__name$1");const uc=new b,td=new b,nd=new b,Hx=new b,Gx=new b,$x=new b,id=new b,fm=new b,pm=new b,Wx=new b,sd=new b,jx=new b,mm=new b,gm=new b(1,0,0);function RA(n,e,t,i,s=.005){const r=Math.max(i.max.x-i.min.x,i.max.y-i.min.y,i.max.z-i.min.z),o=r/(Math.ceil(r/s)+.5),a=1/o,l=n.length/9,c=i.min.x-o,h=i.min.y-o,d=i.min.z-o,f=i.max.x+o,p=i.max.y+o,g=i.max.z+o,m=Math.floor(c*a),v=Math.floor(h*a),y=Math.floor(d*a),w=Math.ceil(f*a),_=Math.ceil(p*a),A=Math.ceil(g*a),x=w-m,C=_-v,T=A-y,S=x*C*T,I=new Float32Array(S),D=new Float32Array(S*3);for(let Y=0;Y<S;++Y)I[Y]=o;const B=new Cs(S),Q=new Cs(S*3);for(let Y=0;Y<l;++Y){const fe=t[Y*6]-o,k=t[Y*6+1]-o,N=t[Y*6+2]-o,F=t[Y*6+3]+o,H=t[Y*6+4]+o,$=t[Y*6+5]+o,te=Math.floor(fe*a),se=Math.floor(k*a),ae=Math.floor(N*a),E=Math.ceil(F*a),L=Math.ceil(H*a),G=Math.ceil($*a),K=E-te,oe=L-se,ge=G-ae;uc.fromArray(n,Y*9),td.fromArray(n,Y*9+3),nd.fromArray(n,Y*9+6),Hx.fromArray(e,Y*9),Gx.fromArray(e,Y*9+3),$x.fromArray(e,Y*9+6),id.addVectors(Hx,Gx).add($x).multiplyScalar(1/3),fm.subVectors(td,uc),pm.subVectors(nd,uc),Wx.subVectors(nd,td);for(let xe=0;xe<K;++xe){const le=xe+te-m,_e=c+le*o;for(let ce=0;ce<oe;++ce){const R=ce+se-v,P=h+R*o;for(let j=0;j<ge;++j){const re=j+ae-y,pe=d+re*o,be=le*C*T+R*T+re;sd.set(_e,P,pe),$F(jx,sd,uc,td,nd,fm,pm,Wx),mm.subVectors(jx,sd);const Se=mm.length();if(!(Se>o)){B.set(be),Se<=I[be]&&(I[be]=Se,D[be*3]=id.x,D[be*3+1]=id.y,D[be*3+2]=id.z);for(let we=0;we<3;++we){const ue=mm.getComponent(we);if(ue<0||ue>o)continue;const Be=be*3+we;if(Q.get(Be))continue;gm.set(0,0,0),gm.setComponent(we,1);const He=WF(sd,gm,uc,fm,pm);He<0||He>o||Q.set(Be)}}}}}}const U=new Cs(I.length),z=[0],q=C*T,ee=T,J=1,X=[-q,+q,-ee,+ee,-J,+J],V=[0,0,1,1,2,2];for(;z.length;){const Y=z.pop();if(Y==null)break;if(B.get(Y)){let fe=!1;for(let k=0;k<6;++k){const N=X[k],F=Y+N;F<0||F>=S||U.get(F)||!B.get(F)||(Q.get((N>0?Y:F)*3+V[k])?fe=!0:(U.set(F),z.push(F)))}fe&&U.set(Y)}else{U.set(Y);for(let fe=0;fe<6;++fe){const k=Y+X[fe];k<0||k>=S||U.get(k)||(U.set(k),z.push(k))}}}for(let Y=0;Y<S;++Y)U.get(Y)||(I[Y]=-I[Y]);const Z=[],de=[];for(let Y=0;Y<x-1;++Y){const fe=c+Y*o;for(let k=0;k<C-1;++k){const N=h+k*o;for(let F=0;F<T-1;++F){const H=d+F*o;I0(Z,null,de,fe,N,H,o,I,D,Y*C*T+k*T+F,(Y+1)*C*T+k*T+F,(Y+1)*C*T+k*T+(F+1),Y*C*T+k*T+(F+1),Y*C*T+(k+1)*T+F,(Y+1)*C*T+(k+1)*T+F,(Y+1)*C*T+(k+1)*T+(F+1),Y*C*T+(k+1)*T+(F+1))}}}return{position:new Float32Array(Z),color:new Float32Array(de)}}u(RA,"voxelizeRemesh");G6(RA,"voxelizeRemesh");var $6=Object.defineProperty,ut=u((n,e)=>$6(n,"name",{value:e,configurable:!0}),"__name");const yd=".doll",vm={description:"Model",accept:{"application/figure-doll-editor":[yd]}},Xx="figure-doll-editor-options";var W6=Pt({components:{ColorPicker:mM,FullscreenLoading:JL,InputBoolean:Kg,InputNumber:jo,LabelRange:_F,ModelNodeProperties:M5,ModelTree:H5,PopupDialog:Of,PopupMenu:u0,PopupMenuItem:CA,QuadView:d6,SidePanel:y6},setup(){const n=ze(),e=ze(),t=new Yg(function(){var k;(k=e.value)==null||k.update()}),i=ze({showTools:!0,showModelTree:!0,showProperties:!0,showStatusBar:!0,modelTreePanelWidth:200,modelNodePropertiesPanelWidth:200,colorPanelX:250,colorPanelY:50}),s=ze(!1),r=ze(null);let o=null;const a=at(function(){var N;const k=(N=e.value)==null?void 0:N.model;return k?k.selected.length===0?vS.filter(F=>F.canBeRoot?F.unique?!k.nodes.find(H=>H.type===F.name):!0:!1):k.selected.length>1?[]:d0(k.getSelectedNodes()[0]).filter(F=>F.showInList):[]}),l=at(function(){var N;const k=(N=e.value)==null?void 0:N.model;return k?k.getSelectedNodes().filter(F=>!fi(F.type).fixed).length:!1});si([r,()=>{var k,N;return(N=(k=e.value)==null?void 0:k.history)==null?void 0:N.dirty}],function([k,N]){k&&k.endsWith(yd)&&(k=k.substring(0,k.length-yd.length)),document.title=(k||"Untitled")+(N?"*":"")+" - Figure Doll Editor"},{immediate:!0}),si([i,()=>{var k;return(k=e.value)==null?void 0:k.options}],function(){var k;localStorage.setItem(Xx,JSON.stringify({ui:i.value,options:(k=e.value)==null?void 0:k.options}))},{deep:!0}),rf(async function(){"showOpenFilePicker"in window||await TA(`This application is only available in Chrome or Edge.
Cannot open or save files in the current browser.`)});function c(){var k;(k=n.value)==null||k.focus()}u(c,"focus"),ut(c,"focus");function h(k,N,F,H,$){e.value=new Tu(k,N,F,H,$);try{const te=localStorage.getItem(Xx);if(te){const se=JSON.parse(te);if("ui"in se&&Object.assign(i.value,se.ui),"options"in se){Object.assign(e.value.options,se.options);for(let ae in e.value.options.tools){const E=e.value.options.tools[ae],L=e.value.tools.find(G=>G.constructor.name===ae);if(L)for(let G in E)L[G]=E[G]}}}}catch(te){console.error(te)}t.start(),window.ctx=e.value.readonlyRef()}u(h,"onCanvasMounted"),ut(h,"onCanvasMounted");function d(){var k;(k=e.value)==null||k.dispose(),e.value=void 0}u(d,"onBeforeCanvasUnmount"),ut(d,"onBeforeCanvasUnmount");function f(k){var N;((N=k==null?void 0:k.target)==null?void 0:N.tagName)!=="INPUT"&&(e.value.history.undo(),c())}u(f,"onUndo"),ut(f,"onUndo");function p(k){var N;((N=k==null?void 0:k.target)==null?void 0:N.tagName)!=="INPUT"&&(e.value.history.redo(),c())}u(p,"onRedo"),ut(p,"onRedo");async function g(){return e.value.history.dirty?await EA(`Unsaved changes will be lost.
Are you sure you want to continue?`):!0}u(g,"historyConfirm"),ut(g,"historyConfirm");async function m(){await g()&&(r.value=null,o=null,e.value.reset(),c(),e.value.statusBarMessage="")}u(m,"onNew"),ut(m,"onNew");async function v(){try{[o]=await showOpenFilePicker({types:[vm],multiple:!1})}catch{return}if(await g())try{e.value.statusBarMessage="Loading...",s.value=!0,await Bi();const k=await o.getFile();r.value=k.name;const N=new Wd(new Uint8Array(await k.arrayBuffer())).read();e.value.load(N),c(),e.value.statusBarMessage=""}catch(k){console.error(k),e.value.statusBarMessage="Failed to open file."}finally{s.value=!1}}u(v,"onOpen"),ut(v,"onOpen");async function y(){let k=null;try{[k]=await showOpenFilePicker({types:[vm],multiple:!1})}catch{return}try{const N=e.value;N.statusBarMessage="Loading...",s.value=!0,await Bi();const F=await k.getFile();r.value=F.name;const H=new Wd(new Uint8Array(await F.arrayBuffer())).read(),$={};let te=N.history.getNextNodeId()+1;for(let E of H.nodes)$[E.id]=te++;const se={};for(let E of H.nodes)se[E.id]={originId:E.id,type:E.type,data:E.data,expanded:E.expanded,instanceId:E.instanceId?$[E.instanceId]:0};const ae=[];for(let E of H.nodes)if(E.parentId){const L=se[E.parentId];L.children=L.children||[],L.children.push(se[E.id])}else ae.push(se[E.id]);for(let E of ae)N.history.createNode(E);c(),N.statusBarMessage=""}catch(N){console.error(N),e.value.statusBarMessage="Failed to import file."}finally{s.value=!1}}u(y,"onImport"),ut(y,"onImport");async function w(k){function N(){const H=e.value.readonlyRef(),$=new Xc;$.traverse=function(te){se($);function se(ae){for(let E of ae.children)E.visible&&(te(E),se(E))}u(se,"traverseVisible"),ut(se,"traverseVisible")};for(let te of H.model.nodes)if(te.has(Ce)){const se=te.value(Ce);se&&$.children.push(se)}return $}u(N,"getExportScene"),ut(N,"getExportScene");async function F(H){try{e.value.statusBarMessage="Exporting...",s.value=!0,await Bi(),await H(async function(){e.value.statusBarMessage="Writing files...",await Bi()}),e.value.statusBarMessage="File exported."}catch($){console.error($),e.value.statusBarMessage="Failed to export."}finally{s.value=!1}}switch(u(F,"process"),ut(F,"process"),k){case"obj":try{const H=await showSaveFilePicker({types:[{accept:{"application/object":[".obj"]}}]});await F(async function($){const te=N(),se=new dM().parse(te);await $();const ae=await H.createWritable({keepExistingData:!1});await ae.write(se),await ae.close()})}catch{return}break;case"glb":try{const H=await showSaveFilePicker({types:[{accept:{"application/object":[".glb"]}}]});await F(async function($){const te=N(),ae=await new Ef().parseAsync(te,{onlyVisible:!0,binary:!0});await $();const E=await H.createWritable({keepExistingData:!1});await E.write(ae),await E.close()})}catch{return}break;default:return}}u(w,"onExport"),ut(w,"onExport");async function _(k){k!=null&&k.shiftKey?await A():(o?await x():await A(),c())}u(_,"onSave"),ut(_,"onSave");async function A(){try{o=await showSaveFilePicker({types:[vm],suggestedName:r.value?r.value+yd:void 0})}catch{return}const k=await o.getFile();r.value=k.name,await x(),c()}u(A,"onSaveAs"),ut(A,"onSaveAs");async function x(){if(!!o)try{e.value.statusBarMessage="Saving...",s.value=!0,await Bi();const k=await o.createWritable({keepExistingData:!1}),N=new U1().write(e.value).getBytes();e.value.statusBarMessage="Writing files...",await Bi(),await k.write(N),await k.close(),e.value.history.save(),e.value.statusBarMessage="File saved."}catch{e.value.statusBarMessage="Failed to save file."}finally{s.value=!1}}u(x,"saveFile"),ut(x,"saveFile");function C(k){const N=e.value,H=N.views[N.mainViewIndex].camera;let $=H.alpha,te=H.beta;switch(k){case"front":$=0,te=-Math.PI/2,Math.abs($-H.alpha)<1e-8&&Math.abs(te-H.beta)<1e-8&&($=0,te=+Math.PI/2);break;case"back":$=0,te=+Math.PI/2,Math.abs($-H.alpha)<1e-8&&Math.abs(te-H.beta)<1e-8&&($=0,te=-Math.PI/2);break;case"top":$=-Math.PI/2,te=-Math.PI/2,Math.abs($-H.alpha)<1e-8&&Math.abs(te-H.beta)<1e-8&&($=+Math.PI/2,te=-Math.PI/2);break;case"bottom":$=+Math.PI/2,te=-Math.PI/2,Math.abs($-H.alpha)<1e-8&&Math.abs(te-H.beta)<1e-8&&($=-Math.PI/2,te=-Math.PI/2);break;case"right":$=0,te=0,Math.abs($-H.alpha)<1e-8&&Math.abs(te-H.beta)<1e-8&&($=0,te=Math.PI);break;case"left":$=0,te=Math.PI,Math.abs($-H.alpha)<1e-8&&Math.abs(te-H.beta)<1e-8&&($=0,te=0);break}const se=$-H.alpha,ae=te-H.beta;pM(function(E){H.alpha=$-se*(1-E),H.beta=te-ae*(1-E)},100)}u(C,"onSetView"),ut(C,"onSetView");function T(k,N,F){e.value.history.setValue(k,N,F)}u(T,"onSetValue"),ut(T,"onSetValue");function S(k,N){k=Ze(k);const F=e.value,H=Ze(F.model);let $=H.selected.map(ae=>H.getNode(ae));const te=N==="before"||N==="after"?k.parent:k;$=$.filter(ae=>!(ae.parent&&$.includes(ae.parent)||fi(ae.type).fixed));for(let ae of $)if(!se(te,ae))return;for(let ae of $){const E=F.options.keepTransformUnchangedWhileMoving;N==="before"||N==="after"?F.history.moveNode(ae,te,k,N==="after",E):F.history.moveNode(ae,te,null,N==="atLast",E)}function se(ae,E){const L=fi(E.type);if(!ae)return L.canBeRoot;if(!ae.isValidChild(E.type))return!1;for(;ae;ae=ae.parent)if(ae===E)return!1;return!0}u(se,"isValidChild"),ut(se,"isValidChild")}u(S,"onMoveNode"),ut(S,"onMoveNode");function I(k){const N=e.value.model,F=N.selected[0];N.selected=[];const H={type:k,parentId:F},$=fi(k);$.defaultData&&(H.data=$.defaultData),$.defaultChildren&&(H.children=$.defaultChildren),e.value.history.createNode(H),c()}u(I,"onAddNode"),ut(I,"onAddNode");function D(k){var H;if((k==null?void 0:k.key)==="Backspace"||((H=k==null?void 0:k.target)==null?void 0:H.tagName)==="INPUT"||!e.value.tool.enableDefaultDeleteShortcut&&(k==null?void 0:k.key)==="Delete")return;const F=e.value.model.getTopmostSelectedNodes();for(let $ of F)fi($.type).fixed||e.value.history.removeNode($.id);c()}u(D,"onDelete"),ut(D,"onDelete");function B(k){e.value.nextFrameEnd(function(){e.value.model.selected=k})}u(B,"onSelect"),ut(B,"onSelect");function Q(k){for(let N of k)e.value.history.setValue(N.node,N.type,N.value)}u(Q,"onSetNodesProperties"),ut(Q,"onSetNodesProperties");function U(k){if(!k)return;const N=new b;if(fu(N,k.getWorldMatrix()),k.has(Ce)){const F=k.value(Ce);if(F){const H=F.geometry;H&&(H.boundingSphere||H.computeBoundingSphere(),N.copy(H.boundingSphere.center),N.applyMatrix4(k.getWorldMatrix()))}}for(let F of e.value.views)F.camera.target.copy(N)}u(U,"onFocus"),ut(U,"onFocus");async function z(k){const N=await q(k);if(N)for(let F of N)e.value.history.removeNode(F.id);c()}u(z,"onCut"),ut(z,"onCut");async function q(k){var H;if(((H=k==null?void 0:k.target)==null?void 0:H.tagName)==="INPUT")return;const N=e.value.model.getTopmostSelectedNodes(),F=[];for(let $ of N)F.push(await $.toJson());return await navigator.clipboard.writeText(JSON.stringify(F)),c(),N}u(q,"onCopy"),ut(q,"onCopy");async function ee(k){var N;if(!(k&&"target"in k&&((N=k.target)==null?void 0:N.tagName)==="INPUT"))try{let F=u(function(L){L=L.filter(G=>G.instanceId?te.isNodeExists(G.instanceId)?G.type===G.type:!1:!0);for(let G of L)G.children&&(G.children=F(G.children));return L},"filterInvalidInstancedNodes");ut(F,"filterInvalidInstancedNodes");let H=JSON.parse(await navigator.clipboard.readText());if(!Array.isArray(H))return;async function $(L){for(let G of L){for(let K in G.data){const oe=Ii(K);let ge=G.data[K];oe.dataType===Xe.BYTES&&(ge=new Uint8Array(await i0(ge))),oe.deserialize&&(ge=oe.deserialize(ge)),G.data[K]=ge}G.children&&await $(G.children),G.selected=!1}}u($,"convertJsonToRealDataType"),ut($,"convertJsonToRealDataType"),await $(H);const te=e.value.model;let se=k instanceof Do?k:void 0;se||te.forEach(L=>{if(te.selected.includes(L.id))return se=L,!1}),H=F(H);let ae=!1;const E=e.value.history;for(let L of H)if(L.selected=!0,se){if(se.isValidChild(L.type)){const G={...L};G.parentId=se.id,E.createNode(G),ae=!0}}else if(fi(L.type).canBeRoot){const K={...L};K.parentId=void 0,E.createNode(K),ae=!0}ae&&(te.selected=[]),c()}catch(F){console.error(F);return}}u(ee,"onPaste"),ut(ee,"onPaste");function J(k){k=Ze(k);const N=e.value,F=k.parent;let H=[],$=[];switch(k.type){case"Shape":{const te=k.get(di);if(te.throttleHash){const E=N.throttleTasks.get(te.throttleHash);E&&(E.callback(),N.throttleTasks.delete(te.throttleHash)),te.throttleHash=""}const ae=k.value(Ce).geometry;H=[new Float32Array(ae.getAttribute("position").array)],ae.hasAttribute("color")?$=[new Float32Array(ae.getAttribute("color").array)]:$=[null]}break;default:{if(!k.has(Ce))return;const te=k.value(Ce);if(!te)return;const se=[];if(te.geometry)se.push(te.geometry);else for(let G of te.children)G.geometry&&se.push(G.geometry);const ae=new b,E=new b,L=new b;for(let G of se){if(!G.isBufferGeometry)continue;const K=G.getAttribute("position");if(!K)continue;const oe=G.index;if(oe){const ge=new Float32Array(oe.count*3),xe=new Float32Array(oe.count*3);for(let le=0,_e=oe.count;le<_e;le+=3){ae.fromBufferAttribute(K,oe.getX(le)),E.fromBufferAttribute(K,oe.getX(le+1)),L.fromBufferAttribute(K,oe.getX(le+2));const ce=le*3;ge[ce]=ae.x,ge[ce+1]=ae.y,ge[ce+2]=ae.z,ge[ce+3]=E.x,ge[ce+4]=E.y,ge[ce+5]=E.z,ge[ce+6]=L.x,ge[ce+7]=L.y,ge[ce+8]=L.z}if(G.hasAttribute("color")){const le=G.getAttribute("color");for(let _e=0,ce=oe.count;_e<ce;_e+=3){ae.fromBufferAttribute(le,oe.getX(_e)),E.fromBufferAttribute(le,oe.getX(_e+1)),L.fromBufferAttribute(le,oe.getX(_e+2));const R=_e*3;xe[R]=ae.x,xe[R+1]=ae.y,xe[R+2]=ae.z,xe[R+3]=E.x,xe[R+4]=E.y,xe[R+5]=E.z,xe[R+6]=L.x,xe[R+7]=L.y,xe[R+8]=L.z}}else for(let le=0,_e=xe.length;le<_e;++le)xe[le]=1;ge.length&&(H.push(ge),$.push(xe))}else if(K.array.length)if(H.push(new Float32Array(K.array)),G.hasAttribute("color")){const ge=G.getAttribute("color");$.push(new Float32Array(ge.array))}else $.push(null)}}break}if(!!H.length){for(let te=0,se=H.length;te<se;++te){const ae=H[te],E=$[te];N.history.createNode({type:"Clay",parentId:F?F.id:0,data:{[Xt.name]:k.value(Xt),[je.name]:k.cloneValue(je),[bt.name]:k.cloneValue(bt),[Bt.name]:k.cloneValue(Bt),[Tn.name]:ae,[ls.name]:E||void 0}})}N.history.removeNode(k.id)}}u(J,"onConvertToClay"),ut(J,"onConvertToClay");const X=at(function(){const k=e.value;if(!k)return!1;const N=k.model.selected[0];return N?k.model.getNode(N).type==="Clay":!1});async function V(){var te;const k=(te=e.value)==null?void 0:te.readonlyRef();if(!k)return;const N=k.model.selected[0];if(!N)return;const F=k.model.getNode(N),$=F.get(Ce).mesh;if(!!$)try{s.value=!0,await Bi(),await new Promise(function(ae){setTimeout(ae,50)});const se=RA($.aPosition,$.aColor,$.triBox,$.octree.box,k.options.remeshVoxelSize);k.history.enableMerge=!1,k.history.setValue(F,Tn,se.position,"remesh-position"),k.history.setValue(F,ls,se.color,"remesh-color")}finally{s.value=!1}}u(V,"onRemesh"),ut(V,"onRemesh");function Z(k,N){var le;const F=e.value;k=Ze(k);const H=new Me,$=new Me,te=new b,se=new b;if(N!=="none"){switch(H.copy(k.getParentWorldMatrix()),$.copy(H).invert(),N){case"x":te.set(1,0,0);break;case"y":te.set(0,1,0);break;case"z":te.set(0,0,1);break}te.transformDirection(H),se.applyMatrix4(H)}const ae=new b,E=new Ve,L=new b,G=new Me,K=new b,oe=new Ve;function ge(_e,ce,R,P,j){const re={type:_e.type,instanceId:_e.instanceId||_e.id};re.data=_e.getComponentData(!0);let pe;if(N!=="none"){if(ce=ce,R=R,P=P,re.data[Ys.name]=new b().copy(te).transformDirection($),ae.set(0,0,0),E.set(0,0,0,1),L.set(1,1,1),_e.has(je)){const Se=re.data[je.name];Se.applyMatrix4(ce),Se.sub(se),Se.reflect(te),Se.add(se),Se.applyMatrix4(P),ae.copy(Se)}if(_e.has(bt)){const Se=re.data[bt.name];E.setFromEuler(Se);const we=Xm(K,E);K.applyMatrix4(ce),K.sub(se),K.reflect(te),K.add(se),K.applyMatrix4(P),K.normalize(),E.setFromAxisAngle(K,-we),Se.setFromQuaternion(E)}if(_e.has(vt)){if(N==="x")throw new Error("Flipping on x axis will broke the ik chain");const Se=_e.get(vt);ae.copy(Se.start),ae.applyMatrix4(ce),ae.sub(se),ae.reflect(te),ae.add(se),ae.applyMatrix4(P);let we=Xm(K,Se.quaternion);K.applyMatrix4(ce),K.sub(se),K.reflect(te),K.add(se),K.applyMatrix4(P),K.normalize(),E.setFromAxisAngle(K,-we);const ue=re.data[jn.name];j?(oe.multiplyQuaternions(j,E),ue.setFromQuaternion(oe)):ue.setFromQuaternion(E)}_e.has(Bt)&&L.setScalar(_e.value(Bt)),G.compose(ae,E,L),R=new Me().multiplyMatrices(R,G),P=new Me().copy(R).invert(),ce=_e.getWorldMatrix(),pe=new Ve().copy(E).invert()}re.children=[];let be;for(let Se of _e.children){const we=ge(Se,ce,R,P,be);be=we.invQuat1,re.children.push(we.creationInfo)}return re.expanded=_e.expanded,re.selected=!1,{creationInfo:re,invQuat1:pe}}u(ge,"makeNewNode"),ut(ge,"makeNewNode");const xe=ge(k,H,H,$).creationInfo;xe.parentId=(le=k.parent)==null?void 0:le.id,xe.selected=!0,F.model.selected=[],F.history.createNode(xe)}u(Z,"onCreateInstance"),ut(Z,"onCreateInstance");function de(k){const N=e.value,F=N.model,H=N.views[N.mainViewIndex];H.zoomLevel=k.zoomLevel,H.camera.alpha=k.alpha,H.camera.beta=k.beta,H.camera.target.set(k.target[0],k.target[1],k.target[2]),F.cameraPerspective=k.perspective,F.cameraFov=k.fov}u(de,"onLoadCamera"),ut(de,"onLoadCamera");function Y(k){e.value.model.cameras.splice(k,1),e.value.history.dirty=!0}u(Y,"onDeleteCamera"),ut(Y,"onDeleteCamera");function fe(){const k=e.value,N=k.model,F=k.views[k.mainViewIndex];N.cameras.push({name:new Date().toISOString().replace("T"," ").replace(/\.[0-9]+Z/,""),zoomLevel:F.zoomLevel,alpha:F.camera.alpha,beta:F.camera.beta,target:[F.camera.target.x,F.camera.target.y,F.camera.target.z],perspective:N.cameraPerspective,fov:N.cameraFov}),k.history.dirty=!0}return u(fe,"onSaveCamera"),ut(fe,"onSaveCamera"),{dom:n,editorCtx:e,fullscreenLoading:s,uiOptions:i,validChildNodeDefs:a,canDelete:l,canRemesh:X,onCanvasMounted:h,onBeforeCanvasUnmount:d,onUndo:f,onRedo:p,onNew:m,onOpen:v,onImport:y,onExport:w,onSave:_,onSaveAs:A,onSetView:C,onSetValue:T,onMoveNode:S,onAddNode:I,onDelete:D,onSelect:B,onSetNodesProperties:Q,onFocus:U,onCut:z,onCopy:q,onPaste:ee,onConvertToClay:J,onRemesh:V,onCreateInstance:Z,onLoadCamera:de,onDeleteCamera:Y,onSaveCamera:fe}}}),j6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFBJREFUOI1jYBgF6OA/FFBsCDJNH0P+owGyDaGKS3BppqohuAxjwmUgIyMjIy4+0QYhA0YoICmqsXkNH5skw8gyBJ8GQobgDEB0jYQCe/ABAKCQl4Lg46L9AAAAAElFTkSuQmCC",X6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFRJREFUOI3lkjsOACAIQ8V4/yvXCUIMH4kbdqWUl5Qx2oq8AQCky0Syv6IQbaweEZNn9uZkmSIxJQBo4pkiXqpxkFl/JK+QMhE3df5YuX4r5InoI21GkSwM7aEiTgAAAABJRU5ErkJggg==",Y6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAC5JREFUOI1jYBgFwxT8////PyE1TNSyjGoGMeKSwOcdRkZGnPrwgqEZRqOAjgAAfNwMAvOaLCwAAAAASUVORK5CYII=",q6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAADBJREFUOI1jYBgFgwf8hwKKDcHGJtsQYgxjIsuWkWUQXkCVWEM2gGJDRgEDAwMDAwA87SfhU+Y3UgAAAABJRU5ErkJggg==",K6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAACJJREFUOI1jYBgFo2AQAUZcEv////+PUxMjI059o2AUUAIA4coEAgSS2PIAAAAASUVORK5CYII=",Z6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAEVJREFUOI1jYBi2gBGf5P////+jKGZkxKseqwHohuATJ8oVxKphIsp0UgHRzsailmouGnwGYYDBFWvINpKaIGmbRYYHAAC8Mj/Vvda64QAAAABJRU5ErkJggg==",Q6="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAGFJREFUOI3dk0EOwCAIBMH0/19er4ILKqaHlqOsw6hR5LelWRMATFg1zNOGB0ybCLBVICwzgaplQCubzOodox2Ta1AGESHPz+7JQwDArz2V6VtGoxUziQYffZHQpnCCD1UHNO0sGtTVHO8AAAAASUVORK5CYII=";const En=u(n=>(ko("data-v-17249f4d"),n=n(),zo(),n),"_withScopeId"),J6={class:"toolbar"},eV={class:"properties"},tV={class:"cols",style:{"align-items":"center","margin-bottom":"8px"}},nV=En(()=>he("div",{style:{"margin-right":"4px"}},"FOV",-1)),iV={class:"camera-list"},sV={class:"item"},rV=["onClick"],oV=En(()=>he("div",{class:"properties"},[he("div",{style:{"margin-bottom":"4px","font-weight":"bold"}}," Figure Doll Editor 20230111 (Developing) "),he("div",null,"Author: x6udpngx")],-1)),aV=En(()=>he("div",{class:"separator"},null,-1)),lV=En(()=>he("img",{src:j6,alt:""},null,-1)),cV=[lV],uV=En(()=>he("img",{src:X6,alt:""},null,-1)),hV=[uV],dV={key:1,class:"button-group cols",style:{"margin-right":"6px"},title:"Direction"},fV=En(()=>he("img",{src:Y6,alt:""},null,-1)),pV=[fV],mV=En(()=>he("img",{src:q6,alt:""},null,-1)),gV=[mV],vV=En(()=>he("img",{src:K6,alt:""},null,-1)),yV=[vV],_V=En(()=>he("option",{value:"no"},"No Symm",-1)),xV=En(()=>he("option",{value:"x"},"Symm X",-1)),bV=En(()=>he("option",{value:"y"},"Symm Y",-1)),wV=En(()=>he("option",{value:"z"},"Symm Z",-1)),MV=[_V,xV,bV,wV],SV={class:"properties"},AV={class:"property inline"},CV=En(()=>he("label",null,"Voxel size",-1)),TV=En(()=>he("span",null,"\xA0m",-1)),EV=En(()=>he("div",{class:"fill"},null,-1)),PV={class:"button-group cols"},IV=En(()=>he("img",{src:Z6,alt:""},null,-1)),RV=[IV],DV=En(()=>he("img",{src:Q6,alt:""},null,-1)),LV=[DV],FV={class:"cols fill"},OV={key:0,class:"tools scrollable"},NV={class:"scroll"},kV={key:0},zV={key:0},BV=["title","onClick"],UV=["src"],VV={key:0,class:"rows",style:{width:"100%",height:"100%"}},HV=["disabled"],GV={key:0,class:"status-bar cols"},$V=En(()=>he("div",{class:"fill"},null,-1));function WV(n,e,t,i,s,r){var w,_,A;const o=Yt("popup-menu-item"),a=Yt("popup-menu"),l=Yt("input-number"),c=Yt("input-boolean"),h=Yt("label-range"),d=Yt("model-tree"),f=Yt("side-panel"),p=Yt("model-node-properties"),g=Yt("quad-view"),m=Yt("color-picker"),v=Yt("popup-dialog"),y=Yt("fullscreen-loading");return Te(),Oe(Tt,null,[he("div",{class:"container rows",tabindex:"0",onKeydown:[e[36]||(e[36]=In(on((...x)=>n.onUndo&&n.onUndo(...x),["ctrl"]),["z"])),e[37]||(e[37]=In(on((...x)=>n.onRedo&&n.onRedo(...x),["ctrl"]),["y"])),e[38]||(e[38]=In(on((...x)=>n.onOpen&&n.onOpen(...x),["ctrl","prevent"]),["o"])),e[39]||(e[39]=In(on((...x)=>n.onSave&&n.onSave(...x),["ctrl","prevent"]),["s"])),e[40]||(e[40]=In(on((...x)=>n.onCut&&n.onCut(...x),["ctrl"]),["x"])),e[41]||(e[41]=In(on((...x)=>n.onCopy&&n.onCopy(...x),["ctrl"]),["c"])),e[42]||(e[42]=In(on((...x)=>n.onPaste&&n.onPaste(...x),["ctrl"]),["v"])),e[43]||(e[43]=In((...x)=>n.onDelete&&n.onDelete(...x),["delete"]))],onContextmenu:e[44]||(e[44]=on(()=>{},["prevent"])),ref:"dom"},[he("div",J6,[n.editorCtx?(Te(),Oe(Tt,{key:0},[Pe(a,{title:"File"},{default:kt(()=>[Pe(o,{title:"New",onClick:n.onNew},null,8,["onClick"]),Pe(o,{title:"Open",popup:"",hotkey:"Ctrl+O",onClick:n.onOpen},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Save",hotkey:"Ctrl+S",onClick:n.onSave},null,8,["onClick"]),Pe(o,{title:"Save As",popup:"",hotkey:"Shirt+Ctrl+S",onClick:n.onSaveAs},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Import",popup:"",onClick:n.onImport},null,8,["onClick"]),Pe(o,{title:"Export"},{default:kt(()=>[Pe(a,null,{default:kt(()=>[Pe(o,{title:"glTF 2.0 Binary (.glb)",popup:"",onClick:e[0]||(e[0]=x=>n.onExport("glb"))}),Pe(o,{title:"Wavefront (.obj)",popup:"",onClick:e[1]||(e[1]=x=>n.onExport("obj"))})]),_:1})]),_:1})]),_:1}),Pe(a,{title:"Edit"},{default:kt(()=>[Pe(o,{title:"Undo",hotkey:"Ctrl+Z",onClick:n.onUndo},null,8,["onClick"]),Pe(o,{title:"Redo",hotkey:"Ctrl+Y",onClick:n.onRedo},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Cut",hotkey:"Ctrl+X",onClick:n.onCut},null,8,["onClick"]),Pe(o,{title:"Copy",hotkey:"Ctrl+C",onClick:n.onCopy},null,8,["onClick"]),Pe(o,{title:"Paste",hotkey:"Ctrl+V",onClick:n.onPaste},null,8,["onClick"]),Pe(o,{title:"Delete",hotkey:"Delete",onClick:n.onDelete},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Options"},{default:kt(()=>[Pe(a,null,{default:kt(()=>[Pe(o,{title:"Keep World Position Unchanged When Moving Nodes",onClick:e[2]||(e[2]=x=>n.editorCtx.options.keepTransformUnchangedWhileMoving=!n.editorCtx.options.keepTransformUnchangedWhileMoving),checked:n.editorCtx.options.keepTransformUnchangedWhileMoving},null,8,["checked"]),Pe(o,{sep:""}),Pe(o,{title:"Use Local Space for Transform Control",onClick:e[3]||(e[3]=x=>n.editorCtx.options.useLocalSpaceForTransformControl=!n.editorCtx.options.useLocalSpaceForTransformControl),checked:n.editorCtx.options.useLocalSpaceForTransformControl},null,8,["checked"]),Pe(o,{sep:""}),Pe(o,{title:"Allow Modification of Joint Length When Modifying IK Bindings",onClick:e[4]||(e[4]=x=>n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk=!n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk),checked:n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk},null,8,["checked"]),Pe(o,{title:"Keep Internal Object Position Unchanged When Modifying IK Bindings",onClick:e[5]||(e[5]=x=>n.editorCtx.options.keepInternalTransformWhenBindingIk=!n.editorCtx.options.keepInternalTransformWhenBindingIk),checked:n.editorCtx.options.keepInternalTransformWhenBindingIk},null,8,["checked"])]),_:1})]),_:1})]),_:1}),Pe(a,{title:"View"},{default:kt(()=>[Pe(o,{title:"Window"},{default:kt(()=>[Pe(a,null,{default:kt(()=>[Pe(o,{title:"Tools",checked:n.uiOptions.showTools,onClick:e[6]||(e[6]=x=>n.uiOptions.showTools=!n.uiOptions.showTools)},null,8,["checked"]),Pe(o,{title:"Nodes Panel",checked:n.uiOptions.showModelTree,onClick:e[7]||(e[7]=x=>n.uiOptions.showModelTree=!n.uiOptions.showModelTree)},null,8,["checked"]),Pe(o,{title:"Properties Panel",checked:n.uiOptions.showProperties,onClick:e[8]||(e[8]=x=>n.uiOptions.showProperties=!n.uiOptions.showProperties)},null,8,["checked"]),Pe(o,{title:"Status Bar",checked:n.uiOptions.showStatusBar,onClick:e[9]||(e[9]=x=>n.uiOptions.showStatusBar=!n.uiOptions.showStatusBar)},null,8,["checked"])]),_:1})]),_:1}),Pe(o,{sep:""}),Pe(o,{title:"Outline Selected",checked:n.editorCtx.options.outlineSelected,onClick:e[10]||(e[10]=x=>n.editorCtx.options.outlineSelected=!n.editorCtx.options.outlineSelected)},null,8,["checked"]),Pe(o,{title:"Grids",checked:n.editorCtx.options.showGrids,onClick:e[11]||(e[11]=x=>n.editorCtx.options.showGrids=!n.editorCtx.options.showGrids)},null,8,["checked"]),Pe(o,{title:"Lights",checked:n.editorCtx.options.showLightHelpers,onClick:e[12]||(e[12]=x=>n.editorCtx.options.showLightHelpers=!n.editorCtx.options.showLightHelpers)},null,8,["checked"]),Pe(o,{title:"IK Joints",checked:n.editorCtx.options.showIkBones,onClick:e[13]||(e[13]=x=>n.editorCtx.options.showIkBones=!n.editorCtx.options.showIkBones)},null,8,["checked"]),Pe(o,{title:"Quad Views",checked:n.editorCtx.options.quadView,onClick:e[14]||(e[14]=x=>n.editorCtx.options.quadView=!n.editorCtx.options.quadView)},null,8,["checked"])]),_:1}),Pe(a,{title:"Camera","dynamic-size":""},{default:kt(()=>[he("div",eV,[he("div",tV,[nV,Pe(l,{style:{width:"4em","margin-right":"8px"},min:4,max:90,value:n.editorCtx.model.cameraFov,onInput:e[15]||(e[15]=x=>n.editorCtx.model.cameraFov=x)},null,8,["value"]),Pe(c,{label:"Orthographic",value:!n.editorCtx.model.cameraPerspective,onInput:e[16]||(e[16]=x=>n.editorCtx.model.cameraPerspective=!x)},null,8,["value"])]),he("div",iV,[(Te(!0),Oe(Tt,null,Pr(n.editorCtx.model.cameras,x=>(Te(),Oe("div",sV,[he("div",{class:"name normal-button",onClick:C=>n.onLoadCamera(x)},$n(x.name),9,rV),he("button",{class:"icon-button",onClick:e[17]||(e[17]=C=>n.onDeleteCamera(n.i))},"\xD7")]))),256))]),he("button",{class:"normal-button",style:{width:"100%","margin-top":"4px"},onClick:e[18]||(e[18]=(...x)=>n.onSaveCamera&&n.onSaveCamera(...x))}," Save Current ")])]),_:1}),Pe(a,{title:"About","dynamic-size":""},{default:kt(()=>[oV]),_:1}),n.editorCtx.tool.sculpt?(Te(),Oe(Tt,{key:0},[aV,Pe(h,{style:{"margin-right":"6px"},value:n.editorCtx.tool.brushRadius,"onUpdate:value":e[19]||(e[19]=x=>n.editorCtx.tool.brushRadius=x),label:"Radius",min:1,max:200,step:1,"fraction-digits":0},null,8,["value"]),n.editorCtx.tool.hasHardness?(Te(),Wt(h,{key:0,style:{"margin-right":"6px"},value:n.editorCtx.tool.brushHardness,"onUpdate:value":e[20]||(e[20]=x=>n.editorCtx.tool.brushHardness=x),label:"Hardness",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"])):tt("",!0),Pe(h,{style:{"margin-right":"2px"},value:n.editorCtx.tool.brushStrength,"onUpdate:value":e[21]||(e[21]=x=>n.editorCtx.tool.brushStrength=x),label:"Strength",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"]),he("button",{class:qt(["normal-button toggle-button",{active:n.editorCtx.options.enablePressure}]),title:"Enable Tablet Pressure Sensitivity",style:{"margin-right":"6px",padding:"0"},onClick:e[22]||(e[22]=x=>n.editorCtx.options.enablePressure=!n.editorCtx.options.enablePressure)},cV,2),he("button",{class:qt(["normal-button toggle-button",{active:n.editorCtx.tool.frontFacesOnly}]),title:"Front Faces Only",style:{"margin-right":"6px",padding:"0"},onClick:e[23]||(e[23]=x=>n.editorCtx.tool.frontFacesOnly=!n.editorCtx.tool.frontFacesOnly)},hV,2),n.editorCtx.tool.hasDirection?(Te(),Oe("div",dV,[he("button",{class:qt(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===1}]),style:{padding:"0"},onClick:e[24]||(e[24]=x=>n.editorCtx.tool.brushDirection=1)},pV,2),n.editorCtx.tool.hasThirdDirection?(Te(),Oe("button",{key:0,class:qt(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===0}]),style:{padding:"0"},onClick:e[25]||(e[25]=x=>n.editorCtx.tool.brushDirection=0)},gV,2)):tt("",!0),he("button",{class:qt(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===-1}]),style:{padding:"0"},onClick:e[26]||(e[26]=x=>n.editorCtx.tool.brushDirection=-1)},yV,2)])):tt("",!0),Ea(he("select",{"onUpdate:modelValue":e[27]||(e[27]=x=>n.editorCtx.options.symmetry=x),title:"Symmetry",style:{"margin-right":"6px"}},MV,512),[[QC,n.editorCtx.options.symmetry]]),n.canRemesh?(Te(),Wt(a,{key:2,title:"Remesh","class-name":"normal-button dropdown"},{default:kt(()=>[he("div",SV,[he("div",AV,[CV,Pe(l,{class:"value",style:{width:"6em"},min:1e-4,max:1,value:n.editorCtx.options.remeshVoxelSize,onInput:e[28]||(e[28]=x=>n.editorCtx.options.remeshVoxelSize=x)},null,8,["min","value"]),TV]),he("button",{class:"normal-button",style:{width:"100%"},onClick:e[29]||(e[29]=(...x)=>n.onRemesh&&n.onRemesh(...x))}," Remesh ")])]),_:1})):tt("",!0)],64)):tt("",!0),EV,he("div",PV,[he("button",{class:qt(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="solid"}]),title:"Shadow Off",style:{padding:"0"},onClick:e[30]||(e[30]=x=>n.editorCtx.options.shadingMode="solid")},RV,2),he("button",{class:qt(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="rendered"}]),title:"Shadow On",style:{padding:"0"},onClick:e[31]||(e[31]=x=>n.editorCtx.options.shadingMode="rendered")},LV,2)])],64)):tt("",!0)]),he("div",FV,[n.uiOptions.showTools?(Te(),Oe("div",OV,[he("div",NV,[n.editorCtx?(Te(),Oe("div",kV,[(Te(!0),Oe(Tt,null,Pr(n.editorCtx.tools,x=>(Te(),Oe(Tt,null,[x.sep?(Te(),Oe("hr",zV)):tt("",!0),x.sep?tt("",!0):(Te(),Oe("button",{key:1,class:qt(["tool icon-button toggle-button",{active:n.editorCtx.tool===x}]),title:x.label,onClick:C=>n.editorCtx.tool=x},[he("img",{src:x.icon,alt:""},null,8,UV)],10,BV))],64))),256))])):tt("",!0)])])):tt("",!0),n.uiOptions.showModelTree?(Te(),Wt(f,{key:1,direction:"right",width:n.uiOptions.modelTreePanelWidth,"onUpdate:width":e[34]||(e[34]=x=>n.uiOptions.modelTreePanelWidth=x),style:{"border-left":"none"}},{default:kt(()=>[n.editorCtx?(Te(),Oe("div",VV,[he("div",{class:"toolbar",onClick:e[33]||(e[33]=on(x=>n.onSelect([]),["self"]))},[Pe(a,{title:"Add",disabled:!n.validChildNodeDefs.length},{default:kt(()=>[(Te(!0),Oe(Tt,null,Pr(n.validChildNodeDefs,x=>(Te(),Wt(o,{key:x.name,title:x.label,icon:x.icon,onClick:C=>n.onAddNode(x.name)},null,8,["title","icon","onClick"]))),128))]),_:1},8,["disabled"]),he("button",{disabled:!n.canDelete,onClick:e[32]||(e[32]=(...x)=>n.onDelete&&n.onDelete(...x))}," Delete ",8,HV)]),Pe(d,{class:"fill",model:n.editorCtx.model,onSelect:n.onSelect,onSetValue:n.onSetValue,onMoveNode:n.onMoveNode,onFocus:n.onFocus,onCut:n.onCut,onCopy:n.onCopy,onPaste:n.onPaste,onDelete:n.onDelete,onConvertToClay:n.onConvertToClay,onCreateInstance:n.onCreateInstance},null,8,["model","onSelect","onSetValue","onMoveNode","onFocus","onCut","onCopy","onPaste","onDelete","onConvertToClay","onCreateInstance"])])):tt("",!0)]),_:1},8,["width"])):tt("",!0),n.uiOptions.showProperties?(Te(),Wt(f,{key:2,direction:"right",width:n.uiOptions.modelNodePropertiesPanelWidth,"onUpdate:width":e[35]||(e[35]=x=>n.uiOptions.modelNodePropertiesPanelWidth=x),style:{"border-left":"none"}},{default:kt(()=>[n.editorCtx?(Te(),Wt(p,{key:0,"editor-context":n.editorCtx,onSetData:n.onSetNodesProperties},null,8,["editor-context","onSetData"])):tt("",!0)]),_:1},8,["width"])):tt("",!0),Pe(g,{class:"fill","editor-context":n.editorCtx,"quad-view":(_=(w=n.editorCtx)==null?void 0:w.options)==null?void 0:_.quadView,"main-view":(A=n.editorCtx)==null?void 0:A.mainViewIndex,onMounted:n.onCanvasMounted,onBeforeUnmount:n.onBeforeCanvasUnmount,onSetView:n.onSetView},null,8,["editor-context","quad-view","main-view","onMounted","onBeforeUnmount","onSetView"])]),n.uiOptions.showStatusBar&&n.editorCtx?(Te(),Oe("div",GV,[he("div",null,$n(n.editorCtx.statusBarMessage),1),$V,he("div",null,"FPS: "+$n(n.editorCtx.fps),1)])):tt("",!0)],544),n.editorCtx?(Te(),Wt(v,{key:0,title:"Color",visible:n.editorCtx.tool.hasColor,x:n.uiOptions.colorPanelX,"onUpdate:x":e[46]||(e[46]=x=>n.uiOptions.colorPanelX=x),y:n.uiOptions.colorPanelY,"onUpdate:y":e[47]||(e[47]=x=>n.uiOptions.colorPanelY=x)},{default:kt(()=>[Pe(m,{value:n.editorCtx.options.paintColor,"onUpdate:value":e[45]||(e[45]=x=>n.editorCtx.options.paintColor=x),"color-box":""},null,8,["value"])]),_:1},8,["visible","x","y"])):tt("",!0),n.fullscreenLoading?(Te(),Wt(y,{key:1})):tt("",!0)],64)}u(WV,"_sfc_render");var jV=Ft(W6,[["render",WV],["__scopeId","data-v-17249f4d"]]);const XV=_3({history:OT(),routes:[{path:"/",component:jV}]}),V1=jb(pT),DA=new Eg;V1.config.errorHandler=function(n,e,t){DA.dispatch(n)};V1.provide("errorSignal",DA);V1.use(XV).mount("#app");
//# sourceMappingURL=index.d456af0e.js.map
