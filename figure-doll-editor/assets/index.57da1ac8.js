var FA=Object.defineProperty;var rN=(n,e,t)=>e in n?FA(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var u=(n,e)=>FA(n,"name",{value:e,configurable:!0});var A=(n,e,t)=>(rN(n,typeof e!="symbol"?e+"":e,t),t);const oN=u(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}u(t,"getFetchOpts");function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}u(s,"processPreload")},"polyfill");oN();function hb(n,e){const t=Object.create(null),s=n.split(",");for(let i=0;i<s.length;i++)t[s[i]]=!0;return e?i=>!!t[i.toLowerCase()]:i=>!!t[i]}u(hb,"makeMap");function On(n){if(ot(n)){const e={};for(let t=0;t<n.length;t++){const s=n[t],i=Yn(s)?uN(s):On(s);if(i)for(const r in i)e[r]=i[r]}return e}else{if(Yn(n))return n;if(mn(n))return n}}u(On,"normalizeStyle");const aN=/;(?![^(]*\))/g,lN=/:([^]+)/,cN=/\/\*.*?\*\//gs;function uN(n){const e={};return n.replace(cN,"").split(aN).forEach(t=>{if(t){const s=t.split(lN);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}u(uN,"parseStringStyle");function pn(n){let e="";if(Yn(n))e=n;else if(ot(n))for(let t=0;t<n.length;t++){const s=pn(n[t]);s&&(e+=s+" ")}else if(mn(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}u(pn,"normalizeClass");const hN="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",dN=hb(hN);function gT(n){return!!n||n===""}u(gT,"includeBooleanAttr");function fN(n,e){if(n.length!==e.length)return!1;let t=!0;for(let s=0;t&&s<n.length;s++)t=w0(n[s],e[s]);return t}u(fN,"looseCompareArrays");function w0(n,e){if(n===e)return!0;let t=zA(n),s=zA(e);if(t||s)return t&&s?n.getTime()===e.getTime():!1;if(t=_f(n),s=_f(e),t||s)return n===e;if(t=ot(n),s=ot(e),t||s)return t&&s?fN(n,e):!1;if(t=mn(n),s=mn(e),t||s){if(!t||!s)return!1;const i=Object.keys(n).length,r=Object.keys(e).length;if(i!==r)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=e.hasOwnProperty(o);if(a&&!l||!a&&l||!w0(n[o],e[o]))return!1}}return String(n)===String(e)}u(w0,"looseEqual");function pN(n,e){return n.findIndex(t=>w0(t,e))}u(pN,"looseIndexOf");const un=u(n=>Yn(n)?n:n==null?"":ot(n)||mn(n)&&(n.toString===_T||!yt(n.toString))?JSON.stringify(n,vT,2):String(n),"toDisplayString"),vT=u((n,e)=>e&&e.__v_isRef?vT(n,e.value):wu(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,i])=>(t[`${s} =>`]=i,t),{})}:A0(e)?{[`Set(${e.size})`]:[...e.values()]}:mn(e)&&!ot(e)&&!bT(e)?String(e):e,"replacer"),yn={},bu=[],vr=u(()=>{},"NOOP"),mN=u(()=>!1,"NO"),gN=/^on[^a-z]/,x0=u(n=>gN.test(n),"isOn"),db=u(n=>n.startsWith("onUpdate:"),"isModelListener"),ni=Object.assign,fb=u((n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},"remove"),vN=Object.prototype.hasOwnProperty,Gt=u((n,e)=>vN.call(n,e),"hasOwn"),ot=Array.isArray,wu=u(n=>Jf(n)==="[object Map]","isMap"),A0=u(n=>Jf(n)==="[object Set]","isSet"),zA=u(n=>Jf(n)==="[object Date]","isDate"),yt=u(n=>typeof n=="function","isFunction"),Yn=u(n=>typeof n=="string","isString"),_f=u(n=>typeof n=="symbol","isSymbol"),mn=u(n=>n!==null&&typeof n=="object","isObject"),yT=u(n=>mn(n)&&yt(n.then)&&yt(n.catch),"isPromise"),_T=Object.prototype.toString,Jf=u(n=>_T.call(n),"toTypeString"),yN=u(n=>Jf(n).slice(8,-1),"toRawType"),bT=u(n=>Jf(n)==="[object Object]","isPlainObject"),pb=u(n=>Yn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,"isIntegerKey"),Pg=hb(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),M0=u(n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},"cacheStringFunction"),_N=/-(\w)/g,qr=M0(n=>n.replace(_N,(e,t)=>t?t.toUpperCase():"")),bN=/\B([A-Z])/g,dc=M0(n=>n.replace(bN,"-$1").toLowerCase()),S0=M0(n=>n.charAt(0).toUpperCase()+n.slice(1)),G1=M0(n=>n?`on${S0(n)}`:""),bf=u((n,e)=>!Object.is(n,e),"hasChanged"),Rg=u((n,e)=>{for(let t=0;t<n.length;t++)n[t](e)},"invokeArrayFns"),jg=u((n,e,t)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value:t})},"def"),wf=u(n=>{const e=parseFloat(n);return isNaN(e)?n:e},"toNumber");let BA;const wN=u(()=>BA||(BA=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{}),"getGlobalThis");let Nr;class wT{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Nr,!e&&Nr&&(this.index=(Nr.scopes||(Nr.scopes=[])).push(this)-1)}run(e){if(this.active){const t=Nr;try{return Nr=this,e()}finally{Nr=t}}}on(){Nr=this}off(){Nr=this.parent}stop(e){if(this.active){let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0,this.active=!1}}}u(wT,"EffectScope");function xN(n,e=Nr){e&&e.active&&e.effects.push(n)}u(xN,"recordEffectScope");const mb=u(n=>{const e=new Set(n);return e.w=0,e.n=0,e},"createDep"),xT=u(n=>(n.w&Fa)>0,"wasTracked"),AT=u(n=>(n.n&Fa)>0,"newTracked"),AN=u(({deps:n})=>{if(n.length)for(let e=0;e<n.length;e++)n[e].w|=Fa},"initDepMarkers"),MN=u(n=>{const{deps:e}=n;if(e.length){let t=0;for(let s=0;s<e.length;s++){const i=e[s];xT(i)&&!AT(i)?i.delete(n):e[t++]=i,i.w&=~Fa,i.n&=~Fa}e.length=t}},"finalizeDepMarkers"),h_=new WeakMap;let Wd=0,Fa=1;const d_=30;let fr;const Gl=Symbol(""),f_=Symbol("");class C0{constructor(e,t=null,s){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,xN(this,s)}run(){if(!this.active)return this.fn();let e=fr,t=Da;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=fr,fr=this,Da=!0,Fa=1<<++Wd,Wd<=d_?AN(this):UA(this),this.fn()}finally{Wd<=d_&&MN(this),Fa=1<<--Wd,fr=this.parent,Da=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){fr===this?this.deferStop=!0:this.active&&(UA(this),this.onStop&&this.onStop(),this.active=!1)}}u(C0,"ReactiveEffect");function UA(n){const{deps:e}=n;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(n);e.length=0}}u(UA,"cleanupEffect");let Da=!0;const MT=[];function fh(){MT.push(Da),Da=!1}u(fh,"pauseTracking");function ph(){const n=MT.pop();Da=n===void 0?!0:n}u(ph,"resetTracking");function Ni(n,e,t){if(Da&&fr){let s=h_.get(n);s||h_.set(n,s=new Map);let i=s.get(t);i||s.set(t,i=mb()),ST(i)}}u(Ni,"track");function ST(n,e){let t=!1;Wd<=d_?AT(n)||(n.n|=Fa,t=!xT(n)):t=!n.has(fr),t&&(n.add(fr),fr.deps.push(n))}u(ST,"trackEffects");function Fo(n,e,t,s,i,r){const o=h_.get(n);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(t==="length"&&ot(n)){const l=wf(s);o.forEach((c,h)=>{(h==="length"||h>=l)&&a.push(c)})}else switch(t!==void 0&&a.push(o.get(t)),e){case"add":ot(n)?pb(t)&&a.push(o.get("length")):(a.push(o.get(Gl)),wu(n)&&a.push(o.get(f_)));break;case"delete":ot(n)||(a.push(o.get(Gl)),wu(n)&&a.push(o.get(f_)));break;case"set":wu(n)&&a.push(o.get(Gl));break}if(a.length===1)a[0]&&p_(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);p_(mb(l))}}u(Fo,"trigger");function p_(n,e){const t=ot(n)?n:[...n];for(const s of t)s.computed&&$A(s);for(const s of t)s.computed||$A(s)}u(p_,"triggerEffects");function $A(n,e){(n!==fr||n.allowRecurse)&&(n.scheduler?n.scheduler():n.run())}u($A,"triggerEffect");const SN=hb("__proto__,__v_isRef,__isVue"),CT=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(_f)),CN=gb(),EN=gb(!1,!0),TN=gb(!0),VA=PN();function PN(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const s=rt(this);for(let r=0,o=this.length;r<o;r++)Ni(s,"get",r+"");const i=s[e](...t);return i===-1||i===!1?s[e](...t.map(rt)):i}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){fh();const s=rt(this)[e].apply(this,t);return ph(),s}}),n}u(PN,"createArrayInstrumentations");function gb(n=!1,e=!1){return u(function(s,i,r){if(i==="__v_isReactive")return!n;if(i==="__v_isReadonly")return n;if(i==="__v_isShallow")return e;if(i==="__v_raw"&&r===(n?e?WN:IT:e?RT:PT).get(s))return s;const o=ot(s);if(!n&&o&&Gt(VA,i))return Reflect.get(VA,i,r);const a=Reflect.get(s,i,r);return(_f(i)?CT.has(i):SN(i))||(n||Ni(s,"get",i),e)?a:ks(a)?o&&pb(i)?a:a.value:mn(a)?n?DT(a):Oo(a):a},"get")}u(gb,"createGetter");const RN=ET(),IN=ET(!0);function ET(n=!1){return u(function(t,s,i,r){let o=t[s];if(Pu(o)&&ks(o)&&!ks(i))return!1;if(!n&&(!Xg(i)&&!Pu(i)&&(o=rt(o),i=rt(i)),!ot(t)&&ks(o)&&!ks(i)))return o.value=i,!0;const a=ot(t)&&pb(s)?Number(s)<t.length:Gt(t,s),l=Reflect.set(t,s,i,r);return t===rt(r)&&(a?bf(i,o)&&Fo(t,"set",s,i):Fo(t,"add",s,i)),l},"set")}u(ET,"createSetter");function DN(n,e){const t=Gt(n,e);n[e];const s=Reflect.deleteProperty(n,e);return s&&t&&Fo(n,"delete",e,void 0),s}u(DN,"deleteProperty");function LN(n,e){const t=Reflect.has(n,e);return(!_f(e)||!CT.has(e))&&Ni(n,"has",e),t}u(LN,"has");function ON(n){return Ni(n,"iterate",ot(n)?"length":Gl),Reflect.ownKeys(n)}u(ON,"ownKeys");const TT={get:CN,set:RN,deleteProperty:DN,has:LN,ownKeys:ON},kN={get:TN,set(n,e){return!0},deleteProperty(n,e){return!0}},NN=ni({},TT,{get:EN,set:IN}),vb=u(n=>n,"toShallow"),E0=u(n=>Reflect.getPrototypeOf(n),"getProto");function xp(n,e,t=!1,s=!1){n=n.__v_raw;const i=rt(n),r=rt(e);t||(e!==r&&Ni(i,"get",e),Ni(i,"get",r));const{has:o}=E0(i),a=s?vb:t?bb:xf;if(o.call(i,e))return a(n.get(e));if(o.call(i,r))return a(n.get(r));n!==i&&n.get(e)}u(xp,"get$1");function Ap(n,e=!1){const t=this.__v_raw,s=rt(t),i=rt(n);return e||(n!==i&&Ni(s,"has",n),Ni(s,"has",i)),n===i?t.has(n):t.has(n)||t.has(i)}u(Ap,"has$1");function Mp(n,e=!1){return n=n.__v_raw,!e&&Ni(rt(n),"iterate",Gl),Reflect.get(n,"size",n)}u(Mp,"size");function GA(n){n=rt(n);const e=rt(this);return E0(e).has.call(e,n)||(e.add(n),Fo(e,"add",n,n)),this}u(GA,"add$4");function HA(n,e){e=rt(e);const t=rt(this),{has:s,get:i}=E0(t);let r=s.call(t,n);r||(n=rt(n),r=s.call(t,n));const o=i.call(t,n);return t.set(n,e),r?bf(e,o)&&Fo(t,"set",n,e):Fo(t,"add",n,e),this}u(HA,"set$1");function WA(n){const e=rt(this),{has:t,get:s}=E0(e);let i=t.call(e,n);i||(n=rt(n),i=t.call(e,n)),s&&s.call(e,n);const r=e.delete(n);return i&&Fo(e,"delete",n,void 0),r}u(WA,"deleteEntry");function jA(){const n=rt(this),e=n.size!==0,t=n.clear();return e&&Fo(n,"clear",void 0,void 0),t}u(jA,"clear");function Sp(n,e){return u(function(s,i){const r=this,o=r.__v_raw,a=rt(o),l=e?vb:n?bb:xf;return!n&&Ni(a,"iterate",Gl),o.forEach((c,h)=>s.call(i,l(c),l(h),r))},"forEach")}u(Sp,"createForEach");function Cp(n,e,t){return function(...s){const i=this.__v_raw,r=rt(i),o=wu(r),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=i[n](...s),h=t?vb:e?bb:xf;return!e&&Ni(r,"iterate",l?f_:Gl),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[h(d[0]),h(d[1])]:h(d),done:f}},[Symbol.iterator](){return this}}}}u(Cp,"createIterableMethod");function Zo(n){return function(...e){return n==="delete"?!1:this}}u(Zo,"createReadonlyMethod");function FN(){const n={get(r){return xp(this,r)},get size(){return Mp(this)},has:Ap,add:GA,set:HA,delete:WA,clear:jA,forEach:Sp(!1,!1)},e={get(r){return xp(this,r,!1,!0)},get size(){return Mp(this)},has:Ap,add:GA,set:HA,delete:WA,clear:jA,forEach:Sp(!1,!0)},t={get(r){return xp(this,r,!0)},get size(){return Mp(this,!0)},has(r){return Ap.call(this,r,!0)},add:Zo("add"),set:Zo("set"),delete:Zo("delete"),clear:Zo("clear"),forEach:Sp(!0,!1)},s={get(r){return xp(this,r,!0,!0)},get size(){return Mp(this,!0)},has(r){return Ap.call(this,r,!0)},add:Zo("add"),set:Zo("set"),delete:Zo("delete"),clear:Zo("clear"),forEach:Sp(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{n[r]=Cp(r,!1,!1),t[r]=Cp(r,!0,!1),e[r]=Cp(r,!1,!0),s[r]=Cp(r,!0,!0)}),[n,t,e,s]}u(FN,"createInstrumentations");const[zN,BN,UN,$N]=FN();function yb(n,e){const t=e?n?$N:UN:n?BN:zN;return(s,i,r)=>i==="__v_isReactive"?!n:i==="__v_isReadonly"?n:i==="__v_raw"?s:Reflect.get(Gt(t,i)&&i in s?t:s,i,r)}u(yb,"createInstrumentationGetter");const VN={get:yb(!1,!1)},GN={get:yb(!1,!0)},HN={get:yb(!0,!1)},PT=new WeakMap,RT=new WeakMap,IT=new WeakMap,WN=new WeakMap;function jN(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}u(jN,"targetTypeMap");function XN(n){return n.__v_skip||!Object.isExtensible(n)?0:jN(yN(n))}u(XN,"getTargetType");function Oo(n){return Pu(n)?n:_b(n,!1,TT,VN,PT)}u(Oo,"reactive");function YN(n){return _b(n,!1,NN,GN,RT)}u(YN,"shallowReactive");function DT(n){return _b(n,!0,kN,HN,IT)}u(DT,"readonly");function _b(n,e,t,s,i){if(!mn(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const r=i.get(n);if(r)return r;const o=XN(n);if(o===0)return n;const a=new Proxy(n,o===2?s:t);return i.set(n,a),a}u(_b,"createReactiveObject");function xu(n){return Pu(n)?xu(n.__v_raw):!!(n&&n.__v_isReactive)}u(xu,"isReactive");function Pu(n){return!!(n&&n.__v_isReadonly)}u(Pu,"isReadonly");function Xg(n){return!!(n&&n.__v_isShallow)}u(Xg,"isShallow");function LT(n){return xu(n)||Pu(n)}u(LT,"isProxy");function rt(n){const e=n&&n.__v_raw;return e?rt(e):n}u(rt,"toRaw");function OT(n){return jg(n,"__v_skip",!0),n}u(OT,"markRaw");const xf=u(n=>mn(n)?Oo(n):n,"toReactive"),bb=u(n=>mn(n)?DT(n):n,"toReadonly");function kT(n){Da&&fr&&(n=rt(n),ST(n.dep||(n.dep=mb())))}u(kT,"trackRefValue");function NT(n,e){n=rt(n),n.dep&&p_(n.dep)}u(NT,"triggerRefValue");function ks(n){return!!(n&&n.__v_isRef===!0)}u(ks,"isRef");function Ne(n){return FT(n,!1)}u(Ne,"ref");function qN(n){return FT(n,!0)}u(qN,"shallowRef");function FT(n,e){return ks(n)?n:new zT(n,e)}u(FT,"createRef");class zT{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:rt(e),this._value=t?e:xf(e)}get value(){return kT(this),this._value}set value(e){const t=this.__v_isShallow||Xg(e)||Pu(e);e=t?e:rt(e),bf(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:xf(e),NT(this))}}u(zT,"RefImpl");function Au(n){return ks(n)?n.value:n}u(Au,"unref");const KN={get:(n,e,t)=>Au(Reflect.get(n,e,t)),set:(n,e,t,s)=>{const i=n[e];return ks(i)&&!ks(t)?(i.value=t,!0):Reflect.set(n,e,t,s)}};function BT(n){return xu(n)?n:new Proxy(n,KN)}u(BT,"proxyRefs");var UT;class $T{constructor(e,t,s,i){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[UT]=!1,this._dirty=!0,this.effect=new C0(e,()=>{this._dirty||(this._dirty=!0,NT(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!i,this.__v_isReadonly=s}get value(){const e=rt(this);return kT(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}u($T,"ComputedRefImpl");UT="__v_isReadonly";function ZN(n,e,t=!1){let s,i;const r=yt(n);return r?(s=n,i=vr):(s=n.get,i=n.set),new $T(s,i,r||!i,t)}u(ZN,"computed$1");function La(n,e,t,s){let i;try{i=s?n(...s):n()}catch(r){T0(r,e,t)}return i}u(La,"callWithErrorHandling");function yr(n,e,t,s){if(yt(n)){const r=La(n,e,t,s);return r&&yT(r)&&r.catch(o=>{T0(o,e,t)}),r}const i=[];for(let r=0;r<n.length;r++)i.push(yr(n[r],e,t,s));return i}u(yr,"callWithAsyncErrorHandling");function T0(n,e,t,s=!0){const i=e?e.vnode:null;if(e){let r=e.parent;const o=e.proxy,a=t;for(;r;){const c=r.ec;if(c){for(let h=0;h<c.length;h++)if(c[h](n,o,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){La(l,null,10,[n,o,a]);return}}QN(n,t,i,s)}u(T0,"handleError");function QN(n,e,t,s=!0){console.error(n)}u(QN,"logError");let Af=!1,m_=!1;const Os=[];let Ur=0;const Mu=[];let Eo=null,Dl=0;const VT=Promise.resolve();let wb=null;function Ri(n){const e=wb||VT;return n?e.then(this?n.bind(this):n):e}u(Ri,"nextTick");function JN(n){let e=Ur+1,t=Os.length;for(;e<t;){const s=e+t>>>1;Mf(Os[s])<n?e=s+1:t=s}return e}u(JN,"findInsertionIndex");function xb(n){(!Os.length||!Os.includes(n,Af&&n.allowRecurse?Ur+1:Ur))&&(n.id==null?Os.push(n):Os.splice(JN(n.id),0,n),GT())}u(xb,"queueJob");function GT(){!Af&&!m_&&(m_=!0,wb=VT.then(WT))}u(GT,"queueFlush");function e4(n){const e=Os.indexOf(n);e>Ur&&Os.splice(e,1)}u(e4,"invalidateJob");function t4(n){ot(n)?Mu.push(...n):(!Eo||!Eo.includes(n,n.allowRecurse?Dl+1:Dl))&&Mu.push(n),GT()}u(t4,"queuePostFlushCb");function XA(n,e=Af?Ur+1:0){for(;e<Os.length;e++){const t=Os[e];t&&t.pre&&(Os.splice(e,1),e--,t())}}u(XA,"flushPreFlushCbs");function HT(n){if(Mu.length){const e=[...new Set(Mu)];if(Mu.length=0,Eo){Eo.push(...e);return}for(Eo=e,Eo.sort((t,s)=>Mf(t)-Mf(s)),Dl=0;Dl<Eo.length;Dl++)Eo[Dl]();Eo=null,Dl=0}}u(HT,"flushPostFlushCbs");const Mf=u(n=>n.id==null?1/0:n.id,"getId"),n4=u((n,e)=>{const t=Mf(n)-Mf(e);if(t===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return t},"comparator");function WT(n){m_=!1,Af=!0,Os.sort(n4);const e=vr;try{for(Ur=0;Ur<Os.length;Ur++){const t=Os[Ur];t&&t.active!==!1&&La(t,null,14)}}finally{Ur=0,Os.length=0,HT(),Af=!1,wb=null,(Os.length||Mu.length)&&WT()}}u(WT,"flushJobs");function s4(n,e,...t){if(n.isUnmounted)return;const s=n.vnode.props||yn;let i=t;const r=e.startsWith("update:"),o=r&&e.slice(7);if(o&&o in s){const h=`${o==="modelValue"?"model":o}Modifiers`,{number:d,trim:f}=s[h]||yn;f&&(i=t.map(p=>Yn(p)?p.trim():p)),d&&(i=t.map(wf))}let a,l=s[a=G1(e)]||s[a=G1(qr(e))];!l&&r&&(l=s[a=G1(dc(e))]),l&&yr(l,n,6,i);const c=s[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,yr(c,n,6,i)}}u(s4,"emit$1");function jT(n,e,t=!1){const s=e.emitsCache,i=s.get(n);if(i!==void 0)return i;const r=n.emits;let o={},a=!1;if(!yt(n)){const l=u(c=>{const h=jT(c,e,!0);h&&(a=!0,ni(o,h))},"extendEmits");!t&&e.mixins.length&&e.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!r&&!a?(mn(n)&&s.set(n,null),null):(ot(r)?r.forEach(l=>o[l]=null):ni(o,r),mn(n)&&s.set(n,o),o)}u(jT,"normalizeEmitsOptions");function P0(n,e){return!n||!x0(e)?!1:(e=e.slice(2).replace(/Once$/,""),Gt(n,e[0].toLowerCase()+e.slice(1))||Gt(n,dc(e))||Gt(n,e))}u(P0,"isEmitListener");let Ns=null,R0=null;function Yg(n){const e=Ns;return Ns=n,R0=n&&n.type.__scopeId||null,e}u(Yg,"setCurrentRenderingInstance");function Ga(n){R0=n}u(Ga,"pushScopeId");function Ha(){R0=null}u(Ha,"popScopeId");function bt(n,e=Ns,t){if(!e||n._n)return n;const s=u((...i)=>{s._d&&sM(-1);const r=Yg(e);let o;try{o=n(...i)}finally{Yg(r),s._d&&sM(1)}return o},"renderFnWithContext");return s._n=!0,s._c=!0,s._d=!0,s}u(bt,"withCtx");function H1(n){const{type:e,vnode:t,proxy:s,withProxy:i,props:r,propsOptions:[o],slots:a,attrs:l,emit:c,render:h,renderCache:d,data:f,setupState:p,ctx:g,inheritAttrs:m}=n;let v,y;const b=Yg(n);try{if(t.shapeFlag&4){const w=i||s;v=zr(h.call(w,w,d,r,p,f,g)),y=l}else{const w=e;v=zr(w.length>1?w(r,{attrs:l,slots:a,emit:c}):w(r,null)),y=e.props?l:i4(l)}}catch(w){af.length=0,T0(w,n,1),v=we(Ba)}let _=v;if(y&&m!==!1){const w=Object.keys(y),{shapeFlag:x}=_;w.length&&x&7&&(o&&w.some(db)&&(y=r4(y,o)),_=Ru(_,y))}return t.dirs&&(_=Ru(_),_.dirs=_.dirs?_.dirs.concat(t.dirs):t.dirs),t.transition&&(_.transition=t.transition),v=_,Yg(b),v}u(H1,"renderComponentRoot");const i4=u(n=>{let e;for(const t in n)(t==="class"||t==="style"||x0(t))&&((e||(e={}))[t]=n[t]);return e},"getFunctionalFallthrough"),r4=u((n,e)=>{const t={};for(const s in n)(!db(s)||!(s.slice(9)in e))&&(t[s]=n[s]);return t},"filterModelListeners");function o4(n,e,t){const{props:s,children:i,component:r}=n,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?YA(s,o,c):!!o;if(l&8){const h=e.dynamicProps;for(let d=0;d<h.length;d++){const f=h[d];if(o[f]!==s[f]&&!P0(c,f))return!0}}}else return(i||a)&&(!a||!a.$stable)?!0:s===o?!1:s?o?YA(s,o,c):!0:!!o;return!1}u(o4,"shouldUpdateComponent");function YA(n,e,t){const s=Object.keys(e);if(s.length!==Object.keys(n).length)return!0;for(let i=0;i<s.length;i++){const r=s[i];if(e[r]!==n[r]&&!P0(t,r))return!0}return!1}u(YA,"hasPropsChanged");function a4({vnode:n,parent:e},t){for(;e&&e.subTree===n;)(n=e.vnode).el=t,e=e.parent}u(a4,"updateHOCHostEl");const l4=u(n=>n.__isSuspense,"isSuspense");function c4(n,e){e&&e.pendingBranch?ot(n)?e.effects.push(...n):e.effects.push(n):t4(n)}u(c4,"queueEffectWithSuspense");function Hl(n,e){if(Cs){let t=Cs.provides;const s=Cs.parent&&Cs.parent.provides;s===t&&(t=Cs.provides=Object.create(s)),t[n]=e}}u(Hl,"provide");function Es(n,e,t=!1){const s=Cs||Ns;if(s){const i=s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides;if(i&&n in i)return i[n];if(arguments.length>1)return t&&yt(e)?e.call(s.proxy):e}}u(Es,"inject$1");const Ep={};function Ts(n,e,t){return XT(n,e,t)}u(Ts,"watch$1");function XT(n,e,{immediate:t,deep:s,flush:i,onTrack:r,onTrigger:o}=yn){const a=Cs;let l,c=!1,h=!1;if(ks(n)?(l=u(()=>n.value,"getter"),c=Xg(n)):xu(n)?(l=u(()=>n,"getter"),s=!0):ot(n)?(h=!0,c=n.some(_=>xu(_)||Xg(_)),l=u(()=>n.map(_=>{if(ks(_))return _.value;if(xu(_))return zl(_);if(yt(_))return La(_,a,2)}),"getter")):yt(n)?e?l=u(()=>La(n,a,2),"getter"):l=u(()=>{if(!(a&&a.isUnmounted))return d&&d(),yr(n,a,3,[f])},"getter"):l=vr,e&&s){const _=l;l=u(()=>zl(_()),"getter")}let d,f=u(_=>{d=y.onStop=()=>{La(_,a,4)}},"onCleanup"),p;if(Cf)if(f=vr,e?t&&yr(e,a,3,[l(),h?[]:void 0,f]):l(),i==="sync"){const _=e5();p=_.__watcherHandles||(_.__watcherHandles=[])}else return vr;let g=h?new Array(n.length).fill(Ep):Ep;const m=u(()=>{if(!!y.active)if(e){const _=y.run();(s||c||(h?_.some((w,x)=>bf(w,g[x])):bf(_,g)))&&(d&&d(),yr(e,a,3,[_,g===Ep?void 0:h&&g[0]===Ep?[]:g,f]),g=_)}else y.run()},"job");m.allowRecurse=!!e;let v;i==="sync"?v=m:i==="post"?v=u(()=>ci(m,a&&a.suspense),"scheduler"):(m.pre=!0,a&&(m.id=a.uid),v=u(()=>xb(m),"scheduler"));const y=new C0(l,v);e?t?m():g=y.run():i==="post"?ci(y.run.bind(y),a&&a.suspense):y.run();const b=u(()=>{y.stop(),a&&a.scope&&fb(a.scope.effects,y)},"unwatch");return p&&p.push(b),b}u(XT,"doWatch");function u4(n,e,t){const s=this.proxy,i=Yn(n)?n.includes(".")?YT(s,n):()=>s[n]:n.bind(s,s);let r;yt(e)?r=e:(r=e.handler,t=e);const o=Cs;Iu(this);const a=XT(i,r.bind(s),t);return o?Iu(o):Wl(),a}u(u4,"instanceWatch");function YT(n,e){const t=e.split(".");return()=>{let s=n;for(let i=0;i<t.length&&s;i++)s=s[t[i]];return s}}u(YT,"createPathGetter");function zl(n,e){if(!mn(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),ks(n))zl(n.value,e);else if(ot(n))for(let t=0;t<n.length;t++)zl(n[t],e);else if(A0(n)||wu(n))n.forEach(t=>{zl(t,e)});else if(bT(n))for(const t in n)zl(n[t],e);return n}u(zl,"traverse");function Ht(n){return yt(n)?{setup:n,name:n.name}:n}u(Ht,"defineComponent");const sf=u(n=>!!n.type.__asyncLoader,"isAsyncWrapper"),qT=u(n=>n.type.__isKeepAlive,"isKeepAlive");function h4(n,e){KT(n,"a",e)}u(h4,"onActivated");function d4(n,e){KT(n,"da",e)}u(d4,"onDeactivated");function KT(n,e,t=Cs){const s=n.__wdc||(n.__wdc=()=>{let i=t;for(;i;){if(i.isDeactivated)return;i=i.parent}return n()});if(I0(e,s,t),t){let i=t.parent;for(;i&&i.parent;)qT(i.parent.vnode)&&f4(s,e,t,i),i=i.parent}}u(KT,"registerKeepAliveHook");function f4(n,e,t,s){const i=I0(e,n,s,!0);L0(()=>{fb(s[e],i)},t)}u(f4,"injectToKeepAliveRoot");function I0(n,e,t=Cs,s=!1){if(t){const i=t[n]||(t[n]=[]),r=e.__weh||(e.__weh=(...o)=>{if(t.isUnmounted)return;fh(),Iu(t);const a=yr(e,t,n,o);return Wl(),ph(),a});return s?i.unshift(r):i.push(r),r}}u(I0,"injectHook");const jo=u(n=>(e,t=Cs)=>(!Cf||n==="sp")&&I0(n,(...s)=>e(...s),t),"createHook"),p4=jo("bm"),D0=jo("m"),m4=jo("bu"),g4=jo("u"),Wa=jo("bum"),L0=jo("um"),v4=jo("sp"),y4=jo("rtg"),_4=jo("rtc");function b4(n,e=Cs){I0("ec",n,e)}u(b4,"onErrorCaptured");function gs(n,e){const t=Ns;if(t===null)return n;const s=N0(t)||t.proxy,i=n.dirs||(n.dirs=[]);for(let r=0;r<e.length;r++){let[o,a,l,c=yn]=e[r];o&&(yt(o)&&(o={mounted:o,updated:o}),o.deep&&zl(a),i.push({dir:o,instance:s,value:a,oldValue:void 0,arg:l,modifiers:c}))}return n}u(gs,"withDirectives");function nl(n,e,t,s){const i=n.dirs,r=e&&e.dirs;for(let o=0;o<i.length;o++){const a=i[o];r&&(a.oldValue=r[o].value);let l=a.dir[s];l&&(fh(),yr(l,t,8,[n.el,a,n,e]),ph())}}u(nl,"invokeDirectiveHook");const Ab="components";function ln(n,e){return QT(Ab,n,!0,e)||n}u(ln,"resolveComponent");const ZT=Symbol();function w4(n){return Yn(n)?QT(Ab,n,!1)||n:n||ZT}u(w4,"resolveDynamicComponent");function QT(n,e,t=!0,s=!1){const i=Ns||Cs;if(i){const r=i.type;if(n===Ab){const a=Z4(r,!1);if(a&&(a===e||a===qr(e)||a===S0(qr(e))))return r}const o=qA(i[n]||r[n],e)||qA(i.appContext[n],e);return!o&&s?r:o}}u(QT,"resolveAsset");function qA(n,e){return n&&(n[e]||n[qr(e)]||n[S0(qr(e))])}u(qA,"resolve");function ji(n,e,t,s){let i;const r=t&&t[s];if(ot(n)||Yn(n)){i=new Array(n.length);for(let o=0,a=n.length;o<a;o++)i[o]=e(n[o],o,void 0,r&&r[o])}else if(typeof n=="number"){i=new Array(n);for(let o=0;o<n;o++)i[o]=e(o+1,o,void 0,r&&r[o])}else if(mn(n))if(n[Symbol.iterator])i=Array.from(n,(o,a)=>e(o,a,void 0,r&&r[a]));else{const o=Object.keys(n);i=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];i[a]=e(n[c],c,a,r&&r[a])}}else i=[];return t&&(t[s]=i),i}u(ji,"renderList");function za(n,e,t={},s,i){if(Ns.isCE||Ns.parent&&sf(Ns.parent)&&Ns.parent.isCE)return e!=="default"&&(t.name=e),we("slot",t,s&&s());let r=n[e];r&&r._c&&(r._d=!1),Se();const o=r&&JT(r(t)),a=Xt(Dt,{key:t.key||o&&o.key||`_${e}`},o||(s?s():[]),o&&n._===1?64:-2);return!i&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}u(za,"renderSlot");function JT(n){return n.some(e=>Kg(e)?!(e.type===Ba||e.type===Dt&&!JT(e.children)):!0)?n:null}u(JT,"ensureValidVNode");const g_=u(n=>n?hP(n)?N0(n)||n.proxy:g_(n.parent):null,"getPublicInstance"),rf=ni(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>g_(n.parent),$root:n=>g_(n.root),$emit:n=>n.emit,$options:n=>Mb(n),$forceUpdate:n=>n.f||(n.f=()=>xb(n.update)),$nextTick:n=>n.n||(n.n=Ri.bind(n.proxy)),$watch:n=>u4.bind(n)}),W1=u((n,e)=>n!==yn&&!n.__isScriptSetup&&Gt(n,e),"hasSetupBinding"),x4={get({_:n},e){const{ctx:t,setupState:s,data:i,props:r,accessCache:o,type:a,appContext:l}=n;let c;if(e[0]!=="$"){const p=o[e];if(p!==void 0)switch(p){case 1:return s[e];case 2:return i[e];case 4:return t[e];case 3:return r[e]}else{if(W1(s,e))return o[e]=1,s[e];if(i!==yn&&Gt(i,e))return o[e]=2,i[e];if((c=n.propsOptions[0])&&Gt(c,e))return o[e]=3,r[e];if(t!==yn&&Gt(t,e))return o[e]=4,t[e];v_&&(o[e]=0)}}const h=rf[e];let d,f;if(h)return e==="$attrs"&&Ni(n,"get",e),h(n);if((d=a.__cssModules)&&(d=d[e]))return d;if(t!==yn&&Gt(t,e))return o[e]=4,t[e];if(f=l.config.globalProperties,Gt(f,e))return f[e]},set({_:n},e,t){const{data:s,setupState:i,ctx:r}=n;return W1(i,e)?(i[e]=t,!0):s!==yn&&Gt(s,e)?(s[e]=t,!0):Gt(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(r[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:s,appContext:i,propsOptions:r}},o){let a;return!!t[o]||n!==yn&&Gt(n,o)||W1(e,o)||(a=r[0])&&Gt(a,o)||Gt(s,o)||Gt(rf,o)||Gt(i.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:Gt(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};let v_=!0;function A4(n){const e=Mb(n),t=n.proxy,s=n.ctx;v_=!1,e.beforeCreate&&KA(e.beforeCreate,n,"bc");const{data:i,computed:r,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:d,mounted:f,beforeUpdate:p,updated:g,activated:m,deactivated:v,beforeDestroy:y,beforeUnmount:b,destroyed:_,unmounted:w,render:x,renderTracked:S,renderTriggered:C,errorCaptured:M,serverPrefetch:R,expose:D,inheritAttrs:k,components:T,directives:N,filters:E}=e;if(c&&M4(c,s,null,n.appContext.config.unwrapInjectedRef),o)for(const q in o){const ne=o[q];yt(ne)&&(s[q]=ne.bind(t))}if(i){const q=i.call(t,t);mn(q)&&(n.data=Oo(q))}if(v_=!0,r)for(const q in r){const ne=r[q],W=yt(ne)?ne.bind(t,t):yt(ne.get)?ne.get.bind(t,t):vr,se=!yt(ne)&&yt(ne.set)?ne.set.bind(t):vr,K=ct({get:W,set:se});Object.defineProperty(s,q,{enumerable:!0,configurable:!0,get:()=>K.value,set:U=>K.value=U})}if(a)for(const q in a)eP(a[q],s,t,q);if(l){const q=yt(l)?l.call(t):l;Reflect.ownKeys(q).forEach(ne=>{Hl(ne,q[ne])})}h&&KA(h,n,"c");function H(q,ne){ot(ne)?ne.forEach(W=>q(W.bind(t))):ne&&q(ne.bind(t))}if(u(H,"registerLifecycleHook"),H(p4,d),H(D0,f),H(m4,p),H(g4,g),H(h4,m),H(d4,v),H(b4,M),H(_4,S),H(y4,C),H(Wa,b),H(L0,w),H(v4,R),ot(D))if(D.length){const q=n.exposed||(n.exposed={});D.forEach(ne=>{Object.defineProperty(q,ne,{get:()=>t[ne],set:W=>t[ne]=W})})}else n.exposed||(n.exposed={});x&&n.render===vr&&(n.render=x),k!=null&&(n.inheritAttrs=k),T&&(n.components=T),N&&(n.directives=N)}u(A4,"applyOptions");function M4(n,e,t=vr,s=!1){ot(n)&&(n=y_(n));for(const i in n){const r=n[i];let o;mn(r)?"default"in r?o=Es(r.from||i,r.default,!0):o=Es(r.from||i):o=Es(r),ks(o)&&s?Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[i]=o}}u(M4,"resolveInjections");function KA(n,e,t){yr(ot(n)?n.map(s=>s.bind(e.proxy)):n.bind(e.proxy),e,t)}u(KA,"callHook");function eP(n,e,t,s){const i=s.includes(".")?YT(t,s):()=>t[s];if(Yn(n)){const r=e[n];yt(r)&&Ts(i,r)}else if(yt(n))Ts(i,n.bind(t));else if(mn(n))if(ot(n))n.forEach(r=>eP(r,e,t,s));else{const r=yt(n.handler)?n.handler.bind(t):e[n.handler];yt(r)&&Ts(i,r,n)}}u(eP,"createWatcher");function Mb(n){const e=n.type,{mixins:t,extends:s}=e,{mixins:i,optionsCache:r,config:{optionMergeStrategies:o}}=n.appContext,a=r.get(e);let l;return a?l=a:!i.length&&!t&&!s?l=e:(l={},i.length&&i.forEach(c=>qg(l,c,o,!0)),qg(l,e,o)),mn(e)&&r.set(e,l),l}u(Mb,"resolveMergedOptions");function qg(n,e,t,s=!1){const{mixins:i,extends:r}=e;r&&qg(n,r,t,!0),i&&i.forEach(o=>qg(n,o,t,!0));for(const o in e)if(!(s&&o==="expose")){const a=S4[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}u(qg,"mergeOptions$1");const S4={data:ZA,props:Tl,emits:Tl,methods:Tl,computed:Tl,beforeCreate:Ws,created:Ws,beforeMount:Ws,mounted:Ws,beforeUpdate:Ws,updated:Ws,beforeDestroy:Ws,beforeUnmount:Ws,destroyed:Ws,unmounted:Ws,activated:Ws,deactivated:Ws,errorCaptured:Ws,serverPrefetch:Ws,components:Tl,directives:Tl,watch:E4,provide:ZA,inject:C4};function ZA(n,e){return e?n?u(function(){return ni(yt(n)?n.call(this,this):n,yt(e)?e.call(this,this):e)},"mergedDataFn"):e:n}u(ZA,"mergeDataFn");function C4(n,e){return Tl(y_(n),y_(e))}u(C4,"mergeInject");function y_(n){if(ot(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}u(y_,"normalizeInject");function Ws(n,e){return n?[...new Set([].concat(n,e))]:e}u(Ws,"mergeAsArray");function Tl(n,e){return n?ni(ni(Object.create(null),n),e):e}u(Tl,"mergeObjectOptions");function E4(n,e){if(!n)return e;if(!e)return n;const t=ni(Object.create(null),n);for(const s in e)t[s]=Ws(n[s],e[s]);return t}u(E4,"mergeWatchOptions");function T4(n,e,t,s=!1){const i={},r={};jg(r,k0,1),n.propsDefaults=Object.create(null),tP(n,e,i,r);for(const o in n.propsOptions[0])o in i||(i[o]=void 0);t?n.props=s?i:YN(i):n.type.props?n.props=i:n.props=r,n.attrs=r}u(T4,"initProps");function P4(n,e,t,s){const{props:i,attrs:r,vnode:{patchFlag:o}}=n,a=rt(i),[l]=n.propsOptions;let c=!1;if((s||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let d=0;d<h.length;d++){let f=h[d];if(P0(n.emitsOptions,f))continue;const p=e[f];if(l)if(Gt(r,f))p!==r[f]&&(r[f]=p,c=!0);else{const g=qr(f);i[g]=__(l,a,g,p,n,!1)}else p!==r[f]&&(r[f]=p,c=!0)}}}else{tP(n,e,i,r)&&(c=!0);let h;for(const d in a)(!e||!Gt(e,d)&&((h=dc(d))===d||!Gt(e,h)))&&(l?t&&(t[d]!==void 0||t[h]!==void 0)&&(i[d]=__(l,a,d,void 0,n,!0)):delete i[d]);if(r!==a)for(const d in r)(!e||!Gt(e,d)&&!0)&&(delete r[d],c=!0)}c&&Fo(n,"set","$attrs")}u(P4,"updateProps");function tP(n,e,t,s){const[i,r]=n.propsOptions;let o=!1,a;if(e)for(let l in e){if(Pg(l))continue;const c=e[l];let h;i&&Gt(i,h=qr(l))?!r||!r.includes(h)?t[h]=c:(a||(a={}))[h]=c:P0(n.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,o=!0)}if(r){const l=rt(t),c=a||yn;for(let h=0;h<r.length;h++){const d=r[h];t[d]=__(i,l,d,c[d],n,!Gt(c,d))}}return o}u(tP,"setFullProps");function __(n,e,t,s,i,r){const o=n[t];if(o!=null){const a=Gt(o,"default");if(a&&s===void 0){const l=o.default;if(o.type!==Function&&yt(l)){const{propsDefaults:c}=i;t in c?s=c[t]:(Iu(i),s=c[t]=l.call(null,e),Wl())}else s=l}o[0]&&(r&&!a?s=!1:o[1]&&(s===""||s===dc(t))&&(s=!0))}return s}u(__,"resolvePropValue");function nP(n,e,t=!1){const s=e.propsCache,i=s.get(n);if(i)return i;const r=n.props,o={},a=[];let l=!1;if(!yt(n)){const h=u(d=>{l=!0;const[f,p]=nP(d,e,!0);ni(o,f),p&&a.push(...p)},"extendProps");!t&&e.mixins.length&&e.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!r&&!l)return mn(n)&&s.set(n,bu),bu;if(ot(r))for(let h=0;h<r.length;h++){const d=qr(r[h]);QA(d)&&(o[d]=yn)}else if(r)for(const h in r){const d=qr(h);if(QA(d)){const f=r[h],p=o[d]=ot(f)||yt(f)?{type:f}:Object.assign({},f);if(p){const g=tM(Boolean,p.type),m=tM(String,p.type);p[0]=g>-1,p[1]=m<0||g<m,(g>-1||Gt(p,"default"))&&a.push(d)}}}const c=[o,a];return mn(n)&&s.set(n,c),c}u(nP,"normalizePropsOptions");function QA(n){return n[0]!=="$"}u(QA,"validatePropName");function JA(n){const e=n&&n.toString().match(/^\s*function (\w+)/);return e?e[1]:n===null?"null":""}u(JA,"getType");function eM(n,e){return JA(n)===JA(e)}u(eM,"isSameType");function tM(n,e){return ot(e)?e.findIndex(t=>eM(t,n)):yt(e)&&eM(e,n)?0:-1}u(tM,"getTypeIndex");const sP=u(n=>n[0]==="_"||n==="$stable","isInternalKey"),Sb=u(n=>ot(n)?n.map(zr):[zr(n)],"normalizeSlotValue"),R4=u((n,e,t)=>{if(e._n)return e;const s=bt((...i)=>Sb(e(...i)),t);return s._c=!1,s},"normalizeSlot$1"),iP=u((n,e,t)=>{const s=n._ctx;for(const i in n){if(sP(i))continue;const r=n[i];if(yt(r))e[i]=R4(i,r,s);else if(r!=null){const o=Sb(r);e[i]=()=>o}}},"normalizeObjectSlots"),rP=u((n,e)=>{const t=Sb(e);n.slots.default=()=>t},"normalizeVNodeSlots"),I4=u((n,e)=>{if(n.vnode.shapeFlag&32){const t=e._;t?(n.slots=rt(e),jg(e,"_",t)):iP(e,n.slots={})}else n.slots={},e&&rP(n,e);jg(n.slots,k0,1)},"initSlots"),D4=u((n,e,t)=>{const{vnode:s,slots:i}=n;let r=!0,o=yn;if(s.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:(ni(i,e),!t&&a===1&&delete i._):(r=!e.$stable,iP(e,i)),o=e}else e&&(rP(n,e),o={default:1});if(r)for(const a in i)!sP(a)&&!(a in o)&&delete i[a]},"updateSlots");function oP(){return{app:null,config:{isNativeTag:mN,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}u(oP,"createAppContext");let L4=0;function O4(n,e){return u(function(s,i=null){yt(s)||(s=Object.assign({},s)),i!=null&&!mn(i)&&(i=null);const r=oP(),o=new Set;let a=!1;const l=r.app={_uid:L4++,_component:s,_props:i,_container:null,_context:r,_instance:null,version:t5,get config(){return r.config},set config(c){},use(c,...h){return o.has(c)||(c&&yt(c.install)?(o.add(c),c.install(l,...h)):yt(c)&&(o.add(c),c(l,...h))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,h){return h?(r.components[c]=h,l):r.components[c]},directive(c,h){return h?(r.directives[c]=h,l):r.directives[c]},mount(c,h,d){if(!a){const f=we(s,i);return f.appContext=r,h&&e?e(f,c):n(f,c,d),a=!0,l._container=c,c.__vue_app__=l,N0(f.component)||f.component.proxy}},unmount(){a&&(n(null,l._container),delete l._container.__vue_app__)},provide(c,h){return r.provides[c]=h,l}};return l},"createApp")}u(O4,"createAppAPI");function b_(n,e,t,s,i=!1){if(ot(n)){n.forEach((f,p)=>b_(f,e&&(ot(e)?e[p]:e),t,s,i));return}if(sf(s)&&!i)return;const r=s.shapeFlag&4?N0(s.component)||s.component.proxy:s.el,o=i?null:r,{i:a,r:l}=n,c=e&&e.r,h=a.refs===yn?a.refs={}:a.refs,d=a.setupState;if(c!=null&&c!==l&&(Yn(c)?(h[c]=null,Gt(d,c)&&(d[c]=null)):ks(c)&&(c.value=null)),yt(l))La(l,a,12,[o,h]);else{const f=Yn(l),p=ks(l);if(f||p){const g=u(()=>{if(n.f){const m=f?Gt(d,l)?d[l]:h[l]:l.value;i?ot(m)&&fb(m,r):ot(m)?m.includes(r)||m.push(r):f?(h[l]=[r],Gt(d,l)&&(d[l]=h[l])):(l.value=[r],n.k&&(h[n.k]=l.value))}else f?(h[l]=o,Gt(d,l)&&(d[l]=o)):p&&(l.value=o,n.k&&(h[n.k]=o))},"doSet");o?(g.id=-1,ci(g,t)):g()}}}u(b_,"setRef");const ci=c4;function k4(n){return N4(n)}u(k4,"createRenderer");function N4(n,e){const t=wN();t.__VUE__=!0;const{insert:s,remove:i,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:d,nextSibling:f,setScopeId:p=vr,insertStaticContent:g}=n,m=u(($,X,I,J=null,Z=null,B=null,F=!1,V=null,ae=!!X.dynamicChildren)=>{if($===X)return;$&&!Oh($,X)&&(J=_e($),U($,Z,B,!0),$=null),X.patchFlag===-2&&(ae=!1,X.dynamicChildren=null);const{type:oe,ref:L,shapeFlag:O}=X;switch(oe){case O0:v($,X,I,J);break;case Ba:y($,X,I,J);break;case j1:$==null&&b(X,I,J,F);break;case Dt:T($,X,I,J,Z,B,F,V,ae);break;default:O&1?x($,X,I,J,Z,B,F,V,ae):O&6?N($,X,I,J,Z,B,F,V,ae):(O&64||O&128)&&oe.process($,X,I,J,Z,B,F,V,ae,Ae)}L!=null&&Z&&b_(L,$&&$.ref,B,X||$,!X)},"patch"),v=u(($,X,I,J)=>{if($==null)s(X.el=a(X.children),I,J);else{const Z=X.el=$.el;X.children!==$.children&&c(Z,X.children)}},"processText"),y=u(($,X,I,J)=>{$==null?s(X.el=l(X.children||""),I,J):X.el=$.el},"processCommentNode"),b=u(($,X,I,J)=>{[$.el,$.anchor]=g($.children,X,I,J,$.el,$.anchor)},"mountStaticNode"),_=u(({el:$,anchor:X},I,J)=>{let Z;for(;$&&$!==X;)Z=f($),s($,I,J),$=Z;s(X,I,J)},"moveStaticNode"),w=u(({el:$,anchor:X})=>{let I;for(;$&&$!==X;)I=f($),i($),$=I;i(X)},"removeStaticNode"),x=u(($,X,I,J,Z,B,F,V,ae)=>{F=F||X.type==="svg",$==null?S(X,I,J,Z,B,F,V,ae):R($,X,Z,B,F,V,ae)},"processElement"),S=u(($,X,I,J,Z,B,F,V)=>{let ae,oe;const{type:L,props:O,shapeFlag:ee,transition:ie,dirs:ce}=$;if(ae=$.el=o($.type,B,O&&O.is,O),ee&8?h(ae,$.children):ee&16&&M($.children,ae,null,J,Z,B&&L!=="foreignObject",F,V),ce&&nl($,null,J,"created"),O){for(const Ce in O)Ce!=="value"&&!Pg(Ce)&&r(ae,Ce,null,O[Ce],B,$.children,J,Z,te);"value"in O&&r(ae,"value",null,O.value),(oe=O.onVnodeBeforeMount)&&Rr(oe,J,$)}C(ae,$,$.scopeId,F,J),ce&&nl($,null,J,"beforeMount");const ye=(!Z||Z&&!Z.pendingBranch)&&ie&&!ie.persisted;ye&&ie.beforeEnter(ae),s(ae,X,I),((oe=O&&O.onVnodeMounted)||ye||ce)&&ci(()=>{oe&&Rr(oe,J,$),ye&&ie.enter(ae),ce&&nl($,null,J,"mounted")},Z)},"mountElement"),C=u(($,X,I,J,Z)=>{if(I&&p($,I),J)for(let B=0;B<J.length;B++)p($,J[B]);if(Z){let B=Z.subTree;if(X===B){const F=Z.vnode;C($,F,F.scopeId,F.slotScopeIds,Z.parent)}}},"setScopeId"),M=u(($,X,I,J,Z,B,F,V,ae=0)=>{for(let oe=ae;oe<$.length;oe++){const L=$[oe]=V?Ca($[oe]):zr($[oe]);m(null,L,X,I,J,Z,B,F,V)}},"mountChildren"),R=u(($,X,I,J,Z,B,F)=>{const V=X.el=$.el;let{patchFlag:ae,dynamicChildren:oe,dirs:L}=X;ae|=$.patchFlag&16;const O=$.props||yn,ee=X.props||yn;let ie;I&&sl(I,!1),(ie=ee.onVnodeBeforeUpdate)&&Rr(ie,I,X,$),L&&nl(X,$,I,"beforeUpdate"),I&&sl(I,!0);const ce=Z&&X.type!=="foreignObject";if(oe?D($.dynamicChildren,oe,V,I,J,ce,B):F||ne($,X,V,null,I,J,ce,B,!1),ae>0){if(ae&16)k(V,X,O,ee,I,J,Z);else if(ae&2&&O.class!==ee.class&&r(V,"class",null,ee.class,Z),ae&4&&r(V,"style",O.style,ee.style,Z),ae&8){const ye=X.dynamicProps;for(let Ce=0;Ce<ye.length;Ce++){const Te=ye[Ce],ve=O[Te],Ge=ee[Te];(Ge!==ve||Te==="value")&&r(V,Te,ve,Ge,Z,$.children,I,J,te)}}ae&1&&$.children!==X.children&&h(V,X.children)}else!F&&oe==null&&k(V,X,O,ee,I,J,Z);((ie=ee.onVnodeUpdated)||L)&&ci(()=>{ie&&Rr(ie,I,X,$),L&&nl(X,$,I,"updated")},J)},"patchElement"),D=u(($,X,I,J,Z,B,F)=>{for(let V=0;V<X.length;V++){const ae=$[V],oe=X[V],L=ae.el&&(ae.type===Dt||!Oh(ae,oe)||ae.shapeFlag&70)?d(ae.el):I;m(ae,oe,L,null,J,Z,B,F,!0)}},"patchBlockChildren"),k=u(($,X,I,J,Z,B,F)=>{if(I!==J){if(I!==yn)for(const V in I)!Pg(V)&&!(V in J)&&r($,V,I[V],null,F,X.children,Z,B,te);for(const V in J){if(Pg(V))continue;const ae=J[V],oe=I[V];ae!==oe&&V!=="value"&&r($,V,oe,ae,F,X.children,Z,B,te)}"value"in J&&r($,"value",I.value,J.value)}},"patchProps"),T=u(($,X,I,J,Z,B,F,V,ae)=>{const oe=X.el=$?$.el:a(""),L=X.anchor=$?$.anchor:a("");let{patchFlag:O,dynamicChildren:ee,slotScopeIds:ie}=X;ie&&(V=V?V.concat(ie):ie),$==null?(s(oe,I,J),s(L,I,J),M(X.children,I,L,Z,B,F,V,ae)):O>0&&O&64&&ee&&$.dynamicChildren?(D($.dynamicChildren,ee,I,Z,B,F,V),(X.key!=null||Z&&X===Z.subTree)&&Cb($,X,!0)):ne($,X,I,L,Z,B,F,V,ae)},"processFragment"),N=u(($,X,I,J,Z,B,F,V,ae)=>{X.slotScopeIds=V,$==null?X.shapeFlag&512?Z.ctx.activate(X,I,J,F,ae):E(X,I,J,Z,B,F,ae):z($,X,ae)},"processComponent"),E=u(($,X,I,J,Z,B,F)=>{const V=$.component=j4($,J,Z);if(qT($)&&(V.ctx.renderer=Ae),X4(V),V.asyncDep){if(Z&&Z.registerDep(V,H),!$.el){const ae=V.subTree=we(Ba);y(null,ae,X,I)}return}H(V,$,X,I,Z,B,F)},"mountComponent"),z=u(($,X,I)=>{const J=X.component=$.component;if(o4($,X,I))if(J.asyncDep&&!J.asyncResolved){q(J,X,I);return}else J.next=X,e4(J.update),J.update();else X.el=$.el,J.vnode=X},"updateComponent"),H=u(($,X,I,J,Z,B,F)=>{const V=u(()=>{if($.isMounted){let{next:L,bu:O,u:ee,parent:ie,vnode:ce}=$,ye=L,Ce;sl($,!1),L?(L.el=ce.el,q($,L,F)):L=ce,O&&Rg(O),(Ce=L.props&&L.props.onVnodeBeforeUpdate)&&Rr(Ce,ie,L,ce),sl($,!0);const Te=H1($),ve=$.subTree;$.subTree=Te,m(ve,Te,d(ve.el),_e(ve),$,Z,B),L.el=Te.el,ye===null&&a4($,Te.el),ee&&ci(ee,Z),(Ce=L.props&&L.props.onVnodeUpdated)&&ci(()=>Rr(Ce,ie,L,ce),Z)}else{let L;const{el:O,props:ee}=X,{bm:ie,m:ce,parent:ye}=$,Ce=sf(X);if(sl($,!1),ie&&Rg(ie),!Ce&&(L=ee&&ee.onVnodeBeforeMount)&&Rr(L,ye,X),sl($,!0),O&&Ie){const Te=u(()=>{$.subTree=H1($),Ie(O,$.subTree,$,Z,null)},"hydrateSubTree");Ce?X.type.__asyncLoader().then(()=>!$.isUnmounted&&Te()):Te()}else{const Te=$.subTree=H1($);m(null,Te,I,J,$,Z,B),X.el=Te.el}if(ce&&ci(ce,Z),!Ce&&(L=ee&&ee.onVnodeMounted)){const Te=X;ci(()=>Rr(L,ye,Te),Z)}(X.shapeFlag&256||ye&&sf(ye.vnode)&&ye.vnode.shapeFlag&256)&&$.a&&ci($.a,Z),$.isMounted=!0,X=I=J=null}},"componentUpdateFn"),ae=$.effect=new C0(V,()=>xb(oe),$.scope),oe=$.update=()=>ae.run();oe.id=$.uid,sl($,!0),oe()},"setupRenderEffect"),q=u(($,X,I)=>{X.component=$;const J=$.vnode.props;$.vnode=X,$.next=null,P4($,X.props,J,I),D4($,X.children,I),fh(),XA(),ph()},"updateComponentPreRender"),ne=u(($,X,I,J,Z,B,F,V,ae=!1)=>{const oe=$&&$.children,L=$?$.shapeFlag:0,O=X.children,{patchFlag:ee,shapeFlag:ie}=X;if(ee>0){if(ee&128){se(oe,O,I,J,Z,B,F,V,ae);return}else if(ee&256){W(oe,O,I,J,Z,B,F,V,ae);return}}ie&8?(L&16&&te(oe,Z,B),O!==oe&&h(I,O)):L&16?ie&16?se(oe,O,I,J,Z,B,F,V,ae):te(oe,Z,B,!0):(L&8&&h(I,""),ie&16&&M(O,I,J,Z,B,F,V,ae))},"patchChildren"),W=u(($,X,I,J,Z,B,F,V,ae)=>{$=$||bu,X=X||bu;const oe=$.length,L=X.length,O=Math.min(oe,L);let ee;for(ee=0;ee<O;ee++){const ie=X[ee]=ae?Ca(X[ee]):zr(X[ee]);m($[ee],ie,I,null,Z,B,F,V,ae)}oe>L?te($,Z,B,!0,!1,O):M(X,I,J,Z,B,F,V,ae,O)},"patchUnkeyedChildren"),se=u(($,X,I,J,Z,B,F,V,ae)=>{let oe=0;const L=X.length;let O=$.length-1,ee=L-1;for(;oe<=O&&oe<=ee;){const ie=$[oe],ce=X[oe]=ae?Ca(X[oe]):zr(X[oe]);if(Oh(ie,ce))m(ie,ce,I,null,Z,B,F,V,ae);else break;oe++}for(;oe<=O&&oe<=ee;){const ie=$[O],ce=X[ee]=ae?Ca(X[ee]):zr(X[ee]);if(Oh(ie,ce))m(ie,ce,I,null,Z,B,F,V,ae);else break;O--,ee--}if(oe>O){if(oe<=ee){const ie=ee+1,ce=ie<L?X[ie].el:J;for(;oe<=ee;)m(null,X[oe]=ae?Ca(X[oe]):zr(X[oe]),I,ce,Z,B,F,V,ae),oe++}}else if(oe>ee)for(;oe<=O;)U($[oe],Z,B,!0),oe++;else{const ie=oe,ce=oe,ye=new Map;for(oe=ce;oe<=ee;oe++){const He=X[oe]=ae?Ca(X[oe]):zr(X[oe]);He.key!=null&&ye.set(He.key,oe)}let Ce,Te=0;const ve=ee-ce+1;let Ge=!1,Xe=0;const Le=new Array(ve);for(oe=0;oe<ve;oe++)Le[oe]=0;for(oe=ie;oe<=O;oe++){const He=$[oe];if(Te>=ve){U(He,Z,B,!0);continue}let et;if(He.key!=null)et=ye.get(He.key);else for(Ce=ce;Ce<=ee;Ce++)if(Le[Ce-ce]===0&&Oh(He,X[Ce])){et=Ce;break}et===void 0?U(He,Z,B,!0):(Le[et-ce]=oe+1,et>=Xe?Xe=et:Ge=!0,m(He,X[et],I,null,Z,B,F,V,ae),Te++)}const Ke=Ge?F4(Le):bu;for(Ce=Ke.length-1,oe=ve-1;oe>=0;oe--){const He=ce+oe,et=X[He],Ut=He+1<L?X[He+1].el:J;Le[oe]===0?m(null,et,I,Ut,Z,B,F,V,ae):Ge&&(Ce<0||oe!==Ke[Ce]?K(et,I,Ut,2):Ce--)}}},"patchKeyedChildren"),K=u(($,X,I,J,Z=null)=>{const{el:B,type:F,transition:V,children:ae,shapeFlag:oe}=$;if(oe&6){K($.component.subTree,X,I,J);return}if(oe&128){$.suspense.move(X,I,J);return}if(oe&64){F.move($,X,I,Ae);return}if(F===Dt){s(B,X,I);for(let O=0;O<ae.length;O++)K(ae[O],X,I,J);s($.anchor,X,I);return}if(F===j1){_($,X,I);return}if(J!==2&&oe&1&&V)if(J===0)V.beforeEnter(B),s(B,X,I),ci(()=>V.enter(B),Z);else{const{leave:O,delayLeave:ee,afterLeave:ie}=V,ce=u(()=>s(B,X,I),"remove"),ye=u(()=>{O(B,()=>{ce(),ie&&ie()})},"performLeave");ee?ee(B,ce,ye):ye()}else s(B,X,I)},"move"),U=u(($,X,I,J=!1,Z=!1)=>{const{type:B,props:F,ref:V,children:ae,dynamicChildren:oe,shapeFlag:L,patchFlag:O,dirs:ee}=$;if(V!=null&&b_(V,null,I,$,!0),L&256){X.ctx.deactivate($);return}const ie=L&1&&ee,ce=!sf($);let ye;if(ce&&(ye=F&&F.onVnodeBeforeUnmount)&&Rr(ye,X,$),L&6)Q($.component,I,J);else{if(L&128){$.suspense.unmount(I,J);return}ie&&nl($,null,X,"beforeUnmount"),L&64?$.type.remove($,X,I,Z,Ae,J):oe&&(B!==Dt||O>0&&O&64)?te(oe,X,I,!1,!0):(B===Dt&&O&384||!Z&&L&16)&&te(ae,X,I),J&&he($)}(ce&&(ye=F&&F.onVnodeUnmounted)||ie)&&ci(()=>{ye&&Rr(ye,X,$),ie&&nl($,null,X,"unmounted")},I)},"unmount"),he=u($=>{const{type:X,el:I,anchor:J,transition:Z}=$;if(X===Dt){ue(I,J);return}if(X===j1){w($);return}const B=u(()=>{i(I),Z&&!Z.persisted&&Z.afterLeave&&Z.afterLeave()},"performRemove");if($.shapeFlag&1&&Z&&!Z.persisted){const{leave:F,delayLeave:V}=Z,ae=u(()=>F(I,B),"performLeave");V?V($.el,B,ae):ae()}else B()},"remove"),ue=u(($,X)=>{let I;for(;$!==X;)I=f($),i($),$=I;i(X)},"removeFragment"),Q=u(($,X,I)=>{const{bum:J,scope:Z,update:B,subTree:F,um:V}=$;J&&Rg(J),Z.stop(),B&&(B.active=!1,U(F,$,X,I)),V&&ci(V,X),ci(()=>{$.isUnmounted=!0},X),X&&X.pendingBranch&&!X.isUnmounted&&$.asyncDep&&!$.asyncResolved&&$.suspenseId===X.pendingId&&(X.deps--,X.deps===0&&X.resolve())},"unmountComponent"),te=u(($,X,I,J=!1,Z=!1,B=0)=>{for(let F=B;F<$.length;F++)U($[F],X,I,J,Z)},"unmountChildren"),_e=u($=>$.shapeFlag&6?_e($.component.subTree):$.shapeFlag&128?$.suspense.next():f($.anchor||$.el),"getNextHostNode"),pe=u(($,X,I)=>{$==null?X._vnode&&U(X._vnode,null,null,!0):m(X._vnode||null,$,X,null,null,null,I),XA(),HT(),X._vnode=$},"render"),Ae={p:m,um:U,m:K,r:he,mt:E,mc:M,pc:ne,pbc:D,n:_e,o:n};let Me,Ie;return e&&([Me,Ie]=e(Ae)),{render:pe,hydrate:Me,createApp:O4(pe,Me)}}u(N4,"baseCreateRenderer");function sl({effect:n,update:e},t){n.allowRecurse=e.allowRecurse=t}u(sl,"toggleRecurse");function Cb(n,e,t=!1){const s=n.children,i=e.children;if(ot(s)&&ot(i))for(let r=0;r<s.length;r++){const o=s[r];let a=i[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=i[r]=Ca(i[r]),a.el=o.el),t||Cb(o,a)),a.type===O0&&(a.el=o.el)}}u(Cb,"traverseStaticChildren");function F4(n){const e=n.slice(),t=[0];let s,i,r,o,a;const l=n.length;for(s=0;s<l;s++){const c=n[s];if(c!==0){if(i=t[t.length-1],n[i]<c){e[s]=i,t.push(s);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,n[t[a]]<c?r=a+1:o=a;c<n[t[r]]&&(r>0&&(e[s]=t[r-1]),t[r]=s)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}u(F4,"getSequence");const z4=u(n=>n.__isTeleport,"isTeleport"),of=u(n=>n&&(n.disabled||n.disabled===""),"isTeleportDisabled"),nM=u(n=>typeof SVGElement!="undefined"&&n instanceof SVGElement,"isTargetSVG"),w_=u((n,e)=>{const t=n&&n.to;return Yn(t)?e?e(t):null:t},"resolveTarget"),B4={__isTeleport:!0,process(n,e,t,s,i,r,o,a,l,c){const{mc:h,pc:d,pbc:f,o:{insert:p,querySelector:g,createText:m,createComment:v}}=c,y=of(e.props);let{shapeFlag:b,children:_,dynamicChildren:w}=e;if(n==null){const x=e.el=m(""),S=e.anchor=m("");p(x,t,s),p(S,t,s);const C=e.target=w_(e.props,g),M=e.targetAnchor=m("");C&&(p(M,C),o=o||nM(C));const R=u((D,k)=>{b&16&&h(_,D,k,i,r,o,a,l)},"mount");y?R(t,S):C&&R(C,M)}else{e.el=n.el;const x=e.anchor=n.anchor,S=e.target=n.target,C=e.targetAnchor=n.targetAnchor,M=of(n.props),R=M?t:S,D=M?x:C;if(o=o||nM(S),w?(f(n.dynamicChildren,w,R,i,r,o,a),Cb(n,e,!0)):l||d(n,e,R,D,i,r,o,a,!1),y)M||Tp(e,t,x,c,1);else if((e.props&&e.props.to)!==(n.props&&n.props.to)){const k=e.target=w_(e.props,g);k&&Tp(e,k,null,c,0)}else M&&Tp(e,S,C,c,1)}aP(e)},remove(n,e,t,s,{um:i,o:{remove:r}},o){const{shapeFlag:a,children:l,anchor:c,targetAnchor:h,target:d,props:f}=n;if(d&&r(h),(o||!of(f))&&(r(c),a&16))for(let p=0;p<l.length;p++){const g=l[p];i(g,e,t,!0,!!g.dynamicChildren)}},move:Tp,hydrate:U4};function Tp(n,e,t,{o:{insert:s},m:i},r=2){r===0&&s(n.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:h}=n,d=r===2;if(d&&s(o,e,t),(!d||of(h))&&l&16)for(let f=0;f<c.length;f++)i(c[f],e,t,2);d&&s(a,e,t)}u(Tp,"moveTeleport");function U4(n,e,t,s,i,r,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const h=e.target=w_(e.props,l);if(h){const d=h._lpa||h.firstChild;if(e.shapeFlag&16)if(of(e.props))e.anchor=c(o(n),e,a(n),t,s,i,r),e.targetAnchor=d;else{e.anchor=o(n);let f=d;for(;f;)if(f=o(f),f&&f.nodeType===8&&f.data==="teleport anchor"){e.targetAnchor=f,h._lpa=e.targetAnchor&&o(e.targetAnchor);break}c(d,e,h,t,s,i,r)}aP(e)}return e.anchor&&o(e.anchor)}u(U4,"hydrateTeleport");const Eb=B4;function aP(n){const e=n.ctx;if(e&&e.ut){let t=n.children[0].el;for(;t!==n.targetAnchor;)t.nodeType===1&&t.setAttribute("data-v-owner",e.uid),t=t.nextSibling;e.ut()}}u(aP,"updateCssVars");const Dt=Symbol(void 0),O0=Symbol(void 0),Ba=Symbol(void 0),j1=Symbol(void 0),af=[];let pr=null;function Se(n=!1){af.push(pr=n?null:[])}u(Se,"openBlock");function $4(){af.pop(),pr=af[af.length-1]||null}u($4,"closeBlock");let Sf=1;function sM(n){Sf+=n}u(sM,"setBlockTracking");function lP(n){return n.dynamicChildren=Sf>0?pr||bu:null,$4(),Sf>0&&pr&&pr.push(n),n}u(lP,"setupBlock");function Oe(n,e,t,s,i,r){return lP(j(n,e,t,s,i,r,!0))}u(Oe,"createElementBlock");function Xt(n,e,t,s,i){return lP(we(n,e,t,s,i,!0))}u(Xt,"createBlock");function Kg(n){return n?n.__v_isVNode===!0:!1}u(Kg,"isVNode");function Oh(n,e){return n.type===e.type&&n.key===e.key}u(Oh,"isSameVNodeType");const k0="__vInternal",cP=u(({key:n})=>n!=null?n:null,"normalizeKey"),Ig=u(({ref:n,ref_key:e,ref_for:t})=>n!=null?Yn(n)||ks(n)||yt(n)?{i:Ns,r:n,k:e,f:!!t}:n:null,"normalizeRef");function j(n,e=null,t=null,s=0,i=null,r=n===Dt?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&cP(e),ref:e&&Ig(e),scopeId:R0,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:s,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:Ns};return a?(Tb(l,t),r&128&&n.normalize(l)):t&&(l.shapeFlag|=Yn(t)?8:16),Sf>0&&!o&&pr&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&pr.push(l),l}u(j,"createBaseVNode");const we=V4;function V4(n,e=null,t=null,s=0,i=null,r=!1){if((!n||n===ZT)&&(n=Ba),Kg(n)){const a=Ru(n,e,!0);return t&&Tb(a,t),Sf>0&&!r&&pr&&(a.shapeFlag&6?pr[pr.indexOf(n)]=a:pr.push(a)),a.patchFlag|=-2,a}if(Q4(n)&&(n=n.__vccOpts),e){e=G4(e);let{class:a,style:l}=e;a&&!Yn(a)&&(e.class=pn(a)),mn(l)&&(LT(l)&&!ot(l)&&(l=ni({},l)),e.style=On(l))}const o=Yn(n)?1:l4(n)?128:z4(n)?64:mn(n)?4:yt(n)?2:0;return j(n,e,t,s,i,o,r,!0)}u(V4,"_createVNode");function G4(n){return n?LT(n)||k0 in n?ni({},n):n:null}u(G4,"guardReactiveProps");function Ru(n,e,t=!1){const{props:s,ref:i,patchFlag:r,children:o}=n,a=e?uP(s||{},e):s;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:a,key:a&&cP(a),ref:e&&e.ref?t&&i?ot(i)?i.concat(Ig(e)):[i,Ig(e)]:Ig(e):i,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:o,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==Dt?r===-1?16:r|16:r,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Ru(n.ssContent),ssFallback:n.ssFallback&&Ru(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx}}u(Ru,"cloneVNode");function dn(n=" ",e=0){return we(O0,null,n,e)}u(dn,"createTextVNode");function tt(n="",e=!1){return e?(Se(),Xt(Ba,null,n)):we(Ba,null,n)}u(tt,"createCommentVNode");function zr(n){return n==null||typeof n=="boolean"?we(Ba):ot(n)?we(Dt,null,n.slice()):typeof n=="object"?Ca(n):we(O0,null,String(n))}u(zr,"normalizeVNode");function Ca(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Ru(n)}u(Ca,"cloneIfMounted");function Tb(n,e){let t=0;const{shapeFlag:s}=n;if(e==null)e=null;else if(ot(e))t=16;else if(typeof e=="object")if(s&65){const i=e.default;i&&(i._c&&(i._d=!1),Tb(n,i()),i._c&&(i._d=!0));return}else{t=32;const i=e._;!i&&!(k0 in e)?e._ctx=Ns:i===3&&Ns&&(Ns.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else yt(e)?(e={default:e,_ctx:Ns},t=32):(e=String(e),s&64?(t=16,e=[dn(e)]):t=8);n.children=e,n.shapeFlag|=t}u(Tb,"normalizeChildren");function uP(...n){const e={};for(let t=0;t<n.length;t++){const s=n[t];for(const i in s)if(i==="class")e.class!==s.class&&(e.class=pn([e.class,s.class]));else if(i==="style")e.style=On([e.style,s.style]);else if(x0(i)){const r=e[i],o=s[i];o&&r!==o&&!(ot(r)&&r.includes(o))&&(e[i]=r?[].concat(r,o):o)}else i!==""&&(e[i]=s[i])}return e}u(uP,"mergeProps");function Rr(n,e,t,s=null){yr(n,e,7,[t,s])}u(Rr,"invokeVNodeHook");const H4=oP();let W4=0;function j4(n,e,t){const s=n.type,i=(e?e.appContext:n.appContext)||H4,r={uid:W4++,vnode:n,type:s,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,scope:new wT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:nP(s,i),emitsOptions:jT(s,i),emit:null,emitted:null,propsDefaults:yn,inheritAttrs:s.inheritAttrs,ctx:yn,data:yn,props:yn,attrs:yn,slots:yn,refs:yn,setupState:yn,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=s4.bind(null,r),n.ce&&n.ce(r),r}u(j4,"createComponentInstance$1");let Cs=null;const Iu=u(n=>{Cs=n,n.scope.on()},"setCurrentInstance"),Wl=u(()=>{Cs&&Cs.scope.off(),Cs=null},"unsetCurrentInstance");function hP(n){return n.vnode.shapeFlag&4}u(hP,"isStatefulComponent");let Cf=!1;function X4(n,e=!1){Cf=e;const{props:t,children:s}=n.vnode,i=hP(n);T4(n,t,i,e),I4(n,s);const r=i?Y4(n,e):void 0;return Cf=!1,r}u(X4,"setupComponent");function Y4(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=OT(new Proxy(n.ctx,x4));const{setup:s}=t;if(s){const i=n.setupContext=s.length>1?K4(n):null;Iu(n),fh();const r=La(s,n,0,[n.props,i]);if(ph(),Wl(),yT(r)){if(r.then(Wl,Wl),e)return r.then(o=>{iM(n,o,e)}).catch(o=>{T0(o,n,0)});n.asyncDep=r}else iM(n,r,e)}else dP(n,e)}u(Y4,"setupStatefulComponent");function iM(n,e,t){yt(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:mn(e)&&(n.setupState=BT(e)),dP(n,t)}u(iM,"handleSetupResult");let rM;function dP(n,e,t){const s=n.type;if(!n.render){if(!e&&rM&&!s.render){const i=s.template||Mb(n).template;if(i){const{isCustomElement:r,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=s,c=ni(ni({isCustomElement:r,delimiters:a},o),l);s.render=rM(i,c)}}n.render=s.render||vr}Iu(n),fh(),A4(n),ph(),Wl()}u(dP,"finishComponentSetup");function q4(n){return new Proxy(n.attrs,{get(e,t){return Ni(n,"get","$attrs"),e[t]}})}u(q4,"createAttrsProxy");function K4(n){const e=u(s=>{n.exposed=s||{}},"expose");let t;return{get attrs(){return t||(t=q4(n))},slots:n.slots,emit:n.emit,expose:e}}u(K4,"createSetupContext");function N0(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(BT(OT(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in rf)return rf[t](n)},has(e,t){return t in e||t in rf}}))}u(N0,"getExposeProxy");function Z4(n,e=!0){return yt(n)?n.displayName||n.name:n.name||e&&n.__name}u(Z4,"getComponentName");function Q4(n){return yt(n)&&"__vccOpts"in n}u(Q4,"isClassComponent");const ct=u((n,e)=>ZN(n,e,Cf),"computed");function fP(n,e,t){const s=arguments.length;return s===2?mn(e)&&!ot(e)?Kg(e)?we(n,null,[e]):we(n,e):we(n,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&Kg(t)&&(t=[t]),we(n,e,t))}u(fP,"h");const J4=Symbol(""),e5=u(()=>Es(J4),"useSSRContext"),t5="3.2.45",n5="http://www.w3.org/2000/svg",Ll=typeof document!="undefined"?document:null,oM=Ll&&Ll.createElement("template"),s5={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,s)=>{const i=e?Ll.createElementNS(n5,n):Ll.createElement(n,t?{is:t}:void 0);return n==="select"&&s&&s.multiple!=null&&i.setAttribute("multiple",s.multiple),i},createText:n=>Ll.createTextNode(n),createComment:n=>Ll.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Ll.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,s,i,r){const o=t?t.previousSibling:e.lastChild;if(i&&(i===r||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),t),!(i===r||!(i=i.nextSibling)););else{oM.innerHTML=s?`<svg>${n}</svg>`:n;const a=oM.content;if(s){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}};function i5(n,e,t){const s=n._vtc;s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}u(i5,"patchClass");function r5(n,e,t){const s=n.style,i=Yn(t);if(t&&!i){for(const r in t)x_(s,r,t[r]);if(e&&!Yn(e))for(const r in e)t[r]==null&&x_(s,r,"")}else{const r=s.display;i?e!==t&&(s.cssText=t):e&&n.removeAttribute("style"),"_vod"in n&&(s.display=r)}}u(r5,"patchStyle");const aM=/\s*!important$/;function x_(n,e,t){if(ot(t))t.forEach(s=>x_(n,e,s));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const s=o5(n,e);aM.test(t)?n.setProperty(dc(s),t.replace(aM,""),"important"):n[s]=t}}u(x_,"setStyle");const lM=["Webkit","Moz","ms"],X1={};function o5(n,e){const t=X1[e];if(t)return t;let s=qr(e);if(s!=="filter"&&s in n)return X1[e]=s;s=S0(s);for(let i=0;i<lM.length;i++){const r=lM[i]+s;if(r in n)return X1[e]=r}return e}u(o5,"autoPrefix");const cM="http://www.w3.org/1999/xlink";function a5(n,e,t,s,i){if(s&&e.startsWith("xlink:"))t==null?n.removeAttributeNS(cM,e.slice(6,e.length)):n.setAttributeNS(cM,e,t);else{const r=dN(e);t==null||r&&!gT(t)?n.removeAttribute(e):n.setAttribute(e,r?"":t)}}u(a5,"patchAttr");function l5(n,e,t,s,i,r,o){if(e==="innerHTML"||e==="textContent"){s&&o(s,i,r),n[e]=t==null?"":t;return}if(e==="value"&&n.tagName!=="PROGRESS"&&!n.tagName.includes("-")){n._value=t;const l=t==null?"":t;(n.value!==l||n.tagName==="OPTION")&&(n.value=l),t==null&&n.removeAttribute(e);return}let a=!1;if(t===""||t==null){const l=typeof n[e];l==="boolean"?t=gT(t):t==null&&l==="string"?(t="",a=!0):l==="number"&&(t=0,a=!0)}try{n[e]=t}catch{}a&&n.removeAttribute(e)}u(l5,"patchDOMProp");function Ol(n,e,t,s){n.addEventListener(e,t,s)}u(Ol,"addEventListener");function c5(n,e,t,s){n.removeEventListener(e,t,s)}u(c5,"removeEventListener");function u5(n,e,t,s,i=null){const r=n._vei||(n._vei={}),o=r[e];if(s&&o)o.value=s;else{const[a,l]=h5(e);if(s){const c=r[e]=p5(s,i);Ol(n,a,c,l)}else o&&(c5(n,a,o,l),r[e]=void 0)}}u(u5,"patchEvent");const uM=/(?:Once|Passive|Capture)$/;function h5(n){let e;if(uM.test(n)){e={};let s;for(;s=n.match(uM);)n=n.slice(0,n.length-s[0].length),e[s[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):dc(n.slice(2)),e]}u(h5,"parseName");let Y1=0;const d5=Promise.resolve(),f5=u(()=>Y1||(d5.then(()=>Y1=0),Y1=Date.now()),"getNow");function p5(n,e){const t=u(s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;yr(m5(s,t.value),e,5,[s])},"invoker");return t.value=n,t.attached=f5(),t}u(p5,"createInvoker");function m5(n,e){if(ot(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(s=>i=>!i._stopped&&s&&s(i))}else return e}u(m5,"patchStopImmediatePropagation");const hM=/^on[a-z]/,g5=u((n,e,t,s,i=!1,r,o,a,l)=>{e==="class"?i5(n,s,i):e==="style"?r5(n,t,s):x0(e)?db(e)||u5(n,e,t,s,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):v5(n,e,s,i))?l5(n,e,s,r,o,a,l):(e==="true-value"?n._trueValue=s:e==="false-value"&&(n._falseValue=s),a5(n,e,s,i))},"patchProp");function v5(n,e,t,s){return s?!!(e==="innerHTML"||e==="textContent"||e in n&&hM.test(e)&&yt(t)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA"||hM.test(e)&&Yn(t)?!1:e in n}u(v5,"shouldSetAsProp");const Zg=u(n=>{const e=n.props["onUpdate:modelValue"]||!1;return ot(e)?t=>Rg(e,t):e},"getModelAssigner");function y5(n){n.target.composing=!0}u(y5,"onCompositionStart");function dM(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}u(dM,"onCompositionEnd");const Pl={created(n,{modifiers:{lazy:e,trim:t,number:s}},i){n._assign=Zg(i);const r=s||i.props&&i.props.type==="number";Ol(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),r&&(a=wf(a)),n._assign(a)}),t&&Ol(n,"change",()=>{n.value=n.value.trim()}),e||(Ol(n,"compositionstart",y5),Ol(n,"compositionend",dM),Ol(n,"change",dM))},mounted(n,{value:e}){n.value=e==null?"":e},beforeUpdate(n,{value:e,modifiers:{lazy:t,trim:s,number:i}},r){if(n._assign=Zg(r),n.composing||document.activeElement===n&&n.type!=="range"&&(t||s&&n.value.trim()===e||(i||n.type==="number")&&wf(n.value)===e))return;const o=e==null?"":e;n.value!==o&&(n.value=o)}},il={deep:!0,created(n,{value:e,modifiers:{number:t}},s){const i=A0(e);Ol(n,"change",()=>{const r=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>t?wf(Qg(o)):Qg(o));n._assign(n.multiple?i?new Set(r):r:r[0])}),n._assign=Zg(s)},mounted(n,{value:e}){fM(n,e)},beforeUpdate(n,e,t){n._assign=Zg(t)},updated(n,{value:e}){fM(n,e)}};function fM(n,e){const t=n.multiple;if(!(t&&!ot(e)&&!A0(e))){for(let s=0,i=n.options.length;s<i;s++){const r=n.options[s],o=Qg(r);if(t)ot(e)?r.selected=pN(e,o)>-1:r.selected=e.has(o);else if(w0(Qg(r),e)){n.selectedIndex!==s&&(n.selectedIndex=s);return}}!t&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}u(fM,"setSelected");function Qg(n){return"_value"in n?n._value:n.value}u(Qg,"getValue");const _5=["ctrl","shift","alt","meta"],b5={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,e)=>_5.some(t=>n[`${t}Key`]&&!e.includes(t))},Hn=u((n,e)=>(t,...s)=>{for(let i=0;i<e.length;i++){const r=b5[e[i]];if(r&&r(t,e))return}return n(t,...s)},"withModifiers"),w5={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Ln=u((n,e)=>t=>{if(!("key"in t))return;const s=dc(t.key);if(e.some(i=>i===s||w5[i]===s))return n(t)},"withKeys"),Pp={beforeMount(n,{value:e},{transition:t}){n._vod=n.style.display==="none"?"":n.style.display,t&&e?t.beforeEnter(n):kh(n,e)},mounted(n,{value:e},{transition:t}){t&&e&&t.enter(n)},updated(n,{value:e,oldValue:t},{transition:s}){!e!=!t&&(s?e?(s.beforeEnter(n),kh(n,!0),s.enter(n)):s.leave(n,()=>{kh(n,!1)}):kh(n,e))},beforeUnmount(n,{value:e}){kh(n,e)}};function kh(n,e){n.style.display=e?n._vod:"none"}u(kh,"setDisplay");const x5=ni({patchProp:g5},s5);let pM;function A5(){return pM||(pM=k4(x5))}u(A5,"ensureRenderer");const pP=u((...n)=>{const e=A5().createApp(...n),{mount:t}=e;return e.mount=s=>{const i=M5(s);if(!i)return;const r=e._component;!yt(r)&&!r.render&&!r.template&&(r.template=i.innerHTML),i.innerHTML="";const o=t(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),o},e},"createApp");function M5(n){return Yn(n)?document.querySelector(n):n}u(M5,"normalizeContainer");var S5=Object.defineProperty,q1=u((n,e)=>S5(n,"name",{value:e,configurable:!0}),"__name$3z"),C5=Ht({setup(){const n=Es("errorSignal"),e=Ne(""),t=Ne(!1),s=q1(o=>{console.error(o),o instanceof Error?e.value=o.stack+"":e.value=o+"",t.value=!0},"showErrorMessageWindow"),i=q1(o=>{s(o.error)},"onError"),r=q1(o=>{s(o.reason)},"onUnhandledRejection");return n.addListener(s),window.addEventListener("error",i),window.addEventListener("unhandledrejection",r),L0(()=>{n.removeListener(s),window.removeEventListener("error",i),window.removeEventListener("unhandledrejection",r)}),{errorMessage:e,errorMessageWindowVisible:t}}});var jt=u((n,e)=>{const t=n.__vccOpts||n;for(const[s,i]of e)t[s]=i;return t},"_export_sfc");const E5=u(n=>(Ga("data-v-18bfa632"),n=n(),Ha(),n),"_withScopeId$7"),T5={key:0,class:"dialog-mask"},P5={class:"dialog"},R5=E5(()=>j("div",{style:{"margin-bottom":".25em"}},"An error occurred.",-1)),I5={readonly:""},D5={style:{"text-align":"right"}};function L5(n,e,t,s,i,r){const o=ln("router-view");return Se(),Oe(Dt,null,[we(o),n.errorMessageWindowVisible?(Se(),Oe("div",T5,[j("div",P5,[R5,j("textarea",I5,un(n.errorMessage),1),j("div",D5,[j("button",{onClick:e[0]||(e[0]=a=>n.errorMessageWindowVisible=!1)},"Close")])])])):tt("",!0)],64)}u(L5,"_sfc_render$v");var O5=jt(C5,[["render",L5],["__scopeId","data-v-18bfa632"]]),k5=Object.defineProperty,N5=u((n,e)=>k5(n,"name",{value:e,configurable:!0}),"__name$3y");class Pb{constructor(){A(this,"listeners",[])}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.findIndex(s=>s===e);t>=0&&this.listeners.splice(t,1)}dispatch(e){this.listeners.forEach(t=>t(e))}}u(Pb,"Signal");N5(Pb,"Signal");/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const au=typeof window!="undefined";function F5(n){return n.__esModule||n[Symbol.toStringTag]==="Module"}u(F5,"isESModule");const en=Object.assign;function K1(n,e){const t={};for(const s in e){const i=e[s];t[s]=xr(i)?i.map(n):n(i)}return t}u(K1,"applyToParams");const lf=u(()=>{},"noop"),xr=Array.isArray,z5=/\/$/,B5=u(n=>n.replace(z5,""),"removeTrailingSlash");function Z1(n,e,t="/"){let s,i={},r="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(s=e.slice(0,l),r=e.slice(l+1,a>-1?a:e.length),i=n(r)),a>-1&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=G5(s!=null?s:e,t),{fullPath:s+(r&&"?")+r+o,path:s,query:i,hash:o}}u(Z1,"parseURL");function U5(n,e){const t=e.query?n(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}u(U5,"stringifyURL");function mM(n,e){return!e||!n.toLowerCase().startsWith(e.toLowerCase())?n:n.slice(e.length)||"/"}u(mM,"stripBase");function $5(n,e,t){const s=e.matched.length-1,i=t.matched.length-1;return s>-1&&s===i&&Du(e.matched[s],t.matched[i])&&mP(e.params,t.params)&&n(e.query)===n(t.query)&&e.hash===t.hash}u($5,"isSameRouteLocation");function Du(n,e){return(n.aliasOf||n)===(e.aliasOf||e)}u(Du,"isSameRouteRecord");function mP(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(!V5(n[t],e[t]))return!1;return!0}u(mP,"isSameRouteLocationParams");function V5(n,e){return xr(n)?gM(n,e):xr(e)?gM(e,n):n===e}u(V5,"isSameRouteLocationParamsValue");function gM(n,e){return xr(e)?n.length===e.length&&n.every((t,s)=>t===e[s]):n.length===1&&n[0]===e}u(gM,"isEquivalentArray");function G5(n,e){if(n.startsWith("/"))return n;if(!n)return e;const t=e.split("/"),s=n.split("/");let i=t.length-1,r,o;for(r=0;r<s.length;r++)if(o=s[r],o!==".")if(o==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+s.slice(r-(r===s.length?1:0)).join("/")}u(G5,"resolveRelativePath");var Ef;(function(n){n.pop="pop",n.push="push"})(Ef||(Ef={}));var cf;(function(n){n.back="back",n.forward="forward",n.unknown=""})(cf||(cf={}));function H5(n){if(!n)if(au){const e=document.querySelector("base");n=e&&e.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),B5(n)}u(H5,"normalizeBase");const W5=/^[^#]+#/;function j5(n,e){return n.replace(W5,"#")+e}u(j5,"createHref");function X5(n,e){const t=document.documentElement.getBoundingClientRect(),s=n.getBoundingClientRect();return{behavior:e.behavior,left:s.left-t.left-(e.left||0),top:s.top-t.top-(e.top||0)}}u(X5,"getElementPosition");const F0=u(()=>({left:window.pageXOffset,top:window.pageYOffset}),"computeScrollPosition");function Y5(n){let e;if("el"in n){const t=n.el,s=typeof t=="string"&&t.startsWith("#"),i=typeof t=="string"?s?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!i)return;e=X5(i,n)}else e=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}u(Y5,"scrollToPosition");function vM(n,e){return(history.state?history.state.position-e:-1)+n}u(vM,"getScrollKey");const A_=new Map;function q5(n,e){A_.set(n,e)}u(q5,"saveScrollPosition");function K5(n){const e=A_.get(n);return A_.delete(n),e}u(K5,"getSavedScrollPosition");let Z5=u(()=>location.protocol+"//"+location.host,"createBaseLocation");function gP(n,e){const{pathname:t,search:s,hash:i}=e,r=n.indexOf("#");if(r>-1){let a=i.includes(n.slice(r))?n.slice(r).length:1,l=i.slice(a);return l[0]!=="/"&&(l="/"+l),mM(l,"")}return mM(t,n)+s+i}u(gP,"createCurrentLocation");function Q5(n,e,t,s){let i=[],r=[],o=null;const a=u(({state:f})=>{const p=gP(n,location),g=t.value,m=e.value;let v=0;if(f){if(t.value=p,e.value=f,o&&o===g){o=null;return}v=m?f.position-m.position:0}else s(p);i.forEach(y=>{y(t.value,g,{delta:v,type:Ef.pop,direction:v?v>0?cf.forward:cf.back:cf.unknown})})},"popStateHandler");function l(){o=t.value}u(l,"pauseListeners");function c(f){i.push(f);const p=u(()=>{const g=i.indexOf(f);g>-1&&i.splice(g,1)},"teardown");return r.push(p),p}u(c,"listen");function h(){const{history:f}=window;!f.state||f.replaceState(en({},f.state,{scroll:F0()}),"")}u(h,"beforeUnloadListener");function d(){for(const f of r)f();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",h)}return u(d,"destroy"),window.addEventListener("popstate",a),window.addEventListener("beforeunload",h),{pauseListeners:l,listen:c,destroy:d}}u(Q5,"useHistoryListeners");function yM(n,e,t,s=!1,i=!1){return{back:n,current:e,forward:t,replaced:s,position:window.history.length,scroll:i?F0():null}}u(yM,"buildState");function J5(n){const{history:e,location:t}=window,s={value:gP(n,t)},i={value:e.state};i.value||r(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(l,c,h){const d=n.indexOf("#"),f=d>-1?(t.host&&document.querySelector("base")?n:n.slice(d))+l:Z5()+n+l;try{e[h?"replaceState":"pushState"](c,"",f),i.value=c}catch(p){console.error(p),t[h?"replace":"assign"](f)}}u(r,"changeLocation");function o(l,c){const h=en({},e.state,yM(i.value.back,l,i.value.forward,!0),c,{position:i.value.position});r(l,h,!0),s.value=l}u(o,"replace");function a(l,c){const h=en({},i.value,e.state,{forward:l,scroll:F0()});r(h.current,h,!0);const d=en({},yM(s.value,l,null),{position:h.position+1},c);r(l,d,!1),s.value=l}return u(a,"push"),{location:s,state:i,push:a,replace:o}}u(J5,"useHistoryStateNavigation");function eF(n){n=H5(n);const e=J5(n),t=Q5(n,e.state,e.location,e.replace);function s(r,o=!0){o||t.pauseListeners(),history.go(r)}u(s,"go");const i=en({location:"",base:n,go:s,createHref:j5.bind(null,n)},e,t);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>e.state.value}),i}u(eF,"createWebHistory");function tF(n){return n=location.host?n||location.pathname+location.search:"",n.includes("#")||(n+="#"),eF(n)}u(tF,"createWebHashHistory");function nF(n){return typeof n=="string"||n&&typeof n=="object"}u(nF,"isRouteLocation");function vP(n){return typeof n=="string"||typeof n=="symbol"}u(vP,"isRouteName");const Qo={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},yP=Symbol("");var _M;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(_M||(_M={}));function Lu(n,e){return en(new Error,{type:n,[yP]:!0},e)}u(Lu,"createRouterError");function Jr(n,e){return n instanceof Error&&yP in n&&(e==null||!!(n.type&e))}u(Jr,"isNavigationFailure");const bM="[^/]+?",sF={sensitive:!1,strict:!1,start:!0,end:!0},iF=/[.+*?^${}()[\]/\\]/g;function rF(n,e){const t=en({},sF,e),s=[];let i=t.start?"^":"";const r=[];for(const c of n){const h=c.length?[]:[90];t.strict&&!c.length&&(i+="/");for(let d=0;d<c.length;d++){const f=c[d];let p=40+(t.sensitive?.25:0);if(f.type===0)d||(i+="/"),i+=f.value.replace(iF,"\\$&"),p+=40;else if(f.type===1){const{value:g,repeatable:m,optional:v,regexp:y}=f;r.push({name:g,repeatable:m,optional:v});const b=y||bM;if(b!==bM){p+=10;try{new RegExp(`(${b})`)}catch(w){throw new Error(`Invalid custom RegExp for param "${g}" (${b}): `+w.message)}}let _=m?`((?:${b})(?:/(?:${b}))*)`:`(${b})`;d||(_=v&&c.length<2?`(?:/${_})`:"/"+_),v&&(_+="?"),i+=_,p+=20,v&&(p+=-8),m&&(p+=-20),b===".*"&&(p+=-50)}h.push(p)}s.push(h)}if(t.strict&&t.end){const c=s.length-1;s[c][s[c].length-1]+=.7000000000000001}t.strict||(i+="/?"),t.end?i+="$":t.strict&&(i+="(?:/|$)");const o=new RegExp(i,t.sensitive?"":"i");function a(c){const h=c.match(o),d={};if(!h)return null;for(let f=1;f<h.length;f++){const p=h[f]||"",g=r[f-1];d[g.name]=p&&g.repeatable?p.split("/"):p}return d}u(a,"parse");function l(c){let h="",d=!1;for(const f of n){(!d||!h.endsWith("/"))&&(h+="/"),d=!1;for(const p of f)if(p.type===0)h+=p.value;else if(p.type===1){const{value:g,repeatable:m,optional:v}=p,y=g in c?c[g]:"";if(xr(y)&&!m)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const b=xr(y)?y.join("/"):y;if(!b)if(v)f.length<2&&(h.endsWith("/")?h=h.slice(0,-1):d=!0);else throw new Error(`Missing required param "${g}"`);h+=b}}return h||"/"}return u(l,"stringify"),{re:o,score:s,keys:r,parse:a,stringify:l}}u(rF,"tokensToParser");function oF(n,e){let t=0;for(;t<n.length&&t<e.length;){const s=e[t]-n[t];if(s)return s;t++}return n.length<e.length?n.length===1&&n[0]===40+40?-1:1:n.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}u(oF,"compareScoreArray");function aF(n,e){let t=0;const s=n.score,i=e.score;for(;t<s.length&&t<i.length;){const r=oF(s[t],i[t]);if(r)return r;t++}if(Math.abs(i.length-s.length)===1){if(wM(s))return 1;if(wM(i))return-1}return i.length-s.length}u(aF,"comparePathParserScore");function wM(n){const e=n[n.length-1];return n.length>0&&e[e.length-1]<0}u(wM,"isLastScoreNegative");const lF={type:0,value:""},cF=/[a-zA-Z0-9_]/;function uF(n){if(!n)return[[]];if(n==="/")return[[lF]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function e(p){throw new Error(`ERR (${t})/"${c}": ${p}`)}u(e,"crash");let t=0,s=t;const i=[];let r;function o(){r&&i.push(r),r=[]}u(o,"finalizeSegment");let a=0,l,c="",h="";function d(){!c||(t===0?r.push({type:0,value:c}):t===1||t===2||t===3?(r.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:h,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}u(d,"consumeBuffer");function f(){c+=l}for(u(f,"addCharToBuffer");a<n.length;){if(l=n[a++],l==="\\"&&t!==2){s=t,t=4;continue}switch(t){case 0:l==="/"?(c&&d(),o()):l===":"?(d(),t=1):f();break;case 4:f(),t=s;break;case 1:l==="("?t=2:cF.test(l)?f():(d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?h[h.length-1]=="\\"?h=h.slice(0,-1)+l:t=3:h+=l;break;case 3:d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,h="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),d(),o(),i}u(uF,"tokenizePath");function hF(n,e,t){const s=rF(uF(n.path),t),i=en(s,{record:n,parent:e,children:[],alias:[]});return e&&!i.record.aliasOf==!e.record.aliasOf&&e.children.push(i),i}u(hF,"createRouteRecordMatcher");function dF(n,e){const t=[],s=new Map;e=MM({strict:!1,end:!0,sensitive:!1},e);function i(h){return s.get(h)}u(i,"getRecordMatcher");function r(h,d,f){const p=!f,g=fF(h);g.aliasOf=f&&f.record;const m=MM(e,h),v=[g];if("alias"in h){const _=typeof h.alias=="string"?[h.alias]:h.alias;for(const w of _)v.push(en({},g,{components:f?f.record.components:g.components,path:w,aliasOf:f?f.record:g}))}let y,b;for(const _ of v){const{path:w}=_;if(d&&w[0]!=="/"){const x=d.record.path,S=x[x.length-1]==="/"?"":"/";_.path=d.record.path+(w&&S+w)}if(y=hF(_,d,m),f?f.alias.push(y):(b=b||y,b!==y&&b.alias.push(y),p&&h.name&&!AM(y)&&o(h.name)),g.children){const x=g.children;for(let S=0;S<x.length;S++)r(x[S],y,f&&f.children[S])}f=f||y,(y.record.components&&Object.keys(y.record.components).length||y.record.name||y.record.redirect)&&l(y)}return b?()=>{o(b)}:lf}u(r,"addRoute");function o(h){if(vP(h)){const d=s.get(h);d&&(s.delete(h),t.splice(t.indexOf(d),1),d.children.forEach(o),d.alias.forEach(o))}else{const d=t.indexOf(h);d>-1&&(t.splice(d,1),h.record.name&&s.delete(h.record.name),h.children.forEach(o),h.alias.forEach(o))}}u(o,"removeRoute");function a(){return t}u(a,"getRoutes");function l(h){let d=0;for(;d<t.length&&aF(h,t[d])>=0&&(h.record.path!==t[d].record.path||!_P(h,t[d]));)d++;t.splice(d,0,h),h.record.name&&!AM(h)&&s.set(h.record.name,h)}u(l,"insertMatcher");function c(h,d){let f,p={},g,m;if("name"in h&&h.name){if(f=s.get(h.name),!f)throw Lu(1,{location:h});m=f.record.name,p=en(xM(d.params,f.keys.filter(b=>!b.optional).map(b=>b.name)),h.params&&xM(h.params,f.keys.map(b=>b.name))),g=f.stringify(p)}else if("path"in h)g=h.path,f=t.find(b=>b.re.test(g)),f&&(p=f.parse(g),m=f.record.name);else{if(f=d.name?s.get(d.name):t.find(b=>b.re.test(d.path)),!f)throw Lu(1,{location:h,currentLocation:d});m=f.record.name,p=en({},d.params,h.params),g=f.stringify(p)}const v=[];let y=f;for(;y;)v.unshift(y.record),y=y.parent;return{name:m,path:g,params:p,matched:v,meta:mF(v)}}return u(c,"resolve"),n.forEach(h=>r(h)),{addRoute:r,resolve:c,removeRoute:o,getRoutes:a,getRecordMatcher:i}}u(dF,"createRouterMatcher");function xM(n,e){const t={};for(const s of e)s in n&&(t[s]=n[s]);return t}u(xM,"paramsFromLocation");function fF(n){return{path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:void 0,beforeEnter:n.beforeEnter,props:pF(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}}}u(fF,"normalizeRouteRecord");function pF(n){const e={},t=n.props||!1;if("component"in n)e.default=t;else for(const s in n.components)e[s]=typeof t=="boolean"?t:t[s];return e}u(pF,"normalizeRecordProps");function AM(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}u(AM,"isAliasRecord");function mF(n){return n.reduce((e,t)=>en(e,t.meta),{})}u(mF,"mergeMetaFields");function MM(n,e){const t={};for(const s in n)t[s]=s in e?e[s]:n[s];return t}u(MM,"mergeOptions");function _P(n,e){return e.children.some(t=>t===n||_P(n,t))}u(_P,"isRecordChildOf");const bP=/#/g,gF=/&/g,vF=/\//g,yF=/=/g,_F=/\?/g,wP=/\+/g,bF=/%5B/g,wF=/%5D/g,xP=/%5E/g,xF=/%60/g,AP=/%7B/g,AF=/%7C/g,MP=/%7D/g,MF=/%20/g;function Rb(n){return encodeURI(""+n).replace(AF,"|").replace(bF,"[").replace(wF,"]")}u(Rb,"commonEncode");function SF(n){return Rb(n).replace(AP,"{").replace(MP,"}").replace(xP,"^")}u(SF,"encodeHash");function M_(n){return Rb(n).replace(wP,"%2B").replace(MF,"+").replace(bP,"%23").replace(gF,"%26").replace(xF,"`").replace(AP,"{").replace(MP,"}").replace(xP,"^")}u(M_,"encodeQueryValue");function CF(n){return M_(n).replace(yF,"%3D")}u(CF,"encodeQueryKey");function EF(n){return Rb(n).replace(bP,"%23").replace(_F,"%3F")}u(EF,"encodePath");function TF(n){return n==null?"":EF(n).replace(vF,"%2F")}u(TF,"encodeParam");function Jg(n){try{return decodeURIComponent(""+n)}catch{}return""+n}u(Jg,"decode");function PF(n){const e={};if(n===""||n==="?")return e;const s=(n[0]==="?"?n.slice(1):n).split("&");for(let i=0;i<s.length;++i){const r=s[i].replace(wP," "),o=r.indexOf("="),a=Jg(o<0?r:r.slice(0,o)),l=o<0?null:Jg(r.slice(o+1));if(a in e){let c=e[a];xr(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}u(PF,"parseQuery");function SM(n){let e="";for(let t in n){const s=n[t];if(t=CF(t),s==null){s!==void 0&&(e+=(e.length?"&":"")+t);continue}(xr(s)?s.map(r=>r&&M_(r)):[s&&M_(s)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}u(SM,"stringifyQuery");function RF(n){const e={};for(const t in n){const s=n[t];s!==void 0&&(e[t]=xr(s)?s.map(i=>i==null?null:""+i):s==null?s:""+s)}return e}u(RF,"normalizeQuery");const IF=Symbol(""),CM=Symbol(""),z0=Symbol(""),SP=Symbol(""),S_=Symbol("");function Nh(){let n=[];function e(s){return n.push(s),()=>{const i=n.indexOf(s);i>-1&&n.splice(i,1)}}u(e,"add");function t(){n=[]}return u(t,"reset"),{add:e,list:()=>n,reset:t}}u(Nh,"useCallbacks");function Ea(n,e,t,s,i){const r=s&&(s.enterCallbacks[i]=s.enterCallbacks[i]||[]);return()=>new Promise((o,a)=>{const l=u(d=>{d===!1?a(Lu(4,{from:t,to:e})):d instanceof Error?a(d):nF(d)?a(Lu(2,{from:e,to:d})):(r&&s.enterCallbacks[i]===r&&typeof d=="function"&&r.push(d),o())},"next"),c=n.call(s&&s.instances[i],e,t,l);let h=Promise.resolve(c);n.length<3&&(h=h.then(l)),h.catch(d=>a(d))})}u(Ea,"guardToPromiseFn");function Q1(n,e,t,s){const i=[];for(const r of n)for(const o in r.components){let a=r.components[o];if(!(e!=="beforeRouteEnter"&&!r.instances[o]))if(DF(a)){const c=(a.__vccOpts||a)[e];c&&i.push(Ea(c,t,s,r,o))}else{let l=a();i.push(()=>l.then(c=>{if(!c)return Promise.reject(new Error(`Couldn't resolve component "${o}" at "${r.path}"`));const h=F5(c)?c.default:c;r.components[o]=h;const f=(h.__vccOpts||h)[e];return f&&Ea(f,t,s,r,o)()}))}}return i}u(Q1,"extractComponentsGuards");function DF(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}u(DF,"isRouteComponent");function EM(n){const e=Es(z0),t=Es(SP),s=ct(()=>e.resolve(Au(n.to))),i=ct(()=>{const{matched:l}=s.value,{length:c}=l,h=l[c-1],d=t.matched;if(!h||!d.length)return-1;const f=d.findIndex(Du.bind(null,h));if(f>-1)return f;const p=TM(l[c-2]);return c>1&&TM(h)===p&&d[d.length-1].path!==p?d.findIndex(Du.bind(null,l[c-2])):f}),r=ct(()=>i.value>-1&&NF(t.params,s.value.params)),o=ct(()=>i.value>-1&&i.value===t.matched.length-1&&mP(t.params,s.value.params));function a(l={}){return kF(l)?e[Au(n.replace)?"replace":"push"](Au(n.to)).catch(lf):Promise.resolve()}return u(a,"navigate"),{route:s,href:ct(()=>s.value.href),isActive:r,isExactActive:o,navigate:a}}u(EM,"useLink");const LF=Ht({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:EM,setup(n,{slots:e}){const t=Oo(EM(n)),{options:s}=Es(z0),i=ct(()=>({[PM(n.activeClass,s.linkActiveClass,"router-link-active")]:t.isActive,[PM(n.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&e.default(t);return n.custom?r:fP("a",{"aria-current":t.isExactActive?n.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:i.value},r)}}}),OF=LF;function kF(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const e=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return n.preventDefault&&n.preventDefault(),!0}}u(kF,"guardEvent");function NF(n,e){for(const t in e){const s=e[t],i=n[t];if(typeof s=="string"){if(s!==i)return!1}else if(!xr(i)||i.length!==s.length||s.some((r,o)=>r!==i[o]))return!1}return!0}u(NF,"includesParams");function TM(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}u(TM,"getOriginalPath");const PM=u((n,e,t)=>n!=null?n:e!=null?e:t,"getLinkClass"),FF=Ht({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:e,slots:t}){const s=Es(S_),i=ct(()=>n.route||s.value),r=Es(CM,0),o=ct(()=>{let c=Au(r);const{matched:h}=i.value;let d;for(;(d=h[c])&&!d.components;)c++;return c}),a=ct(()=>i.value.matched[o.value]);Hl(CM,ct(()=>o.value+1)),Hl(IF,a),Hl(S_,i);const l=Ne();return Ts(()=>[l.value,a.value,n.name],([c,h,d],[f,p,g])=>{h&&(h.instances[d]=c,p&&p!==h&&c&&c===f&&(h.leaveGuards.size||(h.leaveGuards=p.leaveGuards),h.updateGuards.size||(h.updateGuards=p.updateGuards))),c&&h&&(!p||!Du(h,p)||!f)&&(h.enterCallbacks[d]||[]).forEach(m=>m(c))},{flush:"post"}),()=>{const c=i.value,h=n.name,d=a.value,f=d&&d.components[h];if(!f)return RM(t.default,{Component:f,route:c});const p=d.props[h],g=p?p===!0?c.params:typeof p=="function"?p(c):p:null,v=fP(f,en({},g,e,{onVnodeUnmounted:u(y=>{y.component.isUnmounted&&(d.instances[h]=null)},"onVnodeUnmounted"),ref:l}));return RM(t.default,{Component:v,route:c})||v}}});function RM(n,e){if(!n)return null;const t=n(e);return t.length===1?t[0]:t}u(RM,"normalizeSlot");const zF=FF;function BF(n){const e=dF(n.routes,n),t=n.parseQuery||PF,s=n.stringifyQuery||SM,i=n.history,r=Nh(),o=Nh(),a=Nh(),l=qN(Qo);let c=Qo;au&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const h=K1.bind(null,Q=>""+Q),d=K1.bind(null,TF),f=K1.bind(null,Jg);function p(Q,te){let _e,pe;return vP(Q)?(_e=e.getRecordMatcher(Q),pe=te):pe=Q,e.addRoute(pe,_e)}u(p,"addRoute");function g(Q){const te=e.getRecordMatcher(Q);te&&e.removeRoute(te)}u(g,"removeRoute");function m(){return e.getRoutes().map(Q=>Q.record)}u(m,"getRoutes");function v(Q){return!!e.getRecordMatcher(Q)}u(v,"hasRoute");function y(Q,te){if(te=en({},te||l.value),typeof Q=="string"){const $=Z1(t,Q,te.path),X=e.resolve({path:$.path},te),I=i.createHref($.fullPath);return en($,X,{params:f(X.params),hash:Jg($.hash),redirectedFrom:void 0,href:I})}let _e;if("path"in Q)_e=en({},Q,{path:Z1(t,Q.path,te.path).path});else{const $=en({},Q.params);for(const X in $)$[X]==null&&delete $[X];_e=en({},Q,{params:d(Q.params)}),te.params=d(te.params)}const pe=e.resolve(_e,te),Ae=Q.hash||"";pe.params=h(f(pe.params));const Me=U5(s,en({},Q,{hash:SF(Ae),path:pe.path})),Ie=i.createHref(Me);return en({fullPath:Me,hash:Ae,query:s===SM?RF(Q.query):Q.query||{}},pe,{redirectedFrom:void 0,href:Ie})}u(y,"resolve");function b(Q){return typeof Q=="string"?Z1(t,Q,l.value.path):en({},Q)}u(b,"locationAsObject");function _(Q,te){if(c!==Q)return Lu(8,{from:te,to:Q})}u(_,"checkCanceledNavigation");function w(Q){return C(Q)}u(w,"push");function x(Q){return w(en(b(Q),{replace:!0}))}u(x,"replace");function S(Q){const te=Q.matched[Q.matched.length-1];if(te&&te.redirect){const{redirect:_e}=te;let pe=typeof _e=="function"?_e(Q):_e;return typeof pe=="string"&&(pe=pe.includes("?")||pe.includes("#")?pe=b(pe):{path:pe},pe.params={}),en({query:Q.query,hash:Q.hash,params:"path"in pe?{}:Q.params},pe)}}u(S,"handleRedirectRecord");function C(Q,te){const _e=c=y(Q),pe=l.value,Ae=Q.state,Me=Q.force,Ie=Q.replace===!0,$=S(_e);if($)return C(en(b($),{state:typeof $=="object"?en({},Ae,$.state):Ae,force:Me,replace:Ie}),te||_e);const X=_e;X.redirectedFrom=te;let I;return!Me&&$5(s,pe,_e)&&(I=Lu(16,{to:X,from:pe}),se(pe,pe,!0,!1)),(I?Promise.resolve(I):R(X,pe)).catch(J=>Jr(J)?Jr(J,2)?J:W(J):q(J,X,pe)).then(J=>{if(J){if(Jr(J,2))return C(en({replace:Ie},b(J.to),{state:typeof J.to=="object"?en({},Ae,J.to.state):Ae,force:Me}),te||X)}else J=k(X,pe,!0,Ie,Ae);return D(X,pe,J),J})}u(C,"pushWithRedirect");function M(Q,te){const _e=_(Q,te);return _e?Promise.reject(_e):Promise.resolve()}u(M,"checkCanceledNavigationAndReject");function R(Q,te){let _e;const[pe,Ae,Me]=UF(Q,te);_e=Q1(pe.reverse(),"beforeRouteLeave",Q,te);for(const $ of pe)$.leaveGuards.forEach(X=>{_e.push(Ea(X,Q,te))});const Ie=M.bind(null,Q,te);return _e.push(Ie),xc(_e).then(()=>{_e=[];for(const $ of r.list())_e.push(Ea($,Q,te));return _e.push(Ie),xc(_e)}).then(()=>{_e=Q1(Ae,"beforeRouteUpdate",Q,te);for(const $ of Ae)$.updateGuards.forEach(X=>{_e.push(Ea(X,Q,te))});return _e.push(Ie),xc(_e)}).then(()=>{_e=[];for(const $ of Q.matched)if($.beforeEnter&&!te.matched.includes($))if(xr($.beforeEnter))for(const X of $.beforeEnter)_e.push(Ea(X,Q,te));else _e.push(Ea($.beforeEnter,Q,te));return _e.push(Ie),xc(_e)}).then(()=>(Q.matched.forEach($=>$.enterCallbacks={}),_e=Q1(Me,"beforeRouteEnter",Q,te),_e.push(Ie),xc(_e))).then(()=>{_e=[];for(const $ of o.list())_e.push(Ea($,Q,te));return _e.push(Ie),xc(_e)}).catch($=>Jr($,8)?$:Promise.reject($))}u(R,"navigate");function D(Q,te,_e){for(const pe of a.list())pe(Q,te,_e)}u(D,"triggerAfterEach");function k(Q,te,_e,pe,Ae){const Me=_(Q,te);if(Me)return Me;const Ie=te===Qo,$=au?history.state:{};_e&&(pe||Ie?i.replace(Q.fullPath,en({scroll:Ie&&$&&$.scroll},Ae)):i.push(Q.fullPath,Ae)),l.value=Q,se(Q,te,_e,Ie),W()}u(k,"finalizeNavigation");let T;function N(){T||(T=i.listen((Q,te,_e)=>{if(!ue.listening)return;const pe=y(Q),Ae=S(pe);if(Ae){C(en(Ae,{replace:!0}),pe).catch(lf);return}c=pe;const Me=l.value;au&&q5(vM(Me.fullPath,_e.delta),F0()),R(pe,Me).catch(Ie=>Jr(Ie,12)?Ie:Jr(Ie,2)?(C(Ie.to,pe).then($=>{Jr($,20)&&!_e.delta&&_e.type===Ef.pop&&i.go(-1,!1)}).catch(lf),Promise.reject()):(_e.delta&&i.go(-_e.delta,!1),q(Ie,pe,Me))).then(Ie=>{Ie=Ie||k(pe,Me,!1),Ie&&(_e.delta&&!Jr(Ie,8)?i.go(-_e.delta,!1):_e.type===Ef.pop&&Jr(Ie,20)&&i.go(-1,!1)),D(pe,Me,Ie)}).catch(lf)}))}u(N,"setupListeners");let E=Nh(),z=Nh(),H;function q(Q,te,_e){W(Q);const pe=z.list();return pe.length?pe.forEach(Ae=>Ae(Q,te,_e)):console.error(Q),Promise.reject(Q)}u(q,"triggerError");function ne(){return H&&l.value!==Qo?Promise.resolve():new Promise((Q,te)=>{E.add([Q,te])})}u(ne,"isReady");function W(Q){return H||(H=!Q,N(),E.list().forEach(([te,_e])=>Q?_e(Q):te()),E.reset()),Q}u(W,"markAsReady");function se(Q,te,_e,pe){const{scrollBehavior:Ae}=n;if(!au||!Ae)return Promise.resolve();const Me=!_e&&K5(vM(Q.fullPath,0))||(pe||!_e)&&history.state&&history.state.scroll||null;return Ri().then(()=>Ae(Q,te,Me)).then(Ie=>Ie&&Y5(Ie)).catch(Ie=>q(Ie,Q,te))}u(se,"handleScroll");const K=u(Q=>i.go(Q),"go");let U;const he=new Set,ue={currentRoute:l,listening:!0,addRoute:p,removeRoute:g,hasRoute:v,getRoutes:m,resolve:y,options:n,push:w,replace:x,go:K,back:()=>K(-1),forward:()=>K(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:z.add,isReady:ne,install(Q){const te=this;Q.component("RouterLink",OF),Q.component("RouterView",zF),Q.config.globalProperties.$router=te,Object.defineProperty(Q.config.globalProperties,"$route",{enumerable:!0,get:()=>Au(l)}),au&&!U&&l.value===Qo&&(U=!0,w(i.location).catch(Ae=>{}));const _e={};for(const Ae in Qo)_e[Ae]=ct(()=>l.value[Ae]);Q.provide(z0,te),Q.provide(SP,Oo(_e)),Q.provide(S_,l);const pe=Q.unmount;he.add(Q),Q.unmount=function(){he.delete(Q),he.size<1&&(c=Qo,T&&T(),T=null,l.value=Qo,U=!1,H=!1),pe()}}};return ue}u(BF,"createRouter");function xc(n){return n.reduce((e,t)=>e.then(()=>t()),Promise.resolve())}u(xc,"runGuardQueue");function UF(n,e){const t=[],s=[],i=[],r=Math.max(e.matched.length,n.matched.length);for(let o=0;o<r;o++){const a=e.matched[o];a&&(n.matched.find(c=>Du(c,a))?s.push(a):t.push(a));const l=n.matched[o];l&&(e.matched.find(c=>Du(c,l))||i.push(l))}return[t,s,i]}u(UF,"extractChangingRecords");function $F(){return Es(z0)}u($F,"useRouter");/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ib="146",VF=0,IM=1,GF=2,CP=1,EP=2,jd=3,ql=0,Ki=1,Di=2,jr=0,Su=1,C_=2,DM=3,LM=4,HF=5,lu=100,WF=101,jF=102,OM=103,kM=104,XF=200,YF=201,qF=202,KF=203,TP=204,PP=205,ZF=206,QF=207,JF=208,ez=209,tz=210,nz=0,sz=1,iz=2,E_=3,rz=4,oz=5,az=6,lz=7,B0=0,cz=1,uz=2,Xr=0,hz=1,dz=2,fz=3,pz=4,mz=5,RP=300,Ou=301,ku=302,e0=303,T_=304,U0=306,zo=1e3,Ks=1001,Tf=1002,Wn=1003,t0=1004,n0=1005,qs=1006,Db=1007,fc=1008,Kl=1009,gz=1010,vz=1011,IP=1012,yz=1013,Bl=1014,Ra=1015,Nu=1016,_z=1017,bz=1018,Cu=1020,wz=1021,xz=1022,Ii=1023,Az=1024,Mz=1025,jl=1026,Fu=1027,Sz=1028,Cz=1029,Ez=1030,Tz=1031,Pz=1033,J1=33776,ev=33777,tv=33778,nv=33779,NM=35840,FM=35841,zM=35842,BM=35843,Rz=36196,UM=37492,$M=37496,VM=37808,GM=37809,HM=37810,WM=37811,jM=37812,XM=37813,YM=37814,qM=37815,KM=37816,ZM=37817,QM=37818,JM=37819,e2=37820,t2=37821,n2=36492,zu=2300,Zl=2301,sv=2302,s2=2400,i2=2401,r2=2402,Iz=2500,Dz=1,DP=2,Bo=3e3,Bt=3001,Lz=3200,LP=3201,mh=0,Oz=1,To="srgb",Ul="srgb-linear",iv=7680,kz=519,P_=35044,o2="300 es",R_=1035;class pc{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const s=this._listeners[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,e);e.target=null}}}u(pc,"EventDispatcher");const Rs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let a2=1234567;const uf=Math.PI/180,Pf=180/Math.PI;function _r(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(Rs[n&255]+Rs[n>>8&255]+Rs[n>>16&255]+Rs[n>>24&255]+"-"+Rs[e&255]+Rs[e>>8&255]+"-"+Rs[e>>16&15|64]+Rs[e>>24&255]+"-"+Rs[t&63|128]+Rs[t>>8&255]+"-"+Rs[t>>16&255]+Rs[t>>24&255]+Rs[s&255]+Rs[s>>8&255]+Rs[s>>16&255]+Rs[s>>24&255]).toLowerCase()}u(_r,"generateUUID");function Ss(n,e,t){return Math.max(e,Math.min(t,n))}u(Ss,"clamp");function Lb(n,e){return(n%e+e)%e}u(Lb,"euclideanModulo");function Nz(n,e,t,s,i){return s+(n-e)*(i-s)/(t-e)}u(Nz,"mapLinear");function Fz(n,e,t){return n!==e?(t-n)/(e-n):0}u(Fz,"inverseLerp");function hf(n,e,t){return(1-t)*n+t*e}u(hf,"lerp$2");function zz(n,e,t,s){return hf(n,e,1-Math.exp(-t*s))}u(zz,"damp");function Bz(n,e=1){return e-Math.abs(Lb(n,e*2)-e)}u(Bz,"pingpong");function Uz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}u(Uz,"smoothstep");function $z(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}u($z,"smootherstep");function Vz(n,e){return n+Math.floor(Math.random()*(e-n+1))}u(Vz,"randInt");function Gz(n,e){return n+Math.random()*(e-n)}u(Gz,"randFloat");function Hz(n){return n*(.5-Math.random())}u(Hz,"randFloatSpread");function Wz(n){n!==void 0&&(a2=n);let e=a2+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}u(Wz,"seededRandom");function jz(n){return n*uf}u(jz,"degToRad$1");function Xz(n){return n*Pf}u(Xz,"radToDeg$1");function I_(n){return(n&n-1)===0&&n!==0}u(I_,"isPowerOfTwo");function OP(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}u(OP,"ceilPowerOfTwo");function s0(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}u(s0,"floorPowerOfTwo");function Yz(n,e,t,s,i){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+s)/2),h=o((e+s)/2),d=r((e-s)/2),f=o((e-s)/2),p=r((s-e)/2),g=o((s-e)/2);switch(i){case"XYX":n.set(a*h,l*d,l*f,a*c);break;case"YZY":n.set(l*f,a*h,l*d,a*c);break;case"ZXZ":n.set(l*d,l*f,a*h,a*c);break;case"XZX":n.set(a*h,l*g,l*p,a*c);break;case"YXY":n.set(l*p,a*h,l*g,a*c);break;case"ZYZ":n.set(l*g,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}u(Yz,"setQuaternionFromProperEuler");function Io(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}u(Io,"denormalize");function cn(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}u(cn,"normalize$4");var Xi=Object.freeze({__proto__:null,DEG2RAD:uf,RAD2DEG:Pf,generateUUID:_r,clamp:Ss,euclideanModulo:Lb,mapLinear:Nz,inverseLerp:Fz,lerp:hf,damp:zz,pingpong:Bz,smoothstep:Uz,smootherstep:$z,randInt:Vz,randFloat:Gz,randFloatSpread:Hz,seededRandom:Wz,degToRad:jz,radToDeg:Xz,isPowerOfTwo:I_,ceilPowerOfTwo:OP,floorPowerOfTwo:s0,setQuaternionFromProperEuler:Yz,normalize:cn,denormalize:Io});class $e{constructor(e=0,t=0){$e.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,s=this.y,i=e.elements;return this.x=i[0]*t+i[3]*s+i[6],this.y=i[1]*t+i[4]*s+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y;return t*t+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const s=Math.cos(t),i=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*s-o*i+e.x,this.y=r*i+o*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}u($e,"Vector2");class Qs{constructor(){Qs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,s,i,r,o,a,l,c){const h=this.elements;return h[0]=e,h[1]=i,h[2]=a,h[3]=t,h[4]=r,h[5]=l,h[6]=s,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],this}extractBasis(e,t,s){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,r=this.elements,o=s[0],a=s[3],l=s[6],c=s[1],h=s[4],d=s[7],f=s[2],p=s[5],g=s[8],m=i[0],v=i[3],y=i[6],b=i[1],_=i[4],w=i[7],x=i[2],S=i[5],C=i[8];return r[0]=o*m+a*b+l*x,r[3]=o*v+a*_+l*S,r[6]=o*y+a*w+l*C,r[1]=c*m+h*b+d*x,r[4]=c*v+h*_+d*S,r[7]=c*y+h*w+d*C,r[2]=f*m+p*b+g*x,r[5]=f*v+p*_+g*S,r[8]=f*y+p*w+g*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[1],i=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return t*o*h-t*a*c-s*r*h+s*a*l+i*r*c-i*o*l}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=h*o-a*c,f=a*l-h*r,p=c*r-o*l,g=t*d+s*f+i*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/g;return e[0]=d*m,e[1]=(i*c-h*s)*m,e[2]=(a*s-i*o)*m,e[3]=f*m,e[4]=(h*t-i*l)*m,e[5]=(i*r-a*t)*m,e[6]=p*m,e[7]=(s*l-c*t)*m,e[8]=(o*t-s*r)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,s,i,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(s*l,s*c,-s*(l*o+c*a)+o+e,-i*c,i*l,-i*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=t,s[4]*=t,s[7]*=t,this}rotate(e){const t=Math.cos(e),s=Math.sin(e),i=this.elements,r=i[0],o=i[3],a=i[6],l=i[1],c=i[4],h=i[7];return i[0]=t*r+s*l,i[3]=t*o+s*c,i[6]=t*a+s*h,i[1]=-s*r+t*l,i[4]=-s*o+t*c,i[7]=-s*a+t*h,this}translate(e,t){const s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=t*s[2],s[4]+=t*s[5],s[7]+=t*s[8],this}equals(e){const t=this.elements,s=e.elements;for(let i=0;i<9;i++)if(t[i]!==s[i])return!1;return!0}fromArray(e,t=0){for(let s=0;s<9;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}u(Qs,"Matrix3");function kP(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}u(kP,"arrayNeedsUint32");function Rf(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}u(Rf,"createElementNS");function Xl(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}u(Xl,"SRGBToLinear");function Dg(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}u(Dg,"LinearToSRGB");const rv={[To]:{[Ul]:Xl},[Ul]:{[To]:Dg}},sr={legacyMode:!0,get workingColorSpace(){return Ul},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(rv[e]&&rv[e][t]!==void 0){const s=rv[e][t];return n.r=s(n.r),n.g=s(n.g),n.b=s(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},NP={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},as={r:0,g:0,b:0},ir={h:0,s:0,l:0},Rp={h:0,s:0,l:0};function ov(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}u(ov,"hue2rgb");function Ip(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}u(Ip,"toComponents");class De{constructor(e,t,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&s===void 0?this.set(e):this.setRGB(e,t,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=To){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,sr.toWorkingColorSpace(this,t),this}setRGB(e,t,s,i=Ul){return this.r=e,this.g=t,this.b=s,sr.toWorkingColorSpace(this,i),this}setHSL(e,t,s,i=Ul){if(e=Lb(e,1),t=Ss(t,0,1),s=Ss(s,0,1),t===0)this.r=this.g=this.b=s;else{const r=s<=.5?s*(1+t):s+t-s*t,o=2*s-r;this.r=ov(o,r,e+1/3),this.g=ov(o,r,e),this.b=ov(o,r,e-1/3)}return sr.toWorkingColorSpace(this,i),this}setStyle(e,t=To){function s(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}u(s,"handleAlpha");let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,sr.toWorkingColorSpace(this,t),s(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,sr.toWorkingColorSpace(this,t),s(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(r[1])/360,c=parseFloat(r[2])/100,h=parseFloat(r[3])/100;return s(r[4]),this.setHSL(l,c,h,t)}break}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,sr.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,sr.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=To){const s=NP[e.toLowerCase()];return s!==void 0?this.setHex(s,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Xl(e.r),this.g=Xl(e.g),this.b=Xl(e.b),this}copyLinearToSRGB(e){return this.r=Dg(e.r),this.g=Dg(e.g),this.b=Dg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=To){return sr.fromWorkingColorSpace(Ip(this,as),e),Ss(as.r*255,0,255)<<16^Ss(as.g*255,0,255)<<8^Ss(as.b*255,0,255)<<0}getHexString(e=To){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ul){sr.fromWorkingColorSpace(Ip(this,as),t);const s=as.r,i=as.g,r=as.b,o=Math.max(s,i,r),a=Math.min(s,i,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=h<=.5?d/(o+a):d/(2-o-a),o){case s:l=(i-r)/d+(i<r?6:0);break;case i:l=(r-s)/d+2;break;case r:l=(s-i)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=h,e}getRGB(e,t=Ul){return sr.fromWorkingColorSpace(Ip(this,as),t),e.r=as.r,e.g=as.g,e.b=as.b,e}getStyle(e=To){return sr.fromWorkingColorSpace(Ip(this,as),e),e!==To?`color(${e} ${as.r} ${as.g} ${as.b})`:`rgb(${as.r*255|0},${as.g*255|0},${as.b*255|0})`}offsetHSL(e,t,s){return this.getHSL(ir),ir.h+=e,ir.s+=t,ir.l+=s,this.setHSL(ir.h,ir.s,ir.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,s){return this.r=e.r+(t.r-e.r)*s,this.g=e.g+(t.g-e.g)*s,this.b=e.b+(t.b-e.b)*s,this}lerpHSL(e,t){this.getHSL(ir),e.getHSL(Rp);const s=hf(ir.h,Rp.h,t),i=hf(ir.s,Rp.s,t),r=hf(ir.l,Rp.l,t);return this.setHSL(s,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}u(De,"Color");De.NAMES=NP;let Ac;class Ob{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ac===void 0&&(Ac=Rf("canvas")),Ac.width=e.width,Ac.height=e.height;const s=Ac.getContext("2d");e instanceof ImageData?s.putImageData(e,0,0):s.drawImage(e,0,0,e.width,e.height),t=Ac}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=Rf("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const i=s.getImageData(0,0,e.width,e.height),r=i.data;for(let o=0;o<r.length;o++)r[o]=Xl(r[o]/255)*255;return s.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let s=0;s<t.length;s++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[s]=Math.floor(Xl(t[s]/255)*255):t[s]=Xl(t[s]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}u(Ob,"ImageUtils");class $0{constructor(e=null){this.isSource=!0,this.uuid=_r(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?r.push(av(i[o].image)):r.push(av(i[o]))}else r=av(i);s.url=r}return t||(e.images[this.uuid]=s),s}}u($0,"Source");function av(n){return typeof HTMLImageElement!="undefined"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&n instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&n instanceof ImageBitmap?Ob.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}u(av,"serializeImage");let qz=0;class is extends pc{constructor(e=is.DEFAULT_IMAGE,t=is.DEFAULT_MAPPING,s=Ks,i=Ks,r=qs,o=fc,a=Ii,l=Kl,c=1,h=Bo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qz++}),this.uuid=_r(),this.name="",this.source=new $0(e),this.mipmaps=[],this.mapping=t,this.wrapS=s,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new $e(0,0),this.repeat=new $e(1,1),this.center=new $e(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Qs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),t||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==RP)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case zo:e.x=e.x-Math.floor(e.x);break;case Ks:e.x=e.x<0?0:1;break;case Tf:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case zo:e.y=e.y-Math.floor(e.y);break;case Ks:e.y=e.y<0?0:1;break;case Tf:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}u(is,"Texture");is.DEFAULT_IMAGE=null;is.DEFAULT_MAPPING=RP;class Ft{constructor(e=0,t=0,s=0,i=1){Ft.prototype.isVector4=!0,this.x=e,this.y=t,this.z=s,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,s,i){return this.x=e,this.y=t,this.z=s,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,s=this.y,i=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*s+o[8]*i+o[12]*r,this.y=o[1]*t+o[5]*s+o[9]*i+o[13]*r,this.z=o[2]*t+o[6]*s+o[10]*i+o[14]*r,this.w=o[3]*t+o[7]*s+o[11]*i+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,s,i,r;const l=e.elements,c=l[0],h=l[4],d=l[8],f=l[1],p=l[5],g=l[9],m=l[2],v=l[6],y=l[10];if(Math.abs(h-f)<.01&&Math.abs(d-m)<.01&&Math.abs(g-v)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+m)<.1&&Math.abs(g+v)<.1&&Math.abs(c+p+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,w=(p+1)/2,x=(y+1)/2,S=(h+f)/4,C=(d+m)/4,M=(g+v)/4;return _>w&&_>x?_<.01?(s=0,i=.707106781,r=.707106781):(s=Math.sqrt(_),i=S/s,r=C/s):w>x?w<.01?(s=.707106781,i=0,r=.707106781):(i=Math.sqrt(w),s=S/i,r=M/i):x<.01?(s=.707106781,i=.707106781,r=0):(r=Math.sqrt(x),s=C/r,i=M/r),this.set(s,i,r,t),this}let b=Math.sqrt((v-g)*(v-g)+(d-m)*(d-m)+(f-h)*(f-h));return Math.abs(b)<.001&&(b=1),this.x=(v-g)/b,this.y=(d-m)/b,this.z=(f-h)/b,this.w=Math.acos((c+p+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this.w=e.w+(t.w-e.w)*s,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}u(Ft,"Vector4");class ys extends pc{constructor(e=1,t=1,s={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ft(0,0,e,t),this.scissorTest=!1,this.viewport=new Ft(0,0,e,t);const i={width:e,height:t,depth:1};this.texture=new is(i,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=s.generateMipmaps!==void 0?s.generateMipmaps:!1,this.texture.internalFormat=s.internalFormat!==void 0?s.internalFormat:null,this.texture.minFilter=s.minFilter!==void 0?s.minFilter:qs,this.depthBuffer=s.depthBuffer!==void 0?s.depthBuffer:!0,this.stencilBuffer=s.stencilBuffer!==void 0?s.stencilBuffer:!1,this.depthTexture=s.depthTexture!==void 0?s.depthTexture:null,this.samples=s.samples!==void 0?s.samples:0}setSize(e,t,s=1){(this.width!==e||this.height!==t||this.depth!==s)&&(this.width=e,this.height=t,this.depth=s,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=s,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new $0(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}u(ys,"WebGLRenderTarget");class kb extends is{constructor(e=null,t=1,s=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:s,depth:i},this.magFilter=Wn,this.minFilter=Wn,this.wrapR=Ks,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(kb,"DataArrayTexture");class FP extends is{constructor(e=null,t=1,s=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:s,depth:i},this.magFilter=Wn,this.minFilter=Wn,this.wrapR=Ks,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(FP,"Data3DTexture");class qe{constructor(e=0,t=0,s=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=s,this._w=i}static slerpFlat(e,t,s,i,r,o,a){let l=s[i+0],c=s[i+1],h=s[i+2],d=s[i+3];const f=r[o+0],p=r[o+1],g=r[o+2],m=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=g,e[t+3]=m;return}if(d!==m||l!==f||c!==p||h!==g){let v=1-a;const y=l*f+c*p+h*g+d*m,b=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const x=Math.sqrt(_),S=Math.atan2(x,y*b);v=Math.sin(v*S)/x,a=Math.sin(a*S)/x}const w=a*b;if(l=l*v+f*w,c=c*v+p*w,h=h*v+g*w,d=d*v+m*w,v===1-a){const x=1/Math.sqrt(l*l+c*c+h*h+d*d);l*=x,c*=x,h*=x,d*=x}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=d}static multiplyQuaternionsFlat(e,t,s,i,r,o){const a=s[i],l=s[i+1],c=s[i+2],h=s[i+3],d=r[o],f=r[o+1],p=r[o+2],g=r[o+3];return e[t]=a*g+h*d+l*p-c*f,e[t+1]=l*g+h*f+c*d-a*p,e[t+2]=c*g+h*p+a*f-l*d,e[t+3]=h*g-a*d-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,s,i){return this._x=e,this._y=t,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const s=e._x,i=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(s/2),h=a(i/2),d=a(r/2),f=l(s/2),p=l(i/2),g=l(r/2);switch(o){case"XYZ":this._x=f*h*d+c*p*g,this._y=c*p*d-f*h*g,this._z=c*h*g+f*p*d,this._w=c*h*d-f*p*g;break;case"YXZ":this._x=f*h*d+c*p*g,this._y=c*p*d-f*h*g,this._z=c*h*g-f*p*d,this._w=c*h*d+f*p*g;break;case"ZXY":this._x=f*h*d-c*p*g,this._y=c*p*d+f*h*g,this._z=c*h*g+f*p*d,this._w=c*h*d-f*p*g;break;case"ZYX":this._x=f*h*d-c*p*g,this._y=c*p*d+f*h*g,this._z=c*h*g-f*p*d,this._w=c*h*d+f*p*g;break;case"YZX":this._x=f*h*d+c*p*g,this._y=c*p*d+f*h*g,this._z=c*h*g-f*p*d,this._w=c*h*d-f*p*g;break;case"XZY":this._x=f*h*d-c*p*g,this._y=c*p*d-f*h*g,this._z=c*h*g+f*p*d,this._w=c*h*d+f*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const s=t/2,i=Math.sin(s);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,s=t[0],i=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],h=t[6],d=t[10],f=s+a+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-l)*p,this._y=(r-c)*p,this._z=(o-i)*p}else if(s>a&&s>d){const p=2*Math.sqrt(1+s-a-d);this._w=(h-l)/p,this._x=.25*p,this._y=(i+o)/p,this._z=(r+c)/p}else if(a>d){const p=2*Math.sqrt(1+a-s-d);this._w=(r-c)/p,this._x=(i+o)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+d-s-a);this._w=(o-i)/p,this._x=(r+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let s=e.dot(t)+1;return s<Number.EPSILON?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ss(this.dot(e),-1,1)))}rotateTowards(e,t){const s=this.angleTo(e);if(s===0)return this;const i=Math.min(1,t/s);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const s=e._x,i=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,h=t._w;return this._x=s*h+o*a+i*c-r*l,this._y=i*h+o*l+r*a-s*c,this._z=r*h+o*c+s*l-i*a,this._w=o*h-s*a-i*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const s=this._x,i=this._y,r=this._z,o=this._w;let a=o*e._w+s*e._x+i*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=s,this._y=i,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*s+t*this._x,this._y=p*i+t*this._y,this._z=p*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),d=Math.sin((1-t)*h)/c,f=Math.sin(t*h)/c;return this._w=o*d+this._w*f,this._x=s*d+this._x*f,this._y=i*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,s){return this.copy(e).slerp(t,s)}random(){const e=Math.random(),t=Math.sqrt(1-e),s=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),s*Math.sin(r),s*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}u(qe,"Quaternion");class P{constructor(e=0,t=0,s=0){P.prototype.isVector3=!0,this.x=e,this.y=t,this.z=s}set(e,t,s){return s===void 0&&(s=this.z),this.x=e,this.y=t,this.z=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(l2.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(l2.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,s=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*s+r[6]*i,this.y=r[1]*t+r[4]*s+r[7]*i,this.z=r[2]*t+r[5]*s+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,s=this.y,i=this.z,r=e.elements,o=1/(r[3]*t+r[7]*s+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*s+r[8]*i+r[12])*o,this.y=(r[1]*t+r[5]*s+r[9]*i+r[13])*o,this.z=(r[2]*t+r[6]*s+r[10]*i+r[14])*o,this}applyQuaternion(e){const t=this.x,s=this.y,i=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*i-a*s,h=l*s+a*t-r*i,d=l*i+r*s-o*t,f=-r*t-o*s-a*i;return this.x=c*l+f*-r+h*-a-d*-o,this.y=h*l+f*-o+d*-r-c*-a,this.z=d*l+f*-a+c*-o-h*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,s=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*s+r[8]*i,this.y=r[1]*t+r[5]*s+r[9]*i,this.z=r[2]*t+r[6]*s+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(t,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,s){return this.x=e.x+(t.x-e.x)*s,this.y=e.y+(t.y-e.y)*s,this.z=e.z+(t.z-e.z)*s,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const s=e.x,i=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=i*l-r*a,this.y=r*o-s*l,this.z=s*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const s=e.dot(this)/t;return this.copy(e).multiplyScalar(s)}projectOnPlane(e){return lv.copy(this).projectOnVector(e),this.sub(lv)}reflect(e){return this.sub(lv.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const s=this.dot(e)/t;return Math.acos(Ss(s,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,s=this.y-e.y,i=this.z-e.z;return t*t+s*s+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,s){const i=Math.sin(t)*e;return this.x=i*Math.sin(s),this.y=Math.cos(t)*e,this.z=i*Math.cos(s),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,s){return this.x=e*Math.sin(t),this.y=s,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),s=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=s,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,s=Math.sqrt(1-e**2);return this.x=s*Math.cos(t),this.y=s*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}u(P,"Vector3");const lv=new P,l2=new qe;class ss{constructor(e=new P(1/0,1/0,1/0),t=new P(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,s=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const h=e[l],d=e[l+1],f=e[l+2];h<t&&(t=h),d<s&&(s=d),f<i&&(i=f),h>r&&(r=h),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,s,i),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,s=1/0,i=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const h=e.getX(l),d=e.getY(l),f=e.getZ(l);h<t&&(t=h),d<s&&(s=d),f<i&&(i=f),h>r&&(r=h),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,s,i),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,s=e.length;t<s;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const s=rl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(s),this.max.copy(e).add(s),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const s=e.geometry;if(s!==void 0)if(t&&s.attributes!=null&&s.attributes.position!==void 0){const r=s.attributes.position;for(let o=0,a=r.count;o<a;o++)rl.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(rl)}else s.boundingBox===null&&s.computeBoundingBox(),cv.copy(s.boundingBox),cv.applyMatrix4(e.matrixWorld),this.union(cv);const i=e.children;for(let r=0,o=i.length;r<o;r++)this.expandByObject(i[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,rl),rl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,s;return e.normal.x>0?(t=e.normal.x*this.min.x,s=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,s=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,s+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,s+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,s+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,s+=e.normal.z*this.min.z),t<=-e.constant&&s>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Fh),Dp.subVectors(this.max,Fh),Mc.subVectors(e.a,Fh),Sc.subVectors(e.b,Fh),Cc.subVectors(e.c,Fh),Jo.subVectors(Sc,Mc),ea.subVectors(Cc,Sc),ol.subVectors(Mc,Cc);let t=[0,-Jo.z,Jo.y,0,-ea.z,ea.y,0,-ol.z,ol.y,Jo.z,0,-Jo.x,ea.z,0,-ea.x,ol.z,0,-ol.x,-Jo.y,Jo.x,0,-ea.y,ea.x,0,-ol.y,ol.x,0];return!uv(t,Mc,Sc,Cc,Dp)||(t=[1,0,0,0,1,0,0,0,1],!uv(t,Mc,Sc,Cc,Dp))?!1:(Lp.crossVectors(Jo,ea),t=[Lp.x,Lp.y,Lp.z],uv(t,Mc,Sc,Cc,Dp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return rl.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(rl).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(eo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),eo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),eo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),eo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),eo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),eo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),eo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),eo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(eo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}u(ss,"Box3");const eo=[new P,new P,new P,new P,new P,new P,new P,new P],rl=new P,cv=new ss,Mc=new P,Sc=new P,Cc=new P,Jo=new P,ea=new P,ol=new P,Fh=new P,Dp=new P,Lp=new P,al=new P;function uv(n,e,t,s,i){for(let r=0,o=n.length-3;r<=o;r+=3){al.fromArray(n,r);const a=i.x*Math.abs(al.x)+i.y*Math.abs(al.y)+i.z*Math.abs(al.z),l=e.dot(al),c=t.dot(al),h=s.dot(al);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}u(uv,"satForAxes");const Kz=new ss,zh=new P,hv=new P;class ja{constructor(e=new P,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const s=this.center;t!==void 0?s.copy(t):Kz.setFromPoints(e).getCenter(s);let i=0;for(let r=0,o=e.length;r<o;r++)i=Math.max(i,s.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const s=this.center.distanceToSquared(e);return t.copy(e),s>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;zh.subVectors(e,this.center);const t=zh.lengthSq();if(t>this.radius*this.radius){const s=Math.sqrt(t),i=(s-this.radius)*.5;this.center.addScaledVector(zh,i/s),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(hv.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(zh.copy(e.center).add(hv)),this.expandByPoint(zh.copy(e.center).sub(hv))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}u(ja,"Sphere");const to=new P,dv=new P,Op=new P,ta=new P,fv=new P,kp=new P,pv=new P;class Xa{constructor(e=new P,t=new P(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,to)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const s=t.dot(this.direction);return s<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(s).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=to.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(to.copy(this.direction).multiplyScalar(t).add(this.origin),to.distanceToSquared(e))}distanceSqToSegment(e,t,s,i){dv.copy(e).add(t).multiplyScalar(.5),Op.copy(t).sub(e).normalize(),ta.copy(this.origin).sub(dv);const r=e.distanceTo(t)*.5,o=-this.direction.dot(Op),a=ta.dot(this.direction),l=-ta.dot(Op),c=ta.lengthSq(),h=Math.abs(1-o*o);let d,f,p,g;if(h>0)if(d=o*l-a,f=o*a-l,g=r*h,d>=0)if(f>=-g)if(f<=g){const m=1/h;d*=m,f*=m,p=d*(d+o*f+2*a)+f*(o*d+f+2*l)+c}else f=r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f=-r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f<=-g?(d=Math.max(0,-(-o*r+a)),f=d>0?-r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c):f<=g?(d=0,f=Math.min(Math.max(-r,-l),r),p=f*(f+2*l)+c):(d=Math.max(0,-(o*r+a)),f=d>0?r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c);else f=o>0?-r:r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;return s&&s.copy(this.direction).multiplyScalar(d).add(this.origin),i&&i.copy(Op).multiplyScalar(f).add(dv),p}intersectSphere(e,t){to.subVectors(e.center,this.origin);const s=to.dot(this.direction),i=to.dot(to)-s*s,r=e.radius*e.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=s-o,l=s+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(e.normal)+e.constant)/t;return s>=0?s:null}intersectPlane(e,t){const s=this.distanceToPlane(e);return s===null?null:this.at(s,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let s,i,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(s=(e.min.x-f.x)*c,i=(e.max.x-f.x)*c):(s=(e.max.x-f.x)*c,i=(e.min.x-f.x)*c),h>=0?(r=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(r=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),s>o||r>i||((r>s||isNaN(s))&&(s=r),(o<i||isNaN(i))&&(i=o),d>=0?(a=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),s>l||a>i)||((a>s||s!==s)&&(s=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(s>=0?s:i,t)}intersectsBox(e){return this.intersectBox(e,to)!==null}intersectTriangle(e,t,s,i,r){fv.subVectors(t,e),kp.subVectors(s,e),pv.crossVectors(fv,kp);let o=this.direction.dot(pv),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;ta.subVectors(this.origin,e);const l=a*this.direction.dot(kp.crossVectors(ta,kp));if(l<0)return null;const c=a*this.direction.dot(fv.cross(ta));if(c<0||l+c>o)return null;const h=-a*ta.dot(pv);return h<0?null:this.at(h/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}u(Xa,"Ray");class be{constructor(){be.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,s,i,r,o,a,l,c,h,d,f,p,g,m,v){const y=this.elements;return y[0]=e,y[4]=t,y[8]=s,y[12]=i,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=h,y[10]=d,y[14]=f,y[3]=p,y[7]=g,y[11]=m,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new be().fromArray(this.elements)}copy(e){const t=this.elements,s=e.elements;return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],this}copyPosition(e){const t=this.elements,s=e.elements;return t[12]=s[12],t[13]=s[13],t[14]=s[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,s){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(e,t,s){return this.set(e.x,t.x,s.x,0,e.y,t.y,s.y,0,e.z,t.z,s.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,s=e.elements,i=1/Ec.setFromMatrixColumn(e,0).length(),r=1/Ec.setFromMatrixColumn(e,1).length(),o=1/Ec.setFromMatrixColumn(e,2).length();return t[0]=s[0]*i,t[1]=s[1]*i,t[2]=s[2]*i,t[3]=0,t[4]=s[4]*r,t[5]=s[5]*r,t[6]=s[6]*r,t[7]=0,t[8]=s[8]*o,t[9]=s[9]*o,t[10]=s[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,s=e.x,i=e.y,r=e.z,o=Math.cos(s),a=Math.sin(s),l=Math.cos(i),c=Math.sin(i),h=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const f=o*h,p=o*d,g=a*h,m=a*d;t[0]=l*h,t[4]=-l*d,t[8]=c,t[1]=p+g*c,t[5]=f-m*c,t[9]=-a*l,t[2]=m-f*c,t[6]=g+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*h,p=l*d,g=c*h,m=c*d;t[0]=f+m*a,t[4]=g*a-p,t[8]=o*c,t[1]=o*d,t[5]=o*h,t[9]=-a,t[2]=p*a-g,t[6]=m+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*h,p=l*d,g=c*h,m=c*d;t[0]=f-m*a,t[4]=-o*d,t[8]=g+p*a,t[1]=p+g*a,t[5]=o*h,t[9]=m-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*h,p=o*d,g=a*h,m=a*d;t[0]=l*h,t[4]=g*c-p,t[8]=f*c+m,t[1]=l*d,t[5]=m*c+f,t[9]=p*c-g,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*h,t[4]=m-f*d,t[8]=g*d+p,t[1]=d,t[5]=o*h,t[9]=-a*h,t[2]=-c*h,t[6]=p*d+g,t[10]=f-m*d}else if(e.order==="XZY"){const f=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*h,t[4]=-d,t[8]=c*h,t[1]=f*d+m,t[5]=o*h,t[9]=p*d-g,t[2]=g*d-p,t[6]=a*h,t[10]=m*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Zz,e,Qz)}lookAt(e,t,s){const i=this.elements;return mi.subVectors(e,t),mi.lengthSq()===0&&(mi.z=1),mi.normalize(),na.crossVectors(s,mi),na.lengthSq()===0&&(Math.abs(s.z)===1?mi.x+=1e-4:mi.z+=1e-4,mi.normalize(),na.crossVectors(s,mi)),na.normalize(),Np.crossVectors(mi,na),i[0]=na.x,i[4]=Np.x,i[8]=mi.x,i[1]=na.y,i[5]=Np.y,i[9]=mi.y,i[2]=na.z,i[6]=Np.z,i[10]=mi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const s=e.elements,i=t.elements,r=this.elements,o=s[0],a=s[4],l=s[8],c=s[12],h=s[1],d=s[5],f=s[9],p=s[13],g=s[2],m=s[6],v=s[10],y=s[14],b=s[3],_=s[7],w=s[11],x=s[15],S=i[0],C=i[4],M=i[8],R=i[12],D=i[1],k=i[5],T=i[9],N=i[13],E=i[2],z=i[6],H=i[10],q=i[14],ne=i[3],W=i[7],se=i[11],K=i[15];return r[0]=o*S+a*D+l*E+c*ne,r[4]=o*C+a*k+l*z+c*W,r[8]=o*M+a*T+l*H+c*se,r[12]=o*R+a*N+l*q+c*K,r[1]=h*S+d*D+f*E+p*ne,r[5]=h*C+d*k+f*z+p*W,r[9]=h*M+d*T+f*H+p*se,r[13]=h*R+d*N+f*q+p*K,r[2]=g*S+m*D+v*E+y*ne,r[6]=g*C+m*k+v*z+y*W,r[10]=g*M+m*T+v*H+y*se,r[14]=g*R+m*N+v*q+y*K,r[3]=b*S+_*D+w*E+x*ne,r[7]=b*C+_*k+w*z+x*W,r[11]=b*M+_*T+w*H+x*se,r[15]=b*R+_*N+w*q+x*K,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],s=e[4],i=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],h=e[2],d=e[6],f=e[10],p=e[14],g=e[3],m=e[7],v=e[11],y=e[15];return g*(+r*l*d-i*c*d-r*a*f+s*c*f+i*a*p-s*l*p)+m*(+t*l*p-t*c*f+r*o*f-i*o*p+i*c*h-r*l*h)+v*(+t*c*d-t*a*p-r*o*d+s*o*p+r*a*h-s*c*h)+y*(-i*a*h-t*l*d+t*a*f+i*o*d-s*o*f+s*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,s){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=s),this}invert(){const e=this.elements,t=e[0],s=e[1],i=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=d*v*c-m*f*c+m*l*p-a*v*p-d*l*y+a*f*y,_=g*f*c-h*v*c-g*l*p+o*v*p+h*l*y-o*f*y,w=h*m*c-g*d*c+g*a*p-o*m*p-h*a*y+o*d*y,x=g*d*l-h*m*l-g*a*f+o*m*f+h*a*v-o*d*v,S=t*b+s*_+i*w+r*x;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/S;return e[0]=b*C,e[1]=(m*f*r-d*v*r-m*i*p+s*v*p+d*i*y-s*f*y)*C,e[2]=(a*v*r-m*l*r+m*i*c-s*v*c-a*i*y+s*l*y)*C,e[3]=(d*l*r-a*f*r-d*i*c+s*f*c+a*i*p-s*l*p)*C,e[4]=_*C,e[5]=(h*v*r-g*f*r+g*i*p-t*v*p-h*i*y+t*f*y)*C,e[6]=(g*l*r-o*v*r-g*i*c+t*v*c+o*i*y-t*l*y)*C,e[7]=(o*f*r-h*l*r+h*i*c-t*f*c-o*i*p+t*l*p)*C,e[8]=w*C,e[9]=(g*d*r-h*m*r-g*s*p+t*m*p+h*s*y-t*d*y)*C,e[10]=(o*m*r-g*a*r+g*s*c-t*m*c-o*s*y+t*a*y)*C,e[11]=(h*a*r-o*d*r-h*s*c+t*d*c+o*s*p-t*a*p)*C,e[12]=x*C,e[13]=(h*m*i-g*d*i+g*s*f-t*m*f-h*s*v+t*d*v)*C,e[14]=(g*a*i-o*m*i-g*s*l+t*m*l+o*s*v-t*a*v)*C,e[15]=(o*d*i-h*a*i+h*s*l-t*d*l-o*s*f+t*a*f)*C,this}scale(e){const t=this.elements,s=e.x,i=e.y,r=e.z;return t[0]*=s,t[4]*=i,t[8]*=r,t[1]*=s,t[5]*=i,t[9]*=r,t[2]*=s,t[6]*=i,t[10]*=r,t[3]*=s,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],s=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,s,i))}makeTranslation(e,t,s){return this.set(1,0,0,e,0,1,0,t,0,0,1,s,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const s=Math.cos(t),i=Math.sin(t),r=1-s,o=e.x,a=e.y,l=e.z,c=r*o,h=r*a;return this.set(c*o+s,c*a-i*l,c*l+i*a,0,c*a+i*l,h*a+s,h*l-i*o,0,c*l-i*a,h*l+i*o,r*l*l+s,0,0,0,0,1),this}makeScale(e,t,s){return this.set(e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1),this}makeShear(e,t,s,i,r,o){return this.set(1,s,r,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,s){const i=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,h=o+o,d=a+a,f=r*c,p=r*h,g=r*d,m=o*h,v=o*d,y=a*d,b=l*c,_=l*h,w=l*d,x=s.x,S=s.y,C=s.z;return i[0]=(1-(m+y))*x,i[1]=(p+w)*x,i[2]=(g-_)*x,i[3]=0,i[4]=(p-w)*S,i[5]=(1-(f+y))*S,i[6]=(v+b)*S,i[7]=0,i[8]=(g+_)*C,i[9]=(v-b)*C,i[10]=(1-(f+m))*C,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,s){const i=this.elements;let r=Ec.set(i[0],i[1],i[2]).length();const o=Ec.set(i[4],i[5],i[6]).length(),a=Ec.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],rr.copy(this);const c=1/r,h=1/o,d=1/a;return rr.elements[0]*=c,rr.elements[1]*=c,rr.elements[2]*=c,rr.elements[4]*=h,rr.elements[5]*=h,rr.elements[6]*=h,rr.elements[8]*=d,rr.elements[9]*=d,rr.elements[10]*=d,t.setFromRotationMatrix(rr),s.x=r,s.y=o,s.z=a,this}makePerspective(e,t,s,i,r,o){const a=this.elements,l=2*r/(t-e),c=2*r/(s-i),h=(t+e)/(t-e),d=(s+i)/(s-i),f=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=f,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,s,i,r,o){const a=this.elements,l=1/(t-e),c=1/(s-i),h=1/(o-r),d=(t+e)*l,f=(s+i)*c,p=(o+r)*h;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-f,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,s=e.elements;for(let i=0;i<16;i++)if(t[i]!==s[i])return!1;return!0}fromArray(e,t=0){for(let s=0;s<16;s++)this.elements[s]=e[s+t];return this}toArray(e=[],t=0){const s=this.elements;return e[t]=s[0],e[t+1]=s[1],e[t+2]=s[2],e[t+3]=s[3],e[t+4]=s[4],e[t+5]=s[5],e[t+6]=s[6],e[t+7]=s[7],e[t+8]=s[8],e[t+9]=s[9],e[t+10]=s[10],e[t+11]=s[11],e[t+12]=s[12],e[t+13]=s[13],e[t+14]=s[14],e[t+15]=s[15],e}}u(be,"Matrix4");const Ec=new P,rr=new be,Zz=new P(0,0,0),Qz=new P(1,1,1),na=new P,Np=new P,mi=new P,c2=new be,u2=new qe;class ft{constructor(e=0,t=0,s=0,i=ft.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=s,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,s,i=this._order){return this._x=e,this._y=t,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,s=!0){const i=e.elements,r=i[0],o=i[4],a=i[8],l=i[1],c=i[5],h=i[9],d=i[2],f=i[6],p=i[10];switch(t){case"XYZ":this._y=Math.asin(Ss(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Ss(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Ss(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Ss(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Ss(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Ss(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,s===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,s){return c2.makeRotationFromQuaternion(e),this.setFromRotationMatrix(c2,t,s)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return u2.setFromEuler(this),this.setFromQuaternion(u2,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}u(ft,"Euler");ft.DefaultOrder="XYZ";ft.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class V0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}u(V0,"Layers");let Jz=0;const h2=new P,Tc=new qe,no=new be,Fp=new P,Bh=new P,eB=new P,tB=new qe,d2=new P(1,0,0),f2=new P(0,1,0),p2=new P(0,0,1),nB={type:"added"},m2={type:"removed"};class Lt extends pc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Jz++}),this.uuid=_r(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Lt.DefaultUp.clone();const e=new P,t=new ft,s=new qe,i=new P(1,1,1);function r(){s.setFromEuler(t,!1)}u(r,"onRotationChange");function o(){t.setFromQuaternion(s,void 0,!1)}u(o,"onQuaternionChange"),t._onChange(r),s._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new be},normalMatrix:{value:new Qs}}),this.matrix=new be,this.matrixWorld=new be,this.matrixAutoUpdate=Lt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Lt.DefaultMatrixWorldAutoUpdate,this.layers=new V0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Tc.setFromAxisAngle(e,t),this.quaternion.multiply(Tc),this}rotateOnWorldAxis(e,t){return Tc.setFromAxisAngle(e,t),this.quaternion.premultiply(Tc),this}rotateX(e){return this.rotateOnAxis(d2,e)}rotateY(e){return this.rotateOnAxis(f2,e)}rotateZ(e){return this.rotateOnAxis(p2,e)}translateOnAxis(e,t){return h2.copy(e).applyQuaternion(this.quaternion),this.position.add(h2.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(d2,e)}translateY(e){return this.translateOnAxis(f2,e)}translateZ(e){return this.translateOnAxis(p2,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(no.copy(this.matrixWorld).invert())}lookAt(e,t,s){e.isVector3?Fp.copy(e):Fp.set(e,t,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Bh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?no.lookAt(Bh,Fp,this.up):no.lookAt(Fp,Bh,this.up),this.quaternion.setFromRotationMatrix(no),i&&(no.extractRotation(i.matrixWorld),Tc.setFromRotationMatrix(no),this.quaternion.premultiply(Tc.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(nB)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(m2)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(m2)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),no.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),no.multiply(e.parent.matrixWorld)),e.applyMatrix4(no),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let s=0,i=this.children.length;s<i;s++){const o=this.children[s].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bh,e,eB),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bh,tB,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let s=0,i=t.length;s<i;s++)t[s].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let s=0,i=t.length;s<i;s++)t[s].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let s=0,i=t.length;s<i;s++){const r=t[s];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const s=this.parent;if(e===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++){const a=i[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",s={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(u(r,"serialize"),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));i.material=a}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),h=o(e.images),d=o(e.shapes),f=o(e.skeletons),p=o(e.animations),g=o(e.nodes);a.length>0&&(s.geometries=a),l.length>0&&(s.materials=l),c.length>0&&(s.textures=c),h.length>0&&(s.images=h),d.length>0&&(s.shapes=d),f.length>0&&(s.skeletons=f),p.length>0&&(s.animations=p),g.length>0&&(s.nodes=g)}return s.object=i,s;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}u(o,"extractFromCache")}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let s=0;s<e.children.length;s++){const i=e.children[s];this.add(i.clone())}return this}}u(Lt,"Object3D");Lt.DefaultUp=new P(0,1,0);Lt.DefaultMatrixAutoUpdate=!0;Lt.DefaultMatrixWorldAutoUpdate=!0;const or=new P,so=new P,mv=new P,io=new P,Pc=new P,Rc=new P,g2=new P,gv=new P,vv=new P,yv=new P;class $r{constructor(e=new P,t=new P,s=new P){this.a=e,this.b=t,this.c=s}static getNormal(e,t,s,i){i.subVectors(s,t),or.subVectors(e,t),i.cross(or);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,s,i,r){or.subVectors(i,t),so.subVectors(s,t),mv.subVectors(e,t);const o=or.dot(or),a=or.dot(so),l=or.dot(mv),c=so.dot(so),h=so.dot(mv),d=o*c-a*a;if(d===0)return r.set(-2,-1,-1);const f=1/d,p=(c*l-a*h)*f,g=(o*h-a*l)*f;return r.set(1-p-g,g,p)}static containsPoint(e,t,s,i){return this.getBarycoord(e,t,s,i,io),io.x>=0&&io.y>=0&&io.x+io.y<=1}static getUV(e,t,s,i,r,o,a,l){return this.getBarycoord(e,t,s,i,io),l.set(0,0),l.addScaledVector(r,io.x),l.addScaledVector(o,io.y),l.addScaledVector(a,io.z),l}static isFrontFacing(e,t,s,i){return or.subVectors(s,t),so.subVectors(e,t),or.cross(so).dot(i)<0}set(e,t,s){return this.a.copy(e),this.b.copy(t),this.c.copy(s),this}setFromPointsAndIndices(e,t,s,i){return this.a.copy(e[t]),this.b.copy(e[s]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,s,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,s),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return or.subVectors(this.c,this.b),so.subVectors(this.a,this.b),or.cross(so).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $r.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $r.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,s,i,r){return $r.getUV(e,this.a,this.b,this.c,t,s,i,r)}containsPoint(e){return $r.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $r.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const s=this.a,i=this.b,r=this.c;let o,a;Pc.subVectors(i,s),Rc.subVectors(r,s),gv.subVectors(e,s);const l=Pc.dot(gv),c=Rc.dot(gv);if(l<=0&&c<=0)return t.copy(s);vv.subVectors(e,i);const h=Pc.dot(vv),d=Rc.dot(vv);if(h>=0&&d<=h)return t.copy(i);const f=l*d-h*c;if(f<=0&&l>=0&&h<=0)return o=l/(l-h),t.copy(s).addScaledVector(Pc,o);yv.subVectors(e,r);const p=Pc.dot(yv),g=Rc.dot(yv);if(g>=0&&p<=g)return t.copy(r);const m=p*c-l*g;if(m<=0&&c>=0&&g<=0)return a=c/(c-g),t.copy(s).addScaledVector(Rc,a);const v=h*g-p*d;if(v<=0&&d-h>=0&&p-g>=0)return g2.subVectors(r,i),a=(d-h)/(d-h+(p-g)),t.copy(i).addScaledVector(g2,a);const y=1/(v+m+f);return o=m*y,a=f*y,t.copy(s).addScaledVector(Pc,o).addScaledVector(Rc,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}u($r,"Triangle");let sB=0;class zs extends pc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:sB++}),this.uuid=_r(),this.name="",this.type="Material",this.blending=Su,this.side=ql,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=TP,this.blendDst=PP,this.blendEquation=lu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=E_,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=kz,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=iv,this.stencilZFail=iv,this.stencilZPass=iv,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const s=e[t];if(s===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const i=this[t];if(i===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[t]=s}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const s={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(e).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(e).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(e).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(e).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(e).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==Su&&(s.blending=this.blending),this.side!==ql&&(s.side=this.side),this.vertexColors&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=this.transparent),s.depthFunc=this.depthFunc,s.depthTest=this.depthTest,s.depthWrite=this.depthWrite,s.colorWrite=this.colorWrite,s.stencilWrite=this.stencilWrite,s.stencilWriteMask=this.stencilWriteMask,s.stencilFunc=this.stencilFunc,s.stencilRef=this.stencilRef,s.stencilFuncMask=this.stencilFuncMask,s.stencilFail=this.stencilFail,s.stencilZFail=this.stencilZFail,s.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(s.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(s.wireframe=this.wireframe),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=this.flatShading),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData);function i(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(u(i,"extractFromCache"),t){const r=i(e.textures),o=i(e.images);r.length>0&&(s.textures=r),o.length>0&&(s.images=o)}return s}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let s=null;if(t!==null){const i=t.length;s=new Array(i);for(let r=0;r!==i;++r)s[r]=t[r].clone()}return this.clippingPlanes=s,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}u(zs,"Material");class Fs extends zs{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=B0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}u(Fs,"MeshBasicMaterial");const Qn=new P,zp=new $e;class An{constructor(e,t,s){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=s===!0,this.usage=P_,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,s){e*=this.itemSize,s*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[s+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,s=this.count;t<s;t++)zp.fromBufferAttribute(this,t),zp.applyMatrix3(e),this.setXY(t,zp.x,zp.y);else if(this.itemSize===3)for(let t=0,s=this.count;t<s;t++)Qn.fromBufferAttribute(this,t),Qn.applyMatrix3(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}applyMatrix4(e){for(let t=0,s=this.count;t<s;t++)Qn.fromBufferAttribute(this,t),Qn.applyMatrix4(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)Qn.fromBufferAttribute(this,t),Qn.applyNormalMatrix(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)Qn.fromBufferAttribute(this,t),Qn.transformDirection(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Io(t,this.array)),t}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Io(t,this.array)),t}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Io(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Io(t,this.array)),t}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,s){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),s=cn(s,this.array)),this.array[e+0]=t,this.array[e+1]=s,this}setXYZ(e,t,s,i){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),s=cn(s,this.array),i=cn(i,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=i,this}setXYZW(e,t,s,i,r){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),s=cn(s,this.array),i=cn(i,this.array),r=cn(r,this.array)),this.array[e+0]=t,this.array[e+1]=s,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==P_&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}u(An,"BufferAttribute");class G0 extends An{constructor(e,t,s){super(new Uint16Array(e),t,s)}}u(G0,"Uint16BufferAttribute");class Nb extends An{constructor(e,t,s){super(new Uint32Array(e),t,s)}}u(Nb,"Uint32BufferAttribute");class We extends An{constructor(e,t,s){super(new Float32Array(e),t,s)}}u(We,"Float32BufferAttribute");let iB=0;const $i=new be,_v=new Lt,Ic=new P,gi=new ss,Uh=new ss,ds=new P;class at extends pc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:iB++}),this.uuid=_r(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(kP(e)?Nb:G0)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,s=0){this.groups.push({start:e,count:t,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const r=new Qs().getNormalMatrix(e);s.applyNormalMatrix(r),s.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return $i.makeRotationFromQuaternion(e),this.applyMatrix4($i),this}rotateX(e){return $i.makeRotationX(e),this.applyMatrix4($i),this}rotateY(e){return $i.makeRotationY(e),this.applyMatrix4($i),this}rotateZ(e){return $i.makeRotationZ(e),this.applyMatrix4($i),this}translate(e,t,s){return $i.makeTranslation(e,t,s),this.applyMatrix4($i),this}scale(e,t,s){return $i.makeScale(e,t,s),this.applyMatrix4($i),this}lookAt(e){return _v.lookAt(e),_v.updateMatrix(),this.applyMatrix4(_v.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ic).negate(),this.translate(Ic.x,Ic.y,Ic.z),this}setFromPoints(e){const t=[];for(let s=0,i=e.length;s<i;s++){const r=e[s];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new We(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ss);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new P(-1/0,-1/0,-1/0),new P(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let s=0,i=t.length;s<i;s++){const r=t[s];gi.setFromBufferAttribute(r),this.morphTargetsRelative?(ds.addVectors(this.boundingBox.min,gi.min),this.boundingBox.expandByPoint(ds),ds.addVectors(this.boundingBox.max,gi.max),this.boundingBox.expandByPoint(ds)):(this.boundingBox.expandByPoint(gi.min),this.boundingBox.expandByPoint(gi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ja);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new P,1/0);return}if(e){const s=this.boundingSphere.center;if(gi.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];Uh.setFromBufferAttribute(a),this.morphTargetsRelative?(ds.addVectors(gi.min,Uh.min),gi.expandByPoint(ds),ds.addVectors(gi.max,Uh.max),gi.expandByPoint(ds)):(gi.expandByPoint(Uh.min),gi.expandByPoint(Uh.max))}gi.getCenter(s);let i=0;for(let r=0,o=e.count;r<o;r++)ds.fromBufferAttribute(e,r),i=Math.max(i,s.distanceToSquared(ds));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)ds.fromBufferAttribute(a,c),l&&(Ic.fromBufferAttribute(e,c),ds.add(Ic)),i=Math.max(i,s.distanceToSquared(ds))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=e.array,i=t.position.array,r=t.normal.array,o=t.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new An(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],h=[];for(let D=0;D<a;D++)c[D]=new P,h[D]=new P;const d=new P,f=new P,p=new P,g=new $e,m=new $e,v=new $e,y=new P,b=new P;function _(D,k,T){d.fromArray(i,D*3),f.fromArray(i,k*3),p.fromArray(i,T*3),g.fromArray(o,D*2),m.fromArray(o,k*2),v.fromArray(o,T*2),f.sub(d),p.sub(d),m.sub(g),v.sub(g);const N=1/(m.x*v.y-v.x*m.y);!isFinite(N)||(y.copy(f).multiplyScalar(v.y).addScaledVector(p,-m.y).multiplyScalar(N),b.copy(p).multiplyScalar(m.x).addScaledVector(f,-v.x).multiplyScalar(N),c[D].add(y),c[k].add(y),c[T].add(y),h[D].add(b),h[k].add(b),h[T].add(b))}u(_,"handleTriangle");let w=this.groups;w.length===0&&(w=[{start:0,count:s.length}]);for(let D=0,k=w.length;D<k;++D){const T=w[D],N=T.start,E=T.count;for(let z=N,H=N+E;z<H;z+=3)_(s[z+0],s[z+1],s[z+2])}const x=new P,S=new P,C=new P,M=new P;function R(D){C.fromArray(r,D*3),M.copy(C);const k=c[D];x.copy(k),x.sub(C.multiplyScalar(C.dot(k))).normalize(),S.crossVectors(M,k);const N=S.dot(h[D])<0?-1:1;l[D*4]=x.x,l[D*4+1]=x.y,l[D*4+2]=x.z,l[D*4+3]=N}u(R,"handleVertex");for(let D=0,k=w.length;D<k;++D){const T=w[D],N=T.start,E=T.count;for(let z=N,H=N+E;z<H;z+=3)R(s[z+0]),R(s[z+1]),R(s[z+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new An(new Float32Array(t.count*3),3),this.setAttribute("normal",s);else for(let f=0,p=s.count;f<p;f++)s.setXYZ(f,0,0,0);const i=new P,r=new P,o=new P,a=new P,l=new P,c=new P,h=new P,d=new P;if(e)for(let f=0,p=e.count;f<p;f+=3){const g=e.getX(f+0),m=e.getX(f+1),v=e.getX(f+2);i.fromBufferAttribute(t,g),r.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),h.subVectors(o,r),d.subVectors(i,r),h.cross(d),a.fromBufferAttribute(s,g),l.fromBufferAttribute(s,m),c.fromBufferAttribute(s,v),a.add(h),l.add(h),c.add(h),s.setXYZ(g,a.x,a.y,a.z),s.setXYZ(m,l.x,l.y,l.z),s.setXYZ(v,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)i.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),h.subVectors(o,r),d.subVectors(i,r),h.cross(d),s.setXYZ(f+0,h.x,h.y,h.z),s.setXYZ(f+1,h.x,h.y,h.z),s.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),s.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,s=e.count;t<s;t++)ds.fromBufferAttribute(e,t),ds.normalize(),e.setXYZ(t,ds.x,ds.y,ds.z)}toNonIndexed(){function e(a,l){const c=a.array,h=a.itemSize,d=a.normalized,f=new c.constructor(l.length*h);let p=0,g=0;for(let m=0,v=l.length;m<v;m++){a.isInterleavedBufferAttribute?p=l[m]*a.data.stride+a.offset:p=l[m]*h;for(let y=0;y<h;y++)f[g++]=c[p++]}return new An(f,h,d)}if(u(e,"convertBufferAttribute"),this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new at,s=this.index.array,i=this.attributes;for(const a in i){const l=i[a],c=e(l,s);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,d=c.length;h<d;h++){const f=c[h],p=e(f,s);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const s=this.attributes;for(const l in s){const c=s[l];e.data.attributes[l]=c.toJSON(e.data)}const i={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let d=0,f=c.length;d<f;d++){const p=c[d];h.push(p.toJSON(e.data))}h.length>0&&(i[l]=h,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const s=e.index;s!==null&&this.setIndex(s.clone(t));const i=e.attributes;for(const c in i){const h=i[c];this.setAttribute(c,h.clone(t))}const r=e.morphAttributes;for(const c in r){const h=[],d=r[c];for(let f=0,p=d.length;f<p;f++)h.push(d[f].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,h=o.length;c<h;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}u(at,"BufferGeometry");const v2=new be,Dc=new Xa,bv=new ja,sa=new P,ia=new P,ra=new P,wv=new P,xv=new P,Av=new P,Bp=new P,Up=new P,$p=new P,Vp=new $e,Gp=new $e,Hp=new $e,Mv=new P,Wp=new P;class Ye extends Lt{constructor(e=new at,t=new Fs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,s=Object.keys(t);if(s.length>0){const i=t[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}raycast(e,t){const s=this.geometry,i=this.material,r=this.matrixWorld;if(i===void 0||(s.boundingSphere===null&&s.computeBoundingSphere(),bv.copy(s.boundingSphere),bv.applyMatrix4(r),e.ray.intersectsSphere(bv)===!1)||(v2.copy(r).invert(),Dc.copy(e.ray).applyMatrix4(v2),s.boundingBox!==null&&Dc.intersectsBox(s.boundingBox)===!1))return;let o;const a=s.index,l=s.attributes.position,c=s.morphAttributes.position,h=s.morphTargetsRelative,d=s.attributes.uv,f=s.attributes.uv2,p=s.groups,g=s.drawRange;if(a!==null)if(Array.isArray(i))for(let m=0,v=p.length;m<v;m++){const y=p[m],b=i[y.materialIndex],_=Math.max(y.start,g.start),w=Math.min(a.count,Math.min(y.start+y.count,g.start+g.count));for(let x=_,S=w;x<S;x+=3){const C=a.getX(x),M=a.getX(x+1),R=a.getX(x+2);o=jp(this,b,e,Dc,l,c,h,d,f,C,M,R),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(a.count,g.start+g.count);for(let y=m,b=v;y<b;y+=3){const _=a.getX(y),w=a.getX(y+1),x=a.getX(y+2);o=jp(this,i,e,Dc,l,c,h,d,f,_,w,x),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(i))for(let m=0,v=p.length;m<v;m++){const y=p[m],b=i[y.materialIndex],_=Math.max(y.start,g.start),w=Math.min(l.count,Math.min(y.start+y.count,g.start+g.count));for(let x=_,S=w;x<S;x+=3){const C=x,M=x+1,R=x+2;o=jp(this,b,e,Dc,l,c,h,d,f,C,M,R),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(l.count,g.start+g.count);for(let y=m,b=v;y<b;y+=3){const _=y,w=y+1,x=y+2;o=jp(this,i,e,Dc,l,c,h,d,f,_,w,x),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}}}u(Ye,"Mesh");function rB(n,e,t,s,i,r,o,a){let l;if(e.side===Ki?l=s.intersectTriangle(o,r,i,!0,a):l=s.intersectTriangle(i,r,o,e.side!==Di,a),l===null)return null;Wp.copy(a),Wp.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Wp);return c<t.near||c>t.far?null:{distance:c,point:Wp.clone(),object:n}}u(rB,"checkIntersection");function jp(n,e,t,s,i,r,o,a,l,c,h,d){sa.fromBufferAttribute(i,c),ia.fromBufferAttribute(i,h),ra.fromBufferAttribute(i,d);const f=n.morphTargetInfluences;if(r&&f){Bp.set(0,0,0),Up.set(0,0,0),$p.set(0,0,0);for(let g=0,m=r.length;g<m;g++){const v=f[g],y=r[g];v!==0&&(wv.fromBufferAttribute(y,c),xv.fromBufferAttribute(y,h),Av.fromBufferAttribute(y,d),o?(Bp.addScaledVector(wv,v),Up.addScaledVector(xv,v),$p.addScaledVector(Av,v)):(Bp.addScaledVector(wv.sub(sa),v),Up.addScaledVector(xv.sub(ia),v),$p.addScaledVector(Av.sub(ra),v)))}sa.add(Bp),ia.add(Up),ra.add($p)}n.isSkinnedMesh&&(n.boneTransform(c,sa),n.boneTransform(h,ia),n.boneTransform(d,ra));const p=rB(n,e,t,s,sa,ia,ra,Mv);if(p){a&&(Vp.fromBufferAttribute(a,c),Gp.fromBufferAttribute(a,h),Hp.fromBufferAttribute(a,d),p.uv=$r.getUV(Mv,sa,ia,ra,Vp,Gp,Hp,new $e)),l&&(Vp.fromBufferAttribute(l,c),Gp.fromBufferAttribute(l,h),Hp.fromBufferAttribute(l,d),p.uv2=$r.getUV(Mv,sa,ia,ra,Vp,Gp,Hp,new $e));const g={a:c,b:h,c:d,normal:new P,materialIndex:0};$r.getNormal(sa,ia,ra,g.normal),p.face=g}return p}u(jp,"checkBufferGeometryIntersection");class mr extends at{constructor(e=1,t=1,s=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:s,widthSegments:i,heightSegments:r,depthSegments:o};const a=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],d=[];let f=0,p=0;g("z","y","x",-1,-1,s,t,e,o,r,0),g("z","y","x",1,-1,s,t,-e,o,r,1),g("x","z","y",1,1,e,s,t,i,o,2),g("x","z","y",1,-1,e,s,-t,i,o,3),g("x","y","z",1,-1,e,t,s,i,r,4),g("x","y","z",-1,-1,e,t,-s,i,r,5),this.setIndex(l),this.setAttribute("position",new We(c,3)),this.setAttribute("normal",new We(h,3)),this.setAttribute("uv",new We(d,2));function g(m,v,y,b,_,w,x,S,C,M,R){const D=w/C,k=x/M,T=w/2,N=x/2,E=S/2,z=C+1,H=M+1;let q=0,ne=0;const W=new P;for(let se=0;se<H;se++){const K=se*k-N;for(let U=0;U<z;U++){const he=U*D-T;W[m]=he*b,W[v]=K*_,W[y]=E,c.push(W.x,W.y,W.z),W[m]=0,W[v]=0,W[y]=S>0?1:-1,h.push(W.x,W.y,W.z),d.push(U/C),d.push(1-se/M),q+=1}}for(let se=0;se<M;se++)for(let K=0;K<C;K++){const U=f+K+z*se,he=f+K+z*(se+1),ue=f+(K+1)+z*(se+1),Q=f+(K+1)+z*se;l.push(U,he,Q),l.push(he,ue,Q),ne+=6}a.addGroup(p,ne,R),p+=ne,f+=q}u(g,"buildPlane")}static fromJSON(e){return new mr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}u(mr,"BoxGeometry");function Bu(n){const e={};for(const t in n){e[t]={};for(const s in n[t]){const i=n[t][s];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?e[t][s]=i.clone():Array.isArray(i)?e[t][s]=i.slice():e[t][s]=i}}return e}u(Bu,"cloneUniforms");function js(n){const e={};for(let t=0;t<n.length;t++){const s=Bu(n[t]);for(const i in s)e[i]=s[i]}return e}u(js,"mergeUniforms");function oB(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}u(oB,"cloneUniformsGroups");const H0={clone:Bu,merge:js};var aB=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lB=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class bs extends zs{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=aB,this.fragmentShader=lB,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Bu(e.uniforms),this.uniformsGroups=oB(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const s={};for(const i in this.extensions)this.extensions[i]===!0&&(s[i]=!0);return Object.keys(s).length>0&&(t.extensions=s),t}}u(bs,"ShaderMaterial");class W0 extends Lt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new be,this.projectionMatrix=new be,this.projectionMatrixInverse=new be}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}u(W0,"Camera");class _s extends W0{constructor(e=50,t=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Pf*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(uf*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Pf*2*Math.atan(Math.tan(uf*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,s,i,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(uf*.5*this.fov)/this.zoom,s=2*t,i=this.aspect*s,r=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*i/l,t-=o.offsetY*s/c,i*=o.width/l,s*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-s,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}u(_s,"PerspectiveCamera");const Lc=90,Oc=1;class zP extends Lt{constructor(e,t,s){super(),this.type="CubeCamera",this.renderTarget=s;const i=new _s(Lc,Oc,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new P(1,0,0)),this.add(i);const r=new _s(Lc,Oc,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new P(-1,0,0)),this.add(r);const o=new _s(Lc,Oc,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new P(0,1,0)),this.add(o);const a=new _s(Lc,Oc,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new P(0,-1,0)),this.add(a);const l=new _s(Lc,Oc,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new P(0,0,1)),this.add(l);const c=new _s(Lc,Oc,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new P(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const s=this.renderTarget,[i,r,o,a,l,c]=this.children,h=e.getRenderTarget(),d=e.toneMapping,f=e.xr.enabled;e.toneMapping=Xr,e.xr.enabled=!1;const p=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,e.setRenderTarget(s,0),e.render(t,i),e.setRenderTarget(s,1),e.render(t,r),e.setRenderTarget(s,2),e.render(t,o),e.setRenderTarget(s,3),e.render(t,a),e.setRenderTarget(s,4),e.render(t,l),s.texture.generateMipmaps=p,e.setRenderTarget(s,5),e.render(t,c),e.setRenderTarget(h),e.toneMapping=d,e.xr.enabled=f,s.texture.needsPMREMUpdate=!0}}u(zP,"CubeCamera");class Fb extends is{constructor(e,t,s,i,r,o,a,l,c,h){e=e!==void 0?e:[],t=t!==void 0?t:Ou,super(e,t,s,i,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}u(Fb,"CubeTexture");class BP extends ys{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const s={width:e,height:e,depth:1},i=[s,s,s,s,s,s];this.texture=new Fb(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:qs}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new mr(5,5,5),r=new bs({name:"CubemapFromEquirect",uniforms:Bu(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:Ki,blending:jr});r.uniforms.tEquirect.value=t;const o=new Ye(i,r),a=t.minFilter;return t.minFilter===fc&&(t.minFilter=qs),new zP(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,s,i){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,s,i);e.setRenderTarget(r)}}u(BP,"WebGLCubeRenderTarget");const Sv=new P,cB=new P,uB=new Qs;class Po{constructor(e=new P(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,s,i){return this.normal.set(e,t,s),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,s){const i=Sv.subVectors(s,t).cross(cB.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const s=e.delta(Sv),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(s).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),s=this.distanceToPoint(e.end);return t<0&&s>0||s<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const s=t||uB.getNormalMatrix(e),i=this.coplanarPoint(Sv).applyMatrix4(e),r=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}u(Po,"Plane$1");const kc=new ja,Xp=new P;class ep{constructor(e=new Po,t=new Po,s=new Po,i=new Po,r=new Po,o=new Po){this.planes=[e,t,s,i,r,o]}set(e,t,s,i,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(s),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let s=0;s<6;s++)t[s].copy(e.planes[s]);return this}setFromProjectionMatrix(e){const t=this.planes,s=e.elements,i=s[0],r=s[1],o=s[2],a=s[3],l=s[4],c=s[5],h=s[6],d=s[7],f=s[8],p=s[9],g=s[10],m=s[11],v=s[12],y=s[13],b=s[14],_=s[15];return t[0].setComponents(a-i,d-l,m-f,_-v).normalize(),t[1].setComponents(a+i,d+l,m+f,_+v).normalize(),t[2].setComponents(a+r,d+c,m+p,_+y).normalize(),t[3].setComponents(a-r,d-c,m-p,_-y).normalize(),t[4].setComponents(a-o,d-h,m-g,_-b).normalize(),t[5].setComponents(a+o,d+h,m+g,_+b).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),kc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(kc)}intersectsSprite(e){return kc.center.set(0,0,0),kc.radius=.7071067811865476,kc.applyMatrix4(e.matrixWorld),this.intersectsSphere(kc)}intersectsSphere(e){const t=this.planes,s=e.center,i=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(s)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let s=0;s<6;s++){const i=t[s];if(Xp.x=i.normal.x>0?e.max.x:e.min.x,Xp.y=i.normal.y>0?e.max.y:e.min.y,Xp.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Xp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let s=0;s<6;s++)if(t[s].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}u(ep,"Frustum");function UP(){let n=null,e=!1,t=null,s=null;function i(r,o){t(r,o),s=n.requestAnimationFrame(i)}return u(i,"onAnimationFrame"),{start:function(){e!==!0&&t!==null&&(s=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(s),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){n=r}}}u(UP,"WebGLAnimation");function hB(n,e){const t=e.isWebGL2,s=new WeakMap;function i(c,h){const d=c.array,f=c.usage,p=n.createBuffer();n.bindBuffer(h,p),n.bufferData(h,d,f),c.onUploadCallback();let g;if(d instanceof Float32Array)g=5126;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(d instanceof Int16Array)g=5122;else if(d instanceof Uint32Array)g=5125;else if(d instanceof Int32Array)g=5124;else if(d instanceof Int8Array)g=5120;else if(d instanceof Uint8Array)g=5121;else if(d instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:p,type:g,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}u(i,"createBuffer");function r(c,h,d){const f=h.array,p=h.updateRange;n.bindBuffer(d,c),p.count===-1?n.bufferSubData(d,0,f):(t?n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):n.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1)}u(r,"updateBuffer");function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),s.get(c)}u(o,"get");function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=s.get(c);h&&(n.deleteBuffer(h.buffer),s.delete(c))}u(a,"remove");function l(c,h){if(c.isGLBufferAttribute){const f=s.get(c);(!f||f.version<c.version)&&s.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=s.get(c);d===void 0?s.set(c,i(c,h)):d.version<c.version&&(r(d.buffer,c,h),d.version=c.version)}return u(l,"update"),{get:o,remove:a,update:l}}u(hB,"WebGLAttributes");class Uu extends at{constructor(e=1,t=1,s=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:s,heightSegments:i};const r=e/2,o=t/2,a=Math.floor(s),l=Math.floor(i),c=a+1,h=l+1,d=e/a,f=t/l,p=[],g=[],m=[],v=[];for(let y=0;y<h;y++){const b=y*f-o;for(let _=0;_<c;_++){const w=_*d-r;g.push(w,-b,0),m.push(0,0,1),v.push(_/a),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let b=0;b<a;b++){const _=b+c*y,w=b+c*(y+1),x=b+1+c*(y+1),S=b+1+c*y;p.push(_,w,S),p.push(w,x,S)}this.setIndex(p),this.setAttribute("position",new We(g,3)),this.setAttribute("normal",new We(m,3)),this.setAttribute("uv",new We(v,2))}static fromJSON(e){return new Uu(e.width,e.height,e.widthSegments,e.heightSegments)}}u(Uu,"PlaneGeometry");var dB=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,fB=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,pB=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,mB=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,gB=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,vB=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,yB="vec3 transformed = vec3( position );",_B=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bB=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,wB=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,xB=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,AB=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,MB=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,SB=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,CB=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,EB=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,TB=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,PB=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,RB=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,IB=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,DB=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,LB=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,OB=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,kB=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,NB=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,FB=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,zB="gl_FragColor = linearToOutputTexel( gl_FragColor );",BB=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,UB=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,$B=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,VB=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,GB=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,HB=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,WB=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,jB=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,XB=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,YB=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,qB=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,KB=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,ZB=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,QB=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,JB=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,eU=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,tU=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,nU=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,sU=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,iU=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,rU=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,oU=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,aU=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lU=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,cU=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,uU=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,hU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,dU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,fU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,pU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,mU=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,gU=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,vU=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,yU=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_U=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,bU=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,wU=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,xU=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,AU=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,MU=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,SU=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,CU=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,EU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,TU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,PU=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,RU=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,IU=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,DU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,LU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,OU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,kU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,NU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,FU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,zU=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,BU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,UU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,$U=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,VU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,GU=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,HU=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,WU=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,jU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,XU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,YU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,qU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,KU=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,ZU=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,QU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,JU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,e6=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,t6=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,n6=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,s6=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,i6=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,r6=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,o6=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,a6=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,l6=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,c6=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const u6=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,h6=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,d6=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,f6=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,p6=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,m6=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,g6=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,v6=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,y6=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,_6=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,b6=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,w6=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,x6=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,A6=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,M6=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,S6=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,C6=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,E6=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,T6=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,P6=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,R6=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,I6=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,D6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,L6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,O6=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,k6=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,N6=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,F6=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,z6=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,B6=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,U6=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$6=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,V6=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,G6=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,At={alphamap_fragment:dB,alphamap_pars_fragment:fB,alphatest_fragment:pB,alphatest_pars_fragment:mB,aomap_fragment:gB,aomap_pars_fragment:vB,begin_vertex:yB,beginnormal_vertex:_B,bsdfs:bB,iridescence_fragment:wB,bumpmap_pars_fragment:xB,clipping_planes_fragment:AB,clipping_planes_pars_fragment:MB,clipping_planes_pars_vertex:SB,clipping_planes_vertex:CB,color_fragment:EB,color_pars_fragment:TB,color_pars_vertex:PB,color_vertex:RB,common:IB,cube_uv_reflection_fragment:DB,defaultnormal_vertex:LB,displacementmap_pars_vertex:OB,displacementmap_vertex:kB,emissivemap_fragment:NB,emissivemap_pars_fragment:FB,encodings_fragment:zB,encodings_pars_fragment:BB,envmap_fragment:UB,envmap_common_pars_fragment:$B,envmap_pars_fragment:VB,envmap_pars_vertex:GB,envmap_physical_pars_fragment:tU,envmap_vertex:HB,fog_vertex:WB,fog_pars_vertex:jB,fog_fragment:XB,fog_pars_fragment:YB,gradientmap_pars_fragment:qB,lightmap_fragment:KB,lightmap_pars_fragment:ZB,lights_lambert_fragment:QB,lights_lambert_pars_fragment:JB,lights_pars_begin:eU,lights_toon_fragment:nU,lights_toon_pars_fragment:sU,lights_phong_fragment:iU,lights_phong_pars_fragment:rU,lights_physical_fragment:oU,lights_physical_pars_fragment:aU,lights_fragment_begin:lU,lights_fragment_maps:cU,lights_fragment_end:uU,logdepthbuf_fragment:hU,logdepthbuf_pars_fragment:dU,logdepthbuf_pars_vertex:fU,logdepthbuf_vertex:pU,map_fragment:mU,map_pars_fragment:gU,map_particle_fragment:vU,map_particle_pars_fragment:yU,metalnessmap_fragment:_U,metalnessmap_pars_fragment:bU,morphcolor_vertex:wU,morphnormal_vertex:xU,morphtarget_pars_vertex:AU,morphtarget_vertex:MU,normal_fragment_begin:SU,normal_fragment_maps:CU,normal_pars_fragment:EU,normal_pars_vertex:TU,normal_vertex:PU,normalmap_pars_fragment:RU,clearcoat_normal_fragment_begin:IU,clearcoat_normal_fragment_maps:DU,clearcoat_pars_fragment:LU,iridescence_pars_fragment:OU,output_fragment:kU,packing:NU,premultiplied_alpha_fragment:FU,project_vertex:zU,dithering_fragment:BU,dithering_pars_fragment:UU,roughnessmap_fragment:$U,roughnessmap_pars_fragment:VU,shadowmap_pars_fragment:GU,shadowmap_pars_vertex:HU,shadowmap_vertex:WU,shadowmask_pars_fragment:jU,skinbase_vertex:XU,skinning_pars_vertex:YU,skinning_vertex:qU,skinnormal_vertex:KU,specularmap_fragment:ZU,specularmap_pars_fragment:QU,tonemapping_fragment:JU,tonemapping_pars_fragment:e6,transmission_fragment:t6,transmission_pars_fragment:n6,uv_pars_fragment:s6,uv_pars_vertex:i6,uv_vertex:r6,uv2_pars_fragment:o6,uv2_pars_vertex:a6,uv2_vertex:l6,worldpos_vertex:c6,background_vert:u6,background_frag:h6,backgroundCube_vert:d6,backgroundCube_frag:f6,cube_vert:p6,cube_frag:m6,depth_vert:g6,depth_frag:v6,distanceRGBA_vert:y6,distanceRGBA_frag:_6,equirect_vert:b6,equirect_frag:w6,linedashed_vert:x6,linedashed_frag:A6,meshbasic_vert:M6,meshbasic_frag:S6,meshlambert_vert:C6,meshlambert_frag:E6,meshmatcap_vert:T6,meshmatcap_frag:P6,meshnormal_vert:R6,meshnormal_frag:I6,meshphong_vert:D6,meshphong_frag:L6,meshphysical_vert:O6,meshphysical_frag:k6,meshtoon_vert:N6,meshtoon_frag:F6,points_vert:z6,points_frag:B6,shadow_vert:U6,shadow_frag:$6,sprite_vert:V6,sprite_frag:G6},Ve={common:{diffuse:{value:new De(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Qs},uv2Transform:{value:new Qs},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $e(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new De(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new De(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Qs}},sprite:{diffuse:{value:new De(16777215)},opacity:{value:1},center:{value:new $e(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Qs}}},Br={basic:{uniforms:js([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.fog]),vertexShader:At.meshbasic_vert,fragmentShader:At.meshbasic_frag},lambert:{uniforms:js([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,Ve.lights,{emissive:{value:new De(0)}}]),vertexShader:At.meshlambert_vert,fragmentShader:At.meshlambert_frag},phong:{uniforms:js([Ve.common,Ve.specularmap,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,Ve.lights,{emissive:{value:new De(0)},specular:{value:new De(1118481)},shininess:{value:30}}]),vertexShader:At.meshphong_vert,fragmentShader:At.meshphong_frag},standard:{uniforms:js([Ve.common,Ve.envmap,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.roughnessmap,Ve.metalnessmap,Ve.fog,Ve.lights,{emissive:{value:new De(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:At.meshphysical_vert,fragmentShader:At.meshphysical_frag},toon:{uniforms:js([Ve.common,Ve.aomap,Ve.lightmap,Ve.emissivemap,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.gradientmap,Ve.fog,Ve.lights,{emissive:{value:new De(0)}}]),vertexShader:At.meshtoon_vert,fragmentShader:At.meshtoon_frag},matcap:{uniforms:js([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,Ve.fog,{matcap:{value:null}}]),vertexShader:At.meshmatcap_vert,fragmentShader:At.meshmatcap_frag},points:{uniforms:js([Ve.points,Ve.fog]),vertexShader:At.points_vert,fragmentShader:At.points_frag},dashed:{uniforms:js([Ve.common,Ve.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:At.linedashed_vert,fragmentShader:At.linedashed_frag},depth:{uniforms:js([Ve.common,Ve.displacementmap]),vertexShader:At.depth_vert,fragmentShader:At.depth_frag},normal:{uniforms:js([Ve.common,Ve.bumpmap,Ve.normalmap,Ve.displacementmap,{opacity:{value:1}}]),vertexShader:At.meshnormal_vert,fragmentShader:At.meshnormal_frag},sprite:{uniforms:js([Ve.sprite,Ve.fog]),vertexShader:At.sprite_vert,fragmentShader:At.sprite_frag},background:{uniforms:{uvTransform:{value:new Qs},t2D:{value:null}},vertexShader:At.background_vert,fragmentShader:At.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0}},vertexShader:At.backgroundCube_vert,fragmentShader:At.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:At.cube_vert,fragmentShader:At.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:At.equirect_vert,fragmentShader:At.equirect_frag},distanceRGBA:{uniforms:js([Ve.common,Ve.displacementmap,{referencePosition:{value:new P},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:At.distanceRGBA_vert,fragmentShader:At.distanceRGBA_frag},shadow:{uniforms:js([Ve.lights,Ve.fog,{color:{value:new De(0)},opacity:{value:1}}]),vertexShader:At.shadow_vert,fragmentShader:At.shadow_frag}};Br.physical={uniforms:js([Br.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new $e(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new De(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new $e},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new De(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new De(1,1,1)},specularColorMap:{value:null}}]),vertexShader:At.meshphysical_vert,fragmentShader:At.meshphysical_frag};function H6(n,e,t,s,i,r,o){const a=new De(0);let l=r===!0?0:1,c,h,d=null,f=0,p=null;function g(v,y){let b=!1,_=y.isScene===!0?y.background:null;_&&_.isTexture&&(_=(y.backgroundBlurriness>0?t:e).get(_));const w=n.xr,x=w.getSession&&w.getSession();x&&x.environmentBlendMode==="additive"&&(_=null),_===null?m(a,l):_&&_.isColor&&(m(_,1),b=!0),(n.autoClear||b)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),_&&(_.isCubeTexture||_.mapping===U0)?(h===void 0&&(h=new Ye(new mr(1,1,1),new bs({name:"BackgroundCubeMaterial",uniforms:Bu(Br.backgroundCube.uniforms),vertexShader:Br.backgroundCube.vertexShader,fragmentShader:Br.backgroundCube.fragmentShader,side:Ki,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(S,C,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,(d!==_||f!==_.version||p!==n.toneMapping)&&(h.material.needsUpdate=!0,d=_,f=_.version,p=n.toneMapping),h.layers.enableAll(),v.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new Ye(new Uu(2,2),new bs({name:"BackgroundMaterial",uniforms:Bu(Br.background.uniforms),vertexShader:Br.background.vertexShader,fragmentShader:Br.background.fragmentShader,side:ql,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(d!==_||f!==_.version||p!==n.toneMapping)&&(c.material.needsUpdate=!0,d=_,f=_.version,p=n.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}u(g,"render");function m(v,y){s.buffers.color.setClear(v.r,v.g,v.b,y,o)}return u(m,"setClear"),{getClearColor:function(){return a},setClearColor:function(v,y=1){a.set(v),l=y,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,m(a,l)},render:g}}u(H6,"WebGLBackground");function W6(n,e,t,s){const i=n.getParameter(34921),r=s.isWebGL2?null:e.get("OES_vertex_array_object"),o=s.isWebGL2||r!==null,a={},l=v(null);let c=l,h=!1;function d(E,z,H,q,ne){let W=!1;if(o){const se=m(q,H,z);c!==se&&(c=se,p(c.object)),W=y(E,q,H,ne),W&&b(E,q,H,ne)}else{const se=z.wireframe===!0;(c.geometry!==q.id||c.program!==H.id||c.wireframe!==se)&&(c.geometry=q.id,c.program=H.id,c.wireframe=se,W=!0)}ne!==null&&t.update(ne,34963),(W||h)&&(h=!1,M(E,z,H,q),ne!==null&&n.bindBuffer(34963,t.get(ne).buffer))}u(d,"setup");function f(){return s.isWebGL2?n.createVertexArray():r.createVertexArrayOES()}u(f,"createVertexArrayObject");function p(E){return s.isWebGL2?n.bindVertexArray(E):r.bindVertexArrayOES(E)}u(p,"bindVertexArrayObject");function g(E){return s.isWebGL2?n.deleteVertexArray(E):r.deleteVertexArrayOES(E)}u(g,"deleteVertexArrayObject");function m(E,z,H){const q=H.wireframe===!0;let ne=a[E.id];ne===void 0&&(ne={},a[E.id]=ne);let W=ne[z.id];W===void 0&&(W={},ne[z.id]=W);let se=W[q];return se===void 0&&(se=v(f()),W[q]=se),se}u(m,"getBindingState");function v(E){const z=[],H=[],q=[];for(let ne=0;ne<i;ne++)z[ne]=0,H[ne]=0,q[ne]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:z,enabledAttributes:H,attributeDivisors:q,object:E,attributes:{},index:null}}u(v,"createBindingState");function y(E,z,H,q){const ne=c.attributes,W=z.attributes;let se=0;const K=H.getAttributes();for(const U in K)if(K[U].location>=0){const ue=ne[U];let Q=W[U];if(Q===void 0&&(U==="instanceMatrix"&&E.instanceMatrix&&(Q=E.instanceMatrix),U==="instanceColor"&&E.instanceColor&&(Q=E.instanceColor)),ue===void 0||ue.attribute!==Q||Q&&ue.data!==Q.data)return!0;se++}return c.attributesNum!==se||c.index!==q}u(y,"needsUpdate");function b(E,z,H,q){const ne={},W=z.attributes;let se=0;const K=H.getAttributes();for(const U in K)if(K[U].location>=0){let ue=W[U];ue===void 0&&(U==="instanceMatrix"&&E.instanceMatrix&&(ue=E.instanceMatrix),U==="instanceColor"&&E.instanceColor&&(ue=E.instanceColor));const Q={};Q.attribute=ue,ue&&ue.data&&(Q.data=ue.data),ne[U]=Q,se++}c.attributes=ne,c.attributesNum=se,c.index=q}u(b,"saveCache");function _(){const E=c.newAttributes;for(let z=0,H=E.length;z<H;z++)E[z]=0}u(_,"initAttributes");function w(E){x(E,0)}u(w,"enableAttribute");function x(E,z){const H=c.newAttributes,q=c.enabledAttributes,ne=c.attributeDivisors;H[E]=1,q[E]===0&&(n.enableVertexAttribArray(E),q[E]=1),ne[E]!==z&&((s.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[s.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](E,z),ne[E]=z)}u(x,"enableAttributeAndDivisor");function S(){const E=c.newAttributes,z=c.enabledAttributes;for(let H=0,q=z.length;H<q;H++)z[H]!==E[H]&&(n.disableVertexAttribArray(H),z[H]=0)}u(S,"disableUnusedAttributes");function C(E,z,H,q,ne,W){s.isWebGL2===!0&&(H===5124||H===5125)?n.vertexAttribIPointer(E,z,H,ne,W):n.vertexAttribPointer(E,z,H,q,ne,W)}u(C,"vertexAttribPointer");function M(E,z,H,q){if(s.isWebGL2===!1&&(E.isInstancedMesh||q.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;_();const ne=q.attributes,W=H.getAttributes(),se=z.defaultAttributeValues;for(const K in W){const U=W[K];if(U.location>=0){let he=ne[K];if(he===void 0&&(K==="instanceMatrix"&&E.instanceMatrix&&(he=E.instanceMatrix),K==="instanceColor"&&E.instanceColor&&(he=E.instanceColor)),he!==void 0){const ue=he.normalized,Q=he.itemSize,te=t.get(he);if(te===void 0)continue;const _e=te.buffer,pe=te.type,Ae=te.bytesPerElement;if(he.isInterleavedBufferAttribute){const Me=he.data,Ie=Me.stride,$=he.offset;if(Me.isInstancedInterleavedBuffer){for(let X=0;X<U.locationSize;X++)x(U.location+X,Me.meshPerAttribute);E.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=Me.meshPerAttribute*Me.count)}else for(let X=0;X<U.locationSize;X++)w(U.location+X);n.bindBuffer(34962,_e);for(let X=0;X<U.locationSize;X++)C(U.location+X,Q/U.locationSize,pe,ue,Ie*Ae,($+Q/U.locationSize*X)*Ae)}else{if(he.isInstancedBufferAttribute){for(let Me=0;Me<U.locationSize;Me++)x(U.location+Me,he.meshPerAttribute);E.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=he.meshPerAttribute*he.count)}else for(let Me=0;Me<U.locationSize;Me++)w(U.location+Me);n.bindBuffer(34962,_e);for(let Me=0;Me<U.locationSize;Me++)C(U.location+Me,Q/U.locationSize,pe,ue,Q*Ae,Q/U.locationSize*Me*Ae)}}else if(se!==void 0){const ue=se[K];if(ue!==void 0)switch(ue.length){case 2:n.vertexAttrib2fv(U.location,ue);break;case 3:n.vertexAttrib3fv(U.location,ue);break;case 4:n.vertexAttrib4fv(U.location,ue);break;default:n.vertexAttrib1fv(U.location,ue)}}}}S()}u(M,"setupVertexAttributes");function R(){T();for(const E in a){const z=a[E];for(const H in z){const q=z[H];for(const ne in q)g(q[ne].object),delete q[ne];delete z[H]}delete a[E]}}u(R,"dispose");function D(E){if(a[E.id]===void 0)return;const z=a[E.id];for(const H in z){const q=z[H];for(const ne in q)g(q[ne].object),delete q[ne];delete z[H]}delete a[E.id]}u(D,"releaseStatesOfGeometry");function k(E){for(const z in a){const H=a[z];if(H[E.id]===void 0)continue;const q=H[E.id];for(const ne in q)g(q[ne].object),delete q[ne];delete H[E.id]}}u(k,"releaseStatesOfProgram");function T(){N(),h=!0,c!==l&&(c=l,p(c.object))}u(T,"reset");function N(){l.geometry=null,l.program=null,l.wireframe=!1}return u(N,"resetDefaultState"),{setup:d,reset:T,resetDefaultState:N,dispose:R,releaseStatesOfGeometry:D,releaseStatesOfProgram:k,initAttributes:_,enableAttribute:w,disableUnusedAttributes:S}}u(W6,"WebGLBindingStates");function j6(n,e,t,s){const i=s.isWebGL2;let r;function o(c){r=c}u(o,"setMode");function a(c,h){n.drawArrays(r,c,h),t.update(h,r,1)}u(a,"render");function l(c,h,d){if(d===0)return;let f,p;if(i)f=n,p="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[p](r,c,h,d),t.update(h,r,d)}u(l,"renderInstances"),this.setMode=o,this.render=a,this.renderInstances=l}u(j6,"WebGLBufferRenderer");function X6(n,e,t){let s;function i(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");s=n.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}u(i,"getMaxAnisotropy");function r(C){if(C==="highp"){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";C="mediump"}return C==="mediump"&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}u(r,"getMaxPrecision");const o=typeof WebGL2RenderingContext!="undefined"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&n instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),h=t.logarithmicDepthBuffer===!0,d=n.getParameter(34930),f=n.getParameter(35660),p=n.getParameter(3379),g=n.getParameter(34076),m=n.getParameter(34921),v=n.getParameter(36347),y=n.getParameter(36348),b=n.getParameter(36349),_=f>0,w=o||e.has("OES_texture_float"),x=_&&w,S=o?n.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:d,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:b,vertexTextures:_,floatFragmentTextures:w,floatVertexTextures:x,maxSamples:S}}u(X6,"WebGLCapabilities");function Y6(n){const e=this;let t=null,s=0,i=!1,r=!1;const o=new Po,a=new Qs,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f,p){const g=d.length!==0||f||s!==0||i;return i=f,t=h(d,p,0),s=d.length,g},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,c()},this.setState=function(d,f,p){const g=d.clippingPlanes,m=d.clipIntersection,v=d.clipShadows,y=n.get(d);if(!i||g===null||g.length===0||r&&!v)r?h(null):c();else{const b=r?0:s,_=b*4;let w=y.clippingState||null;l.value=w,w=h(g,f,_,p);for(let x=0;x!==_;++x)w[x]=t[x];y.clippingState=w,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=s>0),e.numPlanes=s,e.numIntersection=0}u(c,"resetGlobalState");function h(d,f,p,g){const m=d!==null?d.length:0;let v=null;if(m!==0){if(v=l.value,g!==!0||v===null){const y=p+m*4,b=f.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<y)&&(v=new Float32Array(y));for(let _=0,w=p;_!==m;++_,w+=4)o.copy(d[_]).applyMatrix4(b,a),o.normal.toArray(v,w),v[w+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,v}u(h,"projectPlanes")}u(Y6,"WebGLClipping");function q6(n){let e=new WeakMap;function t(o,a){return a===e0?o.mapping=Ou:a===T_&&(o.mapping=ku),o}u(t,"mapTextureMapping");function s(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===e0||a===T_)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new BP(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",i),t(c.texture,o.mapping)}else return null}}return o}u(s,"get");function i(o){const a=o.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}u(i,"onTextureDispose");function r(){e=new WeakMap}return u(r,"dispose"),{get:s,dispose:r}}u(q6,"WebGLCubeMaps");class Ya extends W0{constructor(e=-1,t=1,s=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=s,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,s,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=s,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=s-e,o=s+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}u(Ya,"OrthographicCamera");const pu=4,y2=[.125,.215,.35,.446,.526,.582],kl=20,Cv=new Ya,_2=new De;let Ev=null;const Rl=(1+Math.sqrt(5))/2,Nc=1/Rl,b2=[new P(1,1,1),new P(-1,1,1),new P(1,1,-1),new P(-1,1,-1),new P(0,Rl,Nc),new P(0,Rl,-Nc),new P(Nc,0,Rl),new P(-Nc,0,Rl),new P(Rl,Nc,0),new P(-Rl,Nc,0)];class D_{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,s=.1,i=100){Ev=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,s,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=A2(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=x2(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ev),e.scissorTest=!1,Yp(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ou||e.mapping===ku?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ev=this._renderer.getRenderTarget();const s=t||this._allocateTargets();return this._textureToCubeUV(e,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,s={magFilter:qs,minFilter:qs,generateMipmaps:!1,type:Nu,format:Ii,encoding:Bo,depthBuffer:!1},i=w2(e,t,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=w2(e,t,s);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=K6(r)),this._blurMaterial=Z6(r,e,t)}return i}_compileMaterial(e){const t=new Ye(this._lodPlanes[0],e);this._renderer.compile(t,Cv)}_sceneToCubeUV(e,t,s,i){const a=new _s(90,1,t,s),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(_2),h.toneMapping=Xr,h.autoClear=!1;const p=new Fs({name:"PMREM.Background",side:Ki,depthWrite:!1,depthTest:!1}),g=new Ye(new mr,p);let m=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,m=!0):(p.color.copy(_2),m=!0);for(let y=0;y<6;y++){const b=y%3;b===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):b===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const _=this._cubeSize;Yp(i,b*_,y>2?_:0,_,_),h.setRenderTarget(i),m&&h.render(g,a),h.render(e,a)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=v}_textureToCubeUV(e,t){const s=this._renderer,i=e.mapping===Ou||e.mapping===ku;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=A2()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=x2());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new Ye(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;Yp(t,0,0,3*l,2*l),s.setRenderTarget(t),s.render(o,Cv)}_applyPMREM(e){const t=this._renderer,s=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=b2[(i-1)%b2.length];this._blur(e,i-1,i,r,o)}t.autoClear=s}_blur(e,t,s,i,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,s,i,"latitudinal",r),this._halfBlur(o,e,s,s,i,"longitudinal",r)}_halfBlur(e,t,s,i,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,d=new Ye(this._lodPlanes[i],c),f=c.uniforms,p=this._sizeLods[s]-1,g=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*kl-1),m=r/g,v=isFinite(r)?1+Math.floor(h*m):kl;v>kl&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${kl}`);const y=[];let b=0;for(let C=0;C<kl;++C){const M=C/m,R=Math.exp(-M*M/2);y.push(R),C===0?b+=R:C<v&&(b+=2*R)}for(let C=0;C<y.length;C++)y[C]=y[C]/b;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=y,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:_}=this;f.dTheta.value=g,f.mipInt.value=_-s;const w=this._sizeLods[i],x=3*w*(i>_-pu?i-_+pu:0),S=4*(this._cubeSize-w);Yp(t,x,S,3*w,2*w),l.setRenderTarget(t),l.render(d,Cv)}}u(D_,"PMREMGenerator");function K6(n){const e=[],t=[],s=[];let i=n;const r=n-pu+1+y2.length;for(let o=0;o<r;o++){const a=Math.pow(2,i);t.push(a);let l=1/a;o>n-pu?l=y2[o-n+pu-1]:o===0&&(l=0),s.push(l);const c=1/(a-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],p=6,g=6,m=3,v=2,y=1,b=new Float32Array(m*g*p),_=new Float32Array(v*g*p),w=new Float32Array(y*g*p);for(let S=0;S<p;S++){const C=S%3*2/3-1,M=S>2?0:-1,R=[C,M,0,C+2/3,M,0,C+2/3,M+1,0,C,M,0,C+2/3,M+1,0,C,M+1,0];b.set(R,m*g*S),_.set(f,v*g*S);const D=[S,S,S,S,S,S];w.set(D,y*g*S)}const x=new at;x.setAttribute("position",new An(b,m)),x.setAttribute("uv",new An(_,v)),x.setAttribute("faceIndex",new An(w,y)),e.push(x),i>pu&&i--}return{lodPlanes:e,sizeLods:t,sigmas:s}}u(K6,"_createPlanes");function w2(n,e,t){const s=new ys(n,e,t);return s.texture.mapping=U0,s.texture.name="PMREM.cubeUv",s.scissorTest=!0,s}u(w2,"_createRenderTarget");function Yp(n,e,t,s,i){n.viewport.set(e,t,s,i),n.scissor.set(e,t,s,i)}u(Yp,"_setViewport");function Z6(n,e,t){const s=new Float32Array(kl),i=new P(0,1,0);return new bs({name:"SphericalGaussianBlur",defines:{n:kl,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:s},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:zb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:jr,depthTest:!1,depthWrite:!1})}u(Z6,"_getBlurShader");function x2(){return new bs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:zb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:jr,depthTest:!1,depthWrite:!1})}u(x2,"_getEquirectMaterial");function A2(){return new bs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:zb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:jr,depthTest:!1,depthWrite:!1})}u(A2,"_getCubemapMaterial");function zb(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}u(zb,"_getCommonVertexShader");function Q6(n){let e=new WeakMap,t=null;function s(a){if(a&&a.isTexture){const l=a.mapping,c=l===e0||l===T_,h=l===Ou||l===ku;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new D_(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||h&&d&&i(d)){t===null&&(t=new D_(n));const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}u(s,"get");function i(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}u(i,"isCubeTextureComplete");function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}u(r,"onTextureDispose");function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return u(o,"dispose"),{get:s,dispose:o}}u(Q6,"WebGLCubeUVMaps");function J6(n){const e={};function t(s){if(e[s]!==void 0)return e[s];let i;switch(s){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(s)}return e[s]=i,i}return u(t,"getExtension"),{has:function(s){return t(s)!==null},init:function(s){s.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(s){const i=t(s);return i===null&&console.warn("THREE.WebGLRenderer: "+s+" extension not supported."),i}}}u(J6,"WebGLExtensions");function e$(n,e,t,s){const i={},r=new WeakMap;function o(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);f.removeEventListener("dispose",o),delete i[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),s.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}u(o,"onGeometryDispose");function a(d,f){return i[f.id]===!0||(f.addEventListener("dispose",o),i[f.id]=!0,t.memory.geometries++),f}u(a,"get");function l(d){const f=d.attributes;for(const g in f)e.update(f[g],34962);const p=d.morphAttributes;for(const g in p){const m=p[g];for(let v=0,y=m.length;v<y;v++)e.update(m[v],34962)}}u(l,"update");function c(d){const f=[],p=d.index,g=d.attributes.position;let m=0;if(p!==null){const b=p.array;m=p.version;for(let _=0,w=b.length;_<w;_+=3){const x=b[_+0],S=b[_+1],C=b[_+2];f.push(x,S,S,C,C,x)}}else{const b=g.array;m=g.version;for(let _=0,w=b.length/3-1;_<w;_+=3){const x=_+0,S=_+1,C=_+2;f.push(x,S,S,C,C,x)}}const v=new(kP(f)?Nb:G0)(f,1);v.version=m;const y=r.get(d);y&&e.remove(y),r.set(d,v)}u(c,"updateWireframeAttribute");function h(d){const f=r.get(d);if(f){const p=d.index;p!==null&&f.version<p.version&&c(d)}else c(d);return r.get(d)}return u(h,"getWireframeAttribute"),{get:a,update:l,getWireframeAttribute:h}}u(e$,"WebGLGeometries");function t$(n,e,t,s){const i=s.isWebGL2;let r;function o(f){r=f}u(o,"setMode");let a,l;function c(f){a=f.type,l=f.bytesPerElement}u(c,"setIndex");function h(f,p){n.drawElements(r,p,a,f*l),t.update(p,r,1)}u(h,"render");function d(f,p,g){if(g===0)return;let m,v;if(i)m=n,v="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[v](r,p,a,f*l,g),t.update(p,r,g)}u(d,"renderInstances"),this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=d}u(t$,"WebGLIndexedBufferRenderer");function n$(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function s(r,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}u(s,"update");function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return u(i,"reset"),{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:s}}u(n$,"WebGLInfo");function s$(n,e){return n[0]-e[0]}u(s$,"numericalSort");function i$(n,e){return Math.abs(e[1])-Math.abs(n[1])}u(i$,"absNumericalSort");function r$(n,e,t){const s={},i=new Float32Array(8),r=new WeakMap,o=new Ft,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,d,f){const p=c.morphTargetInfluences;if(e.isWebGL2===!0){const m=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,v=m!==void 0?m.length:0;let y=r.get(h);if(y===void 0||y.count!==v){let H=function(){E.dispose(),r.delete(h),h.removeEventListener("dispose",H)};var g=H;u(H,"disposeTexture"),y!==void 0&&y.texture.dispose();const w=h.morphAttributes.position!==void 0,x=h.morphAttributes.normal!==void 0,S=h.morphAttributes.color!==void 0,C=h.morphAttributes.position||[],M=h.morphAttributes.normal||[],R=h.morphAttributes.color||[];let D=0;w===!0&&(D=1),x===!0&&(D=2),S===!0&&(D=3);let k=h.attributes.position.count*D,T=1;k>e.maxTextureSize&&(T=Math.ceil(k/e.maxTextureSize),k=e.maxTextureSize);const N=new Float32Array(k*T*4*v),E=new kb(N,k,T,v);E.type=Ra,E.needsUpdate=!0;const z=D*4;for(let q=0;q<v;q++){const ne=C[q],W=M[q],se=R[q],K=k*T*4*q;for(let U=0;U<ne.count;U++){const he=U*z;w===!0&&(o.fromBufferAttribute(ne,U),N[K+he+0]=o.x,N[K+he+1]=o.y,N[K+he+2]=o.z,N[K+he+3]=0),x===!0&&(o.fromBufferAttribute(W,U),N[K+he+4]=o.x,N[K+he+5]=o.y,N[K+he+6]=o.z,N[K+he+7]=0),S===!0&&(o.fromBufferAttribute(se,U),N[K+he+8]=o.x,N[K+he+9]=o.y,N[K+he+10]=o.z,N[K+he+11]=se.itemSize===4?o.w:1)}}y={count:v,texture:E,size:new $e(k,T)},r.set(h,y),h.addEventListener("dispose",H)}let b=0;for(let w=0;w<p.length;w++)b+=p[w];const _=h.morphTargetsRelative?1:1-b;f.getUniforms().setValue(n,"morphTargetBaseInfluence",_),f.getUniforms().setValue(n,"morphTargetInfluences",p),f.getUniforms().setValue(n,"morphTargetsTexture",y.texture,t),f.getUniforms().setValue(n,"morphTargetsTextureSize",y.size)}else{const m=p===void 0?0:p.length;let v=s[h.id];if(v===void 0||v.length!==m){v=[];for(let x=0;x<m;x++)v[x]=[x,0];s[h.id]=v}for(let x=0;x<m;x++){const S=v[x];S[0]=x,S[1]=p[x]}v.sort(i$);for(let x=0;x<8;x++)x<m&&v[x][1]?(a[x][0]=v[x][0],a[x][1]=v[x][1]):(a[x][0]=Number.MAX_SAFE_INTEGER,a[x][1]=0);a.sort(s$);const y=h.morphAttributes.position,b=h.morphAttributes.normal;let _=0;for(let x=0;x<8;x++){const S=a[x],C=S[0],M=S[1];C!==Number.MAX_SAFE_INTEGER&&M?(y&&h.getAttribute("morphTarget"+x)!==y[C]&&h.setAttribute("morphTarget"+x,y[C]),b&&h.getAttribute("morphNormal"+x)!==b[C]&&h.setAttribute("morphNormal"+x,b[C]),i[x]=M,_+=M):(y&&h.hasAttribute("morphTarget"+x)===!0&&h.deleteAttribute("morphTarget"+x),b&&h.hasAttribute("morphNormal"+x)===!0&&h.deleteAttribute("morphNormal"+x),i[x]=0)}const w=h.morphTargetsRelative?1:1-_;f.getUniforms().setValue(n,"morphTargetBaseInfluence",w),f.getUniforms().setValue(n,"morphTargetInfluences",i)}}return u(l,"update"),{update:l}}u(r$,"WebGLMorphtargets");function o$(n,e,t,s){let i=new WeakMap;function r(l){const c=s.render.frame,h=l.geometry,d=e.get(l,h);return i.get(d)!==c&&(e.update(d),i.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}u(r,"update");function o(){i=new WeakMap}u(o,"dispose");function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return u(a,"onInstancedMeshDispose"),{update:r,dispose:o}}u(o$,"WebGLObjects");const $P=new is,VP=new kb,GP=new FP,HP=new Fb,M2=[],S2=[],C2=new Float32Array(16),E2=new Float32Array(9),T2=new Float32Array(4);function gh(n,e,t){const s=n[0];if(s<=0||s>0)return n;const i=e*t;let r=M2[i];if(r===void 0&&(r=new Float32Array(i),M2[i]=r),e!==0){s.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(r,a)}return r}u(gh,"flatten$u");function cs(n,e){if(n.length!==e.length)return!1;for(let t=0,s=n.length;t<s;t++)if(n[t]!==e[t])return!1;return!0}u(cs,"arraysEqual");function us(n,e){for(let t=0,s=e.length;t<s;t++)n[t]=e[t]}u(us,"copyArray");function j0(n,e){let t=S2[e];t===void 0&&(t=new Int32Array(e),S2[e]=t);for(let s=0;s!==e;++s)t[s]=n.allocateTextureUnit();return t}u(j0,"allocTexUnits");function a$(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}u(a$,"setValueV1f");function l$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cs(t,e))return;n.uniform2fv(this.addr,e),us(t,e)}}u(l$,"setValueV2f");function c$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(cs(t,e))return;n.uniform3fv(this.addr,e),us(t,e)}}u(c$,"setValueV3f");function u$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cs(t,e))return;n.uniform4fv(this.addr,e),us(t,e)}}u(u$,"setValueV4f");function h$(n,e){const t=this.cache,s=e.elements;if(s===void 0){if(cs(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),us(t,e)}else{if(cs(t,s))return;T2.set(s),n.uniformMatrix2fv(this.addr,!1,T2),us(t,s)}}u(h$,"setValueM2");function d$(n,e){const t=this.cache,s=e.elements;if(s===void 0){if(cs(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),us(t,e)}else{if(cs(t,s))return;E2.set(s),n.uniformMatrix3fv(this.addr,!1,E2),us(t,s)}}u(d$,"setValueM3");function f$(n,e){const t=this.cache,s=e.elements;if(s===void 0){if(cs(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),us(t,e)}else{if(cs(t,s))return;C2.set(s),n.uniformMatrix4fv(this.addr,!1,C2),us(t,s)}}u(f$,"setValueM4");function p$(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}u(p$,"setValueV1i");function m$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cs(t,e))return;n.uniform2iv(this.addr,e),us(t,e)}}u(m$,"setValueV2i");function g$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(cs(t,e))return;n.uniform3iv(this.addr,e),us(t,e)}}u(g$,"setValueV3i");function v$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cs(t,e))return;n.uniform4iv(this.addr,e),us(t,e)}}u(v$,"setValueV4i");function y$(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}u(y$,"setValueV1ui");function _$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cs(t,e))return;n.uniform2uiv(this.addr,e),us(t,e)}}u(_$,"setValueV2ui");function b$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(cs(t,e))return;n.uniform3uiv(this.addr,e),us(t,e)}}u(b$,"setValueV3ui");function w$(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cs(t,e))return;n.uniform4uiv(this.addr,e),us(t,e)}}u(w$,"setValueV4ui");function x$(n,e,t){const s=this.cache,i=t.allocateTextureUnit();s[0]!==i&&(n.uniform1i(this.addr,i),s[0]=i),t.setTexture2D(e||$P,i)}u(x$,"setValueT1");function A$(n,e,t){const s=this.cache,i=t.allocateTextureUnit();s[0]!==i&&(n.uniform1i(this.addr,i),s[0]=i),t.setTexture3D(e||GP,i)}u(A$,"setValueT3D1");function M$(n,e,t){const s=this.cache,i=t.allocateTextureUnit();s[0]!==i&&(n.uniform1i(this.addr,i),s[0]=i),t.setTextureCube(e||HP,i)}u(M$,"setValueT6");function S$(n,e,t){const s=this.cache,i=t.allocateTextureUnit();s[0]!==i&&(n.uniform1i(this.addr,i),s[0]=i),t.setTexture2DArray(e||VP,i)}u(S$,"setValueT2DArray1");function C$(n){switch(n){case 5126:return a$;case 35664:return l$;case 35665:return c$;case 35666:return u$;case 35674:return h$;case 35675:return d$;case 35676:return f$;case 5124:case 35670:return p$;case 35667:case 35671:return m$;case 35668:case 35672:return g$;case 35669:case 35673:return v$;case 5125:return y$;case 36294:return _$;case 36295:return b$;case 36296:return w$;case 35678:case 36198:case 36298:case 36306:case 35682:return x$;case 35679:case 36299:case 36307:return A$;case 35680:case 36300:case 36308:case 36293:return M$;case 36289:case 36303:case 36311:case 36292:return S$}}u(C$,"getSingularSetter");function E$(n,e){n.uniform1fv(this.addr,e)}u(E$,"setValueV1fArray");function T$(n,e){const t=gh(e,this.size,2);n.uniform2fv(this.addr,t)}u(T$,"setValueV2fArray");function P$(n,e){const t=gh(e,this.size,3);n.uniform3fv(this.addr,t)}u(P$,"setValueV3fArray");function R$(n,e){const t=gh(e,this.size,4);n.uniform4fv(this.addr,t)}u(R$,"setValueV4fArray");function I$(n,e){const t=gh(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}u(I$,"setValueM2Array");function D$(n,e){const t=gh(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}u(D$,"setValueM3Array");function L$(n,e){const t=gh(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}u(L$,"setValueM4Array");function O$(n,e){n.uniform1iv(this.addr,e)}u(O$,"setValueV1iArray");function k$(n,e){n.uniform2iv(this.addr,e)}u(k$,"setValueV2iArray");function N$(n,e){n.uniform3iv(this.addr,e)}u(N$,"setValueV3iArray");function F$(n,e){n.uniform4iv(this.addr,e)}u(F$,"setValueV4iArray");function z$(n,e){n.uniform1uiv(this.addr,e)}u(z$,"setValueV1uiArray");function B$(n,e){n.uniform2uiv(this.addr,e)}u(B$,"setValueV2uiArray");function U$(n,e){n.uniform3uiv(this.addr,e)}u(U$,"setValueV3uiArray");function $$(n,e){n.uniform4uiv(this.addr,e)}u($$,"setValueV4uiArray");function V$(n,e,t){const s=this.cache,i=e.length,r=j0(t,i);cs(s,r)||(n.uniform1iv(this.addr,r),us(s,r));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||$P,r[o])}u(V$,"setValueT1Array");function G$(n,e,t){const s=this.cache,i=e.length,r=j0(t,i);cs(s,r)||(n.uniform1iv(this.addr,r),us(s,r));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||GP,r[o])}u(G$,"setValueT3DArray");function H$(n,e,t){const s=this.cache,i=e.length,r=j0(t,i);cs(s,r)||(n.uniform1iv(this.addr,r),us(s,r));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||HP,r[o])}u(H$,"setValueT6Array");function W$(n,e,t){const s=this.cache,i=e.length,r=j0(t,i);cs(s,r)||(n.uniform1iv(this.addr,r),us(s,r));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||VP,r[o])}u(W$,"setValueT2DArrayArray");function j$(n){switch(n){case 5126:return E$;case 35664:return T$;case 35665:return P$;case 35666:return R$;case 35674:return I$;case 35675:return D$;case 35676:return L$;case 5124:case 35670:return O$;case 35667:case 35671:return k$;case 35668:case 35672:return N$;case 35669:case 35673:return F$;case 5125:return z$;case 36294:return B$;case 36295:return U$;case 36296:return $$;case 35678:case 36198:case 36298:case 36306:case 35682:return V$;case 35679:case 36299:case 36307:return G$;case 35680:case 36300:case 36308:case 36293:return H$;case 36289:case 36303:case 36311:case 36292:return W$}}u(j$,"getPureArraySetter");class WP{constructor(e,t,s){this.id=e,this.addr=s,this.cache=[],this.setValue=C$(t.type)}}u(WP,"SingleUniform");class jP{constructor(e,t,s){this.id=e,this.addr=s,this.cache=[],this.size=t.size,this.setValue=j$(t.type)}}u(jP,"PureArrayUniform");class XP{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,s){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const a=i[r];a.setValue(e,t[a.id],s)}}}u(XP,"StructuredUniform");const Tv=/(\w+)(\])?(\[|\.)?/g;function P2(n,e){n.seq.push(e),n.map[e.id]=e}u(P2,"addUniform");function X$(n,e,t){const s=n.name,i=s.length;for(Tv.lastIndex=0;;){const r=Tv.exec(s),o=Tv.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===i){P2(t,c===void 0?new WP(a,n,e):new jP(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new XP(a),P2(t,d)),t=d}}}u(X$,"parseUniform");class df{constructor(e,t){this.seq=[],this.map={};const s=e.getProgramParameter(t,35718);for(let i=0;i<s;++i){const r=e.getActiveUniform(t,i),o=e.getUniformLocation(t,r.name);X$(r,o,this)}}setValue(e,t,s,i){const r=this.map[t];r!==void 0&&r.setValue(e,s,i)}setOptional(e,t,s){const i=t[s];i!==void 0&&this.setValue(e,s,i)}static upload(e,t,s,i){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=s[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const s=[];for(let i=0,r=e.length;i!==r;++i){const o=e[i];o.id in t&&s.push(o)}return s}}u(df,"WebGLUniforms");function R2(n,e,t){const s=n.createShader(e);return n.shaderSource(s,t),n.compileShader(s),s}u(R2,"WebGLShader");let Y$=0;function q$(n,e){const t=n.split(`
`),s=[],i=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=i;o<r;o++){const a=o+1;s.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return s.join(`
`)}u(q$,"handleSource");function K$(n){switch(n){case Bo:return["Linear","( value )"];case Bt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}u(K$,"getEncodingComponents");function I2(n,e,t){const s=n.getShaderParameter(e,35713),i=n.getShaderInfoLog(e).trim();if(s&&i==="")return"";const r=/ERROR: 0:(\d+)/.exec(i);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+i+`

`+q$(n.getShaderSource(e),o)}else return i}u(I2,"getShaderErrors");function Z$(n,e){const t=K$(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}u(Z$,"getTexelEncodingFunction");function Q$(n,e){let t;switch(e){case hz:t="Linear";break;case dz:t="Reinhard";break;case fz:t="OptimizedCineon";break;case pz:t="ACESFilmic";break;case mz:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}u(Q$,"getToneMappingFunction");function J$(n){return[n.extensionDerivatives||!!n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Xd).join(`
`)}u(J$,"generateExtensions");function e8(n){const e=[];for(const t in n){const s=n[t];s!==!1&&e.push("#define "+t+" "+s)}return e.join(`
`)}u(e8,"generateDefines");function t8(n,e){const t={},s=n.getProgramParameter(e,35721);for(let i=0;i<s;i++){const r=n.getActiveAttrib(e,i),o=r.name;let a=1;r.type===35674&&(a=2),r.type===35675&&(a=3),r.type===35676&&(a=4),t[o]={type:r.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}u(t8,"fetchAttributeLocations");function Xd(n){return n!==""}u(Xd,"filterEmptyLine");function D2(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}u(D2,"replaceLightNums");function L2(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}u(L2,"replaceClippingPlaneNums");const n8=/^[ \t]*#include +<([\w\d./]+)>/gm;function L_(n){return n.replace(n8,s8)}u(L_,"resolveIncludes");function s8(n,e){const t=At[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return L_(t)}u(s8,"includeReplacer");const i8=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function O2(n){return n.replace(i8,r8)}u(O2,"unrollLoops");function r8(n,e,t,s){let i="";for(let r=parseInt(e);r<parseInt(t);r++)i+=s.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}u(r8,"loopReplacer");function k2(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}u(k2,"generatePrecision");function o8(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===CP?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===EP?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===jd&&(e="SHADOWMAP_TYPE_VSM"),e}u(o8,"generateShadowMapTypeDefine");function a8(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ou:case ku:e="ENVMAP_TYPE_CUBE";break;case U0:e="ENVMAP_TYPE_CUBE_UV";break}return e}u(a8,"generateEnvMapTypeDefine");function l8(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case ku:e="ENVMAP_MODE_REFRACTION";break}return e}u(l8,"generateEnvMapModeDefine");function c8(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case B0:e="ENVMAP_BLENDING_MULTIPLY";break;case cz:e="ENVMAP_BLENDING_MIX";break;case uz:e="ENVMAP_BLENDING_ADD";break}return e}u(c8,"generateEnvMapBlendingDefine");function u8(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,s=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:s,maxMip:t}}u(u8,"generateCubeUVSize");function h8(n,e,t,s){const i=n.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=o8(t),c=a8(t),h=l8(t),d=c8(t),f=u8(t),p=t.isWebGL2?"":J$(t),g=e8(r),m=i.createProgram();let v,y,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[g].filter(Xd).join(`
`),v.length>0&&(v+=`
`),y=[p,g].filter(Xd).join(`
`),y.length>0&&(y+=`
`)):(v=[k2(t),"#define SHADER_NAME "+t.shaderName,g,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Xd).join(`
`),y=[p,k2(t),"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Xr?"#define TONE_MAPPING":"",t.toneMapping!==Xr?At.tonemapping_pars_fragment:"",t.toneMapping!==Xr?Q$("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",At.encodings_pars_fragment,Z$("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Xd).join(`
`)),o=L_(o),o=D2(o,t),o=L2(o,t),a=L_(a),a=D2(a,t),a=L2(a,t),o=O2(o),a=O2(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===o2?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===o2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const _=b+v+o,w=b+y+a,x=R2(i,35633,_),S=R2(i,35632,w);if(i.attachShader(m,x),i.attachShader(m,S),t.index0AttributeName!==void 0?i.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),n.debug.checkShaderErrors){const R=i.getProgramInfoLog(m).trim(),D=i.getShaderInfoLog(x).trim(),k=i.getShaderInfoLog(S).trim();let T=!0,N=!0;if(i.getProgramParameter(m,35714)===!1){T=!1;const E=I2(i,x,"vertex"),z=I2(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,35715)+`

Program Info Log: `+R+`
`+E+`
`+z)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(D===""||k==="")&&(N=!1);N&&(this.diagnostics={runnable:T,programLog:R,vertexShader:{log:D,prefix:v},fragmentShader:{log:k,prefix:y}})}i.deleteShader(x),i.deleteShader(S);let C;this.getUniforms=function(){return C===void 0&&(C=new df(i,m)),C};let M;return this.getAttributes=function(){return M===void 0&&(M=t8(i,m)),M},this.destroy=function(){s.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=Y$++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=S,this}u(h8,"WebGLProgram");let d8=0;class YP{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,s=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(s),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const s of t)s.usedTimes--,s.usedTimes===0&&this.shaderCache.delete(s.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let s=t.get(e);return s===void 0&&(s=new Set,t.set(e,s)),s}_getShaderStage(e){const t=this.shaderCache;let s=t.get(e);return s===void 0&&(s=new qP(e),t.set(e,s)),s}}u(YP,"WebGLShaderCache");class qP{constructor(e){this.id=d8++,this.code=e,this.usedTimes=0}}u(qP,"WebGLShaderStage");function f8(n,e,t,s,i,r,o){const a=new V0,l=new YP,c=[],h=i.isWebGL2,d=i.logarithmicDepthBuffer,f=i.vertexTextures;let p=i.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(M,R,D,k,T){const N=k.fog,E=T.geometry,z=M.isMeshStandardMaterial?k.environment:null,H=(M.isMeshStandardMaterial?t:e).get(M.envMap||z),q=!!H&&H.mapping===U0?H.image.height:null,ne=g[M.type];M.precision!==null&&(p=i.getMaxPrecision(M.precision),p!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",p,"instead."));const W=E.morphAttributes.position||E.morphAttributes.normal||E.morphAttributes.color,se=W!==void 0?W.length:0;let K=0;E.morphAttributes.position!==void 0&&(K=1),E.morphAttributes.normal!==void 0&&(K=2),E.morphAttributes.color!==void 0&&(K=3);let U,he,ue,Q;if(ne){const Ie=Br[ne];U=Ie.vertexShader,he=Ie.fragmentShader}else U=M.vertexShader,he=M.fragmentShader,l.update(M),ue=l.getVertexShaderID(M),Q=l.getFragmentShaderID(M);const te=n.getRenderTarget(),_e=M.alphaTest>0,pe=M.clearcoat>0,Ae=M.iridescence>0;return{isWebGL2:h,shaderID:ne,shaderName:M.type,vertexShader:U,fragmentShader:he,defines:M.defines,customVertexShaderID:ue,customFragmentShaderID:Q,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:p,instancing:T.isInstancedMesh===!0,instancingColor:T.isInstancedMesh===!0&&T.instanceColor!==null,supportsVertexTextures:f,outputEncoding:te===null?n.outputEncoding:te.isXRRenderTarget===!0?te.texture.encoding:Bo,map:!!M.map,matcap:!!M.matcap,envMap:!!H,envMapMode:H&&H.mapping,envMapCubeUVHeight:q,lightMap:!!M.lightMap,aoMap:!!M.aoMap,emissiveMap:!!M.emissiveMap,bumpMap:!!M.bumpMap,normalMap:!!M.normalMap,objectSpaceNormalMap:M.normalMapType===Oz,tangentSpaceNormalMap:M.normalMapType===mh,decodeVideoTexture:!!M.map&&M.map.isVideoTexture===!0&&M.map.encoding===Bt,clearcoat:pe,clearcoatMap:pe&&!!M.clearcoatMap,clearcoatRoughnessMap:pe&&!!M.clearcoatRoughnessMap,clearcoatNormalMap:pe&&!!M.clearcoatNormalMap,iridescence:Ae,iridescenceMap:Ae&&!!M.iridescenceMap,iridescenceThicknessMap:Ae&&!!M.iridescenceThicknessMap,displacementMap:!!M.displacementMap,roughnessMap:!!M.roughnessMap,metalnessMap:!!M.metalnessMap,specularMap:!!M.specularMap,specularIntensityMap:!!M.specularIntensityMap,specularColorMap:!!M.specularColorMap,opaque:M.transparent===!1&&M.blending===Su,alphaMap:!!M.alphaMap,alphaTest:_e,gradientMap:!!M.gradientMap,sheen:M.sheen>0,sheenColorMap:!!M.sheenColorMap,sheenRoughnessMap:!!M.sheenRoughnessMap,transmission:M.transmission>0,transmissionMap:!!M.transmissionMap,thicknessMap:!!M.thicknessMap,combine:M.combine,vertexTangents:!!M.normalMap&&!!E.attributes.tangent,vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!E.attributes.color&&E.attributes.color.itemSize===4,vertexUvs:!!M.map||!!M.bumpMap||!!M.normalMap||!!M.specularMap||!!M.alphaMap||!!M.emissiveMap||!!M.roughnessMap||!!M.metalnessMap||!!M.clearcoatMap||!!M.clearcoatRoughnessMap||!!M.clearcoatNormalMap||!!M.iridescenceMap||!!M.iridescenceThicknessMap||!!M.displacementMap||!!M.transmissionMap||!!M.thicknessMap||!!M.specularIntensityMap||!!M.specularColorMap||!!M.sheenColorMap||!!M.sheenRoughnessMap,uvsVertexOnly:!(!!M.map||!!M.bumpMap||!!M.normalMap||!!M.specularMap||!!M.alphaMap||!!M.emissiveMap||!!M.roughnessMap||!!M.metalnessMap||!!M.clearcoatNormalMap||!!M.iridescenceMap||!!M.iridescenceThicknessMap||M.transmission>0||!!M.transmissionMap||!!M.thicknessMap||!!M.specularIntensityMap||!!M.specularColorMap||M.sheen>0||!!M.sheenColorMap||!!M.sheenRoughnessMap)&&!!M.displacementMap,fog:!!N,useFog:M.fog===!0,fogExp2:N&&N.isFogExp2,flatShading:!!M.flatShading,sizeAttenuation:M.sizeAttenuation,logarithmicDepthBuffer:d,skinning:T.isSkinnedMesh===!0,morphTargets:E.morphAttributes.position!==void 0,morphNormals:E.morphAttributes.normal!==void 0,morphColors:E.morphAttributes.color!==void 0,morphTargetsCount:se,morphTextureStride:K,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:n.shadowMap.enabled&&D.length>0,shadowMapType:n.shadowMap.type,toneMapping:M.toneMapped?n.toneMapping:Xr,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Di,flipSided:M.side===Ki,useDepthPacking:!!M.depthPacking,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionDerivatives:M.extensions&&M.extensions.derivatives,extensionFragDepth:M.extensions&&M.extensions.fragDepth,extensionDrawBuffers:M.extensions&&M.extensions.drawBuffers,extensionShaderTextureLOD:M.extensions&&M.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||s.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||s.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||s.has("EXT_shader_texture_lod"),customProgramCacheKey:M.customProgramCacheKey()}}u(m,"getParameters");function v(M){const R=[];if(M.shaderID?R.push(M.shaderID):(R.push(M.customVertexShaderID),R.push(M.customFragmentShaderID)),M.defines!==void 0)for(const D in M.defines)R.push(D),R.push(M.defines[D]);return M.isRawShaderMaterial===!1&&(y(R,M),b(R,M),R.push(n.outputEncoding)),R.push(M.customProgramCacheKey),R.join()}u(v,"getProgramCacheKey");function y(M,R){M.push(R.precision),M.push(R.outputEncoding),M.push(R.envMapMode),M.push(R.envMapCubeUVHeight),M.push(R.combine),M.push(R.vertexUvs),M.push(R.fogExp2),M.push(R.sizeAttenuation),M.push(R.morphTargetsCount),M.push(R.morphAttributeCount),M.push(R.numDirLights),M.push(R.numPointLights),M.push(R.numSpotLights),M.push(R.numSpotLightMaps),M.push(R.numHemiLights),M.push(R.numRectAreaLights),M.push(R.numDirLightShadows),M.push(R.numPointLightShadows),M.push(R.numSpotLightShadows),M.push(R.numSpotLightShadowsWithMaps),M.push(R.shadowMapType),M.push(R.toneMapping),M.push(R.numClippingPlanes),M.push(R.numClipIntersection),M.push(R.depthPacking)}u(y,"getProgramCacheKeyParameters");function b(M,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.map&&a.enable(4),R.matcap&&a.enable(5),R.envMap&&a.enable(6),R.lightMap&&a.enable(7),R.aoMap&&a.enable(8),R.emissiveMap&&a.enable(9),R.bumpMap&&a.enable(10),R.normalMap&&a.enable(11),R.objectSpaceNormalMap&&a.enable(12),R.tangentSpaceNormalMap&&a.enable(13),R.clearcoat&&a.enable(14),R.clearcoatMap&&a.enable(15),R.clearcoatRoughnessMap&&a.enable(16),R.clearcoatNormalMap&&a.enable(17),R.iridescence&&a.enable(18),R.iridescenceMap&&a.enable(19),R.iridescenceThicknessMap&&a.enable(20),R.displacementMap&&a.enable(21),R.specularMap&&a.enable(22),R.roughnessMap&&a.enable(23),R.metalnessMap&&a.enable(24),R.gradientMap&&a.enable(25),R.alphaMap&&a.enable(26),R.alphaTest&&a.enable(27),R.vertexColors&&a.enable(28),R.vertexAlphas&&a.enable(29),R.vertexUvs&&a.enable(30),R.vertexTangents&&a.enable(31),R.uvsVertexOnly&&a.enable(32),M.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.physicallyCorrectLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.specularIntensityMap&&a.enable(15),R.specularColorMap&&a.enable(16),R.transmission&&a.enable(17),R.transmissionMap&&a.enable(18),R.thicknessMap&&a.enable(19),R.sheen&&a.enable(20),R.sheenColorMap&&a.enable(21),R.sheenRoughnessMap&&a.enable(22),R.decodeVideoTexture&&a.enable(23),R.opaque&&a.enable(24),M.push(a.mask)}u(b,"getProgramCacheKeyBooleans");function _(M){const R=g[M.type];let D;if(R){const k=Br[R];D=H0.clone(k.uniforms)}else D=M.uniforms;return D}u(_,"getUniforms");function w(M,R){let D;for(let k=0,T=c.length;k<T;k++){const N=c[k];if(N.cacheKey===R){D=N,++D.usedTimes;break}}return D===void 0&&(D=new h8(n,R,M,r),c.push(D)),D}u(w,"acquireProgram");function x(M){if(--M.usedTimes===0){const R=c.indexOf(M);c[R]=c[c.length-1],c.pop(),M.destroy()}}u(x,"releaseProgram");function S(M){l.remove(M)}u(S,"releaseShaderCache");function C(){l.dispose()}return u(C,"dispose"),{getParameters:m,getProgramCacheKey:v,getUniforms:_,acquireProgram:w,releaseProgram:x,releaseShaderCache:S,programs:c,dispose:C}}u(f8,"WebGLPrograms");function p8(){let n=new WeakMap;function e(r){let o=n.get(r);return o===void 0&&(o={},n.set(r,o)),o}u(e,"get");function t(r){n.delete(r)}u(t,"remove");function s(r,o,a){n.get(r)[o]=a}u(s,"update");function i(){n=new WeakMap}return u(i,"dispose"),{get:e,remove:t,update:s,dispose:i}}u(p8,"WebGLProperties");function m8(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}u(m8,"painterSortStable");function N2(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}u(N2,"reversePainterSortStable");function F2(){const n=[];let e=0;const t=[],s=[],i=[];function r(){e=0,t.length=0,s.length=0,i.length=0}u(r,"init");function o(d,f,p,g,m,v){let y=n[e];return y===void 0?(y={id:d.id,object:d,geometry:f,material:p,groupOrder:g,renderOrder:d.renderOrder,z:m,group:v},n[e]=y):(y.id=d.id,y.object=d,y.geometry=f,y.material=p,y.groupOrder=g,y.renderOrder=d.renderOrder,y.z=m,y.group=v),e++,y}u(o,"getNextRenderItem");function a(d,f,p,g,m,v){const y=o(d,f,p,g,m,v);p.transmission>0?s.push(y):p.transparent===!0?i.push(y):t.push(y)}u(a,"push");function l(d,f,p,g,m,v){const y=o(d,f,p,g,m,v);p.transmission>0?s.unshift(y):p.transparent===!0?i.unshift(y):t.unshift(y)}u(l,"unshift");function c(d,f){t.length>1&&t.sort(d||m8),s.length>1&&s.sort(f||N2),i.length>1&&i.sort(f||N2)}u(c,"sort");function h(){for(let d=e,f=n.length;d<f;d++){const p=n[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return u(h,"finish"),{opaque:t,transmissive:s,transparent:i,init:r,push:a,unshift:l,finish:h,sort:c}}u(F2,"WebGLRenderList");function g8(){let n=new WeakMap;function e(s,i){const r=n.get(s);let o;return r===void 0?(o=new F2,n.set(s,[o])):i>=r.length?(o=new F2,r.push(o)):o=r[i],o}u(e,"get");function t(){n=new WeakMap}return u(t,"dispose"),{get:e,dispose:t}}u(g8,"WebGLRenderLists");function v8(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new P,color:new De};break;case"SpotLight":t={position:new P,direction:new P,color:new De,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new P,color:new De,distance:0,decay:0};break;case"HemisphereLight":t={direction:new P,skyColor:new De,groundColor:new De};break;case"RectAreaLight":t={color:new De,position:new P,halfWidth:new P,halfHeight:new P};break}return n[e.id]=t,t}}}u(v8,"UniformsCache");function y8(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $e,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}u(y8,"ShadowUniformsCache");let _8=0;function b8(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}u(b8,"shadowCastingAndTexturingLightsFirst");function w8(n,e){const t=new v8,s=y8(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)i.probe.push(new P);const r=new P,o=new be,a=new be;function l(h,d){let f=0,p=0,g=0;for(let k=0;k<9;k++)i.probe[k].set(0,0,0);let m=0,v=0,y=0,b=0,_=0,w=0,x=0,S=0,C=0,M=0;h.sort(b8);const R=d!==!0?Math.PI:1;for(let k=0,T=h.length;k<T;k++){const N=h[k],E=N.color,z=N.intensity,H=N.distance,q=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)f+=E.r*z*R,p+=E.g*z*R,g+=E.b*z*R;else if(N.isLightProbe)for(let ne=0;ne<9;ne++)i.probe[ne].addScaledVector(N.sh.coefficients[ne],z);else if(N.isDirectionalLight){const ne=t.get(N);if(ne.color.copy(N.color).multiplyScalar(N.intensity*R),N.castShadow){const W=N.shadow,se=s.get(N);se.shadowBias=W.bias,se.shadowNormalBias=W.normalBias,se.shadowRadius=W.radius,se.shadowMapSize=W.mapSize,i.directionalShadow[m]=se,i.directionalShadowMap[m]=q,i.directionalShadowMatrix[m]=N.shadow.matrix,w++}i.directional[m]=ne,m++}else if(N.isSpotLight){const ne=t.get(N);ne.position.setFromMatrixPosition(N.matrixWorld),ne.color.copy(E).multiplyScalar(z*R),ne.distance=H,ne.coneCos=Math.cos(N.angle),ne.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),ne.decay=N.decay,i.spot[y]=ne;const W=N.shadow;if(N.map&&(i.spotLightMap[C]=N.map,C++,W.updateMatrices(N),N.castShadow&&M++),i.spotLightMatrix[y]=W.matrix,N.castShadow){const se=s.get(N);se.shadowBias=W.bias,se.shadowNormalBias=W.normalBias,se.shadowRadius=W.radius,se.shadowMapSize=W.mapSize,i.spotShadow[y]=se,i.spotShadowMap[y]=q,S++}y++}else if(N.isRectAreaLight){const ne=t.get(N);ne.color.copy(E).multiplyScalar(z),ne.halfWidth.set(N.width*.5,0,0),ne.halfHeight.set(0,N.height*.5,0),i.rectArea[b]=ne,b++}else if(N.isPointLight){const ne=t.get(N);if(ne.color.copy(N.color).multiplyScalar(N.intensity*R),ne.distance=N.distance,ne.decay=N.decay,N.castShadow){const W=N.shadow,se=s.get(N);se.shadowBias=W.bias,se.shadowNormalBias=W.normalBias,se.shadowRadius=W.radius,se.shadowMapSize=W.mapSize,se.shadowCameraNear=W.camera.near,se.shadowCameraFar=W.camera.far,i.pointShadow[v]=se,i.pointShadowMap[v]=q,i.pointShadowMatrix[v]=N.shadow.matrix,x++}i.point[v]=ne,v++}else if(N.isHemisphereLight){const ne=t.get(N);ne.skyColor.copy(N.color).multiplyScalar(z*R),ne.groundColor.copy(N.groundColor).multiplyScalar(z*R),i.hemi[_]=ne,_++}}b>0&&(e.isWebGL2||n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ve.LTC_FLOAT_1,i.rectAreaLTC2=Ve.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=Ve.LTC_HALF_1,i.rectAreaLTC2=Ve.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=f,i.ambient[1]=p,i.ambient[2]=g;const D=i.hash;(D.directionalLength!==m||D.pointLength!==v||D.spotLength!==y||D.rectAreaLength!==b||D.hemiLength!==_||D.numDirectionalShadows!==w||D.numPointShadows!==x||D.numSpotShadows!==S||D.numSpotMaps!==C)&&(i.directional.length=m,i.spot.length=y,i.rectArea.length=b,i.point.length=v,i.hemi.length=_,i.directionalShadow.length=w,i.directionalShadowMap.length=w,i.pointShadow.length=x,i.pointShadowMap.length=x,i.spotShadow.length=S,i.spotShadowMap.length=S,i.directionalShadowMatrix.length=w,i.pointShadowMatrix.length=x,i.spotLightMatrix.length=S+C-M,i.spotLightMap.length=C,i.numSpotLightShadowsWithMaps=M,D.directionalLength=m,D.pointLength=v,D.spotLength=y,D.rectAreaLength=b,D.hemiLength=_,D.numDirectionalShadows=w,D.numPointShadows=x,D.numSpotShadows=S,D.numSpotMaps=C,i.version=_8++)}u(l,"setup");function c(h,d){let f=0,p=0,g=0,m=0,v=0;const y=d.matrixWorldInverse;for(let b=0,_=h.length;b<_;b++){const w=h[b];if(w.isDirectionalLight){const x=i.directional[f];x.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(y),f++}else if(w.isSpotLight){const x=i.spot[g];x.position.setFromMatrixPosition(w.matrixWorld),x.position.applyMatrix4(y),x.direction.setFromMatrixPosition(w.matrixWorld),r.setFromMatrixPosition(w.target.matrixWorld),x.direction.sub(r),x.direction.transformDirection(y),g++}else if(w.isRectAreaLight){const x=i.rectArea[m];x.position.setFromMatrixPosition(w.matrixWorld),x.position.applyMatrix4(y),a.identity(),o.copy(w.matrixWorld),o.premultiply(y),a.extractRotation(o),x.halfWidth.set(w.width*.5,0,0),x.halfHeight.set(0,w.height*.5,0),x.halfWidth.applyMatrix4(a),x.halfHeight.applyMatrix4(a),m++}else if(w.isPointLight){const x=i.point[p];x.position.setFromMatrixPosition(w.matrixWorld),x.position.applyMatrix4(y),p++}else if(w.isHemisphereLight){const x=i.hemi[v];x.direction.setFromMatrixPosition(w.matrixWorld),x.direction.transformDirection(y),v++}}}return u(c,"setupView"),{setup:l,setupView:c,state:i}}u(w8,"WebGLLights");function z2(n,e){const t=new w8(n,e),s=[],i=[];function r(){s.length=0,i.length=0}u(r,"init");function o(d){s.push(d)}u(o,"pushLight");function a(d){i.push(d)}u(a,"pushShadow");function l(d){t.setup(s,d)}u(l,"setupLights");function c(d){t.setupView(s,d)}return u(c,"setupLightsView"),{init:r,state:{lightsArray:s,shadowsArray:i,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}u(z2,"WebGLRenderState");function x8(n,e){let t=new WeakMap;function s(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new z2(n,e),t.set(r,[l])):o>=a.length?(l=new z2(n,e),a.push(l)):l=a[o],l}u(s,"get");function i(){t=new WeakMap}return u(i,"dispose"),{get:s,dispose:i}}u(x8,"WebGLRenderStates");class Bb extends zs{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Lz,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}u(Bb,"MeshDepthMaterial");class KP extends zs{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new P,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}u(KP,"MeshDistanceMaterial");const A8=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,M8=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function S8(n,e,t){let s=new ep;const i=new $e,r=new $e,o=new Ft,a=new Bb({depthPacking:LP}),l=new KP,c={},h=t.maxTextureSize,d={0:Ki,1:ql,2:Di},f=new bs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $e},radius:{value:4}},vertexShader:A8,fragmentShader:M8}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const g=new at;g.setAttribute("position",new An(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Ye(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=CP,this.render=function(w,x,S){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||w.length===0)return;const C=n.getRenderTarget(),M=n.getActiveCubeFace(),R=n.getActiveMipmapLevel(),D=n.state;D.setBlending(jr),D.buffers.color.setClear(1,1,1,1),D.buffers.depth.setTest(!0),D.setScissorTest(!1);for(let k=0,T=w.length;k<T;k++){const N=w[k],E=N.shadow;if(E===void 0){console.warn("THREE.WebGLShadowMap:",N,"has no shadow.");continue}if(E.autoUpdate===!1&&E.needsUpdate===!1)continue;i.copy(E.mapSize);const z=E.getFrameExtents();if(i.multiply(z),r.copy(E.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(r.x=Math.floor(h/z.x),i.x=r.x*z.x,E.mapSize.x=r.x),i.y>h&&(r.y=Math.floor(h/z.y),i.y=r.y*z.y,E.mapSize.y=r.y)),E.map===null){const q=this.type!==jd?{minFilter:Wn,magFilter:Wn}:{};E.map=new ys(i.x,i.y,q),E.map.texture.name=N.name+".shadowMap",E.camera.updateProjectionMatrix()}n.setRenderTarget(E.map),n.clear();const H=E.getViewportCount();for(let q=0;q<H;q++){const ne=E.getViewport(q);o.set(r.x*ne.x,r.y*ne.y,r.x*ne.z,r.y*ne.w),D.viewport(o),E.updateMatrices(N,q),s=E.getFrustum(),_(x,S,E.camera,N,this.type)}E.isPointLightShadow!==!0&&this.type===jd&&y(E,S),E.needsUpdate=!1}v.needsUpdate=!1,n.setRenderTarget(C,M,R)};function y(w,x){const S=e.update(m);f.defines.VSM_SAMPLES!==w.blurSamples&&(f.defines.VSM_SAMPLES=w.blurSamples,p.defines.VSM_SAMPLES=w.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new ys(i.x,i.y)),f.uniforms.shadow_pass.value=w.map.texture,f.uniforms.resolution.value=w.mapSize,f.uniforms.radius.value=w.radius,n.setRenderTarget(w.mapPass),n.clear(),n.renderBufferDirect(x,null,S,f,m,null),p.uniforms.shadow_pass.value=w.mapPass.texture,p.uniforms.resolution.value=w.mapSize,p.uniforms.radius.value=w.radius,n.setRenderTarget(w.map),n.clear(),n.renderBufferDirect(x,null,S,p,m,null)}u(y,"VSMPass");function b(w,x,S,C,M,R){let D=null;const k=S.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(k!==void 0?D=k:D=S.isPointLight===!0?l:a,n.localClippingEnabled&&x.clipShadows===!0&&Array.isArray(x.clippingPlanes)&&x.clippingPlanes.length!==0||x.displacementMap&&x.displacementScale!==0||x.alphaMap&&x.alphaTest>0){const T=D.uuid,N=x.uuid;let E=c[T];E===void 0&&(E={},c[T]=E);let z=E[N];z===void 0&&(z=D.clone(),E[N]=z),D=z}return D.visible=x.visible,D.wireframe=x.wireframe,R===jd?D.side=x.shadowSide!==null?x.shadowSide:x.side:D.side=x.shadowSide!==null?x.shadowSide:d[x.side],D.alphaMap=x.alphaMap,D.alphaTest=x.alphaTest,D.clipShadows=x.clipShadows,D.clippingPlanes=x.clippingPlanes,D.clipIntersection=x.clipIntersection,D.displacementMap=x.displacementMap,D.displacementScale=x.displacementScale,D.displacementBias=x.displacementBias,D.wireframeLinewidth=x.wireframeLinewidth,D.linewidth=x.linewidth,S.isPointLight===!0&&D.isMeshDistanceMaterial===!0&&(D.referencePosition.setFromMatrixPosition(S.matrixWorld),D.nearDistance=C,D.farDistance=M),D}u(b,"getDepthMaterial");function _(w,x,S,C,M){if(w.visible===!1)return;if(w.layers.test(x.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&M===jd)&&(!w.frustumCulled||s.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,w.matrixWorld);const k=e.update(w),T=w.material;if(Array.isArray(T)){const N=k.groups;for(let E=0,z=N.length;E<z;E++){const H=N[E],q=T[H.materialIndex];if(q&&q.visible){const ne=b(w,q,C,S.near,S.far,M);n.renderBufferDirect(S,null,k,ne,w,H)}}}else if(T.visible){const N=b(w,T,C,S.near,S.far,M);n.renderBufferDirect(S,null,k,N,w,null)}}const D=w.children;for(let k=0,T=D.length;k<T;k++)_(D[k],x,S,C,M)}u(_,"renderObject")}u(S8,"WebGLShadowMap");function C8(n,e,t){const s=t.isWebGL2;function i(){let G=!1;const le=new Ft;let de=null;const ge=new Ft(0,0,0,0);return{setMask:function(Re){de!==Re&&!G&&(n.colorMask(Re,Re,Re,Re),de=Re)},setLocked:function(Re){G=Re},setClear:function(Re,st,pt,Pt,os){os===!0&&(Re*=Pt,st*=Pt,pt*=Pt),le.set(Re,st,pt,Pt),ge.equals(le)===!1&&(n.clearColor(Re,st,pt,Pt),ge.copy(le))},reset:function(){G=!1,de=null,ge.set(-1,0,0,0)}}}u(i,"ColorBuffer");function r(){let G=!1,le=null,de=null,ge=null;return{setTest:function(Re){Re?_e(2929):pe(2929)},setMask:function(Re){le!==Re&&!G&&(n.depthMask(Re),le=Re)},setFunc:function(Re){if(de!==Re){switch(Re){case nz:n.depthFunc(512);break;case sz:n.depthFunc(519);break;case iz:n.depthFunc(513);break;case E_:n.depthFunc(515);break;case rz:n.depthFunc(514);break;case oz:n.depthFunc(518);break;case az:n.depthFunc(516);break;case lz:n.depthFunc(517);break;default:n.depthFunc(515)}de=Re}},setLocked:function(Re){G=Re},setClear:function(Re){ge!==Re&&(n.clearDepth(Re),ge=Re)},reset:function(){G=!1,le=null,de=null,ge=null}}}u(r,"DepthBuffer");function o(){let G=!1,le=null,de=null,ge=null,Re=null,st=null,pt=null,Pt=null,os=null;return{setTest:function(Yt){G||(Yt?_e(2960):pe(2960))},setMask:function(Yt){le!==Yt&&!G&&(n.stencilMask(Yt),le=Yt)},setFunc:function(Yt,Qr,Bi){(de!==Yt||ge!==Qr||Re!==Bi)&&(n.stencilFunc(Yt,Qr,Bi),de=Yt,ge=Qr,Re=Bi)},setOp:function(Yt,Qr,Bi){(st!==Yt||pt!==Qr||Pt!==Bi)&&(n.stencilOp(Yt,Qr,Bi),st=Yt,pt=Qr,Pt=Bi)},setLocked:function(Yt){G=Yt},setClear:function(Yt){os!==Yt&&(n.clearStencil(Yt),os=Yt)},reset:function(){G=!1,le=null,de=null,ge=null,Re=null,st=null,pt=null,Pt=null,os=null}}}u(o,"StencilBuffer");const a=new i,l=new r,c=new o,h=new WeakMap,d=new WeakMap;let f={},p={},g=new WeakMap,m=[],v=null,y=!1,b=null,_=null,w=null,x=null,S=null,C=null,M=null,R=!1,D=null,k=null,T=null,N=null,E=null;const z=n.getParameter(35661);let H=!1,q=0;const ne=n.getParameter(7938);ne.indexOf("WebGL")!==-1?(q=parseFloat(/^WebGL (\d)/.exec(ne)[1]),H=q>=1):ne.indexOf("OpenGL ES")!==-1&&(q=parseFloat(/^OpenGL ES (\d)/.exec(ne)[1]),H=q>=2);let W=null,se={};const K=n.getParameter(3088),U=n.getParameter(2978),he=new Ft().fromArray(K),ue=new Ft().fromArray(U);function Q(G,le,de){const ge=new Uint8Array(4),Re=n.createTexture();n.bindTexture(G,Re),n.texParameteri(G,10241,9728),n.texParameteri(G,10240,9728);for(let st=0;st<de;st++)n.texImage2D(le+st,0,6408,1,1,0,6408,5121,ge);return Re}u(Q,"createTexture");const te={};te[3553]=Q(3553,3553,1),te[34067]=Q(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),_e(2929),l.setFunc(E_),Z(!1),B(IM),_e(2884),I(jr);function _e(G){f[G]!==!0&&(n.enable(G),f[G]=!0)}u(_e,"enable");function pe(G){f[G]!==!1&&(n.disable(G),f[G]=!1)}u(pe,"disable");function Ae(G,le){return p[G]!==le?(n.bindFramebuffer(G,le),p[G]=le,s&&(G===36009&&(p[36160]=le),G===36160&&(p[36009]=le)),!0):!1}u(Ae,"bindFramebuffer");function Me(G,le){let de=m,ge=!1;if(G)if(de=g.get(le),de===void 0&&(de=[],g.set(le,de)),G.isWebGLMultipleRenderTargets){const Re=G.texture;if(de.length!==Re.length||de[0]!==36064){for(let st=0,pt=Re.length;st<pt;st++)de[st]=36064+st;de.length=Re.length,ge=!0}}else de[0]!==36064&&(de[0]=36064,ge=!0);else de[0]!==1029&&(de[0]=1029,ge=!0);ge&&(t.isWebGL2?n.drawBuffers(de):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(de))}u(Me,"drawBuffers");function Ie(G){return v!==G?(n.useProgram(G),v=G,!0):!1}u(Ie,"useProgram");const $={[lu]:32774,[WF]:32778,[jF]:32779};if(s)$[OM]=32775,$[kM]=32776;else{const G=e.get("EXT_blend_minmax");G!==null&&($[OM]=G.MIN_EXT,$[kM]=G.MAX_EXT)}const X={[XF]:0,[YF]:1,[qF]:768,[TP]:770,[tz]:776,[JF]:774,[ZF]:772,[KF]:769,[PP]:771,[ez]:775,[QF]:773};function I(G,le,de,ge,Re,st,pt,Pt){if(G===jr){y===!0&&(pe(3042),y=!1);return}if(y===!1&&(_e(3042),y=!0),G!==HF){if(G!==b||Pt!==R){if((_!==lu||S!==lu)&&(n.blendEquation(32774),_=lu,S=lu),Pt)switch(G){case Su:n.blendFuncSeparate(1,771,1,771);break;case C_:n.blendFunc(1,1);break;case DM:n.blendFuncSeparate(0,769,0,1);break;case LM:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}else switch(G){case Su:n.blendFuncSeparate(770,771,1,771);break;case C_:n.blendFunc(770,1);break;case DM:n.blendFuncSeparate(0,769,0,1);break;case LM:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",G);break}w=null,x=null,C=null,M=null,b=G,R=Pt}return}Re=Re||le,st=st||de,pt=pt||ge,(le!==_||Re!==S)&&(n.blendEquationSeparate($[le],$[Re]),_=le,S=Re),(de!==w||ge!==x||st!==C||pt!==M)&&(n.blendFuncSeparate(X[de],X[ge],X[st],X[pt]),w=de,x=ge,C=st,M=pt),b=G,R=null}u(I,"setBlending");function J(G,le){G.side===Di?pe(2884):_e(2884);let de=G.side===Ki;le&&(de=!de),Z(de),G.blending===Su&&G.transparent===!1?I(jr):I(G.blending,G.blendEquation,G.blendSrc,G.blendDst,G.blendEquationAlpha,G.blendSrcAlpha,G.blendDstAlpha,G.premultipliedAlpha),l.setFunc(G.depthFunc),l.setTest(G.depthTest),l.setMask(G.depthWrite),a.setMask(G.colorWrite);const ge=G.stencilWrite;c.setTest(ge),ge&&(c.setMask(G.stencilWriteMask),c.setFunc(G.stencilFunc,G.stencilRef,G.stencilFuncMask),c.setOp(G.stencilFail,G.stencilZFail,G.stencilZPass)),V(G.polygonOffset,G.polygonOffsetFactor,G.polygonOffsetUnits),G.alphaToCoverage===!0?_e(32926):pe(32926)}u(J,"setMaterial");function Z(G){D!==G&&(G?n.frontFace(2304):n.frontFace(2305),D=G)}u(Z,"setFlipSided");function B(G){G!==VF?(_e(2884),G!==k&&(G===IM?n.cullFace(1029):G===GF?n.cullFace(1028):n.cullFace(1032))):pe(2884),k=G}u(B,"setCullFace");function F(G){G!==T&&(H&&n.lineWidth(G),T=G)}u(F,"setLineWidth");function V(G,le,de){G?(_e(32823),(N!==le||E!==de)&&(n.polygonOffset(le,de),N=le,E=de)):pe(32823)}u(V,"setPolygonOffset");function ae(G){G?_e(3089):pe(3089)}u(ae,"setScissorTest");function oe(G){G===void 0&&(G=33984+z-1),W!==G&&(n.activeTexture(G),W=G)}u(oe,"activeTexture");function L(G,le,de){de===void 0&&(W===null?de=33984+z-1:de=W);let ge=se[de];ge===void 0&&(ge={type:void 0,texture:void 0},se[de]=ge),(ge.type!==G||ge.texture!==le)&&(W!==de&&(n.activeTexture(de),W=de),n.bindTexture(G,le||te[G]),ge.type=G,ge.texture=le)}u(L,"bindTexture");function O(){const G=se[W];G!==void 0&&G.type!==void 0&&(n.bindTexture(G.type,null),G.type=void 0,G.texture=void 0)}u(O,"unbindTexture");function ee(){try{n.compressedTexImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(ee,"compressedTexImage2D");function ie(){try{n.compressedTexImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(ie,"compressedTexImage3D");function ce(){try{n.texSubImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(ce,"texSubImage2D");function ye(){try{n.texSubImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(ye,"texSubImage3D");function Ce(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(Ce,"compressedTexSubImage2D");function Te(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(Te,"compressedTexSubImage3D");function ve(){try{n.texStorage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(ve,"texStorage2D");function Ge(){try{n.texStorage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(Ge,"texStorage3D");function Xe(){try{n.texImage2D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(Xe,"texImage2D");function Le(){try{n.texImage3D.apply(n,arguments)}catch(G){console.error("THREE.WebGLState:",G)}}u(Le,"texImage3D");function Ke(G){he.equals(G)===!1&&(n.scissor(G.x,G.y,G.z,G.w),he.copy(G))}u(Ke,"scissor");function He(G){ue.equals(G)===!1&&(n.viewport(G.x,G.y,G.z,G.w),ue.copy(G))}u(He,"viewport");function et(G,le){let de=d.get(le);de===void 0&&(de=new WeakMap,d.set(le,de));let ge=de.get(G);ge===void 0&&(ge=n.getUniformBlockIndex(le,G.name),de.set(G,ge))}u(et,"updateUBOMapping");function Ut(G,le){const ge=d.get(le).get(G);h.get(G)!==ge&&(n.uniformBlockBinding(le,ge,G.__bindingPointIndex),h.set(G,ge))}u(Ut,"uniformBlockBinding");function re(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),s===!0&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},W=null,se={},p={},g=new WeakMap,m=[],v=null,y=!1,b=null,_=null,w=null,x=null,S=null,C=null,M=null,R=!1,D=null,k=null,T=null,N=null,E=null,he.set(0,0,n.canvas.width,n.canvas.height),ue.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}return u(re,"reset"),{buffers:{color:a,depth:l,stencil:c},enable:_e,disable:pe,bindFramebuffer:Ae,drawBuffers:Me,useProgram:Ie,setBlending:I,setMaterial:J,setFlipSided:Z,setCullFace:B,setLineWidth:F,setPolygonOffset:V,setScissorTest:ae,activeTexture:oe,bindTexture:L,unbindTexture:O,compressedTexImage2D:ee,compressedTexImage3D:ie,texImage2D:Xe,texImage3D:Le,updateUBOMapping:et,uniformBlockBinding:Ut,texStorage2D:ve,texStorage3D:Ge,texSubImage2D:ce,texSubImage3D:ye,compressedTexSubImage2D:Ce,compressedTexSubImage3D:Te,scissor:Ke,viewport:He,reset:re}}u(C8,"WebGLState");function E8(n,e,t,s,i,r,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,h=i.maxTextureSize,d=i.maxSamples,f=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(typeof navigator=="undefined"?"":navigator.userAgent),g=new WeakMap;let m;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(L,O){return y?new OffscreenCanvas(L,O):Rf("canvas")}u(b,"createCanvas");function _(L,O,ee,ie){let ce=1;if((L.width>ie||L.height>ie)&&(ce=ie/Math.max(L.width,L.height)),ce<1||O===!0)if(typeof HTMLImageElement!="undefined"&&L instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&L instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&L instanceof ImageBitmap){const ye=O?s0:Math.floor,Ce=ye(ce*L.width),Te=ye(ce*L.height);m===void 0&&(m=b(Ce,Te));const ve=ee?b(Ce,Te):m;return ve.width=Ce,ve.height=Te,ve.getContext("2d").drawImage(L,0,0,Ce,Te),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+L.width+"x"+L.height+") to ("+Ce+"x"+Te+")."),ve}else return"data"in L&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+L.width+"x"+L.height+")."),L;return L}u(_,"resizeImage");function w(L){return I_(L.width)&&I_(L.height)}u(w,"isPowerOfTwo$1");function x(L){return a?!1:L.wrapS!==Ks||L.wrapT!==Ks||L.minFilter!==Wn&&L.minFilter!==qs}u(x,"textureNeedsPowerOfTwo");function S(L,O){return L.generateMipmaps&&O&&L.minFilter!==Wn&&L.minFilter!==qs}u(S,"textureNeedsGenerateMipmaps");function C(L){n.generateMipmap(L)}u(C,"generateMipmap");function M(L,O,ee,ie,ce=!1){if(a===!1)return O;if(L!==null){if(n[L]!==void 0)return n[L];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+L+"'")}let ye=O;return O===6403&&(ee===5126&&(ye=33326),ee===5131&&(ye=33325),ee===5121&&(ye=33321)),O===33319&&(ee===5126&&(ye=33328),ee===5131&&(ye=33327),ee===5121&&(ye=33323)),O===6408&&(ee===5126&&(ye=34836),ee===5131&&(ye=34842),ee===5121&&(ye=ie===Bt&&ce===!1?35907:32856),ee===32819&&(ye=32854),ee===32820&&(ye=32855)),(ye===33325||ye===33326||ye===33327||ye===33328||ye===34842||ye===34836)&&e.get("EXT_color_buffer_float"),ye}u(M,"getInternalFormat");function R(L,O,ee){return S(L,ee)===!0||L.isFramebufferTexture&&L.minFilter!==Wn&&L.minFilter!==qs?Math.log2(Math.max(O.width,O.height))+1:L.mipmaps!==void 0&&L.mipmaps.length>0?L.mipmaps.length:L.isCompressedTexture&&Array.isArray(L.image)?O.mipmaps.length:1}u(R,"getMipLevels");function D(L){return L===Wn||L===t0||L===n0?9728:9729}u(D,"filterFallback");function k(L){const O=L.target;O.removeEventListener("dispose",k),N(O),O.isVideoTexture&&g.delete(O)}u(k,"onTextureDispose");function T(L){const O=L.target;O.removeEventListener("dispose",T),z(O)}u(T,"onRenderTargetDispose");function N(L){const O=s.get(L);if(O.__webglInit===void 0)return;const ee=L.source,ie=v.get(ee);if(ie){const ce=ie[O.__cacheKey];ce.usedTimes--,ce.usedTimes===0&&E(L),Object.keys(ie).length===0&&v.delete(ee)}s.remove(L)}u(N,"deallocateTexture");function E(L){const O=s.get(L);n.deleteTexture(O.__webglTexture);const ee=L.source,ie=v.get(ee);delete ie[O.__cacheKey],o.memory.textures--}u(E,"deleteTexture");function z(L){const O=L.texture,ee=s.get(L),ie=s.get(O);if(ie.__webglTexture!==void 0&&(n.deleteTexture(ie.__webglTexture),o.memory.textures--),L.depthTexture&&L.depthTexture.dispose(),L.isWebGLCubeRenderTarget)for(let ce=0;ce<6;ce++)n.deleteFramebuffer(ee.__webglFramebuffer[ce]),ee.__webglDepthbuffer&&n.deleteRenderbuffer(ee.__webglDepthbuffer[ce]);else{if(n.deleteFramebuffer(ee.__webglFramebuffer),ee.__webglDepthbuffer&&n.deleteRenderbuffer(ee.__webglDepthbuffer),ee.__webglMultisampledFramebuffer&&n.deleteFramebuffer(ee.__webglMultisampledFramebuffer),ee.__webglColorRenderbuffer)for(let ce=0;ce<ee.__webglColorRenderbuffer.length;ce++)ee.__webglColorRenderbuffer[ce]&&n.deleteRenderbuffer(ee.__webglColorRenderbuffer[ce]);ee.__webglDepthRenderbuffer&&n.deleteRenderbuffer(ee.__webglDepthRenderbuffer)}if(L.isWebGLMultipleRenderTargets)for(let ce=0,ye=O.length;ce<ye;ce++){const Ce=s.get(O[ce]);Ce.__webglTexture&&(n.deleteTexture(Ce.__webglTexture),o.memory.textures--),s.remove(O[ce])}s.remove(O),s.remove(L)}u(z,"deallocateRenderTarget");let H=0;function q(){H=0}u(q,"resetTextureUnits");function ne(){const L=H;return L>=l&&console.warn("THREE.WebGLTextures: Trying to use "+L+" texture units while this GPU supports only "+l),H+=1,L}u(ne,"allocateTextureUnit");function W(L){const O=[];return O.push(L.wrapS),O.push(L.wrapT),O.push(L.wrapR||0),O.push(L.magFilter),O.push(L.minFilter),O.push(L.anisotropy),O.push(L.internalFormat),O.push(L.format),O.push(L.type),O.push(L.generateMipmaps),O.push(L.premultiplyAlpha),O.push(L.flipY),O.push(L.unpackAlignment),O.push(L.encoding),O.join()}u(W,"getTextureCacheKey");function se(L,O){const ee=s.get(L);if(L.isVideoTexture&&ae(L),L.isRenderTargetTexture===!1&&L.version>0&&ee.__version!==L.version){const ie=L.image;if(ie===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ie.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{pe(ee,L,O);return}}t.bindTexture(3553,ee.__webglTexture,33984+O)}u(se,"setTexture2D");function K(L,O){const ee=s.get(L);if(L.version>0&&ee.__version!==L.version){pe(ee,L,O);return}t.bindTexture(35866,ee.__webglTexture,33984+O)}u(K,"setTexture2DArray");function U(L,O){const ee=s.get(L);if(L.version>0&&ee.__version!==L.version){pe(ee,L,O);return}t.bindTexture(32879,ee.__webglTexture,33984+O)}u(U,"setTexture3D");function he(L,O){const ee=s.get(L);if(L.version>0&&ee.__version!==L.version){Ae(ee,L,O);return}t.bindTexture(34067,ee.__webglTexture,33984+O)}u(he,"setTextureCube");const ue={[zo]:10497,[Ks]:33071,[Tf]:33648},Q={[Wn]:9728,[t0]:9984,[n0]:9986,[qs]:9729,[Db]:9985,[fc]:9987};function te(L,O,ee){if(ee?(n.texParameteri(L,10242,ue[O.wrapS]),n.texParameteri(L,10243,ue[O.wrapT]),(L===32879||L===35866)&&n.texParameteri(L,32882,ue[O.wrapR]),n.texParameteri(L,10240,Q[O.magFilter]),n.texParameteri(L,10241,Q[O.minFilter])):(n.texParameteri(L,10242,33071),n.texParameteri(L,10243,33071),(L===32879||L===35866)&&n.texParameteri(L,32882,33071),(O.wrapS!==Ks||O.wrapT!==Ks)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(L,10240,D(O.magFilter)),n.texParameteri(L,10241,D(O.minFilter)),O.minFilter!==Wn&&O.minFilter!==qs&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const ie=e.get("EXT_texture_filter_anisotropic");if(O.type===Ra&&e.has("OES_texture_float_linear")===!1||a===!1&&O.type===Nu&&e.has("OES_texture_half_float_linear")===!1)return;(O.anisotropy>1||s.get(O).__currentAnisotropy)&&(n.texParameterf(L,ie.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(O.anisotropy,i.getMaxAnisotropy())),s.get(O).__currentAnisotropy=O.anisotropy)}}u(te,"setTextureParameters");function _e(L,O){let ee=!1;L.__webglInit===void 0&&(L.__webglInit=!0,O.addEventListener("dispose",k));const ie=O.source;let ce=v.get(ie);ce===void 0&&(ce={},v.set(ie,ce));const ye=W(O);if(ye!==L.__cacheKey){ce[ye]===void 0&&(ce[ye]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,ee=!0),ce[ye].usedTimes++;const Ce=ce[L.__cacheKey];Ce!==void 0&&(ce[L.__cacheKey].usedTimes--,Ce.usedTimes===0&&E(O)),L.__cacheKey=ye,L.__webglTexture=ce[ye].texture}return ee}u(_e,"initTexture");function pe(L,O,ee){let ie=3553;(O.isDataArrayTexture||O.isCompressedArrayTexture)&&(ie=35866),O.isData3DTexture&&(ie=32879);const ce=_e(L,O),ye=O.source;t.bindTexture(ie,L.__webglTexture,33984+ee);const Ce=s.get(ye);if(ye.version!==Ce.__version||ce===!0){t.activeTexture(33984+ee),n.pixelStorei(37440,O.flipY),n.pixelStorei(37441,O.premultiplyAlpha),n.pixelStorei(3317,O.unpackAlignment),n.pixelStorei(37443,0);const Te=x(O)&&w(O.image)===!1;let ve=_(O.image,Te,!1,h);ve=oe(O,ve);const Ge=w(ve)||a,Xe=r.convert(O.format,O.encoding);let Le=r.convert(O.type),Ke=M(O.internalFormat,Xe,Le,O.encoding,O.isVideoTexture);te(ie,O,Ge);let He;const et=O.mipmaps,Ut=a&&O.isVideoTexture!==!0,re=Ce.__version===void 0||ce===!0,G=R(O,ve,Ge);if(O.isDepthTexture)Ke=6402,a?O.type===Ra?Ke=36012:O.type===Bl?Ke=33190:O.type===Cu?Ke=35056:Ke=33189:O.type===Ra&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),O.format===jl&&Ke===6402&&O.type!==IP&&O.type!==Bl&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),O.type=Bl,Le=r.convert(O.type)),O.format===Fu&&Ke===6402&&(Ke=34041,O.type!==Cu&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),O.type=Cu,Le=r.convert(O.type))),re&&(Ut?t.texStorage2D(3553,1,Ke,ve.width,ve.height):t.texImage2D(3553,0,Ke,ve.width,ve.height,0,Xe,Le,null));else if(O.isDataTexture)if(et.length>0&&Ge){Ut&&re&&t.texStorage2D(3553,G,Ke,et[0].width,et[0].height);for(let le=0,de=et.length;le<de;le++)He=et[le],Ut?t.texSubImage2D(3553,le,0,0,He.width,He.height,Xe,Le,He.data):t.texImage2D(3553,le,Ke,He.width,He.height,0,Xe,Le,He.data);O.generateMipmaps=!1}else Ut?(re&&t.texStorage2D(3553,G,Ke,ve.width,ve.height),t.texSubImage2D(3553,0,0,0,ve.width,ve.height,Xe,Le,ve.data)):t.texImage2D(3553,0,Ke,ve.width,ve.height,0,Xe,Le,ve.data);else if(O.isCompressedTexture)if(O.isCompressedArrayTexture){Ut&&re&&t.texStorage3D(35866,G,Ke,et[0].width,et[0].height,ve.depth);for(let le=0,de=et.length;le<de;le++)He=et[le],O.format!==Ii?Xe!==null?Ut?t.compressedTexSubImage3D(35866,le,0,0,0,He.width,He.height,ve.depth,Xe,He.data,0,0):t.compressedTexImage3D(35866,le,Ke,He.width,He.height,ve.depth,0,He.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ut?t.texSubImage3D(35866,le,0,0,0,He.width,He.height,ve.depth,Xe,Le,He.data):t.texImage3D(35866,le,Ke,He.width,He.height,ve.depth,0,Xe,Le,He.data)}else{Ut&&re&&t.texStorage2D(3553,G,Ke,et[0].width,et[0].height);for(let le=0,de=et.length;le<de;le++)He=et[le],O.format!==Ii?Xe!==null?Ut?t.compressedTexSubImage2D(3553,le,0,0,He.width,He.height,Xe,He.data):t.compressedTexImage2D(3553,le,Ke,He.width,He.height,0,He.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ut?t.texSubImage2D(3553,le,0,0,He.width,He.height,Xe,Le,He.data):t.texImage2D(3553,le,Ke,He.width,He.height,0,Xe,Le,He.data)}else if(O.isDataArrayTexture)Ut?(re&&t.texStorage3D(35866,G,Ke,ve.width,ve.height,ve.depth),t.texSubImage3D(35866,0,0,0,0,ve.width,ve.height,ve.depth,Xe,Le,ve.data)):t.texImage3D(35866,0,Ke,ve.width,ve.height,ve.depth,0,Xe,Le,ve.data);else if(O.isData3DTexture)Ut?(re&&t.texStorage3D(32879,G,Ke,ve.width,ve.height,ve.depth),t.texSubImage3D(32879,0,0,0,0,ve.width,ve.height,ve.depth,Xe,Le,ve.data)):t.texImage3D(32879,0,Ke,ve.width,ve.height,ve.depth,0,Xe,Le,ve.data);else if(O.isFramebufferTexture){if(re)if(Ut)t.texStorage2D(3553,G,Ke,ve.width,ve.height);else{let le=ve.width,de=ve.height;for(let ge=0;ge<G;ge++)t.texImage2D(3553,ge,Ke,le,de,0,Xe,Le,null),le>>=1,de>>=1}}else if(et.length>0&&Ge){Ut&&re&&t.texStorage2D(3553,G,Ke,et[0].width,et[0].height);for(let le=0,de=et.length;le<de;le++)He=et[le],Ut?t.texSubImage2D(3553,le,0,0,Xe,Le,He):t.texImage2D(3553,le,Ke,Xe,Le,He);O.generateMipmaps=!1}else Ut?(re&&t.texStorage2D(3553,G,Ke,ve.width,ve.height),t.texSubImage2D(3553,0,0,0,Xe,Le,ve)):t.texImage2D(3553,0,Ke,Xe,Le,ve);S(O,Ge)&&C(ie),Ce.__version=ye.version,O.onUpdate&&O.onUpdate(O)}L.__version=O.version}u(pe,"uploadTexture");function Ae(L,O,ee){if(O.image.length!==6)return;const ie=_e(L,O),ce=O.source;t.bindTexture(34067,L.__webglTexture,33984+ee);const ye=s.get(ce);if(ce.version!==ye.__version||ie===!0){t.activeTexture(33984+ee),n.pixelStorei(37440,O.flipY),n.pixelStorei(37441,O.premultiplyAlpha),n.pixelStorei(3317,O.unpackAlignment),n.pixelStorei(37443,0);const Ce=O.isCompressedTexture||O.image[0].isCompressedTexture,Te=O.image[0]&&O.image[0].isDataTexture,ve=[];for(let le=0;le<6;le++)!Ce&&!Te?ve[le]=_(O.image[le],!1,!0,c):ve[le]=Te?O.image[le].image:O.image[le],ve[le]=oe(O,ve[le]);const Ge=ve[0],Xe=w(Ge)||a,Le=r.convert(O.format,O.encoding),Ke=r.convert(O.type),He=M(O.internalFormat,Le,Ke,O.encoding),et=a&&O.isVideoTexture!==!0,Ut=ye.__version===void 0||ie===!0;let re=R(O,Ge,Xe);te(34067,O,Xe);let G;if(Ce){et&&Ut&&t.texStorage2D(34067,re,He,Ge.width,Ge.height);for(let le=0;le<6;le++){G=ve[le].mipmaps;for(let de=0;de<G.length;de++){const ge=G[de];O.format!==Ii?Le!==null?et?t.compressedTexSubImage2D(34069+le,de,0,0,ge.width,ge.height,Le,ge.data):t.compressedTexImage2D(34069+le,de,He,ge.width,ge.height,0,ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):et?t.texSubImage2D(34069+le,de,0,0,ge.width,ge.height,Le,Ke,ge.data):t.texImage2D(34069+le,de,He,ge.width,ge.height,0,Le,Ke,ge.data)}}}else{G=O.mipmaps,et&&Ut&&(G.length>0&&re++,t.texStorage2D(34067,re,He,ve[0].width,ve[0].height));for(let le=0;le<6;le++)if(Te){et?t.texSubImage2D(34069+le,0,0,0,ve[le].width,ve[le].height,Le,Ke,ve[le].data):t.texImage2D(34069+le,0,He,ve[le].width,ve[le].height,0,Le,Ke,ve[le].data);for(let de=0;de<G.length;de++){const Re=G[de].image[le].image;et?t.texSubImage2D(34069+le,de+1,0,0,Re.width,Re.height,Le,Ke,Re.data):t.texImage2D(34069+le,de+1,He,Re.width,Re.height,0,Le,Ke,Re.data)}}else{et?t.texSubImage2D(34069+le,0,0,0,Le,Ke,ve[le]):t.texImage2D(34069+le,0,He,Le,Ke,ve[le]);for(let de=0;de<G.length;de++){const ge=G[de];et?t.texSubImage2D(34069+le,de+1,0,0,Le,Ke,ge.image[le]):t.texImage2D(34069+le,de+1,He,Le,Ke,ge.image[le])}}}S(O,Xe)&&C(34067),ye.__version=ce.version,O.onUpdate&&O.onUpdate(O)}L.__version=O.version}u(Ae,"uploadCubeTexture");function Me(L,O,ee,ie,ce){const ye=r.convert(ee.format,ee.encoding),Ce=r.convert(ee.type),Te=M(ee.internalFormat,ye,Ce,ee.encoding);s.get(O).__hasExternalTextures||(ce===32879||ce===35866?t.texImage3D(ce,0,Te,O.width,O.height,O.depth,0,ye,Ce,null):t.texImage2D(ce,0,Te,O.width,O.height,0,ye,Ce,null)),t.bindFramebuffer(36160,L),V(O)?f.framebufferTexture2DMultisampleEXT(36160,ie,ce,s.get(ee).__webglTexture,0,F(O)):(ce===3553||ce>=34069&&ce<=34074)&&n.framebufferTexture2D(36160,ie,ce,s.get(ee).__webglTexture,0),t.bindFramebuffer(36160,null)}u(Me,"setupFrameBufferTexture");function Ie(L,O,ee){if(n.bindRenderbuffer(36161,L),O.depthBuffer&&!O.stencilBuffer){let ie=33189;if(ee||V(O)){const ce=O.depthTexture;ce&&ce.isDepthTexture&&(ce.type===Ra?ie=36012:ce.type===Bl&&(ie=33190));const ye=F(O);V(O)?f.renderbufferStorageMultisampleEXT(36161,ye,ie,O.width,O.height):n.renderbufferStorageMultisample(36161,ye,ie,O.width,O.height)}else n.renderbufferStorage(36161,ie,O.width,O.height);n.framebufferRenderbuffer(36160,36096,36161,L)}else if(O.depthBuffer&&O.stencilBuffer){const ie=F(O);ee&&V(O)===!1?n.renderbufferStorageMultisample(36161,ie,35056,O.width,O.height):V(O)?f.renderbufferStorageMultisampleEXT(36161,ie,35056,O.width,O.height):n.renderbufferStorage(36161,34041,O.width,O.height),n.framebufferRenderbuffer(36160,33306,36161,L)}else{const ie=O.isWebGLMultipleRenderTargets===!0?O.texture:[O.texture];for(let ce=0;ce<ie.length;ce++){const ye=ie[ce],Ce=r.convert(ye.format,ye.encoding),Te=r.convert(ye.type),ve=M(ye.internalFormat,Ce,Te,ye.encoding),Ge=F(O);ee&&V(O)===!1?n.renderbufferStorageMultisample(36161,Ge,ve,O.width,O.height):V(O)?f.renderbufferStorageMultisampleEXT(36161,Ge,ve,O.width,O.height):n.renderbufferStorage(36161,ve,O.width,O.height)}}n.bindRenderbuffer(36161,null)}u(Ie,"setupRenderBufferStorage");function $(L,O){if(O&&O.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,L),!(O.depthTexture&&O.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!s.get(O.depthTexture).__webglTexture||O.depthTexture.image.width!==O.width||O.depthTexture.image.height!==O.height)&&(O.depthTexture.image.width=O.width,O.depthTexture.image.height=O.height,O.depthTexture.needsUpdate=!0),se(O.depthTexture,0);const ie=s.get(O.depthTexture).__webglTexture,ce=F(O);if(O.depthTexture.format===jl)V(O)?f.framebufferTexture2DMultisampleEXT(36160,36096,3553,ie,0,ce):n.framebufferTexture2D(36160,36096,3553,ie,0);else if(O.depthTexture.format===Fu)V(O)?f.framebufferTexture2DMultisampleEXT(36160,33306,3553,ie,0,ce):n.framebufferTexture2D(36160,33306,3553,ie,0);else throw new Error("Unknown depthTexture format")}u($,"setupDepthTexture");function X(L){const O=s.get(L),ee=L.isWebGLCubeRenderTarget===!0;if(L.depthTexture&&!O.__autoAllocateDepthBuffer){if(ee)throw new Error("target.depthTexture not supported in Cube render targets");$(O.__webglFramebuffer,L)}else if(ee){O.__webglDepthbuffer=[];for(let ie=0;ie<6;ie++)t.bindFramebuffer(36160,O.__webglFramebuffer[ie]),O.__webglDepthbuffer[ie]=n.createRenderbuffer(),Ie(O.__webglDepthbuffer[ie],L,!1)}else t.bindFramebuffer(36160,O.__webglFramebuffer),O.__webglDepthbuffer=n.createRenderbuffer(),Ie(O.__webglDepthbuffer,L,!1);t.bindFramebuffer(36160,null)}u(X,"setupDepthRenderbuffer");function I(L,O,ee){const ie=s.get(L);O!==void 0&&Me(ie.__webglFramebuffer,L,L.texture,36064,3553),ee!==void 0&&X(L)}u(I,"rebindTextures");function J(L){const O=L.texture,ee=s.get(L),ie=s.get(O);L.addEventListener("dispose",T),L.isWebGLMultipleRenderTargets!==!0&&(ie.__webglTexture===void 0&&(ie.__webglTexture=n.createTexture()),ie.__version=O.version,o.memory.textures++);const ce=L.isWebGLCubeRenderTarget===!0,ye=L.isWebGLMultipleRenderTargets===!0,Ce=w(L)||a;if(ce){ee.__webglFramebuffer=[];for(let Te=0;Te<6;Te++)ee.__webglFramebuffer[Te]=n.createFramebuffer()}else{if(ee.__webglFramebuffer=n.createFramebuffer(),ye)if(i.drawBuffers){const Te=L.texture;for(let ve=0,Ge=Te.length;ve<Ge;ve++){const Xe=s.get(Te[ve]);Xe.__webglTexture===void 0&&(Xe.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&L.samples>0&&V(L)===!1){const Te=ye?O:[O];ee.__webglMultisampledFramebuffer=n.createFramebuffer(),ee.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,ee.__webglMultisampledFramebuffer);for(let ve=0;ve<Te.length;ve++){const Ge=Te[ve];ee.__webglColorRenderbuffer[ve]=n.createRenderbuffer(),n.bindRenderbuffer(36161,ee.__webglColorRenderbuffer[ve]);const Xe=r.convert(Ge.format,Ge.encoding),Le=r.convert(Ge.type),Ke=M(Ge.internalFormat,Xe,Le,Ge.encoding,L.isXRRenderTarget===!0),He=F(L);n.renderbufferStorageMultisample(36161,He,Ke,L.width,L.height),n.framebufferRenderbuffer(36160,36064+ve,36161,ee.__webglColorRenderbuffer[ve])}n.bindRenderbuffer(36161,null),L.depthBuffer&&(ee.__webglDepthRenderbuffer=n.createRenderbuffer(),Ie(ee.__webglDepthRenderbuffer,L,!0)),t.bindFramebuffer(36160,null)}}if(ce){t.bindTexture(34067,ie.__webglTexture),te(34067,O,Ce);for(let Te=0;Te<6;Te++)Me(ee.__webglFramebuffer[Te],L,O,36064,34069+Te);S(O,Ce)&&C(34067),t.unbindTexture()}else if(ye){const Te=L.texture;for(let ve=0,Ge=Te.length;ve<Ge;ve++){const Xe=Te[ve],Le=s.get(Xe);t.bindTexture(3553,Le.__webglTexture),te(3553,Xe,Ce),Me(ee.__webglFramebuffer,L,Xe,36064+ve,3553),S(Xe,Ce)&&C(3553)}t.unbindTexture()}else{let Te=3553;(L.isWebGL3DRenderTarget||L.isWebGLArrayRenderTarget)&&(a?Te=L.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Te,ie.__webglTexture),te(Te,O,Ce),Me(ee.__webglFramebuffer,L,O,36064,Te),S(O,Ce)&&C(Te),t.unbindTexture()}L.depthBuffer&&X(L)}u(J,"setupRenderTarget");function Z(L){const O=w(L)||a,ee=L.isWebGLMultipleRenderTargets===!0?L.texture:[L.texture];for(let ie=0,ce=ee.length;ie<ce;ie++){const ye=ee[ie];if(S(ye,O)){const Ce=L.isWebGLCubeRenderTarget?34067:3553,Te=s.get(ye).__webglTexture;t.bindTexture(Ce,Te),C(Ce),t.unbindTexture()}}}u(Z,"updateRenderTargetMipmap");function B(L){if(a&&L.samples>0&&V(L)===!1){const O=L.isWebGLMultipleRenderTargets?L.texture:[L.texture],ee=L.width,ie=L.height;let ce=16384;const ye=[],Ce=L.stencilBuffer?33306:36096,Te=s.get(L),ve=L.isWebGLMultipleRenderTargets===!0;if(ve)for(let Ge=0;Ge<O.length;Ge++)t.bindFramebuffer(36160,Te.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Ge,36161,null),t.bindFramebuffer(36160,Te.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Ge,3553,null,0);t.bindFramebuffer(36008,Te.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Te.__webglFramebuffer);for(let Ge=0;Ge<O.length;Ge++){ye.push(36064+Ge),L.depthBuffer&&ye.push(Ce);const Xe=Te.__ignoreDepthValues!==void 0?Te.__ignoreDepthValues:!1;if(Xe===!1&&(L.depthBuffer&&(ce|=256),L.stencilBuffer&&(ce|=1024)),ve&&n.framebufferRenderbuffer(36008,36064,36161,Te.__webglColorRenderbuffer[Ge]),Xe===!0&&(n.invalidateFramebuffer(36008,[Ce]),n.invalidateFramebuffer(36009,[Ce])),ve){const Le=s.get(O[Ge]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Le,0)}n.blitFramebuffer(0,0,ee,ie,0,0,ee,ie,ce,9728),p&&n.invalidateFramebuffer(36008,ye)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),ve)for(let Ge=0;Ge<O.length;Ge++){t.bindFramebuffer(36160,Te.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+Ge,36161,Te.__webglColorRenderbuffer[Ge]);const Xe=s.get(O[Ge]).__webglTexture;t.bindFramebuffer(36160,Te.__webglFramebuffer),n.framebufferTexture2D(36009,36064+Ge,3553,Xe,0)}t.bindFramebuffer(36009,Te.__webglMultisampledFramebuffer)}}u(B,"updateMultisampleRenderTarget");function F(L){return Math.min(d,L.samples)}u(F,"getRenderTargetSamples");function V(L){const O=s.get(L);return a&&L.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&O.__useRenderToTexture!==!1}u(V,"useMultisampledRTT");function ae(L){const O=o.render.frame;g.get(L)!==O&&(g.set(L,O),L.update())}u(ae,"updateVideoTexture");function oe(L,O){const ee=L.encoding,ie=L.format,ce=L.type;return L.isCompressedTexture===!0||L.isVideoTexture===!0||L.format===R_||ee!==Bo&&(ee===Bt?a===!1?e.has("EXT_sRGB")===!0&&ie===Ii?(L.format=R_,L.minFilter=qs,L.generateMipmaps=!1):O=Ob.sRGBToLinear(O):(ie!==Ii||ce!==Kl)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",ee)),O}u(oe,"verifyColorSpace"),this.allocateTextureUnit=ne,this.resetTextureUnits=q,this.setTexture2D=se,this.setTexture2DArray=K,this.setTexture3D=U,this.setTextureCube=he,this.rebindTextures=I,this.setupRenderTarget=J,this.updateRenderTargetMipmap=Z,this.updateMultisampleRenderTarget=B,this.setupDepthRenderbuffer=X,this.setupFrameBufferTexture=Me,this.useMultisampledRTT=V}u(E8,"WebGLTextures");function T8(n,e,t){const s=t.isWebGL2;function i(r,o=null){let a;if(r===Kl)return 5121;if(r===_z)return 32819;if(r===bz)return 32820;if(r===gz)return 5120;if(r===vz)return 5122;if(r===IP)return 5123;if(r===yz)return 5124;if(r===Bl)return 5125;if(r===Ra)return 5126;if(r===Nu)return s?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===wz)return 6406;if(r===Ii)return 6408;if(r===Az)return 6409;if(r===Mz)return 6410;if(r===jl)return 6402;if(r===Fu)return 34041;if(r===Sz)return 6403;if(r===xz)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===R_)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===Cz)return 36244;if(r===Ez)return 33319;if(r===Tz)return 33320;if(r===Pz)return 36249;if(r===J1||r===ev||r===tv||r===nv)if(o===Bt)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===J1)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===ev)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===tv)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===nv)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===J1)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===ev)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===tv)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===nv)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===NM||r===FM||r===zM||r===BM)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===NM)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===FM)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===zM)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===BM)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Rz)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===UM||r===$M)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===UM)return o===Bt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===$M)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===VM||r===GM||r===HM||r===WM||r===jM||r===XM||r===YM||r===qM||r===KM||r===ZM||r===QM||r===JM||r===e2||r===t2)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===VM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===GM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===HM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===WM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===jM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===XM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===YM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===qM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===KM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===ZM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===QM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===JM)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===e2)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===t2)return o===Bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===n2)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===n2)return o===Bt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===Cu?s?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[r]!==void 0?n[r]:null}return u(i,"convert"),{convert:i}}u(T8,"WebGLUtils");class ZP extends _s{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}u(ZP,"ArrayCamera");class ls extends Lt{constructor(){super(),this.isGroup=!0,this.type="Group"}}u(ls,"Group");const P8={type:"move"};class Lg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ls,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ls,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new P,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new P),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ls,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new P,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new P),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,s){let i=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const m of e.hand.values()){const v=t.getJointPose(m,s);if(c.joints[m.jointName]===void 0){const b=new ls;b.matrixAutoUpdate=!1,b.visible=!1,c.joints[m.jointName]=b,c.add(b)}const y=c.joints[m.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}const h=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=h.position.distanceTo(d.position),p=.02,g=.005;c.inputState.pinching&&f>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,s),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,s),i===null&&r!==null&&(i=r),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(P8)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}}u(Lg,"WebXRController");class Ub extends is{constructor(e,t,s,i,r,o,a,l,c,h){if(h=h!==void 0?h:jl,h!==jl&&h!==Fu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&h===jl&&(s=Bl),s===void 0&&h===Fu&&(s=Cu),super(null,i,r,o,a,l,h,s,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Wn,this.minFilter=l!==void 0?l:Wn,this.flipY=!1,this.generateMipmaps=!1}}u(Ub,"DepthTexture");class QP extends pc{constructor(e,t){super();const s=this;let i=null,r=1,o=null,a="local-floor",l=null,c=null,h=null,d=null,f=null,p=null;const g=t.getContextAttributes();let m=null,v=null;const y=[],b=[],_=new _s;_.layers.enable(1),_.viewport=new Ft;const w=new _s;w.layers.enable(2),w.viewport=new Ft;const x=[_,w],S=new ZP;S.layers.enable(1),S.layers.enable(2);let C=null,M=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(W){let se=y[W];return se===void 0&&(se=new Lg,y[W]=se),se.getTargetRaySpace()},this.getControllerGrip=function(W){let se=y[W];return se===void 0&&(se=new Lg,y[W]=se),se.getGripSpace()},this.getHand=function(W){let se=y[W];return se===void 0&&(se=new Lg,y[W]=se),se.getHandSpace()};function R(W){const se=b.indexOf(W.inputSource);if(se===-1)return;const K=y[se];K!==void 0&&K.dispatchEvent({type:W.type,data:W.inputSource})}u(R,"onSessionEvent");function D(){i.removeEventListener("select",R),i.removeEventListener("selectstart",R),i.removeEventListener("selectend",R),i.removeEventListener("squeeze",R),i.removeEventListener("squeezestart",R),i.removeEventListener("squeezeend",R),i.removeEventListener("end",D),i.removeEventListener("inputsourceschange",k);for(let W=0;W<y.length;W++){const se=b[W];se!==null&&(b[W]=null,y[W].disconnect(se))}C=null,M=null,e.setRenderTarget(m),f=null,d=null,h=null,i=null,v=null,ne.stop(),s.isPresenting=!1,s.dispatchEvent({type:"sessionend"})}u(D,"onSessionEnd"),this.setFramebufferScaleFactor=function(W){r=W,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(W){a=W,s.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(W){l=W},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(W){if(i=W,i!==null){if(m=e.getRenderTarget(),i.addEventListener("select",R),i.addEventListener("selectstart",R),i.addEventListener("selectend",R),i.addEventListener("squeeze",R),i.addEventListener("squeezestart",R),i.addEventListener("squeezeend",R),i.addEventListener("end",D),i.addEventListener("inputsourceschange",k),g.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const se={antialias:i.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(i,t,se),i.updateRenderState({baseLayer:f}),v=new ys(f.framebufferWidth,f.framebufferHeight,{format:Ii,type:Kl,encoding:e.outputEncoding,stencilBuffer:g.stencil})}else{let se=null,K=null,U=null;g.depth&&(U=g.stencil?35056:33190,se=g.stencil?Fu:jl,K=g.stencil?Cu:Bl);const he={colorFormat:32856,depthFormat:U,scaleFactor:r};h=new XRWebGLBinding(i,t),d=h.createProjectionLayer(he),i.updateRenderState({layers:[d]}),v=new ys(d.textureWidth,d.textureHeight,{format:Ii,type:Kl,depthTexture:new Ub(d.textureWidth,d.textureHeight,K,void 0,void 0,void 0,void 0,void 0,void 0,se),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0});const ue=e.properties.get(v);ue.__ignoreDepthValues=d.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(1),l=null,o=await i.requestReferenceSpace(a),ne.setContext(i),ne.start(),s.isPresenting=!0,s.dispatchEvent({type:"sessionstart"})}};function k(W){for(let se=0;se<W.removed.length;se++){const K=W.removed[se],U=b.indexOf(K);U>=0&&(b[U]=null,y[U].dispatchEvent({type:"disconnected",data:K}))}for(let se=0;se<W.added.length;se++){const K=W.added[se];let U=b.indexOf(K);if(U===-1){for(let ue=0;ue<y.length;ue++)if(ue>=b.length){b.push(K),U=ue;break}else if(b[ue]===null){b[ue]=K,U=ue;break}if(U===-1)break}const he=y[U];he&&he.dispatchEvent({type:"connected",data:K})}}u(k,"onInputSourcesChange");const T=new P,N=new P;function E(W,se,K){T.setFromMatrixPosition(se.matrixWorld),N.setFromMatrixPosition(K.matrixWorld);const U=T.distanceTo(N),he=se.projectionMatrix.elements,ue=K.projectionMatrix.elements,Q=he[14]/(he[10]-1),te=he[14]/(he[10]+1),_e=(he[9]+1)/he[5],pe=(he[9]-1)/he[5],Ae=(he[8]-1)/he[0],Me=(ue[8]+1)/ue[0],Ie=Q*Ae,$=Q*Me,X=U/(-Ae+Me),I=X*-Ae;se.matrixWorld.decompose(W.position,W.quaternion,W.scale),W.translateX(I),W.translateZ(X),W.matrixWorld.compose(W.position,W.quaternion,W.scale),W.matrixWorldInverse.copy(W.matrixWorld).invert();const J=Q+X,Z=te+X,B=Ie-I,F=$+(U-I),V=_e*te/Z*J,ae=pe*te/Z*J;W.projectionMatrix.makePerspective(B,F,V,ae,J,Z)}u(E,"setProjectionFromUnion");function z(W,se){se===null?W.matrixWorld.copy(W.matrix):W.matrixWorld.multiplyMatrices(se.matrixWorld,W.matrix),W.matrixWorldInverse.copy(W.matrixWorld).invert()}u(z,"updateCamera"),this.updateCamera=function(W){if(i===null)return;S.near=w.near=_.near=W.near,S.far=w.far=_.far=W.far,(C!==S.near||M!==S.far)&&(i.updateRenderState({depthNear:S.near,depthFar:S.far}),C=S.near,M=S.far);const se=W.parent,K=S.cameras;z(S,se);for(let he=0;he<K.length;he++)z(K[he],se);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),W.matrix.copy(S.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale);const U=W.children;for(let he=0,ue=U.length;he<ue;he++)U[he].updateMatrixWorld(!0);K.length===2?E(S,_,w):S.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return S},this.getFoveation=function(){if(d!==null)return d.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function(W){d!==null&&(d.fixedFoveation=W),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=W)};let H=null;function q(W,se){if(c=se.getViewerPose(l||o),p=se,c!==null){const K=c.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let U=!1;K.length!==S.cameras.length&&(S.cameras.length=0,U=!0);for(let he=0;he<K.length;he++){const ue=K[he];let Q=null;if(f!==null)Q=f.getViewport(ue);else{const _e=h.getViewSubImage(d,ue);Q=_e.viewport,he===0&&(e.setRenderTargetTextures(v,_e.colorTexture,d.ignoreDepthValues?void 0:_e.depthStencilTexture),e.setRenderTarget(v))}let te=x[he];te===void 0&&(te=new _s,te.layers.enable(he),te.viewport=new Ft,x[he]=te),te.matrix.fromArray(ue.transform.matrix),te.projectionMatrix.fromArray(ue.projectionMatrix),te.viewport.set(Q.x,Q.y,Q.width,Q.height),he===0&&S.matrix.copy(te.matrix),U===!0&&S.cameras.push(te)}}for(let K=0;K<y.length;K++){const U=b[K],he=y[K];U!==null&&he!==void 0&&he.update(U,se,l||o)}H&&H(W,se),p=null}u(q,"onAnimationFrame");const ne=new UP;ne.setAnimationLoop(q),this.setAnimationLoop=function(W){H=W},this.dispose=function(){}}}u(QP,"WebXRManager");function R8(n,e){function t(m,v){m.fogColor.value.copy(v.color),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)}u(t,"refreshFogUniforms");function s(m,v,y,b,_){v.isMeshBasicMaterial||v.isMeshLambertMaterial?i(m,v):v.isMeshToonMaterial?(i(m,v),h(m,v)):v.isMeshPhongMaterial?(i(m,v),c(m,v)):v.isMeshStandardMaterial?(i(m,v),d(m,v),v.isMeshPhysicalMaterial&&f(m,v,_)):v.isMeshMatcapMaterial?(i(m,v),p(m,v)):v.isMeshDepthMaterial?i(m,v):v.isMeshDistanceMaterial?(i(m,v),g(m,v)):v.isMeshNormalMaterial?i(m,v):v.isLineBasicMaterial?(r(m,v),v.isLineDashedMaterial&&o(m,v)):v.isPointsMaterial?a(m,v,y,b):v.isSpriteMaterial?l(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}u(s,"refreshMaterialUniforms");function i(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.bumpMap&&(m.bumpMap.value=v.bumpMap,m.bumpScale.value=v.bumpScale,v.side===Ki&&(m.bumpScale.value*=-1)),v.displacementMap&&(m.displacementMap.value=v.displacementMap,m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap),v.normalMap&&(m.normalMap.value=v.normalMap,m.normalScale.value.copy(v.normalScale),v.side===Ki&&m.normalScale.value.negate()),v.specularMap&&(m.specularMap.value=v.specularMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const y=e.get(v).envMap;if(y&&(m.envMap.value=y,m.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio),v.lightMap){m.lightMap.value=v.lightMap;const w=n.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=v.lightMapIntensity*w}v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity);let b;v.map?b=v.map:v.specularMap?b=v.specularMap:v.displacementMap?b=v.displacementMap:v.normalMap?b=v.normalMap:v.bumpMap?b=v.bumpMap:v.roughnessMap?b=v.roughnessMap:v.metalnessMap?b=v.metalnessMap:v.alphaMap?b=v.alphaMap:v.emissiveMap?b=v.emissiveMap:v.clearcoatMap?b=v.clearcoatMap:v.clearcoatNormalMap?b=v.clearcoatNormalMap:v.clearcoatRoughnessMap?b=v.clearcoatRoughnessMap:v.iridescenceMap?b=v.iridescenceMap:v.iridescenceThicknessMap?b=v.iridescenceThicknessMap:v.specularIntensityMap?b=v.specularIntensityMap:v.specularColorMap?b=v.specularColorMap:v.transmissionMap?b=v.transmissionMap:v.thicknessMap?b=v.thicknessMap:v.sheenColorMap?b=v.sheenColorMap:v.sheenRoughnessMap&&(b=v.sheenRoughnessMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),m.uvTransform.value.copy(b.matrix));let _;v.aoMap?_=v.aoMap:v.lightMap&&(_=v.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uv2Transform.value.copy(_.matrix))}u(i,"refreshUniformsCommon");function r(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity}u(r,"refreshUniformsLine");function o(m,v){m.dashSize.value=v.dashSize,m.totalSize.value=v.dashSize+v.gapSize,m.scale.value=v.scale}u(o,"refreshUniformsDash");function a(m,v,y,b){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.size.value=v.size*y,m.scale.value=b*.5,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let _;v.map?_=v.map:v.alphaMap&&(_=v.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uvTransform.value.copy(_.matrix))}u(a,"refreshUniformsPoints");function l(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.rotation.value=v.rotation,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let y;v.map?y=v.map:v.alphaMap&&(y=v.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix))}u(l,"refreshUniformsSprites");function c(m,v){m.specular.value.copy(v.specular),m.shininess.value=Math.max(v.shininess,1e-4)}u(c,"refreshUniformsPhong");function h(m,v){v.gradientMap&&(m.gradientMap.value=v.gradientMap)}u(h,"refreshUniformsToon");function d(m,v){m.roughness.value=v.roughness,m.metalness.value=v.metalness,v.roughnessMap&&(m.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(m.metalnessMap.value=v.metalnessMap),e.get(v).envMap&&(m.envMapIntensity.value=v.envMapIntensity)}u(d,"refreshUniformsStandard");function f(m,v,y){m.ior.value=v.ior,v.sheen>0&&(m.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),m.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(m.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(m.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(m.clearcoat.value=v.clearcoat,m.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(m.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),m.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===Ki&&m.clearcoatNormalScale.value.negate())),v.iridescence>0&&(m.iridescence.value=v.iridescence,m.iridescenceIOR.value=v.iridescenceIOR,m.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(m.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(m.transmission.value=v.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),v.transmissionMap&&(m.transmissionMap.value=v.transmissionMap),m.thickness.value=v.thickness,v.thicknessMap&&(m.thicknessMap.value=v.thicknessMap),m.attenuationDistance.value=v.attenuationDistance,m.attenuationColor.value.copy(v.attenuationColor)),m.specularIntensity.value=v.specularIntensity,m.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(m.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(m.specularColorMap.value=v.specularColorMap)}u(f,"refreshUniformsPhysical");function p(m,v){v.matcap&&(m.matcap.value=v.matcap)}u(p,"refreshUniformsMatcap");function g(m,v){m.referencePosition.value.copy(v.referencePosition),m.nearDistance.value=v.nearDistance,m.farDistance.value=v.farDistance}return u(g,"refreshUniformsDistance"),{refreshFogUniforms:t,refreshMaterialUniforms:s}}u(R8,"WebGLMaterials");function I8(n,e,t,s){let i={},r={},o=[];const a=t.isWebGL2?n.getParameter(35375):0;function l(b,_){const w=_.program;s.uniformBlockBinding(b,w)}u(l,"bind");function c(b,_){let w=i[b.id];w===void 0&&(g(b),w=h(b),i[b.id]=w,b.addEventListener("dispose",v));const x=_.program;s.updateUBOMapping(b,x);const S=e.render.frame;r[b.id]!==S&&(f(b),r[b.id]=S)}u(c,"update");function h(b){const _=d();b.__bindingPointIndex=_;const w=n.createBuffer(),x=b.__size,S=b.usage;return n.bindBuffer(35345,w),n.bufferData(35345,x,S),n.bindBuffer(35345,null),n.bindBufferBase(35345,_,w),w}u(h,"createBuffer");function d(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}u(d,"allocateBindingPointIndex");function f(b){const _=i[b.id],w=b.uniforms,x=b.__cache;n.bindBuffer(35345,_);for(let S=0,C=w.length;S<C;S++){const M=w[S];if(p(M,S,x)===!0){const R=M.value,D=M.__offset;typeof R=="number"?(M.__data[0]=R,n.bufferSubData(35345,D,M.__data)):(M.value.isMatrix3?(M.__data[0]=M.value.elements[0],M.__data[1]=M.value.elements[1],M.__data[2]=M.value.elements[2],M.__data[3]=M.value.elements[0],M.__data[4]=M.value.elements[3],M.__data[5]=M.value.elements[4],M.__data[6]=M.value.elements[5],M.__data[7]=M.value.elements[0],M.__data[8]=M.value.elements[6],M.__data[9]=M.value.elements[7],M.__data[10]=M.value.elements[8],M.__data[11]=M.value.elements[0]):R.toArray(M.__data),n.bufferSubData(35345,D,M.__data))}}n.bindBuffer(35345,null)}u(f,"updateBufferData");function p(b,_,w){const x=b.value;if(w[_]===void 0)return typeof x=="number"?w[_]=x:w[_]=x.clone(),!0;if(typeof x=="number"){if(w[_]!==x)return w[_]=x,!0}else{const S=w[_];if(S.equals(x)===!1)return S.copy(x),!0}return!1}u(p,"hasUniformChanged");function g(b){const _=b.uniforms;let w=0;const x=16;let S=0;for(let C=0,M=_.length;C<M;C++){const R=_[C],D=m(R);if(R.__data=new Float32Array(D.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=w,C>0){S=w%x;const k=x-S;S!==0&&k-D.boundary<0&&(w+=x-S,R.__offset=w)}w+=D.storage}return S=w%x,S>0&&(w+=x-S),b.__size=w,b.__cache={},this}u(g,"prepareUniformsGroup");function m(b){const _=b.value,w={boundary:0,storage:0};return typeof _=="number"?(w.boundary=4,w.storage=4):_.isVector2?(w.boundary=8,w.storage=8):_.isVector3||_.isColor?(w.boundary=16,w.storage=12):_.isVector4?(w.boundary=16,w.storage=16):_.isMatrix3?(w.boundary=48,w.storage=48):_.isMatrix4?(w.boundary=64,w.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),w}u(m,"getUniformSize");function v(b){const _=b.target;_.removeEventListener("dispose",v);const w=o.indexOf(_.__bindingPointIndex);o.splice(w,1),n.deleteBuffer(i[_.id]),delete i[_.id],delete r[_.id]}u(v,"onUniformsGroupsDispose");function y(){for(const b in i)n.deleteBuffer(i[b]);o=[],i={},r={}}return u(y,"dispose"),{bind:l,update:c,dispose:y}}u(I8,"WebGLUniformsGroups");function D8(){const n=Rf("canvas");return n.style.display="block",n}u(D8,"createCanvasElement");function JP(n={}){this.isWebGLRenderer=!0;const e=n.canvas!==void 0?n.canvas:D8(),t=n.context!==void 0?n.context:null,s=n.depth!==void 0?n.depth:!0,i=n.stencil!==void 0?n.stencil:!0,r=n.antialias!==void 0?n.antialias:!1,o=n.premultipliedAlpha!==void 0?n.premultipliedAlpha:!0,a=n.preserveDrawingBuffer!==void 0?n.preserveDrawingBuffer:!1,l=n.powerPreference!==void 0?n.powerPreference:"default",c=n.failIfMajorPerformanceCaveat!==void 0?n.failIfMajorPerformanceCaveat:!1;let h;t!==null?h=t.getContextAttributes().alpha:h=n.alpha!==void 0?n.alpha:!1;let d=null,f=null;const p=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Bo,this.physicallyCorrectLights=!1,this.toneMapping=Xr,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let v=!1,y=0,b=0,_=null,w=-1,x=null;const S=new Ft,C=new Ft;let M=null,R=e.width,D=e.height,k=1,T=null,N=null;const E=new Ft(0,0,R,D),z=new Ft(0,0,R,D);let H=!1;const q=new ep;let ne=!1,W=!1,se=null;const K=new be,U=new $e,he=new P,ue={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Q(){return _===null?k:1}u(Q,"getTargetPixelRatio");let te=t;function _e(Y,me){for(let xe=0;xe<Y.length;xe++){const fe=Y[xe],Ee=e.getContext(fe,me);if(Ee!==null)return Ee}return null}u(_e,"getContext");try{const Y={alpha:!0,depth:s,stencil:i,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Ib}`),e.addEventListener("webglcontextlost",Ke,!1),e.addEventListener("webglcontextrestored",He,!1),e.addEventListener("webglcontextcreationerror",et,!1),te===null){const me=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&me.shift(),te=_e(me,Y),te===null)throw _e(me)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}te.getShaderPrecisionFormat===void 0&&(te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Y){throw console.error("THREE.WebGLRenderer: "+Y.message),Y}let pe,Ae,Me,Ie,$,X,I,J,Z,B,F,V,ae,oe,L,O,ee,ie,ce,ye,Ce,Te,ve,Ge;function Xe(){pe=new J6(te),Ae=new X6(te,pe,n),pe.init(Ae),Te=new T8(te,pe,Ae),Me=new C8(te,pe,Ae),Ie=new n$,$=new p8,X=new E8(te,pe,Me,$,Ae,Te,Ie),I=new q6(m),J=new Q6(m),Z=new hB(te,Ae),ve=new W6(te,pe,Z,Ae),B=new e$(te,Z,Ie,ve),F=new o$(te,B,Z,Ie),ce=new r$(te,Ae,X),O=new Y6($),V=new f8(m,I,J,pe,Ae,ve,O),ae=new R8(m,$),oe=new g8,L=new x8(pe,Ae),ie=new H6(m,I,J,Me,F,h,o),ee=new S8(m,F,Ae),Ge=new I8(te,Ie,Ae,Me),ye=new j6(te,pe,Ie,Ae),Ce=new t$(te,pe,Ie,Ae),Ie.programs=V.programs,m.capabilities=Ae,m.extensions=pe,m.properties=$,m.renderLists=oe,m.shadowMap=ee,m.state=Me,m.info=Ie}u(Xe,"initGLContext"),Xe();const Le=new QP(m,te);this.xr=Le,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const Y=pe.get("WEBGL_lose_context");Y&&Y.loseContext()},this.forceContextRestore=function(){const Y=pe.get("WEBGL_lose_context");Y&&Y.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(Y){Y!==void 0&&(k=Y,this.setSize(R,D,!1))},this.getSize=function(Y){return Y.set(R,D)},this.setSize=function(Y,me,xe){if(Le.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}R=Y,D=me,e.width=Math.floor(Y*k),e.height=Math.floor(me*k),xe!==!1&&(e.style.width=Y+"px",e.style.height=me+"px"),this.setViewport(0,0,Y,me)},this.getDrawingBufferSize=function(Y){return Y.set(R*k,D*k).floor()},this.setDrawingBufferSize=function(Y,me,xe){R=Y,D=me,k=xe,e.width=Math.floor(Y*xe),e.height=Math.floor(me*xe),this.setViewport(0,0,Y,me)},this.getCurrentViewport=function(Y){return Y.copy(S)},this.getViewport=function(Y){return Y.copy(E)},this.setViewport=function(Y,me,xe,fe){Y.isVector4?E.set(Y.x,Y.y,Y.z,Y.w):E.set(Y,me,xe,fe),Me.viewport(S.copy(E).multiplyScalar(k).floor())},this.getScissor=function(Y){return Y.copy(z)},this.setScissor=function(Y,me,xe,fe){Y.isVector4?z.set(Y.x,Y.y,Y.z,Y.w):z.set(Y,me,xe,fe),Me.scissor(C.copy(z).multiplyScalar(k).floor())},this.getScissorTest=function(){return H},this.setScissorTest=function(Y){Me.setScissorTest(H=Y)},this.setOpaqueSort=function(Y){T=Y},this.setTransparentSort=function(Y){N=Y},this.getClearColor=function(Y){return Y.copy(ie.getClearColor())},this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)},this.clear=function(Y=!0,me=!0,xe=!0){let fe=0;Y&&(fe|=16384),me&&(fe|=256),xe&&(fe|=1024),te.clear(fe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ke,!1),e.removeEventListener("webglcontextrestored",He,!1),e.removeEventListener("webglcontextcreationerror",et,!1),oe.dispose(),L.dispose(),$.dispose(),I.dispose(),J.dispose(),F.dispose(),ve.dispose(),Ge.dispose(),V.dispose(),Le.dispose(),Le.removeEventListener("sessionstart",ge),Le.removeEventListener("sessionend",Re),se&&(se.dispose(),se=null),st.stop()};function Ke(Y){Y.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}u(Ke,"onContextLost");function He(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const Y=Ie.autoReset,me=ee.enabled,xe=ee.autoUpdate,fe=ee.needsUpdate,Ee=ee.type;Xe(),Ie.autoReset=Y,ee.enabled=me,ee.autoUpdate=xe,ee.needsUpdate=fe,ee.type=Ee}u(He,"onContextRestore");function et(Y){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Y.statusMessage)}u(et,"onContextCreationError");function Ut(Y){const me=Y.target;me.removeEventListener("dispose",Ut),re(me)}u(Ut,"onMaterialDispose");function re(Y){G(Y),$.remove(Y)}u(re,"deallocateMaterial");function G(Y){const me=$.get(Y).programs;me!==void 0&&(me.forEach(function(xe){V.releaseProgram(xe)}),Y.isShaderMaterial&&V.releaseShaderCache(Y))}u(G,"releaseMaterialProgramReferences"),this.renderBufferDirect=function(Y,me,xe,fe,Ee,it){me===null&&(me=ue);const mt=Ee.isMesh&&Ee.matrixWorld.determinant()<0,Mt=tN(Y,me,xe,fe,Ee);Me.setMaterial(fe,mt);let xt=xe.index;const qt=xe.attributes.position;if(xt===null){if(qt===void 0||qt.count===0)return}else if(xt.count===0)return;let kt=1;fe.wireframe===!0&&(xt=B.getWireframeAttribute(xe),kt=2),ve.setup(Ee,fe,Mt,xe,xt);let $t,Tn=ye;xt!==null&&($t=Z.get(xt),Tn=Ce,Tn.setIndex($t));const el=xt!==null?xt.count:qt.count,_c=xe.drawRange.start*kt,bc=xe.drawRange.count*kt,Pr=it!==null?it.start*kt:0,Kt=it!==null?it.count*kt:1/0,wc=Math.max(_c,Pr),Zn=Math.min(el,_c+bc,Pr+Kt)-1,Ui=Math.max(0,Zn-wc+1);if(Ui!==0){if(Ee.isMesh)fe.wireframe===!0?(Me.setLineWidth(fe.wireframeLinewidth*Q()),Tn.setMode(1)):Tn.setMode(4);else if(Ee.isLine){let Ko=fe.linewidth;Ko===void 0&&(Ko=1),Me.setLineWidth(Ko*Q()),Ee.isLineSegments?Tn.setMode(1):Ee.isLineLoop?Tn.setMode(2):Tn.setMode(3)}else Ee.isPoints?Tn.setMode(0):Ee.isSprite&&Tn.setMode(4);if(Ee.isInstancedMesh)Tn.renderInstances(wc,Ui,Ee.count);else if(xe.isInstancedBufferGeometry){const Ko=Math.min(xe.instanceCount,xe._maxInstanceCount);Tn.renderInstances(wc,Ui,Ko)}else Tn.render(wc,Ui)}},this.compile=function(Y,me){function xe(fe,Ee,it){fe.transparent===!0&&fe.side===Di?(fe.side=Ki,fe.needsUpdate=!0,Bi(fe,Ee,it),fe.side=ql,fe.needsUpdate=!0,Bi(fe,Ee,it),fe.side=Di):Bi(fe,Ee,it)}u(xe,"prepare"),f=L.get(Y),f.init(),g.push(f),Y.traverseVisible(function(fe){fe.isLight&&fe.layers.test(me.layers)&&(f.pushLight(fe),fe.castShadow&&f.pushShadow(fe))}),f.setupLights(m.physicallyCorrectLights),Y.traverse(function(fe){const Ee=fe.material;if(Ee)if(Array.isArray(Ee))for(let it=0;it<Ee.length;it++){const mt=Ee[it];xe(mt,Y,fe)}else xe(Ee,Y,fe)}),g.pop(),f=null};let le=null;function de(Y){le&&le(Y)}u(de,"onAnimationFrame");function ge(){st.stop()}u(ge,"onXRSessionStart");function Re(){st.start()}u(Re,"onXRSessionEnd");const st=new UP;st.setAnimationLoop(de),typeof self!="undefined"&&st.setContext(self),this.setAnimationLoop=function(Y){le=Y,Le.setAnimationLoop(Y),Y===null?st.stop():st.start()},Le.addEventListener("sessionstart",ge),Le.addEventListener("sessionend",Re),this.render=function(Y,me){if(me!==void 0&&me.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;Y.matrixWorldAutoUpdate===!0&&Y.updateMatrixWorld(),me.parent===null&&me.matrixWorldAutoUpdate===!0&&me.updateMatrixWorld(),Le.enabled===!0&&Le.isPresenting===!0&&(Le.cameraAutoUpdate===!0&&Le.updateCamera(me),me=Le.getCamera()),Y.isScene===!0&&Y.onBeforeRender(m,Y,me,_),f=L.get(Y,g.length),f.init(),g.push(f),K.multiplyMatrices(me.projectionMatrix,me.matrixWorldInverse),q.setFromProjectionMatrix(K),W=this.localClippingEnabled,ne=O.init(this.clippingPlanes,W,me),d=oe.get(Y,p.length),d.init(),p.push(d),pt(Y,me,0,m.sortObjects),d.finish(),m.sortObjects===!0&&d.sort(T,N),ne===!0&&O.beginShadows();const xe=f.state.shadowsArray;if(ee.render(xe,Y,me),ne===!0&&O.endShadows(),this.info.autoReset===!0&&this.info.reset(),ie.render(d,Y),f.setupLights(m.physicallyCorrectLights),me.isArrayCamera){const fe=me.cameras;for(let Ee=0,it=fe.length;Ee<it;Ee++){const mt=fe[Ee];Pt(d,Y,mt,mt.viewport)}}else Pt(d,Y,me);_!==null&&(X.updateMultisampleRenderTarget(_),X.updateRenderTargetMipmap(_)),Y.isScene===!0&&Y.onAfterRender(m,Y,me),ve.resetDefaultState(),w=-1,x=null,g.pop(),g.length>0?f=g[g.length-1]:f=null,p.pop(),p.length>0?d=p[p.length-1]:d=null};function pt(Y,me,xe,fe){if(Y.visible===!1)return;if(Y.layers.test(me.layers)){if(Y.isGroup)xe=Y.renderOrder;else if(Y.isLOD)Y.autoUpdate===!0&&Y.update(me);else if(Y.isLight)f.pushLight(Y),Y.castShadow&&f.pushShadow(Y);else if(Y.isSprite){if(!Y.frustumCulled||q.intersectsSprite(Y)){fe&&he.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(K);const mt=F.update(Y),Mt=Y.material;Mt.visible&&d.push(Y,mt,Mt,xe,he.z,null)}}else if((Y.isMesh||Y.isLine||Y.isPoints)&&(Y.isSkinnedMesh&&Y.skeleton.frame!==Ie.render.frame&&(Y.skeleton.update(),Y.skeleton.frame=Ie.render.frame),!Y.frustumCulled||q.intersectsObject(Y))){fe&&he.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(K);const mt=F.update(Y),Mt=Y.material;if(Array.isArray(Mt)){const xt=mt.groups;for(let qt=0,kt=xt.length;qt<kt;qt++){const $t=xt[qt],Tn=Mt[$t.materialIndex];Tn&&Tn.visible&&d.push(Y,mt,Tn,xe,he.z,$t)}}else Mt.visible&&d.push(Y,mt,Mt,xe,he.z,null)}}const it=Y.children;for(let mt=0,Mt=it.length;mt<Mt;mt++)pt(it[mt],me,xe,fe)}u(pt,"projectObject");function Pt(Y,me,xe,fe){const Ee=Y.opaque,it=Y.transmissive,mt=Y.transparent;f.setupLightsView(xe),it.length>0&&os(Ee,me,xe),fe&&Me.viewport(S.copy(fe)),Ee.length>0&&Yt(Ee,me,xe),it.length>0&&Yt(it,me,xe),mt.length>0&&Yt(mt,me,xe),Me.buffers.depth.setTest(!0),Me.buffers.depth.setMask(!0),Me.buffers.color.setMask(!0),Me.setPolygonOffset(!1)}u(Pt,"renderScene");function os(Y,me,xe){const fe=Ae.isWebGL2;se===null&&(se=new ys(1,1,{generateMipmaps:!0,type:pe.has("EXT_color_buffer_half_float")?Nu:Kl,minFilter:fc,samples:fe&&r===!0?4:0})),m.getDrawingBufferSize(U),fe?se.setSize(U.x,U.y):se.setSize(s0(U.x),s0(U.y));const Ee=m.getRenderTarget();m.setRenderTarget(se),m.clear();const it=m.toneMapping;m.toneMapping=Xr,Yt(Y,me,xe),m.toneMapping=it,X.updateMultisampleRenderTarget(se),X.updateRenderTargetMipmap(se),m.setRenderTarget(Ee)}u(os,"renderTransmissionPass");function Yt(Y,me,xe){const fe=me.isScene===!0?me.overrideMaterial:null;for(let Ee=0,it=Y.length;Ee<it;Ee++){const mt=Y[Ee],Mt=mt.object,xt=mt.geometry,qt=fe===null?mt.material:fe,kt=mt.group;Mt.layers.test(xe.layers)&&Qr(Mt,me,xe,xt,qt,kt)}}u(Yt,"renderObjects");function Qr(Y,me,xe,fe,Ee,it){Y.onBeforeRender(m,me,xe,fe,Ee,it),Y.modelViewMatrix.multiplyMatrices(xe.matrixWorldInverse,Y.matrixWorld),Y.normalMatrix.getNormalMatrix(Y.modelViewMatrix),Ee.onBeforeRender(m,me,xe,fe,Y,it),Ee.transparent===!0&&Ee.side===Di?(Ee.side=Ki,Ee.needsUpdate=!0,m.renderBufferDirect(xe,me,fe,Ee,Y,it),Ee.side=ql,Ee.needsUpdate=!0,m.renderBufferDirect(xe,me,fe,Ee,Y,it),Ee.side=Di):m.renderBufferDirect(xe,me,fe,Ee,Y,it),Y.onAfterRender(m,me,xe,fe,Ee,it)}u(Qr,"renderObject");function Bi(Y,me,xe){me.isScene!==!0&&(me=ue);const fe=$.get(Y),Ee=f.state.lights,it=f.state.shadowsArray,mt=Ee.state.version,Mt=V.getParameters(Y,Ee.state,it,me,xe),xt=V.getProgramCacheKey(Mt);let qt=fe.programs;fe.environment=Y.isMeshStandardMaterial?me.environment:null,fe.fog=me.fog,fe.envMap=(Y.isMeshStandardMaterial?J:I).get(Y.envMap||fe.environment),qt===void 0&&(Y.addEventListener("dispose",Ut),qt=new Map,fe.programs=qt);let kt=qt.get(xt);if(kt!==void 0){if(fe.currentProgram===kt&&fe.lightsStateVersion===mt)return kA(Y,Mt),kt}else Mt.uniforms=V.getUniforms(Y),Y.onBuild(xe,Mt,m),Y.onBeforeCompile(Mt,m),kt=V.acquireProgram(Mt,xt),qt.set(xt,kt),fe.uniforms=Mt.uniforms;const $t=fe.uniforms;(!Y.isShaderMaterial&&!Y.isRawShaderMaterial||Y.clipping===!0)&&($t.clippingPlanes=O.uniform),kA(Y,Mt),fe.needsLights=sN(Y),fe.lightsStateVersion=mt,fe.needsLights&&($t.ambientLightColor.value=Ee.state.ambient,$t.lightProbe.value=Ee.state.probe,$t.directionalLights.value=Ee.state.directional,$t.directionalLightShadows.value=Ee.state.directionalShadow,$t.spotLights.value=Ee.state.spot,$t.spotLightShadows.value=Ee.state.spotShadow,$t.rectAreaLights.value=Ee.state.rectArea,$t.ltc_1.value=Ee.state.rectAreaLTC1,$t.ltc_2.value=Ee.state.rectAreaLTC2,$t.pointLights.value=Ee.state.point,$t.pointLightShadows.value=Ee.state.pointShadow,$t.hemisphereLights.value=Ee.state.hemi,$t.directionalShadowMap.value=Ee.state.directionalShadowMap,$t.directionalShadowMatrix.value=Ee.state.directionalShadowMatrix,$t.spotShadowMap.value=Ee.state.spotShadowMap,$t.spotLightMatrix.value=Ee.state.spotLightMatrix,$t.spotLightMap.value=Ee.state.spotLightMap,$t.pointShadowMap.value=Ee.state.pointShadowMap,$t.pointShadowMatrix.value=Ee.state.pointShadowMatrix);const Tn=kt.getUniforms(),el=df.seqWithValue(Tn.seq,$t);return fe.currentProgram=kt,fe.uniformsList=el,kt}u(Bi,"getProgram");function kA(Y,me){const xe=$.get(Y);xe.outputEncoding=me.outputEncoding,xe.instancing=me.instancing,xe.skinning=me.skinning,xe.morphTargets=me.morphTargets,xe.morphNormals=me.morphNormals,xe.morphColors=me.morphColors,xe.morphTargetsCount=me.morphTargetsCount,xe.numClippingPlanes=me.numClippingPlanes,xe.numIntersection=me.numClipIntersection,xe.vertexAlphas=me.vertexAlphas,xe.vertexTangents=me.vertexTangents,xe.toneMapping=me.toneMapping}u(kA,"updateCommonMaterialProperties");function tN(Y,me,xe,fe,Ee){me.isScene!==!0&&(me=ue),X.resetTextureUnits();const it=me.fog,mt=fe.isMeshStandardMaterial?me.environment:null,Mt=_===null?m.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:Bo,xt=(fe.isMeshStandardMaterial?J:I).get(fe.envMap||mt),qt=fe.vertexColors===!0&&!!xe.attributes.color&&xe.attributes.color.itemSize===4,kt=!!fe.normalMap&&!!xe.attributes.tangent,$t=!!xe.morphAttributes.position,Tn=!!xe.morphAttributes.normal,el=!!xe.morphAttributes.color,_c=fe.toneMapped?m.toneMapping:Xr,bc=xe.morphAttributes.position||xe.morphAttributes.normal||xe.morphAttributes.color,Pr=bc!==void 0?bc.length:0,Kt=$.get(fe),wc=f.state.lights;if(ne===!0&&(W===!0||Y!==x)){const pi=Y===x&&fe.id===w;O.setState(fe,Y,pi)}let Zn=!1;fe.version===Kt.__version?(Kt.needsLights&&Kt.lightsStateVersion!==wc.state.version||Kt.outputEncoding!==Mt||Ee.isInstancedMesh&&Kt.instancing===!1||!Ee.isInstancedMesh&&Kt.instancing===!0||Ee.isSkinnedMesh&&Kt.skinning===!1||!Ee.isSkinnedMesh&&Kt.skinning===!0||Kt.envMap!==xt||fe.fog===!0&&Kt.fog!==it||Kt.numClippingPlanes!==void 0&&(Kt.numClippingPlanes!==O.numPlanes||Kt.numIntersection!==O.numIntersection)||Kt.vertexAlphas!==qt||Kt.vertexTangents!==kt||Kt.morphTargets!==$t||Kt.morphNormals!==Tn||Kt.morphColors!==el||Kt.toneMapping!==_c||Ae.isWebGL2===!0&&Kt.morphTargetsCount!==Pr)&&(Zn=!0):(Zn=!0,Kt.__version=fe.version);let Ui=Kt.currentProgram;Zn===!0&&(Ui=Bi(fe,me,Ee));let Ko=!1,Lh=!1,U1=!1;const $s=Ui.getUniforms(),tl=Kt.uniforms;if(Me.useProgram(Ui.program)&&(Ko=!0,Lh=!0,U1=!0),fe.id!==w&&(w=fe.id,Lh=!0),Ko||x!==Y){if($s.setValue(te,"projectionMatrix",Y.projectionMatrix),Ae.logarithmicDepthBuffer&&$s.setValue(te,"logDepthBufFC",2/(Math.log(Y.far+1)/Math.LN2)),x!==Y&&(x=Y,Lh=!0,U1=!0),fe.isShaderMaterial||fe.isMeshPhongMaterial||fe.isMeshToonMaterial||fe.isMeshStandardMaterial||fe.envMap){const pi=$s.map.cameraPosition;pi!==void 0&&pi.setValue(te,he.setFromMatrixPosition(Y.matrixWorld))}(fe.isMeshPhongMaterial||fe.isMeshToonMaterial||fe.isMeshLambertMaterial||fe.isMeshBasicMaterial||fe.isMeshStandardMaterial||fe.isShaderMaterial)&&$s.setValue(te,"isOrthographic",Y.isOrthographicCamera===!0),(fe.isMeshPhongMaterial||fe.isMeshToonMaterial||fe.isMeshLambertMaterial||fe.isMeshBasicMaterial||fe.isMeshStandardMaterial||fe.isShaderMaterial||fe.isShadowMaterial||Ee.isSkinnedMesh)&&$s.setValue(te,"viewMatrix",Y.matrixWorldInverse)}if(Ee.isSkinnedMesh){$s.setOptional(te,Ee,"bindMatrix"),$s.setOptional(te,Ee,"bindMatrixInverse");const pi=Ee.skeleton;pi&&(Ae.floatVertexTextures?(pi.boneTexture===null&&pi.computeBoneTexture(),$s.setValue(te,"boneTexture",pi.boneTexture,X),$s.setValue(te,"boneTextureSize",pi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const $1=xe.morphAttributes;if(($1.position!==void 0||$1.normal!==void 0||$1.color!==void 0&&Ae.isWebGL2===!0)&&ce.update(Ee,xe,fe,Ui),(Lh||Kt.receiveShadow!==Ee.receiveShadow)&&(Kt.receiveShadow=Ee.receiveShadow,$s.setValue(te,"receiveShadow",Ee.receiveShadow)),fe.isMeshGouraudMaterial&&fe.envMap!==null&&(tl.envMap.value=xt,tl.flipEnvMap.value=xt.isCubeTexture&&xt.isRenderTargetTexture===!1?-1:1),Lh&&($s.setValue(te,"toneMappingExposure",m.toneMappingExposure),Kt.needsLights&&nN(tl,U1),it&&fe.fog===!0&&ae.refreshFogUniforms(tl,it),ae.refreshMaterialUniforms(tl,fe,k,D,se),df.upload(te,Kt.uniformsList,tl,X)),fe.isShaderMaterial&&fe.uniformsNeedUpdate===!0&&(df.upload(te,Kt.uniformsList,tl,X),fe.uniformsNeedUpdate=!1),fe.isSpriteMaterial&&$s.setValue(te,"center",Ee.center),$s.setValue(te,"modelViewMatrix",Ee.modelViewMatrix),$s.setValue(te,"normalMatrix",Ee.normalMatrix),$s.setValue(te,"modelMatrix",Ee.matrixWorld),fe.isShaderMaterial||fe.isRawShaderMaterial){const pi=fe.uniformsGroups;for(let V1=0,iN=pi.length;V1<iN;V1++)if(Ae.isWebGL2){const NA=pi[V1];Ge.update(NA,Ui),Ge.bind(NA,Ui)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ui}u(tN,"setProgram");function nN(Y,me){Y.ambientLightColor.needsUpdate=me,Y.lightProbe.needsUpdate=me,Y.directionalLights.needsUpdate=me,Y.directionalLightShadows.needsUpdate=me,Y.pointLights.needsUpdate=me,Y.pointLightShadows.needsUpdate=me,Y.spotLights.needsUpdate=me,Y.spotLightShadows.needsUpdate=me,Y.rectAreaLights.needsUpdate=me,Y.hemisphereLights.needsUpdate=me}u(nN,"markUniformsLightsNeedsUpdate");function sN(Y){return Y.isMeshLambertMaterial||Y.isMeshToonMaterial||Y.isMeshPhongMaterial||Y.isMeshStandardMaterial||Y.isShadowMaterial||Y.isShaderMaterial&&Y.lights===!0}u(sN,"materialNeedsLights"),this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(Y,me,xe){$.get(Y.texture).__webglTexture=me,$.get(Y.depthTexture).__webglTexture=xe;const fe=$.get(Y);fe.__hasExternalTextures=!0,fe.__hasExternalTextures&&(fe.__autoAllocateDepthBuffer=xe===void 0,fe.__autoAllocateDepthBuffer||pe.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),fe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Y,me){const xe=$.get(Y);xe.__webglFramebuffer=me,xe.__useDefaultFramebuffer=me===void 0},this.setRenderTarget=function(Y,me=0,xe=0){_=Y,y=me,b=xe;let fe=!0,Ee=null,it=!1,mt=!1;if(Y){const xt=$.get(Y);xt.__useDefaultFramebuffer!==void 0?(Me.bindFramebuffer(36160,null),fe=!1):xt.__webglFramebuffer===void 0?X.setupRenderTarget(Y):xt.__hasExternalTextures&&X.rebindTextures(Y,$.get(Y.texture).__webglTexture,$.get(Y.depthTexture).__webglTexture);const qt=Y.texture;(qt.isData3DTexture||qt.isDataArrayTexture||qt.isCompressedArrayTexture)&&(mt=!0);const kt=$.get(Y).__webglFramebuffer;Y.isWebGLCubeRenderTarget?(Ee=kt[me],it=!0):Ae.isWebGL2&&Y.samples>0&&X.useMultisampledRTT(Y)===!1?Ee=$.get(Y).__webglMultisampledFramebuffer:Ee=kt,S.copy(Y.viewport),C.copy(Y.scissor),M=Y.scissorTest}else S.copy(E).multiplyScalar(k).floor(),C.copy(z).multiplyScalar(k).floor(),M=H;if(Me.bindFramebuffer(36160,Ee)&&Ae.drawBuffers&&fe&&Me.drawBuffers(Y,Ee),Me.viewport(S),Me.scissor(C),Me.setScissorTest(M),it){const xt=$.get(Y.texture);te.framebufferTexture2D(36160,36064,34069+me,xt.__webglTexture,xe)}else if(mt){const xt=$.get(Y.texture),qt=me||0;te.framebufferTextureLayer(36160,36064,xt.__webglTexture,xe||0,qt)}w=-1},this.readRenderTargetPixels=function(Y,me,xe,fe,Ee,it,mt){if(!(Y&&Y.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Mt=$.get(Y).__webglFramebuffer;if(Y.isWebGLCubeRenderTarget&&mt!==void 0&&(Mt=Mt[mt]),Mt){Me.bindFramebuffer(36160,Mt);try{const xt=Y.texture,qt=xt.format,kt=xt.type;if(qt!==Ii&&Te.convert(qt)!==te.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const $t=kt===Nu&&(pe.has("EXT_color_buffer_half_float")||Ae.isWebGL2&&pe.has("EXT_color_buffer_float"));if(kt!==Kl&&Te.convert(kt)!==te.getParameter(35738)&&!(kt===Ra&&(Ae.isWebGL2||pe.has("OES_texture_float")||pe.has("WEBGL_color_buffer_float")))&&!$t){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}me>=0&&me<=Y.width-fe&&xe>=0&&xe<=Y.height-Ee&&te.readPixels(me,xe,fe,Ee,Te.convert(qt),Te.convert(kt),it)}finally{const xt=_!==null?$.get(_).__webglFramebuffer:null;Me.bindFramebuffer(36160,xt)}}},this.copyFramebufferToTexture=function(Y,me,xe=0){const fe=Math.pow(2,-xe),Ee=Math.floor(me.image.width*fe),it=Math.floor(me.image.height*fe);X.setTexture2D(me,0),te.copyTexSubImage2D(3553,xe,0,0,Y.x,Y.y,Ee,it),Me.unbindTexture()},this.copyTextureToTexture=function(Y,me,xe,fe=0){const Ee=me.image.width,it=me.image.height,mt=Te.convert(xe.format),Mt=Te.convert(xe.type);X.setTexture2D(xe,0),te.pixelStorei(37440,xe.flipY),te.pixelStorei(37441,xe.premultiplyAlpha),te.pixelStorei(3317,xe.unpackAlignment),me.isDataTexture?te.texSubImage2D(3553,fe,Y.x,Y.y,Ee,it,mt,Mt,me.image.data):me.isCompressedTexture?te.compressedTexSubImage2D(3553,fe,Y.x,Y.y,me.mipmaps[0].width,me.mipmaps[0].height,mt,me.mipmaps[0].data):te.texSubImage2D(3553,fe,Y.x,Y.y,mt,Mt,me.image),fe===0&&xe.generateMipmaps&&te.generateMipmap(3553),Me.unbindTexture()},this.copyTextureToTexture3D=function(Y,me,xe,fe,Ee=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const it=Y.max.x-Y.min.x+1,mt=Y.max.y-Y.min.y+1,Mt=Y.max.z-Y.min.z+1,xt=Te.convert(fe.format),qt=Te.convert(fe.type);let kt;if(fe.isData3DTexture)X.setTexture3D(fe,0),kt=32879;else if(fe.isDataArrayTexture)X.setTexture2DArray(fe,0),kt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}te.pixelStorei(37440,fe.flipY),te.pixelStorei(37441,fe.premultiplyAlpha),te.pixelStorei(3317,fe.unpackAlignment);const $t=te.getParameter(3314),Tn=te.getParameter(32878),el=te.getParameter(3316),_c=te.getParameter(3315),bc=te.getParameter(32877),Pr=xe.isCompressedTexture?xe.mipmaps[0]:xe.image;te.pixelStorei(3314,Pr.width),te.pixelStorei(32878,Pr.height),te.pixelStorei(3316,Y.min.x),te.pixelStorei(3315,Y.min.y),te.pixelStorei(32877,Y.min.z),xe.isDataTexture||xe.isData3DTexture?te.texSubImage3D(kt,Ee,me.x,me.y,me.z,it,mt,Mt,xt,qt,Pr.data):xe.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),te.compressedTexSubImage3D(kt,Ee,me.x,me.y,me.z,it,mt,Mt,xt,Pr.data)):te.texSubImage3D(kt,Ee,me.x,me.y,me.z,it,mt,Mt,xt,qt,Pr),te.pixelStorei(3314,$t),te.pixelStorei(32878,Tn),te.pixelStorei(3316,el),te.pixelStorei(3315,_c),te.pixelStorei(32877,bc),Ee===0&&fe.generateMipmaps&&te.generateMipmap(kt),Me.unbindTexture()},this.initTexture=function(Y){Y.isCubeTexture?X.setTextureCube(Y,0):Y.isData3DTexture?X.setTexture3D(Y,0):Y.isDataArrayTexture||Y.isCompressedArrayTexture?X.setTexture2DArray(Y,0):X.setTexture2D(Y,0),Me.unbindTexture()},this.resetState=function(){y=0,b=0,_=null,Me.reset(),ve.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}u(JP,"WebGLRenderer");class eR extends JP{}u(eR,"WebGL1Renderer");eR.prototype.isWebGL1Renderer=!0;class If extends Lt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.backgroundBlurriness=this.backgroundBlurriness),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}u(If,"Scene");class tR{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=P_,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=_r()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,s){e*=this.stride,s*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[s+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_r()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(t,this.stride);return s.setUsage(this.usage),s}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=_r()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}u(tR,"InterleavedBuffer");const Vs=new P;class X0{constructor(e,t,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=s,this.normalized=i===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,s=this.data.count;t<s;t++)Vs.fromBufferAttribute(this,t),Vs.applyMatrix4(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}applyNormalMatrix(e){for(let t=0,s=this.count;t<s;t++)Vs.fromBufferAttribute(this,t),Vs.applyNormalMatrix(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}transformDirection(e){for(let t=0,s=this.count;t<s;t++)Vs.fromBufferAttribute(this,t),Vs.transformDirection(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Io(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Io(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Io(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Io(t,this.array)),t}setXY(e,t,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),s=cn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this}setXYZ(e,t,s,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),s=cn(s,this.array),i=cn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=i,this}setXYZW(e,t,s,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),s=cn(s,this.array),i=cn(i,this.array),r=cn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=s,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return new An(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new X0(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}u(X0,"InterleavedBufferAttribute");const B2=new P,U2=new Ft,$2=new Ft,L8=new P,V2=new be;class $b extends Ye{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new be,this.bindMatrixInverse=new be}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ft,t=this.geometry.attributes.skinWeight;for(let s=0,i=t.count;s<i;s++){e.fromBufferAttribute(t,s);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(s,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const s=this.skeleton,i=this.geometry;U2.fromBufferAttribute(i.attributes.skinIndex,e),$2.fromBufferAttribute(i.attributes.skinWeight,e),B2.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=$2.getComponent(r);if(o!==0){const a=U2.getComponent(r);V2.multiplyMatrices(s.bones[a].matrixWorld,s.boneInverses[a]),t.addScaledVector(L8.copy(B2).applyMatrix4(V2),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}u($b,"SkinnedMesh");class Df extends Lt{constructor(){super(),this.isBone=!0,this.type="Bone"}}u(Df,"Bone");class nR extends is{constructor(e=null,t=1,s=1,i,r,o,a,l,c=Wn,h=Wn,d,f){super(null,o,a,l,c,h,i,r,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}u(nR,"DataTexture");const G2=new be,O8=new be;class tp{constructor(e=[],t=[]){this.uuid=_r(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let s=0,i=this.bones.length;s<i;s++)this.boneInverses.push(new be)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const s=new be;this.bones[e]&&s.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(s)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const s=this.bones[e];s&&s.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const s=this.bones[e];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(){const e=this.bones,t=this.boneInverses,s=this.boneMatrices,i=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:O8;G2.multiplyMatrices(a,t[r]),G2.toArray(s,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new tp(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=OP(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const s=new nR(t,e,e,Ii,Ra);return s.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=s,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,s=this.bones.length;t<s;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let s=0,i=e.bones.length;s<i;s++){const r=e.bones[s];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Df),this.bones.push(o),this.boneInverses.push(new be().fromArray(e.boneInverses[s]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,s=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const o=t[i];e.bones.push(o.uuid);const a=s[i];e.boneInverses.push(a.toArray())}return e}}u(tp,"Skeleton");class O_ extends An{constructor(e,t,s,i=1){super(e,t,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}u(O_,"InstancedBufferAttribute");const H2=new be,W2=new be,qp=[],k8=new be,$h=new Ye;class sR extends Ye{constructor(e,t,s){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new O_(new Float32Array(s*16),16),this.instanceColor=null,this.count=s,this.frustumCulled=!1;for(let i=0;i<s;i++)this.setMatrixAt(i,k8)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const s=this.matrixWorld,i=this.count;if($h.geometry=this.geometry,$h.material=this.material,$h.material!==void 0)for(let r=0;r<i;r++){this.getMatrixAt(r,H2),W2.multiplyMatrices(s,H2),$h.matrixWorld=W2,$h.raycast(e,qp);for(let o=0,a=qp.length;o<a;o++){const l=qp[o];l.instanceId=r,l.object=this,t.push(l)}qp.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new O_(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}u(sR,"InstancedMesh");class Bs extends zs{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new De(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}u(Bs,"LineBasicMaterial");const j2=new P,X2=new P,Y2=new be,Pv=new Xa,Kp=new ja;class Zi extends Lt{constructor(e=new at,t=new Bs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,s=[0];for(let i=1,r=t.count;i<r;i++)j2.fromBufferAttribute(t,i-1),X2.fromBufferAttribute(t,i),s[i]=s[i-1],s[i]+=j2.distanceTo(X2);e.setAttribute("lineDistance",new We(s,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const s=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,o=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),Kp.copy(s.boundingSphere),Kp.applyMatrix4(i),Kp.radius+=r,e.ray.intersectsSphere(Kp)===!1)return;Y2.copy(i).invert(),Pv.copy(e.ray).applyMatrix4(Y2);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new P,h=new P,d=new P,f=new P,p=this.isLineSegments?2:1,g=s.index,v=s.attributes.position;if(g!==null){const y=Math.max(0,o.start),b=Math.min(g.count,o.start+o.count);for(let _=y,w=b-1;_<w;_+=p){const x=g.getX(_),S=g.getX(_+1);if(c.fromBufferAttribute(v,x),h.fromBufferAttribute(v,S),Pv.distanceSqToSegment(c,h,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(f);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let _=y,w=b-1;_<w;_+=p){if(c.fromBufferAttribute(v,_),h.fromBufferAttribute(v,_+1),Pv.distanceSqToSegment(c,h,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const S=e.ray.origin.distanceTo(f);S<e.near||S>e.far||t.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,s=Object.keys(t);if(s.length>0){const i=t[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}u(Zi,"Line");const q2=new P,K2=new P;class Ar extends Zi{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,s=[];for(let i=0,r=t.count;i<r;i+=2)q2.fromBufferAttribute(t,i),K2.fromBufferAttribute(t,i+1),s[i]=i===0?0:s[i-1],s[i+1]=s[i]+q2.distanceTo(K2);e.setAttribute("lineDistance",new We(s,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}u(Ar,"LineSegments");class iR extends Zi{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}u(iR,"LineLoop");class Hr extends zs{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new De(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}u(Hr,"PointsMaterial");const Z2=new be,k_=new Xa,Zp=new ja,Qp=new P;class Oa extends Lt{constructor(e=new at,t=new Hr){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const s=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,o=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),Zp.copy(s.boundingSphere),Zp.applyMatrix4(i),Zp.radius+=r,e.ray.intersectsSphere(Zp)===!1)return;Z2.copy(i).invert(),k_.copy(e.ray).applyMatrix4(Z2);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=s.index,d=s.attributes.position;if(c!==null){const f=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let g=f,m=p;g<m;g++){const v=c.getX(g);Qp.fromBufferAttribute(d,v),Q2(Qp,v,l,i,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let g=f,m=p;g<m;g++)Qp.fromBufferAttribute(d,g),Q2(Qp,g,l,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,s=Object.keys(t);if(s.length>0){const i=t[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}u(Oa,"Points");function Q2(n,e,t,s,i,r,o){const a=k_.distanceSqToPoint(n);if(a<t){const l=new P;k_.closestPointToPoint(n,l),l.applyMatrix4(s);const c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}u(Q2,"testPoint");class rR extends is{constructor(e,t,s,i,r,o,a,l,c){super(e,t,s,i,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}u(rR,"CanvasTexture");class Vb{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const s=this.getUtoTmapping(e);return this.getPoint(s,t)}getPoints(e=5){const t=[];for(let s=0;s<=e;s++)t.push(this.getPoint(s/e));return t}getSpacedPoints(e=5){const t=[];for(let s=0;s<=e;s++)t.push(this.getPointAt(s/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let s,i=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)s=this.getPoint(o/e),r+=s.distanceTo(i),t.push(r),i=s;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const s=this.getLengths();let i=0;const r=s.length;let o;t?o=t:o=e*s[r-1];let a=0,l=r-1,c;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),c=s[i]-o,c<0)a=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,s[i]===o)return i/(r-1);const h=s[i],f=s[i+1]-h,p=(o-h)/f;return(i+p)/(r-1)}getTangent(e,t){let i=e-1e-4,r=e+1e-4;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),a=this.getPoint(r),l=t||(o.isVector2?new $e:new P);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const s=this.getUtoTmapping(e);return this.getTangent(s,t)}computeFrenetFrames(e,t){const s=new P,i=[],r=[],o=[],a=new P,l=new be;for(let p=0;p<=e;p++){const g=p/e;i[p]=this.getTangentAt(g,new P)}r[0]=new P,o[0]=new P;let c=Number.MAX_VALUE;const h=Math.abs(i[0].x),d=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=c&&(c=h,s.set(1,0,0)),d<=c&&(c=d,s.set(0,1,0)),f<=c&&s.set(0,0,1),a.crossVectors(i[0],s).normalize(),r[0].crossVectors(i[0],a),o[0].crossVectors(i[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(i[p-1],i[p]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(Ss(i[p-1].dot(i[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,g))}o[p].crossVectors(i[p],r[p])}if(t===!0){let p=Math.acos(Ss(r[0].dot(r[e]),-1,1));p/=e,i[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let g=1;g<=e;g++)r[g].applyMatrix4(l.makeRotationAxis(i[g],p*g)),o[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}u(Vb,"Curve");class $u extends at{constructor(e=1,t=8,s=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:s,thetaLength:i},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new P,h=new $e;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const p=s+d/t*i;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),a.push(0,0,1),h.x=(o[f]/e+1)/2,h.y=(o[f+1]/e+1)/2,l.push(h.x,h.y)}for(let d=1;d<=t;d++)r.push(d,d+1,0);this.setIndex(r),this.setAttribute("position",new We(o,3)),this.setAttribute("normal",new We(a,3)),this.setAttribute("uv",new We(l,2))}static fromJSON(e){return new $u(e.radius,e.segments,e.thetaStart,e.thetaLength)}}u($u,"CircleGeometry");class Vu extends at{constructor(e=1,t=1,s=1,i=8,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:s,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;i=Math.floor(i),r=Math.floor(r);const h=[],d=[],f=[],p=[];let g=0;const m=[],v=s/2;let y=0;b(),o===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new We(d,3)),this.setAttribute("normal",new We(f,3)),this.setAttribute("uv",new We(p,2));function b(){const w=new P,x=new P;let S=0;const C=(t-e)/s;for(let M=0;M<=r;M++){const R=[],D=M/r,k=D*(t-e)+e;for(let T=0;T<=i;T++){const N=T/i,E=N*l+a,z=Math.sin(E),H=Math.cos(E);x.x=k*z,x.y=-D*s+v,x.z=k*H,d.push(x.x,x.y,x.z),w.set(z,C,H).normalize(),f.push(w.x,w.y,w.z),p.push(N,1-D),R.push(g++)}m.push(R)}for(let M=0;M<i;M++)for(let R=0;R<r;R++){const D=m[R][M],k=m[R+1][M],T=m[R+1][M+1],N=m[R][M+1];h.push(D,k,N),h.push(k,T,N),S+=6}c.addGroup(y,S,0),y+=S}u(b,"generateTorso");function _(w){const x=g,S=new $e,C=new P;let M=0;const R=w===!0?e:t,D=w===!0?1:-1;for(let T=1;T<=i;T++)d.push(0,v*D,0),f.push(0,D,0),p.push(.5,.5),g++;const k=g;for(let T=0;T<=i;T++){const E=T/i*l+a,z=Math.cos(E),H=Math.sin(E);C.x=R*H,C.y=v*D,C.z=R*z,d.push(C.x,C.y,C.z),f.push(0,D,0),S.x=z*.5+.5,S.y=H*.5*D+.5,p.push(S.x,S.y),g++}for(let T=0;T<i;T++){const N=x+T,E=k+T;w===!0?h.push(E,E+1,N):h.push(E+1,E,N),M+=3}c.addGroup(y,M,w===!0?1:2),y+=M}u(_,"generateCap")}static fromJSON(e){return new Vu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}u(Vu,"CylinderGeometry");class Y0 extends Vu{constructor(e=1,t=1,s=8,i=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,s,i,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:s,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Y0(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}u(Y0,"ConeGeometry");class q0 extends at{constructor(e=[],t=[],s=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:s,detail:i};const r=[],o=[];a(i),c(s),h(),this.setAttribute("position",new We(r,3)),this.setAttribute("normal",new We(r.slice(),3)),this.setAttribute("uv",new We(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const _=new P,w=new P,x=new P;for(let S=0;S<t.length;S+=3)p(t[S+0],_),p(t[S+1],w),p(t[S+2],x),l(_,w,x,b)}u(a,"subdivide");function l(b,_,w,x){const S=x+1,C=[];for(let M=0;M<=S;M++){C[M]=[];const R=b.clone().lerp(w,M/S),D=_.clone().lerp(w,M/S),k=S-M;for(let T=0;T<=k;T++)T===0&&M===S?C[M][T]=R:C[M][T]=R.clone().lerp(D,T/k)}for(let M=0;M<S;M++)for(let R=0;R<2*(S-M)-1;R++){const D=Math.floor(R/2);R%2===0?(f(C[M][D+1]),f(C[M+1][D]),f(C[M][D])):(f(C[M][D+1]),f(C[M+1][D+1]),f(C[M+1][D]))}}u(l,"subdivideFace");function c(b){const _=new P;for(let w=0;w<r.length;w+=3)_.x=r[w+0],_.y=r[w+1],_.z=r[w+2],_.normalize().multiplyScalar(b),r[w+0]=_.x,r[w+1]=_.y,r[w+2]=_.z}u(c,"applyRadius");function h(){const b=new P;for(let _=0;_<r.length;_+=3){b.x=r[_+0],b.y=r[_+1],b.z=r[_+2];const w=v(b)/2/Math.PI+.5,x=y(b)/Math.PI+.5;o.push(w,1-x)}g(),d()}u(h,"generateUVs");function d(){for(let b=0;b<o.length;b+=6){const _=o[b+0],w=o[b+2],x=o[b+4],S=Math.max(_,w,x),C=Math.min(_,w,x);S>.9&&C<.1&&(_<.2&&(o[b+0]+=1),w<.2&&(o[b+2]+=1),x<.2&&(o[b+4]+=1))}}u(d,"correctSeam");function f(b){r.push(b.x,b.y,b.z)}u(f,"pushVertex");function p(b,_){const w=b*3;_.x=e[w+0],_.y=e[w+1],_.z=e[w+2]}u(p,"getVertexByIndex");function g(){const b=new P,_=new P,w=new P,x=new P,S=new $e,C=new $e,M=new $e;for(let R=0,D=0;R<r.length;R+=9,D+=6){b.set(r[R+0],r[R+1],r[R+2]),_.set(r[R+3],r[R+4],r[R+5]),w.set(r[R+6],r[R+7],r[R+8]),S.set(o[D+0],o[D+1]),C.set(o[D+2],o[D+3]),M.set(o[D+4],o[D+5]),x.copy(b).add(_).add(w).divideScalar(3);const k=v(x);m(S,D+0,b,k),m(C,D+2,_,k),m(M,D+4,w,k)}}u(g,"correctUVs");function m(b,_,w,x){x<0&&b.x===1&&(o[_]=b.x-1),w.x===0&&w.z===0&&(o[_]=x/2/Math.PI+.5)}u(m,"correctUV");function v(b){return Math.atan2(b.z,-b.x)}u(v,"azimuth");function y(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}u(y,"inclination")}static fromJSON(e){return new q0(e.vertices,e.indices,e.radius,e.details)}}u(q0,"PolyhedronGeometry");class K0 extends q0{constructor(e=1,t=0){const s=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(s,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new K0(e.radius,e.detail)}}u(K0,"OctahedronGeometry");class Z0 extends at{constructor(e=1,t=32,s=16,i=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:s,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),s=Math.max(2,Math.floor(s));const l=Math.min(o+a,Math.PI);let c=0;const h=[],d=new P,f=new P,p=[],g=[],m=[],v=[];for(let y=0;y<=s;y++){const b=[],_=y/s;let w=0;y==0&&o==0?w=.5/t:y==s&&l==Math.PI&&(w=-.5/t);for(let x=0;x<=t;x++){const S=x/t;d.x=-e*Math.cos(i+S*r)*Math.sin(o+_*a),d.y=e*Math.cos(o+_*a),d.z=e*Math.sin(i+S*r)*Math.sin(o+_*a),g.push(d.x,d.y,d.z),f.copy(d).normalize(),m.push(f.x,f.y,f.z),v.push(S+w,1-_),b.push(c++)}h.push(b)}for(let y=0;y<s;y++)for(let b=0;b<t;b++){const _=h[y][b+1],w=h[y][b],x=h[y+1][b],S=h[y+1][b+1];(y!==0||o>0)&&p.push(_,w,S),(y!==s-1||l<Math.PI)&&p.push(w,x,S)}this.setIndex(p),this.setAttribute("position",new We(g,3)),this.setAttribute("normal",new We(m,3)),this.setAttribute("uv",new We(v,2))}static fromJSON(e){return new Z0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}u(Z0,"SphereGeometry$2");class Ta extends at{constructor(e=1,t=.4,s=8,i=6,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:s,tubularSegments:i,arc:r},s=Math.floor(s),i=Math.floor(i);const o=[],a=[],l=[],c=[],h=new P,d=new P,f=new P;for(let p=0;p<=s;p++)for(let g=0;g<=i;g++){const m=g/i*r,v=p/s*Math.PI*2;d.x=(e+t*Math.cos(v))*Math.cos(m),d.y=(e+t*Math.cos(v))*Math.sin(m),d.z=t*Math.sin(v),a.push(d.x,d.y,d.z),h.x=e*Math.cos(m),h.y=e*Math.sin(m),f.subVectors(d,h).normalize(),l.push(f.x,f.y,f.z),c.push(g/i),c.push(p/s)}for(let p=1;p<=s;p++)for(let g=1;g<=i;g++){const m=(i+1)*p+g-1,v=(i+1)*(p-1)+g-1,y=(i+1)*(p-1)+g,b=(i+1)*p+g;o.push(m,v,b),o.push(v,y,b)}this.setIndex(o),this.setAttribute("position",new We(a,3)),this.setAttribute("normal",new We(l,3)),this.setAttribute("uv",new We(c,2))}static fromJSON(e){return new Ta(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}u(Ta,"TorusGeometry");class nr extends zs{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new De(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(nr,"MeshStandardMaterial");class qa extends nr{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new $e(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ss(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new De(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new De(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new De(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}u(qa,"MeshPhysicalMaterial");class ff extends zs{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new De(16777215),this.specular=new De(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=B0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(ff,"MeshPhongMaterial");class oR extends zs{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}u(oR,"MeshNormalMaterial");class Gb extends zs{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new De(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new De(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=mh,this.normalScale=new $e(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=B0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}u(Gb,"MeshLambertMaterial");function oa(n,e,t){return aR(n)?new n.constructor(n.subarray(e,t!==void 0?t:n.length)):n.slice(e,t)}u(oa,"arraySlice");function Jp(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}u(Jp,"convertArray");function aR(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}u(aR,"isTypedArray");function N8(n){function e(i,r){return n[i]-n[r]}u(e,"compareTime");const t=n.length,s=new Array(t);for(let i=0;i!==t;++i)s[i]=i;return s.sort(e),s}u(N8,"getKeyframeOrder");function J2(n,e,t){const s=n.length,i=new n.constructor(s);for(let r=0,o=0;o!==s;++r){const a=t[r]*e;for(let l=0;l!==e;++l)i[o++]=n[a+l]}return i}u(J2,"sortedArray");function lR(n,e,t,s){let i=1,r=n[0];for(;r!==void 0&&r[s]===void 0;)r=n[i++];if(r===void 0)return;let o=r[s];if(o!==void 0)if(Array.isArray(o))do o=r[s],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=n[i++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[s],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=n[i++];while(r!==void 0);else do o=r[s],o!==void 0&&(e.push(r.time),t.push(o)),r=n[i++];while(r!==void 0)}u(lR,"flattenJSON");class vh{constructor(e,t,s,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(s),this.sampleValues=t,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let s=this._cachedIndex,i=t[s],r=t[s-1];e:{t:{let o;n:{s:if(!(e<i)){for(let a=s+2;;){if(i===void 0){if(e<r)break s;return s=t.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===a)break;if(r=i,i=t[++s],e<i)break t}o=t.length;break n}if(!(e>=r)){const a=t[1];e<a&&(s=2,r=a);for(let l=s-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===l)break;if(i=r,r=t[--s-1],e>=r)break t}o=s,s=0;break n}break e}for(;s<o;){const a=s+o>>>1;e<t[a]?o=a:s=a+1}if(i=t[s],r=t[s-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return s=t.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,r,i)}return this.interpolate_(s,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,r=e*i;for(let o=0;o!==i;++o)t[o]=s[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}u(vh,"Interpolant");class cR extends vh{constructor(e,t,s,i){super(e,t,s,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:s2,endingEnd:s2}}intervalChanged_(e,t,s){const i=this.parameterPositions;let r=e-2,o=e+1,a=i[r],l=i[o];if(a===void 0)switch(this.getSettings_().endingStart){case i2:r=e,a=2*t-s;break;case r2:r=i.length-2,a=t+i[r]-i[r+1];break;default:r=e,a=s}if(l===void 0)switch(this.getSettings_().endingEnd){case i2:o=e,l=2*s-t;break;case r2:o=1,l=s+i[1]-i[0];break;default:o=e-1,l=t}const c=(s-t)*.5,h=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-s),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(e,t,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,g=(s-t)/(i-t),m=g*g,v=m*g,y=-f*v+2*f*m-f*g,b=(1+f)*v+(-1.5-2*f)*m+(-.5+f)*g+1,_=(-1-p)*v+(1.5+p)*m+.5*g,w=p*v-p*m;for(let x=0;x!==a;++x)r[x]=y*o[h+x]+b*o[c+x]+_*o[l+x]+w*o[d+x];return r}}u(cR,"CubicInterpolant");class uR extends vh{constructor(e,t,s,i){super(e,t,s,i)}interpolate_(e,t,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,h=(s-t)/(i-t),d=1-h;for(let f=0;f!==a;++f)r[f]=o[c+f]*d+o[l+f]*h;return r}}u(uR,"LinearInterpolant");class hR extends vh{constructor(e,t,s,i){super(e,t,s,i)}interpolate_(e){return this.copySampleValue_(e-1)}}u(hR,"DiscreteInterpolant");class Cr{constructor(e,t,s,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Jp(t,this.TimeBufferType),this.values=Jp(s,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let s;if(t.toJSON!==this.toJSON)s=t.toJSON(e);else{s={name:e.name,times:Jp(e.times,Array),values:Jp(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(s.interpolation=i)}return s.type=e.ValueTypeName,s}InterpolantFactoryMethodDiscrete(e){return new hR(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uR(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new cR(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case zu:t=this.InterpolantFactoryMethodDiscrete;break;case Zl:t=this.InterpolantFactoryMethodLinear;break;case sv:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const s="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(s);return console.warn("THREE.KeyframeTrack:",s),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return zu;case this.InterpolantFactoryMethodLinear:return Zl;case this.InterpolantFactoryMethodSmooth:return sv}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let s=0,i=t.length;s!==i;++s)t[s]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let s=0,i=t.length;s!==i;++s)t[s]*=e}return this}trim(e,t){const s=this.times,i=s.length;let r=0,o=i-1;for(;r!==i&&s[r]<e;)++r;for(;o!==-1&&s[o]>t;)--o;if(++o,r!==0||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=oa(s,r,o),this.values=oa(this.values,r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const s=this.times,i=this.values,r=s.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=s[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(i!==void 0&&aR(i))for(let a=0,l=i.length;a!==l;++a){const c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=oa(this.times),t=oa(this.values),s=this.getValueSize(),i=this.getInterpolation()===sv,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],h=e[a+1];if(c!==h&&(a!==1||c!==e[0]))if(i)l=!0;else{const d=a*s,f=d-s,p=d+s;for(let g=0;g!==s;++g){const m=t[d+g];if(m!==t[f+g]||m!==t[p+g]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*s,f=o*s;for(let p=0;p!==s;++p)t[f+p]=t[d+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*s,l=o*s,c=0;c!==s;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=oa(e,0,o),this.values=oa(t,0,o*s)):(this.times=e,this.values=t),this}clone(){const e=oa(this.times,0),t=oa(this.values,0),s=this.constructor,i=new s(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}u(Cr,"KeyframeTrack");Cr.prototype.TimeBufferType=Float32Array;Cr.prototype.ValueBufferType=Float32Array;Cr.prototype.DefaultInterpolation=Zl;class mc extends Cr{}u(mc,"BooleanKeyframeTrack");mc.prototype.ValueTypeName="bool";mc.prototype.ValueBufferType=Array;mc.prototype.DefaultInterpolation=zu;mc.prototype.InterpolantFactoryMethodLinear=void 0;mc.prototype.InterpolantFactoryMethodSmooth=void 0;class Hb extends Cr{}u(Hb,"ColorKeyframeTrack");Hb.prototype.ValueTypeName="color";class Ql extends Cr{}u(Ql,"NumberKeyframeTrack");Ql.prototype.ValueTypeName="number";class dR extends vh{constructor(e,t,s,i){super(e,t,s,i)}interpolate_(e,t,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(s-t)/(i-t);let c=e*a;for(let h=c+a;c!==h;c+=4)qe.slerpFlat(r,0,o,c-a,o,c,l);return r}}u(dR,"QuaternionLinearInterpolant");class Uo extends Cr{InterpolantFactoryMethodLinear(e){return new dR(this.times,this.values,this.getValueSize(),e)}}u(Uo,"QuaternionKeyframeTrack");Uo.prototype.ValueTypeName="quaternion";Uo.prototype.DefaultInterpolation=Zl;Uo.prototype.InterpolantFactoryMethodSmooth=void 0;class gc extends Cr{}u(gc,"StringKeyframeTrack");gc.prototype.ValueTypeName="string";gc.prototype.ValueBufferType=Array;gc.prototype.DefaultInterpolation=zu;gc.prototype.InterpolantFactoryMethodLinear=void 0;gc.prototype.InterpolantFactoryMethodSmooth=void 0;class Jl extends Cr{}u(Jl,"VectorKeyframeTrack");Jl.prototype.ValueTypeName="vector";class Wb{constructor(e,t=-1,s,i=Iz){this.name=e,this.tracks=s,this.duration=t,this.blendMode=i,this.uuid=_r(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],s=e.tracks,i=1/(e.fps||1);for(let o=0,a=s.length;o!==a;++o)t.push(z8(s[o]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],s=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=s.length;r!==o;++r)t.push(Cr.toJSON(s[r]));return i}static CreateFromMorphTargetSequence(e,t,s,i){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=N8(l);l=J2(l,1,h),c=J2(c,1,h),!i&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new Ql(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/s))}return new this(e,-1,o)}static findByName(e,t){let s=e;if(!Array.isArray(e)){const i=e;s=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<s.length;i++)if(s[i].name===t)return s[i];return null}static CreateClipsFromMorphTargetSequences(e,t,s){const i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],h=c.name.match(r);if(h&&h.length>1){const d=h[1];let f=i[d];f||(i[d]=f=[]),f.push(c)}}const o=[];for(const a in i)o.push(this.CreateFromMorphTargetSequence(a,i[a],t,s));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const s=u(function(d,f,p,g,m){if(p.length!==0){const v=[],y=[];lR(p,v,y,g),v.length!==0&&m.push(new d(f,v,y))}},"addNonemptyTrack"),i=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const f=c[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let g;for(g=0;g<f.length;g++)if(f[g].morphTargets)for(let m=0;m<f[g].morphTargets.length;m++)p[f[g].morphTargets[m]]=-1;for(const m in p){const v=[],y=[];for(let b=0;b!==f[g].morphTargets.length;++b){const _=f[g];v.push(_.time),y.push(_.morphTarget===m?1:0)}i.push(new Ql(".morphTargetInfluence["+m+"]",v,y))}l=p.length*o}else{const p=".bones["+t[d].name+"]";s(Jl,p+".position",f,"pos",i),s(Uo,p+".quaternion",f,"rot",i),s(Jl,p+".scale",f,"scl",i)}}return i.length===0?null:new this(r,l,i,a)}resetDuration(){const e=this.tracks;let t=0;for(let s=0,i=e.length;s!==i;++s){const r=this.tracks[s];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}u(Wb,"AnimationClip");function F8(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ql;case"vector":case"vector2":case"vector3":case"vector4":return Jl;case"color":return Hb;case"quaternion":return Uo;case"bool":case"boolean":return mc;case"string":return gc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}u(F8,"getTrackTypeForValueTypeName");function z8(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=F8(n.type);if(n.times===void 0){const t=[],s=[];lR(n.keys,t,s,"value"),n.times=t,n.values=s}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}u(z8,"parseKeyframeTrack");const Gu={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class jb{constructor(e,t,s){const i=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=s,this.itemStart=function(h){a++,r===!1&&i.onStart!==void 0&&i.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,i.onProgress!==void 0&&i.onProgress(h,o,a),o===a&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,d){return c.push(h,d),this},this.removeHandler=function(h){const d=c.indexOf(h);return d!==-1&&c.splice(d,2),this},this.getHandler=function(h){for(let d=0,f=c.length;d<f;d+=2){const p=c[d],g=c[d+1];if(p.global&&(p.lastIndex=0),p.test(h))return g}return null}}}u(jb,"LoadingManager");const B8=new jb;class Ka{constructor(e){this.manager=e!==void 0?e:B8,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const s=this;return new Promise(function(i,r){s.load(e,i,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}u(Ka,"Loader");const ro={};class fR extends Error{constructor(e,t){super(e),this.response=t}}u(fR,"HttpError");class np extends Ka{constructor(e){super(e)}load(e,t,s,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Gu.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(ro[e]!==void 0){ro[e].push({onLoad:t,onProgress:s,onError:i});return}ro[e]=[],ro[e].push({onLoad:t,onProgress:s,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||c.body===void 0||c.body.getReader===void 0)return c;const h=ro[e],d=c.body.getReader(),f=c.headers.get("Content-Length"),p=f?parseInt(f):0,g=p!==0;let m=0;const v=new ReadableStream({start(y){b();function b(){d.read().then(({done:_,value:w})=>{if(_)y.close();else{m+=w.byteLength;const x=new ProgressEvent("progress",{lengthComputable:g,loaded:m,total:p});for(let S=0,C=h.length;S<C;S++){const M=h[S];M.onProgress&&M.onProgress(x)}y.enqueue(w),b()}})}u(b,"readData")}});return new Response(v)}else throw new fR(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{Gu.add(e,c);const h=ro[e];delete ro[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=ro[e];if(h===void 0)throw this.manager.itemError(e),c;delete ro[e];for(let d=0,f=h.length;d<f;d++){const p=h[d];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}u(np,"FileLoader");class pR extends Ka{constructor(e){super(e)}load(e,t,s,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Gu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=Rf("img");function l(){h(),Gu.add(e,this),t&&t(this),r.manager.itemEnd(e)}u(l,"onImageLoad");function c(d){h(),i&&i(d),r.manager.itemError(e),r.manager.itemEnd(e)}u(c,"onImageError");function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return u(h,"removeEventListeners"),a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}u(pR,"ImageLoader");class sp extends Ka{constructor(e){super(e)}load(e,t,s,i){const r=new is,o=new pR(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},s,i),r}}u(sp,"TextureLoader");class yh extends Lt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new De(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}u(yh,"Light");class mR extends yh{constructor(e,t,s){super(e,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Lt.DefaultUp),this.updateMatrix(),this.groundColor=new De(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}u(mR,"HemisphereLight");const Rv=new be,eS=new P,tS=new P;class Q0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $e(512,512),this.map=null,this.mapPass=null,this.matrix=new be,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ep,this._frameExtents=new $e(1,1),this._viewportCount=1,this._viewports=[new Ft(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,s=this.matrix;eS.setFromMatrixPosition(e.matrixWorld),t.position.copy(eS),tS.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(tS),t.updateMatrixWorld(),Rv.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Rv),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(Rv)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}u(Q0,"LightShadow");class gR extends Q0{constructor(){super(new _s(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,s=Pf*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(s!==t.fov||i!==t.aspect||r!==t.far)&&(t.fov=s,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}u(gR,"SpotLightShadow");class J0 extends yh{constructor(e,t,s=0,i=Math.PI/3,r=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Lt.DefaultUp),this.updateMatrix(),this.target=new Lt,this.distance=s,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new gR}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}u(J0,"SpotLight");const nS=new be,Vh=new P,Iv=new P;class vR extends Q0{constructor(){super(new _s(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new $e(4,2),this._viewportCount=6,this._viewports=[new Ft(2,1,1,1),new Ft(0,1,1,1),new Ft(3,1,1,1),new Ft(1,1,1,1),new Ft(3,0,1,1),new Ft(1,0,1,1)],this._cubeDirections=[new P(1,0,0),new P(-1,0,0),new P(0,0,1),new P(0,0,-1),new P(0,1,0),new P(0,-1,0)],this._cubeUps=[new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,1,0),new P(0,0,1),new P(0,0,-1)]}updateMatrices(e,t=0){const s=this.camera,i=this.matrix,r=e.distance||s.far;r!==s.far&&(s.far=r,s.updateProjectionMatrix()),Vh.setFromMatrixPosition(e.matrixWorld),s.position.copy(Vh),Iv.copy(s.position),Iv.add(this._cubeDirections[t]),s.up.copy(this._cubeUps[t]),s.lookAt(Iv),s.updateMatrixWorld(),i.makeTranslation(-Vh.x,-Vh.y,-Vh.z),nS.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(nS)}}u(vR,"PointLightShadow");class ka extends yh{constructor(e,t,s=0,i=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=i,this.shadow=new vR}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}u(ka,"PointLight");class yR extends Q0{constructor(){super(new Ya(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}u(yR,"DirectionalLightShadow");class e1 extends yh{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Lt.DefaultUp),this.updateMatrix(),this.target=new Lt,this.shadow=new yR}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}u(e1,"DirectionalLight");class t1 extends yh{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}u(t1,"AmbientLight");class br{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let s=0,i=e.length;s<i;s++)t+=String.fromCharCode(e[s]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}u(br,"LoaderUtils");class _R extends Ka{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,s,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Gu.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Gu.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){i&&i(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}u(_R,"ImageBitmapLoader");class bR{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=sS(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=sS();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}u(bR,"Clock");function sS(){return(typeof performance=="undefined"?Date:performance).now()}u(sS,"now");const Xb="\\[\\]\\.:\\/",U8=new RegExp("["+Xb+"]","g"),Yb="[^"+Xb+"]",$8="[^"+Xb.replace("\\.","")+"]",V8=/((?:WC+[\/:])*)/.source.replace("WC",Yb),G8=/(WCOD+)?/.source.replace("WCOD",$8),H8=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Yb),W8=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Yb),j8=new RegExp("^"+V8+G8+H8+W8+"$"),X8=["material","materials","bones","map"];class wR{constructor(e,t,s){const i=s||St.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const s=this._targetGroup.nCachedObjects_,i=this._bindings[s];i!==void 0&&i.getValue(e,t)}setValue(e,t){const s=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=s.length;i!==r;++i)s[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,s=e.length;t!==s;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,s=e.length;t!==s;++t)e[t].unbind()}}u(wR,"Composite");class St{constructor(e,t,s){this.path=t,this.parsedPath=s||St.parseTrackName(t),this.node=St.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,s){return e&&e.isAnimationObjectGroup?new St.Composite(e,t,s):new St(e,t,s)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(U8,"")}static parseTrackName(e){const t=j8.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const s={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=s.nodeName&&s.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=s.nodeName.substring(i+1);X8.indexOf(r)!==-1&&(s.nodeName=s.nodeName.substring(0,i),s.objectName=r)}if(s.propertyName===null||s.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return s}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const s=e.skeleton.getBoneByName(t);if(s!==void 0)return s}if(e.children){const s=u(function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=s(a.children);if(l)return l}return null},"searchNodeSubtree"),i=s(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)e[t++]=s[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,s=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=St.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(s){let c=t.objectIndex;switch(s){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[s]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[s]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[i];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}u(St,"PropertyBinding");St.Composite=wR;St.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};St.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};St.prototype.GetterByBindingType=[St.prototype._getValue_direct,St.prototype._getValue_array,St.prototype._getValue_arrayElement,St.prototype._getValue_toArray];St.prototype.SetterByBindingTypeAndVersioning=[[St.prototype._setValue_direct,St.prototype._setValue_direct_setNeedsUpdate,St.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[St.prototype._setValue_array,St.prototype._setValue_array_setNeedsUpdate,St.prototype._setValue_array_setMatrixWorldNeedsUpdate],[St.prototype._setValue_arrayElement,St.prototype._setValue_arrayElement_setNeedsUpdate,St.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[St.prototype._setValue_fromArray,St.prototype._setValue_fromArray_setNeedsUpdate,St.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class xR{constructor(e,t,s=0,i=1/0){this.ray=new Xa(e,t),this.near=s,this.far=i,this.camera=null,this.layers=new V0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,s=[]){return N_(e,this,s,t),s.sort(iS),s}intersectObjects(e,t=!0,s=[]){for(let i=0,r=e.length;i<r;i++)N_(e[i],this,s,t);return s.sort(iS),s}}u(xR,"Raycaster");function iS(n,e){return n.distance-e.distance}u(iS,"ascSort");function N_(n,e,t,s){if(n.layers.test(e.layers)&&n.raycast(e,t),s===!0){const i=n.children;for(let r=0,o=i.length;r<o;r++)N_(i[r],e,t,!0)}}u(N_,"intersectObject");const rS=new P;class AR extends Lt{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const s=new at,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}s.setAttribute("position",new We(i,3));const r=new Bs({fog:!1,toneMapped:!1});this.cone=new Ar(s,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),rS.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(rS),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}u(AR,"SpotLightHelper");class MR extends Ye{constructor(e,t,s){const i=new Z0(t,4,2),r=new Fs({wireframe:!0,fog:!1,toneMapped:!1});super(i,r),this.light=e,this.light.updateMatrixWorld(),this.color=s,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}u(MR,"PointLightHelper");const Y8=new P,oS=new De,aS=new De;class SR extends Lt{constructor(e,t,s){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s;const i=new K0(t);i.rotateY(Math.PI*.5),this.material=new Fs({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(r.count*3);i.setAttribute("color",new An(o,3)),this.add(new Ye(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");oS.copy(this.light.color),aS.copy(this.light.groundColor);for(let s=0,i=t.count;s<i;s++){const r=s<i/2?oS:aS;t.setXYZ(s,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Y8.setFromMatrixPosition(this.light.matrixWorld).negate())}}u(SR,"HemisphereLightHelper");const lS=new P,em=new P,cS=new P;class CR extends Lt{constructor(e,t,s){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=s,t===void 0&&(t=1);let i=new at;i.setAttribute("position",new We([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new Bs({fog:!1,toneMapped:!1});this.lightPlane=new Zi(i,r),this.add(this.lightPlane),i=new at,i.setAttribute("position",new We([0,0,0,0,0,1],3)),this.targetLine=new Zi(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){lS.setFromMatrixPosition(this.light.matrixWorld),em.setFromMatrixPosition(this.light.target.matrixWorld),cS.subVectors(em,lS),this.lightPlane.lookAt(em),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(em),this.targetLine.scale.z=cS.length()}}u(CR,"DirectionalLightHelper");const tm=new P,Pn=new W0;class ER extends Ar{constructor(e){const t=new at,s=new Bs({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(g,m){l(g),l(m)}u(a,"addLine");function l(g){i.push(0,0,0),r.push(0,0,0),o[g]===void 0&&(o[g]=[]),o[g].push(i.length/3-1)}u(l,"addPoint"),t.setAttribute("position",new We(i,3)),t.setAttribute("color",new We(r,3)),super(t,s),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new De(16755200),h=new De(16711680),d=new De(43775),f=new De(16777215),p=new De(3355443);this.setColors(c,h,d,f,p)}setColors(e,t,s,i,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,s.r,s.g,s.b),a.setXYZ(33,s.r,s.g,s.b),a.setXYZ(34,s.r,s.g,s.b),a.setXYZ(35,s.r,s.g,s.b),a.setXYZ(36,s.r,s.g,s.b),a.setXYZ(37,s.r,s.g,s.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,s=1,i=1;Pn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Nn("c",t,e,Pn,0,0,-1),Nn("t",t,e,Pn,0,0,1),Nn("n1",t,e,Pn,-s,-i,-1),Nn("n2",t,e,Pn,s,-i,-1),Nn("n3",t,e,Pn,-s,i,-1),Nn("n4",t,e,Pn,s,i,-1),Nn("f1",t,e,Pn,-s,-i,1),Nn("f2",t,e,Pn,s,-i,1),Nn("f3",t,e,Pn,-s,i,1),Nn("f4",t,e,Pn,s,i,1),Nn("u1",t,e,Pn,s*.7,i*1.1,-1),Nn("u2",t,e,Pn,-s*.7,i*1.1,-1),Nn("u3",t,e,Pn,0,i*2,-1),Nn("cf1",t,e,Pn,-s,0,1),Nn("cf2",t,e,Pn,s,0,1),Nn("cf3",t,e,Pn,0,-i,1),Nn("cf4",t,e,Pn,0,i,1),Nn("cn1",t,e,Pn,-s,0,-1),Nn("cn2",t,e,Pn,s,0,-1),Nn("cn3",t,e,Pn,0,-i,-1),Nn("cn4",t,e,Pn,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}u(ER,"CameraHelper");function Nn(n,e,t,s,i,r,o){tm.set(i,r,o).unproject(s);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],tm.x,tm.y,tm.z)}}u(Nn,"setPoint");typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ib}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ib);var q8=Object.defineProperty,Og=u((n,e)=>q8(n,"name",{value:e,configurable:!0}),"__name$3x");function ec(n,e,t){let s,i,r=Og(a=>e(a),"_onDragMove"),o=Og(a=>(document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",s),document.removeEventListener("pointerout",i),t&&t(a)),"_onDragEnd");s=o,i=Og(a=>{(!a.relatedTarget||a.relatedTarget.nodeName==="HTML")&&o(a)},"onPointerOut"),document.addEventListener("pointermove",r),document.addEventListener("pointerup",s),document.addEventListener("pointerout",i),n&&r(n)}u(ec,"addGlobalDragListener");Og(ec,"addGlobalDragListener");var K8=Object.defineProperty,nm=u((n,e)=>K8(n,"name",{value:e,configurable:!0}),"__name$3w");const uS="color-box",hS="color-box-active";var Z8=Ht({props:{value:{type:Array,default:[1,1,1]},colorBox:Boolean},emits:["update:value"],setup(n,e){const t=Ne(),s=Ne(),i=160/2,r=13,o=Oo(new De),a=Oo({h:0,s:0,l:0}),l=Ne(0),c=Ne(0),h=Ne(0),d=Ne(0),f=Oo([16777215,16777215,16777215,16777215,16777215,16777215,16777215,16777215]);try{const S=localStorage.getItem(uS);if(S){const M=JSON.parse(S);for(let R=0,D=f.length;R<D;++R)f[R]=M[R]}const C=localStorage.getItem(hS);C&&(d.value=JSON.parse(C))}catch(S){console.error(S)}Ts(f,function(){!n.colorBox||localStorage.setItem(uS,JSON.stringify(f))},{deep:!0}),Ts(d,function(){!n.colorBox||localStorage.setItem(hS,JSON.stringify(d.value))}),Ts(()=>n.value,function(){o.setRGB(n.value[0],n.value[1],n.value[2]),o.getHSL(a);let S=a.h,C=a.s,M=a.l,R=C*Math.min(M,1-M)+M;C=R?2-2*M/R:0,(C||R||h.value&&!C&&!R)&&(c.value=C,h.value=R),C&&(l.value=S),f[d.value]=o.getHex()},{immediate:!0});const p=ct(function(){return o.getHexString()}),g=ct(function(){return f.map(S=>new De().setHex(S).getHexString())}),m=ct(function(){return{transform:`rotate(${Math.round(l.value*360)-60}deg)`,"transform-origin":`0 ${i}px`}}),v=ct(function(){return{"background-color":`#${new De().setHSL(l.value,1,.5).getHexString()}`}}),y=ct(function(){return{left:`${Math.round(100*c.value)}%`,top:`${Math.round(100*(1-h.value))}%`}});function b(S){S.stopPropagation();const C=t.value.getBoundingClientRect(),M=i,R=i,D=S.clientX-C.left,k=S.clientY-C.top,T=Math.sqrt((D-M)**2+(k-R)**2);T>=i-r&&T<=i&&ec(S,N=>{const E=N.clientX-C.left-M,z=N.clientY-C.top-R,q=(Math.atan2(z,E)/Math.PI*180+360*2+90+60)%360/360,ne=new De().setHSL(q,a.s,a.l);e.emit("update:value",[ne.r,ne.g,ne.b]),l.value=q})}u(b,"onHueRingMouseDown"),nm(b,"onHueRingMouseDown");function _(S){S.stopPropagation();const C=s.value.getBoundingClientRect();ec(S,M=>{let R=Math.min(Math.max(M.clientX-C.left,0),C.width)/C.width,D=1-Math.min(Math.max(M.clientY-C.top,0),C.height)/C.height;c.value=R,h.value=D;let k=D-D*R/2,T=Math.min(k,1-k);R=T?(D-k)/T:0;const N=new De().setHSL(l.value,R,k);e.emit("update:value",[N.r,N.g,N.b])})}u(_,"onSvRectMouseDown"),nm(_,"onSvRectMouseDown");function w(S){const M=(S.target.value||"").trim();if(/^([a-fA-F0-9]{6})$/.test(M)){const R=Number.parseInt(M.substring(0,6),16),D=new De().setHex(R);e.emit("update:value",[D.r,D.g,D.b])}}u(w,"onTextInput"),nm(w,"onTextInput");function x(S){d.value=S;const C=new De().setHex(f[S]);e.emit("update:value",[C.r,C.g,C.b])}return u(x,"onBoxClick"),nm(x,"onBoxClick"),{hueRing:t,svRect:s,activeBox:d,hex:p,colorBoxHex:g,hueRingHandlerStyle:m,svRectStyle:v,svRectHandlerStyle:y,onHueRingMouseDown:b,onSvRectMouseDown:_,onTextInput:w,onBoxClick:x}}});const qb=u(n=>(Ga("data-v-3618be33"),n=n(),Ha(),n),"_withScopeId$6"),Q8={class:"color-picker"},J8={class:"hue-ring-inner"},eV=qb(()=>j("div",{class:"bg1 bg"},null,-1)),tV=qb(()=>j("div",{class:"bg2 bg"},null,-1)),nV={class:"color-value"},sV=qb(()=>j("span",null,"#",-1)),iV=["value"],rV={key:0,class:"color-box"},oV=["onClick"];function aV(n,e,t,s,i,r){return Se(),Oe("div",Q8,[j("div",{class:"hue-ring",onPointerdown:e[1]||(e[1]=(...o)=>n.onHueRingMouseDown&&n.onHueRingMouseDown(...o)),ref:"hueRing"},[j("div",{class:"hue-ring-handler",style:On(n.hueRingHandlerStyle)},null,4),j("div",J8,[j("div",{class:"sv-rect",style:On(n.svRectStyle),onPointerdown:e[0]||(e[0]=(...o)=>n.onSvRectMouseDown&&n.onSvRectMouseDown(...o)),ref:"svRect"},[eV,tV,j("div",{class:"sv-rect-handler",style:On(n.svRectHandlerStyle)},null,4)],36)])],544),j("div",nV,[j("div",{class:"block",style:On({"background-color":`#${n.hex}`})},null,4),sV,j("input",{type:"text",value:n.hex,onInput:e[2]||(e[2]=(...o)=>n.onTextInput&&n.onTextInput(...o))},null,40,iV)]),n.colorBox?(Se(),Oe("div",rV,[(Se(!0),Oe(Dt,null,ji(n.colorBoxHex,(o,a)=>(Se(),Oe("div",{class:pn(["color",{active:n.activeBox===a}]),style:On({"background-color":`#${o}`}),onClick:l=>n.onBoxClick(a)},null,14,oV))),256))])):tt("",!0)])}u(aV,"_sfc_render$u");var TR=jt(Z8,[["render",aV],["__scopeId","data-v-3618be33"]]);const lV={},cV=u(n=>(Ga("data-v-b69c8118"),n=n(),Ha(),n),"_withScopeId$5"),uV=cV(()=>j("div",{class:"fullscreen-loading"},[j("div",{class:"lds-dual-ring"})],-1));function hV(n,e){return Se(),Xt(Eb,{to:"body"},[uV])}u(hV,"_sfc_render$t");var dV=jt(lV,[["render",hV],["__scopeId","data-v-b69c8118"]]),fV=Object.defineProperty,pV=u((n,e)=>fV(n,"name",{value:e,configurable:!0}),"__name$3v"),mV=Ht({props:{value:Boolean,label:String},emits:["input"],setup(n,e){function t(){e.emit("input",!n.value)}return u(t,"flip"),pV(t,"flip"),{flip:t}}});const gV={class:"input-boolean"};function vV(n,e,t,s,i,r){return Se(),Oe("div",gV,[j("div",{class:pn(["input-boolean__checkbox",{checked:!!n.value}]),onClick:e[0]||(e[0]=(...o)=>n.flip&&n.flip(...o))},null,2),n.label?(Se(),Oe("div",{key:0,class:"input-boolean__label",onClick:e[1]||(e[1]=(...o)=>n.flip&&n.flip(...o))},un(n.label),1)):tt("",!0)])}u(vV,"_sfc_render$s");var Er=jt(mV,[["render",vV],["__scopeId","data-v-271a8ef3"]]),yV=Object.defineProperty,sm=u((n,e)=>yV(n,"name",{value:e,configurable:!0}),"__name$3u"),_V=Ht({props:{value:Number,readonly:Boolean,disabled:Boolean,min:Number,max:Number,step:Number,resettable:Boolean,defaultValue:Number},emits:["input"],setup(n,e){const t=Ne();let s=!1;function i(){s&&(o(),document.removeEventListener("mousedown",i))}u(i,"postOnMouseDown"),sm(i,"postOnMouseDown");function r(){s||(s=!0,document.addEventListener("mousedown",i))}u(r,"onChange"),sm(r,"onChange"),Wa(function(){document.removeEventListener("mousedown",i)});function o(){if(s){s=!1;const l=t.value;if(l){const c=l.value;let h=Number(c);isFinite(h)||(h=0),n.step!=null&&(h=Math.round(h/n.step)*n.step),n.min!=null&&(h=Math.max(n.min,h)),n.max!=null&&(h=Math.min(n.max,h)),e.emit("input",h)}}}u(o,"onPost"),sm(o,"onPost");function a(){e.emit("input",n.defaultValue||0)}return u(a,"onReset"),sm(a,"onReset"),{inputDom:t,onChange:r,onPost:o,onReset:a}}}),n1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFxJREFUSIntlEsOACEIQ2Xuf+e6MkFiLCN+Nryl0AoxtZQkiSLeRgDohCJuLTW25vZ8VHebrw7Q+JZu/jHAGbEitME1jr1BCChY36xON9gWKIsOEQvajPdfRZJQKkl2V7+RNsIHAAAAAElFTkSuQmCC";const bV=u(n=>(Ga("data-v-3550c3d4"),n=n(),Ha(),n),"_withScopeId$4"),wV={class:"input-number"},xV=["value","readonly","disabled"],AV=bV(()=>j("img",{src:n1,alt:""},null,-1)),MV=[AV];function SV(n,e,t,s,i,r){return Se(),Oe("div",wV,[j("input",{type:"text",value:n.value,readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,xV),n.resettable?(Se(),Oe("button",{key:0,class:"normal-button",onClick:e[3]||(e[3]=(...o)=>n.onReset&&n.onReset(...o))},MV)):tt("",!0)])}u(SV,"_sfc_render$r");var rs=jt(_V,[["render",SV],["__scopeId","data-v-3550c3d4"]]),CV=Object.defineProperty,im=u((n,e)=>CV(n,"name",{value:e,configurable:!0}),"__name$3t"),EV=Ht({props:{value:Number,min:{type:Number,required:!0},max:{type:Number,required:!0},step:Number},emits:["input"],setup(n,e){const t=ct(function(){return n.step?Math.round(n.min/n.step):n.min}),s=ct(function(){return n.step?Math.round(n.max/n.step):n.max}),i=ct(function(){const f=n.value==null?0:n.value;return n.step?Math.round(f/n.step):f}),r=ct(function(){const f=n.value==null?0:n.value;return n.step?f.toFixed(-Math.log10(n.step)):f});function o(f){let p=Number(f.target.value);n.step&&(p*=n.step),e.emit("input",p)}u(o,"onRangeInput"),im(o,"onRangeInput");const a=Ne();let l=!1;function c(){l&&(d(),document.removeEventListener("mousedown",c))}u(c,"postOnMouseDown"),im(c,"postOnMouseDown");function h(){l||(l=!0,document.addEventListener("mousedown",c))}u(h,"onChange"),im(h,"onChange"),Wa(function(){document.removeEventListener("mousedown",c)});function d(){if(l){l=!1;const f=a.value;if(f){const p=f.value;let g=Number(p);isFinite(g)||(g=0),n.step!=null&&(g=Math.round(g/n.step)*n.step),n.min!=null&&(g=Math.max(n.min,g)),n.max!=null&&(g=Math.min(n.max,g)),e.emit("input",g)}}}return u(d,"onPost"),im(d,"onPost"),{inputDom:a,onChange:h,onPost:d,iMin:t,iMax:s,iValue:i,text:r,onRangeInput:o}}});const TV={class:"input-range"},PV=["value","min","max"],RV=["value"];function IV(n,e,t,s,i,r){return Se(),Oe("div",TV,[j("input",{class:"range",type:"range",value:n.iValue,min:n.iMin,max:n.iMax,onInput:e[0]||(e[0]=(...o)=>n.onRangeInput&&n.onRangeInput(...o))},null,40,PV),j("input",{class:"num",type:"text",value:n.text,onInput:e[1]||(e[1]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[2]||(e[2]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[3]||(e[3]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,RV)])}u(IV,"_sfc_render$q");var Xo=jt(EV,[["render",IV],["__scopeId","data-v-63841fa7"]]),DV=Object.defineProperty,dS=u((n,e)=>DV(n,"name",{value:e,configurable:!0}),"__name$3s"),LV=Ht({props:{value:{type:Number,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},fractionDigits:Number,label:String},emits:["update:value"],setup(n,e){const t=Ne(),s=ct(function(){return n.value.toFixed(n.fractionDigits)}),i=ct(function(){return{width:`${Math.round((n.value-n.min)/(n.max-n.min)*100)}%`}});function r(a){ec(a,function(l){const c=t.value.getBoundingClientRect();let d=Math.max(0,Math.min(1,(l.clientX-c.left)/c.width))*(n.max-n.min)+n.min;d=Math.round(d/n.step)*n.step,e.emit("update:value",d)})}u(r,"onMouseDown"),dS(r,"onMouseDown");function o(a){switch(a.key){case"ArrowLeft":e.emit("update:value",Math.max(n.min,n.value-n.step));break;case"ArrowRight":e.emit("update:value",Math.min(n.max,n.value+n.step));break}}return u(o,"onKeyDown"),dS(o,"onKeyDown"),{dom:t,valueText:s,barStyle:i,onMouseDown:r,onKeyDown:o}}});const OV={class:"label"},kV={class:"value"};function NV(n,e,t,s,i,r){return Se(),Oe("div",{class:"label-range",onPointerdown:e[0]||(e[0]=(...o)=>n.onMouseDown&&n.onMouseDown(...o)),ref:"dom",tabindex:"0",onKeydown:e[1]||(e[1]=(...o)=>n.onKeyDown&&n.onKeyDown(...o))},[j("div",{class:"bar",style:On(n.barStyle)},null,4),j("div",OV,un(n.label),1),j("div",kV,un(n.valueText),1)],544)}u(NV,"_sfc_render$p");var FV=jt(LV,[["render",NV],["__scopeId","data-v-2e301f78"]]),zV=Object.defineProperty,BV=u((n,e)=>zV(n,"name",{value:e,configurable:!0}),"__name$3r");class Kb{constructor(){A(this,"panels",[])}register(e){this.panels.push(e)}panelExpand(e){for(let t of this.panels)t!==e&&t.collapse()}}u(Kb,"AccordionGroupContext");BV(Kb,"AccordionGroupContext");var UV=Ht({setup(){Hl("accordion-group-context",new Kb)}});const $V={class:"accordion-group"};function VV(n,e,t,s,i,r){return Se(),Oe("div",$V,[za(n.$slots,"default",{},void 0,!0)])}u(VV,"_sfc_render$o");var GV=jt(UV,[["render",VV],["__scopeId","data-v-f71b1b72"]]),HV=Object.defineProperty,WV=u((n,e)=>HV(n,"name",{value:e,configurable:!0}),"__name$3q");class Zb{constructor(e){A(this,"collapse");this.collapse=e}}u(Zb,"CollapsiblePanelContext");WV(Zb,"CollapsiblePanelContext");var jV=Ht({props:{defaultExpand:Boolean},setup(n,e){const t=Ne(!n.defaultExpand),s=Es("accordion-group-context");if(s){const i=new Zb(function(){t.value=!0});s.register(i),Ts(t,function(r){r||s.panelExpand(i)})}return{collapsed:t}}}),XV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAACNJREFUSIljYBgFo2B4gv////8fNXwYGT5qyeC1ZBSMgmEEABJkI93tOf2YAAAAAElFTkSuQmCC",YV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAADBJREFUSIljYBgFo2AUjADw/////5TIU2QJVQzHZRhVDUc3lCaGo1syCkbBKBhEAAAQyyPdR15+TgAAAABJRU5ErkJggg==";const qV={class:"collapsible-panel"},KV={class:"collapsible-panel__title cols"},ZV={class:"fill"},QV={key:0,src:XV,alt:""},JV={key:1,src:YV,alt:""};function eG(n,e,t,s,i,r){return Se(),Oe("div",qV,[j("div",KV,[j("div",ZV,[za(n.$slots,"title",{},void 0,!0)]),j("div",{class:"collapse-button",onClick:e[0]||(e[0]=o=>n.collapsed=!n.collapsed)},[n.collapsed?(Se(),Oe("img",QV)):(Se(),Oe("img",JV))])]),j("div",{class:pn(["collapsible-panel__body",{collapsed:n.collapsed}])},[za(n.$slots,"body",{},void 0,!0)],2)])}u(eG,"_sfc_render$n");var tG=jt(jV,[["render",eG],["__scopeId","data-v-6c73d7fb"]]);const i0={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class _h{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}u(_h,"Pass");const nG=new Ya(-1,1,1,-1,0,1),Qb=new at;Qb.setAttribute("position",new We([-1,3,0,-1,-1,0,3,-1,0],3));Qb.setAttribute("uv",new We([0,2,0,0,2,0],2));class ip{constructor(e){this._mesh=new Ye(Qb,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,nG)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}u(ip,"FullScreenQuad");class F_ extends _h{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof bs?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=H0.clone(e.uniforms),this.material=new bs({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new ip(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}u(F_,"ShaderPass");class z_ extends _h{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const i=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),r.buffers.stencil.setFunc(i.ALWAYS,o,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(i.EQUAL,1,4294967295),r.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),r.buffers.stencil.setLocked(!0)}}u(z_,"MaskPass");class PR extends _h{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}u(PR,"ClearMaskPass");class kg{constructor(e,t){if(this.renderer=e,t===void 0){const s=e.getSize(new $e);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,t=new ys(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],i0===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),F_===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new F_(i0),this.clock=new bR}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let i=0,r=this.passes.length;i<r;i++){const o=this.passes[i];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),o.needsSwap){if(s){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}z_!==void 0&&(o instanceof z_?s=!0:o instanceof PR&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new $e);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(s,i),this.renderTarget2.setSize(s,i);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(s,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}u(kg,"EffectComposer");new Ya(-1,1,1,-1,0,1);const RR=new at;RR.setAttribute("position",new We([-1,3,0,-1,-1,0,3,-1,0],3));RR.setAttribute("uv",new We([0,2,0,0,2,0],2));class Wr extends _h{constructor(e,t,s,i){super(),this.renderScene=t,this.renderCamera=s,this.selectedObjects=i!==void 0?i:[],this.visibleEdgeColor=new De(1,1,1),this.hiddenEdgeColor=new De(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new $e(e.x,e.y):new $e(256,256);const r=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new ys(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new Bb,this.depthMaterial.side=Di,this.depthMaterial.depthPacking=LP,this.depthMaterial.blending=jr,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Di,this.prepareMaskMaterial.fragmentShader=h(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new ys(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new ys(r,o),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new ys(r,o),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new ys(Math.round(r/2),Math.round(o/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new ys(r,o),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new ys(Math.round(r/2),Math.round(o/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const a=4,l=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(a),this.separableBlurMaterial1.uniforms.texSize.value.set(r,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(l),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(r/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=l,this.overlayMaterial=this.getOverlayMaterial(),i0===void 0&&console.error("THREE.OutlinePass relies on CopyShader");const c=i0;this.copyUniforms=H0.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new bs({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:jr,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new De,this.oldClearAlpha=1,this.fsQuad=new ip(null),this.tempPulseColor1=new De,this.tempPulseColor2=new De,this.textureMatrix=new be;function h(d,f){const p=f.isPerspectiveCamera?"perspective":"orthographic";return d.replace(/DEPTH_TO_VIEW_Z/g,p+"DepthToViewZ")}u(h,"replaceDepthToViewZ")}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let s=Math.round(e/this.downSampleRatio),i=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(s,i),this.renderTargetBlurBuffer1.setSize(s,i),this.renderTargetEdgeBuffer1.setSize(s,i),this.separableBlurMaterial1.uniforms.texSize.value.set(s,i),s=Math.round(s/2),i=Math.round(i/2),this.renderTargetBlurBuffer2.setSize(s,i),this.renderTargetEdgeBuffer2.setSize(s,i),this.separableBlurMaterial2.uniforms.texSize.value.set(s,i)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function s(i){i.isMesh&&(e===!0?i.visible=t.get(i):(t.set(i,i.visible),i.visible=e))}u(s,"gatherSelectedMeshesCallBack");for(let i=0;i<this.selectedObjects.length;i++)this.selectedObjects[i].traverse(s)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,s=[];function i(o){o.isMesh&&s.push(o)}u(i,"gatherSelectedMeshesCallBack");for(let o=0;o<this.selectedObjects.length;o++)this.selectedObjects[o].traverse(i);function r(o){if(o.isMesh||o.isSprite){let a=!1;for(let l=0;l<s.length;l++)if(s[l].id===o.id){a=!0;break}if(a===!1){const l=o.visible;(e===!1||t.get(o)===!0)&&(o.visible=e),t.set(o,l)}}else(o.isPoints||o.isLine)&&(e===!0?o.visible=t.get(o):(t.set(o,o.visible),o.visible=e))}u(r,"VisibilityChangeCallBack"),this.renderScene.traverse(r)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,s,i,r){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,r&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+Math.cos(performance.now()*.01/this.pulsePeriod)*.75/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Wr.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Wr.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Wr.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Wr.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(s),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=s.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new bs({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new $e(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new bs({uniforms:{maskTexture:{value:null},texSize:{value:new $e(.5,.5)},visibleEdgeColor:{value:new P(1,1,1)},hiddenEdgeColor:{value:new P(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new bs({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new $e(.5,.5)},direction:{value:new $e(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new bs({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:C_,depthTest:!1,depthWrite:!1,transparent:!0})}}u(Wr,"OutlinePass");Wr.BlurDirectionX=new $e(1,0);Wr.BlurDirectionY=new $e(0,1);class rp extends _h{constructor(e,t,s,i,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=s,this.clearColor=i,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new De}render(e,t,s){const i=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=i}}u(rp,"RenderPass");var sG=Object.defineProperty,iG=u((n,e)=>sG(n,"name",{value:e,configurable:!0}),"__name$3p");class Jb{constructor(){A(this,"shadingMode","solid");A(this,"enablePressure",!0);A(this,"remeshVoxelSize",.003);A(this,"paintColor",[1,0,1]);A(this,"depthMapOffset",0);A(this,"depthMapScale",.1);A(this,"edgeDetectNormalThreshold",.5);A(this,"edgeDetectDepthThreshold",.1);A(this,"sdServer","http://localhost:7860");A(this,"sdWidth",512);A(this,"sdHeight",512);A(this,"sdPrompt","");A(this,"sdNPrompt","");A(this,"sdPromptA","best quality, extremely detailed");A(this,"sdNPromptA","longbody, lowres, bad anatomy, bad hands, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality");A(this,"sdSampler","");A(this,"sdSteps",30);A(this,"sdInputImg",!1);A(this,"sdCnDepthModel","");A(this,"sdCnDepthEnabled",!1);A(this,"sdCnDepthWeight",1);A(this,"sdCnDepthGuidanceStart",0);A(this,"sdCnDepthGuidanceEnd",1);A(this,"sdCnDepthControlMode",0);A(this,"sdCnEdgeModel","");A(this,"sdCnEdgeEnabled",!1);A(this,"sdCnEdgeWeight",1);A(this,"sdCnEdgeGuidanceStart",0);A(this,"sdCnEdgeGuidanceEnd",1);A(this,"sdCnEdgeControlMode",0);A(this,"sdCnPoseModel","");A(this,"sdCnPoseEnabled",!1);A(this,"sdCnPoseWeight",1);A(this,"sdCnPoseGuidanceStart",0);A(this,"sdCnPoseGuidanceEnd",1);A(this,"sdCnPoseControlMode",0);A(this,"allowSelectingInvisibleObjectByClicking",!0);A(this,"keepTransformUnchangedWhileMoving",!0);A(this,"useLocalSpaceForTransformControl",!0);A(this,"takeGeometryCenterAsTransformOrigin",!0);A(this,"allowModifyingBoneLengthWhenBindingIk",!0);A(this,"keepInternalTransformWhenBindingIk",!0);A(this,"keepBothEndsOfClayNodesWhenStretching",!0);A(this,"quadView",!1);A(this,"outlineSelected",!0);A(this,"showGrids",!0);A(this,"showLightHelpers",!1);A(this,"showIkBones",!1);A(this,"showOpenPoseKeypoints",!1);A(this,"tools",{})}}u(Jb,"EditorOptions");iG(Jb,"EditorOptions");var rG=Object.defineProperty,oG=u((n,e)=>rG(n,"name",{value:e,configurable:!0}),"__name$3o");const fS=new ft,aG=new P,Dv=new qe;class s1{constructor(){A(this,"perspective",!0);A(this,"perspectiveCamera",new _s(45,1,.1,2e3));A(this,"orthographicCamera",new Ya(-1,1,-1,1,0,2e3));A(this,"target",new P);A(this,"distance",1);A(this,"alpha",0);A(this,"beta",0);A(this,"_position",new P);A(this,"_up",new P);A(this,"_dir",new P)}get(){return this.perspective?this.perspectiveCamera:this.orthographicCamera}copy(e){this.perspective=e.perspective,this.target.copy(e.target),this.distance=e.distance,this.alpha=e.alpha,this.beta=e.beta}update(e,t){fS.set(0,this.beta,-this.alpha),Dv.setFromEuler(fS),this._position.set(this.distance,0,0),this._position.applyQuaternion(Dv),this._position.add(this.target);const s=this.get();if(s.position.copy(this._position),this._up.set(0,1,0),this._dir.subVectors(this._position,this.target).normalize(),aG.crossVectors(this._up,this._dir).lengthSq()<1e-8&&this._up.applyQuaternion(Dv),s.up.copy(this._up),s.lookAt(this.target),this.perspective)this.perspectiveCamera.aspect=e/t;else{const i=this.distance/850,r=e/2*i,o=t/2*i;this.orthographicCamera.left=-r,this.orthographicCamera.right=+r,this.orthographicCamera.bottom=-o,this.orthographicCamera.top=+o}s.updateProjectionMatrix()}}u(s1,"ArcRotateCamera");oG(s1,"ArcRotateCamera");var lG=Object.defineProperty,Fi=u((n,e)=>lG(n,"name",{value:e,configurable:!0}),"__name$3n");const Qt=function(){const n=new P,e=new P;return function(t,s,i,r,o){n.subVectors(i,s);const a=n.length();if(a<1e-8)return!1;n.divideScalar(a);const l=n.dot(o);if(Math.abs(l)<1e-8)return!1;e.subVectors(r,s);const c=e.dot(o)/l;return t.copy(s),t.addScaledVector(n,c),!0}}();function B_(n,e,t,s,i){let r=t.x-e.x,o=t.y-e.y,a=t.z-e.z;const l=e.x-s.x,c=e.y-s.y,h=e.z-s.z,d=r**2+o**2+a**2,f=2*(r*l+o*c+a*h),p=l**2+c**2+h**2-i**2,g=f**2-4*d*p;if(g<0)return!1;const m=Math.sqrt(g),v=(-f+m)/(2*d),y=(-f-m)/(2*d),b=Math.min(v,y);return n.x=e.x+r*b,n.y=e.y+o*b,n.z=e.z+a*b,!0}u(B_,"raySphereIntersect");Fi(B_,"raySphereIntersect");const Lf=new P,Of=new qe,Hu=new P;function tc(n,e){return e.decompose(Lf,Of,Hu),n.copy(Lf),n}u(tc,"getTranslation");Fi(tc,"getTranslation");function IR(n,e){return e.decompose(Lf,Of,Hu),n.copy(Of),n}u(IR,"getRotation");Fi(IR,"getRotation");function DR(n,e){return e.decompose(Lf,Of,Hu),n.copy(Hu),n}u(DR,"getScale");Fi(DR,"getScale");function Ia(n){return n.decompose(Lf,Of,Hu),Hu.x}u(Ia,"getScaleScalar");Fi(Ia,"getScaleScalar");function Ro(n,e,t,s,i,r){let o=t.x,a=t.y,l=t.z,c=s.x,h=s.y,d=s.z,f=i.x,p=i.y,g=i.z,m=r.x,v=r.y,y=r.z,b=c**2*v**2+c**2*y**2-2*c*h*m*v-2*c*d*m*y+h**2*m**2+h**2*y**2-2*h*d*v*y+d**2*m**2+d**2*v**2,_=!1,w=(c*m*v*a-c*m*v*p+c*m*y*l-c*m*y*g-c*v**2*o+c*v**2*f-c*y**2*o+c*y**2*f-h*m**2*a+h*m**2*p+h*m*v*o-h*m*v*f+h*v*y*l-h*v*y*g-h*y**2*a+h*y**2*p-d*m**2*l+d*m**2*g+d*m*y*o-d*m*y*f-d*v**2*l+d*v**2*g+d*v*y*a-d*v*y*p)/b;isFinite(w)||(_=!0,w=0);let x=o+c*w,S=a+h*w,C=l+d*w;if(n&&(n.x=x,n.y=S,n.z=C),e){let M=(-c*v*l+c*v*g+c*y*a-c*y*p+h*m*l-h*m*g-h*y*o+h*y*f-d*m*a+d*m*p+d*v*o-d*v*f)/b;if(isFinite(M)){let R=h*y-d*v,D=-c*y+d*m,k=c*v-h*m;e.x=x+R*M,e.y=S+D*M,e.z=C+k*M}else{_=!0;let R=h*(l-g)-d*(a-p),D=-c*(l-g)+d*(o-f),k=c*(a-p)-h*(o-f);e.x=x+h*k-d*D,e.y=S+-c*k+d*R,e.z=C+c*D-h*R}}return _}u(Ro,"closestPointsBetweenTwoLines");Fi(Ro,"closestPointsBetweenTwoLines");const Ua=function(){const n=new P,e=new P,t=new be;return function(s,i,r){return n.crossVectors(r,i).normalize(),e.crossVectors(i,n).normalize(),t.set(n.x,n.y,n.z,0,e.x,e.y,e.z,0,i.x,i.y,i.z,0,0,0,0,1).transpose(),s.setFromRotationMatrix(t)}}();function Eu(n,e){return n.x=Math.round(n.x/e)*e,n.y=Math.round(n.y/e)*e,n.z=Math.round(n.z/e)*e,n}u(Eu,"snapPoint");Fi(Eu,"snapPoint");function Tr(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8}u(Tr,"vectorsEqual");Fi(Tr,"vectorsEqual");function LR(n,e,t){const s=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.y,t.y),a=n.x,l=n.y;return!(a<s||a>i||l<r||l>o)}u(LR,"intersectPointRect");Fi(LR,"intersectPointRect");const cG=function(){const n=new P,e=new P,t=new P;return function(s,i,r,o,a,l,c,h){n.subVectors(i,r);const d=l.dot(n),f=c.dot(n);if(d<=0&&f<=0)return s.copy(r);e.subVectors(i,o);const p=l.dot(e),g=c.dot(e);if(p>=0&&g<=p)return s.copy(o);t.subVectors(i,a);const m=l.dot(t),v=c.dot(t);if(v>=0&&m<=v)return s.copy(a);const y=d*g-p*f;if(y<=0&&d>=0&&p<=0){const C=d/(d-p);return s.copy(r).addScaledVector(l,C)}const b=m*f-d*v;if(b<=0&&f>=0&&v<=0){const C=f/(f-v);return s.copy(r).addScaledVector(c,C)}const _=p*v-m*g;if(_<=0&&g-p>=0&&m-v>=0){const C=(g-p)/(g-p+(m-v));return s.copy(o).addScaledVector(h,C)}const w=1/(_+b+y),x=b*w,S=y*w;return s.copy(r).addScaledVector(l,x).addScaledVector(c,S)}}(),uG=function(){const n=new P,e=new P,t=new P,s=new P;return function(i,r,o,a,l){e.crossVectors(a,l);let c=r.dot(e),h;if(c>0)h=1;else if(c<0)h=-1,c=-c;else return-1;n.subVectors(i,o);const d=h*r.dot(s.crossVectors(n,l));if(d<0)return-1;const f=h*r.dot(t.crossVectors(a,n));if(f<0||f+d>c)return-1;const p=-h*n.dot(e);return p<0?-1:p/c}}(),OR=function(){const n=new P;return function(e,t,s,i){return e.copy(t).addScaledVector(s,n.subVectors(i,t).dot(s))}}(),Nl=function(){const n=new P;return function(e,t,s){return Math.atan2(n.crossVectors(t,s).dot(e),t.dot(s))}}();function ko(n,e){const t=Math.acos(e.w)*2,s=Math.sin(t/2);return s>1e-6?n.set(e.x,e.y,e.z).multiplyScalar(1/s):n.set(1,0,0),t}u(ko,"getAxisAngle");Fi(ko,"getAxisAngle");function mu(n){return n=n%(Math.PI*2),n<0&&(n+=Math.PI*2),n}u(mu,"simplifyAngle");Fi(mu,"simplifyAngle");function U_(n,e){return Math.PI-Math.abs(Math.abs(e-n)%(Math.PI*2)-Math.PI)}u(U_,"absAngleDiff");Fi(U_,"absAngleDiff");function ew(n,e,t){if(n=mu(n),t-e>1e-8&&mu(t-e)<1e-8)return n;if(e=mu(e),t=mu(t),t<e){if(n>=0&&n<=t||n>=e)return n}else if(n>=e&&n<=t)return n;const s=U_(n,e),i=U_(n,t);return s<=i?e:t}u(ew,"clampAngle");Fi(ew,"clampAngle");var hG=Object.defineProperty,dG=u((n,e)=>hG(n,"name",{value:e,configurable:!0}),"__name$3m");const fG=16135762,pG=7316763,mG=3113955,si=new Fs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5}),tw=new Fs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),Yd=tw.clone();Yd.color.setHex(fG);const qd=tw.clone();qd.color.setHex(pG);const Kd=tw.clone();Kd.color.setHex(mG);const dr=.035,Lv=.5+.04,vi=.1+dr,gu=.5-.04,gG=gu-.02,pS=.5,aa=.06,Gh=gu-.06,la=.08,oo=new P,ao=new P,lo=new P,bn=new P,fs=new P,Ov=new P,Hh=new P,mS=new be,Is=new P,ii=new qe,Wh=new P,jh=new P,rm=new P,om=new P;class nw extends ls{constructor(){super();A(this,"translateArrowX");A(this,"translateArrowY");A(this,"translateArrowZ");A(this,"translatePickerX");A(this,"translatePickerY");A(this,"translatePickerZ");A(this,"translateArrowXN");A(this,"translateArrowYN");A(this,"translateArrowZN");A(this,"translatePickerXN");A(this,"translatePickerYN");A(this,"translatePickerZN");A(this,"freeTranslateHandler");A(this,"freeTranslatePicker");A(this,"rotateCircleX");A(this,"rotateCircleY");A(this,"rotateCircleZ");A(this,"rotatePickerX");A(this,"rotatePickerY");A(this,"rotatePickerZ");A(this,"rotateHandlerX");A(this,"rotateHandlerY");A(this,"rotateHandlerZ");A(this,"freeRotatePicker");A(this,"viewRotateCircle");A(this,"viewRotatePicker");A(this,"scaleHandlers");A(this,"scaleCubeX");A(this,"scaleCubeY");A(this,"scaleCubeZ");A(this,"scaleAxisX");A(this,"scaleAxisY");A(this,"scaleAxisZ");A(this,"scalePickerX");A(this,"scalePickerY");A(this,"scalePickerZ");A(this,"scalePickerYZ");A(this,"scalePickerXZ");A(this,"scalePickerXY");A(this,"pickers");A(this,"size",.25);A(this,"orientation","local");A(this,"forcePositiveScale",!0);A(this,"translateSnap",.1);A(this,"rotateSnap",45/180*Math.PI);A(this,"enableTranslate",!0);A(this,"enableRotate",!0);A(this,"enableScale",!0);A(this,"dragStart",!1);A(this,"dragging",!1);A(this,"mode");A(this,"handler");A(this,"position0",new P);A(this,"rotation0",new qe);A(this,"scale0",new P);A(this,"position1",new P);A(this,"rotation1",new qe);A(this,"scale1",new P);A(this,"detTranslation",new P);A(this,"detRotation",new qe);A(this,"detScale",new P);A(this,"mouse0",new P);A(this,"axis",new P);A(this,"raycastPanel",!1);this.renderOrder=1;const t=new Vu(0,.04,.1,12);t.translate(0,.1/2,0),this.translateArrowX=new Ye(t,Yd.clone()),this.translateArrowY=new Ye(t,qd.clone()),this.translateArrowZ=new Ye(t,Kd.clone()),this.translateArrowX.position.set(Lv,0,0),this.translateArrowX.rotation.set(0,0,-Math.PI/2),this.translateArrowY.position.set(0,Lv,0),this.translateArrowY.rotation.set(0,0,0),this.translateArrowZ.position.set(0,0,Lv),this.translateArrowZ.rotation.set(Math.PI/2,0,0),this.add(this.translateArrowX),this.add(this.translateArrowY),this.add(this.translateArrowZ),this.translateArrowXN=this.translateArrowX.clone(),this.translateArrowYN=this.translateArrowY.clone(),this.translateArrowZN=this.translateArrowZ.clone(),this.translateArrowXN.position.negate(),this.translateArrowYN.position.negate(),this.translateArrowZN.position.negate(),this.translateArrowXN.rotation.set(0,0,Math.PI/2),this.translateArrowYN.rotation.set(Math.PI,0,0),this.translateArrowZN.rotation.set(-Math.PI/2,0,0),this.add(this.translateArrowXN),this.add(this.translateArrowYN),this.add(this.translateArrowZN);const s=new Vu(dr,.04+dr,.1+dr,12);s.translate(0,.1/2,0),this.translatePickerX=new Ye(s,si),this.translatePickerY=new Ye(s,si),this.translatePickerZ=new Ye(s,si),this.translatePickerX.position.copy(this.translateArrowX.position),this.translatePickerX.rotation.copy(this.translateArrowX.rotation),this.translatePickerY.position.copy(this.translateArrowY.position),this.translatePickerY.rotation.copy(this.translateArrowY.rotation),this.translatePickerZ.position.copy(this.translateArrowZ.position),this.translatePickerZ.rotation.copy(this.translateArrowZ.rotation),this.add(this.translatePickerX),this.add(this.translatePickerY),this.add(this.translatePickerZ),this.translatePickerX.visible=!1,this.translatePickerY.visible=!1,this.translatePickerZ.visible=!1,this.translatePickerX.userData.name="translate-x",this.translatePickerY.userData.name="translate-y",this.translatePickerZ.userData.name="translate-z",this.translatePickerXN=this.translatePickerX.clone(),this.translatePickerYN=this.translatePickerY.clone(),this.translatePickerZN=this.translatePickerZ.clone(),this.translatePickerXN.position.negate(),this.translatePickerYN.position.negate(),this.translatePickerZN.position.negate(),this.translatePickerXN.rotation.set(0,0,Math.PI/2),this.translatePickerYN.rotation.set(Math.PI,0,0),this.translatePickerZN.rotation.set(-Math.PI/2,0,0),this.add(this.translatePickerXN),this.add(this.translatePickerYN),this.add(this.translatePickerZN),this.translatePickerXN.userData.name="translate-x",this.translatePickerYN.userData.name="translate-y",this.translatePickerZN.userData.name="translate-z",this.freeTranslateHandler=new Ye(new Ta(vi,.0075,3,64,Math.PI*2),si.clone()),this.add(this.freeTranslateHandler),this.freeTranslatePicker=new Ye(new $u(vi,64),si.clone()),this.add(this.freeTranslatePicker),this.freeTranslatePicker.visible=!1,this.freeTranslatePicker.userData.name="translate-free",this.scaleHandlers=new ls,this.add(this.scaleHandlers);const i=new mr(aa,aa,aa);this.scaleCubeX=new Ye(i,Yd.clone()),this.scaleCubeY=new Ye(i,qd.clone()),this.scaleCubeZ=new Ye(i,Kd.clone()),this.scaleCubeX.position.set(Gh,0,0),this.scaleCubeY.position.set(0,Gh,0),this.scaleCubeZ.position.set(0,0,Gh),this.scaleHandlers.add(this.scaleCubeX),this.scaleHandlers.add(this.scaleCubeY),this.scaleHandlers.add(this.scaleCubeZ);const r=new mr(Gh-vi-aa/2,.01,.01);r.translate((Gh-vi-aa/2)/2,0,0),this.scaleAxisX=new Ye(r,this.scaleCubeX.material),this.scaleAxisY=new Ye(r,this.scaleCubeY.material),this.scaleAxisZ=new Ye(r,this.scaleCubeZ.material),this.scaleAxisX.position.set(vi,0,0),this.scaleAxisY.position.set(0,vi,0),this.scaleAxisZ.position.set(0,0,vi),this.scaleAxisX.rotation.set(0,0,0),this.scaleAxisY.rotation.set(0,0,Math.PI/2),this.scaleAxisZ.rotation.set(0,-Math.PI/2,0),this.scaleHandlers.add(this.scaleAxisX),this.scaleHandlers.add(this.scaleAxisY),this.scaleHandlers.add(this.scaleAxisZ);const o=new mr(aa+dr,aa+dr,aa+dr);this.scalePickerX=new Ye(o,si),this.scalePickerY=new Ye(o,si),this.scalePickerZ=new Ye(o,si),this.scalePickerX.position.copy(this.scaleCubeX.position),this.scalePickerY.position.copy(this.scaleCubeY.position),this.scalePickerZ.position.copy(this.scaleCubeZ.position),this.scaleHandlers.add(this.scalePickerX),this.scaleHandlers.add(this.scalePickerY),this.scaleHandlers.add(this.scalePickerZ),this.scalePickerX.visible=!1,this.scalePickerY.visible=!1,this.scalePickerZ.visible=!1,this.scalePickerX.userData.name="scale-x",this.scalePickerY.userData.name="scale-y",this.scalePickerZ.userData.name="scale-z";const a=new mr(1e-7,la,la);this.scalePickerYZ=new Ye(a,Yd.clone()),this.scalePickerXZ=new Ye(a,qd.clone()),this.scalePickerXY=new Ye(a,Kd.clone()),this.scalePickerYZ.rotation.set(0,0,0),this.scalePickerYZ.position.set(0,vi+la/2,vi+la/2),this.scalePickerXZ.rotation.set(0,0,Math.PI/2),this.scalePickerXZ.position.set(vi+la/2,0,vi+la/2),this.scalePickerXY.rotation.set(0,Math.PI/2,0),this.scalePickerXY.position.set(vi+la/2,vi+la/2,0),this.scaleHandlers.add(this.scalePickerYZ),this.scaleHandlers.add(this.scalePickerXZ),this.scaleHandlers.add(this.scalePickerXY),this.scalePickerYZ.userData.name="scale-yz",this.scalePickerXZ.userData.name="scale-xz",this.scalePickerXY.userData.name="scale-xy",this.viewRotateCircle=new Ye(new Ta(pS,.0075,3,64,Math.PI*2),si),this.add(this.viewRotateCircle),this.viewRotatePicker=new Ye(new Ta(pS-dr,.0075+dr,3,64,Math.PI*2),si),this.add(this.viewRotatePicker),this.viewRotatePicker.visible=!1,this.viewRotatePicker.userData.name="rotate-view",this.freeRotatePicker=new Ye(new $u(gG,64),si.clone()),this.freeRotatePicker.material.opacity=.2,this.add(this.freeRotatePicker),this.freeRotatePicker.visible=!1,this.freeRotatePicker.userData.name="rotate-free",this.rotateHandlerX=new Lt,this.rotateHandlerY=new Lt,this.rotateHandlerZ=new Lt,this.add(this.rotateHandlerX),this.add(this.rotateHandlerY),this.add(this.rotateHandlerZ);const l=new Ta(gu,.0075,3,64,Math.PI);l.rotateY(Math.PI/2),l.rotateX(Math.PI/2),this.rotateCircleX=new Ye(l,Yd.clone()),this.rotateCircleY=new Ye(l,qd.clone()),this.rotateCircleZ=new Ye(l,Kd.clone()),this.rotateCircleX.rotation.set(0,0,0),this.rotateCircleY.rotation.set(0,0,-Math.PI/2),this.rotateCircleZ.rotation.set(0,Math.PI/2,0),this.rotateHandlerX.add(this.rotateCircleX),this.rotateHandlerY.add(this.rotateCircleY),this.rotateHandlerZ.add(this.rotateCircleZ);const c=new Ta(.45-dr,.0075+dr,3,64,Math.PI);c.rotateY(Math.PI/2),c.rotateX(Math.PI/2),this.rotatePickerX=new Ye(c,si),this.rotatePickerY=new Ye(c,si),this.rotatePickerZ=new Ye(c,si),this.rotatePickerY.rotation.copy(this.rotateCircleY.rotation),this.rotatePickerX.rotation.copy(this.rotateCircleX.rotation),this.rotatePickerZ.rotation.copy(this.rotateCircleZ.rotation),this.rotateHandlerX.add(this.rotatePickerX),this.rotateHandlerY.add(this.rotatePickerY),this.rotateHandlerZ.add(this.rotatePickerZ),this.rotatePickerX.visible=!1,this.rotatePickerY.visible=!1,this.rotatePickerZ.visible=!1,this.rotatePickerX.userData.name="rotate-x",this.rotatePickerY.userData.name="rotate-y",this.rotatePickerZ.userData.name="rotate-z",this.pickers=[this.translatePickerX,this.translatePickerY,this.translatePickerZ,this.translatePickerXN,this.translatePickerYN,this.translatePickerZN,this.freeTranslatePicker,this.rotatePickerX,this.rotatePickerY,this.rotatePickerZ,this.freeRotatePicker,this.viewRotatePicker,this.scalePickerX,this.scalePickerY,this.scalePickerZ,this.scalePickerYZ,this.scalePickerXZ,this.scalePickerXY]}setTargetTransform(t,s,i){this.dragging||(this.position0.copy(t),this.rotation0.copy(s),this.scale0.copy(i))}setTargetTransformFromMatrix(t){this.dragging||(t.decompose(this.position0,this.rotation0,this.scale0),this.rotation0.normalize())}update(t,s,i,r,o,a){if(!this.visible)return;this.position.copy(this.dragging?this.position1:this.position0),this.orientation==="local"?(this.quaternion.copy(this.dragging?this.rotation1:this.rotation0),this.scaleHandlers.quaternion.set(0,0,0,1)):(this.quaternion.set(0,0,0,1),this.scaleHandlers.quaternion.copy(this.dragging?this.rotation1:this.rotation0)),this.updateWorldMatrix(!1,!1),oo.set(1,0,0).transformDirection(this.matrixWorld),ao.set(0,1,0).transformDirection(this.matrixWorld),lo.set(0,0,1).transformDirection(this.matrixWorld),mS.copy(this.matrixWorld).invert(),Hh.copy(t._dir).transformDirection(mS);let l;if(t.perspective){const f=t.perspectiveCamera;l=this.position.distanceTo(f.position)*Math.min(1.9*Math.tan(Math.PI*f.fov/360)/f.zoom,7)}else{const f=t.orthographicCamera;l=(f.top-f.bottom)/f.zoom}this.scale.setScalar(l*this.size),bn.set(1,0,0),fs.set(0,0,1),this.rotateHandlerX.quaternion.setFromAxisAngle(bn,Nl(bn,fs,Hh)),bn.set(0,1,0),fs.set(0,0,1),this.rotateHandlerY.quaternion.setFromAxisAngle(bn,Nl(bn,fs,Hh)),bn.set(0,0,1),fs.set(1,0,0),this.rotateHandlerZ.quaternion.setFromAxisAngle(bn,Nl(bn,fs,Hh)),bn.set(0,0,1),this.viewRotateCircle.quaternion.setFromUnitVectors(bn,Hh),this.viewRotatePicker.quaternion.copy(this.viewRotateCircle.quaternion),this.freeTranslateHandler.quaternion.copy(this.viewRotateCircle.quaternion),this.freeTranslatePicker.quaternion.copy(this.freeTranslateHandler.quaternion),this.freeRotatePicker.quaternion.copy(this.viewRotateCircle.quaternion);for(let f of this.children)f.updateWorldMatrix(!1,!0);const c=Ov.crossVectors(t._dir,oo).lengthSq()>1e-6,h=Ov.crossVectors(t._dir,ao).lengthSq()>1e-6,d=Ov.crossVectors(t._dir,lo).lengthSq()>1e-6;if(this.dragStart=!1,this.dragging)if(this.translateArrowX.visible=this.translateArrowXN.visible=this.handler==="translate-x",this.translateArrowY.visible=this.translateArrowYN.visible=this.handler==="translate-y",this.translateArrowZ.visible=this.translateArrowZN.visible=this.handler==="translate-z",this.freeTranslateHandler.visible=!0,this.rotateCircleX.visible=this.handler==="rotate-x",this.rotateCircleY.visible=this.handler==="rotate-y",this.rotateCircleZ.visible=this.handler==="rotate-z",this.scaleCubeX.visible=this.scaleAxisX.visible=this.handler==="scale-x",this.scaleCubeY.visible=this.scaleAxisY.visible=this.handler==="scale-y",this.scaleCubeZ.visible=this.scaleAxisZ.visible=this.handler==="scale-z",this.scalePickerYZ.visible=this.handler==="scale-yz",this.scalePickerXZ.visible=this.handler==="scale-xz",this.scalePickerXY.visible=this.handler==="scale-xy",this.viewRotateCircle.visible=!0,this.freeRotatePicker.visible=!1,i.mouseLeft)switch(this.mode){case"translate":this.handler==="translate-free"?Qt(Is,r,o,this.position0,a):Ro(Is,null,this.position0,this.axis,r,a),this.detTranslation.subVectors(Is,this.mouse0),i.isKeyPressed("Shift")&&Eu(this.detTranslation,this.translateSnap),this.position1.addVectors(this.position0,this.detTranslation),this.position.copy(this.position1),this.updateMatrix();break;case"rotate":switch(this.handler){case"rotate-free":B_(Is,r,o,this.position0,gu*l*this.size)||Qt(Is,r,o,this.position0,t._dir),bn.subVectors(this.mouse0,this.position0).normalize(),fs.subVectors(Is,this.position0).normalize(),ii.setFromUnitVectors(bn,fs),this.detRotation.copy(ii),rm.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(ii),om.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(ii),Ua(this.rotation1,rm,om);break;case"rotate-view":{Qt(Is,r,o,this.position0,a),bn.subVectors(this.mouse0,this.position0),fs.subVectors(Is,this.position0);const f=t._dir;let p=Nl(f,bn,fs);i.isKeyPressed("Shift")&&(p=Math.round(p/this.rotateSnap)*this.rotateSnap),ii.setFromAxisAngle(f,p),this.detRotation.copy(ii),rm.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(ii),om.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(ii),Ua(this.rotation1,rm,om)}break;default:{switch(this.handler){case"rotate-x":Wh.set(1,0,0);break;case"rotate-y":Wh.set(0,1,0);break;case"rotate-z":Wh.set(0,0,1);break}if(this.raycastPanel){Qt(Is,r,o,this.position0,a),bn.subVectors(this.mouse0,this.position0),fs.subVectors(Is,this.position0);let f=Nl(this.axis,bn,fs)||0;i.isKeyPressed("Shift")&&(f=Math.round(f/this.rotateSnap)*this.rotateSnap),ii.setFromAxisAngle(Wh,f),this.detRotation.copy(ii),this.rotation1.multiplyQuaternions(this.rotation0,ii)}else{const f=gu*l*this.size;jh.crossVectors(this.axis,t._dir).normalize(),Ro(Is,null,this.position0,jh,r,a);const p=.25;let g=bn.subVectors(Is,this.mouse0).dot(jh)/f*Math.PI/2*p;i.isKeyPressed("Shift")&&(g=Math.round(g/this.rotateSnap)*this.rotateSnap),ii.setFromAxisAngle(Wh,g),this.detRotation.copy(ii),this.rotation1.multiplyQuaternions(this.rotation0,ii)}}break}break;case"scale":if(this.raycastPanel){Qt(Is,r,o,this.position0,this.axis);let f=1,p=1,g=1;switch(bn.subVectors(this.mouse0,this.position0).negate(),fs.subVectors(Is,this.position0).negate(),i.isKeyPressed("Shift")?f=p=g=fs.length()/bn.length():(oo.set(1,0,0).applyQuaternion(this.scaleHandlers.quaternion),ao.set(0,1,0).applyQuaternion(this.scaleHandlers.quaternion),lo.set(0,0,1).applyQuaternion(this.scaleHandlers.quaternion),f=fs.dot(oo)/bn.dot(oo),p=fs.dot(ao)/bn.dot(ao),g=fs.dot(lo)/bn.dot(lo),this.forcePositiveScale&&(f=Math.abs(f),p=Math.abs(p),g=Math.abs(g))),this.handler){case"scale-yz":f=1;break;case"scale-xz":p=1;break;case"scale-xy":g=1;break}this.detScale.set(f,p,g),this.scale1.copy(this.scale0).multiply(this.detScale)}else{Ro(Is,null,this.position0,this.axis,r,a);const f=-bn.subVectors(this.mouse0,this.position0).dot(this.axis);let g=-fs.subVectors(Is,this.position0).dot(this.axis)/f;if(this.forcePositiveScale&&(g=Math.abs(g)),i.isKeyPressed("Shift"))this.detScale.setScalar(g),this.scale1.copy(this.scale0).multiplyScalar(g);else switch(this.scale1.copy(this.scale0),this.handler){case"scale-x":this.detScale.set(g,1,1),this.scale1.x*=g;break;case"scale-y":this.detScale.set(1,g,1),this.scale1.y*=g;break;case"scale-z":this.detScale.set(1,1,g),this.scale1.z*=g;break}}break}else this.dragging=!1,this.mode=void 0,this.position0.copy(this.position1),this.rotation0.copy(this.rotation1),this.scale0.copy(this.scale1);else{let f=!1,p=!1,g=!1,m,v;for(let y of s.intersectObjects(this.pickers))switch(y.object.userData.name){case"translate-x":!m&&c&&this.enableTranslate&&(m="translate-x");break;case"translate-y":!m&&h&&this.enableTranslate&&(m="translate-y");break;case"translate-z":!m&&d&&this.enableTranslate&&(m="translate-z");break;case"translate-free":this.enableTranslate&&(f=!0);break;case"rotate-x":!v&&this.enableRotate&&(v="rotate-x");break;case"rotate-y":!v&&this.enableRotate&&(v="rotate-y");break;case"rotate-z":!v&&this.enableRotate&&(v="rotate-z");break;case"rotate-view":this.enableRotate&&(g=!0);break;case"rotate-free":this.enableRotate&&(p=!0);break;case"scale-x":!m&&c&&this.enableScale&&(m="scale-x");break;case"scale-y":!m&&h&&this.enableScale&&(m="scale-y");break;case"scale-z":!m&&d&&this.enableScale&&(m="scale-z");break;case"scale-yz":!m&&h&&d&&this.enableScale&&(m="scale-yz");break;case"scale-xz":!m&&c&&d&&this.enableScale&&(m="scale-xz");break;case"scale-xy":!m&&c&&h&&this.enableScale&&(m="scale-xy");break}if(this.handler=void 0,m?this.handler=m:v?this.handler=v:f?this.handler="translate-free":p?this.handler="rotate-free":g&&(this.handler="rotate-view"),this.updateOpacity(this.translateArrowX,this.handler==="translate-x"||!this.handler),this.updateOpacity(this.translateArrowY,this.handler==="translate-y"||!this.handler),this.updateOpacity(this.translateArrowZ,this.handler==="translate-z"||!this.handler),this.updateOpacity(this.rotateCircleX,this.handler==="rotate-x"||!this.handler),this.updateOpacity(this.rotateCircleY,this.handler==="rotate-y"||!this.handler),this.updateOpacity(this.rotateCircleZ,this.handler==="rotate-z"||!this.handler),this.updateOpacity(this.scaleCubeX,this.handler==="scale-x"||!this.handler),this.updateOpacity(this.scaleCubeY,this.handler==="scale-y"||!this.handler),this.updateOpacity(this.scaleCubeZ,this.handler==="scale-z"||!this.handler),this.updateOpacity(this.scaleAxisX,this.handler==="scale-x"||!this.handler),this.updateOpacity(this.scaleAxisY,this.handler==="scale-y"||!this.handler),this.updateOpacity(this.scaleAxisZ,this.handler==="scale-z"||!this.handler),this.updateOpacity(this.scalePickerYZ,this.handler==="scale-yz"||!this.handler),this.updateOpacity(this.scalePickerXZ,this.handler==="scale-xz"||!this.handler),this.updateOpacity(this.scalePickerXY,this.handler==="scale-xy"||!this.handler),this.updateOpacity(this.viewRotateCircle,this.handler==="rotate-view"||!this.handler),this.updateOpacity(this.freeTranslateHandler,this.handler==="translate-free"||!this.handler),this.freeRotatePicker.visible=this.handler==="rotate-free"&&this.enableRotate,this.translateArrowX.visible=this.translateArrowXN.visible=c&&this.enableTranslate,this.translateArrowY.visible=this.translateArrowYN.visible=h&&this.enableTranslate,this.translateArrowZ.visible=this.translateArrowZN.visible=d&&this.enableTranslate,this.rotateCircleX.visible=this.enableRotate,this.rotateCircleY.visible=this.enableRotate,this.rotateCircleZ.visible=this.enableRotate,this.scaleCubeX.visible=this.scaleAxisX.visible=c&&this.enableScale,this.scaleCubeY.visible=this.scaleAxisY.visible=h&&this.enableScale,this.scaleCubeZ.visible=this.scaleAxisZ.visible=d&&this.enableScale,this.scalePickerYZ.visible=h&&d&&this.enableScale,this.scalePickerXZ.visible=c&&d&&this.enableScale,this.scalePickerXY.visible=c&&h&&this.enableScale,this.viewRotateCircle.visible=!0,this.freeTranslateHandler.visible=!0,i.mouseLeftDownThisFrame&&this.handler){switch(this.dragStart=!0,this.dragging=!0,this.handler){case"translate-x":case"translate-y":case"translate-z":this.mode="translate",this.axis.copy(this.handler==="translate-x"?oo:this.handler==="translate-y"?ao:lo),Ro(this.mouse0,null,this.position0,this.axis,r,a);break;case"translate-free":this.mode="translate",Qt(this.mouse0,r,o,this.position0,a);break;case"rotate-x":case"rotate-y":case"rotate-z":{this.mode="rotate",this.axis.copy(this.handler==="rotate-x"?oo:this.handler==="rotate-y"?ao:lo);let y=mu(Math.abs(a.angleTo(this.axis)));y=y/Math.PI*180,this.raycastPanel=Math.abs(y-90)>15,this.raycastPanel?Qt(this.mouse0,r,o,this.position0,a):(jh.crossVectors(this.axis,t._dir).normalize(),Ro(this.mouse0,null,this.position0,jh,r,a))}break;case"rotate-free":this.mode="rotate",B_(this.mouse0,r,o,this.position0,gu*l*this.size)||Qt(this.mouse0,r,o,this.position0,t._dir);break;case"rotate-view":this.mode="rotate",Qt(this.mouse0,r,o,this.position0,a);break;case"scale-x":case"scale-y":case"scale-z":{switch(this.mode="scale",this.raycastPanel=!1,this.handler){case"scale-x":this.axis.copy(oo);break;case"scale-y":this.axis.copy(ao);break;case"scale-z":this.axis.copy(lo);break}this.axis.applyQuaternion(this.scaleHandlers.quaternion),Ro(this.mouse0,null,this.position0,this.axis,r,a)}break;case"scale-yz":case"scale-xz":case"scale-xy":{switch(this.mode="scale",this.raycastPanel=!0,this.handler){case"scale-yz":this.axis.copy(oo);break;case"scale-xz":this.axis.copy(ao);break;case"scale-xy":this.axis.copy(lo);break}this.axis.applyQuaternion(this.scaleHandlers.quaternion),Qt(this.mouse0,r,o,this.position0,this.axis)}break}this.position1.copy(this.position0),this.rotation1.copy(this.rotation0),this.scale1.copy(this.scale0)}}}updateOpacity(t,s,i=.35,r=1){const o=t.material;o.opacity=s?r:i}}u(nw,"Gizmo");dG(nw,"Gizmo");var vG=Object.defineProperty,yG=u((n,e)=>vG(n,"name",{value:e,configurable:!0}),"__name$3l");class sw{constructor(){A(this,"element");A(this,"pointerOver",!1);A(this,"pointerX",0);A(this,"pointerY",0);A(this,"pressure",0);A(this,"mouseLeft",!1);A(this,"mouseLeftDownThisFrame",!1);A(this,"mouseRight",!1);A(this,"mouseRightDownThisFrame",!1);A(this,"mouseMiddle",!1);A(this,"mouseMiddleDownThisFrame",!1);A(this,"doubleClick",!1);A(this,"wheelDetX",0);A(this,"wheelDetY",0);A(this,"onContextmenu");A(this,"onPointerMove");A(this,"onPointerDown");A(this,"onPointerUp");A(this,"onPointerLeave");A(this,"onPointerOut");A(this,"onDblClick");A(this,"onWheel");A(this,"onKeyDown");A(this,"onKeyUp");A(this,"onBlur");A(this,"keyMap",new Map);A(this,"timestamp",0);this.onContextmenu=e=>{e.target===this.element&&e.preventDefault()},this.onPointerMove=e=>{e.target===this.element&&(this.pressure=e.pressure,this.pointerOver=!0,this.pointerX=e.offsetX,this.pointerY=e.offsetY)},this.onPointerDown=e=>{if(e.target===this.element)switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!0,this.mouseLeftDownThisFrame=!0;break;case 1:this.mouseMiddle=!0,this.mouseMiddleDownThisFrame=!0;break;case 2:this.mouseRight=!0,this.mouseRightDownThisFrame=!0;break}},this.onPointerUp=e=>{switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1;break;case 1:this.mouseMiddle=!1,this.mouseMiddleDownThisFrame=!1;break;case 2:this.mouseRight=!1,this.mouseLeftDownThisFrame=!1;break}},this.onPointerLeave=()=>{this.pressure=0,this.pointerOver=!1},this.onPointerOut=e=>{(e.clientY<=0||e.clientX<=0||e.clientX>=window.innerWidth||e.clientY>=window.innerHeight)&&(this.pressure=0,this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1,this.mouseRight=!1,this.mouseLeftDownThisFrame=!1)},this.onDblClick=e=>{this.doubleClick=!0},this.onWheel=e=>{e.preventDefault(),this.wheelDetX+=e.deltaX/100,this.wheelDetY+=e.deltaY/100},this.onKeyDown=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||((e.altKey||e.ctrlKey||e.key==="Tab")&&e.preventDefault(),this.keyMap.has(e.key)||this.keyMap.set(e.key,this.timestamp))},this.onKeyUp=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||this.keyMap.delete(e.key)},this.onBlur=()=>{this.keyMap.clear()}}setup(e){this.unload(),this.element=e,e.addEventListener("contextmenu",this.onContextmenu),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerleave",this.onPointerLeave),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointerout",this.onPointerOut),e.addEventListener("dblclick",this.onDblClick),e.addEventListener("wheel",this.onWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}unload(){const e=this.element;!e||(e.removeEventListener("contextmenu",this.onContextmenu),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerleave",this.onPointerLeave),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointerout",this.onPointerOut),e.removeEventListener("dblclick",this.onDblClick),e.removeEventListener("wheel",this.onWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur),this.element=void 0)}update(){this.mouseLeftDownThisFrame=!1,this.mouseRightDownThisFrame=!1,this.mouseMiddleDownThisFrame=!1,this.doubleClick=!1,this.wheelDetX=0,this.wheelDetY=0,this.timestamp=Date.now()}isKeyPressed(e){return this.keyMap.has(e)}isKeyPressedThisFrame(e){return this.keyMap.get(e)===this.timestamp}isKeyRepeated(e,t=150){const s=this.keyMap.get(e);if(s==null)return!1;const i=this.timestamp-s;return i>=t||i===0?(this.keyMap.set(e,this.timestamp),!0):!1}}u(sw,"Input");yG(sw,"Input");var _G=Object.defineProperty,kR=u((n,e)=>_G(n,"name",{value:e,configurable:!0}),"__name$3k");class vu{constructor(e,t,s,i,r,o){A(this,"ctx");A(this,"index");A(this,"enabled",!0);A(this,"element");A(this,"camera",new s1);A(this,"zoomLevel",0);A(this,"left",0);A(this,"bottom",0);A(this,"width",0);A(this,"height",0);A(this,"input",new sw);A(this,"mouseScr",new $e);A(this,"mouseNdc",new P);A(this,"mouseRay0",new P);A(this,"mouseRay1",new P);A(this,"mouseRayN",new P);A(this,"raycaster",new xR);A(this,"gizmo",new nw);A(this,"gizmoEnabled",!1);A(this,"defaultLights");A(this,"defaultLight1");A(this,"defaultLight2");A(this,"defaultLight3");this.ctx=e,this.index=t,this.element=s,this.input.setup(s),this.camera.alpha=i,this.camera.beta=r,this.camera.perspective=o,e.scene.add(this.gizmo),this.gizmo.visible=!1,this.defaultLights=new ls,e.scene.add(this.defaultLights),this.defaultLight1=new ka(16777215,.35),this.defaultLight2=new ka(16777215,.35),this.defaultLight3=new ka(16777215,.35),this.defaultLight1.position.set(0,2,0),this.defaultLight2.position.set(-2,-1,0),this.defaultLight3.position.set(2,-1,0),this.defaultLights.add(this.defaultLight1),this.defaultLights.add(this.defaultLight2),this.defaultLights.add(this.defaultLight3)}update(){const e=this.element.getBoundingClientRect();this.left=e.left,this.bottom=e.bottom,this.width=e.width,this.height=e.height,this.width&&this.height?this.camera.update(this.width,this.height):this.enabled=!1}dispose(){this.defaultLight1.dispose(),this.defaultLight2.dispose(),this.defaultLight3.dispose(),this.input.unload()}mousePick(e){return this.raycaster.intersectObjects(this.ctx.readonlyRef().scene.children.filter(t=>{if(!t.visible)return!1;const s=t.userData.node;return s!=null&&s.visible?!e||s.type===e:!1})).filter(t=>{const s=t.object.userData.node;return s==null?void 0:s.visible})}mousePickVisible(){const e=this.ctx.readonlyRef().scene.children.filter(i=>{if(!i.visible)return!1;const r=i.userData.node;return r==null?void 0:r.visible}),t=kR((i,r,o)=>{if(!!i.visible){i.layers.test(r.layers)&&i.raycast(r,o);for(let a of i.children)t(a,r,o)}},"intersectObjects"),s=[];for(let i of e)t(i,this.raycaster,s);return s.sort((i,r)=>i.distance-r.distance)}}u(vu,"EditorView");kR(vu,"EditorView");var bG=Object.defineProperty,i1=u((n,e)=>bG(n,"name",{value:e,configurable:!0}),"__name$3j");async function Wu(n){return new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(new Blob([n]))})}u(Wu,"bufferToDataUrl");i1(Wu,"bufferToDataUrl");async function iw(n){return(await fetch(n)).arrayBuffer()}u(iw,"dataUrlToArrayBuffer");i1(iw,"dataUrlToArrayBuffer");const r0=new DataView(new ArrayBuffer(4));function rw(n){const e=new Uint8Array(n.length*4);for(let t=0,s=n.length;t<s;++t){r0.setFloat32(0,n[t]);const i=t*4;for(let r=0;r<4;++r)e[i+r]=r0.getUint8(r)}return e}u(rw,"float32ArrayToBytes");i1(rw,"float32ArrayToBytes");function ow(n){const e=new Float32Array(n.length/4);for(let t=0,s=e.length;t<s;++t){const i=t*4;for(let r=0;r<4;++r)r0.setUint8(r,n[i+r]);e[t]=r0.getFloat32(0)}return e}u(ow,"bytesToFloat32Array");i1(ow,"bytesToFloat32Array");var wG=Object.defineProperty,xG=u((n,e)=>wG(n,"name",{value:e,configurable:!0}),"__name$3i");class Fe{onRemoved(){}}u(Fe,"ModelNodeComponent");xG(Fe,"ModelNodeComponent");var AG=Object.defineProperty,aw=u((n,e)=>AG(n,"name",{value:e,configurable:!0}),"__name$3h"),ke=(n=>(n[n.NUMBER=1]="NUMBER",n[n.STRING=2]="STRING",n[n.BOOLEAN=3]="BOOLEAN",n[n.NUMBER_ARRAY=4]="NUMBER_ARRAY",n[n.BYTES=5]="BYTES",n))(ke||{});const lw={};function Be(n){return function(e){if(!e.name.startsWith("C"))throw new Error('Component class name should be prefixed with "C"');if(n.storable&&n.dataType==null)throw new Error(`Component [${e.name}] missing data type`);lw[e.name]=Object.assign({constructor:e},n)}}u(Be,"registerModelComponent");aw(Be,"registerModelComponent");function NR(n){return!!lw[n]}u(NR,"isModelNodeComponentDefExists");aw(NR,"isModelNodeComponentDefExists");function ti(n){const e=lw[n];if(!e)throw new Error(`Component def [${n}] not found`);return e}u(ti,"getModelNodeComponentDef");aw(ti,"getModelNodeComponentDef");var FR=Object.defineProperty,MG=Object.getOwnPropertyDescriptor,SG=u((n,e)=>FR(n,"name",{value:e,configurable:!0}),"__name$3g"),CG=u((n,e,t,s)=>{for(var i=s>1?void 0:s?MG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&FR(e,t,i),i},"__decorateClass$1d");let Mr=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new Float32Array);A(this,"dirty",!0);A(this,"partialUpdate",!1)}},"CColors");SG(Mr,"CColors");Mr=CG([Be({storable:!0,dataType:ke.BYTES,clone(n){return new Float32Array(n)},serialize:rw,deserialize:ow})],Mr);var zR=Object.defineProperty,EG=Object.getOwnPropertyDescriptor,TG=u((n,e)=>zR(n,"name",{value:e,configurable:!0}),"__name$3f"),PG=u((n,e,t,s)=>{for(var i=s>1?void 0:s?EG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&zR(e,t,i),i},"__decorateClass$1c");let Xn=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new P)}},"CFlipDirection");TG(Xn,"CFlipDirection");Xn=PG([Be({storable:!0,dataType:ke.NUMBER_ARRAY,instanceable:!0,equal:Tr,clone(n){return new P().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new P(n[0],n[1],n[2])}})],Xn);var BR=Object.defineProperty,RG=Object.getOwnPropertyDescriptor,IG=u((n,e)=>BR(n,"name",{value:e,configurable:!0}),"__name$3e"),DG=u((n,e,t,s)=>{for(var i=s>1?void 0:s?RG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&BR(e,t,i),i},"__decorateClass$1b");let je=u(class extends Fe{constructor(){super(...arguments);A(this,"value",null);A(this,"dirty",!0);A(this,"matrix",new be);A(this,"matDirty",!0);A(this,"placeholder");A(this,"useTempMat",!1);A(this,"tempMat",new be)}onRemoved(){this.placeholder&&this.placeholder.removeFromParent()}},"CGeom3");IG(je,"CGeom3");je=DG([Be({})],je);var UR=Object.defineProperty,LG=Object.getOwnPropertyDescriptor,cw=u((n,e)=>UR(n,"name",{value:e,configurable:!0}),"__name$3d"),OG=u((n,e,t,s)=>{for(var i=s>1?void 0:s?LG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&UR(e,t,i),i},"__decorateClass$1a");let Pe=u(class extends Fe{constructor(){super(...arguments);A(this,"value",null);A(this,"parentChanged",!0);A(this,"localTransformChanged",!0);A(this,"worldTransformChanged",!0);A(this,"mesh");A(this,"instance",!1);A(this,"usePlainMaterial",!1)}onRemoved(){this.dispose()}dispose(){this.value&&(this.instance||nc(this.value),this.value.removeFromParent(),this.value=null)}},"CObject3D");cw(Pe,"CObject3D");Pe=OG([Be({})],Pe);function nc(n){for(let t of n.children)nc(t);if(n.isInstancedMesh)return;if("geometry"in n){const t=n.geometry;t&&t.dispose()}if("material"in n){const t=n.material;t&&(t instanceof Array?t.forEach(cu):cu(t))}const e=n;e.__originalMaterial&&(e.__originalMaterial instanceof Array?e.__originalMaterial.forEach(cu):cu(e.__originalMaterial)),e.__plainMaterial&&cu(e.__plainMaterial)}u(nc,"disposeObject3D");cw(nc,"disposeObject3D");function cu(n){Object.keys(n).forEach(e=>{const t=n[e];t&&typeof t=="object"&&typeof t.dispose=="function"&&t.dispose()}),n.dispose()}u(cu,"disposeMaterial");cw(cu,"disposeMaterial");var $R=Object.defineProperty,kG=Object.getOwnPropertyDescriptor,NG=u((n,e)=>$R(n,"name",{value:e,configurable:!0}),"__name$3c"),FG=u((n,e,t,s)=>{for(var i=s>1?void 0:s?kG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&$R(e,t,i),i},"__decorateClass$19");let Mn=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new Float32Array);A(this,"dirty",!0);A(this,"partialUpdate",!1)}},"CVertices");NG(Mn,"CVertices");Mn=FG([Be({storable:!0,dataType:ke.BYTES,clone(n){return new Float32Array(n)},serialize:rw,deserialize:ow})],Mn);var zG=Object.defineProperty,Xh=u((n,e)=>zG(n,"name",{value:e,configurable:!0}),"__name$3b"),BG=Ht({components:{InputNumber:rs},props:{value:{type:Array,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},maxDet:{type:Number,required:!0},step:{type:Number,default:1}},emits:["input"],setup(n,e){const t=Ne(),s=ct(function(){let f=n.min,p=n.max;return{left:(n.value[0]-f)/(p-f)*100+"%"}}),i=ct(function(){let f=n.min,p=n.max;return{left:(n.value[1]-f)/(p-f)*100+"%"}}),r=ct(function(){let f=n.min,p=n.max;return{left:(n.value[0]-f)/(p-f)*100+"%",width:(n.value[1]-n.value[0])/(p-f)*100+"%"}});function o(f){let p=Math.min(n.max,Math.max(n.min,Math.round(f/n.step)*n.step)),g=n.value[1];g<p&&(g=p),g-p>n.maxDet&&(g=Math.min(n.max,Math.max(n.min,p+n.maxDet))),e.emit("input",[p,g])}u(o,"inputValue1"),Xh(o,"inputValue1");function a(f){let p=n.value[0],g=Math.min(n.max,Math.max(n.min,Math.round(f/n.step)*n.step));p>g&&(p=g),g-p>n.maxDet&&(p=Math.min(n.max,Math.max(n.min,g-n.maxDet))),e.emit("input",[p,g])}u(a,"inputValue2"),Xh(a,"inputValue2");let l="bar";function c(){switch(l){case"bar":let f=Math.min(n.max,Math.max(n.min,Math.round((n.value[0]-n.step)/n.step)*n.step));if(f>=n.min){let p=Math.min(n.max,Math.max(n.min,Math.round((n.value[1]+(f-n.value[0]))/n.step)*n.step));e.emit("input",[f,p])}break;case"val1":o(n.value[0]-n.step);break;case"val2":a(n.value[1]-n.step);break}}u(c,"moveLeft"),Xh(c,"moveLeft");function h(){switch(l){case"bar":let f=Math.min(n.max,Math.max(n.min,Math.round((n.value[1]+n.step)/n.step)*n.step));if(f<=n.max){let p=Math.min(n.max,Math.max(n.min,Math.round((n.value[0]+(f-n.value[1]))/n.step)*n.step));e.emit("input",[p,f])}break;case"val1":o(n.value[0]+n.step);break;case"val2":a(n.value[1]+n.step);break}}u(h,"moveRight"),Xh(h,"moveRight");function d(f){const g=t.value.getBoundingClientRect(),m=f.clientX-g.left,v=n.value[0],y=n.value[1],b=n.min,_=n.max;l="bar",m<=(n.value[0]-b)/(_-b)*g.width+2&&(l="val1"),m>=(n.value[1]-b)/(_-b)*g.width-2&&(l="val2"),ec(f,w=>{const S=t.value.getBoundingClientRect(),C=w.clientX-S.left,M=Math.min(1,Math.max(0,C/S.width)),R=(n.max-n.min)*M+n.min;switch(l){case"bar":const D=(C-m)/S.width*(n.max-n.min);if(D<0){let k=Math.min(n.max,Math.max(n.min,Math.round((v+D)/n.step)*n.step));if(k>=n.min){let T=Math.min(n.max,Math.max(n.min,Math.round((y+(k-v))/n.step)*n.step));e.emit("input",[k,T])}}else{let k=Math.min(n.max,Math.max(n.min,Math.round((y+D)/n.step)*n.step));if(k<=n.max){let T=Math.min(n.max,Math.max(n.min,Math.round((v+(k-y))/n.step)*n.step));e.emit("input",[T,k])}}break;case"val1":R<=n.value[1]&&n.value[1]-R<=n.maxDet&&o(R);break;case"val2":R>=n.value[0]&&R-n.value[0]<=n.maxDet&&a(R);break}})}return u(d,"onPointerDown"),Xh(d,"onPointerDown"),{bar:t,slider1Style:s,slider2Style:i,sliderBarStyle:r,inputValue1:o,inputValue2:a,moveLeft:c,moveRight:h,onPointerDown:d}}});const UG={class:"input-double-range"},$G={class:"input-double-range__slider-container",ref:"bar"};function VG(n,e,t,s,i,r){const o=ln("input-number");return Se(),Oe("div",UG,[we(o,{value:n.value[0],onInput:n.inputValue1},null,8,["value","onInput"]),j("div",{class:"input-double-range__bar",tabindex:"0",onKeydown:[e[0]||(e[0]=Ln((...a)=>n.moveLeft&&n.moveLeft(...a),["left"])),e[1]||(e[1]=Ln((...a)=>n.moveRight&&n.moveRight(...a),["right"]))],onPointerdown:e[2]||(e[2]=(...a)=>n.onPointerDown&&n.onPointerDown(...a))},[j("div",$G,[j("div",{class:"input-double-range__slider-bar",style:On(n.sliderBarStyle)},null,4),j("div",{class:"input-double-range__slider",style:On(n.slider1Style)},null,4),j("div",{class:"input-double-range__slider",style:On(n.slider2Style)},null,4)],512)],32),we(o,{value:n.value[1],onInput:n.inputValue2},null,8,["value","onInput"])])}u(VG,"_sfc_render$m");var VR=jt(BG,[["render",VG],["__scopeId","data-v-5aca574d"]]),GR=Object.defineProperty,GG=Object.getOwnPropertyDescriptor,HG=u((n,e)=>GR(n,"name",{value:e,configurable:!0}),"__name$3a"),WG=u((n,e,t,s)=>{for(var i=s>1?void 0:s?GG(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&GR(e,t,i),i},"__decorateClass$18");let ju=u(class extends Fe{constructor(){super(...arguments);A(this,"value",[0,360])}},"CAngleRange");HG(ju,"CAngleRange");ju=WG([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,label:"Angle",inputComponent:VR,inputComponentProps:{min:0,max:360,maxDet:360}})],ju);var jG=Object.defineProperty,Yh=u((n,e)=>jG(n,"name",{value:e,configurable:!0}),"__name$39"),XG=Ht({props:{value:{type:P,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean,defaultValue:P},emits:["input"],setup(n,e){const t=Ne(),s=Ne(),i=Ne();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}u(o,"postOnMouseDown"),Yh(o,"postOnMouseDown");function a(d){return Number(d.toFixed(3))}u(a,"format"),Yh(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}u(l,"onChange"),Yh(l,"onChange"),Wa(function(){document.removeEventListener("mousedown",o)});function c(){var d,f,p;if(r){r=!1;let g=Number(((d=t.value)==null?void 0:d.value)||"0")||0,m=Number(((f=s.value)==null?void 0:f.value)||"0")||0,v=Number(((p=i.value)==null?void 0:p.value)||"0")||0;e.emit("input",new P(g,m,v))}}u(c,"onPost"),Yh(c,"onPost");function h(){const d=new P;n.defaultValue&&d.copy(n.defaultValue),e.emit("input",d)}return u(h,"onReset"),Yh(h,"onReset"),{input0:t,input1:s,input2:i,format:a,onChange:l,onPost:c,onReset:h}}});const YG=u(n=>(Ga("data-v-792b48dc"),n=n(),Ha(),n),"_withScopeId$3"),qG={class:"input-vec3"},KG=["value","readonly","disabled"],ZG=["value","readonly","disabled"],QG=["value","readonly","disabled"],JG=YG(()=>j("img",{src:n1,alt:""},null,-1)),eH=[JG];function tH(n,e,t,s,i,r){return Se(),Oe("div",qG,[j("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,KG),j("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,ZG),j("input",{type:"text",placeholder:"z",value:n.format(n.value.z),readonly:n.readonly,disabled:n.disabled,onInput:e[6]||(e[6]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[8]||(e[8]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input2"},null,40,QG),n.resettable?(Se(),Oe("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>n.onReset&&n.onReset(...o))},eH)):tt("",!0)])}u(tH,"_sfc_render$l");var op=jt(XG,[["render",tH],["__scopeId","data-v-792b48dc"]]),HR=Object.defineProperty,nH=Object.getOwnPropertyDescriptor,sH=u((n,e)=>HR(n,"name",{value:e,configurable:!0}),"__name$38"),iH=u((n,e,t,s)=>{for(var i=s>1?void 0:s?nH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&HR(e,t,i),i},"__decorateClass$17");let Yi=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new P(1,1,1));A(this,"dirty",!0)}},"CBoxSize");sH(Yi,"CBoxSize");Yi=iH([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,equal:Tr,label:"Size",inputComponent:op,clone(n){return new P().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new P(n[0],n[1],n[2])}})],Yi);var WR=Object.defineProperty,rH=Object.getOwnPropertyDescriptor,oH=u((n,e)=>WR(n,"name",{value:e,configurable:!0}),"__name$37"),aH=u((n,e,t,s)=>{for(var i=s>1?void 0:s?rH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&WR(e,t,i),i},"__decorateClass$16");let Gn=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!0)}},"CCastShadow");oH(Gn,"CCastShadow");Gn=aH([Be({storable:!0,dataType:ke.BOOLEAN,instanceable:!0,label:"Cast Shadow",inlineLabel:!0,inputComponent:Er})],Gn);var lH=Object.defineProperty,cH=u((n,e)=>lH(n,"name",{value:e,configurable:!0}),"__name$36");class uw{constructor(e,t){A(this,"root");A(this,"zIndex",1e3);A(this,"show");A(this,"hide");A(this,"currentVisibleSubMenu");this.show=e,this.hide=t}handleMenuItemMouseOver(e,t){var s,i,r;(i=(s=this.currentVisibleSubMenu)==null?void 0:s.subMenu)==null||i.hide(),this.currentVisibleSubMenu=e,(r=e.subMenu)==null||r.show(t,"right")}hideAll(){this.root?this.root.hide():this.hide()}}u(uw,"PopupMenuContext");cH(uw,"PopupMenuContext");var uH=Object.defineProperty,qh=u((n,e)=>uH(n,"name",{value:e,configurable:!0}),"__name$35");let am=[];var hH=Ht({props:{title:String,triggerBy:{type:String,default:"mousedown"},position:{type:String,default:"bottom"},disabled:Boolean,className:String,dynamicSize:Boolean},setup(n){const e=Ne(),t=Ne(),s=Ne({left:0,top:0,width:"auto",height:"auto"}),i=Ne(!1),r=Ne(!1),o=new uw(d,f),a=Es("popupMenuItemContext",null);a&&(a.parent&&(o.root=a.parent.root||a.parent,o.zIndex=a.parent.zIndex+1),a.subMenu=o),Hl("popupMenuContext",o),D0(function(){o.root||am.push(o)}),L0(function(){o.root||(am=am.filter(p=>p!==o)),document.body.removeEventListener("mousedown",f)});function l(p){n.triggerBy==="mousedown"&&(r.value?f():d(e.value,n.position))}u(l,"onTriggerMouseDown"),qh(l,"onTriggerMouseDown");function c(){if(n.triggerBy==="hover"||n.triggerBy==="mouseover")return d(e.value,n.position)}u(c,"onTriggerMouseOver"),qh(c,"onTriggerMouseOver");function h(p){p.key==="Escape"&&(o.root?o.hide():f())}u(h,"onKeyDown"),qh(h,"onKeyDown");async function d(p,g){if(n.disabled)return;o.root||am.forEach(R=>R.hideAll());const m=document.body.getBoundingClientRect(),v=p.getBoundingClientRect(),y=m.width,b=m.height;r.value=!0,i.value=!1,s.value={left:0,top:0,width:"auto",height:"auto"},await Ri(),document.body.addEventListener("mousedown",f),t.value.focus();const _=t.value.getBoundingClientRect();let w,x;const S=_.right-_.left,C=_.bottom-_.top;if(typeof g=="object")w=g.x,x=g.y;else switch(g){case"bottom":w=v.left,x=v.bottom;break;default:w=v.right,x=v.top;break}const M={"z-index":o.zIndex};if(n.dynamicSize?(M.width="auto",M.height="auto",i.value=!1):(M.width=Math.floor(S)+"px",M.height=Math.floor(C)+"px",M.overflow="hidden",i.value=!0),w+S>y?M.right=0:M.left=Math.floor(w)+"px",x+C>b){const R=Math.floor(Math.max(0,b-C));M.top=R+"px",M.height=Math.floor(b-R)+"px"}else M.top=Math.floor(x)+"px";s.value=M}u(d,"show"),qh(d,"show");function f(){var p,g;document.body.removeEventListener("mousedown",f),r.value=!1,(g=(p=o.currentVisibleSubMenu)==null?void 0:p.subMenu)==null||g.hide(),o.currentVisibleSubMenu=void 0}return u(f,"hide"),qh(f,"hide"),{trigger:e,menu:t,onTriggerMouseDown:l,onTriggerMouseOver:c,onKeyDown:h,style:s,scrollable:i,visible:r,show:d,hide:f}}});const dH=["disabled"],fH={class:"scroll"};function pH(n,e,t,s,i,r){return Se(),Oe(Dt,null,[n.title?(Se(),Oe("button",{key:0,class:pn(["popup-menu-trigger",n.className]),disabled:n.disabled,onMousedown:e[0]||(e[0]=Hn((...o)=>n.onTriggerMouseDown&&n.onTriggerMouseDown(...o),["stop"])),onMouseover:e[1]||(e[1]=(...o)=>n.onTriggerMouseOver&&n.onTriggerMouseOver(...o)),ref:"trigger"},un(n.title),43,dH)):tt("",!0),(Se(),Xt(Eb,{to:"body"},[n.visible?(Se(),Oe("div",{key:0,class:pn(["popup-menu",{scrollable:n.scrollable}]),style:On(n.style),ref:"menu",tabindex:"0",onMousedown:e[2]||(e[2]=Hn(()=>{},["stop"])),onContextmenu:e[3]||(e[3]=Hn(()=>{},["prevent"])),onKeydown:e[4]||(e[4]=(...o)=>n.onKeyDown&&n.onKeyDown(...o))},[j("div",fH,[za(n.$slots,"default",{},void 0,!0)])],38)):tt("",!0)]))],64)}u(pH,"_sfc_render$k");var hw=jt(hH,[["render",pH],["__scopeId","data-v-e883b650"]]),mH=Object.defineProperty,gH=u((n,e)=>mH(n,"name",{value:e,configurable:!0}),"__name$34"),vH=Ht({components:{ColorPicker:TR,PopupMenu:hw},props:{value:Array},emits:["input"],setup(n,e){const t=ct(function(){const i=n.value||[1,1,1];return{"background-color":`#${new De().setRGB(i[0],i[1],i[2]).getHexString()}`}});function s(i){e.emit("input",i)}return u(s,"onInput"),gH(s,"onInput"),{style:t,onInput:s}}});const yH={style:{padding:"8px 8px 0 8px"}};function _H(n,e,t,s,i,r){const o=ln("color-picker"),a=ln("popup-menu");return Se(),Oe("div",{class:"input-color",style:On(n.style)},[we(a,{title:" "},{default:bt(()=>[j("div",yH,[we(o,{value:n.value,"onUpdate:value":n.onInput},null,8,["value","onUpdate:value"])])]),_:1})],4)}u(_H,"_sfc_render$j");var r1=jt(vH,[["render",_H],["__scopeId","data-v-1ea277a0"]]),jR=Object.defineProperty,bH=Object.getOwnPropertyDescriptor,wH=u((n,e)=>jR(n,"name",{value:e,configurable:!0}),"__name$33"),xH=u((n,e,t,s)=>{for(var i=s>1?void 0:s?bH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&jR(e,t,i),i},"__decorateClass$15");let Vt=u(class extends Fe{constructor(){super(...arguments);A(this,"value",[1,1,1])}},"CColor");wH(Vt,"CColor");Vt=xH([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,equal:(n,e)=>new De().setRGB(n[0],n[1],n[2]).getHex()===new De().setRGB(e[0],e[1],e[2]).getHex(),label:"Color",inlineLabel:!0,inputComponent:r1,clone(n){return[...n]}})],Vt);var AH=Ht({props:{value:Object},setup(){}});const MH={key:0,class:"credit-info"},SH=["href"],CH=["href"],EH=["href"];function TH(n,e,t,s,i,r){return n.value?(Se(),Oe("div",MH,[dn(" This work is based on "),j("a",{href:n.value.url,target:"_blank"},un(n.value.name),9,SH),dn(" by "),j("a",{href:n.value.user.url,target:"_blank"},un(n.value.user.name),9,CH),dn(" licensed under "),j("a",{href:n.value.license.url,target:"_blank"},un(n.value.license.name),9,EH),dn(". ")])):tt("",!0)}u(TH,"_sfc_render$i");var PH=jt(AH,[["render",TH],["__scopeId","data-v-64ad5277"]]),RH=Object.defineProperty,IH=u((n,e)=>RH(n,"name",{value:e,configurable:!0}),"__name$32");function pf(n){if(typeof n!="object"||!n)return n;if(Array.isArray(n))return n.map(pf);const e={};for(let t in n)if(n.hasOwnProperty(t)){const s=n[t];typeof s=="object"?ArrayBuffer.isView(s)?e[t]=s:Array.isArray(s)?e[t]=s.map(pf):e[t]=pf(s):e[t]=s}return e}u(pf,"deepClone");IH(pf,"deepClone");var XR=Object.defineProperty,DH=Object.getOwnPropertyDescriptor,LH=u((n,e)=>XR(n,"name",{value:e,configurable:!0}),"__name$31"),OH=u((n,e,t,s)=>{for(var i=s>1?void 0:s?DH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&XR(e,t,i),i},"__decorateClass$14");let kf=u(class extends Fe{constructor(){super(...arguments);A(this,"value",null)}},"CCredit");LH(kf,"CCredit");kf=OH([Be({storable:!0,dataType:ke.STRING,clone:pf,label:"Credit",inputComponent:PH,serialize(n){return n?JSON.stringify(n):""},deserialize(n){return n?JSON.parse(n):null}})],kf);var YR=Object.defineProperty,kH=Object.getOwnPropertyDescriptor,NH=u((n,e)=>YR(n,"name",{value:e,configurable:!0}),"__name$30"),FH=u((n,e,t,s)=>{for(var i=s>1?void 0:s?kH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&YR(e,t,i),i},"__decorateClass$13");let nn=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!1)}},"CDisableFlip");NH(nn,"CDisableFlip");nn=FH([Be({storable:!0,dataType:ke.BOOLEAN,instanceable:!0,label:"Disable Flip",inlineLabel:!0,inputComponent:Er})],nn);var qR=Object.defineProperty,zH=Object.getOwnPropertyDescriptor,BH=u((n,e)=>qR(n,"name",{value:e,configurable:!0}),"__name$2$"),UH=u((n,e,t,s)=>{for(var i=s>1?void 0:s?zH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&qR(e,t,i),i},"__decorateClass$12");let Rn=u(class extends Fe{constructor(){super(...arguments);A(this,"value",[0,0,0])}},"CEmissive");BH(Rn,"CEmissive");Rn=UH([Be({storable:!0,dataType:ke.NUMBER_ARRAY,equal:(n,e)=>new De().setRGB(n[0],n[1],n[2]).getHex()===new De().setRGB(e[0],e[1],e[2]).getHex(),label:"Emissive",inlineLabel:!0,inputComponent:r1,clone(n){return[...n]}})],Rn);var $H=Object.defineProperty,Kh=u((n,e)=>$H(n,"name",{value:e,configurable:!0}),"__name$2_"),VH=Ht({props:{value:{type:$e,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean,defaultValue:$e},emits:["input"],setup(n,e){const t=Ne(),s=Ne();let i=!1;function r(){i&&(l(),document.removeEventListener("mousedown",r))}u(r,"postOnMouseDown"),Kh(r,"postOnMouseDown");function o(h){return Number(h.toFixed(3))}u(o,"format"),Kh(o,"format");function a(){i||(i=!0,document.addEventListener("mousedown",r))}u(a,"onChange"),Kh(a,"onChange"),Wa(function(){document.removeEventListener("mousedown",r)});function l(){var h,d;if(i){i=!1;let f=Number(((h=t.value)==null?void 0:h.value)||"0")||0,p=Number(((d=s.value)==null?void 0:d.value)||"0")||0;e.emit("input",new $e(f,p))}}u(l,"onPost"),Kh(l,"onPost");function c(){const h=new $e;n.defaultValue&&h.copy(n.defaultValue),e.emit("input",h)}return u(c,"onReset"),Kh(c,"onReset"),{input0:t,input1:s,format:o,onChange:a,onPost:l,onReset:c}}});const GH=u(n=>(Ga("data-v-24b0778d"),n=n(),Ha(),n),"_withScopeId$2"),HH={class:"input-vec2"},WH=["value","readonly","disabled"],jH=["value","readonly","disabled"],XH=GH(()=>j("img",{src:n1,alt:""},null,-1)),YH=[XH];function qH(n,e,t,s,i,r){return Se(),Oe("div",HH,[j("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,WH),j("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,jH),n.resettable?(Se(),Oe("button",{key:0,class:"normal-button",onClick:e[6]||(e[6]=(...o)=>n.onReset&&n.onReset(...o))},YH)):tt("",!0)])}u(qH,"_sfc_render$h");var o1=jt(VH,[["render",qH],["__scopeId","data-v-24b0778d"]]),KR=Object.defineProperty,KH=Object.getOwnPropertyDescriptor,ZH=u((n,e)=>KR(n,"name",{value:e,configurable:!0}),"__name$2Z"),QH=u((n,e,t,s)=>{for(var i=s>1?void 0:s?KH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&KR(e,t,i),i},"__decorateClass$11");let sc=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new $e(.5,.5))}},"CEndRadius2");ZH(sc,"CEndRadius2");sc=QH([Be({storable:!0,dataType:ke.NUMBER_ARRAY,instanceable:!0,equal:Tr,label:"End Radius",inputComponent:o1,clone(n){return new $e().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new $e(n[0],n[1])}})],sc);var ZR=Object.defineProperty,JH=Object.getOwnPropertyDescriptor,e7=u((n,e)=>ZR(n,"name",{value:e,configurable:!0}),"__name$2Y"),t7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?JH(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&ZR(e,t,i),i},"__decorateClass$10");let Nf=u(class extends Fe{constructor(){super(...arguments);A(this,"value",[1,1,1])}},"CGroundColor");e7(Nf,"CGroundColor");Nf=t7([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,equal:(n,e)=>new De().setRGB(n[0],n[1],n[2]).getHex()===new De().setRGB(e[0],e[1],e[2]).getHex(),label:"Ground Color",inputComponent:r1,clone(n){return[...n]}})],Nf);var QR=Object.defineProperty,n7=Object.getOwnPropertyDescriptor,s7=u((n,e)=>QR(n,"name",{value:e,configurable:!0}),"__name$2X"),i7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?n7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&QR(e,t,i),i},"__decorateClass$$");let fn=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.5)}},"CHeight");s7(fn,"CHeight");fn=i7([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,label:"Height",inputComponent:rs,inputComponentProps:{min:0,step:.001}})],fn);var JR=Object.defineProperty,r7=Object.getOwnPropertyDescriptor,o7=u((n,e)=>JR(n,"name",{value:e,configurable:!0}),"__name$2W"),a7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?r7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&JR(e,t,i),i},"__decorateClass$_");let $a=u(class extends Fe{constructor(){super(...arguments);A(this,"value",[-180,180])}},"CHingeAngleRange");o7($a,"CHingeAngleRange");$a=a7([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,label:"Hinge Limit",inputComponent:VR,inputComponentProps:{min:-360,max:360,maxDet:360}})],$a);var l7=Object.defineProperty,c7=u((n,e)=>l7(n,"name",{value:e,configurable:!0}),"__name$2V"),u7=Ht({props:{value:String,disabled:Boolean,options:Array},emits:["input"],setup(n,e){const t=Ne();function s(){const i=t.value;i&&e.emit("input",i.value)}return u(s,"onChange"),c7(s,"onChange"),{selectDom:t,onChange:s}}});const h7=["value","disabled"],d7=["value"];function f7(n,e,t,s,i,r){return Se(),Oe("select",{class:"input-select",value:n.value,disabled:n.disabled,onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),ref:"selectDom"},[(Se(!0),Oe(Dt,null,ji(n.options,o=>(Se(),Oe("option",{key:o,value:o},un(o),9,d7))),128))],40,h7)}u(f7,"_sfc_render$g");var Za=jt(u7,[["render",f7],["__scopeId","data-v-f534510c"]]),eI=Object.defineProperty,p7=Object.getOwnPropertyDescriptor,m7=u((n,e)=>eI(n,"name",{value:e,configurable:!0}),"__name$2U"),g7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?p7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&eI(e,t,i),i},"__decorateClass$Z");let di=u(class extends Fe{constructor(){super(...arguments);A(this,"value","none")}},"CHingeAxis");m7(di,"CHingeAxis");di=g7([Be({storable:!0,dataType:ke.STRING,autoCopy:!0,label:"Hinge",inputComponent:Za,inputComponentProps:{options:["none","horizontal","vertical"]}})],di);var tI=Object.defineProperty,v7=Object.getOwnPropertyDescriptor,y7=u((n,e)=>tI(n,"name",{value:e,configurable:!0}),"__name$2T"),_7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?v7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&tI(e,t,i),i},"__decorateClass$Y");const kv=24,Ds=new P;let Et=u(class extends Fe{constructor(){super(...arguments);A(this,"value");A(this,"dirty",!0);A(this,"start",new P);A(this,"end",new P);A(this,"quaternion",new qe);A(this,"boneMesh");A(this,"hingeIndicator");A(this,"moveHandler");A(this,"rotateHandler");A(this,"moveHandlerHovered",!1);A(this,"moveHandlerZ",0);A(this,"rotateHandlerHovered",!1);A(this,"rotateHandlerZ",0);A(this,"hingeEnabled",!1)}onRemoved(){var e,t;this.boneMesh&&(nc(this.boneMesh),this.boneMesh.removeFromParent()),this.hingeIndicator&&(nc(this.hingeIndicator),this.hingeIndicator.removeFromParent()),this.moveHandler&&(this.moveHandler.geometry.dispose(),(e=this.moveHandler.material)==null||e.dispose(),this.moveHandler.removeFromParent()),this.rotateHandler&&(this.rotateHandler.geometry.dispose(),(t=this.rotateHandler.material)==null||t.dispose(),this.rotateHandler.removeFromParent())}updateHandlersHoverState(e,t){var s,i;(s=this.moveHandler)!=null&&s.visible&&(Ds.copy(this.start).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),Ds.x+=1,Ds.y+=1,Ds.x*=t.width/2,Ds.y*=t.height/2,this.moveHandlerZ=Ds.z,Math.abs(t.mouseScr.x-Ds.x)<=kv/2&&Math.abs(t.mouseScr.y-Ds.y)<=kv/2&&(this.moveHandlerHovered=!0)),(i=this.rotateHandler)!=null&&i.visible&&(Ds.copy(this.end).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),Ds.x+=1,Ds.y+=1,Ds.x*=t.width/2,Ds.y*=t.height/2,this.rotateHandlerZ=Ds.z,Math.sqrt((t.mouseScr.x-Ds.x)**2+(t.mouseScr.y-Ds.y)**2)<=kv/2&&(this.rotateHandlerHovered=!0)),this.moveHandlerHovered&&this.rotateHandlerHovered&&(this.moveHandlerZ<this.rotateHandlerZ?this.rotateHandlerHovered=!1:this.moveHandlerHovered=!1)}resetHandlers(e){this.moveHandlerHovered=!1,this.rotateHandlerHovered=!1,this.boneMesh&&(this.boneMesh.visible=e.options.showIkBones),this.hingeIndicator&&(this.hingeIndicator.visible=e.options.showIkBones&&this.hingeEnabled),this.moveHandler&&(this.moveHandler.visible=!1),this.rotateHandler&&(this.rotateHandler.visible=!1)}},"CIkNode");y7(Et,"CIkNode");Et=_7([Be({})],Et);var nI=Object.defineProperty,b7=Object.getOwnPropertyDescriptor,w7=u((n,e)=>nI(n,"name",{value:e,configurable:!0}),"__name$2S"),x7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?b7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&nI(e,t,i),i},"__decorateClass$X");let Js=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.2)}},"CIkNodeLength");w7(Js,"CIkNodeLength");Js=x7([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Length",inputComponent:rs,inputComponentProps:{min:0}})],Js);var A7=Object.defineProperty,Zh=u((n,e)=>A7(n,"name",{value:e,configurable:!0}),"__name$2R"),M7=Ht({props:{value:{type:ft,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean},emits:["input"],setup(n,e){const t=Ne(),s=Ne(),i=Ne();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}u(o,"postOnMouseDown"),Zh(o,"postOnMouseDown");function a(d){return Number((d/Math.PI*180).toFixed(1))}u(a,"format"),Zh(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}u(l,"onChange"),Zh(l,"onChange"),Wa(function(){document.removeEventListener("mousedown",o)});function c(){var d,f,p;if(r){r=!1;let g=Number(((d=t.value)==null?void 0:d.value)||"0")||0,m=Number(((f=s.value)==null?void 0:f.value)||"0")||0,v=Number(((p=i.value)==null?void 0:p.value)||"0")||0;e.emit("input",new ft(g/180*Math.PI,m/180*Math.PI,v/180*Math.PI))}}u(c,"onPost"),Zh(c,"onPost");function h(){e.emit("input",new ft)}return u(h,"onReset"),Zh(h,"onReset"),{input0:t,input1:s,input2:i,format:a,onChange:l,onPost:c,onReset:h}}});const S7=u(n=>(Ga("data-v-6ff85571"),n=n(),Ha(),n),"_withScopeId$1"),C7={class:"input-euler"},E7=["value","readonly","disabled"],T7=["value","readonly","disabled"],P7=["value","readonly","disabled"],R7=S7(()=>j("img",{src:n1,alt:""},null,-1)),I7=[R7];function D7(n,e,t,s,i,r){return Se(),Oe("div",C7,[j("input",{type:"text",placeholder:"x",value:n.format(n.value.x),readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input0"},null,40,E7),j("input",{type:"text",placeholder:"y",value:n.format(n.value.y),readonly:n.readonly,disabled:n.disabled,onInput:e[3]||(e[3]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[5]||(e[5]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input1"},null,40,T7),j("input",{type:"text",placeholder:"z",value:n.format(n.value.z),readonly:n.readonly,disabled:n.disabled,onInput:e[6]||(e[6]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[8]||(e[8]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"input2"},null,40,P7),n.resettable?(Se(),Oe("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>n.onReset&&n.onReset(...o))},I7)):tt("",!0)])}u(D7,"_sfc_render$f");var sI=jt(M7,[["render",D7],["__scopeId","data-v-6ff85571"]]),iI=Object.defineProperty,L7=Object.getOwnPropertyDescriptor,O7=u((n,e)=>iI(n,"name",{value:e,configurable:!0}),"__name$2Q"),k7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?L7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&iI(e,t,i),i},"__decorateClass$W");let En=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new ft)}},"CIkNodeRotation");O7(En,"CIkNodeRotation");En=k7([Be({storable:!0,dataType:ke.NUMBER_ARRAY,instanceable:!0,equal(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8},label:"Rotation",inputComponent:sI,inputComponentProps:{resettable:!0},clone(n){return new ft().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new ft(n[0],n[1],n[2])}})],En);var N7=Object.defineProperty,F7=u((n,e)=>N7(n,"name",{value:e,configurable:!0}),"__name$2P"),z7=Ht({props:{value:String,accept:String},emits:["input"],setup(n,e){const t=Ne();async function s(){var o;if(!((o=t.value)!=null&&o.files))return;const i=t.value.files[0];if(!i)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsDataURL(i)});t.value.value="",e.emit("input",r)}return u(s,"onChange"),F7(s,"onChange"),{input:t,onChange:s}}});const B7={class:"input-file normal-button"},U7=["accept"];function $7(n,e,t,s,i,r){return Se(),Oe("div",null,[j("label",B7,[j("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),accept:n.accept},null,40,U7),dn(" ... ")])])}u($7,"_sfc_render$e");var rI=jt(z7,[["render",$7],["__scopeId","data-v-cd0c5822"]]),oI=Object.defineProperty,V7=Object.getOwnPropertyDescriptor,G7=u((n,e)=>oI(n,"name",{value:e,configurable:!0}),"__name$2O"),H7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?V7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&oI(e,t,i),i},"__decorateClass$V");let Kr=u(class extends Fe{constructor(){super(...arguments);A(this,"value","");A(this,"dirty",!0);A(this,"texture")}onRemoved(){this.texture&&this.texture.dispose()}},"CImage");G7(Kr,"CImage");Kr=H7([Be({storable:!0,dataType:ke.STRING,label:"Image File",inputComponent:rI,inputComponentProps:{accept:"image/png, image/jpeg, image/webp"}})],Kr);var aI=Object.defineProperty,W7=Object.getOwnPropertyDescriptor,j7=u((n,e)=>aI(n,"name",{value:e,configurable:!0}),"__name$2N"),X7=u((n,e,t,s)=>{for(var i=s>1?void 0:s?W7(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&aI(e,t,i),i},"__decorateClass$U");let $o=u(class extends Fe{constructor(){super(...arguments);A(this,"value","");A(this,"dirty",!0)}},"CImportFbx");j7($o,"CImportFbx");$o=X7([Be({storable:!0,dataType:ke.STRING,label:".fbx File",inputComponent:rI,inputComponentProps:{accept:".fbx"}})],$o);var Y7=Object.defineProperty,q7=u((n,e)=>Y7(n,"name",{value:e,configurable:!0}),"__name$2M"),K7=Ht({props:{value:String,accept:String},emits:["input"],setup(n,e){const t=Ne();async function s(){var o;if(!((o=t.value)!=null&&o.files))return;const i=t.value.files[0];if(!i)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsText(i)});t.value.value="",e.emit("input",r)}return u(s,"onChange"),q7(s,"onChange"),{input:t,onChange:s}}});const Z7={class:"input-file normal-button"},Q7=["accept"];function J7(n,e,t,s,i,r){return Se(),Oe("div",null,[j("label",Z7,[j("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),accept:n.accept},null,40,Q7),dn(" ... ")])])}u(J7,"_sfc_render$d");var e9=jt(K7,[["render",J7],["__scopeId","data-v-51992a25"]]),lI=Object.defineProperty,t9=Object.getOwnPropertyDescriptor,n9=u((n,e)=>lI(n,"name",{value:e,configurable:!0}),"__name$2L"),s9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?t9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&lI(e,t,i),i},"__decorateClass$T");let Vo=u(class extends Fe{constructor(){super(...arguments);A(this,"value","");A(this,"dirty",!0)}},"CImportObj");n9(Vo,"CImportObj");Vo=s9([Be({storable:!0,dataType:ke.STRING,label:".obj File",inputComponent:e9,inputComponentProps:{accept:".obj"}})],Vo);var cI=Object.defineProperty,i9=Object.getOwnPropertyDescriptor,r9=u((n,e)=>cI(n,"name",{value:e,configurable:!0}),"__name$2K"),o9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?i9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&cI(e,t,i),i},"__decorateClass$S");let Go=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new Uint8Array);A(this,"dirty",!0)}},"CImportReadonlyGltf");r9(Go,"CImportReadonlyGltf");Go=o9([Be({storable:!0,dataType:ke.BYTES})],Go);var uI=Object.defineProperty,a9=Object.getOwnPropertyDescriptor,l9=u((n,e)=>uI(n,"name",{value:e,configurable:!0}),"__name$2J"),c9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?a9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&uI(e,t,i),i},"__decorateClass$R");let ic=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.25)}},"CInnerRadius");l9(ic,"CInnerRadius");ic=c9([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Section Radius",inputComponent:rs,inputComponentProps:{min:0,step:.001}})],ic);var hI=Object.defineProperty,u9=Object.getOwnPropertyDescriptor,h9=u((n,e)=>hI(n,"name",{value:e,configurable:!0}),"__name$2I"),d9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?u9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&hI(e,t,i),i},"__decorateClass$Q");let Xu=u(class extends Fe{constructor(){super(...arguments);A(this,"value",0)}},"CInnerRotation");h9(Xu,"CInnerRotation");Xu=d9([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,label:"Section Rotation",inputComponent:Xo,inputComponentProps:{min:0,max:360,step:.1}})],Xu);var dI=Object.defineProperty,f9=Object.getOwnPropertyDescriptor,p9=u((n,e)=>dI(n,"name",{value:e,configurable:!0}),"__name$2H"),m9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?f9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&dI(e,t,i),i},"__decorateClass$P");let Yu=u(class extends Fe{constructor(){super(...arguments);A(this,"value",32)}},"CInnerSegments");p9(Yu,"CInnerSegments");Yu=m9([Be({storable:!0,dataType:ke.NUMBER,label:"Section Segments",inlineLabel:!0,inputComponent:rs})],Yu);var fI=Object.defineProperty,g9=Object.getOwnPropertyDescriptor,v9=u((n,e)=>fI(n,"name",{value:e,configurable:!0}),"__name$2G"),y9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?g9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&fI(e,t,i),i},"__decorateClass$O");let Ys=u(class extends Fe{constructor(){super(...arguments);A(this,"value",1)}},"CIntensity");v9(Ys,"CIntensity");Ys=y9([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Intensity",inputComponent:rs,inputComponentProps:{min:0,step:.001}})],Ys);var pI=Object.defineProperty,_9=Object.getOwnPropertyDescriptor,b9=u((n,e)=>pI(n,"name",{value:e,configurable:!0}),"__name$2F"),w9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?_9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&pI(e,t,i),i},"__decorateClass$N");let ei=u(class extends Fe{constructor(){super(...arguments);A(this,"value",null);A(this,"camera",null)}onRemoved(){this.value&&(nc(this.value),this.value.removeFromParent(),this.value=null),this.camera&&(nc(this.camera),this.camera.removeFromParent(),this.camera=null)}},"CLightHelper");b9(ei,"CLightHelper");ei=w9([Be({})],ei);var mI=Object.defineProperty,x9=Object.getOwnPropertyDescriptor,A9=u((n,e)=>mI(n,"name",{value:e,configurable:!0}),"__name$2E"),M9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?x9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&mI(e,t,i),i},"__decorateClass$M");let Ff=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!1)}},"CLockEnd");A9(Ff,"CLockEnd");Ff=M9([Be({storable:!0,dataType:ke.BOOLEAN,autoCopy:!0,label:"Lock End",inlineLabel:!0,inputComponent:Er})],Ff);var gI=Object.defineProperty,S9=Object.getOwnPropertyDescriptor,C9=u((n,e)=>gI(n,"name",{value:e,configurable:!0}),"__name$2D"),E9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?S9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&gI(e,t,i),i},"__decorateClass$L");let No=u(class extends Fe{constructor(){super(...arguments);A(this,"value","512")}},"CMapSize");C9(No,"CMapSize");No=E9([Be({storable:!0,dataType:ke.STRING,autoCopy:!0,label:"Shadow Quality",inputComponent:Za,inputComponentProps:{options:["128","256","512","1024","2048"]}})],No);var vI=Object.defineProperty,T9=Object.getOwnPropertyDescriptor,P9=u((n,e)=>vI(n,"name",{value:e,configurable:!0}),"__name$2C"),R9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?T9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&vI(e,t,i),i},"__decorateClass$K");let In=u(class extends Fe{constructor(){super(...arguments);A(this,"value",0)}},"CMetalness");P9(In,"CMetalness");In=R9([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Metalness",inputComponent:Xo,inputComponentProps:{min:0,max:1,step:.01}})],In);var I9=Object.defineProperty,Nv=u((n,e)=>I9(n,"name",{value:e,configurable:!0}),"__name$2B"),D9=Ht({props:{value:String,readonly:Boolean,disabled:Boolean},emits:["input"],setup(n,e){const t=Ne();let s=!1;function i(){s&&(o(),document.removeEventListener("mousedown",i))}u(i,"postOnMouseDown"),Nv(i,"postOnMouseDown");function r(){s||(s=!0,document.addEventListener("mousedown",i))}u(r,"onChange"),Nv(r,"onChange"),Wa(function(){document.removeEventListener("mousedown",i)});function o(){if(s){s=!1;const a=t.value;a&&e.emit("input",a.value)}}return u(o,"onPost"),Nv(o,"onPost"),{inputDom:t,onChange:r,onPost:o}}});const L9=["value","readonly","disabled"];function O9(n,e,t,s,i,r){return Se(),Oe("input",{class:"input-string",type:"text",value:n.value,readonly:n.readonly,disabled:n.disabled,onInput:e[0]||(e[0]=(...o)=>n.onChange&&n.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>n.onPost&&n.onPost(...o)),onKeydown:e[2]||(e[2]=Ln((...o)=>n.onPost&&n.onPost(...o),["enter"])),ref:"inputDom"},null,40,L9)}u(O9,"_sfc_render$c");var k9=jt(D9,[["render",O9],["__scopeId","data-v-07fa832a"]]),yI=Object.defineProperty,N9=Object.getOwnPropertyDescriptor,F9=u((n,e)=>yI(n,"name",{value:e,configurable:!0}),"__name$2A"),z9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?N9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&yI(e,t,i),i},"__decorateClass$J");let zt=u(class extends Fe{constructor(){super(...arguments);A(this,"value","")}},"CName");F9(zt,"CName");zt=z9([Be({storable:!0,dataType:ke.STRING,instanceable:!0,label:"Name",inputComponent:k9})],zt);var _I=Object.defineProperty,B9=Object.getOwnPropertyDescriptor,U9=u((n,e)=>_I(n,"name",{value:e,configurable:!0}),"__name$2z"),$9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?B9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&_I(e,t,i),i},"__decorateClass$I");let qu=u(class extends Fe{constructor(){super(...arguments);A(this,"value",30)}},"CNumOfSlices");U9(qu,"CNumOfSlices");qu=$9([Be({storable:!0,dataType:ke.NUMBER,label:"Curve Segments",inlineLabel:!0,inputComponent:rs})],qu);var bI=Object.defineProperty,V9=Object.getOwnPropertyDescriptor,G9=u((n,e)=>bI(n,"name",{value:e,configurable:!0}),"__name$2y"),H9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?V9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&bI(e,t,i),i},"__decorateClass$H");let an=u(class extends Fe{constructor(){super(...arguments);A(this,"value",1)}},"COpacity");G9(an,"COpacity");an=H9([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Opacity",inputComponent:Xo,inputComponentProps:{min:0,max:1,step:.01}})],an);var wI=Object.defineProperty,W9=Object.getOwnPropertyDescriptor,j9=u((n,e)=>wI(n,"name",{value:e,configurable:!0}),"__name$2x"),X9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?W9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&wI(e,t,i),i},"__decorateClass$G");let wr=u(class extends Fe{constructor(){super(...arguments);A(this,"value","")}},"COpenPoseKeypoint");j9(wr,"COpenPoseKeypoint");wr=X9([Be({storable:!0,dataType:ke.STRING,instanceable:!0,label:"Type",inputComponent:Za,inputComponentProps:{options:["","nose","neck","right_shoulder","right_elbow","right_wrist","left_shoulder","left_elbow","left_wrist","right_hip","right_knee","right_ankle","left_hip","left_knee","left_ankle","right_eye","left_eye","right_ear","left_ear"]}})],wr);var xI=Object.defineProperty,Y9=Object.getOwnPropertyDescriptor,q9=u((n,e)=>xI(n,"name",{value:e,configurable:!0}),"__name$2w"),K9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Y9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&xI(e,t,i),i},"__decorateClass$F");let Li=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!1);A(this,"dirty",!0);A(this,"keypoints",{})}},"COpenPoseRoot");q9(Li,"COpenPoseRoot");Li=K9([Be({storable:!0,dataType:ke.BOOLEAN,autoCopy:!0,label:"Pose Root",inlineLabel:!0,inputComponent:Er})],Li);var AI=Object.defineProperty,Z9=Object.getOwnPropertyDescriptor,Q9=u((n,e)=>AI(n,"name",{value:e,configurable:!0}),"__name$2v"),J9=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Z9(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&AI(e,t,i),i},"__decorateClass$E");let rc=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.5)}},"COuterRadius");Q9(rc,"COuterRadius");rc=J9([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Radius",inputComponent:rs,inputComponentProps:{min:0,step:.001}})],rc);var MI=Object.defineProperty,eW=Object.getOwnPropertyDescriptor,tW=u((n,e)=>MI(n,"name",{value:e,configurable:!0}),"__name$2u"),nW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?eW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&MI(e,t,i),i},"__decorateClass$D");let Ku=u(class extends Fe{constructor(){super(...arguments);A(this,"value",360)}},"COuterRotation");tW(Ku,"COuterRotation");Ku=nW([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,label:"Angle",inputComponent:Xo,inputComponentProps:{min:0,max:360,step:.1}})],Ku);var SI=Object.defineProperty,sW=Object.getOwnPropertyDescriptor,iW=u((n,e)=>SI(n,"name",{value:e,configurable:!0}),"__name$2t"),rW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?sW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&SI(e,t,i),i},"__decorateClass$C");let Zu=u(class extends Fe{constructor(){super(...arguments);A(this,"value",32)}},"COuterSegments");iW(Zu,"COuterSegments");Zu=rW([Be({storable:!0,dataType:ke.NUMBER,label:"Segments",inlineLabel:!0,inputComponent:rs})],Zu);var CI=Object.defineProperty,oW=Object.getOwnPropertyDescriptor,aW=u((n,e)=>CI(n,"name",{value:e,configurable:!0}),"__name$2s"),lW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?oW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&CI(e,t,i),i},"__decorateClass$B");let zf=u(class extends Fe{constructor(){super(...arguments);A(this,"value",0)}},"CPenumbra");aW(zf,"CPenumbra");zf=lW([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,label:"Edge Softness",inputComponent:Xo,inputComponentProps:{min:0,max:1,step:.01}})],zf);var EI=Object.defineProperty,cW=Object.getOwnPropertyDescriptor,uW=u((n,e)=>EI(n,"name",{value:e,configurable:!0}),"__name$2r"),hW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?cW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&EI(e,t,i),i},"__decorateClass$A");let ze=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new P)}},"CPosition");uW(ze,"CPosition");ze=hW([Be({storable:!0,dataType:ke.NUMBER_ARRAY,instanceable:!0,equal:Tr,label:"Position",inputComponent:op,inputComponentProps:{resettable:!0},clone(n){return new P().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new P(n[0],n[1],n[2])}})],ze);var TI=Object.defineProperty,dW=Object.getOwnPropertyDescriptor,fW=u((n,e)=>TI(n,"name",{value:e,configurable:!0}),"__name$2q"),pW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?dW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&TI(e,t,i),i},"__decorateClass$z");let ui=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.5)}},"CRadius");fW(ui,"CRadius");ui=pW([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Radius",inputComponent:rs,inputComponentProps:{min:0,step:.001}})],ui);var PI=Object.defineProperty,mW=Object.getOwnPropertyDescriptor,gW=u((n,e)=>PI(n,"name",{value:e,configurable:!0}),"__name$2p"),vW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?mW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&PI(e,t,i),i},"__decorateClass$y");let gr=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new P(.5,.5,.5))}},"CRadius3");gW(gr,"CRadius3");gr=vW([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,equal:Tr,label:"Radius",inputComponent:op,clone(n){return new P().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new P(n[0],n[1],n[2])}})],gr);var RI=Object.defineProperty,yW=Object.getOwnPropertyDescriptor,_W=u((n,e)=>RI(n,"name",{value:e,configurable:!0}),"__name$2o"),bW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?yW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&RI(e,t,i),i},"__decorateClass$x");let Xs=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!0)}},"CReceiveShadow");_W(Xs,"CReceiveShadow");Xs=bW([Be({storable:!0,dataType:ke.BOOLEAN,instanceable:!0,label:"Receive Shadow",inlineLabel:!0,inputComponent:Er})],Xs);var II=Object.defineProperty,wW=Object.getOwnPropertyDescriptor,xW=u((n,e)=>II(n,"name",{value:e,configurable:!0}),"__name$2n"),AW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?wW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&II(e,t,i),i},"__decorateClass$w");let oc=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!0)}},"CRenderEdge");xW(oc,"CRenderEdge");oc=AW([Be({storable:!0,dataType:ke.BOOLEAN,instanceable:!0,label:"Render Edge",inlineLabel:!0,inputComponent:Er})],oc);var DI=Object.defineProperty,MW=Object.getOwnPropertyDescriptor,SW=u((n,e)=>DI(n,"name",{value:e,configurable:!0}),"__name$2m"),CW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?MW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&DI(e,t,i),i},"__decorateClass$v");let nt=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new ft)}},"CRotation");SW(nt,"CRotation");nt=CW([Be({storable:!0,dataType:ke.NUMBER_ARRAY,instanceable:!0,equal(n,e){return Math.abs(n.x-e.x)<1e-8&&Math.abs(n.y-e.y)<1e-8&&Math.abs(n.z-e.z)<1e-8},label:"Rotation",inputComponent:sI,inputComponentProps:{resettable:!0},clone(n){return new ft().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new ft(n[0],n[1],n[2])}})],nt);var LI=Object.defineProperty,EW=Object.getOwnPropertyDescriptor,TW=u((n,e)=>LI(n,"name",{value:e,configurable:!0}),"__name$2l"),PW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?EW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&LI(e,t,i),i},"__decorateClass$u");let Dn=u(class extends Fe{constructor(){super(...arguments);A(this,"value",1)}},"CRoughness");TW(Dn,"CRoughness");Dn=PW([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Roughness",inputComponent:Xo,inputComponentProps:{min:0,max:1,step:.01}})],Dn);var OI=Object.defineProperty,RW=Object.getOwnPropertyDescriptor,IW=u((n,e)=>OI(n,"name",{value:e,configurable:!0}),"__name$2k"),DW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?RW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&OI(e,t,i),i},"__decorateClass$t");let Oi=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.05)}},"CRoundRadius");IW(Oi,"CRoundRadius");Oi=DW([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Round Radius",inputComponent:rs,inputComponentProps:{min:0,step:.001}})],Oi);var kI=Object.defineProperty,LW=Object.getOwnPropertyDescriptor,OW=u((n,e)=>kI(n,"name",{value:e,configurable:!0}),"__name$2j"),kW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?LW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&kI(e,t,i),i},"__decorateClass$s");let Wt=u(class extends Fe{constructor(){super(...arguments);A(this,"value",1)}},"CScale");OW(Wt,"CScale");Wt=kW([Be({storable:!0,dataType:ke.NUMBER,instanceable:!0,equal(n,e){return Math.abs(n-e)<1e-8},label:"Scale",inputComponent:rs,inputComponentProps:{resettable:!0,defaultValue:1}})],Wt);var NI=Object.defineProperty,NW=Object.getOwnPropertyDescriptor,FW=u((n,e)=>NI(n,"name",{value:e,configurable:!0}),"__name$2i"),zW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?NW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&NI(e,t,i),i},"__decorateClass$r");let It=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new P(1,1,1))}},"CScale3");FW(It,"CScale3");It=zW([Be({storable:!0,dataType:ke.NUMBER_ARRAY,instanceable:!0,equal:Tr,label:"Scale",inputComponent:op,inputComponentProps:{resettable:!0,defaultValue:new P(1,1,1)},clone(n){return new P().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new P(n[0],n[1],n[2])}})],It);var FI=Object.defineProperty,BW=Object.getOwnPropertyDescriptor,UW=u((n,e)=>FI(n,"name",{value:e,configurable:!0}),"__name$2h"),$W=u((n,e,t,s)=>{for(var i=s>1?void 0:s?BW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&FI(e,t,i),i},"__decorateClass$q");let Pi=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!0);A(this,"throttleHash","")}},"CSdfDirty");UW(Pi,"CSdfDirty");Pi=$W([Be({})],Pi);var zI=Object.defineProperty,VW=Object.getOwnPropertyDescriptor,GW=u((n,e)=>zI(n,"name",{value:e,configurable:!0}),"__name$2g"),HW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?VW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&zI(e,t,i),i},"__decorateClass$p");let Qu=u(class extends Fe{constructor(){super(...arguments);A(this,"value","add")}},"CSdfOperator");GW(Qu,"CSdfOperator");Qu=HW([Be({storable:!0,dataType:ke.STRING,label:"Operator",inputComponent:Za,inputComponentProps:{options:["add","subtract"]}})],Qu);var BI=Object.defineProperty,WW=Object.getOwnPropertyDescriptor,jW=u((n,e)=>BI(n,"name",{value:e,configurable:!0}),"__name$2f"),XW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?WW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&BI(e,t,i),i},"__decorateClass$o");let ns=u(class extends Fe{constructor(){super(...arguments);A(this,"value",32)}},"CSegments");jW(ns,"CSegments");ns=XW([Be({storable:!0,dataType:ke.NUMBER,label:"Segments",inlineLabel:!0,inputComponent:rs})],ns);var UI=Object.defineProperty,YW=Object.getOwnPropertyDescriptor,qW=u((n,e)=>UI(n,"name",{value:e,configurable:!0}),"__name$2e"),KW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?YW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&UI(e,t,i),i},"__decorateClass$n");let Bf=u(class extends Fe{constructor(){super(...arguments);A(this,"value",10)}},"CShadowMappingRange");qW(Bf,"CShadowMappingRange");Bf=KW([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,label:"Shadow Mapping Range",inputComponent:rs,inputComponentProps:{min:0}})],Bf);var $I=Object.defineProperty,ZW=Object.getOwnPropertyDescriptor,QW=u((n,e)=>$I(n,"name",{value:e,configurable:!0}),"__name$2d"),JW=u((n,e,t,s)=>{for(var i=s>1?void 0:s?ZW(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&$I(e,t,i),i},"__decorateClass$m");let Ju=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!1)}},"CShowMoveHandler");QW(Ju,"CShowMoveHandler");Ju=JW([Be({storable:!0,dataType:ke.BOOLEAN,autoCopy:!0,label:"Move Handler",inlineLabel:!0,inputComponent:Er})],Ju);var VI=Object.defineProperty,ej=Object.getOwnPropertyDescriptor,tj=u((n,e)=>VI(n,"name",{value:e,configurable:!0}),"__name$2c"),nj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?ej(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&VI(e,t,i),i},"__decorateClass$l");let eh=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!0)}},"CShowRotateHandler");tj(eh,"CShowRotateHandler");eh=nj([Be({storable:!0,dataType:ke.BOOLEAN,autoCopy:!0,label:"Rotate Handler",inlineLabel:!0,inputComponent:Er})],eh);var GI=Object.defineProperty,sj=Object.getOwnPropertyDescriptor,ij=u((n,e)=>GI(n,"name",{value:e,configurable:!0}),"__name$2b"),rj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?sj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&GI(e,t,i),i},"__decorateClass$k");let As=u(class extends Fe{constructor(){super(...arguments);A(this,"value","positive")}},"CSign");ij(As,"CSign");As=rj([Be({storable:!0,dataType:ke.STRING,instanceable:!0,label:"Sign",inlineLabel:!0,inputComponent:Za,inputComponentProps:{options:["positive","negative"]}})],As);var HI=Object.defineProperty,oj=Object.getOwnPropertyDescriptor,aj=u((n,e)=>HI(n,"name",{value:e,configurable:!0}),"__name$2a"),lj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?oj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&HI(e,t,i),i},"__decorateClass$j");let qi=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new P(1,1,1))}},"CSize3");aj(qi,"CSize3");qi=lj([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,equal:Tr,label:"Size",inputComponent:op,inputComponentProps:{resettable:!0},clone(n){return new P().copy(n)},serialize(n){return[n.x,n.y,n.z]},deserialize(n){return new P(n[0],n[1],n[2])}})],qi);var WI=Object.defineProperty,cj=Object.getOwnPropertyDescriptor,uj=u((n,e)=>WI(n,"name",{value:e,configurable:!0}),"__name$29"),hj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?cj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&WI(e,t,i),i},"__decorateClass$i");let Uf=u(class extends Fe{constructor(){super(...arguments);A(this,"value",[1,1,1])}},"CSkyColor");uj(Uf,"CSkyColor");Uf=hj([Be({storable:!0,dataType:ke.NUMBER_ARRAY,autoCopy:!0,equal:(n,e)=>new De().setRGB(n[0],n[1],n[2]).getHex()===new De().setRGB(e[0],e[1],e[2]).getHex(),label:"Sky Color",inputComponent:r1,clone(n){return[...n]}})],Uf);var jI=Object.defineProperty,dj=Object.getOwnPropertyDescriptor,fj=u((n,e)=>jI(n,"name",{value:e,configurable:!0}),"__name$28"),pj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?dj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&jI(e,t,i),i},"__decorateClass$h");let th=u(class extends Fe{constructor(){super(...arguments);A(this,"value",0)}},"CSliceAngleEnd");fj(th,"CSliceAngleEnd");th=pj([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Angle End",inlineLabel:!0,inputComponent:rs})],th);var XI=Object.defineProperty,mj=Object.getOwnPropertyDescriptor,gj=u((n,e)=>XI(n,"name",{value:e,configurable:!0}),"__name$27"),vj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?mj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&XI(e,t,i),i},"__decorateClass$g");let nh=u(class extends Fe{constructor(){super(...arguments);A(this,"value",0)}},"CSliceAngleStart");gj(nh,"CSliceAngleStart");nh=vj([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Angle Start",inlineLabel:!0,inputComponent:rs})],nh);var YI=Object.defineProperty,yj=Object.getOwnPropertyDescriptor,_j=u((n,e)=>YI(n,"name",{value:e,configurable:!0}),"__name$26"),bj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?yj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&YI(e,t,i),i},"__decorateClass$f");let sh=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.5)}},"CSliceInnerRadius");_j(sh,"CSliceInnerRadius");sh=bj([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Star Inner Radius",inputComponent:Xo,inputComponentProps:{min:0,max:1,step:.001}})],sh);var qI=Object.defineProperty,wj=Object.getOwnPropertyDescriptor,xj=u((n,e)=>qI(n,"name",{value:e,configurable:!0}),"__name$25"),Aj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?wj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&qI(e,t,i),i},"__decorateClass$e");let ih=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!1)}},"CSlicePreventTwisting");xj(ih,"CSlicePreventTwisting");ih=Aj([Be({storable:!0,dataType:ke.BOOLEAN,label:"Prevent Twisting",inlineLabel:!0,inputComponent:Er})],ih);var KI=Object.defineProperty,Mj=Object.getOwnPropertyDescriptor,Sj=u((n,e)=>KI(n,"name",{value:e,configurable:!0}),"__name$24"),Cj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Mj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&KI(e,t,i),i},"__decorateClass$d");let rh=u(class extends Fe{constructor(){super(...arguments);A(this,"value","ellipse")}},"CSliceShape");Sj(rh,"CSliceShape");rh=Cj([Be({storable:!0,dataType:ke.STRING,label:"Shape",inlineLabel:!0,inputComponent:Za,inputComponentProps:{options:["ellipse","rectangle","star"]}})],rh);var ZI=Object.defineProperty,Ej=Object.getOwnPropertyDescriptor,Tj=u((n,e)=>ZI(n,"name",{value:e,configurable:!0}),"__name$23"),Pj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Ej(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&ZI(e,t,i),i},"__decorateClass$c");let ac=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new $e(.1,.1))}},"CSliceSize2End");Tj(ac,"CSliceSize2End");ac=Pj([Be({storable:!0,dataType:ke.NUMBER_ARRAY,equal(n,e){return n.equals(e)},label:"End Size",inputComponent:o1,clone(n){return new $e().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new $e(n[0],n[1])}})],ac);var QI=Object.defineProperty,Rj=Object.getOwnPropertyDescriptor,Ij=u((n,e)=>QI(n,"name",{value:e,configurable:!0}),"__name$22"),Dj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Rj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&QI(e,t,i),i},"__decorateClass$b");let lc=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new $e(.1,.1))}},"CSliceSize2Start");Ij(lc,"CSliceSize2Start");lc=Dj([Be({storable:!0,dataType:ke.NUMBER_ARRAY,equal(n,e){return n.equals(e)},label:"Start Size",inputComponent:o1,clone(n){return new $e().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new $e(n[0],n[1])}})],lc);var JI=Object.defineProperty,Lj=Object.getOwnPropertyDescriptor,Oj=u((n,e)=>JI(n,"name",{value:e,configurable:!0}),"__name$21"),kj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Lj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&JI(e,t,i),i},"__decorateClass$a");let oh=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.006)}},"CSmooth");Oj(oh,"CSmooth");oh=kj([Be({storable:!0,dataType:ke.NUMBER,equal(n,e){return Math.abs(n-e)<1e-8},label:"Smooth",inputComponent:rs,inputComponentProps:{min:0}})],oh);var eD=Object.defineProperty,Nj=Object.getOwnPropertyDescriptor,Fj=u((n,e)=>eD(n,"name",{value:e,configurable:!0}),"__name$20"),zj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Nj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&eD(e,t,i),i},"__decorateClass$9");let $f=u(class extends Fe{constructor(){super(...arguments);A(this,"value",30)}},"CSpotLightAngle");Fj($f,"CSpotLightAngle");$f=zj([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,label:"Angle",inputComponent:Xo,inputComponentProps:{min:0,max:90,step:.1}})],$f);var tD=Object.defineProperty,Bj=Object.getOwnPropertyDescriptor,Uj=u((n,e)=>tD(n,"name",{value:e,configurable:!0}),"__name$1$"),$j=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Bj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&tD(e,t,i),i},"__decorateClass$8");let cc=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new $e(.5,.5))}},"CStartRadius2");Uj(cc,"CStartRadius2");cc=$j([Be({storable:!0,dataType:ke.NUMBER_ARRAY,instanceable:!0,equal:Tr,label:"Start Radius",inputComponent:o1,clone(n){return new $e().copy(n)},serialize(n){return[n.x,n.y]},deserialize(n){return new $e(n[0],n[1])}})],cc);var nD=Object.defineProperty,Vj=Object.getOwnPropertyDescriptor,Gj=u((n,e)=>nD(n,"name",{value:e,configurable:!0}),"__name$1_"),Hj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Vj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&nD(e,t,i),i},"__decorateClass$7");let ah=u(class extends Fe{constructor(){super(...arguments);A(this,"value",5)}},"CStarVertices");Gj(ah,"CStarVertices");ah=Hj([Be({storable:!0,dataType:ke.NUMBER,label:"Star Vertices",inputComponent:rs})],ah);var sD=Object.defineProperty,Wj=Object.getOwnPropertyDescriptor,jj=u((n,e)=>sD(n,"name",{value:e,configurable:!0}),"__name$1Z"),Xj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Wj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&sD(e,t,i),i},"__decorateClass$6");let Us=u(class extends Fe{constructor(){super(...arguments);A(this,"value","none")}},"CSymmetry");jj(Us,"CSymmetry");Us=Xj([Be({storable:!0,dataType:ke.STRING,label:"Symmetry",inputComponent:Za,inputComponentProps:{options:["none","x","y","z"]}})],Us);var iD=Object.defineProperty,Yj=Object.getOwnPropertyDescriptor,qj=u((n,e)=>iD(n,"name",{value:e,configurable:!0}),"__name$1Y"),Kj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Yj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&iD(e,t,i),i},"__decorateClass$5");let Sr=u(class extends Fe{constructor(){super(...arguments);A(this,"value",new P(1,1,1))}},"CTemporaryScale");qj(Sr,"CTemporaryScale");Sr=Kj([Be({autoCopy:!0,clone(n){return new P().copy(n)}})],Sr);var rD=Object.defineProperty,Zj=Object.getOwnPropertyDescriptor,Qj=u((n,e)=>rD(n,"name",{value:e,configurable:!0}),"__name$1X"),Jj=u((n,e,t,s)=>{for(var i=s>1?void 0:s?Zj(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&rD(e,t,i),i},"__decorateClass$4");let Vf=u(class extends Fe{constructor(){super(...arguments);A(this,"value","512")}},"CTextureSize");Qj(Vf,"CTextureSize");Vf=Jj([Be({storable:!0,dataType:ke.STRING,autoCopy:!0,label:"Texture Quality",inputComponent:Za,inputComponentProps:{options:["128","256","512","1024","2048"]}})],Vf);var oD=Object.defineProperty,eX=Object.getOwnPropertyDescriptor,aD=u((n,e)=>oD(n,"name",{value:e,configurable:!0}),"__name$1W"),tX=u((n,e,t,s)=>{for(var i=s>1?void 0:s?eX(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&oD(e,t,i),i},"__decorateClass$3");function dw(n){return n.map(e=>({radius:e.radius,position:new P().copy(e.position)}))}u(dw,"cloneTube");aD(dw,"cloneTube");const mf=new Bs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:2273612,opacity:.75}),o0=mf.clone();o0.color.setHex(16776960);o0.opacity=1;const gf=mf.clone();gf.color.setHex(15964205);gf.opacity=1;var Hd;let vt=u((Hd=class extends Fe{constructor(){super(...arguments);A(this,"value",[]);A(this,"dirty",!0);A(this,"group");A(this,"pickers",[]);A(this,"circles",[]);A(this,"lines",[]);A(this,"hovered",-1);A(this,"selected",[]);A(this,"draggingStartValue");A(this,"draggingStartMatrix");A(this,"draggingStartInvMatrix");A(this,"draggingStartNodeIndex",-1)}onRemoved(){var e;(e=this.group)==null||e.removeFromParent()}updateColor(){for(let e=0,t=this.circles.length;e<t;++e){const s=this.circles[e];if(this.selected.includes(e)||e===this.draggingStartNodeIndex?s.material=gf:e===this.hovered?s.material=o0:s.material=mf,e<t-1){const i=this.lines[e];this.selected.includes(e)&&this.selected.includes(e+1)?i.material=gf:i.material=mf}}}addSelection(e){this.selected.includes(e)||this.selected.push(e)}clone(e=this.value){return dw(e)}},A(Hd,"normalMaterial",mf),A(Hd,"hoveredMaterial",o0),A(Hd,"selectedMaterial",gf),Hd),"CTube");aD(vt,"CTube");vt=tX([Be({storable:!0,dataType:ke.NUMBER_ARRAY,equal(n,e){if(n.length!==e.length)return!1;for(let t=0,s=n.length;t<s;++t){const i=n[t],r=e[t];if(Math.abs(i.radius-r.radius)>1e-8||!Tr(i.position,r.position))return!1}return!0},clone:dw,serialize(n){const e=[];for(let t of n)e.push(t.radius,t.position.x,t.position.y,t.position.z);return e},deserialize(n){const e=[];for(let t=0,s=n.length;t<s;t+=4)e.push({radius:n[t],position:new P(n[t+1],n[t+2],n[t+3])});return e}})],vt);var lD=Object.defineProperty,nX=Object.getOwnPropertyDescriptor,sX=u((n,e)=>lD(n,"name",{value:e,configurable:!0}),"__name$1V"),iX=u((n,e,t,s)=>{for(var i=s>1?void 0:s?nX(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&lD(e,t,i),i},"__decorateClass$2");let Qi=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!1)}},"CUsePlainMaterial");sX(Qi,"CUsePlainMaterial");Qi=iX([Be({storable:!0,dataType:ke.BOOLEAN,label:"Use Plain Material",inlineLabel:!0,inputComponent:Er})],Qi);var cD=Object.defineProperty,rX=Object.getOwnPropertyDescriptor,oX=u((n,e)=>cD(n,"name",{value:e,configurable:!0}),"__name$1U"),aX=u((n,e,t,s)=>{for(var i=s>1?void 0:s?rX(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&cD(e,t,i),i},"__decorateClass$1");let gt=u(class extends Fe{constructor(){super(...arguments);A(this,"value",!0)}},"CVisible");oX(gt,"CVisible");gt=aX([Be({storable:!0,dataType:ke.BOOLEAN,instanceable:!0})],gt);var uD=Object.defineProperty,lX=Object.getOwnPropertyDescriptor,cX=u((n,e)=>uD(n,"name",{value:e,configurable:!0}),"__name$1T"),uX=u((n,e,t,s)=>{for(var i=s>1?void 0:s?lX(e,t):e,r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&uD(e,t,i),i},"__decorateClass");let Gf=u(class extends Fe{constructor(){super(...arguments);A(this,"value",.5)}},"CWidth");cX(Gf,"CWidth");Gf=uX([Be({storable:!0,dataType:ke.NUMBER,autoCopy:!0,label:"Width",inputComponent:rs,inputComponentProps:{min:0,step:.001}})],Gf);var hX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntlDEOACEIBMH4/y/PNVqK6xEbw9TLbDQEs6LI4koIQJK5S75jOYNr8ijb/w5Odt+yLFCGlRe2XSBLFTxSALDauHRBJDcLbtHV+1O8xQcgdTP9QsaHuQAAAABJRU5ErkJggg==",dX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGJJREFUSIntlMEOwCAMQsX4/7/cXU1cIwM9rRyb8tBIbK1UcgVmKSJiMQKY5wAoFgV/m2d7EvzIvnIi2iNd93ZA5hlfQRk4a1F3A3b1tANkse+gFoIyW/AdhIVbfxHjLf1ADzNkU8v8yWLDAAAAAElFTkSuQmCC",fX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGlJREFUSIntk8EOwCAIQ8X//+futEQZSgnsRi8m+KCKOEarlZUwEAC4hUSoWmbxm8G7xxwinKzjFne8VrQtAEC3yWuLZhh+S1xXljvxUwei0+DxH4NqlRjcHjht4E1PyoAZzbJ/0Gr9pwf7m2fK2pb3HwAAAABJRU5ErkJggg==",pX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGJJREFUSIntlEsOABAMRFXc/8pjg1gYoZ+NeDsJr60JKX2eRyyHAWCIREyurXy17mTXql6sumUTFI3U9b7ROC1+LffcFyI/zoCJVXmwrjChbYwWMEt3Mos8/CXTgEI/ss9bVP0SW8Od0GmxAAAAAElFTkSuQmCC",mX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAEVJREFUSIljYBgFo2AUMJKi+P/////hGhkZSdJLkuHY+FQ1nKqWEDKEkDwTxS4gAGhuAVGApnGAyzBiDR88+WAUjIKBAwBuly/fa4hrDAAAAABJRU5ErkJggg==",gX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntlDEOACEIBMH4/y/PNVqK6xEbw9TLbDQEs6LI4koIQJK5S75jOYNr8ijb/w5Odt+yLFCGlRe2XSBLFTxSALDauHRBJDcLbtHV+1O8xQcgdTP9QsaHuQAAAABJRU5ErkJggg==",vX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFJJREFUSIljYBgFwx4wEqPo/////7FqZmQkSj9eg3EZTow8QcOpoZaFGI24goIYR+C1AGYwoTgg2wfoBpEDmMjVOGrBqAXEAWoUFQNb2I2C4QEA1pU/86LVRNwAAAAASUVORK5CYII=",yX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFpJREFUSIljYBgFwx4wEqvw/////1E0MjISrZdkw3GJYQMslFhCFYDPYGIsZaKucwbAAryAmCAgpGboB9HAxQEp6R6f2oFPRYQyGiGfElVg4TKEqgXeKBi6AABeBzvf6MK7nQAAAABJRU5ErkJggg==",_X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFJJREFUSIljYBgFwx4wEqvw/////1E0MjISrZegweiG4xMn2XBqqKFYIz61TGTZTikgx9u49NDcB0PfApxgaKciGKBpRkM2gJKiYuALu1Ew9AEAikNPxTqns+wAAAAASUVORK5CYII=",bX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntk0sOABAMRI24/5VrJREZMagF8TaiUdNvCJ/nATOamUnOAPUfogioQcSlCCY4LkBp0y93dtYsC8wE0SKViDmrEyQJsM9cp+hIBnXzAKDXaBd2Fu/+RUvqQ9eaf94iA4BHZ8IWGlTXAAAAAElFTkSuQmCC",wX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGRJREFUSIntlEEKACEMA63//3O9iQetTcyyCM5NbDKiYCmPv7Fo0929D5qFszBj+WwtLZdLoiKJZFdyLMkUHEmyYVqCBCkJGoIlzKmgDHu3s1xlihA+FyxRPXT6N90h/20f99AAFR1frx4A45oAAAAASUVORK5CYII=",xX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFdJREFUSIljYBgFAw0Y8Un+////P1whIyNetSQDZMOx8alqOCWWMFHunFELBrsFLKRqwJWSSMon5CRHkvSQm6mw6Rv6kYwTkBpMOCOfWpZQvbQdBUMHAADHwTPtL/6pwwAAAABJRU5ErkJggg==",AX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFtJREFUSIntlEsOABAQQ9X971xbkRkpIoh5m9n1k4aUgn8hSeUuiR/lmgZYMQQAkqyv5NoKWgZqy+wlk5IIhqbBzAZeqO0NTKF2uN7Io0GmueZdnAmx9eML3qcABu5vvYZpbJgAAAAASUVORK5CYII=",MX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntk8EOwCAIQ63Z//8yO5kYB1iCiTvwjkhbotJaUfweME0iIqoYoPSusWXOnG/NNTPNNBwyC6wp1zodEhXt+juVmuDxDgFgTLX+GKtO4d259ybpkBO9H2F2D+5uclFQvCsPj41FND51AAAAAElFTkSuQmCC",SX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntkcEKwCAMQxvx/3+5ngo63KK2wg59pyIkMa1IkvwezB5VVY/MgKlfSMCbpjCRCfu5N2Sf+QwQGWsDwG47GuCFBjzXYo2sDTvs8YrM3H0DL1sBKytZNorS1MiQJLlDA/9ET+yIPaCNAAAAAElFTkSuQmCC",CX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHBJREFUSIntlMEOwCAIQ2X//8/dZVuMoZt0eNDYG4J9hBBK2VpexhIA8BSZ0TpJtbkXp5r3QHDJyx0KrK0JjfCrUxaHxtgzJtm8/uR99N5/LUFryKAygIGGABTz1zWNwtIA6afjlrI94U6GHsGtOXUCrECLjc6LLwMAAAAASUVORK5CYII=",EX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntkkEKACAIBLP//9lOhgdJSlc6ODdhmYFojKaJQt6AmXmPidz9FVpu3any18iMxEKcpGnBsoglS3+2sgj061pSSEDEIodFtBwegQaav1kXY2ucLK26fgAAAABJRU5ErkJggg==",TX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF9JREFUSIntk0EOwCAIBN2m///y9m4WLIKJB+ZiRN0hRsdomuuBKpLkVhgg80oE1pknGhRlKdi9rl8CkgSArEQGz6HR+VLg1eexTKDWlCwlsPYffabeB3u9rirkTZPnA+JpX7qX66AGAAAAAElFTkSuQmCC",PX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFtJREFUSIntk0EKACAIBN3o/1+2a5iVqEQH5yJI7oopUVF8D7QkM7NLDFD1Ugx2Nd1SCABzlG9OnTeLuCYmo8sgg7DB7b9MBieRv0c0bw+R/z4WntxBWrdFEWYA0ho4CpvAbnEAAAAASUVORK5CYII=",Qh="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGNJREFUSIljYBgFAw0YiVX4/////ygaGRmJ1kvQYHTD8YmTbDilapgocgElgBTv41NLtA+QDaE47HEZiByxVLFwaEcyDNA0HyAbRowYNjDwQQQD5KYaFnItGTRg4IvrUUBzAAC2uXOjDxKDVAAAAABJRU5ErkJggg==",RX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntk8EKACEIRDP2/3959hRI4DqNnRbfLQqfNjVG83ss2gAAuohZWCeEFWTnHkXoO866pwWn4sWsCjLoCaQgTwRqBtQV7S/Fr+GQBYr4ioCBykANOBV8/VJWGgoqXTfNXV4/VTgWLIRfCQAAAABJRU5ErkJggg==",IX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntkkkKACEMBO1h/v/l8jIDIlGJC3hInVzoVCKmFATXI+sQYKqYZNbbImhlHk+QD08zXQGAJJVF6v2I4QSruAX/VMcE1z2RSf1zynXvbkqwmnl3SoLgDBnHw1PSkFB0SwAAAABJRU5ErkJggg==",DX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFdJREFUSIljYBgFo4BSwEiswv/////H0MzISLR+og3HxaaK4cTwKTKcFDGyDCdHnIlkm0kEOFMBOd4mKVUNmSDCC2iainBppmo+wGYIqTl5cJRFo2BoAwCKVWuoeE0X9QAAAABJRU5ErkJggg==",LX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAE5JREFUSIljYBgFwx4w4pP8////fxTFjIx41ZME0A3HJUY1w6lqCSFDKLaEGAMosoRYzaOWDC5LaJ6yaJ4/aJrL8RlOVuFF00JwFAw9AACJKmejS/9FQQAAAABJRU5ErkJggg==",OX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFdJREFUSIljYBgFo4BSwEiswv/////H0MzISLR+og3HxaaK4cTwKTKcFDGyDCdHnIlkm0kEOFMBOd4mKVUNmSDCC2iainBppmo+wGYIqTl5cJRFo2BoAwCKVWuoeE0X9QAAAABJRU5ErkJggg==",kX="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAEVJREFUSIljYBgFo2AUMJKi+P/////hGhkZSdJLkuHY+FQ1nKqWEDKEkDwTxS4gAGhuAVGApnGAyzBiDR88+WAUjIKBAwBuly/fa4hrDAAAAABJRU5ErkJggg==",NX=Object.defineProperty,hD=u((n,e)=>NX(n,"name",{value:e,configurable:!0}),"__name$1S");const dD=[{name:"Container",label:"Container",icon:fX,showInList:!0,instanceable:!0,components:[zt,gt,nn,Li,oc,ze,nt,Wt,an,Pe],canBeRoot:!0,validChildTypes:["Container","IKChain","Image","CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier","ObjModel","FbxModel","ImportModel","Box","Shape","Clay","Mirror","OpenPoseKeypoint","AmbientLight","HemisphereLight","DirectionalLight","PointLight","SpotLight"]},{name:"IKChain",label:"IK Chain",icon:CX,showInList:!0,instanceable:!0,components:[zt,gt,nn,Li,oc,ze,nt,Wt,an,Pe,Ju,Ff],canBeRoot:!0,validChildTypes:["IKNode"]},{name:"IKNode",label:"IK Node",icon:EX,showInList:!0,instanceable:!0,components:[zt,gt,nn,an,Pe,Et,Js,En,eh,di,$a],canBeRoot:!1,validChildTypes:["Container","IKChain","Image","CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier","ObjModel","FbxModel","ImportModel","Box","Shape","Clay","Mirror","OpenPoseKeypoint","AmbientLight","HemisphereLight","DirectionalLight","PointLight","SpotLight"]},{name:"CsgGroup",label:"Union",icon:bX,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As,Us],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgIntersect",label:"Intersect",icon:AX,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgHull",label:"Hull",icon:wX,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgHullChain",label:"Hull Chain",icon:xX,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As],canBeRoot:!0,validChildTypes:["CsgGroup","CsgIntersect","CsgHull","CsgHullChain","CsgCuboid","CsgEllipsoid","CsgCylinder","CsgCylinderElliptic","CsgTorus","CsgBezier"]},{name:"CsgCuboid",label:"Cuboid",icon:gX,showInList:!0,instanceable:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As,qi,Oi,ns],canBeRoot:!0,validChildTypes:[],defaultData:{[Oi.name]:0,[qi.name]:new P(.2,.2,.2)}},{name:"CsgEllipsoid",label:"Ellipsoid",icon:_X,showInList:!0,instanceable:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As,gr,ns],canBeRoot:!0,validChildTypes:[],defaultData:{[gr.name]:new P(.1,.1,.1)}},{name:"CsgCylinder",label:"Cylinder",icon:vX,showInList:!0,instanceable:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As,fn,ui,Oi,ns],canBeRoot:!0,validChildTypes:[],defaultData:{[Oi.name]:0,[fn.name]:.2,[ui.name]:.1}},{name:"CsgCylinderElliptic",label:"Cylinder Elliptic",icon:yX,showInList:!0,instanceable:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As,fn,cc,sc,ju,ns],canBeRoot:!0,validChildTypes:[],defaultData:{[fn.name]:.2,[cc.name]:new $e(.1,.1),[sc.name]:new $e(0,0)}},{name:"CsgTorus",label:"Torus",icon:MX,showInList:!0,instanceable:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As,rc,Zu,Ku,ic,Yu,Xu],canBeRoot:!0,validChildTypes:[],defaultData:{[rc.name]:.1,[ic.name]:.05}},{name:"CsgBezier",label:"Curve",icon:pX,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[zt,gt,nn,ze,nt,It,an,Pe,Dn,In,Vt,Rn,je,As,rh,lc,ac,ah,sh,nh,th,qu,ns,ih],canBeRoot:!0,validChildTypes:["CsgBezierControlPoint"],defaultData:{[lc.name]:new $e(.05,.05),[ac.name]:new $e(.05,.05)},defaultChildren:[{type:"CsgBezierControlPoint",data:{[ze.name]:new P(0,0,0)}},{type:"CsgBezierControlPoint",data:{[ze.name]:new P(.2,0,0)}}]},{name:"CsgBezierControlPoint",label:"Control Point",icon:mX,showInList:!0,instanceable:!1,components:[ze,Pe,je],canBeRoot:!1,validChildTypes:[]},{name:"Box",label:"Box",icon:hX,showInList:!0,instanceable:!0,mesh:!0,components:[zt,gt,nn,Gn,Xs,ze,nt,Wt,Vt,Rn,Dn,In,an,Pe,Yi],canBeRoot:!0,validChildTypes:[],defaultData:{[Yi.name]:new P(.2,.2,.2)}},{name:"Shape",label:"Tube",icon:LX,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,mesh:!0,components:[zt,gt,nn,Gn,Xs,ze,nt,Wt,Vt,Rn,Dn,In,an,Pe,Pi,oh,Us],canBeRoot:!0,validChildTypes:["Tube"]},{name:"Tube",label:"Tube Node",icon:kX,showInList:!0,components:[zt,Pe,Qu,vt],canBeRoot:!1,validChildTypes:[]},{name:"Clay",label:"Clay",icon:dX,showInList:!0,instanceable:!0,mesh:!0,components:[zt,gt,nn,Gn,Xs,ze,nt,Wt,Dn,In,Vt,Rn,an,Pe,Mn,Mr,Us,Sr],canBeRoot:!0,validChildTypes:[]},{name:"Image",label:"Image",icon:TX,showInList:!1,instanceable:!0,mesh:!0,components:[zt,gt,nn,Gn,Xs,ze,nt,Wt,an,Pe,Kr],canBeRoot:!0,defaultData:{[Gn.name]:!1,[Xs.name]:!1},validChildTypes:[]},{name:"ObjModel",label:"Obj Model",icon:IX,showInList:!1,instanceable:!0,mesh:!0,components:[zt,gt,nn,Gn,Xs,ze,nt,Wt,Qi,Dn,In,Vt,Rn,an,Pe,Vo],canBeRoot:!0,validChildTypes:[]},{name:"FbxModel",label:"Fbx Model",icon:SX,showInList:!1,instanceable:!0,mesh:!0,components:[zt,gt,nn,Gn,Xs,ze,nt,Wt,Qi,Dn,In,Vt,Rn,an,Pe,$o],canBeRoot:!0,validChildTypes:[]},{name:"ImportModel",label:"Import Model",icon:PX,showInList:!1,instanceable:!0,mesh:!0,components:[kf,zt,gt,nn,Gn,Xs,ze,nt,Wt,Qi,Dn,In,Vt,Rn,an,Pe,Go],canBeRoot:!0,validChildTypes:[]},{name:"Mirror",label:"Mirror",icon:RX,showInList:!0,mesh:!0,components:[zt,gt,nn,Vf,ze,nt,Wt,Pe,Gf,fn,Vt],canBeRoot:!0,validChildTypes:[]},{name:"OpenPoseKeypoint",label:"Pose Keypoint",icon:DX,showInList:!0,instanceable:!0,components:[ze,wr,Pe],canBeRoot:!1,validChildTypes:[]},{name:"Target",label:"Target",icon:OX,showInList:!1,instanceable:!0,fixed:!0,unique:!0,components:[ze,Pe],canBeRoot:!1,validChildTypes:[]},{name:"AmbientLight",label:"Ambient Light",icon:Qh,showInList:!0,instanceable:!0,light:!0,components:[zt,gt,Pe,Ys,Vt],canBeRoot:!0,defaultData:{[Ys.name]:.2},validChildTypes:[]},{name:"HemisphereLight",label:"Hemisphere Light",icon:Qh,showInList:!0,instanceable:!0,light:!0,components:[zt,gt,ze,Pe,ei,Ys,Uf,Nf],canBeRoot:!0,validChildTypes:[],defaultData:{[Ys.name]:.2,[ze.name]:new P(0,1,0)}},{name:"DirectionalLight",label:"Directional Light",icon:Qh,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,light:!0,components:[zt,gt,Gn,No,Bf,ze,Pe,ei,Ys,Vt],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[ze.name]:new P(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]},{name:"PointLight",label:"Point Light",icon:Qh,showInList:!0,instanceable:!0,light:!0,components:[zt,gt,Gn,No,ze,Pe,ei,Ys,Vt],canBeRoot:!0,validChildTypes:[],defaultData:{[ze.name]:new P(0,1,0)}},{name:"SpotLight",label:"Spot Light",icon:Qh,showInList:!0,instanceable:!0,preventCreatingInstanceChild:!0,light:!0,components:[zt,gt,Gn,No,zf,$f,ze,Pe,ei,Ys,Vt],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[ze.name]:new P(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]}],fD={};for(let n of dD)fD[n.name]=n;function kn(n){const e=fD[n];if(!e)throw new Error(`Node def [${n}] not found`);return e}u(kn,"getModelNodeDef");hD(kn,"getModelNodeDef");function fw(n){return kn(n.type).validChildTypes.map(kn).filter(t=>t.unique?!n.children.find(s=>s.type===t.name):!0)}u(fw,"getValidChildNodeDefs");hD(fw,"getValidChildNodeDefs");var FX=Object.defineProperty,zX=u((n,e)=>FX(n,"name",{value:e,configurable:!0}),"__name$1R");const lm=new be;class Yl{constructor(){A(this,"id",0);A(this,"type","");A(this,"expanded",!0);A(this,"components",{});A(this,"parent",null);A(this,"children",[]);A(this,"dirty",!0);A(this,"deleted",!1);A(this,"opacity",1);A(this,"visible",!0);A(this,"instanceId",0);A(this,"instanceMeshDirty",!0);A(this,"instanceMeshRebuild",!0);A(this,"mirrorGeometry",{})}get(e){const t=this.components[e.name];if(!t)throw new Error(`Component [${e.name}] not found`);return t}has(e){return this.components[e.name]!=null}value(e){return this.get(e).value}cloneValue(e){const t=this.get(e).value,s=ti(e.name);return s.clone?s.clone(t):t}forEach(e){const t=[this];for(;;){const s=t.pop();if(!s)break;if(e(s)===!1)return!1;for(let i=s.children.length;i--;)t.push(s.children[i])}}getLocalMatrix(){if(this.has(Pe)){const e=this.value(Pe);if(e)return e.matrix}return this.parent?this.parent.getLocalMatrix():lm}getWorldMatrix(){if(this.has(Pe)){const e=this.value(Pe);if(e)return e.matrixWorld}return this.parent?this.parent.getWorldMatrix():lm}getParentWorldMatrix(){return this.type==="Target"?lm:this.parent?this.parent.getWorldMatrix():lm}async toJson(){var t;const e=[];for(let s of this.children)e.push(await s.toJson());return{type:this.type,expanded:this.expanded,parentId:(t=this.parent)==null?void 0:t.id,instanceId:this.instanceId,data:await this.getComponentsDataJson(),children:e}}getComponentData(e){const t={};for(let s in this.components){const i=ti(s);if(!(e&&!(i.instanceable||i.autoCopy))&&i.storable){let o=this.components[s].value;i.clone&&(o=i.clone(o)),t[s]=o}}return t}async getComponentsDataJson(){const e={};for(let t in this.components){const s=ti(t);if(s.storable){let r=this.components[t].value;s.serialize&&(r=s.serialize(r)),r&&s.dataType===ke.BYTES&&(r=await Wu(r)),e[t]=r}}return e}isValidChild(e){return!!fw(this).find(t=>t.name===e)}}u(Yl,"ModelNode");zX(Yl,"ModelNode");var BX=Object.defineProperty,UX=u((n,e)=>BX(n,"name",{value:e,configurable:!0}),"__name$1Q");class pw{onValueChanged(e,t,s){s===Yi&&(t.get(Yi).dirty=!0)}onChildAdded(e,t,s){}onBeforeChildRemoved(e,t,s){}onMoved(e,t,s,i){}}u(pw,"BoxWatcher");UX(pw,"BoxWatcher");var $X=Object.defineProperty,VX=u((n,e)=>$X(n,"name",{value:e,configurable:!0}),"__name$1P");class mw{onValueChanged(e,t,s){s===Mn?t.get(Mn).dirty=!0:s===Mr&&(t.get(Mr).dirty=!0)}onChildAdded(e,t,s){}onBeforeChildRemoved(e,t,s){}onMoved(e,t,s,i){}}u(mw,"ClayWatcher");VX(mw,"ClayWatcher");var GX=Object.defineProperty,HX=u((n,e)=>GX(n,"name",{value:e,configurable:!0}),"__name$1O");const WX={CsgGroup:[Us],CsgCuboid:[qi,Oi,ns],CsgEllipsoid:[gr,ns],CsgCylinder:[fn,ui,Oi,ns],CsgCylinderElliptic:[fn,cc,sc,ju,ns],CsgRoundedCuboid:[qi,Oi,ns],CsgRoundedCylinder:[fn,ui,Oi,ns],CsgTorus:[ic,rc,Yu,Zu,Xu,Ku],CsgBezier:[rh,lc,ac,ah,sh,nh,th,qu,ns,ih],CsgBezierControlPoint:[ze]};class gw{onValueChanged(e,t,s){var i;if(!!t.has(je)){if([ze,nt,Wt,It].includes(s)){const r=t.get(je);r.matDirty=!0,this.markCsgNodeDirty(t.parent);return}if([gt,As].includes(s)){this.markCsgNodeDirty(t.parent);return}(i=WX[t.type])!=null&&i.includes(s)&&this.markCsgNodeDirty(t)}}onChildAdded(e,t,s){this.markCsgNodeDirty(t)}onBeforeChildRemoved(e,t,s){this.markCsgNodeDirty(t)}onMoved(e,t,s,i){this.markCsgNodeDirty(s),this.markCsgNodeDirty(i)}markCsgNodeDirty(e){for(;e&&e.has(je);){e.dirty=!0;const t=e.get(je);t.dirty=!0,e=e.parent}}}u(gw,"CsgWatcher");HX(gw,"CsgWatcher");var jX=Object.defineProperty,pD=u((n,e)=>jX(n,"name",{value:e,configurable:!0}),"__name$1N");const XX=[Js,En,di,$a];function uu(n,e){if(!n)return;n.dirty=!0;let t=Math.max(0,e?n.children.indexOf(e):0);for(let s=n.children.length;t<s;++t){const i=n.children[t],r=i.get(Et);r&&(i.dirty=!0,r.dirty=!0);const o=i.get(Pe);o&&(o.localTransformChanged=!0,o.worldTransformChanged=!0)}}u(uu,"markIkChainDirty");pD(uu,"markIkChainDirty");class vw{onValueChanged(e,t,s){XX.includes(s)&&uu(t.parent,t)}onMoved(e,t,s,i){t.has(Et)&&(uu(s),uu(i,t))}onChildAdded(e,t,s){s.has(Et)&&uu(t,s)}onBeforeChildRemoved(e,t,s){s.has(Et)&&uu(t,s)}}u(vw,"IkNodeWatcher");pD(vw,"IkNodeWatcher");var YX=Object.defineProperty,qX=u((n,e)=>YX(n,"name",{value:e,configurable:!0}),"__name$1M");class yw{onValueChanged(e,t,s){s===Kr&&(t.get(Kr).dirty=!0)}onChildAdded(e,t,s){}onBeforeChildRemoved(e,t,s){}onMoved(e,t,s,i){}}u(yw,"ImageWatcher");qX(yw,"ImageWatcher");var KX=Object.defineProperty,ZX=u((n,e)=>KX(n,"name",{value:e,configurable:!0}),"__name$1L");class _w{onValueChanged(e,t,s){s===Vo?t.get(Vo).dirty=!0:s===$o?t.get($o).dirty=!0:s===Go&&(t.get(Go).dirty=!0)}onChildAdded(e,t,s){}onBeforeChildRemoved(e,t,s){}onMoved(e,t,s,i){}}u(_w,"ImportModelWatcher");ZX(_w,"ImportModelWatcher");var QX=Object.defineProperty,JX=u((n,e)=>QX(n,"name",{value:e,configurable:!0}),"__name$1K");class bw{onValueChanged(e,t,s){s===Qi&&!t.instanceId&&e.instanceMeshUpdated(t.id,!1)}onMoved(e,t,s,i){}onChildAdded(e,t,s){}onBeforeChildRemoved(e,t,s){}}u(bw,"MaterialWatcher");JX(bw,"MaterialWatcher");var eY=Object.defineProperty,tY=u((n,e)=>eY(n,"name",{value:e,configurable:!0}),"__name$1J");class ww{onValueChanged(e,t,s){s===an&&t.forEach(i=>i.dirty=!0)}onChildAdded(e,t,s){}onBeforeChildRemoved(e,t,s){}onMoved(e,t,s,i){t.forEach(r=>r.dirty=!0)}}u(ww,"OpacityWatcher");tY(ww,"OpacityWatcher");var nY=Object.defineProperty,sY=u((n,e)=>nY(n,"name",{value:e,configurable:!0}),"__name$1I");class xw{onValueChanged(e,t,s){s===Li?this.markPoseRootDirty(t):s===wr&&this.markPoseRootDirty(t)}onChildAdded(e,t,s){s.type==="OpenPoseKeypoint"&&this.markPoseRootDirty(t)}onBeforeChildRemoved(e,t,s){s.type==="OpenPoseKeypoint"&&this.markPoseRootDirty(t)}onMoved(e,t,s,i){t.type==="OpenPoseKeypoint"&&s!==i&&(s&&this.markPoseRootDirty(s),i&&this.markPoseRootDirty(i))}markPoseRootDirty(e){e.has(Li)&&e.value(Li)?(e.dirty=!0,e.get(Li).dirty=!0):e.parent&&this.markPoseRootDirty(e.parent)}}u(xw,"OpenPoseWatcher");sY(xw,"OpenPoseWatcher");var iY=Object.defineProperty,rY=u((n,e)=>iY(n,"name",{value:e,configurable:!0}),"__name$1H");class Aw{onValueChanged(e,t,s){s===vt?(t.get(vt).dirty=!0,t.parent&&(t.parent.dirty=!0,t.parent.get(Pi).value=!0)):s===Qu?t.parent&&(t.parent.dirty=!0,t.parent.get(Pi).value=!0):(s===Us||s===oh)&&t.type==="Shape"&&(t.get(Pi).value=!0)}onChildAdded(e,t,s){t.type==="Shape"&&(t.dirty=!0,t.get(Pi).value=!0)}onBeforeChildRemoved(e,t,s){t.type==="Shape"&&(t.dirty=!0,t.get(Pi).value=!0)}onMoved(e,t,s,i){(s==null?void 0:s.type)==="Shape"&&(s.dirty=!0,s.get(Pi).value=!0),(i==null?void 0:i.type)==="Shape"&&(i.dirty=!0,i.get(Pi).value=!0)}}u(Aw,"SdfShapeWatcher");rY(Aw,"SdfShapeWatcher");var oY=Object.defineProperty,aY=u((n,e)=>oY(n,"name",{value:e,configurable:!0}),"__name$1G");const lY=[ze,nt,Wt,It,Sr];class Mw{onValueChanged(e,t,s){if(lY.includes(s)){if(t.has(Pe)){const i=t.get(Pe);i.localTransformChanged=!0,i.worldTransformChanged=!0}if(t.has(je)){const i=t.get(je);i.matDirty=!0}}t.type==="Target"&&t.parent&&(t.parent.dirty=!0)}onMoved(e,t,s,i){if(t.has(Pe)){t.dirty=!0;const r=t.get(Pe);r.parentChanged=!0,r.worldTransformChanged=!0}}onChildAdded(e,t,s){}onBeforeChildRemoved(e,t,s){}}u(Mw,"TransformWatcher");aY(Mw,"TransformWatcher");var cY=Object.defineProperty,uY=u((n,e)=>cY(n,"name",{value:e,configurable:!0}),"__name$1F");class ap{constructor(){A(this,"nodesMap",new Map);A(this,"nodes",[]);A(this,"cameraFov",45);A(this,"cameraPerspective",!0);A(this,"cameras",[]);A(this,"watchers",[new Mw,new vw,new ww,new yw,new _w,new pw,new Aw,new gw,new mw,new bw,new xw]);A(this,"dirty",!0);A(this,"instanceDirty",!0);A(this,"referenceMap",new Map);A(this,"selected",[])}reset(){this.selected=[],this.dirty=!1,this.instanceDirty=!1,this.referenceMap.clear();for(let e of this.nodes.map(t=>t.id))this.removeNode(e);this.cameras=[]}addSelection(e){this.selected.includes(e)||this.selected.push(e)}isNodeExists(e,t){if(t){const s=this.nodesMap.get(e);return(s==null?void 0:s.type)===t}return this.nodesMap.has(e)}forEach(e){for(let t of this.nodes)if(t.forEach(e)===!1)return!1}getNode(e){const t=this.nodesMap.get(e);if(!t)throw new Error(`Node #${e} does not exist`);return t}getSelectedNodes(){return this.selected.map(e=>this.getNode(e))}getTopmostSelectedNodes(){const e=[];for(let t of this.selected){const s=this.getNode(t);let i=!0;for(let r=s.parent;r;r=r.parent)if(this.selected.includes(r.id)){i=!1;break}i&&e.push(s)}return e}createNode(e,t,s=null,i=null,r,o){if(this.isNodeExists(e))throw new Error(`Node #${e} already exists`);const a=kn(t),l=new Yl;l.id=e,l.type=t;for(let h of a.components)l.components[h.name]=new h;if(l.parent=rt(s),this.instanceMeshUpdated(e,!0),o&&(l.instanceId=o,this.referenceMap.has(o)?this.referenceMap.get(o).push(e):this.referenceMap.set(o,[e]),this.instanceDirty=!0),r)for(let h in r){let d=l.components[h];if(!d&&o&&h===Xn.name&&(d=l.components[h]=new Xn),d){const f=ti(h);d.value=f.clone?f.clone(r[h]):r[h]}}const c=s?s.children:this.nodes;if(i!=null?c.splice(i,0,l):c.push(l),this.nodesMap.set(e,l),s)for(let h of this.watchers)h.onChildAdded(this,s,l);return this.dirty=!0,l}removeNode(e){var r;if(!this.isNodeExists(e))return;const t=this.getNode(e);if(t.parent)for(let o of this.watchers)o.onBeforeChildRemoved(this,t.parent,t);t.deleted=!0,this.instanceMeshUpdated(e,!0),t.forEach(o=>{if(o.instanceId){const a=this.referenceMap.get(o.instanceId);a&&this.referenceMap.set(o.instanceId,a.filter(l=>l!==o.id)),this.instanceDirty=!0}});for(let o in t.mirrorGeometry)(r=t.mirrorGeometry[o])==null||r.dispose(),delete t.mirrorGeometry[o];t.forEach(o=>{this.nodesMap.delete(o.id);const a=this.selected.indexOf(o.id);a>=0&&this.selected.splice(a,1)});const s=t.parent?t.parent.children:this.nodes,i=s.indexOf(t);i>=0&&s.splice(i,1),t.forEach(o=>{for(let a in o.components)o.components[a].onRemoved()}),this.dirty=!0}moveNode(e,t,s,i){const r=e.parent,o=r?r.children:this.nodes;o.splice(o.indexOf(e),1);const a=t?t.children:this.nodes;if(e.parent=t,s){const l=a.indexOf(s);i?a.splice(l+1,0,e):a.splice(l,0,e)}else i?a.push(e):a.unshift(e);e.dirty=!0,this.dirty=!0;for(let l of this.watchers)l.onMoved(this,e,r,t)}setValue(e,t,s){e.get(t).value=s,e.dirty=!0,this.dirty=!0;for(let r of this.watchers)r.onValueChanged(this,e,t);if(ti(t.name).autoCopy){const r=this.referenceMap.get(e.id);if(r)for(let o of r){const a=this.getNode(o);a.get(t).value=s,a.dirty=!0;for(let l of this.watchers)l.onValueChanged(this,a,t)}}}updateVertices(e,t,s,i){const r=e.get(t),o=r.value,a=e.get(Pe);if(a.mesh){const l=a.mesh;if(t===Mn){l.updateVertices(s,i);for(let c=0,h=o.length;c<h;++c)o[c]=l.aPosition[c]}else if(t===Mr){l.updateColors(s,i);for(let c=0,h=o.length;c<h;++c)o[c]=l.aColor[c]}}for(let l=0,c=s.length;l<c;++l){const h=s[l];for(let d=0;d<3;++d)o[h*3+d]=i[l*3+d]}e.dirty=!0,this.dirty=!0,r.partialUpdate=!0;for(let l of this.watchers)l.onValueChanged(this,e,t)}instanceMeshUpdated(e,t){var i;const s=this.referenceMap.get(e);if(s){this.instanceDirty=!0;for(let r of s)if(this.isNodeExists(r)){const o=this.getNode(r);if(o.instanceMeshDirty=!0,o.instanceMeshRebuild=t,o.has(je)){let a=o.parent;for(;a&&(!a.instanceId&&a.has(je));){this.dirty=!0,a.dirty=!0;const l=a.get(je);l.dirty=!0,a=a.parent}}}}if(this.isNodeExists(e)){const r=this.getNode(e);for(let o in r.mirrorGeometry)t&&((i=r.mirrorGeometry[o])==null||i.dispose()),delete r.mirrorGeometry[o]}}}u(ap,"Model");uY(ap,"Model");var hY=Object.defineProperty,Ng=u((n,e)=>hY(n,"name",{value:e,configurable:!0}),"__name$1E");const dY=200;class Sw{constructor(e){A(this,"model");A(this,"enableMerge",!0);A(this,"currentFrameRecords",[]);A(this,"redoStack",[]);A(this,"undoStack",[]);A(this,"nextNodeId",0);A(this,"deletedNodes",new Set);A(this,"dirty",!1);A(this,"lastEventTarget",null);A(this,"onPointerDown",u(e=>{this.lastEventTarget=e.target,this.enableMerge=!1},"onPointerDown"));A(this,"onKeyDown",u(e=>{this.lastEventTarget!==e.target&&(this.lastEventTarget=e.target,this.enableMerge=!1)},"onKeyDown"));this.model=e}setup(){window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("keydown",this.onKeyDown)}unload(){window.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("keydown",this.onKeyDown)}clear(){this.dirty=!1,this.currentFrameRecords.length=0,this.redoStack.length=0,this.undoStack.length=0}save(){this.dirty=!1}update(){if(this.nextNodeId=0,!this.currentFrameRecords.length)return;if(!this.currentFrameRecords.find(l=>!l.empty)){this.currentFrameRecords.length=0;return}this.redoStack.length=0;const e=[],t=[];let s,i;for(let l of this.currentFrameRecords)e.push(l.redo),t.push(l.undo),s=s||l.getCtx,i=i||l.setCtx;let r=Ng(()=>{for(let l of e)l()},"redo"),o=Ng(()=>{for(let l of t)l()},"undo");r();const a=this.currentFrameRecords.map(l=>l.hash).sort().join("@");if(this.enableMerge)for(;this.undoStack.length;){const l=this.undoStack[this.undoStack.length-1];if(l.hash===a)i&&l.getCtx?i(l.getCtx()):o=l.undo,this.undoStack.pop();else break}else{const l=this.undoStack[this.undoStack.length-1];l&&!l.hash.endsWith("!")&&(l.hash+="!")}this.enableMerge=!0,this.undoStack.push({hash:a,redo:r,undo:o,getCtx:s,setCtx:i}),this.undoStack.length>=dY&&this.undoStack.shift(),this.deletedNodes.clear(),this.currentFrameRecords.length=0,this.dirty=!0}undo(){const e=this.undoStack.pop();!e||(this.redoStack.push(e),this.model.selected=[],e.undo(),this.dirty=!0)}redo(){const e=this.redoStack.pop();!e||(this.undoStack.push(e),e.redo(),this.dirty=!0)}getNextNodeId(){if(this.nextNodeId)return this.nextNodeId;let e=0;return this.model.forEach(t=>{e=Math.max(e,t.id)}),e}createNode(e){const t=this.getNextNodeId()+1;if(this.currentFrameRecords.push({hash:"$createNode",redo:()=>{let s=t;if(e.parentId){let r=this.model.getNode(e.parentId);for(;r;r=r.parent)r.expanded=!0}const i=this.model.createNode(s++,e.type,e.parentId?this.model.getNode(e.parentId):null,null,e.data,e.instanceId);if(e.expanded!=null&&(i.expanded=e.expanded),(e.selected==null||e.selected)&&this.model.addSelection(i.id),e.children){const r=[];for(let o of e.children)r.push([i,o]);for(;r.length;){const o=r.shift();if(!o)break;const a=o[0],l=o[1],c=this.model.createNode(s++,l.type,a,null,l.data,l.instanceId);if(l.expanded!=null&&(c.expanded=l.expanded),(l.selected==null||l.selected)&&this.model.addSelection(c.id),l.children){const h=[];for(let d of l.children)h.push([c,d]);r.unshift(...h)}}}},undo:()=>{this.model.removeNode(t)}}),this.enableMerge=!1,this.nextNodeId=t,e.children){const s=[...e.children];for(;;){const i=s.pop();if(!i)break;this.nextNodeId+=1,i.children&&s.push(...i.children)}}return t}removeNode(e){if(!this.model.isNodeExists(e)||this.deletedNodes.has(e))return;class t{constructor(a,l){A(this,"id");A(this,"type");A(this,"expanded");A(this,"parentId",0);A(this,"instanceId",0);A(this,"index",0);A(this,"data");A(this,"children");this.id=a.id,this.type=a.type,this.expanded=a.expanded,a.parent&&(this.parentId=a.parent.id),this.instanceId=a.instanceId;const c=a.parent?a.parent.children:l.nodes;this.index=c.indexOf(a),this.data=a.getComponentData(),this.children=a.children.map(h=>new t(h,l))}}u(t,"NodeRecord"),Ng(t,"NodeRecord");const s=new t(this.model.getNode(e),this.model),i=[s];for(;i.length;){const o=i.pop();if(!o)break;this.deletedNodes.add(o.id),i.push(...o.children)}this.currentFrameRecords.push({hash:"$removeNode",redo:()=>{this.model.removeNode(e)},undo:()=>{const o=this.model.createNode(s.id,s.type,s.parentId?this.model.getNode(s.parentId):null,s.index,s.data,s.instanceId);this.model.addSelection(o.id);const a=[[o,s.children]];for(;;){const l=a.pop();if(!l)break;const c=l[0],h=l[1];for(let d of h){const f=this.model.createNode(d.id,d.type,c,null,d.data,d.instanceId);f.expanded=d.expanded,this.model.addSelection(f.id),d.children.length&&a.push([f,d.children])}}}}),this.enableMerge=!1;const r=this.model.referenceMap.get(e);if(r)for(let o of r)this.removeNode(o)}moveNode(e,t,s,i,r){const o=e.id,a=t?t.id:0,l=s?s.id:0,c=i,h=e.parent?e.parent.id:0;let d=0,f=!1;const p=e.parent?e.parent.children:this.model.nodes,g=p.indexOf(e);if(g>0&&(d=p[g-1].id,f=!0),this.currentFrameRecords.push({hash:"$moveNode",redo:()=>{this.model.moveNode(this.model.getNode(o),a?this.model.getNode(a):null,l?this.model.getNode(l):null,c)},undo:()=>{this.model.moveNode(this.model.getNode(o),h?this.model.getNode(h):null,d?this.model.getNode(d):null,f),this.model.addSelection(o)}}),this.enableMerge=!1,r&&h!==a){if(e.has(ze)||e.has(nt)||e.has(Wt)||e.has(It)){let m=e.getWorldMatrix();t&&(m=new be().copy(t.getWorldMatrix()).invert().multiply(m));const v=new P,y=new qe,b=new P;m.decompose(v,y,b),e.has(ze)&&this.setValue(e,ze,v),e.has(nt)&&this.setValue(e,nt,new ft().setFromQuaternion(y)),e.has(Wt)&&this.setValue(e,Wt,b.x),e.has(It)&&this.setValue(e,It,b)}else if(e.has(vt)){let m=e.getWorldMatrix();t&&(m=new be().copy(t.getWorldMatrix()).invert().multiply(m));const v=Ia(m),y=e.get(vt).clone();for(let b of y)b.position.applyMatrix4(m),b.radius*=v;this.setValue(e,vt,y)}}}setValue(e,t,s,i){const r=e.id,o=e.value(t),a=r+"#"+(i||t.name),l=ti(t.name);return(l.equal?l.equal(o,s):o===s)?(this.currentFrameRecords.push({hash:a,empty:!0,redo(){},undo:()=>{this.model.setValue(this.model.getNode(r),t,o),this.model.addSelection(r)}}),!1):(this.currentFrameRecords=this.currentFrameRecords.filter(c=>c.hash!==a),this.currentFrameRecords.push({hash:a,redo:()=>{this.model.setValue(this.model.getNode(r),t,s)},undo:()=>{this.model.setValue(this.model.getNode(r),t,o),this.model.addSelection(r)}}),!0)}mergeLastRecord(e){const t=this.undoStack[this.undoStack.length-1];if(!t)return;const s=[];for(let o of e)s.push(o.node.id+"#"+(o.hashName||o.componentClass.name));let i=s.sort().join("@"),r=t.hash;r.endsWith("!")&&(r=r.substring(0,r.length-1)),i===r&&(this.undoStack.pop(),t.hash=r,this.currentFrameRecords.push(t))}updateVertices(e,t,s,i){if(!s.length)return!1;const r=e.id,o=e.value(t);let a=new Float32Array(i.length);for(let f=0,p=s.length;f<p;++f){const g=s[f];for(let m=0;m<3;++m)a[f*3+m]=o[g*3+m]}let l=s,c=s,h=i;const d=r+"#"+t.name;return this.currentFrameRecords=this.currentFrameRecords.filter(f=>f.hash!==d),this.currentFrameRecords.push({hash:d,redo:()=>{this.model.updateVertices(this.model.getNode(r),t,c,h)},undo:()=>{this.model.updateVertices(this.model.getNode(r),t,l,a),this.model.addSelection(r)},setCtx:([f,p,g,m])=>{{const v=new Set([...f,...l]),y=new Float32Array(v.size*3);for(let x=0,S=p.length;x<S;++x)y[x]=p[x];const b=[...f],_=new Set(f);let w=p.length;for(let x=0,S=l.length;x<S;++x){const C=l[x];if(!_.has(C)){b.push(C);for(let M=0;M<3;++M)y[w+M]=a[x*3+M];w+=3}}l=b,a=y}{const v=new Set([...c,...g]),y=new Float32Array(v.size*3);for(let x=0,S=h.length;x<S;++x)y[x]=h[x];const b=[...c],_=new Set(c);let w=h.length;for(let x=0,S=g.length;x<S;++x){const C=g[x];if(!_.has(C)){b.push(C);for(let M=0;M<3;++M)y[w+M]=m[x*3+M];w+=3}}c=b,h=y}},getCtx:()=>[l,a,c,h]}),!0}}u(Sw,"ModelHistory");Ng(Sw,"ModelHistory");var fY=Object.defineProperty,pY=u((n,e)=>fY(n,"name",{value:e,configurable:!0}),"__name$1D");class zi{constructor(){A(this,"subSystems",[])}setup(e){}dispose(){}sub(...e){return this.subSystems.push(...e),this}update(e){this.begin(e);for(let t of this.subSystems)t.update(e);this.end(e)}}u(zi,"UpdateSystem");pY(zi,"UpdateSystem");var mY=Object.defineProperty,gY=u((n,e)=>mY(n,"name",{value:e,configurable:!0}),"__name$1C");class Cw extends zi{begin(e){for(let s of e.nextFrameCallbacks)s();e.nextFrameCallbacks.length=0;const t=Date.now();for(let s of e.throttleTasks.entries())s[1].time<=t&&(s[1].callback(),e.throttleTasks.delete(s[0]))}end(e){}}u(Cw,"CallbackFireSystem");gY(Cw,"CallbackFireSystem");var vY=Object.defineProperty,mD=u((n,e)=>vY(n,"name",{value:e,configurable:!0}),"__name$1B");class yu{constructor(){A(this,"mouseNdc0",new P);A(this,"rotating",!1);A(this,"eulerX0",0);A(this,"eulerY0",0);A(this,"moving",!1);A(this,"target0",new P);A(this,"mouseRayN0",new P)}}u(yu,"CameraDraggingState");mD(yu,"CameraDraggingState");const cm=new P,um=new P,gS=new P,vS=new P,yS=new P,yY=40,_S=-20,Fv=2.5;class Ew extends zi{constructor(){super(...arguments);A(this,"states",[new yu,new yu,new yu,new yu])}begin(t){if(t.disableCameraDraggingThisFrame){t.disableCameraDraggingThisFrame=!1;return}let s=-1;for(let i of t.views){const r=this.states[i.index];if(!i.enabled){r.rotating=!1,r.moving=!1;continue}const o=i.input;if(i.index===t.mainViewIndex)if(o.mouseRight)if(r.rotating){const a=i.mouseNdc.x-r.mouseNdc0.x,l=i.mouseNdc.y-r.mouseNdc0.y;i.camera.alpha=Math.max(-Math.PI/2,Math.min(Math.PI/2,r.eulerX0+l*Math.PI/2)),i.camera.beta=(r.eulerY0-a*Math.PI/2)%(Math.PI*2)}else o.pointerOver&&o.mouseRightDownThisFrame&&(r.rotating=!0,r.mouseNdc0.copy(i.mouseNdc),r.eulerX0=i.camera.alpha,r.eulerY0=i.camera.beta);else r.rotating=!1;o.mouseMiddle?r.moving?(cm.copy(r.mouseNdc0),cm.z=-1,cm.unproject(i.camera.get()),um.copy(r.mouseNdc0),um.z=1,um.unproject(i.camera.get()),Qt(gS,cm,um,r.target0,r.mouseRayN0),Qt(vS,i.mouseRay0,i.mouseRay1,r.target0,r.mouseRayN0),yS.subVectors(vS,gS),i.camera.target.subVectors(r.target0,yS),s=i.index):o.pointerOver&&o.mouseMiddleDownThisFrame&&(r.moving=!0,r.target0.copy(i.camera.target),r.mouseNdc0.copy(i.mouseNdc),r.mouseRayN0.copy(i.mouseRayN)):r.moving=!1,o.wheelDetY&&o.pointerOver&&(i.zoomLevel=Math.max(_S,Math.min(yY,i.zoomLevel+o.wheelDetY)),s=i.index)}if(s>=0){const i=t.views[s];for(let r of t.views)r.index!==s&&r.enabled&&(r.camera.target.copy(i.camera.target),r.zoomLevel=i.zoomLevel)}for(let i of t.views)i.enabled&&(i.camera.distance=i.zoomLevel>=0?Fv+i.zoomLevel:Fv-i.zoomLevel/_S*Fv)}end(t){}}u(Ew,"CameraDraggingSystem");mD(Ew,"CameraDraggingSystem");var hm=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function dm(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}u(dm,"commonjsRequire");const _Y=u(n=>{if(!Array.isArray(n))throw new Error("Bezier points must be a valid array/");if(n.length<2)throw new Error("Bezier points must contain at least 2 values.");const e=bY(n);return{points:n,pointType:e,dimensions:e==="float_single"?0:n[0].length,permutations:bS(n.length-1),tangentPermutations:bS(n.length-2)}},"create$I"),bY=u(function(n){let e=null;return n.forEach(t=>{let s="";if(Number.isFinite(t))s="float_single";else if(Array.isArray(t))t.forEach(i=>{if(!Number.isFinite(i))throw new Error("Bezier point values must all be numbers.")}),s="float_"+t.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(e==null)e=s;else if(e!==s)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.")}),e},"getPointType"),bS=u(function(n){const e=[];for(let t=0;t<=n;t++)e.push(zv(n)/(zv(t)*zv(n-t)));return e},"getPermutations"),zv=u(function(n){let e=1;for(let t=2;t<=n;t++)e*=t;return e},"factorial");var wY=_Y;const xY=u((n,e)=>{if(n<0||n>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(e.pointType==="float_single")return wS(e,e.points,n);{const t=[];for(let s=0;s<e.dimensions;s++){const i=[];for(let r=0;r<e.points.length;r++)i.push(e.points[r][s]);t.push(wS(e,i,n))}return t}},"valueAt"),wS=u(function(n,e,t){const s=e.length-1;let i=0;for(let r=0;r<=s;r++)i+=n.permutations[r]*Math.pow(1-t,s-r)*Math.pow(t,r)*e[r];return i},"bezierFunction");var AY=xY;const MY=u((n,e)=>{if(n<0||n>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(e.pointType==="float_single")return xS(e,e.points,n);{const t=[];for(let s=0;s<e.dimensions;s++){const i=[];for(let r=0;r<e.points.length;r++)i.push(e.points[r][s]);t.push(xS(e,i,n))}return t}},"tangentAt"),xS=u(function(n,e,t){const s=e.length-1;let i=0;for(let r=0;r<s;r++){const o=s*(e[r+1]-e[r]);i+=n.tangentPermutations[r]*Math.pow(1-t,s-1-r)*Math.pow(t,r)*o}return i},"bezierTangent");var SY=MY,Bv={create:wY,valueAt:AY,tangentAt:SY};const CY=1e5,EY=1e-5,TY=1e-13,PY=Math.PI*2;var dt={EPS:EY,NEPS:TY,TAU:PY,spatialResolution:CY};const gD=u(n=>n.reduce((e,t)=>Array.isArray(t)?e.concat(gD(t)):e.concat(t),[]),"flatten$t");var Jt=gD;const RY=u(n=>Object.assign({},n),"clone$b");var IY=RY;const DY=u((n,e,t)=>(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n),"add$3");var LY=DY;const OY=u(()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"create$H");var Tw=OY;const kY=Tw,NY=u(n=>{const e=kY();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},"clone$a");var FY=NY;const zY=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n),"copy$7");var vD=zY;const BY=u((n,e)=>{const t=e[0],s=e[1],i=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=t*a-s*o,_=t*l-i*o,w=t*c-r*o,x=s*l-i*a,S=s*c-r*a,C=i*c-r*l,M=h*m-d*g,R=h*v-f*g,D=h*y-p*g,k=d*v-f*m,T=d*y-p*m,N=f*y-p*v;let E=b*N-_*T+w*k+x*D-S*R+C*M;return E?(E=1/E,n[0]=(a*N-l*T+c*k)*E,n[1]=(i*T-s*N-r*k)*E,n[2]=(m*C-v*S+y*x)*E,n[3]=(f*S-d*C-p*x)*E,n[4]=(l*D-o*N-c*R)*E,n[5]=(t*N-i*D+r*R)*E,n[6]=(v*w-g*C-y*_)*E,n[7]=(h*C-f*w+p*_)*E,n[8]=(o*T-a*D+c*M)*E,n[9]=(s*D-t*T-r*M)*E,n[10]=(g*S-m*w+y*b)*E,n[11]=(d*w-h*S-p*b)*E,n[12]=(a*R-o*k-l*M)*E,n[13]=(t*k-s*R+i*M)*E,n[14]=(m*_-g*x-v*b)*E,n[15]=(h*x-d*_+f*b)*E,n):null},"invert$2");var UY=BY;const $Y=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15],"equals$8");var VY=$Y;const{NEPS:GY}=dt,yD=u(n=>Math.abs(n)<GY?0:n,"rezero"),HY=u(n=>yD(Math.sin(n)),"sin$f"),WY=u(n=>yD(Math.cos(n)),"cos$f");var Ps={sin:HY,cos:WY};const jY=u(n=>(n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n),"identity$1");var _D=jY;const{EPS:XY}=dt,{sin:YY,cos:qY}=Ps,KY=_D,ZY=u((n,e,t)=>{let[s,i,r]=t;const o=s*s+i*i+r*r;if(Math.abs(o)<XY)return KY(n);const a=1/Math.sqrt(o);s*=a,i*=a,r*=a;const l=YY(e),c=qY(e),h=1-c;return n[0]=s*s*h+c,n[1]=i*s*h+r*l,n[2]=r*s*h-i*l,n[3]=0,n[4]=s*i*h-r*l,n[5]=i*i*h+c,n[6]=r*i*h+s*l,n[7]=0,n[8]=s*r*h+i*l,n[9]=i*r*h-s*l,n[10]=r*r*h+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromRotation$1");var bD=ZY;const QY=u((n,e)=>(n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n),"fromScaling");var JY=QY;const{sin:Uv,cos:$v}=Ps,eq=u((n,e,t,s)=>{const i=Uv(e),r=$v(e),o=Uv(t),a=$v(t),l=Uv(s),c=$v(s);return n[0]=a*r,n[1]=a*i,n[2]=-o,n[3]=0,n[4]=l*o*r-c*i,n[5]=c*r+l*o*i,n[6]=l*a,n[7]=0,n[8]=l*i+c*o*r,n[9]=c*o*i-l*r,n[10]=c*a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromTaitBryanRotation");var tq=eq;const nq=u((n,e)=>(n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n),"fromTranslation");var sq=nq;const iq=Tw,rq=u((n,e,t,s,i,r,o,a,l,c,h,d,f,p,g,m)=>{const v=iq();return v[0]=n,v[1]=e,v[2]=t,v[3]=s,v[4]=i,v[5]=r,v[6]=o,v[7]=a,v[8]=l,v[9]=c,v[10]=h,v[11]=d,v[12]=f,v[13]=p,v[14]=g,v[15]=m,v},"fromValues$5");var oq=rq;const aq=u((n,e)=>(n[0]=Math.abs(e[0]),n[1]=Math.abs(e[1]),n[2]=Math.abs(e[2]),n),"abs$2");var wD=aq;const lq=u((n,e,t)=>(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n),"add$2");var xD=lq;const cq=u((n,e)=>n[0]*e[0]+n[1]*e[1]+n[2]*e[2],"dot$5");var a1=cq;const uq=a1,hq=u((n,e)=>{const t=n[0],s=n[1],i=n[2],r=e[0],o=e[1],a=e[2],l=Math.sqrt(t*t+s*s+i*i),c=Math.sqrt(r*r+o*o+a*a),h=l*c,d=h&&uq(n,e)/h;return Math.acos(Math.min(Math.max(d,-1),1))},"angle$1");var dq=hq;const fq=u(()=>[0,0,0],"create$E");var l1=fq;const pq=l1,mq=u(n=>{const e=pq();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},"clone$9");var gq=mq;const vq=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n),"copy$6");var AD=vq;const yq=u((n,e,t)=>{const s=e[0],i=e[1],r=e[2],o=t[0],a=t[1],l=t[2];return n[0]=i*l-r*a,n[1]=r*o-s*l,n[2]=s*a-i*o,n},"cross$5");var lp=yq;const _q=u((n,e)=>{const t=e[0]-n[0],s=e[1]-n[1],i=e[2]-n[2];return Math.sqrt(t*t+s*s+i*i)},"distance$2");var MD=_q;const bq=u((n,e,t)=>(n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n),"divide$1");var wq=bq;const xq=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],"equals$7");var Aq=xq;const Mq=u((n,e)=>(n[0]=e,n[1]=e,n[2]=e,n),"fromScalar$2");var Sq=Mq;const Cq=l1,Eq=u((n,e,t)=>{const s=Cq();return s[0]=n,s[1]=e,s[2]=t,s},"fromValues$4");var Tq=Eq;const Pq=u((n,e,t=0)=>(n[0]=e[0],n[1]=e[1],n[2]=t,n),"fromVector2");var Rq=Pq;const Iq=u(n=>{const e=n[0],t=n[1],s=n[2];return Math.sqrt(e*e+t*t+s*s)},"length$2");var SD=Iq;const Dq=u((n,e,t,s)=>(n[0]=e[0]+s*(t[0]-e[0]),n[1]=e[1]+s*(t[1]-e[1]),n[2]=e[2]+s*(t[2]-e[2]),n),"lerp$1");var Lq=Dq;const Oq=u((n,e,t)=>(n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n),"max$2");var CD=Oq;const kq=u((n,e,t)=>(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.min(e[2],t[2]),n),"min$1");var ED=kq;const Nq=u((n,e,t)=>(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n),"multiply$2");var Fq=Nq;const zq=u((n,e)=>(n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n),"negate$1");var Bq=zq;const Uq=u((n,e)=>{const t=e[0],s=e[1],i=e[2];let r=t*t+s*s+i*i;return r>0&&(r=1/Math.sqrt(r)),n[0]=t*r,n[1]=s*r,n[2]=i*r,n},"normalize$3");var Pw=Uq;const $q=wD,Vq=l1,Gq=lp,Hq=u((n,e)=>{const t=$q(Vq(),e),s=0+(t[0]<t[1]&&t[0]<t[2]),i=0+(t[1]<=t[0]&&t[1]<t[2]),r=0+(t[2]<=t[0]&&t[2]<=t[1]);return Gq(n,e,[s,i,r])},"orthogonal");var Wq=Hq;const jq=u((n,e,t,s)=>{const i=[],r=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],r[0]=i[0],r[1]=i[1]*Math.cos(s)-i[2]*Math.sin(s),r[2]=i[1]*Math.sin(s)+i[2]*Math.cos(s),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n},"rotateX$2");var Xq=jq;const Yq=u((n,e,t,s)=>{const i=[],r=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],r[0]=i[2]*Math.sin(s)+i[0]*Math.cos(s),r[1]=i[1],r[2]=i[2]*Math.cos(s)-i[0]*Math.sin(s),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=r[2]+t[2],n},"rotateY$2");var qq=Yq;const Kq=u((n,e,t,s)=>{const i=[],r=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],r[0]=i[0]*Math.cos(s)-i[1]*Math.sin(s),r[1]=i[0]*Math.sin(s)+i[1]*Math.cos(s),n[0]=r[0]+t[0],n[1]=r[1]+t[1],n[2]=e[2],n},"rotateZ$2");var Zq=Kq;const Qq=u((n,e,t)=>(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n),"scale$4");var TD=Qq;const Jq=u((n,e,t)=>(n[0]=Math.round(e[0]/t)*t+0,n[1]=Math.round(e[1]/t)*t+0,n[2]=Math.round(e[2]/t)*t+0,n),"snap$1");var eK=Jq;const tK=u((n,e)=>{const t=e[0]-n[0],s=e[1]-n[1],i=e[2]-n[2];return t*t+s*s+i*i},"squaredDistance$2");var PD=tK;const nK=u(n=>{const e=n[0],t=n[1],s=n[2];return e*e+t*t+s*s},"squaredLength$2");var RD=nK;const sK=u((n,e,t)=>(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n),"subtract$9");var c1=sK;const iK=u(n=>`[${n[0].toFixed(7)}, ${n[1].toFixed(7)}, ${n[2].toFixed(7)}]`,"toString$9");var rK=iK;const oK=u((n,e,t)=>{const s=e[0],i=e[1],r=e[2];let o=t[3]*s+t[7]*i+t[11]*r+t[15];return o=o||1,n[0]=(t[0]*s+t[4]*i+t[8]*r+t[12])/o,n[1]=(t[1]*s+t[5]*i+t[9]*r+t[13])/o,n[2]=(t[2]*s+t[6]*i+t[10]*r+t[14])/o,n},"transform$a");var aK=oK,_t={abs:wD,add:xD,angle:dq,clone:gq,copy:AD,create:l1,cross:lp,distance:MD,divide:wq,dot:a1,equals:Aq,fromScalar:Sq,fromValues:Tq,fromVec2:Rq,length:SD,lerp:Lq,max:CD,min:ED,multiply:Fq,negate:Bq,normalize:Pw,orthogonal:Wq,rotateX:Xq,rotateY:qq,rotateZ:Zq,scale:TD,snap:eK,squaredDistance:PD,squaredLength:RD,subtract:c1,toString:rK,transform:aK};const ca=_t,lK=bD,cK=u((n,e,t)=>{const s=ca.normalize(ca.create(),e),i=ca.normalize(ca.create(),t),r=ca.cross(ca.create(),i,s),o=ca.dot(i,s);if(o===-1)return lK(n,Math.PI,ca.orthogonal(r,s));const a=1/(1+o);return n[0]=r[0]*r[0]*a+o,n[1]=r[1]*r[0]*a-r[2],n[2]=r[2]*r[0]*a+r[1],n[3]=0,n[4]=r[0]*r[1]*a+r[2],n[5]=r[1]*r[1]*a+o,n[6]=r[2]*r[1]*a-r[0],n[7]=0,n[8]=r[0]*r[2]*a-r[1],n[9]=r[1]*r[2]*a+r[0],n[10]=r[2]*r[2]*a+o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromVectorRotation");var uK=cK;const{sin:hK,cos:dK}=Ps,fK=u((n,e)=>{const t=hK(e),s=dK(e);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=t,n[7]=0,n[8]=0,n[9]=-t,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromXRotation");var pK=fK;const{sin:mK,cos:gK}=Ps,vK=u((n,e)=>{const t=mK(e),s=gK(e);return n[0]=s,n[1]=0,n[2]=-t,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=t,n[9]=0,n[10]=s,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromYRotation");var yK=vK;const{sin:_K,cos:bK}=Ps,wK=u((n,e)=>{const t=_K(e),s=bK(e);return n[0]=s,n[1]=t,n[2]=0,n[3]=0,n[4]=-t,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},"fromZRotation");var xK=wK;const AK=u(n=>n[0]===1&&n[1]===0&&n[2]===0&&n[3]===0&&n[4]===0&&n[5]===1&&n[6]===0&&n[7]===0&&n[8]===0&&n[9]===0&&n[10]===1&&n[11]===0&&n[12]===0&&n[13]===0&&n[14]===0&&n[15]===1,"isIdentity");var MK=AK;const SK=u(n=>co(n[1])&&co(n[2])&&co(n[3])&&co(n[4])&&co(n[6])&&co(n[7])&&co(n[8])&&co(n[9])&&co(n[11])&&n[15]===1,"isOnlyTransformScale"),co=u(n=>Math.abs(n)<Number.EPSILON,"isZero");var CK=SK;const EK=u(n=>{const e=n[4]*n[9]-n[8]*n[5],t=n[8]*n[1]-n[0]*n[9],s=n[0]*n[5]-n[4]*n[1];return e*n[2]+t*n[6]+s*n[10]<0},"isMirroring");var TK=EK;const PK=u((n,e)=>{const[t,s,i,r]=e;return n[0]=1-2*t*t,n[1]=-2*s*t,n[2]=-2*i*t,n[3]=0,n[4]=-2*t*s,n[5]=1-2*s*s,n[6]=-2*i*s,n[7]=0,n[8]=-2*t*i,n[9]=-2*s*i,n[10]=1-2*i*i,n[11]=0,n[12]=2*t*r,n[13]=2*s*r,n[14]=2*i*r,n[15]=1,n},"mirrorByPlane");var RK=PK;const IK=u((n,e,t)=>{const s=e[0],i=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],h=e[7],d=e[8],f=e[9],p=e[10],g=e[11],m=e[12],v=e[13],y=e[14],b=e[15];let _=t[0],w=t[1],x=t[2],S=t[3];return n[0]=_*s+w*a+x*d+S*m,n[1]=_*i+w*l+x*f+S*v,n[2]=_*r+w*c+x*p+S*y,n[3]=_*o+w*h+x*g+S*b,_=t[4],w=t[5],x=t[6],S=t[7],n[4]=_*s+w*a+x*d+S*m,n[5]=_*i+w*l+x*f+S*v,n[6]=_*r+w*c+x*p+S*y,n[7]=_*o+w*h+x*g+S*b,_=t[8],w=t[9],x=t[10],S=t[11],n[8]=_*s+w*a+x*d+S*m,n[9]=_*i+w*l+x*f+S*v,n[10]=_*r+w*c+x*p+S*y,n[11]=_*o+w*h+x*g+S*b,_=t[12],w=t[13],x=t[14],S=t[15],n[12]=_*s+w*a+x*d+S*m,n[13]=_*i+w*l+x*f+S*v,n[14]=_*r+w*c+x*p+S*y,n[15]=_*o+w*h+x*g+S*b,n},"multiply$1");var DK=IK;const{EPS:LK}=dt,{sin:OK,cos:kK}=Ps,NK=vD,FK=u((n,e,t,s)=>{let[i,r,o]=s;const a=i*i+r*r+o*o;if(Math.abs(a)<LK)return NK(n,e);const l=1/Math.sqrt(a);i*=l,r*=l,o*=l;const c=OK(t),h=kK(t),d=1-h,f=e[0],p=e[1],g=e[2],m=e[3],v=e[4],y=e[5],b=e[6],_=e[7],w=e[8],x=e[9],S=e[10],C=e[11],M=i*i*d+h,R=r*i*d+o*c,D=o*i*d-r*c,k=i*r*d-o*c,T=r*r*d+h,N=o*r*d+i*c,E=i*o*d+r*c,z=r*o*d-i*c,H=o*o*d+h;return n[0]=f*M+v*R+w*D,n[1]=p*M+y*R+x*D,n[2]=g*M+b*R+S*D,n[3]=m*M+_*R+C*D,n[4]=f*k+v*T+w*N,n[5]=p*k+y*T+x*N,n[6]=g*k+b*T+S*N,n[7]=m*k+_*T+C*N,n[8]=f*E+v*z+w*H,n[9]=p*E+y*z+x*H,n[10]=g*E+b*z+S*H,n[11]=m*E+_*z+C*H,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},"rotate$4");var zK=FK;const{sin:BK,cos:UK}=Ps,$K=u((n,e,t)=>{const s=BK(t),i=UK(t),r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],d=e[10],f=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=r*i+c*s,n[5]=o*i+h*s,n[6]=a*i+d*s,n[7]=l*i+f*s,n[8]=c*i-r*s,n[9]=h*i-o*s,n[10]=d*i-a*s,n[11]=f*i-l*s,n},"rotateX$1");var VK=$K;const{sin:GK,cos:HK}=Ps,WK=u((n,e,t)=>{const s=GK(t),i=HK(t),r=e[0],o=e[1],a=e[2],l=e[3],c=e[8],h=e[9],d=e[10],f=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*i-c*s,n[1]=o*i-h*s,n[2]=a*i-d*s,n[3]=l*i-f*s,n[8]=r*s+c*i,n[9]=o*s+h*i,n[10]=a*s+d*i,n[11]=l*s+f*i,n},"rotateY$1");var jK=WK;const{sin:XK,cos:YK}=Ps,qK=u((n,e,t)=>{const s=XK(t),i=YK(t),r=e[0],o=e[1],a=e[2],l=e[3],c=e[4],h=e[5],d=e[6],f=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=r*i+c*s,n[1]=o*i+h*s,n[2]=a*i+d*s,n[3]=l*i+f*s,n[4]=c*i-r*s,n[5]=h*i-o*s,n[6]=d*i-a*s,n[7]=f*i-l*s,n},"rotateZ$1");var KK=qK;const ZK=u((n,e,t)=>{const s=t[0],i=t[1],r=t[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*r,n[9]=e[9]*r,n[10]=e[10]*r,n[11]=e[11]*r,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},"scale$3");var QK=ZK;const JK=u((n,e,t)=>(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n),"subtract$8");var eZ=JK;const tZ=u(n=>n.map(e=>e.toFixed(7)).toString(),"toString$8");var nZ=tZ;const sZ=u((n,e,t)=>{const s=t[0],i=t[1],r=t[2];let o,a,l,c,h,d,f,p,g,m,v,y;return e===n?(n[12]=e[0]*s+e[4]*i+e[8]*r+e[12],n[13]=e[1]*s+e[5]*i+e[9]*r+e[13],n[14]=e[2]*s+e[6]*i+e[10]*r+e[14],n[15]=e[3]*s+e[7]*i+e[11]*r+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],h=e[4],d=e[5],f=e[6],p=e[7],g=e[8],m=e[9],v=e[10],y=e[11],n[0]=o,n[1]=a,n[2]=l,n[3]=c,n[4]=h,n[5]=d,n[6]=f,n[7]=p,n[8]=g,n[9]=m,n[10]=v,n[11]=y,n[12]=o*s+h*i+g*r+e[12],n[13]=a*s+d*i+m*r+e[13],n[14]=l*s+f*i+v*r+e[14],n[15]=c*s+p*i+y*r+e[15]),n},"translate$4");var iZ=sZ,hn={add:LY,clone:FY,copy:vD,create:Tw,invert:UY,equals:VY,fromRotation:bD,fromScaling:JY,fromTaitBryanRotation:tq,fromTranslation:sq,fromValues:oq,fromVectorRotation:uK,fromXRotation:pK,fromYRotation:yK,fromZRotation:xK,identity:_D,isIdentity:MK,isOnlyTransformScale:CK,isMirroring:TK,mirrorByPlane:RK,multiply:DK,rotate:zK,rotateX:VK,rotateY:jK,rotateZ:KK,scale:QK,subtract:eZ,toString:nZ,translate:iZ};const rZ=hn,oZ=u(n=>(n===void 0&&(n=[]),{sides:n,transforms:rZ.create()}),"create$A");var u1=oZ;const aZ=u((n,e)=>(n[0]=Math.abs(e[0]),n[1]=Math.abs(e[1]),n),"abs");var lZ=aZ;const cZ=u((n,e,t)=>(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n),"add$1");var uZ=cZ;const hZ=u(n=>Math.atan2(n[1],n[0]),"angleRadians$1");var Rw=hZ,dZ=Rw;const fZ=Rw,pZ=u(n=>fZ(n)*57.29577951308232,"angleDegrees");var mZ=pZ;const gZ=u(()=>[0,0],"create$z");var h1=gZ;const vZ=h1,yZ=u(n=>{const e=vZ();return e[0]=n[0],e[1]=n[1],e},"clone$8");var _Z=yZ;const bZ=u((n,e)=>(n[0]=e[0],n[1]=e[1],n),"copy$4");var wZ=bZ;const xZ=u((n,e,t)=>(n[0]=0,n[1]=0,n[2]=e[0]*t[1]-e[1]*t[0],n),"cross$3");var AZ=xZ;const MZ=u((n,e)=>{const t=e[0]-n[0],s=e[1]-n[1];return Math.sqrt(t*t+s*s)},"distance$1");var SZ=MZ;const CZ=u((n,e,t)=>(n[0]=e[0]/t[0],n[1]=e[1]/t[1],n),"divide");var EZ=CZ;const TZ=u((n,e)=>n[0]*e[0]+n[1]*e[1],"dot$3");var PZ=TZ;const RZ=u((n,e)=>n[0]===e[0]&&n[1]===e[1],"equals$6");var IZ=RZ;const{sin:DZ,cos:LZ}=Ps,OZ=u((n,e)=>(n[0]=LZ(e),n[1]=DZ(e),n),"fromAngleRadians$1");var ID=OZ;const kZ=ID,NZ=u((n,e)=>kZ(n,e*.017453292519943295),"fromAngleDegrees");var FZ=NZ;const zZ=u((n,e)=>(n[0]=e,n[1]=e,n),"fromScalar$1");var BZ=zZ;const UZ=h1,$Z=u((n,e)=>{const t=UZ();return t[0]=n,t[1]=e,t},"fromValues$3");var VZ=$Z;const GZ=u(n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),"length$1");var HZ=GZ;const WZ=u((n,e,t,s)=>{const i=e[0],r=e[1];return n[0]=i+s*(t[0]-i),n[1]=r+s*(t[1]-r),n},"lerp");var jZ=WZ;const XZ=u((n,e,t)=>(n[0]=Math.max(e[0],t[0]),n[1]=Math.max(e[1],t[1]),n),"max$1");var YZ=XZ;const qZ=u((n,e,t)=>(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n),"min");var KZ=qZ;const ZZ=u((n,e,t)=>(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n),"multiply");var QZ=ZZ;const JZ=u((n,e)=>(n[0]=-e[0],n[1]=-e[1],n),"negate");var eQ=JZ;const tQ=u((n,e,t,s)=>{const i=e[0]-t[0],r=e[1]-t[1],o=Math.cos(s),a=Math.sin(s);return n[0]=i*o-r*a+t[0],n[1]=i*a+r*o+t[1],n},"rotate$3");var DD=tQ;const{TAU:nQ}=dt,sQ=h1,iQ=DD,rQ=u((n,e)=>iQ(n,e,sQ(),nQ/4),"normal");var oQ=rQ;const aQ=u((n,e)=>{const t=e[0],s=e[1];let i=t*t+s*s;return i>0&&(i=1/Math.sqrt(i)),n[0]=t*i,n[1]=s*i,n},"normalize$2");var lQ=aQ;const cQ=u((n,e,t)=>(n[0]=e[0]*t,n[1]=e[1]*t,n),"scale$2");var uQ=cQ;const hQ=u((n,e,t)=>(n[0]=Math.round(e[0]/t)*t+0,n[1]=Math.round(e[1]/t)*t+0,n),"snap");var dQ=hQ;const fQ=u((n,e)=>{const t=e[0]-n[0],s=e[1]-n[1];return t*t+s*s},"squaredDistance$1");var pQ=fQ;const mQ=u(n=>{const e=n[0],t=n[1];return e*e+t*t},"squaredLength$1");var gQ=mQ;const vQ=u((n,e,t)=>(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n),"subtract$7");var yQ=vQ;const _Q=u(n=>`[${n[0].toFixed(7)}, ${n[1].toFixed(7)}]`,"toString$7");var bQ=_Q;const wQ=u((n,e,t)=>{const s=e[0],i=e[1];return n[0]=t[0]*s+t[4]*i+t[12],n[1]=t[1]*s+t[5]*i+t[13],n},"transform$9");var xQ=wQ,wt={abs:lZ,add:uZ,angle:dZ,angleDegrees:mZ,angleRadians:Rw,clone:_Z,copy:wZ,create:h1,cross:AZ,distance:SZ,divide:EZ,dot:PZ,equals:IZ,fromAngleDegrees:FZ,fromAngleRadians:ID,fromScalar:BZ,fromValues:VZ,length:HZ,lerp:jZ,max:YZ,min:KZ,multiply:QZ,negate:eQ,normal:oQ,normalize:lQ,rotate:DD,scale:uQ,snap:dQ,squaredDistance:pQ,squaredLength:gQ,subtract:yQ,toString:bQ,transform:xQ};const Vv=wt,AQ=u1,MQ=u(n=>{if(!Array.isArray(n))throw new Error("the given points must be an array");let e=n.length;if(e<3)throw new Error("the given points must define a closed geometry with three or more points");Vv.equals(n[0],n[e-1])&&--e;const t=[];let s=n[e-1];for(let i=0;i<e;i++){const r=n[i];t.push([Vv.clone(s),Vv.clone(r)]),s=r}return AQ(t)},"fromPoints$a");var SQ=MQ;const CQ=hn,AS=wt,EQ=u1,TQ=u(n=>{if(n[0]!==0)throw new Error("invalid compact binary data");const e=EQ();e.transforms=CQ.clone(n.slice(1,17));for(let t=21;t<n.length;t+=4){const s=AS.fromValues(n[t+0],n[t+1]),i=AS.fromValues(n[t+2],n[t+3]);e.sides.push([s,i])}return n[17]>=0&&(e.color=[n[17],n[18],n[19],n[20]]),e},"fromCompactBinary$2");var PQ=TQ;const RQ=u(n=>!!(n&&typeof n=="object"&&"sides"in n&&"transforms"in n&&Array.isArray(n.sides)&&"length"in n.transforms),"isA$8");var LD=RQ;const MS=hn,fm=wt,IQ=u(n=>(MS.isIdentity(n.transforms)||(n.sides=n.sides.map(e=>{const t=fm.transform(fm.create(),e[0],n.transforms),s=fm.transform(fm.create(),e[1],n.transforms);return[t,s]}),n.transforms=MS.create()),n),"applyTransforms$5");var DQ=IQ;const LQ=DQ,OQ=u(n=>LQ(n).sides,"toSides$4");var cp=OQ;const kQ=u1,NQ=cp,FQ=u(n=>{const t=NQ(n).map(s=>[s[1],s[0]]);return t.reverse(),kQ(t)},"reverse$3");var zQ=FQ;const Jh=wt,BQ=cp,UQ=u(n=>{const e=new Map,t=u(s=>{const i=s.toString();return e.has(i)?e.get(i):(e.set(i,s),s)},"getUniqueVertex");return n.map(s=>s.map(t))},"toSharedVertices"),$Q=u(n=>{const e=new Map;return UQ(n).forEach(s=>{e.has(s[0])?e.get(s[0]).push(s):e.set(s[0],[s])}),e},"toVertexMap"),VQ=u(n=>{const e=$Q(BQ(n)),t=[];for(;;){let s;for(const[o,a]of e){if(s=a.shift(),!s){e.delete(o);continue}break}if(s===void 0)break;const i=[],r=s[0];for(;;){i.push(s[0]);const o=s[1];if(o===r)break;const a=e.get(o);if(!a)throw new Error(`geometry is not closed at vertex ${o}`);const l=GQ(s,a);a.length===0&&e.delete(o),s=l}i.length>0&&i.push(i.shift()),t.push(i)}return e.clear(),t},"toOutlines$2"),GQ=u((n,e)=>{if(e.length===1)return e.pop();const t=Jh.create(),s=Jh.angleDegrees(Jh.subtract(t,n[1],n[0]));let i,r;e.forEach((a,l)=>{let h=Jh.angleDegrees(Jh.subtract(t,a[1],a[0]))-s;h<-180&&(h+=360),h>=180&&(h-=360),(r===void 0||h>i)&&(r=l,i=h)});const o=e[r];return e.splice(r,1),o},"popNextSide");var OD=VQ;const HQ=cp,WQ=u(n=>{const t=HQ(n).map(s=>s[0]);return t.length>0&&t.push(t.shift()),t},"toPoints$8");var jQ=WQ;const SS=wt,XQ=cp,YQ=u(n=>{const e=XQ(n);let t="geom2 ("+e.length+` sides):
[
`;return e.forEach(s=>{t+="  ["+SS.toString(s[0])+", "+SS.toString(s[1])+`]
`}),t+=`]
`,t},"toString$6");var qQ=YQ;const KQ=u(n=>{const e=n.sides,t=n.transforms;let s=[-1,-1,-1,-1];n.color&&(s=n.color);const i=new Float32Array(1+16+4+e.length*4);i[0]=0,i[1]=t[0],i[2]=t[1],i[3]=t[2],i[4]=t[3],i[5]=t[4],i[6]=t[5],i[7]=t[6],i[8]=t[7],i[9]=t[8],i[10]=t[9],i[11]=t[10],i[12]=t[11],i[13]=t[12],i[14]=t[13],i[15]=t[14],i[16]=t[15],i[17]=s[0],i[18]=s[1],i[19]=s[2],i[20]=s[3];for(let r=0;r<e.length;r++){const o=r*4+21,a=e[r][0],l=e[r][1];i[o+0]=a[0],i[o+1]=a[1],i[o+2]=l[0],i[o+3]=l[1]}return i},"toCompactBinary$2");var ZQ=KQ;const CS=hn,QQ=u((n,e)=>{const t=CS.multiply(CS.create(),n,e.transforms);return Object.assign({},e,{transforms:t})},"transform$8");var JQ=QQ;const eJ=wt,tJ=LD,nJ=OD,sJ=u(n=>{if(!tJ(n))throw new Error("invalid geom2 structure");if(nJ(n),n.sides.forEach(e=>{if(eJ.equals(e[0],e[1]))throw new Error(`geom2 self-edge ${e[0]}`)}),!n.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${n.transforms}`)},"validate$3");var iJ=sJ,Ot={clone:IY,create:u1,fromPoints:SQ,fromCompactBinary:PQ,isA:LD,reverse:zQ,toOutlines:OD,toPoints:jQ,toSides:cp,toString:qQ,toCompactBinary:ZQ,transform:JQ,validate:iJ};const rJ=u(n=>Object.assign({},n),"clone$7");var oJ=rJ;const aJ=hn,lJ=u(n=>(n===void 0&&(n=[]),{polygons:n,transforms:aJ.create()}),"create$s");var d1=lJ;const cJ=u(n=>((n===void 0||n.length<3)&&(n=[]),{vertices:n}),"create$r");var bh=cJ;const uJ=bh,hJ=_t,dJ=u((...n)=>{let e,t;return n.length===1?(e=uJ(),t=n[0]):(e=n[0],t=n[1]),e.vertices=t.vertices.map(s=>hJ.clone(s)),e},"clone$6");var fJ=dJ;const pJ=_t,mJ=bh,gJ=u(n=>{const e=n.map(t=>pJ.clone(t));return mJ(e)},"fromPoints$9");var vJ=gJ;const yJ=bh,_J=u((n,e)=>{const t=yJ(n);return t.plane=e,t},"fromPointsAndPlane");var bJ=_J;const wJ=u(()=>[0,0,0,0],"create$n");var f1=wJ;const xJ=f1,AJ=u(n=>{const e=xJ();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e},"clone$5");var kD=AJ;const MJ=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n),"copy$3");var ND=MJ;const SJ=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3],"equals$5");var FD=SJ;const CJ=u((n,e)=>(n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=-e[3],n),"flip$3");var zD=CJ;const Gv=_t,EJ=u((n,e,t)=>{const s=Gv.normalize(Gv.create(),e),i=Gv.dot(t,s);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=i,n},"fromNormalAndPoint");var TJ=EJ;const PJ=f1,RJ=u((n,e,t,s)=>{const i=PJ();return i[0]=n,i[1]=e,i[2]=t,i[3]=s,i},"fromValues$2");var BD=RJ;const Ir=_t,IJ=u((n,...e)=>{const t=e.length,s=Ir.create(),i=Ir.create(),r=u(o=>{const a=e[o],l=e[(o+1)%t],c=e[(o+2)%t];return Ir.subtract(s,l,a),Ir.subtract(i,c,a),Ir.cross(s,s,i),Ir.normalize(s,s),s},"vertexNormal");return n[0]=0,n[1]=0,n[2]=0,t===3?Ir.copy(n,r(0)):(e.forEach((o,a)=>{Ir.add(n,n,r(a))}),Ir.normalize(n,n)),n[3]=Ir.dot(n,e[0]),n},"fromPoints$8");var UD=IJ;const{EPS:Hv}=dt,Gs=_t,DJ=u((n,e,t,s)=>{let i=Gs.subtract(Gs.create(),t,e),r=Gs.subtract(Gs.create(),s,e);Gs.length(i)<Hv&&(i=Gs.orthogonal(i,r)),Gs.length(r)<Hv&&(r=Gs.orthogonal(r,i));let o=Gs.cross(Gs.create(),i,r);Gs.length(o)<Hv&&(r=Gs.orthogonal(r,i),o=Gs.cross(o,i,r)),o=Gs.normalize(o,o);const a=Gs.dot(o,e);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=a,n},"fromPointsRandom");var LJ=DJ;const OJ=_t,kJ=u((n,e)=>{const t=e[0]*n[0]+e[1]*n[1]+e[2]*n[2]-n[3],s=e[0]-t*n[0],i=e[1]-t*n[1],r=e[2]-t*n[2];return OJ.fromValues(s,i,r)},"projectionOfPoint");var NJ=kJ;const FJ=_t,zJ=u((n,e)=>FJ.dot(n,e)-n[3],"signedDistanceToPoint$1");var $D=zJ;const BJ=u(n=>`(${n[0].toFixed(9)}, ${n[1].toFixed(9)}, ${n[2].toFixed(9)}, ${n[3].toFixed(9)})`,"toString$5");var VD=BJ;const UJ=hn,Hs=_t,$J=UD,VJ=zD,GJ=u((n,e,t)=>{const s=UJ.isMirroring(t),i=Hs.orthogonal(Hs.create(),e),r=Hs.cross(i,e,i),o=Hs.cross(Hs.create(),e,r);let a=Hs.fromScalar(Hs.create(),e[3]);Hs.multiply(a,a,e);let l=Hs.add(Hs.create(),a,r),c=Hs.add(Hs.create(),a,o);return a=Hs.transform(a,a,t),l=Hs.transform(l,l,t),c=Hs.transform(c,c,t),$J(n,a,l,c),s&&VJ(n,n),n},"transform$7");var HJ=GJ,Yo={clone:kD,copy:ND,create:f1,equals:FD,flip:zD,fromNormalAndPoint:TJ,fromValues:BD,fromPoints:UD,fromPointsRandom:LJ,projectionOfPoint:NJ,signedDistanceToPoint:$D,toString:VD,transform:HJ};const ES=Yo,WJ=bh,jJ=u(n=>{const e=n.vertices.slice().reverse(),t=WJ(e);return n.plane&&(t.plane=ES.flip(ES.create(),n.plane)),t},"invert$1");var XJ=jJ;const YJ=u(n=>!!(n&&typeof n=="object"&&"vertices"in n&&Array.isArray(n.vertices)),"isA$6");var GD=YJ;const TS=Yo,ll=_t,qJ=u(n=>KJ(n.vertices),"isConvex$1"),KJ=u(n=>{const e=n.length;if(e>2){const t=TS.fromPoints(TS.create(),...n);let s=n[e-2],i=n[e-1];for(let r=0;r<e;r++){const o=n[r];if(!ZJ(s,i,o,t))return!1;s=i,i=o}}return!0},"areVerticesConvex"),ZJ=u((n,e,t,s)=>{const i=ll.cross(ll.create(),ll.subtract(ll.create(),e,n),ll.subtract(ll.create(),t,e));return ll.dot(i,s)>=0},"isConvexPoint");var HD=qJ;const PS=Yo,QJ=u(n=>(n.plane||(n.plane=PS.fromPoints(PS.create(),...n.vertices)),n.plane),"plane$8");var Iw=QJ;const JJ=Iw,eee=u(n=>{const e=n.vertices.length;if(e<3)return 0;const t=n.vertices,s=JJ(n),i=Math.abs(s[0]),r=Math.abs(s[1]),o=Math.abs(s[2]);if(i+r+o===0)return 0;let a=3;i>r&&i>o?a=1:r>o&&(a=2);let l=0,c=0,h=1,d=2;switch(a){case 1:for(h=1;h<e;h++)c=h-1,d=(h+1)%e,l+=t[h][1]*(t[d][2]-t[c][2]);l+=t[0][1]*(t[1][2]-t[e-1][2]),l/=2*s[0];break;case 2:for(h=1;h<e;h++)c=h-1,d=(h+1)%e,l+=t[h][2]*(t[d][0]-t[c][0]);l+=t[0][2]*(t[1][0]-t[e-1][0]),l/=2*s[1];break;case 3:default:for(h=1;h<e;h++)c=h-1,d=(h+1)%e,l+=t[h][0]*(t[d][1]-t[c][1]);l+=t[0][0]*(t[1][1]-t[e-1][1]),l/=2*s[2];break}return l},"measureArea$3");var WD=eee;const ed=_t,tee=u(n=>{const e=n.vertices,t=e.length,s=t===0?ed.create():ed.clone(e[0]),i=ed.clone(s);for(let r=1;r<t;r++)ed.min(s,s,e[r]),ed.max(i,i,e[r]);return[s,i]},"measureBoundingBox$5");var nee=tee;const see=u((n,e)=>n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3],"dot$2");var iee=see;const ree=u((n,e)=>(n[0]=e,n[1]=e,n[2]=e,n[3]=e,n),"fromScalar");var oee=ree;const aee=u((n,e,t)=>{const[s,i,r,o]=e;return n[0]=t[0]*s+t[4]*i+t[8]*r+t[12]*o,n[1]=t[1]*s+t[5]*i+t[9]*r+t[13]*o,n[2]=t[2]*s+t[6]*i+t[10]*r+t[14]*o,n[3]=t[3]*s+t[7]*i+t[11]*r+t[15]*o,n},"transform$6");var lee=aee,cee={clone:kD,copy:ND,create:f1,dot:iee,equals:FD,fromScalar:oee,fromValues:BD,toString:VD,transform:lee};const uee=cee,RS=new WeakMap,hee=u(n=>{let e=RS.get(n);if(e)return e;const t=n.vertices,s=uee.create();if(t.length===0)return s[0]=0,s[1]=0,s[2]=0,s[3]=0,s;let i=t[0],r=i,o=i,a=i,l=i,c=i;t.forEach(p=>{i[0]>p[0]&&(i=p),r[1]>p[1]&&(r=p),o[2]>p[2]&&(o=p),a[0]<p[0]&&(a=p),l[1]<p[1]&&(l=p),c[2]<p[2]&&(c=p)}),s[0]=(i[0]+a[0])*.5,s[1]=(r[1]+l[1])*.5,s[2]=(o[2]+c[2])*.5;const h=s[0]-a[0],d=s[1]-l[1],f=s[2]-c[2];return s[3]=Math.sqrt(h*h+d*d+f*f),RS.set(n,s),s},"measureBoundingSphere");var dee=hee;const Wv=_t,fee=u(n=>{let e=0;const t=n.vertices,s=Wv.create();for(let i=0;i<t.length-2;i++)Wv.cross(s,t[i+1],t[i+2]),e+=Wv.dot(t[0],s);return e/=6,e},"measureSignedVolume");var pee=fee;const mee=u(n=>n.vertices,"toPoints$7");var gee=mee;const vee=_t,yee=u(n=>{let e="poly3: vertices: [";return n.vertices.forEach(t=>{e+=`${vee.toString(t)}, `}),e+="]",e},"toString$4");var _ee=yee;const bee=hn,IS=_t,wee=bh,xee=u((n,e)=>{const t=e.vertices.map(s=>IS.transform(IS.create(),s,n));return bee.isMirroring(n)&&t.reverse(),wee(t)},"transform$5");var Aee=xee;const Mee=$D,{NEPS:See}=dt,Cee=_t,Eee=GD,Tee=HD,Pee=WD,Ree=Iw,Iee=u(n=>{if(!Eee(n))throw new Error("invalid poly3 structure");if(n.vertices.length<3)throw new Error(`poly3 not enough vertices ${n.vertices.length}`);if(Pee(n)<=0)throw new Error("poly3 area must be greater than zero");for(let e=0;e<n.vertices.length;e++)if(Cee.equals(n.vertices[e],n.vertices[(e+1)%n.vertices.length]))throw new Error(`poly3 duplicate vertex ${n.vertices[e]}`);if(!Tee(n))throw new Error("poly3 must be convex");if(n.vertices.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${e}`)}),n.vertices.length>3){const e=Ree(n);n.vertices.forEach(t=>{const s=Math.abs(Mee(e,t));if(s>See)throw new Error(`poly3 must be coplanar: vertex ${t} distance ${s}`)})}},"validate$2");var Dee=Iee,tn={clone:fJ,create:bh,fromPoints:vJ,fromPointsAndPlane:bJ,invert:XJ,isA:GD,isConvex:HD,measureArea:WD,measureBoundingBox:nee,measureBoundingSphere:dee,measureSignedVolume:pee,plane:Iw,toPoints:gee,toString:_ee,transform:Aee,validate:Dee};const Lee=tn,Oee=d1,kee=u(n=>{if(!Array.isArray(n))throw new Error("the given points must be an array");const e=n.map((s,i)=>Lee.create(s));return Oee(e)},"fromPoints$6");var Nee=kee;const Fee=_t,zee=hn,Bee=tn,Uee=d1,$ee=u(n=>{if(n[0]!==1)throw new Error("invalid compact binary data");const e=Uee();e.transforms=zee.clone(n.slice(1,17));const t=n[21];let s=22,i=n.length-t*3;for(;i<n.length;){const r=n[s];s++;const o=[];for(let a=0;a<r;a++)o.push(Fee.fromValues(n[i],n[i+1],n[i+2])),i+=3;e.polygons.push(Bee.create(o))}return n[17]>=0&&(e.color=[n[17],n[18],n[19],n[20]]),e},"fromCompactBinary$1");var Vee=$ee;const DS=hn,Gee=tn,Hee=u(n=>(DS.isIdentity(n.transforms)||(n.polygons=n.polygons.map(e=>Gee.transform(n.transforms,e)),n.transforms=DS.create()),n),"applyTransforms$3");var Wee=Hee;const jee=Wee,Xee=u(n=>jee(n).polygons,"toPolygons$4");var p1=Xee;const Yee=tn,qee=d1,Kee=p1,Zee=u(n=>{const t=Kee(n).map(s=>Yee.invert(s));return qee(t)},"invert");var Qee=Zee;const Jee=u(n=>!!(n&&typeof n=="object"&&"polygons"in n&&"transforms"in n&&Array.isArray(n.polygons)&&"length"in n.transforms),"isA$4");var jD=Jee;const ete=tn,tte=p1,nte=u(n=>tte(n).map(s=>ete.toPoints(s)),"toPoints$6");var ste=nte;const ite=tn,rte=p1,ote=u(n=>{const e=rte(n);let t="geom3 ("+e.length+` polygons):
`;return e.forEach(s=>{t+="  "+ite.toString(s)+`
`}),t},"toString$3");var ate=ote;const lte=tn,cte=u(n=>{const e=n.polygons,t=n.transforms,s=e.length,i=e.reduce((c,h)=>c+h.vertices.length,0);let r=[-1,-1,-1,-1];n.color&&(r=n.color);const o=new Float32Array(1+16+4+1+s+i*3);o[0]=1,o[1]=t[0],o[2]=t[1],o[3]=t[2],o[4]=t[3],o[5]=t[4],o[6]=t[5],o[7]=t[6],o[8]=t[7],o[9]=t[8],o[10]=t[9],o[11]=t[10],o[12]=t[11],o[13]=t[12],o[14]=t[13],o[15]=t[14],o[16]=t[15],o[17]=r[0],o[18]=r[1],o[19]=r[2],o[20]=r[3],o[21]=i;let a=22,l=a+s;return e.forEach(c=>{const h=lte.toPoints(c);o[a]=h.length,a++;for(let d=0;d<h.length;d++){const f=h[d];o[l+0]=f[0],o[l+1]=f[1],o[l+2]=f[2],l+=3}}),o},"toCompactBinary$1");var ute=cte;const LS=hn,hte=u((n,e)=>{const t=LS.multiply(LS.create(),n,e.transforms);return Object.assign({},e,{transforms:t})},"transform$4");var dte=hte;const fte=tn,pte=jD,mte=u(n=>{if(!pte(n))throw new Error("invalid geom3 structure");if(n.polygons.forEach(fte.validate),gte(n),!n.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${n.transforms}`)},"validate$1"),gte=u(n=>{const e=new Map;n.polygons.forEach(({vertices:s})=>{s.forEach((i,r)=>{const o=`${i}`,a=`${s[(r+1)%s.length]}`,l=`${o}/${a}`,c=e.has(l)?e.get(l):0;e.set(l,c+1)})});const t=[];if(e.forEach((s,i)=>{const r=i.split("/").reverse().join("/"),o=e.get(r);s!==o&&t.push(i.replace("/"," -> "))}),t.length>0)throw new Error(`non-manifold edges ${t.length}
${t.join(`
`)}`)},"validateManifold");var vte=mte,Tt={clone:oJ,create:d1,fromPoints:Nee,fromCompactBinary:Vee,invert:Qee,isA:jD,toPoints:ste,toPolygons:p1,toString:ate,toCompactBinary:ute,transform:dte,validate:vte};const yte=u(n=>Object.assign({},n),"clone$4");var Dw=yte;const{EPS:OS}=dt,_te=wt,bte=Dw,wte=u(n=>{if(n.isClosed)return n;const e=bte(n);if(e.isClosed=!0,e.points.length>1){const t=e.points,s=t[0];let i=t[t.length-1];for(;_te.distance(s,i)<OS*OS&&(t.pop(),t.length!==1);)i=t[t.length-1]}return e},"close$1");var XD=wte;const xte=hn,Ate=u(n=>(n===void 0&&(n=[]),{points:n,isClosed:!1,transforms:xte.create()}),"create$f");var m1=Ate;const{EPS:kS}=dt,NS=wt,Mte=XD,Ste=m1,Cte=u((n,e)=>{const t={closed:!1};let{closed:s}=Object.assign({},t,n),i=Ste();if(i.points=e.map(r=>NS.clone(r)),i.points.length>1){const r=i.points[0],o=i.points[i.points.length-1];NS.distance(r,o)<kS*kS&&(s=!0)}return s===!0&&(i=Mte(i)),i},"fromPoints$5");var Lw=Cte;const FS=hn,zS=wt,Ete=u(n=>(FS.isIdentity(n.transforms)||(n.points=n.points.map(e=>zS.transform(zS.create(),e,n.transforms)),n.transforms=FS.create()),n),"applyTransforms$1");var Tte=Ete;const Pte=Tte,Rte=u(n=>Pte(n).points,"toPoints$5");var wh=Rte;const{TAU:pm}=dt,Jn=wt,Ite=Lw,Dte=wh,Lte=u((n,e)=>{const t={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16};let{endpoint:s,radius:i,xaxisrotation:r,clockwise:o,large:a,segments:l}=Object.assign({},t,n);if(!Array.isArray(s))throw new Error("endpoint must be an array of X and Y values");if(s.length<2)throw new Error("endpoint must contain X and Y values");if(s=Jn.clone(s),!Array.isArray(i))throw new Error("radius must be an array of X and Y values");if(i.length<2)throw new Error("radius must contain X and Y values");if(l<4)throw new Error("segments must be four or more");const c=1e5;if(e.isClosed)throw new Error("the given path cannot be closed");const h=Dte(e);if(h.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let d=i[0],f=i[1];const p=h[h.length-1];d=Math.round(d*c)/c,f=Math.round(f*c)/c,s=Jn.fromValues(Math.round(s[0]*c)/c,Math.round(s[1]*c)/c);const g=!o;let m=[];if(d===0||f===0)m.push(s);else{d=Math.abs(d),f=Math.abs(f);const y=r,b=Math.cos(y),_=Math.sin(y),w=Jn.subtract(Jn.create(),p,s);Jn.scale(w,w,.5);const x=Math.round((b*w[0]+_*w[1])*c)/c,S=Math.round((-_*w[0]+b*w[1])*c)/c,C=Jn.fromValues(x,S),M=C[0]*C[0]/(d*d)+C[1]*C[1]/(f*f);if(M>1){const ne=Math.sqrt(M);d*=ne,f*=ne,d=Math.round(d*c)/c,f=Math.round(f*c)/c}let R=Math.sqrt((d*d*f*f-d*d*C[1]*C[1]-f*f*C[0]*C[0])/(d*d*C[1]*C[1]+f*f*C[0]*C[0]));g===a&&(R=-R);const D=Jn.fromValues(d*C[1]/f,-f*C[0]/d);Jn.scale(D,D,R);let k=Jn.fromValues(b*D[0]-_*D[1],_*D[0]+b*D[1]);k=Jn.add(k,k,Jn.scale(Jn.create(),Jn.add(Jn.create(),p,s),.5));const T=Jn.fromValues((C[0]-D[0])/d,(C[1]-D[1])/f),N=Jn.fromValues((-C[0]-D[0])/d,(-C[1]-D[1])/f),E=Jn.angleRadians(T);let H=Jn.angleRadians(N)-E;H=H%pm,!g&&H>0?H-=pm:g&&H<0&&(H+=pm);let q=Math.ceil(Math.abs(H)/pm*l)+1;q<1&&(q=1);for(let ne=1;ne<q;ne++){const W=E+ne/q*H,se=Math.cos(W),K=Math.sin(W),U=Jn.fromValues(b*d*se-_*f*K,_*d*se+b*f*K);Jn.add(U,U,k),m.push(U)}q&&m.push(n.endpoint)}return m=h.concat(m),Ite({},m)},"appendArc");var Ote=Lte;const kte=Lw,Nte=wh,{equals:Fte}=wt,zte=u((...n)=>{let e=!1,t=[];return n.forEach((s,i)=>{const r=Nte(s).slice();if(t.length>0&&r.length>0&&Fte(r[0],t[t.length-1])&&r.shift(),r.length>0&&e)throw new Error(`Cannot concatenate to a closed path; check the ${i}th path`);e=s.isClosed,t=t.concat(r)}),kte({closed:e},t)},"concat$1");var YD=zte;const Bte=YD,Ute=m1,$te=u((n,e)=>Bte(e,Ute(n)),"appendPoints$1");var qD=$te;const{TAU:Vte}=dt,yi=wt,Gte=wt,Hte=qD,Wte=wh,jte=u((n,e)=>{const t={segments:16};let{controlPoints:s,segments:i}=Object.assign({},t,n);if(!Array.isArray(s))throw new Error("controlPoints must be an array of one or more points");if(s.length<1)throw new Error("controlPoints must be an array of one or more points");if(i<4)throw new Error("segments must be four or more");if(e.isClosed)throw new Error("the given geometry cannot be closed");const r=Wte(e);if(r.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(s=s.slice(),s[0]===null){if(s.length<2)throw new Error("a null control point must be passed with one more control points");let S=r[r.length-2];if("lastBezierControlPoint"in e&&(S=e.lastBezierControlPoint),!Array.isArray(S))throw new Error("the given path must contain TWO or more points if given a null control point");const C=yi.scale(yi.create(),r[r.length-1],2);yi.subtract(C,C,S),s[0]=C}s.unshift(r[r.length-1]);const a=s.length-1,l=[];let c=1;for(let S=0;S<=a;++S)S>0&&(c*=S),l.push(c);const h=[];for(let S=0;S<=a;++S){const C=l[a]/(l[S]*l[a-S]);h.push(C)}const d=yi.create(),f=yi.create(),p=Gte.create(),g=u(S=>{let C=1,M=Math.pow(1-S,a);const R=S!==1?1/(1-S):1,D=yi.create();for(let k=0;k<=a;++k){k===a&&(M=1);const T=h[k]*C*M,N=yi.scale(d,s[k],T);yi.add(D,D,N),C*=S,M*=R}return D},"getPointForT"),m=[],v=[],y=a+1;for(let S=0;S<y;++S){const C=S/(y-1),M=g(C);m.push(M),v.push(C)}let b=1;const _=Vte/i,w=Math.sin(_);for(;b<m.length-1;){const S=yi.subtract(d,m[b],m[b-1]);yi.normalize(S,S);const C=yi.subtract(f,m[b+1],m[b]);yi.normalize(C,C);const M=yi.cross(p,S,C);if(Math.abs(M[2])>w){const R=v[b-1],D=v[b+1],k=R+(D-R)*1/3,T=R+(D-R)*2/3,N=g(k),E=g(T);m.splice(b,1,N,E),v.splice(b,1,k,T),b--,b<1&&(b=1)}else++b}m.shift();const x=Hte(m,e);return x.lastBezierControlPoint=s[s.length-2],x},"appendBezier");var Xte=jte;const Yte=wt,BS=wh,qte=u((n,e)=>{if(n.isClosed!==e.isClosed||n.points.length!==e.points.length)return!1;const t=BS(n),s=BS(e),i=t.length;let r=0;do{let o=!1;for(let a=0;a<i;a++)if(!Yte.equals(t[a],s[(a+r)%i])){o=!0;break}if(o===!1)return!0;if(!n.isClosed)return!1}while(++r<i);return!1},"equals$3");var Kte=qte;const Zte=hn,Qte=wt,Jte=m1,ene=u(n=>{if(n[0]!==2)throw new Error("invalid compact binary data");const e=Jte();e.transforms=Zte.clone(n.slice(1,17)),e.isClosed=!!n[17];for(let t=22;t<n.length;t+=2){const s=Qte.fromValues(n[t],n[t+1]);e.points.push(s)}return n[18]>=0&&(e.color=[n[18],n[19],n[20],n[21]]),e},"fromCompactBinary");var tne=ene;const nne=u(n=>!!(n&&typeof n=="object"&&"points"in n&&"transforms"in n&&"isClosed"in n&&Array.isArray(n.points)&&"length"in n.transforms),"isA$2");var KD=nne;const sne=Dw,ine=u(n=>{const e=sne(n);return e.points=n.points.slice().reverse(),e},"reverse$2");var rne=ine;const one=wt,ane=wh,lne=u(n=>{const e=ane(n);let t="path ("+e.length+" points, "+n.isClosed+`):
[
`;return e.forEach(s=>{t+="  "+one.toString(s)+`,
`}),t+=`]
`,t},"toString$2");var cne=lne;const une=u(n=>{const e=n.points,t=n.transforms;let s=[-1,-1,-1,-1];n.color&&(s=n.color);const i=new Float32Array(1+16+1+4+e.length*2);i[0]=2,i[1]=t[0],i[2]=t[1],i[3]=t[2],i[4]=t[3],i[5]=t[4],i[6]=t[5],i[7]=t[6],i[8]=t[7],i[9]=t[8],i[10]=t[9],i[11]=t[10],i[12]=t[11],i[13]=t[12],i[14]=t[13],i[15]=t[14],i[16]=t[15],i[17]=n.isClosed?1:0,i[18]=s[0],i[19]=s[1],i[20]=s[2],i[21]=s[3];for(let r=0;r<e.length;r++){const o=r*2+22,a=e[r];i[o]=a[0],i[o+1]=a[1]}return i},"toCompactBinary");var hne=une;const US=hn,dne=u((n,e)=>{const t=US.multiply(US.create(),n,e.transforms);return Object.assign({},e,{transforms:t})},"transform$3");var fne=dne;const pne=wt,mne=KD,gne=u(n=>{if(!mne(n))throw new Error("invalid path2 structure");if(n.points.length>1){for(let e=0;e<n.points.length;e++)if(pne.equals(n.points[e],n.points[(e+1)%n.points.length]))throw new Error(`path2 duplicate points ${n.points[e]}`)}if(n.points.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`path2 invalid point ${e}`)}),!n.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${n.transforms}`)},"validate");var vne=gne,qn={appendArc:Ote,appendBezier:Xte,appendPoints:qD,clone:Dw,close:XD,concat:YD,create:m1,equals:Kte,fromPoints:Lw,fromCompactBinary:tne,isA:KD,reverse:rne,toPoints:wh,toString:cne,toCompactBinary:hne,transform:fne,validate:vne};const yne=Ot,_ne=Tt,bne=qn,wne=u(n=>{let e;for(const t of n){let s=0;if(yne.isA(t)&&(s=1),_ne.isA(t)&&(s=2),bne.isA(t)&&(s=3),e&&s!==e)return!1;e=s}return!0},"areAllShapesTheSameType$4");var up=wne;const xne=u(n=>{let e=0;for(let t=0;t<n.length;t++){const s=(t+1)%n.length;e+=n[t][0]*n[s][1],e-=n[s][0]*n[t][1]}return e/2},"area$9");var g1=xne;const Ane=g1,Mne=u(n=>Ane(n.vertices),"measureArea$1");var ZD=Mne;const Sne=u(n=>((n===void 0||n.length<3)&&(n=[]),{vertices:n}),"create$b");var QD=Sne;const Cne=QD,Ene=u(n=>{const e=n.vertices.slice().reverse();return Cne(e)},"flip$1");var JD=Ene;const Tne=ZD,Pne=JD,Rne=u((n,e)=>{if(n.length===0)return 0;const t=e.vertices;return t.length<3?0:(Tne(e)<0&&(e=Pne(e)),n.reduce((i,r)=>i+Ine(r,t),0)===n.length?1:0)},"arePointsInside$1"),Ine=u((n,e)=>{const t=e.length,s=n[0],i=n[1];let r=e[t-1],o=e[0],a=r[1]>i,l=0,c=0;for(let h=t+1;--h;){const d=o[1]>i;if(a!==d){const f=r[0]>s,p=o[0]>s;(f&&p||o[0]-(o[1]-i)*(r[0]-o[0])/(r[1]-o[1])>=s)&&(l=!l)}a=d,r=o,o=e[++c]}return l},"isPointInside");var Dne=Rne,eL={arePointsInside:Dne,create:QD,flip:JD,measureArea:ZD},Lne={geom2:Ot,geom3:Tt,path2:qn,poly2:eL,poly3:tn};const{EPS:One}=dt,kne=u((n,e)=>{let t=0;for(let s=0;s<e;s++)t+=n[1][s]-n[0][s];return One*t/e},"calculateEpsilonFromBounds$1");var Nne=kne;const Fne=Jt,Vr=wt,td=_t,tL=Ot,nL=Tt,sL=qn,$S=tn,lh=new WeakMap,zne=u(n=>{let e=lh.get(n);if(e)return e;const t=sL.toPoints(n);let s;t.length===0?s=Vr.create():s=Vr.clone(t[0]);let i=Vr.clone(s);return t.forEach(r=>{Vr.min(s,s,r),Vr.max(i,i,r)}),s=[s[0],s[1],0],i=[i[0],i[1],0],e=[s,i],lh.set(n,e),e},"measureBoundingBoxOfPath2"),Bne=u(n=>{let e=lh.get(n);if(e)return e;const t=tL.toPoints(n);let s;t.length===0?s=Vr.create():s=Vr.clone(t[0]);let i=Vr.clone(s);return t.forEach(r=>{Vr.min(s,s,r),Vr.max(i,i,r)}),s=[s[0],s[1],0],i=[i[0],i[1],0],e=[s,i],lh.set(n,e),e},"measureBoundingBoxOfGeom2"),Une=u(n=>{let e=lh.get(n);if(e)return e;const t=nL.toPolygons(n);let s=td.create();if(t.length>0){const r=$S.toPoints(t[0]);td.copy(s,r[0])}let i=td.clone(s);return t.forEach(r=>{$S.toPoints(r).forEach(o=>{td.min(s,s,o),td.max(i,i,o)})}),s=[s[0],s[1],s[2]],i=[i[0],i[1],i[2]],e=[s,i],lh.set(n,e),e},"measureBoundingBoxOfGeom3"),$ne=u((...n)=>{if(n=Fne(n),n.length===0)throw new Error("wrong number of arguments");const e=n.map(t=>sL.isA(t)?zne(t):tL.isA(t)?Bne(t):nL.isA(t)?Une(t):[[0,0,0],[0,0,0]]);return e.length===1?e[0]:e},"measureBoundingBox$4");var v1=$ne;const Vne=Jt,{geom2:Gne,geom3:Hne,path2:Wne}=Lne,Ow=Nne,kw=v1,jne=u(n=>Ow(kw(n),2),"measureEpsilonOfPath2"),Xne=u(n=>Ow(kw(n),2),"measureEpsilonOfGeom2"),Yne=u(n=>Ow(kw(n),3),"measureEpsilonOfGeom3"),qne=u((...n)=>{if(n=Vne(n),n.length===0)throw new Error("wrong number of arguments");const e=n.map(t=>Wne.isA(t)?jne(t):Gne.isA(t)?Xne(t):Hne.isA(t)?Yne(t):0);return e.length===1?e[0]:e},"measureEpsilon$5");var hp=qne;const VS=wt,Kne=Ot,Zne=u((n,e)=>{if(e.vertices.length<4)return null;const t=[],s=e.vertices.filter((o,a)=>o[2]>0?(t.push(a),!0):!1);if(s.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");const i=s.map(o=>{const a=Math.round(o[0]/n)*n+0,l=Math.round(o[1]/n)*n+0;return VS.fromValues(a,l)});if(VS.equals(i[0],i[1]))return null;const r=t[1]-t[0];if(r===1||r===3)r===1&&i.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return i},"fromFakePolygon"),Qne=u((n,e)=>{const t=e.map(s=>Zne(n,s)).filter(s=>s!==null);return Kne.create(t)},"fromFakePolygons$3");var Nw=Qne;const ua=_t,Jne=Ot,ese=Tt,tse=tn,nse=u((n,e,t)=>{const s=[ua.fromVec2(ua.create(),t[0],n),ua.fromVec2(ua.create(),t[1],n),ua.fromVec2(ua.create(),t[1],e),ua.fromVec2(ua.create(),t[0],e)];return tse.create(s)},"to3DWall"),sse=u((n,e)=>{const s=Jne.toSides(e).map(r=>nse(n.z0,n.z1,r));return ese.create(s)},"to3DWalls$3");var Fw=sse;const{NEPS:jv}=dt,ise=u((n,e)=>Math.abs(n[0]-e[0])<=jv&&Math.abs(n[1]-e[1])<=jv&&Math.abs(n[2]-e[2])<=jv,"aboutEqualNormals$2");var zw=ise;const rse=u(()=>[0,1,0],"create$9");var Bw=rse;const ose=Bw,ase=u(n=>{const e=ose();return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},"clone$1");var lse=ase;const Xv=wt,cse=u(n=>{const e=Xv.normal(Xv.create(),n);return Xv.negate(e,e),e},"direction$2");var Uw=cse;const GS=wt,use=u(n=>GS.scale(GS.create(),n,n[2]),"origin$3");var y1=use;const hse=wt,dse=Uw,fse=y1,pse=u((n,e)=>{const t=fse(n),s=dse(n),i=(s[1]-t[1])/(s[0]-t[0]),r=t[1]-i*t[0],o=-1/i,l=(e[1]-o*e[0]-r)/(i-o),c=i*l+r;return hse.fromValues(l,c)},"closestPoint");var mse=pse;const gse=u((n,e)=>(n[0]=e[0],n[1]=e[1],n[2]=e[2],n),"copy$2");var iL=gse;const vse=wt,yse=u((n,e)=>{let t=vse.dot(e,n);return t=Math.abs(t-n[2]),t},"distanceToPoint");var _se=yse;const bse=u((n,e)=>n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],"equals$2");var wse=bse;const nd=wt,xse=u((n,e,t)=>{const s=nd.subtract(nd.create(),t,e);nd.normal(s,s),nd.normalize(s,s);const i=nd.dot(e,s);return n[0]=s[0],n[1]=s[1],n[2]=i,n},"fromPoints$2");var rL=xse;const Ase=Bw,Mse=u((n,e,t)=>{const s=Ase();return s[0]=n,s[1]=e,s[2]=t,s},"fromValues$1");var oL=Mse;const Sse=u((n,e,t)=>{let s=t-n[1],i=e[1]-n[1];i<0&&(s=-s,i=-i);let r;return s<=0?r=0:s>=i?r=1:i<1e-10?r=.5:r=s/i,n[0]+r*(e[0]-n[0])},"interpolateBetween2DPointsForY$1");var aL=Sse;const Cse=u((n,e,t,s)=>{if(n[0]===e[0]&&n[1]===e[1]||t[0]===s[0]&&t[1]===s[1])return;const i=(s[1]-t[1])*(e[0]-n[0])-(s[0]-t[0])*(e[1]-n[1]);if(Math.abs(i)<Number.MIN_VALUE)return;const r=((s[0]-t[0])*(n[1]-t[1])-(s[1]-t[1])*(n[0]-t[0]))/i,o=((e[0]-n[0])*(n[1]-t[1])-(e[1]-n[1])*(n[0]-t[0]))/i;if(r<0||r>1||o<0||o>1)return;const a=n[0]+r*(e[0]-n[0]),l=n[1]+r*(e[1]-n[1]);return[a,l]},"intersect$5");var lL=Cse;const Ese=u((n,e,t,s,i,r)=>{const o=n*s-e*t,a=1/o;let l=i*s-e*r,c=-i*t+n*r;return l*=a,c*=a,[l,c]},"solve2Linear$1");var Tse=Ese,$w={aboutEqualNormals:zw,area:g1,cos:Ps.cos,interpolateBetween2DPointsForY:aL,intersect:lL,sin:Ps.sin,solve2Linear:Tse};const Pse=wt,{solve2Linear:Rse}=$w,Ise=u((n,e)=>{const t=Rse(n[0],n[1],e[0],e[1],n[2],e[2]);return Pse.clone(t)},"intersectToLine");var Dse=Ise;const HS=wt,Lse=iL,Ose=oL,kse=u((n,e)=>{const t=HS.negate(HS.create(),e),s=-e[2];return Lse(n,Ose(t[0],t[1],s))},"reverse$1");var Nse=kse;const Fse=u(n=>`line2: (${n[0].toFixed(7)}, ${n[1].toFixed(7)}, ${n[2].toFixed(7)})`,"toString$1");var zse=Fse;const WS=wt,Bse=rL,Use=y1,$se=Uw,Vse=u((n,e,t)=>{const s=Use(e),i=$se(e);return WS.transform(s,s,t),WS.transform(i,i,t),Bse(n,s,i)},"transform$2");var Gse=Vse;const Hse=y1,Wse=u((n,e)=>{let t=(n[2]-n[1]*e)/n[0];return Number.isNaN(t)&&(t=Hse(n)[0]),t},"xAtY");var jse=Wse,cL={clone:lse,closestPoint:mse,copy:iL,create:Bw,direction:Uw,distanceToPoint:_se,equals:wse,fromPoints:rL,fromValues:oL,intersectPointOfLines:Dse,origin:y1,reverse:Nse,toString:zse,transform:Gse,xAtY:jse};const jS=hn,Xse=wt,es=_t,uc=u(function(n,e){arguments.length<2&&(e=es.orthogonal(es.create(),n)),this.v=es.normalize(es.create(),es.cross(es.create(),n,e)),this.u=es.cross(es.create(),this.v,n),this.plane=n,this.planeorigin=es.scale(es.create(),n,n[3])},"OrthoNormalBasis$1");uc.GetCartesian=function(n,e){const t=n+"/"+e;let s,i;if(t==="X/Y")s=[0,0,1],i=[1,0,0];else if(t==="Y/-X")s=[0,0,1],i=[0,1,0];else if(t==="-X/-Y")s=[0,0,1],i=[-1,0,0];else if(t==="-Y/X")s=[0,0,1],i=[0,-1,0];else if(t==="-X/Y")s=[0,0,-1],i=[-1,0,0];else if(t==="-Y/-X")s=[0,0,-1],i=[0,-1,0];else if(t==="X/-Y")s=[0,0,-1],i=[1,0,0];else if(t==="Y/X")s=[0,0,-1],i=[0,1,0];else if(t==="X/Z")s=[0,-1,0],i=[1,0,0];else if(t==="Z/-X")s=[0,-1,0],i=[0,0,1];else if(t==="-X/-Z")s=[0,-1,0],i=[-1,0,0];else if(t==="-Z/X")s=[0,-1,0],i=[0,0,-1];else if(t==="-X/Z")s=[0,1,0],i=[-1,0,0];else if(t==="-Z/-X")s=[0,1,0],i=[0,0,-1];else if(t==="X/-Z")s=[0,1,0],i=[1,0,0];else if(t==="Z/X")s=[0,1,0],i=[0,0,1];else if(t==="Y/Z")s=[1,0,0],i=[0,1,0];else if(t==="Z/-Y")s=[1,0,0],i=[0,0,1];else if(t==="-Y/-Z")s=[1,0,0],i=[0,-1,0];else if(t==="-Z/Y")s=[1,0,0],i=[0,0,-1];else if(t==="-Y/Z")s=[-1,0,0],i=[0,-1,0];else if(t==="-Z/-Y")s=[-1,0,0],i=[0,0,-1];else if(t==="Y/-Z")s=[-1,0,0],i=[0,1,0];else if(t==="Z/Y")s=[-1,0,0],i=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new uc(new Plane(new Vector3D(s),0),new Vector3D(i))};uc.Z0Plane=function(){const n=new Plane(new Vector3D([0,0,1]),0);return new uc(n,new Vector3D([1,0,0]))};uc.prototype={getProjectionMatrix:function(){return jS.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1)},getInverseProjectionMatrix:function(){const n=es.scale(es.create(),this.plane,this.plane[3]);return jS.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,n[0],n[1],n[2],1)},to2D:function(n){return Xse.fromValues(es.dot(n,this.u),es.dot(n,this.v))},to3D:function(n){const e=es.scale(es.create(),this.u,n[0]),t=es.scale(es.create(),this.v,n[1]),s=es.add(e,e,this.planeorigin);return es.add(t,t,s)},line3Dto2D:function(n){const e=n.point,t=n.direction.plus(e),s=this.to2D(e),i=this.to2D(t);return Line2D.fromPoints(s,i)},line2Dto3D:function(n){const e=n.origin(),t=n.direction().plus(e),s=this.to3D(e),i=this.to3D(t);return Line3D.fromPoints(s,i)},transform:function(n){const e=this.plane.transform(n),t=this.u.transform(n),s=new Vector3D(0,0,0).transform(n),i=t.minus(s);return new uc(e,i)}};var Yse=uc;const qse=u(n=>n*.017453292519943295,"degToRad");var Kse=qse;const Zse=u((n,e)=>n-e,"fnNumberSort$2");var uL=Zse;const Qse=u((n,e,t)=>{let s=0,i=n.length;for(;i>s;){const r=Math.floor((s+i)/2),o=n[r];t(e,o)>0?s=r+1:i=r}n.splice(s,0,e)},"insertSorted$1");var Jse=Qse;const{TAU:XS}=dt,eie=u((n,e,t)=>{const s=e>0?n*XS/e:0,i=t>0?XS/t:0;return Math.ceil(Math.max(s,i,4))},"radiusToSegments");var tie=eie;const nie=u(n=>n*57.29577951308232,"radToDeg");var sie=nie,iie={areAllShapesTheSameType:up,degToRad:Kse,flatten:Jt,fnNumberSort:uL,insertSorted:Jse,radiusToSegments:tie,radToDeg:sie};const{EPS:uo}=dt,ha=cL,ar=wt,rie=Yse,Fc=aL,{insertSorted:oie,fnNumberSort:aie}=iie,YS=tn,lie=u(n=>{if(n.length<2)return n;const e=[],t=n.length,s=YS.plane(n[0]),i=new rie(s),r=[],o=[],a=new Map,l=new Map,c=new Map,h=10/uo;for(let g=0;g<t;g++){const m=n[g];let v=[],y=m.vertices.length,b=-1;if(y>0){let _,w;for(let x=0;x<y;x++){let S=i.to2D(m.vertices[x]);const C=Math.floor(S[1]*h);let M;c.has(C)?M=c.get(C):c.has(C+1)?M=c.get(C+1):c.has(C-1)?M=c.get(C-1):(M=S[1],c.set(C,S[1])),S=ar.fromValues(S[0],M),v.push(S);const R=S[1];(x===0||R<_)&&(_=R,b=x),(x===0||R>w)&&(w=R);let D=l.get(R);D||(D={},l.set(R,D)),D[g]=!0}if(_>=w)v=[],y=0,b=-1;else{let x=a.get(_);x||(x=[],a.set(_,x)),x.push(g)}}v.reverse(),b=y-b-1,r.push(v),o.push(b)}const d=[];l.forEach((g,m)=>d.push(m)),d.sort(aie);let f=[],p=[];for(let g=0;g<d.length;g++){const m=[],v=d[g],y=l.get(v);for(let _=0;_<f.length;++_){const w=f[_],x=w.polygonindex;if(y[x]){const S=r[x],C=S.length;let M=w.leftvertexindex,R=w.rightvertexindex;for(;;){let k=M+1;if(k>=C&&(k=0),S[k][1]!==v)break;M=k}let D=R-1;if(D<0&&(D=C-1),S[D][1]===v&&(R=D),M!==w.leftvertexindex&&M===R)f.splice(_,1),--_;else{w.leftvertexindex=M,w.rightvertexindex=R,w.topleft=S[M],w.topright=S[R];let k=M+1;k>=C&&(k=0),w.bottomleft=S[k];let T=R-1;T<0&&(T=C-1),w.bottomright=S[T]}}}let b;if(g>=d.length-1)f=[],b=null;else{b=Number(d[g+1]);const _=.5*(v+b),w=a.get(v);for(const x in w){const S=w[x],C=r[S],M=C.length,R=o[S];let D=R;for(;;){let z=D+1;if(z>=M&&(z=0),C[z][1]!==v||z===R)break;D=z}let k=R;for(;;){let z=k-1;if(z<0&&(z=M-1),C[z][1]!==v||z===D)break;k=z}let T=D+1;T>=M&&(T=0);let N=k-1;N<0&&(N=M-1);const E={polygonindex:S,leftvertexindex:D,rightvertexindex:k,topleft:C[D],topright:C[k],bottomleft:C[T],bottomright:C[N]};oie(f,E,(z,H)=>{const q=Fc(z.topleft,z.bottomleft,_),ne=Fc(H.topleft,H.bottomleft,_);return q>ne?1:q<ne?-1:0})}}for(const _ in f){const w=f[_];let x=Fc(w.topleft,w.bottomleft,v);const S=ar.fromValues(x,v);x=Fc(w.topright,w.bottomright,v);const C=ar.fromValues(x,v);x=Fc(w.topleft,w.bottomleft,b);const M=ar.fromValues(x,b);x=Fc(w.topright,w.bottomright,b);const R=ar.fromValues(x,b),D={topleft:S,topright:C,bottomleft:M,bottomright:R,leftline:ha.fromPoints(ha.create(),S,M),rightline:ha.fromPoints(ha.create(),R,C)};if(m.length>0){const k=m[m.length-1],T=ar.distance(D.topleft,k.topright),N=ar.distance(D.bottomleft,k.bottomright);T<uo&&N<uo&&(D.topleft=k.topleft,D.leftline=k.leftline,D.bottomleft=k.bottomleft,m.splice(m.length-1,1))}m.push(D)}if(g>0){const _=new Set,w=new Set;for(let x=0;x<m.length;x++){const S=m[x];for(let C=0;C<p.length;C++)if(!w.has(C)){const M=p[C];if(ar.distance(M.bottomleft,S.topleft)<uo&&ar.distance(M.bottomright,S.topright)<uo){w.add(C);const R=ha.direction(S.leftline),D=ha.direction(M.leftline),k=R[0]-D[0],T=ha.direction(S.rightline),N=ha.direction(M.rightline),E=T[0]-N[0],z=Math.abs(k)<uo,H=Math.abs(E)<uo,q=z||k>=0,ne=H||E>=0;q&&ne&&(S.outpolygon=M.outpolygon,S.leftlinecontinues=z,S.rightlinecontinues=H,_.add(C));break}}}for(let x=0;x<p.length;x++)if(!_.has(x)){const S=p[x];S.outpolygon.rightpoints.push(S.bottomright),ar.distance(S.bottomright,S.bottomleft)>uo&&S.outpolygon.leftpoints.push(S.bottomleft),S.outpolygon.leftpoints.reverse();const M=S.outpolygon.rightpoints.concat(S.outpolygon.leftpoints).map(D=>i.to3D(D)),R=YS.fromPointsAndPlane(M,s);R.vertices.length&&e.push(R)}}for(let _=0;_<m.length;_++){const w=m[_];w.outpolygon?(w.leftlinecontinues||w.outpolygon.leftpoints.push(w.topleft),w.rightlinecontinues||w.outpolygon.rightpoints.push(w.topright)):(w.outpolygon={leftpoints:[],rightpoints:[]},w.outpolygon.leftpoints.push(w.topleft),ar.distance(w.topleft,w.topright)>uo&&w.outpolygon.rightpoints.push(w.topright))}p=m}return e},"reTesselateCoplanarPolygons$1");var cie=lie;const qS=Tt,KS=tn,uie=zw,hie=cie,die=u((n,e)=>Math.abs(n[3]-e[3])<15e-8?uie(n,e):!1,"coplanar"),fie=u(n=>{if(n.isRetesselated)return n;const e=qS.toPolygons(n),t=[];e.forEach(r=>{const o=t.find(a=>die(a[0],KS.plane(r)));o?o[1].push(r):t.push([KS.plane(r),[r]])});let s=[];t.forEach(r=>{const o=r[1],a=hie(o);s=s.concat(a)});const i=qS.create(s);return i.isRetesselated=!0,i},"retessellate$4");var _1=fie;const{EPS:zc}=dt,ZS=v1,pie=u((n,e)=>{if(n.polygons.length===0||e.polygons.length===0)return!1;const t=ZS(n),s=t[0],i=t[1],r=ZS(e),o=r[0],a=r[1];return!(o[0]-i[0]>zc||s[0]-a[0]>zc||o[1]-i[1]>zc||s[1]-a[1]>zc||o[2]-i[2]>zc||s[2]-a[2]>zc)},"mayOverlap$3");var Vw=pie;const QS=Yo,mie=tn;class Hf{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=e}invert(){const e=[this];let t;for(let s=0;s<e.length;s++){t=e[s],t.plane&&(t.plane=QS.flip(QS.create(),t.plane)),t.front&&e.push(t.front),t.back&&e.push(t.back);const i=t.front;t.front=t.back,t.back=i}}clipPolygons(e,t){let s={node:this,polygontreenodes:e},i;const r=[];do{if(i=s.node,e=s.polygontreenodes,i.plane){const o=i.plane,a=[],l=[],c=t?a:l,h=e.length;for(let f=0;f<h;f++){const p=e[f];p.isRemoved()||p.splitByPlane(o,c,a,l,a)}i.front&&l.length>0&&r.push({node:i.front,polygontreenodes:l});const d=a.length;if(i.back&&d>0)r.push({node:i.back,polygontreenodes:a});else for(let f=0;f<d;f++)a[f].remove()}s=r.pop()}while(s!==void 0)}clipTo(e,t){let s=this;const i=[];do s.polygontreenodes.length>0&&e.rootnode.clipPolygons(s.polygontreenodes,t),s.front&&i.push(s.front),s.back&&i.push(s.back),s=i.pop();while(s!==void 0)}addPolygonTreeNodes(e){let t={node:this,polygontreenodes:e};const s=[];do{const i=t.node,r=t.polygontreenodes;if(r.length===0){t=s.pop();continue}if(!i.plane){let c=0;c=Math.floor(r.length/2);const h=r[c].getPolygon();i.plane=mie.plane(h)}const o=[],a=[],l=r.length;for(let c=0;c<l;++c)r[c].splitByPlane(i.plane,i.polygontreenodes,a,o,a);o.length>0&&(i.front||(i.front=new Hf(i)),l===o.length&&a.length===0?i.front.polygontreenodes=o:s.push({node:i.front,polygontreenodes:o})),a.length>0&&(i.back||(i.back=new Hf(i)),l===a.length&&o.length===0?i.back.polygontreenodes=a:s.push({node:i.back,polygontreenodes:a})),t=s.pop()}while(t!==void 0)}}u(Hf,"Node$3");var gie=Hf;const Bc=_t,vie=u((n,e,t)=>{const s=Bc.subtract(Bc.create(),t,e);let i=(n[3]-Bc.dot(n,e))/Bc.dot(n,s);return Number.isNaN(i)&&(i=0),i>1&&(i=1),i<0&&(i=0),Bc.scale(s,s,i),Bc.add(s,e,s),s},"splitLineSegmentByPlane$1");var yie=vie;const{EPS:mm}=dt,_ie=Yo,gm=_t,Yv=tn,bie=yie,wie=u((n,e)=>{const t={type:null,front:null,back:null},s=e.vertices,i=s.length,r=Yv.plane(e);if(_ie.equals(r,n))t.type=0;else{let o=!1,a=!1;const l=[],c=-mm;for(let h=0;h<i;h++){const d=gm.dot(n,s[h])-n[3],f=d<c;l.push(f),d>mm&&(o=!0),d<c&&(a=!0)}if(!o&&!a){const h=gm.dot(n,r);t.type=h>=0?0:1}else if(!a)t.type=2;else if(!o)t.type=3;else{t.type=4;const h=[],d=[];let f=l[0];for(let g=0;g<i;g++){const m=s[g];let v=g+1;v>=i&&(v=0);const y=l[v];if(f===y)f?d.push(m):h.push(m);else{const b=s[v],_=bie(n,m,b);f?(d.push(m),d.push(_),h.push(_)):(h.push(m),h.push(_),d.push(_))}f=y}const p=mm*mm;if(d.length>=3){let g=d[d.length-1];for(let m=0;m<d.length;m++){const v=d[m];gm.squaredDistance(v,g)<p&&(d.splice(m,1),m--),g=v}}if(h.length>=3){let g=h[h.length-1];for(let m=0;m<h.length;m++){const v=h[m];gm.squaredDistance(v,g)<p&&(h.splice(m,1),m--),g=v}}h.length>=3&&(t.front=Yv.fromPointsAndPlane(h,r)),d.length>=3&&(t.back=Yv.fromPointsAndPlane(d,r))}}return t},"splitPolygonByPlane$1");var xie=wie;const{EPS:Aie}=dt,Mie=_t,JS=tn,Sie=xie;class b1{constructor(e,t){this.parent=e,this.children=[],this.polygon=t,this.removed=!1}addPolygons(e){if(!this.isRootNode())throw new Error("Assertion failed");const t=this;e.forEach(s=>{t.addChild(s)})}remove(){if(!this.removed){this.removed=!0,this.polygon=null;const e=this.parent.children,t=e.indexOf(this);if(t<0)throw new Error("Assertion failed");e.splice(t,1),this.parent.recursivelyInvalidatePolygon()}}isRemoved(){return this.removed}isRootNode(){return!this.parent}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon}getPolygons(e){let t=[this];const s=[t];let i,r,o,a;for(i=0;i<s.length;++i)for(t=s[i],r=0,o=t.length;r<o;r++)a=t[r],a.polygon?e.push(a.polygon):a.children.length>0&&s.push(a.children)}splitByPlane(e,t,s,i,r){if(this.children.length){const o=[this.children];let a,l,c,h,d;for(a=0;a<o.length;a++)for(d=o[a],l=0,c=d.length;l<c;l++)h=d[l],h.children.length>0?o.push(h.children):h._splitByPlane(e,t,s,i,r)}else this._splitByPlane(e,t,s,i,r)}_splitByPlane(e,t,s,i,r){const o=this.polygon;if(o){const a=JS.measureBoundingSphere(o),l=a[3]+Aie,c=a,h=Mie.dot(e,c)-e[3];if(h>l)i.push(this);else if(h<-l)r.push(this);else{const d=Sie(e,o);switch(d.type){case 0:t.push(this);break;case 1:s.push(this);break;case 2:i.push(this);break;case 3:r.push(this);break;case 4:if(d.front){const f=this.addChild(d.front);i.push(f)}if(d.back){const f=this.addChild(d.back);r.push(f)}break}}}}addChild(e){const t=new b1(this,e);return this.children.push(t),t}invertSub(){let e=[this];const t=[e];let s,i,r,o;for(s=0;s<t.length;s++)for(e=t[s],i=0,r=e.length;i<r;i++)o=e[i],o.polygon&&(o.polygon=JS.invert(o.polygon)),o.children.length>0&&t.push(o.children)}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon()}clear(){let e=[this];const t=[e];for(let s=0;s<t.length;++s){e=t[s];const i=e.length;for(let r=0;r<i;r++){const o=e[r];o.polygon&&(o.polygon=null),o.parent&&(o.parent=null),o.children.length>0&&t.push(o.children),o.children=[]}}}toString(){let e="",t=[this];const s=[t];let i,r,o,a;for(i=0;i<s.length;++i){t=s[i];const l=" ".repeat(i);for(r=0,o=t.length;r<o;r++)a=t[r],e+=`${l}PolygonTreeNode (${a.isRootNode()}): ${a.children.length}`,a.polygon?e+=`
 ${l}polygon: ${a.polygon.vertices}
`:e+=`
`,a.children.length>0&&s.push(a.children)}return e}}u(b1,"PolygonTreeNode$1");var Cie=b1;const Eie=gie,Tie=Cie;class hL{constructor(e){this.polygonTree=new Tie,this.rootnode=new Eie(null),e&&this.addPolygons(e)}invert(){this.polygonTree.invert(),this.rootnode.invert()}clipTo(e,t=!1){this.rootnode.clipTo(e,t)}allPolygons(){const e=[];return this.polygonTree.getPolygons(e),e}addPolygons(e){const t=new Array(e.length);for(let s=0;s<e.length;s++)t[s]=this.polygonTree.addChild(e[s]);this.rootnode.addPolygonTreeNodes(t)}clear(){this.polygonTree.clear()}toString(){return"Tree: "+this.polygonTree.toString("")}}u(hL,"Tree$3");var Pie=hL,Gw={Tree:Pie};const vm=Tt,Rie=Vw,{Tree:eC}=Gw,Iie=u((n,e)=>{if(!Rie(n,e))return vm.create();const t=new eC(vm.toPolygons(n)),s=new eC(vm.toPolygons(e));t.invert(),s.clipTo(t),s.invert(),t.clipTo(s),s.clipTo(t),t.addPolygons(s.allPolygons()),t.invert();const i=t.allPolygons();return vm.create(i)},"intersectGeom3Sub");var Die=Iie;const Lie=Jt,Oie=_1,kie=Die,Nie=u((...n)=>{n=Lie(n);let e=n.shift();return n.forEach(t=>{e=kie(e,t)}),e=Oie(e),e},"intersect$4");var dL=Nie;const Fie=Jt,zie=Tt,Bie=hp,Uie=Nw,$ie=Fw,Vie=dL,Gie=u((...n)=>{n=Fie(n);const e=n.map(i=>$ie({z0:-1,z1:1},i)),t=Vie(e),s=Bie(t);return Uie(s,zie.toPolygons(t))},"intersect$3");var Hie=Gie;const Wie=Jt,jie=up,Xie=Ot,Yie=Tt,qie=Hie,Kie=dL,Zie=u((...n)=>{if(n=Wie(n),n.length===0)throw new Error("wrong number of arguments");if(!jie(n))throw new Error("only intersect of the types are supported");const e=n[0];return Xie.isA(e)?qie(n):Yie.isA(e)?Kie(n):e},"intersect$2");var Qie=Zie;const qv=_t,Jie=hp,tC=Tt,ere=u(n=>n.sort((e,t)=>e-t).filter((e,t,s)=>!t||e!==s[t-1]),"sortNb"),tre=u((n,e,t)=>{const s=`${e}`,i=n.get(s);i===void 0?n.set(s,[t]):i.push(t)},"insertMapping"),nre=u((n,e)=>{const t=`${e}`;return n.get(t)},"findMapping"),sre=u(n=>{const e=Jie(n),t=tC.toPolygons(n),s=t.length,i=new Map,r=qv.create();t.forEach((h,d)=>{h.vertices.forEach(f=>{tre(i,qv.snap(r,f,e),d)})});const o=t.map(h=>{let d=[];return h.vertices.forEach(f=>{d=d.concat(nre(i,qv.snap(r,f,e)))}),{e:1,d:ere(d)}});i.clear();let a=0;const l=o.length;for(let h=0;h<l;h++){const d=o[h];if(d.e>0){const f=new Array(s);f[h]=!0;do a=0,f.forEach((p,g)=>{const m=o[g];if(m.e>0){m.e=-1;for(let v=0;v<m.d.length;v++)f[m.d[v]]=!0;a++}});while(a>0);d.indexes=f}}const c=[];for(let h=0;h<l;h++)if(o[h].indexes){const d=[];o[h].indexes.forEach((f,p)=>d.push(t[p])),c.push(tC.create(d))}return c},"scissionGeom3$1");var ire=sre;const rre=Jt,ore=Tt,are=ire,lre=u((...n)=>{if(n=rre(n),n.length===0)throw new Error("wrong number of arguments");const e=n.map(t=>ore.isA(t)?are(t):t);return e.length===1?e[0]:e},"scission");var cre=lre;const ym=Tt,ure=Vw,{Tree:nC}=Gw,hre=u((n,e)=>{if(!ure(n,e))return ym.clone(n);const t=new nC(ym.toPolygons(n)),s=new nC(ym.toPolygons(e));t.invert(),t.clipTo(s),s.clipTo(t,!0),t.addPolygons(s.allPolygons()),t.invert();const i=t.allPolygons();return ym.create(i)},"subtractGeom3Sub");var dre=hre;const fre=Jt,pre=_1,mre=dre,gre=u((...n)=>{n=fre(n);let e=n.shift();return n.forEach(t=>{e=mre(e,t)}),e=pre(e),e},"subtract$6");var fL=gre;const vre=Jt,yre=Tt,_re=hp,bre=Nw,wre=Fw,xre=fL,Are=u((...n)=>{n=vre(n);const e=n.map(i=>wre({z0:-1,z1:1},i)),t=xre(e),s=_re(t);return bre(s,yre.toPolygons(t))},"subtract$5");var Mre=Are;const Sre=Jt,Cre=up,Ere=Ot,Tre=Tt,Pre=Mre,Rre=fL,Ire=u((...n)=>{if(n=Sre(n),n.length===0)throw new Error("wrong number of arguments");if(!Cre(n))throw new Error("only subtract of the types are supported");const e=n[0];return Ere.isA(e)?Pre(n):Tre.isA(e)?Rre(n):e},"subtract$4");var Dre=Ire;const Tu=Tt,Lre=Vw,{Tree:sC}=Gw,Ore=u((n,e)=>{if(!Lre(n,e))return kre(n,e);const t=new sC(Tu.toPolygons(n)),s=new sC(Tu.toPolygons(e));t.clipTo(s,!1),s.clipTo(t),s.invert(),s.clipTo(t),s.invert();const i=t.allPolygons().concat(s.allPolygons());return Tu.create(i)},"unionSub$1"),kre=u((n,e)=>{let t=Tu.toPolygons(n);return t=t.concat(Tu.toPolygons(e)),Tu.create(t)},"unionForNonIntersecting");var pL=Ore;const Nre=Jt,Fre=_1,zre=pL,Bre=u((...n)=>{n=Nre(n);let e;for(e=1;e<n.length;e+=2)n.push(zre(n[e-1],n[e]));let t=n[e-1];return t=Fre(t),t},"union$4");var mL=Bre;const Ure=Jt,$re=Tt,Vre=hp,Gre=Nw,Hre=Fw,Wre=mL,jre=u((...n)=>{n=Ure(n);const e=n.map(i=>Hre({z0:-1,z1:1},i)),t=Wre(e),s=Vre(t);return Gre(s,$re.toPolygons(t))},"union$3");var gL=jre;const Xre=Jt,Yre=up,qre=Ot,Kre=Tt,Zre=gL,Qre=mL,Jre=u((...n)=>{if(n=Xre(n),n.length===0)throw new Error("wrong number of arguments");if(!Yre(n))throw new Error("only unions of the same type are supported");const e=n[0];return qre.isA(e)?Zre(n):Kre.isA(e)?Qre(n):e},"union$2");var Hw=Jre,lr={intersect:Qie,scission:cre,subtract:Dre,union:Hw};const iC=Yo,cl=_t,eoe=u(n=>{const e=n.edges;if(e.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");const t=e.reduce((o,a)=>cl.add(cl.create(),o,a[0]),cl.create());cl.scale(t,t,1/e.length);let s,i=0;e.forEach(o=>{if(!cl.equals(o[0],o[1])){const a=cl.squaredDistance(t,o[0]);a>i&&(s=o,i=a)}});const r=e.find(o=>cl.equals(o[1],s[0]));return iC.fromPoints(iC.create(),r[0],s[0],s[1])},"calculatePlane$1");var vL=eoe;const toe=u(n=>(n||(n=[]),{edges:n}),"create$6");var vc=toe;const noe=vc,rC=_t,soe=u((...n)=>{let e,t;return n.length===1?(e=noe(),t=n[0]):(e=n[0],t=n[1]),e.edges=t.edges.map(s=>[rC.clone(s[0]),rC.clone(s[1])]),e},"clone");var ioe=soe;const roe=_t,ooe=u((n,e)=>{const t=n.edges,s=e.edges;return t.length!==s.length?!1:t.reduce((r,o,a)=>{const l=s[a],c=roe.squaredDistance(o[0],l[0]);return r&&c<Number.EPSILON},!0)},"equals$1");var aoe=ooe;const _m=_t,loe=vc,coe=u(n=>{if(!Array.isArray(n))throw new Error("the given points must be an array");if(n.length<3)throw new Error("the given points must contain THREE or more points");const e=[];let t=n[n.length-1];return n.forEach(s=>{s.length===2&&e.push([_m.fromVec2(_m.create(),t),_m.fromVec2(_m.create(),s)]),s.length===3&&e.push([t,s]),t=s}),loe(e)},"fromPoints");var uoe=coe;const bm=_t,hoe=vc,doe=u(n=>{if(!Array.isArray(n))throw new Error("the given sides must be an array");const e=[];return n.forEach(t=>{e.push([bm.fromVec2(bm.create(),t[0]),bm.fromVec2(bm.create(),t[1])])}),hoe(e)},"fromSides");var foe=doe;const poe=u(n=>!!(n&&typeof n=="object"&&"edges"in n&&Array.isArray(n.edges)),"isA");var moe=poe;const goe=vc,voe=u((...n)=>{let e,t;return n.length===1?(e=goe(),t=n[0]):(e=n[0],t=n[1]),e.edges=t.edges.map(s=>[s[1],s[0]]),e},"reverse");var yoe=voe;const _oe=u(n=>n.edges,"toEdges");var boe=_oe;const woe=u((n,e)=>{let t,s,i,r,o,a=1;do{s=n,n=null;let l=null;for(o=0;s;){o++,i=s;let c=0;for(t=0;t<a&&(c++,i=i.nextZ,!!i);t++);let h=a;for(;c>0||h>0&&i;)c!==0&&(h===0||!i||e(s)<=e(i))?(r=s,s=s.nextZ,c--):(r=i,i=i.nextZ,h--),l?l.nextZ=r:n=r,r.prevZ=l,l=r;s=i}l.nextZ=null,a*=2}while(o>1);return n},"sortLinked$2");var xoe=woe;const Aoe=xoe;class Ww{constructor(e,t,s){this.i=e,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}u(Ww,"Node$1");const Moe=u((n,e,t,s)=>{const i=new Ww(n,e,t);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i},"insertNode$1"),Soe=u(n=>{n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)},"removeNode$2");var yL={Node:Ww,insertNode:Moe,removeNode:Soe,sortLinked:Aoe};const Coe=u((n,e,t,s,i,r,o,a)=>(i-o)*(e-a)-(n-o)*(r-a)>=0&&(n-o)*(s-a)-(t-o)*(e-a)>=0&&(t-o)*(r-a)-(i-o)*(s-a)>=0,"pointInTriangle$2"),Eoe=u((n,e,t)=>(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),"area$7");var jw={area:Eoe,pointInTriangle:Coe};const{Node:oC,insertNode:aC,removeNode:a0}=yL,{area:hi}=jw,Toe=u((n,e,t,s,i)=>{let r;if(i===Ooe(n,e,t,s)>0)for(let o=e;o<t;o+=s)r=aC(o,n[o],n[o+1],r);else for(let o=t-s;o>=e;o-=s)r=aC(o,n[o],n[o+1],r);return r&&w1(r,r.next)&&(a0(r),r=r.next),r},"linkedPolygon$2"),_L=u((n,e)=>{if(!n)return n;e||(e=n);let t=n,s;do if(s=!1,!t.steiner&&(w1(t,t.next)||hi(t.prev,t,t.next)===0)){if(a0(t),t=e=t.prev,t===t.next)break;s=!0}else t=t.next;while(s||t!==e);return e},"filterPoints$2"),Poe=u((n,e,t)=>{let s=n;do{const i=s.prev,r=s.next.next;!w1(i,r)&&bL(i,s,s.next,r)&&Wf(i,r)&&Wf(r,i)&&(e.push(i.i/t),e.push(s.i/t),e.push(r.i/t),a0(s),a0(s.next),s=n=r),s=s.next}while(s!==n);return _L(s)},"cureLocalIntersections$1"),Roe=u((n,e)=>{let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&bL(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1},"intersectsPolygon"),Wf=u((n,e)=>hi(n.prev,n,n.next)<0?hi(n,e,n.next)>=0&&hi(n,n.prev,e)>=0:hi(n,e,n.prev)<0||hi(n,n.next,e)<0,"locallyInside$1"),Ioe=u((n,e)=>{let t=n,s=!1;const i=(n.x+e.x)/2,r=(n.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&i<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(s=!s),t=t.next;while(t!==n);return s},"middleInside"),Doe=u((n,e)=>{const t=new oC(n.i,n.x,n.y),s=new oC(e.i,e.x,e.y),i=n.next,r=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,s.next=t,t.prev=s,r.next=s,s.prev=r,s},"splitPolygon$2"),Loe=u((n,e)=>n.next.i!==e.i&&n.prev.i!==e.i&&!Roe(n,e)&&(Wf(n,e)&&Wf(e,n)&&Ioe(n,e)&&(hi(n.prev,n,e.prev)||hi(n,e.prev,e))||w1(n,e)&&hi(n.prev,n,n.next)>0&&hi(e.prev,e,e.next)>0),"isValidDiagonal$1"),bL=u((n,e,t,s)=>{const i=Math.sign(hi(n,e,t)),r=Math.sign(hi(n,e,s)),o=Math.sign(hi(t,s,n)),a=Math.sign(hi(t,s,e));return!!(i!==r&&o!==a||i===0&&wm(n,t,e)||r===0&&wm(n,s,e)||o===0&&wm(t,n,s)||a===0&&wm(t,e,s))},"intersects"),wm=u((n,e,t)=>e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y),"onSegment"),Ooe=u((n,e,t,s)=>{let i=0;for(let r=e,o=t-s;r<t;r+=s)i+=(n[o]-n[r])*(n[r+1]+n[o+1]),o=r;return i},"signedArea"),w1=u((n,e)=>n.x===e.x&&n.y===e.y,"equals");var wL={cureLocalIntersections:Poe,filterPoints:_L,isValidDiagonal:Loe,linkedPolygon:Toe,locallyInside:Wf,splitPolygon:Doe};const{filterPoints:$_,linkedPolygon:koe,locallyInside:Noe,splitPolygon:Foe}=wL,{area:lC,pointInTriangle:zoe}=jw,Boe=u((n,e,t,s)=>{const i=[];for(let r=0,o=e.length;r<o;r++){const a=e[r]*s,l=r<o-1?e[r+1]*s:n.length,c=koe(n,a,l,s,!1);c===c.next&&(c.steiner=!0),i.push(Goe(c))}i.sort((r,o)=>r.x-o.x);for(let r=0;r<i.length;r++)t=Uoe(i[r],t),t=$_(t,t.next);return t},"eliminateHoles$1"),Uoe=u((n,e)=>{const t=$oe(n,e);if(!t)return e;const s=Foe(t,n),i=$_(t,t.next);return $_(s,s.next),e===t?i:e},"eliminateHole"),$oe=u((n,e)=>{let t=e;const s=n.x,i=n.y;let r=-1/0,o;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const d=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=s&&d>r){if(r=d,d===s){if(i===t.y)return t;if(i===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(s===r)return o;const a=o,l=o.x,c=o.y;let h=1/0;t=o;do{if(s>=t.x&&t.x>=l&&s!==t.x&&zoe(i<c?s:r,i,l,c,i<c?r:s,i,t.x,t.y)){const d=Math.abs(i-t.y)/(s-t.x);Noe(t,n)&&(d<h||d===h&&(t.x>o.x||t.x===o.x&&Voe(o,t)))&&(o=t,h=d)}t=t.next}while(t!==a);return o},"findHoleBridge"),Voe=u((n,e)=>lC(n.prev,n,e.prev)<0&&lC(e.next,n,n.next)<0,"sectorContainsSector"),Goe=u(n=>{let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t},"getLeftmost");var Hoe=Boe;const Woe=Hoe,{removeNode:joe,sortLinked:Xoe}=yL,{cureLocalIntersections:Yoe,filterPoints:l0,isValidDiagonal:qoe,linkedPolygon:Koe,splitPolygon:Zoe}=wL,{area:Fl,pointInTriangle:Zd}=jw,Qoe=u((n,e,t=2)=>{const s=e&&e.length,i=s?e[0]*t:n.length;let r=Koe(n,0,i,t,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,d;if(s&&(r=Woe(n,e,r,t)),n.length>80*t){a=c=n[0],l=h=n[1];for(let f=t;f<i;f+=t){const p=n[f],g=n[f+1];p<a&&(a=p),g<l&&(l=g),p>c&&(c=p),g>h&&(h=g)}d=Math.max(c-a,h-l),d=d!==0?1/d:0}return jf(r,o,t,a,l,d),o},"triangulate"),jf=u((n,e,t,s,i,r,o)=>{if(!n)return;!o&&r&&nae(n,s,i,r);let a=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,r?eae(n,s,i,r):Joe(n)){e.push(l.i/t),e.push(n.i/t),e.push(c.i/t),joe(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=Yoe(l0(n),e,t),jf(n,e,t,s,i,r,2)):o===2&&tae(n,e,t,s,i,r):jf(l0(n),e,t,s,i,r,1);break}}},"earcutLinked"),Joe=u(n=>{const e=n.prev,t=n,s=n.next;if(Fl(e,t,s)>=0)return!1;let i=n.next.next;for(;i!==n.prev;){if(Zd(e.x,e.y,t.x,t.y,s.x,s.y,i.x,i.y)&&Fl(i.prev,i,i.next)>=0)return!1;i=i.next}return!0},"isEar"),eae=u((n,e,t,s)=>{const i=n.prev,r=n,o=n.next;if(Fl(i,r,o)>=0)return!1;const a=i.x<r.x?i.x<o.x?i.x:o.x:r.x<o.x?r.x:o.x,l=i.y<r.y?i.y<o.y?i.y:o.y:r.y<o.y?r.y:o.y,c=i.x>r.x?i.x>o.x?i.x:o.x:r.x>o.x?r.x:o.x,h=i.y>r.y?i.y>o.y?i.y:o.y:r.y>o.y?r.y:o.y,d=V_(a,l,e,t,s),f=V_(c,h,e,t,s);let p=n.prevZ,g=n.nextZ;for(;p&&p.z>=d&&g&&g.z<=f;){if(p!==n.prev&&p!==n.next&&Zd(i.x,i.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Fl(p.prev,p,p.next)>=0||(p=p.prevZ,g!==n.prev&&g!==n.next&&Zd(i.x,i.y,r.x,r.y,o.x,o.y,g.x,g.y)&&Fl(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;p&&p.z>=d;){if(p!==n.prev&&p!==n.next&&Zd(i.x,i.y,r.x,r.y,o.x,o.y,p.x,p.y)&&Fl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=f;){if(g!==n.prev&&g!==n.next&&Zd(i.x,i.y,r.x,r.y,o.x,o.y,g.x,g.y)&&Fl(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0},"isEarHashed"),tae=u((n,e,t,s,i,r)=>{let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&qoe(o,a)){let l=Zoe(o,a);o=l0(o,o.next),l=l0(l,l.next),jf(o,e,t,s,i,r),jf(l,e,t,s,i,r);return}a=a.next}o=o.next}while(o!==n)},"splitEarcut"),nae=u((n,e,t,s)=>{let i=n;do i.z===null&&(i.z=V_(i.x,i.y,e,t,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,Xoe(i,r=>r.z)},"indexCurve"),V_=u((n,e,t,s,i)=>(n=32767*(n-t)*i,e=32767*(e-s)*i,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1),"zOrder");var sae=Qoe;const{area:iae}=$w,{toOutlines:rae}=Ot,{arePointsInside:oae}=eL,aae=u(n=>{const e=rae(n),t=[],s=[];e.forEach((o,a)=>{const l=iae(o);l<0?s.push(a):l>0&&t.push(a)});const i=[],r=[];return t.forEach((o,a)=>{const l=e[o];i[a]=[],s.forEach((c,h)=>{const d=e[c];oae([d[0]],{vertices:l})&&(i[a].push(c),r[h]||(r[h]=[]),r[h].push(a))})}),s.forEach((o,a)=>{if(r[a]&&r[a].length>1){const l=lae(r[a],c=>i[c].length);r[a].forEach((c,h)=>{h!==l&&(i[c]=i[c].filter(d=>d!==o))})}}),i.map((o,a)=>({solid:e[t[a]],holes:o.map(l=>e[l])}))},"assignHoles$1"),lae=u((n,e)=>{let t,s;return n.forEach((i,r)=>{const o=e(i);(s===void 0||o<s)&&(t=r,s=o)}),t},"minIndex");var cae=aae;const uae=Ot,cC=Yo,hae=wt,xs=_t,dae=vL,fae=cae;class xL{constructor(e){this.plane=dae(e);const t=xs.orthogonal(xs.create(),this.plane),s=xs.cross(xs.create(),this.plane,t);this.v=xs.normalize(s,s),this.u=xs.cross(xs.create(),this.v,this.plane),this.basisMap=new Map;const i=e.edges.map(o=>o.map(a=>this.to2D(a))),r=uae.create(i);this.roots=fae(r)}to2D(e){const t=hae.fromValues(xs.dot(e,this.u),xs.dot(e,this.v));return this.basisMap.set(t,e),t}to3D(e){const t=this.basisMap.get(e);if(t)return t;{console.log("Warning: point not in original slice");const s=xs.scale(xs.create(),this.u,e[0]),i=xs.scale(xs.create(),this.v,e[1]),r=xs.scale(xs.create(),cC,cC[3]),o=xs.add(s,s,r);return xs.add(i,i,o)}}}u(xL,"PolygonHierarchy$1");var pae=xL;const mae=tn,gae=sae,vae=pae,yae=u(n=>{const e=new vae(n),t=[];return e.roots.forEach(({solid:s,holes:i})=>{let r=s.length;const o=[];i.forEach((d,f)=>{o.push(r),r+=d.length});const a=[s,...i].flat(),l=a.flat(),c=u(d=>e.to3D(a[d]),"getVertex"),h=gae(l,o);for(let d=0;d<h.length;d+=3){const f=h.slice(d,d+3).map(c);t.push(mae.fromPointsAndPlane(f,e.plane))}}),t},"toPolygons");var _ae=yae;const uC=_t,bae=u(n=>n.reduce((e,t)=>e+=`[${uC.toString(t[0])}, ${uC.toString(t[1])}], `,""),"edgesToString"),wae=u(n=>`[${bae(n.edges)}]`,"toString");var xae=wae;const xm=_t,Aae=vc,Mae=u((n,e)=>{const t=e.edges.map(s=>[xm.transform(xm.create(),s[0],n),xm.transform(xm.create(),s[1],n)]);return Aae(t)},"transform$1");var Sae=Mae,xh={calculatePlane:vL,clone:ioe,create:vc,equals:aoe,fromPoints:uoe,fromSides:foe,isA:moe,reverse:yoe,toEdges:boe,toPolygons:_ae,toString:xae,transform:Sae};const hC=_t,Cae=vc,Eae=u(n=>{if(!n.edges)return n;let e=n.edges;const t=new Map,s=new Map;e=e.filter(o=>!hC.equals(o[0],o[1])),e.forEach(o=>{const a=o[0].toString(),l=o[1].toString();t.set(a,o[0]),t.set(l,o[1]),s.set(a,(s.get(a)||0)+1),s.set(l,(s.get(l)||0)-1)});const i=[],r=[];return s.forEach((o,a)=>{o<0&&i.push(a),o>0&&r.push(a)}),i.forEach(o=>{const a=t.get(o);let l=1/0,c;r.forEach(h=>{const d=t.get(h),f=hC.distance(a,d);f<l&&(l=f,c=d)}),console.warn(`slice.repair: repairing vertex gap ${a} to ${c} distance ${l}`),e=e.map(h=>h[0].toString()===o?[c,h[1]]:h[1].toString()===o?[h[0],c]:h)}),Cae(e)},"repair");var Tae=Eae;const{EPS:dC}=dt,Uc=_t,Am=tn,fC=xh,G_=u((n,e)=>n===e?n:n<e?G_(e,n):e===1?1:e===0?n:G_(e,n%e),"gcd"),Pae=u((n,e)=>n*e/G_(n,e),"lcm"),pC=u((n,e)=>{const t=n/e.length;if(t===1)return e;const s=Uc.fromValues(t,t,t),i=[];return e.forEach(r=>{const o=Uc.subtract(Uc.create(),r[1],r[0]);Uc.divide(o,o,s);let a=r[0];for(let l=1;l<=t;++l){const c=Uc.add(Uc.create(),a,o);i.push([a,c]),a=c}}),i},"repartitionEdges"),mC=dC*dC/2*Math.sin(Math.PI/3),Rae=u((n,e)=>{let t=fC.toEdges(n),s=fC.toEdges(e);if(t.length!==s.length){const r=Pae(t.length,s.length);r!==t.length&&(t=pC(r,t)),r!==s.length&&(s=pC(r,s))}const i=[];return t.forEach((r,o)=>{const a=s[o],l=Am.create([r[0],r[1],a[1]]),c=Am.measureArea(l);Number.isFinite(c)&&c>mC&&i.push(l);const h=Am.create([r[0],a[1],a[0]]),d=Am.measureArea(h);Number.isFinite(d)&&d>mC&&i.push(h)}),i},"extrudeWalls$1");var Iae=Rae;const gC=hn,vC=Ot,Dae=Tt,H_=tn,Pa=xh,Lae=Tae,yC=Iae,Oae=u((n,e,t)=>{let s=null;return vC.isA(t)&&(s=Pa.fromSides(vC.toSides(t))),H_.isA(t)&&(s=Pa.fromPoints(H_.toPoints(t))),n===0||n===1?Pa.transform(gC.fromTranslation(gC.create(),[0,0,n]),s):null},"defaultCallback"),kae=u((n,e)=>{const t={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:Oae},{numberOfSlices:s,capStart:i,capEnd:r,close:o,repair:a,callback:l}=Object.assign({},t,n);if(s<2)throw new Error("numberOfSlices must be 2 or more");a&&(e=Lae(e));const c=s-1;let h=null,d=null,f=null,p=[];for(let g=0;g<s;g++){const m=l(g/c,g,e);if(m){if(!Pa.isA(m))throw new Error("the callback function must return slice objects");if(Pa.toEdges(m).length===0)throw new Error("the callback function must return slices with one or more edges");f&&(p=p.concat(yC(f,m))),g===0&&(h=m),g===s-1&&(d=m),f=m}}if(r){const g=Pa.toPolygons(d);p=p.concat(g)}if(i){const g=Pa.toPolygons(h).map(H_.invert);p=p.concat(g)}return!i&&!r&&o&&!Pa.equals(d,h)&&(p=p.concat(yC(d,h))),Dae.create(p)},"extrudeFromSlices$3");var x1=kae;const sd=hn,Kv=_t,Nae=Ot,Zv=xh,Fae=x1,zae=u((n,e)=>{const t={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0};let{offset:s,twistAngle:i,twistSteps:r,repair:o}=Object.assign({},t,n);if(r<1)throw new Error("twistSteps must be 1 or more");i===0&&(r=1);const a=Kv.clone(s),l=Nae.toSides(e);if(l.length===0)throw new Error("the given geometry cannot be empty");const c=Zv.fromSides(l);a[2]<0&&Zv.reverse(c,c);const h=sd.create(),d=u((f,p,g)=>{const m=p/r*i,v=Kv.scale(Kv.create(),a,p/r);return sd.multiply(h,sd.fromZRotation(h,m),sd.fromTranslation(sd.create(),v)),Zv.transform(h,g)},"createTwist");return n={numberOfSlices:r+1,capStart:!0,capEnd:!0,repair:o,callback:d},Fae(n,c)},"extrudeGeom2");var A1=zae;const Bae=Ot,Uae=qn,$ae=A1,Vae=u((n,e)=>{if(!e.isClosed)throw new Error("extruded path must be closed");const t=Uae.toPoints(e),s=Bae.fromPoints(t);return $ae(n,s)},"extrudePath2");var Gae=Vae;const Hae=Jt,Wae=Ot,jae=qn,Xae=A1,Yae=Gae,qae=u((n,...e)=>{const t={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:s,twistAngle:i,twistSteps:r,repair:o}=Object.assign({},t,n);if(e=Hae(e),e.length===0)throw new Error("wrong number of arguments");n={offset:[0,0,s],twistAngle:i,twistSteps:r,repair:o};const a=e.map(l=>jae.isA(l)?Yae(n,l):Wae.isA(l)?Xae(n,l):l);return a.length===1?a[0]:a},"extrudeLinear");var Kae=qae;const{EPS:Zae,TAU:Qae}=dt,_C=lL,id=cL,Sn=wt,Jae=g1,ele=u((n,e)=>{const t={delta:1,corners:"edge",closed:!1,segments:16};let{delta:s,corners:i,closed:r,segments:o}=Object.assign({},t,n);if(Math.abs(s)<Zae)return e;let a=n.closed?Jae(e):1;a===0&&(a=1);const l=a>0&&s>=0||a<0&&s<0;s=Math.abs(s);let c=null,h=[];const d=[],f=Sn.create(),p=e.length;for(let g=0;g<p;g++){const m=(g+1)%p,v=e[g],y=e[m];l?Sn.subtract(f,v,y):Sn.subtract(f,y,v),Sn.normal(f,f),Sn.normalize(f,f),Sn.scale(f,f,s);const b=Sn.add(Sn.create(),v,f),_=Sn.add(Sn.create(),y,f),w=[b,_];if(c!=null&&(r||!r&&m!==0)){const x=_C(c[0],c[1],w[0],w[1]);x?(h.pop(),w[0]=x):d.push({c:v,s0:c,s1:w})}c=[b,_],!(m===0&&!r)&&(h.push(w[0]),h.push(w[1]))}if(r&&c!=null){const g=h[0],m=h[1],v=_C(c[0],c[1],g,m);if(v)h[0]=v,h.pop();else{const y=e[0],b=[g,m];d.push({c:y,s0:c,s1:b})}}if(i==="edge"){const g=new Map;h.forEach((y,b)=>g.set(y,b));const m=id.create(),v=id.create();d.forEach(y=>{id.fromPoints(m,y.s0[0],y.s0[1]),id.fromPoints(v,y.s1[0],y.s1[1]);const b=id.intersectPointOfLines(m,v);if(Number.isFinite(b[0])&&Number.isFinite(b[1])){const _=y.s0[1],w=g.get(_);h[w]=b,h[(w+1)%h.length]=void 0}else{const _=y.s1[0],w=g.get(_);h[w]=void 0}}),h=h.filter(y=>y!==void 0)}if(i==="round"){let g=Math.floor(o/4);const m=Sn.create();d.forEach(v=>{let y=Sn.angle(Sn.subtract(m,v.s1[0],v.c));if(y-=Sn.angle(Sn.subtract(m,v.s0[1],v.c)),l&&y<0&&(y=y+Math.PI,y<0&&(y=y+Math.PI)),!l&&y>0&&(y=y-Math.PI,y>0&&(y=y-Math.PI)),y!==0){g=Math.floor(o*(Math.abs(y)/Qae));const b=y/g,_=Sn.angle(Sn.subtract(m,v.s0[1],v.c)),w=[];for(let x=1;x<g;x++){const S=_+b*x,C=Sn.fromAngleRadians(Sn.create(),S);Sn.scale(C,C,s),Sn.add(C,C,v.c),w.push(C)}if(w.length>0){const x=v.s0[1];let S=h.findIndex(C=>Sn.equals(x,C));S=(S+1)%h.length,h.splice(S,0,...w)}}else{const b=v.s1[0],_=h.findIndex(w=>Sn.equals(b,w));h.splice(_,1)}})}return h},"offsetFromPoints$2");var AL=ele;const Mm=Ot,tle=AL,nle=u((n,e)=>{const t={delta:1,corners:"edge",segments:16},{delta:s,corners:i,segments:r}=Object.assign({},t,n);if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const l=Mm.toOutlines(e).map(c=>(n={delta:s,corners:i,closed:!0,segments:r},tle(n,c))).reduce((c,h)=>c.concat(Mm.toSides(Mm.fromPoints(h))),[]);return Mm.create(l)},"expandGeom2$1");var sle=nle;const ile=u((n,e)=>Array.isArray(n)&&n.length>=e?n.every(t=>Number.isFinite(t)):!1,"isNumberArray$c"),rle=u((n,e)=>Number.isFinite(n)&&n>e,"isGT$d"),ole=u((n,e)=>Number.isFinite(n)&&n>=e,"isGTE$a");var hs={isNumberArray:ile,isGT:rle,isGTE:ole};const{TAU:bC}=dt,Je=_t,ale=Tt,wC=tn,{sin:xC,cos:AC}=Ps,{isGTE:lle,isNumberArray:MC}=hs,cle=u(n=>{const e={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:s,segments:i,axes:r}=Object.assign({},e,n);if(!MC(t,3))throw new Error("center must be an array of X, Y and Z values");if(!MC(s,3))throw new Error("radius must be an array of X, Y and Z values");if(!s.every(g=>g>0))throw new Error("radius values must be greater than zero");if(!lle(i,4))throw new Error("segments must be four or more");const o=Je.scale(Je.create(),Je.normalize(Je.create(),r[0]),s[0]),a=Je.scale(Je.create(),Je.normalize(Je.create(),r[1]),s[1]),l=Je.scale(Je.create(),Je.normalize(Je.create(),r[2]),s[2]),c=Math.round(i/4);let h;const d=[],f=Je.create(),p=Je.create();for(let g=0;g<=i;g++){const m=bC*g/i,v=Je.add(Je.create(),Je.scale(f,o,AC(m)),Je.scale(p,a,xC(m)));if(g>0){let y,b;for(let _=0;_<=c;_++){const w=bC/4*_/c,x=AC(w),S=xC(w);if(_>0){let C=[],M;M=Je.subtract(Je.create(),Je.scale(f,h,y),Je.scale(p,l,b)),C.push(Je.add(M,M,t)),M=Je.subtract(Je.create(),Je.scale(f,v,y),Je.scale(p,l,b)),C.push(Je.add(M,M,t)),_<c&&(M=Je.subtract(Je.create(),Je.scale(f,v,x),Je.scale(p,l,S)),C.push(Je.add(M,M,t))),M=Je.subtract(Je.create(),Je.scale(f,h,x),Je.scale(p,l,S)),C.push(Je.add(M,M,t)),d.push(wC.create(C)),C=[],M=Je.add(Je.create(),Je.scale(f,h,y),Je.scale(p,l,b)),C.push(Je.add(Je.create(),t,M)),M=Je.add(M,Je.scale(f,v,y),Je.scale(p,l,b)),C.push(Je.add(Je.create(),t,M)),_<c&&(M=Je.add(M,Je.scale(f,v,x),Je.scale(p,l,S)),C.push(Je.add(Je.create(),t,M))),M=Je.add(M,Je.scale(f,h,x),Je.scale(p,l,S)),C.push(Je.add(Je.create(),t,M)),C.reverse(),d.push(wC.create(C))}y=x,b=S}}h=v}return ale.create(d)},"ellipsoid$1");var Xw=cle;const ule=Xw,{isGT:hle}=hs,dle=u(n=>{const e={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]};let{center:t,radius:s,segments:i,axes:r}=Object.assign({},e,n);if(!hle(s,0))throw new Error("radius must be greater than zero");return s=[s,s,s],ule({center:t,radius:s,segments:i,axes:r})},"sphere$2");var ML=dle;const SC=hn,fle=_t,ple=Tt,rd=tn,mle=u((n,e)=>{fle.dot(rd.plane(e),n)>0&&(e=rd.invert(e));const s=[e],i=rd.transform(SC.fromTranslation(SC.create(),n),e),r=e.vertices.length;for(let o=0;o<r;o++){const a=o<r-1?o+1:0,l=rd.create([e.vertices[o],i.vertices[o],i.vertices[a],e.vertices[a]]);s.push(l)}return s.push(rd.invert(i)),ple.create(s)},"extrudePolygon$1");var gle=mle;const{EPS:vle,TAU:Qv}=dt,CC=hn,rn=_t,yle=uL,Jv=Tt,ul=tn,_le=ML,ble=_1,ey=pL,wle=gle,xle=u((n,e,t)=>{const s=e.toString();if(n.has(s))n.get(s)[1].push(t);else{const i=[e,[t]];n.set(s,i)}},"mapPlaneToVertex"),Ale=u((n,e,t)=>{const s=e[0].toString(),i=e[1].toString(),r=s<i?`${s},${i}`:`${i},${s}`;if(n.has(r))n.get(r)[1].push(t);else{const o=[e,[t]];n.set(r,o)}},"mapPlaneToEdge"),ty=u((n,e)=>{n.findIndex(s=>s===e)<0&&n.push(e)},"addUniqueAngle"),Mle=u((n,e)=>{const t={delta:1,segments:12},{delta:s,segments:i}=Object.assign({},t,n);let r=Jv.create();const o=new Map,a=new Map,l=rn.create(),c=rn.create();return Jv.toPolygons(e).forEach((d,f)=>{const p=rn.scale(rn.create(),ul.plane(d),2*s),g=ul.transform(CC.fromTranslation(CC.create(),rn.scale(rn.create(),p,-.5)),d),m=wle(p,g);r=ey(r,m);const v=d.vertices;for(let y=0;y<v.length;y++){xle(o,v[y],ul.plane(d));const b=(y+1)%v.length,_=[v[y],v[b]];Ale(a,_,ul.plane(d))}}),a.forEach(d=>{const f=d[0],p=d[1],g=f[0],m=f[1],v=rn.subtract(rn.create(),m,g);rn.normalize(v,v);const y=p[0],b=rn.cross(rn.create(),y,v);let _=[];for(let k=0;k<i;k++)ty(_,k*Qv/i);for(let k=0,T=p.length;k<T;k++){const N=p[k],E=rn.dot(b,N),z=rn.dot(y,N);let H=Math.atan2(E,z);H<0&&(H+=Qv),ty(_,H),H=Math.atan2(-E,-z),H<0&&(H+=Qv),ty(_,H)}_=_.sort(yle);const w=_.length;let x,S;const C=[],M=[],R=[];for(let k=-1;k<w;k++){const T=_[k<0?k+w:k],N=Math.sin(T),E=Math.cos(T);rn.scale(l,y,E*s),rn.scale(c,b,N*s),rn.add(l,l,c);const z=rn.add(rn.create(),g,l),H=rn.add(rn.create(),m,l);let q=!1;if(k>=0&&rn.distance(z,x)<vle&&(q=!0),!q){if(k>=0){C.push(z),M.push(H);const ne=[S,H,z,x],W=ul.create(ne);R.push(W)}x=z,S=H}}M.reverse(),R.push(ul.create(C)),R.push(ul.create(M));const D=Jv.create(R);r=ey(r,D)}),o.forEach(d=>{const f=d[0],p=d[1],g=p[0];let m=null,v=0;for(let w=1;w<p.length;w++){const x=p[w],S=rn.cross(l,g,x),C=rn.length(S);C>.05&&C>v&&(v=C,m=x)}m||(m=rn.orthogonal(l,g));const y=rn.cross(l,g,m);rn.normalize(y,y);const b=rn.cross(c,y,g),_=_le({center:[f[0],f[1],f[2]],radius:s,segments:i,axes:[g,y,b]});r=ey(r,_)}),ble(r)},"expandShell$1");var Sle=Mle;const Cle=Tt,Ele=Hw,Tle=Sle,Ple=u((n,e)=>{const t={delta:1,corners:"round",segments:12},{delta:s,corners:i,segments:r}=Object.assign({},t,n);if(i!=="round")throw new Error('corners must be "round" for 3D geometries');if(Cle.toPolygons(e).length===0)throw new Error("the given geometry cannot be empty");n={delta:s,corners:i,segments:r};const a=Tle(n,e);return Ele(e,a)},"expandGeom3$1");var Rle=Ple;const Ile=g1,ri=wt,hu=Ot,Qd=qn,EC=AL,Dle=u(n=>{let{external:e,internal:t}=n;Ile(e)<0?e=e.reverse():t=t.reverse();const s=Qd.fromPoints({closed:!0},e),i=Qd.fromPoints({closed:!0},t),r=hu.toSides(hu.fromPoints(Qd.toPoints(s))),o=hu.toSides(hu.fromPoints(Qd.toPoints(i)));return r.push(...o),hu.create(r)},"createGeometryFromClosedOffsets"),Lle=u((n,e,t,s)=>{const{points:i,external:r,internal:o}=n,a=Math.floor(e/2),l=[],c=[];if(t==="round"&&a>0){const d=Math.PI/a,f=i[i.length-1],p=ri.angle(ri.subtract(ri.create(),r[r.length-1],f)),g=i[0],m=ri.angle(ri.subtract(ri.create(),o[0],g));for(let v=1;v<a;v++){let y=p+d*v,b=ri.fromAngleRadians(ri.create(),y);ri.scale(b,b,s),ri.add(b,b,f),l.push(b),y=m+d*v,b=ri.fromAngleRadians(ri.create(),y),ri.scale(b,b,s),ri.add(b,b,g),c.push(b)}}const h=[];return h.push(...r,...l,...o.reverse(),...c),hu.fromPoints(h)},"createGeometryFromExpandedOpenPath"),Ole=u((n,e)=>{n=Object.assign({},{delta:1,corners:"edge",segments:16},n);const{delta:s,corners:i,segments:r}=n;if(s<=0)throw new Error("the given delta must be positive for paths");if(!(i==="edge"||i==="chamfer"||i==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const o=e.isClosed,a=Qd.toPoints(e);if(a.length===0)throw new Error("the given geometry cannot be empty");const l={points:a,external:EC({delta:s,corners:i,segments:r,closed:o},a),internal:EC({delta:-s,corners:i,segments:r,closed:o},a)};return e.isClosed?Dle(l):Lle(l,r,i,s)},"expandPath2$1");var kle=Ole;const Nle=Jt,Fle=Ot,zle=Tt,Ble=qn,Ule=sle,$le=Rle,Vle=kle,Gle=u((n,...e)=>{if(e=Nle(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(s=>Ble.isA(s)?Vle(n,s):Fle.isA(s)?Ule(n,s):zle.isA(s)?$le(n,s):s);return t.length===1?t[0]:t},"expand$2");var SL=Gle;const Hle=qn,Wle=SL,jle=A1,Xle=u((n,e)=>{const t={size:1,height:1},{size:s,height:i}=Object.assign({},t,n);if(n.delta=s,n.offset=[0,0,i],Hle.toPoints(e).length===0)throw new Error("the given geometry cannot be empty");const o=Wle(n,e);return jle(n,o)},"extrudeRectangularPath2$1");var Yle=Xle;const{area:qle}=$w,ny=Ot,Kle=qn,Zle=SL,Qle=A1,Jle=u((n,e)=>{const t={size:1,height:1},{size:s,height:i}=Object.assign({},t,n);n.delta=s,n.offset=[0,0,i];const r=ny.toOutlines(e);if(r.length===0)throw new Error("the given geometry cannot be empty");const a=r.map(c=>(qle(c)<0&&c.reverse(),Zle(n,Kle.fromPoints({closed:!0},c)))).reduce((c,h)=>c.concat(ny.toSides(h)),[]),l=ny.create(a);return Qle(n,l)},"extrudeRectangularGeom2$1");var ece=Jle;const tce=Jt,nce=Ot,sce=qn,ice=Yle,rce=ece,oce=u((n,...e)=>{const t={size:1,height:1},{size:s,height:i}=Object.assign({},t,n);if(e=tce(e),e.length===0)throw new Error("wrong number of arguments");if(s<=0)throw new Error("size must be positive");if(i<=0)throw new Error("height must be positive");const r=e.map(o=>sce.isA(o)?ice(n,o):nce.isA(o)?rce(n,o):o);return r.length===1?r[0]:r},"extrudeRectangular");var ace=oce;const lce=Jt,TC=hn,PC=Yo,RC=Ot,IC=Tt,DC=qn,M1=u((n,...e)=>{const t={origin:[0,0,0],normal:[0,0,1]},{origin:s,normal:i}=Object.assign({},t,n);if(e=lce(e),e.length===0)throw new Error("wrong number of arguments");const r=PC.fromNormalAndPoint(PC.create(),i,s);if(Number.isNaN(r[0]))throw new Error("the given origin and normal do not define a proper plane");const o=TC.mirrorByPlane(TC.create(),r),a=e.map(l=>DC.isA(l)?DC.transform(o,l):RC.isA(l)?RC.transform(o,l):IC.isA(l)?IC.transform(o,l):l);return a.length===1?a[0]:a},"mirror"),cce=u((...n)=>M1({normal:[1,0,0]},n),"mirrorX$1"),uce=u((...n)=>M1({normal:[0,1,0]},n),"mirrorY"),hce=u((...n)=>M1({normal:[0,0,1]},n),"mirrorZ");var Jd={mirror:M1,mirrorX:cce,mirrorY:uce,mirrorZ:hce};const{TAU:_i}=dt,od=hn,{mirrorX:dce}=Jd,ad=Ot,sy=xh,fce=x1,pce=u((n,e)=>{const t={segments:12,startAngle:0,angle:_i,overflow:"cap"};let{segments:s,startAngle:i,angle:r,overflow:o}=Object.assign({},t,n);if(s<3)throw new Error("segments must be greater then 3");i=Math.abs(i)>_i?i%_i:i,r=Math.abs(r)>_i?r%_i:r;let a=i+r;if(a=Math.abs(a)>_i?a%_i:a,a<i){const b=i;i=a,a=b}let l=a-i;if(l<=0&&(l=_i),Math.abs(l)<_i){const b=_i/s;s=Math.floor(Math.abs(l)/b),Math.abs(l)>s*b&&s++}let c=ad.toSides(e);if(c.length===0)throw new Error("the given geometry cannot be empty");const h=c.filter(b=>b[0][0]<0),d=c.filter(b=>b[0][0]>=0);h.length>0&&d.length>0&&o==="cap"&&(h.length>d.length?(c=c.map(b=>{let _=b[0],w=b[1];return _=[Math.min(_[0],0),_[1]],w=[Math.min(w[0],0),w[1]],[_,w]}),e=ad.reverse(ad.create(c)),e=dce(e)):d.length>=h.length&&(c=c.map(b=>{let _=b[0],w=b[1];return _=[Math.max(_[0],0),_[1]],w=[Math.max(w[0],0),w[1]],[_,w]}),e=ad.create(c)));const p=l/s,g=Math.abs(l)<_i,m=sy.fromSides(ad.toSides(e));sy.reverse(m,m);const v=od.create(),y=u((b,_,w)=>{let x=p*_+i;return l===_i&&_===s&&(x=i),od.multiply(v,od.fromZRotation(v,x),od.fromXRotation(od.create(),_i/4)),sy.transform(v,w)},"createSlice");return n={numberOfSlices:s+1,capStart:g,capEnd:g,close:!g,callback:y},fce(n,m)},"extrudeRotate$1");var CL=pce;const{TAU:ld}=dt,iy=xh,Dr=hn,mce=x1,gce=Ot,vce=u((n,e)=>{const t={angle:ld,startAngle:0,pitch:10,endOffset:0,segmentsPerRotation:32},{angle:s,endOffset:i,segmentsPerRotation:r,startAngle:o}=Object.assign({},t,n);let a;if(!n.pitch&&n.height?a=n.height/(s/ld):a=n.pitch?n.pitch:t.pitch,r<3)throw new Error("The number of segments per rotation needs to be at least 3.");let c=gce.toSides(e);if(c.length===0)throw new Error("the given geometry cannot be empty");const h=c.filter(y=>y[0][0]>=0);let d=iy.fromSides(c);h.length===0&&(d=iy.reverse(d));const f=Math.round(r/ld*Math.abs(s)),p=f>=2?f:2,g=Dr.create();let m;const v=u((y,b,_)=>{const w=o+s/p*b,x=i/p*b,S=(w-o)/ld*a;return Dr.multiply(g,Dr.fromTranslation(Dr.create(),[x,0,S*Math.sign(s)]),Dr.fromXRotation(Dr.create(),-ld/4*Math.sign(s))),m=Dr.create(),Dr.multiply(m,Dr.fromZRotation(Dr.create(),w),g),iy.transform(m,_)},"sliceCallback");return mce({numberOfSlices:p+1,callback:v},d)},"extrudeHelical");var yce=vce;const _ce=Jt,LC=zw,ry=Yo,OC=hn,kC=Ot,EL=Tt,$c=tn,bce=hp,wce=gL,xce=u((n,e)=>{const t=ry.fromNormalAndPoint(ry.create(),n.axis,n.origin);if(Number.isNaN(t[0])||Number.isNaN(t[1])||Number.isNaN(t[2])||Number.isNaN(t[3]))throw new Error("project: invalid axis or origin");const s=bce(e),i=s*s*Math.sqrt(3)/4;if(s===0)return kC.create();const r=EL.toPolygons(e);let o=[];for(let l=0;l<r.length;l++){const c=r[l].vertices.map(f=>ry.projectionOfPoint(t,f)),h=$c.create(c),d=$c.plane(h);!LC(t,d)||$c.measureArea(h)<i||o.push(h)}if(!LC(t,[0,0,1])){const l=OC.fromVectorRotation(OC.create(),t,[0,0,1]);o=o.map(c=>$c.transform(l,c))}o=o.sort((l,c)=>$c.measureArea(c)-$c.measureArea(l));const a=o.map(l=>kC.fromPoints(l.vertices));return wce(a)},"projectGeom3"),Ace=u((n,...e)=>{const t={axis:[0,0,1],origin:[0,0,0]},{axis:s,origin:i}=Object.assign({},t,n);if(e=_ce(e),e.length===0)throw new Error("wrong number of arguments");n={axis:s,origin:i};const r=e.map(o=>EL.isA(o)?xce(n,o):o);return r.length===1?r[0]:r},"project");var Mce=Ace,Sm={extrudeFromSlices:x1,extrudeLinear:Kae,extrudeRectangular:ace,extrudeRotate:CL,extrudeHelical:yce,project:Mce,slice:xh};const NC=wt,Sce=u(n=>{let e=NC.fromValues(1/0,1/0);n.forEach(i=>{(i[1]<e[1]||i[1]===e[1]&&i[0]<e[0])&&(e=i)});const t=[];n.forEach(i=>{const r=Ece(i[1]-e[1],i[0]-e[0]),o=NC.squaredDistance(i,e);t.push({point:i,angle:r,distSq:o})}),t.sort((i,r)=>i.angle<r.angle?-1:i.angle>r.angle?1:i.distSq<r.distSq?-1:i.distSq>r.distSq?1:0);const s=[];return t.forEach(i=>{let r=s.length;for(;r>1&&Cce(s[r-2],s[r-1],i.point)<=Number.EPSILON;)s.pop(),r=s.length;s.push(i.point)}),s},"hullPoints2$2"),Cce=u((n,e,t)=>(e[0]-n[0])*(t[1]-n[1])-(e[1]-n[1])*(t[0]-n[0]),"ccw"),Ece=u((n,e)=>n===0&&e===0?-1/0:-e/n,"fakeAtan2");var TL=Sce;const FC=Ot,zC=Tt,BC=qn,Tce=u(n=>{const e=new Set,t=[],s=u(i=>{const r=i.toString();e.has(r)||(t.push(i),e.add(r))},"addPoint");return n.forEach(i=>{FC.isA(i)?FC.toPoints(i).forEach(s):zC.isA(i)?zC.toPoints(i).forEach(r=>r.forEach(s)):BC.isA(i)&&BC.toPoints(i).forEach(s)}),t},"toUniquePoints$3");var Yw=Tce;const Pce=Jt,Rce=qn,Ice=TL,Dce=Yw,Lce=u((...n)=>{n=Pce(n);const e=Dce(n),t=Ice(e);return Rce.fromPoints({closed:!0},t)},"hullPath2$1");var Oce=Lce;const kce=Jt,UC=Ot,Nce=TL,Fce=Yw,zce=u((...n)=>{n=kce(n);const e=Fce(n),t=Nce(e);return t.length<3?UC.create():UC.fromPoints(t)},"hullGeom2$1");var Bce=zce;const Uce=lp,$C=c1,VC=RD,$ce=u((n,e,t)=>{const s=[],i=[],r=[];$C(s,t,e),$C(i,n,e);const o=VC(Uce(r,i,s)),a=VC(s);if(a===0)throw Error("a and b are the same point");return o/a},"distanceSquared"),Vce=u((n,e,t)=>Math.sqrt($ce(n,e,t)),"pointLineDistance$1");var Gce=Vce;const Hce=lp,Wce=Pw,GC=c1,jce=u((n,e,t,s)=>{const i=[0,0,0];return GC(n,e,t),GC(i,t,s),Hce(n,n,i),Wce(n,n)},"planeNormal");var Xce=jce;class PL{constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}first(){return this.head}isEmpty(){return!this.head}}u(PL,"VertexList$1");var Yce=PL;class RL{constructor(e,t){this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null}}u(RL,"Vertex$1");var qce=RL;const Kce=MD,Zce=PD;class IL{constructor(e,t){this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?Kce(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?Zce(this.tail().point,this.head().point):-1}setOpposite(e){this.opposite=e,e.opposite=this}}u(IL,"HalfEdge$1");var Qce=IL;const oy=xD,Jce=AD,eue=lp,ay=a1,tue=SD,nue=Pw,Cm=TD,ly=c1,cy=Qce,DL=0,sue=1,W_=2;class S1{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=DL,this.edge=null,this.nVertices=0}getEdge(e){if(typeof e!="number")throw Error("requires a number");let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}computeNormal(){const e=this.edge,t=e.next;let s=t.next;const i=ly([],t.head().point,e.head().point),r=[],o=[];for(this.nVertices=2,this.normal=[0,0,0];s!==e;)Jce(o,i),ly(i,s.head().point,e.head().point),oy(this.normal,this.normal,eue(r,o,i)),s=s.next,this.nVertices+=1;this.area=tue(this.normal),this.normal=Cm(this.normal,this.normal,1/this.area)}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let t,s=0,i=this.edge;do{const h=i.lengthSquared();h>s&&(t=i,s=h),i=i.next}while(i!==this.edge);const r=t.tail().point,o=t.head().point,a=ly([],o,r),l=Math.sqrt(s);Cm(a,a,1/l);const c=ay(this.normal,a);Cm(a,a,-c),oy(this.normal,this.normal,a),nue(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do oy(this.centroid,this.centroid,e.head().point),e=e.next;while(e!==this.edge);Cm(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(e){typeof e!="undefined"?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=ay(this.normal,this.centroid)}distanceToPlane(e){return ay(this.normal,e)-this.offset}connectHalfEdges(e,t){let s;if(e.opposite.face===t.opposite.face){const i=t.opposite.face;let r;e===this.edge&&(this.edge=t),i.nVertices===3?(r=t.opposite.prev.opposite,i.mark=W_,s=i):(r=t.opposite.next,i.edge===r.prev&&(i.edge=r),r.prev=r.prev.prev,r.prev.next=r),t.prev=e.prev,t.prev.next=t,t.setOpposite(r),i.computeNormalAndCentroid()}else e.next=t,t.prev=e;return s}mergeAdjacentFaces(e,t){const s=e.opposite,i=s.face;t.push(i),i.mark=W_;let r=e.prev,o=e.next,a=s.prev,l=s.next;for(;r.opposite.face===i;)r=r.prev,l=l.next;for(;o.opposite.face===i;)o=o.next,a=a.prev;let c;for(c=l;c!==a.next;c=c.next)c.face=this;this.edge=o;let h;return h=this.connectHalfEdges(a,o),h&&t.push(h),h=this.connectHalfEdges(r,l),h&&t.push(h),this.computeNormalAndCentroid(),t}collectIndices(){const e=[];let t=this.edge;do e.push(t.head().index),t=t.next;while(t!==this.edge);return e}static createTriangle(e,t,s,i=0){const r=new S1,o=new cy(e,r),a=new cy(t,r),l=new cy(s,r);return o.next=l.prev=a,a.next=o.prev=l,l.next=a.prev=o,r.edge=o,r.computeNormalAndCentroid(i),r}}u(S1,"Face$1");var iue={VISIBLE:DL,NON_CONVEX:sue,DELETED:W_,Face:S1};const uy=a1,rue=Gce,oue=Xce,HC=Yce,aue=qce,{Face:ho,VISIBLE:Vc,NON_CONVEX:WC,DELETED:lue}=iue,cue=1,jC=2;class LL{constructor(e){if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=e.length,this.faces=[],this.newFaces=[],this.claimed=new HC,this.unclaimed=new HC,this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new aue(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}deleteFaceVertices(e,t){const s=this.removeAllVerticesFromFace(e);if(s)if(!t)this.unclaimed.addAll(s);else{let i;for(let r=s;r;r=i)i=r.next,t.distanceToPlane(r.point)>this.tolerance?this.addVertexToFace(r,t):this.unclaimed.add(r)}}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let s=t;s;s=t){t=s.next;let i=this.tolerance,r;for(let o=0;o<e.length;o+=1){const a=e[o];if(a.mark===Vc){const l=a.distanceToPlane(s.point);if(l>i&&(i=l,r=a),i>1e3*this.tolerance)break}}r&&this.addVertexToFace(s,r)}}computeExtremes(){const e=[],t=[],s=[],i=[];let r,o;for(r=0;r<3;r+=1)s[r]=i[r]=this.vertices[0];for(r=0;r<3;r+=1)e[r]=t[r]=this.vertices[0].point[r];for(r=1;r<this.vertices.length;r+=1){const a=this.vertices[r],l=a.point;for(o=0;o<3;o+=1)l[o]<e[o]&&(e[o]=l[o],s[o]=a);for(o=0;o<3;o+=1)l[o]>t[o]&&(t[o]=l[o],i[o]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e[0]),Math.abs(t[0]))+Math.max(Math.abs(e[1]),Math.abs(t[1]))+Math.max(Math.abs(e[2]),Math.abs(t[2]))),[s,i]}createInitialSimplex(){const e=this.vertices,[t,s]=this.computeExtremes();let i,r,o,a,l=0,c=0;for(o=0;o<3;o+=1){const m=s[o].point[o]-t[o].point[o];m>l&&(l=m,c=o)}const h=t[c],d=s[c];for(l=0,o=0;o<this.vertices.length;o+=1){const m=this.vertices[o];if(m!==h&&m!==d){const v=rue(m.point,h.point,d.point);v>l&&(l=v,i=m)}}const f=oue([],h.point,d.point,i.point),p=uy(h.point,f);for(l=-1,o=0;o<this.vertices.length;o+=1){const m=this.vertices[o];if(m!==h&&m!==d&&m!==i){const v=Math.abs(uy(f,m.point)-p);v>l&&(l=v,r=m)}}const g=[];if(uy(r.point,f)-p<0)for(g.push(ho.createTriangle(h,d,i),ho.createTriangle(r,d,h),ho.createTriangle(r,i,d),ho.createTriangle(r,h,i)),o=0;o<3;o+=1){const m=(o+1)%3;g[o+1].getEdge(2).setOpposite(g[0].getEdge(m)),g[o+1].getEdge(1).setOpposite(g[m+1].getEdge(0))}else for(g.push(ho.createTriangle(h,i,d),ho.createTriangle(r,h,d),ho.createTriangle(r,d,i),ho.createTriangle(r,i,h)),o=0;o<3;o+=1){const m=(o+1)%3;g[o+1].getEdge(2).setOpposite(g[0].getEdge((3-o)%3)),g[o+1].getEdge(0).setOpposite(g[m+1].getEdge(1))}for(o=0;o<4;o+=1)this.faces.push(g[o]);for(o=0;o<e.length;o+=1){const m=e[o];if(m!==h&&m!==d&&m!==i&&m!==r){l=this.tolerance;let v;for(a=0;a<4;a+=1){const y=g[a].distanceToPlane(m.point);y>l&&(l=y,v=g[a])}v&&this.addVertexToFace(m,v)}}}reindexFaceAndVertices(){const e=[];for(let t=0;t<this.faces.length;t+=1){const s=this.faces[t];s.mark===Vc&&e.push(s)}this.faces=e}collectFaces(e){const t=[];for(let s=0;s<this.faces.length;s+=1){if(this.faces[s].mark!==Vc)throw Error("attempt to include a destroyed face in the hull");const i=this.faces[s].collectIndices();if(e)t.push(i);else for(let r=0;r<i.length-2;r+=1)t.push([i[0],i[r+1],i[r+2]])}return t}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,s=0;const i=this.claimed.first().face;for(t=i.outside;t&&t.face===i;t=t.next){const r=i.distanceToPlane(t.point);r>s&&(s=r,e=t)}return e}}computeHorizon(e,t,s,i){this.deleteFaceVertices(s),s.mark=lue;let r;t?r=t.next:r=t=s.getEdge(0);do{const o=r.opposite,a=o.face;a.mark===Vc&&(a.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,o,a,i):i.push(r)),r=r.next}while(r!==t)}addAdjoiningFace(e,t){const s=ho.createTriangle(e,t.tail(),t.head());return this.faces.push(s),s.getEdge(-1).setOpposite(t.opposite),s.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let s,i;for(let r=0;r<t.length;r+=1){const o=t[r],a=this.addAdjoiningFace(e,o);s?a.next.setOpposite(i):s=a,this.newFaces.push(a.face),i=a}s.next.setOpposite(i)}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid)}doAdjacentMerge(e,t){let s=e.edge,i=!0,r=0;do{if(r>=e.nVertices)throw Error("merge recursion limit exceeded");const o=s.opposite.face;let a=!1;if(t===jC?(this.oppositeFaceDistance(s)>-this.tolerance||this.oppositeFaceDistance(s.opposite)>-this.tolerance)&&(a=!0):e.area>o.area?this.oppositeFaceDistance(s)>-this.tolerance?a=!0:this.oppositeFaceDistance(s.opposite)>-this.tolerance&&(i=!1):this.oppositeFaceDistance(s.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(s)>-this.tolerance&&(i=!1),a){const l=e.mergeAdjacentFaces(s,[]);for(let c=0;c<l.length;c+=1)this.deleteFaceVertices(l[c],e);return!0}s=s.next,r+=1}while(s!==e.edge);return i||(e.mark=WC),!1}addVertexToHull(e){const t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t);for(let s=0;s<this.newFaces.length;s+=1){const i=this.newFaces[s];if(i.mark===Vc)for(;this.doAdjacentMerge(i,cue););}for(let s=0;s<this.newFaces.length;s+=1){const i=this.newFaces[s];if(i.mark===WC)for(i.mark=Vc;this.doAdjacentMerge(i,jC););}this.resolveUnclaimedPoints(this.newFaces)}build(){let e;for(this.createInitialSimplex();e=this.nextVertexToAdd();)this.addVertexToHull(e);this.reindexFaceAndVertices()}}u(LL,"QuickHull$1");var uue=LL;const hue=uue,due=u((n,e={})=>{const t=new hue(n);return t.build(),t.collectFaces(e.skipTriangulation)},"runner");var fue=due;const pue=Jt,mue=Tt,gue=tn,vue=fue,yue=Yw,_ue=u((...n)=>{if(n=pue(n),n.length===1)return n[0];const e=yue(n),s=vue(e,{skipTriangulation:!0}).map(i=>{const r=i.map(o=>e[o]);return gue.create(r)});return mue.create(s)},"hullGeom3$1");var bue=_ue;const wue=Jt,xue=up,Aue=Ot,Mue=Tt,Sue=qn,Cue=Oce,Eue=Bce,Tue=bue,Pue=u((...n)=>{if(n=wue(n),n.length===0)throw new Error("wrong number of arguments");if(!xue(n))throw new Error("only hulls of the same type are supported");const e=n[0];return Sue.isA(e)?Cue(n):Aue.isA(e)?Eue(n):Mue.isA(e)?Tue(n):e},"hull$1");var OL=Pue;const Rue=Jt,Iue=Hw,Due=OL,Lue=u((...n)=>{if(n=Rue(n),n.length<2)throw new Error("wrong number of arguments");const e=[];for(let t=1;t<n.length;t++)e.push(Due(n[t-1],n[t]));return Iue(e)},"hullChain");var Oue=Lue,XC={hull:OL,hullChain:Oue};const kue=u((n,e,t)=>{for(n=n.slice();n.length<t;)n.push(e);return n},"padArrayToLength$1");var Nue=kue;const Fue=Jt,zue=ED,Bue=CD,Uue=v1,$ue=u((...n)=>{if(n=Fue(n),n.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");const e=Uue(n);if(n.length===1)return e;const t=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return e.reduce((s,i)=>(s=[zue(s[0],s[0],i[0]),Bue(s[1],s[1],i[1])],s),t)},"measureAggregateBoundingBox$1");var Vue=$ue;const Gue=Jt,YC=hn,qC=Ot,KC=Tt,ZC=qn,C1=u((n,...e)=>{if(!Array.isArray(n))throw new Error("offset must be an array");if(e=Gue(e),e.length===0)throw new Error("wrong number of arguments");for(n=n.slice();n.length<3;)n.push(0);const t=YC.fromTranslation(YC.create(),n),s=e.map(i=>ZC.isA(i)?ZC.transform(t,i):qC.isA(i)?qC.transform(t,i):KC.isA(i)?KC.transform(t,i):i);return s.length===1?s[0]:s},"translate$3"),Hue=u((n,...e)=>C1([n,0,0],e),"translateX"),Wue=u((n,...e)=>C1([0,n,0],e),"translateY"),jue=u((n,...e)=>C1([0,0,n],e),"translateZ");var $l={translate:C1,translateX:Hue,translateY:Wue,translateZ:jue};const Xue=Jt,QC=Nue,kL=Vue,{translate:Yue}=$l,que=u(n=>{if(!Array.isArray(n.modes)||n.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(n.modes=QC(n.modes,"none",3),n.modes.filter(e=>["center","max","min","none"].includes(e)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(n.relativeTo)||n.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(n.relativeTo=QC(n.relativeTo,0,3),n.relativeTo.filter(e=>Number.isFinite(e)||e==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof n.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return n},"validateOptions"),Kue=u((n,e,t)=>{for(let s=0;s<3;s++)n[s]==null&&(e[s]==="center"?n[s]=(t[0][s]+t[1][s])/2:e[s]==="max"?n[s]=t[1][s]:e[s]==="min"&&(n[s]=t[0][s]));return n},"populateRelativeToFromBounds"),JC=u((n,e,t)=>{const s=kL(n),i=[0,0,0];for(let r=0;r<3;r++)e[r]==="center"?i[r]=t[r]-(s[0][r]+s[1][r])/2:e[r]==="max"?i[r]=t[r]-s[1][r]:e[r]==="min"&&(i[r]=t[r]-s[0][r]);return Yue(i,n)},"alignGeometries"),Zue=u((n,...e)=>{n=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},n),n=que(n);let{modes:s,relativeTo:i,grouped:r}=n;if(e=Xue(e),e.length===0)throw new Error("align(): No geometries were provided to act upon");if(i.filter(o=>o==null).length){const o=kL(e);i=Kue(i,s,o)}return r?e=JC(e,s,i):e=e.map(o=>JC(o,s,i)),e.length===1?e[0]:e},"align");var Que=Zue;const Jue=Jt,ehe=Ot,the=Tt,nhe=qn,she=v1,{translate:ihe}=$l,hy=u((n,e)=>{const t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:s,relativeTo:i}=Object.assign({},t,n),r=she(e),o=[0,0,0];return s[0]&&(o[0]=i[0]-(r[0][0]+(r[1][0]-r[0][0])/2)),s[1]&&(o[1]=i[1]-(r[0][1]+(r[1][1]-r[0][1])/2)),s[2]&&(o[2]=i[2]-(r[0][2]+(r[1][2]-r[0][2])/2)),ihe(o,e)},"centerGeometry"),E1=u((n,...e)=>{const t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:s,relativeTo:i}=Object.assign({},t,n);if(e=Jue(e),e.length===0)throw new Error("wrong number of arguments");if(i.length!==3)throw new Error("relativeTo must be an array of length 3");n={axes:s,relativeTo:i};const r=e.map(o=>nhe.isA(o)||ehe.isA(o)||the.isA(o)?hy(n,o):o);return r.length===1?r[0]:r},"center"),rhe=u((...n)=>E1({axes:[!0,!1,!1]},n),"centerX"),ohe=u((...n)=>E1({axes:[!1,!0,!1]},n),"centerY"),ahe=u((...n)=>E1({axes:[!1,!1,!0]},n),"centerZ");var Em={center:E1,centerX:rhe,centerY:ohe,centerZ:ahe};const lhe=Jt,e3=hn,t3=Ot,n3=Tt,s3=qn,T1=u((n,...e)=>{if(!Array.isArray(n))throw new Error("angles must be an array");if(e=lhe(e),e.length===0)throw new Error("wrong number of arguments");for(n=n.slice();n.length<3;)n.push(0);const t=n[2],s=n[1],i=n[0],r=e3.fromTaitBryanRotation(e3.create(),t,s,i),o=e.map(a=>s3.isA(a)?s3.transform(r,a):t3.isA(a)?t3.transform(r,a):n3.isA(a)?n3.transform(r,a):a);return o.length===1?o[0]:o},"rotate$1"),che=u((n,...e)=>T1([n,0,0],e),"rotateX"),uhe=u((n,...e)=>T1([0,n,0],e),"rotateY"),hhe=u((n,...e)=>T1([0,0,n],e),"rotateZ");var ef={rotate:T1,rotateX:che,rotateY:uhe,rotateZ:hhe};const dhe=Jt,i3=hn,r3=Ot,o3=Tt,a3=qn,P1=u((n,...e)=>{if(!Array.isArray(n))throw new Error("factors must be an array");if(e=dhe(e),e.length===0)throw new Error("wrong number of arguments");for(n=n.slice();n.length<3;)n.push(1);if(n[0]<=0||n[1]<=0||n[2]<=0)throw new Error("factors must be positive");const t=i3.fromScaling(i3.create(),n),s=e.map(i=>a3.isA(i)?a3.transform(t,i):r3.isA(i)?r3.transform(t,i):o3.isA(i)?o3.transform(t,i):i);return s.length===1?s[0]:s},"scale"),fhe=u((n,...e)=>P1([n,1,1],e),"scaleX"),phe=u((n,...e)=>P1([1,n,1],e),"scaleY"),mhe=u((n,...e)=>P1([1,1,n],e),"scaleZ");var Tm={scale:P1,scaleX:fhe,scaleY:phe,scaleZ:mhe};const ghe=Jt,l3=Ot,c3=Tt,u3=qn,vhe=u((n,...e)=>{if(e=ghe(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(s=>u3.isA(s)?u3.transform(n,s):l3.isA(s)?l3.transform(n,s):c3.isA(s)?c3.transform(n,s):s);return t.length===1?t[0]:t},"transform");var yhe=vhe,dy={align:Que,center:Em.center,centerX:Em.centerX,centerY:Em.centerY,centerZ:Em.centerZ,mirror:Jd.mirror,mirrorX:Jd.mirrorX,mirrorY:Jd.mirrorY,mirrorZ:Jd.mirrorZ,rotate:ef.rotate,rotateX:ef.rotateX,rotateY:ef.rotateY,rotateZ:ef.rotateZ,scale:Tm.scale,scaleX:Tm.scaleX,scaleY:Tm.scaleY,scaleZ:Tm.scaleZ,transform:yhe,translate:$l.translate,translateX:$l.translateX,translateY:$l.translateY,translateZ:$l.translateZ};const{EPS:h3,TAU:Gc}=dt,fo=wt,_he=qn,{isGT:bhe,isGTE:fy,isNumberArray:whe}=hs,xhe=u(n=>{const e={center:[0,0],radius:1,startAngle:0,endAngle:Gc,makeTangent:!1,segments:32};let{center:t,radius:s,startAngle:i,endAngle:r,makeTangent:o,segments:a}=Object.assign({},e,n);if(!whe(t,2))throw new Error("center must be an array of X and Y values");if(!bhe(s,0))throw new Error("radius must be greater than zero");if(!fy(i,0))throw new Error("startAngle must be positive");if(!fy(r,0))throw new Error("endAngle must be positive");if(!fy(a,4))throw new Error("segments must be four or more");i=i%Gc,r=r%Gc;let l=Gc;i<r&&(l=r-i),i>r&&(l=r+(Gc-i));const c=Math.acos((s*s+s*s-h3*h3)/(2*s*s)),h=fo.clone(t);let d;const f=[];if(l<c)d=fo.fromAngleRadians(fo.create(),i),fo.scale(d,d,s),fo.add(d,d,h),f.push(d);else{const p=Math.max(1,Math.floor(a*(l/Gc)))+1;let g=p*.5/l;g>.25&&(g=.25);const m=o?p+2:p;for(let v=0;v<=m;v++){let y=v;o&&(y=(v-1)*(p-2*g)/p+g,y<0&&(y=0),y>p&&(y=p));const b=i+y*(l/p);d=fo.fromAngleRadians(fo.create(),b),fo.scale(d,d,s),fo.add(d,d,h),f.push(d)}}return _he.fromPoints({closed:!1},f)},"arc");var Ahe=xhe;const{EPS:d3,TAU:da}=dt,py=wt,Mhe=Ot,{sin:She,cos:Che}=Ps,{isGTE:my,isNumberArray:f3}=hs,Ehe=u(n=>{const e={center:[0,0],radius:[1,1],startAngle:0,endAngle:da,segments:32};let{center:t,radius:s,startAngle:i,endAngle:r,segments:o}=Object.assign({},e,n);if(!f3(t,2))throw new Error("center must be an array of X and Y values");if(!f3(s,2))throw new Error("radius must be an array of X and Y values");if(!s.every(p=>p>0))throw new Error("radius values must be greater than zero");if(!my(i,0))throw new Error("startAngle must be positive");if(!my(r,0))throw new Error("endAngle must be positive");if(!my(o,3))throw new Error("segments must be three or more");i=i%da,r=r%da;let a=da;i<r&&(a=r-i),i>r&&(a=r+(da-i));const l=Math.min(s[0],s[1]),c=Math.acos((l*l+l*l-d3*d3)/(2*l*l));if(a<c)throw new Error("startAngle and endAngle do not define a significant rotation");o=Math.floor(o*(a/da));const h=py.clone(t),d=a/o,f=[];o=a<da?o+1:o;for(let p=0;p<o;p++){const g=d*p+i,m=py.fromValues(s[0]*Che(g),s[1]*She(g));py.add(m,h,m),f.push(m)}return a<da&&f.push(h),Mhe.fromPoints(f)},"ellipse$1");var NL=Ehe;const{TAU:The}=dt,Phe=NL,{isGT:Rhe}=hs,Ihe=u(n=>{const e={center:[0,0],radius:1,startAngle:0,endAngle:The,segments:32};let{center:t,radius:s,startAngle:i,endAngle:r,segments:o}=Object.assign({},e,n);if(!Rhe(s,0))throw new Error("radius must be greater than zero");return s=[s,s],Phe({center:t,radius:s,startAngle:i,endAngle:r,segments:o})},"circle$1");var FL=Ihe;const Dhe=Tt,Lhe=tn,{isNumberArray:p3}=hs,Ohe=u(n=>{const e={center:[0,0,0],size:[2,2,2]},{center:t,size:s}=Object.assign({},e,n);if(!p3(t,3))throw new Error("center must be an array of X, Y and Z values");if(!p3(s,3))throw new Error("size must be an array of width, depth and height values");if(!s.every(r=>r>0))throw new Error("size values must be greater than zero");return Dhe.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(r=>{const o=r[0].map(a=>[t[0]+s[0]/2*(2*!!(a&1)-1),t[1]+s[1]/2*(2*!!(a&2)-1),t[2]+s[2]/2*(2*!!(a&4)-1)]);return Lhe.create(o)}))},"cuboid$1");var zL=Ohe;const khe=zL,{isGT:Nhe}=hs,Fhe=u(n=>{const e={center:[0,0,0],size:2};let{center:t,size:s}=Object.assign({},e,n);if(!Nhe(s,0))throw new Error("size must be greater than zero");return s=[s,s,s],khe({center:t,size:s})},"cube");var zhe=Fhe;const{EPS:m3,TAU:fa}=dt,ps=_t,Bhe=Tt,Uhe=tn,{sin:$he,cos:Vhe}=Ps,{isGT:Ghe,isGTE:gy,isNumberArray:vy}=hs,Hhe=u(n=>{const e={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:fa,segments:32};let{center:t,height:s,startRadius:i,startAngle:r,endRadius:o,endAngle:a,segments:l}=Object.assign({},e,n);if(!vy(t,3))throw new Error("center must be an array of X, Y and Z values");if(!Ghe(s,0))throw new Error("height must be greater then zero");if(!vy(i,2))throw new Error("startRadius must be an array of X and Y values");if(!i.every(R=>R>=0))throw new Error("startRadius values must be positive");if(!vy(o,2))throw new Error("endRadius must be an array of X and Y values");if(!o.every(R=>R>=0))throw new Error("endRadius values must be positive");if(o.every(R=>R===0)&&i.every(R=>R===0))throw new Error("at least one radius must be positive");if(!gy(r,0))throw new Error("startAngle must be positive");if(!gy(a,0))throw new Error("endAngle must be positive");if(!gy(l,4))throw new Error("segments must be four or more");r=r%fa,a=a%fa;let c=fa;r<a&&(c=a-r),r>a&&(c=a+(fa-r));const h=Math.min(i[0],i[1],o[0],o[1]),d=Math.acos((h*h+h*h-m3*m3)/(2*h*h));if(c<d)throw new Error("startAngle and endAngle do not define a significant rotation");const f=Math.floor(l*(c/fa)),p=ps.fromValues(0,0,-(s/2)),g=ps.fromValues(0,0,s/2),m=ps.subtract(ps.create(),g,p),v=ps.fromValues(1,0,0),y=ps.fromValues(0,1,0),b=ps.create(),_=ps.create(),w=ps.create(),x=u((R,D,k)=>{const T=D*c+r;return ps.scale(b,v,k[0]*Vhe(T)),ps.scale(_,y,k[1]*$he(T)),ps.add(b,b,_),ps.scale(w,m,R),ps.add(w,w,p),ps.add(ps.create(),b,w)},"point"),S=u((...R)=>{const D=R.map(k=>ps.add(ps.create(),k,t));return Uhe.create(D)},"fromPoints"),C=[];for(let R=0;R<f;R++){const D=R/f;let k=(R+1)/f;c===fa&&R===f-1&&(k=0),o[0]===i[0]&&o[1]===i[1]?(C.push(S(p,x(0,k,o),x(0,D,o))),C.push(S(x(0,k,o),x(1,k,o),x(1,D,o),x(0,D,o))),C.push(S(g,x(1,D,o),x(1,k,o)))):(i[0]>0&&i[1]>0&&C.push(S(p,x(0,k,i),x(0,D,i))),(i[0]>0||i[1]>0)&&C.push(S(x(0,D,i),x(0,k,i),x(1,D,o))),o[0]>0&&o[1]>0&&C.push(S(g,x(1,D,o),x(1,k,o))),(o[0]>0||o[1]>0)&&C.push(S(x(1,D,o),x(0,k,i),x(1,k,o))))}return c<fa&&(C.push(S(p,x(0,0,i),g)),C.push(S(x(0,0,i),x(1,0,o),g)),C.push(S(p,g,x(0,1,i))),C.push(S(x(0,1,i),g,x(1,1,o)))),Bhe.create(C)},"cylinderElliptic$1");var BL=Hhe;const Whe=BL,{isGT:jhe}=hs,Xhe=u(n=>{const e={center:[0,0,0],height:2,radius:1,segments:32},{center:t,height:s,radius:i,segments:r}=Object.assign({},e,n);if(!jhe(i,0))throw new Error("radius must be greater than zero");return Whe({center:t,height:s,startRadius:[i,i],endRadius:[i,i],segments:r})},"cylinder");var Yhe=Xhe;const qhe=Tt,Khe=tn,{isNumberArray:g3}=hs,Zhe=u(n=>{const e={points:[],faces:[],colors:void 0,orientation:"outward"},{points:t,faces:s,colors:i,orientation:r}=Object.assign({},e,n);if(!(Array.isArray(t)&&Array.isArray(s)))throw new Error("points and faces must be arrays");if(t.length<3)throw new Error("three or more points are required");if(s.length<1)throw new Error("one or more faces are required");if(i){if(!Array.isArray(i))throw new Error("colors must be an array");if(i.length!==s.length)throw new Error("faces and colors must have the same length")}t.forEach((a,l)=>{if(!g3(a,3))throw new Error(`point ${l} must be an array of X, Y, Z values`)}),s.forEach((a,l)=>{if(a.length<3)throw new Error(`face ${l} must contain 3 or more indexes`);if(!g3(a,a.length))throw new Error(`face ${l} must be an array of numbers`)}),r!=="outward"&&s.forEach(a=>a.reverse());const o=s.map((a,l)=>{const c=Khe.create(a.map(h=>t[h]));return i&&i[l]&&(c.color=i[l]),c});return qhe.create(o)},"polyhedron$1");var UL=Zhe;const v3=hn,y3=_t,Qhe=Tt,Jhe=UL,{isGT:ede,isGTE:tde}=hs,nde=u(n=>{const e={radius:1,frequency:6};let{radius:t,frequency:s}=Object.assign({},e,n);if(!ede(t,0))throw new Error("radius must be greater than zero");if(!tde(s,6))throw new Error("frequency must be six or more");s=Math.floor(s/6);const i=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],r=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],o=u((f,p,g)=>{const m=f[0],v=f[1],y=f[2];let b=g;const _=[],w=[];for(let x=0;x<p;x++)for(let S=0;S<p-x;S++){const C=x/p,M=(x+1)/p,R=S/(p-x),D=(S+1)/(p-x),k=p-x-1?S/(p-x-1):1,T=[];T[0]=a(a(m,v,R),y,C),T[1]=a(a(m,v,D),y,C),T[2]=a(a(m,v,k),y,M);for(let N=0;N<3;N++){const E=y3.length(T[N]);for(let z=0;z<3;z++)T[N][z]/=E}if(_.push(T[0],T[1],T[2]),w.push([b,b+1,b+2]),b+=3,S<p-x-1){const N=p-x-1?(S+1)/(p-x-1):1;T[0]=a(a(m,v,D),y,C),T[1]=a(a(m,v,N),y,M),T[2]=a(a(m,v,k),y,M);for(let E=0;E<3;E++){const z=y3.length(T[E]);for(let H=0;H<3;H++)T[E][H]/=z}_.push(T[0],T[1],T[2]),w.push([b,b+1,b+2]),b+=3}}return{points:_,triangles:w,offset:b}},"geodesicSubDivide"),a=u((f,p,g)=>{const m=1-g,v=[];for(let y=0;y<3;y++)v[y]=f[y]*m+p[y]*g;return v},"mix3");let l=[],c=[],h=0;for(let f=0;f<r.length;f++){const p=o([i[r[f][0]],i[r[f][1]],i[r[f][2]]],s,h);l=l.concat(p.points),c=c.concat(p.triangles),h=p.offset}let d=Jhe({points:l,faces:c,orientation:"inward"});return t!==1&&(d=Qhe.transform(v3.fromScaling(v3.create(),[t,t,t]),d)),d},"geodesicSphere");var sde=nde;const ide=qn,rde=u(n=>{if(!Array.isArray(n))throw new Error("points must be an array");return ide.fromPoints({},n)},"line$2");var ode=rde;const yy=Ot,ade=u(n=>{const e={points:[],paths:[]},{points:t,paths:s}=Object.assign({},e,n);if(!(Array.isArray(t)&&Array.isArray(s)))throw new Error("points and paths must be arrays");let i=t;Array.isArray(t[0])&&(Array.isArray(t[0][0])||(i=[t])),i.forEach((l,c)=>{if(!Array.isArray(l))throw new Error("list of points "+c+" must be an array");if(l.length<3)throw new Error("list of points "+c+" must contain three or more points");l.forEach((h,d)=>{if(!Array.isArray(h))throw new Error("list of points "+c+", point "+d+" must be an array");if(h.length<2)throw new Error("list of points "+c+", point "+d+" must contain by X and Y values")})});let r=s;if(s.length===0){let l=0;r=i.map(c=>c.map(h=>l++))}const o=[];i.forEach(l=>l.forEach(c=>o.push(c)));let a=[];return r.forEach(l=>{const c=l.map(d=>o[d]),h=yy.fromPoints(c);a=a.concat(yy.toSides(h))}),yy.create(a)},"polygon");var lde=ade;const pa=wt,cde=Ot,{isNumberArray:_3}=hs,ude=u(n=>{const e={center:[0,0],size:[2,2]},{center:t,size:s}=Object.assign({},e,n);if(!_3(t,2))throw new Error("center must be an array of X and Y values");if(!_3(s,2))throw new Error("size must be an array of X and Y values");if(!s.every(a=>a>0))throw new Error("size values must be greater than zero");const i=[s[0]/2,s[1]/2],r=[i[0],-i[1]],o=[pa.subtract(pa.create(),t,i),pa.add(pa.create(),t,r),pa.add(pa.create(),t,i),pa.subtract(pa.create(),t,r)];return cde.fromPoints(o)},"rectangle$1");var $L=ude;const{EPS:Fg,TAU:cd}=dt,_y=wt,Fn=_t,hde=Tt,ch=tn,{sin:dde,cos:fde}=Ps,{isGT:pde,isGTE:mde,isNumberArray:b3}=hs,w3=u((n,e,t,s,i,r)=>{const o=cd/4*i/s,a=fde(o),l=dde(o),c=s-i;let h=t*a,d=e[2]-(t-t*l);r||(d=t-t*l-e[2]),h=h>Fg?h:0;const f=Fn.add(Fn.create(),n,[e[0]-t,e[1]-t,d]),p=Fn.add(Fn.create(),n,[t-e[0],e[1]-t,d]),g=Fn.add(Fn.create(),n,[t-e[0],t-e[1],d]),m=Fn.add(Fn.create(),n,[e[0]-t,t-e[1],d]),v=[],y=[],b=[],_=[];for(let w=0;w<=c;w++){const x=c>0?cd/4*w/c:0,S=_y.fromAngleRadians(_y.create(),x);_y.scale(S,S,h);const C=Fn.fromVec2(Fn.create(),S);v.push(Fn.add(Fn.create(),f,C)),Fn.rotateZ(C,C,[0,0,0],cd/4),y.push(Fn.add(Fn.create(),p,C)),Fn.rotateZ(C,C,[0,0,0],cd/4),b.push(Fn.add(Fn.create(),g,C)),Fn.rotateZ(C,C,[0,0,0],cd/4),_.push(Fn.add(Fn.create(),m,C))}return r?[v,y,b,_]:(v.reverse(),y.reverse(),b.reverse(),_.reverse(),[_,b,y,v])},"createCorners"),x3=u((n,e)=>{const t=[];for(let s=0;s<n.length;s++){const i=n[s],r=e[s];for(let o=0;o<i.length-1;o++)t.push(ch.create([i[o],i[o+1],r[o]])),o<r.length-1&&t.push(ch.create([r[o],i[o+1],r[o+1]]))}return t},"stitchCorners"),A3=u((n,e)=>{const t=[];for(let s=0;s<n.length;s++){let i=n[s],r=e[s];const o=i[i.length-1],a=r[r.length-1],l=(s+1)%n.length;i=n[l],r=e[l];const c=i[0],h=r[0];t.push(ch.create([o,c,h,a]))}return t},"stitchWalls"),gde=u((n,e)=>{n=[n[3],n[2],n[1],n[0]],n=n.map(r=>r.slice().reverse());const t=[];n.forEach(r=>{r.forEach(o=>t.push(o))});const s=[];e.forEach(r=>{r.forEach(o=>s.push(o))});const i=[];for(let r=0;r<s.length;r++){const o=(r+1)%s.length;i.push(ch.create([t[r],t[o],s[o],s[r]]))}return i},"stitchSides"),vde=u(n=>{const e={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32};let{center:t,size:s,roundRadius:i,segments:r}=Object.assign({},e,n);if(!b3(t,3))throw new Error("center must be an array of X, Y and Z values");if(!b3(s,3))throw new Error("size must be an array of X, Y and Z values");if(!s.every(c=>c>0))throw new Error("size values must be greater than zero");if(!pde(i,0))throw new Error("roundRadius must be greater than zero");if(!mde(r,4))throw new Error("segments must be four or more");if(s=s.map(c=>c/2),i>s[0]-Fg||i>s[1]-Fg||i>s[2]-Fg)throw new Error("roundRadius must be smaller then the radius of all dimensions");r=Math.floor(r/4);let o=null,a=null,l=[];for(let c=0;c<=r;c++){const h=w3(t,s,i,r,c,!0),d=w3(t,s,i,r,c,!1);if(c===0&&(l=l.concat(gde(d,h))),o&&(l=l.concat(x3(o,h),A3(o,h))),a&&(l=l.concat(x3(a,d),A3(a,d))),c===r){let f=h.map(p=>p[0]);l.push(ch.create(f)),f=d.map(p=>p[0]),l.push(ch.create(f))}o=h,a=d}return hde.create(l)},"roundedCuboid");var yde=vde;const{EPS:M3,TAU:S3}=dt,Ue=_t,_de=Tt,bde=tn,{sin:C3,cos:E3}=Ps,{isGT:by,isGTE:wde,isNumberArray:xde}=hs,Ade=u(n=>{const e={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:t,height:s,radius:i,roundRadius:r,segments:o}=Object.assign({},e,n);if(!xde(t,3))throw new Error("center must be an array of X, Y and Z values");if(!by(s,0))throw new Error("height must be greater then zero");if(!by(i,0))throw new Error("radius must be greater then zero");if(!by(r,0))throw new Error("roundRadius must be greater then zero");if(r>i-M3)throw new Error("roundRadius must be smaller then the radius");if(!wde(o,4))throw new Error("segments must be four or more");const a=[0,0,-(s/2)],l=[0,0,s/2],c=Ue.subtract(Ue.create(),l,a),h=Ue.length(c);if(2*r>h-M3)throw new Error("height must be larger than twice roundRadius");let d;Math.abs(c[0])>Math.abs(c[1])?d=Ue.fromValues(0,1,0):d=Ue.fromValues(1,0,0);const f=Ue.scale(Ue.create(),Ue.normalize(Ue.create(),c),r),p=Ue.scale(Ue.create(),Ue.normalize(Ue.create(),Ue.cross(Ue.create(),f,d)),i),g=Ue.scale(Ue.create(),Ue.normalize(Ue.create(),Ue.cross(Ue.create(),p,f)),i);Ue.add(a,a,f),Ue.subtract(l,l,f);const m=Math.floor(.25*o),v=u(S=>{const C=S.map(M=>Ue.add(M,M,t));return bde.create(C)},"fromPoints"),y=[],b=Ue.create(),_=Ue.create();let w;for(let S=0;S<=o;S++){const C=S3*S/o,M=Ue.add(Ue.create(),Ue.scale(b,p,E3(C)),Ue.scale(_,g,C3(C)));if(S>0){let R=[];R.push(Ue.add(Ue.create(),a,M)),R.push(Ue.add(Ue.create(),a,w)),R.push(Ue.add(Ue.create(),l,w)),R.push(Ue.add(Ue.create(),l,M)),y.push(v(R));let D,k;for(let T=0;T<=m;T++){const N=S3/4*T/m,E=E3(N),z=C3(N);if(T>0){R=[];let H;H=Ue.add(Ue.create(),a,Ue.subtract(b,Ue.scale(b,w,D),Ue.scale(_,f,k))),R.push(H),H=Ue.add(Ue.create(),a,Ue.subtract(b,Ue.scale(b,M,D),Ue.scale(_,f,k))),R.push(H),T<m&&(H=Ue.add(Ue.create(),a,Ue.subtract(b,Ue.scale(b,M,E),Ue.scale(_,f,z))),R.push(H)),H=Ue.add(Ue.create(),a,Ue.subtract(b,Ue.scale(b,w,E),Ue.scale(_,f,z))),R.push(H),y.push(v(R)),R=[],H=Ue.add(Ue.create(),Ue.scale(b,w,D),Ue.scale(_,f,k)),Ue.add(H,H,l),R.push(H),H=Ue.add(Ue.create(),Ue.scale(b,M,D),Ue.scale(_,f,k)),Ue.add(H,H,l),R.push(H),T<m&&(H=Ue.add(Ue.create(),Ue.scale(b,M,E),Ue.scale(_,f,z)),Ue.add(H,H,l),R.push(H)),H=Ue.add(Ue.create(),Ue.scale(b,w,E),Ue.scale(_,f,z)),Ue.add(H,H,l),R.push(H),R.reverse(),y.push(v(R))}D=E,k=z}}w=M}return _de.create(y)},"roundedCylinder");var Mde=Ade;const{EPS:T3,TAU:Pm}=dt,gn=wt,Sde=Ot,{isGT:Cde,isGTE:Ede,isNumberArray:P3}=hs,Tde=u(n=>{const e={center:[0,0],size:[2,2],roundRadius:.2,segments:32};let{center:t,size:s,roundRadius:i,segments:r}=Object.assign({},e,n);if(!P3(t,2))throw new Error("center must be an array of X and Y values");if(!P3(s,2))throw new Error("size must be an array of X and Y values");if(!s.every(m=>m>0))throw new Error("size values must be greater than zero");if(!Cde(i,0))throw new Error("roundRadius must be greater than zero");if(!Ede(r,4))throw new Error("segments must be four or more");if(s=s.map(m=>m/2),i>s[0]-T3||i>s[1]-T3)throw new Error("roundRadius must be smaller then the radius of all dimensions");const o=Math.floor(r/4),a=gn.add(gn.create(),t,[s[0]-i,s[1]-i]),l=gn.add(gn.create(),t,[i-s[0],s[1]-i]),c=gn.add(gn.create(),t,[i-s[0],i-s[1]]),h=gn.add(gn.create(),t,[s[0]-i,i-s[1]]),d=[],f=[],p=[],g=[];for(let m=0;m<=o;m++){const v=Pm/4*m/o,y=gn.fromAngleRadians(gn.create(),v);gn.scale(y,y,i),d.push(gn.add(gn.create(),a,y)),gn.rotate(y,y,gn.create(),Pm/4),f.push(gn.add(gn.create(),l,y)),gn.rotate(y,y,gn.create(),Pm/4),p.push(gn.add(gn.create(),c,y)),gn.rotate(y,y,gn.create(),Pm/4),g.push(gn.add(gn.create(),h,y))}return Sde.fromPoints(d.concat(f,p,g))},"roundedRectangle");var Pde=Tde;const Rde=$L,{isGT:Ide}=hs,Dde=u(n=>{const e={center:[0,0],size:2};let{center:t,size:s}=Object.assign({},e,n);if(!Ide(s,0))throw new Error("size must be greater than zero");return s=[s,s],Rde({center:t,size:s})},"square");var Lde=Dde;const{TAU:VL}=dt,tf=wt,Ode=Ot,{isGT:kde,isGTE:Rm,isNumberArray:Nde}=hs,Fde=u((n,e)=>n>0&&e>1&&e<n/2?Math.cos(Math.PI*e/n)/Math.cos(Math.PI*(e-1)/n):0,"getRadiusRatio"),R3=u((n,e,t,s)=>{const i=VL/n,r=[];for(let o=0;o<n;o++){const a=tf.fromAngleRadians(tf.create(),i*o+t);tf.scale(a,a,e),tf.add(a,s,a),r.push(a)}return r},"getPoints"),zde=u(n=>{const e={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0};let{center:t,vertices:s,outerRadius:i,innerRadius:r,density:o,startAngle:a}=Object.assign({},e,n);if(!Nde(t,2))throw new Error("center must be an array of X and Y values");if(!Rm(s,2))throw new Error("vertices must be two or more");if(!kde(i,0))throw new Error("outerRadius must be greater than zero");if(!Rm(r,0))throw new Error("innerRadius must be greater than zero");if(!Rm(a,0))throw new Error("startAngle must be greater than zero");if(s=Math.floor(s),o=Math.floor(o),a=a%VL,r===0){if(!Rm(o,2))throw new Error("density must be two or more");r=i*Fde(s,o)}const l=tf.clone(t),c=R3(s,i,a,l),h=R3(s,r,a+Math.PI/s,l),d=[];for(let f=0;f<s;f++)d.push(c[f]),d.push(h[f]);return Ode.fromPoints(d)},"star");var Bde=zde;const{TAU:Ude}=dt,$de=CL,{rotate:Vde}=ef,{translate:Gde}=$l,Hde=FL,{isGT:wy,isGTE:xy}=hs,Wde=u(n=>{const e={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:Ude},{innerRadius:t,innerSegments:s,outerRadius:i,outerSegments:r,innerRotation:o,startAngle:a,outerRotation:l}=Object.assign({},e,n);if(!wy(t,0))throw new Error("innerRadius must be greater than zero");if(!xy(s,3))throw new Error("innerSegments must be three or more");if(!wy(i,0))throw new Error("outerRadius must be greater than zero");if(!xy(r,3))throw new Error("outerSegments must be three or more");if(!xy(a,0))throw new Error("startAngle must be positive");if(!wy(l,0))throw new Error("outerRotation must be greater than zero");if(t>=i)throw new Error("inner circle is two large to rotate about the outer circle");let c=Hde({radius:t,segments:s});return o!==0&&(c=Vde([0,0,o],c)),c=Gde([i,0],c),$de({startAngle:a,angle:l,segments:r},c)},"torus");var jde=Wde;const{NEPS:uh}=dt,ud=wt,Xde=Ot,{isNumberArray:Yde}=hs,j_=u((n,e,t)=>Math.acos((n*n+e*e-t*t)/(2*n*e)),"solveAngleFromSSS"),qde=u((n,e,t)=>e>uh?Math.sqrt(n*n+t*t-2*n*t*Math.cos(e)):Math.sqrt((n-t)*(n-t)+n*t*e*e*(1-e*e/12)),"solveSideFromSAS"),Kde=u(n=>{if(Math.abs(n[0]+n[1]+n[2]-Math.PI)>uh)throw new Error("AAA triangles require angles that sum to PI");const t=n[0],s=n[1],i=Math.PI-t-s,r=1,o=r/Math.sin(i)*Math.sin(t),a=r/Math.sin(i)*Math.sin(s);return Ah(t,s,i,o,a,r)},"solveAAA"),Zde=u(n=>{const e=n[0],t=n[1],s=Math.PI+uh-e-t;if(s<uh)throw new Error("AAS triangles require angles that sum to PI");const i=n[2],r=i/Math.sin(e)*Math.sin(t),o=i/Math.sin(e)*Math.sin(s);return Ah(e,t,s,i,r,o)},"solveAAS"),Qde=u(n=>{const e=n[0],t=n[2],s=Math.PI+uh-e-t;if(s<uh)throw new Error("ASA triangles require angles that sum to PI");const i=n[1],r=i/Math.sin(s)*Math.sin(e),o=i/Math.sin(s)*Math.sin(t);return Ah(e,t,s,r,o,i)},"solveASA"),Jde=u(n=>{const e=n[0],t=n[1],s=n[2],i=qde(e,t,s),r=j_(i,e,s),o=Math.PI-r-t;return Ah(r,t,o,s,i,e)},"solveSAS"),efe=u(n=>{const e=n[0],t=n[1],s=n[2],i=Math.asin(t*Math.sin(s)/e),r=Math.PI-i-s,o=e/Math.sin(s)*Math.sin(r);return Ah(i,r,s,t,o,e)},"solveSSA"),tfe=u(n=>{const e=n[1],t=n[2],s=n[0];if(e+t<=s||t+s<=e||s+e<=t)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");const i=j_(t,s,e),r=j_(s,e,t),o=Math.PI-i-r;return Ah(i,r,o,e,t,s)},"solveSSS"),Ah=u((n,e,t,s,i,r)=>{const o=ud.fromValues(0,0),a=ud.fromValues(r,0),l=ud.fromValues(s,0);return ud.add(l,ud.rotate(l,l,[0,0],Math.PI-e),a),Xde.fromPoints([o,a,l])},"createTriangle"),nfe=u(n=>{const e={type:"SSS",values:[1,1,1]};let{type:t,values:s}=Object.assign({},e,n);if(typeof t!="string")throw new Error("triangle type must be a string");if(t=t.toUpperCase(),!((t[0]==="A"||t[0]==="S")&&(t[1]==="A"||t[1]==="S")&&(t[2]==="A"||t[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!Yde(s,3))throw new Error("triangle values must contain three values");if(!s.every(i=>i>0))throw new Error("triangle values must be greater than zero");switch(t){case"AAA":return Kde(s);case"AAS":return Zde(s);case"ASA":return Qde(s);case"SAS":return Jde(s);case"SSA":return efe(s);case"SSS":return tfe(s);default:throw new Error("invalid triangle type, try again")}},"triangle");var sfe=nfe,po={arc:Ahe,circle:FL,cube:zhe,cuboid:zL,cylinder:Yhe,cylinderElliptic:BL,ellipse:NL,ellipsoid:Xw,geodesicSphere:sde,line:ode,polygon:lde,polyhedron:UL,rectangle:$L,roundedCuboid:yde,roundedCylinder:Mde,roundedRectangle:Pde,sphere:ML,square:Lde,star:Bde,torus:jde,triangle:sfe};class R1 extends at{constructor(e=(i,r,o)=>o.set(i,r,Math.cos(i)*Math.sin(r)),t=8,s=8){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:s};const i=[],r=[],o=[],a=[],l=1e-5,c=new P,h=new P,d=new P,f=new P,p=new P,g=t+1;for(let m=0;m<=s;m++){const v=m/s;for(let y=0;y<=t;y++){const b=y/t;e(b,v,h),r.push(h.x,h.y,h.z),b-l>=0?(e(b-l,v,d),f.subVectors(h,d)):(e(b+l,v,d),f.subVectors(d,h)),v-l>=0?(e(b,v-l,d),p.subVectors(h,d)):(e(b,v+l,d),p.subVectors(d,h)),c.crossVectors(f,p).normalize(),o.push(c.x,c.y,c.z),a.push(b,v)}}for(let m=0;m<s;m++)for(let v=0;v<t;v++){const y=m*g+v,b=m*g+v+1,_=(m+1)*g+v+1,w=(m+1)*g+v;i.push(y,b,w),i.push(b,_,w)}this.setIndex(i),this.setAttribute("position",new We(r,3)),this.setAttribute("normal",new We(o,3)),this.setAttribute("uv",new We(a,2))}}u(R1,"ParametricGeometry");const hc={klein:function(n,e,t){e*=Math.PI,n*=2*Math.PI,e=e*2;let s,i;e<Math.PI?(s=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(e)*Math.cos(n),i=-8*Math.sin(e)-2*(1-Math.cos(e)/2)*Math.sin(e)*Math.cos(n)):(s=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(n+Math.PI),i=-8*Math.sin(e));const r=-2*(1-Math.cos(e)/2)*Math.sin(n);t.set(s,r,i)},plane:function(n,e){return function(t,s,i){const r=t*n,o=0,a=s*e;i.set(r,o,a)}},mobius:function(n,e,t){n=n-.5;const s=2*Math.PI*e,i=2,r=Math.cos(s)*(i+n*Math.cos(s/2)),o=Math.sin(s)*(i+n*Math.cos(s/2)),a=n*Math.sin(s/2);t.set(r,o,a)},mobius3d:function(n,e,t){n*=Math.PI,e*=2*Math.PI,n=n*2;const s=n/2,i=2.25,r=.125,o=.65;let a=r*Math.cos(e)*Math.cos(s)-o*Math.sin(e)*Math.sin(s);const l=r*Math.cos(e)*Math.sin(s)+o*Math.sin(e)*Math.cos(s),c=(i+a)*Math.sin(n);a=(i+a)*Math.cos(n),t.set(a,c,l)}};hc.TubeGeometry=u(class extends R1{constructor(e,t=64,s=1,i=8,r=!1){const o=t+1,a=e.computeFrenetFrames(t,r),l=a.tangents,c=a.normals,h=a.binormals,d=new P;function f(p,g,m){g*=2*Math.PI;const v=Math.floor(p*(o-1));e.getPointAt(p,d);const y=c[v],b=h[v],_=-s*Math.cos(g),w=s*Math.sin(g);d.x+=_*y.x+w*b.x,d.y+=_*y.y+w*b.y,d.z+=_*y.z+w*b.z,m.copy(d)}u(f,"ParametricTube"),super(f,t,i),this.tangents=l,this.normals=c,this.binormals=h,this.path=e,this.segments=t,this.radius=s,this.segmentsRadius=i,this.closed=r}},"TubeGeometry");hc.TorusKnotGeometry=u(class extends hc.TubeGeometry{constructor(e=200,t=40,s=64,i=8,r=2,o=3){class a extends Vb{getPoint(f,p=new P){const g=p;f*=Math.PI*2;const m=.5,v=(1+m*Math.cos(o*f))*Math.cos(r*f),y=(1+m*Math.cos(o*f))*Math.sin(r*f),b=m*Math.sin(o*f);return g.set(v,y,b).multiplyScalar(e)}}u(a,"TorusKnotCurve");const l=s,c=i,h=new a;super(h,l,t,c,!0,!1),this.radius=e,this.tube=t,this.segmentsT=s,this.segmentsR=i,this.p=r,this.q=o}},"TorusKnotGeometry");hc.SphereGeometry=u(class extends R1{constructor(e,t,s){function i(r,o,a){r*=Math.PI,o*=2*Math.PI;const l=e*Math.sin(r)*Math.cos(o),c=e*Math.sin(r)*Math.sin(o),h=e*Math.cos(r);a.set(l,c,h)}u(i,"sphere"),super(i,t,s)}},"SphereGeometry");hc.PlaneGeometry=u(class extends R1{constructor(e,t,s,i){function r(o,a,l){const c=o*e,h=0,d=a*t;l.set(c,h,d)}u(r,"plane"),super(r,s,i)}},"PlaneGeometry");var ife=Object.defineProperty,GL=u((n,e)=>ife(n,"name",{value:e,configurable:!0}),"__name$1A");const Im=new P,rfe=[1,1,1];function HL(n){const e=[],t=[],s=[],i=[];let r=0;for(let o of n.polygons){WL(Im,o);const a=o.color||n.color||rfe;for(let c of o.vertices)e.push(...c),t.push(Im.x,Im.y,Im.z),s.push(a[0],a[1],a[2]);const l=o.vertices.length;for(let c=2;c<l;++c)i.push(r,r+c-1,r+c);r+=l}return new at().setAttribute("position",new We(new Float32Array(e),3)).setAttribute("normal",new We(new Float32Array(t),3)).setAttribute("color",new We(new Float32Array(s),3)).setIndex(i)}u(HL,"geom3ToBufferGeometry");GL(HL,"geom3ToBufferGeometry");const Ay=new P,I3=new P,D3=new P,L3=new P,O3=new P;function WL(n,e){const t=e.vertices;return Ay.fromArray(t[0]),I3.fromArray(t[1]),D3.fromArray(t[2]),L3.subVectors(I3,Ay),O3.subVectors(D3,Ay),n.crossVectors(L3,O3),n.normalize(),n}u(WL,"calculatePoly3Normal");GL(WL,"calculatePoly3Normal");var ofe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAOJJREFUSImtVUkSBCEIS6bm322/nD6MWi7I0jUclZBQBiFiUZLnPb6RwiJyaZckXaITwVSY5K0lDfdHIo2gKIVVha3wQqTmjsWlJpmJK27B2sW9xAz2o2WTvGvbEZIiItfpnTYFzlkaZ9m0kERVB4VoVG6JcJW+6a7fe4MG7J0gqhzwJ3kjAfp8uMWBg4v+GeEORisaD/+KYHOL465jEc0VlltCGHMOHLd4c2IqyvxHJk51Ucbn+HXS/q6cmgig4ZDoukiNAFFR8qdQN9phU20R2Xw6clZoLX1zpUYIJqLEeY8HyX71TroxJVAAAAAASUVORK5CYII=",afe=Object.defineProperty,lfe=u((n,e)=>afe(n,"name",{value:e,configurable:!0}),"__name$1z");const cfe=hc.SphereGeometry,hl=new P,mo=new qe,ma=new P,Hc=new P(0,0,1),dl=new P,k3=new qe,Dm=new be,Lm=new Array(16).fill(0),N3=new nr({toneMapped:!1,color:15114812,transparent:!0,opacity:.5,depthTest:!1}),ufe=new nr({toneMapped:!1,transparent:!0,opacity:0,depthTest:!1,depthWrite:!1}),hfe=new sp,X_=hfe.load(ofe);X_.minFilter=X_.magFilter=Wn;const dfe=new Hr({map:X_,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24});class qw extends zi{begin(e){const t=e.readonlyRef().model;if(!t.dirty)return;const s=[...t.nodes];for(;s.length;){const i=s.pop();if(!i)break;i.has(je)?(this.updateMatrix(i),i.instanceId||e.throttle(`#${i.id}-update-csg`,50,()=>{this.updateGeometry(t,i)},!1)):s.push(...i.children)}}updateMatrix(e){if(!e.has(je))return;const t=e.get(je);if(t.dirty&&!e.instanceId)for(let s of e.children)this.updateMatrix(s);t.matDirty&&(t.matDirty=!1,e.has(ze)?hl.copy(e.value(ze)):hl.set(0,0,0),e.has(nt)?mo.setFromEuler(e.value(nt)):mo.set(0,0,0,1),e.has(It)?ma.copy(e.value(It)):e.has(Wt)?ma.setScalar(e.value(Wt)):ma.setScalar(1),t.matrix.compose(hl,mo,ma),!e.instanceId&&!t.dirty&&t.value&&t.matrix.toArray(t.value.transforms=[...t.value.transforms]))}updateGeometry(e,t){if(!t.has(je))return;const s=t.get(je);if(s.dirty){if(s.dirty=!1,!t.instanceId){for(let r of t.children)this.updateGeometry(e,r);switch(t.type){case"CsgGroup":{let r=null,o=!0,a=[];for(let l of t.children){if(!l.value(gt))continue;let c=null;if(l.instanceId){if(c=e.getNode(l.instanceId).value(je),!c)continue;c=Object.assign({},c),c.transforms=[...c.transforms],l.get(je).matrix.toArray(c.transforms)}else{if(c=l.value(je),!c)continue;c=Object.assign({},c)}const h=l.value(As)==="positive";o===h?a.push(c):(o?(r&&(a=[r,...a]),a.length&&(r=lr.union(...a))):r&&(r=lr.subtract(r,...a)),a=[c],o=h)}if(a.length&&(o?(r&&(a=[r,...a]),r=lr.union(...a)):r&&(r=lr.subtract(r,...a))),r)switch(t.value(Us)){case"x":r=lr.union(r,dy.mirrorX(r));break;case"y":r=lr.union(r,dy.mirrorY(r));break;case"z":r=lr.union(r,dy.mirrorZ(r));break}s.value=r}break;case"CsgIntersect":{const r=[];for(let o of t.children){if(!o.value(gt))continue;let a=null;if(o.instanceId){if(a=e.getNode(o.instanceId).value(je),!a)continue;a=Object.assign({},a),a.transforms=[...a.transforms],o.get(je).matrix.toArray(a.transforms)}else{if(a=o.value(je),!a)continue;a=Object.assign({},a)}r.push(Object.assign({},a))}r.length?s.value=r.length>1?lr.intersect(...r):lr.union(r[0]):s.value=null}break;case"CsgHull":{const r=[];for(let o of t.children){if(!o.value(gt))continue;let a=null;if(o.instanceId){if(a=e.getNode(o.instanceId).value(je),!a)continue;a=Object.assign({},a),a.transforms=[...a.transforms],o.get(je).matrix.toArray(a.transforms)}else{if(a=o.value(je),!a)continue;a=Object.assign({},a)}r.push(Object.assign({},a))}r.length?s.value=r.length>1?XC.hull(...r):lr.union(r[0]):s.value=null}break;case"CsgHullChain":{const r=[];for(let o of t.children){if(!o.value(gt))continue;let a=null;if(o.instanceId){if(a=e.getNode(o.instanceId).value(je),!a)continue;a=Object.assign({},a),a.transforms=[...a.transforms],o.get(je).matrix.toArray(a.transforms)}else{if(a=o.value(je),!a)continue;a=Object.assign({},a)}r.push(Object.assign({},a))}r.length?s.value=r.length>1?XC.hullChain(...r):lr.union(r[0]):s.value=null}break;case"CsgEllipsoid":{const r=t.value(gr),o=Math.max(4,t.value(ns));r.x>0&&r.y>0&&r.z>0?s.value=Xw({radius:[r.x,r.y,r.z],segments:o}):s.value=null}break;case"CsgCuboid":{const r=t.value(qi),o=Math.min(t.value(Oi),r.x/2-1e-5,r.y/2-1e-5,r.z/2-1e-5),a=Math.max(4,t.value(ns));r.x>0&&r.y>0&&r.z>0?o>0?s.value=po.roundedCuboid({size:[r.x,r.y,r.z],roundRadius:o,segments:a}):s.value=po.cuboid({size:[r.x,r.y,r.z]}):s.value=null}break;case"CsgCylinder":{const r=t.value(fn),o=t.value(ui),a=Math.min(t.value(Oi),o-1e-5,r/2-1e-5),l=Math.max(4,t.value(ns));r>0&&o>0?a>0?s.value=po.roundedCylinder({height:r,radius:o,roundRadius:a,segments:l}):s.value=po.cylinder({height:r,radius:o,segments:l}):s.value=null}break;case"CsgCylinderElliptic":{const r=t.value(fn),o=t.value(cc),a=t.value(sc),l=Math.max(4,t.value(ns)),c=t.value(ju);r>0&&(o.x>0||o.y>0||a.x>0||a.y>0)&&c[1]>c[0]?s.value=po.cylinderElliptic({height:r,startRadius:[o.x,o.y],endRadius:[a.x,a.y],segments:l,startAngle:c[0]/180*Math.PI,endAngle:c[1]/180*Math.PI}):s.value=null}break;case"CsgTorus":{const r=t.value(ic),o=t.value(rc),a=Math.max(3,t.value(Yu)),l=Math.max(3,t.value(Zu)),c=t.value(Xu)/180*Math.PI,h=t.value(Ku)/180*Math.PI;r>0&&o>0&&o>r&&h>0?s.value=po.torus({innerRadius:r,outerRadius:o,innerSegments:a,outerSegments:l,innerRotation:c,outerRotation:h}):s.value=null}break;case"CsgBezier":{const r=t.value(rh),o=t.value(lc),a=t.value(ac),l=t.value(sh),c=Math.max(3,t.value(ah)),h=t.value(nh)/180*Math.PI,d=t.value(th)/180*Math.PI,f=Math.max(3,t.value(ns)),p=Math.max(2,t.value(qu));if(o.x>=0&&o.y>=0&&a.x>=0&&a.y>=0&&(o.x||o.y||a.x||a.y)&&!(r==="star"&&l===0)&&t.children.length>1){const g=[];for(let b of t.children)g.push(b.value(ze).toArray([0,0,0]));let m;switch(r){case"ellipse":m=po.ellipse({radius:[Math.max(dt.EPS,o.x),Math.max(dt.EPS,o.y)],segments:f});break;case"rectangle":m=po.rectangle({size:[Math.max(dt.EPS,o.x),Math.max(dt.EPS,o.y)]});break;case"star":m=po.star({outerRadius:Math.max(dt.EPS,o.x),innerRadius:Math.max(dt.EPS,o.x*l),vertices:c});break;default:throw new Error(`Unknown shape ${r}`)}const v=Bv.create(g);let y=Sm.slice.fromSides(m.sides);t.value(ih)?(dl.set(g[1][0]-g[0][0],g[1][1]-g[0][1],g[1][2]-g[0][2]).normalize(),dl.lengthSq()<.5&&dl.set(0,0,1),Hc.set(0,0,1),hl.set(0,0,0),mo.setFromUnitVectors(Hc,dl),ma.set(1,1,1),Dm.compose(hl,mo,ma),Dm.toArray(Lm),y=Sm.slice.transform(Lm,y),Hc.copy(dl)):Hc.set(0,0,1),s.value=Sm.extrudeFromSlices({numberOfSlices:p,capStart:!0,capEnd:!0,callback:(b,_,w)=>{const x=Bv.valueAt(b,v),S=Bv.tangentAt(b,v);hl.fromArray(x),dl.fromArray(S).normalize(),mo.setFromUnitVectors(Hc,dl);const C=(h-d)*b+h;k3.setFromAxisAngle(Hc,C),mo.multiplyQuaternions(mo,k3);let M=(a.x-o.x)*b+o.x,R=(a.y-o.y)*b+o.y;return M=M/Math.max(o.x,dt.EPS),R=R/Math.max(o.y,dt.EPS),r==="star"&&(R*=o.y/Math.max(dt.EPS,o.x)),ma.set(Math.max(dt.EPS,M),Math.max(dt.EPS,R),1),Dm.compose(hl,mo,ma),Dm.toArray(Lm),Sm.slice.transform(Lm,w)}},y)}else s.value=null}break;case"CsgBezierControlPoint":s.value=null;break;default:throw new Error(`Unknown csg node type [${t.type}]`)}}const i=t.get(Pe);if(t.type==="CsgBezierControlPoint")t.instanceId||(i.value||(i.value=new Ye(new cfe(.001,8,8),ufe),i.value.visible=!1),s.placeholder=new Oa(new at().setFromPoints([new P]),dfe),s.placeholder.renderOrder=2);else if(t.instanceId){const r=e.getNode(t.instanceId).get(je).placeholder;if(r){const o=r;o.isMesh&&(s.placeholder=new Ye(o.geometry,N3))}}else{const r=s.value?HL(s.value):new at;if(i.value){const o=i.value.children[0];o.geometry.dispose(),o.geometry=r,r.computeBoundingSphere()}else{const o=i.value=new ls;o.userData.node=t;const a=new Ye(r,new nr);a.userData.node=t,o.add(a)}s.placeholder&&(s.placeholder.removeFromParent(),delete s.placeholder),r&&(s.placeholder=new Ye(r,N3)),e.instanceMeshUpdated(t.id,!0)}s.useTempMat=!1,t.instanceId||(s.value&&s.matrix.toArray(s.value.transforms=[...s.value.transforms]),e.dirty=!0,t.dirty=!0,i.parentChanged=!0,i.localTransformChanged=!0,i.worldTransformChanged=!0)}}end(e){}}u(qw,"CsgUpdateSystem");lfe(qw,"CsgUpdateSystem");var ffe=Object.defineProperty,pfe=u((n,e)=>ffe(n,"name",{value:e,configurable:!0}),"__name$1y");class Kw extends zi{begin(e){e.history.update()}end(e){}}u(Kw,"HistorySystem");pfe(Kw,"HistorySystem");var mfe=Object.defineProperty,gfe=u((n,e)=>mfe(n,"name",{value:e,configurable:!0}),"__name$1x");class Zw extends zi{constructor(){super(...arguments);A(this,"showIkBones",!1)}setup(t){this.showIkBones=t.options.showIkBones}begin(t){t=t.readonlyRef(),t.options.showIkBones!==this.showIkBones&&(this.showIkBones=t.options.showIkBones,t.model.forEach(s=>{if(s.has(Et)){const i=s.get(Et);i.boneMesh&&(i.boneMesh.visible=t.options.showIkBones),i.hingeIndicator&&(i.hingeIndicator.visible=t.options.showIkBones&&i.hingeEnabled)}}))}end(t){}}u(Zw,"IkBoneVisibleUpdateSystem");gfe(Zw,"IkBoneVisibleUpdateSystem");var vfe=Object.defineProperty,yfe=u((n,e)=>vfe(n,"name",{value:e,configurable:!0}),"__name$1w");class Qw extends zi{constructor(){super(...arguments);A(this,"ambientLight",new t1(16777215,.05))}setup(t){t.scene.add(this.ambientLight)}begin(t){if(t=t.readonlyRef(),t.options.shadingMode==="solid"){t.renderer.physicallyCorrectLights=!1,this.ambientLight.visible=!0;for(let r of t.views){if(!r.enabled)continue;const o=r.defaultLights;o.position.copy(r.camera._position).addScaledVector(r.camera._dir,2),o.up.copy(r.camera._up),o.lookAt(r.camera.target)}}else this.ambientLight.visible=!1,t.renderer.physicallyCorrectLights=!0;const s=t.options.shadingMode==="rendered",i=t.options.showLightHelpers;t.model.forEach(r=>{if(kn(r.type).light){const o=r.value(Pe),a=r.visible;if(o&&(o.visible=s&&a),r.has(ei)){const l=r.get(ei),c=t.model.selected.includes(r.id)||!!r.children.length&&t.model.selected.includes(r.children[0].id);l.value&&(l.value.visible=a&&(i||c)),l.camera&&(l.camera.visible=s&&o.castShadow&&a&&(i||c))}}})}end(t){}}u(Qw,"LightUpdateSystem");yfe(Qw,"LightUpdateSystem");var _fe=Object.defineProperty,bfe=u((n,e)=>_fe(n,"name",{value:e,configurable:!0}),"__name$1v");class Jw{update(e,t){if(t.instanceId||t.type!=="Box")return;const s=t.get(Yi);if(!s.dirty)return;s.dirty=!1;const i=t.get(Pe),r=s.value,o=new mr(r.x,r.y,r.z);if(i.value){const a=i.value;a.geometry.dispose(),a.geometry=o}else i.value=new Ye(o,new nr),i.value.userData={node:t},i.parentChanged=!0,i.localTransformChanged=!0;o.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)}}u(Jw,"BoxUpdateFilter");bfe(Jw,"BoxUpdateFilter");var wfe=Object.defineProperty,xfe=u((n,e)=>wfe(n,"name",{value:e,configurable:!0}),"__name$1u");class Yr{constructor(e=0){A(this,"bits");this.bits=new Uint32Array((e>>>5)+1)}checkCapacity(e){if(e>this.bits.length){const t=new Uint32Array(e);t.set(this.bits,0),this.bits=t}}expandCapacity(e){this.checkCapacity((e>>>5)+1)}clear(){for(let e=0,t=this.bits.length;e<t;++e)this.bits[e]=0}set(e){const t=e>>>5;this.checkCapacity(t+1),this.bits[t]=(this.bits[t]|1<<(e&31))>>>0}get(e){const t=e>>>5;return t>=this.bits.length?!1:(this.bits[t]&1<<(e&31))!==0}clearBit(e){const t=e>>>5;t>=this.bits.length||(this.bits[t]=(this.bits[t]&~(1<<(e&31)))>>>0)}setBit(e,t){t?this.set(e):this.clearBit(e)}and(e){const t=Math.min(this.bits.length,e.bits.length);for(let s=0;s<t;++s)this.bits[s]=(this.bits[s]&e.bits[s])>>>0;if(this.bits.length>t)for(let s=t,i=this.bits.length;s<i;++s)this.bits[s]=0}or(e){const t=Math.min(this.bits.length,e.bits.length);for(let s=0;s<t;++s)this.bits[s]=(this.bits[s]|e.bits[s])>>>0;if(e.bits.length>t){this.checkCapacity(e.bits.length);for(let s=t,i=e.bits.length;s<i;++s)this.bits[s]=e.bits[s]}}equals(e){const t=this.bits.length>=e.bits.length?this:e,s=t===this?e:this;for(let i=0,r=s.bits.length;i<r;++i)if(t.bits[i]!==s.bits[i])return!1;for(let i=t.bits.length-s.bits.length+1,r=t.bits.length;i<r;++i)if(t.bits[i])return!1;return!0}intersects(e){for(let t=0,s=Math.min(this.bits.length,e.bits.length);t<s;++t)if((this.bits[t]&e.bits[t])!==0)return!0;return!1}containsAll(e){if(e.bits.length>this.bits.length){for(let t=this.bits.length,s=e.bits.length;t<s;++t)if(e.bits[t]!==0)return!1}for(let t=0,s=Math.min(this.bits.length,e.bits.length);t<s;++t)if((this.bits[t]&e.bits[t])!==e.bits[t])return!1;return!0}isEmpty(){for(let e=0,t=this.bits.length;e<t;++e)if(this.bits[e]!==0)return!1;return!0}clone(){const e=new Yr;return e.bits=this.bits.slice(),e}}u(Yr,"Bits");xfe(Yr,"Bits");var Afe=Object.defineProperty,jL=u((n,e)=>Afe(n,"name",{value:e,configurable:!0}),"__name$1t");const Vl=new DataView(new ArrayBuffer(12)),F3=new Array(8),z3=new Array(8);function Y_(n,e){Vl.setUint32(0,n),Vl.setUint32(4,e);for(let t=0;t<8;++t)F3[t]=String.fromCharCode(Vl.getUint8(t));return F3.join("")}u(Y_,"hashUint32x2");jL(Y_,"hashUint32x2");function ex(n,e,t){Vl.setFloat32(0,n||0),Vl.setFloat32(4,e||0),Vl.setFloat32(8,t||0);for(let s=0;s<12;++s)z3[s]=String.fromCharCode(Vl.getUint8(s));return z3.join("")}u(ex,"hashFloat32x3");jL(ex,"hashFloat32x3");var Mfe=Object.defineProperty,XL=u((n,e)=>Mfe(n,"name",{value:e,configurable:!0}),"__name$1s");const Ms=new P,My=new ss,Om=new ss,B3=new P,U3=new P,$3=new P,Sfe=new P;function q_(n,e){if(e.isLeaf=!1,e.depth>=Gr.MAX_DEPTH){e.isLeaf=!0;return}if(e.indices.length<=Gr.MAX_TRI_PER_NODE){e.isLeaf=!0;return}if(!e.indices.length){e.isLeaf=!0;return}Om.makeEmpty();for(let t of e.indices)Om.expandByPoint(n.getTriangleCenter(Ms,t));e.splitCenter.copy(Om.min).add(Om.max).multiplyScalar(.5),e.children.length=0;for(let t=0;t<8;++t){const s=new Gr;s.depth=e.depth+1,e.children.push(s)}for(let t of e.indices)n.getTriangleCenter(Ms,t),Ms.x<e.splitCenter.x?Ms.y<e.splitCenter.y?Ms.z<e.splitCenter.z?e.children[0].indices.push(t):e.children[1].indices.push(t):Ms.z<e.splitCenter.z?e.children[2].indices.push(t):e.children[3].indices.push(t):Ms.y<e.splitCenter.y?Ms.z<e.splitCenter.z?e.children[4].indices.push(t):e.children[5].indices.push(t):Ms.z<e.splitCenter.z?e.children[6].indices.push(t):e.children[7].indices.push(t)}u(q_,"constructChildren");XL(q_,"constructChildren");const b0=class{constructor(){A(this,"depth",1);A(this,"children",[]);A(this,"box",new ss);A(this,"splitCenter",new P);A(this,"isLeaf",!1);A(this,"indices",[])}build(e){this.indices.length=0;for(let s=0;s<e.triNum;++s)this.indices.push(s);const t=[this];for(;t.length;){const s=t.pop();if(!s)break;s.recomputeBox(e),q_(e,s),s.isLeaf||t.push(...s.children)}}recomputeBox(e){this.box.makeEmpty();for(let t of this.indices)this.box.union(e.getTriangleBox(My,t));this.box.expandByScalar(1e-7)}update(e,t){if(!t.length)return;const s=new Yr(e.triNum);for(let r of t)s.set(r);const i=new Set;{const r=[this];for(;r.length;){const o=r.pop();if(!o)break;let a=!1;if(o.depth===1)a=!0;else{const l=o.indices.filter(c=>!s.get(c));a=l.length!==o.indices.length,o.indices=l}a&&(o.indices.length?(i.add(o),r.push(...o.children)):(o.box.makeEmpty(),o.isLeaf=!0,o.children.length=0))}}{const r=[[this,t]];for(;r.length;){const o=r.pop();if(!o)break;const a=o[0],l=o[1];if(i.add(a),a.depth!==1&&a.indices.push(...l),a.isLeaf){if(a.indices.length<=b0.MAX_TRI_PER_NODE||a.depth>=b0.MAX_DEPTH)continue;const y=[a];for(;y.length;){const b=y.pop();if(!b)break;b.recomputeBox(e),q_(e,b),b.isLeaf||y.push(...b.children)}continue}const c=[],h=[],d=[],f=[],p=[],g=[],m=[],v=[];for(let y of l)e.getTriangleCenter(Ms,y),Ms.x<a.splitCenter.x?Ms.y<a.splitCenter.y?Ms.z<a.splitCenter.z?c.push(y):h.push(y):Ms.z<a.splitCenter.z?d.push(y):f.push(y):Ms.y<a.splitCenter.y?Ms.z<a.splitCenter.z?p.push(y):g.push(y):Ms.z<a.splitCenter.z?m.push(y):v.push(y);c.length&&r.push([a.children[0],c]),h.length&&r.push([a.children[1],h]),d.length&&r.push([a.children[2],d]),f.length&&r.push([a.children[3],f]),p.length&&r.push([a.children[4],p]),g.length&&r.push([a.children[5],g]),m.length&&r.push([a.children[6],m]),v.length&&r.push([a.children[7],v])}}for(let r of i)r.recomputeBox(e)}raycast(e,t,s){const i=[],r=[this],o=1/t.direction.x,a=1/t.direction.y,l=1/t.direction.z;for(;r.length;){const c=r.pop();if(!c)break;const h=(c.box.min.x-t.origin.x)*o,d=(c.box.max.x-t.origin.x)*o,f=(c.box.min.y-t.origin.y)*a,p=(c.box.max.y-t.origin.y)*a,g=(c.box.min.z-t.origin.z)*l,m=(c.box.max.z-t.origin.z)*l,v=Math.max(Math.min(h,d),Math.min(f,p),Math.min(g,m)),y=Math.min(Math.max(h,d),Math.max(f,p),Math.max(g,m));if(!(y<0||v>y))if(c.isLeaf)for(let b of c.indices){e.getTriangle(B3,U3,$3,b);const _=t.intersectTriangle(B3,U3,$3,s,Sfe);if(_){const w=new P().copy(_),x=e.getNormal(new P,b),S=t.origin.distanceTo(w);i.push({point:w,normal:x,distance:S,triangleIndex:b})}}else r.push(...c.children)}return i.sort((c,h)=>c.distance-h.distance)}intersectSphere(e,t){const s=[this],i=[];for(;s.length;){const r=s.pop();if(!r)break;if(!!r.box.intersectsSphere(t))if(r.isLeaf)for(let o of r.indices)e.getTriangleBox(My,o),My.intersectsSphere(t)&&i.push(o);else s.push(...r.children)}return i}};let Gr=b0;u(Gr,"OctreeNode"),A(Gr,"MAX_DEPTH",8),A(Gr,"MAX_TRI_PER_NODE",100);XL(Gr,"OctreeNode");var Cfe=Object.defineProperty,YL=u((n,e)=>Cfe(n,"name",{value:e,configurable:!0}),"__name$1r");const zn=new P,Cn=new P,Bn=new P,km=new P,Lr=new P,go=new P,Efe=new P,vs=1e-7;function zg(n,e){let t=n.x,s=n.y,i=n.z,r=e.x,o=e.y,a=e.z;return t=Math.round(t/vs)*vs,s=Math.round(s/vs)*vs,i=Math.round(i/vs)*vs,r=Math.round(r/vs)*vs,o=Math.round(o/vs)*vs,a=Math.round(a/vs)*vs,t===r&&s===o&&i===a}u(zg,"isSameVertex");YL(zg,"isSameVertex");class tx{constructor(){A(this,"aPosition",new Float32Array);A(this,"aColor",new Float32Array);A(this,"aNormal",new Float32Array);A(this,"triCenter",new Float32Array);A(this,"triBox",new Float32Array);A(this,"triNum",0);A(this,"sharedVertexMap",new Uint32Array);A(this,"sharedVertexIndices",new Map);A(this,"edgeNeighborMap",new Uint32Array);A(this,"holes",new Uint8Array);A(this,"octree",new Gr);A(this,"dirtyTriangles",[]);A(this,"dirtyTrianglesMask",new Yr);A(this,"positionNeedsUpdate",!1);A(this,"colorNeedsUpdate",!1)}buildFromTriangles(e,t){const s=this.aPosition=new Float32Array(e.length),i=this.aNormal=new Float32Array(e.length),r=this.aColor=new Float32Array(e.length);(t==null?void 0:t.length)!==r.length&&(t=void 0);let o=0;for(let a=0,l=e.length/9;a<l;++a)if(zn.fromArray(e,a*9),Cn.fromArray(e,a*9+3),Bn.fromArray(e,a*9+6),!(zg(zn,Cn)||zg(zn,Bn)||zg(Cn,Bn))){for(let c=0;c<9;++c)s[o*9+c]=e[a*9+c];if(t)for(let c=0;c<9;++c)r[o*9+c]=t[a*9+c];else for(let c=0;c<9;++c)r[o*9+c]=1;km.subVectors(zn,Cn),Lr.subVectors(Bn,Cn),Lr.cross(km).normalize();for(let c=0;c<3;++c){const h=o*9+c*3;i[h]=Lr.x,i[h+1]=Lr.y,i[h+2]=Lr.z}o+=1}o<e.length/9&&(this.aPosition=s.subarray(0,o*9),this.aNormal=i.subarray(0,o*9),this.aColor=r.subarray(0,o*9),console.info(`Discard ${e.length/9-o} zero area triangles`)),this.init()}init(){const e=this.aPosition,t=this.triNum=e.length/9,s=this.triCenter=new Float32Array(t*3),i=this.triBox=new Float32Array(t*6);for(let r=0;r<t;++r)zn.fromArray(e,r*9),Cn.fromArray(e,r*9+3),Bn.fromArray(e,r*9+6),go.copy(zn).add(Cn).add(Bn).multiplyScalar(1/3),s[r*3]=go.x,s[r*3+1]=go.y,s[r*3+2]=go.z,i[r*6]=Math.min(zn.x,Cn.x,Bn.x),i[r*6+1]=Math.min(zn.y,Cn.y,Bn.y),i[r*6+2]=Math.min(zn.z,Cn.z,Bn.z),i[r*6+3]=Math.max(zn.x,Cn.x,Bn.x),i[r*6+4]=Math.max(zn.y,Cn.y,Bn.y),i[r*6+5]=Math.max(zn.z,Cn.z,Bn.z);this.buildTriangleNeighborEdgeMap(),this.octree.build(this),this.dirtyTrianglesMask.expandCapacity(t)}buildTriangleNeighborEdgeMap(){const e=this.triNum,t=this.aPosition,s=this.sharedVertexMap=new Uint32Array(e*3),i=this.sharedVertexIndices;i.clear();const r=new Map;for(let p=0,g=e*3;p<g;++p){let m=t[p*3],v=t[p*3+1],y=t[p*3+2];m=Math.round(m/vs)*vs,v=Math.round(v/vs)*vs,y=Math.round(y/vs)*vs;const b=ex(m,v,y);let _=r.get(b);_==null?(_=p,r.set(b,_),i.set(_,[])):i.get(_).push(p),s[p]=_}const o=new Map,a=new Uint8Array(e);let l=0,c=0;for(let p=0;p<e;++p){let g=!1;for(let m=0;m<3;++m){const v=p*3+m,y=s[v],b=s[p*3+(m+1)%3];if(y===b){g=!0;break}}if(g){c+=1,a[p]=1;continue}for(let m=0;m<3;++m){const v=p*3+m,y=s[v],b=s[p*3+(m+1)%3],_=Y_(y,b);o.get(_)==null?o.set(_,v):l+=1}}c&&console.warn(`Mesh has ${c} zero area triangles`),l&&console.warn(`Mesh has ${l} duplicate edges (embedded faces may exist)`);const h=this.edgeNeighborMap=new Uint32Array(e*3),d=this.holes=new Uint8Array(e*3);let f=0;for(let p=0;p<e;++p)if(!a[p])for(let g=0;g<3;++g){const m=p*3+g,v=s[m],y=s[p*3+(g+1)%3],b=Y_(y,v),_=o.get(b);_==null?(d[m]=1,f+=1):h[m]=_}f&&console.warn(`Mesh has ${f} edges border hole`)}getTriangleCenter(e,t){return e.fromArray(this.triCenter,t*3),e}getTriangleBox(e,t){return e.min.fromArray(this.triBox,t*6),e.max.fromArray(this.triBox,t*6+3),e}getTriangle(e,t,s,i){e.fromArray(this.aPosition,this.sharedVertexMap[i*3]*3),t.fromArray(this.aPosition,this.sharedVertexMap[i*3+1]*3),s.fromArray(this.aPosition,this.sharedVertexMap[i*3+2]*3)}getVertex(e,t){return e.fromArray(this.aPosition,t*3)}getNormal(e,t){return e.fromArray(this.aNormal,t*3*3),e}getAverageNormal(e,t){e.set(0,0,0);for(let s of t)e.add(this.getNormal(Efe,s));return e.normalize()}getAverageCenter(e,t){e.set(0,0,0);for(let s of t)e.add(this.getTriangleCenter(go,s));return e.divideScalar(t.length)}toThree(e){if(e){const t=e,s=t.geometry.getAttribute("position");if(s.array===this.aPosition){if(this.positionNeedsUpdate){this.positionNeedsUpdate=!1,s.needsUpdate=!0;const i=t.geometry.getAttribute("normal");i.needsUpdate=!0}if(this.colorNeedsUpdate){this.colorNeedsUpdate=!1;const i=t.geometry.getAttribute("color");i.needsUpdate=!0}}else t.geometry.dispose(),t.geometry=new at,t.geometry.setAttribute("position",new We(this.aPosition,3)),t.geometry.setAttribute("normal",new We(this.aNormal,3)),t.geometry.setAttribute("color",new We(this.aColor,3));return t}else return new Ye(new at().setAttribute("position",new An(this.aPosition,3)).setAttribute("normal",new An(this.aNormal,3)).setAttribute("color",new An(this.aColor,3)),new nr({vertexColors:!0}))}raycast(e,t){return this.octree.raycast(this,e,t)}intersectSphere(e){return this.octree.intersectSphere(this,e)}getVertexTriangleIndex(e){return(e-e%3)/3}markTriangleDirty(e){this.dirtyTrianglesMask.get(e)||(this.dirtyTrianglesMask.set(e),this.dirtyTriangles.push(e))}updateVertices(e,t){const s=this.aPosition;for(let i=0,r=e.length;i<r;++i){const o=this.sharedVertexMap[e[i]];this.markTriangleDirty(this.getVertexTriangleIndex(o));for(let l=0;l<3;++l)s[o*3+l]=t[i*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a){this.markTriangleDirty(this.getVertexTriangleIndex(l));for(let c=0;c<3;++c)s[l*3+c]=t[i*3+c]}}this.positionNeedsUpdate=!0}updateColors(e,t){const s=this.aColor;for(let i=0,r=e.length;i<r;++i){const o=this.sharedVertexMap[e[i]];for(let l=0;l<3;++l)s[o*3+l]=t[i*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a)for(let c=0;c<3;++c)s[l*3+c]=t[i*3+c]}this.colorNeedsUpdate=!0}update(e){const t=this.dirtyTriangles,s=this.aPosition,i=this.aNormal,r=this.triCenter,o=this.triBox;let a=0,l=0,c=0,h=0,d=0,f=0,p=!1;if(e!=null&&e.boundingSphere){p=!0;const g=e.boundingSphere.center,m=e.boundingSphere.radius;a=g.x-m,l=g.y-m,c=g.z-m,h=g.x+m,d=g.y+m,f=g.z+m}for(let g of t){zn.fromArray(s,g*9),Cn.fromArray(s,g*9+3),Bn.fromArray(s,g*9+6),km.subVectors(zn,Cn),Lr.subVectors(Bn,Cn),Lr.cross(km).normalize();for(let m=0;m<3;++m){const v=g*9+m*3;i[v]=Lr.x,i[v+1]=Lr.y,i[v+2]=Lr.z}go.copy(zn).add(Cn).add(Bn).multiplyScalar(1/3),r[g*3]=go.x,r[g*3+1]=go.y,r[g*3+2]=go.z,o[g*6]=Math.min(zn.x,Cn.x,Bn.x),o[g*6+1]=Math.min(zn.y,Cn.y,Bn.y),o[g*6+2]=Math.min(zn.z,Cn.z,Bn.z),o[g*6+3]=Math.max(zn.x,Cn.x,Bn.x),o[g*6+4]=Math.max(zn.y,Cn.y,Bn.y),o[g*6+5]=Math.max(zn.z,Cn.z,Bn.z),p&&(a=Math.min(o[g*6],a),l=Math.min(o[g*6+1],l),c=Math.min(o[g*6+2],c),h=Math.max(o[g*6+3],h),d=Math.max(o[g*6+4],d),f=Math.max(o[g*6+5],f))}if(p){const g=e.boundingSphere;g.center.set((h+a)/2,(d+l)/2,(f+c)/2),g.radius=Math.max(h-g.center.x,g.center.x-a,d-g.center.y,g.center.y-l,f-g.center.z,g.center.z-c)}this.octree.update(this,t),this.dirtyTriangles.length=0,this.dirtyTrianglesMask.clear()}}u(tx,"DynamicMesh");YL(tx,"DynamicMesh");var Tfe=Object.defineProperty,qL=u((n,e)=>Tfe(n,"name",{value:e,configurable:!0}),"__name$1q");const Sy=new Int8Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),bi=new Uint16Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);function Ci(n,e){return n/(n-e)}u(Ci,"getAlpha");qL(Ci,"getAlpha");const ut=new Float32Array(12*3),ht=new Float32Array(12*3),Ze=new P,wn=new P;function nx(n,e,t,s,i,r,o,a,l,c,h,d,f,p,g,m,v){const y=a[c],b=a[h],_=a[d],w=a[f],x=a[p],S=a[g],C=a[m],M=a[v],R=!!(t&&l);let D=0;if(y<0&&(D|=1<<0),b<0&&(D|=1<<1),_<0&&(D|=1<<2),w<0&&(D|=1<<3),x<0&&(D|=1<<4),S<0&&(D|=1<<5),C<0&&(D|=1<<6),M<0&&(D|=1<<7),bi[D]!==0){if(bi[D]&1<<0){const k=Ci(y,b);ut[0]=s+k*o,ut[1]=i,ut[2]=r,R&&(Ze.fromArray(l,c*3),wn.fromArray(l,h*3),Ze.lerp(wn,k),ht[0]=Ze.x,ht[1]=Ze.y,ht[2]=Ze.z)}if(bi[D]&1<<1){const k=Ci(b,_);ut[3]=s+o,ut[3+1]=i,ut[3+2]=r+k*o,R&&(Ze.fromArray(l,h*3),wn.fromArray(l,d*3),Ze.lerp(wn,k),ht[3]=Ze.x,ht[3+1]=Ze.y,ht[3+2]=Ze.z)}if(bi[D]&1<<2){const k=Ci(w,_);ut[3*2]=s+k*o,ut[3*2+1]=i,ut[3*2+2]=r+o,R&&(Ze.fromArray(l,f*3),wn.fromArray(l,d*3),Ze.lerp(wn,k),ht[3*2]=Ze.x,ht[3*2+1]=Ze.y,ht[3*2+2]=Ze.z)}if(bi[D]&1<<3){const k=Ci(y,w);ut[3*3]=s,ut[3*3+1]=i,ut[3*3+2]=r+k*o,R&&(Ze.fromArray(l,c*3),wn.fromArray(l,f*3),Ze.lerp(wn,k),ht[3*3]=Ze.x,ht[3*3+1]=Ze.y,ht[3*3+2]=Ze.z)}if(bi[D]&1<<4){const k=Ci(x,S);ut[3*4]=s+k*o,ut[3*4+1]=i+o,ut[3*4+2]=r,R&&(Ze.fromArray(l,p*3),wn.fromArray(l,g*3),Ze.lerp(wn,k),ht[3*4]=Ze.x,ht[3*4+1]=Ze.y,ht[3*4+2]=Ze.z)}if(bi[D]&1<<5){const k=Ci(S,C);ut[3*5]=s+o,ut[3*5+1]=i+o,ut[3*5+2]=r+k*o,R&&(Ze.fromArray(l,g*3),wn.fromArray(l,m*3),Ze.lerp(wn,k),ht[3*5]=Ze.x,ht[3*5+1]=Ze.y,ht[3*5+2]=Ze.z)}if(bi[D]&1<<6){const k=Ci(M,C);ut[3*6]=s+k*o,ut[3*6+1]=i+o,ut[3*6+2]=r+o,R&&(Ze.fromArray(l,v*3),wn.fromArray(l,m*3),Ze.lerp(wn,k),ht[3*6]=Ze.x,ht[3*6+1]=Ze.y,ht[3*6+2]=Ze.z)}if(bi[D]&1<<7){const k=Ci(x,M);ut[3*7]=s,ut[3*7+1]=i+o,ut[3*7+2]=r+k*o,R&&(Ze.fromArray(l,p*3),wn.fromArray(l,v*3),Ze.lerp(wn,k),ht[3*7]=Ze.x,ht[3*7+1]=Ze.y,ht[3*7+2]=Ze.z)}if(bi[D]&1<<8){const k=Ci(y,x);ut[3*8]=s,ut[3*8+1]=i+k*o,ut[3*8+2]=r,R&&(Ze.fromArray(l,c*3),wn.fromArray(l,p*3),Ze.lerp(wn,k),ht[3*8]=Ze.x,ht[3*8+1]=Ze.y,ht[3*8+2]=Ze.z)}if(bi[D]&1<<9){const k=Ci(b,S);ut[3*9]=s+o,ut[3*9+1]=i+k*o,ut[3*9+2]=r,R&&(Ze.fromArray(l,h*3),wn.fromArray(l,g*3),Ze.lerp(wn,k),ht[3*9]=Ze.x,ht[3*9+1]=Ze.y,ht[3*9+2]=Ze.z)}if(bi[D]&1<<10){const k=Ci(_,C);ut[3*10]=s+o,ut[3*10+1]=i+k*o,ut[3*10+2]=r+o,R&&(Ze.fromArray(l,d*3),wn.fromArray(l,m*3),Ze.lerp(wn,k),ht[3*10]=Ze.x,ht[3*10+1]=Ze.y,ht[3*10+2]=Ze.z)}if(bi[D]&1<<11){const k=Ci(w,M);ut[3*11]=s,ut[3*11+1]=i+k*o,ut[3*11+2]=r+o,R&&(Ze.fromArray(l,f*3),wn.fromArray(l,v*3),Ze.lerp(wn,k),ht[3*11]=Ze.x,ht[3*11+1]=Ze.y,ht[3*11+2]=Ze.z)}for(let k=0;;k+=3){const T=Sy[D*16+k];if(T===-1)break;const N=Sy[D*16+k+1],E=Sy[D*16+k+2],z=ut[T*3],H=ut[T*3+1],q=ut[T*3+2],ne=ut[N*3],W=ut[N*3+1],se=ut[N*3+2],K=ut[E*3],U=ut[E*3+1],he=ut[E*3+2];if(n.push(z,H,q,ne,W,se,K,U,he),R&&t.push(ht[T*3],ht[T*3+1],ht[T*3+2],ht[N*3],ht[N*3+1],ht[N*3+2],ht[E*3],ht[E*3+1],ht[E*3+2]),e){const ue=ne-z,Q=W-H,te=se-q,_e=ne-K,pe=W-U,Ae=se-he,Me=Q*Ae-te*pe,Ie=te*_e-ue*Ae,$=ue*pe-Q*_e,X=1/Math.sqrt(Me**2+Ie**2+$**2),I=-Me*X,J=-Ie*X,Z=-$*X;e.push(I,J,Z,I,J,Z,I,J,Z)}}}}u(nx,"marchingCubes");qL(nx,"marchingCubes");var Pfe=Object.defineProperty,Qa=u((n,e)=>Pfe(n,"name",{value:e,configurable:!0}),"__name$1p");function KL(n,e,t,s,i,r,o){return Math.sqrt((n-s)**2+(e-i)**2+(t-r)**2)-o}u(KL,"sphere");Qa(KL,"sphere");function ZL(n,e,t,s,i,r,o,a,l,c,h){const d=a-s,f=l-i,p=c-r,g=d**2+f**2+p**2,m=o-h,v=g-m**2,y=1/g,b=n-s,_=e-i,w=t-r,x=b*d+_*f+w*p,S=x-g,C=(b*g-d*x)**2+(_*g-f*x)**2+(w*g-p*x)**2,M=x**2*g,R=S**2*g,D=Math.sign(m)*m*m*C;return Math.sign(S)*v*R>D?Math.sqrt(C+R)*y-h:Math.sign(x)*v*M<D?Math.sqrt(C+M)*y-o:(Math.sqrt(C*v*y)+x*m)*y-o}u(ZL,"roundCone");Qa(ZL,"roundCone");function Rfe(n,e){return Math.min(n,e)}u(Rfe,"merge");Qa(Rfe,"merge");function QL(n,e,t){const s=Math.max(0,Math.min(1,.5+.5*(e-n)/t));return e*(1-s)+n*s-t*s*(1-s)}u(QL,"mergeSmooth");Qa(QL,"mergeSmooth");function JL(n,e){return Math.max(n,e)}u(JL,"intersect");Qa(JL,"intersect");function eO(n,e,t){const s=Math.max(0,Math.min(1,.5-.5*(e-n)/t));return e*(1-s)+n*s+t*s*(1-s)}u(eO,"intersectSmooth");Qa(eO,"intersectSmooth");function Ife(n,e){return JL(n,-e)}u(Ife,"subtract");Qa(Ife,"subtract");function tO(n,e,t){return eO(n,-e,t)}u(tO,"subtractSmooth");Qa(tO,"subtractSmooth");var Dfe=Object.defineProperty,sx=u((n,e)=>Dfe(n,"name",{value:e,configurable:!0}),"__name$1o");class dp{constructor(e,t,s){A(this,"position");A(this,"radius");A(this,"operator");A(this,"bb");A(this,"fatBb",new ss);this.position=e,this.radius=t,this.operator=s,this.bb=new ss().expandByPoint(e).expandByScalar(t)}createSymmetry(e){const t=new P().copy(this.position);return t.setComponent(e,-t.getComponent(e)),new dp(t,this.radius,this.operator)}sdf(e,t,s){return KL(e,t,s,this.position.x,this.position.y,this.position.z,this.radius)}}u(dp,"SdfSphere");sx(dp,"SdfSphere");class fp{constructor(e,t,s,i,r){A(this,"p1");A(this,"r1");A(this,"p2");A(this,"r2");A(this,"operator");A(this,"bb");A(this,"fatBb",new ss);this.p1=e,this.r1=t,this.p2=s,this.r2=i,this.operator=r,this.bb=new ss().union(new ss().expandByPoint(e).expandByScalar(t)).union(new ss().expandByPoint(s).expandByScalar(i))}createSymmetry(e){const t=new P().copy(this.p1).setComponent(e,-this.p1.getComponent(e)),s=new P().copy(this.p2).setComponent(e,-this.p2.getComponent(e));return new fp(t,this.r1,s,this.r2,this.operator)}sdf(e,t,s){return ZL(e,t,s,this.p1.x,this.p1.y,this.p1.z,this.r1,this.p2.x,this.p2.y,this.p2.z,this.r2)}}u(fp,"SdfRoundCone");sx(fp,"SdfRoundCone");const Wc=new P;class I1{constructor(){A(this,"resolution",.003);A(this,"maxResolutionSeg",100);A(this,"symmetryAxis",-1);A(this,"smoothRange",.01);A(this,"shapes",[])}sphere(e,t,s){if(t<=0)return;const i=new dp(e,t,s);this.shapes.push(i),this.symmetryAxis>=0&&this.shapes.push(i.createSymmetry(this.symmetryAxis))}roundCone(e,t,s,i,r){if(t<=0&&i<=0)return;if(Wc.subVectors(e,s).length()+Math.min(t,i)<=Math.max(t,i))return t>i?this.sphere(e,t,r):this.sphere(s,i,r);const a=new fp(e,t,s,i,r);this.shapes.push(a),this.symmetryAxis>=0&&this.shapes.push(a.createSymmetry(this.symmetryAxis))}build(){const e=new ss;for(let y of this.shapes)y.operator&&e.union(y.bb);if(e.isEmpty())return{position:[],normal:[]};e.getSize(Wc);let t=Math.max(this.resolution,Math.max(Wc.x,Wc.y,Wc.z)/this.maxResolutionSeg);const s=this.smoothRange;for(let y of this.shapes)y.fatBb.copy(y.bb).expandByScalar(t+s);const i=e.min.x-t-s,r=e.min.y-t-s,o=e.min.z-t-s,a=e.max.x+t+s,l=e.max.y+t+s,c=e.max.z+t+s,h=Math.ceil((a-i)/t),d=Math.ceil((l-r)/t),f=Math.ceil((c-o)/t),p=new Float32Array(h*d*f),g=new Yr(p.length);for(let y=0;y<h;++y){const b=i+y*t;for(let _=0;_<d;++_){const w=r+_*t;for(let x=0;x<f;++x){const S=o+x*t,C=y*d*f+_*f+x;for(let M of this.shapes)if(!!M.fatBb.containsPoint(Wc.set(b,w,S)))if(M.operator)g.get(C)?p[C]=QL(p[C],M.sdf(b,w,S),s):(g.set(C),p[C]=M.sdf(b,w,S));else{if(!g.get(C))continue;p[C]=tO(p[C],M.sdf(b,w,S),s)}}}}const m=[],v=[];for(let y=0;y<h-1;++y){const b=i+y*t;for(let _=0;_<d-1;++_){const w=r+_*t;for(let x=0;x<f-1;++x){const S=o+x*t;!g.get(y*d*f+_*f+x)||nx(m,v,null,b,w,S,t,p,null,y*d*f+_*f+x,(y+1)*d*f+_*f+x,(y+1)*d*f+_*f+(x+1),y*d*f+_*f+(x+1),y*d*f+(_+1)*f+x,(y+1)*d*f+(_+1)*f+x,(y+1)*d*f+(_+1)*f+(x+1),y*d*f+(_+1)*f+(x+1))}}}return{position:m,normal:v}}}u(I1,"SdfMeshBuilder");sx(I1,"SdfMeshBuilder");var Lfe=Object.defineProperty,Ofe=u((n,e)=>Lfe(n,"name",{value:e,configurable:!0}),"__name$1n");class ix{update(e,t){var l;if(t.instanceId||t.type!=="Clay")return;const s=t.get(Mn),i=t.get(Mr);if(!s.dirty&&!i.dirty)return;s.dirty=!1,i.dirty=!1;const r=s.partialUpdate||i.partialUpdate;if(s.partialUpdate=!1,i.partialUpdate=!1,s.value.length===0){const c=new I1;c.sphere(new P(0,0,0),.25,!0);const{position:h}=c.build();s.value=new Float32Array(h),i.value=new Float32Array(h.length);for(let d=0,f=i.value.length;d<f;++d)i.value[d]=1}const o=t.get(Pe);!o.mesh||!r?(o.mesh=new tx,o.mesh.buildFromTriangles(s.value,i.value),s.value=new Float32Array(o.mesh.aPosition),i.value=new Float32Array(o.mesh.aColor)):o.mesh.update((l=o.value)==null?void 0:l.geometry),r||o.dispose();const a=o.value;o.value?o.mesh.toThree(o.value):(o.value=o.mesh.toThree(),o.value.userData={node:t},o.parentChanged=!0,o.localTransformChanged=!0),e.model.instanceMeshUpdated(t.id,a!==o.value)}}u(ix,"ClayUpdateFilter");Ofe(ix,"ClayUpdateFilter");var kfe=Object.defineProperty,Nfe=u((n,e)=>kfe(n,"name",{value:e,configurable:!0}),"__name$1m");class rx{update(e,t){if(t.type==="Container"){const s=t.get(Pe);s.value||(s.value=new ls,s.value.userData={node:t}),t.instanceId&&(t.instanceMeshDirty=!1)}}}u(rx,"ContainerUpdateFilter");Nfe(rx,"ContainerUpdateFilter");var Ffe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntlsEOwCAIQ8vCf+u+HC8z0WnUMEh2oDc09PVkJQAZjmIAEJHkYU5EN7eDpXkNzbPDr2rD8upSo3fIAfAoK/2HvUtpdKwABCAAAfgDwPo13QOs67MDWNdmB3Arfjh/WwpBzho97mV7igAAAABJRU5ErkJggg==",zfe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAALhJREFUSIntVdsOwjAIHcb/HvtyfAFCESjVGmPieVuBc8k2CkcPuHiuuHeIieiMigAwFcoEBmIAuKImU58KDeTE4AF99vD1SMAnQCI6xfFCAu3nNGESFBfeYZXW9/sk6UtmVxW5OgWA9EMI3TeI2xy3F4j2KO/i+niCv8D3BQS//R+UDt6dTXeR2YxHIYbSm/FYAZSlFazr1ATX7bqeLsmtF05sbf3KvOxcRyAUehouiLsCg9DCueIBQtEIj3OkCCMAAAAASUVORK5CYII=",Bfe=Object.defineProperty,Ufe=u((n,e)=>Bfe(n,"name",{value:e,configurable:!0}),"__name$1l");const nO=new sp,K_=nO.load(Ffe);K_.minFilter=K_.magFilter=Wn;const Z_=nO.load(zfe);Z_.minFilter=Z_.magFilter=Wn;class ox{update(e,t){var i,r,o,a;if(t.type!=="IKChain")return;t.instanceId&&(t.instanceMeshDirty=!1);const s=t.get(Pe);s.value||(s.value=new ls,s.value.userData={node:t});for(let l=0,c=t.children.length;l<c;++l){const h=t.children[l];h.instanceId&&(h.instanceMeshDirty=!1);const d=h.get(Pe);d.value||(d.value=new ls,d.value.userData={node:h});const f=h.get(Et);if(!f.dirty)continue;if(!f.boneMesh){const S=f.boneMesh=new Ye;S.material=new Fs({depthWrite:!1,depthTest:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5,color:7829367}),S.renderOrder=1,S.visible=e.options.showIkBones,d.value.add(S)}const p=f.boneMesh,g=h.value(Js),m=p.geometry;((i=m==null?void 0:m.parameters)==null?void 0:i.height)!==g&&((r=p.geometry)==null||r.dispose(),p.geometry=new Y0(.003,g,6).translate(0,h.value(Js)/2,0).rotateZ(-Math.PI/2));const v=h.value($a);let y=v[0]/180*Math.PI,b=v[1]/180*Math.PI;if(h.instanceId&&h.has(Xn)){const S=h.value(Xn);switch(h.value(di)){case"horizontal":S.z>1e-6&&([y,b]=[-b,-y]);break;case"vertical":S.y>1e-6&&([y,b]=[-b,-y]);break}}if(!f.hingeIndicator){const S=f.hingeIndicator=new Ye;S.material=new Fs({depthWrite:!1,depthTest:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5,color:16777215,side:Di}),S.renderOrder=1}const _=f.hingeIndicator;_.visible=e.options.showIkBones&&h.value(di)!=="none";const w=l===0?t.value(Pe):t.children[l-1].value(Pe);_.parent!==w&&w.add(_);const x=_.geometry;switch((!x||((o=x==null?void 0:x.parameters)==null?void 0:o.thetaStart)!==y||((a=x==null?void 0:x.parameters)==null?void 0:a.thetaLength)!==b-y)&&(x==null||x.dispose(),_.geometry=new $u(.025,32,y,b-y)),h.value(di)){case"horizontal":_.rotation.set(-Math.PI/2,0,0),f.hingeEnabled=!0,_.material.color.setHex(65535);break;case"vertical":_.rotation.set(0,0,0),f.hingeEnabled=!0,_.material.color.setHex(16776960);break;default:f.hingeEnabled=!1;break}if(l===0?_.position.set(0,0,0):_.position.set(t.children[l-1].value(Js),0,0),f.moveHandler||(f.moveHandler=new Oa(new at().setFromPoints([new P]),new Hr({map:K_,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),f.moveHandler.renderOrder=2,d.value.add(f.moveHandler),f.moveHandler.visible=!1),f.rotateHandler||(f.rotateHandler=new Oa(new at().setFromPoints([new P]),new Hr({map:Z_,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),f.rotateHandler.renderOrder=2,d.value.add(f.rotateHandler),f.rotateHandler.visible=!1),f.dirty=!1,f.quaternion.setFromEuler(h.value(En)),l>0){const S=t.children[l-1].get(Et);f.start.copy(S.end),f.quaternion.multiplyQuaternions(S.quaternion,f.quaternion).normalize()}else f.start.set(0,0,0);f.end.set(h.value(Js),0,0).applyQuaternion(f.quaternion).add(f.start),f.rotateHandler.position.set(g,0,0)}}}u(ox,"IkChainUpdateFilter");Ufe(ox,"IkChainUpdateFilter");var $fe=Object.defineProperty,Vfe=u((n,e)=>$fe(n,"name",{value:e,configurable:!0}),"__name$1k");class ax extends at{constructor(e=1,t=1,s=1,i=1){super(),this.type="DoubleSidedPlaneGeometry";const r=e/2,o=t/2,a=Math.floor(s),l=Math.floor(i),c=a+1,h=l+1,d=e/a,f=t/l,p=[],g=[],m=[],v=[];for(let b=0;b<2;++b)for(let _=0;_<h;_++){const w=_*f-o;for(let x=0;x<c;x++){const S=x*d-r;g.push(S,-w,0),m.push(0,0,b===0?1:-1),v.push(x/a),v.push(1-_/l)}}const y=c*h;for(let b=0;b<l;b++)for(let _=0;_<a;_++){const w=_+c*b,x=_+c*(b+1),S=_+1+c*(b+1),C=_+1+c*b;p.push(w,x,C),p.push(x,S,C),p.push(w+y,C+y,S+y),p.push(w+y,S+y,x+y)}this.setIndex(p),this.setAttribute("position",new We(g,3)),this.setAttribute("normal",new We(m,3)),this.setAttribute("uv",new We(v,2))}}u(ax,"DoubleSidedPlaneGeometry");Vfe(ax,"DoubleSidedPlaneGeometry");var Gfe=Object.defineProperty,Hfe=u((n,e)=>Gfe(n,"name",{value:e,configurable:!0}),"__name$1j");class lx{update(e,t){if(t.instanceId||!t.has(Kr))return;const s=t.get(Kr);if(!s.dirty||(s.dirty=!1,!s.value))return;const i=new Image;i.onload=function(){if(t.deleted||i.src!==s.value)return;s.texture&&s.texture.dispose();const r=s.texture=new is;if(s.texture.image=i,s.texture.needsUpdate=!0,t.type!=="Image")return;const o=t.get(Pe);o.dispose();const a=1,l=i.height/i.width*a;o.value=new Ye(new ax(a,l),new Gb({map:r})),o.value.userData={node:t},e.model.dirty=!0,t.dirty=!0,o.parentChanged=!0,o.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)},i.src=s.value}}u(lx,"ImageUpdateFilter");Hfe(lx,"ImageUpdateFilter");var sO={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(n,e){(function(t){n.exports=t()})(function(){return u(function t(s,i,r){function o(c,h){if(!i[c]){if(!s[c]){var d=typeof dm=="function"&&dm;if(!h&&d)return d(c,!0);if(a)return a(c,!0);var f=new Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f}var p=i[c]={exports:{}};s[c][0].call(p.exports,function(g){var m=s[c][1][g];return o(m||g)},p,p.exports,t,s,i,r)}return i[c].exports}u(o,"u");for(var a=typeof dm=="function"&&dm,l=0;l<r.length;l++)o(r[l]);return o},"s")({1:[function(t,s,i){var r=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var c,h,d,f,p,g,m,v=[],y=0,b=l.length,_=b,w=r.getTypeOf(l)!=="string";y<l.length;)_=b-y,d=w?(c=l[y++],h=y<b?l[y++]:0,y<b?l[y++]:0):(c=l.charCodeAt(y++),h=y<b?l.charCodeAt(y++):0,y<b?l.charCodeAt(y++):0),f=c>>2,p=(3&c)<<4|h>>4,g=1<_?(15&h)<<2|d>>6:64,m=2<_?63&d:64,v.push(a.charAt(f)+a.charAt(p)+a.charAt(g)+a.charAt(m));return v.join("")},i.decode=function(l){var c,h,d,f,p,g,m=0,v=0,y="data:";if(l.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&_--,l.charAt(l.length-2)===a.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|_):new Array(0|_);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(f=a.indexOf(l.charAt(m++)))>>4,h=(15&f)<<4|(p=a.indexOf(l.charAt(m++)))>>2,d=(3&p)<<6|(g=a.indexOf(l.charAt(m++))),b[v++]=c,p!==64&&(b[v++]=h),g!==64&&(b[v++]=d);return b}},{"./support":30,"./utils":32}],2:[function(t,s,i){var r=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(h,d,f,p,g){this.compressedSize=h,this.uncompressedSize=d,this.crc32=f,this.compression=p,this.compressedContent=g}u(c,"o"),c.prototype={getContentWorker:function(){var h=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return h.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,d,f){return h.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var r=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var r=t("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var h=0;h<8;h++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();s.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,h,d,f){var p=o,g=f+d;c^=-1;for(var m=f;m<g;m++)c=c>>>8^p[255&(c^h[m])];return-1^c}(0|l,a,a.length,0):function(c,h,d,f){var p=o,g=f+d;c^=-1;for(var m=f;m<g;m++)c=c>>>8^p[255&(c^h.charCodeAt(m))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var r=null;r=typeof Promise!="undefined"?Promise:t("lie"),s.exports={Promise:r}},{lie:37}],7:[function(t,s,i){var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",o=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=r?"uint8array":"array";function h(d,f){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}u(h,"h"),i.magic="\b\0",a.inherits(h,l),h.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,d.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},i.compressWorker=function(d){return new h("Deflate",d)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function r(p,g){var m,v="";for(m=0;m<g;m++)v+=String.fromCharCode(255&p),p>>>=8;return v}u(r,"A");function o(p,g,m,v,y,b){var _,w,x=p.file,S=p.compression,C=b!==c.utf8encode,M=a.transformTo("string",b(x.name)),R=a.transformTo("string",c.utf8encode(x.name)),D=x.comment,k=a.transformTo("string",b(D)),T=a.transformTo("string",c.utf8encode(D)),N=R.length!==x.name.length,E=T.length!==D.length,z="",H="",q="",ne=x.dir,W=x.date,se={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(se.crc32=p.crc32,se.compressedSize=p.compressedSize,se.uncompressedSize=p.uncompressedSize);var K=0;g&&(K|=8),C||!N&&!E||(K|=2048);var U=0,he=0;ne&&(U|=16),y==="UNIX"?(he=798,U|=function(Q,te){var _e=Q;return Q||(_e=te?16893:33204),(65535&_e)<<16}(x.unixPermissions,ne)):(he=20,U|=function(Q){return 63&(Q||0)}(x.dosPermissions)),_=W.getUTCHours(),_<<=6,_|=W.getUTCMinutes(),_<<=5,_|=W.getUTCSeconds()/2,w=W.getUTCFullYear()-1980,w<<=4,w|=W.getUTCMonth()+1,w<<=5,w|=W.getUTCDate(),N&&(H=r(1,1)+r(h(M),4)+R,z+="up"+r(H.length,2)+H),E&&(q=r(1,1)+r(h(k),4)+T,z+="uc"+r(q.length,2)+q);var ue="";return ue+=`
\0`,ue+=r(K,2),ue+=S.magic,ue+=r(_,2),ue+=r(w,2),ue+=r(se.crc32,4),ue+=r(se.compressedSize,4),ue+=r(se.uncompressedSize,4),ue+=r(M.length,2),ue+=r(z.length,2),{fileRecord:d.LOCAL_FILE_HEADER+ue+M+z,dirRecord:d.CENTRAL_FILE_HEADER+r(he,2)+ue+r(k.length,2)+"\0\0\0\0"+r(U,4)+r(v,4)+M+z+k}}u(o,"n");var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),h=t("../crc32"),d=t("../signature");function f(p,g,m,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=v,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}u(f,"s"),a.inherits(f,l),f.prototype.push=function(p){var g=p.meta.percent||0,m=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-v-1))/m:100}}))},f.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var g=this.streamFiles&&!p.file.dir;if(g){var m=o(p,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(p){this.accumulate=!1;var g=this.streamFiles&&!p.file.dir,m=o(p,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(v){return d.DATA_DESCRIPTOR+r(v.crc32,4)+r(v.compressedSize,4)+r(v.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var p=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-p,v=function(y,b,_,w,x){var S=a.transformTo("string",x(w));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(y,2)+r(y,2)+r(b,4)+r(_,4)+r(S.length,2)+S}(this.dirRecords.length,m,p,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(p){this._sources.push(p);var g=this;return p.on("data",function(m){g.processChunk(m)}),p.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),p.on("error",function(m){g.error(m)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(p){var g=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var m=0;m<g.length;m++)try{g[m].error(p)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,g=0;g<p.length;g++)p[g].lock()},s.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var r=t("../compressions"),o=t("./ZipFileWorker");i.generateWorker=function(a,l,c){var h=new o(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{a.forEach(function(f,p){d++;var g=function(b,_){var w=b||_,x=r[w];if(!x)throw new Error(w+" is not a valid compression method !");return x}(p.options.compression,l.compression),m=p.options.compressionOptions||l.compressionOptions||{},v=p.dir,y=p.date;p._compressWorker(g,m).withStreamInfo("file",{name:f,dir:v,date:y,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(h)}),h.entriesCount=d}catch(f){h.error(f)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}u(r,"n"),(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=t("./external"),s.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var r=t("./utils"),o=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function d(f){return new o.Promise(function(p,g){var m=f.decompressed.getContentWorker().pipe(new c);m.on("error",function(v){g(v)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}u(d,"f"),s.exports=function(f,p){var g=this;return p=r.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),h.isNode&&h.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(m){var v=new l(p);return v.load(m),v}).then(function(m){var v=[o.Promise.resolve(m)],y=m.files;if(p.checkCRC32)for(var b=0;b<y.length;b++)v.push(d(y[b]));return o.Promise.all(v)}).then(function(m){for(var v=m.shift(),y=v.files,b=0;b<y.length;b++){var _=y[b],w=_.fileNameStr,x=r.resolve(_.fileNameStr);g.file(x,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:p.createFolders}),_.dir||(g.file(x).unsafeOriginalName=w)}return v.zipComment.length&&(g.comment=v.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var r=t("../utils"),o=t("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}u(a,"s"),r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var r=t("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var h=this;a.on("data",function(d,f){h.push(d)||h._helper.pause(),c&&c(f)}).on("error",function(d){h.emit("error",d)}).on("end",function(){h.push(null)})}u(o,"n"),t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},s.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,s,i){function r(x,S,C){var M,R=a.getTypeOf(S),D=a.extend(C||{},h);D.date=D.date||new Date,D.compression!==null&&(D.compression=D.compression.toUpperCase()),typeof D.unixPermissions=="string"&&(D.unixPermissions=parseInt(D.unixPermissions,8)),D.unixPermissions&&16384&D.unixPermissions&&(D.dir=!0),D.dosPermissions&&16&D.dosPermissions&&(D.dir=!0),D.dir&&(x=y(x)),D.createFolders&&(M=v(x))&&b.call(this,M,!0);var k=R==="string"&&D.binary===!1&&D.base64===!1;C&&C.binary!==void 0||(D.binary=!k),(S instanceof d&&S.uncompressedSize===0||D.dir||!S||S.length===0)&&(D.base64=!1,D.binary=!0,S="",D.compression="STORE",R="string");var T=null;T=S instanceof d||S instanceof l?S:g.isNode&&g.isStream(S)?new m(x,S):a.prepareContent(x,S,D.binary,D.optimizedBinaryString,D.base64);var N=new f(x,T,D);this.files[x]=N}u(r,"s");var o=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),h=t("./defaults"),d=t("./compressedObject"),f=t("./zipObject"),p=t("./generate"),g=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),v=u(function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var S=x.lastIndexOf("/");return 0<S?x.substring(0,S):""},"_"),y=u(function(x){return x.slice(-1)!=="/"&&(x+="/"),x},"g"),b=u(function(x,S){return S=S!==void 0?S:h.createFolders,x=y(x),this.files[x]||r.call(this,x,null,{dir:!0,createFolders:S}),this.files[x]},"b");function _(x){return Object.prototype.toString.call(x)==="[object RegExp]"}u(_,"h");var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var S,C,M;for(S in this.files)M=this.files[S],(C=S.slice(this.root.length,S.length))&&S.slice(0,this.root.length)===this.root&&x(C,M)},filter:function(x){var S=[];return this.forEach(function(C,M){x(C,M)&&S.push(M)}),S},file:function(x,S,C){if(arguments.length!==1)return x=this.root+x,r.call(this,x,S,C),this;if(_(x)){var M=x;return this.filter(function(D,k){return!k.dir&&M.test(D)})}var R=this.files[this.root+x];return R&&!R.dir?R:null},folder:function(x){if(!x)return this;if(_(x))return this.filter(function(R,D){return D.dir&&x.test(R)});var S=this.root+x,C=b.call(this,S),M=this.clone();return M.root=C.name,M},remove:function(x){x=this.root+x;var S=this.files[x];if(S||(x.slice(-1)!=="/"&&(x+="/"),S=this.files[x]),S&&!S.dir)delete this.files[x];else for(var C=this.filter(function(R,D){return D.name.slice(0,x.length)===x}),M=0;M<C.length;M++)delete this.files[C[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var S,C={};try{if((C=a.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=C.type.toLowerCase(),C.compression=C.compression.toUpperCase(),C.type==="binarystring"&&(C.type="string"),!C.type)throw new Error("No output type specified.");a.checkSupport(C.type),C.platform!=="darwin"&&C.platform!=="freebsd"&&C.platform!=="linux"&&C.platform!=="sunos"||(C.platform="UNIX"),C.platform==="win32"&&(C.platform="DOS");var M=C.comment||this.comment||"";S=p.generateWorker(this,C,M)}catch(R){(S=new l("error")).error(R)}return new c(S,C.type||"string",C.mimeType)},generateAsync:function(x,S){return this.generateInternalStream(x).accumulate(S)},generateNodeStream:function(x,S){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(S)}};s.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var r=t("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}u(o,"i"),t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===c&&this.data[f+2]===h&&this.data[f+3]===d)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),h=a.charCodeAt(2),d=a.charCodeAt(3),f=this.readData(4);return l===f[0]&&c===f[1]&&h===f[2]&&d===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var r=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}u(o,"i"),o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},s.exports=o},{"../utils":32}],19:[function(t,s,i){var r=t("./Uint8ArrayReader");function o(a){r.call(this,a)}u(o,"i"),t("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var r=t("./DataReader");function o(a){r.call(this,a)}u(o,"i"),t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var r=t("./ArrayReader");function o(a){r.call(this,a)}u(o,"i"),t("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var r=t("../utils"),o=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");s.exports=function(d){var f=r.getTypeOf(d);return r.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new c(d):o.uint8array?new h(r.transformTo("uint8array",d)):new a(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var r=t("./GenericWorker"),o=t("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}u(a,"s"),o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},s.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var r=t("./GenericWorker"),o=t("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}u(a,"s"),t("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}u(a,"s"),r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},s.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=r.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}u(a,"s"),r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}u(r,"n"),r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},s.exports=r},{}],29:[function(t,s,i){var r=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),h=t("../external"),d=null;if(c.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(g,m){return new h.Promise(function(v,y){var b=[],_=g._internalType,w=g._outputType,x=g._mimeType;g.on("data",function(S,C){b.push(S),m&&m(C)}).on("error",function(S){b=[],y(S)}).on("end",function(){try{var S=function(C,M,R){switch(C){case"blob":return r.newBlob(r.transformTo("arraybuffer",M),R);case"base64":return l.encode(M);default:return r.transformTo(C,M)}}(w,function(C,M){var R,D=0,k=null,T=0;for(R=0;R<M.length;R++)T+=M[R].length;switch(C){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(k=new Uint8Array(T),R=0;R<M.length;R++)k.set(M[R],D),D+=M[R].length;return k;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+C+"'")}}(_,b),x);v(S)}catch(C){y(C)}b=[]}).resume()})}u(f,"l");function p(g,m,v){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=v,r.checkSupport(y),this._worker=g.pipe(new o(y)),g.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}u(p,"f"),p.prototype={accumulate:function(g){return f(this,g)},on:function(g,m){var v=this;return g==="data"?this._worker.on(g,function(y){m.call(v,y.data,y.meta)}):this._worker.on(g,function(){r.delay(m,arguments,v)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},s.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",i.nodebuffer=typeof Buffer!="undefined",i.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var r=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}u(d,"a");function f(){l.call(this,"utf-8 encode")}u(f,"l"),i.utf8encode=function(p){return o.nodebuffer?a.newBufferFrom(p,"utf-8"):function(g){var m,v,y,b,_,w=g.length,x=0;for(b=0;b<w;b++)(64512&(v=g.charCodeAt(b)))==55296&&b+1<w&&(64512&(y=g.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),b++),x+=v<128?1:v<2048?2:v<65536?3:4;for(m=o.uint8array?new Uint8Array(x):new Array(x),b=_=0;_<x;b++)(64512&(v=g.charCodeAt(b)))==55296&&b+1<w&&(64512&(y=g.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),b++),v<128?m[_++]=v:(v<2048?m[_++]=192|v>>>6:(v<65536?m[_++]=224|v>>>12:(m[_++]=240|v>>>18,m[_++]=128|v>>>12&63),m[_++]=128|v>>>6&63),m[_++]=128|63&v);return m}(p)},i.utf8decode=function(p){return o.nodebuffer?r.transformTo("nodebuffer",p).toString("utf-8"):function(g){var m,v,y,b,_=g.length,w=new Array(2*_);for(m=v=0;m<_;)if((y=g[m++])<128)w[v++]=y;else if(4<(b=c[y]))w[v++]=65533,m+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&m<_;)y=y<<6|63&g[m++],b--;1<b?w[v++]=65533:y<65536?w[v++]=y:(y-=65536,w[v++]=55296|y>>10&1023,w[v++]=56320|1023&y)}return w.length!==v&&(w.subarray?w=w.subarray(0,v):w.length=v),r.applyFromCharCode(w)}(p=r.transformTo(o.uint8array?"uint8array":"array",p))},r.inherits(d,l),d.prototype.processChunk=function(p){var g=r.transformTo(o.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var v=function(b,_){var w;for((_=_||b.length)>b.length&&(_=b.length),w=_-1;0<=w&&(192&b[w])==128;)w--;return w<0||w===0?_:w+c[b[w]]>_?w:_}(g),y=g;v!==g.length&&(o.uint8array?(y=g.subarray(0,v),this.leftOver=g.subarray(v,g.length)):(y=g.slice(0,v),this.leftOver=g.slice(v,g.length))),this.push({data:i.utf8decode(y),meta:p.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,r.inherits(f,l),f.prototype.processChunk=function(p){this.push({data:i.utf8encode(p.data),meta:p.meta})},i.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var r=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(m){return m}u(c,"n");function h(m,v){for(var y=0;y<m.length;++y)v[y]=255&m.charCodeAt(y);return v}u(h,"l"),t("setimmediate"),i.newBlob=function(m,v){i.checkSupport("blob");try{return new Blob([m],{type:v})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(m,v,y){var b=[],_=0,w=m.length;if(w<=y)return String.fromCharCode.apply(null,m);for(;_<w;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(_,Math.min(_+y,w)))):b.push(String.fromCharCode.apply(null,m.subarray(_,Math.min(_+y,w)))),_+=y;return b.join("")},stringifyByChar:function(m){for(var v="",y=0;y<m.length;y++)v+=String.fromCharCode(m[y]);return v},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var v=65536,y=i.getTypeOf(m),b=!0;if(y==="uint8array"?b=d.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=d.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return d.stringifyByChunk(m,y,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(m)}u(f,"s");function p(m,v){for(var y=0;y<m.length;y++)v[y]=m[y];return v}u(p,"f"),i.applyFromCharCode=f;var g={};g.string={string:c,array:function(m){return h(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return h(m,new Uint8Array(m.length))},nodebuffer:function(m){return h(m,a.allocBuffer(m.length))}},g.array={string:f,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},g.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return p(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:f,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},g.nodebuffer={string:f,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return p(m,new Uint8Array(m.length))},nodebuffer:c},i.transformTo=function(m,v){if(v=v||"",!m)return v;i.checkSupport(m);var y=i.getTypeOf(v);return g[y][m](v)},i.resolve=function(m){for(var v=m.split("/"),y=[],b=0;b<v.length;b++){var _=v[b];_==="."||_===""&&b!==0&&b!==v.length-1||(_===".."?y.pop():y.push(_))}return y.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var v,y,b="";for(y=0;y<(m||"").length;y++)b+="\\x"+((v=m.charCodeAt(y))<16?"0":"")+v.toString(16).toUpperCase();return b},i.delay=function(m,v,y){setImmediate(function(){m.apply(y||null,v||[])})},i.inherits=function(m,v){function y(){}u(y,"r"),y.prototype=v.prototype,m.prototype=new y},i.extend=function(){var m,v,y={};for(m=0;m<arguments.length;m++)for(v in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],v)&&y[v]===void 0&&(y[v]=arguments[m][v]);return y},i.prepareContent=function(m,v,y,b,_){return l.Promise.resolve(v).then(function(w){return r.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader!="undefined"?new l.Promise(function(x,S){var C=new FileReader;C.onload=function(M){x(M.target.result)},C.onerror=function(M){S(M.target.error)},C.readAsArrayBuffer(w)}):w}).then(function(w){var x=i.getTypeOf(w);return x?(x==="arraybuffer"?w=i.transformTo("uint8array",w):x==="string"&&(_?w=o.decode(w):y&&b!==!0&&(w=function(S){return h(S,r.uint8array?new Uint8Array(S.length):new Array(S.length))}(w))),w):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function h(d){this.files=[],this.loadOptions=d}u(h,"h"),h.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(d)+")")}},isSignature:function(d,f){var p=this.reader.index;this.reader.setIndex(d);var g=this.reader.readString(4)===f;return this.reader.setIndex(p),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=c.uint8array?"uint8array":"array",p=o.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,p,g=this.zip64EndOfCentralSize-44;0<g;)d=this.reader.readInt(2),f=this.reader.readInt(4),p=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var g=f-p;if(0<g)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(d){this.reader=r(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),h=t("./compressions"),d=t("./support");function f(p,g){this.options=p,this.loadOptions=g}u(f,"l"),f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var g,m;if(p.skip(22),this.fileNameLength=p.readInt(2),m=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(v){for(var y in h)if(Object.prototype.hasOwnProperty.call(h,y)&&h[y].magic===v)return h[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,g,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var g=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(g),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var g,m,v,y=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<y;)g=p.readInt(2),m=p.readInt(2),v=p.readData(m),this.extraFields[g]={id:g,length:m,value:v};p.setIndex(y)},handleUTF8:function(){var p=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=o.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var y=o.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var g=r(p.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var g=r(p.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(p.length-5))}return null}},s.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function r(g,m,v){this.name=g,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=m,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}u(r,"n");var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),h=t("./stream/GenericWorker");r.prototype={internalStream:function(g){var m=null,v="string";try{if(!g)throw new Error("No output type specified.");var y=(v=g.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(m=m.pipe(new l.Utf8EncodeWorker)),!b&&y&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(_){(m=new h("error")).error(_)}return new o(m,v,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(v,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<d.length;p++)r.prototype[d[p]]=f;s.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,h=new l(g),d=r.document.createTextNode("");h.observe(d,{characterData:!0}),o=u(function(){d.data=c=++c%2},"r")}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var f=new r.MessageChannel;f.port1.onmessage=g,o=u(function(){f.port2.postMessage(0)},"r")}var p=[];function g(){var m,v;a=!0;for(var y=p.length;y;){for(v=p,p=[],m=-1;++m<y;)v[m]();y=p.length}a=!1}u(g,"u"),s.exports=function(m){p.push(m)!==1||a||o()}}).call(this,typeof hm!="undefined"?hm:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(t,s,i){var r=t("immediate");function o(){}u(o,"u");var a={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function d(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,y!==o&&m(this,y)}u(d,"o");function f(y,b,_){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}u(f,"h");function p(y,b,_){r(function(){var w;try{w=b(_)}catch(x){return a.reject(y,x)}w===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,w)})}u(p,"f");function g(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}u(g,"c");function m(y,b){var _=!1;function w(C){_||(_=!0,a.reject(y,C))}u(w,"n");function x(C){_||(_=!0,a.resolve(y,C))}u(x,"i");var S=v(function(){b(x,w)});S.status==="error"&&w(S.value)}u(m,"d");function v(y,b){var _={};try{_.value=y(b),_.status="success"}catch(w){_.status="error",_.value=w}return _}u(v,"p"),(s.exports=d).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(_){return b.resolve(y()).then(function(){return _})},function(_){return b.resolve(y()).then(function(){throw _})})},d.prototype.catch=function(y){return this.then(null,y)},d.prototype.then=function(y,b){if(typeof y!="function"&&this.state===c||typeof b!="function"&&this.state===l)return this;var _=new this.constructor(o);return this.state!==h?p(_,this.state===c?y:b,this.outcome):this.queue.push(new f(_,y,b)),_},f.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},f.prototype.otherCallFulfilled=function(y){p(this.promise,this.onFulfilled,y)},f.prototype.callRejected=function(y){a.reject(this.promise,y)},f.prototype.otherCallRejected=function(y){p(this.promise,this.onRejected,y)},a.resolve=function(y,b){var _=v(g,b);if(_.status==="error")return a.reject(y,_.value);var w=_.value;if(w)m(y,w);else{y.state=c,y.outcome=b;for(var x=-1,S=y.queue.length;++x<S;)y.queue[x].callFulfilled(b)}return y},a.reject=function(y,b){y.state=l,y.outcome=b;for(var _=-1,w=y.queue.length;++_<w;)y.queue[_].callRejected(b);return y},d.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},d.reject=function(y){var b=new this(o);return a.reject(b,y)},d.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,w=!1;if(!_)return this.resolve([]);for(var x=new Array(_),S=0,C=-1,M=new this(o);++C<_;)R(y[C],C);return M;function R(D,k){b.resolve(D).then(function(T){x[k]=T,++S!==_||w||(w=!0,a.resolve(M,x))},function(T){w||(w=!0,a.reject(M,T))})}},d.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,w=!1;if(!_)return this.resolve([]);for(var x=-1,S=new this(o);++x<_;)C=y[x],b.resolve(C).then(function(M){w||(w=!0,a.resolve(S,M))},function(M){w||(w=!0,a.reject(S,M))});var C;return S}},{immediate:36}],38:[function(t,s,i){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var r=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),h=Object.prototype.toString,d=0,f=-1,p=0,g=8;function m(y){if(!(this instanceof m))return new m(y);this.options=o.assign({level:f,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var _=r.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(_!==d)throw new Error(l[_]);if(b.header&&r.deflateSetHeader(this.strm,b.header),b.dictionary){var w;if(w=typeof b.dictionary=="string"?a.string2buf(b.dictionary):h.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(_=r.deflateSetDictionary(this.strm,w))!==d)throw new Error(l[_]);this._dict_set=!0}}u(m,"p");function v(y,b){var _=new m(b);if(_.push(y,!0),_.err)throw _.msg||l[_.err];return _.result}u(v,"n"),m.prototype.push=function(y,b){var _,w,x=this.strm,S=this.options.chunkSize;if(this.ended)return!1;w=b===~~b?b:b===!0?4:0,typeof y=="string"?x.input=a.string2buf(y):h.call(y)==="[object ArrayBuffer]"?x.input=new Uint8Array(y):x.input=y,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(S),x.next_out=0,x.avail_out=S),(_=r.deflate(x,w))!==1&&_!==d)return this.onEnd(_),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&_!==1);return w===4?(_=r.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===d):w!==2||(this.onEnd(d),!(x.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=m,i.deflate=v,i.deflateRaw=function(y,b){return(b=b||{}).raw=!0,v(y,b)},i.gzip=function(y,b){return(b=b||{}).gzip=!0,v(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var r=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),h=t("./zlib/zstream"),d=t("./zlib/gzheader"),f=Object.prototype.toString;function p(m){if(!(this instanceof p))return new p(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||m&&m.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var y=r.inflateInit2(this.strm,v.windowBits);if(y!==l.Z_OK)throw new Error(c[y]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}u(p,"a");function g(m,v){var y=new p(v);if(y.push(m,!0),y.err)throw y.msg||c[y.err];return y.result}u(g,"o"),p.prototype.push=function(m,v){var y,b,_,w,x,S,C=this.strm,M=this.options.chunkSize,R=this.options.dictionary,D=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?C.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?C.input=new Uint8Array(m):C.input=m,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new o.Buf8(M),C.next_out=0,C.avail_out=M),(y=r.inflate(C,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&R&&(S=typeof R=="string"?a.string2buf(R):f.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,y=r.inflateSetDictionary(this.strm,S)),y===l.Z_BUF_ERROR&&D===!0&&(y=l.Z_OK,D=!1),y!==l.Z_STREAM_END&&y!==l.Z_OK)return this.onEnd(y),!(this.ended=!0);C.next_out&&(C.avail_out!==0&&y!==l.Z_STREAM_END&&(C.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=a.utf8border(C.output,C.next_out),w=C.next_out-_,x=a.buf2string(C.output,_),C.next_out=w,C.avail_out=M-w,w&&o.arraySet(C.output,C.output,_,w,0),this.onData(x)):this.onData(o.shrinkBuf(C.output,C.next_out)))),C.avail_in===0&&C.avail_out===0&&(D=!0)}while((0<C.avail_in||C.avail_out===0)&&y!==l.Z_STREAM_END);return y===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(y=r.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(C.avail_out=0))},p.prototype.onData=function(m){this.chunks.push(m)},p.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=p,i.inflate=g,i.inflateRaw=function(m,v){return(v=v||{}).raw=!0,g(m,v)},i.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";i.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var d in h)h.hasOwnProperty(d)&&(l[d]=h[d])}}return l},i.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,h,d,f){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+d),f);else for(var p=0;p<d;p++)l[f+p]=c[h+p]},flattenChunks:function(l){var c,h,d,f,p,g;for(c=d=0,h=l.length;c<h;c++)d+=l[c].length;for(g=new Uint8Array(d),c=f=0,h=l.length;c<h;c++)p=l[c],g.set(p,f),f+=p.length;return g}},a={arraySet:function(l,c,h,d,f){for(var p=0;p<d;p++)l[f+p]=c[h+p]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,a))},i.setTyped(r)},{}],42:[function(t,s,i){var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(d,f){if(f<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(d,f));for(var p="",g=0;g<f;g++)p+=String.fromCharCode(d[g]);return p}u(h,"l"),l[254]=l[254]=1,i.string2buf=function(d){var f,p,g,m,v,y=d.length,b=0;for(m=0;m<y;m++)(64512&(p=d.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=d.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),m++),b+=p<128?1:p<2048?2:p<65536?3:4;for(f=new r.Buf8(b),m=v=0;v<b;m++)(64512&(p=d.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=d.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),m++),p<128?f[v++]=p:(p<2048?f[v++]=192|p>>>6:(p<65536?f[v++]=224|p>>>12:(f[v++]=240|p>>>18,f[v++]=128|p>>>12&63),f[v++]=128|p>>>6&63),f[v++]=128|63&p);return f},i.buf2binstring=function(d){return h(d,d.length)},i.binstring2buf=function(d){for(var f=new r.Buf8(d.length),p=0,g=f.length;p<g;p++)f[p]=d.charCodeAt(p);return f},i.buf2string=function(d,f){var p,g,m,v,y=f||d.length,b=new Array(2*y);for(p=g=0;p<y;)if((m=d[p++])<128)b[g++]=m;else if(4<(v=l[m]))b[g++]=65533,p+=v-1;else{for(m&=v===2?31:v===3?15:7;1<v&&p<y;)m=m<<6|63&d[p++],v--;1<v?b[g++]=65533:m<65536?b[g++]=m:(m-=65536,b[g++]=55296|m>>10&1023,b[g++]=56320|1023&m)}return h(b,g)},i.utf8border=function(d,f){var p;for((f=f||d.length)>d.length&&(f=d.length),p=f-1;0<=p&&(192&d[p])==128;)p--;return p<0||p===0?f:p+l[d[p]]>f?p:f}},{"./common":41}],43:[function(t,s,i){s.exports=function(r,o,a,l){for(var c=65535&r|0,h=r>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;h=h+(c=c+o[l++]|0)|0,--d;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();s.exports=function(o,a,l,c){var h=r,d=c+l;o^=-1;for(var f=c;f<d;f++)o=o>>>8^h[255&(o^a[f])];return-1^o}},{}],46:[function(t,s,i){var r,o=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),h=t("./messages"),d=0,f=4,p=0,g=-2,m=-1,v=4,y=2,b=8,_=9,w=286,x=30,S=19,C=2*w+1,M=15,R=3,D=258,k=D+R+1,T=42,N=113,E=1,z=2,H=3,q=4;function ne(I,J){return I.msg=h[J],J}u(ne,"R");function W(I){return(I<<1)-(4<I?9:0)}u(W,"T");function se(I){for(var J=I.length;0<=--J;)I[J]=0}u(se,"D");function K(I){var J=I.state,Z=J.pending;Z>I.avail_out&&(Z=I.avail_out),Z!==0&&(o.arraySet(I.output,J.pending_buf,J.pending_out,Z,I.next_out),I.next_out+=Z,J.pending_out+=Z,I.total_out+=Z,I.avail_out-=Z,J.pending-=Z,J.pending===0&&(J.pending_out=0))}u(K,"F");function U(I,J){a._tr_flush_block(I,0<=I.block_start?I.block_start:-1,I.strstart-I.block_start,J),I.block_start=I.strstart,K(I.strm)}u(U,"N");function he(I,J){I.pending_buf[I.pending++]=J}u(he,"U");function ue(I,J){I.pending_buf[I.pending++]=J>>>8&255,I.pending_buf[I.pending++]=255&J}u(ue,"P");function Q(I,J){var Z,B,F=I.max_chain_length,V=I.strstart,ae=I.prev_length,oe=I.nice_match,L=I.strstart>I.w_size-k?I.strstart-(I.w_size-k):0,O=I.window,ee=I.w_mask,ie=I.prev,ce=I.strstart+D,ye=O[V+ae-1],Ce=O[V+ae];I.prev_length>=I.good_match&&(F>>=2),oe>I.lookahead&&(oe=I.lookahead);do if(O[(Z=J)+ae]===Ce&&O[Z+ae-1]===ye&&O[Z]===O[V]&&O[++Z]===O[V+1]){V+=2,Z++;do;while(O[++V]===O[++Z]&&O[++V]===O[++Z]&&O[++V]===O[++Z]&&O[++V]===O[++Z]&&O[++V]===O[++Z]&&O[++V]===O[++Z]&&O[++V]===O[++Z]&&O[++V]===O[++Z]&&V<ce);if(B=D-(ce-V),V=ce-D,ae<B){if(I.match_start=J,oe<=(ae=B))break;ye=O[V+ae-1],Ce=O[V+ae]}}while((J=ie[J&ee])>L&&--F!=0);return ae<=I.lookahead?ae:I.lookahead}u(Q,"L");function te(I){var J,Z,B,F,V,ae,oe,L,O,ee,ie=I.w_size;do{if(F=I.window_size-I.lookahead-I.strstart,I.strstart>=ie+(ie-k)){for(o.arraySet(I.window,I.window,ie,ie,0),I.match_start-=ie,I.strstart-=ie,I.block_start-=ie,J=Z=I.hash_size;B=I.head[--J],I.head[J]=ie<=B?B-ie:0,--Z;);for(J=Z=ie;B=I.prev[--J],I.prev[J]=ie<=B?B-ie:0,--Z;);F+=ie}if(I.strm.avail_in===0)break;if(ae=I.strm,oe=I.window,L=I.strstart+I.lookahead,O=F,ee=void 0,ee=ae.avail_in,O<ee&&(ee=O),Z=ee===0?0:(ae.avail_in-=ee,o.arraySet(oe,ae.input,ae.next_in,ee,L),ae.state.wrap===1?ae.adler=l(ae.adler,oe,ee,L):ae.state.wrap===2&&(ae.adler=c(ae.adler,oe,ee,L)),ae.next_in+=ee,ae.total_in+=ee,ee),I.lookahead+=Z,I.lookahead+I.insert>=R)for(V=I.strstart-I.insert,I.ins_h=I.window[V],I.ins_h=(I.ins_h<<I.hash_shift^I.window[V+1])&I.hash_mask;I.insert&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[V+R-1])&I.hash_mask,I.prev[V&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=V,V++,I.insert--,!(I.lookahead+I.insert<R)););}while(I.lookahead<k&&I.strm.avail_in!==0)}u(te,"j");function _e(I,J){for(var Z,B;;){if(I.lookahead<k){if(te(I),I.lookahead<k&&J===d)return E;if(I.lookahead===0)break}if(Z=0,I.lookahead>=R&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+R-1])&I.hash_mask,Z=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),Z!==0&&I.strstart-Z<=I.w_size-k&&(I.match_length=Q(I,Z)),I.match_length>=R)if(B=a._tr_tally(I,I.strstart-I.match_start,I.match_length-R),I.lookahead-=I.match_length,I.match_length<=I.max_lazy_match&&I.lookahead>=R){for(I.match_length--;I.strstart++,I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+R-1])&I.hash_mask,Z=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart,--I.match_length!=0;);I.strstart++}else I.strstart+=I.match_length,I.match_length=0,I.ins_h=I.window[I.strstart],I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+1])&I.hash_mask;else B=a._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++;if(B&&(U(I,!1),I.strm.avail_out===0))return E}return I.insert=I.strstart<R-1?I.strstart:R-1,J===f?(U(I,!0),I.strm.avail_out===0?H:q):I.last_lit&&(U(I,!1),I.strm.avail_out===0)?E:z}u(_e,"Z");function pe(I,J){for(var Z,B,F;;){if(I.lookahead<k){if(te(I),I.lookahead<k&&J===d)return E;if(I.lookahead===0)break}if(Z=0,I.lookahead>=R&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+R-1])&I.hash_mask,Z=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),I.prev_length=I.match_length,I.prev_match=I.match_start,I.match_length=R-1,Z!==0&&I.prev_length<I.max_lazy_match&&I.strstart-Z<=I.w_size-k&&(I.match_length=Q(I,Z),I.match_length<=5&&(I.strategy===1||I.match_length===R&&4096<I.strstart-I.match_start)&&(I.match_length=R-1)),I.prev_length>=R&&I.match_length<=I.prev_length){for(F=I.strstart+I.lookahead-R,B=a._tr_tally(I,I.strstart-1-I.prev_match,I.prev_length-R),I.lookahead-=I.prev_length-1,I.prev_length-=2;++I.strstart<=F&&(I.ins_h=(I.ins_h<<I.hash_shift^I.window[I.strstart+R-1])&I.hash_mask,Z=I.prev[I.strstart&I.w_mask]=I.head[I.ins_h],I.head[I.ins_h]=I.strstart),--I.prev_length!=0;);if(I.match_available=0,I.match_length=R-1,I.strstart++,B&&(U(I,!1),I.strm.avail_out===0))return E}else if(I.match_available){if((B=a._tr_tally(I,0,I.window[I.strstart-1]))&&U(I,!1),I.strstart++,I.lookahead--,I.strm.avail_out===0)return E}else I.match_available=1,I.strstart++,I.lookahead--}return I.match_available&&(B=a._tr_tally(I,0,I.window[I.strstart-1]),I.match_available=0),I.insert=I.strstart<R-1?I.strstart:R-1,J===f?(U(I,!0),I.strm.avail_out===0?H:q):I.last_lit&&(U(I,!1),I.strm.avail_out===0)?E:z}u(pe,"W");function Ae(I,J,Z,B,F){this.good_length=I,this.max_lazy=J,this.nice_length=Z,this.max_chain=B,this.func=F}u(Ae,"M");function Me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*C),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*S+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(M+1),this.heap=new o.Buf16(2*w+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*w+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}u(Me,"H");function Ie(I){var J;return I&&I.state?(I.total_in=I.total_out=0,I.data_type=y,(J=I.state).pending=0,J.pending_out=0,J.wrap<0&&(J.wrap=-J.wrap),J.status=J.wrap?T:N,I.adler=J.wrap===2?0:1,J.last_flush=d,a._tr_init(J),p):ne(I,g)}u(Ie,"G");function $(I){var J=Ie(I);return J===p&&function(Z){Z.window_size=2*Z.w_size,se(Z.head),Z.max_lazy_match=r[Z.level].max_lazy,Z.good_match=r[Z.level].good_length,Z.nice_match=r[Z.level].nice_length,Z.max_chain_length=r[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=R-1,Z.match_available=0,Z.ins_h=0}(I.state),J}u($,"K");function X(I,J,Z,B,F,V){if(!I)return g;var ae=1;if(J===m&&(J=6),B<0?(ae=0,B=-B):15<B&&(ae=2,B-=16),F<1||_<F||Z!==b||B<8||15<B||J<0||9<J||V<0||v<V)return ne(I,g);B===8&&(B=9);var oe=new Me;return(I.state=oe).strm=I,oe.wrap=ae,oe.gzhead=null,oe.w_bits=B,oe.w_size=1<<oe.w_bits,oe.w_mask=oe.w_size-1,oe.hash_bits=F+7,oe.hash_size=1<<oe.hash_bits,oe.hash_mask=oe.hash_size-1,oe.hash_shift=~~((oe.hash_bits+R-1)/R),oe.window=new o.Buf8(2*oe.w_size),oe.head=new o.Buf16(oe.hash_size),oe.prev=new o.Buf16(oe.w_size),oe.lit_bufsize=1<<F+6,oe.pending_buf_size=4*oe.lit_bufsize,oe.pending_buf=new o.Buf8(oe.pending_buf_size),oe.d_buf=1*oe.lit_bufsize,oe.l_buf=3*oe.lit_bufsize,oe.level=J,oe.strategy=V,oe.method=Z,$(I)}u(X,"Y"),r=[new Ae(0,0,0,0,function(I,J){var Z=65535;for(Z>I.pending_buf_size-5&&(Z=I.pending_buf_size-5);;){if(I.lookahead<=1){if(te(I),I.lookahead===0&&J===d)return E;if(I.lookahead===0)break}I.strstart+=I.lookahead,I.lookahead=0;var B=I.block_start+Z;if((I.strstart===0||I.strstart>=B)&&(I.lookahead=I.strstart-B,I.strstart=B,U(I,!1),I.strm.avail_out===0)||I.strstart-I.block_start>=I.w_size-k&&(U(I,!1),I.strm.avail_out===0))return E}return I.insert=0,J===f?(U(I,!0),I.strm.avail_out===0?H:q):(I.strstart>I.block_start&&(U(I,!1),I.strm.avail_out),E)}),new Ae(4,4,8,4,_e),new Ae(4,5,16,8,_e),new Ae(4,6,32,32,_e),new Ae(4,4,16,16,pe),new Ae(8,16,32,32,pe),new Ae(8,16,128,128,pe),new Ae(8,32,128,256,pe),new Ae(32,128,258,1024,pe),new Ae(32,258,258,4096,pe)],i.deflateInit=function(I,J){return X(I,J,b,15,8,0)},i.deflateInit2=X,i.deflateReset=$,i.deflateResetKeep=Ie,i.deflateSetHeader=function(I,J){return I&&I.state?I.state.wrap!==2?g:(I.state.gzhead=J,p):g},i.deflate=function(I,J){var Z,B,F,V;if(!I||!I.state||5<J||J<0)return I?ne(I,g):g;if(B=I.state,!I.output||!I.input&&I.avail_in!==0||B.status===666&&J!==f)return ne(I,I.avail_out===0?-5:g);if(B.strm=I,Z=B.last_flush,B.last_flush=J,B.status===T)if(B.wrap===2)I.adler=0,he(B,31),he(B,139),he(B,8),B.gzhead?(he(B,(B.gzhead.text?1:0)+(B.gzhead.hcrc?2:0)+(B.gzhead.extra?4:0)+(B.gzhead.name?8:0)+(B.gzhead.comment?16:0)),he(B,255&B.gzhead.time),he(B,B.gzhead.time>>8&255),he(B,B.gzhead.time>>16&255),he(B,B.gzhead.time>>24&255),he(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),he(B,255&B.gzhead.os),B.gzhead.extra&&B.gzhead.extra.length&&(he(B,255&B.gzhead.extra.length),he(B,B.gzhead.extra.length>>8&255)),B.gzhead.hcrc&&(I.adler=c(I.adler,B.pending_buf,B.pending,0)),B.gzindex=0,B.status=69):(he(B,0),he(B,0),he(B,0),he(B,0),he(B,0),he(B,B.level===9?2:2<=B.strategy||B.level<2?4:0),he(B,3),B.status=N);else{var ae=b+(B.w_bits-8<<4)<<8;ae|=(2<=B.strategy||B.level<2?0:B.level<6?1:B.level===6?2:3)<<6,B.strstart!==0&&(ae|=32),ae+=31-ae%31,B.status=N,ue(B,ae),B.strstart!==0&&(ue(B,I.adler>>>16),ue(B,65535&I.adler)),I.adler=1}if(B.status===69)if(B.gzhead.extra){for(F=B.pending;B.gzindex<(65535&B.gzhead.extra.length)&&(B.pending!==B.pending_buf_size||(B.gzhead.hcrc&&B.pending>F&&(I.adler=c(I.adler,B.pending_buf,B.pending-F,F)),K(I),F=B.pending,B.pending!==B.pending_buf_size));)he(B,255&B.gzhead.extra[B.gzindex]),B.gzindex++;B.gzhead.hcrc&&B.pending>F&&(I.adler=c(I.adler,B.pending_buf,B.pending-F,F)),B.gzindex===B.gzhead.extra.length&&(B.gzindex=0,B.status=73)}else B.status=73;if(B.status===73)if(B.gzhead.name){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(I.adler=c(I.adler,B.pending_buf,B.pending-F,F)),K(I),F=B.pending,B.pending===B.pending_buf_size)){V=1;break}V=B.gzindex<B.gzhead.name.length?255&B.gzhead.name.charCodeAt(B.gzindex++):0,he(B,V)}while(V!==0);B.gzhead.hcrc&&B.pending>F&&(I.adler=c(I.adler,B.pending_buf,B.pending-F,F)),V===0&&(B.gzindex=0,B.status=91)}else B.status=91;if(B.status===91)if(B.gzhead.comment){F=B.pending;do{if(B.pending===B.pending_buf_size&&(B.gzhead.hcrc&&B.pending>F&&(I.adler=c(I.adler,B.pending_buf,B.pending-F,F)),K(I),F=B.pending,B.pending===B.pending_buf_size)){V=1;break}V=B.gzindex<B.gzhead.comment.length?255&B.gzhead.comment.charCodeAt(B.gzindex++):0,he(B,V)}while(V!==0);B.gzhead.hcrc&&B.pending>F&&(I.adler=c(I.adler,B.pending_buf,B.pending-F,F)),V===0&&(B.status=103)}else B.status=103;if(B.status===103&&(B.gzhead.hcrc?(B.pending+2>B.pending_buf_size&&K(I),B.pending+2<=B.pending_buf_size&&(he(B,255&I.adler),he(B,I.adler>>8&255),I.adler=0,B.status=N)):B.status=N),B.pending!==0){if(K(I),I.avail_out===0)return B.last_flush=-1,p}else if(I.avail_in===0&&W(J)<=W(Z)&&J!==f)return ne(I,-5);if(B.status===666&&I.avail_in!==0)return ne(I,-5);if(I.avail_in!==0||B.lookahead!==0||J!==d&&B.status!==666){var oe=B.strategy===2?function(L,O){for(var ee;;){if(L.lookahead===0&&(te(L),L.lookahead===0)){if(O===d)return E;break}if(L.match_length=0,ee=a._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++,ee&&(U(L,!1),L.strm.avail_out===0))return E}return L.insert=0,O===f?(U(L,!0),L.strm.avail_out===0?H:q):L.last_lit&&(U(L,!1),L.strm.avail_out===0)?E:z}(B,J):B.strategy===3?function(L,O){for(var ee,ie,ce,ye,Ce=L.window;;){if(L.lookahead<=D){if(te(L),L.lookahead<=D&&O===d)return E;if(L.lookahead===0)break}if(L.match_length=0,L.lookahead>=R&&0<L.strstart&&(ie=Ce[ce=L.strstart-1])===Ce[++ce]&&ie===Ce[++ce]&&ie===Ce[++ce]){ye=L.strstart+D;do;while(ie===Ce[++ce]&&ie===Ce[++ce]&&ie===Ce[++ce]&&ie===Ce[++ce]&&ie===Ce[++ce]&&ie===Ce[++ce]&&ie===Ce[++ce]&&ie===Ce[++ce]&&ce<ye);L.match_length=D-(ye-ce),L.match_length>L.lookahead&&(L.match_length=L.lookahead)}if(L.match_length>=R?(ee=a._tr_tally(L,1,L.match_length-R),L.lookahead-=L.match_length,L.strstart+=L.match_length,L.match_length=0):(ee=a._tr_tally(L,0,L.window[L.strstart]),L.lookahead--,L.strstart++),ee&&(U(L,!1),L.strm.avail_out===0))return E}return L.insert=0,O===f?(U(L,!0),L.strm.avail_out===0?H:q):L.last_lit&&(U(L,!1),L.strm.avail_out===0)?E:z}(B,J):r[B.level].func(B,J);if(oe!==H&&oe!==q||(B.status=666),oe===E||oe===H)return I.avail_out===0&&(B.last_flush=-1),p;if(oe===z&&(J===1?a._tr_align(B):J!==5&&(a._tr_stored_block(B,0,0,!1),J===3&&(se(B.head),B.lookahead===0&&(B.strstart=0,B.block_start=0,B.insert=0))),K(I),I.avail_out===0))return B.last_flush=-1,p}return J!==f?p:B.wrap<=0?1:(B.wrap===2?(he(B,255&I.adler),he(B,I.adler>>8&255),he(B,I.adler>>16&255),he(B,I.adler>>24&255),he(B,255&I.total_in),he(B,I.total_in>>8&255),he(B,I.total_in>>16&255),he(B,I.total_in>>24&255)):(ue(B,I.adler>>>16),ue(B,65535&I.adler)),K(I),0<B.wrap&&(B.wrap=-B.wrap),B.pending!==0?p:1)},i.deflateEnd=function(I){var J;return I&&I.state?(J=I.state.status)!==T&&J!==69&&J!==73&&J!==91&&J!==103&&J!==N&&J!==666?ne(I,g):(I.state=null,J===N?ne(I,-3):p):g},i.deflateSetDictionary=function(I,J){var Z,B,F,V,ae,oe,L,O,ee=J.length;if(!I||!I.state||(V=(Z=I.state).wrap)===2||V===1&&Z.status!==T||Z.lookahead)return g;for(V===1&&(I.adler=l(I.adler,J,ee,0)),Z.wrap=0,ee>=Z.w_size&&(V===0&&(se(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0),O=new o.Buf8(Z.w_size),o.arraySet(O,J,ee-Z.w_size,Z.w_size,0),J=O,ee=Z.w_size),ae=I.avail_in,oe=I.next_in,L=I.input,I.avail_in=ee,I.next_in=0,I.input=J,te(Z);Z.lookahead>=R;){for(B=Z.strstart,F=Z.lookahead-(R-1);Z.ins_h=(Z.ins_h<<Z.hash_shift^Z.window[B+R-1])&Z.hash_mask,Z.prev[B&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=B,B++,--F;);Z.strstart=B,Z.lookahead=R-1,te(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=R-1,Z.match_available=0,I.next_in=oe,I.input=L,I.avail_in=ae,Z.wrap=V,p},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(r,o){var a,l,c,h,d,f,p,g,m,v,y,b,_,w,x,S,C,M,R,D,k,T,N,E,z;a=r.state,l=r.next_in,E=r.input,c=l+(r.avail_in-5),h=r.next_out,z=r.output,d=h-(o-r.avail_out),f=h+(r.avail_out-257),p=a.dmax,g=a.wsize,m=a.whave,v=a.wnext,y=a.window,b=a.hold,_=a.bits,w=a.lencode,x=a.distcode,S=(1<<a.lenbits)-1,C=(1<<a.distbits)-1;e:do{_<15&&(b+=E[l++]<<_,_+=8,b+=E[l++]<<_,_+=8),M=w[b&S];t:for(;;){if(b>>>=R=M>>>24,_-=R,(R=M>>>16&255)===0)z[h++]=65535&M;else{if(!(16&R)){if((64&R)==0){M=w[(65535&M)+(b&(1<<R)-1)];continue t}if(32&R){a.mode=12;break e}r.msg="invalid literal/length code",a.mode=30;break e}D=65535&M,(R&=15)&&(_<R&&(b+=E[l++]<<_,_+=8),D+=b&(1<<R)-1,b>>>=R,_-=R),_<15&&(b+=E[l++]<<_,_+=8,b+=E[l++]<<_,_+=8),M=x[b&C];n:for(;;){if(b>>>=R=M>>>24,_-=R,!(16&(R=M>>>16&255))){if((64&R)==0){M=x[(65535&M)+(b&(1<<R)-1)];continue n}r.msg="invalid distance code",a.mode=30;break e}if(k=65535&M,_<(R&=15)&&(b+=E[l++]<<_,(_+=8)<R&&(b+=E[l++]<<_,_+=8)),p<(k+=b&(1<<R)-1)){r.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=R,_-=R,(R=h-d)<k){if(m<(R=k-R)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break e}if(N=y,(T=0)===v){if(T+=g-R,R<D){for(D-=R;z[h++]=y[T++],--R;);T=h-k,N=z}}else if(v<R){if(T+=g+v-R,(R-=v)<D){for(D-=R;z[h++]=y[T++],--R;);if(T=0,v<D){for(D-=R=v;z[h++]=y[T++],--R;);T=h-k,N=z}}}else if(T+=v-R,R<D){for(D-=R;z[h++]=y[T++],--R;);T=h-k,N=z}for(;2<D;)z[h++]=N[T++],z[h++]=N[T++],z[h++]=N[T++],D-=3;D&&(z[h++]=N[T++],1<D&&(z[h++]=N[T++]))}else{for(T=h-k;z[h++]=z[T++],z[h++]=z[T++],z[h++]=z[T++],2<(D-=3););D&&(z[h++]=z[T++],1<D&&(z[h++]=z[T++]))}break}}break}}while(l<c&&h<f);l-=D=_>>3,b&=(1<<(_-=D<<3))-1,r.next_in=l,r.next_out=h,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=h<f?f-h+257:257-(h-f),a.hold=b,a.bits=_}},{}],49:[function(t,s,i){var r=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),h=1,d=2,f=0,p=-2,g=1,m=852,v=592;function y(T){return(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24)}u(y,"L");function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}u(b,"s");function _(T){var N;return T&&T.state?(N=T.state,T.total_in=T.total_out=N.total=0,T.msg="",N.wrap&&(T.adler=1&N.wrap),N.mode=g,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new r.Buf32(m),N.distcode=N.distdyn=new r.Buf32(v),N.sane=1,N.back=-1,f):p}u(_,"a");function w(T){var N;return T&&T.state?((N=T.state).wsize=0,N.whave=0,N.wnext=0,_(T)):p}u(w,"o");function x(T,N){var E,z;return T&&T.state?(z=T.state,N<0?(E=0,N=-N):(E=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?p:(z.window!==null&&z.wbits!==N&&(z.window=null),z.wrap=E,z.wbits=N,w(T))):p}u(x,"h");function S(T,N){var E,z;return T?(z=new b,(T.state=z).window=null,(E=x(T,N))!==f&&(T.state=null),E):p}u(S,"u");var C,M,R=!0;function D(T){if(R){var N;for(C=new r.Buf32(512),M=new r.Buf32(32),N=0;N<144;)T.lens[N++]=8;for(;N<256;)T.lens[N++]=9;for(;N<280;)T.lens[N++]=7;for(;N<288;)T.lens[N++]=8;for(c(h,T.lens,0,288,C,0,T.work,{bits:9}),N=0;N<32;)T.lens[N++]=5;c(d,T.lens,0,32,M,0,T.work,{bits:5}),R=!1}T.lencode=C,T.lenbits=9,T.distcode=M,T.distbits=5}u(D,"j");function k(T,N,E,z){var H,q=T.state;return q.window===null&&(q.wsize=1<<q.wbits,q.wnext=0,q.whave=0,q.window=new r.Buf8(q.wsize)),z>=q.wsize?(r.arraySet(q.window,N,E-q.wsize,q.wsize,0),q.wnext=0,q.whave=q.wsize):(z<(H=q.wsize-q.wnext)&&(H=z),r.arraySet(q.window,N,E-z,H,q.wnext),(z-=H)?(r.arraySet(q.window,N,E-z,z,0),q.wnext=z,q.whave=q.wsize):(q.wnext+=H,q.wnext===q.wsize&&(q.wnext=0),q.whave<q.wsize&&(q.whave+=H))),0}u(k,"Z"),i.inflateReset=w,i.inflateReset2=x,i.inflateResetKeep=_,i.inflateInit=function(T){return S(T,15)},i.inflateInit2=S,i.inflate=function(T,N){var E,z,H,q,ne,W,se,K,U,he,ue,Q,te,_e,pe,Ae,Me,Ie,$,X,I,J,Z,B,F=0,V=new r.Buf8(4),ae=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!T||!T.state||!T.output||!T.input&&T.avail_in!==0)return p;(E=T.state).mode===12&&(E.mode=13),ne=T.next_out,H=T.output,se=T.avail_out,q=T.next_in,z=T.input,W=T.avail_in,K=E.hold,U=E.bits,he=W,ue=se,J=f;e:for(;;)switch(E.mode){case g:if(E.wrap===0){E.mode=13;break}for(;U<16;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(2&E.wrap&&K===35615){V[E.check=0]=255&K,V[1]=K>>>8&255,E.check=a(E.check,V,2,0),U=K=0,E.mode=2;break}if(E.flags=0,E.head&&(E.head.done=!1),!(1&E.wrap)||(((255&K)<<8)+(K>>8))%31){T.msg="incorrect header check",E.mode=30;break}if((15&K)!=8){T.msg="unknown compression method",E.mode=30;break}if(U-=4,I=8+(15&(K>>>=4)),E.wbits===0)E.wbits=I;else if(I>E.wbits){T.msg="invalid window size",E.mode=30;break}E.dmax=1<<I,T.adler=E.check=1,E.mode=512&K?10:12,U=K=0;break;case 2:for(;U<16;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(E.flags=K,(255&E.flags)!=8){T.msg="unknown compression method",E.mode=30;break}if(57344&E.flags){T.msg="unknown header flags set",E.mode=30;break}E.head&&(E.head.text=K>>8&1),512&E.flags&&(V[0]=255&K,V[1]=K>>>8&255,E.check=a(E.check,V,2,0)),U=K=0,E.mode=3;case 3:for(;U<32;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}E.head&&(E.head.time=K),512&E.flags&&(V[0]=255&K,V[1]=K>>>8&255,V[2]=K>>>16&255,V[3]=K>>>24&255,E.check=a(E.check,V,4,0)),U=K=0,E.mode=4;case 4:for(;U<16;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}E.head&&(E.head.xflags=255&K,E.head.os=K>>8),512&E.flags&&(V[0]=255&K,V[1]=K>>>8&255,E.check=a(E.check,V,2,0)),U=K=0,E.mode=5;case 5:if(1024&E.flags){for(;U<16;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}E.length=K,E.head&&(E.head.extra_len=K),512&E.flags&&(V[0]=255&K,V[1]=K>>>8&255,E.check=a(E.check,V,2,0)),U=K=0}else E.head&&(E.head.extra=null);E.mode=6;case 6:if(1024&E.flags&&(W<(Q=E.length)&&(Q=W),Q&&(E.head&&(I=E.head.extra_len-E.length,E.head.extra||(E.head.extra=new Array(E.head.extra_len)),r.arraySet(E.head.extra,z,q,Q,I)),512&E.flags&&(E.check=a(E.check,z,Q,q)),W-=Q,q+=Q,E.length-=Q),E.length))break e;E.length=0,E.mode=7;case 7:if(2048&E.flags){if(W===0)break e;for(Q=0;I=z[q+Q++],E.head&&I&&E.length<65536&&(E.head.name+=String.fromCharCode(I)),I&&Q<W;);if(512&E.flags&&(E.check=a(E.check,z,Q,q)),W-=Q,q+=Q,I)break e}else E.head&&(E.head.name=null);E.length=0,E.mode=8;case 8:if(4096&E.flags){if(W===0)break e;for(Q=0;I=z[q+Q++],E.head&&I&&E.length<65536&&(E.head.comment+=String.fromCharCode(I)),I&&Q<W;);if(512&E.flags&&(E.check=a(E.check,z,Q,q)),W-=Q,q+=Q,I)break e}else E.head&&(E.head.comment=null);E.mode=9;case 9:if(512&E.flags){for(;U<16;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(K!==(65535&E.check)){T.msg="header crc mismatch",E.mode=30;break}U=K=0}E.head&&(E.head.hcrc=E.flags>>9&1,E.head.done=!0),T.adler=E.check=0,E.mode=12;break;case 10:for(;U<32;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}T.adler=E.check=y(K),U=K=0,E.mode=11;case 11:if(E.havedict===0)return T.next_out=ne,T.avail_out=se,T.next_in=q,T.avail_in=W,E.hold=K,E.bits=U,2;T.adler=E.check=1,E.mode=12;case 12:if(N===5||N===6)break e;case 13:if(E.last){K>>>=7&U,U-=7&U,E.mode=27;break}for(;U<3;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}switch(E.last=1&K,U-=1,3&(K>>>=1)){case 0:E.mode=14;break;case 1:if(D(E),E.mode=20,N!==6)break;K>>>=2,U-=2;break e;case 2:E.mode=17;break;case 3:T.msg="invalid block type",E.mode=30}K>>>=2,U-=2;break;case 14:for(K>>>=7&U,U-=7&U;U<32;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if((65535&K)!=(K>>>16^65535)){T.msg="invalid stored block lengths",E.mode=30;break}if(E.length=65535&K,U=K=0,E.mode=15,N===6)break e;case 15:E.mode=16;case 16:if(Q=E.length){if(W<Q&&(Q=W),se<Q&&(Q=se),Q===0)break e;r.arraySet(H,z,q,Q,ne),W-=Q,q+=Q,se-=Q,ne+=Q,E.length-=Q;break}E.mode=12;break;case 17:for(;U<14;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(E.nlen=257+(31&K),K>>>=5,U-=5,E.ndist=1+(31&K),K>>>=5,U-=5,E.ncode=4+(15&K),K>>>=4,U-=4,286<E.nlen||30<E.ndist){T.msg="too many length or distance symbols",E.mode=30;break}E.have=0,E.mode=18;case 18:for(;E.have<E.ncode;){for(;U<3;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}E.lens[ae[E.have++]]=7&K,K>>>=3,U-=3}for(;E.have<19;)E.lens[ae[E.have++]]=0;if(E.lencode=E.lendyn,E.lenbits=7,Z={bits:E.lenbits},J=c(0,E.lens,0,19,E.lencode,0,E.work,Z),E.lenbits=Z.bits,J){T.msg="invalid code lengths set",E.mode=30;break}E.have=0,E.mode=19;case 19:for(;E.have<E.nlen+E.ndist;){for(;Ae=(F=E.lencode[K&(1<<E.lenbits)-1])>>>16&255,Me=65535&F,!((pe=F>>>24)<=U);){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(Me<16)K>>>=pe,U-=pe,E.lens[E.have++]=Me;else{if(Me===16){for(B=pe+2;U<B;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(K>>>=pe,U-=pe,E.have===0){T.msg="invalid bit length repeat",E.mode=30;break}I=E.lens[E.have-1],Q=3+(3&K),K>>>=2,U-=2}else if(Me===17){for(B=pe+3;U<B;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}U-=pe,I=0,Q=3+(7&(K>>>=pe)),K>>>=3,U-=3}else{for(B=pe+7;U<B;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}U-=pe,I=0,Q=11+(127&(K>>>=pe)),K>>>=7,U-=7}if(E.have+Q>E.nlen+E.ndist){T.msg="invalid bit length repeat",E.mode=30;break}for(;Q--;)E.lens[E.have++]=I}}if(E.mode===30)break;if(E.lens[256]===0){T.msg="invalid code -- missing end-of-block",E.mode=30;break}if(E.lenbits=9,Z={bits:E.lenbits},J=c(h,E.lens,0,E.nlen,E.lencode,0,E.work,Z),E.lenbits=Z.bits,J){T.msg="invalid literal/lengths set",E.mode=30;break}if(E.distbits=6,E.distcode=E.distdyn,Z={bits:E.distbits},J=c(d,E.lens,E.nlen,E.ndist,E.distcode,0,E.work,Z),E.distbits=Z.bits,J){T.msg="invalid distances set",E.mode=30;break}if(E.mode=20,N===6)break e;case 20:E.mode=21;case 21:if(6<=W&&258<=se){T.next_out=ne,T.avail_out=se,T.next_in=q,T.avail_in=W,E.hold=K,E.bits=U,l(T,ue),ne=T.next_out,H=T.output,se=T.avail_out,q=T.next_in,z=T.input,W=T.avail_in,K=E.hold,U=E.bits,E.mode===12&&(E.back=-1);break}for(E.back=0;Ae=(F=E.lencode[K&(1<<E.lenbits)-1])>>>16&255,Me=65535&F,!((pe=F>>>24)<=U);){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(Ae&&(240&Ae)==0){for(Ie=pe,$=Ae,X=Me;Ae=(F=E.lencode[X+((K&(1<<Ie+$)-1)>>Ie)])>>>16&255,Me=65535&F,!(Ie+(pe=F>>>24)<=U);){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}K>>>=Ie,U-=Ie,E.back+=Ie}if(K>>>=pe,U-=pe,E.back+=pe,E.length=Me,Ae===0){E.mode=26;break}if(32&Ae){E.back=-1,E.mode=12;break}if(64&Ae){T.msg="invalid literal/length code",E.mode=30;break}E.extra=15&Ae,E.mode=22;case 22:if(E.extra){for(B=E.extra;U<B;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}E.length+=K&(1<<E.extra)-1,K>>>=E.extra,U-=E.extra,E.back+=E.extra}E.was=E.length,E.mode=23;case 23:for(;Ae=(F=E.distcode[K&(1<<E.distbits)-1])>>>16&255,Me=65535&F,!((pe=F>>>24)<=U);){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if((240&Ae)==0){for(Ie=pe,$=Ae,X=Me;Ae=(F=E.distcode[X+((K&(1<<Ie+$)-1)>>Ie)])>>>16&255,Me=65535&F,!(Ie+(pe=F>>>24)<=U);){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}K>>>=Ie,U-=Ie,E.back+=Ie}if(K>>>=pe,U-=pe,E.back+=pe,64&Ae){T.msg="invalid distance code",E.mode=30;break}E.offset=Me,E.extra=15&Ae,E.mode=24;case 24:if(E.extra){for(B=E.extra;U<B;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}E.offset+=K&(1<<E.extra)-1,K>>>=E.extra,U-=E.extra,E.back+=E.extra}if(E.offset>E.dmax){T.msg="invalid distance too far back",E.mode=30;break}E.mode=25;case 25:if(se===0)break e;if(Q=ue-se,E.offset>Q){if((Q=E.offset-Q)>E.whave&&E.sane){T.msg="invalid distance too far back",E.mode=30;break}te=Q>E.wnext?(Q-=E.wnext,E.wsize-Q):E.wnext-Q,Q>E.length&&(Q=E.length),_e=E.window}else _e=H,te=ne-E.offset,Q=E.length;for(se<Q&&(Q=se),se-=Q,E.length-=Q;H[ne++]=_e[te++],--Q;);E.length===0&&(E.mode=21);break;case 26:if(se===0)break e;H[ne++]=E.length,se--,E.mode=21;break;case 27:if(E.wrap){for(;U<32;){if(W===0)break e;W--,K|=z[q++]<<U,U+=8}if(ue-=se,T.total_out+=ue,E.total+=ue,ue&&(T.adler=E.check=E.flags?a(E.check,H,ue,ne-ue):o(E.check,H,ue,ne-ue)),ue=se,(E.flags?K:y(K))!==E.check){T.msg="incorrect data check",E.mode=30;break}U=K=0}E.mode=28;case 28:if(E.wrap&&E.flags){for(;U<32;){if(W===0)break e;W--,K+=z[q++]<<U,U+=8}if(K!==(4294967295&E.total)){T.msg="incorrect length check",E.mode=30;break}U=K=0}E.mode=29;case 29:J=1;break e;case 30:J=-3;break e;case 31:return-4;case 32:default:return p}return T.next_out=ne,T.avail_out=se,T.next_in=q,T.avail_in=W,E.hold=K,E.bits=U,(E.wsize||ue!==T.avail_out&&E.mode<30&&(E.mode<27||N!==4))&&k(T,T.output,T.next_out,ue-T.avail_out)?(E.mode=31,-4):(he-=T.avail_in,ue-=T.avail_out,T.total_in+=he,T.total_out+=ue,E.total+=ue,E.wrap&&ue&&(T.adler=E.check=E.flags?a(E.check,H,ue,T.next_out-ue):o(E.check,H,ue,T.next_out-ue)),T.data_type=E.bits+(E.last?64:0)+(E.mode===12?128:0)+(E.mode===20||E.mode===15?256:0),(he==0&&ue===0||N===4)&&J===f&&(J=-5),J)},i.inflateEnd=function(T){if(!T||!T.state)return p;var N=T.state;return N.window&&(N.window=null),T.state=null,f},i.inflateGetHeader=function(T,N){var E;return T&&T.state?(2&(E=T.state).wrap)==0?p:((E.head=N).done=!1,f):p},i.inflateSetDictionary=function(T,N){var E,z=N.length;return T&&T.state?(E=T.state).wrap!==0&&E.mode!==11?p:E.mode===11&&o(1,N,z,0)!==E.check?-3:k(T,N,z,z)?(E.mode=31,-4):(E.havedict=1,f):p},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,d,f,p,g,m,v,y){var b,_,w,x,S,C,M,R,D,k=y.bits,T=0,N=0,E=0,z=0,H=0,q=0,ne=0,W=0,se=0,K=0,U=null,he=0,ue=new r.Buf16(16),Q=new r.Buf16(16),te=null,_e=0;for(T=0;T<=15;T++)ue[T]=0;for(N=0;N<p;N++)ue[d[f+N]]++;for(H=k,z=15;1<=z&&ue[z]===0;z--);if(z<H&&(H=z),z===0)return g[m++]=20971520,g[m++]=20971520,y.bits=1,0;for(E=1;E<z&&ue[E]===0;E++);for(H<E&&(H=E),T=W=1;T<=15;T++)if(W<<=1,(W-=ue[T])<0)return-1;if(0<W&&(h===0||z!==1))return-1;for(Q[1]=0,T=1;T<15;T++)Q[T+1]=Q[T]+ue[T];for(N=0;N<p;N++)d[f+N]!==0&&(v[Q[d[f+N]]++]=N);if(C=h===0?(U=te=v,19):h===1?(U=o,he-=257,te=a,_e-=257,256):(U=l,te=c,-1),T=E,S=m,ne=N=K=0,w=-1,x=(se=1<<(q=H))-1,h===1&&852<se||h===2&&592<se)return 1;for(;;){for(M=T-ne,D=v[N]<C?(R=0,v[N]):v[N]>C?(R=te[_e+v[N]],U[he+v[N]]):(R=96,0),b=1<<T-ne,E=_=1<<q;g[S+(K>>ne)+(_-=b)]=M<<24|R<<16|D|0,_!==0;);for(b=1<<T-1;K&b;)b>>=1;if(b!==0?(K&=b-1,K+=b):K=0,N++,--ue[T]==0){if(T===z)break;T=d[f+v[N]]}if(H<T&&(K&x)!==w){for(ne===0&&(ne=H),S+=E,W=1<<(q=T-ne);q+ne<z&&!((W-=ue[q+ne])<=0);)q++,W<<=1;if(se+=1<<q,h===1&&852<se||h===2&&592<se)return 1;g[w=K&x]=H<<24|q<<16|S-m|0}}return K!==0&&(g[S+K]=T-ne<<24|64<<16|0),y.bits=H,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var r=t("../utils/common"),o=0,a=1;function l(F){for(var V=F.length;0<=--V;)F[V]=0}u(l,"n");var c=0,h=29,d=256,f=d+1+h,p=30,g=19,m=2*f+1,v=15,y=16,b=7,_=256,w=16,x=17,S=18,C=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(f+2));l(k);var T=new Array(2*p);l(T);var N=new Array(512);l(N);var E=new Array(256);l(E);var z=new Array(h);l(z);var H,q,ne,W=new Array(p);function se(F,V,ae,oe,L){this.static_tree=F,this.extra_bits=V,this.extra_base=ae,this.elems=oe,this.max_length=L,this.has_stree=F&&F.length}u(se,"D");function K(F,V){this.dyn_tree=F,this.max_code=0,this.stat_desc=V}u(K,"F");function U(F){return F<256?N[F]:N[256+(F>>>7)]}u(U,"N");function he(F,V){F.pending_buf[F.pending++]=255&V,F.pending_buf[F.pending++]=V>>>8&255}u(he,"U");function ue(F,V,ae){F.bi_valid>y-ae?(F.bi_buf|=V<<F.bi_valid&65535,he(F,F.bi_buf),F.bi_buf=V>>y-F.bi_valid,F.bi_valid+=ae-y):(F.bi_buf|=V<<F.bi_valid&65535,F.bi_valid+=ae)}u(ue,"P");function Q(F,V,ae){ue(F,ae[2*V],ae[2*V+1])}u(Q,"L");function te(F,V){for(var ae=0;ae|=1&F,F>>>=1,ae<<=1,0<--V;);return ae>>>1}u(te,"j");function _e(F,V,ae){var oe,L,O=new Array(v+1),ee=0;for(oe=1;oe<=v;oe++)O[oe]=ee=ee+ae[oe-1]<<1;for(L=0;L<=V;L++){var ie=F[2*L+1];ie!==0&&(F[2*L]=te(O[ie]++,ie))}}u(_e,"Z");function pe(F){var V;for(V=0;V<f;V++)F.dyn_ltree[2*V]=0;for(V=0;V<p;V++)F.dyn_dtree[2*V]=0;for(V=0;V<g;V++)F.bl_tree[2*V]=0;F.dyn_ltree[2*_]=1,F.opt_len=F.static_len=0,F.last_lit=F.matches=0}u(pe,"W");function Ae(F){8<F.bi_valid?he(F,F.bi_buf):0<F.bi_valid&&(F.pending_buf[F.pending++]=F.bi_buf),F.bi_buf=0,F.bi_valid=0}u(Ae,"M");function Me(F,V,ae,oe){var L=2*V,O=2*ae;return F[L]<F[O]||F[L]===F[O]&&oe[V]<=oe[ae]}u(Me,"H");function Ie(F,V,ae){for(var oe=F.heap[ae],L=ae<<1;L<=F.heap_len&&(L<F.heap_len&&Me(V,F.heap[L+1],F.heap[L],F.depth)&&L++,!Me(V,oe,F.heap[L],F.depth));)F.heap[ae]=F.heap[L],ae=L,L<<=1;F.heap[ae]=oe}u(Ie,"G");function $(F,V,ae){var oe,L,O,ee,ie=0;if(F.last_lit!==0)for(;oe=F.pending_buf[F.d_buf+2*ie]<<8|F.pending_buf[F.d_buf+2*ie+1],L=F.pending_buf[F.l_buf+ie],ie++,oe===0?Q(F,L,V):(Q(F,(O=E[L])+d+1,V),(ee=C[O])!==0&&ue(F,L-=z[O],ee),Q(F,O=U(--oe),ae),(ee=M[O])!==0&&ue(F,oe-=W[O],ee)),ie<F.last_lit;);Q(F,_,V)}u($,"K");function X(F,V){var ae,oe,L,O=V.dyn_tree,ee=V.stat_desc.static_tree,ie=V.stat_desc.has_stree,ce=V.stat_desc.elems,ye=-1;for(F.heap_len=0,F.heap_max=m,ae=0;ae<ce;ae++)O[2*ae]!==0?(F.heap[++F.heap_len]=ye=ae,F.depth[ae]=0):O[2*ae+1]=0;for(;F.heap_len<2;)O[2*(L=F.heap[++F.heap_len]=ye<2?++ye:0)]=1,F.depth[L]=0,F.opt_len--,ie&&(F.static_len-=ee[2*L+1]);for(V.max_code=ye,ae=F.heap_len>>1;1<=ae;ae--)Ie(F,O,ae);for(L=ce;ae=F.heap[1],F.heap[1]=F.heap[F.heap_len--],Ie(F,O,1),oe=F.heap[1],F.heap[--F.heap_max]=ae,F.heap[--F.heap_max]=oe,O[2*L]=O[2*ae]+O[2*oe],F.depth[L]=(F.depth[ae]>=F.depth[oe]?F.depth[ae]:F.depth[oe])+1,O[2*ae+1]=O[2*oe+1]=L,F.heap[1]=L++,Ie(F,O,1),2<=F.heap_len;);F.heap[--F.heap_max]=F.heap[1],function(Ce,Te){var ve,Ge,Xe,Le,Ke,He,et=Te.dyn_tree,Ut=Te.max_code,re=Te.stat_desc.static_tree,G=Te.stat_desc.has_stree,le=Te.stat_desc.extra_bits,de=Te.stat_desc.extra_base,ge=Te.stat_desc.max_length,Re=0;for(Le=0;Le<=v;Le++)Ce.bl_count[Le]=0;for(et[2*Ce.heap[Ce.heap_max]+1]=0,ve=Ce.heap_max+1;ve<m;ve++)ge<(Le=et[2*et[2*(Ge=Ce.heap[ve])+1]+1]+1)&&(Le=ge,Re++),et[2*Ge+1]=Le,Ut<Ge||(Ce.bl_count[Le]++,Ke=0,de<=Ge&&(Ke=le[Ge-de]),He=et[2*Ge],Ce.opt_len+=He*(Le+Ke),G&&(Ce.static_len+=He*(re[2*Ge+1]+Ke)));if(Re!==0){do{for(Le=ge-1;Ce.bl_count[Le]===0;)Le--;Ce.bl_count[Le]--,Ce.bl_count[Le+1]+=2,Ce.bl_count[ge]--,Re-=2}while(0<Re);for(Le=ge;Le!==0;Le--)for(Ge=Ce.bl_count[Le];Ge!==0;)Ut<(Xe=Ce.heap[--ve])||(et[2*Xe+1]!==Le&&(Ce.opt_len+=(Le-et[2*Xe+1])*et[2*Xe],et[2*Xe+1]=Le),Ge--)}}(F,V),_e(O,ye,F.bl_count)}u(X,"Y");function I(F,V,ae){var oe,L,O=-1,ee=V[1],ie=0,ce=7,ye=4;for(ee===0&&(ce=138,ye=3),V[2*(ae+1)+1]=65535,oe=0;oe<=ae;oe++)L=ee,ee=V[2*(oe+1)+1],++ie<ce&&L===ee||(ie<ye?F.bl_tree[2*L]+=ie:L!==0?(L!==O&&F.bl_tree[2*L]++,F.bl_tree[2*w]++):ie<=10?F.bl_tree[2*x]++:F.bl_tree[2*S]++,O=L,ye=(ie=0)===ee?(ce=138,3):L===ee?(ce=6,3):(ce=7,4))}u(I,"X");function J(F,V,ae){var oe,L,O=-1,ee=V[1],ie=0,ce=7,ye=4;for(ee===0&&(ce=138,ye=3),oe=0;oe<=ae;oe++)if(L=ee,ee=V[2*(oe+1)+1],!(++ie<ce&&L===ee)){if(ie<ye)for(;Q(F,L,F.bl_tree),--ie!=0;);else L!==0?(L!==O&&(Q(F,L,F.bl_tree),ie--),Q(F,w,F.bl_tree),ue(F,ie-3,2)):ie<=10?(Q(F,x,F.bl_tree),ue(F,ie-3,3)):(Q(F,S,F.bl_tree),ue(F,ie-11,7));O=L,ye=(ie=0)===ee?(ce=138,3):L===ee?(ce=6,3):(ce=7,4)}}u(J,"V"),l(W);var Z=!1;function B(F,V,ae,oe){ue(F,(c<<1)+(oe?1:0),3),function(L,O,ee,ie){Ae(L),ie&&(he(L,ee),he(L,~ee)),r.arraySet(L.pending_buf,L.window,O,ee,L.pending),L.pending+=ee}(F,V,ae,!0)}u(B,"J"),i._tr_init=function(F){Z||(function(){var V,ae,oe,L,O,ee=new Array(v+1);for(L=oe=0;L<h-1;L++)for(z[L]=oe,V=0;V<1<<C[L];V++)E[oe++]=L;for(E[oe-1]=L,L=O=0;L<16;L++)for(W[L]=O,V=0;V<1<<M[L];V++)N[O++]=L;for(O>>=7;L<p;L++)for(W[L]=O<<7,V=0;V<1<<M[L]-7;V++)N[256+O++]=L;for(ae=0;ae<=v;ae++)ee[ae]=0;for(V=0;V<=143;)k[2*V+1]=8,V++,ee[8]++;for(;V<=255;)k[2*V+1]=9,V++,ee[9]++;for(;V<=279;)k[2*V+1]=7,V++,ee[7]++;for(;V<=287;)k[2*V+1]=8,V++,ee[8]++;for(_e(k,f+1,ee),V=0;V<p;V++)T[2*V+1]=5,T[2*V]=te(V,5);H=new se(k,C,d+1,f,v),q=new se(T,M,0,p,v),ne=new se(new Array(0),R,0,g,b)}(),Z=!0),F.l_desc=new K(F.dyn_ltree,H),F.d_desc=new K(F.dyn_dtree,q),F.bl_desc=new K(F.bl_tree,ne),F.bi_buf=0,F.bi_valid=0,pe(F)},i._tr_stored_block=B,i._tr_flush_block=function(F,V,ae,oe){var L,O,ee=0;0<F.level?(F.strm.data_type===2&&(F.strm.data_type=function(ie){var ce,ye=4093624447;for(ce=0;ce<=31;ce++,ye>>>=1)if(1&ye&&ie.dyn_ltree[2*ce]!==0)return o;if(ie.dyn_ltree[18]!==0||ie.dyn_ltree[20]!==0||ie.dyn_ltree[26]!==0)return a;for(ce=32;ce<d;ce++)if(ie.dyn_ltree[2*ce]!==0)return a;return o}(F)),X(F,F.l_desc),X(F,F.d_desc),ee=function(ie){var ce;for(I(ie,ie.dyn_ltree,ie.l_desc.max_code),I(ie,ie.dyn_dtree,ie.d_desc.max_code),X(ie,ie.bl_desc),ce=g-1;3<=ce&&ie.bl_tree[2*D[ce]+1]===0;ce--);return ie.opt_len+=3*(ce+1)+5+5+4,ce}(F),L=F.opt_len+3+7>>>3,(O=F.static_len+3+7>>>3)<=L&&(L=O)):L=O=ae+5,ae+4<=L&&V!==-1?B(F,V,ae,oe):F.strategy===4||O===L?(ue(F,2+(oe?1:0),3),$(F,k,T)):(ue(F,4+(oe?1:0),3),function(ie,ce,ye,Ce){var Te;for(ue(ie,ce-257,5),ue(ie,ye-1,5),ue(ie,Ce-4,4),Te=0;Te<Ce;Te++)ue(ie,ie.bl_tree[2*D[Te]+1],3);J(ie,ie.dyn_ltree,ce-1),J(ie,ie.dyn_dtree,ye-1)}(F,F.l_desc.max_code+1,F.d_desc.max_code+1,ee+1),$(F,F.dyn_ltree,F.dyn_dtree)),pe(F),oe&&Ae(F)},i._tr_tally=function(F,V,ae){return F.pending_buf[F.d_buf+2*F.last_lit]=V>>>8&255,F.pending_buf[F.d_buf+2*F.last_lit+1]=255&V,F.pending_buf[F.l_buf+F.last_lit]=255&ae,F.last_lit++,V===0?F.dyn_ltree[2*ae]++:(F.matches++,V--,F.dyn_ltree[2*(E[ae]+d+1)]++,F.dyn_dtree[2*U(V)]++),F.last_lit===F.lit_bufsize-1},i._tr_align=function(F){ue(F,2,3),Q(F,_,k),function(V){V.bi_valid===16?(he(V,V.bi_buf),V.bi_buf=0,V.bi_valid=0):8<=V.bi_valid&&(V.pending_buf[V.pending++]=255&V.bi_buf,V.bi_buf>>=8,V.bi_valid-=8)}(F)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(r){(function(o,a){if(!o.setImmediate){var l,c,h,d,f=1,p={},g=!1,m=o.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(o);v=v&&v.setTimeout?v:o,l={}.toString.call(o.process)==="[object process]"?function(w){process.nextTick(function(){b(w)})}:function(){if(o.postMessage&&!o.importScripts){var w=!0,x=o.onmessage;return o.onmessage=function(){w=!1},o.postMessage("","*"),o.onmessage=x,w}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",_,!1):o.attachEvent("onmessage",_),function(w){o.postMessage(d+w,"*")}):o.MessageChannel?((h=new MessageChannel).port1.onmessage=function(w){b(w.data)},function(w){h.port2.postMessage(w)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(w){var x=m.createElement("script");x.onreadystatechange=function(){b(w),x.onreadystatechange=null,c.removeChild(x),x=null},c.appendChild(x)}):function(w){setTimeout(b,0,w)},v.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var x=new Array(arguments.length-1),S=0;S<x.length;S++)x[S]=arguments[S+1];var C={callback:w,args:x};return p[f]=C,l(f),f++},v.clearImmediate=y}function y(w){delete p[w]}u(y,"f");function b(w){if(g)setTimeout(b,0,w);else{var x=p[w];if(x){g=!0;try{(function(S){var C=S.callback,M=S.args;switch(M.length){case 0:C();break;case 1:C(M[0]);break;case 2:C(M[0],M[1]);break;case 3:C(M[0],M[1],M[2]);break;default:C.apply(a,M)}})(x)}finally{y(w),g=!1}}}}u(b,"c");function _(w){w.source===o&&typeof w.data=="string"&&w.data.indexOf(d)===0&&b(+w.data.slice(d.length))}u(_,"d")})(typeof self=="undefined"?r===void 0?this:r:self)}).call(this,typeof hm!="undefined"?hm:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(sO);var Wfe=sO.exports;/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var V3={},Q_=u(function(n){return URL.createObjectURL(new Blob([n],{type:"text/javascript"}))},"durl"),iO=u(function(n){return new Worker(n)},"cwk");try{URL.revokeObjectURL(Q_(""))}catch{Q_=u(function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},"durl"),iO=u(function(e){return new Worker(e,{type:"module"})},"cwk")}var jfe=u(function(n,e,t,s,i){var r=iO(V3[e]||(V3[e]=Q_(n)));return r.onerror=function(o){return i(o.error,null)},r.onmessage=function(o){return i(null,o.data)},r.postMessage(t,s),r},"wk"),Nt=Uint8Array,ws=Uint16Array,Ho=Uint32Array,Mh=new Nt([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Sh=new Nt([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Xf=new Nt([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rO=u(function(n,e){for(var t=new ws(31),s=0;s<31;++s)t[s]=e+=1<<n[s-1];for(var i=new Ho(t[30]),s=1;s<30;++s)for(var r=t[s];r<t[s+1];++r)i[r]=r-t[s]<<5|s;return[t,i]},"freb"),oO=rO(Mh,2),cx=oO[0],c0=oO[1];cx[28]=258,c0[258]=28;var aO=rO(Sh,0),lO=aO[0],J_=aO[1],Yf=new ws(32768);for(var _n=0;_n<32768;++_n){var ga=(_n&43690)>>>1|(_n&21845)<<1;ga=(ga&52428)>>>2|(ga&13107)<<2,ga=(ga&61680)>>>4|(ga&3855)<<4,Yf[_n]=((ga&65280)>>>8|(ga&255)<<8)>>>1}var Ji=u(function(n,e,t){for(var s=n.length,i=0,r=new ws(e);i<s;++i)++r[n[i]-1];var o=new ws(e);for(i=0;i<e;++i)o[i]=o[i-1]+r[i-1]<<1;var a;if(t){a=new ws(1<<e);var l=15-e;for(i=0;i<s;++i)if(n[i])for(var c=i<<4|n[i],h=e-n[i],d=o[n[i]-1]++<<h,f=d|(1<<h)-1;d<=f;++d)a[Yf[d]>>>l]=c}else for(a=new ws(s),i=0;i<s;++i)n[i]&&(a[i]=Yf[o[n[i]-1]++]>>>15-n[i]);return a},"hMap"),Wo=new Nt(288);for(var _n=0;_n<144;++_n)Wo[_n]=8;for(var _n=144;_n<256;++_n)Wo[_n]=9;for(var _n=256;_n<280;++_n)Wo[_n]=7;for(var _n=280;_n<288;++_n)Wo[_n]=8;var hh=new Nt(32);for(var _n=0;_n<32;++_n)hh[_n]=5;var cO=Ji(Wo,9,0),uO=Ji(Wo,9,1),hO=Ji(hh,5,0),dO=Ji(hh,5,1),Bg=u(function(n){for(var e=n[0],t=1;t<n.length;++t)n[t]>e&&(e=n[t]);return e},"max"),Hi=u(function(n,e,t){var s=e/8|0;return(n[s]|n[s+1]<<8)>>(e&7)&t},"bits"),Ug=u(function(n,e){var t=e/8|0;return(n[t]|n[t+1]<<8|n[t+2]<<16)>>(e&7)},"bits16"),pp=u(function(n){return(n/8|0)+(n&7&&1)},"shft"),er=u(function(n,e,t){(e==null||e<0)&&(e=0),(t==null||t>n.length)&&(t=n.length);var s=new(n instanceof ws?ws:n instanceof Ho?Ho:Nt)(t-e);return s.set(n.subarray(e,t)),s},"slc"),mp=u(function(n,e,t){var s=n.length;if(!s||t&&!t.l&&s<5)return e||new Nt(0);var i=!e||t,r=!t||t.i;t||(t={}),e||(e=new Nt(s*3));var o=u(function(te){var _e=e.length;if(te>_e){var pe=new Nt(Math.max(_e*2,te));pe.set(e),e=pe}},"cbuf"),a=t.f||0,l=t.p||0,c=t.b||0,h=t.l,d=t.d,f=t.m,p=t.n,g=s*8;do{if(!h){t.f=a=Hi(n,l,1);var m=Hi(n,l+1,3);if(l+=3,m)if(m==1)h=uO,d=dO,f=9,p=5;else if(m==2){var _=Hi(n,l,31)+257,w=Hi(n,l+10,15)+4,x=_+Hi(n,l+5,31)+1;l+=14;for(var S=new Nt(x),C=new Nt(19),M=0;M<w;++M)C[Xf[M]]=Hi(n,l+M*3,7);l+=w*3;for(var R=Bg(C),D=(1<<R)-1,k=Ji(C,R,1),M=0;M<x;){var T=k[Hi(n,l,D)];l+=T&15;var v=T>>>4;if(v<16)S[M++]=v;else{var N=0,E=0;for(v==16?(E=3+Hi(n,l,3),l+=2,N=S[M-1]):v==17?(E=3+Hi(n,l,7),l+=3):v==18&&(E=11+Hi(n,l,127),l+=7);E--;)S[M++]=N}}var z=S.subarray(0,_),H=S.subarray(_);f=Bg(z),p=Bg(H),h=Ji(z,f,1),d=Ji(H,p,1)}else throw"invalid block type";else{var v=pp(l)+4,y=n[v-4]|n[v-3]<<8,b=v+y;if(b>s){if(r)throw"unexpected EOF";break}i&&o(c+y),e.set(n.subarray(v,b),c),t.b=c+=y,t.p=l=b*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}i&&o(c+131072);for(var q=(1<<f)-1,ne=(1<<p)-1,W=l;;W=l){var N=h[Ug(n,l)&q],se=N>>>4;if(l+=N&15,l>g){if(r)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(se<256)e[c++]=se;else if(se==256){W=l,h=null;break}else{var K=se-254;if(se>264){var M=se-257,U=Mh[M];K=Hi(n,l,(1<<U)-1)+cx[M],l+=U}var he=d[Ug(n,l)&ne],ue=he>>>4;if(!he)throw"invalid distance";l+=he&15;var H=lO[ue];if(ue>3){var U=Sh[ue];H+=Ug(n,l)&(1<<U)-1,l+=U}if(l>g){if(r)throw"unexpected EOF";break}i&&o(c+131072);for(var Q=c+K;c<Q;c+=4)e[c]=e[c-H],e[c+1]=e[c+1-H],e[c+2]=e[c+2-H],e[c+3]=e[c+3-H];c=Q}}t.l=h,t.p=W,t.b=c,h&&(a=1,t.m=f,t.d=d,t.n=p)}while(!a);return c==e.length?e:er(e,0,c)},"inflt"),Fr=u(function(n,e,t){t<<=e&7;var s=e/8|0;n[s]|=t,n[s+1]|=t>>>8},"wbits"),du=u(function(n,e,t){t<<=e&7;var s=e/8|0;n[s]|=t,n[s+1]|=t>>>8,n[s+2]|=t>>>16},"wbits16"),$g=u(function(n,e){for(var t=[],s=0;s<n.length;++s)n[s]&&t.push({s,f:n[s]});var i=t.length,r=t.slice();if(!i)return[Do,0];if(i==1){var o=new Nt(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(x,S){return x.f-S.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,h=1,d=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};h!=i-1;)a=t[t[c].f<t[d].f?c++:d++],l=t[c!=h&&t[c].f<t[d].f?c++:d++],t[h++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,s=1;s<i;++s)r[s].s>f&&(f=r[s].s);var p=new ws(f+1),g=u0(t[h-1],p,0);if(g>e){var s=0,m=0,v=g-e,y=1<<v;for(r.sort(function(S,C){return p[C.s]-p[S.s]||S.f-C.f});s<i;++s){var b=r[s].s;if(p[b]>e)m+=y-(1<<g-p[b]),p[b]=e;else break}for(m>>>=v;m>0;){var _=r[s].s;p[_]<e?m-=1<<e-p[_]++-1:++s}for(;s>=0&&m;--s){var w=r[s].s;p[w]==e&&(--p[w],++m)}g=e}return[new Nt(p),g]},"hTree"),u0=u(function(n,e,t){return n.s==-1?Math.max(u0(n.l,e,t+1),u0(n.r,e,t+1)):e[n.s]=t},"ln"),eb=u(function(n){for(var e=n.length;e&&!n[--e];);for(var t=new ws(++e),s=0,i=n[0],r=1,o=u(function(l){t[s++]=l},"w"),a=1;a<=e;++a)if(n[a]==i&&a!=e)++r;else{if(!i&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(i),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(i);r=1,i=n[a]}return[t.subarray(0,s),e]},"lc"),fu=u(function(n,e){for(var t=0,s=0;s<e.length;++s)t+=n[s]*e[s];return t},"clen"),vf=u(function(n,e,t){var s=t.length,i=pp(e+2);n[i]=s&255,n[i+1]=s>>>8,n[i+2]=n[i]^255,n[i+3]=n[i+1]^255;for(var r=0;r<s;++r)n[i+r+4]=t[r];return(i+4+s)*8},"wfblk"),tb=u(function(n,e,t,s,i,r,o,a,l,c,h){Fr(e,h++,t),++i[256];for(var d=$g(i,15),f=d[0],p=d[1],g=$g(r,15),m=g[0],v=g[1],y=eb(f),b=y[0],_=y[1],w=eb(m),x=w[0],S=w[1],C=new ws(19),M=0;M<b.length;++M)C[b[M]&31]++;for(var M=0;M<x.length;++M)C[x[M]&31]++;for(var R=$g(C,7),D=R[0],k=R[1],T=19;T>4&&!D[Xf[T-1]];--T);var N=c+5<<3,E=fu(i,Wo)+fu(r,hh)+o,z=fu(i,f)+fu(r,m)+o+14+3*T+fu(C,D)+(2*C[16]+3*C[17]+7*C[18]);if(N<=E&&N<=z)return vf(e,h,n.subarray(l,l+c));var H,q,ne,W;if(Fr(e,h,1+(z<E)),h+=2,z<E){H=Ji(f,p,0),q=f,ne=Ji(m,v,0),W=m;var se=Ji(D,k,0);Fr(e,h,_-257),Fr(e,h+5,S-1),Fr(e,h+10,T-4),h+=14;for(var M=0;M<T;++M)Fr(e,h+3*M,D[Xf[M]]);h+=3*T;for(var K=[b,x],U=0;U<2;++U)for(var he=K[U],M=0;M<he.length;++M){var ue=he[M]&31;Fr(e,h,se[ue]),h+=D[ue],ue>15&&(Fr(e,h,he[M]>>>5&127),h+=he[M]>>>12)}}else H=cO,q=Wo,ne=hO,W=hh;for(var M=0;M<a;++M)if(s[M]>255){var ue=s[M]>>>18&31;du(e,h,H[ue+257]),h+=q[ue+257],ue>7&&(Fr(e,h,s[M]>>>23&31),h+=Mh[ue]);var Q=s[M]&31;du(e,h,ne[Q]),h+=W[Q],Q>3&&(du(e,h,s[M]>>>5&8191),h+=Sh[Q])}else du(e,h,H[s[M]]),h+=q[s[M]];return du(e,h,H[256]),h+q[256]},"wblk"),fO=new Ho([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Do=new Nt(0),pO=u(function(n,e,t,s,i,r){var o=n.length,a=new Nt(s+o+5*(1+Math.ceil(o/7e3))+i),l=a.subarray(s,a.length-i),c=0;if(!e||o<8)for(var h=0;h<=o;h+=65535){var d=h+65535;d<o?c=vf(l,c,n.subarray(h,d)):(l[h]=r,c=vf(l,c,n.subarray(h,o)))}else{for(var f=fO[e-1],p=f>>>13,g=f&8191,m=(1<<t)-1,v=new ws(32768),y=new ws(m+1),b=Math.ceil(t/3),_=2*b,w=u(function(I){return(n[I]^n[I+1]<<b^n[I+2]<<_)&m},"hsh"),x=new Ho(25e3),S=new ws(288),C=new ws(32),M=0,R=0,h=0,D=0,k=0,T=0;h<o;++h){var N=w(h),E=h&32767,z=y[N];if(v[E]=z,y[N]=E,k<=h){var H=o-h;if((M>7e3||D>24576)&&H>423){c=tb(n,l,0,x,S,C,R,D,T,h-T,c),D=M=R=0,T=h;for(var q=0;q<286;++q)S[q]=0;for(var q=0;q<30;++q)C[q]=0}var ne=2,W=0,se=g,K=E-z&32767;if(H>2&&N==w(h-K))for(var U=Math.min(p,H)-1,he=Math.min(32767,h),ue=Math.min(258,H);K<=he&&--se&&E!=z;){if(n[h+ne]==n[h+ne-K]){for(var Q=0;Q<ue&&n[h+Q]==n[h+Q-K];++Q);if(Q>ne){if(ne=Q,W=K,Q>U)break;for(var te=Math.min(K,Q-2),_e=0,q=0;q<te;++q){var pe=h-K+q+32768&32767,Ae=v[pe],Me=pe-Ae+32768&32767;Me>_e&&(_e=Me,z=pe)}}}E=z,z=v[E],K+=E-z+32768&32767}if(W){x[D++]=268435456|c0[ne]<<18|J_[W];var Ie=c0[ne]&31,$=J_[W]&31;R+=Mh[Ie]+Sh[$],++S[257+Ie],++C[$],k=h+ne,++M}else x[D++]=n[h],++S[n[h]]}}c=tb(n,l,r,x,S,C,R,D,T,h-T,c),!r&&c&7&&(c=vf(l,c+1,Do))}return er(a,0,s+pp(c)+i)},"dflt"),mO=function(){for(var n=new Ho(256),e=0;e<256;++e){for(var t=e,s=9;--s;)t=(t&1&&3988292384)^t>>>1;n[e]=t}return n}(),Ch=u(function(){var n=-1;return{p:function(e){for(var t=n,s=0;s<e.length;++s)t=mO[t&255^e[s]]^t>>>8;n=t},d:function(){return~n}}},"crc"),ux=u(function(){var n=1,e=0;return{p:function(t){for(var s=n,i=e,r=t.length,o=0;o!=r;){for(var a=Math.min(o+2655,r);o<a;++o)i+=s+=t[o];s=(s&65535)+15*(s>>16),i=(i&65535)+15*(i>>16)}n=s,e=i},d:function(){return n%=65521,e%=65521,(n&255)<<24|n>>>8<<16|(e&255)<<8|e>>>8}}},"adler"),yc=u(function(n,e,t,s,i){return pO(n,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(n.length)))*1.5):12+e.mem,t,s,!i)},"dopt"),gp=u(function(n,e){var t={};for(var s in n)t[s]=n[s];for(var s in e)t[s]=e[s];return t},"mrg"),G3=u(function(n,e,t){for(var s=n(),i=n.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<s.length;++o){var a=s[o],l=r[o];if(typeof a=="function"){e+=";"+l+"=";var c=a.toString();if(a.prototype)if(c.indexOf("[native code]")!=-1){var h=c.indexOf(" ",8)+1;e+=c.slice(h,c.indexOf("(",h))}else{e+=c;for(var d in a.prototype)e+=";"+l+".prototype."+d+"="+a.prototype[d].toString()}else e+=c}else t[l]=a}return[e,t]},"wcln"),Nm=[],Xfe=u(function(n){var e=[];for(var t in n)(n[t]instanceof Nt||n[t]instanceof ws||n[t]instanceof Ho)&&e.push((n[t]=new n[t].constructor(n[t])).buffer);return e},"cbfs"),gO=u(function(n,e,t,s){var i;if(!Nm[t]){for(var r="",o={},a=n.length-1,l=0;l<a;++l)i=G3(n[l],r,o),r=i[0],o=i[1];Nm[t]=G3(n[a],r,o)}var c=gp({},Nm[t][1]);return jfe(Nm[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,Xfe(c),s)},"wrkr"),Eh=u(function(){return[Nt,ws,Ho,Mh,Sh,Xf,cx,lO,uO,dO,Yf,Ji,Bg,Hi,Ug,pp,er,mp,Ih,Ja,hx]},"bInflt"),Th=u(function(){return[Nt,ws,Ho,Mh,Sh,Xf,c0,J_,cO,Wo,hO,hh,Yf,fO,Do,Ji,Fr,du,$g,u0,eb,fu,vf,tb,pp,er,pO,yc,vp,Ja]},"bDflt"),vO=u(function(){return[dx,px,Zt,Ch,mO]},"gze"),yO=u(function(){return[fx,wO]},"guze"),_O=u(function(){return[mx,Zt,ux]},"zle"),bO=u(function(){return[xO]},"zule"),Ja=u(function(n){return postMessage(n,[n.buffer])},"pbf"),hx=u(function(n){return n&&n.size&&new Nt(n.size)},"gu8"),Ph=u(function(n,e,t,s,i,r){var o=gO(t,s,i,function(a,l){o.terminate(),r(a,l)});return o.postMessage([n,e],e.consume?[n.buffer]:[]),function(){o.terminate()}},"cbify"),tr=u(function(n){return n.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return n.push(e.data[0],e.data[1])}},"astrm"),Rh=u(function(n,e,t,s,i){var r,o=gO(n,s,i,function(a,l){a?(o.terminate(),e.ondata.call(e,a)):(l[1]&&o.terminate(),e.ondata.call(e,a,l[0],l[1]))});o.postMessage(t),e.push=function(a,l){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([a,r=l],[a.buffer])},e.terminate=function(){o.terminate()}},"astrmify"),Zs=u(function(n,e){return n[e]|n[e+1]<<8},"b2"),jn=u(function(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0},"b4"),Cy=u(function(n,e){return jn(n,e)+jn(n,e+4)*4294967296},"b8"),Zt=u(function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},"wbytes"),dx=u(function(n,e){var t=e.filename;if(n[0]=31,n[1]=139,n[2]=8,n[8]=e.level<2?4:e.level==9?2:0,n[9]=3,e.mtime!=0&&Zt(n,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){n[3]=8;for(var s=0;s<=t.length;++s)n[s+10]=t.charCodeAt(s)}},"gzh"),fx=u(function(n){if(n[0]!=31||n[1]!=139||n[2]!=8)throw"invalid gzip data";var e=n[3],t=10;e&4&&(t+=n[10]|(n[11]<<8)+2);for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!n[t++]);return t+(e&2)},"gzs"),wO=u(function(n){var e=n.length;return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0},"gzl"),px=u(function(n){return 10+(n.filename&&n.filename.length+1||0)},"gzhl"),mx=u(function(n,e){var t=e.level,s=t==0?0:t<6?1:t==9?3:2;n[0]=120,n[1]=s<<6|(s?32-2*s:1)},"zlh"),xO=u(function(n){if((n[0]&15)!=8||n[0]>>>4>7||(n[0]<<8|n[1])%31)throw"invalid zlib data";if(n[1]&32)throw"invalid zlib data: preset dictionaries not supported"},"zlv");function gx(n,e){return!e&&typeof n=="function"&&(e=n,n={}),this.ondata=e,n}u(gx,"AsyncCmpStrm");var Zr=function(){function n(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return u(n,"Deflate"),n.prototype.p=function(e,t){this.ondata(yc(e,this.o,0,0,!t),t)},n.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},n}(),AO=function(){function n(e,t){Rh([Th,function(){return[tr,Zr]}],this,gx.call(this,e,t),function(s){var i=new Zr(s.data);onmessage=tr(i)},6)}return u(n,"AsyncDeflate"),n}();function MO(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ph(n,e,[Th],function(s){return Ja(vp(s.data[0],s.data[1]))},0,t)}u(MO,"deflate");function vp(n,e){return yc(n,e||{},0,0)}u(vp,"deflateSync");var fi=function(){function n(e){this.s={},this.p=new Nt(0),this.ondata=e}return u(n,"Inflate"),n.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,s=new Nt(t+e.length);s.set(this.p),s.set(e,t),this.p=s},n.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,s=mp(this.p,this.o,this.s);this.ondata(er(s,t,this.s.b),this.d),this.o=er(s,this.s.b-32768),this.s.b=this.o.length,this.p=er(this.p,this.s.p/8|0),this.s.p&=7},n.prototype.push=function(e,t){this.e(e),this.c(t)},n}(),vx=function(){function n(e){this.ondata=e,Rh([Eh,function(){return[tr,fi]}],this,0,function(){var t=new fi;onmessage=tr(t)},7)}return u(n,"AsyncInflate"),n}();function yx(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ph(n,e,[Eh],function(s){return Ja(Ih(s.data[0],hx(s.data[1])))},1,t)}u(yx,"inflate");function Ih(n,e){return mp(n,e)}u(Ih,"inflateSync");var h0=function(){function n(e,t){this.c=Ch(),this.l=0,this.v=1,Zr.call(this,e,t)}return u(n,"Gzip"),n.prototype.push=function(e,t){Zr.prototype.push.call(this,e,t)},n.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var s=yc(e,this.o,this.v&&px(this.o),t&&8,!t);this.v&&(dx(s,this.o),this.v=0),t&&(Zt(s,s.length-8,this.c.d()),Zt(s,s.length-4,this.l)),this.ondata(s,t)},n}(),H3=function(){function n(e,t){Rh([Th,vO,function(){return[tr,Zr,h0]}],this,gx.call(this,e,t),function(s){var i=new h0(s.data);onmessage=tr(i)},8)}return u(n,"AsyncGzip"),n}();function W3(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ph(n,e,[Th,vO,function(){return[d0]}],function(s){return Ja(d0(s.data[0],s.data[1]))},2,t)}u(W3,"gzip");function d0(n,e){e||(e={});var t=Ch(),s=n.length;t.p(n);var i=yc(n,e,px(e),8),r=i.length;return dx(i,e),Zt(i,r-8,t.d()),Zt(i,r-4,s),i}u(d0,"gzipSync");var f0=function(){function n(e){this.v=1,fi.call(this,e)}return u(n,"Gunzip"),n.prototype.push=function(e,t){if(fi.prototype.e.call(this,e),this.v){var s=this.p.length>3?fx(this.p):4;if(s>=this.p.length&&!t)return;this.p=this.p.subarray(s),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}fi.prototype.c.call(this,t)},n}(),SO=function(){function n(e){this.ondata=e,Rh([Eh,yO,function(){return[tr,fi,f0]}],this,0,function(){var t=new f0;onmessage=tr(t)},9)}return u(n,"AsyncGunzip"),n}();function CO(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ph(n,e,[Eh,yO,function(){return[p0]}],function(s){return Ja(p0(s.data[0]))},3,t)}u(CO,"gunzip");function p0(n,e){return mp(n.subarray(fx(n),-8),e||new Nt(wO(n)))}u(p0,"gunzipSync");var nb=function(){function n(e,t){this.c=ux(),this.v=1,Zr.call(this,e,t)}return u(n,"Zlib"),n.prototype.push=function(e,t){Zr.prototype.push.call(this,e,t)},n.prototype.p=function(e,t){this.c.p(e);var s=yc(e,this.o,this.v&&2,t&&4,!t);this.v&&(mx(s,this.o),this.v=0),t&&Zt(s,s.length-4,this.c.d()),this.ondata(s,t)},n}(),Yfe=function(){function n(e,t){Rh([Th,_O,function(){return[tr,Zr,nb]}],this,gx.call(this,e,t),function(s){var i=new nb(s.data);onmessage=tr(i)},10)}return u(n,"AsyncZlib"),n}();function qfe(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ph(n,e,[Th,_O,function(){return[sb]}],function(s){return Ja(sb(s.data[0],s.data[1]))},4,t)}u(qfe,"zlib");function sb(n,e){e||(e={});var t=ux();t.p(n);var s=yc(n,e,2,4);return mx(s,e),Zt(s,s.length-4,t.d()),s}u(sb,"zlibSync");var m0=function(){function n(e){this.v=1,fi.call(this,e)}return u(n,"Unzlib"),n.prototype.push=function(e,t){if(fi.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}fi.prototype.c.call(this,t)},n}(),EO=function(){function n(e){this.ondata=e,Rh([Eh,bO,function(){return[tr,fi,m0]}],this,0,function(){var t=new m0;onmessage=tr(t)},11)}return u(n,"AsyncUnzlib"),n}();function TO(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ph(n,e,[Eh,bO,function(){return[qf]}],function(s){return Ja(qf(s.data[0],hx(s.data[1])))},5,t)}u(TO,"unzlib");function qf(n,e){return mp((xO(n),n.subarray(2,-4)),e)}u(qf,"unzlibSync");var PO=function(){function n(e){this.G=f0,this.I=fi,this.Z=m0,this.ondata=e}return u(n,"Decompress"),n.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var s=new Nt(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,r=u(function(){i.ondata.apply(i,arguments)},"cb");this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},n}(),Kfe=function(){function n(e){this.G=SO,this.I=vx,this.Z=EO,this.ondata=e}return u(n,"AsyncDecompress"),n.prototype.push=function(e,t){PO.prototype.push.call(this,e,t)},n}();function Zfe(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return n[0]==31&&n[1]==139&&n[2]==8?CO(n,e,t):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?yx(n,e,t):TO(n,e,t)}u(Zfe,"decompress");function Qfe(n,e){return n[0]==31&&n[1]==139&&n[2]==8?p0(n,e):(n[0]&15)!=8||n[0]>>4>7||(n[0]<<8|n[1])%31?Ih(n,e):qf(n,e)}u(Qfe,"decompressSync");var _x=u(function(n,e,t,s){for(var i in n){var r=n[i],o=e+i;r instanceof Nt?t[o]=[r,s]:Array.isArray(r)?t[o]=[r[0],gp(s,r[1])]:_x(r,o+"/",t,s)}},"fltn"),j3=typeof TextEncoder!="undefined"&&new TextEncoder,ib=typeof TextDecoder!="undefined"&&new TextDecoder,RO=0;try{ib.decode(Do,{stream:!0}),RO=1}catch{}var IO=u(function(n){for(var e="",t=0;;){var s=n[t++],i=(s>127)+(s>223)+(s>239);if(t+i>n.length)return[e,er(n,t-1)];i?i==3?(s=((s&15)<<18|(n[t++]&63)<<12|(n[t++]&63)<<6|n[t++]&63)-65536,e+=String.fromCharCode(55296|s>>10,56320|s&1023)):i&1?e+=String.fromCharCode((s&31)<<6|n[t++]&63):e+=String.fromCharCode((s&15)<<12|(n[t++]&63)<<6|n[t++]&63):e+=String.fromCharCode(s)}},"dutf8"),Jfe=function(){function n(e){this.ondata=e,RO?this.t=new TextDecoder:this.p=Do}return u(n,"DecodeUTF8"),n.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var s=new Nt(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var i=IO(s),r=i[0],o=i[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(r,t)},n}(),epe=function(){function n(e){this.ondata=e}return u(n,"EncodeUTF8"),n.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Va(e),this.d=t||!1)},n}();function Va(n,e){if(e){for(var t=new Nt(n.length),s=0;s<n.length;++s)t[s]=n.charCodeAt(s);return t}if(j3)return j3.encode(n);for(var i=n.length,r=new Nt(n.length+(n.length>>1)),o=0,a=u(function(h){r[o++]=h},"w"),s=0;s<i;++s){if(o+5>r.length){var l=new Nt(o+8+(i-s<<1));l.set(r),r=l}var c=n.charCodeAt(s);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|n.charCodeAt(++s)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return er(r,0,o)}u(Va,"strToU8");function bx(n,e){if(e){for(var t="",s=0;s<n.length;s+=16384)t+=String.fromCharCode.apply(null,n.subarray(s,s+16384));return t}else{if(ib)return ib.decode(n);var i=IO(n),r=i[0],o=i[1];if(o.length)throw"invalid utf-8 data";return r}}u(bx,"strFromU8");var DO=u(function(n){return n==1?3:n<6?2:n==9?1:0},"dbf"),LO=u(function(n,e){return e+30+Zs(n,e+26)+Zs(n,e+28)},"slzh"),OO=u(function(n,e,t){var s=Zs(n,e+28),i=bx(n.subarray(e+46,e+46+s),!(Zs(n,e+8)&2048)),r=e+46+s,o=jn(n,e+20),a=t&&o==4294967295?kO(n,r):[o,jn(n,e+24),jn(n,e+42)],l=a[0],c=a[1],h=a[2];return[Zs(n,e+10),l,c,i,r+Zs(n,e+30)+Zs(n,e+32),h]},"zh"),kO=u(function(n,e){for(;Zs(n,e)!=1;e+=4+Zs(n,e+2));return[Cy(n,e+12),Cy(n,e+4),Cy(n,e+20)]},"z64e"),Na=u(function(n){var e=0;if(n)for(var t in n){var s=n[t].length;if(s>65535)throw"extra field too long";e+=s+4}return e},"exfl"),dh=u(function(n,e,t,s,i,r,o,a){var l=s.length,c=t.extra,h=a&&a.length,d=Na(c);Zt(n,e,o!=null?33639248:67324752),e+=4,o!=null&&(n[e++]=20,n[e++]=t.os),n[e]=20,e+=2,n[e++]=t.flag<<1|(r==null&&8),n[e++]=i&&8,n[e++]=t.compression&255,n[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Zt(n,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(Zt(n,e,t.crc),Zt(n,e+4,r),Zt(n,e+8,t.size)),Zt(n,e+12,l),Zt(n,e+14,d),e+=16,o!=null&&(Zt(n,e,h),Zt(n,e+6,t.attrs),Zt(n,e+10,o),e+=14),n.set(s,e),e+=l,d)for(var g in c){var m=c[g],v=m.length;Zt(n,e,+g),Zt(n,e+2,v),n.set(m,e+4),e+=4+v}return h&&(n.set(a,e),e+=h),e},"wzh"),wx=u(function(n,e,t,s,i){Zt(n,e,101010256),Zt(n,e+8,t),Zt(n,e+10,t),Zt(n,e+12,s),Zt(n,e+16,i)},"wzf"),Kf=function(){function n(e){this.filename=e,this.c=Ch(),this.size=0,this.compression=0}return u(n,"ZipPassThrough"),n.prototype.process=function(e,t){this.ondata(null,e,t)},n.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},n}(),tpe=function(){function n(e,t){var s=this;t||(t={}),Kf.call(this,e),this.d=new Zr(t,function(i,r){s.ondata(null,i,r)}),this.compression=8,this.flag=DO(t.level)}return u(n,"ZipDeflate"),n.prototype.process=function(e,t){try{this.d.push(e,t)}catch(s){this.ondata(s,null,t)}},n.prototype.push=function(e,t){Kf.prototype.push.call(this,e,t)},n}(),npe=function(){function n(e,t){var s=this;t||(t={}),Kf.call(this,e),this.d=new AO(t,function(i,r,o){s.ondata(i,r,o)}),this.compression=8,this.flag=DO(t.level),this.terminate=this.d.terminate}return u(n,"AsyncZipDeflate"),n.prototype.process=function(e,t){this.d.push(e,t)},n.prototype.push=function(e,t){Kf.prototype.push.call(this,e,t)},n}(),spe=function(){function n(e){this.ondata=e,this.u=[],this.d=1}return u(n,"Zip"),n.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var s=Va(e.filename),i=s.length,r=e.comment,o=r&&Va(r),a=i!=e.filename.length||o&&r.length!=o.length,l=i+Na(e.extra)+30;if(i>65535)throw"filename too long";var c=new Nt(l);dh(c,0,e,s,a);var h=[c],d=u(function(){for(var v=0,y=h;v<y.length;v++){var b=y[v];t.ondata(null,b,!1)}h=[]},"pAll"),f=this.d;this.d=0;var p=this.u.length,g=gp(e,{f:s,u:a,o,t:function(){e.terminate&&e.terminate()},r:function(){if(d(),f){var v=t.u[p+1];v?v.r():t.d=1}f=1}}),m=0;e.ondata=function(v,y,b){if(v)t.ondata(v,y,b),t.terminate();else if(m+=y.length,h.push(y),b){var _=new Nt(16);Zt(_,0,134695760),Zt(_,4,e.crc),Zt(_,8,m),Zt(_,12,e.size),h.push(_),g.c=m,g.b=l+m+16,g.crc=e.crc,g.size=e.size,f&&g.r(),f=1}else f&&d()},this.u.push(g)},n.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},n.prototype.e=function(){for(var e=0,t=0,s=0,i=0,r=this.u;i<r.length;i++){var o=r[i];s+=46+o.f.length+Na(o.extra)+(o.o?o.o.length:0)}for(var a=new Nt(s+22),l=0,c=this.u;l<c.length;l++){var o=c[l];dh(a,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+Na(o.extra)+(o.o?o.o.length:0),t+=o.b}wx(a,e,this.u.length,s,t),this.ondata(null,a,!0),this.d=2},n.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var s=t[e];s.t()}this.d=2},n}();function ipe(n,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var s={};_x(n,"",s,e);var i=Object.keys(s),r=i.length,o=0,a=0,l=r,c=new Array(r),h=[],d=u(function(){for(var m=0;m<h.length;++m)h[m]()},"tAll"),f=u(function(){var m=new Nt(a+22),v=o,y=a-o;a=0;for(var b=0;b<l;++b){var _=c[b];try{var w=_.c.length;dh(m,a,_,_.f,_.u,w);var x=30+_.f.length+Na(_.extra),S=a+x;m.set(_.c,S),dh(m,o,_,_.f,_.u,w,a,_.m),o+=16+x+(_.m?_.m.length:0),a=S+w}catch(C){return t(C,null)}}wx(m,o,c.length,y,v),t(null,m)},"cbf");r||f();for(var p=u(function(m){var v=i[m],y=s[v],b=y[0],_=y[1],w=Ch(),x=b.length;w.p(b);var S=Va(v),C=S.length,M=_.comment,R=M&&Va(M),D=R&&R.length,k=Na(_.extra),T=_.level==0?0:8,N=u(function(E,z){if(E)d(),t(E,null);else{var H=z.length;c[m]=gp(_,{size:x,crc:w.d(),c:z,f:S,m:R,u:C!=v.length||R&&M.length!=D,compression:T}),o+=30+C+k+H,a+=76+2*(C+k)+(D||0)+H,--r||f()}},"cbl");if(C>65535&&N("filename too long",null),!T)N(null,b);else if(x<16e4)try{N(null,vp(b,_))}catch(E){N(E,null)}else h.push(MO(b,_,N))},"_loop_1"),g=0;g<l;++g)p(g);return d}u(ipe,"zip");function rpe(n,e){e||(e={});var t={},s=[];_x(n,"",t,e);var i=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],h=c.level==0?0:8,d=Va(o),f=d.length,p=c.comment,g=p&&Va(p),m=g&&g.length,v=Na(c.extra);if(f>65535)throw"filename too long";var y=h?vp(l,c):l,b=y.length,_=Ch();_.p(l),s.push(gp(c,{size:l.length,crc:_.d(),c:y,f:d,m:g,u:f!=o.length||g&&p.length!=m,o:i,compression:h})),i+=30+f+v+b,r+=76+2*(f+v)+(m||0)+b}for(var w=new Nt(r+22),x=i,S=r-i,C=0;C<s.length;++C){var d=s[C];dh(w,d.o,d,d.f,d.u,d.c.length);var M=30+d.f.length+Na(d.extra);w.set(d.c,d.o+M),dh(w,i,d,d.f,d.u,d.c.length,d.o,d.m),i+=16+M+(d.m?d.m.length:0)}return wx(w,i,s.length,S,x),w}u(rpe,"zipSync");var NO=function(){function n(){}return u(n,"UnzipPassThrough"),n.prototype.push=function(e,t){this.ondata(null,e,t)},n.compression=0,n}(),ope=function(){function n(){var e=this;this.i=new fi(function(t,s){e.ondata(null,t,s)})}return u(n,"UnzipInflate"),n.prototype.push=function(e,t){try{this.i.push(e,t)}catch(s){this.ondata(s,e,t)}},n.compression=8,n}(),ape=function(){function n(e,t){var s=this;t<32e4?this.i=new fi(function(i,r){s.ondata(null,i,r)}):(this.i=new vx(function(i,r,o){s.ondata(i,r,o)}),this.terminate=this.i.terminate)}return u(n,"AsyncUnzipInflate"),n.prototype.push=function(e,t){this.i.terminate&&(e=er(e,0)),this.i.push(e,t)},n.compression=8,n}(),lpe=function(){function n(e){this.onfile=e,this.k=[],this.o={0:NO},this.p=Do}return u(n,"Unzip"),n.prototype.push=function(e,t){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),r=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(i),e.length)return this.push(e,t)}else{var o=0,a=0,l=void 0,c=void 0;this.p.length?e.length?(c=new Nt(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var h=c.length,d=this.c,f=d&&this.d,p=u(function(){var y,b=jn(c,a);if(b==67324752){o=1,l=a,g.d=null,g.c=0;var _=Zs(c,a+6),w=Zs(c,a+8),x=_&2048,S=_&8,C=Zs(c,a+26),M=Zs(c,a+28);if(h>a+30+C+M){var R=[];g.k.unshift(R),o=2;var D=jn(c,a+18),k=jn(c,a+22),T=bx(c.subarray(a+30,a+=30+C),!x);D==4294967295?(y=S?[-2]:kO(c,a),D=y[0],k=y[1]):S&&(D=-1),a+=M,g.c=D;var N,E={name:T,compression:w,start:function(){if(!E.ondata)throw"no callback";if(!D)E.ondata(null,Do,!0);else{var z=s.o[w];if(!z)throw"unknown compression type "+w;N=D<0?new z(T):new z(T,D,k),N.ondata=function(W,se,K){E.ondata(W,se,K)};for(var H=0,q=R;H<q.length;H++){var ne=q[H];N.push(ne,!1)}s.k[0]==R&&s.c?s.d=N:N.push(Do,!0)}},terminate:function(){N&&N.terminate&&N.terminate()}};D>=0&&(E.size=D,E.originalSize=k),g.onfile(E)}return"break"}else if(d){if(b==134695760)return l=a+=12+(d==-2&&8),o=3,g.c=0,"break";if(b==33639248)return l=a-=4,o=3,g.c=0,"break"}},"_loop_2"),g=this;a<h-4;++a){var m=p();if(m==="break")break}if(this.p=Do,d<0){var v=o?c.subarray(0,l-12-(d==-2&&8)-(jn(c,l-16)==134695760&&4)):c.subarray(0,a);f?f.push(v,!!o):this.k[+(o==2)].push(v)}if(o&2)return this.push(c.subarray(a),t);this.p=c.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},n.prototype.register=function(e){this.o[e.compression]=e},n}();function cpe(n,e){if(typeof e!="function")throw"no callback";for(var t=[],s=u(function(){for(var f=0;f<t.length;++f)t[f]()},"tAll"),i={},r=n.length-22;jn(n,r)!=101010256;--r)if(!r||n.length-r>65558){e("invalid zip file",null);return}var o=Zs(n,r+8);o||e(null,{});var a=o,l=jn(n,r+16),c=l==4294967295;if(c){if(r=jn(n,r-12),jn(n,r)!=101075792){e("invalid zip file",null);return}a=o=jn(n,r+32),l=jn(n,r+48)}for(var h=u(function(f){var p=OO(n,l,c),g=p[0],m=p[1],v=p[2],y=p[3],b=p[4],_=p[5],w=LO(n,_);l=b;var x=u(function(C,M){C?(s(),e(C,null)):(i[y]=M,--o||e(null,i))},"cbl");if(!g)x(null,er(n,w,w+m));else if(g==8){var S=n.subarray(w,w+m);if(m<32e4)try{x(null,Ih(S,new Nt(v)))}catch(C){x(C,null)}else t.push(yx(S,{size:v},x))}else x("unknown compression type "+g,null)},"_loop_3"),d=0;d<a;++d)h();return s}u(cpe,"unzip");function upe(n){for(var e={},t=n.length-22;jn(n,t)!=101010256;--t)if(!t||n.length-t>65558)throw"invalid zip file";var s=Zs(n,t+8);if(!s)return{};var i=jn(n,t+16),r=i==4294967295;if(r){if(t=jn(n,t-12),jn(n,t)!=101075792)throw"invalid zip file";s=jn(n,t+32),i=jn(n,t+48)}for(var o=0;o<s;++o){var a=OO(n,i,r),l=a[0],c=a[1],h=a[2],d=a[3],f=a[4],p=a[5],g=LO(n,p);if(i=f,!l)e[d]=er(n,g,g+c);else if(l==8)e[d]=Ih(n.subarray(g,g+c),new Nt(h));else throw"unknown compression type "+l}return e}u(upe,"unzipSync");var hpe=Object.freeze(Object.defineProperty({__proto__:null,Deflate:Zr,AsyncDeflate:AO,deflate:MO,deflateSync:vp,Inflate:fi,AsyncInflate:vx,inflate:yx,inflateSync:Ih,Gzip:h0,AsyncGzip:H3,gzip:W3,gzipSync:d0,Gunzip:f0,AsyncGunzip:SO,gunzip:CO,gunzipSync:p0,Zlib:nb,AsyncZlib:Yfe,zlib:qfe,zlibSync:sb,Unzlib:m0,AsyncUnzlib:EO,unzlib:TO,unzlibSync:qf,compress:W3,AsyncCompress:H3,compressSync:d0,Compress:h0,Decompress:PO,AsyncDecompress:Kfe,decompress:Zfe,decompressSync:Qfe,DecodeUTF8:Jfe,EncodeUTF8:epe,strToU8:Va,strFromU8:bx,ZipPassThrough:Kf,ZipDeflate:tpe,AsyncZipDeflate:npe,Zip:spe,zip:ipe,zipSync:rpe,UnzipPassThrough:NO,UnzipInflate:ope,AsyncUnzipInflate:ape,Unzip:lpe,unzip:cpe,unzipSync:upe},Symbol.toStringTag,{value:"Module"}));function FO(n,e,t){const s=t.length-n-1;if(e>=t[s])return s-1;if(e<=t[n])return n;let i=n,r=s,o=Math.floor((i+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:i=o,o=Math.floor((i+r)/2);return o}u(FO,"findSpan");function dpe(n,e,t,s){const i=[],r=[],o=[];i[0]=1;for(let a=1;a<=t;++a){r[a]=e-s[n+1-a],o[a]=s[n+a]-e;let l=0;for(let c=0;c<a;++c){const h=o[c+1],d=r[a-c],f=i[c]/(h+d);i[c]=l+h*f,l=d*f}i[a]=l}return i}u(dpe,"calcBasisFunctions");function fpe(n,e,t,s){const i=FO(n,s,e),r=dpe(i,s,n,e),o=new Ft(0,0,0,0);for(let a=0;a<=n;++a){const l=t[i-n+a],c=r[a],h=l.w*c;o.x+=l.x*h,o.y+=l.y*h,o.z+=l.z*h,o.w+=l.w*c}return o}u(fpe,"calcBSplinePoint");function ppe(n,e,t,s,i){const r=[];for(let d=0;d<=t;++d)r[d]=0;const o=[];for(let d=0;d<=s;++d)o[d]=r.slice(0);const a=[];for(let d=0;d<=t;++d)a[d]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let d=1;d<=t;++d){l[d]=e-i[n+1-d],c[d]=i[n+d]-e;let f=0;for(let p=0;p<d;++p){const g=c[p+1],m=l[d-p];a[d][p]=g+m;const v=a[p][d-1]/a[d][p];a[p][d]=f+g*v,f=m*v}a[d][d]=f}for(let d=0;d<=t;++d)o[0][d]=a[d][t];for(let d=0;d<=t;++d){let f=0,p=1;const g=[];for(let m=0;m<=t;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=s;++m){let v=0;const y=d-m,b=t-m;d>=m&&(g[p][0]=g[f][0]/a[b+1][y],v=g[p][0]*a[y][b]);const _=y>=-1?1:-y,w=d-1<=b?m-1:t-d;for(let S=_;S<=w;++S)g[p][S]=(g[f][S]-g[f][S-1])/a[b+1][y+S],v+=g[p][S]*a[y+S][b];d<=b&&(g[p][m]=-g[f][m-1]/a[b+1][d],v+=g[p][m]*a[d][b]),o[m][d]=v;const x=f;f=p,p=x}}let h=t;for(let d=1;d<=s;++d){for(let f=0;f<=t;++f)o[d][f]*=h;h*=t-d}return o}u(ppe,"calcBasisFunctionDerivatives");function mpe(n,e,t,s,i){const r=i<n?i:n,o=[],a=FO(n,s,e),l=ppe(a,s,n,r,e),c=[];for(let h=0;h<t.length;++h){const d=t[h].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,c[h]=d}for(let h=0;h<=r;++h){const d=c[a-n].clone().multiplyScalar(l[h][0]);for(let f=1;f<=n;++f)d.add(c[a-n+f].clone().multiplyScalar(l[h][f]));o[h]=d}for(let h=r+1;h<=i+1;++h)o[h]=new Ft(0,0,0);return o}u(mpe,"calcBSplineDerivatives");function gpe(n,e){let t=1;for(let i=2;i<=n;++i)t*=i;let s=1;for(let i=2;i<=e;++i)s*=i;for(let i=2;i<=n-e;++i)s*=i;return t/s}u(gpe,"calcKoverI");function vpe(n){const e=n.length,t=[],s=[];for(let r=0;r<e;++r){const o=n[r];t[r]=new P(o.x,o.y,o.z),s[r]=o.w}const i=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(i[r-a].clone().multiplyScalar(gpe(r,a)*s[a]));i[r]=o.divideScalar(s[0])}return i}u(vpe,"calcRationalCurveDerivatives");function ype(n,e,t,s,i){const r=mpe(n,e,t,s,i);return vpe(r)}u(ype,"calcNURBSDerivatives");class rb extends Vb{constructor(e,t,s,i,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<s.length;++o){const a=s[o];this.controlPoints[o]=new Ft(a.x,a.y,a.z,a.w)}}getPoint(e,t=new P){const s=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=fpe(this.degree,this.knots,this.controlPoints,i);return r.w!==1&&r.divideScalar(r.w),s.set(r.x,r.y,r.z)}getTangent(e,t=new P){const s=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=ype(this.degree,this.knots,this.controlPoints,i,1);return s.copy(r[1]).normalize(),s}}u(rb,"NURBSCurve");let Rt,Vn,li;class zO extends Ka{constructor(e){super(e)}load(e,t,s,i){const r=this,o=r.path===""?br.extractUrlBase(e):r.path,a=new np(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){i?i(c):console.error(c),r.manager.itemError(e)}},s,i)}parse(e,t){if(_pe(e))Rt=new GO().parse(e);else{const i=jO(e);if(!bpe(i))throw new Error("THREE.FBXLoader: Unknown format.");if(X3(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+X3(i));Rt=new VO().parse(i)}const s=new sp(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new BO(s,this.manager).parse(Rt)}}u(zO,"FBXLoader");class BO{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Vn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),s=this.parseMaterials(t),i=this.parseDeformers(),r=new UO().parse(i);return this.parseScene(i,r,s),li}parseConnections(){const e=new Map;return"Connections"in Rt&&Rt.Connections.connections.forEach(function(s){const i=s[0],r=s[1],o=s[2];e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(i).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:i,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in Rt.Objects){const s=Rt.Objects.Video;for(const i in s){const r=s[i],o=parseInt(i);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(s[i]);t[r.RelativeFilename||r.Filename]=c}}}}for(const s in e){const i=e[s];t[i]!==void 0?e[s]=t[i]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const t=e.Content,s=e.RelativeFilename||e.Filename,i=s.slice(s.lastIndexOf(".")+1).toLowerCase();let r;switch(i){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in Rt.Objects){const s=Rt.Objects.Texture;for(const i in s){const r=this.parseTexture(s[i],e);t.set(parseInt(i),r)}}return t}parseTexture(e,t){const s=this.loadTexture(e,t);s.ID=e.id,s.name=e.attrName;const i=e.WrapModeU,r=e.WrapModeV,o=i!==void 0?i.value:0,a=r!==void 0?r.value:0;if(s.wrapS=o===0?zo:Ks,s.wrapT=a===0?zo:Ks,"Scaling"in e){const l=e.Scaling.value;s.repeat.x=l[0],s.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;s.offset.x=l[0],s.offset.y=l[1]}return s}loadTexture(e,t){let s;const i=this.textureLoader.path,r=Vn.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(s=t[r[0].ID],(s.indexOf("blob:")===0||s.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new is):(l.setPath(this.textureLoader.path),o=l.load(s))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new is):o=this.textureLoader.load(s);return this.textureLoader.setPath(i),o}parseMaterials(e){const t=new Map;if("Material"in Rt.Objects){const s=Rt.Objects.Material;for(const i in s){const r=this.parseMaterial(s[i],e);r!==null&&t.set(parseInt(i),r)}}return t}parseMaterial(e,t){const s=e.id,i=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!Vn.has(s))return null;const o=this.parseParameters(e,t,s);let a;switch(r.toLowerCase()){case"phong":a=new ff;break;case"lambert":a=new Gb;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new ff;break}return a.setValues(o),a.name=i,a}parseParameters(e,t,s){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new De().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new De().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new De().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new De().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new De().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new De().fromArray(e.SpecularColor.value));const r=this;return Vn.get(s).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":i.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":i.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=r.getTexture(t,o.ID),i.map!==void 0&&(i.map.encoding=Bt);break;case"DisplacementColor":i.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":i.emissiveMap=r.getTexture(t,o.ID),i.emissiveMap!==void 0&&(i.emissiveMap.encoding=Bt);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":i.envMap=r.getTexture(t,o.ID),i.envMap!==void 0&&(i.envMap.mapping=e0,i.envMap.encoding=Bt);break;case"SpecularColor":i.specularMap=r.getTexture(t,o.ID),i.specularMap!==void 0&&(i.specularMap.encoding=Bt);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=r.getTexture(t,o.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),i}getTexture(e,t){return"LayeredTexture"in Rt.Objects&&t in Rt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Vn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Rt.Objects){const s=Rt.Objects.Deformer;for(const i in s){const r=s[i],o=Vn.get(parseInt(i));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,s);a.ID=i,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[i]=a}else if(r.attrType==="BlendShape"){const a={id:i};a.rawTargets=this.parseMorphTargets(o,s),a.id=i,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const s=[];return e.children.forEach(function(i){const r=t[i.ID];if(r.attrType!=="Cluster")return;const o={ID:i.ID,indices:[],weights:[],transformLink:new be().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),s.push(o)}),{rawBones:s,bones:[]}}parseMorphTargets(e,t){const s=[];for(let i=0;i<e.children.length;i++){const r=e.children[i],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Vn.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,s.push(a)}return s}parseScene(e,t,s){li=new ls;const i=this.parseModels(e.skeletons,t,s),r=Rt.Objects.Model,o=this;i.forEach(function(l){const c=r[l.ID];o.setLookAtProperties(l,c),Vn.get(l.ID).parents.forEach(function(d){const f=i.get(d.ID);f!==void 0&&f.add(l)}),l.parent===null&&li.add(l)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),li.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=HO(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new $O().parse();li.children.length===1&&li.children[0].isGroup&&(li.children[0].animations=a,li=li.children[0]),li.animations=a}parseModels(e,t,s){const i=new Map,r=Rt.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=Vn.get(a);let h=this.buildSkeleton(c,e,a,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,s);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new Df;break;case"Null":default:h=new ls;break}h.name=l.attrName?St.sanitizeNodeName(l.attrName):"",h.ID=a}this.getTransformData(h,l),i.set(a,h)}return i}buildSkeleton(e,t,s,i){let r=null;return e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,h){if(c.ID===o.ID){const d=r;r=new Df,r.matrixWorld.copy(c.transformLink),r.name=i?St.sanitizeNodeName(i):"",r.ID=s,l.bones[h]=r,d!==null&&r.add(d)}})}}),r}createCamera(e){let t,s;if(e.children.forEach(function(i){const r=Rt.Objects.NodeAttribute[i.ID];r!==void 0&&(s=r)}),s===void 0)t=new Lt;else{let i=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(i=1);let r=1;s.NearPlane!==void 0&&(r=s.NearPlane.value/1e3);let o=1e3;s.FarPlane!==void 0&&(o=s.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(a=s.AspectWidth.value,l=s.AspectHeight.value);const c=a/l;let h=45;s.FieldOfView!==void 0&&(h=s.FieldOfView.value);const d=s.FocalLength?s.FocalLength.value:null;switch(i){case 0:t=new _s(h,c,r,o),d!==null&&t.setFocalLength(d);break;case 1:t=new Ya(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new Lt;break}}return t}createLight(e){let t,s;if(e.children.forEach(function(i){const r=Rt.Objects.NodeAttribute[i.ID];r!==void 0&&(s=r)}),s===void 0)t=new Lt;else{let i;s.LightType===void 0?i=0:i=s.LightType.value;let r=16777215;s.Color!==void 0&&(r=new De().fromArray(s.Color.value));let o=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(o=0);let a=0;s.FarAttenuationEnd!==void 0&&(s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?a=0:a=s.FarAttenuationEnd.value);const l=1;switch(i){case 0:t=new ka(r,o,a,l);break;case 1:t=new e1(r,o);break;case 2:let c=Math.PI/3;s.InnerAngle!==void 0&&(c=Xi.degToRad(s.InnerAngle.value));let h=0;s.OuterAngle!==void 0&&(h=Xi.degToRad(s.OuterAngle.value),h=Math.max(h,1)),t=new J0(r,o,a,c,h,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),t=new ka(r,o);break}s.CastShadows!==void 0&&s.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,s){let i,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),s.has(l.ID)&&a.push(s.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new ff({color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(i=new $b(r,o),i.normalizeSkinWeights()):i=new Ye(r,o),i}createCurve(e,t){const s=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),i=new Bs({color:3342591,linewidth:1});return new Zi(s,i)}getTransformData(e,t){const s={};"InheritType"in t&&(s.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?s.eulerOrder=WO(t.RotationOrder.value):s.eulerOrder="ZYX","Lcl_Translation"in t&&(s.translation=t.Lcl_Translation.value),"PreRotation"in t&&(s.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(s.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(s.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(s.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(s.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(s.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(s.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(s.rotationPivot=t.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,t){"LookAtProperty"in t&&Vn.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const r=Rt.Objects.Model[i.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),li.add(e.target)):e.lookAt(new P().fromArray(o))}}})}bindSkeleton(e,t,s){const i=this.parsePoseNodes();for(const r in e){const o=e[r];Vn.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;Vn.get(c).parents.forEach(function(d){s.has(d.ID)&&s.get(d.ID).bind(new tp(o.bones),i[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Rt.Objects){const t=Rt.Objects.Pose;for(const s in t)if(t[s].attrType==="BindPose"&&t[s].NbPoseNodes>0){const i=t[s].PoseNode;Array.isArray(i)?i.forEach(function(r){e[r.Node]=new be().fromArray(r.Matrix.a)}):e[i.Node]=new be().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Rt&&"AmbientColor"in Rt.GlobalSettings){const e=Rt.GlobalSettings.AmbientColor.value,t=e[0],s=e[1],i=e[2];if(t!==0||s!==0||i!==0){const r=new De(t,s,i);li.add(new t1(r,1))}}}}u(BO,"FBXTreeParser");class UO{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Rt.Objects){const s=Rt.Objects.Geometry;for(const i in s){const r=Vn.get(parseInt(i)),o=this.parseGeometry(r,s[i],e);t.set(parseInt(i),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,s){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,s);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,s){const i=s.skeletons,r=[],o=e.parents.map(function(d){return Rt.Objects.Model[d.ID]});if(o.length===0)return;const a=e.children.reduce(function(d,f){return i[f.ID]!==void 0&&(d=i[f.ID]),d},null);e.children.forEach(function(d){s.morphTargets[d.ID]!==void 0&&r.push(s.morphTargets[d.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=WO(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=HO(c);return this.genGeometry(t,a,r,h)}genGeometry(e,t,s,i){const r=new at;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new We(a.vertex,3);if(l.applyMatrix4(i),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new We(a.colors,3)),t&&(r.setAttribute("skinIndex",new G0(a.weightsIndices,4)),r.setAttribute("skinWeight",new We(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new Qs().getNormalMatrix(i),h=new We(a.normal,3);h.applyNormalMatrix(c),r.setAttribute("normal",h)}if(a.uvs.forEach(function(c,h){let d="uv"+(h+1).toString();h===0&&(d="uv"),r.setAttribute(d,new We(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(d,f){d!==c&&(r.addGroup(h,f-h,c),c=d,h=f)}),r.groups.length>0){const d=r.groups[r.groups.length-1],f=d.start+d.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,s,i),r}parseGeoNode(e,t){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return s.weightTable={},t!==null&&(s.skeleton=t,t.rawBones.forEach(function(i,r){i.indices.forEach(function(o,a){s.weightTable[o]===void 0&&(s.weightTable[o]=[]),s.weightTable[o].push({id:r,weight:i.weights[a]})})})),s}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,i=0,r=!1,o=[],a=[],l=[],c=[],h=[],d=[];const f=this;return e.vertexIndices.forEach(function(p,g){let m,v=!1;p<0&&(p=p^-1,v=!0);let y=[],b=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const _=Fm(g,s,p,e.color);l.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(_){b.push(_.weight),y.push(_.id)}),b.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],w=[0,0,0,0];b.forEach(function(x,S){let C=x,M=y[S];w.forEach(function(R,D,k){if(C>R){k[D]=C,C=R;const T=_[D];_[D]=M,M=T}})}),y=_,b=w}for(;b.length<4;)b.push(0),y.push(0);for(let _=0;_<4;++_)h.push(b[_]),d.push(y[_])}if(e.normal){const _=Fm(g,s,p,e.normal);a.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=Fm(g,s,p,e.material)[0],m<0&&(f.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(_,w){const x=Fm(g,s,p,_);c[w]===void 0&&(c[w]=[]),c[w].push(x[0]),c[w].push(x[1])}),i++,v&&(f.genFace(t,e,o,m,a,l,c,h,d,i),s++,i=0,o=[],a=[],l=[],c=[],h=[],d=[])}),t}genFace(e,t,s,i,r,o,a,l,c,h){for(let d=2;d<h;d++)e.vertex.push(t.vertexPositions[s[0]]),e.vertex.push(t.vertexPositions[s[1]]),e.vertex.push(t.vertexPositions[s[2]]),e.vertex.push(t.vertexPositions[s[(d-1)*3]]),e.vertex.push(t.vertexPositions[s[(d-1)*3+1]]),e.vertex.push(t.vertexPositions[s[(d-1)*3+2]]),e.vertex.push(t.vertexPositions[s[d*3]]),e.vertex.push(t.vertexPositions[s[d*3+1]]),e.vertex.push(t.vertexPositions[s[d*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(d-1)*4]),e.vertexWeights.push(l[(d-1)*4+1]),e.vertexWeights.push(l[(d-1)*4+2]),e.vertexWeights.push(l[(d-1)*4+3]),e.vertexWeights.push(l[d*4]),e.vertexWeights.push(l[d*4+1]),e.vertexWeights.push(l[d*4+2]),e.vertexWeights.push(l[d*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(d-1)*4]),e.weightsIndices.push(c[(d-1)*4+1]),e.weightsIndices.push(c[(d-1)*4+2]),e.weightsIndices.push(c[(d-1)*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(d-1)*3]),e.colors.push(o[(d-1)*3+1]),e.colors.push(o[(d-1)*3+2]),e.colors.push(o[d*3]),e.colors.push(o[d*3+1]),e.colors.push(o[d*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(d-1)*3]),e.normal.push(r[(d-1)*3+1]),e.normal.push(r[(d-1)*3+2]),e.normal.push(r[d*3]),e.normal.push(r[d*3+1]),e.normal.push(r[d*3+2])),t.uv&&t.uv.forEach(function(f,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(d-1)*2]),e.uvs[p].push(a[p][(d-1)*2+1]),e.uvs[p].push(a[p][d*2]),e.uvs[p].push(a[p][d*2+1])})}addMorphTargets(e,t,s,i){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;s.forEach(function(o){o.rawTargets.forEach(function(a){const l=Rt.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,i,a.name)})})}genMorphGeometry(e,t,s,i,r){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=s.Vertices!==void 0?s.Vertices.a:[],l=s.Indexes!==void 0?s.Indexes.a:[],c=e.attributes.position.count*3,h=new Float32Array(c);for(let g=0;g<l.length;g++){const m=l[g]*3;h[m]=a[g*3],h[m+1]=a[g*3+1],h[m+2]=a[g*3+2]}const d={vertexIndices:o,vertexPositions:h},f=this.genBuffers(d),p=new We(f.vertex,3);p.name=r||s.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,i=e.Normals.a;let r=[];return s==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:r,mappingType:t,referenceType:s}}parseUVs(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,i=e.UV.a;let r=[];return s==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:i,indices:r,mappingType:t,referenceType:s}}parseVertexColors(e){const t=e.MappingInformationType,s=e.ReferenceInformationType,i=e.Colors.a;let r=[];return s==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:i,indices:r,mappingType:t,referenceType:s}}parseMaterialIndices(e){const t=e.MappingInformationType,s=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const i=e.Materials.a,r=[];for(let o=0;o<i.length;++o)r.push(o);return{dataSize:1,buffer:i,indices:r,mappingType:t,referenceType:s}}parseNurbsGeometry(e){if(rb===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new at;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new at;const s=t-1,i=e.KnotVector.a,r=[],o=e.Points.a;for(let d=0,f=o.length;d<f;d+=4)r.push(new Ft().fromArray(o,d));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=s,l=i.length-1-a;for(let d=0;d<s;++d)r.push(r[d])}const h=new rb(s,i,r,a,l).getPoints(r.length*12);return new at().setFromPoints(h)}}u(UO,"GeometryParser");class $O{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const s in t){const i=t[s],r=this.addClip(i);e.push(r)}return e}parseClips(){if(Rt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Rt.Objects.AnimationCurveNode,t=new Map;for(const s in e){const i=e[s];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:i.id,attr:i.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=Rt.Objects.AnimationCurve;for(const s in t){const i={id:t[s].id,times:t[s].KeyTime.a.map(wpe),values:t[s].KeyValueFloat.a},r=Vn.get(i.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=i:a.match(/Y/)?e.get(o).curves.y=i:a.match(/Z/)?e.get(o).curves.z=i:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=i)}}}parseAnimationLayers(e){const t=Rt.Objects.AnimationLayer,s=new Map;for(const i in t){const r=[],o=Vn.get(parseInt(i));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const h=e.get(l.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(r[c]===void 0){const d=Vn.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(d!==void 0){const f=Rt.Objects.Model[d.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:f.attrName?St.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};li.traverse(function(g){g.ID===f.id&&(p.transform=g.matrix,g.userData.transformData&&(p.eulerOrder=g.userData.transformData.eulerOrder))}),p.transform||(p.transform=new be),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[c]=p}}r[c]&&(r[c][h.attr]=h)}else if(h.curves.morph!==void 0){if(r[c]===void 0){const d=Vn.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,f=Vn.get(d).parents[0].ID,p=Vn.get(f).parents[0].ID,g=Vn.get(p).parents[0].ID,m=Rt.Objects.Model[g],v={modelName:m.attrName?St.sanitizeNodeName(m.attrName):"",morphName:Rt.Objects.Deformer[d].attrName};r[c]=v}r[c][h.attr]=h}}}),s.set(parseInt(i),r))}return s}parseAnimStacks(e){const t=Rt.Objects.AnimationStack,s={};for(const i in t){const r=Vn.get(parseInt(i)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);s[i]={name:t[i].attrName,layer:o}}return s}addClip(e){let t=[];const s=this;return e.layer.forEach(function(i){t=t.concat(s.generateTracks(i))}),new Wb(e.name,-1,t)}generateTracks(e){const t=[];let s=new P,i=new qe,r=new P;if(e.transform&&e.transform.decompose(s,i,r),s=s.toArray(),i=new ft().setFromQuaternion(i,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,s,i){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,s);return new Jl(e+"."+i,r,o)}generateRotationTrack(e,t,s,i,r,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Xi.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Xi.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Xi.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,s);i!==void 0&&(i=i.map(Xi.degToRad),i.push(o),i=new ft().fromArray(i),i=new qe().setFromEuler(i)),r!==void 0&&(r=r.map(Xi.degToRad),r.push(o),r=new ft().fromArray(r),r=new qe().setFromEuler(r).invert());const c=new qe,h=new ft,d=[];for(let f=0;f<l.length;f+=3)h.set(l[f],l[f+1],l[f+2],o),c.setFromEuler(h),i!==void 0&&c.premultiply(i),r!==void 0&&c.multiply(r),c.toArray(d,f/3*4);return new Uo(e+".quaternion",a,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,s=t.values.map(function(r){return r/100}),i=li.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ql(e.modelName+".morphTargetInfluences["+i+"]",t.times,s)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(s,i){return s-i}),t.length>1){let s=1,i=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==i&&(t[s]=o,i=o,s++)}t=t.slice(0,s)}return t}getKeyframeTrackValues(e,t,s){const i=s,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const h=t.x.values[o];r.push(h),i[0]=h}else r.push(i[0]);if(a!==-1){const h=t.y.values[a];r.push(h),i[1]=h}else r.push(i[1]);if(l!==-1){const h=t.z.values[l];r.push(h),i[2]=h}else r.push(i[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const s=e.values[t-1],i=e.values[t]-s,r=Math.abs(i);if(r>=180){const o=r/180,a=i/o;let l=s+a;const c=e.times[t-1],d=(e.times[t]-c)/o;let f=c+d;const p=[],g=[];for(;f<e.times[t];)p.push(f),f+=d,g.push(l),l+=a;e.times=Y3(e.times,t,p),e.values=Y3(e.values,t,g)}}}}u($O,"AnimationParser");class VO{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new xx,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,s=e.split(/[\r\n]+/);return s.forEach(function(i,r){const o=i.match(/^[\s\t]*;/),a=i.match(/^[\s\t]*$/);if(o||a)return;const l=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=i.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(i,l):c?t.parseNodeProperty(i,c,s[++r]):h?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const s=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:s},o=this.parseNodeAttr(i),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,r):s in a?(s==="PoseNode"?a.PoseNode.push(r):a[s].id!==void 0&&(a[s]={},a[s][a[s].id]=a[s]),o.id!==""&&(a[s][o.id]=r)):typeof o.id=="number"?(a[s]={},a[s][o.id]=r):s!=="Properties70"&&(s==="PoseNode"?a[s]=[r]:a[s]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let s="",i="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:s,type:i}}parseNodeProperty(e,t,s){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&r===","&&(r=s.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,i,r);return}if(i==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),h=parseInt(l[1]);let d=r.split(",").slice(3);d=d.map(function(f){return f.trim().replace(/^"/,"")}),i="connections",r=[c,h],Ape(r,d),o[i]===void 0&&(o[i]=[])}i==="Node"&&(o.id=r),i in o&&Array.isArray(o[i])?o[i].push(r):i!=="a"?o[i]=r:o.a=r,this.setCurrentProp(o,i),i==="a"&&r.slice(-1)!==","&&(o.a=Ty(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Ty(t.a))}parseNodeSpecialProperty(e,t,s){const i=s.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=i[0],o=i[1],a=i[2],l=i[3];let c=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Ty(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}u(VO,"TextParser");class GO{parse(e){const t=new ob(e);t.skip(23);const s=t.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const i=new xx;for(;!this.endOfContent(t);){const r=this.parseNode(t,s);r!==null&&i.add(r.name,r)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const s={},i=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(i===0)return null;const l=[];for(let f=0;f<r;f++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(s.singleProperty=r===1&&e.getOffset()===i;i>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,s,f)}return s.propertyList=l,typeof c=="number"&&(s.id=c),h!==""&&(s.attrName=h),d!==""&&(s.attrType=d),a!==""&&(s.name=a),s}parseSubNode(e,t,s){if(s.singleProperty===!0){const i=s.propertyList[0];Array.isArray(i)?(t[s.name]=s,s.a=i):t[s.name]=i}else if(e==="Connections"&&s.name==="C"){const i=[];s.propertyList.forEach(function(r,o){o!==0&&i.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(s.name==="Properties70")Object.keys(s).forEach(function(r){t[r]=s[r]});else if(e==="Properties70"&&s.name==="P"){let i=s.propertyList[0],r=s.propertyList[1];const o=s.propertyList[2],a=s.propertyList[3];let l;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:l=s.propertyList[4],t[i]={type:r,type2:o,flag:a,value:l}}else t[s.name]===void 0?typeof s.id=="number"?(t[s.name]={},t[s.name][s.id]=s):t[s.name]=s:s.name==="PoseNode"?(Array.isArray(t[s.name])||(t[s.name]=[t[s.name]]),t[s.name].push(s)):t[s.name][s.id]===void 0&&(t[s.name][s.id]=s)}parseProperty(e){const t=e.getString(1);let s;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}typeof hpe=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=qf(new Uint8Array(e.getArrayBuffer(o))),l=new ob(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}u(GO,"BinaryParser");class ob{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let s=0;s<e;s++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let s=0;s<e;s++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let i=0;i<e;i++)t[i]=this.getUint8();const s=t.indexOf(0);return s>=0&&(t=t.slice(0,s)),br.decodeText(new Uint8Array(t))}}u(ob,"BinaryReader");class xx{add(e,t){this[e]=t}}u(xx,"FBXTree");function _pe(n){const e="Kaydara FBX Binary  \0";return n.byteLength>=e.length&&e===jO(n,0,e.length)}u(_pe,"isFbxFormatBinary");function bpe(n){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function s(i){const r=n[i-1];return n=n.slice(t+i),t++,r}u(s,"read");for(let i=0;i<e.length;++i)if(s(1)===e[i])return!1;return!0}u(bpe,"isFbxFormatASCII");function X3(n){const e=/FBXVersion: (\d+)/,t=n.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}u(X3,"getFbxVersion");function wpe(n){return n/46186158e3}u(wpe,"convertFBXTimeToSeconds");const xpe=[];function Fm(n,e,t,s){let i;switch(s.mappingType){case"ByPolygonVertex":i=n;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(i=s.indices[i]);const r=i*s.dataSize,o=r+s.dataSize;return Mpe(xpe,s.buffer,r,o)}u(Fm,"getData");const Ey=new ft,jc=new P;function HO(n){const e=new be,t=new be,s=new be,i=new be,r=new be,o=new be,a=new be,l=new be,c=new be,h=new be,d=new be,f=new be,p=n.inheritType?n.inheritType:0;if(n.translation&&e.setPosition(jc.fromArray(n.translation)),n.preRotation){const D=n.preRotation.map(Xi.degToRad);D.push(n.eulerOrder||ft.DefaultOrder),t.makeRotationFromEuler(Ey.fromArray(D))}if(n.rotation){const D=n.rotation.map(Xi.degToRad);D.push(n.eulerOrder||ft.DefaultOrder),s.makeRotationFromEuler(Ey.fromArray(D))}if(n.postRotation){const D=n.postRotation.map(Xi.degToRad);D.push(n.eulerOrder||ft.DefaultOrder),i.makeRotationFromEuler(Ey.fromArray(D)),i.invert()}n.scale&&r.scale(jc.fromArray(n.scale)),n.scalingOffset&&a.setPosition(jc.fromArray(n.scalingOffset)),n.scalingPivot&&o.setPosition(jc.fromArray(n.scalingPivot)),n.rotationOffset&&l.setPosition(jc.fromArray(n.rotationOffset)),n.rotationPivot&&c.setPosition(jc.fromArray(n.rotationPivot)),n.parentMatrixWorld&&(d.copy(n.parentMatrix),h.copy(n.parentMatrixWorld));const g=t.clone().multiply(s).multiply(i),m=new be;m.extractRotation(h);const v=new be;v.copyPosition(h);const y=v.clone().invert().multiply(h),b=m.clone().invert().multiply(y),_=r,w=new be;if(p===0)w.copy(m).multiply(g).multiply(b).multiply(_);else if(p===1)w.copy(m).multiply(b).multiply(g).multiply(_);else{const k=new be().scale(new P().setFromMatrixScale(d)).clone().invert(),T=b.clone().multiply(k);w.copy(m).multiply(g).multiply(T).multiply(_)}const x=c.clone().invert(),S=o.clone().invert();let C=e.clone().multiply(l).multiply(c).multiply(t).multiply(s).multiply(i).multiply(x).multiply(a).multiply(o).multiply(r).multiply(S);const M=new be().copyPosition(C),R=h.clone().multiply(M);return f.copyPosition(R),C=f.clone().multiply(w),C.premultiply(h.invert()),C}u(HO,"generateTransform");function WO(n){n=n||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return n===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[n]}u(WO,"getEulerOrder");function Ty(n){return n.split(",").map(function(t){return parseFloat(t)})}u(Ty,"parseNumberArray");function jO(n,e,t){return e===void 0&&(e=0),t===void 0&&(t=n.byteLength),br.decodeText(new Uint8Array(n,e,t))}u(jO,"convertArrayBufferToString");function Ape(n,e){for(let t=0,s=n.length,i=e.length;t<i;t++,s++)n[s]=e[t]}u(Ape,"append");function Mpe(n,e,t,s){for(let i=t,r=0;i<s;i++,r++)n[r]=e[i];return n}u(Mpe,"slice");function Y3(n,e,t){return n.slice(0,e).concat(t).concat(n.slice(e))}u(Y3,"inject");class XO extends Ka{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new ZO(t)}),this.register(function(t){return new ik(t)}),this.register(function(t){return new rk(t)}),this.register(function(t){return new JO(t)}),this.register(function(t){return new ek(t)}),this.register(function(t){return new tk(t)}),this.register(function(t){return new nk(t)}),this.register(function(t){return new KO(t)}),this.register(function(t){return new sk(t)}),this.register(function(t){return new QO(t)}),this.register(function(t){return new YO(t)}),this.register(function(t){return new ok(t)}),this.register(function(t){return new ak(t)})}load(e,t,s,i){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=br.extractUrlBase(e),this.manager.itemStart(e);const a=u(function(c){i?i(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},"_onError"),l=new np(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(h){t(h),r.manager.itemEnd(e)},a)}catch(h){a(h)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let r;const o={},a={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(br.decodeText(new Uint8Array(e,0,4))===lk){try{o[Ct.KHR_BINARY_GLTF]=new ck(e)}catch(h){i&&i(h);return}r=JSON.parse(o[Ct.KHR_BINARY_GLTF].content)}else r=JSON.parse(br.decodeText(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new mk(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const h=this.pluginCallbacks[c](l);a[h.name]=h,o[h.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const h=r.extensionsUsed[c],d=r.extensionsRequired||[];switch(h){case Ct.KHR_MATERIALS_UNLIT:o[h]=new qO;break;case Ct.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[h]=new dk;break;case Ct.KHR_DRACO_MESH_COMPRESSION:o[h]=new uk(r,this.dracoLoader);break;case Ct.KHR_TEXTURE_TRANSFORM:o[h]=new hk;break;case Ct.KHR_MESH_QUANTIZATION:o[h]=new fk;break;default:d.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(s,i)}parseAsync(e,t){const s=this;return new Promise(function(i,r){s.parse(e,t,i,r)})}}u(XO,"GLTFLoader");function Spe(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}u(Spe,"GLTFRegistry");const Ct={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class YO{constructor(e){this.parser=e,this.name=Ct.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){const r=t[s];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let i=t.cache.get(s);if(i)return i;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const h=new De(16777215);l.color!==void 0&&h.fromArray(l.color);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new e1(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ka(h),c.distance=d;break;case"spot":c=new J0(h),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),t.cache.add(s,i),i}createNodeAttachment(e){const t=this,s=this.parser,r=s.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return s._getNodeRef(t.cache,a,l)})}}u(YO,"GLTFLightsExtension");class qO{constructor(){this.name=Ct.KHR_MATERIALS_UNLIT}getMaterialType(){return Fs}extendParams(e,t,s){const i=[];e.color=new De(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&i.push(s.assignTexture(e,"map",r.baseColorTexture,Bt))}return Promise.all(i)}}u(qO,"GLTFMaterialsUnlitExtension$1");class KO{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}u(KO,"GLTFMaterialsEmissiveStrengthExtension");class ZO{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:qa}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(s.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(s.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(s.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new $e(a,a)}return Promise.all(r)}}u(ZO,"GLTFMaterialsClearcoatExtension$1");class QO{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:qa}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(s.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(s.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}u(QO,"GLTFMaterialsIridescenceExtension$1");class JO{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:qa}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new De(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=i.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(s.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Bt)),o.sheenRoughnessTexture!==void 0&&r.push(s.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}u(JO,"GLTFMaterialsSheenExtension");class ek{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:qa}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(s.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}u(ek,"GLTFMaterialsTransmissionExtension$1");class tk{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:qa}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(s.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new De(a[0],a[1],a[2]),Promise.all(r)}}u(tk,"GLTFMaterialsVolumeExtension$1");class nk{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:qa}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=i.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}u(nk,"GLTFMaterialsIorExtension");class sk{constructor(e){this.parser=e,this.name=Ct.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:qa}extendMaterialParams(e,t){const s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],o=i.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(s.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new De(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&r.push(s.assignTexture(t,"specularColorMap",o.specularColorTexture,Bt)),Promise.all(r)}}u(sk,"GLTFMaterialsSpecularExtension");class ik{constructor(e){this.parser=e,this.name=Ct.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}u(ik,"GLTFTextureBasisUExtension");class rk{constructor(e){this.parser=e,this.name=Ct.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,i=s.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=i.images[o.source];let l=s.textureLoader;if(a.uri){const c=s.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return s.loadTextureImage(e,o.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}u(rk,"GLTFTextureWebPExtension");class ok{constructor(e){this.name=Ct.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const i=s.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=i.byteOffset||0,c=i.byteLength||0,h=i.count,d=i.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,d,f,i.mode,i.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(h*d);return o.decodeGltfBuffer(new Uint8Array(p),h,d,f,i.mode,i.filter),p})})}else return null}}u(ok,"GLTFMeshoptCompression");class ak{constructor(e){this.name=Ct.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const i=t.meshes[s.mesh];for(const c of i.primitives)if(c.mode!==Wi.TRIANGLES&&c.mode!==Wi.TRIANGLE_STRIP&&c.mode!==Wi.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=s.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const h=c.pop(),d=h.isGroup?h.children:[h],f=c[0].count,p=[];for(const g of d){const m=new be,v=new P,y=new qe,b=new P(1,1,1),_=new sR(g.geometry,g.material,f);for(let w=0;w<f;w++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,w),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,w),l.SCALE&&b.fromBufferAttribute(l.SCALE,w),_.setMatrixAt(w,m.compose(v,y,b));for(const w in l)w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&g.geometry.setAttribute(w,l[w]);Lt.prototype.copy.call(_,g),_.frustumCulled=!1,this.parser.assignFinalMaterial(_),p.push(_)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}u(ak,"GLTFMeshGpuInstancing");const lk="glTF",hd=12,q3={JSON:1313821514,BIN:5130562};class ck{constructor(e){this.name=Ct.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,hd);if(this.header={magic:br.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==lk)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-hd,i=new DataView(e,hd);let r=0;for(;r<s;){const o=i.getUint32(r,!0);r+=4;const a=i.getUint32(r,!0);if(r+=4,a===q3.JSON){const l=new Uint8Array(e,hd+r,o);this.content=br.decodeText(l)}else if(a===q3.BIN){const l=hd+r;this.body=e.slice(l,l+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}u(ck,"GLTFBinaryExtension");class uk{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ct.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const d=ab[h]||h.toLowerCase();a[d]=o[h]}for(const h in e.attributes){const d=ab[h]||h.toLowerCase();if(o[h]!==void 0){const f=s.accessors[e.attributes[h]],p=Zf[f.componentType];c[d]=p.name,l[d]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(h){return new Promise(function(d){i.decodeDracoFile(h,function(f){for(const p in f.attributes){const g=f.attributes[p],m=l[p];m!==void 0&&(g.normalized=m)}d(f)},a,c)})})}}u(uk,"GLTFDracoMeshCompressionExtension");class hk{constructor(){this.name=Ct.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}u(hk,"GLTFTextureTransformExtension");class g0 extends nr{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new De().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(l){for(const c in a)l.uniforms[c]=a[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(l){a.specular.value=l}},specularMap:{get:function(){return a.specularMap.value},set:function(l){a.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(l){a.glossiness.value=l}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(l){a.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}u(g0,"GLTFMeshStandardSGMaterial");class dk{constructor(){this.name=Ct.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return g0}extendParams(e,t,s){const i=t.extensions[this.name];e.color=new De(1,1,1),e.opacity=1;const r=[];if(Array.isArray(i.diffuseFactor)){const o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(i.diffuseTexture!==void 0&&r.push(s.assignTexture(e,"map",i.diffuseTexture,Bt)),e.emissive=new De(0,0,0),e.glossiness=i.glossinessFactor!==void 0?i.glossinessFactor:1,e.specular=new De(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),i.specularGlossinessTexture!==void 0){const o=i.specularGlossinessTexture;r.push(s.assignTexture(e,"glossinessMap",o)),r.push(s.assignTexture(e,"specularMap",o,Bt))}return Promise.all(r)}createMaterial(e){const t=new g0(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=mh,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}u(dk,"GLTFMaterialsPbrSpecularGlossinessExtension");class fk{constructor(){this.name=Ct.KHR_MESH_QUANTIZATION}}u(fk,"GLTFMeshQuantizationExtension");class Ax extends vh{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let o=0;o!==i;o++)t[o]=s[r+o];return t}interpolate_(e,t,s,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=i-t,d=(s-t)/h,f=d*d,p=f*d,g=e*c,m=g-c,v=-2*p+3*f,y=p-f,b=1-v,_=y-f+d;for(let w=0;w!==a;w++){const x=o[m+w+a],S=o[m+w+l]*h,C=o[g+w+a],M=o[g+w]*h;r[w]=b*x+_*S+v*C+y*M}return r}}u(Ax,"GLTFCubicSplineInterpolant");const Cpe=new qe;class pk extends Ax{interpolate_(e,t,s,i){const r=super.interpolate_(e,t,s,i);return Cpe.fromArray(r).normalize().toArray(r),r}}u(pk,"GLTFCubicSplineQuaternionInterpolant");const Wi={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Zf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},K3={9728:Wn,9729:qs,9984:t0,9985:Db,9986:n0,9987:fc},Z3={33071:Ks,33648:Tf,10497:zo},Q3={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ab={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},va={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Epe={CUBICSPLINE:void 0,LINEAR:Zl,STEP:zu},Py={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Tpe(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new nr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ql})),n.DefaultMaterial}u(Tpe,"createDefaultMaterial");function dd(n,e,t){for(const s in t.extensions)n[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}u(dd,"addUnknownExtensionsToUserData");function Il(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}u(Il,"assignExtrasToUserData");function Ppe(n,e,t){let s=!1,i=!1,r=!1;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(d.POSITION!==void 0&&(s=!0),d.NORMAL!==void 0&&(i=!0),d.COLOR_0!==void 0&&(r=!0),s&&i&&r)break}if(!s&&!i&&!r)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,h=e.length;c<h;c++){const d=e[c];if(s){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):n.attributes.position;o.push(f)}if(i){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):n.attributes.normal;a.push(f)}if(r){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):n.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],f=c[2];return s&&(n.morphAttributes.position=h),i&&(n.morphAttributes.normal=d),r&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}u(Ppe,"addMorphTargets");function Rpe(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let s=0,i=t.length;s<i;s++)n.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}u(Rpe,"updateMorphTargets");function Ipe(n){const e=n.extensions&&n.extensions[Ct.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+J3(e.attributes):t=n.indices+":"+J3(n.attributes)+":"+n.mode,t}u(Ipe,"createPrimitiveKey");function J3(n){let e="";const t=Object.keys(n).sort();for(let s=0,i=t.length;s<i;s++)e+=t[s]+":"+n[t[s]]+";";return e}u(J3,"createAttributesKey");function lb(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}u(lb,"getNormalizedComponentScale");function Dpe(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}u(Dpe,"getImageURIMimeType");class mk{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Spe,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,r=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||s||i&&r<98?this.textureLoader=new sp(this.options.manager):this.textureLoader=new _R(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new np(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(o){const a={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:s,userData:{}};dd(r,a,i),Il(a,i),Promise.all(s._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let i=0,r=t.length;i<r;i++){const o=t[i].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let i=0,r=e.length;i<r;i++){const o=e[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(s[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const i=s.clone(),r=u((o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])},"updateMappings");return r(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const i=e(t[s]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&s.push(r)}return s}getDependency(e,t){const s=e+":"+t;let i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(r,o){return s.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ct.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(r,o){s.load(br.resolveURL(t.uri,i.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const i=t.byteLength||0,r=t.byteOffset||0;return s.slice(r,r+i)})}loadAccessor(e){const t=this,s=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0)return Promise.resolve(null);const r=[];return i.bufferView!==void 0?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),i.sparse!==void 0&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=Q3[i.type],c=Zf[i.componentType],h=c.BYTES_PER_ELEMENT,d=h*l,f=i.byteOffset||0,p=i.bufferView!==void 0?s.bufferViews[i.bufferView].byteStride:void 0,g=i.normalized===!0;let m,v;if(p&&p!==d){const y=Math.floor(f/p),b="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+y+":"+i.count;let _=t.cache.get(b);_||(m=new c(a,y*p,i.count*p/h),_=new tR(m,p/h),t.cache.add(b,_)),v=new X0(_,l,f%p/h,g)}else a===null?m=new c(i.count*l):m=new c(a,f,i.count*l),v=new An(m,l,g);if(i.sparse!==void 0){const y=Q3.SCALAR,b=Zf[i.sparse.indices.componentType],_=i.sparse.indices.byteOffset||0,w=i.sparse.values.byteOffset||0,x=new b(o[1],_,i.sparse.count*y),S=new c(o[2],w,i.sparse.count*l);a!==null&&(v=new An(v.array.slice(),v.itemSize,v.normalized));for(let C=0,M=x.length;C<M;C++){const R=x[C];if(v.setX(R,S[C*l]),l>=2&&v.setY(R,S[C*l+1]),l>=3&&v.setZ(R,S[C*l+2]),l>=4&&v.setW(R,S[C*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,s=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=s.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,s){const i=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,s).then(function(h){h.flipY=!1,h.name=o.name||a.name||"";const f=(r.samplers||{})[o.sampler]||{};return h.magFilter=K3[f.magFilter]||qs,h.minFilter=K3[f.minFilter]||fc,h.wrapS=Z3[f.wrapS]||zo,h.wrapT=Z3[f.wrapT]||zo,i.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const s=this,i=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=i.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=s.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const f=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let g=f;t.isImageBitmapLoader===!0&&(g=u(function(m){const v=new is(m);v.needsUpdate=!0,f(v)},"onLoad")),t.load(br.resolveURL(d,r.path),g,void 0,p)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||Dpe(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=h,h}assignTexture(e,t,s,i){const r=this;return this.getDependency("texture",s.index).then(function(o){if(s.texCoord!==void 0&&s.texCoord!=0&&!(t==="aoMap"&&s.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),r.extensions[Ct.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[Ct.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[Ct.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return i!==void 0&&(o.encoding=i),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const i=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let l=this.cache.get(a);l||(l=new Hr,zs.prototype.copy.call(l,s),l.color.copy(s.color),l.map=s.map,l.sizeAttenuation=!1,this.cache.add(a,l)),s=l}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let l=this.cache.get(a);l||(l=new Bs,zs.prototype.copy.call(l,s),l.color.copy(s.color),this.cache.add(a,l)),s=l}if(i||r||o){let a="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),i&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=s.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),i&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(s))),s=l}s.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return nr}loadMaterial(e){const t=this,s=this.json,i=this.extensions,r=s.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[Ct.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const d=i[Ct.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else if(l[Ct.KHR_MATERIALS_UNLIT]){const d=i[Ct.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new De(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,Bt)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Di);const h=r.alphaMode||Py.OPAQUE;if(h===Py.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Py.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Fs&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new $e(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}return r.occlusionTexture!==void 0&&o!==Fs&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Fs&&(a.emissive=new De().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==Fs&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,Bt)),Promise.all(c).then(function(){let d;return o===g0?d=i[Ct.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):d=new o(a),r.name&&(d.name=r.name),Il(d,r),t.associations.set(d,{materials:e}),r.extensions&&dd(i,d,r),d})}createUniqueName(e){const t=St.sanitizeNodeName(e||"");let s=t;for(let i=1;this.nodeNamesUsed[s];++i)s=t+"_"+i;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,i=this.primitiveCache;function r(a){return s[Ct.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return eE(l,a,t)})}u(r,"createDracoPrimitive");const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],h=Ipe(c),d=i[h];if(d)o.push(d.promise);else{let f;c.extensions&&c.extensions[Ct.KHR_DRACO_MESH_COMPRESSION]?f=r(c):f=eE(new at,c,t),i[h]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,s=this.json,i=this.extensions,r=s.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?Tpe(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],d=[];for(let p=0,g=h.length;p<g;p++){const m=h[p],v=o[p];let y;const b=c[p];if(v.mode===Wi.TRIANGLES||v.mode===Wi.TRIANGLE_STRIP||v.mode===Wi.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new $b(m,b):new Ye(m,b),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),v.mode===Wi.TRIANGLE_STRIP?y.geometry=tE(y.geometry,Dz):v.mode===Wi.TRIANGLE_FAN&&(y.geometry=tE(y.geometry,DP));else if(v.mode===Wi.LINES)y=new Ar(m,b);else if(v.mode===Wi.LINE_STRIP)y=new Zi(m,b);else if(v.mode===Wi.LINE_LOOP)y=new iR(m,b);else if(v.mode===Wi.POINTS)y=new Oa(m,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&Rpe(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),Il(y,r),v.extensions&&dd(i,y,v),t.assignFinalMaterial(y),d.push(y)}for(let p=0,g=d.length;p<g;p++)t.associations.set(d[p],{meshes:e,primitives:p});if(d.length===1)return d[0];const f=new ls;t.associations.set(f,{meshes:e});for(let p=0,g=d.length;p<g;p++)f.add(d[p]);return f})}loadCamera(e){let t;const s=this.json.cameras[e],i=s[s.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new _s(Xi.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):s.type==="orthographic"&&(t=new Ya(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),Il(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(i){return s.inverseBindMatrices=i,s})}loadAnimation(e){const s=this.json.animations[e],i=[],r=[],o=[],a=[],l=[];for(let c=0,h=s.channels.length;c<h;c++){const d=s.channels[c],f=s.samplers[d.sampler],p=d.target,g=p.node,m=s.parameters!==void 0?s.parameters[f.input]:f.input,v=s.parameters!==void 0?s.parameters[f.output]:f.output;i.push(this.getDependency("node",g)),r.push(this.getDependency("accessor",m)),o.push(this.getDependency("accessor",v)),a.push(f),l.push(p)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],d=c[1],f=c[2],p=c[3],g=c[4],m=[];for(let y=0,b=h.length;y<b;y++){const _=h[y],w=d[y],x=f[y],S=p[y],C=g[y];if(_===void 0)continue;_.updateMatrix();let M;switch(va[C.path]){case va.weights:M=Ql;break;case va.rotation:M=Uo;break;case va.position:case va.scale:default:M=Jl;break}const R=_.name?_.name:_.uuid,D=S.interpolation!==void 0?Epe[S.interpolation]:Zl,k=[];va[C.path]===va.weights?_.traverse(function(N){N.morphTargetInfluences&&k.push(N.name?N.name:N.uuid)}):k.push(R);let T=x.array;if(x.normalized){const N=lb(T.constructor),E=new Float32Array(T.length);for(let z=0,H=T.length;z<H;z++)E[z]=T[z]*N;T=E}for(let N=0,E=k.length;N<E;N++){const z=new M(k[N]+"."+va[C.path],w.array,T,D);S.interpolation==="CUBICSPLINE"&&(z.createInterpolant=u(function(q){const ne=this instanceof Uo?pk:Ax;return new ne(this.times,this.values,this.getValueSize()/3,q)},"InterpolantFactoryMethodGLTFCubicSpline"),z.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(z)}}const v=s.name?s.name:"animation_"+e;return new Wb(v,void 0,m)})}createNodeMesh(e){const t=this.json,s=this,i=t.nodes[e];return i.mesh===void 0?null:s.getDependency("mesh",i.mesh).then(function(r){const o=s._getNodeRef(s.meshCache,i.mesh,r);return i.weights!==void 0&&o.traverse(function(a){if(!!a.isMesh)for(let l=0,c=i.weights.length;l<c;l++)a.morphTargetInfluences[l]=i.weights[l]}),o})}loadNode(e){const t=this.json,s=this.extensions,i=this,r=t.nodes[e],o=r.name?i.createUniqueName(r.name):"";return function(){const a=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(i.getDependency("camera",r.camera).then(function(c){return i._getNodeRef(i.cameraCache,r.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let l;if(r.isBone===!0?l=new Df:a.length>1?l=new ls:a.length===1?l=a[0]:l=new Lt,l!==a[0])for(let c=0,h=a.length;c<h;c++)l.add(a[c]);if(r.name&&(l.userData.name=r.name,l.name=o),Il(l,r),r.extensions&&dd(s,l,r),r.matrix!==void 0){const c=new be;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return i.associations.has(l)||i.associations.set(l,{}),i.associations.get(l).nodes=e,l})}loadScene(e){const t=this.json,s=this.extensions,i=this.json.scenes[e],r=this,o=new ls;i.name&&(o.name=r.createUniqueName(i.name)),Il(o,i),i.extensions&&dd(s,o,i);const a=i.nodes||[],l=[];for(let c=0,h=a.length;c<h;c++)l.push(gk(a[c],o,t,r));return Promise.all(l).then(function(){const c=u(h=>{const d=new Map;for(const[f,p]of r.associations)(f instanceof zs||f instanceof is)&&d.set(f,p);return h.traverse(f=>{const p=r.associations.get(f);p!=null&&d.set(f,p)}),d},"reduceAssociations");return r.associations=c(o),o})}}u(mk,"GLTFParser");function gk(n,e,t,s){const i=t.nodes[n];return s.getDependency("node",n).then(function(r){if(i.skin===void 0)return r;let o;return s.getDependency("skin",i.skin).then(function(a){o=a;const l=[];for(let c=0,h=o.joints.length;c<h;c++)l.push(s.getDependency("node",o.joints[c]));return Promise.all(l)}).then(function(a){return r.traverse(function(l){if(!l.isMesh)return;const c=[],h=[];for(let d=0,f=a.length;d<f;d++){const p=a[d];if(p){c.push(p);const g=new be;o.inverseBindMatrices!==void 0&&g.fromArray(o.inverseBindMatrices.array,d*16),h.push(g)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[d])}l.bind(new tp(c,h),l.matrixWorld)}),r})}).then(function(r){e.add(r);const o=[];if(i.children){const a=i.children;for(let l=0,c=a.length;l<c;l++){const h=a[l];o.push(gk(h,r,t,s))}}return Promise.all(o)})}u(gk,"buildNodeHierarchy");function Lpe(n,e,t){const s=e.attributes,i=new ss;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(i.set(new P(l[0],l[1],l[2]),new P(c[0],c[1],c[2])),a.normalized){const h=lb(Zf[a.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new P,l=new P;for(let c=0,h=r.length;c<h;c++){const d=r[c];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],p=f.min,g=f.max;if(p!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),f.normalized){const m=lb(Zf[f.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}n.boundingBox=i;const o=new ja;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=o}u(Lpe,"computeBounds");function eE(n,e,t){const s=e.attributes,i=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}u(r,"assignAttributeAccessor");for(const o in s){const a=ab[o]||o.toLowerCase();a in n.attributes||i.push(r(s[o],a))}if(e.indices!==void 0&&!n.index){const o=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});i.push(o)}return Il(n,e),Lpe(n,e,t),Promise.all(i).then(function(){return e.targets!==void 0?Ppe(n,e.targets,t):n})}u(eE,"addPrimitiveAttributes");function tE(n,e){let t=n.getIndex();if(t===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),t=n.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const s=t.count-2,i=[];if(e===DP)for(let o=1;o<=s;o++)i.push(t.getX(0)),i.push(t.getX(o)),i.push(t.getX(o+1));else for(let o=0;o<s;o++)o%2===0?(i.push(t.getX(o)),i.push(t.getX(o+1)),i.push(t.getX(o+2))):(i.push(t.getX(o+2)),i.push(t.getX(o+1)),i.push(t.getX(o)));i.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(i),r}u(tE,"toTrianglesDrawMode");const Ope=/^[og]\s*(.+)?/,kpe=/^mtllib /,Npe=/^usemtl /,Fpe=/^usemap /,nE=/\s+/,sE=new P,Ry=new P,iE=new P,rE=new P,Vi=new P,zm=new De;function zpe(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:i||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),i&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},s&&s.name&&typeof s.clone=="function"){const i=s.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/3)*3},parseNormalIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/3)*3},parseUVIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/2)*2},addVertex:function(e,t,s){const i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[s+0],i[s+1],i[s+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,s){const i=this.normals,r=this.object.geometry.normals;r.push(i[e+0],i[e+1],i[e+2]),r.push(i[t+0],i[t+1],i[t+2]),r.push(i[s+0],i[s+1],i[s+2])},addFaceNormal:function(e,t,s){const i=this.vertices,r=this.object.geometry.normals;sE.fromArray(i,e),Ry.fromArray(i,t),iE.fromArray(i,s),Vi.subVectors(iE,Ry),rE.subVectors(sE,Ry),Vi.cross(rE),Vi.normalize(),r.push(Vi.x,Vi.y,Vi.z),r.push(Vi.x,Vi.y,Vi.z),r.push(Vi.x,Vi.y,Vi.z)},addColor:function(e,t,s){const i=this.colors,r=this.object.geometry.colors;i[e]!==void 0&&r.push(i[e+0],i[e+1],i[e+2]),i[t]!==void 0&&r.push(i[t+0],i[t+1],i[t+2]),i[s]!==void 0&&r.push(i[s+0],i[s+1],i[s+2])},addUV:function(e,t,s){const i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0],i[e+1]),r.push(i[t+0],i[t+1]),r.push(i[s+0],i[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,s,i,r,o,a,l,c){const h=this.vertices.length;let d=this.parseVertexIndex(e,h),f=this.parseVertexIndex(t,h),p=this.parseVertexIndex(s,h);if(this.addVertex(d,f,p),this.addColor(d,f,p),a!==void 0&&a!==""){const g=this.normals.length;d=this.parseNormalIndex(a,g),f=this.parseNormalIndex(l,g),p=this.parseNormalIndex(c,g),this.addNormal(d,f,p)}else this.addFaceNormal(d,f,p);if(i!==void 0&&i!==""){const g=this.uvs.length;d=this.parseUVIndex(i,g),f=this.parseUVIndex(r,g),p=this.parseUVIndex(o,g),this.addUV(d,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let s=0,i=e.length;s<i;s++){const r=this.parseVertexIndex(e[s],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const s=this.vertices.length,i=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],s));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],i))}};return n.startObject("",!1),n}u(zpe,"ParserState");class vk extends Ka{constructor(e){super(e),this.materials=null}load(e,t,s,i){const r=this,o=new np(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(a))}catch(l){i?i(l):console.error(l),r.manager.itemError(e)}},s,i)}setMaterials(e){return this.materials=e,this}parse(e){const t=new zpe;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let i=[];for(let a=0,l=s.length;a<l;a++){const c=s[a].trimStart();if(c.length===0)continue;const h=c.charAt(0);if(h!=="#")if(h==="v"){const d=c.split(nE);switch(d[0]){case"v":t.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7?(zm.setRGB(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6])).convertSRGBToLinear(),t.colors.push(zm.r,zm.g,zm.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":t.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(h==="f"){const f=c.slice(1).trim().split(nE),p=[];for(let m=0,v=f.length;m<v;m++){const y=f[m];if(y.length>0){const b=y.split("/");p.push(b)}}const g=p[0];for(let m=1,v=p.length-1;m<v;m++){const y=p[m],b=p[m+1];t.addFace(g[0],y[0],b[0],g[1],y[1],b[1],g[2],y[2],b[2])}}else if(h==="l"){const d=c.substring(1).trim().split(" ");let f=[];const p=[];if(c.indexOf("/")===-1)f=d;else for(let g=0,m=d.length;g<m;g++){const v=d[g].split("/");v[0]!==""&&f.push(v[0]),v[1]!==""&&p.push(v[1])}t.addLineGeometry(f,p)}else if(h==="p"){const f=c.slice(1).trim().split(" ");t.addPointGeometry(f)}else if((i=Ope.exec(c))!==null){const d=(" "+i[0].slice(1).trim()).slice(1);t.startObject(d)}else if(Npe.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(kpe.test(c))t.materialLibraries.push(c.substring(7).trim());else if(Fpe.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(i=c.split(" "),i.length>1){const f=i[1].trim().toLowerCase();t.object.smooth=f!=="0"&&f!=="off"}else t.object.smooth=!0;const d=t.object.currentMaterial();d&&(d.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();const r=new ls;if(r.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=t.objects.length;a<l;a++){const c=t.objects[a],h=c.geometry,d=c.materials,f=h.type==="Line",p=h.type==="Points";let g=!1;if(h.vertices.length===0)continue;const m=new at;m.setAttribute("position",new We(h.vertices,3)),h.normals.length>0&&m.setAttribute("normal",new We(h.normals,3)),h.colors.length>0&&(g=!0,m.setAttribute("color",new We(h.colors,3))),h.hasUVIndices===!0&&m.setAttribute("uv",new We(h.uvs,2));const v=[];for(let b=0,_=d.length;b<_;b++){const w=d[b],x=w.name+"_"+w.smooth+"_"+g;let S=t.materials[x];if(this.materials!==null){if(S=this.materials.create(w.name),f&&S&&!(S instanceof Bs)){const C=new Bs;zs.prototype.copy.call(C,S),C.color.copy(S.color),S=C}else if(p&&S&&!(S instanceof Hr)){const C=new Hr({size:10,sizeAttenuation:!1});zs.prototype.copy.call(C,S),C.color.copy(S.color),C.map=S.map,S=C}}S===void 0&&(f?S=new Bs:p?S=new Hr({size:1,sizeAttenuation:!1}):S=new ff,S.name=w.name,S.flatShading=!w.smooth,S.vertexColors=g,t.materials[x]=S),v.push(S)}let y;if(v.length>1){for(let b=0,_=d.length;b<_;b++){const w=d[b];m.addGroup(w.groupStart,w.groupCount,b)}f?y=new Ar(m,v):p?y=new Oa(m,v):y=new Ye(m,v)}else f?y=new Ar(m,v[0]):p?y=new Oa(m,v[0]):y=new Ye(m,v[0]);y.name=c.name,r.add(y)}else if(t.vertices.length>0){const a=new Hr({size:1,sizeAttenuation:!1}),l=new at;l.setAttribute("position",new We(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new We(t.colors,3)),a.vertexColors=!0);const c=new Oa(l,a);r.add(c)}return r}}u(vk,"OBJLoader");var Bpe=Object.defineProperty,Upe=u((n,e)=>Bpe(n,"name",{value:e,configurable:!0}),"__name$1i");class Mx{update(e,t){if(!t.instanceId){if(t.has(Vo)){const s=t.get(Vo);if(!s.dirty||(s.dirty=!1,!s.value))return;const i=t.get(Pe);i.dispose(),i.value=new vk().parse(s.value),i.value.userData={node:t};for(let r of i.value.children)r.userData={node:t};i.parentChanged=!0,i.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)}else if(t.has($o)){const s=t.get($o);if(!s.dirty||(s.dirty=!1,!s.value))return;const i=t.get(Pe);i.dispose(),iw(s.value).then(function(r){if(t.deleted)return;i.value=new zO().parse(r,void 0);const o=[i.value];for(;o.length;){const a=o.pop();if(!a)break;a.userData={node:t},o.push(...a.children)}i.parentChanged=!0,i.localTransformChanged=!0,t.dirty=!0,e.model.dirty=!0,e.model.instanceMeshUpdated(t.id,!0)})}else if(t.has(Go)){const s=t.get(Go);if(!s.dirty||(s.dirty=!1,!s.value.length))return;const i=t.get(Pe);i.dispose(),console.info("Loading gltf zip"),Wfe.loadAsync(s.value).then(async function(r){if(t.deleted)return;const o=Object.values(r.files).filter(f=>!f.dir),a=o.find(f=>f.name.toLocaleLowerCase().endsWith(".gltf"));if(!a){console.error("Failed to find entry file");return}const l={};for(let f of o){console.info(`Loading ${f.name}`);const p=await f.async("blob");if(t.deleted)return;l[f.name]=URL.createObjectURL(p)}const c=new jb;c.setURLModifier(f=>{const p=new URL(f),g=p.pathname.replace(p.origin+"/","");return l[g]||f});const h=new XO(c),d=l[a.name];h.load(d,f=>{if(t.deleted)return;i.value=f.scene;const p=[f.scene];for(;p.length;){const g=p.pop();if(!g)break;g.userData={node:t},p.push(...g.children)}i.parentChanged=!0,i.localTransformChanged=!0,t.dirty=!0,e.model.dirty=!0,e.model.instanceMeshUpdated(t.id,!0)})})}}}}u(Mx,"ImportModelUpdateFilter");Upe(Mx,"ImportModelUpdateFilter");var $pe=Object.defineProperty,Vpe=u((n,e)=>$pe(n,"name",{value:e,configurable:!0}),"__name$1h");class Sx{update(e,t){if(t.instanceId){const s=e.model.getNode(t.instanceId);for(let i in t.components)ti(i).autoCopy&&(t.components[i].value=s.components[i].value)}}}u(Sx,"InstanceNodeUpdateFilter");Vpe(Sx,"InstanceNodeUpdateFilter");var Gpe=Object.defineProperty,Hpe=u((n,e)=>Gpe(n,"name",{value:e,configurable:!0}),"__name$1g");class Cx{update(e,t){if(t.has(ei)){const s=t.get(ei),i=s.value;i&&i.update();const r=s.camera;r&&r.update()}}}u(Cx,"LightHelperUpdateFilter");Hpe(Cx,"LightHelperUpdateFilter");var Wpe=Object.defineProperty,jpe=u((n,e)=>Wpe(n,"name",{value:e,configurable:!0}),"__name$1f");class Ex{update(e,t){var s,i,r,o;switch(t.type){case"AmbientLight":{const a=t.get(Pe);a.value||(a.value=new t1);const l=a.value,c=t.value(Vt);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(Ys)}break;case"HemisphereLight":{const a=t.get(Pe);a.value||(a.value=new mR);const l=a.value,c=t.value(Uf);l.color.setRGB(c[0],c[1],c[2]);const h=t.value(Nf);l.groundColor.setRGB(h[0],h[1],h[2]),l.intensity=t.value(Ys);const d=t.get(ei);d.value||(d.value=new SR(l,.25),e.scene.add(d.value))}break;case"DirectionalLight":{const a=t.get(Pe);a.value||(a.value=new e1);const l=a.value;l.castShadow=t.value(Gn);const c=t.value(Vt);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(Ys);const h=Number.parseInt(t.value(No));l.shadow.mapSize.x!==h&&(l.shadow.mapSize.set(h,h),(s=l.shadow.map)==null||s.setSize(h,h),(i=l.shadow.mapPass)==null||i.setSize(h,h),l.shadow.dispose());const d=t.value(Bf)/2;l.shadow.camera.top=+d,l.shadow.camera.right=+d,l.shadow.camera.bottom=-d,l.shadow.camera.left=-d,l.shadow.camera.near=0,l.shadow.camera.updateProjectionMatrix();const f=t.get(ei);f.value||(f.value=new CR(l),e.scene.add(f.value)),f.camera||(f.camera=new ER(l.shadow.camera),e.scene.add(f.camera));const g=t.children[0].get(Pe);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break;case"PointLight":{const a=t.get(Pe);let l=a.value;const c=Number.parseInt(t.value(No));l&&l.shadow.mapSize.x!==c&&(l.dispose(),l.removeFromParent(),a.value=null,a.localTransformChanged=!0,a.worldTransformChanged=!0,a.parentChanged=!0),a.value||(l=a.value=new ka,l.shadow.mapSize.set(c,c)),l.castShadow=t.value(Gn);const h=t.value(Vt);l.color.setRGB(h[0],h[1],h[2]),l.intensity=t.value(Ys);const d=.005;l.shadow.camera.near!==d&&(l.shadow.camera.near=d,l.shadow.camera.updateProjectionMatrix());const f=t.get(ei);let p=f.value;p&&p.light!==l&&(p.dispose(),p.removeFromParent(),f.value=null),f.value||(f.value=new MR(l,.25),e.scene.add(f.value))}break;case"SpotLight":{const a=t.get(Pe);a.value||(a.value=new J0);const l=a.value;l.castShadow=t.value(Gn);const c=t.value(Vt);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(Ys),l.angle=t.value($f)/180*Math.PI,l.penumbra=t.value(zf);const h=Number.parseInt(t.value(No));l.shadow.mapSize.x!==h&&(l.shadow.mapSize.set(h,h),(r=l.shadow.map)==null||r.setSize(h,h),(o=l.shadow.mapPass)==null||o.setSize(h,h),l.shadow.dispose());const d=.005;l.shadow.camera.near!==d&&(l.shadow.camera.near=d,l.shadow.camera.updateProjectionMatrix());const f=t.get(ei);f.value||(f.value=new AR(l),e.scene.add(f.value));const g=t.children[0].get(Pe);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break}}}u(Ex,"LightUpdateFilter");jpe(Ex,"LightUpdateFilter");var Xpe=Object.defineProperty,Ype=u((n,e)=>Xpe(n,"name",{value:e,configurable:!0}),"__name$1e");class Tx{update(e,t){var s;if(!t.instanceId&&t.has(Pe)){const i=t.value(Pe);if(!i)return;if(t.has(Qi)){const r=t.value(Qi);t.get(Pe).usePlainMaterial=r;const o=[i];for(;o.length;){const a=o.pop();if(!a)break;const l=a;l.isMesh&&(r?(l.__plainMaterial||(l.__originalMaterial=l.material,l.__plainMaterial=new nr),l.material=l.__plainMaterial,this.updateMaterial(t,l.__plainMaterial)):l.__originalMaterial&&(l.material=l.__originalMaterial)),o.push(...a.children)}}else{const r=[i];for(;r.length;){const o=r.pop();if(!o)break;if(((s=o.userData.node)==null?void 0:s.id)!==t.id)continue;const a=o;if(a.isMesh){const l=a.material;l.isMeshStandardMaterial&&this.updateMaterial(t,l)}else r.push(...o.children)}if(!i.isMesh)return}}}updateMaterial(e,t){if(e.has(Vt)){const s=e.value(Vt);t.color.setRGB(s[0],s[1],s[2])}if(e.has(Rn)){const s=e.value(Rn);t.emissive.setRGB(s[0],s[1],s[2])}e.has(Dn)&&(t.roughness=e.value(Dn)),e.has(In)&&(t.metalness=e.value(In))}}u(Tx,"MaterialUpdateFilter");Ype(Tx,"MaterialUpdateFilter");class yp extends Ye{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new _s;const s=this,i=t.color!==void 0?new De(t.color):new De(8355711),r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,l=t.shader||yp.ReflectorShader,c=t.multisample!==void 0?t.multisample:4,h=new Po,d=new P,f=new P,p=new P,g=new be,m=new P(0,0,-1),v=new Ft,y=new P,b=new P,_=new Ft,w=new be,x=this.camera,S=new ys(r,o,{samples:c,type:Nu}),C=new bs({uniforms:H0.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});C.uniforms.tDiffuse.value=S.texture,C.uniforms.color.value=i,C.uniforms.textureMatrix.value=w,this.material=C,this.onBeforeRender=function(M,R,D){if(f.setFromMatrixPosition(s.matrixWorld),p.setFromMatrixPosition(D.matrixWorld),g.extractRotation(s.matrixWorld),d.set(0,0,1),d.applyMatrix4(g),y.subVectors(f,p),y.dot(d)>0)return;y.reflect(d).negate(),y.add(f),g.extractRotation(D.matrixWorld),m.set(0,0,-1),m.applyMatrix4(g),m.add(p),b.subVectors(f,m),b.reflect(d).negate(),b.add(f),x.position.copy(y),x.up.set(0,1,0),x.up.applyMatrix4(g),x.up.reflect(d),x.lookAt(b),x.far=D.far,x.updateMatrixWorld(),x.projectionMatrix.copy(D.projectionMatrix),w.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),w.multiply(x.projectionMatrix),w.multiply(x.matrixWorldInverse),w.multiply(s.matrixWorld),h.setFromNormalAndCoplanarPoint(d,f),h.applyMatrix4(x.matrixWorldInverse),v.set(h.normal.x,h.normal.y,h.normal.z,h.constant);const k=x.projectionMatrix;_.x=(Math.sign(v.x)+k.elements[8])/k.elements[0],_.y=(Math.sign(v.y)+k.elements[9])/k.elements[5],_.z=-1,_.w=(1+k.elements[10])/k.elements[14],v.multiplyScalar(2/v.dot(_)),k.elements[2]=v.x,k.elements[6]=v.y,k.elements[10]=v.z+1-a,k.elements[14]=v.w,s.visible=!1;const T=M.getRenderTarget(),N=M.xr.enabled,E=M.shadowMap.autoUpdate,z=M.outputEncoding,H=M.toneMapping;M.xr.enabled=!1,M.shadowMap.autoUpdate=!1,M.outputEncoding=Bo,M.toneMapping=Xr,M.setRenderTarget(S),M.state.buffers.depth.setMask(!0),M.autoClear===!1&&M.clear(),M.render(R,x),M.xr.enabled=N,M.shadowMap.autoUpdate=E,M.outputEncoding=z,M.toneMapping=H,M.setRenderTarget(T);const q=D.viewport;q!==void 0&&M.state.viewport(q),s.visible=!0},this.getRenderTarget=function(){return S},this.dispose=function(){S.dispose(),s.material.dispose()}}}u(yp,"Reflector");yp.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <encodings_fragment>

		}`};var qpe=Object.defineProperty,Kpe=u((n,e)=>qpe(n,"name",{value:e,configurable:!0}),"__name$1d");class Px{update(e,t){if(t.type!=="Mirror")return;const s=t.value(Gf),i=t.value(fn),r=t.get(Pe);if(!r.value){const d=t.value(Vt);r.value=new yp(new Uu(s,i),{color:new De().setRGB(d[0],d[1],d[2])}),r.value.userData.node=t;return}const o=r.value,a=o.geometry;(a.parameters.width!==s||a.parameters.height!==i)&&(a.dispose(),r.value.geometry=new Uu(s,i));const l=o.material.uniforms.color.value,c=t.value(Vt);l.setRGB(c[0],c[1],c[2]);const h=Number.parseInt(t.value(Vf));o.getRenderTarget().setSize(h,h)}}u(Px,"MirrorUpdateFilter");Kpe(Px,"MirrorUpdateFilter");var Zpe=Object.defineProperty,Qpe=u((n,e)=>Zpe(n,"name",{value:e,configurable:!0}),"__name$1c");class Rx{update(e,t){var s;if(t.has(Pe)){const i=t.get(Pe);if(i.parentChanged){const o=i.value;if(o){o.removeFromParent();const a=rt(t.parent);if(a){if(a.has(Pe)){const l=a.value(Pe);l&&l.add(o)}}else e.scene.add(o)}i.parentChanged=!1}let r=t.has(gt)?t.value(gt):!0;t.has(je)&&((s=t.parent)==null?void 0:s.has(je))&&(r=!1),i.value&&(i.value.visible=r)}}}u(Rx,"Object3DRelationshipUpdateFilter");Qpe(Rx,"Object3DRelationshipUpdateFilter");var Jpe=Object.defineProperty,yk=u((n,e)=>Jpe(n,"name",{value:e,configurable:!0}),"__name$1b");function Ix(n,e){const t=n;if(t.isMesh)if(Array.isArray(t.material))for(let s of t.material)s.opacity!==e&&(s.opacity=e,s.transparent=s.opacity<1,s.needsUpdate=!0);else t.material.opacity!==e&&(t.material.opacity=e,t.material.transparent=t.material.opacity<1,t.material.needsUpdate=!0);for(let s of n.children)Ix(s,e)}u(Ix,"setOpacity");yk(Ix,"setOpacity");class Dx{update(e,t){if(t.instanceId)return;if(t.opacity=(t.parent?t.parent.opacity:1)*(t.has(an)?t.value(an):1),kn(t.type).mesh){const i=t.get(Pe);i.value&&Ix(i.value,t.opacity)}}}u(Dx,"OpacityUpdateFilter");yk(Dx,"OpacityUpdateFilter");var eme=Object.defineProperty,tme=u((n,e)=>eme(n,"name",{value:e,configurable:!0}),"__name$1a");class Lx{update(e,t){if(t.has(Li)){const s=t.get(Li);s.dirty&&(s.dirty=!1,s.keypoints={},s.value&&t.forEach(i=>{if(i.type==="OpenPoseKeypoint"){const r=i.value(wr);r&&(s.keypoints[r]=i)}}))}else if(t.has(wr)){const s=t.get(Pe);s.value||(s.value=new Lt,s.parentChanged=!0,s.worldTransformChanged=!0)}}}u(Lx,"OpenPoseUpdateFilter");tme(Lx,"OpenPoseUpdateFilter");var nme=Object.defineProperty,sme=u((n,e)=>nme(n,"name",{value:e,configurable:!0}),"__name$19");class Ox{update(e,t){if(t.instanceId||t.type!=="Shape"||!t.value(Pi))return;const s=t.get(Pi);s.value=!1;const i=t.get(Pe);i.value||(i.value=new Ye(new at,new nr),i.value.userData={node:t}),s.throttleHash=`#${t.id}-update-sdf-shape-geometry`,e.throttle(s.throttleHash,25,function(){if(t.deleted)return;s.throttleHash="";const r=new I1;switch(r.smoothRange=t.value(oh),t.value(Us)){case"x":r.symmetryAxis=0;break;case"y":r.symmetryAxis=1;break;case"z":r.symmetryAxis=2;break}for(let h of t.children){const d=h.value(vt),f=h.value(Qu)==="add";if(d.length===1)r.sphere(d[0].position,d[0].radius,f);else for(let p=0;p+1<d.length;++p){const g=d[p],m=d[p+1];r.roundCone(g.position,g.radius,m.position,m.radius,f)}}const{position:o,normal:a}=r.build(),c=i.value.geometry;c.setAttribute("position",new We(o,3)),c.setAttribute("normal",new We(a,3)),c.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)},!1)}}u(Ox,"SdfShapeUpdateFilter");sme(Ox,"SdfShapeUpdateFilter");var ime=Object.defineProperty,rme=u((n,e)=>ime(n,"name",{value:e,configurable:!0}),"__name$18");class kx{update(e,t){if(!t.has(Pe)||!t.has(Gn)&&!t.has(Xs))return;const s=t.value(Pe);if(!s)return;const i=t.has(Gn)?t.value(Gn):null,r=t.has(Xs)?t.value(Xs):null,o=[s];for(;o.length;){const a=o.pop();if(!a)break;i!=null&&(a.castShadow=i),r!=null&&(a.receiveShadow=r),o.push(...a.children)}}}u(kx,"ShadowUpdateFilter");rme(kx,"ShadowUpdateFilter");var ome=Object.defineProperty,ame=u((n,e)=>ome(n,"name",{value:e,configurable:!0}),"__name$17");class Nx{update(e,t){if(t.has(Pe)){const s=t.get(Pe),i=s.value;if(i){if(s.localTransformChanged){if(t.has(ze)&&i.position.copy(t.value(ze)),t.has(nt)&&i.rotation.copy(t.value(nt)),t.has(Wt)&&(i.scale.x=i.scale.y=i.scale.z=t.value(Wt)),t.has(It)&&i.scale.copy(t.value(It)),t.has(Sr)&&i.scale.multiply(t.value(Sr)),t.has(Et)){const r=t.get(Et);i.position.copy(r.start),i.quaternion.copy(r.quaternion)}t.has(je)?i.matrix.copy(t.get(je).matrix):i.updateMatrix(),s.localTransformChanged=!1}s.worldTransformChanged&&(i.updateMatrixWorld(!0),s.worldTransformChanged=!1,t.forEach(r=>{if(r.has(vt)){const o=r.get(vt);o.group&&(o.group.matrixAutoUpdate=!1,o.group.matrix.copy(r.getWorldMatrix()))}}))}}}}u(Nx,"TransformUpdateFilter");ame(Nx,"TransformUpdateFilter");var lme=Object.defineProperty,cme=u((n,e)=>lme(n,"name",{value:e,configurable:!0}),"__name$16");function v0(n=1,e=20){const t=[];let s=0,i=n;const r=Math.PI*2/e,o=Math.cos(r),a=Math.sin(r);for(let l=0;l<e;++l){const c=s*o-i*a,h=s*a+i*o;t.push(new P(s,i,0),new P(c,h,0)),s=c,i=h}return t}u(v0,"xyCirclePoints");cme(v0,"xyCirclePoints");var ume=Object.defineProperty,hme=u((n,e)=>ume(n,"name",{value:e,configurable:!0}),"__name$15");class D1 extends at{constructor(e=1,t=20){super(),this.setFromPoints(v0(e,t)),this.type="CircleEdgeGeometry"}}u(D1,"CircleEdgeGeometry");hme(D1,"CircleEdgeGeometry");var dme=Object.defineProperty,fme=u((n,e)=>dme(n,"name",{value:e,configurable:!0}),"__name$14");const pme=hc.SphereGeometry,mme=new pme(1,20,20),gme=new D1,vme=new at().setFromPoints([new P,new P(1,0,0)]),yme=new P(1,0,0),Iy=new P;class Fx{update(e,t){if(!t.has(vt))return;const s=t.get(vt);if(!s.dirty)return;s.dirty=!1,s.group||(s.group=new ls,s.group.visible=!1,e.scene.add(s.group));const i=s.value;for(;i.length<s.pickers.length;){const o=s.pickers.pop();o==null||o.removeFromParent()}for(;i.length<s.circles.length;){const o=s.circles.pop();o==null||o.removeFromParent()}for(;s.lines.length&&i.length-1<s.lines.length;){const o=s.lines.pop();o==null||o.removeFromParent()}for(;i.length>s.pickers.length;){const o=new Ye(mme);o.visible=!1;const a=s.pickers.push(o);o.userData={index:a-1},s.group.add(o)}for(;i.length>s.circles.length;){const o=new Zi(gme,vt.normalMaterial);s.circles.push(o),s.group.add(o)}for(;i.length-1>s.lines.length;){const o=new Zi(vme,vt.normalMaterial);s.lines.push(o),s.group.add(o)}for(let o=0,a=i.length;o<a;++o){const l=i[o],c=s.circles[o];c.position.copy(l.position),c.scale.setScalar(l.radius);const h=s.pickers[o];if(h.position.copy(l.position),h.scale.setScalar(l.radius),o<a-1){const d=s.lines[o];d.position.copy(l.position),Iy.subVectors(i[o+1].position,l.position);const f=Iy.length();d.scale.setScalar(f),f>1e-8&&d.quaternion.setFromUnitVectors(yme,Iy.divideScalar(f))}}const r=t.get(Pe);r.value||(r.value=new Lt,r.value.userData={node:t},r.parentChanged=!0,r.localTransformChanged=!0)}}u(Fx,"TubeUpdateFilter");fme(Fx,"TubeUpdateFilter");var _me=Object.defineProperty,bme=u((n,e)=>_me(n,"name",{value:e,configurable:!0}),"__name$13");const Bm=[],Or=new P,Dy=new P,Um=new qe,$m=new be,Ly=new be,Vm=new P;class zx extends zi{constructor(t){super();A(this,"filters");this.filters=t}begin(t){t=t.readonlyRef();const s=rt(this);if(t.model.dirty){t.model.forEach(i=>{i.parent&&!i.parent.visible?i.visible=!1:i.visible=i.has(gt)?i.value(gt):!0,i.dirty&&Bm.push(i)});for(let i of s.filters)for(let r of Bm)i.update(t,r);for(let i of Bm)i.dirty=!1;Bm.length=0,t.model.dirty=!1}t.model.instanceDirty&&(t.model.instanceDirty=!1,t.model.forEach(i=>{if(i.instanceId){if(i.instanceMeshDirty){if(i.instanceMeshDirty=!1,!kn(i.type).mesh)return;let o=i.instanceMeshRebuild;i.instanceMeshRebuild&&(i.instanceMeshRebuild=!1,s.recreateInstanceMesh(t,i)),i.has(Xn)&&t.throttle(`#${i.id}-update-instance-mirror-geometry`,250,()=>{i.deleted||s.updateInstanceMirrorGeometry(t,i)},i.visible&&o)}s.updateInstanceMaterial(t,i)}}),t.model.dirty=!0)}end(t){}recreateInstanceMesh(t,s){if(!s.has(Pe))return;const i=s.get(Pe);if(i.instance=!0,i.dispose(),!t.model.isNodeExists(s.instanceId))return;const r=t.model.getNode(s.instanceId),o=r.value(Pe);if(!o)return;const a=[[o,null]];let l=0;for(;a.length;){const c=a.pop();if(!c)break;const h=c[0],d=c[1];let f;if(h.isMesh){const p=h;f=new Ye(p.geometry,p.material)}else f=new Lt;f.visible=h.visible,f.position.copy(h.position),f.quaternion.copy(h.quaternion),f.scale.copy(h.scale),f.updateMatrix(),f.updateMatrixWorld(!0),f.userData={node:s,origin:h,instanceId:l++},d?d.add(f):i.value=f;for(let p of h.children)a.push([p,f])}s.dirty=!0,i.parentChanged=!0,i.localTransformChanged=!0,i.worldTransformChanged=!0,i.usePlainMaterial=r.get(Pe).usePlainMaterial}updateInstanceMaterial(t,s){if(!s.has(Pe)||!s.has(Qi))return;const i=t.model.getNode(s.instanceId),r=s.get(Pe),o=i.get(Pe);if(r.usePlainMaterial===o.usePlainMaterial||(r.usePlainMaterial=o.usePlainMaterial,!r.value)||!o.value)return;const a=[[r.value,o.value]];for(;a.length;){const l=a.pop();if(!l)break;const c=l[0],h=l[1];if(c.isMesh&&(c.material=h.material),c.children.length===h.children.length)for(let d=0,f=c.children.length;d<f;++d)a.push([c.children[d],h.children[d]])}}updateInstanceMirrorGeometry(t,s){if(!s.has(Xn))return;const i=s.value(Xn),r=s.value(Pe);if(!r)return;const o=t.model.getNode(s.instanceId);if(!o.value(Pe))return;const l=1e-6,c=ex(Math.round(i.x/l)*l,Math.round(i.y/l)*l,Math.round(i.z/l)*l),h=r,d=[h];for(;d.length;){const f=d.shift();if(!f)break;const p=f.userData;if(p.relatedMatOrigin||(p.relatedMatOrigin=new be,p.relatedMatFlipped=new be),f!==h){const g=f.parent.userData;$m.copy(g.relatedMatOrigin),Ly.copy(g.relatedMatFlipped).invert();const m=p.origin;Dy.copy(m.position),Dy.applyMatrix4($m).reflect(i).applyMatrix4(Ly),Um.copy(m.quaternion);const v=ko(Vm,Um);Vm.applyMatrix4($m).reflect(i).applyMatrix4(Ly),Vm.normalize(),Um.setFromAxisAngle(Vm,-v),f.position.copy(Dy),f.quaternion.copy(Um),f.updateMatrix(),f.updateMatrixWorld(!0),p.relatedMatOrigin.multiplyMatrices($m,m.matrix),p.relatedMatFlipped.multiplyMatrices(g.relatedMatFlipped,f.matrix)}f.isMesh&&this.mirrorMesh(o,c+"/"+p.instanceId,f,p.origin,i),d.push(...f.children)}}mirrorMesh(t,s,i,r,o){if(!(!(i!=null&&i.geometry)||!(r!=null&&r.geometry))){if(t.mirrorGeometry[s]){i.geometry=t.mirrorGeometry[s];return}if(i.geometry===r.geometry){i.geometry=new at;const a=r.geometry.getIndex();a&&(i.geometry.index=new An(new Uint32Array(a.array.length),a.itemSize),this.flipIndex(i.geometry.index,a));const l=r.geometry.getAttribute("position");l&&i.geometry.setAttribute("position",new We(new Float32Array(l.array),l.itemSize));const c=r.geometry.getAttribute("normal");c&&i.geometry.setAttribute("normal",new We(new Float32Array(c.array),c.itemSize));const h=r.geometry.getAttribute("color");h&&i.geometry.setAttribute("color",new We(new Float32Array(h.array),h.itemSize));const d=r.geometry.getAttribute("uv");d&&i.geometry.setAttribute("uv",d.clone())}this.mirrorGeometry(i.geometry,r.geometry,o),i.geometry.boundingSphere=null,t.mirrorGeometry[s]=i.geometry}}flipIndex(t,s){const i=t.array,r=s.array;for(let o=0,a=r.length;o<a;o+=3)i[o]=r[o+2],i[o+1]=r[o+1],i[o+2]=r[o]}mirrorGeometry(t,s,i){const r=!t.getIndex();this.mirrorAttribute(t.getAttribute("position"),s.getAttribute("position"),i,r),this.mirrorAttribute(t.getAttribute("normal"),s.getAttribute("normal"),i,r),r&&this.flipTriangles(t.getAttribute("color"),s.getAttribute("color"))}mirrorAttribute(t,s,i,r){if(!t||!s||t.itemSize!==3)return;const o=t.array,a=s.array;if(r)for(let l=0,c=a.length;l<c;l+=9)for(let h=0;h<9;h+=3)Or.fromArray(a,l+6-h),Or.reflect(i),o[l+h]=Or.x,o[l+h+1]=Or.y,o[l+h+2]=Or.z;else for(let l=0,c=a.length;l<c;l+=3)Or.fromArray(a,l),Or.reflect(i),o[l]=Or.x,o[l+1]=Or.y,o[l+2]=Or.z;t.needsUpdate=!0}flipTriangles(t,s){if(!t||!s||t.itemSize!==3)return;const i=t.array,r=s.array;for(let o=0,a=r.length;o<a;o+=9)for(let l=0;l<9;l+=3)i[o+l]=r[o+6-l],i[o+l+1]=r[o+6-l+1],i[o+l+2]=r[o+6-l+2];t.needsUpdate=!0}}u(zx,"ModelUpdateSystem");bme(zx,"ModelUpdateSystem");var wme=Object.defineProperty,xme=u((n,e)=>wme(n,"name",{value:e,configurable:!0}),"__name$12");class Bx extends zi{begin(e){e=e.readonlyRef();for(let t of e.views)t.enabled&&(t.mouseScr.x=t.input.pointerX,t.mouseScr.y=t.height-t.input.pointerY,t.mouseNdc.x=t.mouseScr.x/t.width*2-1,t.mouseNdc.y=t.mouseScr.y/t.height*2-1,t.mouseRay0.copy(t.mouseNdc),t.mouseRay0.z=-1,t.mouseRay0.unproject(t.camera.get()),t.mouseRay1.copy(t.mouseNdc),t.mouseRay1.z=1,t.mouseRay1.unproject(t.camera.get()),t.mouseRayN.subVectors(t.mouseRay1,t.mouseRay0).normalize(),t.raycaster.setFromCamera(t.mouseNdc,t.camera.get()))}end(e){}}u(Bx,"MouseSystem");xme(Bx,"MouseSystem");var Ame=Object.defineProperty,Mme=u((n,e)=>Ame(n,"name",{value:e,configurable:!0}),"__name$11");class Ux extends zi{constructor(){super(...arguments);A(this,"selectedObjs",[]);A(this,"visibilityCache",new Map)}setup(t){t.outlinePass.render=(s,i,r,o,a)=>{this.visibilityCache.clear();for(let l of this.selectedObjs){let c=l;for(;c;)this.visibilityCache.has(c)||this.visibilityCache.set(c,c.visible),c.visible=!0,c=c.parent}Wr.prototype.render.call(t.outlinePass,s,i,r,o,a);for(let l of this.selectedObjs){let c=l;for(;c;)c.visible=!!this.visibilityCache.get(c),c=c.parent}}}begin(t){if(!t.options.outlineSelected){t.outlinePass.selectedObjects.length=0,t.outlinePass.enabled=!1;return}const s=t.readonlyRef().model.getTopmostSelectedNodes();this.selectedObjs.length=0;for(let i of s)if(i.has(Pe)&&i.visible&&i.type!=="CsgBezierControlPoint"){const r=i.value(Pe);r&&this.selectedObjs.push(r)}t.outlinePass.selectedObjects=this.selectedObjs,t.outlinePass.enabled=!!this.selectedObjs.length}end(t){}}u(Ux,"OutlineUpdateSystem");Mme(Ux,"OutlineUpdateSystem");var Sme=Object.defineProperty,Cme=u((n,e)=>Sme(n,"name",{value:e,configurable:!0}),"__name$10");class _u extends Ar{constructor(e=10,t=10,s=4473924,i=4473924,r=8947848,o=!0){const a=new De(s),l=new De(i),c=new De(r),h=t/2,d=e/t,f=e/2,p=[],g=[];for(let y=0,b=0,_=-f;y<=t;y++,_+=d){p.push(-f,0,_,f,0,_),p.push(_,0,-f,_,0,f);const w=y===h?a:c,x=y===h?l:c;w.toArray(g,b),b+=3,w.toArray(g,b),b+=3,x.toArray(g,b),b+=3,x.toArray(g,b),b+=3}const m=new at;m.setAttribute("position",new We(p,3)),m.setAttribute("color",new We(g,3));const v=new Bs({vertexColors:!0,toneMapped:!1,depthWrite:o});super(m,v),this.type="Grids"}dispose(){this.geometry.dispose(),this.material.dispose()}}u(_u,"Grids");Cme(_u,"Grids");var Eme=Object.defineProperty,Tme=u((n,e)=>Eme(n,"name",{value:e,configurable:!0}),"__name$$");const y0=["nose","neck","right_shoulder","right_elbow","right_wrist","left_shoulder","left_elbow","left_wrist","right_hip","right_knee","right_ankle","left_hip","left_knee","left_ankle","right_eye","left_eye","right_ear","left_ear"],oE=[[0,1],[1,2],[2,3],[3,4],[1,5],[5,6],[6,7],[1,8],[8,9],[9,10],[1,11],[11,12],[12,13],[14,0],[14,16],[15,0],[15,17]],_k=[[0,0,255],[255,0,0],[255,170,0],[255,255,0],[255,85,0],[170,255,0],[85,255,0],[0,255,0],[0,255,85],[0,255,170],[0,255,255],[0,170,255],[0,85,255],[85,0,255],[170,0,255],[255,0,255],[255,0,170],[255,0,85]],Pme=_k.map(n=>`rgb(${n[0]},${n[1]},${n[2]})`),Rme=_k.map(n=>`rgba(${n[0]},${n[1]},${n[2]},0.7)`),fd=y0.map(n=>!1),Gm=y0.map(n=>new P);function $x(n,e,t){const s=[...e.children],i=[];for(;s.length;){const c=s.pop();if(!c)break;if(c.visible){const h=c.userData.node;if(h){if(h.has(Li)){const d=h.get(Li);d.value&&i.push(d)}}else s.push(...c.children)}}const r=n.canvas.width,o=n.canvas.height,a=r/2,l=o/2;n.lineWidth=10;for(let c of i){const h=y0.length;for(let d=0;d<h;++d){const f=y0[d],p=c.keypoints[f];if(p){fd[d]=!0;const g=tc(Gm[d],p.getWorldMatrix());g.project(t),g.x=g.x*a+a,g.y=-g.y*l+l}else fd[d]=!1}for(let d=0,f=oE.length;d<f;++d){const p=oE[d],g=p[0],m=p[1];if(fd[g]&&fd[m]){const v=Gm[g],y=Gm[m];n.beginPath(),n.moveTo(v.x,v.y),n.lineTo(y.x,y.y),n.strokeStyle=Rme[d],n.stroke()}}for(let d=0;d<h;++d)if(fd[d]){const f=Gm[d];n.beginPath(),n.arc(f.x,f.y,5,0,Math.PI*2),n.fillStyle=Pme[d],n.fill()}}}u($x,"drawOpenposeKeypoints");Tme($x,"drawOpenposeKeypoints");var Ime=Object.defineProperty,bk=u((n,e)=>Ime(n,"name",{value:e,configurable:!0}),"__name$_");const ya=200,Dme=new P(1,0,0),Lme=new P(0,1,0),Ome=new P(0,0,1),kme=new P,pd=new s1;function Vg(n,e){return kme.crossVectors(n._dir,e).lengthSq()<1e-8}u(Vg,"isCameraParallelTo");bk(Vg,"isCameraParallelTo");class Vx extends zi{constructor(){super(...arguments);A(this,"groundGrids",new _u(ya,ya,16135762,3113955,5592405));A(this,"xzGrids",new _u(ya,ya,16135762,3113955,5592405,!1));A(this,"xyGrids",new _u(ya,ya,16135762,7316763,5592405,!1).rotateX(Math.PI/2));A(this,"yzGrids",new _u(ya,ya,7316763,3113955,5592405,!1).rotateZ(Math.PI/2))}setup(t){t.scene.add(this.groundGrids),t.scene.add(this.xzGrids),t.scene.add(this.xyGrids),t.scene.add(this.yzGrids)}begin(t){t=t.readonlyRef();const s=t.canvas.getBoundingClientRect(),i=t.renderer;if(t.depthMapOutput||t.edgeOutput||t.poseOutput){const o=t.views[t.mainViewIndex];if(pd.copy(o.camera),pd.update(512,512),(t.depthMapOutput||t.edgeOutput)&&(i.setScissorTest(!1),i.setViewport(0,t.canvas.height-512,512,512),t.depthMapOutput&&(t.depthMapPass.camera=pd.get(),t.depthMapComposer.setSize(512,512),t.depthMapComposer.render(),t.depthMapOutput.drawImage(t.canvas,0,0,512,512,0,0,512,512)),t.edgeOutput&&(t.edgeDetectPass.camera=pd.get(),t.edgeComposer.setSize(512,512),t.edgeComposer.render(),t.edgeOutput.drawImage(t.canvas,0,0,512,512,0,0,512,512))),t.poseOutput){const a=t.poseOutput;a.fillStyle="#000",a.fillRect(0,0,a.canvas.width,a.canvas.height),$x(a,t.scene,pd.get())}}i.setScissorTest(!0),i.setClearColor(0,0),i.clear();const r=t.options.shadingMode==="solid";for(let o of t.views){for(let a of t.views){const l=o===a;a.gizmo.visible=l&&a.gizmoEnabled,a.gizmo.size=t.options.quadView?1/2:1/4,a.defaultLights.visible=r&&l}if(o.enabled&&o.width&&o.height){const a=o.camera;this.xzGrids.visible=t.options.showGrids&&Vg(a,Lme),this.xyGrids.visible=t.options.showGrids&&Vg(a,Ome),this.yzGrids.visible=t.options.showGrids&&Vg(a,Dme),this.groundGrids.visible=t.options.showGrids&&!(this.xzGrids.visible||this.xyGrids.visible||this.yzGrids.visible),t.tool.beforeRender(t,o);const l=-s.left+o.left,c=s.bottom-o.bottom,h=o.width,d=o.height;switch(i.setViewport(l,c,h,d),i.setScissor(l,c,h,d),t.options.shadingMode){case"solid":case"rendered":t.renderPass.camera=a.get(),t.outlinePass.renderCamera=a.get(),t.openPosePass.camera=a.get(),t.openPosePass.enabled=t.options.showOpenPoseKeypoints,t.defaultComposer.setSize(h,d),t.defaultComposer.render();break;case"depth":t.depthMapPass.camera=a.get(),t.depthMapPass.offset=t.options.depthMapOffset,t.depthMapPass.scale=t.options.depthMapScale,t.depthMapComposer.setSize(h,d),t.depthMapComposer.render();break;case"edge":t.edgeDetectPass.camera=a.get(),t.edgeDetectPass.normalThreshold=t.options.edgeDetectNormalThreshold,t.edgeDetectPass.depthThreshold=t.options.edgeDetectDepthThreshold,t.edgeComposer.setSize(h,d),t.edgeComposer.render();break}}}t.tool.afterRender(t)}end(t){}}u(Vx,"RenderSystem");bk(Vx,"RenderSystem");var Nme=Object.defineProperty,Fme=u((n,e)=>Nme(n,"name",{value:e,configurable:!0}),"__name$Z");const aE=new P(0,0,1),md=new P,Oy=new be,_a=new P,ky=new Xa;class Gx extends zi{constructor(){super(...arguments);A(this,"prevTool");A(this,"dragMovedFramesCount",0);A(this,"sculptPicked",!1);A(this,"sculptStroked",!1);A(this,"sculptIndicator",new Ar(new at().setFromPoints([...v0(1),...v0(.05)]),new Bs({fog:!1,toneMapped:!1,transparent:!0,color:15964205,opacity:1})));A(this,"sculptIndicatorSym",new Ar(this.sculptIndicator.geometry.clone(),this.sculptIndicator.material.clone()))}setup(t){this.sculptIndicator.visible=!1,t.scene.add(this.sculptIndicator),this.sculptIndicatorSym.visible=!1,this.sculptIndicatorSym.material.opacity=.33,t.scene.add(this.sculptIndicatorSym)}begin(t){var i,r,o;const s=rt(t.tool);if(t.selectionRectSetThisFrame=!1,s.enableSelectionRect)for(let a of t.views){if(a=rt(a),!a.enabled)continue;const l=a.input;if(l.pointerOver&&l.mouseLeft){const c=Math.max(-1,Math.min(1,a.mouseNdc.x)),h=Math.max(-1,Math.min(1,a.mouseNdc.y));t.selectionRectDragging?(t.selectionRect.setPoint2(c,h),t.selectionEnd.set(c,h),this.dragMovedFramesCount<2&&(t.selectionRect.hide(),(this.dragMovedFramesCount||!t.selectionStart.equals(t.selectionEnd))&&(this.dragMovedFramesCount+=1))):(t.selectionRectDragging=!0,t.selectionRectViewIndex=a.index,t.selectionRect.attach(a.element),t.selectionRect.setPoint1(c,h),t.selectionRect.setPoint2(c,h),t.selectionStart.set(c,h),t.selectionEnd.set(c,h),this.dragMovedFramesCount=0)}if(t.selectionRectDragging&&t.selectionRectViewIndex===a.index&&!l.mouseLeft&&(t.selectionRectDragging=!1,t.selectionRectSetThisFrame=!0,t.selectionRect.hide(),s.enableDefaultSelectionBehavior))if(t.selectionStart.equals(t.selectionEnd)){const c=a.mousePick();let h=0;for(let d of c){const f=d.object.userData.node;if(f!=null&&f.visible){if(!t.options.allowSelectingInvisibleObjectByClicking&&f.has(je)&&((i=f.parent)==null?void 0:i.has(je)))continue;h=f.id;break}}if(h){if(t.model.selected.includes(h)?a.input.isKeyPressed("Control")&&(t.model.selected=t.model.selected.filter(d=>d!==h)):(a.input.isKeyPressed("Control")||(t.model.selected=[]),t.model.addSelection(h)),l.doubleClick){let d=t.model.getNode(h);for(d=d.parent;d;)d.expanded=!0,d=d.parent}}else a.input.isKeyPressed("Control")||(t.model.selected=[])}else{const c=t.selectionRect.select(a.camera.get(),t.readonlyRef().scene.children.filter(h=>h.visible&&!!h.userData.node));a.input.isKeyPressed("Control")||(t.model.selected=[]);for(let h of c){const d=h.userData.node;if(d){if(!t.options.allowSelectingInvisibleObjectByClicking&&d.has(je)&&((r=d.parent)==null?void 0:r.has(je)))continue;t.model.addSelection(d.id)}}}}else t.selectionRect.hide(),t.selectionRectDragging=!1;do{if(this.sculptIndicator.visible=!1,this.sculptIndicatorSym.visible=!1,t.sculptNodeId=0,t.sculptSym=!1,t.sculptMoved=!1,this.sculptPicked){let c=!1;for(let h of t.views)if(h.input.mouseLeft){c=!0;break}c||(this.sculptPicked=!1);break}if(!s.sculpt)break;const a=t.readonlyRef().model.getSelectedNodes().filter(c=>c.type==="Clay"&&!c.instanceId&&c.visible)[0];if(!a)break;const l=a.get(Pe).mesh;if(!l)break;t.sculptNodeId=a.id,t.sculptSym=a.value(Us)!=="none";for(let c of t.views){if(c=rt(c),!c.enabled)continue;const h=c.input;if(h.mouseLeft)(h.pointerOver||t.sculptActiveView===c.index)&&(t.sculptActiveView=c.index,h.mouseLeftDownThisFrame?(t.sculptMoved=!0,t.sculptStartThisFrame=!0,t.sculptX0=t.sculptX1=h.pointerX,t.sculptY0=t.sculptY1=h.pointerY,this.sculptStroked=!1):(t.sculptX1!==h.pointerX||t.sculptY1!==h.pointerY)&&(t.sculptMoved=!0,t.sculptStartThisFrame=!1,t.sculptX0=t.sculptX1,t.sculptY0=t.sculptY1,t.sculptX1=h.pointerX,t.sculptY1=h.pointerY,this.sculptStroked=!0));else if(t.sculptActiveView===c.index&&(t.sculptActiveView=-1,!this.sculptStroked&&h.pointerOver)){t.model.selected.length=0;for(let g of c.mousePick()){const m=g.object.userData.node;if((m==null?void 0:m.type)==="Clay"){t.model.addSelection(m.id),this.sculptPicked=!0,t.sculptActiveView=-1;break}}}if(!h.pointerOver)continue;const d=a.getWorldMatrix();Oy.copy(d).invert(),ky.copy(c.raycaster.ray),ky.applyMatrix4(Oy);const f=l.raycast(ky,!0)[0];if(!f)break;h.mouseLeft?this.sculptStroked=!0:(this.sculptIndicator.visible=!0,this.sculptIndicatorSym.visible=t.sculptSym),this.sculptIndicator.position.copy(f.point).applyMatrix4(d),_a.copy(f.normal).transformDirection(d),this.sculptIndicator.quaternion.setFromUnitVectors(aE,_a);let p=s.brushRadius/c.height;if(c.camera.perspective?p*=this.sculptIndicator.position.distanceTo(c.camera._position):p*=c.camera.orthographicCamera.top-c.camera.orthographicCamera.bottom,this.sculptIndicator.scale.setScalar(p),t.sculptLocalRadius=p*Ia(Oy),this.sculptIndicatorSym.visible){switch(md.copy(f.point),_a.copy(f.normal),a.value(Us)){case"x":md.x*=-1,_a.x*=-1;break;case"y":md.y*=-1,_a.y*=-1;break;case"z":md.z*=-1,_a.z*=-1;break}this.sculptIndicatorSym.position.copy(md).applyMatrix4(d),_a.transformDirection(d),this.sculptIndicatorSym.quaternion.setFromUnitVectors(aE,_a),this.sculptIndicatorSym.scale.copy(this.sculptIndicator.scale)}break}}while(!1);s.begin(t);for(let a of t.views)a=rt(a),a.enabled&&s.update(t,a);if(s.end(t),s.sculpt&&!t.sculptNodeId)for(let a of t.views){a=rt(a);const l=a.input;if(l.pointerOver&&l.mouseLeftDownThisFrame)for(let c of a.mousePick()){const h=c.object.userData.node;if((h==null?void 0:h.type)==="Clay"){t.model.addSelection(h.id),this.sculptPicked=!0,t.sculptActiveView=-1;break}}}if(rt(this.prevTool)!==s&&((o=this.prevTool)==null||o.onUnselected(t),this.prevTool=s,t.statusBarMessage=s.tips),s.optionsProps.length){const a=t.options.tools[s.constructor.name]=t.options.tools[s.constructor.name]||{};for(let l of s.optionsProps)a[l]=s[l]}}end(t){}}u(Gx,"ToolSystem");Fme(Gx,"ToolSystem");var zme=Object.defineProperty,Hx=u((n,e)=>zme(n,"name",{value:e,configurable:!0}),"__name$Y");const ba=new P,gd=new P,Xc=new P,vd=new P,Hm=new P,Wm=new P,jm=new P,Xm=new P,Ny=new P,Fy=new P,zy=new P,yd=new P;function cb(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(cb,"vertex$2");Hx(cb,"vertex");function Ei(n,e,t,s){return e=cb(n,e,t),cb(n,e,s)}u(Ei,"line$1");Hx(Ei,"line");class Wx extends Ar{constructor(){const t=new at,s=new Array(12*2*3).fill(0),i=new Array(12*2*3).fill(1);t.setAttribute("position",new We(s,3)),t.setAttribute("color",new We(i,3));const r=new Bs({vertexColors:!0,toneMapped:!1,color:16776960});super(t,r);A(this,"point1",new P);A(this,"point2",new P);A(this,"normal1",new P);A(this,"normal2",new P);A(this,"length",0);A(this,"width",0);A(this,"height",0);A(this,"dirty",!1);this.type="BoxEdge"}setPoint1(t){this.point1.equals(t)||(this.dirty=!0,this.point1.copy(t))}setPoint2(t){this.point2.equals(t)||(this.dirty=!0,this.point2.copy(t))}setNormal1(t){this.normal1.equals(t)||(this.dirty=!0,this.normal1.copy(t))}setNormal2(t){this.normal2.equals(t)||(this.dirty=!0,this.normal2.copy(t))}setHeight(t){t!==this.height&&(this.dirty=!0,this.height=t)}getLength(){return this.length}getWidth(){return this.width}updateGeometry(){if(!this.dirty)return;this.dirty=!1;const t=this.geometry.attributes.position,s=t.array;ba.copy(this.point1),Xc.copy(this.point2),Fy.copy(this.normal1).normalize(),zy.crossVectors(this.normal1,this.normal2).normalize(),Ny.subVectors(Xc,ba),gd.copy(ba).addScaledVector(Fy,this.width=Ny.dot(Fy)),vd.copy(ba).addScaledVector(zy,this.length=Ny.dot(zy)),yd.copy(this.normal2).normalize().multiplyScalar(this.height),Hm.addVectors(ba,yd),Wm.addVectors(gd,yd),jm.addVectors(Xc,yd),Xm.addVectors(vd,yd);let i=0;i=Ei(s,i,ba,gd),i=Ei(s,i,gd,Xc),i=Ei(s,i,Xc,vd),i=Ei(s,i,vd,ba),i=Ei(s,i,ba,Hm),i=Ei(s,i,gd,Wm),i=Ei(s,i,Xc,jm),i=Ei(s,i,vd,Xm),i=Ei(s,i,Hm,Wm),i=Ei(s,i,Wm,jm),i=Ei(s,i,jm,Xm),Ei(s,i,Xm,Hm),t.needsUpdate=!0}}u(Wx,"BoxEdge");Hx(Wx,"BoxEdge");var Bme=Object.defineProperty,jx=u((n,e)=>Bme(n,"name",{value:e,configurable:!0}),"__name$X");const vn=new P,wi=new P,xi=new P,Ai=new P,fl=new P,pl=new P,ml=new P,gl=new P,vl=new P;function Co(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(Co,"vertex$1");jx(Co,"vertex");function wk(n,e,t,s,i,r,o){let a=0;Co(n,a,t),a=Co(e,a,o),Co(n,a,s),a=Co(e,a,o),Co(n,a,i),a=Co(e,a,o),Co(n,a,r),Co(e,a,o)}u(wk,"face");jx(wk,"face");const on=class extends Ye{constructor(){const t=new at,s=new Float32Array(4*3),i=new Float32Array(4*3);t.setAttribute("position",new We(s,3)),t.setAttribute("normal",new We(i,3)),t.setIndex([0,1,3,0,3,2]);const r=new Fs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16776960,opacity:.75});super(t,r);A(this,"size",new P(1,1,1));A(this,"face",on.Right);A(this,"dirty",!0);this.type="BoxFace"}setSize(t){this.size.equals(t)||(this.dirty=!0,this.size.copy(t))}setFace(t){t!==this.face&&(this.dirty=!0,this.face=t)}getFace(){return this.face}setFaceFromNormal(t){t.x<-1e-6?this.setFace(on.Left):t.x>1e-6?this.setFace(on.Right):t.y<-1e-6?this.setFace(on.Bottom):t.y>1e-6?this.setFace(on.Top):t.z<-1e-6?this.setFace(on.Back):this.setFace(on.Front)}getFaceNormal(t){switch(this.face){case on.Left:t.set(-1,0,0);break;case on.Right:t.set(1,0,0);break;case on.Bottom:t.set(0,-1,0);break;case on.Top:t.set(0,1,0);break;case on.Back:t.set(0,0,-1);break;case on.Front:t.set(0,0,1);break}return t}getFaceTangent(t){switch(this.face){case on.Left:t.set(0,0,-1);break;case on.Right:t.set(0,0,1);break;case on.Bottom:t.set(-1,0,0);break;case on.Top:t.set(1,0,0);break;case on.Back:t.set(0,-1,0);break;case on.Front:t.set(0,1,0);break}return t}updateGeometry(){if(!this.dirty)return;this.dirty=!1,vn.copy(this.size).multiplyScalar(-.5),wi.set(this.size.x,0,0),xi.set(0,this.size.y,0),Ai.set(0,0,this.size.z);const t=this.geometry.attributes.position,s=this.geometry.attributes.normal,i=t.array,r=s.array;switch(t.needsUpdate=!0,s.needsUpdate=!0,this.face){case on.Left:fl.copy(vn),pl.copy(vn).add(Ai),ml.copy(vn).add(xi),gl.copy(vn).add(Ai).add(xi),vl.set(-1,0,0);break;case on.Right:fl.copy(vn).add(wi),pl.copy(vn).add(xi).add(wi),ml.copy(vn).add(Ai).add(wi),gl.copy(vn).add(Ai).add(xi).add(wi),vl.set(1,0,0);break;case on.Bottom:fl.copy(vn),pl.copy(vn).add(wi),ml.copy(vn).add(Ai),gl.copy(vn).add(Ai).add(wi),vl.set(0,-1,0);break;case on.Top:fl.copy(vn).add(xi),pl.copy(vn).add(Ai).add(xi),ml.copy(vn).add(wi).add(xi),gl.copy(vn).add(Ai).add(wi).add(xi),vl.set(0,1,0);break;case on.Back:fl.copy(vn),pl.copy(vn).add(xi),ml.copy(vn).add(wi),gl.copy(vn).add(xi).add(wi),vl.set(0,0,-1);break;case on.Front:fl.copy(vn).add(Ai),pl.copy(vn).add(wi).add(Ai),ml.copy(vn).add(xi).add(Ai),gl.copy(vn).add(xi).add(wi).add(Ai),vl.set(0,0,1);break}wk(i,r,fl,pl,ml,gl,vl)}};let ts=on;u(ts,"BoxFace"),A(ts,"Right",0),A(ts,"Left",1),A(ts,"Top",2),A(ts,"Bottom",3),A(ts,"Front",4),A(ts,"Back",5);jx(ts,"BoxFace");var Ume="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntlDkOADEIxCDa/3/Z26TKBbmUBtcZD4oQIsFr1HoAMCVUNZ1LcjLX5FOZFXkv9+1OY/15VeAJlcOMSB7RDlEQBX4AWut9pKAnP1Iwkos0zvXV8xw84QcGmUP1JGS0xQAAAABJRU5ErkJggg==",$me=Object.defineProperty,Vme=u((n,e)=>$me(n,"name",{value:e,configurable:!0}),"__name$W");function xk(n,e,t,s,i){let r,o,a,l,c=t-n,h=s-e,d=Math.abs(c),f=Math.abs(h),p=2*f-d,g=2*d-f;if(f<=d){c>=0?(r=n,o=e,a=t):(r=t,o=s,a=n),i(r,o);for(let m=0;r<a;m++)r=r+1,p<0?p=p+2*f:(c<0&&h<0||c>0&&h>0?o=o+1:o=o-1,p=p+2*(f-d)),i(r,o)}else{h>=0?(r=n,o=e,l=s):(r=t,o=s,l=e),i(r,o);for(let m=0;o<l;m++)o=o+1,g<=0?g=g+2*d:(c<0&&h<0||c>0&&h>0?r=r+1:r=r-1,g=g+2*(d-f)),i(r,o)}}u(xk,"pixelLine");Vme(xk,"pixelLine");var Gme=Object.defineProperty,Hme=u((n,e)=>Gme(n,"name",{value:e,configurable:!0}),"__name$V");const yl=new ja,oi=new Xa,lE=new be,Ym=new P;class Kn{constructor(){A(this,"sep",!1);A(this,"tips","");A(this,"enableDefaultDeleteShortcut",!0);A(this,"enableSelectionRect",!1);A(this,"enableDefaultSelectionBehavior",!1);A(this,"sculpt",!1);A(this,"brushRadius",50);A(this,"brushStepSpacingRadiusRatio",.2);A(this,"brushStrength",.5);A(this,"hasDirection",!1);A(this,"hasThirdDirection",!1);A(this,"brushDirection",1);A(this,"brushHardness",.5);A(this,"hasHardness",!1);A(this,"hasColor",!1);A(this,"frontFacesOnly",!1);A(this,"optionsProps",[])}setup(e){}dispose(){}begin(e){}update(e,t){}end(e){}beforeRender(e,t){}afterRender(e){}onUnselected(e){}sculptPickStrokeVertices(e,t,s,i,r){e=e.readonlyRef(),lE.copy(t.getWorldMatrix()).invert();const o=new Set,a=[],l=Math.max(1,Math.floor(this.brushRadius*this.brushStepSpacingRadiusRatio));e.sculptStartThisFrame&&(e.sculptAccWalkedPixels=l);const c=t.value(Us);xk(e.sculptX0,e.sculptY0,e.sculptX1,e.sculptY1,(p,g)=>{if(e.sculptAccWalkedPixels+=1,e.sculptAccWalkedPixels<l)return;e.sculptAccWalkedPixels=0,oi.origin.set(p/s.width*2-1,(s.height-g)/s.height*2-1,-1),oi.direction.copy(oi.origin).setZ(1),oi.origin.unproject(s.camera.get()),oi.direction.unproject(s.camera.get()),oi.direction.sub(oi.origin).normalize(),oi.applyMatrix4(lE);const m=i.raycast(oi,!0)[0];if(!m)return;yl.set(m.point,e.sculptLocalRadius);const v=i.intersectSphere(yl),y=[],b=new Set;for(let x of v)if(!(r&&(i.getNormal(Ym,x),Ym.dot(oi.direction)>=0)))for(let S=0;S<3;++S){const C=i.sharedVertexMap[x*3+S];b.has(C)||(b.add(C),y.push(C),o.add(C))}switch(c){case"x":yl.center.x*=-1,oi.direction.x*=-1;break;case"y":yl.center.y*=-1,oi.direction.y*=-1;break;case"z":yl.center.z*=-1,oi.direction.z*=-1;break;default:{a.push({center:m.point,triangles:v,indices:y});return}}const _=i.intersectSphere(yl),w=[];b.clear();for(let x of _)if(!(r&&(i.getNormal(Ym,x),Ym.dot(oi.direction)>=0)))for(let S=0;S<3;++S){const C=i.sharedVertexMap[x*3+S];b.has(C)||(b.add(C),w.push(C),o.add(C))}a.push({center:m.point,triangles:v,indices:y,centerSym:new P().copy(yl.center),trianglesSym:_,indicesSym:w})});const h=Array.from(o),d=new Map,f=new Float32Array(h.length*3);for(let p=0,g=h.length;p<g;++p){const m=h[p];for(let v=0;v<3;++v)f[p*3+v]=i.aPosition[m*3+v];d.set(m,p*3)}return{indices:h,offset:d,position:f,track:a}}sculptFalloff(e){return(3*e-4)*e**3+1}}u(Kn,"EditorTool");Hme(Kn,"EditorTool");var Wme=Object.defineProperty,jme=u((n,e)=>Wme(n,"name",{value:e,configurable:!0}),"__name$U");const qm=new P,_d=new P,cE=new P,By=new P,Un=new P,bd=new P,wd=new P,uE=new P,Xme=new P,_l=new be,Km=new P,hE=new P,bl=new P,wa=new P,xd=new P,Mi=.25;class _p extends Kn{constructor(){super(...arguments);A(this,"name",_p.name);A(this,"label","Box");A(this,"icon",Ume);A(this,"tips","Hold [Alt] to create a box");A(this,"boxEdge",new Wx);A(this,"boxFace",new ts);A(this,"activeViewIndex",-1);A(this,"draggingFace",!1);A(this,"draggingFaceNodeId",0);A(this,"draggingFaceIndex",0);A(this,"draggingFaceNormal",new P);A(this,"faceNormalWorld0",new P);A(this,"position0",new P);A(this,"boxSize0",new P);A(this,"localMat0",new be);A(this,"invWorldMat0",new be);A(this,"mouse0",new P);A(this,"local0",new P);A(this,"creating",!1);A(this,"point2Set",!1);A(this,"point1",new P);A(this,"point2",new P);A(this,"normal1",new P);A(this,"normal2",new P);A(this,"boxHeight",0)}setup(t){this.boxEdge.visible=!1,t.scene.add(this.boxEdge),this.boxFace.visible=!1,t.scene.add(this.boxFace)}begin(t){this.draggingFace||(this.boxFace.visible=!1),this.creating||(this.boxEdge.visible=!1)}update(t,s){var r;const i=s.input;if(this.draggingFace){if(this.activeViewIndex!==s.index)return;if(i.pointerOver&&i.mouseLeft&&t.model.isNodeExists(this.draggingFaceNodeId,"Box")){if(uE.crossVectors(this.faceNormalWorld0,s.mouseRayN).lengthSq()<1e-6)return;Ro(qm,null,this.mouse0,this.faceNormalWorld0,s.mouseRay0,s.mouseRayN),_d.copy(qm).applyMatrix4(this.invWorldMat0);const o=cE.subVectors(_d,this.local0).dot(this.draggingFaceNormal);By.copy(this.position0),Un.copy(this.boxSize0);const a=t.model.getNode(this.draggingFaceNodeId);switch(this.draggingFaceIndex){case ts.Left:case ts.Right:{Un.x=Math.max(0,o+Un.x),i.isKeyPressed("Shift")&&(Un.x=Math.round(Un.x/Mi)*Mi);const l=this.draggingFaceIndex===ts.Left?1:-1;bd.set(l*this.boxSize0.x/2,0,0),wd.set(l*Un.x/2,0,0)}break;case ts.Bottom:case ts.Top:{Un.y=Math.max(0,o+Un.y),i.isKeyPressed("Shift")&&(Un.y=Math.round(Un.y/Mi)*Mi);const l=this.draggingFaceIndex===ts.Bottom?1:-1;bd.set(0,l*this.boxSize0.y/2,0),wd.set(0,l*Un.y/2,0)}break;case ts.Back:case ts.Front:{Un.z=Math.max(0,o+Un.z),i.isKeyPressed("Shift")&&(Un.z=Math.round(Un.z/Mi)*Mi);const l=this.draggingFaceIndex===ts.Back?1:-1;bd.set(0,0,l*this.boxSize0.z/2),wd.set(0,0,l*Un.z/2)}break}bd.applyMatrix4(this.localMat0),wd.applyMatrix4(this.localMat0),By.add(bd).sub(wd),t.history.setValue(a,Yi,new P().copy(Un)),t.history.setValue(a,ze,new P().copy(By)),Un.multiplyScalar(Ia(a.getWorldMatrix())),t.statusBarMessage=`${Un.x.toFixed(2)} \xD7 ${Un.y.toFixed(2)} \xD7 ${Un.z.toFixed(2)}`}else this.draggingFace=!1,this.activeViewIndex=-1,this.draggingFaceNodeId=0,t.statusBarMessage=this.tips;return}if(this.creating){if(!this.point2Set){if(this.activeViewIndex!==s.index)return;if(i.mouseRightDownThisFrame&&(this.creating=!1,t.statusBarMessage=this.tips),Qt(this.point2,s.mouseRay0,s.mouseRay1,this.point1,this.normal2)){if(this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry(),i.isKeyPressed("Shift")){bl.copy(this.normal1),wa.crossVectors(this.normal1,this.normal2).normalize();let l=this.boxEdge.getWidth(),c=this.boxEdge.getLength();l=Math.round(l/Mi)*Mi,c=Math.round(c/Mi)*Mi,this.point2.copy(this.point1).addScaledVector(bl,l).addScaledVector(wa,c),this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry()}const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a}`}i.mouseLeft||(this.point2Set=!0);return}if(!i.pointerOver||(i.mouseRightDownThisFrame&&(this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips),uE.crossVectors(this.normal2,s.mouseRayN).lengthSq()<1e-8))return;if(!Ro(qm,null,this.point2,this.normal2,s.mouseRay0,s.mouseRayN)){this.boxHeight=cE.subVectors(qm,this.point2).dot(this.normal2),i.isKeyPressed("Shift")&&(this.boxHeight=Math.round(this.boxHeight/Mi)*Mi),this.boxEdge.setHeight(this.boxHeight),this.boxEdge.updateGeometry();const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2),l=Math.abs(this.boxHeight).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a} \xD7 ${l}`}if(i.mouseLeftDownThisFrame){this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips;let o=null;for(let v of t.model.getSelectedNodes())if(v.isValidChild("Box")){o=v;break}o?_l.copy(o.getWorldMatrix()).invert():_l.identity(),_d.copy(this.point1).applyMatrix4(_l),Km.copy(this.point2).applyMatrix4(_l),hE.copy(this.point2).addScaledVector(this.normal2,this.boxHeight).applyMatrix4(_l),bl.copy(this.normal1).transformDirection(_l),wa.copy(this.normal2).transformDirection(_l),xd.crossVectors(bl,wa).normalize();let a=_d.dot(bl),l=Km.dot(bl);a>l&&([a,l]=[l,a]);let c=_d.dot(xd),h=Km.dot(xd);c>h&&([c,h]=[h,c]);let d=Km.dot(wa),f=hE.dot(wa);d>f&&([d,f]=[f,d]);const p=new ft().setFromQuaternion(Ua(new qe,xd,wa)),g=new P(l-a,f-d,h-c),m=new P().addScaledVector(bl,a+g.x/2).addScaledVector(wa,d+g.y/2).addScaledVector(xd,c+g.z/2);t.history.createNode({type:"Box",parentId:o?o.id:0,data:{[Yi.name]:g,[ze.name]:m,[nt.name]:p}})}return}if(i.pointerOver){for(let o of s.mousePick()){const a=o.object.userData.node;if((a==null?void 0:a.type)==="Box"){const l=(r=o.face)==null?void 0:r.normal;l&&(this.boxFace.visible=!0,this.boxFace.matrixAutoUpdate=!1,this.boxFace.matrix.copy(a.getWorldMatrix()),this.boxFace.setSize(a.value(Yi)),this.boxFace.setFaceFromNormal(l),this.boxFace.updateGeometry(),this.point1.copy(o.point),i.mouseLeftDownThisFrame&&!i.isKeyPressed("Alt")&&!a.instanceId&&(this.draggingFace=!0,this.activeViewIndex=s.index,this.draggingFaceNodeId=a.id,this.draggingFaceIndex=this.boxFace.getFace(),this.draggingFaceNormal.copy(l),this.faceNormalWorld0.copy(l).transformDirection(a.getWorldMatrix()),this.position0.copy(a.value(ze)),this.boxSize0.copy(a.value(Yi)),this.localMat0.copy(a.getLocalMatrix()),this.invWorldMat0.copy(a.getWorldMatrix()).invert(),this.mouse0.copy(o.point),this.local0.copy(this.mouse0).applyMatrix4(this.invWorldMat0)));break}}i.isKeyPressed("Alt")&&i.mouseLeftDownThisFrame&&(this.boxFace.visible?(this.creating=!0,this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2),this.normal1.transformDirection(this.boxFace.matrix),this.normal2.transformDirection(this.boxFace.matrix)):Qt(this.point1,s.mouseRay0,s.mouseRay1,this.point1.set(0,0,0),s.camera.perspective?Xme.set(0,1,0):s.mouseRayN)&&(s.camera.perspective?(this.normal1.set(1,0,0),this.normal2.set(0,1,0)):(this.boxFace.setFaceFromNormal(s.mouseRayN),this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2)),this.creating=!0),this.creating&&(i.isKeyPressed("Shift")&&Eu(this.point1,Mi),this.activeViewIndex=s.index,this.boxHeight=0,this.boxEdge.setPoint1(this.point1),this.boxEdge.setPoint2(this.point1),this.boxEdge.setNormal1(this.normal1),this.boxEdge.setNormal2(this.normal2),this.boxEdge.setHeight(0),this.boxEdge.updateGeometry(),this.boxEdge.visible=!0))}}onUnselected(t){this.draggingFace=!1,this.creating=!1,this.point2Set=!1,this.boxEdge.visible=!1,this.boxFace.visible=!1}}u(_p,"BoxTool");jme(_p,"BoxTool");var Yme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAItJREFUSIntkskRgCAMAIljIR4taP8FaAsencSPMtGBkGD4sR8zjO6C6lwlF7wpGqDXYoFika/UPBISmkZiMrMIJzKJpCS/IxLBr4j04dR9rUUcEREAICswdJOf93P1c0yoCjzy7VhQIxWBBLoWmjnYE5juWIr2FE1uiH58DvUroLse+xmce/9dFTUXvoWCImYNNpoAAAAASUVORK5CYII=",qme=Object.defineProperty,Kme=u((n,e)=>qme(n,"name",{value:e,configurable:!0}),"__name$T");class bp extends Kn{constructor(){super(...arguments);A(this,"name",bp.name);A(this,"label","Select");A(this,"icon",Yme);A(this,"enableSelectionRect",!0);A(this,"enableDefaultSelectionBehavior",!0)}}u(bp,"CursorTool");Kme(bp,"CursorTool");var Zme=Object.defineProperty,Xx=u((n,e)=>Zme(n,"name",{value:e,configurable:!0}),"__name$S");function ub(n,e,t){return n[e]=t.x,n[e+1]=t.y,n[e+2]=t.z,e+3}u(ub,"vertex");Xx(ub,"vertex");function Ti(n,e,t,s){return e=ub(n,e,t),ub(n,e,s)}u(Ti,"line");Xx(Ti,"line");const xa=new P,Yc=new P,wl=new P,qc=new P,Ad=new P,Md=new P,Sd=new P,Cd=new P;class Yx extends Ar{constructor(){const t=new at,s=new Array(12*2*3).fill(0);t.setAttribute("position",new We(s,3));const i=new Bs({toneMapped:!1,color:16777215,transparent:!0,opacity:.25});super(t,i);A(this,"box",new ss);this.type="AabbEdge"}setBox(t){if(this.box.equals(t))return;this.box.copy(t);const s=t.max.x-t.min.x,i=t.max.y-t.min.y,r=t.max.z-t.min.z;xa.copy(t.min),Yc.copy(xa),Yc.x+=s,wl.copy(xa),wl.x+=s,wl.z+=r,qc.copy(xa),qc.z+=r,Ad.copy(xa),Ad.y+=i,Md.copy(Yc),Md.y+=i,Sd.copy(wl),Sd.y+=i,Cd.copy(qc),Cd.y+=i;const o=this.geometry.attributes.position,a=o.array;let l=0;l=Ti(a,l,xa,Yc),l=Ti(a,l,Yc,wl),l=Ti(a,l,wl,qc),l=Ti(a,l,qc,xa),l=Ti(a,l,xa,Ad),l=Ti(a,l,Yc,Md),l=Ti(a,l,wl,Sd),l=Ti(a,l,qc,Cd),l=Ti(a,l,Ad,Md),l=Ti(a,l,Md,Sd),l=Ti(a,l,Sd,Cd),Ti(a,l,Cd,Ad),o.needsUpdate=!0}}u(Yx,"AabbEdge");Xx(Yx,"AabbEdge");var Qme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAJNJREFUSIntVMsOwCAIo8v+/5e7kwkzgIJmO2w9+YBWiyLyYzdIMhN/VIlnhTBLDACaVM8BDHlCcj1viOI0XGWS1CezSPr96ZtkCxnlnVWCLb5740ycK6KL6SXpfav4Ip1FVe8tjmbhTaAtrggNa/NYDbx1z2svL/VMK0/znZ/skVZ6UWjRqGMud1OLbPT5tgl9BxdXU+tyUEB2ugAAAABJRU5ErkJggg==",Jme=Object.defineProperty,qx=u((n,e)=>Jme(n,"name",{value:e,configurable:!0}),"__name$R");function Kx(...n){if(!n.length)return null;if(n.length===1)return n[0];const e=new Set;let t=n[0];for(;t;)e.add(t),t=t.parent;let s=n[1];for(;s;){if(e.has(s))return Kx(s,...n.slice(2));s=s.parent}return null}u(Kx,"getCommonParent");qx(Kx,"getCommonParent");const ege=function(){const n=new ss,e=new be;return qx(u(function t(s,i,r){i.updateWorldMatrix(!1,!1);const o=i.geometry;o&&(o.boundingBox||o.computeBoundingBox(),n.copy(o.boundingBox),e.multiplyMatrices(r,i.matrixWorld),n.applyMatrix4(e),s.union(n));for(let a of i.children)a.visible&&t(s,a,r)},"expandBoxByVisibleObjects2"),"expandBoxByVisibleObjects")}(),Zm=new ss,Aa=new be,Ed=new be,Uy=new be,$n=new P,$y=new qe,xl=new P,Ls=new P,dE=new be,fE=new be,Td=new P,Qm=new P;class Zx extends Kn{constructor(){super(...arguments);A(this,"label","Transform");A(this,"icon",Qme);A(this,"nodes",[]);A(this,"detMats",new Map);A(this,"geom3Init",new Map);A(this,"boundingBox",new Yx)}setup(t){t.scene.add(this.boundingBox),this.boundingBox.visible=!1}begin(t){const s=t.readonlyRef().model;this.nodes=s.getTopmostSelectedNodes().filter(r=>r.visible&&r.has(Pe));const i=this.nodes.map(r=>r.value(Pe)).filter(r=>!!r);if(i.length){this.boundingBox.visible=!0,Zm.makeEmpty();const r=Kx(...i);r?(r.updateWorldMatrix(!1,!1),Aa.copy(r.matrixWorld),Ed.copy(r.matrixWorld).invert()):(Aa.identity(),Ed.identity());for(let o of i)ege(Zm,o,Ed);this.boundingBox.setBox(Zm),Aa.decompose(this.boundingBox.position,this.boundingBox.quaternion,this.boundingBox.scale),this.boundingBox.quaternion.normalize(),Zm.applyMatrix4(Aa).getSize(Qm),t.statusBarMessage=`${Qm.x.toFixed(2)} \xD7 ${Qm.y.toFixed(2)} \xD7 ${Qm.z.toFixed(2)}`}else this.boundingBox.visible=!1,t.statusBarMessage="";this.enableSelectionRect=!0}update(t,s){var r,o,a,l;const i=s.gizmo;if(i.orientation=t.options.useLocalSpaceForTransformControl?"local":"world",s.gizmo.visible=!0,s.gizmoEnabled=this.boundingBox.visible,s.gizmoEnabled){if(this.boundingBox.updateMatrixWorld(),i.dragging||(t.options.takeGeometryCenterAsTransformOrigin?this.boundingBox.box.getCenter($n).applyMatrix4(this.boundingBox.matrixWorld):$n.copy(this.boundingBox.position),i.setTargetTransform($n,this.boundingBox.quaternion,xl.set(1,1,1))),s.gizmo.enableTranslate=!0,s.gizmo.enableRotate=!0,s.gizmo.enableScale=!0,this.nodes.length===1){const c=this.nodes[0];s.gizmo.enableTranslate=c.has(ze),s.gizmo.enableRotate=c.has(nt),s.gizmo.enableScale=c.has(Wt)||c.has(It)}s.gizmo.enableTranslate||s.gizmo.enableRotate||s.gizmo.enableScale?i.update(s.camera,s.raycaster,s.input,s.mouseRay0,s.mouseRay1,s.mouseRayN):s.gizmoEnabled=!1}if(i.dragging)if(this.enableSelectionRect=!1,i.dragStart){Aa.compose(i.position0,i.rotation0,i.scale0),Ed.copy(Aa).invert(),this.detMats.clear(),this.geom3Init.clear();for(let c of this.nodes){const h=new be().multiplyMatrices(Ed,c.getWorldMatrix());switch(this.detMats.set(c.id,h),c.type){case"CsgCuboid":this.geom3Init.set(c.id,{[qi.name]:c.cloneValue(qi),[It.name]:c.cloneValue(It)});break;case"CsgEllipsoid":this.geom3Init.set(c.id,{[gr.name]:c.cloneValue(gr),[It.name]:c.cloneValue(It)});break;case"CsgCylinder":this.geom3Init.set(c.id,{[fn.name]:c.cloneValue(fn),[It.name]:c.cloneValue(It),[ui.name]:c.cloneValue(ui)});break;case"CsgCylinderElliptic":this.geom3Init.set(c.id,{[fn.name]:c.cloneValue(fn),[It.name]:c.cloneValue(It)});break}}}else{dE.compose(i.position0,i.rotation0,i.scale0),Aa.compose(i.position1,i.rotation1,i.scale1);for(let c of this.nodes){const h=this.detMats.get(c.id);if(!h)continue;Uy.copy(c.getParentWorldMatrix()).invert().multiply(Aa).multiply(h),Uy.decompose($n,$y,xl),c.has(ze)&&t.history.setValue(c,ze,new P().copy($n)),c.has(nt)&&t.history.setValue(c,nt,new ft().setFromQuaternion($y));let d=!1;if(i.mode==="scale"){const f=this.geom3Init.get(c.id);if(f&&Math.abs($y.length()-1)<1e-8){const p=f[It.name];switch(Ls.copy(xl).divide(p),c.type){case"CsgCuboid":{const g=new P().copy(f[qi.name]);g.multiply(Ls),t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,qi,g),d=!0}break;case"CsgEllipsoid":{const g=new P().copy(f[gr.name]);g.multiply(Ls),t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,gr,g),d=!0}break;case"CsgCylinder":if(Math.abs(Ls.x-1)<1e-7&&Math.abs(Ls.y-1)<1e-7&&Math.abs(Ls.z-1)>1e-7){let g=f[fn.name];g*=Ls.z,t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,fn,g),t.history.setValue(c,It,new P().copy(p)),d=!0}else if(Math.abs(Ls.x-1)>1e-7&&Math.abs(Ls.y-Ls.x)<1e-7&&Math.abs(Ls.z-1)<1e-7){let g=f[ui.name];g*=Ls.x,t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,ui,g),t.history.setValue(c,It,new P().copy(p)),d=!0}else t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,fn,f[fn.name]),t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,ui,f[ui.name]);break;case"CsgCylinderElliptic":if(Math.abs(Ls.x-1)<1e-7&&Math.abs(Ls.y-1)<1e-7&&Math.abs(Ls.z-1)>1e-7){let g=f[fn.name];g*=Ls.z,t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,fn,g),t.history.setValue(c,It,new P().copy(p)),d=!0}else t.history.setValue(c.instanceId?t.model.getNode(c.instanceId):c,fn,f[fn.name]);break}}}if(!d)if(c.has(Wt)){fE.copy(c.getParentWorldMatrix()).invert().multiply(dE).multiply(h),DR(Td,fE);const f=(xl.x/Td.x||1)*(xl.y/Td.y||1)*(xl.z/Td.z||1)*Td.x;t.history.setValue(c,Wt,f)}else c.has(It)&&t.history.setValue(c,It,new P().copy(xl));if(c.has(je)){const f=c.get(je);d?(f.useTempMat=!0,f.tempMat.copy(Uy)):f.useTempMat=!1;let p=c;for(;p&&(p.parent&&p.parent.has(je));)p=p.parent;t.delayThrottle(`#${p.id}-update-csg`,50)}}}else if(t.selectionRectSetThisFrame&&t.selectionRectViewIndex===s.index){const c=t.readonlyRef().selectionRect;if(Math.abs(c.x0-c.x1)<1e-6&&Math.abs(c.y0-c.y1)<1e-6){const h=s.raycaster.intersectObjects(t.readonlyRef().scene.children.filter(v=>!!v.userData.node));let d=!1,f=null;for(let v of h)if((r=v.object.userData.node)!=null&&r.visible){const y=v.object.userData.node;if(!t.options.allowSelectingInvisibleObjectByClicking&&y.has(je)&&((o=y.parent)==null?void 0:o.has(je)))continue;if(f||(f=y),!d&&t.model.selected.includes(y.id)){d=!0;break}}const p=new Set;for(let v of this.nodes)if(v.type==="CsgBezierControlPoint")for(let y of v.parent.children)p.add(y);let g=1/0;const m=s.camera.get();for(let v of p)tc($n,v.getWorldMatrix()),$n.project(m),!($n.z>g)&&($n.x+=1,$n.y+=1,$n.x*=s.width/2,$n.y*=s.height/2,Math.sqrt((s.mouseScr.x-$n.x)**2+(s.mouseScr.y-$n.y)**2)<=24/2&&(g=$n.z,f=v));d||(s.input.isKeyPressed("Control")||(t.model.selected.length=0),f&&t.model.addSelection(f.id))}else{const h=new Set;for(let d of this.nodes)if(d.type==="CsgBezierControlPoint")for(let f of d.parent.children)h.add(f);if(h.size){const d=s.camera.get();s.input.isKeyPressed("Control")||(t.model.selected.length=0);const f=Math.min(c.x0,c.x1),p=Math.min(c.y0,c.y1),g=Math.max(c.x0,c.x1),m=Math.max(c.y0,c.y1);for(let v of h)tc($n,v.getWorldMatrix()),$n.project(d),$n.x>=f&&$n.x<=g&&$n.y>=p&&$n.y<=m&&t.model.selected.push(v.id)}else{const d=c.select(s.camera.get(),t.readonlyRef().scene.children.filter(f=>!!f.userData.node));s.input.isKeyPressed("Control")||(t.model.selected.length=0);for(let f of d)if((a=f.userData.node)!=null&&a.visible){const p=f.userData.node;if(!t.options.allowSelectingInvisibleObjectByClicking&&p.has(je)&&((l=p.parent)==null?void 0:l.has(je)))continue;t.model.addSelection(p.id)}}}}}end(t){var i;const s=new Set;for(let r of this.nodes)if(r.type==="CsgBezierControlPoint")for(let o of r.parent.children)s.add(o);else{if(!r.has(je))continue;const o=r.get(je);let a=r,l=!1;if(o.useTempMat)l=!0;else for(;a&&a.has(je);){if(a.has(As)&&((i=a==null?void 0:a.parent)==null?void 0:i.has(je))&&a.value(As)==="negative"){l=!0;break}a=a.parent}l&&s.add(r)}for(let r of s){const o=r.get(Pe);if(!o.value)continue;const a=r.get(je),l=a.placeholder;l&&(l.parent||t.scene.add(l),l.visible=!0,l.matrixAutoUpdate=!1,a.useTempMat?l.matrix.multiplyMatrices(r.getParentWorldMatrix(),a.tempMat):l.matrix.copy(o.value.matrixWorld))}}afterRender(t){for(let s of this.nodes)if(s.type==="CsgBezierControlPoint")for(let i of s.parent.children){const r=i.get(je);r.placeholder&&(r.placeholder.visible=!1)}else if(s.has(je)){const i=s.get(je);i.placeholder&&(i.placeholder.visible=!1)}}onUnselected(t){this.boundingBox.visible=!1;for(let s of t.views)s.gizmoEnabled=!1,s.gizmo.visible=!1,s.gizmo.dragging=!1;t.selectionRect.hide(),this.nodes=[],this.detMats.clear(),this.geom3Init.clear()}}u(Zx,"GizmoTool");qx(Zx,"GizmoTool");var tge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntk0sOwCAIRB3vf2e6aqJN+AnEJjpLJfNQhtaudgvcBRHRVAiwtW59zbmzNPMIpGuwaOcioERaxymzyJ6DyygN4IGMYXAHw7ITo7nUmBnCQUOxliDSC8x7AABaurQak5b/+ZeQUsALKQWcoQdg9q9krk0nEQAAAABJRU5ErkJggg==",nge=Object.defineProperty,sge=u((n,e)=>nge(n,"name",{value:e,configurable:!0}),"__name$Q");const Vy=new P,Jm=new P,eg=new P,Al=new P,tg=new be,Kc=new be,ng=new be,Zc=new P,cr=new qe,Gy=new qe,ige=new qe,pE=new qe,sg=new P,mE=new P,ig=new P,gE=new P,vE=new P,Hy=new P,rg=new qe,yE=new P;class Qx extends Kn{constructor(){super(...arguments);A(this,"label","IK Bind");A(this,"icon",tge);A(this,"activeView",-1);A(this,"ikChains",[]);A(this,"node");A(this,"rotate",!1);A(this,"mouse0",new P);A(this,"nodeInvMat",new be);A(this,"chainInvMat",new be);A(this,"chainPosition0",new P);A(this,"nodeStart0",new P);A(this,"nodeEnd0",new P);A(this,"nodeRotation0",new qe);A(this,"nodeLocalMat0",new Map);A(this,"objWorldMat0",new Map)}begin(t){this.cleanup(t);const s=new Set;for(let i of t.model.getSelectedNodes())i.type==="IKChain"?s.add(i):i.type==="IKNode"&&i.parent&&s.add(i.parent);this.ikChains=Array.from(s);for(let i of this.ikChains)for(let r=0,o=i.children.length;r<o;++r){const l=i.children[r].get(Et);l.boneMesh&&(l.boneMesh.visible=!0),l.hingeIndicator&&(l.hingeIndicator.visible=l.hingeEnabled),r===0&&l.moveHandler&&(l.moveHandler.visible=!0),l.rotateHandler&&(l.rotateHandler.visible=!0)}}update(t,s){const i=s.input;if(i.mouseLeft){if(i.mouseLeftDownThisFrame){if(i.pointerOver){let r=1/0,o=null,a=null;for(let l of this.ikChains)for(let c of l.children){const h=c.get(Et);h.updateHandlersHoverState(c,s),h.moveHandlerHovered&&h.moveHandlerZ<r&&(r=h.moveHandlerZ,o=c,a=h),h.rotateHandlerHovered&&h.rotateHandlerZ<r&&(r=h.rotateHandlerZ,o=c,a=h)}if(o&&a){this.node=o,this.rotate=a.rotateHandlerHovered,this.activeView=s.index;const l=o.parent,c=l.getWorldMatrix();this.mouse0.copy(this.rotate?a.end:a.start).applyMatrix4(c),Qt(this.mouse0,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),this.nodeInvMat.copy(c).invert(),this.chainInvMat.copy(l.getParentWorldMatrix()).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.nodeRotation0.copy(a.quaternion),this.chainPosition0.copy(l.value(ze)),this.nodeLocalMat0.clear(),this.objWorldMat0.clear();for(let h of l.children){this.nodeLocalMat0.set(h.id,new be().copy(h.getLocalMatrix()));for(let d of h.children)this.objWorldMat0.set(d.id,new be().copy(d.getWorldMatrix()))}t.model.addSelection(this.node.id)}else{let l;for(let c of s.mousePick()){for(l=c.object.userData.node;l&&!l.has(Et);)l=l.parent||void 0;if(l){this.mouse0.copy(c.point);break}}if(!l){t.model.selected=[];return}t.model.selected=[l.id]}}}else if(this.activeView===s.index&&this.node&&!this.node.deleted){const r=this.node.parent;if(Qt(Vy,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),this.rotate){Jm.copy(this.mouse0).applyMatrix4(this.nodeInvMat),eg.copy(Vy).applyMatrix4(this.nodeInvMat),Al.subVectors(eg,Jm),mE.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),ig.copy(this.nodeEnd0).add(Al).sub(this.nodeStart0);let o=ig.length();ig.normalize(),Gy.setFromUnitVectors(mE,ig),gE.set(0,0,1).applyQuaternion(this.nodeRotation0).applyQuaternion(Gy),vE.set(0,1,0).applyQuaternion(this.nodeRotation0).applyQuaternion(Gy),Ua(cr,gE,vE),rg.copy(cr);const a=r.children.indexOf(this.node);if(a>0){const c=r.children[a-1];pE.copy(c.get(Et).quaternion).invert(),cr.multiplyQuaternions(pE,cr)}let l=t.history.setValue(this.node,En,new ft().setFromQuaternion(cr));if(t.options.allowModifyingBoneLengthWhenBindingIk&&(l=t.history.setValue(this.node,Js,o)||l),l&&t.options.keepInternalTransformWhenBindingIk){let c=r.children.indexOf(this.node);if(c<0)return;Hy.copy(this.node.get(Et).start),yE.set(1,1,1);const h=r.getWorldMatrix();for(let d=r.children.length;c<d;++c){const f=r.children[c];Kc.compose(Hy,rg,yE),Kc.multiplyMatrices(h,Kc).invert();for(let g of f.children){const m=this.objWorldMat0.get(g.id);!m||(ng.multiplyMatrices(Kc,m),ng.decompose(Zc,cr,sg),g.has(ze)&&t.history.setValue(g,ze,new P().copy(Zc)),g.has(nt)&&t.history.setValue(g,nt,new ft().setFromQuaternion(cr)))}const p=c+1;if(p<d){Al.set(o,0,0).applyQuaternion(rg),Hy.add(Al);const g=r.children[p];rg.multiply(ige.setFromEuler(g.value(En))),o=g.value(Js)}}}}else if(Jm.copy(this.mouse0).applyMatrix4(this.chainInvMat),eg.copy(Vy).applyMatrix4(this.chainInvMat),Al.subVectors(eg,Jm),t.history.setValue(r,ze,new P().copy(this.chainPosition0).add(Al))&&t.options.keepInternalTransformWhenBindingIk){Zc.copy(this.chainPosition0).add(Al),cr.setFromEuler(r.value(nt)),sg.setScalar(r.value(Wt)),tg.compose(Zc,cr,sg),tg.multiplyMatrices(r.getParentWorldMatrix(),tg);for(let a of r.children){const l=this.nodeLocalMat0.get(a.id);if(!!l){Kc.multiplyMatrices(tg,l).invert();for(let c of a.children){const h=this.objWorldMat0.get(c.id);!h||(ng.multiplyMatrices(Kc,h),ng.decompose(Zc,cr,sg),c.has(ze)&&t.history.setValue(c,ze,new P().copy(Zc)),c.has(nt)&&t.history.setValue(c,nt,new ft().setFromQuaternion(cr)))}}}}}}else this.activeView===s.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let s of this.ikChains)if(!s.deleted)for(let i of s.children){if(i.deleted)continue;i.get(Et).resetHandlers(t)}this.ikChains.length=0}}u(Qx,"IkBindTool");sge(Qx,"IkBindTool");var rge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntktsOwCAIQ+3+/5/xyWRbVrATNVl23kRCubSUn92AfZiZXRIBmitzL85iacVHRI5IbLRzV0Chu5Eokd1HmvbNHVj8cUUAkOYaD6VbaYJGxiShi7at6/yWXdQj4gmmiExd2zKR6cdf4q7vUwFJaZOIR/7h8gAAAABJRU5ErkJggg==",oge=Object.defineProperty,age=u((n,e)=>oge(n,"name",{value:e,configurable:!0}),"__name$P");const ai=new P,_E=new be;class Jx extends Kn{constructor(){super(...arguments);A(this,"label","Stretch Joint");A(this,"icon",rge);A(this,"node",null);A(this,"dragging",!1);A(this,"draggedPrevFrame",!1);A(this,"length0",0);A(this,"childrenPosition0",new Map);A(this,"scale",new P)}begin(t){this.cleanup(t),this.node=null;for(let i of t.model.getSelectedNodes())if(!i.instanceId){this.node=i;break}for(;this.node&&!(this.node.type==="IKNode"&&!this.node.instanceId);)this.node=this.node.parent;if(!this.node){for(let i of t.views)i.gizmoEnabled=!1,i.gizmo.visible=!1,i.gizmo.dragging=!1;return}const s=this.node.parent;for(let i=0,r=s.children.length;i<r;++i){const a=s.children[i].get(Et);a.boneMesh&&(a.boneMesh.visible=!0)}if(!this.dragging){this.length0=this.node.value(Js),this.childrenPosition0.clear();for(let i of this.node.children)i.has(ze)&&this.childrenPosition0.set(i.id,new P().copy(i.value(ze)))}this.draggedPrevFrame=this.dragging,this.dragging=!1}update(t,s){if(this.node&&(s.gizmoEnabled=!0,s.gizmo.visible=!0,s.gizmo.orientation="local",s.gizmo.enableTranslate=!1,s.gizmo.enableRotate=!1,s.gizmo.enableScale=!0,s.gizmo.dragging||(s.gizmo.setTargetTransformFromMatrix(this.node.getWorldMatrix()),s.gizmo.scale0.set(1,1,1)),s.gizmo.update(s.camera,s.raycaster,s.input,s.mouseRay0,s.mouseRay1,s.mouseRayN),s.gizmo.dragging)){this.dragging=!0,this.scale.copy(s.gizmo.scale1),this.scale.x=Math.max(this.scale.x,0),t.history.setValue(this.node,Js,this.length0*this.scale.x);for(let r of this.childrenPosition0){const o=t.model.getNode(r[0]),a=r[1],l=new P().copy(a);l.x*=this.scale.x,t.history.setValue(o,ze,l)}for(let r of this.node.children)r.type==="Clay"&&t.model.setValue(r,Sr,new P().copy(this.scale));return}const i=s.input;if(i.pointerOver&&i.mouseLeftDownThisFrame)for(let r of s.mousePick()){const o=r.object.userData.node;if(o&&!o.instanceId){t.model.selected=[o.id];break}}}end(t){if(this.draggedPrevFrame&&!this.dragging&&this.node){const s=this.scale,i=this.length0,r=s.x*i,o=r-i,a=t.options.keepBothEndsOfClayNodesWhenStretching;let l=!1;for(let c of this.node.children)if(c.type==="Clay"){l=!0;const h=c.getLocalMatrix();_E.copy(h).invert();const d=c.cloneValue(Mn);for(let f=0,p=d.length;f<p;f+=3)ai.fromArray(d,f),ai.applyMatrix4(h),s.x>1&&a?ai.x>0&&ai.x<r?ai.x*=s.x:ai.x>=r&&(ai.x+=o):ai.x*=s.x,ai.y*=s.y,ai.z*=s.z,ai.applyMatrix4(_E),d[f]=ai.x,d[f+1]=ai.y,d[f+2]=ai.z;t.history.setValue(c,Mn,d)}if(l){const c=[];c.push({node:this.node,componentClass:Js});for(let h of this.childrenPosition0){const d=t.model.getNode(h[0]);c.push({node:d,componentClass:ze})}t.history.mergeLastRecord(c)}}}onUnselected(t){for(let s of t.views)s.gizmoEnabled=!1,s.gizmo.visible=!1,s.gizmo.dragging=!1;this.cleanup(t),this.node=null,this.dragging=!1,this.draggedPrevFrame=!1,this.scale.setScalar(1),this.childrenPosition0.clear()}cleanup(t){if(this.node){for(let i of this.node.children)i.type==="Clay"&&t.model.setValue(i,Sr,new P(1,1,1));const s=this.node.parent;for(let i=0,r=s.children.length;i<r;++i)s.children[i].get(Et).resetHandlers(t)}}}u(Jx,"IkJointStretchTool");age(Jx,"IkJointStretchTool");var lge=Object.defineProperty,cge=u((n,e)=>lge(n,"name",{value:e,configurable:!0}),"__name$O");class eA{constructor(){A(this,"length",0);A(this,"localRotation",new qe);A(this,"start",new P);A(this,"end",new P);A(this,"rotation",new qe);A(this,"hingeEnabled",!1);A(this,"hingeAxis",new P(1,0,0));A(this,"lowerAngle",-Math.PI);A(this,"upperAngle",+Math.PI)}}u(eA,"CcdJoint");cge(eA,"CcdJoint");var uge=Object.defineProperty,hge=u((n,e)=>uge(n,"name",{value:e,configurable:!0}),"__name$N");const Wy=new P,bE=new P,wE=new P,Pd=new qe,xE=new P,AE=new P,og=new qe,ag=new P;class tA{constructor(){A(this,"joints",[]);A(this,"iterLimit",20);A(this,"precision",1e-4)}resize(e){this.joints.length=e;for(let t=0;t<e;++t)this.joints[t]||(this.joints[t]=new eA)}resolve(e){const t=this.joints.length;if(!t)return;for(let i=0;i<t;++i){const r=this.joints[i];if(i>0){const o=this.joints[i-1];r.rotation.multiplyQuaternions(o.rotation,r.localRotation),r.start.copy(o.end)}else r.rotation.copy(r.localRotation),r.start.set(0,0,0);r.end.set(r.length,0,0).applyQuaternion(r.rotation).add(r.start)}const s=this.joints[t-1];Wy.copy(s.end);for(let i=0;i<this.iterLimit;++i){for(let r=t-1;r>=0;--r){const o=this.joints[r];if(bE.subVectors(s.end,o.start).normalize(),wE.subVectors(e,o.start).normalize(),Pd.setFromUnitVectors(bE,wE),xE.set(0,0,1).applyQuaternion(o.rotation).applyQuaternion(Pd),AE.set(0,1,0).applyQuaternion(o.rotation).applyQuaternion(Pd),Ua(o.localRotation,xE,AE),r>0){const a=this.joints[r-1];og.copy(a.rotation).invert(),o.localRotation.multiplyQuaternions(og,o.localRotation)}if(o.hingeEnabled){og.copy(o.localRotation).invert(),ag.copy(o.hingeAxis).applyQuaternion(og),Pd.setFromUnitVectors(o.hingeAxis,ag),o.localRotation.multiply(Pd).normalize();let a=ko(ag,o.localRotation);const l=Math.sign(ag.dot(o.hingeAxis));a=ew(a*l,o.lowerAngle,o.upperAngle),o.localRotation.setFromAxisAngle(o.hingeAxis,a)}for(let a=r;a<t;++a){const l=this.joints[a];if(a>0){const c=this.joints[a-1];l.rotation.multiplyQuaternions(c.rotation,l.localRotation),l.start.copy(c.end)}else l.rotation.copy(l.localRotation),l.start.set(0,0,0);l.end.set(l.length,0,0).applyQuaternion(l.rotation).add(l.start)}}if(s.end.distanceToSquared(Wy)<=this.precision||s.end.distanceToSquared(e)<=this.precision)break;Wy.copy(s.end)}}}u(tA,"CcdChain");hge(tA,"CcdChain");var dge=Object.defineProperty,qo=u((n,e)=>dge(n,"name",{value:e,configurable:!0}),"__name$M");class nA{constructor(e){A(this,"node");A(this,"length",0);A(this,"localRotation",new qe);A(this,"localRotation0",new qe);A(this,"hingeEnabled",!1);A(this,"hingeAxis",new P(1,0,0));A(this,"lowerAngle",-Math.PI);A(this,"upperAngle",+Math.PI);A(this,"localMat",new be);A(this,"worldMat",new be);A(this,"hasLockEndChild",!1);A(this,"children",[]);A(this,"parent",null);A(this,"start",new P);A(this,"end",new P);A(this,"rotation",new qe);this.node=e}}u(nA,"VirtualIkNode");qo(nA,"VirtualIkNode");class sA{constructor(){A(this,"localMat",new be);A(this,"worldMat",new be);A(this,"hasLockEndChild",!1);A(this,"children",[]);A(this,"parent",null)}}u(sA,"VirtualContainer");qo(sA,"VirtualContainer");class L1{constructor(){A(this,"children",[]);A(this,"localMat",new be);A(this,"worldMat",new be);A(this,"hasLockEndChild",!1);A(this,"lockEnd",!1);A(this,"endWorld",new P);A(this,"parent",null)}}u(L1,"VirtualIkChain");qo(L1,"VirtualIkChain");function iA(n){const e=[];let t=!1;for(let s of n.children){const i=iA(s);i&&(e.push(i),(i.hasLockEndChild||i.lockEnd)&&(t=!0))}switch(n.type){case"Container":{const s=new sA;s.localMat.copy(n.getLocalMatrix()),s.worldMat.copy(n.getWorldMatrix()),s.hasLockEndChild=t,s.children=e;for(let i of s.children)i.parent=s;return s}case"IKChain":{const s=new L1;if(s.localMat.copy(n.getLocalMatrix()),s.worldMat.copy(n.getWorldMatrix()),s.lockEnd=n.value(Ff),s.hasLockEndChild=t,s.children=e,s.lockEnd&&n.children.length){const i=n.children[n.children.length-1];s.endWorld.copy(i.get(Et).end),s.endWorld.applyMatrix4(s.worldMat)}for(let i of s.children)i.parent=s;return s}case"IKNode":{const s=new nA(n);switch(s.localMat.copy(n.getLocalMatrix()),s.worldMat.copy(n.getWorldMatrix()),s.length=n.value(Js),s.localRotation.setFromEuler(n.value(En)),s.localRotation0.copy(s.localRotation),n.value(di)){case"horizontal":s.hingeEnabled=!0,s.hingeAxis.set(0,1,0);break;case"vertical":s.hingeEnabled=!0,s.hingeAxis.set(0,0,1);break;default:s.hingeEnabled=!1;break}const i=n.value($a);if(s.lowerAngle=i[0]/180*Math.PI,s.upperAngle=i[1]/180*Math.PI,n.instanceId&&n.has(Xn)){const r=n.value(Xn);switch(n.value(di)){case"horizontal":r.z>1e-6&&([s.lowerAngle,s.upperAngle]=[-s.upperAngle,-s.lowerAngle]);break;case"vertical":r.y>1e-6&&([s.lowerAngle,s.upperAngle]=[-s.upperAngle,-s.lowerAngle]);break}}s.hasLockEndChild=t,s.children=e;for(let r of s.children)r.parent=s;return s}}return null}u(iA,"createVirtualNode");qo(iA,"createVirtualNode");function Ak(n){return iA(n)}u(Ak,"saveIkChainState");qo(Ak,"saveIkChainState");const lg=new tA,fge=new P(1,1,1);function rA(n,e,t,s){lg.resize(t+1);for(let i=0;i<=t;++i){const r=lg.joints[i],o=e.children[i];r.length=o.length,r.localRotation.copy(o.localRotation),r.hingeEnabled=o.hingeEnabled,r.hingeAxis.copy(o.hingeAxis),r.lowerAngle=o.lowerAngle,r.upperAngle=o.upperAngle}lg.resolve(s);for(let i=0;i<=t;++i){const r=lg.joints[i],o=e.children[i];o.localRotation.copy(r.localRotation),n.history.setValue(o.node,En,new ft().setFromQuaternion(o.localRotation))}oA(e)}u(rA,"resolveIkChain");qo(rA,"resolveIkChain");function oA(n){for(let e=0,t=n.children.length;e<t;++e){const s=n.children[e];if(e===0)s.rotation.copy(s.localRotation),s.start.set(0,0,0);else{const i=n.children[e-1];s.rotation.multiplyQuaternions(i.rotation,s.localRotation),s.start.copy(i.end)}s.end.set(s.length,0,0).applyQuaternion(s.rotation).add(s.start),s.localMat.compose(s.start,s.rotation,fge)}}u(oA,"updateIkChainLocalMatrices");qo(oA,"updateIkChainLocalMatrices");const ME=new be,SE=new P;function _0(n,e){if((e.hasLockEndChild||e.lockEnd)&&e.parent&&e.worldMat.multiplyMatrices(e.parent.worldMat,e.localMat),e.lockEnd){const t=e;ME.copy(t.worldMat).invert(),SE.copy(t.endWorld).applyMatrix4(ME),rA(n,t,t.children.length-1,SE)}if(e.hasLockEndChild)for(let t of e.children)_0(n,t)}u(_0,"resolveLockedEnds");qo(_0,"resolveLockedEnds");function aA(n){if(n instanceof L1)for(let e of n.children)e.localRotation.copy(e.localRotation0);if(n.hasLockEndChild)for(let e of n.children)aA(e)}u(aA,"resetIkChains");qo(aA,"resetIkChains");var pge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHlJREFUSIntU0EOwDAIqvv/n9m1MzjRNlmylCNSsFHHOPgaxkgAeIjMqK4Fbx5x28xXQ643w8xU0YQBGQCgPBulY6+bOeVH6RyYOau1Qjwf/aQVUlnfckjVqLTSHZO5VlrTbRetmEYzajWhDpzx8iXOj9kFZ/WDH+MGbSHHUbX+Pw0AAAAASUVORK5CYII=",mge=Object.defineProperty,gge=u((n,e)=>mge(n,"name",{value:e,configurable:!0}),"__name$L");const vo=new P,yo=new P,Qc=new P,Jc=new P,CE=new P,Rd=new P,Ml=new qe,cg=new qe,EE=new P,TE=new P,Sl=new P,jy=new P,PE=new qe,RE=new P;class lA extends Kn{constructor(){super(...arguments);A(this,"label","Move IK Chain");A(this,"icon",pge);A(this,"activeView",-1);A(this,"ikChains",[]);A(this,"node");A(this,"action","swing");A(this,"mouse0",new P);A(this,"origin",new P);A(this,"boneAxis",new P);A(this,"invMat",new be);A(this,"nodeEnd0",new P);A(this,"rotation0",new qe);A(this,"position0",new P);A(this,"chain0",null)}begin(t){this.cleanup(t);const s=new Set;for(let i of t.model.getSelectedNodes())i.type==="IKChain"?s.add(i):i.type==="IKNode"&&i.parent&&s.add(i.parent);this.ikChains=Array.from(s);for(let i of this.ikChains)for(let r=0,o=i.children.length;r<o;++r){const a=i.children[r],l=a.get(Et);r===0&&l.moveHandler&&(l.moveHandler.visible=i.value(Ju)),l.rotateHandler&&(l.rotateHandler.visible=a.value(eh))}}update(t,s){const i=s.input;if(i.mouseLeft){if(i.mouseLeftDownThisFrame){if(i.pointerOver){let r=1/0,o=null,a=null,l=!1;for(let c of this.ikChains)for(let h of c.children){const d=h.get(Et);d.updateHandlersHoverState(h,s),d.moveHandlerHovered&&d.moveHandlerZ<r&&(r=d.moveHandlerZ,o=h,a=d,l=!1),d.rotateHandlerHovered&&d.rotateHandlerZ<r&&(r=d.rotateHandlerZ,o=h,a=d,l=!0)}if(o&&a){this.node=o,this.action=l?"swing":"move",this.activeView=s.index;const c=o.parent,h=c.getWorldMatrix();l?this.mouse0.copy(a.end).applyMatrix4(h):(this.position0.copy(c.value(ze)),tc(this.mouse0,c.getWorldMatrix())),Qt(this.mouse0,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),l?(this.invMat.copy(h).invert(),this.nodeEnd0.copy(a.end)):this.invMat.copy(c.getParentWorldMatrix()).invert(),t.model.addSelection(this.node.id)}else{let c;for(let f of s.mousePickVisible()){for(c=f.object.userData.node;c&&!c.has(Et);)c=c.parent||void 0;if(c){this.mouse0.copy(f.point);break}}if(!c){t.model.selected=[];return}if(t.model.selected=[c.id],c.value(di)!=="none")return;this.node=c,this.action="twist",this.activeView=s.index;const h=c.getParentWorldMatrix();this.invMat.copy(h).invert(),yo.copy(this.mouse0).applyMatrix4(this.invMat);const d=c.get(Et);this.boneAxis.subVectors(d.end,d.start).normalize(),OR(this.origin,d.start,this.boneAxis,yo),this.boneAxis.transformDirection(h),this.rotation0.copy(d.quaternion),this.origin.distanceTo(yo)<1e-8?this.node=void 0:this.origin.applyMatrix4(h)}this.node&&(this.chain0=Ak(this.node.parent))}}else if(this.activeView===s.index&&this.node&&!this.node.deleted&&this.chain0){let r=!1;if(this.action==="move"){Qt(vo,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),yo.copy(this.mouse0).applyMatrix4(this.invMat),Qc.copy(vo).applyMatrix4(this.invMat),Jc.subVectors(Qc,yo);const o=this.node.parent,a=new P().addVectors(this.position0,Jc);r=t.history.setValue(o,ze,a),Ml.setFromEuler(o.value(nt)),RE.setScalar(o.value(Wt)),this.chain0.localMat.compose(a,Ml,RE),this.chain0.worldMat.multiplyMatrices(o.getParentWorldMatrix(),this.chain0.localMat)}else if(this.action==="swing"){if(Qt(vo,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),yo.copy(this.mouse0).applyMatrix4(this.invMat),Qc.copy(vo).applyMatrix4(this.invMat),Jc.subVectors(Qc,yo),Jc.lengthSq()<1e-6)return;Rd.copy(this.nodeEnd0).add(Jc),this.mouse0.copy(vo),this.nodeEnd0.copy(Rd);const o=this.chain0.children.findIndex(a=>a.node.id===this.node.id);rA(t,this.chain0,o,Rd),r=!0}else{if(Math.acos(Math.abs(this.boneAxis.dot(s.mouseRayN)))*180/Math.PI>45){if(!Qt(vo,s.mouseRay0,s.mouseRay1,this.origin,s.mouseRayN))return;Sl.crossVectors(this.boneAxis,s.mouseRayN).normalize();const c=this.mouse0.distanceTo(this.origin),h=.4,d=-Jc.subVectors(vo,this.mouse0).dot(Sl)/c*Math.PI/2*h;Sl.copy(this.boneAxis).transformDirection(this.invMat),cg.setFromAxisAngle(Sl,d)}else{if(!Qt(vo,s.mouseRay0,s.mouseRay1,this.origin,this.boneAxis))return;yo.copy(this.mouse0).applyMatrix4(this.invMat),Qc.copy(vo).applyMatrix4(this.invMat),jy.copy(this.origin).applyMatrix4(this.invMat),CE.subVectors(yo,jy).normalize(),Rd.subVectors(Qc,jy).normalize(),Sl.copy(this.boneAxis).transformDirection(this.invMat);const c=Nl(Sl,CE,Rd);cg.setFromAxisAngle(Sl,c)}EE.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(cg),TE.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(cg),Ua(Ml,EE,TE);const o=this.node.parent,a=o.children.indexOf(this.node);if(a>0){const c=o.children[a-1];PE.copy(c.get(Et).quaternion).invert(),Ml.multiplyQuaternions(PE,Ml)}r=t.history.setValue(this.node,En,new ft().setFromQuaternion(Ml)),this.chain0.children.find(c=>c.node.id===this.node.id).localRotation.copy(Ml),oA(this.chain0)}if(r){for(let o of this.chain0.children)aA(o);if(this.node.id===this.chain0.children[this.chain0.children.length-1].node.id)for(let o of this.chain0.children)_0(t,o);else _0(t,this.chain0)}}}else this.activeView===s.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let s of this.ikChains)if(!s.deleted)for(let i of s.children){if(i.deleted)continue;i.get(Et).resetHandlers(t)}this.ikChains.length=0}}u(lA,"IkMoveTool");gge(lA,"IkMoveTool");var vge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhJREFUSIntk0sOgDAIRDve/864ra0DJUM1Mc4SKI9Pae3X2wJzmJldAgEam9aYnNnKkiuQI4KplbuALYoqZn7r1NunDgBAGcvyb/Mq9eyp4rKQO7+7ZHVcIaAKsqQRUn2Q00MGlLtliSqu3oWwQ5Mg25f/yO/6vk5YzaN81PvS3QAAAABJRU5ErkJggg==",yge=Object.defineProperty,_ge=u((n,e)=>yge(n,"name",{value:e,configurable:!0}),"__name$K");const Ma=new P,_o=new P,eu=new P,Id=new P,ug=new P,hg=new P,Sa=new qe,Cl=new qe,IE=new P,DE=new P,El=new P,Xy=new P,dg=new qe,fg=new P,tu=new P;class cA extends Kn{constructor(){super(...arguments);A(this,"label","Move Single Joint (Ignore IK)");A(this,"icon",vge);A(this,"activeView",-1);A(this,"ikChains",[]);A(this,"node");A(this,"action","swing");A(this,"mouse0",new P);A(this,"origin",new P);A(this,"boneAxis",new P);A(this,"invMat",new be);A(this,"nodeStart0",new P);A(this,"nodeEnd0",new P);A(this,"rotation0",new qe);A(this,"position0",new P)}begin(t){this.cleanup(t);const s=new Set;for(let i of t.model.getSelectedNodes())i.type==="IKChain"?s.add(i):i.type==="IKNode"&&i.parent&&s.add(i.parent);this.ikChains=Array.from(s);for(let i of this.ikChains)for(let r=0,o=i.children.length;r<o;++r){const a=i.children[r],l=a.get(Et);r===0&&l.moveHandler&&(l.moveHandler.visible=i.value(Ju)),l.rotateHandler&&(l.rotateHandler.visible=a.value(eh))}}update(t,s){const i=s.input;if(i.mouseLeft){if(i.mouseLeftDownThisFrame){if(i.pointerOver){let r=1/0,o=null,a=null,l=!1;for(let c of this.ikChains)for(let h of c.children){const d=h.get(Et);d.updateHandlersHoverState(h,s),d.moveHandlerHovered&&d.moveHandlerZ<r&&(r=d.moveHandlerZ,o=h,a=d,l=!1),d.rotateHandlerHovered&&d.rotateHandlerZ<r&&(r=d.rotateHandlerZ,o=h,a=d,l=!0)}if(o&&a){this.node=o,this.action=l?"swing":"move",this.activeView=s.index;const c=o.parent,h=c.getWorldMatrix();l?this.mouse0.copy(a.end).applyMatrix4(h):(this.position0.copy(c.value(ze)),tc(this.mouse0,c.getWorldMatrix())),Qt(this.mouse0,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),l?(this.invMat.copy(h).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.rotation0.copy(a.quaternion)):this.invMat.copy(c.getParentWorldMatrix()).invert(),t.model.addSelection(this.node.id)}else{let c;for(let f of s.mousePickVisible()){for(c=f.object.userData.node;c&&!c.has(Et);)c=c.parent||void 0;if(c){this.mouse0.copy(f.point);break}}if(!c){t.model.selected=[];return}if(t.model.selected=[c.id],c.value(di)!=="none")return;this.node=c,this.action="twist",this.activeView=s.index;const h=c.getParentWorldMatrix();this.invMat.copy(h).invert(),_o.copy(this.mouse0).applyMatrix4(this.invMat);const d=c.get(Et);this.boneAxis.subVectors(d.end,d.start).normalize(),OR(this.origin,d.start,this.boneAxis,_o),this.boneAxis.transformDirection(h),this.rotation0.copy(d.quaternion),this.origin.distanceTo(_o)<1e-8?this.node=void 0:this.origin.applyMatrix4(h)}}}else if(this.activeView===s.index&&this.node&&!this.node.deleted)if(this.action==="move"){Qt(Ma,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),_o.copy(this.mouse0).applyMatrix4(this.invMat),eu.copy(Ma).applyMatrix4(this.invMat),Id.subVectors(eu,_o);const r=this.node.parent;t.history.setValue(r,ze,new P().addVectors(this.position0,Id))}else{if(this.action==="swing")Qt(Ma,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN),_o.copy(this.mouse0).applyMatrix4(this.invMat),eu.copy(Ma).applyMatrix4(this.invMat),Id.subVectors(eu,_o),ug.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),hg.subVectors(this.nodeEnd0,this.nodeStart0).add(Id).normalize(),Cl.setFromUnitVectors(ug,hg);else if(Math.acos(Math.abs(this.boneAxis.dot(s.mouseRayN)))*180/Math.PI>45){if(!Qt(Ma,s.mouseRay0,s.mouseRay1,this.origin,s.mouseRayN))return;El.crossVectors(this.boneAxis,s.mouseRayN).normalize();const l=this.mouse0.distanceTo(this.origin),c=.4,h=-Id.subVectors(Ma,this.mouse0).dot(El)/l*Math.PI/2*c;El.copy(this.boneAxis).transformDirection(this.invMat),Cl.setFromAxisAngle(El,h)}else{if(!Qt(Ma,s.mouseRay0,s.mouseRay1,this.origin,this.boneAxis))return;_o.copy(this.mouse0).applyMatrix4(this.invMat),eu.copy(Ma).applyMatrix4(this.invMat),Xy.copy(this.origin).applyMatrix4(this.invMat),ug.subVectors(_o,Xy).normalize(),hg.subVectors(eu,Xy).normalize(),El.copy(this.boneAxis).transformDirection(this.invMat);const l=Nl(El,ug,hg);Cl.setFromAxisAngle(El,l)}IE.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(Cl),DE.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(Cl),Ua(Sa,IE,DE);const r=this.node.parent,o=r.children.indexOf(this.node);if(o>0){const l=r.children[o-1];dg.copy(l.get(Et).quaternion).invert(),Sa.multiplyQuaternions(dg,Sa)}let a=!1;switch(this.node.value(di)){case"horizontal":tu.set(0,1,0),a=!0;break;case"vertical":tu.set(0,0,1),a=!0;break}if(a){dg.copy(Sa).invert(),fg.copy(tu).applyQuaternion(dg),Cl.setFromUnitVectors(tu,fg),Sa.multiply(Cl).normalize();let l=ko(fg,Sa);const c=Math.sign(fg.dot(tu)),h=this.node.value($a);let d=h[0],f=h[1];if(this.node.instanceId&&this.node.has(Xn)){const p=this.node.value(Xn);switch(this.node.value(di)){case"horizontal":p.z>1e-6&&([d,f]=[-f,-d]);break;case"vertical":p.y>1e-6&&([d,f]=[-f,-d]);break}}l=ew(l*c,d/180*Math.PI,f/180*Math.PI),Sa.setFromAxisAngle(tu,l)}t.history.setValue(this.node,En,new ft().setFromQuaternion(Sa))}}else this.activeView===s.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let s of this.ikChains)if(!s.deleted)for(let i of s.children){if(i.deleted)continue;i.get(Et).resetHandlers(t)}this.ikChains.length=0}}u(cA,"IkRotateTool");_ge(cA,"IkRotateTool");var bge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntVEEOwCAIs2b///J2GQkh6VZQD1vsxaClIAFa2/gdzhtmH6qTtwGA8QAg8uVsnu7NTolLxM+K+zJlEpLInvPG79GRdcgUjGTPfKU5iCJ2Kr9NBZhSvlRHCD6dPSxFZdCWBCmLewF12TFIXaGu640SLqrDp4K4/n+JAAAAAElFTkSuQmCC",wge=Object.defineProperty,xge=u((n,e)=>wge(n,"name",{value:e,configurable:!0}),"__name$J");const LE=new P;class uA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Brush");A(this,"icon",bge);A(this,"sculpt",!0);A(this,"hasDirection",!0);A(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,s){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView)return;const i=s.input;if(!i.mouseLeft)return;if(i.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,s);const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh,l=t.options.enablePressure?1:i.pressure,c=this.brushStrength*this.brushDirection*l*.01,h=new P,d=new P,f=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly);for(let p of f.track)this.stroke(p.indices,c,a.getAverageNormal(d,p.triangles),a.getAverageCenter(h,p.triangles),t.sculptLocalRadius,f.offset,f.position),t.sculptSym&&this.stroke(p.indicesSym,c,a.getAverageNormal(d,p.trianglesSym),a.getAverageCenter(h,p.trianglesSym),t.sculptLocalRadius,f.offset,f.position);t.history.updateVertices(r,Mn,f.indices,f.position)}stroke(t,s,i,r,o,a,l){r.addScaledVector(i,-o*Math.sign(s)*.5);for(let c of t)this.strokeVertex(i,r,o,s,l,a.get(c))}strokeVertex(t,s,i,r,o,a){LE.fromArray(o,a);const l=LE.distanceTo(s)/i;if(l>=1)return;const c=this.sculptFalloff(l)*r;o[a]+=t.x*c,o[a+1]+=t.y*c,o[a+2]+=t.z*c}}u(uA,"SculptBrushTool");xge(uA,"SculptBrushTool");var Age="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntlMEKgDAMQ1Px/39ZLwoSZk2j87K9S2G0SQehwORvtoNu4tda3irbzhK/E+R3W7zSN4i4OsA9sklXcaWZk9NKErNWzc8aEaHMyQaq4CPOHclmlnfrmFR+YV9OJ7KWiXLsMqRksNhniZoAwA6iu8NUWhw/8AAAAABJRU5ErkJggg==",Mge=Object.defineProperty,Sge=u((n,e)=>Mge(n,"name",{value:e,configurable:!0}),"__name$I");const pg=new P,mg=new P;class hA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Crease");A(this,"icon",Age);A(this,"sculpt",!0);A(this,"hasDirection",!0);A(this,"brushStrength",.25);A(this,"brushStepSpacingRadiusRatio",.1);A(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,s){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView)return;const i=s.input;if(!i.mouseLeft)return;if(i.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,s);const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh,l=t.options.enablePressure?1:i.pressure,c=this.brushStrength*this.brushDirection*l*.1,h=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly),d=new P;for(let f of h.track)this.stroke(f.indices,c,a.getAverageNormal(d,f.triangles),f.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(f.indicesSym,c,a.getAverageNormal(d,f.trianglesSym),f.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Mn,h.indices,h.position)}stroke(t,s,i,r,o,a,l){for(let c of t)this.strokeVertex(i,r,o,s,l,a.get(c))}strokeVertex(t,s,i,r,o,a){pg.fromArray(o,a);const l=pg.distanceTo(s)/i;if(l>=1)return;const c=this.sculptFalloff(l),h=c**5*r*-.01;o[a]+=t.x*h,o[a+1]+=t.y*h,o[a+2]+=t.z*h,pg.fromArray(o,a),mg.subVectors(s,pg);const d=c*r*.1;o[a]+=mg.x*d,o[a+1]+=mg.y*d,o[a+2]+=mg.z*d}}u(hA,"SculptCreaseTool");Sge(hA,"SculptCreaseTool");var Cge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntlMEOwCAIQ2H//8/stMQZcC1gdrE3I7w2RBE5+ltaaTYze8FUczwbNJ5no9kQBkfJSyarQg+M9sJwNAB3Kd/pywZsCBr+1KVM2GdGj4h+xxL/iTaDyGiLiaerA5JaEdvgTGN5nKtlh8Kh/d2294883Y/A1zVqqAZoAAAAAElFTkSuQmCC",Ege=Object.defineProperty,Tge=u((n,e)=>Ege(n,"name",{value:e,configurable:!0}),"__name$H");const OE=new P,Yy=new P,Dd=new P,gg=new P;class dA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Drag");A(this,"icon",Cge);A(this,"sculpt",!0);A(this,"brushRadius",100);A(this,"brushStrength",1);A(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);A(this,"nodeId",0);A(this,"stroke0");A(this,"mouse0",new P);A(this,"local0",new P);A(this,"invMat",new be)}begin(t){t.sculptActiveView===-1&&(this.nodeId=0,this.stroke0=void 0)}update(t,s){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView)return;const i=s.input;if(!i.mouseLeft)return;if(i.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,s);const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh,l=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly);if(l.track.length&&(this.nodeId=r.id,this.stroke0=l,this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert()),this.nodeId!==r.id||!this.stroke0||!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}if(!Qt(OE,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN))return;Yy.copy(OE).applyMatrix4(this.invMat).sub(this.local0);const c=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(Dd.copy(Yy),r.value(Us)){case"x":Dd.x*=-1;break;case"y":Dd.y*=-1;break;case"z":Dd.z*=-1;break}const h=t.options.enablePressure?1:i.pressure;this.stroke(this.stroke0.indices,this.brushStrength*h,t.sculptSym,Yy,Dd,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,c),t.history.updateVertices(r,Mn,this.stroke0.indices,c)}stroke(t,s,i,r,o,a,l,c,h,d){for(let f of t)this.strokeVertex(i,r,o,a,l,c,s,d,h.get(f))}strokeVertex(t,s,i,r,o,a,l,c,h){if(gg.fromArray(c,h),t){const d=gg.distanceTo(r)/a,f=gg.distanceTo(o)/a;if(d>=1){if(f>=1)return;const p=this.sculptFalloff(f)*l;c[h]+=i.x*p,c[h+1]+=i.y*p,c[h+2]+=i.z*p}else if(f>=1){const p=this.sculptFalloff(d)*l;c[h]+=s.x*p,c[h+1]+=s.y*p,c[h+2]+=s.z*p}else{const p=1-d+(1-f),g=this.sculptFalloff(d)*l*(1-d)/p,m=this.sculptFalloff(f)*l*(1-f)/p;c[h]+=s.x*g+i.x*m,c[h+1]+=s.y*g+i.y*m,c[h+2]+=s.z*g+i.z*m}}else{const d=gg.distanceTo(r)/a;if(d>=1)return;const f=this.sculptFalloff(d)*l;c[h]+=s.x*f,c[h+1]+=s.y*f,c[h+2]+=s.z*f}}}u(dA,"SculptDragTool");Tge(dA,"SculptDragTool");var Pge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIVJREFUSIntVUEOgCAMo8T/f1kvmujMRjvYSXtCmKVjHbT2owL7iXJiZpPOEl9jAMjJc4itytG3xRaRL1VryZX1KP5Vg1LlIzVRnGfdboMy6mnrqs3j9cV9znURAznbFe1vs3jUAAAym0g2nQUlUskifazMj9M185pHeQ8om1my0qvkezgA21OnjKJcGJgAAAAASUVORK5CYII=",Rge=Object.defineProperty,Ige=u((n,e)=>Rge(n,"name",{value:e,configurable:!0}),"__name$G");const qy=new P,Dge=new P;class fA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Flatten");A(this,"icon",Pge);A(this,"sculpt",!0);A(this,"brushStrength",.2);A(this,"hasDirection",!0);A(this,"hasThirdDirection",!0);A(this,"brushDirection",0);A(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,s){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView)return;const i=s.input;if(!i.mouseLeft)return;if(i.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,s);const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh,l=new P,c=new P,h=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly),d=t.options.enablePressure?1:i.pressure;for(let f of h.track)this.stroke(f.indices,this.brushStrength*d,a.getAverageNormal(c,f.triangles),a.getAverageCenter(l,f.triangles),f.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(f.indicesSym,this.brushStrength*d,a.getAverageNormal(c,f.trianglesSym),a.getAverageCenter(l,f.trianglesSym),f.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Mn,h.indices,h.position)}stroke(t,s,i,r,o,a,l,c){for(let h of t)this.strokeVertex(i,r,o,a,s,c,l.get(h))}strokeVertex(t,s,i,r,o,a,l){qy.fromArray(a,l);const c=qy.distanceTo(i)/r;if(c>=1)return;const h=Dge.subVectors(s,qy).dot(t);if(this.brushDirection===-Math.sign(h))return;const d=this.sculptFalloff(c)*o*h;a[l]+=t.x*d,a[l+1]+=t.y*d,a[l+2]+=t.z*d}}u(fA,"SculptFlattenTool");Ige(fA,"SculptFlattenTool");var Lge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHNJREFUSIntVEEOgDAIW43//zJeXKJkakujB7MegbaMMFqb+D3AFEVEnEgARrljnELsuIrn3KiW7prNUyZSJyrfFc8aiytWdn5FQzVgtmhVBDMAQPoHzohobsXkjvPtFnUoryiPlSHaa/107BgN+1xP2NgAXJmHlymbSbgAAAAASUVORK5CYII=",Oge=Object.defineProperty,kge=u((n,e)=>Oge(n,"name",{value:e,configurable:!0}),"__name$F");const Ky=new P,Zy=new Set,nu=new P,kE=new P,NE=new P;class pA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Inflate");A(this,"icon",Lge);A(this,"sculpt",!0);A(this,"brushStrength",.2);A(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,s){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView)return;const i=s.input;if(!i.mouseLeft)return;if(i.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,s);const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh,l=t.options.enablePressure?1:i.pressure,c=this.brushStrength*l*.01,h=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly);for(let d of h.track)this.stroke(a,d.indices,c,d.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(a,d.indicesSym,c,d.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Mn,h.indices,h.position)}stroke(t,s,i,r,o,a,l){for(let c of s)this.strokeVertex(t,c,r,o,i,l,a.get(c))}strokeVertex(t,s,i,r,o,a,l){Ky.fromArray(a,l);const c=Ky.distanceTo(i)/r;if(c>=1)return;nu.set(0,0,0);let h=t.getVertexTriangleIndex(t.edgeNeighborMap[s]);const d=h;let f=50;Zy.clear();do{Zy.add(h),t.getNormal(kE,h),t.getTriangleCenter(NE,h),nu.addScaledVector(kE,Ky.distanceTo(NE));const g=h;for(let m=0;m<3;++m){const v=h*3+m;if(t.holes[v])continue;const y=t.getVertexTriangleIndex(t.edgeNeighborMap[v]);if(h===y||Zy.has(y))continue;let b=!1;for(let _=0;_<3;++_)if(t.sharedVertexMap[y*3+_]===s){b=!0;break}if(b){h=y;break}}if(g===h)break;if(f--<=0){console.warn("Loop limit reached");break}}while(d!==h);nu.normalize();const p=this.sculptFalloff(c)*o;a[l]+=nu.x*p,a[l+1]+=nu.y*p,a[l+2]+=nu.z*p}}u(pA,"SculptInflateTool");kge(pA,"SculptInflateTool");var Nge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHpJREFUSIntVUkKwDAI1NL/f3l6aS6hLhMNFNq5heAsUYzIDxEBAOtOO8lVtcwXisw4WYJWl7jhCUZn0w0APLn1nmOGmTYiYRLQ5GzNwZKVsOreGoYWAapuVcBDWw+2pnjPFA0wKZb7liksD4W37LLkqdU7k237WL6JC85mj5JuLIckAAAAAElFTkSuQmCC",Fge=Object.defineProperty,zge=u((n,e)=>Fge(n,"name",{value:e,configurable:!0}),"__name$E");const FE=new P,Qy=new P,Ld=new P,vg=new P;class mA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Move");A(this,"icon",Nge);A(this,"sculpt",!0);A(this,"brushStrength",1);A(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);A(this,"nodeId",0);A(this,"stroke0");A(this,"mouse0",new P);A(this,"local0",new P);A(this,"invMat",new be)}update(t,s){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView)return;const i=s.input;if(!i.mouseLeft)return;if(i.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,s);const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh;if(t.sculptStartThisFrame){if(this.nodeId=r.id,this.stroke0=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly),!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert();return}else if(this.nodeId!==r.id){this.nodeId=0,this.stroke0=void 0;return}if(!this.stroke0||!this.stroke0.track.length||!Qt(FE,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN))return;Qy.copy(FE).applyMatrix4(this.invMat).sub(this.local0);const l=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(Ld.copy(Qy),r.value(Us)){case"x":Ld.x*=-1;break;case"y":Ld.y*=-1;break;case"z":Ld.z*=-1;break}const c=t.options.enablePressure?1:i.pressure;this.stroke(this.stroke0.indices,this.brushStrength*c,t.sculptSym,Qy,Ld,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,l),t.history.updateVertices(r,Mn,this.stroke0.indices,l)}stroke(t,s,i,r,o,a,l,c,h,d){for(let f of t)this.strokeVertex(i,r,o,a,l,c,s,d,h.get(f))}strokeVertex(t,s,i,r,o,a,l,c,h){if(vg.fromArray(c,h),t){const d=vg.distanceTo(r)/a,f=vg.distanceTo(o)/a;if(d>=1){if(f>=1)return;const p=this.sculptFalloff(f)*l;c[h]+=i.x*p,c[h+1]+=i.y*p,c[h+2]+=i.z*p}else if(f>=1){const p=this.sculptFalloff(d)*l;c[h]+=s.x*p,c[h+1]+=s.y*p,c[h+2]+=s.z*p}else{const p=1-d+(1-f),g=this.sculptFalloff(d)*l*(1-d)/p,m=this.sculptFalloff(f)*l*(1-f)/p;c[h]+=s.x*g+i.x*m,c[h+1]+=s.y*g+i.y*m,c[h+2]+=s.z*g+i.z*m}}else{const d=vg.distanceTo(r)/a;if(d>=1)return;const f=this.sculptFalloff(d)*l;c[h]+=s.x*f,c[h+1]+=s.y*f,c[h+2]+=s.z*f}}}u(mA,"SculptMoveTool");zge(mA,"SculptMoveTool");var Bge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIFJREFUSIntVMsOwCAIo/v/f2YnE8MQqMHsYi9GbcsrQeTib6BCUlX9CIGSNjX2zLO/snknLxSx9y3z1UkH8YgVs1KAmcT21mpdfdYGJrEwwBFz1tS2oVT17jCplkZz8BJg55UaVngzHvsAAEPQstBW6MheJFnXs3hUYw2PVnnRgheBggsc8NK3TAAAAABJRU5ErkJggg==",Uge=Object.defineProperty,$ge=u((n,e)=>Uge(n,"name",{value:e,configurable:!0}),"__name$D");const zE=new P,Gi=new P,Od=new P,yg=new Xa,BE=new be;class gA extends Kn{constructor(){super(...arguments);A(this,"label","Paint");A(this,"icon",Bge);A(this,"tips","Press [P] to pick color");A(this,"sculpt",!0);A(this,"brushRadius",25);A(this,"brushStrength",1);A(this,"hasHardness",!0);A(this,"hasColor",!0);A(this,"frontFacesOnly",!0);A(this,"optionsProps",["brushRadius","brushStrength","brushHardness","frontFacesOnly"])}update(t,s){if(!t.sculptNodeId)return;const i=s.input;if(i.pointerOver&&i.isKeyPressed("p")){const f=t.model.getNode(t.sculptNodeId),g=f.get(Pe).mesh;BE.copy(f.getWorldMatrix()).invert(),yg.origin.copy(s.mouseRay0),yg.direction.copy(s.mouseRayN),yg.applyMatrix4(BE);const m=g.raycast(yg,!0)[0];if(m){const v=m.triangleIndex;Gi.set(0,0,0),Gi.add(Od.fromArray(g.aColor,v*9)),Gi.add(Od.fromArray(g.aColor,v*9+3)),Gi.add(Od.fromArray(g.aColor,v*9+6)),Gi.divideScalar(3),t.options.paintColor=[Gi.x,Gi.y,Gi.z]}return}if(t=t.readonlyRef(),!t.sculptMoved||s.index!==t.sculptActiveView||!i.mouseLeft)return;const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh,l=t.options.enablePressure?1:i.pressure,c=this.brushStrength*l,h=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly),d=new Float32Array(h.position);for(let f=0,p=h.indices.length;f<p;++f){const g=h.indices[f];for(let m=0;m<3;++m)d[f*3+m]=a.aColor[g*3+m]}Od.set(t.options.paintColor[0],t.options.paintColor[1],t.options.paintColor[2]);for(let f of h.track)this.stroke(f.indices,c,f.center,t.sculptLocalRadius,h.offset,h.position,d),t.sculptSym&&this.stroke(f.indicesSym,c,f.centerSym,t.sculptLocalRadius,h.offset,h.position,d);t.history.updateVertices(r,Mr,h.indices,d)}stroke(t,s,i,r,o,a,l){for(let c of t)this.strokeVertex(i,r,s,a,l,o.get(c))}strokeVertex(t,s,i,r,o,a){zE.fromArray(r,a);const l=zE.distanceTo(t)/s;if(l>=1)return;const h=Math.pow(1-l,2*(1-this.brushHardness))*i;Gi.fromArray(o,a).lerp(Od,h),o[a]=Gi.x,o[a+1]=Gi.y,o[a+2]=Gi.z}}u(gA,"SculptPaintTool");$ge(gA,"SculptPaintTool");var Vge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIJJREFUSIntVUEOwCAIk2X//zI7kbiFxpbhzZ4US2tEcYyDBUxNcHd/CZjJGrR4xAItwplgjGWT1c4yYdqEISLOHL8RISvenFguLrOrmLNcepG9LZDDFqhsolyz0hFVHgt6E20GyGiLSYarQ6TUIraJK4m/jxMVTmnPVD/5irV+MgcPCvzbPZirI9cAAAAASUVORK5CYII=",Gge=Object.defineProperty,Hge=u((n,e)=>Gge(n,"name",{value:e,configurable:!0}),"__name$C");const Jy=new P,_g=new P;class vA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Pinch");A(this,"icon",Vge);A(this,"sculpt",!0);A(this,"hasDirection",!0);A(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,s){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView)return;const i=s.input;if(!i.mouseLeft)return;if(i.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,s);const r=t.model.getNode(t.sculptNodeId),a=r.get(Pe).mesh,l=t.options.enablePressure?1:i.pressure,c=this.brushStrength*this.brushDirection*l*.1,h=this.sculptPickStrokeVertices(t,r,s,a,this.frontFacesOnly);for(let d of h.track)this.stroke(d.indices,c,d.center,t.sculptLocalRadius,h.offset,h.position),t.sculptSym&&this.stroke(d.indicesSym,c,d.centerSym,t.sculptLocalRadius,h.offset,h.position);t.history.updateVertices(r,Mn,h.indices,h.position)}stroke(t,s,i,r,o,a){for(let l of t)this.strokeVertex(i,r,s,a,o.get(l))}strokeVertex(t,s,i,r,o){Jy.fromArray(r,o);const a=Jy.distanceTo(t)/s;if(a>=1)return;_g.subVectors(t,Jy);const l=this.sculptFalloff(a)*i;r[o]+=_g.x*l,r[o+1]+=_g.y*l,r[o+2]+=_g.z*l}}u(vA,"SculptPinchTool");Hge(vA,"SculptPinchTool");var Wge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHxJREFUSIntVMsOgDAIG8b//2W8zGRBgcrD03pcoAVWGGNDgJn5V5GjW+xEgmTbRESogBl4E0tC+R4q4MtnrbE80Ubu5mfJwwLWGNLkGvGao83+4Q7PAVoR5c5BUbbJcHGRLqyc9lv0iugulIukTaF5G7o3E9DZzZzrDRcXkCuzdkeSNcIAAAAASUVORK5CYII=",jge=Object.defineProperty,Xge=u((n,e)=>jge(n,"name",{value:e,configurable:!0}),"__name$B");const su=new P,kd=new P,e_=new Set;class yA extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Smooth (Shift)");A(this,"icon",Wge);A(this,"sculpt",!0);A(this,"brushStrength",1);A(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,s){t=t.readonlyRef(),!(!t.sculptMoved||!t.sculptNodeId||s.index!==t.sculptActiveView||!s.input.mouseLeft)&&this.doStroke(t,s)}doStroke(t,s){const i=t.model.getNode(t.sculptNodeId),o=i.get(Pe).mesh,a=this.sculptPickStrokeVertices(t,i,s,o,this.frontFacesOnly),l=t.options.enablePressure?1:s.input.pressure;for(let c of a.track)this.stroke(o,c.indices,this.brushStrength*l,c.center,t.sculptLocalRadius,a.offset,a.position),t.sculptSym&&this.stroke(o,c.indicesSym,this.brushStrength*l,c.centerSym,t.sculptLocalRadius,a.offset,a.position);t.history.updateVertices(i,Mn,a.indices,a.position)}stroke(t,s,i,r,o,a,l){for(let c of s)this.strokeVertex(t,c,r,o,i,l,a.get(c))}strokeVertex(t,s,i,r,o,a,l){su.fromArray(a,l);const c=su.distanceTo(i)/r;if(c>=1)return;let h=t.getVertexTriangleIndex(t.edgeNeighborMap[s]);const d=h;let f=0,p=0,g=0,m=0,v=50;e_.clear();do{e_.add(h);for(let _=0;_<3;++_){const w=t.sharedVertexMap[h*3+_];if(w!==s){t.getVertex(kd,w);const x=kd.distanceTo(su);f+=kd.x*x,p+=kd.y*x,g+=kd.z*x,m+=x}}const b=h;for(let _=0;_<3;++_){const w=h*3+_;if(t.holes[w])continue;const x=t.getVertexTriangleIndex(t.edgeNeighborMap[w]);if(h===x||e_.has(x))continue;let S=!1;for(let C=0;C<3;++C)if(t.sharedVertexMap[x*3+C]===s){S=!0;break}if(S){h=x;break}}if(b===h)break;if(v--<=0){console.warn("Loop limit reached");break}}while(d!==h);if(m=1/m,!isFinite(m))return;f*=m,p*=m,g*=m;const y=this.sculptFalloff(c)*o;a[l]+=(f-su.x)*y,a[l+1]+=(p-su.y)*y,a[l+2]+=(g-su.z)*y}}u(yA,"SculptSmoothTool");Xge(yA,"SculptSmoothTool");var Yge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAH1JREFUSIntlEEWwDAEROnr/a+sq2xSw6jaZZbCJ0FEjqZlZhad619wVXVZVIK9SgQrJ1hgBGRukMKRfT9H9gtBvIqyhnp+rwQILsI/Q+jHVrl8l+gAFs7q7gSXp+jLDUoxnSca7UMU4+7BuKqjOpakPdZoiSrLNf5dH6V6APeKi6uPxERhAAAAAElFTkSuQmCC",qge=Object.defineProperty,Kge=u((n,e)=>qge(n,"name",{value:e,configurable:!0}),"__name$A");const iu=new be,UE=new P,$E=new qe,VE=new P;class _A extends Kn{constructor(){super(...arguments);A(this,"label","Sculpt Transform");A(this,"icon",Yge);A(this,"node",null);A(this,"invMat",new be)}begin(t){this.node=null;for(let s of t.model.getSelectedNodes())if(s.type==="Clay"&&!s.instanceId){this.node=s;break}if(!this.node){for(let s of t.views)s.gizmoEnabled=!1,s.gizmo.visible=!1,s.gizmo.dragging=!1;return}}update(t,s){if(this.node&&(s.gizmoEnabled=!0,s.gizmo.visible=!0,s.gizmo.orientation=t.options.useLocalSpaceForTransformControl?"local":"world",s.gizmo.enableTranslate=!0,s.gizmo.enableRotate=!0,s.gizmo.enableScale=!0,s.gizmo.dragging||(s.gizmo.setTargetTransformFromMatrix(this.node.getWorldMatrix()),this.invMat.copy(this.node.getParentWorldMatrix()).invert()),s.gizmo.update(s.camera,s.raycaster,s.input,s.mouseRay0,s.mouseRay1,s.mouseRayN),s.gizmo.dragging)){iu.compose(s.gizmo.position1,s.gizmo.rotation1,s.gizmo.scale1),iu.multiplyMatrices(this.invMat,iu),iu.decompose(UE,$E,VE);const r=this.node;t.history.setValue(r,ze,new P().copy(UE)),t.history.setValue(r,nt,new ft().setFromQuaternion($E)),t.model.setValue(r,Sr,new P().copy(VE)),t.throttle(`#${r.id}-apply-transform`,100,()=>{if(r.deleted)return;iu.copy(r.getLocalMatrix());const o=r.cloneValue(Mn),a=new P;for(let l=0,c=o.length;l<c;l+=3)a.fromArray(o,l),a.applyMatrix4(iu),o[l]=a.x,o[l+1]=a.y,o[l+2]=a.z;t.history.setValue(r,Mn,o),t.history.setValue(r,ze,new P),t.history.setValue(r,nt,new ft),t.history.setValue(r,Wt,1),t.nextFrameEnd(()=>{r.deleted||t.model.setValue(r,Sr,new P(1,1,1))})});return}const i=s.input;if(i.pointerOver&&i.mouseLeftDownThisFrame)for(let r of s.mousePick()){const o=r.object.userData.node;if(o&&!o.instanceId&&o.type==="Clay"){t.model.selected=[o.id];break}}}onUnselected(t){for(let s of t.views)s.gizmoEnabled=!1,s.gizmo.visible=!1,s.gizmo.dragging=!1;this.node=null}}u(_A,"SculptTransformTool");Kge(_A,"SculptTransformTool");var Zge=Object.defineProperty,Qge=u((n,e)=>Zge(n,"name",{value:e,configurable:!0}),"__name$z");const OA=class extends Kn{constructor(){super(...arguments);A(this,"icon","");A(this,"label","");A(this,"sep",!0)}};let Lo=OA;u(Lo,"ToolSeperator"),A(Lo,"instance",new OA);Qge(Lo,"ToolSeperator");var Jge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGRJREFUSIntlMESABAIROX//znXGKJajBl7JG8LldLXbZG2ycxcBROp8Sa18NEaDA4zWQFYTHIoG49Ws3NfleXgdpPQgx8zQf8qFwDSgLNq3uhyCdo6q0bAnkF4/EoodJx/wVQASvh7kexwAhUAAAAASUVORK5CYII=",e0e=Object.defineProperty,t0e=u((n,e)=>e0e(n,"name",{value:e,configurable:!0}),"__name$y");const Si=new P,GE=new P,bo=new P,HE=new qe,WE=new P(1,0,0),wo=new be,jE=.003,XE=.003,YE=5,t_=.05;class bA extends Kn{constructor(){super(...arguments);A(this,"label","Tube");A(this,"icon",Jge);A(this,"tips","Hold [Alt] to create/insert a tube node. Resize tube node with mouse wheel.");A(this,"enableDefaultDeleteShortcut",!1);A(this,"enableSelectionRect",!0);A(this,"enableDefaultSelectionBehavior",!1);A(this,"nodes",[]);A(this,"enableDeleteThisFrame",!0);A(this,"dragging",!1);A(this,"draggingActiveViewIndex",-1);A(this,"mouse0",new P);A(this,"circle",new Zi(new D1,new Bs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16711935})));A(this,"line1",new Zi(new at().setFromPoints([new P(0,0,0),new P(1,0,0)]),this.circle.material.clone()));A(this,"line2",new Zi(this.line1.geometry.clone(),this.line1.material.clone()));A(this,"creating",!1);A(this,"radius",.1);A(this,"lastNodeId",0)}setup(t){this.circle.visible=!1,t.scene.add(this.circle),this.line1.visible=!1,t.scene.add(this.line1),this.line2.visible=!1,t.scene.add(this.line2)}begin(t){t=t.readonlyRef();for(let s of this.nodes){if(s.deleted)continue;const i=s.get(vt);i.group&&(i.group.visible=!1),t.model.selected.includes(s.id)?i.selected=i.selected.filter(r=>r<i.value.length):i.selected.length=0}this.enableDefaultDeleteShortcut=!0,this.enableDeleteThisFrame=!0,this.nodes=t.model.getSelectedNodes().filter(s=>s.has(vt)&&!s.instanceId);for(let s of this.nodes){const i=s.get(vt);i.group&&(i.group.visible=!0),i.hovered=-1,i.selected.length&&(this.enableDefaultDeleteShortcut=!1),s.id===this.lastNodeId&&i.value.length&&(i.selected=[0],this.lastNodeId=0)}this.enableSelectionRect=!0,this.creating||(this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1,this.lastNodeId=0)}update(t,s){const i=s.input;if(i.isKeyPressed("Delete")&&this.enableDeleteThisFrame){this.enableDeleteThisFrame=!1;for(let r of this.nodes){const o=r.get(vt);if(o.selected.length){const a=o.clone().filter((l,c)=>!o.selected.includes(c));o.selected.length=0,a.length===0?t.history.removeNode(r.id):t.history.setValue(r,vt,a)}}return}if(this.dragging&&s.index===this.draggingActiveViewIndex)if(this.enableSelectionRect=!1,i.mouseLeft){if(Qt(GE,s.mouseRay0,s.mouseRay1,this.mouse0,s.mouseRayN)){bo.subVectors(GE,this.mouse0);let r=!0;for(let o of this.nodes){const a=o.get(vt);if(a.draggingStartNodeIndex>=0){r=a.selected.includes(a.draggingStartNodeIndex);break}}for(let o of this.nodes){const a=o.get(vt);if(a.selected.length||a.draggingStartNodeIndex>=0){const l=a.clone(a.draggingStartValue);if(r)for(let c of a.selected)l[c].position.applyMatrix4(a.draggingStartMatrix).add(bo).applyMatrix4(a.draggingStartInvMatrix),i.isKeyPressed("Shift")&&Eu(l[c].position,t_);a.draggingStartNodeIndex>=0&&!r&&(l[a.draggingStartNodeIndex].position.applyMatrix4(a.draggingStartMatrix).add(bo).applyMatrix4(a.draggingStartInvMatrix),i.isKeyPressed("Shift")&&Eu(l[a.draggingStartNodeIndex].position,t_)),t.history.setValue(o,vt,l)}}if(!r)for(let o of this.nodes){const a=o.get(vt);a.draggingStartNodeIndex>=0?a.selected=[a.draggingStartNodeIndex]:a.selected=[]}}}else{this.dragging=!1,this.draggingActiveViewIndex=-1;for(let r of this.nodes){const o=r.get(vt);o.draggingStartNodeIndex=-1}}if(i.pointerOver&&!(this.dragging||this.creating)){let r=!1;for(let o of this.nodes){const a=o.get(vt),l=s.raycaster.intersectObjects(a.pickers);if(l.length){const c=l[0].object.userData.index;if(a.hovered=c==null?-1:c,i.mouseLeftDownThisFrame)this.dragging=!0,this.draggingActiveViewIndex=s.index,this.mouse0.copy(l[0].point),a.draggingStartNodeIndex=a.hovered;else if(i.wheelDetY)for(let h of l){const d=h.object.userData.index;if(d!=null&&a.selected.includes(d)){r=!0;break}}}else a.hovered=-1}if(this.dragging&&s.index===this.draggingActiveViewIndex)for(let o of this.nodes){const a=o.get(vt);(a.selected.length||a.draggingStartNodeIndex>=0)&&(a.draggingStartMatrix=new be().copy(o.getWorldMatrix()),a.draggingStartInvMatrix=new be().copy(o.getWorldMatrix()).invert(),a.draggingStartValue=a.clone())}if(r){t.disableCameraDraggingThisFrame=!0;for(let o of this.nodes){const a=o.get(vt);if(a.selected.length){const l=a.clone();for(let c of a.selected)l[c].radius=Math.max(jE,Math.min(YE,l[c].radius-i.wheelDetY*XE));t.history.setValue(o,vt,l)}}}if(!this.dragging&&!this.creating&&i.isKeyPressed("Alt")){this.creating=!0;for(let o of this.nodes){const a=o.get(vt);if(a.selected.length){this.radius=a.value[a.selected[0]].radius,this.radius*=Ia(o.getWorldMatrix());break}}}}if(this.creating)if(i.isKeyPressed("Alt")){if(this.enableSelectionRect=!1,i.pointerOver){let r=null,o=null,a=-1;for(let l of this.nodes){const c=l.get(vt);if(c.selected.length){r=l,o=c,a=c.selected[0];break}}if(r)Si.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix());else for(let l of t.readonlyRef().model.getSelectedNodes())if(l.isValidChild("Tube")){Si.setFromMatrixPosition(l.getWorldMatrix());break}if(Qt(this.circle.position,s.mouseRay0,s.mouseRay1,Si,s.mouseRayN),i.isKeyPressed("Shift")&&Eu(this.circle.position,t_),i.wheelDetY&&(this.radius=Math.min(YE,Math.max(jE,-i.wheelDetY*XE+this.radius)),t.disableCameraDraggingThisFrame=!0),this.circle.scale.setScalar(this.radius),this.circle.visible=!0,this.line1.visible=!1,this.line2.visible=!1,r&&(this.line1.position.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix()),bo.subVectors(this.circle.position,this.line1.position),this.line1.scale.setScalar(bo.length()),this.line1.quaternion.setFromUnitVectors(WE,bo.normalize()),this.line1.visible=!0,a<o.value.length-1&&(this.line2.position.copy(o.value[a+1].position).applyMatrix4(r.getWorldMatrix()),bo.subVectors(this.circle.position,this.line2.position),this.line2.scale.setScalar(bo.length()),this.line2.quaternion.setFromUnitVectors(WE,bo.normalize()),this.line2.visible=!0,o.lines[a].visible=!1,t.nextFrameEnd(()=>{const l=o==null?void 0:o.lines[a];l&&(l.visible=!0)}))),i.mouseLeftDownThisFrame){Si.copy(this.circle.position);let l=this.radius;if(!r&&this.nodes.length&&this.nodes[0].value(vt).length===0&&(r=this.nodes[0]),r){wo.copy(r.getWorldMatrix()).invert(),Si.applyMatrix4(wo),l*=Ia(wo);let c;o?(c=o.clone(),c.splice(a+1,0,{position:new P().copy(Si),radius:l}),o.selected=[a+1]):(c=[{position:new P().copy(Si),radius:l}],this.lastNodeId=r.id),t.history.setValue(r,vt,c)}else{let c=null;if(this.nodes.length)c=this.nodes[0].parent;else for(let d of t.model.getSelectedNodes())if(d.isValidChild("Tube")){c=d;break}if(!c){for(let d of t.model.getSelectedNodes())if(d.isValidChild("Shape")){c=d;break}c&&(wo.copy(c.getWorldMatrix()).invert(),Si.applyMatrix4(wo),l*=Ia(wo)),t.model.selected=[],this.lastNodeId=t.history.createNode({type:"Shape",parentId:c?c.id:0,data:{},children:[{type:"Tube",data:{[vt.name]:[{radius:l,position:new P().copy(Si)}]}}]})+1}else c&&(wo.copy(c.getWorldMatrix()).invert(),Si.applyMatrix4(wo),l*=Ia(wo)),t.model.selected=[],this.lastNodeId=t.history.createNode({type:"Tube",parentId:c?c.id:0,data:{[vt.name]:[{radius:l,position:new P().copy(Si)}]}})}this.creating=!1}}}else this.creating=!1;if(t.selectionRectSetThisFrame&&t.selectionRectViewIndex===s.index)if(t.selectionStart.equals(t.selectionEnd)){let r=!1;for(let o of this.nodes){const a=o.get(vt);a.selected.length&&(r=!0),a.selected.includes(a.hovered)?i.isKeyPressed("Control")&&(a.selected=a.selected.filter(l=>l!==a.hovered),r=!0):(i.isKeyPressed("Control")||(a.selected.length=0),a.hovered>=0&&(a.addSelection(a.hovered),r=!0))}if(!r){const o=s.mousePick("Shape");let a=null;for(let l of o){const c=o[0].object.userData.node;if(c){a=c;break}}a?t.model.selected=a.children.map(l=>l.id):t.model.selected=[]}}else{const r=s.camera.get();for(let o of this.nodes){const a=o.get(vt);i.isKeyPressed("Control")||(a.selected.length=0);for(let l of a.pickers)if(Si.setFromMatrixPosition(l.matrixWorld).project(r),LR(Si,t.selectionStart,t.selectionEnd)){const c=l.userData.index;c!=null&&a.addSelection(c)}}}}end(t){for(let s of this.nodes)s.get(vt).updateColor()}beforeRender(t,s){for(let i of this.nodes){const r=i.get(vt);IR(HE,i.getWorldMatrix()).invert();for(let o of r.circles)o.quaternion.copy(HE).multiply(s.camera.get().quaternion)}this.circle.visible&&this.circle.quaternion.copy(s.camera.get().quaternion)}onUnselected(t){this.dragging=!1,this.creating=!1,this.lastNodeId=0,this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1;for(let s of this.nodes){if(s.deleted)continue;const i=s.get(vt);i.group&&(i.group.visible=!1),i.selected.length=0}this.nodes.length=0}}u(bA,"TubeTool");t0e(bA,"TubeTool");var n0e=Object.defineProperty,s0e=u((n,e)=>n0e(n,"name",{value:e,configurable:!0}),"__name$x");class wA extends rp{constructor(){super(...arguments);A(this,"overrideMaterial",new bs({vertexShader:`
            varying float vDepth;

            void main() {
                vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
                gl_Position = projectionMatrix * modelViewPosition;
                vDepth = gl_Position.z;
            }
        `,fragmentShader:`
            varying float vDepth;
            uniform float uOffset;
            uniform float uScale;

            void main() {
                gl_FragColor = vec4(mix(vec3(1.0, 1.0, 1.0), vec3(0.0, 0.0, 0.0), (vDepth + uOffset) * uScale), 1.0);
            }
        `,uniforms:{uOffset:{value:0},uScale:{value:.1}}}));A(this,"offset",0);A(this,"scale",.1);A(this,"clearColor",new De(0,0,0));A(this,"visibleMap",new Map)}dispose(){var t;super.dispose(),(t=this.overrideMaterial)==null||t.dispose()}render(t,s){const i=this.visibleMap;i.clear();const r=[...this.scene.children];for(;r.length;){const a=r.pop();if(!a)break;if(a.visible){const l=a.userData.node;a.isMesh?l&&kn(l.type).mesh||(a.visible=!1):(a.isPoints||a.isLine)&&(a.visible=!1),a.visible?r.push(...a.children):i.set(a.id,!0)}}const o=this.scene.overrideMaterial;for(this.scene.overrideMaterial=this.overrideMaterial,this.renderToScreen?t.setRenderTarget(null):t.setRenderTarget(s),this.overrideMaterial.uniforms.uOffset.value=this.offset,this.overrideMaterial.uniforms.uScale.value=this.scale,t.setClearColor(this.clearColor,1),t.clear(),t.render(this.scene,this.camera),this.scene.overrideMaterial=o,r.push(...this.scene.children);r.length;){const a=r.pop();if(!a)break;i.has(a.id)&&(a.visible=!0),a.visible&&r.push(...a.children)}}}u(wA,"DepthMapPass");s0e(wA,"DepthMapPass");var i0e=Object.defineProperty,r0e=u((n,e)=>i0e(n,"name",{value:e,configurable:!0}),"__name$w");class xA extends rp{constructor(){super(...arguments);A(this,"edgeMaterial",new bs({vertexShader:`
            varying vec2 vUv;

            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            varying vec2 vUv;

            uniform sampler2D uTexNormal;
            uniform sampler2D uTexDepth;
            uniform vec4 uResolution;
            uniform float uNormalThreshold;
            uniform float uDepthThreshold;

            vec3 getNormal(int x, int y) {
                return texture2D(uTexNormal, vUv + vec2(x, y) * uResolution.zw).rgb * 2.0 - 1.0;
            }

            float getDepth(int x, int y) {
                return texture2D(uTexDepth, vUv + vec2(x, y) * uResolution.zw).r;
            }

            float neighborNormalEdgeIndicator(int x, int y, vec3 normal) {
                vec3 neighborNormal = getNormal(x, y);
                vec3 normalEdgeBias = vec3(1.0, 1.0, 1.0);
                float normalDiff = dot(normal - neighborNormal, normalEdgeBias);
                float normalIndicator = clamp(normalDiff, 0.0, 1.0);
                return (1.0 - dot(normal, neighborNormal)) * normalIndicator;
            }

            float depthEdgeIndicator(float depth) {
                float diff = 0.0;

                diff += abs(getDepth(1, 0) - depth);
                diff += abs(getDepth(-1, 0) - depth);
                diff += abs(getDepth(0, 1) - depth);
                diff += abs(getDepth(0, -1) - depth);

                diff += abs(getDepth(1, 1) - depth);
                diff += abs(getDepth(-1, -1) - depth);
                diff += abs(getDepth(-1, 1) - depth);
                diff += abs(getDepth(1, -1) - depth);

                diff += abs(getDepth(2, 0) - depth);
                diff += abs(getDepth(-2, 0) - depth);
                diff += abs(getDepth(0, 2) - depth);
                diff += abs(getDepth(0, -2) - depth);

                return diff * 4.0 > uDepthThreshold ? 1.0 : 0.0;
            }

            float normalEdgeIndicator(vec3 normal) {
                float indicator = 0.0;

                indicator += neighborNormalEdgeIndicator(0, -1, normal);
                indicator += neighborNormalEdgeIndicator(0, 1, normal);
                indicator += neighborNormalEdgeIndicator(-1, 0, normal);
                indicator += neighborNormalEdgeIndicator(1, 0, normal);

                indicator += neighborNormalEdgeIndicator(-1, -1, normal);
                indicator += neighborNormalEdgeIndicator(1, 1, normal);
                indicator += neighborNormalEdgeIndicator(-1, 1, normal);
                indicator += neighborNormalEdgeIndicator(1, -1, normal);

                indicator += neighborNormalEdgeIndicator(0, -2, normal);
                indicator += neighborNormalEdgeIndicator(0, 2, normal);
                indicator += neighborNormalEdgeIndicator(-2, 0, normal);
                indicator += neighborNormalEdgeIndicator(2, 0, normal);

                return indicator * 0.5 > uNormalThreshold ? 1.0 : 0.0;
            }

            void main() {
                float ni = normalEdgeIndicator(getNormal(0, 0));
                float di = depthEdgeIndicator(getDepth(0, 0));
                gl_FragColor.rgb = vec3(1.0, 1.0, 1.0) * (ni + di);
                gl_FragColor.a = 1.0;
            }
        `,uniforms:{uTexNormal:{value:null},uTexDepth:{value:null},uResolution:{value:new Ft},uNormalThreshold:{value:0},uDepthThreshold:{value:0}}}));A(this,"normalMaterial",new oR);A(this,"normalRenderTarget",new ys(1,1,{depthBuffer:!0,depthTexture:new Ub(1,1)}));A(this,"fsQuad",new ip(this.edgeMaterial));A(this,"visibleMap",new Map);A(this,"normalThreshold",.5);A(this,"depthThreshold",.1)}dispose(){this.normalMaterial.dispose(),this.normalRenderTarget.dispose(),this.edgeMaterial.dispose(),this.fsQuad.dispose()}setSize(t,s){this.normalRenderTarget.setSize(t,s),this.edgeMaterial.uniforms.uResolution.value.set(t,s,1/t,1/s)}render(t,s){const i=this.visibleMap;i.clear();const r=[...this.scene.children];for(;r.length;){const a=r.pop();if(!a)break;if(a.visible){const l=a.userData.node;a.isMesh?l&&kn(l.type).mesh||(a.visible=!1):(a.isPoints||a.isLine)&&(a.visible=!1),l&&l.has(oc)&&!l.value(oc)&&(a.visible=!1),a.visible?r.push(...a.children):i.set(a.id,!0)}}const o=this.scene.overrideMaterial;for(this.scene.overrideMaterial=this.normalMaterial,t.setRenderTarget(this.normalRenderTarget),t.render(this.scene,this.camera),this.scene.overrideMaterial=o,r.push(...this.scene.children);r.length;){const a=r.pop();if(!a)break;i.has(a.id)&&(a.visible=!0),a.visible&&r.push(...a.children)}this.edgeMaterial.uniforms.uTexNormal.value=this.normalRenderTarget.texture,this.edgeMaterial.uniforms.uTexDepth.value=this.normalRenderTarget.depthTexture,this.edgeMaterial.uniforms.uNormalThreshold.value=this.normalThreshold,this.edgeMaterial.uniforms.uDepthThreshold.value=this.depthThreshold,this.renderToScreen?t.setRenderTarget(null):t.setRenderTarget(s),this.fsQuad.render(t)}}u(xA,"EdgeDetectPass");r0e(xA,"EdgeDetectPass");var o0e=Object.defineProperty,a0e=u((n,e)=>o0e(n,"name",{value:e,configurable:!0}),"__name$v");class AA extends rp{constructor(){super(...arguments);A(this,"canvas",document.createElement("canvas"));A(this,"ctx2d",this.canvas.getContext("2d"));A(this,"texture",new rR(this.canvas));A(this,"material",new Fs({map:this.texture,transparent:!0,depthTest:!1,depthWrite:!1}));A(this,"fsQuad",new ip(this.material))}setSize(t,s){(this.canvas.width!==t||this.canvas.height!==s)&&(this.canvas.width=t,this.canvas.height=s,this.texture.dispose())}render(t,s,i){this.ctx2d.clearRect(0,0,this.canvas.width,this.canvas.height),$x(this.ctx2d,this.scene,this.camera),this.texture.needsUpdate=!0,this.renderToScreen?t.setRenderTarget(null):t.setRenderTarget(s),t.autoClear=!1,this.material.map=i.texture,this.fsQuad.render(t),this.material.map=this.texture,this.fsQuad.render(t),t.autoClear=!0}}u(AA,"OpenPosePass");a0e(AA,"OpenPosePass");var l0e=Object.defineProperty,c0e=u((n,e)=>l0e(n,"name",{value:e,configurable:!0}),"__name$u");const n_=new ep,ru=new P,ou=new P,ur=new P,xo=new P,kr=new P,Ao=new P,Mo=new P,Nd=new P,Fd=new P,zd=new P,bg=new P,Bd=new P,Ud=new P,$d=new P,qE=new be,u0e=new qe,h0e=new P;class MA{constructor(){A(this,"dom");A(this,"parent");A(this,"x0",0);A(this,"y0",0);A(this,"x1",0);A(this,"y1",0);const e=this.dom=document.createElement("div");e.style.pointerEvents="none",e.style.position="absolute",e.style.zIndex="20",e.style.border="dashed 1px #fff",e.style.background="rgba(255, 255, 255, .1)",e.style.boxSizing="border-box"}attach(e){this.parent=e,e.appendChild(this.dom)}detach(){this.parent=void 0,this.dom.remove()}show(){this.dom.style.display="block"}hide(){this.dom.style.display="none"}setPoint1(e,t){this.x0=e,this.y0=t}setPoint2(e,t){if(this.x1=e,this.y1=t,!this.parent)return;const s=(this.x0+1)/2,i=(this.x1+1)/2,r=(this.y0+1)/2,o=(this.y1+1)/2,a=this.parent.getBoundingClientRect(),l=Math.round(a.width*Math.max(Math.min(s,i),0)),c=Math.round(a.width*Math.min(1-Math.max(s,i),1)),h=Math.round(a.height*Math.max(1-Math.max(r,o),0)),d=Math.round(a.height*Math.min(r,o,1));this.dom.style.left=`${l}px`,this.dom.style.right=`${c}px`,this.dom.style.top=`${h}px`,this.dom.style.bottom=`${d}px`,s!==i||r!==o?this.show():this.hide()}select(e,t){let s=this.x0,i=this.y0,r=this.x1,o=this.y1;s===r&&(r+=Number.EPSILON),i===o&&(o+=Number.EPSILON);const a=0,l=1,c=Number.MAX_VALUE;if(e.updateProjectionMatrix(),e.updateMatrixWorld(),e.isPerspectiveCamera){ou.set(s,i,a),ou.x=Math.min(s,r),ou.y=Math.max(i,o),r=Math.max(s,r),o=Math.min(i,o),ur.setFromMatrixPosition(e.matrixWorld),xo.copy(ou),kr.set(r,ou.y,0),Ao.set(r,o,l),Mo.set(ou.x,o,0),xo.unproject(e),kr.unproject(e),Ao.unproject(e),Mo.unproject(e),Bd.copy(xo).sub(ur),Ud.copy(kr).sub(ur),$d.copy(Ao).sub(ur),Bd.normalize(),Ud.normalize(),$d.normalize(),Bd.multiplyScalar(c),Ud.multiplyScalar(c),$d.multiplyScalar(c),Bd.add(ur),Ud.add(ur),$d.add(ur);const f=n_.planes;f[0].setFromCoplanarPoints(ur,xo,kr),f[1].setFromCoplanarPoints(ur,kr,Ao),f[2].setFromCoplanarPoints(Ao,Mo,ur),f[3].setFromCoplanarPoints(Mo,xo,ur),f[4].setFromCoplanarPoints(kr,Ao,Mo),f[5].setFromCoplanarPoints($d,Ud,Bd),f[5].normal.multiplyScalar(-1)}else if(e.isOrthographicCamera){const f=Math.min(s,r),p=Math.max(i,o),g=Math.max(s,r),m=Math.min(i,o);xo.set(f,p,-1),kr.set(g,p,-1),Ao.set(g,m,-1),Mo.set(f,m,-1),Nd.set(f,p,1),Fd.set(g,p,1),zd.set(g,m,1),bg.set(f,m,1),xo.unproject(e),kr.unproject(e),Ao.unproject(e),Mo.unproject(e),Nd.unproject(e),Fd.unproject(e),zd.unproject(e),bg.unproject(e);const v=n_.planes;v[0].setFromCoplanarPoints(xo,Nd,Fd),v[1].setFromCoplanarPoints(kr,Fd,zd),v[2].setFromCoplanarPoints(zd,bg,Mo),v[3].setFromCoplanarPoints(bg,Nd,xo),v[4].setFromCoplanarPoints(kr,Ao,Mo),v[5].setFromCoplanarPoints(zd,Fd,Nd),v[5].normal.multiplyScalar(-1)}const h=[],d={};for(let f of t)this.searchChildInFrustum(h,d,n_,f);return h}searchChildInFrustum(e,t,s,i){if(i.isMesh||i.isLine||i.isPoints)if(i.isInstancedMesh){const r=i;t[r.uuid]=[];for(let o=0;o<r.count;o++)r.getMatrixAt(o,qE),qE.decompose(ru,u0e,h0e),ru.applyMatrix4(r.matrixWorld),s.containsPoint(ru)&&t[r.uuid].push(o)}else{const r=i;r.geometry.boundingSphere===null&&r.geometry.computeBoundingSphere(),ru.copy(r.geometry.boundingSphere.center),ru.applyMatrix4(i.matrixWorld),s.containsPoint(ru)&&e.push(i)}if(i.children.length>0)for(let r=0;r<i.children.length;r++)this.searchChildInFrustum(e,t,s,i.children[r])}}u(MA,"SelectionRect");c0e(MA,"SelectionRect");var d0e=Object.defineProperty,f0e=u((n,e)=>d0e(n,"name",{value:e,configurable:!0}),"__name$t");class wp{constructor(e,t,s,i,r){A(this,"systems",[new qw,new zx([new Sx,new Ex,new lx,new Mx,new Jw,new Ox,new Fx,new ix,new Px,new rx,new ox,new Lx,new Rx,new Nx,new kx,new Cx,new Tx,new Dx]),new Bx,new Gx,new Kw,new Zw,new Qw,new Ux,new Vx,new Ew,new Cw]);A(this,"sculptSmoothTool",new yA);A(this,"tools",[new bp,new Zx,Lo.instance,new cA,new lA,Lo.instance,new Qx,new Jx,Lo.instance,new _p,new bA,Lo.instance,new uA,new pA,new hA,new vA,new fA,new mA,new dA,this.sculptSmoothTool,new _A,new gA]);A(this,"canvas");A(this,"renderer");A(this,"defaultComposer");A(this,"renderPass");A(this,"outlinePass");A(this,"openPosePass");A(this,"depthMapComposer");A(this,"depthMapPass");A(this,"edgeComposer");A(this,"edgeDetectPass");A(this,"depthMapOutput");A(this,"edgeOutput");A(this,"poseOutput");A(this,"scene",new If);A(this,"views");A(this,"mainViewIndex");A(this,"disableCameraDraggingThisFrame",!1);A(this,"model",new ap);A(this,"history",new Sw(this.model));A(this,"fps",0);A(this,"detSec",0);A(this,"lastTimestamp",0);A(this,"statusBarMessage","");A(this,"tool",this.tools[0]);A(this,"nextFrameCallbacks",[]);A(this,"throttleTasks",new Map);A(this,"selectionRect",new MA);A(this,"selectionRectDragging",!1);A(this,"selectionRectViewIndex",-1);A(this,"selectionRectSetThisFrame",!1);A(this,"selectionStart",new $e);A(this,"selectionEnd",new $e);A(this,"sculptNodeId",0);A(this,"sculptActiveView",-1);A(this,"sculptSym",!1);A(this,"sculptLocalRadius",0);A(this,"sculptMoved",!1);A(this,"sculptStartThisFrame",!1);A(this,"sculptAccWalkedPixels",0);A(this,"sculptX0",0);A(this,"sculptY0",0);A(this,"sculptX1",0);A(this,"sculptY1",0);A(this,"options",new Jb);this.history.setup(),this.canvas=e,this.renderer=new JP({canvas:e}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=EP,this.mainViewIndex=1,this.views=[new vu(this,0,t,-Math.PI/2,-Math.PI/2,!1),new vu(this,1,s,-Math.PI/8,-Math.PI/4,!0),new vu(this,2,i,0,-Math.PI/2,!1),new vu(this,3,r,0,0,!1)],this.defaultComposer=new kg(this.renderer),this.renderPass=new rp(this.scene,this.views[this.mainViewIndex].camera.get()),this.defaultComposer.addPass(this.renderPass),this.outlinePass=new Wr(new $e,this.scene,this.renderPass.camera),this.outlinePass.visibleEdgeColor.setHex(15964205),this.defaultComposer.addPass(this.outlinePass),this.openPosePass=new AA(this.scene,this.renderPass.camera),this.defaultComposer.addPass(this.openPosePass),this.depthMapComposer=new kg(this.renderer),this.depthMapPass=new wA(this.scene,this.renderPass.camera),this.depthMapComposer.addPass(this.depthMapPass),this.edgeComposer=new kg(this.renderer),this.edgeDetectPass=new xA(this.scene,this.renderPass.camera),this.edgeComposer.addPass(this.edgeDetectPass);for(let o of this.systems)o.setup(this);for(let o of this.tools)o.setup(this)}dispose(){this.history.unload();for(let e of this.views)e.dispose();for(let e of this.systems)e.dispose();for(let e of this.tools)e.dispose();this.renderer.dispose()}update(){const e=Date.now();this.detSec=(e-this.lastTimestamp)/1e3,this.fps=Math.floor(1/this.detSec),this.lastTimestamp=e;for(let t=0;t<this.views.length;++t){const s=this.views[t];if(s.enabled=t===this.mainViewIndex||this.options.quadView,t===this.mainViewIndex){const i=s.camera;i.perspective=this.model.cameraPerspective&&(Math.abs(i.alpha%(Math.PI/2))>1e-8||Math.abs(i.beta%(Math.PI/2))>1e-8),i.perspectiveCamera.fov=this.model.cameraFov}}for(let t of this.views)t=rt(t),t.enabled&&t.update();for(let t of this.systems)t.update(this);for(let t of this.views)t=rt(t),t.input.update()}reset(){this.views[this.mainViewIndex].camera.alpha=-Math.PI/8,this.views[this.mainViewIndex].camera.beta=-Math.PI/4;for(let e of this.views)e.camera.target.set(0,0,0),e.zoomLevel=0;this.model.reset(),this.history.clear()}readonlyRef(){return rt(this)}nextFrameEnd(e){this.nextFrameCallbacks.push(e)}throttle(e,t,s,i=!1){const r=this.throttleTasks.get(e);r?(i||(r.time=Date.now()+t),r.callback=s):i?(s(),this.throttleTasks.set(e,{time:Date.now()+t,callback:()=>{}})):this.throttleTasks.set(e,{time:Date.now()+t,callback:s})}delayThrottle(e,t){const s=this.throttleTasks.get(e);s&&(s.time=Date.now()+t)}load(e){this.reset();for(let t=0;t<4;++t){const s=e.views[t],i=this.views[t];i.zoomLevel=s.zoomLevel,i.camera.alpha=s.alpha,i.camera.beta=s.beta,i.camera.target.set(...s.target),t===this.mainViewIndex&&(i.camera.perspective=s.perspective,i.camera.perspectiveCamera.fov=s.fov,this.model.cameraPerspective=s.perspective,this.model.cameraFov=s.fov)}this.model.cameras=e.cameras;for(let t of e.nodes){const s=this.model.createNode(t.id,t.type,t.parentId?this.model.getNode(t.parentId):null,null,t.data,t.instanceId);s.expanded=t.expanded}}}u(wp,"EditorContext");f0e(wp,"EditorContext");var p0e=Object.defineProperty,m0e=u((n,e)=>p0e(n,"name",{value:e,configurable:!0}),"__name$s"),g0e=Ht({props:{editorContext:{type:wp,required:!0}},emits:["setData"],setup(n,e){const t=ct(function(){return n.editorContext.model.selected.join(",")}),s=ct(function(){const r=n.editorContext.model.getSelectedNodes();if(!r.length)return[];const o=[],a=new Set;let l=r[0];const c=kn(l.type);for(let h of c.components)ti(h.name).inputComponent&&a.add(h.name);for(let h=1,d=r.length;h<d;++h){let f=r[h];const p=kn(f.type),g=new Set;for(let m of p.components)ti(m.name).inputComponent&&g.add(m.name);for(let m of a)g.has(m)||a.delete(m)}for(let h of a){const d=ti(h);let f;l.instanceId&&!d.instanceable?f=n.editorContext.model.getNode(l.instanceId).value(d.constructor):f=l.value(d.constructor),o.push({name:h,componentClass:d.constructor,label:d.label||h,inlineLabel:d.inlineLabel||!1,inputComponent:d.inputComponent,inputComponentProps:d.inputComponentProps,value:f})}return o});function i(r,o){e.emit("setData",n.editorContext.model.getSelectedNodes().map(a=>({node:a,type:r,value:o})))}return u(i,"onInput"),m0e(i,"onInput"),{key:t,properties:s,onInput:i}}});function v0e(n,e,t,s,i,r){return Se(),Oe("div",{class:"properties",key:n.key},[(Se(!0),Oe(Dt,null,ji(n.properties,o=>(Se(),Oe("div",{class:pn(["property",{inline:o.inlineLabel}])},[j("label",null,un(o.label),1),(Se(),Xt(w4(o.inputComponent),uP({class:"value",value:o.value,onInput:a=>n.onInput(o.componentClass,a)},o.inputComponentProps),null,16,["value","onInput"]))],2))),256))])}u(v0e,"_sfc_render$b");var y0e=jt(g0e,[["render",v0e]]),_0e=Object.defineProperty,b0e=u((n,e)=>_0e(n,"name",{value:e,configurable:!0}),"__name$r");class SA{constructor(){A(this,"parent");A(this,"subMenu")}}u(SA,"PopupMenuItemContext");b0e(SA,"PopupMenuItemContext");var w0e=Object.defineProperty,KE=u((n,e)=>w0e(n,"name",{value:e,configurable:!0}),"__name$q"),x0e=Ht({props:{title:String,icon:String,hotkey:String,disabled:Boolean,sep:Boolean,popup:Boolean,checked:Boolean},setup(n,e){const t=Ne(),s=ct(function(){return!!e.slots.default}),i=new SA;Hl("popupMenuItemContext",i),i.parent=Es("popupMenuContext",null)||void 0;function r(){var a;(a=i.parent)==null||a.handleMenuItemMouseOver(i,t.value)}u(r,"onMouseOver"),KE(r,"onMouseOver");function o(a){var l;n.disabled||n.sep||s.value||(l=i.parent)==null||l.hideAll()}return u(o,"onClick"),KE(o,"onClick"),{menuItem:t,hasChild:s,onMouseOver:r,onClick:o}}});const A0e=["src"],M0e={class:"title"},S0e={key:0,class:"hotkey"};function C0e(n,e,t,s,i,r){return Se(),Oe("div",{class:pn(["popup-menu-item",{"has-child":n.hasChild,disabled:n.disabled,sep:n.sep,popup:n.popup}]),ref:"menuItem",onMouseover:e[0]||(e[0]=Hn((...o)=>n.onMouseOver&&n.onMouseOver(...o),["stop"])),onClick:e[1]||(e[1]=(...o)=>n.onClick&&n.onClick(...o))},[n.sep?tt("",!0):(Se(),Oe(Dt,{key:0},[j("div",{class:pn(["icon",{checked:n.checked,img:!!n.icon}])},[n.icon&&!n.checked?(Se(),Oe("img",{key:0,src:n.icon,alt:""},null,8,A0e)):tt("",!0)],2),j("div",M0e,un(n.title),1),n.hotkey?(Se(),Oe("div",S0e,un(n.hotkey),1)):tt("",!0),za(n.$slots,"default",{},void 0,!0)],64))],34)}u(C0e,"_sfc_render$a");var Mk=jt(x0e,[["render",C0e],["__scopeId","data-v-4eb751b0"]]),E0e=Object.defineProperty,hr=u((n,e)=>E0e(n,"name",{value:e,configurable:!0}),"__name$p"),T0e=Ht({name:"model-tree-node",props:{model:{type:ap,required:!0},node:{type:Yl,required:!0},depth:{type:Number,required:!0},draggingNode:Yl,dragOverNode:Yl,dropPosition:String},emits:["setValue","setSelection","dragStart","dragOver","contextmenu","rangeSelect"],setup(n,e){const t=Ne(),s=ct(function(){const _=n.node;if(_.type==="OpenPoseKeypoint"){const w=_.value(wr);return"#"+{"":"Keypoint",nose:"Nose",neck:"Neck",right_shoulder:"Right Shoulder",right_elbow:"Right Elbow",right_wrist:"Right Wrist",left_shoulder:"Left Shoulder",left_elbow:"Left Elbow",left_wrist:"Left Wrist",right_hip:"Right Hip",right_knee:"Right Knee",right_ankle:"Right Ankle",left_hip:"Left Hip",left_knee:"Left Knee",left_ankle:"Left Ankle",right_eye:"Right Eye",left_eye:"Left Eye",right_ear:"Right Ear",left_ear:"Left Ear"}[w]}return(_.has(zt)?_.value(zt):"")||`${kn(_.type).label} #${_.id}`}),i=ct(function(){return kn(n.node.type).icon}),r=ct(function(){return n.node.has(gt)}),o=ct(function(){return r.value&&n.node.value(gt)});function a(_,w,x){e.emit("setValue",_,w,x)}u(a,"onSetValue"),hr(a,"onSetValue");function l(){a(n.node,gt,!o.value)}u(l,"toggleVisible"),hr(l,"toggleVisible");function c(){n.node.expanded=!n.node.expanded}u(c,"toggleExpanded"),hr(c,"toggleExpanded");function h(_){e.emit("setSelection",_)}u(h,"onSetSelection"),hr(h,"onSetSelection");function d(_){const w=n.node.id;if(_.ctrlKey){const x=n.model.selected;x.includes(w)?e.emit("setSelection",x.filter(S=>S!==w)):e.emit("setSelection",[...x,w])}else _.shiftKey?b(w):e.emit("setSelection",[w])}u(d,"onNodeClick"),hr(d,"onNodeClick");function f(_){if(!_.shiftKey){if(!n.model.selected.includes(n.node.id)){if(_.ctrlKey)return;e.emit("setSelection",[n.node.id])}g(n.node)}}u(f,"onMouseDown"),hr(f,"onMouseDown");function p(_){if(n.draggingNode&&t.value){const w=t.value.getBoundingClientRect(),x=_.clientY-w.top,S=6;let C=x<=S?"before":x>=w.height-S?"after":"atLast";C==="after"&&n.node.children.length&&n.node.expanded&&(C="atFirst"),e.emit("dragOver",n.node,C)}}u(p,"onMouseMove"),hr(p,"onMouseMove");function g(_){e.emit("dragStart",_)}u(g,"onDragStart"),hr(g,"onDragStart");function m(_,w){e.emit("dragOver",_,w)}u(m,"onDragOver"),hr(m,"onDragOver");const v=ct(function(){const _=n.node,w=n.draggingNode===_,x=n.dragOverNode===_,S=n.dropPosition;return{selected:n.model.selected.includes(_.id),dragging:w,"drag-over-before":x&&S==="before","drag-over-inside":x&&(S==="atFirst"||S==="atLast"),"drag-over-after":x&&S==="after",instance:!!_.instanceId}});function y(_,w){e.emit("contextmenu",_,w)}u(y,"onContextMenu"),hr(y,"onContextMenu");function b(_){e.emit("rangeSelect",_)}return u(b,"onRangeSelect"),hr(b,"onRangeSelect"),{dom:t,name:s,icon:i,hasVisible:r,visible:o,onSetValue:a,toggleVisible:l,toggleExpanded:c,onSetSelection:h,onNodeClick:d,onMouseDown:f,onMouseMove:p,onDragStart:g,onDragOver:m,classnames:v,onContextMenu:y,onRangeSelect:b}}});const P0e={class:"visibility"},R0e={class:"expand"},I0e=["src"],D0e={class:"node-name"};function L0e(n,e,t,s,i,r){const o=ln("model-tree-node",!0);return Se(),Oe(Dt,null,[j("div",{class:pn(["model-tree-node",n.classnames]),onMousedown:e[3]||(e[3]=Hn((...a)=>n.onMouseDown&&n.onMouseDown(...a),["left"])),onMousemove:e[4]||(e[4]=(...a)=>n.onMouseMove&&n.onMouseMove(...a)),onContextmenu:e[5]||(e[5]=Hn(a=>n.onContextMenu(n.node,a),["prevent"])),ref:"dom"},[j("div",P0e,[n.hasVisible?(Se(),Oe("div",{key:0,class:pn(["icon",[n.visible?"visible":"invisible"]]),onClick:e[0]||(e[0]=Hn((...a)=>n.toggleVisible&&n.toggleVisible(...a),["stop"]))},null,2)):tt("",!0)]),j("div",{class:"name",style:On({"padding-left":`${n.depth*16+2}px`}),onClick:e[2]||(e[2]=(...a)=>n.onNodeClick&&n.onNodeClick(...a))},[j("div",R0e,[n.node.children.length?(Se(),Oe("div",{key:0,class:pn(["icon",[n.node.expanded?"collapse":"expand"]]),onClick:e[1]||(e[1]=Hn((...a)=>n.toggleExpanded&&n.toggleExpanded(...a),["stop"]))},null,2)):tt("",!0)]),j("img",{class:"node-icon",src:n.icon,alt:""},null,8,I0e),j("span",D0e,un(n.name),1)],4)],34),n.node.expanded?(Se(!0),Oe(Dt,{key:0},ji(n.node.children,a=>(Se(),Xt(o,{key:a.id,model:n.model,node:a,depth:n.depth+1,onSetValue:n.onSetValue,onSetSelection:n.onSetSelection,onRangeSelect:n.onRangeSelect,"dragging-node":n.draggingNode,"drag-over-node":n.dragOverNode,"drop-position":n.dropPosition,onDragStart:n.onDragStart,onDragOver:n.onDragOver,onContextmenu:n.onContextMenu},null,8,["model","node","depth","onSetValue","onSetSelection","onRangeSelect","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu"]))),128)):tt("",!0)],64)}u(L0e,"_sfc_render$9");var O0e=jt(T0e,[["render",L0e],["__scopeId","data-v-6a76ea03"]]),k0e=Object.defineProperty,ms=u((n,e)=>k0e(n,"name",{value:e,configurable:!0}),"__name$o"),N0e=Ht({components:{PopupMenu:hw,PopupMenuItem:Mk,ModelTreeNode:O0e},props:{model:{type:ap,required:!0}},emits:["setValue","moveNode","select","focus","cut","copy","paste","delete","convertToClay","applyTransformation","createInstance","flip","copyPose","pastePose"],setup(n,e){const t=Ne();function s(z,H,q){e.emit("setValue",z,H,q)}u(s,"onSetValue"),ms(s,"onSetValue");let i=!1;const r=Ne(),o=Ne(),a=Ne("");function l(z){r.value=z,o.value=void 0;const H=ms(function(){r.value!==o.value&&r.value&&o.value&&e.emit("moveNode",o.value,a.value),r.value=void 0,o.value=void 0,document.removeEventListener("mouseup",H)},"onMouseUp");document.addEventListener("mouseup",H)}u(l,"onDragStart"),ms(l,"onDragStart");function c(z,H){z!==o.value&&(i=!0),o.value=z,a.value=H}u(c,"onDragOver"),ms(c,"onDragOver");function h(z){if(i){i=!1;return}e.emit("select",z)}u(h,"onSetSelection"),ms(h,"onSetSelection");function d(z){const H=rt(n.model),q=new Set(H.selected);if(!q.size){h([z]);return}const ne=[];let W=!1,se=!1;H.forEach(K=>{if(W&&se)return!1;!se&&q.has(K.id)&&(se=!0),K.id===z&&(W=!0),(se||W)&&ne.push(K.id)}),h(ne)}u(d,"onRangeSelect"),ms(d,"onRangeSelect");const f=Ne();function p(z,H){f.value=z,t.value.show(H.target,{x:H.clientX,y:H.clientY})}u(p,"onContextMenu"),ms(p,"onContextMenu");function g(){e.emit("focus",f.value)}u(g,"onFocus"),ms(g,"onFocus");function m(){e.emit("cut")}u(m,"onCut"),ms(m,"onCut");function v(){e.emit("copy")}u(v,"onCopy"),ms(v,"onCopy");function y(){e.emit("paste",f.value)}u(y,"onPaste"),ms(y,"onPaste");function b(){e.emit("delete")}u(b,"onDelete"),ms(b,"onDelete");const _=ct(function(){const z=f.value;return z?kn(z.type).mesh:!1});function w(){e.emit("convertToClay",f.value)}u(w,"onConvertToClay"),ms(w,"onConvertToClay");const x=ct(function(){const z=f.value;return z?!z.instanceId&&z.type==="Clay":!1});function S(){e.emit("applyTransformation",f.value)}u(S,"onApplyTransformation"),ms(S,"onApplyTransformation");const C=ct(function(){const z=f.value;if(!z)return!1;const H=kn(z.type);return!!H.instanceable&&!H.unique}),M=ct(function(){const z=f.value;return z?!z.has(Xn):!1});function R(z){e.emit("createInstance",f.value,z)}u(R,"onCreateInstance"),ms(R,"onCreateInstance");const D=ct(function(){const z=f.value;return z?["Container","IKChain","IKNode"].includes(z.type):!1});function k(z){e.emit("flip",f.value,z)}u(k,"onFlip"),ms(k,"onFlip");const T=ct(function(){const z=f.value;return z?["IKChain"].includes(z.type):!1});function N(){e.emit("copyPose",f.value)}u(N,"onCopyPose"),ms(N,"onCopyPose");function E(){e.emit("pastePose",f.value)}return u(E,"onPastePose"),ms(E,"onPastePose"),{contextMenu:t,onSetValue:s,onSetSelection:h,draggingNode:r,dragOverNode:o,dropPosition:a,onDragStart:l,onDragOver:c,onRangeSelect:d,onContextMenu:p,contextMenuNode:f,onFocus:g,onCut:m,onCopy:v,onPaste:y,onDelete:b,canConvertToClay:_,onConvertToClay:w,canApplyTransformation:x,onApplyTransformation:S,canCreateInstance:C,canCreateMirrorInstance:M,onCreateInstance:R,canFlip:D,onFlip:k,hasPose:T,onCopyPose:N,onPastePose:E}}});function F0e(n,e,t,s,i,r){const o=ln("model-tree-node"),a=ln("popup-menu-item"),l=ln("popup-menu");return Se(),Oe("div",{class:"model-tree",onClick:e[6]||(e[6]=Hn(c=>n.onSetSelection([]),["left","self"])),onContextmenu:e[7]||(e[7]=Hn(c=>n.onContextMenu(void 0,c),["self","prevent"]))},[(Se(!0),Oe(Dt,null,ji(n.model.nodes,c=>(Se(),Xt(o,{key:c.id,model:n.model,node:c,depth:0,onSetValue:n.onSetValue,onSetSelection:n.onSetSelection,"dragging-node":n.draggingNode,"drag-over-node":n.dragOverNode,"drop-position":n.dropPosition,onDragStart:n.onDragStart,onDragOver:n.onDragOver,onContextmenu:n.onContextMenu,onRangeSelect:n.onRangeSelect},null,8,["model","node","onSetValue","onSetSelection","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu","onRangeSelect"]))),128)),we(l,{ref:"contextMenu"},{default:bt(()=>[we(a,{title:"Focus",onClick:n.onFocus,disabled:!n.contextMenuNode},null,8,["onClick","disabled"]),n.canFlip?(Se(),Oe(Dt,{key:0},[we(a,{title:"Flip",onClick:e[0]||(e[0]=c=>n.onFlip("flip"))}),we(a,{title:"Flip Left to Right",onClick:e[1]||(e[1]=c=>n.onFlip("left-to-right"))}),we(a,{title:"Flip Right to Left",onClick:e[2]||(e[2]=c=>n.onFlip("right-to-left"))})],64)):tt("",!0),n.canConvertToClay||n.canApplyTransformation||n.canCreateInstance?(Se(),Oe(Dt,{key:1},[we(a,{sep:""}),n.canConvertToClay?(Se(),Xt(a,{key:0,title:"Convert to Clay",onClick:n.onConvertToClay},null,8,["onClick"])):tt("",!0),n.canApplyTransformation?(Se(),Xt(a,{key:1,title:"Apply Transformation",onClick:n.onApplyTransformation},null,8,["onClick"])):tt("",!0),n.canCreateInstance?(Se(),Oe(Dt,{key:2},[we(a,{title:"Create Shadow Node",onClick:e[3]||(e[3]=c=>n.onCreateInstance("none"))}),n.canCreateMirrorInstance?(Se(),Oe(Dt,{key:0},[we(a,{title:"Create Mirror Shadow Node",onClick:e[4]||(e[4]=c=>n.onCreateInstance("z"))}),we(a,{title:"Create Vertical Mirror Shadow Node",onClick:e[5]||(e[5]=c=>n.onCreateInstance("y"))})],64)):tt("",!0)],64)):tt("",!0)],64)):tt("",!0),n.hasPose?(Se(),Oe(Dt,{key:2},[we(a,{sep:""}),we(a,{title:"Copy Pose",onClick:n.onCopyPose},null,8,["onClick"]),we(a,{title:"Paste Pose",onClick:n.onPastePose},null,8,["onClick"])],64)):tt("",!0),we(a,{sep:""}),we(a,{title:"Cut",hotkey:"Ctrl+X",onClick:n.onCut,disabled:!n.model.selected.length},null,8,["onClick","disabled"]),we(a,{title:"Copy",hotkey:"Ctrl+C",onClick:n.onCopy,disabled:!n.model.selected.length},null,8,["onClick","disabled"]),we(a,{title:"Paste",hotkey:"Ctrl+V",onClick:n.onPaste},null,8,["onClick"]),we(a,{title:"Delete",hotkey:"Delete",onClick:n.onDelete,disabled:!n.model.selected.length},null,8,["onClick","disabled"])]),_:1},512)],32)}u(F0e,"_sfc_render$8");var z0e=jt(N0e,[["render",F0e],["__scopeId","data-v-5aa4f4ef"]]),B0e=Object.defineProperty,ZE=u((n,e)=>B0e(n,"name",{value:e,configurable:!0}),"__name$n"),U0e=Ht({props:{modal:Boolean,title:String,width:String,height:String,closable:Boolean,visible:Boolean,x:Number,y:Number,bodyStyle:Object},emits:["update:visible","update:x","update:y","close"],setup(n,e){const t=Ne(),s=Ne(0),i=Ne(0),r=ct(function(){const l={};return l.left=Math.round(s.value)+"px",l.top=Math.round(i.value)+"px",n.width&&(l.width=n.width),n.height&&(l.height=n.height),l});Ts([()=>n.x,()=>n.y],function([l,c]){l!=null&&c!=null&&(s.value=l,i.value=c)},{immediate:!0}),Ts(()=>n.visible,async function(l){if(l&&(n.x==null||n.y==null)&&(s.value=0,i.value=0,await Ri(),t.value)){const c=document.body.getBoundingClientRect(),h=t.value.getBoundingClientRect();s.value=(c.width-h.width)/2,i.value=(c.height-h.height)/2}},{immediate:!0});function o(){e.emit("update:visible",!1),e.emit("close")}u(o,"close"),ZE(o,"close");function a(l){const c=l.clientX,h=l.clientY,d=s.value,f=i.value;ec(l,p=>{if(t.value){const g=p.clientX-c,m=p.clientY-h,v=document.body.getBoundingClientRect(),y=t.value.getBoundingClientRect();s.value=Math.max(0,Math.min(v.width-y.width,d+g)),i.value=Math.max(0,Math.min(v.height-y.height,f+m)),e.emit("update:x",s.value),e.emit("update:y",i.value)}})}return u(a,"onTitleMouseDown"),ZE(a,"onTitleMouseDown"),{dialog:t,style:r,close:o,onTitleMouseDown:a}}});const $0e={class:"popup-dialog__title-text"},V0e={key:0,class:"popup-dialog__buttons"};function G0e(n,e,t,s,i,r){return Se(),Xt(Eb,{to:"body"},[j("div",{class:pn(["popup-dialog__mask",{modal:n.modal,visible:n.visible}])},[j("div",{class:"popup-dialog",style:On(n.style),ref:"dialog"},[j("div",{class:"popup-dialog__title",onPointerdown:e[2]||(e[2]=(...o)=>n.onTitleMouseDown&&n.onTitleMouseDown(...o))},[j("div",$0e,un(n.title),1),n.closable?(Se(),Oe("button",{key:0,class:"popup-dialog__btn-close",onMousedown:e[0]||(e[0]=Hn(()=>{},["stop"])),onClick:e[1]||(e[1]=(...o)=>n.close&&n.close(...o))},null,32)):tt("",!0)],32),j("div",{class:"popup-dialog__body",style:On(n.bodyStyle)},[za(n.$slots,"default",{},void 0,!0)],4),n.$slots.buttons?(Se(),Oe("div",V0e,[za(n.$slots,"buttons",{},void 0,!0)])):tt("",!0)],4)],2)])}u(G0e,"_sfc_render$7");var O1=jt(U0e,[["render",G0e],["__scopeId","data-v-a463ad14"]]),H0e=Object.defineProperty,W0e=u((n,e)=>H0e(n,"name",{value:e,configurable:!0}),"__name$m"),j0e=Ht({props:{alpha:Number,beta:Number},emits:["setView"],setup(n,e){const t=ct(function(){const i=(n.alpha||0)/Math.PI*180,r=-(n.beta||0)/Math.PI*180-90;return{transform:`rotateX(${i}deg) rotateY(${r}deg)`}});function s(i){e.emit("setView",i)}return u(s,"setView"),W0e(s,"setView"),{cubeStyle:t,setView:s}}});function X0e(n,e,t,s,i,r){return Se(),Oe("div",{class:"view-rotation-handler",onContextmenu:e[6]||(e[6]=Hn(()=>{},["prevent"]))},[j("div",{class:"cube",style:On(n.cubeStyle)},[j("div",{class:"face front",onClick:e[0]||(e[0]=o=>n.setView("front"))},"+Z"),j("div",{class:"face back",onClick:e[1]||(e[1]=o=>n.setView("back"))},"-Z"),j("div",{class:"face top",onClick:e[2]||(e[2]=o=>n.setView("top"))},"+Y"),j("div",{class:"face bottom",onClick:e[3]||(e[3]=o=>n.setView("bottom"))},"-Y"),j("div",{class:"face right",onClick:e[4]||(e[4]=o=>n.setView("right"))},"+X"),j("div",{class:"face left",onClick:e[5]||(e[5]=o=>n.setView("left"))},"-X")],4)],32)}u(X0e,"_sfc_render$6");var Y0e=jt(j0e,[["render",X0e],["__scopeId","data-v-308c1057"]]),q0e=Object.defineProperty,QE=u((n,e)=>q0e(n,"name",{value:e,configurable:!0}),"__name$l"),K0e=Ht({components:{ViewRotationHandler:Y0e},props:{editorContext:wp,quadView:Boolean,mainView:Number},emits:["mounted","beforeUnmount","setView"],setup(n,e){const t=Ne(),s=Ne(),i=Ne(),r=Ne(),o=Ne(),a=Ne(),l=Ne(),c=Ne(),h=Ne(),d=Ne();let f;Ts(()=>n.quadView,function(){p()}),D0(function(){p(),f=setInterval(p,50),e.emit("mounted",s.value,l.value,c.value,h.value,d.value)}),Wa(function(){clearInterval(f),e.emit("beforeUnmount")});function p(){const m=t.value.getBoundingClientRect(),v=s.value;(v.width!==m.width||v.height!==m.height)&&(v.width=m.width,v.height=m.height)}u(p,"resize"),QE(p,"resize");function g(m){e.emit("setView",m)}return u(g,"setView"),QE(g,"setView"),{wrapper:t,canvas:s,view1:i,view2:r,view3:o,view4:a,view1Control:l,view2Control:c,view3Control:h,view4Control:d,setView:g}}});const Z0e={ref:"canvas"},Q0e={class:"view v1",ref:"view1",tabindex:"0"},J0e={class:"control",ref:"view1Control"},e1e={class:"view v2",ref:"view2",tabindex:"0"},t1e={class:"control",ref:"view2Control"},n1e={class:"view v3",ref:"view3",tabindex:"0"},s1e={class:"control",ref:"view3Control"},i1e={class:"view v4",ref:"view4",tabindex:"0"},r1e={class:"control",ref:"view4Control"};function o1e(n,e,t,s,i,r){const o=ln("view-rotation-handler");return Se(),Oe("div",{class:pn(["canvas-wrapper",{"quad-view":n.quadView}]),ref:"wrapper"},[j("canvas",Z0e,null,512),gs(j("div",Q0e,[j("div",J0e,null,512),n.editorContext?(Se(),Xt(o,{key:0,alpha:n.editorContext.views[0].camera.alpha,beta:n.editorContext.views[0].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Pp,n.quadView||n.mainView===0]]),gs(j("div",e1e,[j("div",t1e,null,512),n.editorContext?(Se(),Xt(o,{key:0,alpha:n.editorContext.views[1].camera.alpha,beta:n.editorContext.views[1].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Pp,n.quadView||n.mainView===1]]),gs(j("div",n1e,[j("div",s1e,null,512),n.editorContext?(Se(),Xt(o,{key:0,alpha:n.editorContext.views[2].camera.alpha,beta:n.editorContext.views[2].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Pp,n.quadView||n.mainView===2]]),gs(j("div",i1e,[j("div",r1e,null,512),n.editorContext?(Se(),Xt(o,{key:0,alpha:n.editorContext.views[3].camera.alpha,beta:n.editorContext.views[3].camera.beta,onSetView:n.setView},null,8,["alpha","beta","onSetView"])):tt("",!0)],512),[[Pp,n.quadView||n.mainView===3]])],2)}u(o1e,"_sfc_render$5");var a1e=jt(K0e,[["render",o1e],["__scopeId","data-v-5bd07d3d"]]),l1e=Object.defineProperty,c1e=u((n,e)=>l1e(n,"name",{value:e,configurable:!0}),"__name$k"),u1e=Ht({props:{width:{type:Number,default:250},minWidth:{type:Number,default:50},maxWidth:{type:Number,default:500},direction:{type:String,default:"left"}},setup(n,e){function t(s){if(s.button!==0)return;const i=n.width,r=s.clientX;ec(s,function(o){const a=(o.clientX-r)*(n.direction==="left"?-1:1),l=Math.min(Math.max(i+a,n.minWidth),n.maxWidth);e.emit("update:width",l)})}return u(t,"onResize"),c1e(t,"onResize"),{onResize:t}}});const h1e={class:"side-panel-content"};function d1e(n,e,t,s,i,r){return Se(),Oe("div",{class:"side-panel",style:On({width:`${n.width}px`})},[j("div",h1e,[za(n.$slots,"default",{},void 0,!0)]),n.direction==="left"?(Se(),Oe("div",{key:0,class:"resizer-handler left",onPointerdown:e[0]||(e[0]=(...o)=>n.onResize&&n.onResize(...o))},null,32)):tt("",!0),n.direction==="right"?(Se(),Oe("div",{key:1,class:"resizer-handler right",onPointerdown:e[1]||(e[1]=(...o)=>n.onResize&&n.onResize(...o))},null,32)):tt("",!0)],4)}u(d1e,"_sfc_render$4");var f1e=jt(u1e,[["render",d1e],["__scopeId","data-v-64397c11"]]),p1e=Object.defineProperty,m1e=u((n,e)=>p1e(n,"name",{value:e,configurable:!0}),"__name$j");function k1(n,e){const t=pP(n);e&&e(t);const s=document.createElement("div");return document.body.appendChild(s),t.mount(s),function(){t.unmount(),s.remove()}}u(k1,"createComponentInstance");m1e(k1,"createComponentInstance");var g1e=Object.defineProperty,v1e=u((n,e)=>g1e(n,"name",{value:e,configurable:!0}),"__name$i"),y1e=Ht({components:{PopupDialog:O1},setup(){const n=Ne(!1),e=Ne(""),t=Es("context",null);t&&(n.value=t.visible,e.value=t.content),Ts(n,i=>{i||t==null||t.onCloseCallback()});function s(){n.value=!1}return u(s,"ok"),v1e(s,"ok"),{visible:n,content:e,ok:s}}});const _1e={style:{"white-space":"pre-wrap"}};function b1e(n,e,t,s,i,r){const o=ln("popup-dialog");return Se(),Xt(o,{modal:"",title:"Message",closable:"",visible:n.visible,"onUpdate:visible":e[1]||(e[1]=a=>n.visible=a)},{buttons:bt(()=>[j("button",{onClick:e[0]||(e[0]=(...a)=>n.ok&&n.ok(...a))},"Ok")]),default:bt(()=>[j("div",_1e,un(n.content),1)]),_:1},8,["visible"])}u(b1e,"_sfc_render$3");var w1e=jt(y1e,[["render",b1e]]),x1e=Object.defineProperty,JE=u((n,e)=>x1e(n,"name",{value:e,configurable:!0}),"__name$h"),A1e=Ht({components:{PopupDialog:O1},setup(){const n=Ne(!1),e=Ne("");let t=!1;const s=Es("context",null);s&&(n.value=s.visible,e.value=s.content),Ts(n,o=>{o||s==null||s.onCloseCallback(t)});function i(){t=!0,n.value=!1}u(i,"yes"),JE(i,"yes");function r(){n.value=!1}return u(r,"no"),JE(r,"no"),{visible:n,content:e,yes:i,no:r}}});const M1e={style:{"white-space":"pre-wrap"}};function S1e(n,e,t,s,i,r){const o=ln("popup-dialog");return Se(),Xt(o,{modal:"",title:"Confirm",closable:"",visible:n.visible,"onUpdate:visible":e[2]||(e[2]=a=>n.visible=a)},{buttons:bt(()=>[j("button",{onClick:e[0]||(e[0]=(...a)=>n.yes&&n.yes(...a))},"Yes"),j("button",{onClick:e[1]||(e[1]=(...a)=>n.no&&n.no(...a))},"No")]),default:bt(()=>[j("div",M1e,un(n.content),1)]),_:1},8,["visible"])}u(S1e,"_sfc_render$2");var C1e=jt(A1e,[["render",S1e]]),E1e=Object.defineProperty,eT=u((n,e)=>E1e(n,"name",{value:e,configurable:!0}),"__name$g"),T1e=Ht({components:{PopupDialog:O1},setup(){const n=Ne(!1),e=Ne(""),t=Ne(),s=Ne(null);let i=!1;const r=Es("context",null);r&&(n.value=r.visible,e.value=r.title,s.value=r.value),Ts(n,async l=>{var c,h;l?(await Ri(),(c=t.value)==null||c.focus(),(h=t.value)==null||h.select()):r==null||r.onCloseCallback(i?s.value:null)},{immediate:!0});function o(){i=!0,n.value=!1}u(o,"ok"),eT(o,"ok");function a(){i=!1,n.value=!1}return u(a,"cancel"),eT(a,"cancel"),{visible:n,title:e,input:t,value:s,ok:o,cancel:a}}});function P1e(n,e,t,s,i,r){const o=ln("popup-dialog");return Se(),Xt(o,{modal:"",title:n.title,closable:"",visible:n.visible,"onUpdate:visible":e[3]||(e[3]=a=>n.visible=a)},{buttons:bt(()=>[j("button",{onClick:e[1]||(e[1]=(...a)=>n.ok&&n.ok(...a))},"Ok"),j("button",{onClick:e[2]||(e[2]=(...a)=>n.cancel&&n.cancel(...a))},"Cancel")]),default:bt(()=>[gs(j("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),style:{width:"100%"},ref:"input"},null,512),[[Pl,n.value]])]),_:1},8,["title","visible"])}u(P1e,"_sfc_render$1");var R1e=jt(T1e,[["render",P1e]]),I1e=Object.defineProperty,Dh=u((n,e)=>I1e(n,"name",{value:e,configurable:!0}),"__name$f");class CA{constructor(e,t,s){A(this,"visible");A(this,"content");A(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=s}}u(CA,"AlertDialogContext");Dh(CA,"AlertDialogContext");function yf(n){let e;return new Promise(function(t){const s=new CA(!0,n,function(){e(),t()});e=k1(w1e,i=>{i.provide("context",s)})})}u(yf,"showAlertDialog");Dh(yf,"showAlertDialog");class EA{constructor(e,t,s){A(this,"visible");A(this,"content");A(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=s}}u(EA,"ConfirmDialogContext");Dh(EA,"ConfirmDialogContext");function Sk(n){let e;return new Promise(function(t){const s=new EA(!0,n,function(i){e(),t(i)});e=k1(C1e,i=>{i.provide("context",s)})})}u(Sk,"showConfirmDialog");Dh(Sk,"showConfirmDialog");class TA{constructor(e,t,s,i){A(this,"visible");A(this,"title");A(this,"value");A(this,"onCloseCallback");this.visible=e,this.title=t,this.value=s,this.onCloseCallback=i}}u(TA,"PromptDialogContext");Dh(TA,"PromptDialogContext");function D1e(n,e){let t;return new Promise(function(s){const i=new TA(!0,n,e==null?null:e,function(r){t(),s(r)});t=k1(R1e,r=>{r.provide("context",i)})})}u(D1e,"showPromptDialog");Dh(D1e,"showPromptDialog");var L1e=Object.defineProperty,Qf=u((n,e)=>L1e(n,"name",{value:e,configurable:!0}),"__name$e");async function Ck(n,e){const t=await PA(n,e);if(t){for(let s of t)n.history.removeNode(s.id);return!0}return!1}u(Ck,"cutModelSelected");Qf(Ck,"cutModelSelected");async function PA(n,e){var i;if(((i=e==null?void 0:e.target)==null?void 0:i.tagName)==="INPUT")return;const t=n.model.getTopmostSelectedNodes(),s=[];for(let r of t)s.push(await r.toJson());return await navigator.clipboard.writeText(JSON.stringify(s)),t}u(PA,"copyModelSelected");Qf(PA,"copyModelSelected");async function Ek(n,e){var t;if(e&&"target"in e&&((t=e.target)==null?void 0:t.tagName)==="INPUT")return!1;try{let s=u(function(d){d=d.filter(f=>f.instanceId?a.isNodeExists(f.instanceId)?f.type===f.type:!1:!0);for(let f of d)f.children&&(f.children=s(f.children));return d},"filterInvalidInstancedNodes");Qf(s,"filterInvalidInstancedNodes");const i=(await navigator.clipboard.read())[0];for(let d of i.types)if(d.startsWith("image/")){const f=await i.getType(d),p=await Wu(f);return n.history.createNode({type:"Image",data:{[Kr.name]:p}}),!0}let r=JSON.parse(await navigator.clipboard.readText());if(!Array.isArray(r))return!1;async function o(d){for(let f of d){for(let p in f.data){const g=ti(p);let m=f.data[p];g.dataType===ke.BYTES&&(m=new Uint8Array(await iw(m))),g.deserialize&&(m=g.deserialize(m)),f.data[p]=m}f.children&&await o(f.children),f.selected=!1}}u(o,"convertJsonToRealDataType"),Qf(o,"convertJsonToRealDataType"),await o(r);const a=n.model;let l=e instanceof Yl?e:void 0;l||a.forEach(d=>{if(a.selected.includes(d.id))return l=d,!1}),r=s(r);let c=!1;const h=n.history;for(let d of r)if(d.selected=!0,l){if(l.isValidChild(d.type)){const f={...d};f.parentId=l.id,h.createNode(f),c=!0}}else if(kn(d.type).canBeRoot){const p={...d};p.parentId=void 0,h.createNode(p),c=!0}return c&&(a.selected=[]),!0}catch(s){return console.error(s),!1}}u(Ek,"pastedModelNodes");Qf(Ek,"pastedModelNodes");var O1e=Object.defineProperty,k1e=u((n,e)=>O1e(n,"name",{value:e,configurable:!0}),"__name$d");const tT=new P,s_=new qe,nT=new P,sT=new be,wg=new be;function Tk(n,e){e=rt(e);const t=e.parent;if(!e.has(Pe))return;const s=e.value(Pe);if(!s)return;sT.copy(e.getParentWorldMatrix()).invert();const i=[s],r=[];for(;i.length;){const o=i.pop();if(!o)break;const a=o.userData.node;a&&a.id!==e.id||!o.visible||(o.isMesh&&r.push(o),i.push(...o.children))}for(let o of r){const a=o.geometry,l=[];let c=null;if(a.index){const f=a.getAttribute("position");if((f==null?void 0:f.itemSize)!==3)continue;const p=a.index.array,g=f.array;for(let v=0,y=p.length;v<y;++v){const _=p[v]*3;l.push(g[_],g[_+1],g[_+2])}const m=a.getAttribute("color");if(m){const v=m.array;c=[];for(let y=0,b=p.length,_=m.itemSize;y<b;++y){const x=p[y]*_;c.push(v[x],v[x+1],v[x+2])}}}else{const f=a.getAttribute("position");if((f==null?void 0:f.itemSize)!==3)continue;const p=f.array;for(let m=0,v=p.length;m<v;m+=3)l.push(p[m],p[m+1],p[m+2]);const g=a.getAttribute("color");if(g){c=[];const m=g.array;for(let v=0,y=m.length,b=g.itemSize;v<y;v+=b)c.push(m[v],m[v+1],m[v+2])}}if(!l.length)continue;const h={};h[Mn.name]=new Float32Array(l),c&&(h[Mr.name]=new Float32Array(c));const d=[zt,Gn,Xs,Dn,In,Vt,Rn,an,Us];for(let f of d)e.has(f)&&(h[f.name]=e.cloneValue(f));o.updateWorldMatrix(!0,!1),wg.copy(o.matrixWorld),wg.multiplyMatrices(sT,wg),wg.decompose(tT,s_,nT),s_.identity(),h[ze.name]=new P().copy(tT),h[nt.name]=new ft().setFromQuaternion(s_),h[Wt.name]=nT.x,n.history.createNode({type:"Clay",parentId:t==null?void 0:t.id,data:h})}n.history.removeNode(e.id)}u(Tk,"convertModelNodeToClay");k1e(Tk,"convertModelNodeToClay");var N1e=Object.defineProperty,N1=u((n,e)=>N1e(n,"name",{value:e,configurable:!0}),"__name$c");async function Pk(n){function e(t){const s={type:t.type,children:[]};if(t.has(En)){const i=t.value(En);s.euler={x:i.x,y:i.y,z:i.z}}return s.children=t.children.map(e),s}u(e,"getPoseJson"),N1(e,"getPoseJson"),await navigator.clipboard.writeText(JSON.stringify(e(n)))}u(Pk,"copyPose");N1(Pk,"copyPose");async function Rk(n,e){try{let t=u(function(i,r){if(r.type===i.type&&(r.euler&&i.has(En)&&n.history.setValue(i,En,new ft(r.euler.x,r.euler.y,r.euler.z)),i.children.length===r.children.length))for(let o=0,a=i.children.length;o<a;++o)t(i.children[o],r.children[o])},"applyPose");N1(t,"applyPose");let s=JSON.parse(await navigator.clipboard.readText());if(!("type"in s))return;t(e,s)}catch(t){console.error(t)}}u(Rk,"pastePose");N1(Rk,"pastePose");var F1e=Object.defineProperty,Ik=u((n,e)=>F1e(n,"name",{value:e,configurable:!0}),"__name$b");function Dk(n,e,t){var v;e=rt(e);const s=new be,i=new be,r=new P,o=new P,a=new P;if(t!=="none"){switch(s.copy(e.getParentWorldMatrix()),i.copy(s).invert(),t){case"x":r.set(1,0,0);break;case"y":r.set(0,1,0);break;case"z":r.set(0,0,1);break}o.copy(r).transformDirection(s),a.applyMatrix4(s)}const l=new P,c=new qe,h=new P,d=new be,f=new P,p=new qe;function g(y,b,_,w,x){const S={type:y.type,instanceId:y.instanceId||y.id};S.data=y.getComponentData(!0);let C;if(t!=="none"){if(b=b,_=_,w=w,y.instanceId&&y.has(Xn)&&Tr(y.value(Xn),r)?delete S.data[Xn.name]:S.data[Xn.name]=new P().copy(r),l.set(0,0,0),c.set(0,0,0,1),h.set(1,1,1),y.has(ze)){const M=S.data[ze.name];M.applyMatrix4(b),M.sub(a),M.reflect(o),M.add(a),M.applyMatrix4(w),l.copy(M)}if(y.has(nt)){const M=S.data[nt.name];c.setFromEuler(M);const R=ko(f,c);f.applyMatrix4(b),f.sub(a),f.reflect(o),f.add(a),f.applyMatrix4(w),f.normalize(),c.setFromAxisAngle(f,-R),M.setFromQuaternion(c)}if(y.has(Et)){if(t==="x")throw new Error("Flipping on x axis will broke the ik chain");const M=y.get(Et);l.copy(M.start),l.applyMatrix4(b),l.sub(a),l.reflect(o),l.add(a),l.applyMatrix4(w);let R=ko(f,M.quaternion);f.applyMatrix4(b),f.sub(a),f.reflect(o),f.add(a),f.applyMatrix4(w),f.normalize(),c.setFromAxisAngle(f,-R);const D=S.data[En.name];x?(p.multiplyQuaternions(x,c),D.setFromQuaternion(p)):D.setFromQuaternion(c)}if(y.has(Wt)&&h.setScalar(y.value(Wt)),y.has(wr)){const M=y.value(wr);S.data[wr.name]={"":"",nose:"nose",neck:"neck",right_shoulder:"left_shoulder",right_elbow:"left_elbow",right_wrist:"left_wrist",left_shoulder:"right_shoulder",left_elbow:"right_elbow",left_wrist:"right_wrist",right_hip:"left_hip",right_knee:"left_knee",right_ankle:"left_ankle",left_hip:"right_hip",left_knee:"right_knee",left_ankle:"right_ankle",right_eye:"left_eye",left_eye:"right_eye",right_ear:"left_ear",left_ear:"right_ear"}[M]}d.compose(l,c,h),_=new be().multiplyMatrices(_,d),w=new be().copy(_).invert(),b=y.getWorldMatrix(),C=new qe().copy(c).invert()}if(S.children=[],!kn(y.type).preventCreatingInstanceChild){let M;for(let R of y.children){const D=g(R,b,_,w,M);M=D.invQuat1,S.children.push(D.creationInfo)}}return S.expanded=y.expanded,S.selected=!1,{creationInfo:S,invQuat1:C}}u(g,"makeNewNode"),Ik(g,"makeNewNode");const m=g(e,s,s,i).creationInfo;m.parentId=(v=e.parent)==null?void 0:v.id,m.selected=!0,n.model.selected=[],n.history.createNode(m)}u(Dk,"createInstanceNode");Ik(Dk,"createInstanceNode");class F1{constructor(){this.pluginCallbacks=[],this.register(function(e){return new kk(e)}),this.register(function(e){return new Nk(e)}),this.register(function(e){return new Fk(e)}),this.register(function(e){return new Uk(e)}),this.register(function(e){return new $k(e)}),this.register(function(e){return new zk(e)}),this.register(function(e){return new Bk(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){const r=new Ok,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,i).catch(s)}parseAsync(e,t){const s=this;return new Promise(function(i,r){s.parse(e,i,r,t)})}}u(F1,"GLTFExporter");const sn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},ki={};ki[Wn]=sn.NEAREST;ki[t0]=sn.NEAREST_MIPMAP_NEAREST;ki[n0]=sn.NEAREST_MIPMAP_LINEAR;ki[qs]=sn.LINEAR;ki[Db]=sn.LINEAR_MIPMAP_NEAREST;ki[fc]=sn.LINEAR_MIPMAP_LINEAR;ki[Ks]=sn.CLAMP_TO_EDGE;ki[zo]=sn.REPEAT;ki[Tf]=sn.MIRRORED_REPEAT;const iT={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},rT=12,z1e=1179937895,B1e=2,oT=8,U1e=1313821514,$1e=5130562;function nf(n,e){return n.length===e.length&&n.every(function(t,s){return t===e[s]})}u(nf,"equalArray");function V1e(n){return new TextEncoder().encode(n).buffer}u(V1e,"stringToArrayBuffer");function G1e(n){return nf(n.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}u(G1e,"isIdentityMatrix");function H1e(n,e,t){const s={min:new Array(n.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(n.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=e;i<e+t;i++)for(let r=0;r<n.itemSize;r++){let o;n.itemSize>4?o=n.array[i*n.itemSize+r]:r===0?o=n.getX(i):r===1?o=n.getY(i):r===2?o=n.getZ(i):r===3&&(o=n.getW(i)),s.min[r]=Math.min(s.min[r],o),s.max[r]=Math.max(s.max[r],o)}return s}u(H1e,"getMinMax");function Lk(n){return Math.ceil(n/4)*4}u(Lk,"getPaddedBufferSize");function i_(n,e=0){const t=Lk(n.byteLength);if(t!==n.byteLength){const s=new Uint8Array(t);if(s.set(new Uint8Array(n)),e!==0)for(let i=n.byteLength;i<t;i++)s[i]=e;return s.buffer}return n}u(i_,"getPaddedArrayBuffer");function aT(){return typeof document=="undefined"&&typeof OffscreenCanvas!="undefined"?new OffscreenCanvas(1,1):document.createElement("canvas")}u(aT,"getCanvas");function lT(n,e){if(n.toBlob!==void 0)return new Promise(s=>n.toBlob(s,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),n.convertToBlob({type:e,quality:t})}u(lT,"getToBlobPromise");class Ok{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,s){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const i=this,r=i.buffers,o=i.json;s=i.options;const a=i.extensionsUsed,l=new Blob(r,{type:"application/octet-stream"}),c=Object.keys(a);if(c.length>0&&(o.extensionsUsed=c),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),s.binary===!0){const h=new FileReader;h.readAsArrayBuffer(l),h.onloadend=function(){const d=i_(h.result),f=new DataView(new ArrayBuffer(oT));f.setUint32(0,d.byteLength,!0),f.setUint32(4,$1e,!0);const p=i_(V1e(JSON.stringify(o)),32),g=new DataView(new ArrayBuffer(oT));g.setUint32(0,p.byteLength,!0),g.setUint32(4,U1e,!0);const m=new ArrayBuffer(rT),v=new DataView(m);v.setUint32(0,z1e,!0),v.setUint32(4,B1e,!0);const y=rT+g.byteLength+p.byteLength+f.byteLength+d.byteLength;v.setUint32(8,y,!0);const b=new Blob([m,g,p,f,d],{type:"application/octet-stream"}),_=new FileReader;_.readAsArrayBuffer(b),_.onloadend=function(){t(_.result)}}}else if(o.buffers&&o.buffers.length>0){const h=new FileReader;h.readAsDataURL(l),h.onloadend=function(){const d=h.result;o.buffers[0].uri=d,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const s=this.options,i=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],i[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(e,i)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const s=new P;for(let i=0,r=e.count;i<r;i++)if(Math.abs(s.fromBufferAttribute(e,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const s=e.clone(),i=new P;for(let r=0,o=s.count;r<o;r++)i.fromBufferAttribute(s,r),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),s.setXYZ(r,i.x,i.y,i.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1;const i={};(t.offset.x!==0||t.offset.y!==0)&&(i.offset=t.offset.toArray(),s=!0),t.rotation!==0&&(i.rotation=t.rotation,s=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(i.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function s(p){return p.encoding===Bt?u(function(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)},"SRGBToLinear"):u(function(m){return m},"LinearToLinear")}u(s,"getEncodingConversion"),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const i=e==null?void 0:e.image,r=t==null?void 0:t.image,o=Math.max((i==null?void 0:i.width)||0,(r==null?void 0:r.width)||0),a=Math.max((i==null?void 0:i.height)||0,(r==null?void 0:r.height)||0),l=aT();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const h=c.getImageData(0,0,o,a);if(i){c.drawImage(i,0,0,o,a);const p=s(e),g=c.getImageData(0,0,o,a).data;for(let m=2;m<g.length;m+=4)h.data[m]=p(g[m]/256)*256}if(r){c.drawImage(r,0,0,o,a);const p=s(t),g=c.getImageData(0,0,o,a).data;for(let m=1;m<g.length;m+=4)h.data[m]=p(g[m]/256)*256}c.putImageData(h,0,0);const f=(e||t).clone();return f.source=new $0(l),f.encoding=Bo,f}processBuffer(e){const t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,i,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;t===sn.UNSIGNED_BYTE?a=1:t===sn.UNSIGNED_SHORT?a=2:a=4;const l=Lk(i*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let h=0;for(let p=s;p<s+i;p++)for(let g=0;g<e.itemSize;g++){let m;e.itemSize>4?m=e.array[p*e.itemSize+g]:g===0?m=e.getX(p):g===1?m=e.getY(p):g===2?m=e.getZ(p):g===3&&(m=e.getW(p)),t===sn.FLOAT?c.setFloat32(h,m,!0):t===sn.UNSIGNED_INT?c.setUint32(h,m,!0):t===sn.UNSIGNED_SHORT?c.setUint16(h,m,!0):t===sn.UNSIGNED_BYTE&&c.setUint8(h,m),h+=a}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(d.target=r),r===sn.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(i){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=i_(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,i(s.bufferViews.push(a)-1)}})}processAccessor(e,t,s,i){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=sn.FLOAT;else if(e.array.constructor===Uint32Array)a=sn.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)a=sn.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)a=sn.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(s===void 0&&(s=0),i===void 0&&(i=e.count),i===0)return null;const l=H1e(e,s,i);let c;t!==void 0&&(c=e===t.index?sn.ELEMENT_ARRAY_BUFFER:sn.ARRAY_BUFFER);const h=this.processBufferView(e,a,s,i,c),d={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:i,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(e,t,s,i="image/png"){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const h=o.images.get(e),d=i+":flipY/"+s.toString();if(h[d]!==void 0)return h[d];a.images||(a.images=[]);const f={mimeType:i},p=aT();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const g=p.getContext("2d");if(s===!0&&(g.translate(0,p.height),g.scale(1,-1)),e.data!==void 0){t!==Ii&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const v=new Uint8ClampedArray(e.height*e.width*4);for(let y=0;y<v.length;y+=4)v[y+0]=e.data[y+0],v[y+1]=e.data[y+1],v[y+2]=e.data[y+2],v[y+3]=e.data[y+3];g.putImageData(new ImageData(v,e.width,e.height),0,0)}else g.drawImage(e,0,0,p.width,p.height);l.binary===!0?c.push(lT(p,i).then(v=>r.processBufferViewImage(v)).then(v=>{f.bufferView=v})):p.toDataURL!==void 0?f.uri=p.toDataURL(i):c.push(lT(p,i).then(v=>new FileReader().readAsDataURL(v)).then(v=>{f.uri=v}));const m=a.images.push(f)-1;return h[d]=m,m}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const s={magFilter:ki[e.magFilter],minFilter:ki[e.minFilter],wrapS:ki[e.wrapS],wrapT:ki[e.wrapT]};return t.samplers.push(s)-1}processTexture(e){const t=this.cache,s=this.json;if(t.textures.has(e))return t.textures.get(e);s.textures||(s.textures=[]);let i=e.userData.mimeType;i==="image/webp"&&(i="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,i)};e.name&&(r.name=e.name),this._invokeAll(function(a){a.writeTexture&&a.writeTexture(e,r)});const o=s.textures.push(r)-1;return t.textures.set(e,o),o}processMaterial(e){const t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const i={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(nf(r,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(a)};this.applyTextureTransform(l,a),i.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){const a={index:this.processTexture(e.map)};this.applyTextureTransform(a,e.map),i.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive.clone().multiplyScalar(e.emissiveIntensity),l=Math.max(a.r,a.g,a.b);if(l>1&&(a.multiplyScalar(1/l),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),l>0&&(i.emissiveFactor=a.toArray()),e.emissiveMap){const c={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(c,e.emissiveMap),i.emissiveTexture=c}}if(e.normalMap){const a={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),i.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),i.occlusionTexture=a}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),e.side===Di&&(i.doubleSided=!0),e.name!==""&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,i)});const o=s.materials.push(i)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,s=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,w=e.material.length;_<w;_++)i.push(e.material[_].uuid);else i.push(e.material.uuid);const r=i.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let a;e.isLineSegments?a=sn.LINES:e.isLineLoop?a=sn.LINE_LOOP:e.isLine?a=sn.LINE_STRIP:e.isPoints?a=sn.POINTS:a=e.material.wireframe?sn.LINES:sn.TRIANGLES;const l={},c={},h=[],d=[],f={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let g=null;for(let _ in o.attributes){if(_.slice(0,5)==="morph")continue;const w=o.attributes[_];if(_=f[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),t.attributes.has(this.getUID(w))){c[_]=t.attributes.get(this.getUID(w));continue}g=null;const S=w.array;_==="JOINTS_0"&&!(S instanceof Uint16Array)&&!(S instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new An(new Uint16Array(S),w.itemSize,w.normalized));const C=this.processAccessor(g||w,o);C!==null&&(c[_]=C,t.attributes.set(this.getUID(w),C))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],w=[],x={};if(e.morphTargetDictionary!==void 0)for(const S in e.morphTargetDictionary)x[e.morphTargetDictionary[S]]=S;for(let S=0;S<e.morphTargetInfluences.length;++S){const C={};let M=!1;for(const R in o.morphAttributes){if(R!=="position"&&R!=="normal"){M||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),M=!0);continue}const D=o.morphAttributes[R][S],k=R.toUpperCase(),T=o.attributes[R];if(t.attributes.has(this.getUID(D,!0))){C[k]=t.attributes.get(this.getUID(D,!0));continue}const N=D.clone();if(!o.morphTargetsRelative)for(let E=0,z=D.count;E<z;E++)N.setXYZ(E,D.getX(E)-T.getX(E),D.getY(E)-T.getY(E),D.getZ(E)-T.getZ(E));C[k]=this.processAccessor(N,o),t.attributes.set(this.getUID(T,!0),C[k])}d.push(C),_.push(e.morphTargetInfluences[S]),e.morphTargetDictionary!==void 0&&w.push(x[S])}l.weights=_,w.length>0&&(l.extras={},l.extras.targetNames=w)}const m=Array.isArray(e.material);if(m&&o.groups.length===0)return null;const v=m?e.material:[e.material],y=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,w=y.length;_<w;_++){const x={mode:a,attributes:c};if(this.serializeUserData(o,x),d.length>0&&(x.targets=d),o.index!==null){let C=this.getUID(o.index);(y[_].start!==void 0||y[_].count!==void 0)&&(C+=":"+y[_].start+":"+y[_].count),t.attributes.has(C)?x.indices=t.attributes.get(C):(x.indices=this.processAccessor(o.index,o,y[_].start,y[_].count),t.attributes.set(C,x.indices)),x.indices===null&&delete x.indices}const S=this.processMaterial(v[y[_].materialIndex]);S!==null&&(x.material=S),h.push(x)}l.primitives=h,s.meshes||(s.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,l)});const b=s.meshes.push(l)-1;return t.meshes.set(r,b),b}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const s=e.isOrthographicCamera,i={type:s?"orthographic":"perspective"};return s?i.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:Xi.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(i.name=e.type),t.cameras.push(i)-1}processAnimation(e,t){const s=this.json,i=this.nodeMap;s.animations||(s.animations=[]),e=F1.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],h=St.parseTrackName(c.name);let d=St.findNode(t,h.nodeName);const f=iT[h.propertyName];if(h.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(h.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let g=c.values.length/c.times.length;f===iT.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let m;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(m="CUBICSPLINE",g/=3):c.getInterpolation()===zu?m="STEP":m="LINEAR",a.push({input:this.processAccessor(new An(c.times,p)),output:this.processAccessor(new An(c.values,g)),interpolation:m}),o.push({sampler:a.length-1,target:{node:i.get(d),path:f}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:a,channels:o}),s.animations.length-1}processSkin(e){const t=this.json,s=this.nodeMap,i=t.nodes[s.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new be;for(let d=0;d<r.bones.length;++d)a.push(s.get(r.bones[d])),c.copy(r.boneInverses[d]),c.multiply(e.bindMatrix).toArray(l,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new An(l,16)),joints:a,skeleton:s.get(o)}),i.skin=t.skins.length-1}processNode(e){const t=this.json,s=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(s.trs){const a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();nf(a,[0,0,0,1])||(r.rotation=a),nf(l,[0,0,0])||(r.translation=l),nf(c,[1,1,1])||(r.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),G1e(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(r.mesh=a)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let l=0,c=e.children.length;l<c;l++){const h=e.children[l];if(h.visible||s.onlyVisible===!1){const d=this.processNode(h);d!==null&&a.push(d)}}a.length>0&&(r.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,r)});const o=t.nodes.push(r)-1;return i.set(e,o),o}processScene(e){const t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);const i={};e.name!==""&&(i.name=e.name),t.scenes.push(i);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||s.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}processObjects(e){const t=new If;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(e)});const s=[];for(let i=0;i<e.length;i++)e[i]instanceof If?this.processScene(e[i]):s.push(e[i]);s.length>0&&this.processObjects(s);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<t.animations.length;++i)this.processAnimation(t.animations[i],e[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(e)})}_invokeAll(e){for(let t=0,s=this.plugins.length;t<s;t++)e(this.plugins[t])}}u(Ok,"GLTFWriter");class kk{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const s=this.writer,i=s.json,r=s.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);const a=i.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}u(kk,"GLTFLightExtension");class Nk{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}u(Nk,"GLTFMaterialsUnlitExtension");class Fk{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const s=this.writer,i=s.extensionsUsed,r={};t.pbrMetallicRoughness.baseColorFactor&&(r.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const o=[1,1,1];if(e.specular.toArray(o,0),r.specularFactor=o,r.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(r.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const a={index:s.processTexture(e.specularMap)};s.applyTextureTransform(a,e.specularMap),r.specularGlossinessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}u(Fk,"GLTFMaterialsPBRSpecularGlossiness");class zk{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,i=s.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}u(zk,"GLTFMaterialsClearcoatExtension");class Bk{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,i=s.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}u(Bk,"GLTFMaterialsIridescenceExtension");class Uk{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,i=s.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}u(Uk,"GLTFMaterialsTransmissionExtension");class $k{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,i=s.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}u($k,"GLTFMaterialsVolumeExtension");F1.Utils={insertKeyframe:function(n,e){const s=n.getValueSize(),i=new n.TimeBufferType(n.times.length+1),r=new n.ValueBufferType(n.values.length+s),o=n.createInterpolant(new n.ValueBufferType(s));let a;if(n.times.length===0){i[0]=e;for(let l=0;l<s;l++)r[l]=0;a=0}else if(e<n.times[0]){if(Math.abs(n.times[0]-e)<.001)return 0;i[0]=e,i.set(n.times,1),r.set(o.evaluate(e),0),r.set(n.values,s),a=0}else if(e>n.times[n.times.length-1]){if(Math.abs(n.times[n.times.length-1]-e)<.001)return n.times.length-1;i[i.length-1]=e,i.set(n.times,0),r.set(n.values,0),r.set(o.evaluate(e),n.values.length),a=i.length-1}else for(let l=0;l<n.times.length;l++){if(Math.abs(n.times[l]-e)<.001)return l;if(n.times[l]<e&&n.times[l+1]>e){i.set(n.times.slice(0,l+1),0),i[l+1]=e,i.set(n.times.slice(l+1),l+2),r.set(n.values.slice(0,(l+1)*s),0),r.set(o.evaluate(e),(l+1)*s),r.set(n.values.slice((l+1)*s),(l+2)*s),a=l+1;break}}return n.times=i,n.values=r,a},mergeMorphTargetTracks:function(n,e){const t=[],s={},i=n.tracks;for(let r=0;r<i.length;++r){let o=i[r];const a=St.parseTrackName(o.name),l=St.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(Zl)}const c=l.morphTargetInfluences.length,h=l.morphTargetDictionary[a.propertyIndex];if(h===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(s[l.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(c*d.times.length);for(let g=0;g<d.times.length;g++)p[g*c+h]=d.values[g];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,s[l.uuid]=d,t.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=s[l.uuid];for(let p=0;p<d.times.length;p++)d.values[p*c+h]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const g=this.insertKeyframe(d,o.times[p]);d.values[g*c+h]=o.values[p]}}return n.tracks=t,n}};class Vk{parse(e){let t="",s=0,i=0,r=0;const o=new P,a=new De,l=new P,c=new $e,h=[];function d(g){let m=0,v=0,y=0;const b=g.geometry,_=new Qs,w=b.getAttribute("position"),x=b.getAttribute("normal"),S=b.getAttribute("uv"),C=b.getIndex();if(t+="o "+g.name+`
`,g.material&&g.material.name&&(t+="usemtl "+g.material.name+`
`),w!==void 0)for(let M=0,R=w.count;M<R;M++,m++)o.fromBufferAttribute(w,M),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(S!==void 0)for(let M=0,R=S.count;M<R;M++,y++)c.fromBufferAttribute(S,M),t+="vt "+c.x+" "+c.y+`
`;if(x!==void 0){_.getNormalMatrix(g.matrixWorld);for(let M=0,R=x.count;M<R;M++,v++)l.fromBufferAttribute(x,M),l.applyMatrix3(_).normalize(),t+="vn "+l.x+" "+l.y+" "+l.z+`
`}if(C!==null)for(let M=0,R=C.count;M<R;M+=3){for(let D=0;D<3;D++){const k=C.getX(M+D)+1;h[D]=s+k+(x||S?"/"+(S?i+k:"")+(x?"/"+(r+k):""):"")}t+="f "+h.join(" ")+`
`}else for(let M=0,R=w.count;M<R;M+=3){for(let D=0;D<3;D++){const k=M+D+1;h[D]=s+k+(x||S?"/"+(S?i+k:"")+(x?"/"+(r+k):""):"")}t+="f "+h.join(" ")+`
`}s+=m,i+=y,r+=v}u(d,"parseMesh");function f(g){let m=0;const v=g.geometry,y=g.type,b=v.getAttribute("position");if(t+="o "+g.name+`
`,b!==void 0)for(let _=0,w=b.count;_<w;_++,m++)o.fromBufferAttribute(b,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(y==="Line"){t+="l ";for(let _=1,w=b.count;_<=w;_++)t+=s+_+" ";t+=`
`}if(y==="LineSegments")for(let _=1,w=_+1,x=b.count;_<x;_+=2,w=_+1)t+="l "+(s+_)+" "+(s+w)+`
`;s+=m}u(f,"parseLine");function p(g){let m=0;const v=g.geometry,y=v.getAttribute("position"),b=v.getAttribute("color");if(t+="o "+g.name+`
`,y!==void 0){for(let _=0,w=y.count;_<w;_++,m++)o.fromBufferAttribute(y,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z,b!==void 0&&(a.fromBufferAttribute(b,_).convertLinearToSRGB(),t+=" "+a.r+" "+a.g+" "+a.b),t+=`
`;t+="p ";for(let _=1,w=y.count;_<=w;_++)t+=s+_+" ";t+=`
`}s+=m}return u(p,"parsePoints"),e.traverse(function(g){g.isMesh===!0&&d(g),g.isLine===!0&&f(g),g.isPoints===!0&&p(g)}),t}}u(Vk,"OBJExporter");var W1e=Object.defineProperty,Gg=u((n,e)=>W1e(n,"name",{value:e,configurable:!0}),"__name$a");async function Gk(n,e,t){function s(){const r=new If;r.traverse=function(o){a(r);function a(l){for(let c of l.children)c.visible&&(o(c),a(c))}u(a,"traverseVisible"),Gg(a,"traverseVisible")};for(let o of n.readonlyRef().model.nodes)if(o.has(Pe)){const a=o.value(Pe);a&&r.children.push(a)}return r}u(s,"getExportScene"),Gg(s,"getExportScene");async function i(r){try{n.statusBarMessage="Exporting...",e.value=!0,await Ri(),await r(async function(){n.statusBarMessage="Writing files...",await Ri()}),n.statusBarMessage="File exported."}catch(o){console.error(o),n.statusBarMessage="Failed to export."}finally{e.value=!1}}switch(u(i,"process"),Gg(i,"process"),t){case"obj":try{const r=await showSaveFilePicker({types:[{accept:{"application/object":[".obj"]}}]});await i(async function(o){const a=s(),l=new Vk().parse(a);await o();const c=await r.createWritable({keepExistingData:!1});await c.write(l),await c.close()})}catch{return}break;case"glb":try{const r=await showSaveFilePicker({types:[{accept:{"application/object":[".glb"]}}]});await i(async function(o){const a=s(),c=await new F1().parseAsync(a,{onlyVisible:!0,binary:!0});await o();const h=await r.createWritable({keepExistingData:!1});await h.write(c),await h.close()})}catch{return}break;default:return}}u(Gk,"exportModel");Gg(Gk,"exportModel");var j1e=Object.defineProperty,Hg=u((n,e)=>j1e(n,"name",{value:e,configurable:!0}),"__name$9");const xn=new P,So=new qe,xg=new P(1,0,0),Vd=new P(0,1,0),cT=new P(0,0,1);function Hk(n,e,t){e=rt(e);let s;if(e.type==="IKNode"){const a=e.parent,l=a.children.findIndex(c=>c.id===e.id);if(l){const h=a.children[l-1].get(Et);s=new qe().copy(h.quaternion).invert()}}i(e,new P,new P(0,0,1),new be,new be,new be,s);function i(a,l,c,h,d,f,p){const g=a.getLocalMatrix(),m=new P,v=new qe,y=new P;if(!(a.has(nn)&&a.value(nn))){g.decompose(m,v,y);const _=new be().multiplyMatrices(h,g);if(t==="flip"){const M=ko(xn,v);xn.applyMatrix4(h),xn.sub(l),xn.reflect(c),xn.add(l),xn.applyMatrix4(f),xn.normalize(),v.setFromAxisAngle(xn,-M),m.applyMatrix4(h),m.sub(l),m.reflect(c),m.add(l),m.applyMatrix4(f)}else xg.set(1,0,0).applyQuaternion(v),Vd.set(0,1,0).applyQuaternion(v),xg.z=0,xg.normalize(),Vd.z=0,Vd.normalize(),cT.crossVectors(xg,Vd).normalize(),Ua(v,cT,Vd),m.z=0;a.has(nt)&&n.history.setValue(a,nt,new ft().setFromQuaternion(v)),a.has(En)&&(p?So.multiplyQuaternions(p,v):So.copy(v),n.history.setValue(a,En,new ft().setFromQuaternion(So)));const w=new be().compose(m,v,y);w.multiplyMatrices(d,w);const x=new be().copy(w).invert(),S=new Set;let C;for(let M of a.children){if(S.has(M.id))continue;S.add(M.id);const R=o(M,a);if(R){S.add(R.id);let D=M,k=R;M.has(ze)&&M.value(ze).z>0&&(k=M,D=R),r(l,c,D,h,d,f,C,k,h,d,f,C)}else{const{rotation:D}=i(M,l,c,_,w,x,C);C=new qe().copy(D).invert()}}}return{rotation:v}}u(i,"processMiddleNode"),Hg(i,"processMiddleNode");function r(a,l,c,h,d,f,p,g,m,v,y,b){const _=c.getLocalMatrix(),w=new P,x=new qe,S=new P;_.decompose(w,x,S);const C=new be().multiplyMatrices(h,_),M=g.getLocalMatrix(),R=new P,D=new qe,k=new P;M.decompose(R,D,k);const T=new be().multiplyMatrices(m,M);if(!(e.has(nn)&&e.value(nn))){if(t==="flip"||t==="left-to-right"){const se=ko(xn,x);xn.applyMatrix4(h),xn.sub(a),xn.reflect(l),xn.add(a),xn.applyMatrix4(f),xn.normalize(),x.setFromAxisAngle(xn,-se),w.applyMatrix4(h),w.sub(a),w.reflect(l),w.add(a),w.applyMatrix4(f),g.has(nt)&&n.history.setValue(g,nt,new ft().setFromQuaternion(x)),g.has(En)&&(p?So.multiplyQuaternions(p,x):So.copy(x),n.history.setValue(g,En,new ft().setFromQuaternion(So)))}if(t==="flip"||t==="right-to-left"){const se=ko(xn,D);xn.applyMatrix4(m),xn.sub(a),xn.reflect(l),xn.add(a),xn.applyMatrix4(y),xn.normalize(),D.setFromAxisAngle(xn,-se),R.applyMatrix4(m),R.sub(a),R.reflect(l),R.add(a),R.applyMatrix4(y),c.has(nt)&&n.history.setValue(c,nt,new ft().setFromQuaternion(D)),c.has(En)&&(b?So.multiplyQuaternions(b,D):So.copy(D),n.history.setValue(c,En,new ft().setFromQuaternion(So)))}const E=new be().compose(w,x,S);E.multiplyMatrices(d,E);const z=new be().copy(E).invert(),H=new be().compose(R,D,k);H.multiplyMatrices(v,H);const q=new be().copy(H).invert();let ne,W;for(let se of c.children){const K=o(se,g);if(K){const{rotationLeft:U,rotationRight:he}=r(a,l,se,C,E,z,ne,K,T,H,q,W);ne=new qe().copy(U).invert(),W=new qe().copy(he).invert()}}}return{rotationLeft:x,rotationRight:D}}u(r,"processMirrorNode"),Hg(r,"processMirrorNode");function o(a,l){var d;if(a.type==="IKNode"&&((d=a.parent)==null?void 0:d.id)===l.id)return null;const c=a.has(ze)?a.value(ze):null;if(a.has(Xn)){for(let f of l.children)if(a.id!==f.id&&a.type===f.type&&(a.instanceId===f.id||a.instanceId===f.instanceId)&&(!c||h(c,f.value(ze))))return f}else for(let f of l.children)if(a.id!==f.id&&a.type===f.type&&f.has(Xn)&&(f.instanceId===a.id||f.instanceId===a.instanceId)&&(!c||h(c,f.value(ze))))return f;return null;function h(f,p){return Math.abs(f.x-p.x)<1e-8&&Math.abs(f.y-p.y)<1e-8&&Math.abs(f.z+p.z)<1e-8}}u(o,"findMirrorNode"),Hg(o,"findMirrorNode")}u(Hk,"flipNode");Hg(Hk,"flipNode");var X1e=Object.defineProperty,Y1e=u((n,e)=>X1e(n,"name",{value:e,configurable:!0}),"__name$8");const Wk=2016834916,jk=2,Ag=new DataView(new ArrayBuffer(8));class RA{constructor(){A(this,"buffer",new Uint8Array(64));A(this,"size",0)}expandCapacity(e){const t=e+this.size;if(this.buffer.length<t){const s=new Uint8Array(Math.pow(2,Math.ceil(Math.log2(t))));for(let i=0,r=this.size;i<r;++i)s[i]=this.buffer[i];this.buffer=s}}writeUint32(e){this.expandCapacity(4),Ag.setUint32(0,e);for(let t=0;t<4;++t)this.buffer[this.size+t]=Ag.getUint8(t);this.size+=4}writeFloat64(e){this.expandCapacity(8),Ag.setFloat64(0,e);for(let t=0;t<8;++t)this.buffer[this.size+t]=Ag.getUint8(t);this.size+=8}writeBoolean(e){this.writeUint32(e?1:0)}writeString(e){const s=new TextEncoder().encode(e);this.writeUint32(s.length),this.expandCapacity(s.length);for(let i=0,r=s.length;i<r;++i)this.buffer[this.size+i]=s[i];this.size+=s.length}writeBytes(e){this.writeUint32(e.length),this.expandCapacity(e.length);for(let t=0,s=e.length;t<s;++t)this.buffer[this.size+t]=e[t];this.size+=e.length}writeNumberArray(e){this.writeUint32(e.length);for(let t of e)this.writeFloat64(t)}write(e){e=e.readonlyRef(),this.writeUint32(Wk),this.writeUint32(jk);for(let s of e.views)this.writeFloat64(s.zoomLevel),this.writeFloat64(s.camera.alpha),this.writeFloat64(s.camera.beta),this.writeFloat64(s.camera.target.x),this.writeFloat64(s.camera.target.y),this.writeFloat64(s.camera.target.z),this.writeBoolean(s.index===e.mainViewIndex?e.model.cameraPerspective:s.camera.perspective),this.writeFloat64(s.camera.perspectiveCamera.fov);const t=e.model;this.writeUint32(t.cameras.length);for(let s of t.cameras)this.writeString(s.name),this.writeFloat64(s.zoomLevel),this.writeFloat64(s.alpha),this.writeFloat64(s.beta),this.writeFloat64(s.target[0]),this.writeFloat64(s.target[1]),this.writeFloat64(s.target[2]),this.writeBoolean(s.perspective),this.writeFloat64(s.fov);return e.model.forEach(s=>{var r;this.writeUint32(s.id),this.writeString(s.type),this.writeBoolean(s.expanded),this.writeUint32(((r=s.parent)==null?void 0:r.id)||0),this.writeUint32(s.instanceId);const i=[];for(let o in s.components){const a=s.components[o],l=ti(o);if(l.storable){if(s.instanceId&&!l.instanceable)continue;const c=l.serialize?l.serialize(a.value):a.value;c!=null&&i.push([l.dataType,o,c])}}this.writeUint32(i.length);for(let o of i){const a=o[0],l=o[1],c=o[2];switch(this.writeUint32(a),this.writeString(l.substring(1)),a){case ke.NUMBER:this.writeFloat64(c);break;case ke.STRING:this.writeString(c);break;case ke.BOOLEAN:this.writeBoolean(c);break;case ke.NUMBER_ARRAY:this.writeNumberArray(c);break;case ke.BYTES:this.writeBytes(c);break;default:throw new Error(`Unimplemented data type of component [${l}]`)}}}),this}getBytes(){return this.buffer.subarray(0,this.size)}}u(RA,"ProjectWriter");Y1e(RA,"ProjectWriter");var q1e=Object.defineProperty,K1e=u((n,e)=>q1e(n,"name",{value:e,configurable:!0}),"__name$7");const Mg=new DataView(new ArrayBuffer(8));class z1{constructor(e){A(this,"buffer");A(this,"index",0);this.buffer=e}end(){return this.index>=this.buffer.length}readUint32(){for(let t=0;t<4;++t)Mg.setUint8(t,this.buffer[this.index+t]);const e=Mg.getUint32(0);return this.index+=4,e}readFloat64(){for(let t=0;t<8;++t)Mg.setUint8(t,this.buffer[this.index+t]);const e=Mg.getFloat64(0);return this.index+=8,e}readBoolean(){return!!this.readUint32()}readString(){const e=new TextDecoder,t=this.readUint32(),s=this.buffer.subarray(this.index,this.index+t),i=e.decode(s);return this.index+=t,i}readBytes(){const e=this.readUint32(),t=this.buffer.subarray(this.index,this.index+e);return this.index+=e,t}readNumberArray(){const e=this.readUint32(),t=[];for(let s=0;s<e;++s)t.push(this.readFloat64());return t}read(){if(this.readUint32()!==Wk)throw new Error("Failed to read magic header");const t=this.readUint32();if(t>jk)throw new Error("Unknown file version");const s={views:[],cameras:[],nodes:[]};for(let i=0;i<4;++i){const r=this.readFloat64(),o=this.readFloat64(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),h=this.readFloat64();let d=i===1,f=45;t>=2&&(d=this.readBoolean(),f=this.readFloat64()),s.views.push({zoomLevel:r,alpha:o,beta:a,target:[l,c,h],perspective:d,fov:f})}if(t>=2){const i=this.readUint32();for(let r=0;r<i;++r){const o=this.readString(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),h=this.readFloat64(),d=this.readFloat64(),f=this.readFloat64(),p=this.readBoolean(),g=this.readFloat64();s.cameras.push({name:o,zoomLevel:a,alpha:l,beta:c,target:[h,d,f],perspective:p,fov:g})}}for(;!this.end();){const i=this.readUint32(),r=this.readString(),o=this.readBoolean(),a=this.readUint32(),l=this.readUint32(),c=this.readUint32(),h={};for(let d=0;d<c;++d){const f=this.readUint32(),p="C"+this.readString();let g;switch(f){case ke.NUMBER:g=this.readFloat64();break;case ke.STRING:g=this.readString();break;case ke.BOOLEAN:g=this.readBoolean();break;case ke.NUMBER_ARRAY:g=this.readNumberArray();break;case ke.BYTES:g=this.readBytes();break;default:throw new Error(`Unimplemented data type [${f}]`)}if(NR(p)){const m=ti(p);m.deserialize&&(g=m.deserialize(g)),h[p]=g}}s.nodes.push({id:i,type:r,expanded:o,parentId:a,instanceId:l,data:h})}return s}}u(z1,"ProjectReader");K1e(z1,"ProjectReader");var Z1e=Object.defineProperty,Q1e=u((n,e)=>Z1e(n,"name",{value:e,configurable:!0}),"__name$6");async function Xk(n,e,t,s){let i=null;const r=[t,{description:"Wavefront",accept:{"application/object":[".obj"]}},{description:"FBX",accept:{"application/fbx":[".fbx"]}},{description:"Image",accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".jfif",".pjpeg",".pjp"],"image/bmp":[".bmp"],"image/webp":[".webp"]}}];try{[i]=await showOpenFilePicker({types:[{description:"All Supported",accept:r.reduce((o,a)=>Object.assign(o,a.accept),{})},...r],multiple:!1})}catch{return}try{n.statusBarMessage="Loading...",e.value=!0,await Ri();const o=await i.getFile(),a=o.name.substring(o.name.lastIndexOf(".")).toLowerCase();switch(a){case s:{const l=new z1(new Uint8Array(await o.arrayBuffer())).read(),c={};let h=n.history.getNextNodeId()+1;for(let p of l.nodes)c[p.id]=h++;const d={};for(let p of l.nodes)d[p.id]={originId:p.id,type:p.type,data:p.data,expanded:p.expanded,instanceId:p.instanceId?c[p.instanceId]:0};const f=[];for(let p of l.nodes)if(p.parentId){const g=d[p.parentId];g.children=g.children||[],g.children.push(d[p.id])}else f.push(d[p.id]);for(let p of f)n.history.createNode(p)}break;case".obj":{const l=await o.text();n.history.createNode({type:"ObjModel",data:{[Vo.name]:l,[Qi.name]:!0}})}break;case".fbx":{const l=await o.arrayBuffer(),c=await Wu(new Blob([l]));n.history.createNode({type:"FbxModel",data:{[$o.name]:c,[Qi.name]:!0}})}break;case".jpg":case".jpeg":case".jfif":case".pjpeg":case".pjp":case".png":case".apng":case".gif":case".avif":case".webp":case".bmp":{const l=await o.arrayBuffer(),c=await Wu(new Blob([l]));n.history.createNode({type:"Image",data:{[Kr.name]:c}})}break;default:await yf(`Unsupported file format ${a}`)}focus(),n.statusBarMessage=""}catch(o){console.error(o),n.statusBarMessage="Failed to import file: "+o}finally{e.value=!1}}u(Xk,"importModel");Q1e(Xk,"importModel");var J1e=Object.defineProperty,eve=u((n,e)=>J1e(n,"name",{value:e,configurable:!0}),"__name$5");const Gd=new P,Sg=new P,Cg=new P,uT=new P,hT=new P,dT=new P,Eg=new P,r_=new P,o_=new P,fT=new P,Tg=new P,pT=new P,a_=new P,l_=new P(1,0,0);function Yk(n,e,t,s,i=.005){const r=Math.max(s.max.x-s.min.x,s.max.y-s.min.y,s.max.z-s.min.z),o=r/(Math.ceil(r/i)+.5),a=1/o,l=n.length/9,c=s.min.x-o,h=s.min.y-o,d=s.min.z-o,f=s.max.x+o,p=s.max.y+o,g=s.max.z+o,m=Math.floor(c*a),v=Math.floor(h*a),y=Math.floor(d*a),b=Math.ceil(f*a),_=Math.ceil(p*a),w=Math.ceil(g*a),x=b-m,S=_-v,C=w-y,M=x*S*C,R=new Float32Array(M),D=new Float32Array(M*3);for(let U=0;U<M;++U)R[U]=o;const k=new Yr(M),T=new Yr(M*3);for(let U=0;U<l;++U){const he=t[U*6]-o,ue=t[U*6+1]-o,Q=t[U*6+2]-o,te=t[U*6+3]+o,_e=t[U*6+4]+o,pe=t[U*6+5]+o,Ae=Math.floor(he*a),Me=Math.floor(ue*a),Ie=Math.floor(Q*a),$=Math.ceil(te*a),X=Math.ceil(_e*a),I=Math.ceil(pe*a),J=$-Ae,Z=X-Me,B=I-Ie;Gd.fromArray(n,U*9),Sg.fromArray(n,U*9+3),Cg.fromArray(n,U*9+6),uT.fromArray(e,U*9),hT.fromArray(e,U*9+3),dT.fromArray(e,U*9+6),Eg.addVectors(uT,hT).add(dT).multiplyScalar(1/3),r_.subVectors(Sg,Gd),o_.subVectors(Cg,Gd),fT.subVectors(Cg,Sg);for(let F=0;F<J;++F){const V=F+Ae-m,ae=c+V*o;for(let oe=0;oe<Z;++oe){const L=oe+Me-v,O=h+L*o;for(let ee=0;ee<B;++ee){const ie=ee+Ie-y,ce=d+ie*o,ye=V*S*C+L*C+ie;Tg.set(ae,O,ce),cG(pT,Tg,Gd,Sg,Cg,r_,o_,fT),a_.subVectors(pT,Tg);const Ce=a_.length();if(!(Ce>o)){k.set(ye),Ce<=R[ye]&&(R[ye]=Ce,D[ye*3]=Eg.x,D[ye*3+1]=Eg.y,D[ye*3+2]=Eg.z);for(let Te=0;Te<3;++Te){const ve=a_.getComponent(Te);if(ve<0||ve>o)continue;const Ge=ye*3+Te;if(T.get(Ge))continue;l_.set(0,0,0),l_.setComponent(Te,1);const Xe=uG(Tg,l_,Gd,r_,o_);Xe<0||Xe>o||T.set(Ge)}}}}}}const N=new Yr(R.length),E=[0],z=S*C,H=C,q=1,ne=[-z,+z,-H,+H,-q,+q],W=[0,0,1,1,2,2];for(;E.length;){const U=E.pop();if(U==null)break;if(k.get(U)){let he=!1;for(let ue=0;ue<6;++ue){const Q=ne[ue],te=U+Q;te<0||te>=M||N.get(te)||!k.get(te)||(T.get((Q>0?U:te)*3+W[ue])?he=!0:(N.set(te),E.push(te)))}he&&N.set(U)}else{N.set(U);for(let he=0;he<6;++he){const ue=U+ne[he];ue<0||ue>=M||N.get(ue)||(N.set(ue),E.push(ue))}}}for(let U=0;U<M;++U)N.get(U)||(R[U]=-R[U]);const se=[],K=[];for(let U=0;U<x-1;++U){const he=c+U*o;for(let ue=0;ue<S-1;++ue){const Q=h+ue*o;for(let te=0;te<C-1;++te){const _e=d+te*o;nx(se,null,K,he,Q,_e,o,R,D,U*S*C+ue*C+te,(U+1)*S*C+ue*C+te,(U+1)*S*C+ue*C+(te+1),U*S*C+ue*C+(te+1),U*S*C+(ue+1)*C+te,(U+1)*S*C+(ue+1)*C+te,(U+1)*S*C+(ue+1)*C+(te+1),U*S*C+(ue+1)*C+(te+1))}}}return{position:new Float32Array(se),color:new Float32Array(K)}}u(Yk,"voxelizeRemesh");eve(Yk,"voxelizeRemesh");var tve=Object.defineProperty,nve=u((n,e)=>tve(n,"name",{value:e,configurable:!0}),"__name$4");async function qk(n,e,t,s){const i=await fetch(n);if(!i.body)throw new Error("Failed to get response body");const r=i.body.getReader();s||(s=Number.parseInt(i.headers.get("Content-Length")||"0"));let o=0;const a=[];for(;;){const{done:h,value:d}=await r.read();if(h||!d)break;if(a.push(d),o+=d.length,e(o,s),t!=null&&t.value)return await r.cancel(),r.releaseLock(),null}const l=new Uint8Array(o);let c=0;for(let h of a)l.set(h,c),c+=h.length;return l}u(qk,"progressiveDownload");nve(qk,"progressiveDownload");var sve=Object.defineProperty,ive=u((n,e)=>sve(n,"name",{value:e,configurable:!0}),"__name$3");class IA{constructor(e){A(this,"running",!1);A(this,"keepLoop",!1);A(this,"lastTimestamp",0);A(this,"onUpdate");this.onUpdate=e}start(){this.running||(this.running=!0,this.keepLoop=!0,this.lastTimestamp=new Date().valueOf(),requestAnimationFrame(()=>this.loop()))}stop(){this.keepLoop=!1}loop(){const e=new Date().valueOf();try{this.keepLoop&&this.onUpdate(Math.max(e-this.lastTimestamp,1)/1e3)}catch(t){throw this.running=!1,this.keepLoop=!1,t}this.lastTimestamp=e,this.keepLoop?requestAnimationFrame(()=>this.loop()):this.running=!1}}u(IA,"RenderLoop");ive(IA,"RenderLoop");var rve=Object.defineProperty,ove=u((n,e)=>rve(n,"name",{value:e,configurable:!0}),"__name$2");const ave="gYxItIxQuvELUDHlN23TLnKHSMC47FjIJmWce1uK",lve=`https://sketchfab.com/oauth2/authorize/?response_type=token&client_id=${ave}`,c_="sketchfab-token",Kk=Oo({token:{accessToken:"",expires:0},user:{displayName:"",username:""},loadLocalStorage(){const n=localStorage.getItem(c_);if(!n)return;const e=JSON.parse(n);if(e.expires>Date.now())try{this.getUser(),this.token=e}catch(t){console.error(t)}},login(){window.location.replace(lve)},logout(){this.token={accessToken:"",expires:0},localStorage.removeItem(c_)},parseRouterPath(n){n=n||"",n.startsWith("/")&&(n=n.substring(1));const e=n.split("&"),t={accessToken:"",expires:0};for(let s of e){const i=s.split("=");if(i.length<2)continue;const r=i[0],o=i[1];switch(r){case"access_token":t.accessToken=o;break;case"expires_in":t.expires=Number.parseInt(o)*1e3+Date.now();break}}t.accessToken&&t.accessToken!==this.token.accessToken&&(this.token=t,localStorage.setItem(c_,JSON.stringify(t)),this.getUser())},async fetch(n,e="get"){return fetch(n,{method:e,headers:{Authorization:`Bearer ${this.token.accessToken}`},mode:"cors"})},async getUser(){const n=await this.fetch("https://api.sketchfab.com/v3/me");this.user=await n.json()},async getModelDownloadUrl(n){var r,o,a,l;const e=new URL(n).pathname.split("-"),t=e[e.length-1];if(!t)return;const s=await(await this.fetch(`https://api.sketchfab.com/v3/models/${t}/download`)).json(),i=await(await this.fetch(`https://api.sketchfab.com/v3/models/${t}`)).json();return{download:s,info:{name:i==null?void 0:i.name,url:i==null?void 0:i.viewerUrl,license:{name:(r=i==null?void 0:i.license)==null?void 0:r.label,url:(o=i==null?void 0:i.license)==null?void 0:o.url},user:{name:(a=i==null?void 0:i.user)==null?void 0:a.displayName,url:(l=i==null?void 0:i.user)==null?void 0:l.profileUrl}}}}});Kk.loadLocalStorage();function Zk(){return Kk}u(Zk,"useSketchfabClient");ove(Zk,"useSketchfabClient");var cve=Object.defineProperty,Qk=u((n,e)=>cve(n,"name",{value:e,configurable:!0}),"__name$1");function Jk(n,e=300){let t=Date.now(),s=0;function i(){const r=Date.now();s+=r-t,t=r;const o=Math.min(1,s/e);n(o),o<1&&requestAnimationFrame(i)}u(i,"step"),Qk(i,"step"),i()}u(Jk,"createTransitionAnimation");Qk(Jk,"createTransitionAnimation");var uve=Object.defineProperty,lt=u((n,e)=>uve(n,"name",{value:e,configurable:!0}),"__name");const Wg=".doll",u_={description:"Figure Doll Model",accept:{"application/figure-doll-editor":[Wg]}},mT="figure-doll-editor-options";var hve=Ht({components:{ColorPicker:TR,FullscreenLoading:dV,InputBoolean:Er,InputNumber:rs,InputRange:Xo,LabelRange:FV,AccordionGroup:GV,CollapsiblePanel:tG,ModelNodeProperties:y0e,ModelTree:z0e,PopupDialog:O1,PopupMenu:hw,PopupMenuItem:Mk,QuadView:a1e,SidePanel:f1e},setup(){const n=$F(),e=Zk(),t=Ne(),s=Ne(),i=new IA(function(){var re;(re=s.value)==null||re.update()}),r=Ne({showTools:!0,showModelTree:!0,showProperties:!0,showStatusBar:!0,modelTreePanelWidth:200,modelNodePropertiesPanelWidth:200,colorPanelX:250,colorPanelY:50,depthMapPanelX:250,depthMapPanelY:50,edgePanelX:250,edgePanelY:50,sdPanelX:250,sdPanelY:50,sdResultPanelX:250,sdResultPanelY:250}),o=Ne(!1),a=Ne(null);let l=null;const c=ct(function(){var G;const re=(G=s.value)==null?void 0:G.model;return re?re.selected.length===0?dD.filter(le=>!le.canBeRoot||!le.showInList?!1:le.unique?!re.nodes.find(de=>de.type===le.name):!0):re.selected.length>1?[]:fw(re.getSelectedNodes()[0]).filter(le=>le.showInList):[]}),h=ct(function(){var G;const re=(G=s.value)==null?void 0:G.model;return re?re.getSelectedNodes().filter(le=>!kn(le.type).fixed).length:!1});Ts([a,()=>{var re,G;return(G=(re=s.value)==null?void 0:re.history)==null?void 0:G.dirty}],function([re,G]){re&&re.endsWith(Wg)&&(re=re.substring(0,re.length-Wg.length)),document.title=(re||"Untitled")+(G?"*":"")+" - Figure Doll Editor"},{immediate:!0}),Ts([r,()=>{var re;return(re=s.value)==null?void 0:re.options}],function(){var re;localStorage.setItem(mT,JSON.stringify({ui:r.value,options:(re=s.value)==null?void 0:re.options}))},{deep:!0}),D0(async function(){"showOpenFilePicker"in window||await yf(`This application is only available in Chrome or Edge.
Cannot open or save files in the current browser.`),e.parseRouterPath(n.currentRoute.value.fullPath),n.currentRoute.value.fullPath.length>1&&await n.push("/")});function d(){var re;(re=t.value)==null||re.focus()}u(d,"focus"),lt(d,"focus");function f(re,G,le,de,ge){s.value=new wp(re,G,le,de,ge);try{const Re=localStorage.getItem(mT);if(Re){const st=JSON.parse(Re);if("ui"in st&&Object.assign(r.value,st.ui),"options"in st){Object.assign(s.value.options,st.options);for(let pt in s.value.options.tools){const Pt=s.value.options.tools[pt],os=s.value.tools.find(Yt=>Yt.constructor.name===pt);if(os)for(let Yt in Pt)os[Yt]=Pt[Yt]}}}}catch(Re){console.error(Re)}i.start(),window.ctx=s.value.readonlyRef()}u(f,"onCanvasMounted"),lt(f,"onCanvasMounted");function p(){var re;(re=s.value)==null||re.dispose(),s.value=void 0}u(p,"onBeforeCanvasUnmount"),lt(p,"onBeforeCanvasUnmount");function g(re){var G;((G=re==null?void 0:re.target)==null?void 0:G.tagName)!=="INPUT"&&(s.value.history.undo(),d())}u(g,"onUndo"),lt(g,"onUndo");function m(re){var G;((G=re==null?void 0:re.target)==null?void 0:G.tagName)!=="INPUT"&&(s.value.history.redo(),d())}u(m,"onRedo"),lt(m,"onRedo");async function v(){return s.value.history.dirty?await Sk(`Unsaved changes will be lost.
Are you sure you want to continue?`):!0}u(v,"historyConfirm"),lt(v,"historyConfirm");async function y(){await v()&&(a.value=null,l=null,s.value.reset(),d(),s.value.statusBarMessage="")}u(y,"onNew"),lt(y,"onNew");async function b(){try{[l]=await showOpenFilePicker({types:[u_],multiple:!1})}catch{return}if(await v())try{s.value.statusBarMessage="Loading...",o.value=!0,await Ri();const re=await l.getFile();a.value=re.name;const G=new z1(new Uint8Array(await re.arrayBuffer())).read();s.value.load(G),d(),s.value.statusBarMessage=""}catch(re){console.error(re),s.value.statusBarMessage="Failed to open file."}finally{o.value=!1}}u(b,"onOpen"),lt(b,"onOpen");async function _(){await Xk(s.value,o,u_,Wg)}u(_,"onImport"),lt(_,"onImport");async function w(re){await Gk(s.value,o,re)}u(w,"onExport"),lt(w,"onExport");async function x(re){re!=null&&re.shiftKey?await S():(l?await C():await S(),d())}u(x,"onSave"),lt(x,"onSave");async function S(){try{l=await showSaveFilePicker({types:[u_],suggestedName:a.value||void 0})}catch{return}const re=await l.getFile();a.value=re.name,await C(),d()}u(S,"onSaveAs"),lt(S,"onSaveAs");async function C(){if(!!l)try{s.value.statusBarMessage="Saving...",o.value=!0,await Ri();const re=await l.createWritable({keepExistingData:!1}),G=new RA().write(s.value).getBytes();s.value.statusBarMessage="Writing files...",await Ri(),await re.write(G),await re.close(),s.value.history.save(),s.value.statusBarMessage="File saved."}catch{s.value.statusBarMessage="Failed to save file."}finally{o.value=!1}}u(C,"saveFile"),lt(C,"saveFile");function M(re){const G=s.value,de=G.views[G.mainViewIndex].camera;let ge=de.alpha,Re=de.beta;switch(re){case"front":ge=0,Re=-Math.PI/2,Math.abs(ge-de.alpha)<1e-8&&Math.abs(Re-de.beta)<1e-8&&(ge=0,Re=+Math.PI/2);break;case"back":ge=0,Re=+Math.PI/2,Math.abs(ge-de.alpha)<1e-8&&Math.abs(Re-de.beta)<1e-8&&(ge=0,Re=-Math.PI/2);break;case"top":ge=-Math.PI/2,Re=-Math.PI/2,Math.abs(ge-de.alpha)<1e-8&&Math.abs(Re-de.beta)<1e-8&&(ge=+Math.PI/2,Re=-Math.PI/2);break;case"bottom":ge=+Math.PI/2,Re=-Math.PI/2,Math.abs(ge-de.alpha)<1e-8&&Math.abs(Re-de.beta)<1e-8&&(ge=-Math.PI/2,Re=-Math.PI/2);break;case"right":ge=0,Re=0,Math.abs(ge-de.alpha)<1e-8&&Math.abs(Re-de.beta)<1e-8&&(ge=0,Re=Math.PI);break;case"left":ge=0,Re=Math.PI,Math.abs(ge-de.alpha)<1e-8&&Math.abs(Re-de.beta)<1e-8&&(ge=0,Re=0);break}const st=ge-de.alpha,pt=Re-de.beta;Jk(function(Pt){de.alpha=ge-st*(1-Pt),de.beta=Re-pt*(1-Pt)},100)}u(M,"onSetView"),lt(M,"onSetView");function R(re,G,le){s.value.history.setValue(re,G,le)}u(R,"onSetValue"),lt(R,"onSetValue");function D(re,G){re=rt(re);const le=s.value;let ge=rt(le.model).getSelectedNodes();const Re=G==="before"||G==="after"?re.parent:re;ge=ge.filter(pt=>{let Pt=!0,os=pt.parent;for(;Pt&&os;){if(!os.expanded){Pt=!1;break}os=os.parent}return!Pt||pt.parent&&ge.includes(pt.parent)?!1:!kn(pt.type).fixed});for(let pt of ge)if(!st(Re,pt))return;for(let pt of ge){const Pt=le.options.keepTransformUnchangedWhileMoving;G==="before"||G==="after"?le.history.moveNode(pt,Re,re,G==="after",Pt):le.history.moveNode(pt,Re,null,G==="atLast",Pt)}function st(pt,Pt){const os=kn(Pt.type);if(!pt)return os.canBeRoot;if(!pt.isValidChild(Pt.type))return!1;for(;pt;pt=pt.parent)if(pt.id===Pt.id)return!1;return!0}u(st,"isValidChild"),lt(st,"isValidChild")}u(D,"onMoveNode"),lt(D,"onMoveNode");function k(re){const G=s.value.model,le=G.selected[0];G.selected=[];const de={type:re,parentId:le},ge=kn(re);ge.defaultData&&(de.data=ge.defaultData),ge.defaultChildren&&(de.children=ge.defaultChildren),s.value.history.createNode(de),d()}u(k,"onAddNode"),lt(k,"onAddNode");function T(re){var de;if((re==null?void 0:re.key)==="Backspace"||((de=re==null?void 0:re.target)==null?void 0:de.tagName)==="INPUT"||!s.value.tool.enableDefaultDeleteShortcut&&(re==null?void 0:re.key)==="Delete")return;const le=s.value.model.getTopmostSelectedNodes();for(let ge of le)kn(ge.type).fixed||s.value.history.removeNode(ge.id);d()}u(T,"onDelete"),lt(T,"onDelete");function N(re){s.value.nextFrameEnd(function(){s.value.model.selected=re})}u(N,"onSelect"),lt(N,"onSelect");function E(re){const G=new Set;for(let le of re){let de=le.node;de.instanceId&&(ti(le.type.name).instanceable||(de=s.value.model.getNode(de.instanceId)));const ge=`${de.id}#${le.type.name}`;G.has(ge)||(G.add(ge),s.value.history.setValue(de,le.type,le.value))}}u(E,"onSetNodesProperties"),lt(E,"onSetNodesProperties");function z(re){if(!re)return;const G=new P;if(tc(G,re.getWorldMatrix()),re.has(Pe)){const le=re.value(Pe);if(le){const de=le.geometry;de&&(de.boundingSphere||de.computeBoundingSphere(),G.copy(de.boundingSphere.center),G.applyMatrix4(re.getWorldMatrix()))}}for(let le of s.value.views)le.camera.target.copy(G)}u(z,"onFocus"),lt(z,"onFocus");async function H(re){await Ck(s.value,re)&&d()}u(H,"onCut"),lt(H,"onCut");async function q(re){await PA(s.value,re)&&d()}u(q,"onCopy"),lt(q,"onCopy");async function ne(re){await Ek(s.value,re)&&d()}u(ne,"onPaste"),lt(ne,"onPaste");function W(re){Tk(s.value,re)}u(W,"onConvertToClay"),lt(W,"onConvertToClay");function se(re){re=rt(re);const G=s.value,le=re.getLocalMatrix(),de=re.cloneValue(Mn),ge=new P;for(let Re=0,st=de.length;Re<st;Re+=3)ge.fromArray(de,Re),ge.applyMatrix4(le),de[Re]=ge.x,de[Re+1]=ge.y,de[Re+2]=ge.z;G.history.setValue(re,Mn,de),G.history.setValue(re,ze,new P),G.history.setValue(re,nt,new ft),G.history.setValue(re,Wt,1)}u(se,"onApplyTransformation"),lt(se,"onApplyTransformation");const K=ct(function(){const re=s.value;if(!re)return!1;const G=re.model.selected[0];return G?re.model.getNode(G).type==="Clay":!1});async function U(){var Re;const re=(Re=s.value)==null?void 0:Re.readonlyRef();if(!re)return;const G=re.model.selected[0];if(!G)return;const le=re.model.getNode(G),ge=le.get(Pe).mesh;if(!!ge)try{o.value=!0,await Ri(),await new Promise(function(pt){setTimeout(pt,50)});const st=Yk(ge.aPosition,ge.aColor,ge.triBox,ge.octree.box,re.options.remeshVoxelSize);re.history.enableMerge=!1,re.history.setValue(le,Mn,st.position,"remesh-position"),re.history.setValue(le,Mr,st.color,"remesh-color")}finally{o.value=!1}}u(U,"onRemesh"),lt(U,"onRemesh");function he(re,G){Dk(s.value,re,G)}u(he,"onCreateInstance"),lt(he,"onCreateInstance");function ue(re,G){Hk(s.value,re,G)}u(ue,"onFlip"),lt(ue,"onFlip");function Q(re){return Pk(re)}u(Q,"onCopyPose"),lt(Q,"onCopyPose");function te(re){return Rk(s.value,re)}u(te,"onPastePose"),lt(te,"onPastePose");function _e(re){const G=s.value,le=G.model,de=G.views[G.mainViewIndex];de.zoomLevel=re.zoomLevel,de.camera.alpha=re.alpha,de.camera.beta=re.beta,de.camera.target.set(re.target[0],re.target[1],re.target[2]),le.cameraPerspective=re.perspective,le.cameraFov=re.fov}u(_e,"onLoadCamera"),lt(_e,"onLoadCamera");function pe(re){s.value.model.cameras.splice(re,1),s.value.history.dirty=!0}u(pe,"onDeleteCamera"),lt(pe,"onDeleteCamera");function Ae(){const re=s.value,G=re.model,le=re.views[re.mainViewIndex];G.cameras.push({name:new Date().toISOString().replace("T"," ").replace(/\.[0-9]+Z/,""),zoomLevel:le.zoomLevel,alpha:le.camera.alpha,beta:le.camera.beta,target:[le.camera.target.x,le.camera.target.y,le.camera.target.z],perspective:G.cameraPerspective,fov:G.cameraFov}),re.history.dirty=!0}u(Ae,"onSaveCamera"),lt(Ae,"onSaveCamera");const Me=Ne("");async function Ie(){await v()&&e.login()}u(Ie,"onSketchfabLogin"),lt(Ie,"onSketchfabLogin");function $(){e.logout()}u($,"onSketchfabLogout"),lt($,"onSketchfabLogout");const X=Ne(!1),I=Ne(""),J=Ne(""),Z=Ne(!1),B=Ne(0);async function F(){var re;if(!!Me.value)try{s.value.statusBarMessage="Fetching model download url...",o.value=!0;const{info:G,download:le}=await e.getModelDownloadUrl(Me.value);if((re=le.gltf)!=null&&re.url){Me.value="",s.value.statusBarMessage="Downloading model...",o.value=!1,X.value=!0,Z.value=!1,B.value=0,I.value="0.0MB",J.value=(le.gltf.size/1024/1024).toFixed(1)+"MB";const de=await qk(le.gltf.url,(ge,Re)=>{B.value=Math.round(ge/Re*100),I.value=(ge/1024/1024).toFixed(1)+"MB"},Z,le.gltf.size);if(!de){s.value.statusBarMessage="Download canceled.";return}s.value.history.createNode({type:"ImportModel",data:{[zt.name]:G.name,[kf.name]:G,[Go.name]:de}}),s.value.statusBarMessage="Model imported."}else s.value.statusBarMessage="Failed to download model.",le.detail?await yf("Could not download model: "+le.detail):await yf("Failed to get model download url.")}catch{s.value.statusBarMessage="Failed to import model."}finally{o.value=!1,X.value=!1}}u(F,"onSketchfabImportModel"),lt(F,"onSketchfabImportModel");function V(){window.open("https://github.com/x6ud/figure-doll-editor/issues")}u(V,"onOpenFeedback"),lt(V,"onOpenFeedback");function ae(){window.open("https://github.com/x6ud/figure-doll-editor#download-models")}u(ae,"onOpenTutorial"),lt(ae,"onOpenTutorial");const oe=Ne(),L=Ne(),O=Ne(),ee=Ne(),ie=Ne(!1),ce=Ne([]),ye=Ne([]),Ce=Ne(!1),Te=Ne(""),ve=Ne(!1),Ge=Ne(0);async function Xe(){var G,le,de;ie.value=!0,ce.value.length||Le(),await Ri();const re=s.value;re.depthMapOutput=(G=L.value)==null?void 0:G.getContext("2d"),re.edgeOutput=(le=O.value)==null?void 0:le.getContext("2d"),re.poseOutput=(de=ee.value)==null?void 0:de.getContext("2d")}u(Xe,"onShowSdDialog"),lt(Xe,"onShowSdDialog"),Ts(ie,function(re){if(!re){const G=s.value;G.depthMapOutput=void 0,G.edgeOutput=void 0,G.poseOutput=void 0}});async function Le(){if(!s.value)return;const re=s.value.options.sdServer;if(!re)return;const G=await fetch(re+"/sdapi/v1/samplers",{mode:"cors"});ce.value=(await G.json()).map(ge=>ge.name),ce.value.length&&(s.value.options.sdSampler||(s.value.options.sdSampler=ce.value[0]));const le=await fetch(re+"/controlnet/model_list",{mode:"cors"});ye.value=(await le.json()).model_list;const de=s.value.options;de.sdCnDepthModel||(de.sdCnDepthModel=ye.value.find(ge=>ge.includes("depth"))||""),de.sdCnEdgeModel||(de.sdCnEdgeModel=ye.value.find(ge=>ge.includes("canny"))||""),de.sdCnPoseModel||(de.sdCnPoseModel=ye.value.find(ge=>ge.includes("pose"))||"")}u(Le,"onRefreshSdServer"),lt(Le,"onRefreshSdServer");async function Ke(){if(!!ve.value)try{const G=await(await fetch(s.value.options.sdServer+"/sdapi/v1/progress",{mode:"cors"})).json();if(ve.value&&(Ge.value=Math.round(G.progress*100),G.current_image)){const le="data:image/png;base64,"+G.current_image;Ce.value=!0,Te.value=le}}finally{ve.value&&setTimeout(Ke,500)}}u(Ke,"sdGetGenerateProgress"),lt(Ke,"sdGetGenerateProgress");async function He(){var G,le,de;const re=s.value;try{ve.value=!0,Ge.value=0,Ke();const ge=[];re.options.sdCnDepthEnabled&&re.options.sdCnDepthModel&&ge.push({input_image:(G=L.value)==null?void 0:G.toDataURL(),model:re.options.sdCnDepthModel,module:"none",weight:re.options.sdCnDepthWeight,guidance_start:re.options.sdCnDepthGuidanceStart,guidance_end:re.options.sdCnDepthGuidanceEnd,control_mode:re.options.sdCnDepthControlMode}),re.options.sdCnEdgeEnabled&&re.options.sdCnEdgeModel&&ge.push({input_image:(le=O.value)==null?void 0:le.toDataURL(),model:re.options.sdCnEdgeModel,module:"none",weight:re.options.sdCnEdgeWeight,guidance_start:re.options.sdCnEdgeGuidanceStart,guidance_end:re.options.sdCnEdgeGuidanceEnd,control_mode:re.options.sdCnEdgeControlMode}),re.options.sdCnPoseEnabled&&re.options.sdCnPoseModel&&ge.push({input_image:(de=ee.value)==null?void 0:de.toDataURL(),model:re.options.sdCnPoseModel,module:"none",weight:re.options.sdCnPoseWeight,guidance_start:re.options.sdCnPoseGuidanceStart,guidance_end:re.options.sdCnPoseGuidanceEnd,control_mode:re.options.sdCnPoseControlMode});const Re={prompt:re.options.sdPrompt+", "+re.options.sdPromptA,negative_prompt:re.options.sdNPrompt+", "+re.options.sdNPromptA,sampler_name:re.options.sdSampler,steps:re.options.sdSteps,width:re.options.sdWidth,height:re.options.sdHeight};ge.length&&(Re.alwayson_scripts={controlnet:{args:ge}});let st="/sdapi/v1/txt2img";re.options.sdInputImg&&(Re.init_images=[oe.value.toDataURL()],st="/sdapi/v1/img2img");const Pt=await(await fetch(re.options.sdServer+st,{method:"POST",mode:"cors",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(Re)})).json();if(Pt.images&&Pt.images[0]){const os="data:image/png;base64,"+Pt.images[0];Ce.value=!0,Te.value=os}}finally{ve.value=!1}}u(He,"onSdGenerate"),lt(He,"onSdGenerate");async function et(re){const G=re.getContext("2d");G===s.value.poseOutput&&(s.value.poseOutput=void 0),G===s.value.depthMapOutput&&(s.value.depthMapOutput=void 0),G===s.value.edgeOutput&&(s.value.edgeOutput=void 0);const le=(await navigator.clipboard.read())[0];for(let de of le.types)if(de.startsWith("image/")){const ge=await le.getType(de),Re=await Wu(ge),st=new Image;st.onload=()=>{G.fillStyle="#000",G.fillRect(0,0,G.canvas.width,G.canvas.height),G.drawImage(st,0,0)},st.src=Re}}u(et,"onPasteToCanvas"),lt(et,"onPasteToCanvas");function Ut(re){var le,de,ge;const G=s.value;switch(re){case"pose":G.poseOutput=(le=ee.value)==null?void 0:le.getContext("2d");break;case"depth":G.depthMapOutput=(de=L.value)==null?void 0:de.getContext("2d");break;case"edge":G.edgeOutput=(ge=O.value)==null?void 0:ge.getContext("2d");break}}return u(Ut,"onRefreshOutputCanvas"),lt(Ut,"onRefreshOutputCanvas"),{dom:t,sketchfabClient:e,editorCtx:s,fullscreenLoading:o,uiOptions:r,validChildNodeDefs:c,canDelete:h,canRemesh:K,sketchfabModelUrl:Me,downloadProgressDialog:X,downloadProgressText:I,downloadTotalText:J,downloadCancelFlag:Z,downloadProgressPercent:B,sdInputCanvas:oe,depthMapCanvas:L,edgeCanvas:O,poseCanvas:ee,sdDialog:ie,sdSamplers:ce,sdCnModels:ye,sdResultDialog:Ce,sdResultImage:Te,sdGenerating:ve,sdProgress:Ge,onCanvasMounted:f,onBeforeCanvasUnmount:p,onUndo:g,onRedo:m,onNew:y,onOpen:b,onImport:_,onExport:w,onSave:x,onSaveAs:S,onSetView:M,onSetValue:R,onMoveNode:D,onAddNode:k,onDelete:T,onSelect:N,onSetNodesProperties:E,onFocus:z,onCut:H,onCopy:q,onPaste:ne,onConvertToClay:W,onApplyTransformation:se,onRemesh:U,onCreateInstance:he,onFlip:ue,onCopyPose:Q,onPastePose:te,onLoadCamera:_e,onDeleteCamera:pe,onSaveCamera:Ae,onSketchfabLogin:Ie,onSketchfabLogout:$,onSketchfabImportModel:F,onOpenFeedback:V,onOpenTutorial:ae,onShowSdDialog:Xe,onRefreshSdServer:Le,onSdGenerate:He,onPasteToCanvas:et,onRefreshOutputCanvas:Ut}}}),dve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAPYElEQVR42u1be1RU1ff/nLkz4Ixo4AM1FTF8P6CwfKJo9FIyAzEUtbQkDTMrM7Ny3XXTwge4VktSVrpKMzHSJMon6nKVpqQpShhCKC41zRe+ZgCZuXf//vh9z133ztwZEOlbra9nrVlc7p17ztmfs/c+n733GUZE+F9u7B4A9wC4B8A9AP7qJkkSAUBoaCjMZjMAQFGU/58AY7q/AGAymeBwOFBZWQmHw4G5c+eyfyUAXPAOHTogICAAsiwjMTGRAUBubi6NGjXKQ7CcnBwqLCxE9+7dUVxcrHsmiiL7VwAwf/58uv/++9GqVSvIsgxFUVBYWOghwO7du2nfvn0AgKioKDidTvz888/q97799lsSBAEjR45kmZmZdPHixQYHoUEBWLRoEYWFhcFsNsPf3x8AIAgCTCYTBEFQPyaTCXl5eYiJiUFUVBTbv38/DRw40Ktg27dvJ7vdjuPHj8NisUAQBMyZM4f9YwD4/PPPyWw2w2w2o7S0FP3794efnx+GDRvGuBm4t+HDh8NisYCIwBiDy+UCEUFRFPWv9kNEkGUZjz/+OAOApUuX0ptvvsn+VgCWL19OZrMZL7/8siqoKIps586dZLPZsGvXLoiiyCRJIq66x44dIwAgIgiCACJCeHg4KywsJMYYevfuzbT+g7fHHnsMu3btQr9+/VSzOn36NARBQEpKCvuvA5CZmUkmk0kVngs6ePBg7N27FyNGjMAjjzzCAODXX38lPk54eDgDgJKSEuratSsDgBMnTlC3bt0YABw/fpwYY+jRo4dOe3h/2nvh4eFQFAUVFRVITk5m/zUAFi9eTK1bt0Z5ebnufnR0NIYOHcokSaL4+Hj1/qZNmzyc1++//06dO3dmAFBWVkadOnXSrfxzzz0Hxhg4MMeOHaOIiAidNvHr7OxsIiI4nU5MnDiR/aUALFiwgNq0aYOAgACcOHFC3Z727t1LgwcPVoXnDq9r1666SQPA6dOnKTQ0lGm3y0mTJmH16tUeQJWWlhIAyLIMl8sFp9MJp9OJmpoa1NTU4Pbt26ipqcGzzz7L1q9fT+PGjfvrAOCrExISgsDAQMTFxTEA+Omnn2jQoEE6O+YqfurUKXrggQfUSZ07d47atWunU2VRFBm/7z5meXk5cUfYuXNnDzC1c+vduzcqKiowZcoU1uAAaCccGhqKFi1aIDY2lh04cIAGDBjACgsLidu3Vq0lSaKXXnoJXOjk5GSsXLnSY6X//PNPat26tXrv/PnzJMsy2rdvb9in+/tbt26lQ4cOAQCCg4PxyiuvsAYHQBRF9uWXX9KECRPYzp07qWnTpujXrx/j9qn9PldzDtzUqVMhCIJKe7XUt3nz5gwArly5QnwLbNWqlaEAZWVltG7dOkNSFRMTo/qGoKAgvPbaa6xBANAinpWVRe3atcOQIUNYQUEBMcbw4IMPegx09uxZ+uyzz1QVv3r1KjVv3pxVVFRQs2bNdPY/Y8YM9T0+n4yMDK/zGT9+PNxB4D5I22/jxo3x1ltvsQYDIDs7mxITE1l+fj75+fkhMjKSeTMVruocAK3gN27coPvuu8/j3evXr1NgYKBOGzgowcHBOr/BQeDtqaeewvbt2z3m7u/vj3feeYfdFQCpqak0d+5ctmHDBhozZgw7fPgw9enThxkJzlfl4sWL1KpVK9VetcIBwK1bt6hJkyYeE3O/rzUhbh6rVq2CKIpMu30WFBTQQw89pOtvxYoVZLfbUV1djXnz5rF6A5Cenk4dO3ZEfHw8O3jwIFksFnDq+/XXX3tEapIk0fTp09GiRQsGADdv3qSmTZt6TKCyspJsNpvuvsPhoMaNGzN3QN3Ni4PhdDqRlZWF0aNHo1evXmzPnj3kcDhgt9sxduxYlp6eTna73WsQVScAli1bRu3atUObNm3Qv39/da/v3bs3O3nyJIWFhTF3c9GqvLfVBoDq6mpq1KiR6rxmz56NJUuWeJ2w+w5w8uRJ4nGC3W6Hu2ZmZGTQ1atX6w/AypUrKTk5meXm5lJwcDDy8vIgiiL77bffqEePHoyvSPv27XXbE1d5u91O6enpPsPY27dv08KFCyGKItMCUhsA586dI5fLhdDQUFZSUkJfffWVhzZ++umndOHChfoDsGbNGmrWrBmCgoIQFRWldqLl8nwfFwQBLVu21Km9w+GgtLQ0jwm4EyGn00kWi4VxQPz9/b1qQEpKCmRZhpY3aGMKLUhr1qyh06dP1x+A9evXU9u2bTFkyBCPDrj6awe8du0aBQUFMbvdTiaTCTabzYO/e7Ntl8tFZrOZ1dTUkJ+fn8fzGzdukKIoCAoKMhSmuLiYunfvrhuna9euGDt2rFcGWSsA27ZtI6vViqFDhxrS1I4dO3p0fuvWLRIEAYwxWK1WD9rrazyXy0VEBK4NAFBVVUWKooA7R199HD9+nHr27Mk0gRjFx8fXD4DNmzeT1WoFZ1hG7cyZMxQSEuLxvKqqijjjM5lMKvszSoJ+8MEHunfff/99EJG67WnNoTYAioqKqFevXgwAtmzZQrGxsT53FJ8A5OXl0YEDB7yunCRJNGXKFLRt29bDvt9++20sXrwYc+fORWpqqs+VJ80kuOD8mmeDFi5cWOegLS4uDjk5ORg4cCD279/vM6nqE4Dt27eTv78/fvzxR0MnJooiu3DhArVp08bDvqurq2nRokUQRZG5XC5ijEEQhDpHabIsE/8+B1RRFDUbJMuyGkMYtaNHj9KNGzcQHR3N0tLSyOFw3DkAW7ZsIavVCn9/f5jNZvTr148ZqeHFixcpMzNTN4AWAP59RVHIZDLVCQRFUWj+/Pm6lTMaV5ZlNVcgyzK0zLCqqgrnz59HQkJC/XzA999/T0eOHMGwYcPU4Oe7776Du0dPSUlRtz9u/4sXL/Zgh//5nw/oc6+fN28e3MEyEsLdvouLi8nlcqmAPPzww8yX7/AKQE5ODsXFxTFJkigmJga7d+8GACQkJGDjxo26lbly5Qpx2lsHAFRzdwdBK4yRtvhygNpnRUVF5HK5UFNTg759+9bPCW7cuJG0qnPgwAHKy8sDACQlJUEQBGgzPVrqa8TxvUxeBcHouRaE2rw/zxW4XC41j5ifn0+culssFrz77rt1B4CHvtqM7/Dhw9G3b1+mDUp4xoYTICPhaxHAq0m4O0JvAJw9e5ZkWYY2ASOKolpwSU9Pp1mzZt0ZE8zKyqKkpCQdALGxsapNGaWyrl+/ThaLBY0bN64VAAO19DCJ2gC4dOkSybIMvgsZjbd37146evQoZsyYcWcArF27liZOnOhR2XnmmWfgHndfuXKFtOWvgIAArxPyZY+cD7D/sCROjd0BuH79OimKAm1myZtfiI6ORklJCaZOnVp3AFavXk2TJk3y2NslSaJRo0YZpsB4AMQYg1Ho661E5t5EUWR85XmAxIW32+1ERGjSpAmra39RUVE4c+YMJk+efHcaoF09ngtwF/D111+HyWRSqa87BXanwwYagAULFgAA3nvvPSiKgtTUVMyZMweKomDJkiV3VCqXJIkGDBiAy5cvY/z48XcGQGZmJgUFBcFsNqOoqEhHaCRJooSEBPCgwyjt5XA4CIDqD3ypvrvdczqsjQe0DJDv8S6XC0a1BO2ctm3bRna7HWPGjLkzAD755BOaPn06W7duHTVt2hQjR47UsSltQkSbBVq2bJluhSorKwmAunp1re/zPt0TJO7OsLy8nHi1yP1TU1MDp9MJRVHw9NNP3xkAH3/8Mc2cOZPx3WDHjh2Un5+vY4GJiYnIzs5WtUObBzQKjnhoXBsI2u944xS+wOTv79ixg1wuF2JjY+uXFeYJRZ5U2LNnDwmCoCZH3NNQly5douDgYK87QFVVFQGA1WplvqpPWpBnzZpluKv4osbR0dGQZRn79u1Dz549kZCQUD8AFi1aRNXV1RBFUU2JS5JETz75pJocHTduHLp06cKMyltGE+WJTyLS8QVvwrzxxhswyigbvZefn0+yLGPQoEHqWN26dVPPJd0xAB999BE5nU51Rb755hviDvHw4cO0efNmlRp37tyZ/fHHH+SeGzACgF/zbW3p0qVew233eoJRKygoIFmWsWXLFo/4o1OnTl53gFoBMLI1nmLiNXuTyYRGjRohKysLL774oq6Y6WtltbvKzZs3iYigrRYZpdfd+0hISICiKNi0aZPh9qjlM/WuDC1YsIAEQVDP6kmSRBERETh27JguBOXFEm3dv64hLG/Xrl0jRVGQkZGhPrt8+TItX75cN6ekpCQoiqKePdAKrx1v1apVVFupvM61QZvNhtmzZ6tn/I4ePaoToKysTJcD5EB4iwF8tZSUFHChp02bplaKy8vLiYjUKNSbafHrzMxMmjZt2t0DwDsNDAzEzJkzmSRJFBkZiZEjR+oEGzt2rFoCt1gsHmzQqDRuxAaJCCaTSb3mJKhDhw668R599FHdKZHbt2/rrokIr776asMAwAdt2bIlLl++DADo06ePjmBoU9JlZWVERMjKyjIkQL5OeoiiyM6fP09aAHiWR0tyeIrOvb8VK1aQLMu1Cl+vM0KSJFHbtm0hCAImT57MeOqZJyK1gZIkSZSUlKSupLaS5Ms5au+dOnWK1q5d62HfRvNq3749ZFnG1atXfZbE7woAPpjFYkFISAgmTJjAtm7dSiNGjGCHDh2irVu3eiQxud0nJiaCiKCt3nhLePJWWlpK69ev9xkErVu3jmRZxvPPP18npnnXAPAJ+/n5ISwsDAEBARgxYoSagfHm5fn9hIQENcjh54q8OUsedLmDCQA9evSAoig4ceJErRrS4ADwSfr7+6NLly6wWq2w2WyIjo5mdeHq/HrUqFFQFAWRkZGGJTRuVlrhcnNziR/Ads8l3KkMDXJWeOHChcQYQ0REBARB0FVj6tpiY2OhKIou5wgABw8epG3btoGHtoqiIDY2lnGafjfCNxgAfFWtVivCw8N9JkGMaoP8dCkAPPHEE+oBacYYoqKi2K5du0hRFFy6dAnV1dWoqqpCRUXFXQne4ABoQQgJCUFJSQkiIyN1J75Hjx5tuAv88MMPutogbyaTCbIso7KyEr/88gtqyyn+7QBoD1W88MILHpmgDRs2kBYQbZBi5AQjIyNx5MgRiKLIPvzwQ3K5XP/sH0xoW0ZGBjkcDmjt1N1hffHFF8RZ3rlz53QrHBYWhpMnT8Jms0GW5Trv6/8YAAAgLS2NjGze6J7NZlM1Q5Zl+Pn5weFwoCF+FPG3AfBvaPcAuAfAPQD+twH4PyYSYSaTaCiyAAAAAElFTkSuQmCC",fve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAZNJREFUOI3Fk79rU1EUxz/nvgZiqkMRgkKGDMlQCDRgXbpZgrSIQ5ZM/gHB3exFcLB0kQ6OLkIgW6wubdA2mTIEApVAoWPgpQ/E16bxx+u7xyHk0Te1kMEDl8s5XD7fc773XpgzRFXnAph5O5gbIMCLTCazk0wmbwUbj8cT13UPgS1VPQV43+v19DYxGo3U8zxtt9uay+V+AMsGEBGZ4v8GcHwK/hiCKzg+Af8iUi8Wi5N0Ov21Xq/TaDSWROTNQqy/tx/g+wnccWBpEUYu3EvCzmtIpQA8a+26iHyp1Wqb+Xz+SRzgDcG5hCCEMw9MCJMLOPdngMg7x3FIJBIJA2j0FjbWwEzA/ALzB+QKVh/Bg4cwPXhfRPaq1eqG7/sMBoOjhRhg8ylc/oRPzWm+UoTqy0i20+ncdRznmeu6lMtl31r7CmC32+3G7f68p7r7TjUIYuVSqWSz2ewZ8BHIz4S3W63WjVc4HA5VRPZVletLgMeFQuFbpVJJGWNms0a7tZYwDGk2m7/7/f5zVT2IufnfP9M/jW8Tm1+fCIsAAAAASUVORK5CYII=",pve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFBJREFUOI1jYBgF6OA/FFBsCDJNH0P+owGyDaGKS3BppqohuAxjwmUgIyMjIy4+0QYhA0YoICmqsXkNH5skw8gyBJ8GQobgDEB0jYQCe/ABAKCQl4Lg46L9AAAAAElFTkSuQmCC",mve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFRJREFUOI3lkjsOACAIQ8V4/yvXCUIMH4kbdqWUl5Qx2oq8AQCky0Syv6IQbaweEZNn9uZkmSIxJQBo4pkiXqpxkFl/JK+QMhE3df5YuX4r5InoI21GkSwM7aEiTgAAAABJRU5ErkJggg==",gve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAC5JREFUOI1jYBgFwxT8////PyE1TNSyjGoGMeKSwOcdRkZGnPrwgqEZRqOAjgAAfNwMAvOaLCwAAAAASUVORK5CYII=",vve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAADBJREFUOI1jYBgFgwf8hwKKDcHGJtsQYgxjIsuWkWUQXkCVWEM2gGJDRgEDAwMDAwA87SfhU+Y3UgAAAABJRU5ErkJggg==",yve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAACJJREFUOI1jYBgFo2AQAUZcEv////+PUxMjI059o2AUUAIA4coEAgSS2PIAAAAASUVORK5CYII=",_ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAEVJREFUOI1jYBi2gBGZ8/////8kaWZkhOtnopaLaG4QI5E0QYP+E0nTx0WMUBsJ0QQNIsaQIeAiVBNISNnoalkoMWyEAABm9CkRfIO1owAAAABJRU5ErkJggg==",bve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAADNJREFUOI1jYBi2gBGZ8/////8kaWZkZMQqQYpB6GqZSHEBPjBq0KhB1AAs6AKkZpMRAAAPZRAMju/UaQAAAABJRU5ErkJggg==",wve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAEVJREFUOI1jYBi2gBGf5P////+jKGZkxKseqwHohuATJ8oVxKphIsp0UgHRzsailmouGnwGYYDBFWvINpKaIGmbRYYHAAC8Mj/Vvda64QAAAABJRU5ErkJggg==",xve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAGFJREFUOI3dk0EOwCAIBMH0/19er4ILKqaHlqOsw6hR5LelWRMATFg1zNOGB0ybCLBVICwzgaplQCubzOodox2Ta1AGESHPz+7JQwDArz2V6VtGoxUziQYffZHQpnCCD1UHNO0sGtTVHO8AAAAASUVORK5CYII=",Ave="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFxJREFUSIntlEsOACEIQ2Xuf+e6MkFiLCN+Nryl0AoxtZQkiSLeRgDohCJuLTW25vZ8VHebrw7Q+JZu/jHAGbEitME1jr1BCChY36xON9gWKIsOEQvajPdfRZJQKkl2V7+RNsIHAAAAAElFTkSuQmCC",B1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAFZJREFUOI1jYKAF+A8FVNFEtGH4FOGTYyFWE4zPyMjISJIGdDF0cSZcLsAHkA0hyQBGKEAWwxkG2GyDGUKSATgDjSYuwBbyhFxAtM245PB6geT8MCAAAPBiU+VdXfvhAAAAAElFTkSuQmCC",DA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAFJJREFUOI3FkkkOACAIA8H//xnPYBsr0dgj2zSA2W85S0REpEJ3Wrs01uYaR3lIVQBDsqUAFDrSkYNrau9gO5WdkNGhA/lh2GTlkRJQtdp29lwTgQVXv/+wyrQAAAAASUVORK5CYII=";const Qe=u(n=>(Ga("data-v-c3c868e0"),n=n(),Ha(),n),"_withScopeId"),Mve={class:"toolbar"},Sve={class:"properties"},Cve={class:"cols",style:{"align-items":"center","margin-bottom":"8px"}},Eve={class:"cols",style:{"align-items":"center"}},Tve=Qe(()=>j("div",{class:"fill"},null,-1)),Pve={style:{"margin-right":"4px"}},Rve={class:"properties"},Ive={class:"cols",style:{"align-items":"center","margin-bottom":"8px"}},Dve=Qe(()=>j("div",{style:{"margin-right":"4px"}},"FOV",-1)),Lve={class:"camera-list"},Ove={class:"item"},kve=["onClick"],Nve=["onClick"],Fve=Qe(()=>j("div",{class:"properties cols"},[j("div",null,[j("img",{src:dve,alt:""})]),j("div",{style:{padding:"4px 6px 4px 8px"}},[j("div",{style:{"margin-bottom":"6px"}},[j("span",{style:{"font-size":"16px","font-weight":"bold"}}," Figure Doll Editor "),dn(" Ver 20230427 ")]),j("div",{style:{"margin-bottom":"6px"}},"Author: x6udpngx"),j("div",{style:{"margin-bottom":"6px"}},[j("a",{href:"https://github.com/x6ud/figure-doll-editor",target:"_blank"}," Source ")]),j("div",null,[j("a",{href:"https://ko-fi.com/x6udpngx",target:"_blank"},[j("img",{src:fve,alt:"",style:{"vertical-align":"text-bottom"}}),dn(" Support Me on Ko-fi ")])])])],-1)),zve=Qe(()=>j("div",{class:"separator"},null,-1)),Bve=Qe(()=>j("img",{src:pve,alt:""},null,-1)),Uve=[Bve],$ve=Qe(()=>j("img",{src:mve,alt:""},null,-1)),Vve=[$ve],Gve={key:1,class:"button-group cols",style:{"margin-right":"6px"},title:"Direction"},Hve=Qe(()=>j("img",{src:gve,alt:""},null,-1)),Wve=[Hve],jve=Qe(()=>j("img",{src:vve,alt:""},null,-1)),Xve=[jve],Yve=Qe(()=>j("img",{src:yve,alt:""},null,-1)),qve=[Yve],Kve={class:"properties"},Zve={class:"property inline"},Qve=Qe(()=>j("label",null,"Voxel size",-1)),Jve=Qe(()=>j("span",null,"\xA0m",-1)),eye=Qe(()=>j("div",{class:"fill"},null,-1)),tye={class:"button-group cols",style:{"margin-right":"6px"}},nye=Qe(()=>j("img",{src:_ve,alt:""},null,-1)),sye=[nye],iye=Qe(()=>j("img",{src:bve,alt:""},null,-1)),rye=[iye],oye={class:"button-group cols"},aye=Qe(()=>j("img",{src:wve,alt:""},null,-1)),lye=[aye],cye=Qe(()=>j("img",{src:xve,alt:""},null,-1)),uye=[cye],hye={class:"cols fill"},dye={key:0,class:"tools scrollable"},fye={class:"scroll"},pye={key:0},mye={key:0},gye=["title","onClick"],vye=["src"],yye={key:0,class:"rows",style:{width:"100%",height:"100%"}},_ye=["disabled"],bye={key:0,class:"status-bar cols"},wye=Qe(()=>j("div",{class:"fill"},null,-1)),xye={class:"properties",style:{padding:"0"}},Aye={class:"property inline"},Mye=Qe(()=>j("label",null,"Offset",-1)),Sye={class:"property inline"},Cye=Qe(()=>j("label",null,"Scale",-1)),Eye={class:"properties",style:{padding:"0"}},Tye={class:"property inline"},Pye=Qe(()=>j("label",null,"Angle Threshold",-1)),Rye={class:"property inline"},Iye=Qe(()=>j("label",null,"Depth Threshold",-1)),Dye={class:"properties",style:{padding:"0"}},Lye={class:"property inline"},Oye=Qe(()=>j("label",null,"Web UI Server",-1)),kye=Qe(()=>j("img",{src:Ave,alt:""},null,-1)),Nye=[kye],Fye={class:"cols"},zye={class:"fill",style:{"margin-right":"10px"}},Bye={class:"property"},Uye=Qe(()=>j("label",null,"Prompt",-1)),$ye={class:"property"},Vye=Qe(()=>j("label",null,"Negative Prompt",-1)),Gye={class:"fill"},Hye={class:"property"},Wye=Qe(()=>j("label",null,"Additional Prompt",-1)),jye={class:"property"},Xye=Qe(()=>j("label",null,"Additional Negative Prompt",-1)),Yye={class:"cols"},qye={class:"fill",style:{"margin-right":"10px"}},Kye={class:"property inline"},Zye=Qe(()=>j("label",null,"Sampler",-1)),Qye=["value"],Jye={class:"fill"},e_e={class:"property inline"},t_e=Qe(()=>j("label",null,"Steps",-1)),n_e={class:"cols"},s_e={class:"fill",style:{"margin-right":"10px"}},i_e={class:"property inline"},r_e=Qe(()=>j("label",null,"Width",-1)),o_e={class:"fill"},a_e={class:"property inline"},l_e=Qe(()=>j("label",null,"Height",-1)),c_e={class:"cols"},u_e={style:{"margin-bottom":"4px"}},h_e=Qe(()=>j("img",{src:B1,alt:"",style:{"vertical-align":"text-top"}},null,-1)),d_e={width:"512",height:"512",style:{margin:"0 auto",border:"solid 1px #333","max-width":"200px","max-height":"200px"},ref:"sdInputCanvas"},f_e=Qe(()=>j("div",{style:{"margin-bottom":"6px"}},"ControlNet",-1)),p_e={class:"cols"},m_e=["value"],g_e={class:"cols",style:{"margin-bottom":"4px","align-items":"center"}},v_e=Qe(()=>j("label",null,"Weight\xA0",-1)),y_e=Qe(()=>j("label",null,"Guidance\xA0",-1)),__e=Qe(()=>j("span",null,"\xA0~\xA0",-1)),b_e=Qe(()=>j("label",null,"Priority\xA0",-1)),w_e=Qe(()=>j("option",{value:0},"Balanced",-1)),x_e=Qe(()=>j("option",{value:1},"Prompt",-1)),A_e=Qe(()=>j("option",{value:2},"ControlNet",-1)),M_e=[w_e,x_e,A_e],S_e={style:{"margin-bottom":"4px"}},C_e=Qe(()=>j("img",{src:B1,alt:"",style:{"vertical-align":"text-top"}},null,-1)),E_e=Qe(()=>j("img",{src:DA,alt:"",style:{"vertical-align":"text-top"}},null,-1)),T_e={width:"512",height:"512",style:{margin:"0 auto",border:"solid 1px #333","max-width":"200px","max-height":"200px"},ref:"depthMapCanvas"},P_e={class:"cols"},R_e=["value"],I_e={class:"cols",style:{"margin-bottom":"4px","align-items":"center"}},D_e=Qe(()=>j("label",null,"Weight\xA0",-1)),L_e=Qe(()=>j("label",null,"Guidance\xA0",-1)),O_e=Qe(()=>j("span",null,"\xA0~\xA0",-1)),k_e=Qe(()=>j("label",null,"Priority\xA0",-1)),N_e=Qe(()=>j("option",{value:0},"Balanced",-1)),F_e=Qe(()=>j("option",{value:1},"Prompt",-1)),z_e=Qe(()=>j("option",{value:2},"ControlNet",-1)),B_e=[N_e,F_e,z_e],U_e={style:{"margin-bottom":"4px"}},$_e=Qe(()=>j("img",{src:B1,alt:"",style:{"vertical-align":"text-top"}},null,-1)),V_e=Qe(()=>j("img",{src:DA,alt:"",style:{"vertical-align":"text-top"}},null,-1)),G_e={width:"512",height:"512",style:{margin:"0 auto",border:"solid 1px #333","max-width":"200px","max-height":"200px"},ref:"edgeCanvas"},H_e={class:"cols"},W_e=["value"],j_e={class:"cols",style:{"margin-bottom":"4px","align-items":"center"}},X_e=Qe(()=>j("label",null,"Weight\xA0",-1)),Y_e=Qe(()=>j("label",null,"Guidance\xA0",-1)),q_e=Qe(()=>j("span",null,"\xA0~\xA0",-1)),K_e=Qe(()=>j("label",null,"Priority\xA0",-1)),Z_e=Qe(()=>j("option",{value:0},"Balanced",-1)),Q_e=Qe(()=>j("option",{value:1},"Prompt",-1)),J_e=Qe(()=>j("option",{value:2},"ControlNet",-1)),ebe=[Z_e,Q_e,J_e],tbe={style:{"margin-bottom":"4px"}},nbe=Qe(()=>j("img",{src:B1,alt:"",style:{"vertical-align":"text-top"}},null,-1)),sbe=Qe(()=>j("img",{src:DA,alt:"",style:{"vertical-align":"text-top"}},null,-1)),ibe={width:"512",height:"512",style:{margin:"0 auto",border:"solid 1px #333","max-width":"200px","max-height":"200px"},ref:"poseCanvas"},rbe=["disabled"],obe=["src"],abe={class:"cols",style:{"align-items":"center"}},lbe={class:"progress-bar",style:{width:"260px"}},cbe={class:"text"},ube={class:"cols",style:{"align-items":"center"}},hbe={class:"progress-bar",style:{width:"260px","margin-right":"4px"}},dbe={class:"text"};function fbe(n,e,t,s,i,r){var x,S,C,M,R,D,k;const o=ln("popup-menu-item"),a=ln("popup-menu"),l=ln("input-number"),c=ln("input-boolean"),h=ln("label-range"),d=ln("model-tree"),f=ln("side-panel"),p=ln("model-node-properties"),g=ln("quad-view"),m=ln("color-picker"),v=ln("popup-dialog"),y=ln("input-range"),b=ln("collapsible-panel"),_=ln("accordion-group"),w=ln("fullscreen-loading");return Se(),Oe(Dt,null,[j("div",{class:"container rows",tabindex:"0",onKeydown:[e[47]||(e[47]=Ln(Hn((...T)=>n.onUndo&&n.onUndo(...T),["ctrl"]),["z"])),e[48]||(e[48]=Ln(Hn((...T)=>n.onRedo&&n.onRedo(...T),["ctrl"]),["y"])),e[49]||(e[49]=Ln(Hn((...T)=>n.onOpen&&n.onOpen(...T),["ctrl","prevent"]),["o"])),e[50]||(e[50]=Ln(Hn((...T)=>n.onSave&&n.onSave(...T),["ctrl","prevent"]),["s"])),e[51]||(e[51]=Ln(Hn((...T)=>n.onCut&&n.onCut(...T),["ctrl"]),["x"])),e[52]||(e[52]=Ln(Hn((...T)=>n.onCopy&&n.onCopy(...T),["ctrl"]),["c"])),e[53]||(e[53]=Ln(Hn((...T)=>n.onPaste&&n.onPaste(...T),["ctrl"]),["v"])),e[54]||(e[54]=Ln((...T)=>n.onDelete&&n.onDelete(...T),["delete"]))],onContextmenu:e[55]||(e[55]=Hn(()=>{},["prevent"])),ref:"dom"},[j("div",Mve,[n.editorCtx?(Se(),Oe(Dt,{key:0},[we(a,{title:"File"},{default:bt(()=>[we(o,{title:"New",onClick:n.onNew},null,8,["onClick"]),we(o,{title:"Open",popup:"",hotkey:"Ctrl+O",onClick:n.onOpen},null,8,["onClick"]),we(o,{sep:""}),we(o,{title:"Save",hotkey:"Ctrl+S",onClick:n.onSave},null,8,["onClick"]),we(o,{title:"Save As",popup:"",hotkey:"Shirt+Ctrl+S",onClick:n.onSaveAs},null,8,["onClick"]),we(o,{sep:""}),we(o,{title:"Import",popup:"",onClick:n.onImport},null,8,["onClick"]),we(o,{title:"Export"},{default:bt(()=>[we(a,null,{default:bt(()=>[we(o,{title:"glTF 2.0 Binary (.glb)",popup:"",onClick:e[0]||(e[0]=T=>n.onExport("glb"))}),we(o,{title:"Wavefront (.obj)",popup:"",onClick:e[1]||(e[1]=T=>n.onExport("obj"))})]),_:1})]),_:1})]),_:1}),we(a,{title:"Edit"},{default:bt(()=>[we(o,{title:"Undo",hotkey:"Ctrl+Z",onClick:n.onUndo},null,8,["onClick"]),we(o,{title:"Redo",hotkey:"Ctrl+Y",onClick:n.onRedo},null,8,["onClick"]),we(o,{sep:""}),we(o,{title:"Cut",hotkey:"Ctrl+X",onClick:n.onCut},null,8,["onClick"]),we(o,{title:"Copy",hotkey:"Ctrl+C",onClick:n.onCopy},null,8,["onClick"]),we(o,{title:"Paste",hotkey:"Ctrl+V",onClick:n.onPaste},null,8,["onClick"]),we(o,{title:"Delete",hotkey:"Delete",onClick:n.onDelete},null,8,["onClick"]),we(o,{sep:""}),we(o,{title:"Moving Nodes: Keep World Position Unchanged",onClick:e[2]||(e[2]=T=>n.editorCtx.options.keepTransformUnchangedWhileMoving=!n.editorCtx.options.keepTransformUnchangedWhileMoving),checked:n.editorCtx.options.keepTransformUnchangedWhileMoving},null,8,["checked"]),we(o,{sep:""}),we(o,{title:"Selecting: Allow Clicking Negative Objects",onClick:e[3]||(e[3]=T=>n.editorCtx.options.allowSelectingInvisibleObjectByClicking=!n.editorCtx.options.allowSelectingInvisibleObjectByClicking),checked:n.editorCtx.options.allowSelectingInvisibleObjectByClicking},null,8,["checked"]),we(o,{sep:""}),we(o,{title:"Transform: Use Local Space for Controls",onClick:e[4]||(e[4]=T=>n.editorCtx.options.useLocalSpaceForTransformControl=!n.editorCtx.options.useLocalSpaceForTransformControl),checked:n.editorCtx.options.useLocalSpaceForTransformControl},null,8,["checked"]),we(o,{title:"Transform: Take Geometry Center as Origin",onClick:e[5]||(e[5]=T=>n.editorCtx.options.takeGeometryCenterAsTransformOrigin=!n.editorCtx.options.takeGeometryCenterAsTransformOrigin),checked:n.editorCtx.options.takeGeometryCenterAsTransformOrigin},null,8,["checked"]),we(o,{sep:""}),we(o,{title:"IK Binding: Allow Modification of Joint Length",onClick:e[6]||(e[6]=T=>n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk=!n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk),checked:n.editorCtx.options.allowModifyingBoneLengthWhenBindingIk},null,8,["checked"]),we(o,{title:"IK Binding: Keep Internal Object Position Unchanged",onClick:e[7]||(e[7]=T=>n.editorCtx.options.keepInternalTransformWhenBindingIk=!n.editorCtx.options.keepInternalTransformWhenBindingIk),checked:n.editorCtx.options.keepInternalTransformWhenBindingIk},null,8,["checked"]),we(o,{sep:""}),we(o,{title:"Stretching Joints: Keep Both Ends of Clay Nodes Unchanged",onClick:e[8]||(e[8]=T=>n.editorCtx.options.keepBothEndsOfClayNodesWhenStretching=!n.editorCtx.options.keepBothEndsOfClayNodesWhenStretching),checked:n.editorCtx.options.keepBothEndsOfClayNodesWhenStretching},null,8,["checked"])]),_:1}),we(a,{title:"View"},{default:bt(()=>[we(o,{title:"Window"},{default:bt(()=>[we(a,null,{default:bt(()=>[we(o,{title:"Tools",checked:n.uiOptions.showTools,onClick:e[9]||(e[9]=T=>n.uiOptions.showTools=!n.uiOptions.showTools)},null,8,["checked"]),we(o,{title:"Nodes Panel",checked:n.uiOptions.showModelTree,onClick:e[10]||(e[10]=T=>n.uiOptions.showModelTree=!n.uiOptions.showModelTree)},null,8,["checked"]),we(o,{title:"Properties Panel",checked:n.uiOptions.showProperties,onClick:e[11]||(e[11]=T=>n.uiOptions.showProperties=!n.uiOptions.showProperties)},null,8,["checked"]),we(o,{title:"Status Bar",checked:n.uiOptions.showStatusBar,onClick:e[12]||(e[12]=T=>n.uiOptions.showStatusBar=!n.uiOptions.showStatusBar)},null,8,["checked"])]),_:1})]),_:1}),we(o,{sep:""}),we(o,{title:"Quad Views",checked:n.editorCtx.options.quadView,onClick:e[13]||(e[13]=T=>n.editorCtx.options.quadView=!n.editorCtx.options.quadView)},null,8,["checked"]),we(o,{title:"Outline Selected",checked:n.editorCtx.options.outlineSelected,onClick:e[14]||(e[14]=T=>n.editorCtx.options.outlineSelected=!n.editorCtx.options.outlineSelected)},null,8,["checked"]),we(o,{sep:""}),we(o,{title:"Grids",checked:n.editorCtx.options.showGrids,onClick:e[15]||(e[15]=T=>n.editorCtx.options.showGrids=!n.editorCtx.options.showGrids)},null,8,["checked"]),we(o,{title:"Light Indicators",checked:n.editorCtx.options.showLightHelpers,onClick:e[16]||(e[16]=T=>n.editorCtx.options.showLightHelpers=!n.editorCtx.options.showLightHelpers)},null,8,["checked"]),we(o,{title:"IK Joint Indicators",checked:n.editorCtx.options.showIkBones,onClick:e[17]||(e[17]=T=>n.editorCtx.options.showIkBones=!n.editorCtx.options.showIkBones)},null,8,["checked"]),we(o,{title:"OpenPose Keypoints",checked:n.editorCtx.options.showOpenPoseKeypoints,onClick:e[18]||(e[18]=T=>n.editorCtx.options.showOpenPoseKeypoints=!n.editorCtx.options.showOpenPoseKeypoints)},null,8,["checked"])]),_:1}),we(a,{title:"Sketchfab","dynamic-size":""},{default:bt(()=>[j("div",Sve,[n.sketchfabClient.token.accessToken?(Se(),Oe(Dt,{key:0},[j("div",Cve,[gs(j("input",{type:"text",placeholder:"Sketchfab Model URL",style:{"margin-right":"4px",width:"260px"},"onUpdate:modelValue":e[19]||(e[19]=T=>n.sketchfabModelUrl=T),onKeydown:e[20]||(e[20]=Ln((...T)=>n.onSketchfabImportModel&&n.onSketchfabImportModel(...T),["enter"]))},null,544),[[Pl,n.sketchfabModelUrl]]),j("button",{class:"normal-button",style:{"font-size":"8px",padding:"2px 6px"},onClick:e[21]||(e[21]=(...T)=>n.onSketchfabImportModel&&n.onSketchfabImportModel(...T))}," Import ")]),j("div",Eve,[Tve,j("div",Pve,un(n.sketchfabClient.user.displayName),1),j("button",{class:"normal-button",onClick:e[22]||(e[22]=(...T)=>n.onSketchfabLogout&&n.onSketchfabLogout(...T)),style:{"font-size":"8px",padding:"2px 6px"}}," Logout ")])],64)):(Se(),Oe("button",{key:1,class:"normal-button",onClick:e[23]||(e[23]=(...T)=>n.onSketchfabLogin&&n.onSketchfabLogin(...T))}," Sketchfab Login "))])]),_:1}),we(a,{title:"Camera","dynamic-size":""},{default:bt(()=>[j("div",Rve,[j("div",Ive,[Dve,we(l,{style:{width:"4em","margin-right":"8px"},min:4,max:90,value:n.editorCtx.model.cameraFov,onInput:e[24]||(e[24]=T=>n.editorCtx.model.cameraFov=T)},null,8,["value"]),we(c,{label:"Orthographic",value:!n.editorCtx.model.cameraPerspective,onInput:e[25]||(e[25]=T=>n.editorCtx.model.cameraPerspective=!T)},null,8,["value"])]),j("div",Lve,[(Se(!0),Oe(Dt,null,ji(n.editorCtx.model.cameras,(T,N)=>(Se(),Oe("div",Ove,[j("div",{class:"name normal-button",onClick:E=>n.onLoadCamera(T)},un(T.name),9,kve),j("button",{class:"icon-button",onClick:E=>n.onDeleteCamera(N)},"\xD7",8,Nve)]))),256))]),j("button",{class:"normal-button",style:{width:"100%","margin-top":"4px"},onClick:e[26]||(e[26]=(...T)=>n.onSaveCamera&&n.onSaveCamera(...T))}," Save Current ")])]),_:1}),we(a,{title:"Render"},{default:bt(()=>[we(o,{title:"Stable Diffusion",onClick:n.onShowSdDialog},null,8,["onClick"])]),_:1}),we(a,{title:"About","dynamic-size":""},{default:bt(()=>[Fve]),_:1}),j("button",{class:"popup-menu-trigger",onClick:e[27]||(e[27]=(...T)=>n.onOpenFeedback&&n.onOpenFeedback(...T)),style:{cursor:"pointer"}}," Feedback "),j("button",{class:"popup-menu-trigger",onClick:e[28]||(e[28]=(...T)=>n.onOpenTutorial&&n.onOpenTutorial(...T)),style:{cursor:"pointer"}}," Tutorial "),n.editorCtx.tool.sculpt?(Se(),Oe(Dt,{key:0},[zve,we(h,{style:{"margin-right":"6px"},value:n.editorCtx.tool.brushRadius,"onUpdate:value":e[29]||(e[29]=T=>n.editorCtx.tool.brushRadius=T),label:"Radius",min:1,max:200,step:1,"fraction-digits":0},null,8,["value"]),n.editorCtx.tool.hasHardness?(Se(),Xt(h,{key:0,style:{"margin-right":"6px"},value:n.editorCtx.tool.brushHardness,"onUpdate:value":e[30]||(e[30]=T=>n.editorCtx.tool.brushHardness=T),label:"Hardness",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"])):tt("",!0),we(h,{style:{"margin-right":"2px"},value:n.editorCtx.tool.brushStrength,"onUpdate:value":e[31]||(e[31]=T=>n.editorCtx.tool.brushStrength=T),label:"Strength",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"]),j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.options.enablePressure}]),title:"Enable Tablet Pressure Sensitivity",style:{"margin-right":"6px",padding:"0"},onClick:e[32]||(e[32]=T=>n.editorCtx.options.enablePressure=!n.editorCtx.options.enablePressure)},Uve,2),j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.tool.frontFacesOnly}]),title:"Front Faces Only",style:{"margin-right":"6px",padding:"0"},onClick:e[33]||(e[33]=T=>n.editorCtx.tool.frontFacesOnly=!n.editorCtx.tool.frontFacesOnly)},Vve,2),n.editorCtx.tool.hasDirection?(Se(),Oe("div",Gve,[j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===1}]),style:{padding:"0"},onClick:e[34]||(e[34]=T=>n.editorCtx.tool.brushDirection=1)},Wve,2),n.editorCtx.tool.hasThirdDirection?(Se(),Oe("button",{key:0,class:pn(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===0}]),style:{padding:"0"},onClick:e[35]||(e[35]=T=>n.editorCtx.tool.brushDirection=0)},Xve,2)):tt("",!0),j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.tool.brushDirection===-1}]),style:{padding:"0"},onClick:e[36]||(e[36]=T=>n.editorCtx.tool.brushDirection=-1)},qve,2)])):tt("",!0),n.canRemesh?(Se(),Xt(a,{key:2,title:"Remesh","class-name":"normal-button dropdown"},{default:bt(()=>[j("div",Kve,[j("div",Zve,[Qve,we(l,{class:"value",style:{width:"6em"},min:1e-4,max:1,value:n.editorCtx.options.remeshVoxelSize,onInput:e[37]||(e[37]=T=>n.editorCtx.options.remeshVoxelSize=T)},null,8,["min","value"]),Jve]),j("button",{class:"normal-button",style:{width:"100%"},onClick:e[38]||(e[38]=(...T)=>n.onRemesh&&n.onRemesh(...T))}," Remesh ")])]),_:1})):tt("",!0)],64)):tt("",!0),eye,j("div",tye,[j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="depth"}]),title:"Depth Map",style:{padding:"0"},onClick:e[39]||(e[39]=T=>n.editorCtx.options.shadingMode="depth")},sye,2),j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="edge"}]),title:"Edge",style:{padding:"0"},onClick:e[40]||(e[40]=T=>n.editorCtx.options.shadingMode="edge")},rye,2)]),j("div",oye,[j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="solid"}]),title:"Shadow Off",style:{padding:"0"},onClick:e[41]||(e[41]=T=>n.editorCtx.options.shadingMode="solid")},lye,2),j("button",{class:pn(["normal-button toggle-button",{active:n.editorCtx.options.shadingMode==="rendered"}]),title:"Shadow On",style:{padding:"0"},onClick:e[42]||(e[42]=T=>n.editorCtx.options.shadingMode="rendered")},uye,2)])],64)):tt("",!0)]),j("div",hye,[n.uiOptions.showTools?(Se(),Oe("div",dye,[j("div",fye,[n.editorCtx?(Se(),Oe("div",pye,[(Se(!0),Oe(Dt,null,ji(n.editorCtx.tools,T=>(Se(),Oe(Dt,null,[T.sep?(Se(),Oe("hr",mye)):tt("",!0),T.sep?tt("",!0):(Se(),Oe("button",{key:1,class:pn(["tool icon-button toggle-button",{active:n.editorCtx.tool===T}]),title:T.label,onClick:N=>n.editorCtx.tool=T},[j("img",{src:T.icon,alt:""},null,8,vye)],10,gye))],64))),256))])):tt("",!0)])])):tt("",!0),n.uiOptions.showModelTree?(Se(),Xt(f,{key:1,direction:"right",width:n.uiOptions.modelTreePanelWidth,"onUpdate:width":e[45]||(e[45]=T=>n.uiOptions.modelTreePanelWidth=T),style:{"border-left":"none"}},{default:bt(()=>[n.editorCtx?(Se(),Oe("div",yye,[j("div",{class:"toolbar",onClick:e[44]||(e[44]=Hn(T=>n.onSelect([]),["self"]))},[we(a,{title:"Add",disabled:!n.validChildNodeDefs.length},{default:bt(()=>[(Se(!0),Oe(Dt,null,ji(n.validChildNodeDefs,T=>(Se(),Xt(o,{key:T.name,title:T.label,icon:T.icon,onClick:N=>n.onAddNode(T.name)},null,8,["title","icon","onClick"]))),128))]),_:1},8,["disabled"]),j("button",{disabled:!n.canDelete,onClick:e[43]||(e[43]=(...T)=>n.onDelete&&n.onDelete(...T))}," Delete ",8,_ye)]),we(d,{class:"fill",model:n.editorCtx.model,onSelect:n.onSelect,onSetValue:n.onSetValue,onMoveNode:n.onMoveNode,onFocus:n.onFocus,onCut:n.onCut,onCopy:n.onCopy,onPaste:n.onPaste,onDelete:n.onDelete,onConvertToClay:n.onConvertToClay,onApplyTransformation:n.onApplyTransformation,onCreateInstance:n.onCreateInstance,onFlip:n.onFlip,onCopyPose:n.onCopyPose,onPastePose:n.onPastePose},null,8,["model","onSelect","onSetValue","onMoveNode","onFocus","onCut","onCopy","onPaste","onDelete","onConvertToClay","onApplyTransformation","onCreateInstance","onFlip","onCopyPose","onPastePose"])])):tt("",!0)]),_:1},8,["width"])):tt("",!0),n.uiOptions.showProperties?(Se(),Xt(f,{key:2,direction:"right",width:n.uiOptions.modelNodePropertiesPanelWidth,"onUpdate:width":e[46]||(e[46]=T=>n.uiOptions.modelNodePropertiesPanelWidth=T),style:{"border-left":"none"}},{default:bt(()=>[n.editorCtx?(Se(),Xt(p,{key:0,"editor-context":n.editorCtx,onSetData:n.onSetNodesProperties},null,8,["editor-context","onSetData"])):tt("",!0)]),_:1},8,["width"])):tt("",!0),we(g,{class:"fill","editor-context":n.editorCtx,"quad-view":(S=(x=n.editorCtx)==null?void 0:x.options)==null?void 0:S.quadView,"main-view":(C=n.editorCtx)==null?void 0:C.mainViewIndex,onMounted:n.onCanvasMounted,onBeforeUnmount:n.onBeforeCanvasUnmount,onSetView:n.onSetView},null,8,["editor-context","quad-view","main-view","onMounted","onBeforeUnmount","onSetView"])]),n.uiOptions.showStatusBar&&n.editorCtx?(Se(),Oe("div",bye,[j("div",null,un(n.editorCtx.statusBarMessage),1),wye,j("div",null,"FPS: "+un(n.editorCtx.fps),1)])):tt("",!0)],544),n.editorCtx?(Se(),Xt(v,{key:0,title:"Color",visible:n.editorCtx.tool.hasColor,x:n.uiOptions.colorPanelX,"onUpdate:x":e[57]||(e[57]=T=>n.uiOptions.colorPanelX=T),y:n.uiOptions.colorPanelY,"onUpdate:y":e[58]||(e[58]=T=>n.uiOptions.colorPanelY=T)},{default:bt(()=>[we(m,{value:n.editorCtx.options.paintColor,"onUpdate:value":e[56]||(e[56]=T=>n.editorCtx.options.paintColor=T),"color-box":""},null,8,["value"])]),_:1},8,["visible","x","y"])):tt("",!0),((R=(M=n.editorCtx)==null?void 0:M.options)==null?void 0:R.shadingMode)==="depth"?(Se(),Xt(v,{key:1,title:"Depth Map",x:n.uiOptions.depthMapPanelX,"onUpdate:x":e[61]||(e[61]=T=>n.uiOptions.depthMapPanelX=T),y:n.uiOptions.depthMapPanelY,"onUpdate:y":e[62]||(e[62]=T=>n.uiOptions.depthMapPanelY=T),visible:!0},{default:bt(()=>[j("div",xye,[j("div",Aye,[Mye,we(y,{class:"value",value:n.editorCtx.options.depthMapOffset,min:-20,max:20,step:.001,onInput:e[59]||(e[59]=T=>n.editorCtx.options.depthMapOffset=T)},null,8,["value","step"])]),j("div",Sye,[Cye,we(y,{class:"value",value:n.editorCtx.options.depthMapScale,min:0,max:1,step:.001,onInput:e[60]||(e[60]=T=>n.editorCtx.options.depthMapScale=T)},null,8,["value","step"])])])]),_:1},8,["x","y"])):tt("",!0),((k=(D=n.editorCtx)==null?void 0:D.options)==null?void 0:k.shadingMode)==="edge"?(Se(),Xt(v,{key:2,title:"Edge",x:n.uiOptions.edgePanelX,"onUpdate:x":e[65]||(e[65]=T=>n.uiOptions.edgePanelX=T),y:n.uiOptions.edgePanelY,"onUpdate:y":e[66]||(e[66]=T=>n.uiOptions.edgePanelY=T),visible:!0},{default:bt(()=>[j("div",Eye,[j("div",Tye,[Pye,we(y,{class:"value",value:n.editorCtx.options.edgeDetectNormalThreshold,min:0,max:1,step:.001,onInput:e[63]||(e[63]=T=>n.editorCtx.options.edgeDetectNormalThreshold=T)},null,8,["value","step"])]),j("div",Rye,[Iye,we(y,{class:"value",value:n.editorCtx.options.edgeDetectDepthThreshold,min:0,max:2,step:.001,onInput:e[64]||(e[64]=T=>n.editorCtx.options.edgeDetectDepthThreshold=T)},null,8,["value","step"])])])]),_:1},8,["x","y"])):tt("",!0),n.editorCtx&&n.sdDialog?(Se(),Xt(v,{key:3,title:"Stable Diffusion",visible:n.sdDialog,"onUpdate:visible":e[104]||(e[104]=T=>n.sdDialog=T),x:n.uiOptions.sdPanelX,"onUpdate:x":e[105]||(e[105]=T=>n.uiOptions.sdPanelX=T),y:n.uiOptions.sdPanelY,"onUpdate:y":e[106]||(e[106]=T=>n.uiOptions.sdPanelY=T),closable:""},{default:bt(()=>[j("div",Dye,[j("div",Lye,[Oye,gs(j("input",{class:"value",type:"text","onUpdate:modelValue":e[67]||(e[67]=T=>n.editorCtx.options.sdServer=T)},null,512),[[Pl,n.editorCtx.options.sdServer]]),j("button",{class:"icon-button",title:"Refresh",onClick:e[68]||(e[68]=(...T)=>n.onRefreshSdServer&&n.onRefreshSdServer(...T))},Nye)]),j("div",Fye,[j("div",zye,[j("div",Bye,[Uye,gs(j("input",{class:"value",type:"text","onUpdate:modelValue":e[69]||(e[69]=T=>n.editorCtx.options.sdPrompt=T)},null,512),[[Pl,n.editorCtx.options.sdPrompt]])]),j("div",$ye,[Vye,gs(j("input",{class:"value",type:"text","onUpdate:modelValue":e[70]||(e[70]=T=>n.editorCtx.options.sdNPrompt=T)},null,512),[[Pl,n.editorCtx.options.sdNPrompt]])])]),j("div",Gye,[j("div",Hye,[Wye,gs(j("input",{class:"value",type:"text","onUpdate:modelValue":e[71]||(e[71]=T=>n.editorCtx.options.sdPromptA=T)},null,512),[[Pl,n.editorCtx.options.sdPromptA]])]),j("div",jye,[Xye,gs(j("input",{class:"value",type:"text","onUpdate:modelValue":e[72]||(e[72]=T=>n.editorCtx.options.sdNPromptA=T)},null,512),[[Pl,n.editorCtx.options.sdNPromptA]])])])]),j("div",Yye,[j("div",qye,[j("div",Kye,[Zye,gs(j("select",{class:"value","onUpdate:modelValue":e[73]||(e[73]=T=>n.editorCtx.options.sdSampler=T)},[(Se(!0),Oe(Dt,null,ji(n.sdSamplers,T=>(Se(),Oe("option",{value:T},un(T),9,Qye))),256))],512),[[il,n.editorCtx.options.sdSampler]])])]),j("div",Jye,[j("div",e_e,[t_e,we(l,{class:"value",value:n.editorCtx.options.sdSteps,onInput:e[74]||(e[74]=T=>n.editorCtx.options.sdSteps=T),min:1,max:150,step:1},null,8,["value"])])])]),j("div",n_e,[j("div",s_e,[j("div",i_e,[r_e,we(l,{class:"value",value:n.editorCtx.options.sdWidth,onInput:e[75]||(e[75]=T=>n.editorCtx.options.sdWidth=T),min:1,step:1},null,8,["value"])])]),j("div",o_e,[j("div",a_e,[l_e,we(l,{class:"value",value:n.editorCtx.options.sdHeight,onInput:e[76]||(e[76]=T=>n.editorCtx.options.sdHeight=T),min:1,step:1},null,8,["value"])])])]),we(_,{style:{"margin-bottom":"10px"}},{default:bt(()=>[we(b,null,{title:bt(()=>[j("div",c_e,[we(c,{label:"img2img",value:n.editorCtx.options.sdInputImg,onInput:e[77]||(e[77]=T=>n.editorCtx.options.sdInputImg=T)},null,8,["value"]),dn("\xA0 ")])]),body:bt(()=>[j("div",u_e,[j("button",{class:"normal-button",onClick:e[78]||(e[78]=T=>n.onPasteToCanvas(n.sdInputCanvas))},[h_e,dn(" Paste ")])]),j("canvas",d_e,null,512)]),_:1}),f_e,we(b,null,{title:bt(()=>[j("div",p_e,[we(c,{label:"Depth",value:n.editorCtx.options.sdCnDepthEnabled,onInput:e[79]||(e[79]=T=>n.editorCtx.options.sdCnDepthEnabled=T)},null,8,["value"]),dn("\xA0 "),gs(j("select",{class:"value","onUpdate:modelValue":e[80]||(e[80]=T=>n.editorCtx.options.sdCnDepthModel=T)},[(Se(!0),Oe(Dt,null,ji(n.sdCnModels,T=>(Se(),Oe("option",{value:T},un(T),9,m_e))),256))],512),[[il,n.editorCtx.options.sdCnDepthModel]])])]),body:bt(()=>[j("div",g_e,[v_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnDepthWeight,onInput:e[81]||(e[81]=T=>n.editorCtx.options.sdCnDepthWeight=T)},null,8,["value"]),dn(" \xA0\xA0 "),y_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnDepthGuidanceStart,onInput:e[82]||(e[82]=T=>n.editorCtx.options.sdCnDepthGuidanceStart=T)},null,8,["value"]),__e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnDepthGuidanceEnd,onInput:e[83]||(e[83]=T=>n.editorCtx.options.sdCnDepthGuidanceEnd=T)},null,8,["value"]),dn(" \xA0\xA0 "),b_e,gs(j("select",{"onUpdate:modelValue":e[84]||(e[84]=T=>n.editorCtx.options.sdCnDepthControlMode=T)},M_e,512),[[il,n.editorCtx.options.sdCnDepthControlMode]])]),j("div",S_e,[j("button",{class:"normal-button",onClick:e[85]||(e[85]=T=>n.onPasteToCanvas(n.depthMapCanvas)),style:{"margin-right":"4px"}},[C_e,dn(" Paste ")]),j("button",{class:"normal-button",onClick:e[86]||(e[86]=T=>n.onRefreshOutputCanvas("depth"))},[E_e,dn(" Refresh ")])]),j("canvas",T_e,null,512)]),_:1}),we(b,null,{title:bt(()=>[j("div",P_e,[we(c,{label:"Edge",value:n.editorCtx.options.sdCnEdgeEnabled,onInput:e[87]||(e[87]=T=>n.editorCtx.options.sdCnEdgeEnabled=T)},null,8,["value"]),dn("\xA0 "),gs(j("select",{class:"value","onUpdate:modelValue":e[88]||(e[88]=T=>n.editorCtx.options.sdCnEdgeModel=T)},[(Se(!0),Oe(Dt,null,ji(n.sdCnModels,T=>(Se(),Oe("option",{value:T},un(T),9,R_e))),256))],512),[[il,n.editorCtx.options.sdCnEdgeModel]])])]),body:bt(()=>[j("div",I_e,[D_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnEdgeWeight,onInput:e[89]||(e[89]=T=>n.editorCtx.options.sdCnEdgeWeight=T)},null,8,["value"]),dn(" \xA0\xA0 "),L_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnEdgeGuidanceStart,onInput:e[90]||(e[90]=T=>n.editorCtx.options.sdCnEdgeGuidanceStart=T)},null,8,["value"]),O_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnEdgeGuidanceEnd,onInput:e[91]||(e[91]=T=>n.editorCtx.options.sdCnEdgeGuidanceEnd=T)},null,8,["value"]),dn(" \xA0\xA0 "),k_e,gs(j("select",{"onUpdate:modelValue":e[92]||(e[92]=T=>n.editorCtx.options.sdCnEdgeControlMode=T)},B_e,512),[[il,n.editorCtx.options.sdCnEdgeControlMode]])]),j("div",U_e,[j("button",{class:"normal-button",onClick:e[93]||(e[93]=T=>n.onPasteToCanvas(n.edgeCanvas)),style:{"margin-right":"4px"}},[$_e,dn(" Paste ")]),j("button",{class:"normal-button",onClick:e[94]||(e[94]=T=>n.onRefreshOutputCanvas("edge"))},[V_e,dn(" Refresh ")])]),j("canvas",G_e,null,512)]),_:1}),we(b,null,{title:bt(()=>[j("div",H_e,[we(c,{label:"Pose",value:n.editorCtx.options.sdCnPoseEnabled,onInput:e[95]||(e[95]=T=>n.editorCtx.options.sdCnPoseEnabled=T)},null,8,["value"]),dn("\xA0 "),gs(j("select",{class:"value","onUpdate:modelValue":e[96]||(e[96]=T=>n.editorCtx.options.sdCnPoseModel=T)},[(Se(!0),Oe(Dt,null,ji(n.sdCnModels,T=>(Se(),Oe("option",{value:T},un(T),9,W_e))),256))],512),[[il,n.editorCtx.options.sdCnPoseModel]])])]),body:bt(()=>[j("div",j_e,[X_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnPoseWeight,onInput:e[97]||(e[97]=T=>n.editorCtx.options.sdCnPoseWeight=T)},null,8,["value"]),dn(" \xA0\xA0 "),Y_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnPoseGuidanceStart,onInput:e[98]||(e[98]=T=>n.editorCtx.options.sdCnPoseGuidanceStart=T)},null,8,["value"]),q_e,we(l,{style:{width:"3em"},value:n.editorCtx.options.sdCnPoseGuidanceEnd,onInput:e[99]||(e[99]=T=>n.editorCtx.options.sdCnPoseGuidanceEnd=T)},null,8,["value"]),dn(" \xA0\xA0 "),K_e,gs(j("select",{"onUpdate:modelValue":e[100]||(e[100]=T=>n.editorCtx.options.sdCnPoseControlMode=T)},ebe,512),[[il,n.editorCtx.options.sdCnPoseControlMode]])]),j("div",tbe,[j("button",{class:"normal-button",onClick:e[101]||(e[101]=T=>n.onPasteToCanvas(n.poseCanvas)),style:{"margin-right":"4px"}},[nbe,dn(" Paste ")]),j("button",{class:"normal-button",onClick:e[102]||(e[102]=T=>n.onRefreshOutputCanvas("pose"))},[sbe,dn(" Refresh ")])]),j("canvas",ibe,null,512)]),_:1})]),_:1}),j("button",{class:"normal-button",style:{width:"100%"},disabled:!n.editorCtx.options.sdServer,onClick:e[103]||(e[103]=(...T)=>n.onSdGenerate&&n.onSdGenerate(...T))}," Generate ",8,rbe)])]),_:1},8,["visible","x","y"])):tt("",!0),n.editorCtx&&n.sdResultDialog?(Se(),Xt(v,{key:4,visible:n.sdResultDialog,"onUpdate:visible":e[107]||(e[107]=T=>n.sdResultDialog=T),x:n.uiOptions.sdResultPanelX,"onUpdate:x":e[108]||(e[108]=T=>n.uiOptions.sdResultPanelX=T),y:n.uiOptions.sdResultPanelY,"onUpdate:y":e[109]||(e[109]=T=>n.uiOptions.sdResultPanelY=T),closable:"",title:"Generate Result","body-style":{padding:"0",display:"inline-flex"}},{default:bt(()=>[j("img",{src:n.sdResultImage,alt:"",style:On({width:`${n.editorCtx.options.sdWidth}px`,height:`${n.editorCtx.options.sdHeight}px`})},null,12,obe)]),_:1},8,["visible","x","y"])):tt("",!0),n.sdGenerating?(Se(),Xt(v,{key:5,visible:n.sdGenerating,modal:"",title:"Generating"},{default:bt(()=>[j("div",abe,[j("div",lbe,[j("div",{class:"progress",style:On({width:`${n.sdProgress}%`})},null,4),j("div",cbe,un(n.sdProgress)+"% ",1)])])]),_:1},8,["visible"])):tt("",!0),n.downloadProgressDialog?(Se(),Xt(v,{key:6,visible:n.downloadProgressDialog,modal:"",title:"Downloading"},{default:bt(()=>[j("div",ube,[j("div",hbe,[j("div",{class:"progress",style:On({width:`${n.downloadProgressPercent}%`})},null,4),j("div",dbe,un(n.downloadProgressText)+" / "+un(n.downloadTotalText),1)]),j("button",{class:"normal-button",onClick:e[110]||(e[110]=T=>n.downloadCancelFlag=!0)},"Cancel")])]),_:1},8,["visible"])):tt("",!0),n.fullscreenLoading?(Se(),Xt(w,{key:7})):tt("",!0)],64)}u(fbe,"_sfc_render");var pbe=jt(hve,[["render",fbe],["__scopeId","data-v-c3c868e0"]]);const mbe=BF({history:tF(),routes:[{path:"/:pathMatch(.*)",component:pbe}]}),LA=pP(O5),eN=new Pb;LA.config.errorHandler=function(n,e,t){eN.dispatch(n)};LA.provide("errorSignal",eN);LA.use(mbe).mount("#app");
//# sourceMappingURL=index.57da1ac8.js.map
