var ly=Object.defineProperty;var lT=(i,e,t)=>e in i?ly(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var h=(i,e)=>ly(i,"name",{value:e,configurable:!0});var C=(i,e,t)=>(lT(i,typeof e!="symbol"?e+"":e,t),t);const cT=h(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}h(t,"getFetchOpts");function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}h(n,"processPreload")},"polyfill");cT();function m0(i,e){const t=Object.create(null),n=i.split(",");for(let s=0;s<n.length;s++)t[n[s]]=!0;return e?s=>!!t[s.toLowerCase()]:s=>!!t[s]}h(m0,"makeMap");function En(i){if(rt(i)){const e={};for(let t=0;t<i.length;t++){const n=i[t],s=bn(n)?fT(n):En(n);if(s)for(const r in s)e[r]=s[r]}return e}else{if(bn(i))return i;if(Qt(i))return i}}h(En,"normalizeStyle");const uT=/;(?![^(]*\))/g,hT=/:([^]+)/,dT=/\/\*.*?\*\//gs;function fT(i){const e={};return i.replace(dT,"").split(uT).forEach(t=>{if(t){const n=t.split(hT);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}h(fT,"parseStringStyle");function en(i){let e="";if(bn(i))e=i;else if(rt(i))for(let t=0;t<i.length;t++){const n=en(i[t]);n&&(e+=n+" ")}else if(Qt(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}h(en,"normalizeClass");const pT="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",mT=m0(pT);function wx(i){return!!i||i===""}h(wx,"includeBooleanAttr");const rn=h(i=>bn(i)?i:i==null?"":rt(i)||Qt(i)&&(i.toString===Sx||!at(i.toString))?JSON.stringify(i,xx,2):String(i),"toDisplayString"),xx=h((i,e)=>e&&e.__v_isRef?xx(i,e.value):wl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,s])=>(t[`${n} =>`]=s,t),{})}:Mx(e)?{[`Set(${e.size})`]:[...e.values()]}:Qt(e)&&!rt(e)&&!Cx(e)?String(e):e,"replacer"),Gt={},bl=[],ms=h(()=>{},"NOOP"),gT=h(()=>!1,"NO"),vT=/^on[^a-z]/,Kf=h(i=>vT.test(i),"isOn"),g0=h(i=>i.startsWith("onUpdate:"),"isModelListener"),yi=Object.assign,v0=h((i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},"remove"),yT=Object.prototype.hasOwnProperty,Mt=h((i,e)=>yT.call(i,e),"hasOwn"),rt=Array.isArray,wl=h(i=>qf(i)==="[object Map]","isMap"),Mx=h(i=>qf(i)==="[object Set]","isSet"),at=h(i=>typeof i=="function","isFunction"),bn=h(i=>typeof i=="string","isString"),y0=h(i=>typeof i=="symbol","isSymbol"),Qt=h(i=>i!==null&&typeof i=="object","isObject"),Ax=h(i=>Qt(i)&&at(i.then)&&at(i.catch),"isPromise"),Sx=Object.prototype.toString,qf=h(i=>Sx.call(i),"toTypeString"),_T=h(i=>qf(i).slice(8,-1),"toRawType"),Cx=h(i=>qf(i)==="[object Object]","isPlainObject"),_0=h(i=>bn(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,"isIntegerKey"),af=m0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Zf=h(i=>{const e=Object.create(null);return t=>e[t]||(e[t]=i(t))},"cacheStringFunction"),bT=/-(\w)/g,Gs=Zf(i=>i.replace(bT,(e,t)=>t?t.toUpperCase():"")),wT=/\B([A-Z])/g,_a=Zf(i=>i.replace(wT,"-$1").toLowerCase()),Qf=Zf(i=>i.charAt(0).toUpperCase()+i.slice(1)),Hp=Zf(i=>i?`on${Qf(i)}`:""),Su=h((i,e)=>!Object.is(i,e),"hasChanged"),lf=h((i,e)=>{for(let t=0;t<i.length;t++)i[t](e)},"invokeArrayFns"),Mf=h((i,e,t)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value:t})},"def"),Af=h(i=>{const e=parseFloat(i);return isNaN(e)?i:e},"toNumber");let cy;const xT=h(()=>cy||(cy=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{}),"getGlobalThis");let Es;class Tx{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Es,!e&&Es&&(this.index=(Es.scopes||(Es.scopes=[])).push(this)-1)}run(e){if(this.active){const t=Es;try{return Es=this,e()}finally{Es=t}}}on(){Es=this}off(){Es=this.parent}stop(e){if(this.active){let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this.active=!1}}}h(Tx,"EffectScope");function MT(i,e=Es){e&&e.active&&e.effects.push(i)}h(MT,"recordEffectScope");const b0=h(i=>{const e=new Set(i);return e.w=0,e.n=0,e},"createDep"),Ex=h(i=>(i.w&ao)>0,"wasTracked"),Px=h(i=>(i.n&ao)>0,"newTracked"),AT=h(({deps:i})=>{if(i.length)for(let e=0;e<i.length;e++)i[e].w|=ao},"initDepMarkers"),ST=h(i=>{const{deps:e}=i;if(e.length){let t=0;for(let n=0;n<e.length;n++){const s=e[n];Ex(s)&&!Px(s)?s.delete(i):e[t++]=s,s.w&=~ao,s.n&=~ao}e.length=t}},"finalizeDepMarkers"),xg=new WeakMap;let iu=0,ao=1;const Mg=30;let ds;const sa=Symbol(""),Ag=Symbol("");class Jf{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,MT(this,n)}run(){if(!this.active)return this.fn();let e=ds,t=io;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=ds,ds=this,io=!0,ao=1<<++iu,iu<=Mg?AT(this):uy(this),this.fn()}finally{iu<=Mg&&ST(this),ao=1<<--iu,ds=this.parent,io=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){ds===this?this.deferStop=!0:this.active&&(uy(this),this.onStop&&this.onStop(),this.active=!1)}}h(Jf,"ReactiveEffect");function uy(i){const{deps:e}=i;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(i);e.length=0}}h(uy,"cleanupEffect");let io=!0;const Rx=[];function Yl(){Rx.push(io),io=!1}h(Yl,"pauseTracking");function Kl(){const i=Rx.pop();io=i===void 0?!0:i}h(Kl,"resetTracking");function Vi(i,e,t){if(io&&ds){let n=xg.get(i);n||xg.set(i,n=new Map);let s=n.get(t);s||n.set(t,s=b0()),Ix(s)}}h(Vi,"track");function Ix(i,e){let t=!1;iu<=Mg?Px(i)||(i.n|=ao,t=!Ex(i)):t=!i.has(ds),t&&(i.add(ds),ds.deps.push(i))}h(Ix,"trackEffects");function br(i,e,t,n,s,r){const o=xg.get(i);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(t==="length"&&rt(i)){const l=Af(n);o.forEach((c,u)=>{(u==="length"||u>=l)&&a.push(c)})}else switch(t!==void 0&&a.push(o.get(t)),e){case"add":rt(i)?_0(t)&&a.push(o.get("length")):(a.push(o.get(sa)),wl(i)&&a.push(o.get(Ag)));break;case"delete":rt(i)||(a.push(o.get(sa)),wl(i)&&a.push(o.get(Ag)));break;case"set":wl(i)&&a.push(o.get(sa));break}if(a.length===1)a[0]&&Sg(a[0]);else{const l=[];for(const c of a)c&&l.push(...c);Sg(b0(l))}}h(br,"trigger");function Sg(i,e){const t=rt(i)?i:[...i];for(const n of t)n.computed&&hy(n);for(const n of t)n.computed||hy(n)}h(Sg,"triggerEffects");function hy(i,e){(i!==ds||i.allowRecurse)&&(i.scheduler?i.scheduler():i.run())}h(hy,"triggerEffect");const CT=m0("__proto__,__v_isRef,__isVue"),Dx=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(y0)),TT=w0(),ET=w0(!1,!0),PT=w0(!0),dy=RT();function RT(){const i={};return["includes","indexOf","lastIndexOf"].forEach(e=>{i[e]=function(...t){const n=qe(this);for(let r=0,o=this.length;r<o;r++)Vi(n,"get",r+"");const s=n[e](...t);return s===-1||s===!1?n[e](...t.map(qe)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{i[e]=function(...t){Yl();const n=qe(this)[e].apply(this,t);return Kl(),n}}),i}h(RT,"createArrayInstrumentations");function w0(i=!1,e=!1){return h(function(n,s,r){if(s==="__v_isReactive")return!i;if(s==="__v_isReadonly")return i;if(s==="__v_isShallow")return e;if(s==="__v_raw"&&r===(i?e?$T:Fx:e?Nx:Ox).get(n))return n;const o=rt(n);if(!i&&o&&Mt(dy,s))return Reflect.get(dy,s,r);const a=Reflect.get(n,s,r);return(y0(s)?Dx.has(s):CT(s))||(i||Vi(n,"get",s),e)?a:Qn(a)?o&&_0(s)?a:a.value:Qt(a)?i?zx(a):vr(a):a},"get")}h(w0,"createGetter");const IT=Lx(),DT=Lx(!0);function Lx(i=!1){return h(function(t,n,s,r){let o=t[n];if(El(o)&&Qn(o)&&!Qn(s))return!1;if(!i&&(!Sf(s)&&!El(s)&&(o=qe(o),s=qe(s)),!rt(t)&&Qn(o)&&!Qn(s)))return o.value=s,!0;const a=rt(t)&&_0(n)?Number(n)<t.length:Mt(t,n),l=Reflect.set(t,n,s,r);return t===qe(r)&&(a?Su(s,o)&&br(t,"set",n,s):br(t,"add",n,s)),l},"set")}h(Lx,"createSetter");function LT(i,e){const t=Mt(i,e);i[e];const n=Reflect.deleteProperty(i,e);return n&&t&&br(i,"delete",e,void 0),n}h(LT,"deleteProperty");function kT(i,e){const t=Reflect.has(i,e);return(!y0(e)||!Dx.has(e))&&Vi(i,"has",e),t}h(kT,"has");function OT(i){return Vi(i,"iterate",rt(i)?"length":sa),Reflect.ownKeys(i)}h(OT,"ownKeys");const kx={get:TT,set:IT,deleteProperty:LT,has:kT,ownKeys:OT},NT={get:PT,set(i,e){return!0},deleteProperty(i,e){return!0}},FT=yi({},kx,{get:ET,set:DT}),x0=h(i=>i,"toShallow"),ep=h(i=>Reflect.getPrototypeOf(i),"getProto");function xh(i,e,t=!1,n=!1){i=i.__v_raw;const s=qe(i),r=qe(e);t||(e!==r&&Vi(s,"get",e),Vi(s,"get",r));const{has:o}=ep(s),a=n?x0:t?S0:Cu;if(o.call(s,e))return a(i.get(e));if(o.call(s,r))return a(i.get(r));i!==s&&i.get(e)}h(xh,"get$1");function Mh(i,e=!1){const t=this.__v_raw,n=qe(t),s=qe(i);return e||(i!==s&&Vi(n,"has",i),Vi(n,"has",s)),i===s?t.has(i):t.has(i)||t.has(s)}h(Mh,"has$1");function Ah(i,e=!1){return i=i.__v_raw,!e&&Vi(qe(i),"iterate",sa),Reflect.get(i,"size",i)}h(Ah,"size");function fy(i){i=qe(i);const e=qe(this);return ep(e).has.call(e,i)||(e.add(i),br(e,"add",i,i)),this}h(fy,"add");function py(i,e){e=qe(e);const t=qe(this),{has:n,get:s}=ep(t);let r=n.call(t,i);r||(i=qe(i),r=n.call(t,i));const o=s.call(t,i);return t.set(i,e),r?Su(e,o)&&br(t,"set",i,e):br(t,"add",i,e),this}h(py,"set$1");function my(i){const e=qe(this),{has:t,get:n}=ep(e);let s=t.call(e,i);s||(i=qe(i),s=t.call(e,i)),n&&n.call(e,i);const r=e.delete(i);return s&&br(e,"delete",i,void 0),r}h(my,"deleteEntry");function gy(){const i=qe(this),e=i.size!==0,t=i.clear();return e&&br(i,"clear",void 0,void 0),t}h(gy,"clear");function Sh(i,e){return h(function(n,s){const r=this,o=r.__v_raw,a=qe(o),l=e?x0:i?S0:Cu;return!i&&Vi(a,"iterate",sa),o.forEach((c,u)=>n.call(s,l(c),l(u),r))},"forEach")}h(Sh,"createForEach");function Ch(i,e,t){return function(...n){const s=this.__v_raw,r=qe(s),o=wl(r),a=i==="entries"||i===Symbol.iterator&&o,l=i==="keys"&&o,c=s[i](...n),u=t?x0:e?S0:Cu;return!e&&Vi(r,"iterate",l?Ag:sa),{next(){const{value:d,done:f}=c.next();return f?{value:d,done:f}:{value:a?[u(d[0]),u(d[1])]:u(d),done:f}},[Symbol.iterator](){return this}}}}h(Ch,"createIterableMethod");function Lr(i){return function(...e){return i==="delete"?!1:this}}h(Lr,"createReadonlyMethod");function zT(){const i={get(r){return xh(this,r)},get size(){return Ah(this)},has:Mh,add:fy,set:py,delete:my,clear:gy,forEach:Sh(!1,!1)},e={get(r){return xh(this,r,!1,!0)},get size(){return Ah(this)},has:Mh,add:fy,set:py,delete:my,clear:gy,forEach:Sh(!1,!0)},t={get(r){return xh(this,r,!0)},get size(){return Ah(this,!0)},has(r){return Mh.call(this,r,!0)},add:Lr("add"),set:Lr("set"),delete:Lr("delete"),clear:Lr("clear"),forEach:Sh(!0,!1)},n={get(r){return xh(this,r,!0,!0)},get size(){return Ah(this,!0)},has(r){return Mh.call(this,r,!0)},add:Lr("add"),set:Lr("set"),delete:Lr("delete"),clear:Lr("clear"),forEach:Sh(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{i[r]=Ch(r,!1,!1),t[r]=Ch(r,!0,!1),e[r]=Ch(r,!1,!0),n[r]=Ch(r,!0,!0)}),[i,t,e,n]}h(zT,"createInstrumentations");const[BT,UT,VT,HT]=zT();function M0(i,e){const t=e?i?HT:VT:i?UT:BT;return(n,s,r)=>s==="__v_isReactive"?!i:s==="__v_isReadonly"?i:s==="__v_raw"?n:Reflect.get(Mt(t,s)&&s in n?t:n,s,r)}h(M0,"createInstrumentationGetter");const GT={get:M0(!1,!1)},WT={get:M0(!1,!0)},jT={get:M0(!0,!1)},Ox=new WeakMap,Nx=new WeakMap,Fx=new WeakMap,$T=new WeakMap;function XT(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}h(XT,"targetTypeMap");function YT(i){return i.__v_skip||!Object.isExtensible(i)?0:XT(_T(i))}h(YT,"getTargetType");function vr(i){return El(i)?i:A0(i,!1,kx,GT,Ox)}h(vr,"reactive");function KT(i){return A0(i,!1,FT,WT,Nx)}h(KT,"shallowReactive");function zx(i){return A0(i,!0,NT,jT,Fx)}h(zx,"readonly");function A0(i,e,t,n,s){if(!Qt(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const r=s.get(i);if(r)return r;const o=YT(i);if(o===0)return i;const a=new Proxy(i,o===2?n:t);return s.set(i,a),a}h(A0,"createReactiveObject");function xl(i){return El(i)?xl(i.__v_raw):!!(i&&i.__v_isReactive)}h(xl,"isReactive");function El(i){return!!(i&&i.__v_isReadonly)}h(El,"isReadonly");function Sf(i){return!!(i&&i.__v_isShallow)}h(Sf,"isShallow");function Bx(i){return xl(i)||El(i)}h(Bx,"isProxy");function qe(i){const e=i&&i.__v_raw;return e?qe(e):i}h(qe,"toRaw");function Ux(i){return Mf(i,"__v_skip",!0),i}h(Ux,"markRaw");const Cu=h(i=>Qt(i)?vr(i):i,"toReactive"),S0=h(i=>Qt(i)?zx(i):i,"toReadonly");function Vx(i){io&&ds&&(i=qe(i),Ix(i.dep||(i.dep=b0())))}h(Vx,"trackRefValue");function Hx(i,e){i=qe(i),i.dep&&Sg(i.dep)}h(Hx,"triggerRefValue");function Qn(i){return!!(i&&i.__v_isRef===!0)}h(Qn,"isRef");function ze(i){return Gx(i,!1)}h(ze,"ref");function qT(i){return Gx(i,!0)}h(qT,"shallowRef");function Gx(i,e){return Qn(i)?i:new Wx(i,e)}h(Gx,"createRef");class Wx{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:qe(e),this._value=t?e:Cu(e)}get value(){return Vx(this),this._value}set value(e){const t=this.__v_isShallow||Sf(e)||El(e);e=t?e:qe(e),Su(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:Cu(e),Hx(this))}}h(Wx,"RefImpl");function Ml(i){return Qn(i)?i.value:i}h(Ml,"unref");const ZT={get:(i,e,t)=>Ml(Reflect.get(i,e,t)),set:(i,e,t,n)=>{const s=i[e];return Qn(s)&&!Qn(t)?(s.value=t,!0):Reflect.set(i,e,t,n)}};function jx(i){return xl(i)?i:new Proxy(i,ZT)}h(jx,"proxyRefs");var $x;class Xx{constructor(e,t,n,s){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[$x]=!1,this._dirty=!0,this.effect=new Jf(e,()=>{this._dirty||(this._dirty=!0,Hx(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=n}get value(){const e=qe(this);return Vx(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}h(Xx,"ComputedRefImpl");$x="__v_isReadonly";function QT(i,e,t=!1){let n,s;const r=at(i);return r?(n=i,s=ms):(n=i.get,s=i.set),new Xx(n,s,r||!s,t)}h(QT,"computed$1");function so(i,e,t,n){let s;try{s=n?i(...n):i()}catch(r){tp(r,e,t)}return s}h(so,"callWithErrorHandling");function gs(i,e,t,n){if(at(i)){const r=so(i,e,t,n);return r&&Ax(r)&&r.catch(o=>{tp(o,e,t)}),r}const s=[];for(let r=0;r<i.length;r++)s.push(gs(i[r],e,t,n));return s}h(gs,"callWithAsyncErrorHandling");function tp(i,e,t,n=!0){const s=e?e.vnode:null;if(e){let r=e.parent;const o=e.proxy,a=t;for(;r;){const c=r.ec;if(c){for(let u=0;u<c.length;u++)if(c[u](i,o,a)===!1)return}r=r.parent}const l=e.appContext.config.errorHandler;if(l){so(l,null,10,[i,o,a]);return}}JT(i,t,s,n)}h(tp,"handleError");function JT(i,e,t,n=!0){console.error(i)}h(JT,"logError");let Tu=!1,Cg=!1;const qn=[];let Ds=0;const Al=[];let ur=null,Zo=0;const Yx=Promise.resolve();let C0=null;function Qi(i){const e=C0||Yx;return i?e.then(this?i.bind(this):i):e}h(Qi,"nextTick");function e3(i){let e=Ds+1,t=qn.length;for(;e<t;){const n=e+t>>>1;Eu(qn[n])<i?e=n+1:t=n}return e}h(e3,"findInsertionIndex");function T0(i){(!qn.length||!qn.includes(i,Tu&&i.allowRecurse?Ds+1:Ds))&&(i.id==null?qn.push(i):qn.splice(e3(i.id),0,i),Kx())}h(T0,"queueJob");function Kx(){!Tu&&!Cg&&(Cg=!0,C0=Yx.then(Zx))}h(Kx,"queueFlush");function t3(i){const e=qn.indexOf(i);e>Ds&&qn.splice(e,1)}h(t3,"invalidateJob");function n3(i){rt(i)?Al.push(...i):(!ur||!ur.includes(i,i.allowRecurse?Zo+1:Zo))&&Al.push(i),Kx()}h(n3,"queuePostFlushCb");function vy(i,e=Tu?Ds+1:0){for(;e<qn.length;e++){const t=qn[e];t&&t.pre&&(qn.splice(e,1),e--,t())}}h(vy,"flushPreFlushCbs");function qx(i){if(Al.length){const e=[...new Set(Al)];if(Al.length=0,ur){ur.push(...e);return}for(ur=e,ur.sort((t,n)=>Eu(t)-Eu(n)),Zo=0;Zo<ur.length;Zo++)ur[Zo]();ur=null,Zo=0}}h(qx,"flushPostFlushCbs");const Eu=h(i=>i.id==null?1/0:i.id,"getId"),i3=h((i,e)=>{const t=Eu(i)-Eu(e);if(t===0){if(i.pre&&!e.pre)return-1;if(e.pre&&!i.pre)return 1}return t},"comparator");function Zx(i){Cg=!1,Tu=!0,qn.sort(i3);const e=ms;try{for(Ds=0;Ds<qn.length;Ds++){const t=qn[Ds];t&&t.active!==!1&&so(t,null,14)}}finally{Ds=0,qn.length=0,qx(),Tu=!1,C0=null,(qn.length||Al.length)&&Zx()}}h(Zx,"flushJobs");function s3(i,e,...t){if(i.isUnmounted)return;const n=i.vnode.props||Gt;let s=t;const r=e.startsWith("update:"),o=r&&e.slice(7);if(o&&o in n){const u=`${o==="modelValue"?"model":o}Modifiers`,{number:d,trim:f}=n[u]||Gt;f&&(s=t.map(p=>bn(p)?p.trim():p)),d&&(s=t.map(Af))}let a,l=n[a=Hp(e)]||n[a=Hp(Gs(e))];!l&&r&&(l=n[a=Hp(_a(e))]),l&&gs(l,i,6,s);const c=n[a+"Once"];if(c){if(!i.emitted)i.emitted={};else if(i.emitted[a])return;i.emitted[a]=!0,gs(c,i,6,s)}}h(s3,"emit$1");function Qx(i,e,t=!1){const n=e.emitsCache,s=n.get(i);if(s!==void 0)return s;const r=i.emits;let o={},a=!1;if(!at(i)){const l=h(c=>{const u=Qx(c,e,!0);u&&(a=!0,yi(o,u))},"extendEmits");!t&&e.mixins.length&&e.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!r&&!a?(Qt(i)&&n.set(i,null),null):(rt(r)?r.forEach(l=>o[l]=null):yi(o,r),Qt(i)&&n.set(i,o),o)}h(Qx,"normalizeEmitsOptions");function np(i,e){return!i||!Kf(e)?!1:(e=e.slice(2).replace(/Once$/,""),Mt(i,e[0].toLowerCase()+e.slice(1))||Mt(i,_a(e))||Mt(i,e))}h(np,"isEmitListener");let Jn=null,ip=null;function Cf(i){const e=Jn;return Jn=i,ip=i&&i.type.__scopeId||null,e}h(Cf,"setCurrentRenderingInstance");function ba(i){ip=i}h(ba,"pushScopeId");function wa(){ip=null}h(wa,"popScopeId");function Ht(i,e=Jn,t){if(!e||i._n)return i;const n=h((...s)=>{n._d&&Ty(-1);const r=Cf(e);let o;try{o=i(...s)}finally{Cf(r),n._d&&Ty(1)}return o},"renderFnWithContext");return n._n=!0,n._c=!0,n._d=!0,n}h(Ht,"withCtx");function Gp(i){const{type:e,vnode:t,proxy:n,withProxy:s,props:r,propsOptions:[o],slots:a,attrs:l,emit:c,render:u,renderCache:d,data:f,setupState:p,ctx:g,inheritAttrs:m}=i;let v,y;const b=Cf(i);try{if(t.shapeFlag&4){const x=s||n;v=Rs(u.call(x,x,d,r,p,f,g)),y=l}else{const x=e;v=Rs(x.length>1?x(r,{attrs:l,slots:a,emit:c}):x(r,null)),y=e.props?l:r3(l)}}catch(x){fu.length=0,tp(x,i,1),v=Pe(lo)}let _=v;if(y&&m!==!1){const x=Object.keys(y),{shapeFlag:w}=_;x.length&&w&7&&(o&&x.some(g0)&&(y=o3(y,o)),_=Pl(_,y))}return t.dirs&&(_=Pl(_),_.dirs=_.dirs?_.dirs.concat(t.dirs):t.dirs),t.transition&&(_.transition=t.transition),v=_,Cf(b),v}h(Gp,"renderComponentRoot");const r3=h(i=>{let e;for(const t in i)(t==="class"||t==="style"||Kf(t))&&((e||(e={}))[t]=i[t]);return e},"getFunctionalFallthrough"),o3=h((i,e)=>{const t={};for(const n in i)(!g0(n)||!(n.slice(9)in e))&&(t[n]=i[n]);return t},"filterModelListeners");function a3(i,e,t){const{props:n,children:s,component:r}=i,{props:o,children:a,patchFlag:l}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return n?yy(n,o,c):!!o;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const f=u[d];if(o[f]!==n[f]&&!np(c,f))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:n===o?!1:n?o?yy(n,o,c):!0:!!o;return!1}h(a3,"shouldUpdateComponent");function yy(i,e,t){const n=Object.keys(e);if(n.length!==Object.keys(i).length)return!0;for(let s=0;s<n.length;s++){const r=n[s];if(e[r]!==i[r]&&!np(t,r))return!0}return!1}h(yy,"hasPropsChanged");function l3({vnode:i,parent:e},t){for(;e&&e.subTree===i;)(i=e.vnode).el=t,e=e.parent}h(l3,"updateHOCHostEl");const c3=h(i=>i.__isSuspense,"isSuspense");function u3(i,e){e&&e.pendingBranch?rt(i)?e.effects.push(...i):e.effects.push(i):n3(i)}h(u3,"queueEffectWithSuspense");function Sl(i,e){if(Wn){let t=Wn.provides;const n=Wn.parent&&Wn.parent.provides;n===t&&(t=Wn.provides=Object.create(n)),t[i]=e}}h(Sl,"provide");function ei(i,e,t=!1){const n=Wn||Jn;if(n){const s=n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides;if(s&&i in s)return s[i];if(arguments.length>1)return t&&at(e)?e.call(n.proxy):e}}h(ei,"inject$1");const Th={};function mi(i,e,t){return Jx(i,e,t)}h(mi,"watch");function Jx(i,e,{immediate:t,deep:n,flush:s,onTrack:r,onTrigger:o}=Gt){const a=Wn;let l,c=!1,u=!1;if(Qn(i)?(l=h(()=>i.value,"getter"),c=Sf(i)):xl(i)?(l=h(()=>i,"getter"),n=!0):rt(i)?(u=!0,c=i.some(_=>xl(_)||Sf(_)),l=h(()=>i.map(_=>{if(Qn(_))return _.value;if(xl(_))return ea(_);if(at(_))return so(_,a,2)}),"getter")):at(i)?e?l=h(()=>so(i,a,2),"getter"):l=h(()=>{if(!(a&&a.isUnmounted))return d&&d(),gs(i,a,3,[f])},"getter"):l=ms,e&&n){const _=l;l=h(()=>ea(_()),"getter")}let d,f=h(_=>{d=y.onStop=()=>{so(_,a,4)}},"onCleanup"),p;if(Iu)if(f=ms,e?t&&gs(e,a,3,[l(),u?[]:void 0,f]):l(),s==="sync"){const _=tE();p=_.__watcherHandles||(_.__watcherHandles=[])}else return ms;let g=u?new Array(i.length).fill(Th):Th;const m=h(()=>{if(!!y.active)if(e){const _=y.run();(n||c||(u?_.some((x,w)=>Su(x,g[w])):Su(_,g)))&&(d&&d(),gs(e,a,3,[_,g===Th?void 0:u&&g[0]===Th?[]:g,f]),g=_)}else y.run()},"job");m.allowRecurse=!!e;let v;s==="sync"?v=m:s==="post"?v=h(()=>Mi(m,a&&a.suspense),"scheduler"):(m.pre=!0,a&&(m.id=a.uid),v=h(()=>T0(m),"scheduler"));const y=new Jf(l,v);e?t?m():g=y.run():s==="post"?Mi(y.run.bind(y),a&&a.suspense):y.run();const b=h(()=>{y.stop(),a&&a.scope&&v0(a.scope.effects,y)},"unwatch");return p&&p.push(b),b}h(Jx,"doWatch");function h3(i,e,t){const n=this.proxy,s=bn(i)?i.includes(".")?eM(n,i):()=>n[i]:i.bind(n,n);let r;at(e)?r=e:(r=e.handler,t=e);const o=Wn;Rl(this);const a=Jx(s,r.bind(n),t);return o?Rl(o):ra(),a}h(h3,"instanceWatch");function eM(i,e){const t=e.split(".");return()=>{let n=i;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}h(eM,"createPathGetter");function ea(i,e){if(!Qt(i)||i.__v_skip||(e=e||new Set,e.has(i)))return i;if(e.add(i),Qn(i))ea(i.value,e);else if(rt(i))for(let t=0;t<i.length;t++)ea(i[t],e);else if(Mx(i)||wl(i))i.forEach(t=>{ea(t,e)});else if(Cx(i))for(const t in i)ea(i[t],e);return i}h(ea,"traverse");function Rt(i){return at(i)?{setup:i,name:i.name}:i}h(Rt,"defineComponent");const uu=h(i=>!!i.type.__asyncLoader,"isAsyncWrapper"),tM=h(i=>i.type.__isKeepAlive,"isKeepAlive");function d3(i,e){nM(i,"a",e)}h(d3,"onActivated");function f3(i,e){nM(i,"da",e)}h(f3,"onDeactivated");function nM(i,e,t=Wn){const n=i.__wdc||(i.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return i()});if(sp(e,n,t),t){let s=t.parent;for(;s&&s.parent;)tM(s.parent.vnode)&&p3(n,e,t,s),s=s.parent}}h(nM,"registerKeepAliveHook");function p3(i,e,t,n){const s=sp(e,i,n,!0);op(()=>{v0(n[e],s)},t)}h(p3,"injectToKeepAliveRoot");function sp(i,e,t=Wn,n=!1){if(t){const s=t[i]||(t[i]=[]),r=e.__weh||(e.__weh=(...o)=>{if(t.isUnmounted)return;Yl(),Rl(t);const a=gs(e,t,i,o);return ra(),Kl(),a});return n?s.unshift(r):s.push(r),r}}h(sp,"injectHook");const Er=h(i=>(e,t=Wn)=>(!Iu||i==="sp")&&sp(i,(...n)=>e(...n),t),"createHook"),m3=Er("bm"),rp=Er("m"),g3=Er("bu"),v3=Er("u"),xa=Er("bum"),op=Er("um"),y3=Er("sp"),_3=Er("rtg"),b3=Er("rtc");function w3(i,e=Wn){sp("ec",i,e)}h(w3,"onErrorCaptured");function ml(i,e){const t=Jn;if(t===null)return i;const n=cp(t)||t.proxy,s=i.dirs||(i.dirs=[]);for(let r=0;r<e.length;r++){let[o,a,l,c=Gt]=e[r];o&&(at(o)&&(o={mounted:o,updated:o}),o.deep&&ea(a),s.push({dir:o,instance:n,value:a,oldValue:void 0,arg:l,modifiers:c}))}return i}h(ml,"withDirectives");function Co(i,e,t,n){const s=i.dirs,r=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];r&&(a.oldValue=r[o].value);let l=a.dir[n];l&&(Yl(),gs(l,t,8,[i.el,a,i,e]),Kl())}}h(Co,"invokeDirectiveHook");const E0="components";function qt(i,e){return sM(E0,i,!0,e)||i}h(qt,"resolveComponent");const iM=Symbol();function x3(i){return bn(i)?sM(E0,i,!1)||i:i||iM}h(x3,"resolveDynamicComponent");function sM(i,e,t=!0,n=!1){const s=Jn||Wn;if(s){const r=s.type;if(i===E0){const a=Q3(r,!1);if(a&&(a===e||a===Gs(e)||a===Qf(Gs(e))))return r}const o=_y(s[i]||r[i],e)||_y(s.appContext[i],e);return!o&&n?r:o}}h(sM,"resolveAsset");function _y(i,e){return i&&(i[e]||i[Gs(e)]||i[Qf(Gs(e))])}h(_y,"resolve");function ro(i,e,t,n){let s;const r=t&&t[n];if(rt(i)||bn(i)){s=new Array(i.length);for(let o=0,a=i.length;o<a;o++)s[o]=e(i[o],o,void 0,r&&r[o])}else if(typeof i=="number"){s=new Array(i);for(let o=0;o<i;o++)s[o]=e(o+1,o,void 0,r&&r[o])}else if(Qt(i))if(i[Symbol.iterator])s=Array.from(i,(o,a)=>e(o,a,void 0,r&&r[a]));else{const o=Object.keys(i);s=new Array(o.length);for(let a=0,l=o.length;a<l;a++){const c=o[a];s[a]=e(i[c],c,a,r&&r[a])}}else s=[];return t&&(t[n]=s),s}h(ro,"renderList");function Pu(i,e,t={},n,s){if(Jn.isCE||Jn.parent&&uu(Jn.parent)&&Jn.parent.isCE)return e!=="default"&&(t.name=e),Pe("slot",t,n&&n());let r=i[e];r&&r._c&&(r._d=!1),Se();const o=r&&rM(r(t)),a=Bt(At,{key:t.key||o&&o.key||`_${e}`},o||(n?n():[]),o&&i._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}h(Pu,"renderSlot");function rM(i){return i.some(e=>Ef(e)?!(e.type===lo||e.type===At&&!rM(e.children)):!0)?i:null}h(rM,"ensureValidVNode");const Tg=h(i=>i?vM(i)?cp(i)||i.proxy:Tg(i.parent):null,"getPublicInstance"),hu=yi(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>Tg(i.parent),$root:i=>Tg(i.root),$emit:i=>i.emit,$options:i=>P0(i),$forceUpdate:i=>i.f||(i.f=()=>T0(i.update)),$nextTick:i=>i.n||(i.n=Qi.bind(i.proxy)),$watch:i=>h3.bind(i)}),Wp=h((i,e)=>i!==Gt&&!i.__isScriptSetup&&Mt(i,e),"hasSetupBinding"),M3={get({_:i},e){const{ctx:t,setupState:n,data:s,props:r,accessCache:o,type:a,appContext:l}=i;let c;if(e[0]!=="$"){const p=o[e];if(p!==void 0)switch(p){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return r[e]}else{if(Wp(n,e))return o[e]=1,n[e];if(s!==Gt&&Mt(s,e))return o[e]=2,s[e];if((c=i.propsOptions[0])&&Mt(c,e))return o[e]=3,r[e];if(t!==Gt&&Mt(t,e))return o[e]=4,t[e];Eg&&(o[e]=0)}}const u=hu[e];let d,f;if(u)return e==="$attrs"&&Vi(i,"get",e),u(i);if((d=a.__cssModules)&&(d=d[e]))return d;if(t!==Gt&&Mt(t,e))return o[e]=4,t[e];if(f=l.config.globalProperties,Mt(f,e))return f[e]},set({_:i},e,t){const{data:n,setupState:s,ctx:r}=i;return Wp(s,e)?(s[e]=t,!0):n!==Gt&&Mt(n,e)?(n[e]=t,!0):Mt(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(r[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:r}},o){let a;return!!t[o]||i!==Gt&&Mt(i,o)||Wp(e,o)||(a=r[0])&&Mt(a,o)||Mt(n,o)||Mt(hu,o)||Mt(s.config.globalProperties,o)},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:Mt(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};let Eg=!0;function A3(i){const e=P0(i),t=i.proxy,n=i.ctx;Eg=!1,e.beforeCreate&&by(e.beforeCreate,i,"bc");const{data:s,computed:r,methods:o,watch:a,provide:l,inject:c,created:u,beforeMount:d,mounted:f,beforeUpdate:p,updated:g,activated:m,deactivated:v,beforeDestroy:y,beforeUnmount:b,destroyed:_,unmounted:x,render:w,renderTracked:T,renderTriggered:P,errorCaptured:M,serverPrefetch:R,expose:L,inheritAttrs:W,components:k,directives:z,filters:S}=e;if(c&&S3(c,n,null,i.appContext.config.unwrapInjectedRef),o)for(const K in o){const ie=o[K];at(ie)&&(n[K]=ie.bind(t))}if(s){const K=s.call(t,t);Qt(K)&&(i.data=vr(K))}if(Eg=!0,r)for(const K in r){const ie=r[K],G=at(ie)?ie.bind(t,t):at(ie.get)?ie.get.bind(t,t):ms,se=!at(ie)&&at(ie.set)?ie.set.bind(t):ms,q=Je({get:G,set:se});Object.defineProperty(n,K,{enumerable:!0,configurable:!0,get:()=>q.value,set:U=>q.value=U})}if(a)for(const K in a)oM(a[K],n,t,K);if(l){const K=at(l)?l.call(t):l;Reflect.ownKeys(K).forEach(ie=>{Sl(ie,K[ie])})}u&&by(u,i,"c");function ne(K,ie){rt(ie)?ie.forEach(G=>K(G.bind(t))):ie&&K(ie.bind(t))}if(h(ne,"registerLifecycleHook"),ne(m3,d),ne(rp,f),ne(g3,p),ne(v3,g),ne(d3,m),ne(f3,v),ne(w3,M),ne(b3,T),ne(_3,P),ne(xa,b),ne(op,x),ne(y3,R),rt(L))if(L.length){const K=i.exposed||(i.exposed={});L.forEach(ie=>{Object.defineProperty(K,ie,{get:()=>t[ie],set:G=>t[ie]=G})})}else i.exposed||(i.exposed={});w&&i.render===ms&&(i.render=w),W!=null&&(i.inheritAttrs=W),k&&(i.components=k),z&&(i.directives=z)}h(A3,"applyOptions");function S3(i,e,t=ms,n=!1){rt(i)&&(i=Pg(i));for(const s in i){const r=i[s];let o;Qt(r)?"default"in r?o=ei(r.from||s,r.default,!0):o=ei(r.from||s):o=ei(r),Qn(o)&&n?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>o.value,set:a=>o.value=a}):e[s]=o}}h(S3,"resolveInjections");function by(i,e,t){gs(rt(i)?i.map(n=>n.bind(e.proxy)):i.bind(e.proxy),e,t)}h(by,"callHook");function oM(i,e,t,n){const s=n.includes(".")?eM(t,n):()=>t[n];if(bn(i)){const r=e[i];at(r)&&mi(s,r)}else if(at(i))mi(s,i.bind(t));else if(Qt(i))if(rt(i))i.forEach(r=>oM(r,e,t,n));else{const r=at(i.handler)?i.handler.bind(t):e[i.handler];at(r)&&mi(s,r,i)}}h(oM,"createWatcher");function P0(i){const e=i.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:o}}=i.appContext,a=r.get(e);let l;return a?l=a:!s.length&&!t&&!n?l=e:(l={},s.length&&s.forEach(c=>Tf(l,c,o,!0)),Tf(l,e,o)),Qt(e)&&r.set(e,l),l}h(P0,"resolveMergedOptions");function Tf(i,e,t,n=!1){const{mixins:s,extends:r}=e;r&&Tf(i,r,t,!0),s&&s.forEach(o=>Tf(i,o,t,!0));for(const o in e)if(!(n&&o==="expose")){const a=C3[o]||t&&t[o];i[o]=a?a(i[o],e[o]):e[o]}return i}h(Tf,"mergeOptions$1");const C3={data:wy,props:Xo,emits:Xo,methods:Xo,computed:Xo,beforeCreate:ii,created:ii,beforeMount:ii,mounted:ii,beforeUpdate:ii,updated:ii,beforeDestroy:ii,beforeUnmount:ii,destroyed:ii,unmounted:ii,activated:ii,deactivated:ii,errorCaptured:ii,serverPrefetch:ii,components:Xo,directives:Xo,watch:E3,provide:wy,inject:T3};function wy(i,e){return e?i?h(function(){return yi(at(i)?i.call(this,this):i,at(e)?e.call(this,this):e)},"mergedDataFn"):e:i}h(wy,"mergeDataFn");function T3(i,e){return Xo(Pg(i),Pg(e))}h(T3,"mergeInject");function Pg(i){if(rt(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}h(Pg,"normalizeInject");function ii(i,e){return i?[...new Set([].concat(i,e))]:e}h(ii,"mergeAsArray");function Xo(i,e){return i?yi(yi(Object.create(null),i),e):e}h(Xo,"mergeObjectOptions");function E3(i,e){if(!i)return e;if(!e)return i;const t=yi(Object.create(null),i);for(const n in e)t[n]=ii(i[n],e[n]);return t}h(E3,"mergeWatchOptions");function P3(i,e,t,n=!1){const s={},r={};Mf(r,lp,1),i.propsDefaults=Object.create(null),aM(i,e,s,r);for(const o in i.propsOptions[0])o in s||(s[o]=void 0);t?i.props=n?s:KT(s):i.type.props?i.props=s:i.props=r,i.attrs=r}h(P3,"initProps");function R3(i,e,t,n){const{props:s,attrs:r,vnode:{patchFlag:o}}=i,a=qe(s),[l]=i.propsOptions;let c=!1;if((n||o>0)&&!(o&16)){if(o&8){const u=i.vnode.dynamicProps;for(let d=0;d<u.length;d++){let f=u[d];if(np(i.emitsOptions,f))continue;const p=e[f];if(l)if(Mt(r,f))p!==r[f]&&(r[f]=p,c=!0);else{const g=Gs(f);s[g]=Rg(l,a,g,p,i,!1)}else p!==r[f]&&(r[f]=p,c=!0)}}}else{aM(i,e,s,r)&&(c=!0);let u;for(const d in a)(!e||!Mt(e,d)&&((u=_a(d))===d||!Mt(e,u)))&&(l?t&&(t[d]!==void 0||t[u]!==void 0)&&(s[d]=Rg(l,a,d,void 0,i,!0)):delete s[d]);if(r!==a)for(const d in r)(!e||!Mt(e,d)&&!0)&&(delete r[d],c=!0)}c&&br(i,"set","$attrs")}h(R3,"updateProps");function aM(i,e,t,n){const[s,r]=i.propsOptions;let o=!1,a;if(e)for(let l in e){if(af(l))continue;const c=e[l];let u;s&&Mt(s,u=Gs(l))?!r||!r.includes(u)?t[u]=c:(a||(a={}))[u]=c:np(i.emitsOptions,l)||(!(l in n)||c!==n[l])&&(n[l]=c,o=!0)}if(r){const l=qe(t),c=a||Gt;for(let u=0;u<r.length;u++){const d=r[u];t[d]=Rg(s,l,d,c[d],i,!Mt(c,d))}}return o}h(aM,"setFullProps");function Rg(i,e,t,n,s,r){const o=i[t];if(o!=null){const a=Mt(o,"default");if(a&&n===void 0){const l=o.default;if(o.type!==Function&&at(l)){const{propsDefaults:c}=s;t in c?n=c[t]:(Rl(s),n=c[t]=l.call(null,e),ra())}else n=l}o[0]&&(r&&!a?n=!1:o[1]&&(n===""||n===_a(t))&&(n=!0))}return n}h(Rg,"resolvePropValue");function lM(i,e,t=!1){const n=e.propsCache,s=n.get(i);if(s)return s;const r=i.props,o={},a=[];let l=!1;if(!at(i)){const u=h(d=>{l=!0;const[f,p]=lM(d,e,!0);yi(o,f),p&&a.push(...p)},"extendProps");!t&&e.mixins.length&&e.mixins.forEach(u),i.extends&&u(i.extends),i.mixins&&i.mixins.forEach(u)}if(!r&&!l)return Qt(i)&&n.set(i,bl),bl;if(rt(r))for(let u=0;u<r.length;u++){const d=Gs(r[u]);xy(d)&&(o[d]=Gt)}else if(r)for(const u in r){const d=Gs(u);if(xy(d)){const f=r[u],p=o[d]=rt(f)||at(f)?{type:f}:Object.assign({},f);if(p){const g=Sy(Boolean,p.type),m=Sy(String,p.type);p[0]=g>-1,p[1]=m<0||g<m,(g>-1||Mt(p,"default"))&&a.push(d)}}}const c=[o,a];return Qt(i)&&n.set(i,c),c}h(lM,"normalizePropsOptions");function xy(i){return i[0]!=="$"}h(xy,"validatePropName");function My(i){const e=i&&i.toString().match(/^\s*function (\w+)/);return e?e[1]:i===null?"null":""}h(My,"getType");function Ay(i,e){return My(i)===My(e)}h(Ay,"isSameType");function Sy(i,e){return rt(e)?e.findIndex(t=>Ay(t,i)):at(e)&&Ay(e,i)?0:-1}h(Sy,"getTypeIndex");const cM=h(i=>i[0]==="_"||i==="$stable","isInternalKey"),R0=h(i=>rt(i)?i.map(Rs):[Rs(i)],"normalizeSlotValue"),I3=h((i,e,t)=>{if(e._n)return e;const n=Ht((...s)=>R0(e(...s)),t);return n._c=!1,n},"normalizeSlot$1"),uM=h((i,e,t)=>{const n=i._ctx;for(const s in i){if(cM(s))continue;const r=i[s];if(at(r))e[s]=I3(s,r,n);else if(r!=null){const o=R0(r);e[s]=()=>o}}},"normalizeObjectSlots"),hM=h((i,e)=>{const t=R0(e);i.slots.default=()=>t},"normalizeVNodeSlots"),D3=h((i,e)=>{if(i.vnode.shapeFlag&32){const t=e._;t?(i.slots=qe(e),Mf(e,"_",t)):uM(e,i.slots={})}else i.slots={},e&&hM(i,e);Mf(i.slots,lp,1)},"initSlots"),L3=h((i,e,t)=>{const{vnode:n,slots:s}=i;let r=!0,o=Gt;if(n.shapeFlag&32){const a=e._;a?t&&a===1?r=!1:(yi(s,e),!t&&a===1&&delete s._):(r=!e.$stable,uM(e,s)),o=e}else e&&(hM(i,e),o={default:1});if(r)for(const a in s)!cM(a)&&!(a in o)&&delete s[a]},"updateSlots");function dM(){return{app:null,config:{isNativeTag:gT,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}h(dM,"createAppContext");let k3=0;function O3(i,e){return h(function(n,s=null){at(n)||(n=Object.assign({},n)),s!=null&&!Qt(s)&&(s=null);const r=dM(),o=new Set;let a=!1;const l=r.app={_uid:k3++,_component:n,_props:s,_container:null,_context:r,_instance:null,version:nE,get config(){return r.config},set config(c){},use(c,...u){return o.has(c)||(c&&at(c.install)?(o.add(c),c.install(l,...u)):at(c)&&(o.add(c),c(l,...u))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,u){return u?(r.components[c]=u,l):r.components[c]},directive(c,u){return u?(r.directives[c]=u,l):r.directives[c]},mount(c,u,d){if(!a){const f=Pe(n,s);return f.appContext=r,u&&e?e(f,c):i(f,c,d),a=!0,l._container=c,c.__vue_app__=l,cp(f.component)||f.component.proxy}},unmount(){a&&(i(null,l._container),delete l._container.__vue_app__)},provide(c,u){return r.provides[c]=u,l}};return l},"createApp")}h(O3,"createAppAPI");function Ig(i,e,t,n,s=!1){if(rt(i)){i.forEach((f,p)=>Ig(f,e&&(rt(e)?e[p]:e),t,n,s));return}if(uu(n)&&!s)return;const r=n.shapeFlag&4?cp(n.component)||n.component.proxy:n.el,o=s?null:r,{i:a,r:l}=i,c=e&&e.r,u=a.refs===Gt?a.refs={}:a.refs,d=a.setupState;if(c!=null&&c!==l&&(bn(c)?(u[c]=null,Mt(d,c)&&(d[c]=null)):Qn(c)&&(c.value=null)),at(l))so(l,a,12,[o,u]);else{const f=bn(l),p=Qn(l);if(f||p){const g=h(()=>{if(i.f){const m=f?Mt(d,l)?d[l]:u[l]:l.value;s?rt(m)&&v0(m,r):rt(m)?m.includes(r)||m.push(r):f?(u[l]=[r],Mt(d,l)&&(d[l]=u[l])):(l.value=[r],i.k&&(u[i.k]=l.value))}else f?(u[l]=o,Mt(d,l)&&(d[l]=o)):p&&(l.value=o,i.k&&(u[i.k]=o))},"doSet");o?(g.id=-1,Mi(g,t)):g()}}}h(Ig,"setRef");const Mi=u3;function N3(i){return F3(i)}h(N3,"createRenderer");function F3(i,e){const t=xT();t.__VUE__=!0;const{insert:n,remove:s,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:f,setScopeId:p=ms,insertStaticContent:g}=i,m=h((V,X,E,ee=null,Q=null,F=null,O=!1,j=null,N=!!X.dynamicChildren)=>{if(V===X)return;V&&!dc(V,X)&&(ee=me(V),U(V,Q,F,!0),V=null),X.patchFlag===-2&&(N=!1,X.dynamicChildren=null);const{type:$,ref:I,shapeFlag:D}=X;switch($){case ap:v(V,X,E,ee);break;case lo:y(V,X,E,ee);break;case jp:V==null&&b(X,E,ee,O);break;case At:k(V,X,E,ee,Q,F,O,j,N);break;default:D&1?w(V,X,E,ee,Q,F,O,j,N):D&6?z(V,X,E,ee,Q,F,O,j,N):(D&64||D&128)&&$.process(V,X,E,ee,Q,F,O,j,N,be)}I!=null&&Q&&Ig(I,V&&V.ref,F,X||V,!X)},"patch"),v=h((V,X,E,ee)=>{if(V==null)n(X.el=a(X.children),E,ee);else{const Q=X.el=V.el;X.children!==V.children&&c(Q,X.children)}},"processText"),y=h((V,X,E,ee)=>{V==null?n(X.el=l(X.children||""),E,ee):X.el=V.el},"processCommentNode"),b=h((V,X,E,ee)=>{[V.el,V.anchor]=g(V.children,X,E,ee,V.el,V.anchor)},"mountStaticNode"),_=h(({el:V,anchor:X},E,ee)=>{let Q;for(;V&&V!==X;)Q=f(V),n(V,E,ee),V=Q;n(X,E,ee)},"moveStaticNode"),x=h(({el:V,anchor:X})=>{let E;for(;V&&V!==X;)E=f(V),s(V),V=E;s(X)},"removeStaticNode"),w=h((V,X,E,ee,Q,F,O,j,N)=>{O=O||X.type==="svg",V==null?T(X,E,ee,Q,F,O,j,N):R(V,X,Q,F,O,j,N)},"processElement"),T=h((V,X,E,ee,Q,F,O,j)=>{let N,$;const{type:I,props:D,shapeFlag:H,transition:Z,dirs:re}=V;if(N=V.el=o(V.type,F,D&&D.is,D),H&8?u(N,V.children):H&16&&M(V.children,N,null,ee,Q,F&&I!=="foreignObject",O,j),re&&Co(V,null,ee,"created"),D){for(const ge in D)ge!=="value"&&!af(ge)&&r(N,ge,null,D[ge],F,V.children,ee,Q,te);"value"in D&&r(N,"value",null,D.value),($=D.onVnodeBeforeMount)&&Ms($,ee,V)}P(N,V,V.scopeId,O,ee),re&&Co(V,null,ee,"beforeMount");const ue=(!Q||Q&&!Q.pendingBranch)&&Z&&!Z.persisted;ue&&Z.beforeEnter(N),n(N,X,E),(($=D&&D.onVnodeMounted)||ue||re)&&Mi(()=>{$&&Ms($,ee,V),ue&&Z.enter(N),re&&Co(V,null,ee,"mounted")},Q)},"mountElement"),P=h((V,X,E,ee,Q)=>{if(E&&p(V,E),ee)for(let F=0;F<ee.length;F++)p(V,ee[F]);if(Q){let F=Q.subTree;if(X===F){const O=Q.vnode;P(V,O,O.scopeId,O.slotScopeIds,Q.parent)}}},"setScopeId"),M=h((V,X,E,ee,Q,F,O,j,N=0)=>{for(let $=N;$<V.length;$++){const I=V[$]=j?Qr(V[$]):Rs(V[$]);m(null,I,X,E,ee,Q,F,O,j)}},"mountChildren"),R=h((V,X,E,ee,Q,F,O)=>{const j=X.el=V.el;let{patchFlag:N,dynamicChildren:$,dirs:I}=X;N|=V.patchFlag&16;const D=V.props||Gt,H=X.props||Gt;let Z;E&&To(E,!1),(Z=H.onVnodeBeforeUpdate)&&Ms(Z,E,X,V),I&&Co(X,V,E,"beforeUpdate"),E&&To(E,!0);const re=Q&&X.type!=="foreignObject";if($?L(V.dynamicChildren,$,j,E,ee,re,F):O||ie(V,X,j,null,E,ee,re,F,!1),N>0){if(N&16)W(j,X,D,H,E,ee,Q);else if(N&2&&D.class!==H.class&&r(j,"class",null,H.class,Q),N&4&&r(j,"style",D.style,H.style,Q),N&8){const ue=X.dynamicProps;for(let ge=0;ge<ue.length;ge++){const xe=ue[ge],pe=D[xe],Oe=H[xe];(Oe!==pe||xe==="value")&&r(j,xe,pe,Oe,Q,V.children,E,ee,te)}}N&1&&V.children!==X.children&&u(j,X.children)}else!O&&$==null&&W(j,X,D,H,E,ee,Q);((Z=H.onVnodeUpdated)||I)&&Mi(()=>{Z&&Ms(Z,E,X,V),I&&Co(X,V,E,"updated")},ee)},"patchElement"),L=h((V,X,E,ee,Q,F,O)=>{for(let j=0;j<X.length;j++){const N=V[j],$=X[j],I=N.el&&(N.type===At||!dc(N,$)||N.shapeFlag&70)?d(N.el):E;m(N,$,I,null,ee,Q,F,O,!0)}},"patchBlockChildren"),W=h((V,X,E,ee,Q,F,O)=>{if(E!==ee){if(E!==Gt)for(const j in E)!af(j)&&!(j in ee)&&r(V,j,E[j],null,O,X.children,Q,F,te);for(const j in ee){if(af(j))continue;const N=ee[j],$=E[j];N!==$&&j!=="value"&&r(V,j,$,N,O,X.children,Q,F,te)}"value"in ee&&r(V,"value",E.value,ee.value)}},"patchProps"),k=h((V,X,E,ee,Q,F,O,j,N)=>{const $=X.el=V?V.el:a(""),I=X.anchor=V?V.anchor:a("");let{patchFlag:D,dynamicChildren:H,slotScopeIds:Z}=X;Z&&(j=j?j.concat(Z):Z),V==null?(n($,E,ee),n(I,E,ee),M(X.children,E,I,Q,F,O,j,N)):D>0&&D&64&&H&&V.dynamicChildren?(L(V.dynamicChildren,H,E,Q,F,O,j),(X.key!=null||Q&&X===Q.subTree)&&I0(V,X,!0)):ie(V,X,E,I,Q,F,O,j,N)},"processFragment"),z=h((V,X,E,ee,Q,F,O,j,N)=>{X.slotScopeIds=j,V==null?X.shapeFlag&512?Q.ctx.activate(X,E,ee,O,N):S(X,E,ee,Q,F,O,N):B(V,X,N)},"processComponent"),S=h((V,X,E,ee,Q,F,O)=>{const j=V.component=X3(V,ee,Q);if(tM(V)&&(j.ctx.renderer=be),Y3(j),j.asyncDep){if(Q&&Q.registerDep(j,ne),!V.el){const N=j.subTree=Pe(lo);y(null,N,X,E)}return}ne(j,V,X,E,Q,F,O)},"mountComponent"),B=h((V,X,E)=>{const ee=X.component=V.component;if(a3(V,X,E))if(ee.asyncDep&&!ee.asyncResolved){K(ee,X,E);return}else ee.next=X,t3(ee.update),ee.update();else X.el=V.el,ee.vnode=X},"updateComponent"),ne=h((V,X,E,ee,Q,F,O)=>{const j=h(()=>{if(V.isMounted){let{next:I,bu:D,u:H,parent:Z,vnode:re}=V,ue=I,ge;To(V,!1),I?(I.el=re.el,K(V,I,O)):I=re,D&&lf(D),(ge=I.props&&I.props.onVnodeBeforeUpdate)&&Ms(ge,Z,I,re),To(V,!0);const xe=Gp(V),pe=V.subTree;V.subTree=xe,m(pe,xe,d(pe.el),me(pe),V,Q,F),I.el=xe.el,ue===null&&l3(V,xe.el),H&&Mi(H,Q),(ge=I.props&&I.props.onVnodeUpdated)&&Mi(()=>Ms(ge,Z,I,re),Q)}else{let I;const{el:D,props:H}=X,{bm:Z,m:re,parent:ue}=V,ge=uu(X);if(To(V,!1),Z&&lf(Z),!ge&&(I=H&&H.onVnodeBeforeMount)&&Ms(I,ue,X),To(V,!0),D&&Ae){const xe=h(()=>{V.subTree=Gp(V),Ae(D,V.subTree,V,Q,null)},"hydrateSubTree");ge?X.type.__asyncLoader().then(()=>!V.isUnmounted&&xe()):xe()}else{const xe=V.subTree=Gp(V);m(null,xe,E,ee,V,Q,F),X.el=xe.el}if(re&&Mi(re,Q),!ge&&(I=H&&H.onVnodeMounted)){const xe=X;Mi(()=>Ms(I,ue,xe),Q)}(X.shapeFlag&256||ue&&uu(ue.vnode)&&ue.vnode.shapeFlag&256)&&V.a&&Mi(V.a,Q),V.isMounted=!0,X=E=ee=null}},"componentUpdateFn"),N=V.effect=new Jf(j,()=>T0($),V.scope),$=V.update=()=>N.run();$.id=V.uid,To(V,!0),$()},"setupRenderEffect"),K=h((V,X,E)=>{X.component=V;const ee=V.vnode.props;V.vnode=X,V.next=null,R3(V,X.props,ee,E),L3(V,X.children,E),Yl(),vy(),Kl()},"updateComponentPreRender"),ie=h((V,X,E,ee,Q,F,O,j,N=!1)=>{const $=V&&V.children,I=V?V.shapeFlag:0,D=X.children,{patchFlag:H,shapeFlag:Z}=X;if(H>0){if(H&128){se($,D,E,ee,Q,F,O,j,N);return}else if(H&256){G($,D,E,ee,Q,F,O,j,N);return}}Z&8?(I&16&&te($,Q,F),D!==$&&u(E,D)):I&16?Z&16?se($,D,E,ee,Q,F,O,j,N):te($,Q,F,!0):(I&8&&u(E,""),Z&16&&M(D,E,ee,Q,F,O,j,N))},"patchChildren"),G=h((V,X,E,ee,Q,F,O,j,N)=>{V=V||bl,X=X||bl;const $=V.length,I=X.length,D=Math.min($,I);let H;for(H=0;H<D;H++){const Z=X[H]=N?Qr(X[H]):Rs(X[H]);m(V[H],Z,E,null,Q,F,O,j,N)}$>I?te(V,Q,F,!0,!1,D):M(X,E,ee,Q,F,O,j,N,D)},"patchUnkeyedChildren"),se=h((V,X,E,ee,Q,F,O,j,N)=>{let $=0;const I=X.length;let D=V.length-1,H=I-1;for(;$<=D&&$<=H;){const Z=V[$],re=X[$]=N?Qr(X[$]):Rs(X[$]);if(dc(Z,re))m(Z,re,E,null,Q,F,O,j,N);else break;$++}for(;$<=D&&$<=H;){const Z=V[D],re=X[H]=N?Qr(X[H]):Rs(X[H]);if(dc(Z,re))m(Z,re,E,null,Q,F,O,j,N);else break;D--,H--}if($>D){if($<=H){const Z=H+1,re=Z<I?X[Z].el:ee;for(;$<=H;)m(null,X[$]=N?Qr(X[$]):Rs(X[$]),E,re,Q,F,O,j,N),$++}}else if($>H)for(;$<=D;)U(V[$],Q,F,!0),$++;else{const Z=$,re=$,ue=new Map;for($=re;$<=H;$++){const Ne=X[$]=N?Qr(X[$]):Rs(X[$]);Ne.key!=null&&ue.set(Ne.key,$)}let ge,xe=0;const pe=H-re+1;let Oe=!1,Ge=0;const Ie=new Array(pe);for($=0;$<pe;$++)Ie[$]=0;for($=Z;$<=D;$++){const Ne=V[$];if(xe>=pe){U(Ne,Q,F,!0);continue}let Xe;if(Ne.key!=null)Xe=ue.get(Ne.key);else for(ge=re;ge<=H;ge++)if(Ie[ge-re]===0&&dc(Ne,X[ge])){Xe=ge;break}Xe===void 0?U(Ne,Q,F,!0):(Ie[Xe-re]=$+1,Xe>=Ge?Ge=Xe:Oe=!0,m(Ne,X[Xe],E,null,Q,F,O,j,N),xe++)}const We=Oe?z3(Ie):bl;for(ge=We.length-1,$=pe-1;$>=0;$--){const Ne=re+$,Xe=X[Ne],St=Ne+1<I?X[Ne+1].el:ee;Ie[$]===0?m(null,Xe,E,St,Q,F,O,j,N):Oe&&(ge<0||$!==We[ge]?q(Xe,E,St,2):ge--)}}},"patchKeyedChildren"),q=h((V,X,E,ee,Q=null)=>{const{el:F,type:O,transition:j,children:N,shapeFlag:$}=V;if($&6){q(V.component.subTree,X,E,ee);return}if($&128){V.suspense.move(X,E,ee);return}if($&64){O.move(V,X,E,be);return}if(O===At){n(F,X,E);for(let D=0;D<N.length;D++)q(N[D],X,E,ee);n(V.anchor,X,E);return}if(O===jp){_(V,X,E);return}if(ee!==2&&$&1&&j)if(ee===0)j.beforeEnter(F),n(F,X,E),Mi(()=>j.enter(F),Q);else{const{leave:D,delayLeave:H,afterLeave:Z}=j,re=h(()=>n(F,X,E),"remove"),ue=h(()=>{D(F,()=>{re(),Z&&Z()})},"performLeave");H?H(F,re,ue):ue()}else n(F,X,E)},"move"),U=h((V,X,E,ee=!1,Q=!1)=>{const{type:F,props:O,ref:j,children:N,dynamicChildren:$,shapeFlag:I,patchFlag:D,dirs:H}=V;if(j!=null&&Ig(j,null,E,V,!0),I&256){X.ctx.deactivate(V);return}const Z=I&1&&H,re=!uu(V);let ue;if(re&&(ue=O&&O.onVnodeBeforeUnmount)&&Ms(ue,X,V),I&6)J(V.component,E,ee);else{if(I&128){V.suspense.unmount(E,ee);return}Z&&Co(V,null,X,"beforeUnmount"),I&64?V.type.remove(V,X,E,Q,be,ee):$&&(F!==At||D>0&&D&64)?te($,X,E,!1,!0):(F===At&&D&384||!Q&&I&16)&&te(N,X,E),ee&&le(V)}(re&&(ue=O&&O.onVnodeUnmounted)||Z)&&Mi(()=>{ue&&Ms(ue,X,V),Z&&Co(V,null,X,"unmounted")},E)},"unmount"),le=h(V=>{const{type:X,el:E,anchor:ee,transition:Q}=V;if(X===At){ae(E,ee);return}if(X===jp){x(V);return}const F=h(()=>{s(E),Q&&!Q.persisted&&Q.afterLeave&&Q.afterLeave()},"performRemove");if(V.shapeFlag&1&&Q&&!Q.persisted){const{leave:O,delayLeave:j}=Q,N=h(()=>O(E,F),"performLeave");j?j(V.el,F,N):N()}else F()},"remove"),ae=h((V,X)=>{let E;for(;V!==X;)E=f(V),s(V),V=E;s(X)},"removeFragment"),J=h((V,X,E)=>{const{bum:ee,scope:Q,update:F,subTree:O,um:j}=V;ee&&lf(ee),Q.stop(),F&&(F.active=!1,U(O,V,X,E)),j&&Mi(j,X),Mi(()=>{V.isUnmounted=!0},X),X&&X.pendingBranch&&!X.isUnmounted&&V.asyncDep&&!V.asyncResolved&&V.suspenseId===X.pendingId&&(X.deps--,X.deps===0&&X.resolve())},"unmountComponent"),te=h((V,X,E,ee=!1,Q=!1,F=0)=>{for(let O=F;O<V.length;O++)U(V[O],X,E,ee,Q)},"unmountChildren"),me=h(V=>V.shapeFlag&6?me(V.component.subTree):V.shapeFlag&128?V.suspense.next():f(V.anchor||V.el),"getNextHostNode"),de=h((V,X,E)=>{V==null?X._vnode&&U(X._vnode,null,null,!0):m(X._vnode||null,V,X,null,null,null,E),vy(),qx(),X._vnode=V},"render"),be={p:m,um:U,m:q,r:le,mt:S,mc:M,pc:ie,pbc:L,n:me,o:i};let we,Ae;return e&&([we,Ae]=e(be)),{render:de,hydrate:we,createApp:O3(de,we)}}h(F3,"baseCreateRenderer");function To({effect:i,update:e},t){i.allowRecurse=e.allowRecurse=t}h(To,"toggleRecurse");function I0(i,e,t=!1){const n=i.children,s=e.children;if(rt(n)&&rt(s))for(let r=0;r<n.length;r++){const o=n[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=Qr(s[r]),a.el=o.el),t||I0(o,a)),a.type===ap&&(a.el=o.el)}}h(I0,"traverseStaticChildren");function z3(i){const e=i.slice(),t=[0];let n,s,r,o,a;const l=i.length;for(n=0;n<l;n++){const c=i[n];if(c!==0){if(s=t[t.length-1],i[s]<c){e[n]=s,t.push(n);continue}for(r=0,o=t.length-1;r<o;)a=r+o>>1,i[t[a]]<c?r=a+1:o=a;c<i[t[r]]&&(r>0&&(e[n]=t[r-1]),t[r]=n)}}for(r=t.length,o=t[r-1];r-- >0;)t[r]=o,o=e[o];return t}h(z3,"getSequence");const B3=h(i=>i.__isTeleport,"isTeleport"),du=h(i=>i&&(i.disabled||i.disabled===""),"isTeleportDisabled"),Cy=h(i=>typeof SVGElement!="undefined"&&i instanceof SVGElement,"isTargetSVG"),Dg=h((i,e)=>{const t=i&&i.to;return bn(t)?e?e(t):null:t},"resolveTarget"),U3={__isTeleport:!0,process(i,e,t,n,s,r,o,a,l,c){const{mc:u,pc:d,pbc:f,o:{insert:p,querySelector:g,createText:m,createComment:v}}=c,y=du(e.props);let{shapeFlag:b,children:_,dynamicChildren:x}=e;if(i==null){const w=e.el=m(""),T=e.anchor=m("");p(w,t,n),p(T,t,n);const P=e.target=Dg(e.props,g),M=e.targetAnchor=m("");P&&(p(M,P),o=o||Cy(P));const R=h((L,W)=>{b&16&&u(_,L,W,s,r,o,a,l)},"mount");y?R(t,T):P&&R(P,M)}else{e.el=i.el;const w=e.anchor=i.anchor,T=e.target=i.target,P=e.targetAnchor=i.targetAnchor,M=du(i.props),R=M?t:T,L=M?w:P;if(o=o||Cy(T),x?(f(i.dynamicChildren,x,R,s,r,o,a),I0(i,e,!0)):l||d(i,e,R,L,s,r,o,a,!1),y)M||Eh(e,t,w,c,1);else if((e.props&&e.props.to)!==(i.props&&i.props.to)){const W=e.target=Dg(e.props,g);W&&Eh(e,W,null,c,0)}else M&&Eh(e,T,P,c,1)}fM(e)},remove(i,e,t,n,{um:s,o:{remove:r}},o){const{shapeFlag:a,children:l,anchor:c,targetAnchor:u,target:d,props:f}=i;if(d&&r(u),(o||!du(f))&&(r(c),a&16))for(let p=0;p<l.length;p++){const g=l[p];s(g,e,t,!0,!!g.dynamicChildren)}},move:Eh,hydrate:V3};function Eh(i,e,t,{o:{insert:n},m:s},r=2){r===0&&n(i.targetAnchor,e,t);const{el:o,anchor:a,shapeFlag:l,children:c,props:u}=i,d=r===2;if(d&&n(o,e,t),(!d||du(u))&&l&16)for(let f=0;f<c.length;f++)s(c[f],e,t,2);d&&n(a,e,t)}h(Eh,"moveTeleport");function V3(i,e,t,n,s,r,{o:{nextSibling:o,parentNode:a,querySelector:l}},c){const u=e.target=Dg(e.props,l);if(u){const d=u._lpa||u.firstChild;if(e.shapeFlag&16)if(du(e.props))e.anchor=c(o(i),e,a(i),t,n,s,r),e.targetAnchor=d;else{e.anchor=o(i);let f=d;for(;f;)if(f=o(f),f&&f.nodeType===8&&f.data==="teleport anchor"){e.targetAnchor=f,u._lpa=e.targetAnchor&&o(e.targetAnchor);break}c(d,e,u,t,n,s,r)}fM(e)}return e.anchor&&o(e.anchor)}h(V3,"hydrateTeleport");const D0=U3;function fM(i){const e=i.ctx;if(e&&e.ut){let t=i.children[0].el;for(;t!==i.targetAnchor;)t.nodeType===1&&t.setAttribute("data-v-owner",e.uid),t=t.nextSibling;e.ut()}}h(fM,"updateCssVars");const At=Symbol(void 0),ap=Symbol(void 0),lo=Symbol(void 0),jp=Symbol(void 0),fu=[];let fs=null;function Se(i=!1){fu.push(fs=i?null:[])}h(Se,"openBlock");function H3(){fu.pop(),fs=fu[fu.length-1]||null}h(H3,"closeBlock");let Ru=1;function Ty(i){Ru+=i}h(Ty,"setBlockTracking");function pM(i){return i.dynamicChildren=Ru>0?fs||bl:null,H3(),Ru>0&&fs&&fs.push(i),i}h(pM,"setupBlock");function ke(i,e,t,n,s,r){return pM(he(i,e,t,n,s,r,!0))}h(ke,"createElementBlock");function Bt(i,e,t,n,s){return pM(Pe(i,e,t,n,s,!0))}h(Bt,"createBlock");function Ef(i){return i?i.__v_isVNode===!0:!1}h(Ef,"isVNode");function dc(i,e){return i.type===e.type&&i.key===e.key}h(dc,"isSameVNodeType");const lp="__vInternal",mM=h(({key:i})=>i!=null?i:null,"normalizeKey"),cf=h(({ref:i,ref_key:e,ref_for:t})=>i!=null?bn(i)||Qn(i)||at(i)?{i:Jn,r:i,k:e,f:!!t}:i:null,"normalizeRef");function he(i,e=null,t=null,n=0,s=null,r=i===At?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&mM(e),ref:e&&cf(e),scopeId:ip,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Jn};return a?(L0(l,t),r&128&&i.normalize(l)):t&&(l.shapeFlag|=bn(t)?8:16),Ru>0&&!o&&fs&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&fs.push(l),l}h(he,"createBaseVNode");const Pe=G3;function G3(i,e=null,t=null,n=0,s=null,r=!1){if((!i||i===iM)&&(i=lo),Ef(i)){const a=Pl(i,e,!0);return t&&L0(a,t),Ru>0&&!r&&fs&&(a.shapeFlag&6?fs[fs.indexOf(i)]=a:fs.push(a)),a.patchFlag|=-2,a}if(J3(i)&&(i=i.__vccOpts),e){e=W3(e);let{class:a,style:l}=e;a&&!bn(a)&&(e.class=en(a)),Qt(l)&&(Bx(l)&&!rt(l)&&(l=yi({},l)),e.style=En(l))}const o=bn(i)?1:c3(i)?128:B3(i)?64:Qt(i)?4:at(i)?2:0;return he(i,e,t,n,s,o,r,!0)}h(G3,"_createVNode");function W3(i){return i?Bx(i)||lp in i?yi({},i):i:null}h(W3,"guardReactiveProps");function Pl(i,e,t=!1){const{props:n,ref:s,patchFlag:r,children:o}=i,a=e?gM(n||{},e):n;return{__v_isVNode:!0,__v_skip:!0,type:i.type,props:a,key:a&&mM(a),ref:e&&e.ref?t&&s?rt(s)?s.concat(cf(e)):[s,cf(e)]:cf(e):s,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:o,target:i.target,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==At?r===-1?16:r|16:r,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:i.transition,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Pl(i.ssContent),ssFallback:i.ssFallback&&Pl(i.ssFallback),el:i.el,anchor:i.anchor,ctx:i.ctx}}h(Pl,"cloneVNode");function fr(i=" ",e=0){return Pe(ap,null,i,e)}h(fr,"createTextVNode");function Qe(i="",e=!1){return e?(Se(),Bt(lo,null,i)):Pe(lo,null,i)}h(Qe,"createCommentVNode");function Rs(i){return i==null||typeof i=="boolean"?Pe(lo):rt(i)?Pe(At,null,i.slice()):typeof i=="object"?Qr(i):Pe(ap,null,String(i))}h(Rs,"normalizeVNode");function Qr(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Pl(i)}h(Qr,"cloneIfMounted");function L0(i,e){let t=0;const{shapeFlag:n}=i;if(e==null)e=null;else if(rt(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),L0(i,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!(lp in e)?e._ctx=Jn:s===3&&Jn&&(Jn.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else at(e)?(e={default:e,_ctx:Jn},t=32):(e=String(e),n&64?(t=16,e=[fr(e)]):t=8);i.children=e,i.shapeFlag|=t}h(L0,"normalizeChildren");function gM(...i){const e={};for(let t=0;t<i.length;t++){const n=i[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=en([e.class,n.class]));else if(s==="style")e.style=En([e.style,n.style]);else if(Kf(s)){const r=e[s],o=n[s];o&&r!==o&&!(rt(r)&&r.includes(o))&&(e[s]=r?[].concat(r,o):o)}else s!==""&&(e[s]=n[s])}return e}h(gM,"mergeProps");function Ms(i,e,t,n=null){gs(i,e,7,[t,n])}h(Ms,"invokeVNodeHook");const j3=dM();let $3=0;function X3(i,e,t){const n=i.type,s=(e?e.appContext:i.appContext)||j3,r={uid:$3++,vnode:i,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new Tx(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:lM(n,s),emitsOptions:Qx(n,s),emit:null,emitted:null,propsDefaults:Gt,inheritAttrs:n.inheritAttrs,ctx:Gt,data:Gt,props:Gt,attrs:Gt,slots:Gt,refs:Gt,setupState:Gt,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=s3.bind(null,r),i.ce&&i.ce(r),r}h(X3,"createComponentInstance$1");let Wn=null;const Rl=h(i=>{Wn=i,i.scope.on()},"setCurrentInstance"),ra=h(()=>{Wn&&Wn.scope.off(),Wn=null},"unsetCurrentInstance");function vM(i){return i.vnode.shapeFlag&4}h(vM,"isStatefulComponent");let Iu=!1;function Y3(i,e=!1){Iu=e;const{props:t,children:n}=i.vnode,s=vM(i);P3(i,t,s,e),D3(i,n);const r=s?K3(i,e):void 0;return Iu=!1,r}h(Y3,"setupComponent");function K3(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=Ux(new Proxy(i.ctx,M3));const{setup:n}=t;if(n){const s=i.setupContext=n.length>1?Z3(i):null;Rl(i),Yl();const r=so(n,i,0,[i.props,s]);if(Kl(),ra(),Ax(r)){if(r.then(ra,ra),e)return r.then(o=>{Ey(i,o,e)}).catch(o=>{tp(o,i,0)});i.asyncDep=r}else Ey(i,r,e)}else yM(i,e)}h(K3,"setupStatefulComponent");function Ey(i,e,t){at(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:Qt(e)&&(i.setupState=jx(e)),yM(i,t)}h(Ey,"handleSetupResult");let Py;function yM(i,e,t){const n=i.type;if(!i.render){if(!e&&Py&&!n.render){const s=n.template||P0(i).template;if(s){const{isCustomElement:r,compilerOptions:o}=i.appContext.config,{delimiters:a,compilerOptions:l}=n,c=yi(yi({isCustomElement:r,delimiters:a},o),l);n.render=Py(s,c)}}i.render=n.render||ms}Rl(i),Yl(),A3(i),Kl(),ra()}h(yM,"finishComponentSetup");function q3(i){return new Proxy(i.attrs,{get(e,t){return Vi(i,"get","$attrs"),e[t]}})}h(q3,"createAttrsProxy");function Z3(i){const e=h(n=>{i.exposed=n||{}},"expose");let t;return{get attrs(){return t||(t=q3(i))},slots:i.slots,emit:i.emit,expose:e}}h(Z3,"createSetupContext");function cp(i){if(i.exposed)return i.exposeProxy||(i.exposeProxy=new Proxy(jx(Ux(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in hu)return hu[t](i)},has(e,t){return t in e||t in hu}}))}h(cp,"getExposeProxy");function Q3(i,e=!0){return at(i)?i.displayName||i.name:i.name||e&&i.__name}h(Q3,"getComponentName");function J3(i){return at(i)&&"__vccOpts"in i}h(J3,"isClassComponent");const Je=h((i,e)=>QT(i,e,Iu),"computed");function _M(i,e,t){const n=arguments.length;return n===2?Qt(e)&&!rt(e)?Ef(e)?Pe(i,null,[e]):Pe(i,e):Pe(i,null,e):(n>3?t=Array.prototype.slice.call(arguments,2):n===3&&Ef(t)&&(t=[t]),Pe(i,e,t))}h(_M,"h");const eE=Symbol(""),tE=h(()=>ei(eE),"useSSRContext"),nE="3.2.45",iE="http://www.w3.org/2000/svg",Qo=typeof document!="undefined"?document:null,Ry=Qo&&Qo.createElement("template"),sE={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,n)=>{const s=e?Qo.createElementNS(iE,i):Qo.createElement(i,t?{is:t}:void 0);return i==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:i=>Qo.createTextNode(i),createComment:i=>Qo.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>Qo.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,n,s,r){const o=t?t.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===r||!(s=s.nextSibling)););else{Ry.innerHTML=n?`<svg>${i}</svg>`:i;const a=Ry.content;if(n){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}};function rE(i,e,t){const n=i._vtc;n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}h(rE,"patchClass");function oE(i,e,t){const n=i.style,s=bn(t);if(t&&!s){for(const r in t)Lg(n,r,t[r]);if(e&&!bn(e))for(const r in e)t[r]==null&&Lg(n,r,"")}else{const r=n.display;s?e!==t&&(n.cssText=t):e&&i.removeAttribute("style"),"_vod"in i&&(n.display=r)}}h(oE,"patchStyle");const Iy=/\s*!important$/;function Lg(i,e,t){if(rt(t))t.forEach(n=>Lg(i,e,n));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const n=aE(i,e);Iy.test(t)?i.setProperty(_a(n),t.replace(Iy,""),"important"):i[n]=t}}h(Lg,"setStyle");const Dy=["Webkit","Moz","ms"],$p={};function aE(i,e){const t=$p[e];if(t)return t;let n=Gs(e);if(n!=="filter"&&n in i)return $p[e]=n;n=Qf(n);for(let s=0;s<Dy.length;s++){const r=Dy[s]+n;if(r in i)return $p[e]=r}return e}h(aE,"autoPrefix");const Ly="http://www.w3.org/1999/xlink";function lE(i,e,t,n,s){if(n&&e.startsWith("xlink:"))t==null?i.removeAttributeNS(Ly,e.slice(6,e.length)):i.setAttributeNS(Ly,e,t);else{const r=mT(e);t==null||r&&!wx(t)?i.removeAttribute(e):i.setAttribute(e,r?"":t)}}h(lE,"patchAttr");function cE(i,e,t,n,s,r,o){if(e==="innerHTML"||e==="textContent"){n&&o(n,s,r),i[e]=t==null?"":t;return}if(e==="value"&&i.tagName!=="PROGRESS"&&!i.tagName.includes("-")){i._value=t;const l=t==null?"":t;(i.value!==l||i.tagName==="OPTION")&&(i.value=l),t==null&&i.removeAttribute(e);return}let a=!1;if(t===""||t==null){const l=typeof i[e];l==="boolean"?t=wx(t):t==null&&l==="string"?(t="",a=!0):l==="number"&&(t=0,a=!0)}try{i[e]=t}catch{}a&&i.removeAttribute(e)}h(cE,"patchDOMProp");function ll(i,e,t,n){i.addEventListener(e,t,n)}h(ll,"addEventListener");function uE(i,e,t,n){i.removeEventListener(e,t,n)}h(uE,"removeEventListener");function hE(i,e,t,n,s=null){const r=i._vei||(i._vei={}),o=r[e];if(n&&o)o.value=n;else{const[a,l]=dE(e);if(n){const c=r[e]=mE(n,s);ll(i,a,c,l)}else o&&(uE(i,a,o,l),r[e]=void 0)}}h(hE,"patchEvent");const ky=/(?:Once|Passive|Capture)$/;function dE(i){let e;if(ky.test(i)){e={};let n;for(;n=i.match(ky);)i=i.slice(0,i.length-n[0].length),e[n[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):_a(i.slice(2)),e]}h(dE,"parseName");let Xp=0;const fE=Promise.resolve(),pE=h(()=>Xp||(fE.then(()=>Xp=0),Xp=Date.now()),"getNow");function mE(i,e){const t=h(n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;gs(gE(n,t.value),e,5,[n])},"invoker");return t.value=i,t.attached=pE(),t}h(mE,"createInvoker");function gE(i,e){if(rt(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}h(gE,"patchStopImmediatePropagation");const Oy=/^on[a-z]/,vE=h((i,e,t,n,s=!1,r,o,a,l)=>{e==="class"?rE(i,n,s):e==="style"?oE(i,t,n):Kf(e)?g0(e)||hE(i,e,t,n,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):yE(i,e,n,s))?cE(i,e,n,r,o,a,l):(e==="true-value"?i._trueValue=n:e==="false-value"&&(i._falseValue=n),lE(i,e,n,s))},"patchProp");function yE(i,e,t,n){return n?!!(e==="innerHTML"||e==="textContent"||e in i&&Oy.test(e)&&at(t)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA"||Oy.test(e)&&bn(t)?!1:e in i}h(yE,"shouldSetAsProp");const Ny=h(i=>{const e=i.props["onUpdate:modelValue"]||!1;return rt(e)?t=>lf(e,t):e},"getModelAssigner");function _E(i){i.target.composing=!0}h(_E,"onCompositionStart");function Fy(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}h(Fy,"onCompositionEnd");const bM={created(i,{modifiers:{lazy:e,trim:t,number:n}},s){i._assign=Ny(s);const r=n||s.props&&s.props.type==="number";ll(i,e?"change":"input",o=>{if(o.target.composing)return;let a=i.value;t&&(a=a.trim()),r&&(a=Af(a)),i._assign(a)}),t&&ll(i,"change",()=>{i.value=i.value.trim()}),e||(ll(i,"compositionstart",_E),ll(i,"compositionend",Fy),ll(i,"change",Fy))},mounted(i,{value:e}){i.value=e==null?"":e},beforeUpdate(i,{value:e,modifiers:{lazy:t,trim:n,number:s}},r){if(i._assign=Ny(r),i.composing||document.activeElement===i&&i.type!=="range"&&(t||n&&i.value.trim()===e||(s||i.type==="number")&&Af(i.value)===e))return;const o=e==null?"":e;i.value!==o&&(i.value=o)}},bE=["ctrl","shift","alt","meta"],wE={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,e)=>bE.some(t=>i[`${t}Key`]&&!e.includes(t))},mn=h((i,e)=>(t,...n)=>{for(let s=0;s<e.length;s++){const r=wE[e[s]];if(r&&r(t,e))return}return i(t,...n)},"withModifiers"),xE={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Sn=h((i,e)=>t=>{if(!("key"in t))return;const n=_a(t.key);if(e.some(s=>s===n||xE[s]===n))return i(t)},"withKeys"),Ph={beforeMount(i,{value:e},{transition:t}){i._vod=i.style.display==="none"?"":i.style.display,t&&e?t.beforeEnter(i):fc(i,e)},mounted(i,{value:e},{transition:t}){t&&e&&t.enter(i)},updated(i,{value:e,oldValue:t},{transition:n}){!e!=!t&&(n?e?(n.beforeEnter(i),fc(i,!0),n.enter(i)):n.leave(i,()=>{fc(i,!1)}):fc(i,e))},beforeUnmount(i,{value:e}){fc(i,e)}};function fc(i,e){i.style.display=e?i._vod:"none"}h(fc,"setDisplay");const ME=yi({patchProp:vE},sE);let zy;function AE(){return zy||(zy=N3(ME))}h(AE,"ensureRenderer");const wM=h((...i)=>{const e=AE().createApp(...i),{mount:t}=e;return e.mount=n=>{const s=SE(n);if(!s)return;const r=e._component;!at(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.innerHTML="";const o=t(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e},"createApp");function SE(i){return bn(i)?document.querySelector(i):i}h(SE,"normalizeContainer");var CE=Object.defineProperty,Yp=h((i,e)=>CE(i,"name",{value:e,configurable:!0}),"__name$2U"),TE=Rt({setup(){const i=ei("errorSignal"),e=ze(""),t=ze(!1),n=Yp(o=>{console.error(o),o instanceof Error?e.value=o.stack+"":e.value=o+"",t.value=!0},"showErrorMessageWindow"),s=Yp(o=>{n(o.error)},"onError"),r=Yp(o=>{n(o.reason)},"onUnhandledRejection");return i.addListener(n),window.addEventListener("error",s),window.addEventListener("unhandledrejection",r),op(()=>{i.removeListener(n),window.removeEventListener("error",s),window.removeEventListener("unhandledrejection",r)}),{errorMessage:e,errorMessageWindowVisible:t}}});var Dt=h((i,e)=>{const t=i.__vccOpts||i;for(const[n,s]of e)t[n]=s;return t},"_export_sfc");const EE=h(i=>(ba("data-v-18bfa632"),i=i(),wa(),i),"_withScopeId$6"),PE={key:0,class:"dialog-mask"},RE={class:"dialog"},IE=EE(()=>he("div",{style:{"margin-bottom":".25em"}},"An error occurred.",-1)),DE={readonly:""},LE={style:{"text-align":"right"}};function kE(i,e,t,n,s,r){const o=qt("router-view");return Se(),ke(At,null,[Pe(o),i.errorMessageWindowVisible?(Se(),ke("div",PE,[he("div",RE,[IE,he("textarea",DE,rn(i.errorMessage),1),he("div",LE,[he("button",{onClick:e[0]||(e[0]=a=>i.errorMessageWindowVisible=!1)},"Close")])])])):Qe("",!0)],64)}h(kE,"_sfc_render$s");var OE=Dt(TE,[["render",kE],["__scopeId","data-v-18bfa632"]]),NE=Object.defineProperty,FE=h((i,e)=>NE(i,"name",{value:e,configurable:!0}),"__name$2T");class k0{constructor(){C(this,"listeners",[])}addListener(e){this.listeners.push(e)}removeListener(e){const t=this.listeners.findIndex(n=>n===e);t>=0&&this.listeners.splice(t,1)}dispatch(e){this.listeners.forEach(t=>t(e))}}h(k0,"Signal");FE(k0,"Signal");/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const cl=typeof window!="undefined";function zE(i){return i.__esModule||i[Symbol.toStringTag]==="Module"}h(zE,"isESModule");const It=Object.assign;function Kp(i,e){const t={};for(const n in e){const s=e[n];t[n]=_s(s)?s.map(i):i(s)}return t}h(Kp,"applyToParams");const pu=h(()=>{},"noop"),_s=Array.isArray,BE=/\/$/,UE=h(i=>i.replace(BE,""),"removeTrailingSlash");function qp(i,e,t="/"){let n,s={},r="",o="";const a=e.indexOf("#");let l=e.indexOf("?");return a<l&&a>=0&&(l=-1),l>-1&&(n=e.slice(0,l),r=e.slice(l+1,a>-1?a:e.length),s=i(r)),a>-1&&(n=n||e.slice(0,a),o=e.slice(a,e.length)),n=WE(n!=null?n:e,t),{fullPath:n+(r&&"?")+r+o,path:n,query:s,hash:o}}h(qp,"parseURL");function VE(i,e){const t=e.query?i(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}h(VE,"stringifyURL");function By(i,e){return!e||!i.toLowerCase().startsWith(e.toLowerCase())?i:i.slice(e.length)||"/"}h(By,"stripBase");function HE(i,e,t){const n=e.matched.length-1,s=t.matched.length-1;return n>-1&&n===s&&Il(e.matched[n],t.matched[s])&&xM(e.params,t.params)&&i(e.query)===i(t.query)&&e.hash===t.hash}h(HE,"isSameRouteLocation");function Il(i,e){return(i.aliasOf||i)===(e.aliasOf||e)}h(Il,"isSameRouteRecord");function xM(i,e){if(Object.keys(i).length!==Object.keys(e).length)return!1;for(const t in i)if(!GE(i[t],e[t]))return!1;return!0}h(xM,"isSameRouteLocationParams");function GE(i,e){return _s(i)?Uy(i,e):_s(e)?Uy(e,i):i===e}h(GE,"isSameRouteLocationParamsValue");function Uy(i,e){return _s(e)?i.length===e.length&&i.every((t,n)=>t===e[n]):i.length===1&&i[0]===e}h(Uy,"isEquivalentArray");function WE(i,e){if(i.startsWith("/"))return i;if(!i)return e;const t=e.split("/"),n=i.split("/");let s=t.length-1,r,o;for(r=0;r<n.length;r++)if(o=n[r],o!==".")if(o==="..")s>1&&s--;else break;return t.slice(0,s).join("/")+"/"+n.slice(r-(r===n.length?1:0)).join("/")}h(WE,"resolveRelativePath");var Du;(function(i){i.pop="pop",i.push="push"})(Du||(Du={}));var mu;(function(i){i.back="back",i.forward="forward",i.unknown=""})(mu||(mu={}));function jE(i){if(!i)if(cl){const e=document.querySelector("base");i=e&&e.getAttribute("href")||"/",i=i.replace(/^\w+:\/\/[^\/]+/,"")}else i="/";return i[0]!=="/"&&i[0]!=="#"&&(i="/"+i),UE(i)}h(jE,"normalizeBase");const $E=/^[^#]+#/;function XE(i,e){return i.replace($E,"#")+e}h(XE,"createHref");function YE(i,e){const t=document.documentElement.getBoundingClientRect(),n=i.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}h(YE,"getElementPosition");const up=h(()=>({left:window.pageXOffset,top:window.pageYOffset}),"computeScrollPosition");function KE(i){let e;if("el"in i){const t=i.el,n=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=YE(s,i)}else e=i;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}h(KE,"scrollToPosition");function Vy(i,e){return(history.state?history.state.position-e:-1)+i}h(Vy,"getScrollKey");const kg=new Map;function qE(i,e){kg.set(i,e)}h(qE,"saveScrollPosition");function ZE(i){const e=kg.get(i);return kg.delete(i),e}h(ZE,"getSavedScrollPosition");let QE=h(()=>location.protocol+"//"+location.host,"createBaseLocation");function MM(i,e){const{pathname:t,search:n,hash:s}=e,r=i.indexOf("#");if(r>-1){let a=s.includes(i.slice(r))?i.slice(r).length:1,l=s.slice(a);return l[0]!=="/"&&(l="/"+l),By(l,"")}return By(t,i)+n+s}h(MM,"createCurrentLocation");function JE(i,e,t,n){let s=[],r=[],o=null;const a=h(({state:f})=>{const p=MM(i,location),g=t.value,m=e.value;let v=0;if(f){if(t.value=p,e.value=f,o&&o===g){o=null;return}v=m?f.position-m.position:0}else n(p);s.forEach(y=>{y(t.value,g,{delta:v,type:Du.pop,direction:v?v>0?mu.forward:mu.back:mu.unknown})})},"popStateHandler");function l(){o=t.value}h(l,"pauseListeners");function c(f){s.push(f);const p=h(()=>{const g=s.indexOf(f);g>-1&&s.splice(g,1)},"teardown");return r.push(p),p}h(c,"listen");function u(){const{history:f}=window;!f.state||f.replaceState(It({},f.state,{scroll:up()}),"")}h(u,"beforeUnloadListener");function d(){for(const f of r)f();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",u)}return h(d,"destroy"),window.addEventListener("popstate",a),window.addEventListener("beforeunload",u),{pauseListeners:l,listen:c,destroy:d}}h(JE,"useHistoryListeners");function Hy(i,e,t,n=!1,s=!1){return{back:i,current:e,forward:t,replaced:n,position:window.history.length,scroll:s?up():null}}h(Hy,"buildState");function eP(i){const{history:e,location:t}=window,n={value:MM(i,t)},s={value:e.state};s.value||r(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(l,c,u){const d=i.indexOf("#"),f=d>-1?(t.host&&document.querySelector("base")?i:i.slice(d))+l:QE()+i+l;try{e[u?"replaceState":"pushState"](c,"",f),s.value=c}catch(p){console.error(p),t[u?"replace":"assign"](f)}}h(r,"changeLocation");function o(l,c){const u=It({},e.state,Hy(s.value.back,l,s.value.forward,!0),c,{position:s.value.position});r(l,u,!0),n.value=l}h(o,"replace");function a(l,c){const u=It({},s.value,e.state,{forward:l,scroll:up()});r(u.current,u,!0);const d=It({},Hy(n.value,l,null),{position:u.position+1},c);r(l,d,!1),n.value=l}return h(a,"push"),{location:n,state:s,push:a,replace:o}}h(eP,"useHistoryStateNavigation");function tP(i){i=jE(i);const e=eP(i),t=JE(i,e.state,e.location,e.replace);function n(r,o=!0){o||t.pauseListeners(),history.go(r)}h(n,"go");const s=It({location:"",base:i,go:n,createHref:XE.bind(null,i)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}h(tP,"createWebHistory");function nP(i){return i=location.host?i||location.pathname+location.search:"",i.includes("#")||(i+="#"),tP(i)}h(nP,"createWebHashHistory");function iP(i){return typeof i=="string"||i&&typeof i=="object"}h(iP,"isRouteLocation");function AM(i){return typeof i=="string"||typeof i=="symbol"}h(AM,"isRouteName");const kr={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},SM=Symbol("");var Gy;(function(i){i[i.aborted=4]="aborted",i[i.cancelled=8]="cancelled",i[i.duplicated=16]="duplicated"})(Gy||(Gy={}));function Dl(i,e){return It(new Error,{type:i,[SM]:!0},e)}h(Dl,"createRouterError");function Xs(i,e){return i instanceof Error&&SM in i&&(e==null||!!(i.type&e))}h(Xs,"isNavigationFailure");const Wy="[^/]+?",sP={sensitive:!1,strict:!1,start:!0,end:!0},rP=/[.+*?^${}()[\]/\\]/g;function oP(i,e){const t=It({},sP,e),n=[];let s=t.start?"^":"";const r=[];for(const c of i){const u=c.length?[]:[90];t.strict&&!c.length&&(s+="/");for(let d=0;d<c.length;d++){const f=c[d];let p=40+(t.sensitive?.25:0);if(f.type===0)d||(s+="/"),s+=f.value.replace(rP,"\\$&"),p+=40;else if(f.type===1){const{value:g,repeatable:m,optional:v,regexp:y}=f;r.push({name:g,repeatable:m,optional:v});const b=y||Wy;if(b!==Wy){p+=10;try{new RegExp(`(${b})`)}catch(x){throw new Error(`Invalid custom RegExp for param "${g}" (${b}): `+x.message)}}let _=m?`((?:${b})(?:/(?:${b}))*)`:`(${b})`;d||(_=v&&c.length<2?`(?:/${_})`:"/"+_),v&&(_+="?"),s+=_,p+=20,v&&(p+=-8),m&&(p+=-20),b===".*"&&(p+=-50)}u.push(p)}n.push(u)}if(t.strict&&t.end){const c=n.length-1;n[c][n[c].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(c){const u=c.match(o),d={};if(!u)return null;for(let f=1;f<u.length;f++){const p=u[f]||"",g=r[f-1];d[g.name]=p&&g.repeatable?p.split("/"):p}return d}h(a,"parse");function l(c){let u="",d=!1;for(const f of i){(!d||!u.endsWith("/"))&&(u+="/"),d=!1;for(const p of f)if(p.type===0)u+=p.value;else if(p.type===1){const{value:g,repeatable:m,optional:v}=p,y=g in c?c[g]:"";if(_s(y)&&!m)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const b=_s(y)?y.join("/"):y;if(!b)if(v)f.length<2&&(u.endsWith("/")?u=u.slice(0,-1):d=!0);else throw new Error(`Missing required param "${g}"`);u+=b}}return u||"/"}return h(l,"stringify"),{re:o,score:n,keys:r,parse:a,stringify:l}}h(oP,"tokensToParser");function aP(i,e){let t=0;for(;t<i.length&&t<e.length;){const n=e[t]-i[t];if(n)return n;t++}return i.length<e.length?i.length===1&&i[0]===40+40?-1:1:i.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}h(aP,"compareScoreArray");function lP(i,e){let t=0;const n=i.score,s=e.score;for(;t<n.length&&t<s.length;){const r=aP(n[t],s[t]);if(r)return r;t++}if(Math.abs(s.length-n.length)===1){if(jy(n))return 1;if(jy(s))return-1}return s.length-n.length}h(lP,"comparePathParserScore");function jy(i){const e=i[i.length-1];return i.length>0&&e[e.length-1]<0}h(jy,"isLastScoreNegative");const cP={type:0,value:""},uP=/[a-zA-Z0-9_]/;function hP(i){if(!i)return[[]];if(i==="/")return[[cP]];if(!i.startsWith("/"))throw new Error(`Invalid path "${i}"`);function e(p){throw new Error(`ERR (${t})/"${c}": ${p}`)}h(e,"crash");let t=0,n=t;const s=[];let r;function o(){r&&s.push(r),r=[]}h(o,"finalizeSegment");let a=0,l,c="",u="";function d(){!c||(t===0?r.push({type:0,value:c}):t===1||t===2||t===3?(r.length>1&&(l==="*"||l==="+")&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:u,repeatable:l==="*"||l==="+",optional:l==="*"||l==="?"})):e("Invalid state to consume buffer"),c="")}h(d,"consumeBuffer");function f(){c+=l}for(h(f,"addCharToBuffer");a<i.length;){if(l=i[a++],l==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:l==="/"?(c&&d(),o()):l===":"?(d(),t=1):f();break;case 4:f(),t=n;break;case 1:l==="("?t=2:uP.test(l)?f():(d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--);break;case 2:l===")"?u[u.length-1]=="\\"?u=u.slice(0,-1)+l:t=3:u+=l;break;case 3:d(),t=0,l!=="*"&&l!=="?"&&l!=="+"&&a--,u="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${c}"`),d(),o(),s}h(hP,"tokenizePath");function dP(i,e,t){const n=oP(hP(i.path),t),s=It(n,{record:i,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}h(dP,"createRouteRecordMatcher");function fP(i,e){const t=[],n=new Map;e=Yy({strict:!1,end:!0,sensitive:!1},e);function s(u){return n.get(u)}h(s,"getRecordMatcher");function r(u,d,f){const p=!f,g=pP(u);g.aliasOf=f&&f.record;const m=Yy(e,u),v=[g];if("alias"in u){const _=typeof u.alias=="string"?[u.alias]:u.alias;for(const x of _)v.push(It({},g,{components:f?f.record.components:g.components,path:x,aliasOf:f?f.record:g}))}let y,b;for(const _ of v){const{path:x}=_;if(d&&x[0]!=="/"){const w=d.record.path,T=w[w.length-1]==="/"?"":"/";_.path=d.record.path+(x&&T+x)}if(y=dP(_,d,m),f?f.alias.push(y):(b=b||y,b!==y&&b.alias.push(y),p&&u.name&&!Xy(y)&&o(u.name)),g.children){const w=g.children;for(let T=0;T<w.length;T++)r(w[T],y,f&&f.children[T])}f=f||y,(y.record.components&&Object.keys(y.record.components).length||y.record.name||y.record.redirect)&&l(y)}return b?()=>{o(b)}:pu}h(r,"addRoute");function o(u){if(AM(u)){const d=n.get(u);d&&(n.delete(u),t.splice(t.indexOf(d),1),d.children.forEach(o),d.alias.forEach(o))}else{const d=t.indexOf(u);d>-1&&(t.splice(d,1),u.record.name&&n.delete(u.record.name),u.children.forEach(o),u.alias.forEach(o))}}h(o,"removeRoute");function a(){return t}h(a,"getRoutes");function l(u){let d=0;for(;d<t.length&&lP(u,t[d])>=0&&(u.record.path!==t[d].record.path||!CM(u,t[d]));)d++;t.splice(d,0,u),u.record.name&&!Xy(u)&&n.set(u.record.name,u)}h(l,"insertMatcher");function c(u,d){let f,p={},g,m;if("name"in u&&u.name){if(f=n.get(u.name),!f)throw Dl(1,{location:u});m=f.record.name,p=It($y(d.params,f.keys.filter(b=>!b.optional).map(b=>b.name)),u.params&&$y(u.params,f.keys.map(b=>b.name))),g=f.stringify(p)}else if("path"in u)g=u.path,f=t.find(b=>b.re.test(g)),f&&(p=f.parse(g),m=f.record.name);else{if(f=d.name?n.get(d.name):t.find(b=>b.re.test(d.path)),!f)throw Dl(1,{location:u,currentLocation:d});m=f.record.name,p=It({},d.params,u.params),g=f.stringify(p)}const v=[];let y=f;for(;y;)v.unshift(y.record),y=y.parent;return{name:m,path:g,params:p,matched:v,meta:gP(v)}}return h(c,"resolve"),i.forEach(u=>r(u)),{addRoute:r,resolve:c,removeRoute:o,getRoutes:a,getRecordMatcher:s}}h(fP,"createRouterMatcher");function $y(i,e){const t={};for(const n of e)n in i&&(t[n]=i[n]);return t}h($y,"paramsFromLocation");function pP(i){return{path:i.path,redirect:i.redirect,name:i.name,meta:i.meta||{},aliasOf:void 0,beforeEnter:i.beforeEnter,props:mP(i),children:i.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in i?i.components||null:i.component&&{default:i.component}}}h(pP,"normalizeRouteRecord");function mP(i){const e={},t=i.props||!1;if("component"in i)e.default=t;else for(const n in i.components)e[n]=typeof t=="boolean"?t:t[n];return e}h(mP,"normalizeRecordProps");function Xy(i){for(;i;){if(i.record.aliasOf)return!0;i=i.parent}return!1}h(Xy,"isAliasRecord");function gP(i){return i.reduce((e,t)=>It(e,t.meta),{})}h(gP,"mergeMetaFields");function Yy(i,e){const t={};for(const n in i)t[n]=n in e?e[n]:i[n];return t}h(Yy,"mergeOptions");function CM(i,e){return e.children.some(t=>t===i||CM(i,t))}h(CM,"isRecordChildOf");const TM=/#/g,vP=/&/g,yP=/\//g,_P=/=/g,bP=/\?/g,EM=/\+/g,wP=/%5B/g,xP=/%5D/g,PM=/%5E/g,MP=/%60/g,RM=/%7B/g,AP=/%7C/g,IM=/%7D/g,SP=/%20/g;function O0(i){return encodeURI(""+i).replace(AP,"|").replace(wP,"[").replace(xP,"]")}h(O0,"commonEncode");function CP(i){return O0(i).replace(RM,"{").replace(IM,"}").replace(PM,"^")}h(CP,"encodeHash");function Og(i){return O0(i).replace(EM,"%2B").replace(SP,"+").replace(TM,"%23").replace(vP,"%26").replace(MP,"`").replace(RM,"{").replace(IM,"}").replace(PM,"^")}h(Og,"encodeQueryValue");function TP(i){return Og(i).replace(_P,"%3D")}h(TP,"encodeQueryKey");function EP(i){return O0(i).replace(TM,"%23").replace(bP,"%3F")}h(EP,"encodePath");function PP(i){return i==null?"":EP(i).replace(yP,"%2F")}h(PP,"encodeParam");function Pf(i){try{return decodeURIComponent(""+i)}catch{}return""+i}h(Pf,"decode");function RP(i){const e={};if(i===""||i==="?")return e;const n=(i[0]==="?"?i.slice(1):i).split("&");for(let s=0;s<n.length;++s){const r=n[s].replace(EM," "),o=r.indexOf("="),a=Pf(o<0?r:r.slice(0,o)),l=o<0?null:Pf(r.slice(o+1));if(a in e){let c=e[a];_s(c)||(c=e[a]=[c]),c.push(l)}else e[a]=l}return e}h(RP,"parseQuery");function Ky(i){let e="";for(let t in i){const n=i[t];if(t=TP(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(_s(n)?n.map(r=>r&&Og(r)):[n&&Og(n)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}h(Ky,"stringifyQuery");function IP(i){const e={};for(const t in i){const n=i[t];n!==void 0&&(e[t]=_s(n)?n.map(s=>s==null?null:""+s):n==null?n:""+n)}return e}h(IP,"normalizeQuery");const DP=Symbol(""),qy=Symbol(""),hp=Symbol(""),DM=Symbol(""),Ng=Symbol("");function pc(){let i=[];function e(n){return i.push(n),()=>{const s=i.indexOf(n);s>-1&&i.splice(s,1)}}h(e,"add");function t(){i=[]}return h(t,"reset"),{add:e,list:()=>i,reset:t}}h(pc,"useCallbacks");function Jr(i,e,t,n,s){const r=n&&(n.enterCallbacks[s]=n.enterCallbacks[s]||[]);return()=>new Promise((o,a)=>{const l=h(d=>{d===!1?a(Dl(4,{from:t,to:e})):d instanceof Error?a(d):iP(d)?a(Dl(2,{from:e,to:d})):(r&&n.enterCallbacks[s]===r&&typeof d=="function"&&r.push(d),o())},"next"),c=i.call(n&&n.instances[s],e,t,l);let u=Promise.resolve(c);i.length<3&&(u=u.then(l)),u.catch(d=>a(d))})}h(Jr,"guardToPromiseFn");function Zp(i,e,t,n){const s=[];for(const r of i)for(const o in r.components){let a=r.components[o];if(!(e!=="beforeRouteEnter"&&!r.instances[o]))if(LP(a)){const c=(a.__vccOpts||a)[e];c&&s.push(Jr(c,t,n,r,o))}else{let l=a();s.push(()=>l.then(c=>{if(!c)return Promise.reject(new Error(`Couldn't resolve component "${o}" at "${r.path}"`));const u=zE(c)?c.default:c;r.components[o]=u;const f=(u.__vccOpts||u)[e];return f&&Jr(f,t,n,r,o)()}))}}return s}h(Zp,"extractComponentsGuards");function LP(i){return typeof i=="object"||"displayName"in i||"props"in i||"__vccOpts"in i}h(LP,"isRouteComponent");function Zy(i){const e=ei(hp),t=ei(DM),n=Je(()=>e.resolve(Ml(i.to))),s=Je(()=>{const{matched:l}=n.value,{length:c}=l,u=l[c-1],d=t.matched;if(!u||!d.length)return-1;const f=d.findIndex(Il.bind(null,u));if(f>-1)return f;const p=Qy(l[c-2]);return c>1&&Qy(u)===p&&d[d.length-1].path!==p?d.findIndex(Il.bind(null,l[c-2])):f}),r=Je(()=>s.value>-1&&FP(t.params,n.value.params)),o=Je(()=>s.value>-1&&s.value===t.matched.length-1&&xM(t.params,n.value.params));function a(l={}){return NP(l)?e[Ml(i.replace)?"replace":"push"](Ml(i.to)).catch(pu):Promise.resolve()}return h(a,"navigate"),{route:n,href:Je(()=>n.value.href),isActive:r,isExactActive:o,navigate:a}}h(Zy,"useLink");const kP=Rt({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Zy,setup(i,{slots:e}){const t=vr(Zy(i)),{options:n}=ei(hp),s=Je(()=>({[Jy(i.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[Jy(i.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&e.default(t);return i.custom?r:_M("a",{"aria-current":t.isExactActive?i.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},r)}}}),OP=kP;function NP(i){if(!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)&&!i.defaultPrevented&&!(i.button!==void 0&&i.button!==0)){if(i.currentTarget&&i.currentTarget.getAttribute){const e=i.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return i.preventDefault&&i.preventDefault(),!0}}h(NP,"guardEvent");function FP(i,e){for(const t in e){const n=e[t],s=i[t];if(typeof n=="string"){if(n!==s)return!1}else if(!_s(s)||s.length!==n.length||n.some((r,o)=>r!==s[o]))return!1}return!0}h(FP,"includesParams");function Qy(i){return i?i.aliasOf?i.aliasOf.path:i.path:""}h(Qy,"getOriginalPath");const Jy=h((i,e,t)=>i!=null?i:e!=null?e:t,"getLinkClass"),zP=Rt({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(i,{attrs:e,slots:t}){const n=ei(Ng),s=Je(()=>i.route||n.value),r=ei(qy,0),o=Je(()=>{let c=Ml(r);const{matched:u}=s.value;let d;for(;(d=u[c])&&!d.components;)c++;return c}),a=Je(()=>s.value.matched[o.value]);Sl(qy,Je(()=>o.value+1)),Sl(DP,a),Sl(Ng,s);const l=ze();return mi(()=>[l.value,a.value,i.name],([c,u,d],[f,p,g])=>{u&&(u.instances[d]=c,p&&p!==u&&c&&c===f&&(u.leaveGuards.size||(u.leaveGuards=p.leaveGuards),u.updateGuards.size||(u.updateGuards=p.updateGuards))),c&&u&&(!p||!Il(u,p)||!f)&&(u.enterCallbacks[d]||[]).forEach(m=>m(c))},{flush:"post"}),()=>{const c=s.value,u=i.name,d=a.value,f=d&&d.components[u];if(!f)return e_(t.default,{Component:f,route:c});const p=d.props[u],g=p?p===!0?c.params:typeof p=="function"?p(c):p:null,v=_M(f,It({},g,e,{onVnodeUnmounted:h(y=>{y.component.isUnmounted&&(d.instances[u]=null)},"onVnodeUnmounted"),ref:l}));return e_(t.default,{Component:v,route:c})||v}}});function e_(i,e){if(!i)return null;const t=i(e);return t.length===1?t[0]:t}h(e_,"normalizeSlot");const BP=zP;function UP(i){const e=fP(i.routes,i),t=i.parseQuery||RP,n=i.stringifyQuery||Ky,s=i.history,r=pc(),o=pc(),a=pc(),l=qT(kr);let c=kr;cl&&i.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=Kp.bind(null,J=>""+J),d=Kp.bind(null,PP),f=Kp.bind(null,Pf);function p(J,te){let me,de;return AM(J)?(me=e.getRecordMatcher(J),de=te):de=J,e.addRoute(de,me)}h(p,"addRoute");function g(J){const te=e.getRecordMatcher(J);te&&e.removeRoute(te)}h(g,"removeRoute");function m(){return e.getRoutes().map(J=>J.record)}h(m,"getRoutes");function v(J){return!!e.getRecordMatcher(J)}h(v,"hasRoute");function y(J,te){if(te=It({},te||l.value),typeof J=="string"){const V=qp(t,J,te.path),X=e.resolve({path:V.path},te),E=s.createHref(V.fullPath);return It(V,X,{params:f(X.params),hash:Pf(V.hash),redirectedFrom:void 0,href:E})}let me;if("path"in J)me=It({},J,{path:qp(t,J.path,te.path).path});else{const V=It({},J.params);for(const X in V)V[X]==null&&delete V[X];me=It({},J,{params:d(J.params)}),te.params=d(te.params)}const de=e.resolve(me,te),be=J.hash||"";de.params=u(f(de.params));const we=VE(n,It({},J,{hash:CP(be),path:de.path})),Ae=s.createHref(we);return It({fullPath:we,hash:be,query:n===Ky?IP(J.query):J.query||{}},de,{redirectedFrom:void 0,href:Ae})}h(y,"resolve");function b(J){return typeof J=="string"?qp(t,J,l.value.path):It({},J)}h(b,"locationAsObject");function _(J,te){if(c!==J)return Dl(8,{from:te,to:J})}h(_,"checkCanceledNavigation");function x(J){return P(J)}h(x,"push");function w(J){return x(It(b(J),{replace:!0}))}h(w,"replace");function T(J){const te=J.matched[J.matched.length-1];if(te&&te.redirect){const{redirect:me}=te;let de=typeof me=="function"?me(J):me;return typeof de=="string"&&(de=de.includes("?")||de.includes("#")?de=b(de):{path:de},de.params={}),It({query:J.query,hash:J.hash,params:"path"in de?{}:J.params},de)}}h(T,"handleRedirectRecord");function P(J,te){const me=c=y(J),de=l.value,be=J.state,we=J.force,Ae=J.replace===!0,V=T(me);if(V)return P(It(b(V),{state:typeof V=="object"?It({},be,V.state):be,force:we,replace:Ae}),te||me);const X=me;X.redirectedFrom=te;let E;return!we&&HE(n,de,me)&&(E=Dl(16,{to:X,from:de}),se(de,de,!0,!1)),(E?Promise.resolve(E):R(X,de)).catch(ee=>Xs(ee)?Xs(ee,2)?ee:G(ee):K(ee,X,de)).then(ee=>{if(ee){if(Xs(ee,2))return P(It({replace:Ae},b(ee.to),{state:typeof ee.to=="object"?It({},be,ee.to.state):be,force:we}),te||X)}else ee=W(X,de,!0,Ae,be);return L(X,de,ee),ee})}h(P,"pushWithRedirect");function M(J,te){const me=_(J,te);return me?Promise.reject(me):Promise.resolve()}h(M,"checkCanceledNavigationAndReject");function R(J,te){let me;const[de,be,we]=VP(J,te);me=Zp(de.reverse(),"beforeRouteLeave",J,te);for(const V of de)V.leaveGuards.forEach(X=>{me.push(Jr(X,J,te))});const Ae=M.bind(null,J,te);return me.push(Ae),La(me).then(()=>{me=[];for(const V of r.list())me.push(Jr(V,J,te));return me.push(Ae),La(me)}).then(()=>{me=Zp(be,"beforeRouteUpdate",J,te);for(const V of be)V.updateGuards.forEach(X=>{me.push(Jr(X,J,te))});return me.push(Ae),La(me)}).then(()=>{me=[];for(const V of J.matched)if(V.beforeEnter&&!te.matched.includes(V))if(_s(V.beforeEnter))for(const X of V.beforeEnter)me.push(Jr(X,J,te));else me.push(Jr(V.beforeEnter,J,te));return me.push(Ae),La(me)}).then(()=>(J.matched.forEach(V=>V.enterCallbacks={}),me=Zp(we,"beforeRouteEnter",J,te),me.push(Ae),La(me))).then(()=>{me=[];for(const V of o.list())me.push(Jr(V,J,te));return me.push(Ae),La(me)}).catch(V=>Xs(V,8)?V:Promise.reject(V))}h(R,"navigate");function L(J,te,me){for(const de of a.list())de(J,te,me)}h(L,"triggerAfterEach");function W(J,te,me,de,be){const we=_(J,te);if(we)return we;const Ae=te===kr,V=cl?history.state:{};me&&(de||Ae?s.replace(J.fullPath,It({scroll:Ae&&V&&V.scroll},be)):s.push(J.fullPath,be)),l.value=J,se(J,te,me,Ae),G()}h(W,"finalizeNavigation");let k;function z(){k||(k=s.listen((J,te,me)=>{if(!ae.listening)return;const de=y(J),be=T(de);if(be){P(It(be,{replace:!0}),de).catch(pu);return}c=de;const we=l.value;cl&&qE(Vy(we.fullPath,me.delta),up()),R(de,we).catch(Ae=>Xs(Ae,12)?Ae:Xs(Ae,2)?(P(Ae.to,de).then(V=>{Xs(V,20)&&!me.delta&&me.type===Du.pop&&s.go(-1,!1)}).catch(pu),Promise.reject()):(me.delta&&s.go(-me.delta,!1),K(Ae,de,we))).then(Ae=>{Ae=Ae||W(de,we,!1),Ae&&(me.delta&&!Xs(Ae,8)?s.go(-me.delta,!1):me.type===Du.pop&&Xs(Ae,20)&&s.go(-1,!1)),L(de,we,Ae)}).catch(pu)}))}h(z,"setupListeners");let S=pc(),B=pc(),ne;function K(J,te,me){G(J);const de=B.list();return de.length?de.forEach(be=>be(J,te,me)):console.error(J),Promise.reject(J)}h(K,"triggerError");function ie(){return ne&&l.value!==kr?Promise.resolve():new Promise((J,te)=>{S.add([J,te])})}h(ie,"isReady");function G(J){return ne||(ne=!J,z(),S.list().forEach(([te,me])=>J?me(J):te()),S.reset()),J}h(G,"markAsReady");function se(J,te,me,de){const{scrollBehavior:be}=i;if(!cl||!be)return Promise.resolve();const we=!me&&ZE(Vy(J.fullPath,0))||(de||!me)&&history.state&&history.state.scroll||null;return Qi().then(()=>be(J,te,we)).then(Ae=>Ae&&KE(Ae)).catch(Ae=>K(Ae,J,te))}h(se,"handleScroll");const q=h(J=>s.go(J),"go");let U;const le=new Set,ae={currentRoute:l,listening:!0,addRoute:p,removeRoute:g,hasRoute:v,getRoutes:m,resolve:y,options:i,push:x,replace:w,go:q,back:()=>q(-1),forward:()=>q(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:B.add,isReady:ie,install(J){const te=this;J.component("RouterLink",OP),J.component("RouterView",BP),J.config.globalProperties.$router=te,Object.defineProperty(J.config.globalProperties,"$route",{enumerable:!0,get:()=>Ml(l)}),cl&&!U&&l.value===kr&&(U=!0,x(s.location).catch(be=>{}));const me={};for(const be in kr)me[be]=Je(()=>l.value[be]);J.provide(hp,te),J.provide(DM,vr(me)),J.provide(Ng,l);const de=J.unmount;le.add(J),J.unmount=function(){le.delete(J),le.size<1&&(c=kr,k&&k(),k=null,l.value=kr,U=!1,ne=!1),de()}}};return ae}h(UP,"createRouter");function La(i){return i.reduce((e,t)=>e.then(()=>t()),Promise.resolve())}h(La,"runGuardQueue");function VP(i,e){const t=[],n=[],s=[],r=Math.max(e.matched.length,i.matched.length);for(let o=0;o<r;o++){const a=e.matched[o];a&&(i.matched.find(c=>Il(c,a))?n.push(a):t.push(a));const l=i.matched[o];l&&(e.matched.find(c=>Il(c,l))||s.push(l))}return[t,n,s]}h(VP,"extractChangingRecords");function HP(){return ei(hp)}h(HP,"useRouter");/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const N0="146",GP=0,t_=1,WP=2,LM=1,kM=2,su=3,ha=0,Ji=1,Ci=2,Us=0,Cl=1,Fg=2,n_=3,i_=4,jP=5,ul=100,$P=101,XP=102,s_=103,r_=104,YP=200,KP=201,qP=202,ZP=203,OM=204,NM=205,QP=206,JP=207,eR=208,tR=209,nR=210,iR=0,sR=1,rR=2,zg=3,oR=4,aR=5,lR=6,cR=7,dp=0,uR=1,hR=2,Vs=0,dR=1,fR=2,pR=3,mR=4,gR=5,FM=300,Ll=301,kl=302,Rf=303,Bg=304,fp=306,wr=1e3,li=1001,Lu=1002,Cn=1003,If=1004,Df=1005,ai=1006,F0=1007,Ma=1008,da=1009,vR=1010,yR=1011,zM=1012,_R=1013,ta=1014,to=1015,Ol=1016,bR=1017,wR=1018,Tl=1020,xR=1021,MR=1022,Bi=1023,AR=1024,SR=1025,oa=1026,Nl=1027,CR=1028,TR=1029,ER=1030,PR=1031,RR=1033,Qp=33776,Jp=33777,em=33778,tm=33779,o_=35840,a_=35841,l_=35842,c_=35843,IR=36196,u_=37492,h_=37496,d_=37808,f_=37809,p_=37810,m_=37811,g_=37812,v_=37813,y_=37814,__=37815,b_=37816,w_=37817,x_=37818,M_=37819,A_=37820,S_=37821,C_=36492,Fl=2300,fa=2301,nm=2302,T_=2400,E_=2401,P_=2402,DR=2500,LR=1,BM=2,xr=3e3,bt=3001,kR=3200,UM=3201,ih=0,OR=1,hr="srgb",na="srgb-linear",im=7680,NR=519,Ug=35044,R_="300 es",Vg=1035;class Aa{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const r=s.indexOf(t);r!==-1&&s.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,e);e.target=null}}}h(Aa,"EventDispatcher");const Yn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let I_=1234567;const gu=Math.PI/180,ku=180/Math.PI;function vs(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Yn[i&255]+Yn[i>>8&255]+Yn[i>>16&255]+Yn[i>>24&255]+"-"+Yn[e&255]+Yn[e>>8&255]+"-"+Yn[e>>16&15|64]+Yn[e>>24&255]+"-"+Yn[t&63|128]+Yn[t>>8&255]+"-"+Yn[t>>16&255]+Yn[t>>24&255]+Yn[n&255]+Yn[n>>8&255]+Yn[n>>16&255]+Yn[n>>24&255]).toLowerCase()}h(vs,"generateUUID");function Gn(i,e,t){return Math.max(e,Math.min(t,i))}h(Gn,"clamp");function z0(i,e){return(i%e+e)%e}h(z0,"euclideanModulo");function FR(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}h(FR,"mapLinear");function zR(i,e,t){return i!==e?(t-i)/(e-i):0}h(zR,"inverseLerp");function vu(i,e,t){return(1-t)*i+t*e}h(vu,"lerp");function BR(i,e,t,n){return vu(i,e,1-Math.exp(-t*n))}h(BR,"damp");function UR(i,e=1){return e-Math.abs(z0(i,e*2)-e)}h(UR,"pingpong");function VR(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}h(VR,"smoothstep");function HR(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}h(HR,"smootherstep");function GR(i,e){return i+Math.floor(Math.random()*(e-i+1))}h(GR,"randInt");function WR(i,e){return i+Math.random()*(e-i)}h(WR,"randFloat");function jR(i){return i*(.5-Math.random())}h(jR,"randFloatSpread");function $R(i){i!==void 0&&(I_=i);let e=I_+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}h($R,"seededRandom");function XR(i){return i*gu}h(XR,"degToRad");function YR(i){return i*ku}h(YR,"radToDeg");function Hg(i){return(i&i-1)===0&&i!==0}h(Hg,"isPowerOfTwo");function VM(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}h(VM,"ceilPowerOfTwo");function Lf(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}h(Lf,"floorPowerOfTwo");function KR(i,e,t,n,s){const r=Math.cos,o=Math.sin,a=r(t/2),l=o(t/2),c=r((e+n)/2),u=o((e+n)/2),d=r((e-n)/2),f=o((e-n)/2),p=r((n-e)/2),g=o((n-e)/2);switch(s){case"XYX":i.set(a*u,l*d,l*f,a*c);break;case"YZY":i.set(l*f,a*u,l*d,a*c);break;case"ZXZ":i.set(l*d,l*f,a*u,a*c);break;case"XZX":i.set(a*u,l*g,l*p,a*c);break;case"YXY":i.set(l*p,a*u,l*g,a*c);break;case"ZYZ":i.set(l*g,l*p,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}h(KR,"setQuaternionFromProperEuler");function pr(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}h(pr,"denormalize");function Nt(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}h(Nt,"normalize");var Zi=Object.freeze({__proto__:null,DEG2RAD:gu,RAD2DEG:ku,generateUUID:vs,clamp:Gn,euclideanModulo:z0,mapLinear:FR,inverseLerp:zR,lerp:vu,damp:BR,pingpong:UR,smoothstep:VR,smootherstep:HR,randInt:GR,randFloat:WR,randFloatSpread:jR,seededRandom:$R,degToRad:XR,radToDeg:YR,isPowerOfTwo:Hg,ceilPowerOfTwo:VM,floorPowerOfTwo:Lf,setQuaternionFromProperEuler:KR,normalize:Nt,denormalize:pr});class je{constructor(e=0,t=0){je.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),r=this.x-e.x,o=this.y-e.y;return this.x=r*n-o*s+e.x,this.y=r*s+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}h(je,"Vector2");class ui{constructor(){ui.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,s,r,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=s,u[2]=a,u[3]=t,u[4]=r,u[5]=l,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],u=n[4],d=n[7],f=n[2],p=n[5],g=n[8],m=s[0],v=s[3],y=s[6],b=s[1],_=s[4],x=s[7],w=s[2],T=s[5],P=s[8];return r[0]=o*m+a*b+l*w,r[3]=o*v+a*_+l*T,r[6]=o*y+a*x+l*P,r[1]=c*m+u*b+d*w,r[4]=c*v+u*_+d*T,r[7]=c*y+u*x+d*P,r[2]=f*m+p*b+g*w,r[5]=f*v+p*_+g*T,r[8]=f*y+p*x+g*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-n*r*u+n*a*l+s*r*c-s*o*l}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,f=a*l-u*r,p=c*r-o*l,g=t*d+n*f+s*p;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/g;return e[0]=d*m,e[1]=(s*c-u*n)*m,e[2]=(a*n-s*o)*m,e[3]=f*m,e[4]=(u*t-s*l)*m,e[5]=(s*r-a*t)*m,e[6]=p*m,e[7]=(n*l-c*t)*m,e[8]=(o*t-n*r)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*o+c*a)+o+e,-s*c,s*l,-s*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),s=this.elements,r=s[0],o=s[3],a=s[6],l=s[1],c=s[4],u=s[7];return s[0]=t*r+n*l,s[3]=t*o+n*c,s[6]=t*a+n*u,s[1]=-n*r+t*l,s[4]=-n*o+t*c,s[7]=-n*a+t*u,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}h(ui,"Matrix3");function HM(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}h(HM,"arrayNeedsUint32");function Ou(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}h(Ou,"createElementNS");function aa(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}h(aa,"SRGBToLinear");function uf(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}h(uf,"LinearToSRGB");const sm={[hr]:{[na]:aa},[na]:{[hr]:uf}},rs={legacyMode:!0,get workingColorSpace(){return na},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,t){if(this.legacyMode||e===t||!e||!t)return i;if(sm[e]&&sm[e][t]!==void 0){const n=sm[e][t];return i.r=n(i.r),i.g=n(i.g),i.b=n(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}},GM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Tn={r:0,g:0,b:0},os={h:0,s:0,l:0},Rh={h:0,s:0,l:0};function rm(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}h(rm,"hue2rgb");function Ih(i,e){return e.r=i.r,e.g=i.g,e.b=i.b,e}h(Ih,"toComponents");class Te{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=hr){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,rs.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=na){return this.r=e,this.g=t,this.b=n,rs.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=na){if(e=z0(e,1),t=Gn(t,0,1),n=Gn(n,0,1),t===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,o=2*n-r;this.r=rm(o,r,e+1/3),this.g=rm(o,r,e),this.b=rm(o,r,e-1/3)}return rs.toWorkingColorSpace(this,s),this}setStyle(e,t=hr){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}h(n,"handleAlpha");let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,rs.toWorkingColorSpace(this,t),n(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,rs.toWorkingColorSpace(this,t),n(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(r[1])/360,c=parseFloat(r[2])/100,u=parseFloat(r[3])/100;return n(r[4]),this.setHSL(l,c,u,t)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=s[1],o=r.length;if(o===3)return this.r=parseInt(r.charAt(0)+r.charAt(0),16)/255,this.g=parseInt(r.charAt(1)+r.charAt(1),16)/255,this.b=parseInt(r.charAt(2)+r.charAt(2),16)/255,rs.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,this.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,this.b=parseInt(r.charAt(4)+r.charAt(5),16)/255,rs.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=hr){const n=GM[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=aa(e.r),this.g=aa(e.g),this.b=aa(e.b),this}copyLinearToSRGB(e){return this.r=uf(e.r),this.g=uf(e.g),this.b=uf(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=hr){return rs.fromWorkingColorSpace(Ih(this,Tn),e),Gn(Tn.r*255,0,255)<<16^Gn(Tn.g*255,0,255)<<8^Gn(Tn.b*255,0,255)<<0}getHexString(e=hr){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=na){rs.fromWorkingColorSpace(Ih(this,Tn),t);const n=Tn.r,s=Tn.g,r=Tn.b,o=Math.max(n,s,r),a=Math.min(n,s,r);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const d=o-a;switch(c=u<=.5?d/(o+a):d/(2-o-a),o){case n:l=(s-r)/d+(s<r?6:0);break;case s:l=(r-n)/d+2;break;case r:l=(n-s)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=na){return rs.fromWorkingColorSpace(Ih(this,Tn),t),e.r=Tn.r,e.g=Tn.g,e.b=Tn.b,e}getStyle(e=hr){return rs.fromWorkingColorSpace(Ih(this,Tn),e),e!==hr?`color(${e} ${Tn.r} ${Tn.g} ${Tn.b})`:`rgb(${Tn.r*255|0},${Tn.g*255|0},${Tn.b*255|0})`}offsetHSL(e,t,n){return this.getHSL(os),os.h+=e,os.s+=t,os.l+=n,this.setHSL(os.h,os.s,os.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(os),e.getHSL(Rh);const n=vu(os.h,Rh.h,t),s=vu(os.s,Rh.s,t),r=vu(os.l,Rh.l,t);return this.setHSL(n,s,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}h(Te,"Color");Te.NAMES=GM;let ka;class B0{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement=="undefined")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{ka===void 0&&(ka=Ou("canvas")),ka.width=e.width,ka.height=e.height;const n=ka.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ka}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap){const t=Ou("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=aa(r[o]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(aa(t[n]/255)*255):t[n]=aa(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}h(B0,"ImageUtils");class pp{constructor(e=null){this.isSource=!0,this.uuid=vs(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(om(s[o].image)):r.push(om(s[o]))}else r=om(s);n.url=r}return t||(e.images[this.uuid]=n),n}}h(pp,"Source");function om(i){return typeof HTMLImageElement!="undefined"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&i instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap?B0.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}h(om,"serializeImage");let qR=0;class Pn extends Aa{constructor(e=Pn.DEFAULT_IMAGE,t=Pn.DEFAULT_MAPPING,n=li,s=li,r=ai,o=Ma,a=Bi,l=da,c=1,u=xr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qR++}),this.uuid=vs(),this.name="",this.source=new pp(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new je(0,0),this.repeat=new je(1,1),this.center=new je(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ui,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==FM)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case wr:e.x=e.x-Math.floor(e.x);break;case li:e.x=e.x<0?0:1;break;case Lu:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case wr:e.y=e.y-Math.floor(e.y);break;case li:e.y=e.y<0?0:1;break;case Lu:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}h(Pn,"Texture");Pn.DEFAULT_IMAGE=null;Pn.DEFAULT_MAPPING=FM;class wt{constructor(e=0,t=0,n=0,s=1){wt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*s+o[12]*r,this.y=o[1]*t+o[5]*n+o[9]*s+o[13]*r,this.z=o[2]*t+o[6]*n+o[10]*s+o[14]*r,this.w=o[3]*t+o[7]*n+o[11]*s+o[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,r;const l=e.elements,c=l[0],u=l[4],d=l[8],f=l[1],p=l[5],g=l[9],m=l[2],v=l[6],y=l[10];if(Math.abs(u-f)<.01&&Math.abs(d-m)<.01&&Math.abs(g-v)<.01){if(Math.abs(u+f)<.1&&Math.abs(d+m)<.1&&Math.abs(g+v)<.1&&Math.abs(c+p+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,x=(p+1)/2,w=(y+1)/2,T=(u+f)/4,P=(d+m)/4,M=(g+v)/4;return _>x&&_>w?_<.01?(n=0,s=.707106781,r=.707106781):(n=Math.sqrt(_),s=T/n,r=P/n):x>w?x<.01?(n=.707106781,s=0,r=.707106781):(s=Math.sqrt(x),n=T/s,r=M/s):w<.01?(n=.707106781,s=.707106781,r=0):(r=Math.sqrt(w),n=P/r,s=M/r),this.set(n,s,r,t),this}let b=Math.sqrt((v-g)*(v-g)+(d-m)*(d-m)+(f-u)*(f-u));return Math.abs(b)<.001&&(b=1),this.x=(v-g)/b,this.y=(d-m)/b,this.z=(f-u)/b,this.w=Math.acos((c+p+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}h(wt,"Vector4");class Hn extends Aa{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new wt(0,0,e,t),this.scissorTest=!1,this.viewport=new wt(0,0,e,t);const s={width:e,height:t,depth:1};this.texture=new Pn(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:ai,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new pp(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}h(Hn,"WebGLRenderTarget");class U0 extends Pn{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=Cn,this.minFilter=Cn,this.wrapR=li,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}h(U0,"DataArrayTexture");class WM extends Pn{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=Cn,this.minFilter=Cn,this.wrapR=li,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}h(WM,"Data3DTexture");class Be{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,r,o,a){let l=n[s+0],c=n[s+1],u=n[s+2],d=n[s+3];const f=r[o+0],p=r[o+1],g=r[o+2],m=r[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=f,e[t+1]=p,e[t+2]=g,e[t+3]=m;return}if(d!==m||l!==f||c!==p||u!==g){let v=1-a;const y=l*f+c*p+u*g+d*m,b=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const w=Math.sqrt(_),T=Math.atan2(w,y*b);v=Math.sin(v*T)/w,a=Math.sin(a*T)/w}const x=a*b;if(l=l*v+f*x,c=c*v+p*x,u=u*v+g*x,d=d*v+m*x,v===1-a){const w=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=w,c*=w,u*=w,d*=w}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,n,s,r,o){const a=n[s],l=n[s+1],c=n[s+2],u=n[s+3],d=r[o],f=r[o+1],p=r[o+2],g=r[o+3];return e[t]=a*g+u*d+l*p-c*f,e[t+1]=l*g+u*f+c*d-a*p,e[t+2]=c*g+u*p+a*f-l*d,e[t+3]=u*g-a*d-l*f-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,s=e._y,r=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(n/2),u=a(s/2),d=a(r/2),f=l(n/2),p=l(s/2),g=l(r/2);switch(o){case"XYZ":this._x=f*u*d+c*p*g,this._y=c*p*d-f*u*g,this._z=c*u*g+f*p*d,this._w=c*u*d-f*p*g;break;case"YXZ":this._x=f*u*d+c*p*g,this._y=c*p*d-f*u*g,this._z=c*u*g-f*p*d,this._w=c*u*d+f*p*g;break;case"ZXY":this._x=f*u*d-c*p*g,this._y=c*p*d+f*u*g,this._z=c*u*g+f*p*d,this._w=c*u*d-f*p*g;break;case"ZYX":this._x=f*u*d-c*p*g,this._y=c*p*d+f*u*g,this._z=c*u*g-f*p*d,this._w=c*u*d+f*p*g;break;case"YZX":this._x=f*u*d+c*p*g,this._y=c*p*d+f*u*g,this._z=c*u*g-f*p*d,this._w=c*u*d-f*p*g;break;case"XZY":this._x=f*u*d-c*p*g,this._y=c*p*d-f*u*g,this._z=c*u*g+f*p*d,this._w=c*u*d+f*p*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],r=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],f=n+a+d;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(u-l)*p,this._y=(r-c)*p,this._z=(o-s)*p}else if(n>a&&n>d){const p=2*Math.sqrt(1+n-a-d);this._w=(u-l)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(r+c)/p}else if(a>d){const p=2*Math.sqrt(1+a-n-d);this._w=(r-c)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(l+u)/p}else{const p=2*Math.sqrt(1+d-n-a);this._w=(o-s)/p,this._x=(r+c)/p,this._y=(l+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Gn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,r=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+s*c-r*l,this._y=s*u+o*l+r*a-n*c,this._z=r*u+o*c+n*l-s*a,this._w=o*u-n*a-s*l-r*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,r=this._z,o=this._w;let a=o*e._w+n*e._x+s*e._y+r*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const p=1-t;return this._w=p*o+t*this._w,this._x=p*n+t*this._x,this._y=p*s+t*this._y,this._z=p*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=o*d+this._w*f,this._x=n*d+this._x*f,this._y=s*d+this._y*f,this._z=r*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(s),n*Math.sin(r),n*Math.cos(r),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}h(Be,"Quaternion");class A{constructor(e=0,t=0,n=0){A.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(D_.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(D_.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*s,this.y=r[1]*t+r[4]*n+r[7]*s,this.z=r[2]*t+r[5]*n+r[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,r=e.elements,o=1/(r[3]*t+r[7]*n+r[11]*s+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*s+r[12])*o,this.y=(r[1]*t+r[5]*n+r[9]*s+r[13])*o,this.z=(r[2]*t+r[6]*n+r[10]*s+r[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,r=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*s-a*n,u=l*n+a*t-r*s,d=l*s+r*n-o*t,f=-r*t-o*n-a*s;return this.x=c*l+f*-r+u*-a-d*-o,this.y=u*l+f*-o+d*-r-c*-a,this.z=d*l+f*-a+c*-o-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s,this.y=r[1]*t+r[5]*n+r[9]*s,this.z=r[2]*t+r[6]*n+r[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z;return this.x=s*l-r*a,this.y=r*o-n*l,this.z=n*a-s*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return am.copy(this).projectOnVector(e),this.sub(am)}reflect(e){return this.sub(am.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Gn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}h(A,"Vector3");const am=new A,D_=new Be;class zn{constructor(e=new A(1/0,1/0,1/0),t=new A(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const u=e[l],d=e[l+1],f=e[l+2];u<t&&(t=u),d<n&&(n=d),f<s&&(s=f),u>r&&(r=u),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,n,s),this.max.set(r,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,s=1/0,r=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const u=e.getX(l),d=e.getY(l),f=e.getZ(l);u<t&&(t=u),d<n&&(n=d),f<s&&(s=f),u>r&&(r=u),d>o&&(o=d),f>a&&(a=f)}return this.min.set(t,n,s),this.max.set(r,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Eo.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const r=n.attributes.position;for(let o=0,a=r.count;o<a;o++)Eo.fromBufferAttribute(r,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Eo)}else n.boundingBox===null&&n.computeBoundingBox(),lm.copy(n.boundingBox),lm.applyMatrix4(e.matrixWorld),this.union(lm);const s=e.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Eo),Eo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(mc),Dh.subVectors(this.max,mc),Oa.subVectors(e.a,mc),Na.subVectors(e.b,mc),Fa.subVectors(e.c,mc),Or.subVectors(Na,Oa),Nr.subVectors(Fa,Na),Po.subVectors(Oa,Fa);let t=[0,-Or.z,Or.y,0,-Nr.z,Nr.y,0,-Po.z,Po.y,Or.z,0,-Or.x,Nr.z,0,-Nr.x,Po.z,0,-Po.x,-Or.y,Or.x,0,-Nr.y,Nr.x,0,-Po.y,Po.x,0];return!cm(t,Oa,Na,Fa,Dh)||(t=[1,0,0,0,1,0,0,0,1],!cm(t,Oa,Na,Fa,Dh))?!1:(Lh.crossVectors(Or,Nr),t=[Lh.x,Lh.y,Lh.z],cm(t,Oa,Na,Fa,Dh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Eo.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Eo).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ys[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ys[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ys[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ys[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ys[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ys[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ys[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ys[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ys),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}h(zn,"Box3");const Ys=[new A,new A,new A,new A,new A,new A,new A,new A],Eo=new A,lm=new zn,Oa=new A,Na=new A,Fa=new A,Or=new A,Nr=new A,Po=new A,mc=new A,Dh=new A,Lh=new A,Ro=new A;function cm(i,e,t,n,s){for(let r=0,o=i.length-3;r<=o;r+=3){Ro.fromArray(i,r);const a=s.x*Math.abs(Ro.x)+s.y*Math.abs(Ro.y)+s.z*Math.abs(Ro.z),l=e.dot(Ro),c=t.dot(Ro),u=n.dot(Ro);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}h(cm,"satForAxes");const ZR=new zn,gc=new A,um=new A;class go{constructor(e=new A,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):ZR.setFromPoints(e).getCenter(n);let s=0;for(let r=0,o=e.length;r<o;r++)s=Math.max(s,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;gc.subVectors(e,this.center);const t=gc.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.addScaledVector(gc,s/n),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(um.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(gc.copy(e.center).add(um)),this.expandByPoint(gc.copy(e.center).sub(um))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}h(go,"Sphere");const Ks=new A,hm=new A,kh=new A,Fr=new A,dm=new A,Oh=new A,fm=new A;class vo{constructor(e=new A,t=new A(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ks)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ks.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ks.copy(this.direction).multiplyScalar(t).add(this.origin),Ks.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){hm.copy(e).add(t).multiplyScalar(.5),kh.copy(t).sub(e).normalize(),Fr.copy(this.origin).sub(hm);const r=e.distanceTo(t)*.5,o=-this.direction.dot(kh),a=Fr.dot(this.direction),l=-Fr.dot(kh),c=Fr.lengthSq(),u=Math.abs(1-o*o);let d,f,p,g;if(u>0)if(d=o*l-a,f=o*a-l,g=r*u,d>=0)if(f>=-g)if(f<=g){const m=1/u;d*=m,f*=m,p=d*(d+o*f+2*a)+f*(o*d+f+2*l)+c}else f=r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f=-r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;else f<=-g?(d=Math.max(0,-(-o*r+a)),f=d>0?-r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c):f<=g?(d=0,f=Math.min(Math.max(-r,-l),r),p=f*(f+2*l)+c):(d=Math.max(0,-(o*r+a)),f=d>0?r:Math.min(Math.max(-r,-l),r),p=-d*d+f*(f+2*l)+c);else f=o>0?-r:r,d=Math.max(0,-(o*f+a)),p=-d*d+f*(f+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(d).add(this.origin),s&&s.copy(kh).multiplyScalar(f).add(hm),p}intersectSphere(e,t){Ks.subVectors(e.center,this.origin);const n=Ks.dot(this.direction),s=Ks.dot(Ks)-n*n,r=e.radius*e.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=n-o,l=n+o;return a<0&&l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,r,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(n=(e.min.x-f.x)*c,s=(e.max.x-f.x)*c):(n=(e.max.x-f.x)*c,s=(e.min.x-f.x)*c),u>=0?(r=(e.min.y-f.y)*u,o=(e.max.y-f.y)*u):(r=(e.max.y-f.y)*u,o=(e.min.y-f.y)*u),n>o||r>s||((r>n||isNaN(n))&&(n=r),(o<s||isNaN(s))&&(s=o),d>=0?(a=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),n>l||a>s)||((a>n||n!==n)&&(n=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,Ks)!==null}intersectTriangle(e,t,n,s,r){dm.subVectors(t,e),Oh.subVectors(n,e),fm.crossVectors(dm,Oh);let o=this.direction.dot(fm),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Fr.subVectors(this.origin,e);const l=a*this.direction.dot(Oh.crossVectors(Fr,Oh));if(l<0)return null;const c=a*this.direction.dot(dm.cross(Fr));if(c<0||l+c>o)return null;const u=-a*Fr.dot(fm);return u<0?null:this.at(u/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}h(vo,"Ray");class ve{constructor(){ve.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,s,r,o,a,l,c,u,d,f,p,g,m,v){const y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=s,y[1]=r,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=d,y[14]=f,y[3]=p,y[7]=g,y[11]=m,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ve().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/za.setFromMatrixColumn(e,0).length(),r=1/za.setFromMatrixColumn(e,1).length(),o=1/za.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,r=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(s),c=Math.sin(s),u=Math.cos(r),d=Math.sin(r);if(e.order==="XYZ"){const f=o*u,p=o*d,g=a*u,m=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=p+g*c,t[5]=f-m*c,t[9]=-a*l,t[2]=m-f*c,t[6]=g+p*c,t[10]=o*l}else if(e.order==="YXZ"){const f=l*u,p=l*d,g=c*u,m=c*d;t[0]=f+m*a,t[4]=g*a-p,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=p*a-g,t[6]=m+f*a,t[10]=o*l}else if(e.order==="ZXY"){const f=l*u,p=l*d,g=c*u,m=c*d;t[0]=f-m*a,t[4]=-o*d,t[8]=g+p*a,t[1]=p+g*a,t[5]=o*u,t[9]=m-f*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const f=o*u,p=o*d,g=a*u,m=a*d;t[0]=l*u,t[4]=g*c-p,t[8]=f*c+m,t[1]=l*d,t[5]=m*c+f,t[9]=p*c-g,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const f=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*u,t[4]=m-f*d,t[8]=g*d+p,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=p*d+g,t[10]=f-m*d}else if(e.order==="XZY"){const f=o*l,p=o*c,g=a*l,m=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=f*d+m,t[5]=o*u,t[9]=p*d-g,t[2]=g*d-p,t[6]=a*u,t[10]=m*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(QR,e,JR)}lookAt(e,t,n){const s=this.elements;return Ri.subVectors(e,t),Ri.lengthSq()===0&&(Ri.z=1),Ri.normalize(),zr.crossVectors(n,Ri),zr.lengthSq()===0&&(Math.abs(n.z)===1?Ri.x+=1e-4:Ri.z+=1e-4,Ri.normalize(),zr.crossVectors(n,Ri)),zr.normalize(),Nh.crossVectors(Ri,zr),s[0]=zr.x,s[4]=Nh.x,s[8]=Ri.x,s[1]=zr.y,s[5]=Nh.y,s[9]=Ri.y,s[2]=zr.z,s[6]=Nh.z,s[10]=Ri.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,r=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],u=n[1],d=n[5],f=n[9],p=n[13],g=n[2],m=n[6],v=n[10],y=n[14],b=n[3],_=n[7],x=n[11],w=n[15],T=s[0],P=s[4],M=s[8],R=s[12],L=s[1],W=s[5],k=s[9],z=s[13],S=s[2],B=s[6],ne=s[10],K=s[14],ie=s[3],G=s[7],se=s[11],q=s[15];return r[0]=o*T+a*L+l*S+c*ie,r[4]=o*P+a*W+l*B+c*G,r[8]=o*M+a*k+l*ne+c*se,r[12]=o*R+a*z+l*K+c*q,r[1]=u*T+d*L+f*S+p*ie,r[5]=u*P+d*W+f*B+p*G,r[9]=u*M+d*k+f*ne+p*se,r[13]=u*R+d*z+f*K+p*q,r[2]=g*T+m*L+v*S+y*ie,r[6]=g*P+m*W+v*B+y*G,r[10]=g*M+m*k+v*ne+y*se,r[14]=g*R+m*z+v*K+y*q,r[3]=b*T+_*L+x*S+w*ie,r[7]=b*P+_*W+x*B+w*G,r[11]=b*M+_*k+x*ne+w*se,r[15]=b*R+_*z+x*K+w*q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],r=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],f=e[10],p=e[14],g=e[3],m=e[7],v=e[11],y=e[15];return g*(+r*l*d-s*c*d-r*a*f+n*c*f+s*a*p-n*l*p)+m*(+t*l*p-t*c*f+r*o*f-s*o*p+s*c*u-r*l*u)+v*(+t*c*d-t*a*p-r*o*d+n*o*p+r*a*u-n*c*u)+y*(-s*a*u-t*l*d+t*a*f+s*o*d-n*o*f+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],p=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=d*v*c-m*f*c+m*l*p-a*v*p-d*l*y+a*f*y,_=g*f*c-u*v*c-g*l*p+o*v*p+u*l*y-o*f*y,x=u*m*c-g*d*c+g*a*p-o*m*p-u*a*y+o*d*y,w=g*d*l-u*m*l-g*a*f+o*m*f+u*a*v-o*d*v,T=t*b+n*_+s*x+r*w;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/T;return e[0]=b*P,e[1]=(m*f*r-d*v*r-m*s*p+n*v*p+d*s*y-n*f*y)*P,e[2]=(a*v*r-m*l*r+m*s*c-n*v*c-a*s*y+n*l*y)*P,e[3]=(d*l*r-a*f*r-d*s*c+n*f*c+a*s*p-n*l*p)*P,e[4]=_*P,e[5]=(u*v*r-g*f*r+g*s*p-t*v*p-u*s*y+t*f*y)*P,e[6]=(g*l*r-o*v*r-g*s*c+t*v*c+o*s*y-t*l*y)*P,e[7]=(o*f*r-u*l*r+u*s*c-t*f*c-o*s*p+t*l*p)*P,e[8]=x*P,e[9]=(g*d*r-u*m*r-g*n*p+t*m*p+u*n*y-t*d*y)*P,e[10]=(o*m*r-g*a*r+g*n*c-t*m*c-o*n*y+t*a*y)*P,e[11]=(u*a*r-o*d*r-u*n*c+t*d*c+o*n*p-t*a*p)*P,e[12]=w*P,e[13]=(u*m*s-g*d*s+g*n*f-t*m*f-u*n*v+t*d*v)*P,e[14]=(g*a*s-o*m*s-g*n*l+t*m*l+o*n*v-t*a*v)*P,e[15]=(o*d*s-u*a*s+u*n*l-t*d*l-o*n*f+t*a*f)*P,this}scale(e){const t=this.elements,n=e.x,s=e.y,r=e.z;return t[0]*=n,t[4]*=s,t[8]*=r,t[1]*=n,t[5]*=s,t[9]*=r,t[2]*=n,t[6]*=s,t[10]*=r,t[3]*=n,t[7]*=s,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),r=1-n,o=e.x,a=e.y,l=e.z,c=r*o,u=r*a;return this.set(c*o+n,c*a-s*l,c*l+s*a,0,c*a+s*l,u*a+n,u*l-s*o,0,c*l-s*a,u*l+s*o,r*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,r,o){return this.set(1,n,r,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,r=t._x,o=t._y,a=t._z,l=t._w,c=r+r,u=o+o,d=a+a,f=r*c,p=r*u,g=r*d,m=o*u,v=o*d,y=a*d,b=l*c,_=l*u,x=l*d,w=n.x,T=n.y,P=n.z;return s[0]=(1-(m+y))*w,s[1]=(p+x)*w,s[2]=(g-_)*w,s[3]=0,s[4]=(p-x)*T,s[5]=(1-(f+y))*T,s[6]=(v+b)*T,s[7]=0,s[8]=(g+_)*P,s[9]=(v-b)*P,s[10]=(1-(f+m))*P,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let r=za.set(s[0],s[1],s[2]).length();const o=za.set(s[4],s[5],s[6]).length(),a=za.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),e.x=s[12],e.y=s[13],e.z=s[14],as.copy(this);const c=1/r,u=1/o,d=1/a;return as.elements[0]*=c,as.elements[1]*=c,as.elements[2]*=c,as.elements[4]*=u,as.elements[5]*=u,as.elements[6]*=u,as.elements[8]*=d,as.elements[9]*=d,as.elements[10]*=d,t.setFromRotationMatrix(as),n.x=r,n.y=o,n.z=a,this}makePerspective(e,t,n,s,r,o){const a=this.elements,l=2*r/(t-e),c=2*r/(n-s),u=(t+e)/(t-e),d=(n+s)/(n-s),f=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=l,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=f,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,s,r,o){const a=this.elements,l=1/(t-e),c=1/(n-s),u=1/(o-r),d=(t+e)*l,f=(n+s)*c,p=(o+r)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-f,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}h(ve,"Matrix4");const za=new A,as=new ve,QR=new A(0,0,0),JR=new A(1,1,1),zr=new A,Nh=new A,Ri=new A,L_=new ve,k_=new Be;class it{constructor(e=0,t=0,n=0,s=it.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],u=s[9],d=s[2],f=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(Gn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Gn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,r),this._z=0);break;case"ZXY":this._x=Math.asin(Gn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Gn(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Gn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-Gn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return L_.makeRotationFromQuaternion(e),this.setFromRotationMatrix(L_,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return k_.setFromEuler(this),this.setFromQuaternion(k_,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}h(it,"Euler");it.DefaultOrder="XYZ";it.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class mp{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}h(mp,"Layers");let eI=0;const O_=new A,Ba=new Be,qs=new ve,Fh=new A,vc=new A,tI=new A,nI=new Be,N_=new A(1,0,0),F_=new A(0,1,0),z_=new A(0,0,1),iI={type:"added"},B_={type:"removed"};class vt extends Aa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:eI++}),this.uuid=vs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=vt.DefaultUp.clone();const e=new A,t=new it,n=new Be,s=new A(1,1,1);function r(){n.setFromEuler(t,!1)}h(r,"onRotationChange");function o(){t.setFromQuaternion(n,void 0,!1)}h(o,"onQuaternionChange"),t._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ve},normalMatrix:{value:new ui}}),this.matrix=new ve,this.matrixWorld=new ve,this.matrixAutoUpdate=vt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=vt.DefaultMatrixWorldAutoUpdate,this.layers=new mp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ba.setFromAxisAngle(e,t),this.quaternion.multiply(Ba),this}rotateOnWorldAxis(e,t){return Ba.setFromAxisAngle(e,t),this.quaternion.premultiply(Ba),this}rotateX(e){return this.rotateOnAxis(N_,e)}rotateY(e){return this.rotateOnAxis(F_,e)}rotateZ(e){return this.rotateOnAxis(z_,e)}translateOnAxis(e,t){return O_.copy(e).applyQuaternion(this.quaternion),this.position.add(O_.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(N_,e)}translateY(e){return this.translateOnAxis(F_,e)}translateZ(e){return this.translateOnAxis(z_,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(qs.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Fh.copy(e):Fh.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),vc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qs.lookAt(vc,Fh,this.up):qs.lookAt(Fh,vc,this.up),this.quaternion.setFromRotationMatrix(qs),s&&(qs.extractRotation(s.matrixWorld),Ba.setFromRotationMatrix(qs),this.quaternion.premultiply(Ba.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(iI)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(B_)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(B_)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),qs.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),qs.multiply(e.parent.matrixWorld)),e.applyMatrix4(qs),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vc,e,tI),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vc,nI,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++){const r=t[n];(r.matrixWorldAutoUpdate===!0||e===!0)&&r.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++){const a=s[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(h(r,"serialize"),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];r(e.shapes,d)}else r(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(e.materials,this.material[l]));s.material=a}else s.material=r(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),d=o(e.shapes),f=o(e.skeletons),p=o(e.animations),g=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),u.length>0&&(n.images=u),d.length>0&&(n.shapes=d),f.length>0&&(n.skeletons=f),p.length>0&&(n.animations=p),g.length>0&&(n.nodes=g)}return n.object=s,n;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}h(o,"extractFromCache")}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}h(vt,"Object3D");vt.DefaultUp=new A(0,1,0);vt.DefaultMatrixAutoUpdate=!0;vt.DefaultMatrixWorldAutoUpdate=!0;const ls=new A,Zs=new A,pm=new A,Qs=new A,Ua=new A,Va=new A,U_=new A,mm=new A,gm=new A,vm=new A;class Ls{constructor(e=new A,t=new A,n=new A){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),ls.subVectors(e,t),s.cross(ls);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(e,t,n,s,r){ls.subVectors(s,t),Zs.subVectors(n,t),pm.subVectors(e,t);const o=ls.dot(ls),a=ls.dot(Zs),l=ls.dot(pm),c=Zs.dot(Zs),u=Zs.dot(pm),d=o*c-a*a;if(d===0)return r.set(-2,-1,-1);const f=1/d,p=(c*l-a*u)*f,g=(o*u-a*l)*f;return r.set(1-p-g,g,p)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,Qs),Qs.x>=0&&Qs.y>=0&&Qs.x+Qs.y<=1}static getUV(e,t,n,s,r,o,a,l){return this.getBarycoord(e,t,n,s,Qs),l.set(0,0),l.addScaledVector(r,Qs.x),l.addScaledVector(o,Qs.y),l.addScaledVector(a,Qs.z),l}static isFrontFacing(e,t,n,s){return ls.subVectors(n,t),Zs.subVectors(e,t),ls.cross(Zs).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ls.subVectors(this.c,this.b),Zs.subVectors(this.a,this.b),ls.cross(Zs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ls.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ls.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,s,r){return Ls.getUV(e,this.a,this.b,this.c,t,n,s,r)}containsPoint(e){return Ls.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ls.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,r=this.c;let o,a;Ua.subVectors(s,n),Va.subVectors(r,n),mm.subVectors(e,n);const l=Ua.dot(mm),c=Va.dot(mm);if(l<=0&&c<=0)return t.copy(n);gm.subVectors(e,s);const u=Ua.dot(gm),d=Va.dot(gm);if(u>=0&&d<=u)return t.copy(s);const f=l*d-u*c;if(f<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(Ua,o);vm.subVectors(e,r);const p=Ua.dot(vm),g=Va.dot(vm);if(g>=0&&p<=g)return t.copy(r);const m=p*c-l*g;if(m<=0&&c>=0&&g<=0)return a=c/(c-g),t.copy(n).addScaledVector(Va,a);const v=u*g-p*d;if(v<=0&&d-u>=0&&p-g>=0)return U_.subVectors(r,s),a=(d-u)/(d-u+(p-g)),t.copy(s).addScaledVector(U_,a);const y=1/(v+m+f);return o=m*y,a=f*y,t.copy(n).addScaledVector(Ua,o).addScaledVector(Va,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}h(Ls,"Triangle");let sI=0;class gi extends Aa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:sI++}),this.uuid=vs(),this.name="",this.type="Material",this.blending=Cl,this.side=ha,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=OM,this.blendDst=NM,this.blendEquation=ul,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=zg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=NR,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=im,this.stencilZFail=im,this.stencilZPass=im,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const s=this[t];if(s===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Cl&&(n.blending=this.blending),this.side!==ha&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(h(s,"extractFromCache"),t){const r=s(e.textures),o=s(e.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let r=0;r!==s;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}h(gi,"Material");class hi extends gi{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=dp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}h(hi,"MeshBasicMaterial");const Mn=new A,zh=new je;class Zt{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Ug,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)zh.fromBufferAttribute(this,t),zh.applyMatrix3(e),this.setXY(t,zh.x,zh.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Mn.fromBufferAttribute(this,t),Mn.applyMatrix3(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Mn.fromBufferAttribute(this,t),Mn.applyMatrix4(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Mn.fromBufferAttribute(this,t),Mn.applyNormalMatrix(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Mn.fromBufferAttribute(this,t),Mn.transformDirection(e),this.setXYZ(t,Mn.x,Mn.y,Mn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=pr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Nt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=pr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Nt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=pr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Nt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=pr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Nt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Nt(t,this.array),n=Nt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Nt(t,this.array),n=Nt(n,this.array),s=Nt(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e*=this.itemSize,this.normalized&&(t=Nt(t,this.array),n=Nt(n,this.array),s=Nt(s,this.array),r=Nt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Ug&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}h(Zt,"BufferAttribute");class gp extends Zt{constructor(e,t,n){super(new Uint16Array(e),t,n)}}h(gp,"Uint16BufferAttribute");class V0 extends Zt{constructor(e,t,n){super(new Uint32Array(e),t,n)}}h(V0,"Uint32BufferAttribute");class Fe extends Zt{constructor(e,t,n){super(new Float32Array(e),t,n)}}h(Fe,"Float32BufferAttribute");let rI=0;const ji=new ve,ym=new vt,Ha=new A,Ii=new zn,yc=new zn,Ln=new A;class et extends Aa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:rI++}),this.uuid=vs(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(HM(e)?V0:gp)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new ui().getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return ji.makeRotationFromQuaternion(e),this.applyMatrix4(ji),this}rotateX(e){return ji.makeRotationX(e),this.applyMatrix4(ji),this}rotateY(e){return ji.makeRotationY(e),this.applyMatrix4(ji),this}rotateZ(e){return ji.makeRotationZ(e),this.applyMatrix4(ji),this}translate(e,t,n){return ji.makeTranslation(e,t,n),this.applyMatrix4(ji),this}scale(e,t,n){return ji.makeScale(e,t,n),this.applyMatrix4(ji),this}lookAt(e){return ym.lookAt(e),ym.updateMatrix(),this.applyMatrix4(ym.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ha).negate(),this.translate(Ha.x,Ha.y,Ha.z),this}setFromPoints(e){const t=[];for(let n=0,s=e.length;n<s;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new Fe(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new zn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new A(-1/0,-1/0,-1/0),new A(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const r=t[n];Ii.setFromBufferAttribute(r),this.morphTargetsRelative?(Ln.addVectors(this.boundingBox.min,Ii.min),this.boundingBox.expandByPoint(Ln),Ln.addVectors(this.boundingBox.max,Ii.max),this.boundingBox.expandByPoint(Ln)):(this.boundingBox.expandByPoint(Ii.min),this.boundingBox.expandByPoint(Ii.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new go);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new A,1/0);return}if(e){const n=this.boundingSphere.center;if(Ii.setFromBufferAttribute(e),t)for(let r=0,o=t.length;r<o;r++){const a=t[r];yc.setFromBufferAttribute(a),this.morphTargetsRelative?(Ln.addVectors(Ii.min,yc.min),Ii.expandByPoint(Ln),Ln.addVectors(Ii.max,yc.max),Ii.expandByPoint(Ln)):(Ii.expandByPoint(yc.min),Ii.expandByPoint(yc.max))}Ii.getCenter(n);let s=0;for(let r=0,o=e.count;r<o;r++)Ln.fromBufferAttribute(e,r),s=Math.max(s,n.distanceToSquared(Ln));if(t)for(let r=0,o=t.length;r<o;r++){const a=t[r],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Ln.fromBufferAttribute(a,c),l&&(Ha.fromBufferAttribute(e,c),Ln.add(Ha)),s=Math.max(s,n.distanceToSquared(Ln))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,s=t.position.array,r=t.normal.array,o=t.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Zt(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let L=0;L<a;L++)c[L]=new A,u[L]=new A;const d=new A,f=new A,p=new A,g=new je,m=new je,v=new je,y=new A,b=new A;function _(L,W,k){d.fromArray(s,L*3),f.fromArray(s,W*3),p.fromArray(s,k*3),g.fromArray(o,L*2),m.fromArray(o,W*2),v.fromArray(o,k*2),f.sub(d),p.sub(d),m.sub(g),v.sub(g);const z=1/(m.x*v.y-v.x*m.y);!isFinite(z)||(y.copy(f).multiplyScalar(v.y).addScaledVector(p,-m.y).multiplyScalar(z),b.copy(p).multiplyScalar(m.x).addScaledVector(f,-v.x).multiplyScalar(z),c[L].add(y),c[W].add(y),c[k].add(y),u[L].add(b),u[W].add(b),u[k].add(b))}h(_,"handleTriangle");let x=this.groups;x.length===0&&(x=[{start:0,count:n.length}]);for(let L=0,W=x.length;L<W;++L){const k=x[L],z=k.start,S=k.count;for(let B=z,ne=z+S;B<ne;B+=3)_(n[B+0],n[B+1],n[B+2])}const w=new A,T=new A,P=new A,M=new A;function R(L){P.fromArray(r,L*3),M.copy(P);const W=c[L];w.copy(W),w.sub(P.multiplyScalar(P.dot(W))).normalize(),T.crossVectors(M,W);const z=T.dot(u[L])<0?-1:1;l[L*4]=w.x,l[L*4+1]=w.y,l[L*4+2]=w.z,l[L*4+3]=z}h(R,"handleVertex");for(let L=0,W=x.length;L<W;++L){const k=x[L],z=k.start,S=k.count;for(let B=z,ne=z+S;B<ne;B+=3)R(n[B+0]),R(n[B+1]),R(n[B+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Zt(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let f=0,p=n.count;f<p;f++)n.setXYZ(f,0,0,0);const s=new A,r=new A,o=new A,a=new A,l=new A,c=new A,u=new A,d=new A;if(e)for(let f=0,p=e.count;f<p;f+=3){const g=e.getX(f+0),m=e.getX(f+1),v=e.getX(f+2);s.fromBufferAttribute(t,g),r.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),u.subVectors(o,r),d.subVectors(s,r),u.cross(d),a.fromBufferAttribute(n,g),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,v),a.add(u),l.add(u),c.add(u),n.setXYZ(g,a.x,a.y,a.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let f=0,p=t.count;f<p;f+=3)s.fromBufferAttribute(t,f+0),r.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),u.subVectors(o,r),d.subVectors(s,r),u.cross(d),n.setXYZ(f+0,u.x,u.y,u.z),n.setXYZ(f+1,u.x,u.y,u.z),n.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ln.fromBufferAttribute(e,t),Ln.normalize(),e.setXYZ(t,Ln.x,Ln.y,Ln.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,f=new c.constructor(l.length*u);let p=0,g=0;for(let m=0,v=l.length;m<v;m++){a.isInterleavedBufferAttribute?p=l[m]*a.data.stride+a.offset:p=l[m]*u;for(let y=0;y<u;y++)f[g++]=c[p++]}return new Zt(f,u,d)}if(h(e,"convertBufferAttribute"),this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new et,n=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=e(l,n);t.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let u=0,d=c.length;u<d;u++){const f=c[u],p=e(f,n);l.push(p)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const c=n[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,f=c.length;d<f;d++){const p=c[d];u.push(p.toJSON(e.data))}u.length>0&&(s[l]=u,r=!0)}r&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const s=e.attributes;for(const c in s){const u=s[c];this.setAttribute(c,u.clone(t))}const r=e.morphAttributes;for(const c in r){const u=[],d=r[c];for(let f=0,p=d.length;f<p;f++)u.push(d[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}h(et,"BufferGeometry");const V_=new ve,Ga=new vo,_m=new go,Br=new A,Ur=new A,Vr=new A,bm=new A,wm=new A,xm=new A,Bh=new A,Uh=new A,Vh=new A,Hh=new je,Gh=new je,Wh=new je,Mm=new A,jh=new A;class Re extends vt{constructor(e=new et,t=new hi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}raycast(e,t){const n=this.geometry,s=this.material,r=this.matrixWorld;if(s===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),_m.copy(n.boundingSphere),_m.applyMatrix4(r),e.ray.intersectsSphere(_m)===!1)||(V_.copy(r).invert(),Ga.copy(e.ray).applyMatrix4(V_),n.boundingBox!==null&&Ga.intersectsBox(n.boundingBox)===!1))return;let o;const a=n.index,l=n.attributes.position,c=n.morphAttributes.position,u=n.morphTargetsRelative,d=n.attributes.uv,f=n.attributes.uv2,p=n.groups,g=n.drawRange;if(a!==null)if(Array.isArray(s))for(let m=0,v=p.length;m<v;m++){const y=p[m],b=s[y.materialIndex],_=Math.max(y.start,g.start),x=Math.min(a.count,Math.min(y.start+y.count,g.start+g.count));for(let w=_,T=x;w<T;w+=3){const P=a.getX(w),M=a.getX(w+1),R=a.getX(w+2);o=$h(this,b,e,Ga,l,c,u,d,f,P,M,R),o&&(o.faceIndex=Math.floor(w/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(a.count,g.start+g.count);for(let y=m,b=v;y<b;y+=3){const _=a.getX(y),x=a.getX(y+1),w=a.getX(y+2);o=$h(this,s,e,Ga,l,c,u,d,f,_,x,w),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}else if(l!==void 0)if(Array.isArray(s))for(let m=0,v=p.length;m<v;m++){const y=p[m],b=s[y.materialIndex],_=Math.max(y.start,g.start),x=Math.min(l.count,Math.min(y.start+y.count,g.start+g.count));for(let w=_,T=x;w<T;w+=3){const P=w,M=w+1,R=w+2;o=$h(this,b,e,Ga,l,c,u,d,f,P,M,R),o&&(o.faceIndex=Math.floor(w/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else{const m=Math.max(0,g.start),v=Math.min(l.count,g.start+g.count);for(let y=m,b=v;y<b;y+=3){const _=y,x=y+1,w=y+2;o=$h(this,s,e,Ga,l,c,u,d,f,_,x,w),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}}}h(Re,"Mesh");function oI(i,e,t,n,s,r,o,a){let l;if(e.side===Ji?l=n.intersectTriangle(o,r,s,!0,a):l=n.intersectTriangle(s,r,o,e.side!==Ci,a),l===null)return null;jh.copy(a),jh.applyMatrix4(i.matrixWorld);const c=t.ray.origin.distanceTo(jh);return c<t.near||c>t.far?null:{distance:c,point:jh.clone(),object:i}}h(oI,"checkIntersection");function $h(i,e,t,n,s,r,o,a,l,c,u,d){Br.fromBufferAttribute(s,c),Ur.fromBufferAttribute(s,u),Vr.fromBufferAttribute(s,d);const f=i.morphTargetInfluences;if(r&&f){Bh.set(0,0,0),Uh.set(0,0,0),Vh.set(0,0,0);for(let g=0,m=r.length;g<m;g++){const v=f[g],y=r[g];v!==0&&(bm.fromBufferAttribute(y,c),wm.fromBufferAttribute(y,u),xm.fromBufferAttribute(y,d),o?(Bh.addScaledVector(bm,v),Uh.addScaledVector(wm,v),Vh.addScaledVector(xm,v)):(Bh.addScaledVector(bm.sub(Br),v),Uh.addScaledVector(wm.sub(Ur),v),Vh.addScaledVector(xm.sub(Vr),v)))}Br.add(Bh),Ur.add(Uh),Vr.add(Vh)}i.isSkinnedMesh&&(i.boneTransform(c,Br),i.boneTransform(u,Ur),i.boneTransform(d,Vr));const p=oI(i,e,t,n,Br,Ur,Vr,Mm);if(p){a&&(Hh.fromBufferAttribute(a,c),Gh.fromBufferAttribute(a,u),Wh.fromBufferAttribute(a,d),p.uv=Ls.getUV(Mm,Br,Ur,Vr,Hh,Gh,Wh,new je)),l&&(Hh.fromBufferAttribute(l,c),Gh.fromBufferAttribute(l,u),Wh.fromBufferAttribute(l,d),p.uv2=Ls.getUV(Mm,Br,Ur,Vr,Hh,Gh,Wh,new je));const g={a:c,b:u,c:d,normal:new A,materialIndex:0};Ls.getNormal(Br,Ur,Vr,g.normal),p.face=g}return p}h($h,"checkBufferGeometryIntersection");class sn extends et{constructor(e=1,t=1,n=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],u=[],d=[];let f=0,p=0;g("z","y","x",-1,-1,n,t,e,o,r,0),g("z","y","x",1,-1,n,t,-e,o,r,1),g("x","z","y",1,1,e,n,t,s,o,2),g("x","z","y",1,-1,e,n,-t,s,o,3),g("x","y","z",1,-1,e,t,n,s,r,4),g("x","y","z",-1,-1,e,t,-n,s,r,5),this.setIndex(l),this.setAttribute("position",new Fe(c,3)),this.setAttribute("normal",new Fe(u,3)),this.setAttribute("uv",new Fe(d,2));function g(m,v,y,b,_,x,w,T,P,M,R){const L=x/P,W=w/M,k=x/2,z=w/2,S=T/2,B=P+1,ne=M+1;let K=0,ie=0;const G=new A;for(let se=0;se<ne;se++){const q=se*W-z;for(let U=0;U<B;U++){const le=U*L-k;G[m]=le*b,G[v]=q*_,G[y]=S,c.push(G.x,G.y,G.z),G[m]=0,G[v]=0,G[y]=T>0?1:-1,u.push(G.x,G.y,G.z),d.push(U/P),d.push(1-se/M),K+=1}}for(let se=0;se<M;se++)for(let q=0;q<P;q++){const U=f+q+B*se,le=f+q+B*(se+1),ae=f+(q+1)+B*(se+1),J=f+(q+1)+B*se;l.push(U,le,J),l.push(le,ae,J),ie+=6}a.addGroup(p,ie,R),p+=ie,f+=K}h(g,"buildPlane")}static fromJSON(e){return new sn(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}h(sn,"BoxGeometry");function zl(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}h(zl,"cloneUniforms");function si(i){const e={};for(let t=0;t<i.length;t++){const n=zl(i[t]);for(const s in n)e[s]=n[s]}return e}h(si,"mergeUniforms");function aI(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}h(aI,"cloneUniformsGroups");const vp={clone:zl,merge:si};var lI=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,cI=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Zn extends gi{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=lI,this.fragmentShader=cI,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zl(e.uniforms),this.uniformsGroups=aI(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}h(Zn,"ShaderMaterial");class yp extends vt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ve,this.projectionMatrix=new ve,this.projectionMatrixInverse=new ve}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}h(yp,"Camera");class Fn extends yp{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ku*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(gu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ku*2*Math.atan(Math.tan(gu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,s,r,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(gu*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,t-=o.offsetY*n/c,s*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(r+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}h(Fn,"PerspectiveCamera");const Wa=90,ja=1;class jM extends vt{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const s=new Fn(Wa,ja,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new A(1,0,0)),this.add(s);const r=new Fn(Wa,ja,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new A(-1,0,0)),this.add(r);const o=new Fn(Wa,ja,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new A(0,1,0)),this.add(o);const a=new Fn(Wa,ja,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new A(0,-1,0)),this.add(a);const l=new Fn(Wa,ja,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new A(0,0,1)),this.add(l);const c=new Fn(Wa,ja,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new A(0,0,-1)),this.add(c)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[s,r,o,a,l,c]=this.children,u=e.getRenderTarget(),d=e.toneMapping,f=e.xr.enabled;e.toneMapping=Vs,e.xr.enabled=!1;const p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,s),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=p,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}h(jM,"CubeCamera");class H0 extends Pn{constructor(e,t,n,s,r,o,a,l,c,u){e=e!==void 0?e:[],t=t!==void 0?t:Ll,super(e,t,n,s,r,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}h(H0,"CubeTexture");class $M extends Hn{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new H0(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:ai}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new sn(5,5,5),r=new Zn({name:"CubemapFromEquirect",uniforms:zl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ji,blending:Us});r.uniforms.tEquirect.value=t;const o=new Re(s,r),a=t.minFilter;return t.minFilter===Ma&&(t.minFilter=ai),new jM(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,s){const r=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,s);e.setRenderTarget(r)}}h($M,"WebGLCubeRenderTarget");const Am=new A,uI=new A,hI=new ui;class dr{constructor(e=new A(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=Am.subVectors(n,t).cross(uI.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Am),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||hI.getNormalMatrix(e),s=this.coplanarPoint(Am).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}h(dr,"Plane");const $a=new go,Xh=new A;class sh{constructor(e=new dr,t=new dr,n=new dr,s=new dr,r=new dr,o=new dr){this.planes=[e,t,n,s,r,o]}set(e,t,n,s,r,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,s=n[0],r=n[1],o=n[2],a=n[3],l=n[4],c=n[5],u=n[6],d=n[7],f=n[8],p=n[9],g=n[10],m=n[11],v=n[12],y=n[13],b=n[14],_=n[15];return t[0].setComponents(a-s,d-l,m-f,_-v).normalize(),t[1].setComponents(a+s,d+l,m+f,_+v).normalize(),t[2].setComponents(a+r,d+c,m+p,_+y).normalize(),t[3].setComponents(a-r,d-c,m-p,_-y).normalize(),t[4].setComponents(a-o,d-u,m-g,_-b).normalize(),t[5].setComponents(a+o,d+u,m+g,_+b).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),$a.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere($a)}intersectsSprite(e){return $a.center.set(0,0,0),$a.radius=.7071067811865476,$a.applyMatrix4(e.matrixWorld),this.intersectsSphere($a)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(Xh.x=s.normal.x>0?e.max.x:e.min.x,Xh.y=s.normal.y>0?e.max.y:e.min.y,Xh.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Xh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}h(sh,"Frustum");function XM(){let i=null,e=!1,t=null,n=null;function s(r,o){t(r,o),n=i.requestAnimationFrame(s)}return h(s,"onAnimationFrame"),{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(r){t=r},setContext:function(r){i=r}}}h(XM,"WebGLAnimation");function dI(i,e){const t=e.isWebGL2,n=new WeakMap;function s(c,u){const d=c.array,f=c.usage,p=i.createBuffer();i.bindBuffer(u,p),i.bufferData(u,d,f),c.onUploadCallback();let g;if(d instanceof Float32Array)g=5126;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(t)g=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=5123;else if(d instanceof Int16Array)g=5122;else if(d instanceof Uint32Array)g=5125;else if(d instanceof Int32Array)g=5124;else if(d instanceof Int8Array)g=5120;else if(d instanceof Uint8Array)g=5121;else if(d instanceof Uint8ClampedArray)g=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:p,type:g,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}h(s,"createBuffer");function r(c,u,d){const f=u.array,p=u.updateRange;i.bindBuffer(d,c),p.count===-1?i.bufferSubData(d,0,f):(t?i.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f,p.offset,p.count):i.bufferSubData(d,p.offset*f.BYTES_PER_ELEMENT,f.subarray(p.offset,p.offset+p.count)),p.count=-1)}h(r,"updateBuffer");function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}h(o,"get");function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u&&(i.deleteBuffer(u.buffer),n.delete(c))}h(a,"remove");function l(c,u){if(c.isGLBufferAttribute){const f=n.get(c);(!f||f.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const d=n.get(c);d===void 0?n.set(c,s(c,u)):d.version<c.version&&(r(d.buffer,c,u),d.version=c.version)}return h(l,"update"),{get:o,remove:a,update:l}}h(dI,"WebGLAttributes");class pa extends et{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const r=e/2,o=t/2,a=Math.floor(n),l=Math.floor(s),c=a+1,u=l+1,d=e/a,f=t/l,p=[],g=[],m=[],v=[];for(let y=0;y<u;y++){const b=y*f-o;for(let _=0;_<c;_++){const x=_*d-r;g.push(x,-b,0),m.push(0,0,1),v.push(_/a),v.push(1-y/l)}}for(let y=0;y<l;y++)for(let b=0;b<a;b++){const _=b+c*y,x=b+c*(y+1),w=b+1+c*(y+1),T=b+1+c*y;p.push(_,x,T),p.push(x,w,T)}this.setIndex(p),this.setAttribute("position",new Fe(g,3)),this.setAttribute("normal",new Fe(m,3)),this.setAttribute("uv",new Fe(v,2))}static fromJSON(e){return new pa(e.width,e.height,e.widthSegments,e.heightSegments)}}h(pa,"PlaneGeometry");var fI=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,pI=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,mI=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,gI=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,vI=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,yI=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,_I="vec3 transformed = vec3( position );",bI=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,wI=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,xI=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,MI=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,AI=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,SI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,CI=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,TI=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,EI=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,PI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,RI=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,II=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,DI=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,LI=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,kI=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,OI=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,NI=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,FI=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,zI=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,BI="gl_FragColor = linearToOutputTexel( gl_FragColor );",UI=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,VI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,HI=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,GI=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,WI=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,jI=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,$I=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,XI=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,YI=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,KI=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,qI=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,ZI=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,QI=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,JI=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,eD=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,tD=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,nD=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,iD=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,sD=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,rD=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,oD=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,aD=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lD=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,cD=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,uD=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,hD=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,dD=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,fD=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,pD=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,mD=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,gD=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,vD=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,yD=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,_D=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,bD=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,wD=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,xD=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,MD=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,AD=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,SD=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,CD=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,TD=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,ED=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,PD=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,RD=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,ID=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,DD=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,LD=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,kD=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,OD=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,ND=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,FD=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,zD=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,BD=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,UD=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,VD=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,HD=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,GD=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,WD=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,jD=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,$D=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,XD=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,YD=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,KD=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,qD=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,ZD=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,QD=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,JD=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,eL=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tL=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,nL=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,iL=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,sL=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,rL=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,oL=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,aL=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,lL=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,cL=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,uL=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const hL=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,dL=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,fL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,pL=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,mL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,gL=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vL=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,yL=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,_L=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,bL=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,wL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,xL=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,ML=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,AL=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,SL=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,CL=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,TL=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EL=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PL=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,RL=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IL=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,DL=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,LL=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,kL=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OL=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,NL=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,FL=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zL=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,BL=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,UL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,VL=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,HL=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,GL=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,WL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ht={alphamap_fragment:fI,alphamap_pars_fragment:pI,alphatest_fragment:mI,alphatest_pars_fragment:gI,aomap_fragment:vI,aomap_pars_fragment:yI,begin_vertex:_I,beginnormal_vertex:bI,bsdfs:wI,iridescence_fragment:xI,bumpmap_pars_fragment:MI,clipping_planes_fragment:AI,clipping_planes_pars_fragment:SI,clipping_planes_pars_vertex:CI,clipping_planes_vertex:TI,color_fragment:EI,color_pars_fragment:PI,color_pars_vertex:RI,color_vertex:II,common:DI,cube_uv_reflection_fragment:LI,defaultnormal_vertex:kI,displacementmap_pars_vertex:OI,displacementmap_vertex:NI,emissivemap_fragment:FI,emissivemap_pars_fragment:zI,encodings_fragment:BI,encodings_pars_fragment:UI,envmap_fragment:VI,envmap_common_pars_fragment:HI,envmap_pars_fragment:GI,envmap_pars_vertex:WI,envmap_physical_pars_fragment:nD,envmap_vertex:jI,fog_vertex:$I,fog_pars_vertex:XI,fog_fragment:YI,fog_pars_fragment:KI,gradientmap_pars_fragment:qI,lightmap_fragment:ZI,lightmap_pars_fragment:QI,lights_lambert_fragment:JI,lights_lambert_pars_fragment:eD,lights_pars_begin:tD,lights_toon_fragment:iD,lights_toon_pars_fragment:sD,lights_phong_fragment:rD,lights_phong_pars_fragment:oD,lights_physical_fragment:aD,lights_physical_pars_fragment:lD,lights_fragment_begin:cD,lights_fragment_maps:uD,lights_fragment_end:hD,logdepthbuf_fragment:dD,logdepthbuf_pars_fragment:fD,logdepthbuf_pars_vertex:pD,logdepthbuf_vertex:mD,map_fragment:gD,map_pars_fragment:vD,map_particle_fragment:yD,map_particle_pars_fragment:_D,metalnessmap_fragment:bD,metalnessmap_pars_fragment:wD,morphcolor_vertex:xD,morphnormal_vertex:MD,morphtarget_pars_vertex:AD,morphtarget_vertex:SD,normal_fragment_begin:CD,normal_fragment_maps:TD,normal_pars_fragment:ED,normal_pars_vertex:PD,normal_vertex:RD,normalmap_pars_fragment:ID,clearcoat_normal_fragment_begin:DD,clearcoat_normal_fragment_maps:LD,clearcoat_pars_fragment:kD,iridescence_pars_fragment:OD,output_fragment:ND,packing:FD,premultiplied_alpha_fragment:zD,project_vertex:BD,dithering_fragment:UD,dithering_pars_fragment:VD,roughnessmap_fragment:HD,roughnessmap_pars_fragment:GD,shadowmap_pars_fragment:WD,shadowmap_pars_vertex:jD,shadowmap_vertex:$D,shadowmask_pars_fragment:XD,skinbase_vertex:YD,skinning_pars_vertex:KD,skinning_vertex:qD,skinnormal_vertex:ZD,specularmap_fragment:QD,specularmap_pars_fragment:JD,tonemapping_fragment:eL,tonemapping_pars_fragment:tL,transmission_fragment:nL,transmission_pars_fragment:iL,uv_pars_fragment:sL,uv_pars_vertex:rL,uv_vertex:oL,uv2_pars_fragment:aL,uv2_pars_vertex:lL,uv2_vertex:cL,worldpos_vertex:uL,background_vert:hL,background_frag:dL,backgroundCube_vert:fL,backgroundCube_frag:pL,cube_vert:mL,cube_frag:gL,depth_vert:vL,depth_frag:yL,distanceRGBA_vert:_L,distanceRGBA_frag:bL,equirect_vert:wL,equirect_frag:xL,linedashed_vert:ML,linedashed_frag:AL,meshbasic_vert:SL,meshbasic_frag:CL,meshlambert_vert:TL,meshlambert_frag:EL,meshmatcap_vert:PL,meshmatcap_frag:RL,meshnormal_vert:IL,meshnormal_frag:DL,meshphong_vert:LL,meshphong_frag:kL,meshphysical_vert:OL,meshphysical_frag:NL,meshtoon_vert:FL,meshtoon_frag:zL,points_vert:BL,points_frag:UL,shadow_vert:VL,shadow_frag:HL,sprite_vert:GL,sprite_frag:WL},De={common:{diffuse:{value:new Te(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ui},uv2Transform:{value:new ui},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new je(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Te(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Te(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ui}},sprite:{diffuse:{value:new Te(16777215)},opacity:{value:1},center:{value:new je(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ui}}},Is={basic:{uniforms:si([De.common,De.specularmap,De.envmap,De.aomap,De.lightmap,De.fog]),vertexShader:ht.meshbasic_vert,fragmentShader:ht.meshbasic_frag},lambert:{uniforms:si([De.common,De.specularmap,De.envmap,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.fog,De.lights,{emissive:{value:new Te(0)}}]),vertexShader:ht.meshlambert_vert,fragmentShader:ht.meshlambert_frag},phong:{uniforms:si([De.common,De.specularmap,De.envmap,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.fog,De.lights,{emissive:{value:new Te(0)},specular:{value:new Te(1118481)},shininess:{value:30}}]),vertexShader:ht.meshphong_vert,fragmentShader:ht.meshphong_frag},standard:{uniforms:si([De.common,De.envmap,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.roughnessmap,De.metalnessmap,De.fog,De.lights,{emissive:{value:new Te(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ht.meshphysical_vert,fragmentShader:ht.meshphysical_frag},toon:{uniforms:si([De.common,De.aomap,De.lightmap,De.emissivemap,De.bumpmap,De.normalmap,De.displacementmap,De.gradientmap,De.fog,De.lights,{emissive:{value:new Te(0)}}]),vertexShader:ht.meshtoon_vert,fragmentShader:ht.meshtoon_frag},matcap:{uniforms:si([De.common,De.bumpmap,De.normalmap,De.displacementmap,De.fog,{matcap:{value:null}}]),vertexShader:ht.meshmatcap_vert,fragmentShader:ht.meshmatcap_frag},points:{uniforms:si([De.points,De.fog]),vertexShader:ht.points_vert,fragmentShader:ht.points_frag},dashed:{uniforms:si([De.common,De.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ht.linedashed_vert,fragmentShader:ht.linedashed_frag},depth:{uniforms:si([De.common,De.displacementmap]),vertexShader:ht.depth_vert,fragmentShader:ht.depth_frag},normal:{uniforms:si([De.common,De.bumpmap,De.normalmap,De.displacementmap,{opacity:{value:1}}]),vertexShader:ht.meshnormal_vert,fragmentShader:ht.meshnormal_frag},sprite:{uniforms:si([De.sprite,De.fog]),vertexShader:ht.sprite_vert,fragmentShader:ht.sprite_frag},background:{uniforms:{uvTransform:{value:new ui},t2D:{value:null}},vertexShader:ht.background_vert,fragmentShader:ht.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0}},vertexShader:ht.backgroundCube_vert,fragmentShader:ht.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ht.cube_vert,fragmentShader:ht.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ht.equirect_vert,fragmentShader:ht.equirect_frag},distanceRGBA:{uniforms:si([De.common,De.displacementmap,{referencePosition:{value:new A},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ht.distanceRGBA_vert,fragmentShader:ht.distanceRGBA_frag},shadow:{uniforms:si([De.lights,De.fog,{color:{value:new Te(0)},opacity:{value:1}}]),vertexShader:ht.shadow_vert,fragmentShader:ht.shadow_frag}};Is.physical={uniforms:si([Is.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new je(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Te(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new je},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Te(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Te(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ht.meshphysical_vert,fragmentShader:ht.meshphysical_frag};function jL(i,e,t,n,s,r,o){const a=new Te(0);let l=r===!0?0:1,c,u,d=null,f=0,p=null;function g(v,y){let b=!1,_=y.isScene===!0?y.background:null;_&&_.isTexture&&(_=(y.backgroundBlurriness>0?t:e).get(_));const x=i.xr,w=x.getSession&&x.getSession();w&&w.environmentBlendMode==="additive"&&(_=null),_===null?m(a,l):_&&_.isColor&&(m(_,1),b=!0),(i.autoClear||b)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),_&&(_.isCubeTexture||_.mapping===fp)?(u===void 0&&(u=new Re(new sn(1,1,1),new Zn({name:"BackgroundCubeMaterial",uniforms:zl(Is.backgroundCube.uniforms),vertexShader:Is.backgroundCube.vertexShader,fragmentShader:Is.backgroundCube.fragmentShader,side:Ji,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(T,P,M){this.matrixWorld.copyPosition(M.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(u)),u.material.uniforms.envMap.value=_,u.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,(d!==_||f!==_.version||p!==i.toneMapping)&&(u.material.needsUpdate=!0,d=_,f=_.version,p=i.toneMapping),u.layers.enableAll(),v.unshift(u,u.geometry,u.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new Re(new pa(2,2),new Zn({name:"BackgroundMaterial",uniforms:zl(Is.background.uniforms),vertexShader:Is.background.vertexShader,fragmentShader:Is.background.fragmentShader,side:ha,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=_,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(d!==_||f!==_.version||p!==i.toneMapping)&&(c.material.needsUpdate=!0,d=_,f=_.version,p=i.toneMapping),c.layers.enableAll(),v.unshift(c,c.geometry,c.material,0,0,null))}h(g,"render");function m(v,y){n.buffers.color.setClear(v.r,v.g,v.b,y,o)}return h(m,"setClear"),{getClearColor:function(){return a},setClearColor:function(v,y=1){a.set(v),l=y,m(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(v){l=v,m(a,l)},render:g}}h(jL,"WebGLBackground");function $L(i,e,t,n){const s=i.getParameter(34921),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||r!==null,a={},l=v(null);let c=l,u=!1;function d(S,B,ne,K,ie){let G=!1;if(o){const se=m(K,ne,B);c!==se&&(c=se,p(c.object)),G=y(S,K,ne,ie),G&&b(S,K,ne,ie)}else{const se=B.wireframe===!0;(c.geometry!==K.id||c.program!==ne.id||c.wireframe!==se)&&(c.geometry=K.id,c.program=ne.id,c.wireframe=se,G=!0)}ie!==null&&t.update(ie,34963),(G||u)&&(u=!1,M(S,B,ne,K),ie!==null&&i.bindBuffer(34963,t.get(ie).buffer))}h(d,"setup");function f(){return n.isWebGL2?i.createVertexArray():r.createVertexArrayOES()}h(f,"createVertexArrayObject");function p(S){return n.isWebGL2?i.bindVertexArray(S):r.bindVertexArrayOES(S)}h(p,"bindVertexArrayObject");function g(S){return n.isWebGL2?i.deleteVertexArray(S):r.deleteVertexArrayOES(S)}h(g,"deleteVertexArrayObject");function m(S,B,ne){const K=ne.wireframe===!0;let ie=a[S.id];ie===void 0&&(ie={},a[S.id]=ie);let G=ie[B.id];G===void 0&&(G={},ie[B.id]=G);let se=G[K];return se===void 0&&(se=v(f()),G[K]=se),se}h(m,"getBindingState");function v(S){const B=[],ne=[],K=[];for(let ie=0;ie<s;ie++)B[ie]=0,ne[ie]=0,K[ie]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:B,enabledAttributes:ne,attributeDivisors:K,object:S,attributes:{},index:null}}h(v,"createBindingState");function y(S,B,ne,K){const ie=c.attributes,G=B.attributes;let se=0;const q=ne.getAttributes();for(const U in q)if(q[U].location>=0){const ae=ie[U];let J=G[U];if(J===void 0&&(U==="instanceMatrix"&&S.instanceMatrix&&(J=S.instanceMatrix),U==="instanceColor"&&S.instanceColor&&(J=S.instanceColor)),ae===void 0||ae.attribute!==J||J&&ae.data!==J.data)return!0;se++}return c.attributesNum!==se||c.index!==K}h(y,"needsUpdate");function b(S,B,ne,K){const ie={},G=B.attributes;let se=0;const q=ne.getAttributes();for(const U in q)if(q[U].location>=0){let ae=G[U];ae===void 0&&(U==="instanceMatrix"&&S.instanceMatrix&&(ae=S.instanceMatrix),U==="instanceColor"&&S.instanceColor&&(ae=S.instanceColor));const J={};J.attribute=ae,ae&&ae.data&&(J.data=ae.data),ie[U]=J,se++}c.attributes=ie,c.attributesNum=se,c.index=K}h(b,"saveCache");function _(){const S=c.newAttributes;for(let B=0,ne=S.length;B<ne;B++)S[B]=0}h(_,"initAttributes");function x(S){w(S,0)}h(x,"enableAttribute");function w(S,B){const ne=c.newAttributes,K=c.enabledAttributes,ie=c.attributeDivisors;ne[S]=1,K[S]===0&&(i.enableVertexAttribArray(S),K[S]=1),ie[S]!==B&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](S,B),ie[S]=B)}h(w,"enableAttributeAndDivisor");function T(){const S=c.newAttributes,B=c.enabledAttributes;for(let ne=0,K=B.length;ne<K;ne++)B[ne]!==S[ne]&&(i.disableVertexAttribArray(ne),B[ne]=0)}h(T,"disableUnusedAttributes");function P(S,B,ne,K,ie,G){n.isWebGL2===!0&&(ne===5124||ne===5125)?i.vertexAttribIPointer(S,B,ne,ie,G):i.vertexAttribPointer(S,B,ne,K,ie,G)}h(P,"vertexAttribPointer");function M(S,B,ne,K){if(n.isWebGL2===!1&&(S.isInstancedMesh||K.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;_();const ie=K.attributes,G=ne.getAttributes(),se=B.defaultAttributeValues;for(const q in G){const U=G[q];if(U.location>=0){let le=ie[q];if(le===void 0&&(q==="instanceMatrix"&&S.instanceMatrix&&(le=S.instanceMatrix),q==="instanceColor"&&S.instanceColor&&(le=S.instanceColor)),le!==void 0){const ae=le.normalized,J=le.itemSize,te=t.get(le);if(te===void 0)continue;const me=te.buffer,de=te.type,be=te.bytesPerElement;if(le.isInterleavedBufferAttribute){const we=le.data,Ae=we.stride,V=le.offset;if(we.isInstancedInterleavedBuffer){for(let X=0;X<U.locationSize;X++)w(U.location+X,we.meshPerAttribute);S.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=we.meshPerAttribute*we.count)}else for(let X=0;X<U.locationSize;X++)x(U.location+X);i.bindBuffer(34962,me);for(let X=0;X<U.locationSize;X++)P(U.location+X,J/U.locationSize,de,ae,Ae*be,(V+J/U.locationSize*X)*be)}else{if(le.isInstancedBufferAttribute){for(let we=0;we<U.locationSize;we++)w(U.location+we,le.meshPerAttribute);S.isInstancedMesh!==!0&&K._maxInstanceCount===void 0&&(K._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let we=0;we<U.locationSize;we++)x(U.location+we);i.bindBuffer(34962,me);for(let we=0;we<U.locationSize;we++)P(U.location+we,J/U.locationSize,de,ae,J*be,J/U.locationSize*we*be)}}else if(se!==void 0){const ae=se[q];if(ae!==void 0)switch(ae.length){case 2:i.vertexAttrib2fv(U.location,ae);break;case 3:i.vertexAttrib3fv(U.location,ae);break;case 4:i.vertexAttrib4fv(U.location,ae);break;default:i.vertexAttrib1fv(U.location,ae)}}}}T()}h(M,"setupVertexAttributes");function R(){k();for(const S in a){const B=a[S];for(const ne in B){const K=B[ne];for(const ie in K)g(K[ie].object),delete K[ie];delete B[ne]}delete a[S]}}h(R,"dispose");function L(S){if(a[S.id]===void 0)return;const B=a[S.id];for(const ne in B){const K=B[ne];for(const ie in K)g(K[ie].object),delete K[ie];delete B[ne]}delete a[S.id]}h(L,"releaseStatesOfGeometry");function W(S){for(const B in a){const ne=a[B];if(ne[S.id]===void 0)continue;const K=ne[S.id];for(const ie in K)g(K[ie].object),delete K[ie];delete ne[S.id]}}h(W,"releaseStatesOfProgram");function k(){z(),u=!0,c!==l&&(c=l,p(c.object))}h(k,"reset");function z(){l.geometry=null,l.program=null,l.wireframe=!1}return h(z,"resetDefaultState"),{setup:d,reset:k,resetDefaultState:z,dispose:R,releaseStatesOfGeometry:L,releaseStatesOfProgram:W,initAttributes:_,enableAttribute:x,disableUnusedAttributes:T}}h($L,"WebGLBindingStates");function XL(i,e,t,n){const s=n.isWebGL2;let r;function o(c){r=c}h(o,"setMode");function a(c,u){i.drawArrays(r,c,u),t.update(u,r,1)}h(a,"render");function l(c,u,d){if(d===0)return;let f,p;if(s)f=i,p="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",f===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[p](r,c,u,d),t.update(u,r,d)}h(l,"renderInstances"),this.setMode=o,this.render=a,this.renderInstances=l}h(XL,"WebGLBufferRenderer");function YL(i,e,t){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const P=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}h(s,"getMaxAnisotropy");function r(P){if(P==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";P="mediump"}return P==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}h(r,"getMaxPrecision");const o=typeof WebGL2RenderingContext!="undefined"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&i instanceof WebGL2ComputeRenderingContext;let a=t.precision!==void 0?t.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,d=i.getParameter(34930),f=i.getParameter(35660),p=i.getParameter(3379),g=i.getParameter(34076),m=i.getParameter(34921),v=i.getParameter(36347),y=i.getParameter(36348),b=i.getParameter(36349),_=f>0,x=o||e.has("OES_texture_float"),w=_&&x,T=o?i.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:s,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:v,maxVaryings:y,maxFragmentUniforms:b,vertexTextures:_,floatFragmentTextures:x,floatVertexTextures:w,maxSamples:T}}h(YL,"WebGLCapabilities");function KL(i){const e=this;let t=null,n=0,s=!1,r=!1;const o=new dr,a=new ui,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f,p){const g=d.length!==0||f||n!==0||s;return s=f,t=u(d,p,0),n=d.length,g},this.beginShadows=function(){r=!0,u(null)},this.endShadows=function(){r=!1,c()},this.setState=function(d,f,p){const g=d.clippingPlanes,m=d.clipIntersection,v=d.clipShadows,y=i.get(d);if(!s||g===null||g.length===0||r&&!v)r?u(null):c();else{const b=r?0:n,_=b*4;let x=y.clippingState||null;l.value=x,x=u(g,f,_,p);for(let w=0;w!==_;++w)x[w]=t[w];y.clippingState=x,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}h(c,"resetGlobalState");function u(d,f,p,g){const m=d!==null?d.length:0;let v=null;if(m!==0){if(v=l.value,g!==!0||v===null){const y=p+m*4,b=f.matrixWorldInverse;a.getNormalMatrix(b),(v===null||v.length<y)&&(v=new Float32Array(y));for(let _=0,x=p;_!==m;++_,x+=4)o.copy(d[_]).applyMatrix4(b,a),o.normal.toArray(v,x),v[x+3]=o.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,v}h(u,"projectPlanes")}h(KL,"WebGLClipping");function qL(i){let e=new WeakMap;function t(o,a){return a===Rf?o.mapping=Ll:a===Bg&&(o.mapping=kl),o}h(t,"mapTextureMapping");function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===Rf||a===Bg)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new $M(l.height/2);return c.fromEquirectangularTexture(i,o),e.set(o,c),o.addEventListener("dispose",s),t(c.texture,o.mapping)}else return null}}return o}h(n,"get");function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}h(s,"onTextureDispose");function r(){e=new WeakMap}return h(r,"dispose"),{get:n,dispose:r}}h(qL,"WebGLCubeMaps");class yo extends yp{constructor(e=-1,t=1,n=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=n-e,o=n+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}h(yo,"OrthographicCamera");const gl=4,H_=[.125,.215,.35,.446,.526,.582],Jo=20,Sm=new yo,G_=new Te;let Cm=null;const Yo=(1+Math.sqrt(5))/2,Xa=1/Yo,W_=[new A(1,1,1),new A(-1,1,1),new A(1,1,-1),new A(-1,1,-1),new A(0,Yo,Xa),new A(0,Yo,-Xa),new A(Xa,0,Yo),new A(-Xa,0,Yo),new A(Yo,Xa,0),new A(-Yo,Xa,0)];class Gg{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){Cm=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,s,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=X_(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=$_(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Cm),e.scissorTest=!1,Yh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ll||e.mapping===kl?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Cm=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ai,minFilter:ai,generateMipmaps:!1,type:Ol,format:Bi,encoding:xr,depthBuffer:!1},s=j_(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=j_(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=ZL(r)),this._blurMaterial=QL(r,e,t)}return s}_compileMaterial(e){const t=new Re(this._lodPlanes[0],e);this._renderer.compile(t,Sm)}_sceneToCubeUV(e,t,n,s){const a=new Fn(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,f=u.toneMapping;u.getClearColor(G_),u.toneMapping=Vs,u.autoClear=!1;const p=new hi({name:"PMREM.Background",side:Ji,depthWrite:!1,depthTest:!1}),g=new Re(new sn,p);let m=!1;const v=e.background;v?v.isColor&&(p.color.copy(v),e.background=null,m=!0):(p.color.copy(G_),m=!0);for(let y=0;y<6;y++){const b=y%3;b===0?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):b===1?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const _=this._cubeSize;Yh(s,b*_,y>2?_:0,_,_),u.setRenderTarget(s),m&&u.render(g,a),u.render(e,a)}g.geometry.dispose(),g.material.dispose(),u.toneMapping=f,u.autoClear=d,e.background=v}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===Ll||e.mapping===kl;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=X_()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=$_());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new Re(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=e;const l=this._cubeSize;Yh(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,Sm)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=W_[(s-1)%W_.length];this._blur(e,s-1,s,r,o)}t.autoClear=n}_blur(e,t,n,s,r){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,s,"latitudinal",r),this._halfBlur(o,e,n,n,s,"longitudinal",r)}_halfBlur(e,t,n,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new Re(this._lodPlanes[s],c),f=c.uniforms,p=this._sizeLods[n]-1,g=isFinite(r)?Math.PI/(2*p):2*Math.PI/(2*Jo-1),m=r/g,v=isFinite(r)?1+Math.floor(u*m):Jo;v>Jo&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Jo}`);const y=[];let b=0;for(let P=0;P<Jo;++P){const M=P/m,R=Math.exp(-M*M/2);y.push(R),P===0?b+=R:P<v&&(b+=2*R)}for(let P=0;P<y.length;P++)y[P]=y[P]/b;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=y,f.latitudinal.value=o==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:_}=this;f.dTheta.value=g,f.mipInt.value=_-n;const x=this._sizeLods[s],w=3*x*(s>_-gl?s-_+gl:0),T=4*(this._cubeSize-x);Yh(t,w,T,3*x,2*x),l.setRenderTarget(t),l.render(d,Sm)}}h(Gg,"PMREMGenerator");function ZL(i){const e=[],t=[],n=[];let s=i;const r=i-gl+1+H_.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);t.push(a);let l=1/a;o>i-gl?l=H_[o-i+gl-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),u=-c,d=1+c,f=[u,u,d,u,d,d,u,u,d,d,u,d],p=6,g=6,m=3,v=2,y=1,b=new Float32Array(m*g*p),_=new Float32Array(v*g*p),x=new Float32Array(y*g*p);for(let T=0;T<p;T++){const P=T%3*2/3-1,M=T>2?0:-1,R=[P,M,0,P+2/3,M,0,P+2/3,M+1,0,P,M,0,P+2/3,M+1,0,P,M+1,0];b.set(R,m*g*T),_.set(f,v*g*T);const L=[T,T,T,T,T,T];x.set(L,y*g*T)}const w=new et;w.setAttribute("position",new Zt(b,m)),w.setAttribute("uv",new Zt(_,v)),w.setAttribute("faceIndex",new Zt(x,y)),e.push(w),s>gl&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}h(ZL,"_createPlanes");function j_(i,e,t){const n=new Hn(i,e,t);return n.texture.mapping=fp,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}h(j_,"_createRenderTarget");function Yh(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}h(Yh,"_setViewport");function QL(i,e,t){const n=new Float32Array(Jo),s=new A(0,1,0);return new Zn({name:"SphericalGaussianBlur",defines:{n:Jo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:G0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Us,depthTest:!1,depthWrite:!1})}h(QL,"_getBlurShader");function $_(){return new Zn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:G0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Us,depthTest:!1,depthWrite:!1})}h($_,"_getEquirectMaterial");function X_(){return new Zn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:G0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Us,depthTest:!1,depthWrite:!1})}h(X_,"_getCubemapMaterial");function G0(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}h(G0,"_getCommonVertexShader");function JL(i){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===Rf||l===Bg,u=l===Ll||l===kl;if(c||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let d=e.get(a);return t===null&&(t=new Gg(i)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}else{if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||u&&d&&s(d)){t===null&&(t=new Gg(i));const f=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",r),f.texture}else return null}}}return a}h(n,"get");function s(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}h(s,"isCubeTextureComplete");function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}h(r,"onTextureDispose");function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return h(o,"dispose"),{get:n,dispose:o}}h(JL,"WebGLCubeUVMaps");function ek(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return e[n]=s,s}return h(t,"getExtension"),{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const s=t(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}h(ek,"WebGLExtensions");function tk(i,e,t,n){const s={},r=new WeakMap;function o(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);f.removeEventListener("dispose",o),delete s[f.id];const p=r.get(f);p&&(e.remove(p),r.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}h(o,"onGeometryDispose");function a(d,f){return s[f.id]===!0||(f.addEventListener("dispose",o),s[f.id]=!0,t.memory.geometries++),f}h(a,"get");function l(d){const f=d.attributes;for(const g in f)e.update(f[g],34962);const p=d.morphAttributes;for(const g in p){const m=p[g];for(let v=0,y=m.length;v<y;v++)e.update(m[v],34962)}}h(l,"update");function c(d){const f=[],p=d.index,g=d.attributes.position;let m=0;if(p!==null){const b=p.array;m=p.version;for(let _=0,x=b.length;_<x;_+=3){const w=b[_+0],T=b[_+1],P=b[_+2];f.push(w,T,T,P,P,w)}}else{const b=g.array;m=g.version;for(let _=0,x=b.length/3-1;_<x;_+=3){const w=_+0,T=_+1,P=_+2;f.push(w,T,T,P,P,w)}}const v=new(HM(f)?V0:gp)(f,1);v.version=m;const y=r.get(d);y&&e.remove(y),r.set(d,v)}h(c,"updateWireframeAttribute");function u(d){const f=r.get(d);if(f){const p=d.index;p!==null&&f.version<p.version&&c(d)}else c(d);return r.get(d)}return h(u,"getWireframeAttribute"),{get:a,update:l,getWireframeAttribute:u}}h(tk,"WebGLGeometries");function nk(i,e,t,n){const s=n.isWebGL2;let r;function o(f){r=f}h(o,"setMode");let a,l;function c(f){a=f.type,l=f.bytesPerElement}h(c,"setIndex");function u(f,p){i.drawElements(r,p,a,f*l),t.update(p,r,1)}h(u,"render");function d(f,p,g){if(g===0)return;let m,v;if(s)m=i,v="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[v](r,p,a,f*l,g),t.update(p,r,g)}h(d,"renderInstances"),this.setMode=o,this.setIndex=c,this.render=u,this.renderInstances=d}h(nk,"WebGLIndexedBufferRenderer");function ik(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(r/3);break;case 1:t.lines+=a*(r/2);break;case 3:t.lines+=a*(r-1);break;case 2:t.lines+=a*r;break;case 0:t.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}h(n,"update");function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return h(s,"reset"),{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}h(ik,"WebGLInfo");function sk(i,e){return i[0]-e[0]}h(sk,"numericalSort");function rk(i,e){return Math.abs(e[1])-Math.abs(i[1])}h(rk,"absNumericalSort");function ok(i,e,t){const n={},s=new Float32Array(8),r=new WeakMap,o=new wt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,u,d,f){const p=c.morphTargetInfluences;if(e.isWebGL2===!0){const m=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,v=m!==void 0?m.length:0;let y=r.get(u);if(y===void 0||y.count!==v){let ne=function(){S.dispose(),r.delete(u),u.removeEventListener("dispose",ne)};var g=ne;h(ne,"disposeTexture"),y!==void 0&&y.texture.dispose();const x=u.morphAttributes.position!==void 0,w=u.morphAttributes.normal!==void 0,T=u.morphAttributes.color!==void 0,P=u.morphAttributes.position||[],M=u.morphAttributes.normal||[],R=u.morphAttributes.color||[];let L=0;x===!0&&(L=1),w===!0&&(L=2),T===!0&&(L=3);let W=u.attributes.position.count*L,k=1;W>e.maxTextureSize&&(k=Math.ceil(W/e.maxTextureSize),W=e.maxTextureSize);const z=new Float32Array(W*k*4*v),S=new U0(z,W,k,v);S.type=to,S.needsUpdate=!0;const B=L*4;for(let K=0;K<v;K++){const ie=P[K],G=M[K],se=R[K],q=W*k*4*K;for(let U=0;U<ie.count;U++){const le=U*B;x===!0&&(o.fromBufferAttribute(ie,U),z[q+le+0]=o.x,z[q+le+1]=o.y,z[q+le+2]=o.z,z[q+le+3]=0),w===!0&&(o.fromBufferAttribute(G,U),z[q+le+4]=o.x,z[q+le+5]=o.y,z[q+le+6]=o.z,z[q+le+7]=0),T===!0&&(o.fromBufferAttribute(se,U),z[q+le+8]=o.x,z[q+le+9]=o.y,z[q+le+10]=o.z,z[q+le+11]=se.itemSize===4?o.w:1)}}y={count:v,texture:S,size:new je(W,k)},r.set(u,y),u.addEventListener("dispose",ne)}let b=0;for(let x=0;x<p.length;x++)b+=p[x];const _=u.morphTargetsRelative?1:1-b;f.getUniforms().setValue(i,"morphTargetBaseInfluence",_),f.getUniforms().setValue(i,"morphTargetInfluences",p),f.getUniforms().setValue(i,"morphTargetsTexture",y.texture,t),f.getUniforms().setValue(i,"morphTargetsTextureSize",y.size)}else{const m=p===void 0?0:p.length;let v=n[u.id];if(v===void 0||v.length!==m){v=[];for(let w=0;w<m;w++)v[w]=[w,0];n[u.id]=v}for(let w=0;w<m;w++){const T=v[w];T[0]=w,T[1]=p[w]}v.sort(rk);for(let w=0;w<8;w++)w<m&&v[w][1]?(a[w][0]=v[w][0],a[w][1]=v[w][1]):(a[w][0]=Number.MAX_SAFE_INTEGER,a[w][1]=0);a.sort(sk);const y=u.morphAttributes.position,b=u.morphAttributes.normal;let _=0;for(let w=0;w<8;w++){const T=a[w],P=T[0],M=T[1];P!==Number.MAX_SAFE_INTEGER&&M?(y&&u.getAttribute("morphTarget"+w)!==y[P]&&u.setAttribute("morphTarget"+w,y[P]),b&&u.getAttribute("morphNormal"+w)!==b[P]&&u.setAttribute("morphNormal"+w,b[P]),s[w]=M,_+=M):(y&&u.hasAttribute("morphTarget"+w)===!0&&u.deleteAttribute("morphTarget"+w),b&&u.hasAttribute("morphNormal"+w)===!0&&u.deleteAttribute("morphNormal"+w),s[w]=0)}const x=u.morphTargetsRelative?1:1-_;f.getUniforms().setValue(i,"morphTargetBaseInfluence",x),f.getUniforms().setValue(i,"morphTargetInfluences",s)}}return h(l,"update"),{update:l}}h(ok,"WebGLMorphtargets");function ak(i,e,t,n){let s=new WeakMap;function r(l){const c=n.render.frame,u=l.geometry,d=e.get(l,u);return s.get(d)!==c&&(e.update(d),s.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),l.instanceColor!==null&&t.update(l.instanceColor,34962)),d}h(r,"update");function o(){s=new WeakMap}h(o,"dispose");function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return h(a,"onInstancedMeshDispose"),{update:r,dispose:o}}h(ak,"WebGLObjects");const YM=new Pn,KM=new U0,qM=new WM,ZM=new H0,Y_=[],K_=[],q_=new Float32Array(16),Z_=new Float32Array(9),Q_=new Float32Array(4);function ql(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let r=Y_[s];if(r===void 0&&(r=new Float32Array(s),Y_[s]=r),e!==0){n.toArray(r,0);for(let o=1,a=0;o!==e;++o)a+=t,i[o].toArray(r,a)}return r}h(ql,"flatten");function Rn(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}h(Rn,"arraysEqual");function In(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}h(In,"copyArray");function _p(i,e){let t=K_[e];t===void 0&&(t=new Int32Array(e),K_[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}h(_p,"allocTexUnits");function lk(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}h(lk,"setValueV1f");function ck(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rn(t,e))return;i.uniform2fv(this.addr,e),In(t,e)}}h(ck,"setValueV2f");function uk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Rn(t,e))return;i.uniform3fv(this.addr,e),In(t,e)}}h(uk,"setValueV3f");function hk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rn(t,e))return;i.uniform4fv(this.addr,e),In(t,e)}}h(hk,"setValueV4f");function dk(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Rn(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),In(t,e)}else{if(Rn(t,n))return;Q_.set(n),i.uniformMatrix2fv(this.addr,!1,Q_),In(t,n)}}h(dk,"setValueM2");function fk(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Rn(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),In(t,e)}else{if(Rn(t,n))return;Z_.set(n),i.uniformMatrix3fv(this.addr,!1,Z_),In(t,n)}}h(fk,"setValueM3");function pk(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(Rn(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),In(t,e)}else{if(Rn(t,n))return;q_.set(n),i.uniformMatrix4fv(this.addr,!1,q_),In(t,n)}}h(pk,"setValueM4");function mk(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}h(mk,"setValueV1i");function gk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rn(t,e))return;i.uniform2iv(this.addr,e),In(t,e)}}h(gk,"setValueV2i");function vk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Rn(t,e))return;i.uniform3iv(this.addr,e),In(t,e)}}h(vk,"setValueV3i");function yk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rn(t,e))return;i.uniform4iv(this.addr,e),In(t,e)}}h(yk,"setValueV4i");function _k(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}h(_k,"setValueV1ui");function bk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rn(t,e))return;i.uniform2uiv(this.addr,e),In(t,e)}}h(bk,"setValueV2ui");function wk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Rn(t,e))return;i.uniform3uiv(this.addr,e),In(t,e)}}h(wk,"setValueV3ui");function xk(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rn(t,e))return;i.uniform4uiv(this.addr,e),In(t,e)}}h(xk,"setValueV4ui");function Mk(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2D(e||YM,s)}h(Mk,"setValueT1");function Ak(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||qM,s)}h(Ak,"setValueT3D1");function Sk(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||ZM,s)}h(Sk,"setValueT6");function Ck(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||KM,s)}h(Ck,"setValueT2DArray1");function Tk(i){switch(i){case 5126:return lk;case 35664:return ck;case 35665:return uk;case 35666:return hk;case 35674:return dk;case 35675:return fk;case 35676:return pk;case 5124:case 35670:return mk;case 35667:case 35671:return gk;case 35668:case 35672:return vk;case 35669:case 35673:return yk;case 5125:return _k;case 36294:return bk;case 36295:return wk;case 36296:return xk;case 35678:case 36198:case 36298:case 36306:case 35682:return Mk;case 35679:case 36299:case 36307:return Ak;case 35680:case 36300:case 36308:case 36293:return Sk;case 36289:case 36303:case 36311:case 36292:return Ck}}h(Tk,"getSingularSetter");function Ek(i,e){i.uniform1fv(this.addr,e)}h(Ek,"setValueV1fArray");function Pk(i,e){const t=ql(e,this.size,2);i.uniform2fv(this.addr,t)}h(Pk,"setValueV2fArray");function Rk(i,e){const t=ql(e,this.size,3);i.uniform3fv(this.addr,t)}h(Rk,"setValueV3fArray");function Ik(i,e){const t=ql(e,this.size,4);i.uniform4fv(this.addr,t)}h(Ik,"setValueV4fArray");function Dk(i,e){const t=ql(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}h(Dk,"setValueM2Array");function Lk(i,e){const t=ql(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}h(Lk,"setValueM3Array");function kk(i,e){const t=ql(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}h(kk,"setValueM4Array");function Ok(i,e){i.uniform1iv(this.addr,e)}h(Ok,"setValueV1iArray");function Nk(i,e){i.uniform2iv(this.addr,e)}h(Nk,"setValueV2iArray");function Fk(i,e){i.uniform3iv(this.addr,e)}h(Fk,"setValueV3iArray");function zk(i,e){i.uniform4iv(this.addr,e)}h(zk,"setValueV4iArray");function Bk(i,e){i.uniform1uiv(this.addr,e)}h(Bk,"setValueV1uiArray");function Uk(i,e){i.uniform2uiv(this.addr,e)}h(Uk,"setValueV2uiArray");function Vk(i,e){i.uniform3uiv(this.addr,e)}h(Vk,"setValueV3uiArray");function Hk(i,e){i.uniform4uiv(this.addr,e)}h(Hk,"setValueV4uiArray");function Gk(i,e,t){const n=this.cache,s=e.length,r=_p(t,s);Rn(n,r)||(i.uniform1iv(this.addr,r),In(n,r));for(let o=0;o!==s;++o)t.setTexture2D(e[o]||YM,r[o])}h(Gk,"setValueT1Array");function Wk(i,e,t){const n=this.cache,s=e.length,r=_p(t,s);Rn(n,r)||(i.uniform1iv(this.addr,r),In(n,r));for(let o=0;o!==s;++o)t.setTexture3D(e[o]||qM,r[o])}h(Wk,"setValueT3DArray");function jk(i,e,t){const n=this.cache,s=e.length,r=_p(t,s);Rn(n,r)||(i.uniform1iv(this.addr,r),In(n,r));for(let o=0;o!==s;++o)t.setTextureCube(e[o]||ZM,r[o])}h(jk,"setValueT6Array");function $k(i,e,t){const n=this.cache,s=e.length,r=_p(t,s);Rn(n,r)||(i.uniform1iv(this.addr,r),In(n,r));for(let o=0;o!==s;++o)t.setTexture2DArray(e[o]||KM,r[o])}h($k,"setValueT2DArrayArray");function Xk(i){switch(i){case 5126:return Ek;case 35664:return Pk;case 35665:return Rk;case 35666:return Ik;case 35674:return Dk;case 35675:return Lk;case 35676:return kk;case 5124:case 35670:return Ok;case 35667:case 35671:return Nk;case 35668:case 35672:return Fk;case 35669:case 35673:return zk;case 5125:return Bk;case 36294:return Uk;case 36295:return Vk;case 36296:return Hk;case 35678:case 36198:case 36298:case 36306:case 35682:return Gk;case 35679:case 36299:case 36307:return Wk;case 35680:case 36300:case 36308:case 36293:return jk;case 36289:case 36303:case 36311:case 36292:return $k}}h(Xk,"getPureArraySetter");class QM{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=Tk(t.type)}}h(QM,"SingleUniform");class JM{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=Xk(t.type)}}h(JM,"PureArrayUniform");class eA{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(e,t[a.id],n)}}}h(eA,"StructuredUniform");const Tm=/(\w+)(\])?(\[|\.)?/g;function J_(i,e){i.seq.push(e),i.map[e.id]=e}h(J_,"addUniform");function Yk(i,e,t){const n=i.name,s=n.length;for(Tm.lastIndex=0;;){const r=Tm.exec(n),o=Tm.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){J_(t,c===void 0?new QM(a,i,e):new JM(a,i,e));break}else{let d=t.map[a];d===void 0&&(d=new eA(a),J_(t,d)),t=d}}}h(Yk,"parseUniform");class yu{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let s=0;s<n;++s){const r=e.getActiveUniform(t,s),o=e.getUniformLocation(t,r.name);Yk(r,o,this)}}setValue(e,t,n,s){const r=this.map[t];r!==void 0&&r.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let r=0,o=t.length;r!==o;++r){const a=t[r],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,r=e.length;s!==r;++s){const o=e[s];o.id in t&&n.push(o)}return n}}h(yu,"WebGLUniforms");function eb(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}h(eb,"WebGLShader");let Kk=0;function qk(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),r=Math.min(e+6,t.length);for(let o=s;o<r;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}h(qk,"handleSource");function Zk(i){switch(i){case xr:return["Linear","( value )"];case bt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}h(Zk,"getEncodingComponents");function tb(i,e,t){const n=i.getShaderParameter(e,35713),s=i.getShaderInfoLog(e).trim();if(n&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return t.toUpperCase()+`

`+s+`

`+qk(i.getShaderSource(e),o)}else return s}h(tb,"getShaderErrors");function Qk(i,e){const t=Zk(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}h(Qk,"getTexelEncodingFunction");function Jk(i,e){let t;switch(e){case dR:t="Linear";break;case fR:t="Reinhard";break;case pR:t="OptimizedCineon";break;case mR:t="ACESFilmic";break;case gR:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}h(Jk,"getToneMappingFunction");function eO(i){return[i.extensionDerivatives||!!i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ru).join(`
`)}h(eO,"generateExtensions");function tO(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}h(tO,"generateDefines");function nO(i,e){const t={},n=i.getProgramParameter(e,35721);for(let s=0;s<n;s++){const r=i.getActiveAttrib(e,s),o=r.name;let a=1;r.type===35674&&(a=2),r.type===35675&&(a=3),r.type===35676&&(a=4),t[o]={type:r.type,location:i.getAttribLocation(e,o),locationSize:a}}return t}h(nO,"fetchAttributeLocations");function ru(i){return i!==""}h(ru,"filterEmptyLine");function nb(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}h(nb,"replaceLightNums");function ib(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}h(ib,"replaceClippingPlaneNums");const iO=/^[ \t]*#include +<([\w\d./]+)>/gm;function Wg(i){return i.replace(iO,sO)}h(Wg,"resolveIncludes");function sO(i,e){const t=ht[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Wg(t)}h(sO,"includeReplacer");const rO=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sb(i){return i.replace(rO,oO)}h(sb,"unrollLoops");function oO(i,e,t,n){let s="";for(let r=parseInt(e);r<parseInt(t);r++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}h(oO,"loopReplacer");function rb(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}h(rb,"generatePrecision");function aO(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===LM?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===kM?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===su&&(e="SHADOWMAP_TYPE_VSM"),e}h(aO,"generateShadowMapTypeDefine");function lO(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case Ll:case kl:e="ENVMAP_TYPE_CUBE";break;case fp:e="ENVMAP_TYPE_CUBE_UV";break}return e}h(lO,"generateEnvMapTypeDefine");function cO(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case kl:e="ENVMAP_MODE_REFRACTION";break}return e}h(cO,"generateEnvMapModeDefine");function uO(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case dp:e="ENVMAP_BLENDING_MULTIPLY";break;case uR:e="ENVMAP_BLENDING_MIX";break;case hR:e="ENVMAP_BLENDING_ADD";break}return e}h(uO,"generateEnvMapBlendingDefine");function hO(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}h(hO,"generateCubeUVSize");function dO(i,e,t,n){const s=i.getContext(),r=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=aO(t),c=lO(t),u=cO(t),d=uO(t),f=hO(t),p=t.isWebGL2?"":eO(t),g=tO(r),m=s.createProgram();let v,y,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=[g].filter(ru).join(`
`),v.length>0&&(v+=`
`),y=[p,g].filter(ru).join(`
`),y.length>0&&(y+=`
`)):(v=[rb(t),"#define SHADER_NAME "+t.shaderName,g,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ru).join(`
`),y=[p,rb(t),"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Vs?"#define TONE_MAPPING":"",t.toneMapping!==Vs?ht.tonemapping_pars_fragment:"",t.toneMapping!==Vs?Jk("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ht.encodings_pars_fragment,Qk("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ru).join(`
`)),o=Wg(o),o=nb(o,t),o=ib(o,t),a=Wg(a),a=nb(a,t),a=ib(a,t),o=sb(o),a=sb(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===R_?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===R_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const _=b+v+o,x=b+y+a,w=eb(s,35633,_),T=eb(s,35632,x);if(s.attachShader(m,w),s.attachShader(m,T),t.index0AttributeName!==void 0?s.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),i.debug.checkShaderErrors){const R=s.getProgramInfoLog(m).trim(),L=s.getShaderInfoLog(w).trim(),W=s.getShaderInfoLog(T).trim();let k=!0,z=!0;if(s.getProgramParameter(m,35714)===!1){k=!1;const S=tb(s,w,"vertex"),B=tb(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+`

Program Info Log: `+R+`
`+S+`
`+B)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(L===""||W==="")&&(z=!1);z&&(this.diagnostics={runnable:k,programLog:R,vertexShader:{log:L,prefix:v},fragmentShader:{log:W,prefix:y}})}s.deleteShader(w),s.deleteShader(T);let P;this.getUniforms=function(){return P===void 0&&(P=new yu(s,m)),P};let M;return this.getAttributes=function(){return M===void 0&&(M=nO(s,m)),M},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=Kk++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=w,this.fragmentShader=T,this}h(dO,"WebGLProgram");let fO=0;class tA{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new nA(e),t.set(e,n)),n}}h(tA,"WebGLShaderCache");class nA{constructor(e){this.id=fO++,this.code=e,this.usedTimes=0}}h(nA,"WebGLShaderStage");function pO(i,e,t,n,s,r,o){const a=new mp,l=new tA,c=[],u=s.isWebGL2,d=s.logarithmicDepthBuffer,f=s.vertexTextures;let p=s.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(M,R,L,W,k){const z=W.fog,S=k.geometry,B=M.isMeshStandardMaterial?W.environment:null,ne=(M.isMeshStandardMaterial?t:e).get(M.envMap||B),K=!!ne&&ne.mapping===fp?ne.image.height:null,ie=g[M.type];M.precision!==null&&(p=s.getMaxPrecision(M.precision),p!==M.precision&&console.warn("THREE.WebGLProgram.getParameters:",M.precision,"not supported, using",p,"instead."));const G=S.morphAttributes.position||S.morphAttributes.normal||S.morphAttributes.color,se=G!==void 0?G.length:0;let q=0;S.morphAttributes.position!==void 0&&(q=1),S.morphAttributes.normal!==void 0&&(q=2),S.morphAttributes.color!==void 0&&(q=3);let U,le,ae,J;if(ie){const Ae=Is[ie];U=Ae.vertexShader,le=Ae.fragmentShader}else U=M.vertexShader,le=M.fragmentShader,l.update(M),ae=l.getVertexShaderID(M),J=l.getFragmentShaderID(M);const te=i.getRenderTarget(),me=M.alphaTest>0,de=M.clearcoat>0,be=M.iridescence>0;return{isWebGL2:u,shaderID:ie,shaderName:M.type,vertexShader:U,fragmentShader:le,defines:M.defines,customVertexShaderID:ae,customFragmentShaderID:J,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:p,instancing:k.isInstancedMesh===!0,instancingColor:k.isInstancedMesh===!0&&k.instanceColor!==null,supportsVertexTextures:f,outputEncoding:te===null?i.outputEncoding:te.isXRRenderTarget===!0?te.texture.encoding:xr,map:!!M.map,matcap:!!M.matcap,envMap:!!ne,envMapMode:ne&&ne.mapping,envMapCubeUVHeight:K,lightMap:!!M.lightMap,aoMap:!!M.aoMap,emissiveMap:!!M.emissiveMap,bumpMap:!!M.bumpMap,normalMap:!!M.normalMap,objectSpaceNormalMap:M.normalMapType===OR,tangentSpaceNormalMap:M.normalMapType===ih,decodeVideoTexture:!!M.map&&M.map.isVideoTexture===!0&&M.map.encoding===bt,clearcoat:de,clearcoatMap:de&&!!M.clearcoatMap,clearcoatRoughnessMap:de&&!!M.clearcoatRoughnessMap,clearcoatNormalMap:de&&!!M.clearcoatNormalMap,iridescence:be,iridescenceMap:be&&!!M.iridescenceMap,iridescenceThicknessMap:be&&!!M.iridescenceThicknessMap,displacementMap:!!M.displacementMap,roughnessMap:!!M.roughnessMap,metalnessMap:!!M.metalnessMap,specularMap:!!M.specularMap,specularIntensityMap:!!M.specularIntensityMap,specularColorMap:!!M.specularColorMap,opaque:M.transparent===!1&&M.blending===Cl,alphaMap:!!M.alphaMap,alphaTest:me,gradientMap:!!M.gradientMap,sheen:M.sheen>0,sheenColorMap:!!M.sheenColorMap,sheenRoughnessMap:!!M.sheenRoughnessMap,transmission:M.transmission>0,transmissionMap:!!M.transmissionMap,thicknessMap:!!M.thicknessMap,combine:M.combine,vertexTangents:!!M.normalMap&&!!S.attributes.tangent,vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!S.attributes.color&&S.attributes.color.itemSize===4,vertexUvs:!!M.map||!!M.bumpMap||!!M.normalMap||!!M.specularMap||!!M.alphaMap||!!M.emissiveMap||!!M.roughnessMap||!!M.metalnessMap||!!M.clearcoatMap||!!M.clearcoatRoughnessMap||!!M.clearcoatNormalMap||!!M.iridescenceMap||!!M.iridescenceThicknessMap||!!M.displacementMap||!!M.transmissionMap||!!M.thicknessMap||!!M.specularIntensityMap||!!M.specularColorMap||!!M.sheenColorMap||!!M.sheenRoughnessMap,uvsVertexOnly:!(!!M.map||!!M.bumpMap||!!M.normalMap||!!M.specularMap||!!M.alphaMap||!!M.emissiveMap||!!M.roughnessMap||!!M.metalnessMap||!!M.clearcoatNormalMap||!!M.iridescenceMap||!!M.iridescenceThicknessMap||M.transmission>0||!!M.transmissionMap||!!M.thicknessMap||!!M.specularIntensityMap||!!M.specularColorMap||M.sheen>0||!!M.sheenColorMap||!!M.sheenRoughnessMap)&&!!M.displacementMap,fog:!!z,useFog:M.fog===!0,fogExp2:z&&z.isFogExp2,flatShading:!!M.flatShading,sizeAttenuation:M.sizeAttenuation,logarithmicDepthBuffer:d,skinning:k.isSkinnedMesh===!0,morphTargets:S.morphAttributes.position!==void 0,morphNormals:S.morphAttributes.normal!==void 0,morphColors:S.morphAttributes.color!==void 0,morphTargetsCount:se,morphTextureStride:q,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:i.shadowMap.enabled&&L.length>0,shadowMapType:i.shadowMap.type,toneMapping:M.toneMapped?i.toneMapping:Vs,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===Ci,flipSided:M.side===Ji,useDepthPacking:!!M.depthPacking,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionDerivatives:M.extensions&&M.extensions.derivatives,extensionFragDepth:M.extensions&&M.extensions.fragDepth,extensionDrawBuffers:M.extensions&&M.extensions.drawBuffers,extensionShaderTextureLOD:M.extensions&&M.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:M.customProgramCacheKey()}}h(m,"getParameters");function v(M){const R=[];if(M.shaderID?R.push(M.shaderID):(R.push(M.customVertexShaderID),R.push(M.customFragmentShaderID)),M.defines!==void 0)for(const L in M.defines)R.push(L),R.push(M.defines[L]);return M.isRawShaderMaterial===!1&&(y(R,M),b(R,M),R.push(i.outputEncoding)),R.push(M.customProgramCacheKey),R.join()}h(v,"getProgramCacheKey");function y(M,R){M.push(R.precision),M.push(R.outputEncoding),M.push(R.envMapMode),M.push(R.envMapCubeUVHeight),M.push(R.combine),M.push(R.vertexUvs),M.push(R.fogExp2),M.push(R.sizeAttenuation),M.push(R.morphTargetsCount),M.push(R.morphAttributeCount),M.push(R.numDirLights),M.push(R.numPointLights),M.push(R.numSpotLights),M.push(R.numSpotLightMaps),M.push(R.numHemiLights),M.push(R.numRectAreaLights),M.push(R.numDirLightShadows),M.push(R.numPointLightShadows),M.push(R.numSpotLightShadows),M.push(R.numSpotLightShadowsWithMaps),M.push(R.shadowMapType),M.push(R.toneMapping),M.push(R.numClippingPlanes),M.push(R.numClipIntersection),M.push(R.depthPacking)}h(y,"getProgramCacheKeyParameters");function b(M,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.map&&a.enable(4),R.matcap&&a.enable(5),R.envMap&&a.enable(6),R.lightMap&&a.enable(7),R.aoMap&&a.enable(8),R.emissiveMap&&a.enable(9),R.bumpMap&&a.enable(10),R.normalMap&&a.enable(11),R.objectSpaceNormalMap&&a.enable(12),R.tangentSpaceNormalMap&&a.enable(13),R.clearcoat&&a.enable(14),R.clearcoatMap&&a.enable(15),R.clearcoatRoughnessMap&&a.enable(16),R.clearcoatNormalMap&&a.enable(17),R.iridescence&&a.enable(18),R.iridescenceMap&&a.enable(19),R.iridescenceThicknessMap&&a.enable(20),R.displacementMap&&a.enable(21),R.specularMap&&a.enable(22),R.roughnessMap&&a.enable(23),R.metalnessMap&&a.enable(24),R.gradientMap&&a.enable(25),R.alphaMap&&a.enable(26),R.alphaTest&&a.enable(27),R.vertexColors&&a.enable(28),R.vertexAlphas&&a.enable(29),R.vertexUvs&&a.enable(30),R.vertexTangents&&a.enable(31),R.uvsVertexOnly&&a.enable(32),M.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.physicallyCorrectLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.specularIntensityMap&&a.enable(15),R.specularColorMap&&a.enable(16),R.transmission&&a.enable(17),R.transmissionMap&&a.enable(18),R.thicknessMap&&a.enable(19),R.sheen&&a.enable(20),R.sheenColorMap&&a.enable(21),R.sheenRoughnessMap&&a.enable(22),R.decodeVideoTexture&&a.enable(23),R.opaque&&a.enable(24),M.push(a.mask)}h(b,"getProgramCacheKeyBooleans");function _(M){const R=g[M.type];let L;if(R){const W=Is[R];L=vp.clone(W.uniforms)}else L=M.uniforms;return L}h(_,"getUniforms");function x(M,R){let L;for(let W=0,k=c.length;W<k;W++){const z=c[W];if(z.cacheKey===R){L=z,++L.usedTimes;break}}return L===void 0&&(L=new dO(i,R,M,r),c.push(L)),L}h(x,"acquireProgram");function w(M){if(--M.usedTimes===0){const R=c.indexOf(M);c[R]=c[c.length-1],c.pop(),M.destroy()}}h(w,"releaseProgram");function T(M){l.remove(M)}h(T,"releaseShaderCache");function P(){l.dispose()}return h(P,"dispose"),{getParameters:m,getProgramCacheKey:v,getUniforms:_,acquireProgram:x,releaseProgram:w,releaseShaderCache:T,programs:c,dispose:P}}h(pO,"WebGLPrograms");function mO(){let i=new WeakMap;function e(r){let o=i.get(r);return o===void 0&&(o={},i.set(r,o)),o}h(e,"get");function t(r){i.delete(r)}h(t,"remove");function n(r,o,a){i.get(r)[o]=a}h(n,"update");function s(){i=new WeakMap}return h(s,"dispose"),{get:e,remove:t,update:n,dispose:s}}h(mO,"WebGLProperties");function gO(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}h(gO,"painterSortStable");function ob(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}h(ob,"reversePainterSortStable");function ab(){const i=[];let e=0;const t=[],n=[],s=[];function r(){e=0,t.length=0,n.length=0,s.length=0}h(r,"init");function o(d,f,p,g,m,v){let y=i[e];return y===void 0?(y={id:d.id,object:d,geometry:f,material:p,groupOrder:g,renderOrder:d.renderOrder,z:m,group:v},i[e]=y):(y.id=d.id,y.object=d,y.geometry=f,y.material=p,y.groupOrder=g,y.renderOrder=d.renderOrder,y.z=m,y.group=v),e++,y}h(o,"getNextRenderItem");function a(d,f,p,g,m,v){const y=o(d,f,p,g,m,v);p.transmission>0?n.push(y):p.transparent===!0?s.push(y):t.push(y)}h(a,"push");function l(d,f,p,g,m,v){const y=o(d,f,p,g,m,v);p.transmission>0?n.unshift(y):p.transparent===!0?s.unshift(y):t.unshift(y)}h(l,"unshift");function c(d,f){t.length>1&&t.sort(d||gO),n.length>1&&n.sort(f||ob),s.length>1&&s.sort(f||ob)}h(c,"sort");function u(){for(let d=e,f=i.length;d<f;d++){const p=i[d];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return h(u,"finish"),{opaque:t,transmissive:n,transparent:s,init:r,push:a,unshift:l,finish:u,sort:c}}h(ab,"WebGLRenderList");function vO(){let i=new WeakMap;function e(n,s){const r=i.get(n);let o;return r===void 0?(o=new ab,i.set(n,[o])):s>=r.length?(o=new ab,r.push(o)):o=r[s],o}h(e,"get");function t(){i=new WeakMap}return h(t,"dispose"),{get:e,dispose:t}}h(vO,"WebGLRenderLists");function yO(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new A,color:new Te};break;case"SpotLight":t={position:new A,direction:new A,color:new Te,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new A,color:new Te,distance:0,decay:0};break;case"HemisphereLight":t={direction:new A,skyColor:new Te,groundColor:new Te};break;case"RectAreaLight":t={color:new Te,position:new A,halfWidth:new A,halfHeight:new A};break}return i[e.id]=t,t}}}h(yO,"UniformsCache");function _O(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new je,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}h(_O,"ShadowUniformsCache");let bO=0;function wO(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}h(wO,"shadowCastingAndTexturingLightsFirst");function xO(i,e){const t=new yO,n=_O(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)s.probe.push(new A);const r=new A,o=new ve,a=new ve;function l(u,d){let f=0,p=0,g=0;for(let W=0;W<9;W++)s.probe[W].set(0,0,0);let m=0,v=0,y=0,b=0,_=0,x=0,w=0,T=0,P=0,M=0;u.sort(wO);const R=d!==!0?Math.PI:1;for(let W=0,k=u.length;W<k;W++){const z=u[W],S=z.color,B=z.intensity,ne=z.distance,K=z.shadow&&z.shadow.map?z.shadow.map.texture:null;if(z.isAmbientLight)f+=S.r*B*R,p+=S.g*B*R,g+=S.b*B*R;else if(z.isLightProbe)for(let ie=0;ie<9;ie++)s.probe[ie].addScaledVector(z.sh.coefficients[ie],B);else if(z.isDirectionalLight){const ie=t.get(z);if(ie.color.copy(z.color).multiplyScalar(z.intensity*R),z.castShadow){const G=z.shadow,se=n.get(z);se.shadowBias=G.bias,se.shadowNormalBias=G.normalBias,se.shadowRadius=G.radius,se.shadowMapSize=G.mapSize,s.directionalShadow[m]=se,s.directionalShadowMap[m]=K,s.directionalShadowMatrix[m]=z.shadow.matrix,x++}s.directional[m]=ie,m++}else if(z.isSpotLight){const ie=t.get(z);ie.position.setFromMatrixPosition(z.matrixWorld),ie.color.copy(S).multiplyScalar(B*R),ie.distance=ne,ie.coneCos=Math.cos(z.angle),ie.penumbraCos=Math.cos(z.angle*(1-z.penumbra)),ie.decay=z.decay,s.spot[y]=ie;const G=z.shadow;if(z.map&&(s.spotLightMap[P]=z.map,P++,G.updateMatrices(z),z.castShadow&&M++),s.spotLightMatrix[y]=G.matrix,z.castShadow){const se=n.get(z);se.shadowBias=G.bias,se.shadowNormalBias=G.normalBias,se.shadowRadius=G.radius,se.shadowMapSize=G.mapSize,s.spotShadow[y]=se,s.spotShadowMap[y]=K,T++}y++}else if(z.isRectAreaLight){const ie=t.get(z);ie.color.copy(S).multiplyScalar(B),ie.halfWidth.set(z.width*.5,0,0),ie.halfHeight.set(0,z.height*.5,0),s.rectArea[b]=ie,b++}else if(z.isPointLight){const ie=t.get(z);if(ie.color.copy(z.color).multiplyScalar(z.intensity*R),ie.distance=z.distance,ie.decay=z.decay,z.castShadow){const G=z.shadow,se=n.get(z);se.shadowBias=G.bias,se.shadowNormalBias=G.normalBias,se.shadowRadius=G.radius,se.shadowMapSize=G.mapSize,se.shadowCameraNear=G.camera.near,se.shadowCameraFar=G.camera.far,s.pointShadow[v]=se,s.pointShadowMap[v]=K,s.pointShadowMatrix[v]=z.shadow.matrix,w++}s.point[v]=ie,v++}else if(z.isHemisphereLight){const ie=t.get(z);ie.skyColor.copy(z.color).multiplyScalar(B*R),ie.groundColor.copy(z.groundColor).multiplyScalar(B*R),s.hemi[_]=ie,_++}}b>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=De.LTC_FLOAT_1,s.rectAreaLTC2=De.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=De.LTC_HALF_1,s.rectAreaLTC2=De.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=f,s.ambient[1]=p,s.ambient[2]=g;const L=s.hash;(L.directionalLength!==m||L.pointLength!==v||L.spotLength!==y||L.rectAreaLength!==b||L.hemiLength!==_||L.numDirectionalShadows!==x||L.numPointShadows!==w||L.numSpotShadows!==T||L.numSpotMaps!==P)&&(s.directional.length=m,s.spot.length=y,s.rectArea.length=b,s.point.length=v,s.hemi.length=_,s.directionalShadow.length=x,s.directionalShadowMap.length=x,s.pointShadow.length=w,s.pointShadowMap.length=w,s.spotShadow.length=T,s.spotShadowMap.length=T,s.directionalShadowMatrix.length=x,s.pointShadowMatrix.length=w,s.spotLightMatrix.length=T+P-M,s.spotLightMap.length=P,s.numSpotLightShadowsWithMaps=M,L.directionalLength=m,L.pointLength=v,L.spotLength=y,L.rectAreaLength=b,L.hemiLength=_,L.numDirectionalShadows=x,L.numPointShadows=w,L.numSpotShadows=T,L.numSpotMaps=P,s.version=bO++)}h(l,"setup");function c(u,d){let f=0,p=0,g=0,m=0,v=0;const y=d.matrixWorldInverse;for(let b=0,_=u.length;b<_;b++){const x=u[b];if(x.isDirectionalLight){const w=s.directional[f];w.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),f++}else if(x.isSpotLight){const w=s.spot[g];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),w.direction.setFromMatrixPosition(x.matrixWorld),r.setFromMatrixPosition(x.target.matrixWorld),w.direction.sub(r),w.direction.transformDirection(y),g++}else if(x.isRectAreaLight){const w=s.rectArea[m];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),a.identity(),o.copy(x.matrixWorld),o.premultiply(y),a.extractRotation(o),w.halfWidth.set(x.width*.5,0,0),w.halfHeight.set(0,x.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),m++}else if(x.isPointLight){const w=s.point[p];w.position.setFromMatrixPosition(x.matrixWorld),w.position.applyMatrix4(y),p++}else if(x.isHemisphereLight){const w=s.hemi[v];w.direction.setFromMatrixPosition(x.matrixWorld),w.direction.transformDirection(y),v++}}}return h(c,"setupView"),{setup:l,setupView:c,state:s}}h(xO,"WebGLLights");function lb(i,e){const t=new xO(i,e),n=[],s=[];function r(){n.length=0,s.length=0}h(r,"init");function o(d){n.push(d)}h(o,"pushLight");function a(d){s.push(d)}h(a,"pushShadow");function l(d){t.setup(n,d)}h(l,"setupLights");function c(d){t.setupView(n,d)}return h(c,"setupLightsView"),{init:r,state:{lightsArray:n,shadowsArray:s,lights:t},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}h(lb,"WebGLRenderState");function MO(i,e){let t=new WeakMap;function n(r,o=0){const a=t.get(r);let l;return a===void 0?(l=new lb(i,e),t.set(r,[l])):o>=a.length?(l=new lb(i,e),a.push(l)):l=a[o],l}h(n,"get");function s(){t=new WeakMap}return h(s,"dispose"),{get:n,dispose:s}}h(MO,"WebGLRenderStates");class W0 extends gi{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=kR,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}h(W0,"MeshDepthMaterial");class iA extends gi{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new A,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}h(iA,"MeshDistanceMaterial");const AO=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,SO=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function CO(i,e,t){let n=new sh;const s=new je,r=new je,o=new wt,a=new W0({depthPacking:UM}),l=new iA,c={},u=t.maxTextureSize,d={0:Ji,1:ha,2:Ci},f=new Zn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new je},radius:{value:4}},vertexShader:AO,fragmentShader:SO}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const g=new et;g.setAttribute("position",new Zt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Re(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=LM,this.render=function(x,w,T){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||x.length===0)return;const P=i.getRenderTarget(),M=i.getActiveCubeFace(),R=i.getActiveMipmapLevel(),L=i.state;L.setBlending(Us),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);for(let W=0,k=x.length;W<k;W++){const z=x[W],S=z.shadow;if(S===void 0){console.warn("THREE.WebGLShadowMap:",z,"has no shadow.");continue}if(S.autoUpdate===!1&&S.needsUpdate===!1)continue;s.copy(S.mapSize);const B=S.getFrameExtents();if(s.multiply(B),r.copy(S.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(r.x=Math.floor(u/B.x),s.x=r.x*B.x,S.mapSize.x=r.x),s.y>u&&(r.y=Math.floor(u/B.y),s.y=r.y*B.y,S.mapSize.y=r.y)),S.map===null){const K=this.type!==su?{minFilter:Cn,magFilter:Cn}:{};S.map=new Hn(s.x,s.y,K),S.map.texture.name=z.name+".shadowMap",S.camera.updateProjectionMatrix()}i.setRenderTarget(S.map),i.clear();const ne=S.getViewportCount();for(let K=0;K<ne;K++){const ie=S.getViewport(K);o.set(r.x*ie.x,r.y*ie.y,r.x*ie.z,r.y*ie.w),L.viewport(o),S.updateMatrices(z,K),n=S.getFrustum(),_(w,T,S.camera,z,this.type)}S.isPointLightShadow!==!0&&this.type===su&&y(S,T),S.needsUpdate=!1}v.needsUpdate=!1,i.setRenderTarget(P,M,R)};function y(x,w){const T=e.update(m);f.defines.VSM_SAMPLES!==x.blurSamples&&(f.defines.VSM_SAMPLES=x.blurSamples,p.defines.VSM_SAMPLES=x.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),x.mapPass===null&&(x.mapPass=new Hn(s.x,s.y)),f.uniforms.shadow_pass.value=x.map.texture,f.uniforms.resolution.value=x.mapSize,f.uniforms.radius.value=x.radius,i.setRenderTarget(x.mapPass),i.clear(),i.renderBufferDirect(w,null,T,f,m,null),p.uniforms.shadow_pass.value=x.mapPass.texture,p.uniforms.resolution.value=x.mapSize,p.uniforms.radius.value=x.radius,i.setRenderTarget(x.map),i.clear(),i.renderBufferDirect(w,null,T,p,m,null)}h(y,"VSMPass");function b(x,w,T,P,M,R){let L=null;const W=T.isPointLight===!0?x.customDistanceMaterial:x.customDepthMaterial;if(W!==void 0?L=W:L=T.isPointLight===!0?l:a,i.localClippingEnabled&&w.clipShadows===!0&&Array.isArray(w.clippingPlanes)&&w.clippingPlanes.length!==0||w.displacementMap&&w.displacementScale!==0||w.alphaMap&&w.alphaTest>0){const k=L.uuid,z=w.uuid;let S=c[k];S===void 0&&(S={},c[k]=S);let B=S[z];B===void 0&&(B=L.clone(),S[z]=B),L=B}return L.visible=w.visible,L.wireframe=w.wireframe,R===su?L.side=w.shadowSide!==null?w.shadowSide:w.side:L.side=w.shadowSide!==null?w.shadowSide:d[w.side],L.alphaMap=w.alphaMap,L.alphaTest=w.alphaTest,L.clipShadows=w.clipShadows,L.clippingPlanes=w.clippingPlanes,L.clipIntersection=w.clipIntersection,L.displacementMap=w.displacementMap,L.displacementScale=w.displacementScale,L.displacementBias=w.displacementBias,L.wireframeLinewidth=w.wireframeLinewidth,L.linewidth=w.linewidth,T.isPointLight===!0&&L.isMeshDistanceMaterial===!0&&(L.referencePosition.setFromMatrixPosition(T.matrixWorld),L.nearDistance=P,L.farDistance=M),L}h(b,"getDepthMaterial");function _(x,w,T,P,M){if(x.visible===!1)return;if(x.layers.test(w.layers)&&(x.isMesh||x.isLine||x.isPoints)&&(x.castShadow||x.receiveShadow&&M===su)&&(!x.frustumCulled||n.intersectsObject(x))){x.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,x.matrixWorld);const W=e.update(x),k=x.material;if(Array.isArray(k)){const z=W.groups;for(let S=0,B=z.length;S<B;S++){const ne=z[S],K=k[ne.materialIndex];if(K&&K.visible){const ie=b(x,K,P,T.near,T.far,M);i.renderBufferDirect(T,null,W,ie,x,ne)}}}else if(k.visible){const z=b(x,k,P,T.near,T.far,M);i.renderBufferDirect(T,null,W,z,x,null)}}const L=x.children;for(let W=0,k=L.length;W<k;W++)_(L[W],w,T,P,M)}h(_,"renderObject")}h(CO,"WebGLShadowMap");function TO(i,e,t){const n=t.isWebGL2;function s(){let oe=!1;const ye=new wt;let Ee=null;const Le=new wt(0,0,0,0);return{setMask:function(Ve){Ee!==Ve&&!oe&&(i.colorMask(Ve,Ve,Ve,Ve),Ee=Ve)},setLocked:function(Ve){oe=Ve},setClear:function(Ve,Ct,Dn,Xn,Mo){Mo===!0&&(Ve*=Xn,Ct*=Xn,Dn*=Xn),ye.set(Ve,Ct,Dn,Xn),Le.equals(ye)===!1&&(i.clearColor(Ve,Ct,Dn,Xn),Le.copy(ye))},reset:function(){oe=!1,Ee=null,Le.set(-1,0,0,0)}}}h(s,"ColorBuffer");function r(){let oe=!1,ye=null,Ee=null,Le=null;return{setTest:function(Ve){Ve?me(2929):de(2929)},setMask:function(Ve){ye!==Ve&&!oe&&(i.depthMask(Ve),ye=Ve)},setFunc:function(Ve){if(Ee!==Ve){switch(Ve){case iR:i.depthFunc(512);break;case sR:i.depthFunc(519);break;case rR:i.depthFunc(513);break;case zg:i.depthFunc(515);break;case oR:i.depthFunc(514);break;case aR:i.depthFunc(518);break;case lR:i.depthFunc(516);break;case cR:i.depthFunc(517);break;default:i.depthFunc(515)}Ee=Ve}},setLocked:function(Ve){oe=Ve},setClear:function(Ve){Le!==Ve&&(i.clearDepth(Ve),Le=Ve)},reset:function(){oe=!1,ye=null,Ee=null,Le=null}}}h(r,"DepthBuffer");function o(){let oe=!1,ye=null,Ee=null,Le=null,Ve=null,Ct=null,Dn=null,Xn=null,Mo=null;return{setTest:function(jt){oe||(jt?me(2960):de(2960))},setMask:function(jt){ye!==jt&&!oe&&(i.stencilMask(jt),ye=jt)},setFunc:function(jt,$s,Gi){(Ee!==jt||Le!==$s||Ve!==Gi)&&(i.stencilFunc(jt,$s,Gi),Ee=jt,Le=$s,Ve=Gi)},setOp:function(jt,$s,Gi){(Ct!==jt||Dn!==$s||Xn!==Gi)&&(i.stencilOp(jt,$s,Gi),Ct=jt,Dn=$s,Xn=Gi)},setLocked:function(jt){oe=jt},setClear:function(jt){Mo!==jt&&(i.clearStencil(jt),Mo=jt)},reset:function(){oe=!1,ye=null,Ee=null,Le=null,Ve=null,Ct=null,Dn=null,Xn=null,Mo=null}}}h(o,"StencilBuffer");const a=new s,l=new r,c=new o,u=new WeakMap,d=new WeakMap;let f={},p={},g=new WeakMap,m=[],v=null,y=!1,b=null,_=null,x=null,w=null,T=null,P=null,M=null,R=!1,L=null,W=null,k=null,z=null,S=null;const B=i.getParameter(35661);let ne=!1,K=0;const ie=i.getParameter(7938);ie.indexOf("WebGL")!==-1?(K=parseFloat(/^WebGL (\d)/.exec(ie)[1]),ne=K>=1):ie.indexOf("OpenGL ES")!==-1&&(K=parseFloat(/^OpenGL ES (\d)/.exec(ie)[1]),ne=K>=2);let G=null,se={};const q=i.getParameter(3088),U=i.getParameter(2978),le=new wt().fromArray(q),ae=new wt().fromArray(U);function J(oe,ye,Ee){const Le=new Uint8Array(4),Ve=i.createTexture();i.bindTexture(oe,Ve),i.texParameteri(oe,10241,9728),i.texParameteri(oe,10240,9728);for(let Ct=0;Ct<Ee;Ct++)i.texImage2D(ye+Ct,0,6408,1,1,0,6408,5121,Le);return Ve}h(J,"createTexture");const te={};te[3553]=J(3553,3553,1),te[34067]=J(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),me(2929),l.setFunc(zg),Q(!1),F(t_),me(2884),E(Us);function me(oe){f[oe]!==!0&&(i.enable(oe),f[oe]=!0)}h(me,"enable");function de(oe){f[oe]!==!1&&(i.disable(oe),f[oe]=!1)}h(de,"disable");function be(oe,ye){return p[oe]!==ye?(i.bindFramebuffer(oe,ye),p[oe]=ye,n&&(oe===36009&&(p[36160]=ye),oe===36160&&(p[36009]=ye)),!0):!1}h(be,"bindFramebuffer");function we(oe,ye){let Ee=m,Le=!1;if(oe)if(Ee=g.get(ye),Ee===void 0&&(Ee=[],g.set(ye,Ee)),oe.isWebGLMultipleRenderTargets){const Ve=oe.texture;if(Ee.length!==Ve.length||Ee[0]!==36064){for(let Ct=0,Dn=Ve.length;Ct<Dn;Ct++)Ee[Ct]=36064+Ct;Ee.length=Ve.length,Le=!0}}else Ee[0]!==36064&&(Ee[0]=36064,Le=!0);else Ee[0]!==1029&&(Ee[0]=1029,Le=!0);Le&&(t.isWebGL2?i.drawBuffers(Ee):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Ee))}h(we,"drawBuffers");function Ae(oe){return v!==oe?(i.useProgram(oe),v=oe,!0):!1}h(Ae,"useProgram");const V={[ul]:32774,[$P]:32778,[XP]:32779};if(n)V[s_]=32775,V[r_]=32776;else{const oe=e.get("EXT_blend_minmax");oe!==null&&(V[s_]=oe.MIN_EXT,V[r_]=oe.MAX_EXT)}const X={[YP]:0,[KP]:1,[qP]:768,[OM]:770,[nR]:776,[eR]:774,[QP]:772,[ZP]:769,[NM]:771,[tR]:775,[JP]:773};function E(oe,ye,Ee,Le,Ve,Ct,Dn,Xn){if(oe===Us){y===!0&&(de(3042),y=!1);return}if(y===!1&&(me(3042),y=!0),oe!==jP){if(oe!==b||Xn!==R){if((_!==ul||T!==ul)&&(i.blendEquation(32774),_=ul,T=ul),Xn)switch(oe){case Cl:i.blendFuncSeparate(1,771,1,771);break;case Fg:i.blendFunc(1,1);break;case n_:i.blendFuncSeparate(0,769,0,1);break;case i_:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}else switch(oe){case Cl:i.blendFuncSeparate(770,771,1,771);break;case Fg:i.blendFunc(770,1);break;case n_:i.blendFuncSeparate(0,769,0,1);break;case i_:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}x=null,w=null,P=null,M=null,b=oe,R=Xn}return}Ve=Ve||ye,Ct=Ct||Ee,Dn=Dn||Le,(ye!==_||Ve!==T)&&(i.blendEquationSeparate(V[ye],V[Ve]),_=ye,T=Ve),(Ee!==x||Le!==w||Ct!==P||Dn!==M)&&(i.blendFuncSeparate(X[Ee],X[Le],X[Ct],X[Dn]),x=Ee,w=Le,P=Ct,M=Dn),b=oe,R=null}h(E,"setBlending");function ee(oe,ye){oe.side===Ci?de(2884):me(2884);let Ee=oe.side===Ji;ye&&(Ee=!Ee),Q(Ee),oe.blending===Cl&&oe.transparent===!1?E(Us):E(oe.blending,oe.blendEquation,oe.blendSrc,oe.blendDst,oe.blendEquationAlpha,oe.blendSrcAlpha,oe.blendDstAlpha,oe.premultipliedAlpha),l.setFunc(oe.depthFunc),l.setTest(oe.depthTest),l.setMask(oe.depthWrite),a.setMask(oe.colorWrite);const Le=oe.stencilWrite;c.setTest(Le),Le&&(c.setMask(oe.stencilWriteMask),c.setFunc(oe.stencilFunc,oe.stencilRef,oe.stencilFuncMask),c.setOp(oe.stencilFail,oe.stencilZFail,oe.stencilZPass)),j(oe.polygonOffset,oe.polygonOffsetFactor,oe.polygonOffsetUnits),oe.alphaToCoverage===!0?me(32926):de(32926)}h(ee,"setMaterial");function Q(oe){L!==oe&&(oe?i.frontFace(2304):i.frontFace(2305),L=oe)}h(Q,"setFlipSided");function F(oe){oe!==GP?(me(2884),oe!==W&&(oe===t_?i.cullFace(1029):oe===WP?i.cullFace(1028):i.cullFace(1032))):de(2884),W=oe}h(F,"setCullFace");function O(oe){oe!==k&&(ne&&i.lineWidth(oe),k=oe)}h(O,"setLineWidth");function j(oe,ye,Ee){oe?(me(32823),(z!==ye||S!==Ee)&&(i.polygonOffset(ye,Ee),z=ye,S=Ee)):de(32823)}h(j,"setPolygonOffset");function N(oe){oe?me(3089):de(3089)}h(N,"setScissorTest");function $(oe){oe===void 0&&(oe=33984+B-1),G!==oe&&(i.activeTexture(oe),G=oe)}h($,"activeTexture");function I(oe,ye,Ee){Ee===void 0&&(G===null?Ee=33984+B-1:Ee=G);let Le=se[Ee];Le===void 0&&(Le={type:void 0,texture:void 0},se[Ee]=Le),(Le.type!==oe||Le.texture!==ye)&&(G!==Ee&&(i.activeTexture(Ee),G=Ee),i.bindTexture(oe,ye||te[oe]),Le.type=oe,Le.texture=ye)}h(I,"bindTexture");function D(){const oe=se[G];oe!==void 0&&oe.type!==void 0&&(i.bindTexture(oe.type,null),oe.type=void 0,oe.texture=void 0)}h(D,"unbindTexture");function H(){try{i.compressedTexImage2D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(H,"compressedTexImage2D");function Z(){try{i.compressedTexImage3D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(Z,"compressedTexImage3D");function re(){try{i.texSubImage2D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(re,"texSubImage2D");function ue(){try{i.texSubImage3D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(ue,"texSubImage3D");function ge(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(ge,"compressedTexSubImage2D");function xe(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(xe,"compressedTexSubImage3D");function pe(){try{i.texStorage2D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(pe,"texStorage2D");function Oe(){try{i.texStorage3D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(Oe,"texStorage3D");function Ge(){try{i.texImage2D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(Ge,"texImage2D");function Ie(){try{i.texImage3D.apply(i,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}h(Ie,"texImage3D");function We(oe){le.equals(oe)===!1&&(i.scissor(oe.x,oe.y,oe.z,oe.w),le.copy(oe))}h(We,"scissor");function Ne(oe){ae.equals(oe)===!1&&(i.viewport(oe.x,oe.y,oe.z,oe.w),ae.copy(oe))}h(Ne,"viewport");function Xe(oe,ye){let Ee=d.get(ye);Ee===void 0&&(Ee=new WeakMap,d.set(ye,Ee));let Le=Ee.get(oe);Le===void 0&&(Le=i.getUniformBlockIndex(ye,oe.name),Ee.set(oe,Le))}h(Xe,"updateUBOMapping");function St(oe,ye){const Le=d.get(ye).get(oe);u.get(oe)!==Le&&(i.uniformBlockBinding(ye,Le,oe.__bindingPointIndex),u.set(oe,Le))}h(St,"uniformBlockBinding");function wn(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),f={},G=null,se={},p={},g=new WeakMap,m=[],v=null,y=!1,b=null,_=null,x=null,w=null,T=null,P=null,M=null,R=!1,L=null,W=null,k=null,z=null,S=null,le.set(0,0,i.canvas.width,i.canvas.height),ae.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return h(wn,"reset"),{buffers:{color:a,depth:l,stencil:c},enable:me,disable:de,bindFramebuffer:be,drawBuffers:we,useProgram:Ae,setBlending:E,setMaterial:ee,setFlipSided:Q,setCullFace:F,setLineWidth:O,setPolygonOffset:j,setScissorTest:N,activeTexture:$,bindTexture:I,unbindTexture:D,compressedTexImage2D:H,compressedTexImage3D:Z,texImage2D:Ge,texImage3D:Ie,updateUBOMapping:Xe,uniformBlockBinding:St,texStorage2D:pe,texStorage3D:Oe,texSubImage2D:re,texSubImage3D:ue,compressedTexSubImage2D:ge,compressedTexSubImage3D:xe,scissor:We,viewport:Ne,reset:wn}}h(TO,"WebGLState");function EO(i,e,t,n,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,u=s.maxTextureSize,d=s.maxSamples,f=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(typeof navigator=="undefined"?"":navigator.userAgent),g=new WeakMap;let m;const v=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(I,D){return y?new OffscreenCanvas(I,D):Ou("canvas")}h(b,"createCanvas");function _(I,D,H,Z){let re=1;if((I.width>Z||I.height>Z)&&(re=Z/Math.max(I.width,I.height)),re<1||D===!0)if(typeof HTMLImageElement!="undefined"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&I instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&I instanceof ImageBitmap){const ue=D?Lf:Math.floor,ge=ue(re*I.width),xe=ue(re*I.height);m===void 0&&(m=b(ge,xe));const pe=H?b(ge,xe):m;return pe.width=ge,pe.height=xe,pe.getContext("2d").drawImage(I,0,0,ge,xe),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+I.width+"x"+I.height+") to ("+ge+"x"+xe+")."),pe}else return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+I.width+"x"+I.height+")."),I;return I}h(_,"resizeImage");function x(I){return Hg(I.width)&&Hg(I.height)}h(x,"isPowerOfTwo$1");function w(I){return a?!1:I.wrapS!==li||I.wrapT!==li||I.minFilter!==Cn&&I.minFilter!==ai}h(w,"textureNeedsPowerOfTwo");function T(I,D){return I.generateMipmaps&&D&&I.minFilter!==Cn&&I.minFilter!==ai}h(T,"textureNeedsGenerateMipmaps");function P(I){i.generateMipmap(I)}h(P,"generateMipmap");function M(I,D,H,Z,re=!1){if(a===!1)return D;if(I!==null){if(i[I]!==void 0)return i[I];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+I+"'")}let ue=D;return D===6403&&(H===5126&&(ue=33326),H===5131&&(ue=33325),H===5121&&(ue=33321)),D===33319&&(H===5126&&(ue=33328),H===5131&&(ue=33327),H===5121&&(ue=33323)),D===6408&&(H===5126&&(ue=34836),H===5131&&(ue=34842),H===5121&&(ue=Z===bt&&re===!1?35907:32856),H===32819&&(ue=32854),H===32820&&(ue=32855)),(ue===33325||ue===33326||ue===33327||ue===33328||ue===34842||ue===34836)&&e.get("EXT_color_buffer_float"),ue}h(M,"getInternalFormat");function R(I,D,H){return T(I,H)===!0||I.isFramebufferTexture&&I.minFilter!==Cn&&I.minFilter!==ai?Math.log2(Math.max(D.width,D.height))+1:I.mipmaps!==void 0&&I.mipmaps.length>0?I.mipmaps.length:I.isCompressedTexture&&Array.isArray(I.image)?D.mipmaps.length:1}h(R,"getMipLevels");function L(I){return I===Cn||I===If||I===Df?9728:9729}h(L,"filterFallback");function W(I){const D=I.target;D.removeEventListener("dispose",W),z(D),D.isVideoTexture&&g.delete(D)}h(W,"onTextureDispose");function k(I){const D=I.target;D.removeEventListener("dispose",k),B(D)}h(k,"onRenderTargetDispose");function z(I){const D=n.get(I);if(D.__webglInit===void 0)return;const H=I.source,Z=v.get(H);if(Z){const re=Z[D.__cacheKey];re.usedTimes--,re.usedTimes===0&&S(I),Object.keys(Z).length===0&&v.delete(H)}n.remove(I)}h(z,"deallocateTexture");function S(I){const D=n.get(I);i.deleteTexture(D.__webglTexture);const H=I.source,Z=v.get(H);delete Z[D.__cacheKey],o.memory.textures--}h(S,"deleteTexture");function B(I){const D=I.texture,H=n.get(I),Z=n.get(D);if(Z.__webglTexture!==void 0&&(i.deleteTexture(Z.__webglTexture),o.memory.textures--),I.depthTexture&&I.depthTexture.dispose(),I.isWebGLCubeRenderTarget)for(let re=0;re<6;re++)i.deleteFramebuffer(H.__webglFramebuffer[re]),H.__webglDepthbuffer&&i.deleteRenderbuffer(H.__webglDepthbuffer[re]);else{if(i.deleteFramebuffer(H.__webglFramebuffer),H.__webglDepthbuffer&&i.deleteRenderbuffer(H.__webglDepthbuffer),H.__webglMultisampledFramebuffer&&i.deleteFramebuffer(H.__webglMultisampledFramebuffer),H.__webglColorRenderbuffer)for(let re=0;re<H.__webglColorRenderbuffer.length;re++)H.__webglColorRenderbuffer[re]&&i.deleteRenderbuffer(H.__webglColorRenderbuffer[re]);H.__webglDepthRenderbuffer&&i.deleteRenderbuffer(H.__webglDepthRenderbuffer)}if(I.isWebGLMultipleRenderTargets)for(let re=0,ue=D.length;re<ue;re++){const ge=n.get(D[re]);ge.__webglTexture&&(i.deleteTexture(ge.__webglTexture),o.memory.textures--),n.remove(D[re])}n.remove(D),n.remove(I)}h(B,"deallocateRenderTarget");let ne=0;function K(){ne=0}h(K,"resetTextureUnits");function ie(){const I=ne;return I>=l&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+l),ne+=1,I}h(ie,"allocateTextureUnit");function G(I){const D=[];return D.push(I.wrapS),D.push(I.wrapT),D.push(I.wrapR||0),D.push(I.magFilter),D.push(I.minFilter),D.push(I.anisotropy),D.push(I.internalFormat),D.push(I.format),D.push(I.type),D.push(I.generateMipmaps),D.push(I.premultiplyAlpha),D.push(I.flipY),D.push(I.unpackAlignment),D.push(I.encoding),D.join()}h(G,"getTextureCacheKey");function se(I,D){const H=n.get(I);if(I.isVideoTexture&&N(I),I.isRenderTargetTexture===!1&&I.version>0&&H.__version!==I.version){const Z=I.image;if(Z===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Z.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{de(H,I,D);return}}t.bindTexture(3553,H.__webglTexture,33984+D)}h(se,"setTexture2D");function q(I,D){const H=n.get(I);if(I.version>0&&H.__version!==I.version){de(H,I,D);return}t.bindTexture(35866,H.__webglTexture,33984+D)}h(q,"setTexture2DArray");function U(I,D){const H=n.get(I);if(I.version>0&&H.__version!==I.version){de(H,I,D);return}t.bindTexture(32879,H.__webglTexture,33984+D)}h(U,"setTexture3D");function le(I,D){const H=n.get(I);if(I.version>0&&H.__version!==I.version){be(H,I,D);return}t.bindTexture(34067,H.__webglTexture,33984+D)}h(le,"setTextureCube");const ae={[wr]:10497,[li]:33071,[Lu]:33648},J={[Cn]:9728,[If]:9984,[Df]:9986,[ai]:9729,[F0]:9985,[Ma]:9987};function te(I,D,H){if(H?(i.texParameteri(I,10242,ae[D.wrapS]),i.texParameteri(I,10243,ae[D.wrapT]),(I===32879||I===35866)&&i.texParameteri(I,32882,ae[D.wrapR]),i.texParameteri(I,10240,J[D.magFilter]),i.texParameteri(I,10241,J[D.minFilter])):(i.texParameteri(I,10242,33071),i.texParameteri(I,10243,33071),(I===32879||I===35866)&&i.texParameteri(I,32882,33071),(D.wrapS!==li||D.wrapT!==li)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(I,10240,L(D.magFilter)),i.texParameteri(I,10241,L(D.minFilter)),D.minFilter!==Cn&&D.minFilter!==ai&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const Z=e.get("EXT_texture_filter_anisotropic");if(D.type===to&&e.has("OES_texture_float_linear")===!1||a===!1&&D.type===Ol&&e.has("OES_texture_half_float_linear")===!1)return;(D.anisotropy>1||n.get(D).__currentAnisotropy)&&(i.texParameterf(I,Z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,s.getMaxAnisotropy())),n.get(D).__currentAnisotropy=D.anisotropy)}}h(te,"setTextureParameters");function me(I,D){let H=!1;I.__webglInit===void 0&&(I.__webglInit=!0,D.addEventListener("dispose",W));const Z=D.source;let re=v.get(Z);re===void 0&&(re={},v.set(Z,re));const ue=G(D);if(ue!==I.__cacheKey){re[ue]===void 0&&(re[ue]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,H=!0),re[ue].usedTimes++;const ge=re[I.__cacheKey];ge!==void 0&&(re[I.__cacheKey].usedTimes--,ge.usedTimes===0&&S(D)),I.__cacheKey=ue,I.__webglTexture=re[ue].texture}return H}h(me,"initTexture");function de(I,D,H){let Z=3553;(D.isDataArrayTexture||D.isCompressedArrayTexture)&&(Z=35866),D.isData3DTexture&&(Z=32879);const re=me(I,D),ue=D.source;t.bindTexture(Z,I.__webglTexture,33984+H);const ge=n.get(ue);if(ue.version!==ge.__version||re===!0){t.activeTexture(33984+H),i.pixelStorei(37440,D.flipY),i.pixelStorei(37441,D.premultiplyAlpha),i.pixelStorei(3317,D.unpackAlignment),i.pixelStorei(37443,0);const xe=w(D)&&x(D.image)===!1;let pe=_(D.image,xe,!1,u);pe=$(D,pe);const Oe=x(pe)||a,Ge=r.convert(D.format,D.encoding);let Ie=r.convert(D.type),We=M(D.internalFormat,Ge,Ie,D.encoding,D.isVideoTexture);te(Z,D,Oe);let Ne;const Xe=D.mipmaps,St=a&&D.isVideoTexture!==!0,wn=ge.__version===void 0||re===!0,oe=R(D,pe,Oe);if(D.isDepthTexture)We=6402,a?D.type===to?We=36012:D.type===ta?We=33190:D.type===Tl?We=35056:We=33189:D.type===to&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),D.format===oa&&We===6402&&D.type!==zM&&D.type!==ta&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),D.type=ta,Ie=r.convert(D.type)),D.format===Nl&&We===6402&&(We=34041,D.type!==Tl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),D.type=Tl,Ie=r.convert(D.type))),wn&&(St?t.texStorage2D(3553,1,We,pe.width,pe.height):t.texImage2D(3553,0,We,pe.width,pe.height,0,Ge,Ie,null));else if(D.isDataTexture)if(Xe.length>0&&Oe){St&&wn&&t.texStorage2D(3553,oe,We,Xe[0].width,Xe[0].height);for(let ye=0,Ee=Xe.length;ye<Ee;ye++)Ne=Xe[ye],St?t.texSubImage2D(3553,ye,0,0,Ne.width,Ne.height,Ge,Ie,Ne.data):t.texImage2D(3553,ye,We,Ne.width,Ne.height,0,Ge,Ie,Ne.data);D.generateMipmaps=!1}else St?(wn&&t.texStorage2D(3553,oe,We,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,pe.width,pe.height,Ge,Ie,pe.data)):t.texImage2D(3553,0,We,pe.width,pe.height,0,Ge,Ie,pe.data);else if(D.isCompressedTexture)if(D.isCompressedArrayTexture){St&&wn&&t.texStorage3D(35866,oe,We,Xe[0].width,Xe[0].height,pe.depth);for(let ye=0,Ee=Xe.length;ye<Ee;ye++)Ne=Xe[ye],D.format!==Bi?Ge!==null?St?t.compressedTexSubImage3D(35866,ye,0,0,0,Ne.width,Ne.height,pe.depth,Ge,Ne.data,0,0):t.compressedTexImage3D(35866,ye,We,Ne.width,Ne.height,pe.depth,0,Ne.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):St?t.texSubImage3D(35866,ye,0,0,0,Ne.width,Ne.height,pe.depth,Ge,Ie,Ne.data):t.texImage3D(35866,ye,We,Ne.width,Ne.height,pe.depth,0,Ge,Ie,Ne.data)}else{St&&wn&&t.texStorage2D(3553,oe,We,Xe[0].width,Xe[0].height);for(let ye=0,Ee=Xe.length;ye<Ee;ye++)Ne=Xe[ye],D.format!==Bi?Ge!==null?St?t.compressedTexSubImage2D(3553,ye,0,0,Ne.width,Ne.height,Ge,Ne.data):t.compressedTexImage2D(3553,ye,We,Ne.width,Ne.height,0,Ne.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):St?t.texSubImage2D(3553,ye,0,0,Ne.width,Ne.height,Ge,Ie,Ne.data):t.texImage2D(3553,ye,We,Ne.width,Ne.height,0,Ge,Ie,Ne.data)}else if(D.isDataArrayTexture)St?(wn&&t.texStorage3D(35866,oe,We,pe.width,pe.height,pe.depth),t.texSubImage3D(35866,0,0,0,0,pe.width,pe.height,pe.depth,Ge,Ie,pe.data)):t.texImage3D(35866,0,We,pe.width,pe.height,pe.depth,0,Ge,Ie,pe.data);else if(D.isData3DTexture)St?(wn&&t.texStorage3D(32879,oe,We,pe.width,pe.height,pe.depth),t.texSubImage3D(32879,0,0,0,0,pe.width,pe.height,pe.depth,Ge,Ie,pe.data)):t.texImage3D(32879,0,We,pe.width,pe.height,pe.depth,0,Ge,Ie,pe.data);else if(D.isFramebufferTexture){if(wn)if(St)t.texStorage2D(3553,oe,We,pe.width,pe.height);else{let ye=pe.width,Ee=pe.height;for(let Le=0;Le<oe;Le++)t.texImage2D(3553,Le,We,ye,Ee,0,Ge,Ie,null),ye>>=1,Ee>>=1}}else if(Xe.length>0&&Oe){St&&wn&&t.texStorage2D(3553,oe,We,Xe[0].width,Xe[0].height);for(let ye=0,Ee=Xe.length;ye<Ee;ye++)Ne=Xe[ye],St?t.texSubImage2D(3553,ye,0,0,Ge,Ie,Ne):t.texImage2D(3553,ye,We,Ge,Ie,Ne);D.generateMipmaps=!1}else St?(wn&&t.texStorage2D(3553,oe,We,pe.width,pe.height),t.texSubImage2D(3553,0,0,0,Ge,Ie,pe)):t.texImage2D(3553,0,We,Ge,Ie,pe);T(D,Oe)&&P(Z),ge.__version=ue.version,D.onUpdate&&D.onUpdate(D)}I.__version=D.version}h(de,"uploadTexture");function be(I,D,H){if(D.image.length!==6)return;const Z=me(I,D),re=D.source;t.bindTexture(34067,I.__webglTexture,33984+H);const ue=n.get(re);if(re.version!==ue.__version||Z===!0){t.activeTexture(33984+H),i.pixelStorei(37440,D.flipY),i.pixelStorei(37441,D.premultiplyAlpha),i.pixelStorei(3317,D.unpackAlignment),i.pixelStorei(37443,0);const ge=D.isCompressedTexture||D.image[0].isCompressedTexture,xe=D.image[0]&&D.image[0].isDataTexture,pe=[];for(let ye=0;ye<6;ye++)!ge&&!xe?pe[ye]=_(D.image[ye],!1,!0,c):pe[ye]=xe?D.image[ye].image:D.image[ye],pe[ye]=$(D,pe[ye]);const Oe=pe[0],Ge=x(Oe)||a,Ie=r.convert(D.format,D.encoding),We=r.convert(D.type),Ne=M(D.internalFormat,Ie,We,D.encoding),Xe=a&&D.isVideoTexture!==!0,St=ue.__version===void 0||Z===!0;let wn=R(D,Oe,Ge);te(34067,D,Ge);let oe;if(ge){Xe&&St&&t.texStorage2D(34067,wn,Ne,Oe.width,Oe.height);for(let ye=0;ye<6;ye++){oe=pe[ye].mipmaps;for(let Ee=0;Ee<oe.length;Ee++){const Le=oe[Ee];D.format!==Bi?Ie!==null?Xe?t.compressedTexSubImage2D(34069+ye,Ee,0,0,Le.width,Le.height,Ie,Le.data):t.compressedTexImage2D(34069+ye,Ee,Ne,Le.width,Le.height,0,Le.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Xe?t.texSubImage2D(34069+ye,Ee,0,0,Le.width,Le.height,Ie,We,Le.data):t.texImage2D(34069+ye,Ee,Ne,Le.width,Le.height,0,Ie,We,Le.data)}}}else{oe=D.mipmaps,Xe&&St&&(oe.length>0&&wn++,t.texStorage2D(34067,wn,Ne,pe[0].width,pe[0].height));for(let ye=0;ye<6;ye++)if(xe){Xe?t.texSubImage2D(34069+ye,0,0,0,pe[ye].width,pe[ye].height,Ie,We,pe[ye].data):t.texImage2D(34069+ye,0,Ne,pe[ye].width,pe[ye].height,0,Ie,We,pe[ye].data);for(let Ee=0;Ee<oe.length;Ee++){const Ve=oe[Ee].image[ye].image;Xe?t.texSubImage2D(34069+ye,Ee+1,0,0,Ve.width,Ve.height,Ie,We,Ve.data):t.texImage2D(34069+ye,Ee+1,Ne,Ve.width,Ve.height,0,Ie,We,Ve.data)}}else{Xe?t.texSubImage2D(34069+ye,0,0,0,Ie,We,pe[ye]):t.texImage2D(34069+ye,0,Ne,Ie,We,pe[ye]);for(let Ee=0;Ee<oe.length;Ee++){const Le=oe[Ee];Xe?t.texSubImage2D(34069+ye,Ee+1,0,0,Ie,We,Le.image[ye]):t.texImage2D(34069+ye,Ee+1,Ne,Ie,We,Le.image[ye])}}}T(D,Ge)&&P(34067),ue.__version=re.version,D.onUpdate&&D.onUpdate(D)}I.__version=D.version}h(be,"uploadCubeTexture");function we(I,D,H,Z,re){const ue=r.convert(H.format,H.encoding),ge=r.convert(H.type),xe=M(H.internalFormat,ue,ge,H.encoding);n.get(D).__hasExternalTextures||(re===32879||re===35866?t.texImage3D(re,0,xe,D.width,D.height,D.depth,0,ue,ge,null):t.texImage2D(re,0,xe,D.width,D.height,0,ue,ge,null)),t.bindFramebuffer(36160,I),j(D)?f.framebufferTexture2DMultisampleEXT(36160,Z,re,n.get(H).__webglTexture,0,O(D)):(re===3553||re>=34069&&re<=34074)&&i.framebufferTexture2D(36160,Z,re,n.get(H).__webglTexture,0),t.bindFramebuffer(36160,null)}h(we,"setupFrameBufferTexture");function Ae(I,D,H){if(i.bindRenderbuffer(36161,I),D.depthBuffer&&!D.stencilBuffer){let Z=33189;if(H||j(D)){const re=D.depthTexture;re&&re.isDepthTexture&&(re.type===to?Z=36012:re.type===ta&&(Z=33190));const ue=O(D);j(D)?f.renderbufferStorageMultisampleEXT(36161,ue,Z,D.width,D.height):i.renderbufferStorageMultisample(36161,ue,Z,D.width,D.height)}else i.renderbufferStorage(36161,Z,D.width,D.height);i.framebufferRenderbuffer(36160,36096,36161,I)}else if(D.depthBuffer&&D.stencilBuffer){const Z=O(D);H&&j(D)===!1?i.renderbufferStorageMultisample(36161,Z,35056,D.width,D.height):j(D)?f.renderbufferStorageMultisampleEXT(36161,Z,35056,D.width,D.height):i.renderbufferStorage(36161,34041,D.width,D.height),i.framebufferRenderbuffer(36160,33306,36161,I)}else{const Z=D.isWebGLMultipleRenderTargets===!0?D.texture:[D.texture];for(let re=0;re<Z.length;re++){const ue=Z[re],ge=r.convert(ue.format,ue.encoding),xe=r.convert(ue.type),pe=M(ue.internalFormat,ge,xe,ue.encoding),Oe=O(D);H&&j(D)===!1?i.renderbufferStorageMultisample(36161,Oe,pe,D.width,D.height):j(D)?f.renderbufferStorageMultisampleEXT(36161,Oe,pe,D.width,D.height):i.renderbufferStorage(36161,pe,D.width,D.height)}}i.bindRenderbuffer(36161,null)}h(Ae,"setupRenderBufferStorage");function V(I,D){if(D&&D.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,I),!(D.depthTexture&&D.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(D.depthTexture).__webglTexture||D.depthTexture.image.width!==D.width||D.depthTexture.image.height!==D.height)&&(D.depthTexture.image.width=D.width,D.depthTexture.image.height=D.height,D.depthTexture.needsUpdate=!0),se(D.depthTexture,0);const Z=n.get(D.depthTexture).__webglTexture,re=O(D);if(D.depthTexture.format===oa)j(D)?f.framebufferTexture2DMultisampleEXT(36160,36096,3553,Z,0,re):i.framebufferTexture2D(36160,36096,3553,Z,0);else if(D.depthTexture.format===Nl)j(D)?f.framebufferTexture2DMultisampleEXT(36160,33306,3553,Z,0,re):i.framebufferTexture2D(36160,33306,3553,Z,0);else throw new Error("Unknown depthTexture format")}h(V,"setupDepthTexture");function X(I){const D=n.get(I),H=I.isWebGLCubeRenderTarget===!0;if(I.depthTexture&&!D.__autoAllocateDepthBuffer){if(H)throw new Error("target.depthTexture not supported in Cube render targets");V(D.__webglFramebuffer,I)}else if(H){D.__webglDepthbuffer=[];for(let Z=0;Z<6;Z++)t.bindFramebuffer(36160,D.__webglFramebuffer[Z]),D.__webglDepthbuffer[Z]=i.createRenderbuffer(),Ae(D.__webglDepthbuffer[Z],I,!1)}else t.bindFramebuffer(36160,D.__webglFramebuffer),D.__webglDepthbuffer=i.createRenderbuffer(),Ae(D.__webglDepthbuffer,I,!1);t.bindFramebuffer(36160,null)}h(X,"setupDepthRenderbuffer");function E(I,D,H){const Z=n.get(I);D!==void 0&&we(Z.__webglFramebuffer,I,I.texture,36064,3553),H!==void 0&&X(I)}h(E,"rebindTextures");function ee(I){const D=I.texture,H=n.get(I),Z=n.get(D);I.addEventListener("dispose",k),I.isWebGLMultipleRenderTargets!==!0&&(Z.__webglTexture===void 0&&(Z.__webglTexture=i.createTexture()),Z.__version=D.version,o.memory.textures++);const re=I.isWebGLCubeRenderTarget===!0,ue=I.isWebGLMultipleRenderTargets===!0,ge=x(I)||a;if(re){H.__webglFramebuffer=[];for(let xe=0;xe<6;xe++)H.__webglFramebuffer[xe]=i.createFramebuffer()}else{if(H.__webglFramebuffer=i.createFramebuffer(),ue)if(s.drawBuffers){const xe=I.texture;for(let pe=0,Oe=xe.length;pe<Oe;pe++){const Ge=n.get(xe[pe]);Ge.__webglTexture===void 0&&(Ge.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&I.samples>0&&j(I)===!1){const xe=ue?D:[D];H.__webglMultisampledFramebuffer=i.createFramebuffer(),H.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,H.__webglMultisampledFramebuffer);for(let pe=0;pe<xe.length;pe++){const Oe=xe[pe];H.__webglColorRenderbuffer[pe]=i.createRenderbuffer(),i.bindRenderbuffer(36161,H.__webglColorRenderbuffer[pe]);const Ge=r.convert(Oe.format,Oe.encoding),Ie=r.convert(Oe.type),We=M(Oe.internalFormat,Ge,Ie,Oe.encoding,I.isXRRenderTarget===!0),Ne=O(I);i.renderbufferStorageMultisample(36161,Ne,We,I.width,I.height),i.framebufferRenderbuffer(36160,36064+pe,36161,H.__webglColorRenderbuffer[pe])}i.bindRenderbuffer(36161,null),I.depthBuffer&&(H.__webglDepthRenderbuffer=i.createRenderbuffer(),Ae(H.__webglDepthRenderbuffer,I,!0)),t.bindFramebuffer(36160,null)}}if(re){t.bindTexture(34067,Z.__webglTexture),te(34067,D,ge);for(let xe=0;xe<6;xe++)we(H.__webglFramebuffer[xe],I,D,36064,34069+xe);T(D,ge)&&P(34067),t.unbindTexture()}else if(ue){const xe=I.texture;for(let pe=0,Oe=xe.length;pe<Oe;pe++){const Ge=xe[pe],Ie=n.get(Ge);t.bindTexture(3553,Ie.__webglTexture),te(3553,Ge,ge),we(H.__webglFramebuffer,I,Ge,36064+pe,3553),T(Ge,ge)&&P(3553)}t.unbindTexture()}else{let xe=3553;(I.isWebGL3DRenderTarget||I.isWebGLArrayRenderTarget)&&(a?xe=I.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(xe,Z.__webglTexture),te(xe,D,ge),we(H.__webglFramebuffer,I,D,36064,xe),T(D,ge)&&P(xe),t.unbindTexture()}I.depthBuffer&&X(I)}h(ee,"setupRenderTarget");function Q(I){const D=x(I)||a,H=I.isWebGLMultipleRenderTargets===!0?I.texture:[I.texture];for(let Z=0,re=H.length;Z<re;Z++){const ue=H[Z];if(T(ue,D)){const ge=I.isWebGLCubeRenderTarget?34067:3553,xe=n.get(ue).__webglTexture;t.bindTexture(ge,xe),P(ge),t.unbindTexture()}}}h(Q,"updateRenderTargetMipmap");function F(I){if(a&&I.samples>0&&j(I)===!1){const D=I.isWebGLMultipleRenderTargets?I.texture:[I.texture],H=I.width,Z=I.height;let re=16384;const ue=[],ge=I.stencilBuffer?33306:36096,xe=n.get(I),pe=I.isWebGLMultipleRenderTargets===!0;if(pe)for(let Oe=0;Oe<D.length;Oe++)t.bindFramebuffer(36160,xe.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Oe,36161,null),t.bindFramebuffer(36160,xe.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Oe,3553,null,0);t.bindFramebuffer(36008,xe.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,xe.__webglFramebuffer);for(let Oe=0;Oe<D.length;Oe++){ue.push(36064+Oe),I.depthBuffer&&ue.push(ge);const Ge=xe.__ignoreDepthValues!==void 0?xe.__ignoreDepthValues:!1;if(Ge===!1&&(I.depthBuffer&&(re|=256),I.stencilBuffer&&(re|=1024)),pe&&i.framebufferRenderbuffer(36008,36064,36161,xe.__webglColorRenderbuffer[Oe]),Ge===!0&&(i.invalidateFramebuffer(36008,[ge]),i.invalidateFramebuffer(36009,[ge])),pe){const Ie=n.get(D[Oe]).__webglTexture;i.framebufferTexture2D(36009,36064,3553,Ie,0)}i.blitFramebuffer(0,0,H,Z,0,0,H,Z,re,9728),p&&i.invalidateFramebuffer(36008,ue)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),pe)for(let Oe=0;Oe<D.length;Oe++){t.bindFramebuffer(36160,xe.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Oe,36161,xe.__webglColorRenderbuffer[Oe]);const Ge=n.get(D[Oe]).__webglTexture;t.bindFramebuffer(36160,xe.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Oe,3553,Ge,0)}t.bindFramebuffer(36009,xe.__webglMultisampledFramebuffer)}}h(F,"updateMultisampleRenderTarget");function O(I){return Math.min(d,I.samples)}h(O,"getRenderTargetSamples");function j(I){const D=n.get(I);return a&&I.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&D.__useRenderToTexture!==!1}h(j,"useMultisampledRTT");function N(I){const D=o.render.frame;g.get(I)!==D&&(g.set(I,D),I.update())}h(N,"updateVideoTexture");function $(I,D){const H=I.encoding,Z=I.format,re=I.type;return I.isCompressedTexture===!0||I.isVideoTexture===!0||I.format===Vg||H!==xr&&(H===bt?a===!1?e.has("EXT_sRGB")===!0&&Z===Bi?(I.format=Vg,I.minFilter=ai,I.generateMipmaps=!1):D=B0.sRGBToLinear(D):(Z!==Bi||re!==da)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",H)),D}h($,"verifyColorSpace"),this.allocateTextureUnit=ie,this.resetTextureUnits=K,this.setTexture2D=se,this.setTexture2DArray=q,this.setTexture3D=U,this.setTextureCube=le,this.rebindTextures=E,this.setupRenderTarget=ee,this.updateRenderTargetMipmap=Q,this.updateMultisampleRenderTarget=F,this.setupDepthRenderbuffer=X,this.setupFrameBufferTexture=we,this.useMultisampledRTT=j}h(EO,"WebGLTextures");function PO(i,e,t){const n=t.isWebGL2;function s(r,o=null){let a;if(r===da)return 5121;if(r===bR)return 32819;if(r===wR)return 32820;if(r===vR)return 5120;if(r===yR)return 5122;if(r===zM)return 5123;if(r===_R)return 5124;if(r===ta)return 5125;if(r===to)return 5126;if(r===Ol)return n?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===xR)return 6406;if(r===Bi)return 6408;if(r===AR)return 6409;if(r===SR)return 6410;if(r===oa)return 6402;if(r===Nl)return 34041;if(r===CR)return 6403;if(r===MR)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(r===Vg)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===TR)return 36244;if(r===ER)return 33319;if(r===PR)return 33320;if(r===RR)return 36249;if(r===Qp||r===Jp||r===em||r===tm)if(o===bt)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===Qp)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Jp)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===em)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===tm)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===Qp)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Jp)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===em)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===tm)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===o_||r===a_||r===l_||r===c_)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===o_)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===a_)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===l_)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===c_)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===IR)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===u_||r===h_)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(r===u_)return o===bt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===h_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===d_||r===f_||r===p_||r===m_||r===g_||r===v_||r===y_||r===__||r===b_||r===w_||r===x_||r===M_||r===A_||r===S_)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(r===d_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===f_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===p_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===m_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===g_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===v_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===y_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===__)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===b_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===w_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===x_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===M_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===A_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===S_)return o===bt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===C_)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(r===C_)return o===bt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return r===Tl?n?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[r]!==void 0?i[r]:null}return h(s,"convert"),{convert:s}}h(PO,"WebGLUtils");class sA extends Fn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}h(sA,"ArrayCamera");class di extends vt{constructor(){super(),this.isGroup=!0,this.type="Group"}}h(di,"Group");const RO={type:"move"};class hf{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new di,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new di,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new A,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new A),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new di,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new A,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new A),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const m of e.hand.values()){const v=t.getJointPose(m,n);if(c.joints[m.jointName]===void 0){const b=new di;b.matrixAutoUpdate=!1,b.visible=!1,c.joints[m.jointName]=b,c.add(b)}const y=c.joints[m.jointName];v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=v.radius),y.visible=v!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=u.position.distanceTo(d.position),p=.02,g=.005;c.inputState.pinching&&f>p+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=p-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(RO)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}}h(hf,"WebXRController");class rA extends Pn{constructor(e,t,n,s,r,o,a,l,c,u){if(u=u!==void 0?u:oa,u!==oa&&u!==Nl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===oa&&(n=ta),n===void 0&&u===Nl&&(n=Tl),super(null,s,r,o,a,l,u,n,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Cn,this.minFilter=l!==void 0?l:Cn,this.flipY=!1,this.generateMipmaps=!1}}h(rA,"DepthTexture");class oA extends Aa{constructor(e,t){super();const n=this;let s=null,r=1,o=null,a="local-floor",l=null,c=null,u=null,d=null,f=null,p=null;const g=t.getContextAttributes();let m=null,v=null;const y=[],b=[],_=new Fn;_.layers.enable(1),_.viewport=new wt;const x=new Fn;x.layers.enable(2),x.viewport=new wt;const w=[_,x],T=new sA;T.layers.enable(1),T.layers.enable(2);let P=null,M=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(G){let se=y[G];return se===void 0&&(se=new hf,y[G]=se),se.getTargetRaySpace()},this.getControllerGrip=function(G){let se=y[G];return se===void 0&&(se=new hf,y[G]=se),se.getGripSpace()},this.getHand=function(G){let se=y[G];return se===void 0&&(se=new hf,y[G]=se),se.getHandSpace()};function R(G){const se=b.indexOf(G.inputSource);if(se===-1)return;const q=y[se];q!==void 0&&q.dispatchEvent({type:G.type,data:G.inputSource})}h(R,"onSessionEvent");function L(){s.removeEventListener("select",R),s.removeEventListener("selectstart",R),s.removeEventListener("selectend",R),s.removeEventListener("squeeze",R),s.removeEventListener("squeezestart",R),s.removeEventListener("squeezeend",R),s.removeEventListener("end",L),s.removeEventListener("inputsourceschange",W);for(let G=0;G<y.length;G++){const se=b[G];se!==null&&(b[G]=null,y[G].disconnect(se))}P=null,M=null,e.setRenderTarget(m),f=null,d=null,u=null,s=null,v=null,ie.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}h(L,"onSessionEnd"),this.setFramebufferScaleFactor=function(G){r=G,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(G){a=G,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(G){l=G},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(G){if(s=G,s!==null){if(m=e.getRenderTarget(),s.addEventListener("select",R),s.addEventListener("selectstart",R),s.addEventListener("selectend",R),s.addEventListener("squeeze",R),s.addEventListener("squeezestart",R),s.addEventListener("squeezeend",R),s.addEventListener("end",L),s.addEventListener("inputsourceschange",W),g.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const se={antialias:s.renderState.layers===void 0?g.antialias:!0,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(s,t,se),s.updateRenderState({baseLayer:f}),v=new Hn(f.framebufferWidth,f.framebufferHeight,{format:Bi,type:da,encoding:e.outputEncoding,stencilBuffer:g.stencil})}else{let se=null,q=null,U=null;g.depth&&(U=g.stencil?35056:33190,se=g.stencil?Nl:oa,q=g.stencil?Tl:ta);const le={colorFormat:32856,depthFormat:U,scaleFactor:r};u=new XRWebGLBinding(s,t),d=u.createProjectionLayer(le),s.updateRenderState({layers:[d]}),v=new Hn(d.textureWidth,d.textureHeight,{format:Bi,type:da,depthTexture:new rA(d.textureWidth,d.textureHeight,q,void 0,void 0,void 0,void 0,void 0,void 0,se),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0});const ae=e.properties.get(v);ae.__ignoreDepthValues=d.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(1),l=null,o=await s.requestReferenceSpace(a),ie.setContext(s),ie.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function W(G){for(let se=0;se<G.removed.length;se++){const q=G.removed[se],U=b.indexOf(q);U>=0&&(b[U]=null,y[U].dispatchEvent({type:"disconnected",data:q}))}for(let se=0;se<G.added.length;se++){const q=G.added[se];let U=b.indexOf(q);if(U===-1){for(let ae=0;ae<y.length;ae++)if(ae>=b.length){b.push(q),U=ae;break}else if(b[ae]===null){b[ae]=q,U=ae;break}if(U===-1)break}const le=y[U];le&&le.dispatchEvent({type:"connected",data:q})}}h(W,"onInputSourcesChange");const k=new A,z=new A;function S(G,se,q){k.setFromMatrixPosition(se.matrixWorld),z.setFromMatrixPosition(q.matrixWorld);const U=k.distanceTo(z),le=se.projectionMatrix.elements,ae=q.projectionMatrix.elements,J=le[14]/(le[10]-1),te=le[14]/(le[10]+1),me=(le[9]+1)/le[5],de=(le[9]-1)/le[5],be=(le[8]-1)/le[0],we=(ae[8]+1)/ae[0],Ae=J*be,V=J*we,X=U/(-be+we),E=X*-be;se.matrixWorld.decompose(G.position,G.quaternion,G.scale),G.translateX(E),G.translateZ(X),G.matrixWorld.compose(G.position,G.quaternion,G.scale),G.matrixWorldInverse.copy(G.matrixWorld).invert();const ee=J+X,Q=te+X,F=Ae-E,O=V+(U-E),j=me*te/Q*ee,N=de*te/Q*ee;G.projectionMatrix.makePerspective(F,O,j,N,ee,Q)}h(S,"setProjectionFromUnion");function B(G,se){se===null?G.matrixWorld.copy(G.matrix):G.matrixWorld.multiplyMatrices(se.matrixWorld,G.matrix),G.matrixWorldInverse.copy(G.matrixWorld).invert()}h(B,"updateCamera"),this.updateCamera=function(G){if(s===null)return;T.near=x.near=_.near=G.near,T.far=x.far=_.far=G.far,(P!==T.near||M!==T.far)&&(s.updateRenderState({depthNear:T.near,depthFar:T.far}),P=T.near,M=T.far);const se=G.parent,q=T.cameras;B(T,se);for(let le=0;le<q.length;le++)B(q[le],se);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),G.matrix.copy(T.matrix),G.matrix.decompose(G.position,G.quaternion,G.scale);const U=G.children;for(let le=0,ae=U.length;le<ae;le++)U[le].updateMatrixWorld(!0);q.length===2?S(T,_,x):T.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){if(d!==null)return d.fixedFoveation;if(f!==null)return f.fixedFoveation},this.setFoveation=function(G){d!==null&&(d.fixedFoveation=G),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=G)};let ne=null;function K(G,se){if(c=se.getViewerPose(l||o),p=se,c!==null){const q=c.views;f!==null&&(e.setRenderTargetFramebuffer(v,f.framebuffer),e.setRenderTarget(v));let U=!1;q.length!==T.cameras.length&&(T.cameras.length=0,U=!0);for(let le=0;le<q.length;le++){const ae=q[le];let J=null;if(f!==null)J=f.getViewport(ae);else{const me=u.getViewSubImage(d,ae);J=me.viewport,le===0&&(e.setRenderTargetTextures(v,me.colorTexture,d.ignoreDepthValues?void 0:me.depthStencilTexture),e.setRenderTarget(v))}let te=w[le];te===void 0&&(te=new Fn,te.layers.enable(le),te.viewport=new wt,w[le]=te),te.matrix.fromArray(ae.transform.matrix),te.projectionMatrix.fromArray(ae.projectionMatrix),te.viewport.set(J.x,J.y,J.width,J.height),le===0&&T.matrix.copy(te.matrix),U===!0&&T.cameras.push(te)}}for(let q=0;q<y.length;q++){const U=b[q],le=y[q];U!==null&&le!==void 0&&le.update(U,se,l||o)}ne&&ne(G,se),p=null}h(K,"onAnimationFrame");const ie=new XM;ie.setAnimationLoop(K),this.setAnimationLoop=function(G){ne=G},this.dispose=function(){}}}h(oA,"WebXRManager");function IO(i,e){function t(m,v){m.fogColor.value.copy(v.color),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)}h(t,"refreshFogUniforms");function n(m,v,y,b,_){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(m,v):v.isMeshToonMaterial?(s(m,v),u(m,v)):v.isMeshPhongMaterial?(s(m,v),c(m,v)):v.isMeshStandardMaterial?(s(m,v),d(m,v),v.isMeshPhysicalMaterial&&f(m,v,_)):v.isMeshMatcapMaterial?(s(m,v),p(m,v)):v.isMeshDepthMaterial?s(m,v):v.isMeshDistanceMaterial?(s(m,v),g(m,v)):v.isMeshNormalMaterial?s(m,v):v.isLineBasicMaterial?(r(m,v),v.isLineDashedMaterial&&o(m,v)):v.isPointsMaterial?a(m,v,y,b):v.isSpriteMaterial?l(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}h(n,"refreshMaterialUniforms");function s(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.bumpMap&&(m.bumpMap.value=v.bumpMap,m.bumpScale.value=v.bumpScale,v.side===Ji&&(m.bumpScale.value*=-1)),v.displacementMap&&(m.displacementMap.value=v.displacementMap,m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap),v.normalMap&&(m.normalMap.value=v.normalMap,m.normalScale.value.copy(v.normalScale),v.side===Ji&&m.normalScale.value.negate()),v.specularMap&&(m.specularMap.value=v.specularMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const y=e.get(v).envMap;if(y&&(m.envMap.value=y,m.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio),v.lightMap){m.lightMap.value=v.lightMap;const x=i.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=v.lightMapIntensity*x}v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity);let b;v.map?b=v.map:v.specularMap?b=v.specularMap:v.displacementMap?b=v.displacementMap:v.normalMap?b=v.normalMap:v.bumpMap?b=v.bumpMap:v.roughnessMap?b=v.roughnessMap:v.metalnessMap?b=v.metalnessMap:v.alphaMap?b=v.alphaMap:v.emissiveMap?b=v.emissiveMap:v.clearcoatMap?b=v.clearcoatMap:v.clearcoatNormalMap?b=v.clearcoatNormalMap:v.clearcoatRoughnessMap?b=v.clearcoatRoughnessMap:v.iridescenceMap?b=v.iridescenceMap:v.iridescenceThicknessMap?b=v.iridescenceThicknessMap:v.specularIntensityMap?b=v.specularIntensityMap:v.specularColorMap?b=v.specularColorMap:v.transmissionMap?b=v.transmissionMap:v.thicknessMap?b=v.thicknessMap:v.sheenColorMap?b=v.sheenColorMap:v.sheenRoughnessMap&&(b=v.sheenRoughnessMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),m.uvTransform.value.copy(b.matrix));let _;v.aoMap?_=v.aoMap:v.lightMap&&(_=v.lightMap),_!==void 0&&(_.isWebGLRenderTarget&&(_=_.texture),_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uv2Transform.value.copy(_.matrix))}h(s,"refreshUniformsCommon");function r(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity}h(r,"refreshUniformsLine");function o(m,v){m.dashSize.value=v.dashSize,m.totalSize.value=v.dashSize+v.gapSize,m.scale.value=v.scale}h(o,"refreshUniformsDash");function a(m,v,y,b){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.size.value=v.size*y,m.scale.value=b*.5,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let _;v.map?_=v.map:v.alphaMap&&(_=v.alphaMap),_!==void 0&&(_.matrixAutoUpdate===!0&&_.updateMatrix(),m.uvTransform.value.copy(_.matrix))}h(a,"refreshUniformsPoints");function l(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.rotation.value=v.rotation,v.map&&(m.map.value=v.map),v.alphaMap&&(m.alphaMap.value=v.alphaMap),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);let y;v.map?y=v.map:v.alphaMap&&(y=v.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix))}h(l,"refreshUniformsSprites");function c(m,v){m.specular.value.copy(v.specular),m.shininess.value=Math.max(v.shininess,1e-4)}h(c,"refreshUniformsPhong");function u(m,v){v.gradientMap&&(m.gradientMap.value=v.gradientMap)}h(u,"refreshUniformsToon");function d(m,v){m.roughness.value=v.roughness,m.metalness.value=v.metalness,v.roughnessMap&&(m.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(m.metalnessMap.value=v.metalnessMap),e.get(v).envMap&&(m.envMapIntensity.value=v.envMapIntensity)}h(d,"refreshUniformsStandard");function f(m,v,y){m.ior.value=v.ior,v.sheen>0&&(m.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),m.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(m.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(m.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(m.clearcoat.value=v.clearcoat,m.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(m.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),m.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===Ji&&m.clearcoatNormalScale.value.negate())),v.iridescence>0&&(m.iridescence.value=v.iridescence,m.iridescenceIOR.value=v.iridescenceIOR,m.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(m.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(m.transmission.value=v.transmission,m.transmissionSamplerMap.value=y.texture,m.transmissionSamplerSize.value.set(y.width,y.height),v.transmissionMap&&(m.transmissionMap.value=v.transmissionMap),m.thickness.value=v.thickness,v.thicknessMap&&(m.thicknessMap.value=v.thicknessMap),m.attenuationDistance.value=v.attenuationDistance,m.attenuationColor.value.copy(v.attenuationColor)),m.specularIntensity.value=v.specularIntensity,m.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(m.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(m.specularColorMap.value=v.specularColorMap)}h(f,"refreshUniformsPhysical");function p(m,v){v.matcap&&(m.matcap.value=v.matcap)}h(p,"refreshUniformsMatcap");function g(m,v){m.referencePosition.value.copy(v.referencePosition),m.nearDistance.value=v.nearDistance,m.farDistance.value=v.farDistance}return h(g,"refreshUniformsDistance"),{refreshFogUniforms:t,refreshMaterialUniforms:n}}h(IO,"WebGLMaterials");function DO(i,e,t,n){let s={},r={},o=[];const a=t.isWebGL2?i.getParameter(35375):0;function l(b,_){const x=_.program;n.uniformBlockBinding(b,x)}h(l,"bind");function c(b,_){let x=s[b.id];x===void 0&&(g(b),x=u(b),s[b.id]=x,b.addEventListener("dispose",v));const w=_.program;n.updateUBOMapping(b,w);const T=e.render.frame;r[b.id]!==T&&(f(b),r[b.id]=T)}h(c,"update");function u(b){const _=d();b.__bindingPointIndex=_;const x=i.createBuffer(),w=b.__size,T=b.usage;return i.bindBuffer(35345,x),i.bufferData(35345,w,T),i.bindBuffer(35345,null),i.bindBufferBase(35345,_,x),x}h(u,"createBuffer");function d(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}h(d,"allocateBindingPointIndex");function f(b){const _=s[b.id],x=b.uniforms,w=b.__cache;i.bindBuffer(35345,_);for(let T=0,P=x.length;T<P;T++){const M=x[T];if(p(M,T,w)===!0){const R=M.value,L=M.__offset;typeof R=="number"?(M.__data[0]=R,i.bufferSubData(35345,L,M.__data)):(M.value.isMatrix3?(M.__data[0]=M.value.elements[0],M.__data[1]=M.value.elements[1],M.__data[2]=M.value.elements[2],M.__data[3]=M.value.elements[0],M.__data[4]=M.value.elements[3],M.__data[5]=M.value.elements[4],M.__data[6]=M.value.elements[5],M.__data[7]=M.value.elements[0],M.__data[8]=M.value.elements[6],M.__data[9]=M.value.elements[7],M.__data[10]=M.value.elements[8],M.__data[11]=M.value.elements[0]):R.toArray(M.__data),i.bufferSubData(35345,L,M.__data))}}i.bindBuffer(35345,null)}h(f,"updateBufferData");function p(b,_,x){const w=b.value;if(x[_]===void 0)return typeof w=="number"?x[_]=w:x[_]=w.clone(),!0;if(typeof w=="number"){if(x[_]!==w)return x[_]=w,!0}else{const T=x[_];if(T.equals(w)===!1)return T.copy(w),!0}return!1}h(p,"hasUniformChanged");function g(b){const _=b.uniforms;let x=0;const w=16;let T=0;for(let P=0,M=_.length;P<M;P++){const R=_[P],L=m(R);if(R.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=x,P>0){T=x%w;const W=w-T;T!==0&&W-L.boundary<0&&(x+=w-T,R.__offset=x)}x+=L.storage}return T=x%w,T>0&&(x+=w-T),b.__size=x,b.__cache={},this}h(g,"prepareUniformsGroup");function m(b){const _=b.value,x={boundary:0,storage:0};return typeof _=="number"?(x.boundary=4,x.storage=4):_.isVector2?(x.boundary=8,x.storage=8):_.isVector3||_.isColor?(x.boundary=16,x.storage=12):_.isVector4?(x.boundary=16,x.storage=16):_.isMatrix3?(x.boundary=48,x.storage=48):_.isMatrix4?(x.boundary=64,x.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),x}h(m,"getUniformSize");function v(b){const _=b.target;_.removeEventListener("dispose",v);const x=o.indexOf(_.__bindingPointIndex);o.splice(x,1),i.deleteBuffer(s[_.id]),delete s[_.id],delete r[_.id]}h(v,"onUniformsGroupsDispose");function y(){for(const b in s)i.deleteBuffer(s[b]);o=[],s={},r={}}return h(y,"dispose"),{bind:l,update:c,dispose:y}}h(DO,"WebGLUniformsGroups");function LO(){const i=Ou("canvas");return i.style.display="block",i}h(LO,"createCanvasElement");function aA(i={}){this.isWebGLRenderer=!0;const e=i.canvas!==void 0?i.canvas:LO(),t=i.context!==void 0?i.context:null,n=i.depth!==void 0?i.depth:!0,s=i.stencil!==void 0?i.stencil:!0,r=i.antialias!==void 0?i.antialias:!1,o=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,a=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,l=i.powerPreference!==void 0?i.powerPreference:"default",c=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let u;t!==null?u=t.getContextAttributes().alpha:u=i.alpha!==void 0?i.alpha:!1;let d=null,f=null;const p=[],g=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=xr,this.physicallyCorrectLights=!1,this.toneMapping=Vs,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let v=!1,y=0,b=0,_=null,x=-1,w=null;const T=new wt,P=new wt;let M=null,R=e.width,L=e.height,W=1,k=null,z=null;const S=new wt(0,0,R,L),B=new wt(0,0,R,L);let ne=!1;const K=new sh;let ie=!1,G=!1,se=null;const q=new ve,U=new je,le=new A,ae={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function J(){return _===null?W:1}h(J,"getTargetPixelRatio");let te=t;function me(Y,fe){for(let _e=0;_e<Y.length;_e++){const ce=Y[_e],Me=e.getContext(ce,fe);if(Me!==null)return Me}return null}h(me,"getContext");try{const Y={alpha:!0,depth:n,stencil:s,antialias:r,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${N0}`),e.addEventListener("webglcontextlost",We,!1),e.addEventListener("webglcontextrestored",Ne,!1),e.addEventListener("webglcontextcreationerror",Xe,!1),te===null){const fe=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&fe.shift(),te=me(fe,Y),te===null)throw me(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}te.getShaderPrecisionFormat===void 0&&(te.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Y){throw console.error("THREE.WebGLRenderer: "+Y.message),Y}let de,be,we,Ae,V,X,E,ee,Q,F,O,j,N,$,I,D,H,Z,re,ue,ge,xe,pe,Oe;function Ge(){de=new ek(te),be=new YL(te,de,i),de.init(be),xe=new PO(te,de,be),we=new TO(te,de,be),Ae=new ik,V=new mO,X=new EO(te,de,we,V,be,xe,Ae),E=new qL(m),ee=new JL(m),Q=new dI(te,be),pe=new $L(te,de,Q,be),F=new tk(te,Q,Ae,pe),O=new ak(te,F,Q,Ae),re=new ok(te,be,X),D=new KL(V),j=new pO(m,E,ee,de,be,pe,D),N=new IO(m,V),$=new vO,I=new MO(de,be),Z=new jL(m,E,ee,we,O,u,o),H=new CO(m,O,be),Oe=new DO(te,Ae,be,we),ue=new XL(te,de,Ae,be),ge=new nk(te,de,Ae,be),Ae.programs=j.programs,m.capabilities=be,m.extensions=de,m.properties=V,m.renderLists=$,m.shadowMap=H,m.state=we,m.info=Ae}h(Ge,"initGLContext"),Ge();const Ie=new oA(m,te);this.xr=Ie,this.getContext=function(){return te},this.getContextAttributes=function(){return te.getContextAttributes()},this.forceContextLoss=function(){const Y=de.get("WEBGL_lose_context");Y&&Y.loseContext()},this.forceContextRestore=function(){const Y=de.get("WEBGL_lose_context");Y&&Y.restoreContext()},this.getPixelRatio=function(){return W},this.setPixelRatio=function(Y){Y!==void 0&&(W=Y,this.setSize(R,L,!1))},this.getSize=function(Y){return Y.set(R,L)},this.setSize=function(Y,fe,_e){if(Ie.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}R=Y,L=fe,e.width=Math.floor(Y*W),e.height=Math.floor(fe*W),_e!==!1&&(e.style.width=Y+"px",e.style.height=fe+"px"),this.setViewport(0,0,Y,fe)},this.getDrawingBufferSize=function(Y){return Y.set(R*W,L*W).floor()},this.setDrawingBufferSize=function(Y,fe,_e){R=Y,L=fe,W=_e,e.width=Math.floor(Y*_e),e.height=Math.floor(fe*_e),this.setViewport(0,0,Y,fe)},this.getCurrentViewport=function(Y){return Y.copy(T)},this.getViewport=function(Y){return Y.copy(S)},this.setViewport=function(Y,fe,_e,ce){Y.isVector4?S.set(Y.x,Y.y,Y.z,Y.w):S.set(Y,fe,_e,ce),we.viewport(T.copy(S).multiplyScalar(W).floor())},this.getScissor=function(Y){return Y.copy(B)},this.setScissor=function(Y,fe,_e,ce){Y.isVector4?B.set(Y.x,Y.y,Y.z,Y.w):B.set(Y,fe,_e,ce),we.scissor(P.copy(B).multiplyScalar(W).floor())},this.getScissorTest=function(){return ne},this.setScissorTest=function(Y){we.setScissorTest(ne=Y)},this.setOpaqueSort=function(Y){k=Y},this.setTransparentSort=function(Y){z=Y},this.getClearColor=function(Y){return Y.copy(Z.getClearColor())},this.setClearColor=function(){Z.setClearColor.apply(Z,arguments)},this.getClearAlpha=function(){return Z.getClearAlpha()},this.setClearAlpha=function(){Z.setClearAlpha.apply(Z,arguments)},this.clear=function(Y=!0,fe=!0,_e=!0){let ce=0;Y&&(ce|=16384),fe&&(ce|=256),_e&&(ce|=1024),te.clear(ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",We,!1),e.removeEventListener("webglcontextrestored",Ne,!1),e.removeEventListener("webglcontextcreationerror",Xe,!1),$.dispose(),I.dispose(),V.dispose(),E.dispose(),ee.dispose(),O.dispose(),pe.dispose(),Oe.dispose(),j.dispose(),Ie.dispose(),Ie.removeEventListener("sessionstart",Le),Ie.removeEventListener("sessionend",Ve),se&&(se.dispose(),se=null),Ct.stop()};function We(Y){Y.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}h(We,"onContextLost");function Ne(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const Y=Ae.autoReset,fe=H.enabled,_e=H.autoUpdate,ce=H.needsUpdate,Me=H.type;Ge(),Ae.autoReset=Y,H.enabled=fe,H.autoUpdate=_e,H.needsUpdate=ce,H.type=Me}h(Ne,"onContextRestore");function Xe(Y){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Y.statusMessage)}h(Xe,"onContextCreationError");function St(Y){const fe=Y.target;fe.removeEventListener("dispose",St),wn(fe)}h(St,"onMaterialDispose");function wn(Y){oe(Y),V.remove(Y)}h(wn,"deallocateMaterial");function oe(Y){const fe=V.get(Y).programs;fe!==void 0&&(fe.forEach(function(_e){j.releaseProgram(_e)}),Y.isShaderMaterial&&j.releaseShaderCache(Y))}h(oe,"releaseMaterialProgramReferences"),this.renderBufferDirect=function(Y,fe,_e,ce,Me,Ye){fe===null&&(fe=ae);const st=Me.isMesh&&Me.matrixWorld.determinant()<0,dt=sT(Y,fe,_e,ce,Me);we.setMaterial(ce,st);let ct=_e.index;const Tt=_e.attributes.position;if(ct===null){if(Tt===void 0||Tt.count===0)return}else if(ct.count===0)return;let yt=1;ce.wireframe===!0&&(ct=F.getWireframeAttribute(_e),yt=2),pe.setup(Me,ce,dt,_e,ct);let xt,tn=ue;ct!==null&&(xt=Q.get(ct),tn=ge,tn.setIndex(xt));const Ao=ct!==null?ct.count:Tt.count,Ra=_e.drawRange.start*yt,Ia=_e.drawRange.count*yt,xs=Ye!==null?Ye.start*yt:0,Et=Ye!==null?Ye.count*yt:1/0,Da=Math.max(Ra,xs),xn=Math.min(Ao,Ra+Ia,xs+Et)-1,Wi=Math.max(0,xn-Da+1);if(Wi!==0){if(Me.isMesh)ce.wireframe===!0?(we.setLineWidth(ce.wireframeLinewidth*J()),tn.setMode(1)):tn.setMode(4);else if(Me.isLine){let Dr=ce.linewidth;Dr===void 0&&(Dr=1),we.setLineWidth(Dr*J()),Me.isLineSegments?tn.setMode(1):Me.isLineLoop?tn.setMode(2):tn.setMode(3)}else Me.isPoints?tn.setMode(0):Me.isSprite&&tn.setMode(4);if(Me.isInstancedMesh)tn.renderInstances(Da,Wi,Me.count);else if(_e.isInstancedBufferGeometry){const Dr=Math.min(_e.instanceCount,_e._maxInstanceCount);tn.renderInstances(Da,Wi,Dr)}else tn.render(Da,Wi)}},this.compile=function(Y,fe){function _e(ce,Me,Ye){ce.transparent===!0&&ce.side===Ci?(ce.side=Ji,ce.needsUpdate=!0,Gi(ce,Me,Ye),ce.side=ha,ce.needsUpdate=!0,Gi(ce,Me,Ye),ce.side=Ci):Gi(ce,Me,Ye)}h(_e,"prepare"),f=I.get(Y),f.init(),g.push(f),Y.traverseVisible(function(ce){ce.isLight&&ce.layers.test(fe.layers)&&(f.pushLight(ce),ce.castShadow&&f.pushShadow(ce))}),f.setupLights(m.physicallyCorrectLights),Y.traverse(function(ce){const Me=ce.material;if(Me)if(Array.isArray(Me))for(let Ye=0;Ye<Me.length;Ye++){const st=Me[Ye];_e(st,Y,ce)}else _e(Me,Y,ce)}),g.pop(),f=null};let ye=null;function Ee(Y){ye&&ye(Y)}h(Ee,"onAnimationFrame");function Le(){Ct.stop()}h(Le,"onXRSessionStart");function Ve(){Ct.start()}h(Ve,"onXRSessionEnd");const Ct=new XM;Ct.setAnimationLoop(Ee),typeof self!="undefined"&&Ct.setContext(self),this.setAnimationLoop=function(Y){ye=Y,Ie.setAnimationLoop(Y),Y===null?Ct.stop():Ct.start()},Ie.addEventListener("sessionstart",Le),Ie.addEventListener("sessionend",Ve),this.render=function(Y,fe){if(fe!==void 0&&fe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;Y.matrixWorldAutoUpdate===!0&&Y.updateMatrixWorld(),fe.parent===null&&fe.matrixWorldAutoUpdate===!0&&fe.updateMatrixWorld(),Ie.enabled===!0&&Ie.isPresenting===!0&&(Ie.cameraAutoUpdate===!0&&Ie.updateCamera(fe),fe=Ie.getCamera()),Y.isScene===!0&&Y.onBeforeRender(m,Y,fe,_),f=I.get(Y,g.length),f.init(),g.push(f),q.multiplyMatrices(fe.projectionMatrix,fe.matrixWorldInverse),K.setFromProjectionMatrix(q),G=this.localClippingEnabled,ie=D.init(this.clippingPlanes,G,fe),d=$.get(Y,p.length),d.init(),p.push(d),Dn(Y,fe,0,m.sortObjects),d.finish(),m.sortObjects===!0&&d.sort(k,z),ie===!0&&D.beginShadows();const _e=f.state.shadowsArray;if(H.render(_e,Y,fe),ie===!0&&D.endShadows(),this.info.autoReset===!0&&this.info.reset(),Z.render(d,Y),f.setupLights(m.physicallyCorrectLights),fe.isArrayCamera){const ce=fe.cameras;for(let Me=0,Ye=ce.length;Me<Ye;Me++){const st=ce[Me];Xn(d,Y,st,st.viewport)}}else Xn(d,Y,fe);_!==null&&(X.updateMultisampleRenderTarget(_),X.updateRenderTargetMipmap(_)),Y.isScene===!0&&Y.onAfterRender(m,Y,fe),pe.resetDefaultState(),x=-1,w=null,g.pop(),g.length>0?f=g[g.length-1]:f=null,p.pop(),p.length>0?d=p[p.length-1]:d=null};function Dn(Y,fe,_e,ce){if(Y.visible===!1)return;if(Y.layers.test(fe.layers)){if(Y.isGroup)_e=Y.renderOrder;else if(Y.isLOD)Y.autoUpdate===!0&&Y.update(fe);else if(Y.isLight)f.pushLight(Y),Y.castShadow&&f.pushShadow(Y);else if(Y.isSprite){if(!Y.frustumCulled||K.intersectsSprite(Y)){ce&&le.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(q);const st=O.update(Y),dt=Y.material;dt.visible&&d.push(Y,st,dt,_e,le.z,null)}}else if((Y.isMesh||Y.isLine||Y.isPoints)&&(Y.isSkinnedMesh&&Y.skeleton.frame!==Ae.render.frame&&(Y.skeleton.update(),Y.skeleton.frame=Ae.render.frame),!Y.frustumCulled||K.intersectsObject(Y))){ce&&le.setFromMatrixPosition(Y.matrixWorld).applyMatrix4(q);const st=O.update(Y),dt=Y.material;if(Array.isArray(dt)){const ct=st.groups;for(let Tt=0,yt=ct.length;Tt<yt;Tt++){const xt=ct[Tt],tn=dt[xt.materialIndex];tn&&tn.visible&&d.push(Y,st,tn,_e,le.z,xt)}}else dt.visible&&d.push(Y,st,dt,_e,le.z,null)}}const Ye=Y.children;for(let st=0,dt=Ye.length;st<dt;st++)Dn(Ye[st],fe,_e,ce)}h(Dn,"projectObject");function Xn(Y,fe,_e,ce){const Me=Y.opaque,Ye=Y.transmissive,st=Y.transparent;f.setupLightsView(_e),Ye.length>0&&Mo(Me,fe,_e),ce&&we.viewport(T.copy(ce)),Me.length>0&&jt(Me,fe,_e),Ye.length>0&&jt(Ye,fe,_e),st.length>0&&jt(st,fe,_e),we.buffers.depth.setTest(!0),we.buffers.depth.setMask(!0),we.buffers.color.setMask(!0),we.setPolygonOffset(!1)}h(Xn,"renderScene");function Mo(Y,fe,_e){const ce=be.isWebGL2;se===null&&(se=new Hn(1,1,{generateMipmaps:!0,type:de.has("EXT_color_buffer_half_float")?Ol:da,minFilter:Ma,samples:ce&&r===!0?4:0})),m.getDrawingBufferSize(U),ce?se.setSize(U.x,U.y):se.setSize(Lf(U.x),Lf(U.y));const Me=m.getRenderTarget();m.setRenderTarget(se),m.clear();const Ye=m.toneMapping;m.toneMapping=Vs,jt(Y,fe,_e),m.toneMapping=Ye,X.updateMultisampleRenderTarget(se),X.updateRenderTargetMipmap(se),m.setRenderTarget(Me)}h(Mo,"renderTransmissionPass");function jt(Y,fe,_e){const ce=fe.isScene===!0?fe.overrideMaterial:null;for(let Me=0,Ye=Y.length;Me<Ye;Me++){const st=Y[Me],dt=st.object,ct=st.geometry,Tt=ce===null?st.material:ce,yt=st.group;dt.layers.test(_e.layers)&&$s(dt,fe,_e,ct,Tt,yt)}}h(jt,"renderObjects");function $s(Y,fe,_e,ce,Me,Ye){Y.onBeforeRender(m,fe,_e,ce,Me,Ye),Y.modelViewMatrix.multiplyMatrices(_e.matrixWorldInverse,Y.matrixWorld),Y.normalMatrix.getNormalMatrix(Y.modelViewMatrix),Me.onBeforeRender(m,fe,_e,ce,Y,Ye),Me.transparent===!0&&Me.side===Ci?(Me.side=Ji,Me.needsUpdate=!0,m.renderBufferDirect(_e,fe,ce,Me,Y,Ye),Me.side=ha,Me.needsUpdate=!0,m.renderBufferDirect(_e,fe,ce,Me,Y,Ye),Me.side=Ci):m.renderBufferDirect(_e,fe,ce,Me,Y,Ye),Y.onAfterRender(m,fe,_e,ce,Me,Ye)}h($s,"renderObject");function Gi(Y,fe,_e){fe.isScene!==!0&&(fe=ae);const ce=V.get(Y),Me=f.state.lights,Ye=f.state.shadowsArray,st=Me.state.version,dt=j.getParameters(Y,Me.state,Ye,fe,_e),ct=j.getProgramCacheKey(dt);let Tt=ce.programs;ce.environment=Y.isMeshStandardMaterial?fe.environment:null,ce.fog=fe.fog,ce.envMap=(Y.isMeshStandardMaterial?ee:E).get(Y.envMap||ce.environment),Tt===void 0&&(Y.addEventListener("dispose",St),Tt=new Map,ce.programs=Tt);let yt=Tt.get(ct);if(yt!==void 0){if(ce.currentProgram===yt&&ce.lightsStateVersion===st)return oy(Y,dt),yt}else dt.uniforms=j.getUniforms(Y),Y.onBuild(_e,dt,m),Y.onBeforeCompile(dt,m),yt=j.acquireProgram(dt,ct),Tt.set(ct,yt),ce.uniforms=dt.uniforms;const xt=ce.uniforms;(!Y.isShaderMaterial&&!Y.isRawShaderMaterial||Y.clipping===!0)&&(xt.clippingPlanes=D.uniform),oy(Y,dt),ce.needsLights=oT(Y),ce.lightsStateVersion=st,ce.needsLights&&(xt.ambientLightColor.value=Me.state.ambient,xt.lightProbe.value=Me.state.probe,xt.directionalLights.value=Me.state.directional,xt.directionalLightShadows.value=Me.state.directionalShadow,xt.spotLights.value=Me.state.spot,xt.spotLightShadows.value=Me.state.spotShadow,xt.rectAreaLights.value=Me.state.rectArea,xt.ltc_1.value=Me.state.rectAreaLTC1,xt.ltc_2.value=Me.state.rectAreaLTC2,xt.pointLights.value=Me.state.point,xt.pointLightShadows.value=Me.state.pointShadow,xt.hemisphereLights.value=Me.state.hemi,xt.directionalShadowMap.value=Me.state.directionalShadowMap,xt.directionalShadowMatrix.value=Me.state.directionalShadowMatrix,xt.spotShadowMap.value=Me.state.spotShadowMap,xt.spotLightMatrix.value=Me.state.spotLightMatrix,xt.spotLightMap.value=Me.state.spotLightMap,xt.pointShadowMap.value=Me.state.pointShadowMap,xt.pointShadowMatrix.value=Me.state.pointShadowMatrix);const tn=yt.getUniforms(),Ao=yu.seqWithValue(tn.seq,xt);return ce.currentProgram=yt,ce.uniformsList=Ao,yt}h(Gi,"getProgram");function oy(Y,fe){const _e=V.get(Y);_e.outputEncoding=fe.outputEncoding,_e.instancing=fe.instancing,_e.skinning=fe.skinning,_e.morphTargets=fe.morphTargets,_e.morphNormals=fe.morphNormals,_e.morphColors=fe.morphColors,_e.morphTargetsCount=fe.morphTargetsCount,_e.numClippingPlanes=fe.numClippingPlanes,_e.numIntersection=fe.numClipIntersection,_e.vertexAlphas=fe.vertexAlphas,_e.vertexTangents=fe.vertexTangents,_e.toneMapping=fe.toneMapping}h(oy,"updateCommonMaterialProperties");function sT(Y,fe,_e,ce,Me){fe.isScene!==!0&&(fe=ae),X.resetTextureUnits();const Ye=fe.fog,st=ce.isMeshStandardMaterial?fe.environment:null,dt=_===null?m.outputEncoding:_.isXRRenderTarget===!0?_.texture.encoding:xr,ct=(ce.isMeshStandardMaterial?ee:E).get(ce.envMap||st),Tt=ce.vertexColors===!0&&!!_e.attributes.color&&_e.attributes.color.itemSize===4,yt=!!ce.normalMap&&!!_e.attributes.tangent,xt=!!_e.morphAttributes.position,tn=!!_e.morphAttributes.normal,Ao=!!_e.morphAttributes.color,Ra=ce.toneMapped?m.toneMapping:Vs,Ia=_e.morphAttributes.position||_e.morphAttributes.normal||_e.morphAttributes.color,xs=Ia!==void 0?Ia.length:0,Et=V.get(ce),Da=f.state.lights;if(ie===!0&&(G===!0||Y!==w)){const Pi=Y===w&&ce.id===x;D.setState(ce,Y,Pi)}let xn=!1;ce.version===Et.__version?(Et.needsLights&&Et.lightsStateVersion!==Da.state.version||Et.outputEncoding!==dt||Me.isInstancedMesh&&Et.instancing===!1||!Me.isInstancedMesh&&Et.instancing===!0||Me.isSkinnedMesh&&Et.skinning===!1||!Me.isSkinnedMesh&&Et.skinning===!0||Et.envMap!==ct||ce.fog===!0&&Et.fog!==Ye||Et.numClippingPlanes!==void 0&&(Et.numClippingPlanes!==D.numPlanes||Et.numIntersection!==D.numIntersection)||Et.vertexAlphas!==Tt||Et.vertexTangents!==yt||Et.morphTargets!==xt||Et.morphNormals!==tn||Et.morphColors!==Ao||Et.toneMapping!==Ra||be.isWebGL2===!0&&Et.morphTargetsCount!==xs)&&(xn=!0):(xn=!0,Et.__version=ce.version);let Wi=Et.currentProgram;xn===!0&&(Wi=Gi(ce,fe,Me));let Dr=!1,hc=!1,Bp=!1;const ti=Wi.getUniforms(),So=Et.uniforms;if(we.useProgram(Wi.program)&&(Dr=!0,hc=!0,Bp=!0),ce.id!==x&&(x=ce.id,hc=!0),Dr||w!==Y){if(ti.setValue(te,"projectionMatrix",Y.projectionMatrix),be.logarithmicDepthBuffer&&ti.setValue(te,"logDepthBufFC",2/(Math.log(Y.far+1)/Math.LN2)),w!==Y&&(w=Y,hc=!0,Bp=!0),ce.isShaderMaterial||ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshStandardMaterial||ce.envMap){const Pi=ti.map.cameraPosition;Pi!==void 0&&Pi.setValue(te,le.setFromMatrixPosition(Y.matrixWorld))}(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial)&&ti.setValue(te,"isOrthographic",Y.isOrthographicCamera===!0),(ce.isMeshPhongMaterial||ce.isMeshToonMaterial||ce.isMeshLambertMaterial||ce.isMeshBasicMaterial||ce.isMeshStandardMaterial||ce.isShaderMaterial||ce.isShadowMaterial||Me.isSkinnedMesh)&&ti.setValue(te,"viewMatrix",Y.matrixWorldInverse)}if(Me.isSkinnedMesh){ti.setOptional(te,Me,"bindMatrix"),ti.setOptional(te,Me,"bindMatrixInverse");const Pi=Me.skeleton;Pi&&(be.floatVertexTextures?(Pi.boneTexture===null&&Pi.computeBoneTexture(),ti.setValue(te,"boneTexture",Pi.boneTexture,X),ti.setValue(te,"boneTextureSize",Pi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Up=_e.morphAttributes;if((Up.position!==void 0||Up.normal!==void 0||Up.color!==void 0&&be.isWebGL2===!0)&&re.update(Me,_e,ce,Wi),(hc||Et.receiveShadow!==Me.receiveShadow)&&(Et.receiveShadow=Me.receiveShadow,ti.setValue(te,"receiveShadow",Me.receiveShadow)),ce.isMeshGouraudMaterial&&ce.envMap!==null&&(So.envMap.value=ct,So.flipEnvMap.value=ct.isCubeTexture&&ct.isRenderTargetTexture===!1?-1:1),hc&&(ti.setValue(te,"toneMappingExposure",m.toneMappingExposure),Et.needsLights&&rT(So,Bp),Ye&&ce.fog===!0&&N.refreshFogUniforms(So,Ye),N.refreshMaterialUniforms(So,ce,W,L,se),yu.upload(te,Et.uniformsList,So,X)),ce.isShaderMaterial&&ce.uniformsNeedUpdate===!0&&(yu.upload(te,Et.uniformsList,So,X),ce.uniformsNeedUpdate=!1),ce.isSpriteMaterial&&ti.setValue(te,"center",Me.center),ti.setValue(te,"modelViewMatrix",Me.modelViewMatrix),ti.setValue(te,"normalMatrix",Me.normalMatrix),ti.setValue(te,"modelMatrix",Me.matrixWorld),ce.isShaderMaterial||ce.isRawShaderMaterial){const Pi=ce.uniformsGroups;for(let Vp=0,aT=Pi.length;Vp<aT;Vp++)if(be.isWebGL2){const ay=Pi[Vp];Oe.update(ay,Wi),Oe.bind(ay,Wi)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Wi}h(sT,"setProgram");function rT(Y,fe){Y.ambientLightColor.needsUpdate=fe,Y.lightProbe.needsUpdate=fe,Y.directionalLights.needsUpdate=fe,Y.directionalLightShadows.needsUpdate=fe,Y.pointLights.needsUpdate=fe,Y.pointLightShadows.needsUpdate=fe,Y.spotLights.needsUpdate=fe,Y.spotLightShadows.needsUpdate=fe,Y.rectAreaLights.needsUpdate=fe,Y.hemisphereLights.needsUpdate=fe}h(rT,"markUniformsLightsNeedsUpdate");function oT(Y){return Y.isMeshLambertMaterial||Y.isMeshToonMaterial||Y.isMeshPhongMaterial||Y.isMeshStandardMaterial||Y.isShadowMaterial||Y.isShaderMaterial&&Y.lights===!0}h(oT,"materialNeedsLights"),this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(Y,fe,_e){V.get(Y.texture).__webglTexture=fe,V.get(Y.depthTexture).__webglTexture=_e;const ce=V.get(Y);ce.__hasExternalTextures=!0,ce.__hasExternalTextures&&(ce.__autoAllocateDepthBuffer=_e===void 0,ce.__autoAllocateDepthBuffer||de.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ce.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Y,fe){const _e=V.get(Y);_e.__webglFramebuffer=fe,_e.__useDefaultFramebuffer=fe===void 0},this.setRenderTarget=function(Y,fe=0,_e=0){_=Y,y=fe,b=_e;let ce=!0,Me=null,Ye=!1,st=!1;if(Y){const ct=V.get(Y);ct.__useDefaultFramebuffer!==void 0?(we.bindFramebuffer(36160,null),ce=!1):ct.__webglFramebuffer===void 0?X.setupRenderTarget(Y):ct.__hasExternalTextures&&X.rebindTextures(Y,V.get(Y.texture).__webglTexture,V.get(Y.depthTexture).__webglTexture);const Tt=Y.texture;(Tt.isData3DTexture||Tt.isDataArrayTexture||Tt.isCompressedArrayTexture)&&(st=!0);const yt=V.get(Y).__webglFramebuffer;Y.isWebGLCubeRenderTarget?(Me=yt[fe],Ye=!0):be.isWebGL2&&Y.samples>0&&X.useMultisampledRTT(Y)===!1?Me=V.get(Y).__webglMultisampledFramebuffer:Me=yt,T.copy(Y.viewport),P.copy(Y.scissor),M=Y.scissorTest}else T.copy(S).multiplyScalar(W).floor(),P.copy(B).multiplyScalar(W).floor(),M=ne;if(we.bindFramebuffer(36160,Me)&&be.drawBuffers&&ce&&we.drawBuffers(Y,Me),we.viewport(T),we.scissor(P),we.setScissorTest(M),Ye){const ct=V.get(Y.texture);te.framebufferTexture2D(36160,36064,34069+fe,ct.__webglTexture,_e)}else if(st){const ct=V.get(Y.texture),Tt=fe||0;te.framebufferTextureLayer(36160,36064,ct.__webglTexture,_e||0,Tt)}x=-1},this.readRenderTargetPixels=function(Y,fe,_e,ce,Me,Ye,st){if(!(Y&&Y.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let dt=V.get(Y).__webglFramebuffer;if(Y.isWebGLCubeRenderTarget&&st!==void 0&&(dt=dt[st]),dt){we.bindFramebuffer(36160,dt);try{const ct=Y.texture,Tt=ct.format,yt=ct.type;if(Tt!==Bi&&xe.convert(Tt)!==te.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const xt=yt===Ol&&(de.has("EXT_color_buffer_half_float")||be.isWebGL2&&de.has("EXT_color_buffer_float"));if(yt!==da&&xe.convert(yt)!==te.getParameter(35738)&&!(yt===to&&(be.isWebGL2||de.has("OES_texture_float")||de.has("WEBGL_color_buffer_float")))&&!xt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}fe>=0&&fe<=Y.width-ce&&_e>=0&&_e<=Y.height-Me&&te.readPixels(fe,_e,ce,Me,xe.convert(Tt),xe.convert(yt),Ye)}finally{const ct=_!==null?V.get(_).__webglFramebuffer:null;we.bindFramebuffer(36160,ct)}}},this.copyFramebufferToTexture=function(Y,fe,_e=0){const ce=Math.pow(2,-_e),Me=Math.floor(fe.image.width*ce),Ye=Math.floor(fe.image.height*ce);X.setTexture2D(fe,0),te.copyTexSubImage2D(3553,_e,0,0,Y.x,Y.y,Me,Ye),we.unbindTexture()},this.copyTextureToTexture=function(Y,fe,_e,ce=0){const Me=fe.image.width,Ye=fe.image.height,st=xe.convert(_e.format),dt=xe.convert(_e.type);X.setTexture2D(_e,0),te.pixelStorei(37440,_e.flipY),te.pixelStorei(37441,_e.premultiplyAlpha),te.pixelStorei(3317,_e.unpackAlignment),fe.isDataTexture?te.texSubImage2D(3553,ce,Y.x,Y.y,Me,Ye,st,dt,fe.image.data):fe.isCompressedTexture?te.compressedTexSubImage2D(3553,ce,Y.x,Y.y,fe.mipmaps[0].width,fe.mipmaps[0].height,st,fe.mipmaps[0].data):te.texSubImage2D(3553,ce,Y.x,Y.y,st,dt,fe.image),ce===0&&_e.generateMipmaps&&te.generateMipmap(3553),we.unbindTexture()},this.copyTextureToTexture3D=function(Y,fe,_e,ce,Me=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Ye=Y.max.x-Y.min.x+1,st=Y.max.y-Y.min.y+1,dt=Y.max.z-Y.min.z+1,ct=xe.convert(ce.format),Tt=xe.convert(ce.type);let yt;if(ce.isData3DTexture)X.setTexture3D(ce,0),yt=32879;else if(ce.isDataArrayTexture)X.setTexture2DArray(ce,0),yt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}te.pixelStorei(37440,ce.flipY),te.pixelStorei(37441,ce.premultiplyAlpha),te.pixelStorei(3317,ce.unpackAlignment);const xt=te.getParameter(3314),tn=te.getParameter(32878),Ao=te.getParameter(3316),Ra=te.getParameter(3315),Ia=te.getParameter(32877),xs=_e.isCompressedTexture?_e.mipmaps[0]:_e.image;te.pixelStorei(3314,xs.width),te.pixelStorei(32878,xs.height),te.pixelStorei(3316,Y.min.x),te.pixelStorei(3315,Y.min.y),te.pixelStorei(32877,Y.min.z),_e.isDataTexture||_e.isData3DTexture?te.texSubImage3D(yt,Me,fe.x,fe.y,fe.z,Ye,st,dt,ct,Tt,xs.data):_e.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),te.compressedTexSubImage3D(yt,Me,fe.x,fe.y,fe.z,Ye,st,dt,ct,xs.data)):te.texSubImage3D(yt,Me,fe.x,fe.y,fe.z,Ye,st,dt,ct,Tt,xs),te.pixelStorei(3314,xt),te.pixelStorei(32878,tn),te.pixelStorei(3316,Ao),te.pixelStorei(3315,Ra),te.pixelStorei(32877,Ia),Me===0&&ce.generateMipmaps&&te.generateMipmap(yt),we.unbindTexture()},this.initTexture=function(Y){Y.isCubeTexture?X.setTextureCube(Y,0):Y.isData3DTexture?X.setTexture3D(Y,0):Y.isDataArrayTexture||Y.isCompressedArrayTexture?X.setTexture2DArray(Y,0):X.setTexture2D(Y,0),we.unbindTexture()},this.resetState=function(){y=0,b=0,_=null,we.reset(),pe.reset()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}h(aA,"WebGLRenderer");class lA extends aA{}h(lA,"WebGL1Renderer");lA.prototype.isWebGL1Renderer=!0;class Nu extends vt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.backgroundBlurriness=this.backgroundBlurriness),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}h(Nu,"Scene");class cA{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Ug,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=vs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,r=this.stride;s<r;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=vs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=vs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}h(cA,"InterleavedBuffer");const ni=new A;class bp{constructor(e,t,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ni.fromBufferAttribute(this,t),ni.applyMatrix4(e),this.setXYZ(t,ni.x,ni.y,ni.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ni.fromBufferAttribute(this,t),ni.applyNormalMatrix(e),this.setXYZ(t,ni.x,ni.y,ni.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ni.fromBufferAttribute(this,t),ni.transformDirection(e),this.setXYZ(t,ni.x,ni.y,ni.z);return this}setX(e,t){return this.normalized&&(t=Nt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Nt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Nt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Nt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=pr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=pr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=pr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=pr(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Nt(t,this.array),n=Nt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Nt(t,this.array),n=Nt(n,this.array),s=Nt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Nt(t,this.array),n=Nt(n,this.array),s=Nt(s,this.array),r=Nt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=r,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return new Zt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new bp(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)t.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}h(bp,"InterleavedBufferAttribute");const cb=new A,ub=new wt,hb=new wt,kO=new A,db=new ve;class j0 extends Re{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ve,this.bindMatrixInverse=new ve}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new wt,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,s=this.geometry;ub.fromBufferAttribute(s.attributes.skinIndex,e),hb.fromBufferAttribute(s.attributes.skinWeight,e),cb.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){const o=hb.getComponent(r);if(o!==0){const a=ub.getComponent(r);db.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(kO.copy(cb).applyMatrix4(db),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}h(j0,"SkinnedMesh");class Fu extends vt{constructor(){super(),this.isBone=!0,this.type="Bone"}}h(Fu,"Bone");class uA extends Pn{constructor(e=null,t=1,n=1,s,r,o,a,l,c=Cn,u=Cn,d,f){super(null,o,a,l,c,u,s,r,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}h(uA,"DataTexture");const fb=new ve,OO=new ve;class rh{constructor(e=[],t=[]){this.uuid=vs(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new ve)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new ve;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let r=0,o=e.length;r<o;r++){const a=e[r]?e[r].matrixWorld:OO;fb.multiplyMatrices(a,t[r]),fb.toArray(n,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new rh(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=VM(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new uA(t,e,e,Bi,to);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const r=e.bones[n];let o=t[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new Fu),this.bones.push(o),this.boneInverses.push(new ve().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,r=t.length;s<r;s++){const o=t[s];e.bones.push(o.uuid);const a=n[s];e.boneInverses.push(a.toArray())}return e}}h(rh,"Skeleton");class jg extends Zt{constructor(e,t,n,s=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}h(jg,"InstancedBufferAttribute");const pb=new ve,mb=new ve,Kh=[],NO=new ve,_c=new Re;class hA extends Re{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new jg(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1;for(let s=0;s<n;s++)this.setMatrixAt(s,NO)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,s=this.count;if(_c.geometry=this.geometry,_c.material=this.material,_c.material!==void 0)for(let r=0;r<s;r++){this.getMatrixAt(r,pb),mb.multiplyMatrices(n,pb),_c.matrixWorld=mb,_c.raycast(e,Kh);for(let o=0,a=Kh.length;o<a;o++){const l=Kh[o];l.instanceId=r,l.object=this,t.push(l)}Kh.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new jg(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}h(hA,"InstancedMesh");class $n extends gi{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Te(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}h($n,"LineBasicMaterial");const gb=new A,vb=new A,yb=new ve,Em=new vo,qh=new go;class vn extends vt{constructor(e=new et,t=new $n){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let s=1,r=t.count;s<r;s++)gb.fromBufferAttribute(t,s-1),vb.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=gb.distanceTo(vb);e.setAttribute("lineDistance",new Fe(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),qh.copy(n.boundingSphere),qh.applyMatrix4(s),qh.radius+=r,e.ray.intersectsSphere(qh)===!1)return;yb.copy(s).invert(),Em.copy(e.ray).applyMatrix4(yb);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new A,u=new A,d=new A,f=new A,p=this.isLineSegments?2:1,g=n.index,v=n.attributes.position;if(g!==null){const y=Math.max(0,o.start),b=Math.min(g.count,o.start+o.count);for(let _=y,x=b-1;_<x;_+=p){const w=g.getX(_),T=g.getX(_+1);if(c.fromBufferAttribute(v,w),u.fromBufferAttribute(v,T),Em.distanceSqToSegment(c,u,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(f);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const y=Math.max(0,o.start),b=Math.min(v.count,o.start+o.count);for(let _=y,x=b-1;_<x;_+=p){if(c.fromBufferAttribute(v,_),u.fromBufferAttribute(v,_+1),Em.distanceSqToSegment(c,u,f,d)>l)continue;f.applyMatrix4(this.matrixWorld);const T=e.ray.origin.distanceTo(f);T<e.near||T>e.far||t.push({distance:T,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}h(vn,"Line");const _b=new A,bb=new A;class Ws extends vn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let s=0,r=t.count;s<r;s+=2)_b.fromBufferAttribute(t,s),bb.fromBufferAttribute(t,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+_b.distanceTo(bb);e.setAttribute("lineDistance",new Fe(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}h(Ws,"LineSegments");class dA extends vn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}h(dA,"LineLoop");class mr extends gi{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Te(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}h(mr,"PointsMaterial");const wb=new ve,$g=new vo,Zh=new go,Qh=new A;class la extends vt{constructor(e=new et,t=new mr){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,r=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Zh.copy(n.boundingSphere),Zh.applyMatrix4(s),Zh.radius+=r,e.ray.intersectsSphere(Zh)===!1)return;wb.copy(s).invert(),$g.copy(e.ray).applyMatrix4(wb);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,d=n.attributes.position;if(c!==null){const f=Math.max(0,o.start),p=Math.min(c.count,o.start+o.count);for(let g=f,m=p;g<m;g++){const v=c.getX(g);Qh.fromBufferAttribute(d,v),xb(Qh,v,l,s,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let g=f,m=p;g<m;g++)Qh.fromBufferAttribute(d,g),xb(Qh,g,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}h(la,"Points");function xb(i,e,t,n,s,r,o){const a=$g.distanceSqToPoint(i);if(a<t){const l=new A;$g.closestPointToPoint(i,l),l.applyMatrix4(n);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}h(xb,"testPoint");class $0{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),r=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),r+=n.distanceTo(s),t.push(r),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let s=0;const r=n.length;let o;t?o=t:o=e*n[r-1];let a=0,l=r-1,c;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),c=n[s]-o,c<0)a=s+1;else if(c>0)l=s-1;else{l=s;break}if(s=l,n[s]===o)return s/(r-1);const u=n[s],f=n[s+1]-u,p=(o-u)/f;return(s+p)/(r-1)}getTangent(e,t){let s=e-1e-4,r=e+1e-4;s<0&&(s=0),r>1&&(r=1);const o=this.getPoint(s),a=this.getPoint(r),l=t||(o.isVector2?new je:new A);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new A,s=[],r=[],o=[],a=new A,l=new ve;for(let p=0;p<=e;p++){const g=p/e;s[p]=this.getTangentAt(g,new A)}r[0]=new A,o[0]=new A;let c=Number.MAX_VALUE;const u=Math.abs(s[0].x),d=Math.abs(s[0].y),f=Math.abs(s[0].z);u<=c&&(c=u,n.set(1,0,0)),d<=c&&(c=d,n.set(0,1,0)),f<=c&&n.set(0,0,1),a.crossVectors(s[0],n).normalize(),r[0].crossVectors(s[0],a),o[0].crossVectors(s[0],r[0]);for(let p=1;p<=e;p++){if(r[p]=r[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(s[p-1],s[p]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(Gn(s[p-1].dot(s[p]),-1,1));r[p].applyMatrix4(l.makeRotationAxis(a,g))}o[p].crossVectors(s[p],r[p])}if(t===!0){let p=Math.acos(Gn(r[0].dot(r[e]),-1,1));p/=e,s[0].dot(a.crossVectors(r[0],r[e]))>0&&(p=-p);for(let g=1;g<=e;g++)r[g].applyMatrix4(l.makeRotationAxis(s[g],p*g)),o[g].crossVectors(s[g],r[g])}return{tangents:s,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}h($0,"Curve");class wp extends et{constructor(e=1,t=8,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);const r=[],o=[],a=[],l=[],c=new A,u=new je;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let d=0,f=3;d<=t;d++,f+=3){const p=n+d/t*s;c.x=e*Math.cos(p),c.y=e*Math.sin(p),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[f]/e+1)/2,u.y=(o[f+1]/e+1)/2,l.push(u.x,u.y)}for(let d=1;d<=t;d++)r.push(d,d+1,0);this.setIndex(r),this.setAttribute("position",new Fe(o,3)),this.setAttribute("normal",new Fe(a,3)),this.setAttribute("uv",new Fe(l,2))}static fromJSON(e){return new wp(e.radius,e.segments,e.thetaStart,e.thetaLength)}}h(wp,"CircleGeometry");class On extends et{constructor(e=1,t=1,n=1,s=8,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const u=[],d=[],f=[],p=[];let g=0;const m=[],v=n/2;let y=0;b(),o===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(u),this.setAttribute("position",new Fe(d,3)),this.setAttribute("normal",new Fe(f,3)),this.setAttribute("uv",new Fe(p,2));function b(){const x=new A,w=new A;let T=0;const P=(t-e)/n;for(let M=0;M<=r;M++){const R=[],L=M/r,W=L*(t-e)+e;for(let k=0;k<=s;k++){const z=k/s,S=z*l+a,B=Math.sin(S),ne=Math.cos(S);w.x=W*B,w.y=-L*n+v,w.z=W*ne,d.push(w.x,w.y,w.z),x.set(B,P,ne).normalize(),f.push(x.x,x.y,x.z),p.push(z,1-L),R.push(g++)}m.push(R)}for(let M=0;M<s;M++)for(let R=0;R<r;R++){const L=m[R][M],W=m[R+1][M],k=m[R+1][M+1],z=m[R][M+1];u.push(L,W,z),u.push(W,k,z),T+=6}c.addGroup(y,T,0),y+=T}h(b,"generateTorso");function _(x){const w=g,T=new je,P=new A;let M=0;const R=x===!0?e:t,L=x===!0?1:-1;for(let k=1;k<=s;k++)d.push(0,v*L,0),f.push(0,L,0),p.push(.5,.5),g++;const W=g;for(let k=0;k<=s;k++){const S=k/s*l+a,B=Math.cos(S),ne=Math.sin(S);P.x=R*ne,P.y=v*L,P.z=R*B,d.push(P.x,P.y,P.z),f.push(0,L,0),T.x=B*.5+.5,T.y=ne*.5*L+.5,p.push(T.x,T.y),g++}for(let k=0;k<s;k++){const z=w+k,S=W+k;x===!0?u.push(S,S+1,z):u.push(S+1,S,z),M+=3}c.addGroup(y,M,x===!0?1:2),y+=M}h(_,"generateCap")}static fromJSON(e){return new On(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}h(On,"CylinderGeometry");class xp extends On{constructor(e=1,t=1,n=8,s=1,r=!1,o=0,a=Math.PI*2){super(0,e,t,n,s,r,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(e){return new xp(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}h(xp,"ConeGeometry");class Mp extends et{constructor(e=[],t=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};const r=[],o=[];a(s),c(n),u(),this.setAttribute("position",new Fe(r,3)),this.setAttribute("normal",new Fe(r.slice(),3)),this.setAttribute("uv",new Fe(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const _=new A,x=new A,w=new A;for(let T=0;T<t.length;T+=3)p(t[T+0],_),p(t[T+1],x),p(t[T+2],w),l(_,x,w,b)}h(a,"subdivide");function l(b,_,x,w){const T=w+1,P=[];for(let M=0;M<=T;M++){P[M]=[];const R=b.clone().lerp(x,M/T),L=_.clone().lerp(x,M/T),W=T-M;for(let k=0;k<=W;k++)k===0&&M===T?P[M][k]=R:P[M][k]=R.clone().lerp(L,k/W)}for(let M=0;M<T;M++)for(let R=0;R<2*(T-M)-1;R++){const L=Math.floor(R/2);R%2===0?(f(P[M][L+1]),f(P[M+1][L]),f(P[M][L])):(f(P[M][L+1]),f(P[M+1][L+1]),f(P[M+1][L]))}}h(l,"subdivideFace");function c(b){const _=new A;for(let x=0;x<r.length;x+=3)_.x=r[x+0],_.y=r[x+1],_.z=r[x+2],_.normalize().multiplyScalar(b),r[x+0]=_.x,r[x+1]=_.y,r[x+2]=_.z}h(c,"applyRadius");function u(){const b=new A;for(let _=0;_<r.length;_+=3){b.x=r[_+0],b.y=r[_+1],b.z=r[_+2];const x=v(b)/2/Math.PI+.5,w=y(b)/Math.PI+.5;o.push(x,1-w)}g(),d()}h(u,"generateUVs");function d(){for(let b=0;b<o.length;b+=6){const _=o[b+0],x=o[b+2],w=o[b+4],T=Math.max(_,x,w),P=Math.min(_,x,w);T>.9&&P<.1&&(_<.2&&(o[b+0]+=1),x<.2&&(o[b+2]+=1),w<.2&&(o[b+4]+=1))}}h(d,"correctSeam");function f(b){r.push(b.x,b.y,b.z)}h(f,"pushVertex");function p(b,_){const x=b*3;_.x=e[x+0],_.y=e[x+1],_.z=e[x+2]}h(p,"getVertexByIndex");function g(){const b=new A,_=new A,x=new A,w=new A,T=new je,P=new je,M=new je;for(let R=0,L=0;R<r.length;R+=9,L+=6){b.set(r[R+0],r[R+1],r[R+2]),_.set(r[R+3],r[R+4],r[R+5]),x.set(r[R+6],r[R+7],r[R+8]),T.set(o[L+0],o[L+1]),P.set(o[L+2],o[L+3]),M.set(o[L+4],o[L+5]),w.copy(b).add(_).add(x).divideScalar(3);const W=v(w);m(T,L+0,b,W),m(P,L+2,_,W),m(M,L+4,x,W)}}h(g,"correctUVs");function m(b,_,x,w){w<0&&b.x===1&&(o[_]=b.x-1),x.x===0&&x.z===0&&(o[_]=w/2/Math.PI+.5)}h(m,"correctUV");function v(b){return Math.atan2(b.z,-b.x)}h(v,"azimuth");function y(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}h(y,"inclination")}static fromJSON(e){return new Mp(e.vertices,e.indices,e.radius,e.details)}}h(Mp,"PolyhedronGeometry");class no extends Mp{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new no(e.radius,e.detail)}}h(no,"OctahedronGeometry");class oh extends et{constructor(e=1,t=32,n=16,s=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:r,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const u=[],d=new A,f=new A,p=[],g=[],m=[],v=[];for(let y=0;y<=n;y++){const b=[],_=y/n;let x=0;y==0&&o==0?x=.5/t:y==n&&l==Math.PI&&(x=-.5/t);for(let w=0;w<=t;w++){const T=w/t;d.x=-e*Math.cos(s+T*r)*Math.sin(o+_*a),d.y=e*Math.cos(o+_*a),d.z=e*Math.sin(s+T*r)*Math.sin(o+_*a),g.push(d.x,d.y,d.z),f.copy(d).normalize(),m.push(f.x,f.y,f.z),v.push(T+x,1-_),b.push(c++)}u.push(b)}for(let y=0;y<n;y++)for(let b=0;b<t;b++){const _=u[y][b+1],x=u[y][b],w=u[y+1][b],T=u[y+1][b+1];(y!==0||o>0)&&p.push(_,x,T),(y!==n-1||l<Math.PI)&&p.push(x,w,T)}this.setIndex(p),this.setAttribute("position",new Fe(g,3)),this.setAttribute("normal",new Fe(m,3)),this.setAttribute("uv",new Fe(v,2))}static fromJSON(e){return new oh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}h(oh,"SphereGeometry$1");class eo extends et{constructor(e=1,t=.4,n=8,s=6,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:r},n=Math.floor(n),s=Math.floor(s);const o=[],a=[],l=[],c=[],u=new A,d=new A,f=new A;for(let p=0;p<=n;p++)for(let g=0;g<=s;g++){const m=g/s*r,v=p/n*Math.PI*2;d.x=(e+t*Math.cos(v))*Math.cos(m),d.y=(e+t*Math.cos(v))*Math.sin(m),d.z=t*Math.sin(v),a.push(d.x,d.y,d.z),u.x=e*Math.cos(m),u.y=e*Math.sin(m),f.subVectors(d,u).normalize(),l.push(f.x,f.y,f.z),c.push(g/s),c.push(p/n)}for(let p=1;p<=n;p++)for(let g=1;g<=s;g++){const m=(s+1)*p+g-1,v=(s+1)*(p-1)+g-1,y=(s+1)*(p-1)+g,b=(s+1)*p+g;o.push(m,v,b),o.push(v,y,b)}this.setIndex(o),this.setAttribute("position",new Fe(a,3)),this.setAttribute("normal",new Fe(l,3)),this.setAttribute("uv",new Fe(c,2))}static fromJSON(e){return new eo(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}h(eo,"TorusGeometry");class Pr extends gi{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Te(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ih,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}h(Pr,"MeshStandardMaterial");class _o extends Pr{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new je(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Gn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Te(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Te(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Te(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}h(_o,"MeshPhysicalMaterial");class _u extends gi{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Te(16777215),this.specular=new Te(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ih,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=dp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}h(_u,"MeshPhongMaterial");class X0 extends gi{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Te(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Te(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ih,this.normalScale=new je(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=dp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}h(X0,"MeshLambertMaterial");function Hr(i,e,t){return fA(i)?new i.constructor(i.subarray(e,t!==void 0?t:i.length)):i.slice(e,t)}h(Hr,"arraySlice");function Jh(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}h(Jh,"convertArray");function fA(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}h(fA,"isTypedArray");function FO(i){function e(s,r){return i[s]-i[r]}h(e,"compareTime");const t=i.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n}h(FO,"getKeyframeOrder");function Mb(i,e,t){const n=i.length,s=new i.constructor(n);for(let r=0,o=0;o!==n;++r){const a=t[r]*e;for(let l=0;l!==e;++l)s[o++]=i[a+l]}return s}h(Mb,"sortedArray");function pA(i,e,t,n){let s=1,r=i[0];for(;r!==void 0&&r[n]===void 0;)r=i[s++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(e.push(r.time),t.push.apply(t,o)),r=i[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(e.push(r.time),o.toArray(t,t.length)),r=i[s++];while(r!==void 0);else do o=r[n],o!==void 0&&(e.push(r.time),t.push(o)),r=i[s++];while(r!==void 0)}h(pA,"flattenJSON");class Zl{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,s=t[n],r=t[n-1];e:{t:{let o;n:{i:if(!(e<s)){for(let a=n+2;;){if(s===void 0){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(r=s,s=t[++n],e<s)break t}o=t.length;break n}if(!(e>=r)){const a=t[1];e<a&&(n=2,r=a);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(s=r,r=t[--n-1],e>=r)break t}o=n,n=0;break n}break e}for(;n<o;){const a=n+o>>>1;e<t[a]?o=a:n=a+1}if(s=t[n],r=t[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,s)}return this.interpolate_(n,r,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s;for(let o=0;o!==s;++o)t[o]=n[r+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}h(Zl,"Interpolant");class mA extends Zl{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:T_,endingEnd:T_}}intervalChanged_(e,t,n){const s=this.parameterPositions;let r=e-2,o=e+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case E_:r=e,a=2*t-n;break;case P_:r=s.length-2,a=t+s[r]-s[r+1];break;default:r=e,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case E_:o=e,l=2*n-t;break;case P_:o=1,l=n+s[1]-s[0];break;default:o=e-1,l=t}const c=(n-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-n),this._offsetPrev=r*u,this._offsetNext=o*u}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,f=this._weightPrev,p=this._weightNext,g=(n-t)/(s-t),m=g*g,v=m*g,y=-f*v+2*f*m-f*g,b=(1+f)*v+(-1.5-2*f)*m+(-.5+f)*g+1,_=(-1-p)*v+(1.5+p)*m+.5*g,x=p*v-p*m;for(let w=0;w!==a;++w)r[w]=y*o[u+w]+b*o[c+w]+_*o[l+w]+x*o[d+w];return r}}h(mA,"CubicInterpolant");class gA extends Zl{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(n-t)/(s-t),d=1-u;for(let f=0;f!==a;++f)r[f]=o[c+f]*d+o[l+f]*u;return r}}h(gA,"LinearInterpolant");class vA extends Zl{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}h(vA,"DiscreteInterpolant");class ws{constructor(e,t,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Jh(t,this.TimeBufferType),this.values=Jh(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Jh(e.times,Array),values:Jh(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new vA(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new gA(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new mA(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Fl:t=this.InterpolantFactoryMethodDiscrete;break;case fa:t=this.InterpolantFactoryMethodLinear;break;case nm:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Fl;case this.InterpolantFactoryMethodLinear:return fa;case this.InterpolantFactoryMethodSmooth:return nm}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const n=this.times,s=n.length;let r=0,o=s-1;for(;r!==s&&n[r]<e;)++r;for(;o!==-1&&n[o]>t;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=Hr(n,r,o),this.values=Hr(this.values,r*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==r;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(s!==void 0&&fA(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=Hr(this.times),t=Hr(this.values),n=this.getValueSize(),s=this.getInterpolation()===nm,r=e.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(s)l=!0;else{const d=a*n,f=d-n,p=d+n;for(let g=0;g!==n;++g){const m=t[d+g];if(m!==t[f+g]||m!==t[p+g]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*n,f=o*n;for(let p=0;p!==n;++p)t[f+p]=t[d+p]}++o}}if(r>0){e[o]=e[r];for(let a=r*n,l=o*n,c=0;c!==n;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=Hr(e,0,o),this.values=Hr(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=Hr(this.times,0),t=Hr(this.values,0),n=this.constructor,s=new n(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}h(ws,"KeyframeTrack");ws.prototype.TimeBufferType=Float32Array;ws.prototype.ValueBufferType=Float32Array;ws.prototype.DefaultInterpolation=fa;class Sa extends ws{}h(Sa,"BooleanKeyframeTrack");Sa.prototype.ValueTypeName="bool";Sa.prototype.ValueBufferType=Array;Sa.prototype.DefaultInterpolation=Fl;Sa.prototype.InterpolantFactoryMethodLinear=void 0;Sa.prototype.InterpolantFactoryMethodSmooth=void 0;class Y0 extends ws{}h(Y0,"ColorKeyframeTrack");Y0.prototype.ValueTypeName="color";class ma extends ws{}h(ma,"NumberKeyframeTrack");ma.prototype.ValueTypeName="number";class yA extends Zl{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-t)/(s-t);let c=e*a;for(let u=c+a;c!==u;c+=4)Be.slerpFlat(r,0,o,c-a,o,c,l);return r}}h(yA,"QuaternionLinearInterpolant");class Mr extends ws{InterpolantFactoryMethodLinear(e){return new yA(this.times,this.values,this.getValueSize(),e)}}h(Mr,"QuaternionKeyframeTrack");Mr.prototype.ValueTypeName="quaternion";Mr.prototype.DefaultInterpolation=fa;Mr.prototype.InterpolantFactoryMethodSmooth=void 0;class Ca extends ws{}h(Ca,"StringKeyframeTrack");Ca.prototype.ValueTypeName="string";Ca.prototype.ValueBufferType=Array;Ca.prototype.DefaultInterpolation=Fl;Ca.prototype.InterpolantFactoryMethodLinear=void 0;Ca.prototype.InterpolantFactoryMethodSmooth=void 0;class ga extends ws{}h(ga,"VectorKeyframeTrack");ga.prototype.ValueTypeName="vector";class K0{constructor(e,t=-1,n,s=DR){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=vs(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,s=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(BO(n[o]).scale(s));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,o=n.length;r!==o;++r)t.push(ws.toJSON(n[r]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const r=t.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const u=FO(l);l=Mb(l,1,u),c=Mb(c,1,u),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new ma(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(r);if(u&&u.length>1){const d=u[1];let f=s[d];f||(s[d]=f=[]),f.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=h(function(d,f,p,g,m){if(p.length!==0){const v=[],y=[];pA(p,v,y,g),v.length!==0&&m.push(new d(f,v,y))}},"addNonemptyTrack"),s=[],r=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const f=c[d].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let g;for(g=0;g<f.length;g++)if(f[g].morphTargets)for(let m=0;m<f[g].morphTargets.length;m++)p[f[g].morphTargets[m]]=-1;for(const m in p){const v=[],y=[];for(let b=0;b!==f[g].morphTargets.length;++b){const _=f[g];v.push(_.time),y.push(_.morphTarget===m?1:0)}s.push(new ma(".morphTargetInfluence["+m+"]",v,y))}l=p.length*o}else{const p=".bones["+t[d].name+"]";n(ga,p+".position",f,"pos",s),n(Mr,p+".quaternion",f,"rot",s),n(ga,p+".scale",f,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,s=e.length;n!==s;++n){const r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}h(K0,"AnimationClip");function zO(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ma;case"vector":case"vector2":case"vector3":case"vector4":return ga;case"color":return Y0;case"quaternion":return Mr;case"bool":case"boolean":return Sa;case"string":return Ca}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}h(zO,"getTrackTypeForValueTypeName");function BO(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=zO(i.type);if(i.times===void 0){const t=[],n=[];pA(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}h(BO,"parseKeyframeTrack");const Bl={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class q0{constructor(e,t,n){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,r===!1&&s.onStart!==void 0&&s.onStart(u,o,a),r=!0},this.itemEnd=function(u){o++,s.onProgress!==void 0&&s.onProgress(u,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,f=c.length;d<f;d+=2){const p=c[d],g=c[d+1];if(p.global&&(p.lastIndex=0),p.test(u))return g}return null}}}h(q0,"LoadingManager");const UO=new q0;class bo{constructor(e){this.manager=e!==void 0?e:UO,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,r){n.load(e,s,t,r)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}h(bo,"Loader");const Js={};class _A extends Error{constructor(e,t){super(e),this.response=t}}h(_A,"HttpError");class ah extends bo{constructor(e){super(e)}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Bl.get(e);if(r!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(r),this.manager.itemEnd(e)},0),r;if(Js[e]!==void 0){Js[e].push({onLoad:t,onProgress:n,onError:s});return}Js[e]=[],Js[e].push({onLoad:t,onProgress:n,onError:s});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream=="undefined"||c.body===void 0||c.body.getReader===void 0)return c;const u=Js[e],d=c.body.getReader(),f=c.headers.get("Content-Length"),p=f?parseInt(f):0,g=p!==0;let m=0;const v=new ReadableStream({start(y){b();function b(){d.read().then(({done:_,value:x})=>{if(_)y.close();else{m+=x.byteLength;const w=new ProgressEvent("progress",{lengthComputable:g,loaded:m,total:p});for(let T=0,P=u.length;T<P;T++){const M=u[T];M.onProgress&&M.onProgress(w)}y.enqueue(x),b()}})}h(b,"readData")}});return new Response(v)}else throw new _A(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a===void 0)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,p=new TextDecoder(f);return c.arrayBuffer().then(g=>p.decode(g))}}}).then(c=>{Bl.add(e,c);const u=Js[e];delete Js[e];for(let d=0,f=u.length;d<f;d++){const p=u[d];p.onLoad&&p.onLoad(c)}}).catch(c=>{const u=Js[e];if(u===void 0)throw this.manager.itemError(e),c;delete Js[e];for(let d=0,f=u.length;d<f;d++){const p=u[d];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}h(ah,"FileLoader");class bA extends bo{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Bl.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a=Ou("img");function l(){u(),Bl.add(e,this),t&&t(this),r.manager.itemEnd(e)}h(l,"onImageLoad");function c(d){u(),s&&s(d),r.manager.itemError(e),r.manager.itemEnd(e)}h(c,"onImageError");function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return h(u,"removeEventListeners"),a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(e),a.src=e,a}}h(bA,"ImageLoader");class Ap extends bo{constructor(e){super(e)}load(e,t,n,s){const r=new Pn,o=new bA(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){r.image=a,r.needsUpdate=!0,t!==void 0&&t(r)},n,s),r}}h(Ap,"TextureLoader");class Ql extends vt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Te(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}h(Ql,"Light");class wA extends Ql{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(vt.DefaultUp),this.updateMatrix(),this.groundColor=new Te(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}h(wA,"HemisphereLight");const Pm=new ve,Ab=new A,Sb=new A;class Sp{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new je(512,512),this.map=null,this.mapPass=null,this.matrix=new ve,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new sh,this._frameExtents=new je(1,1),this._viewportCount=1,this._viewports=[new wt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Ab.setFromMatrixPosition(e.matrixWorld),t.position.copy(Ab),Sb.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Sb),t.updateMatrixWorld(),Pm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Pm),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Pm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}h(Sp,"LightShadow");class xA extends Sp{constructor(){super(new Fn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=ku*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(n!==t.fov||s!==t.aspect||r!==t.far)&&(t.fov=n,t.aspect=s,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}h(xA,"SpotLightShadow");class Cp extends Ql{constructor(e,t,n=0,s=Math.PI/3,r=0,o=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(vt.DefaultUp),this.updateMatrix(),this.target=new vt,this.distance=n,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new xA}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}h(Cp,"SpotLight");const Cb=new ve,bc=new A,Rm=new A;class MA extends Sp{constructor(){super(new Fn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new je(4,2),this._viewportCount=6,this._viewports=[new wt(2,1,1,1),new wt(0,1,1,1),new wt(3,1,1,1),new wt(1,1,1,1),new wt(3,0,1,1),new wt(1,0,1,1)],this._cubeDirections=[new A(1,0,0),new A(-1,0,0),new A(0,0,1),new A(0,0,-1),new A(0,1,0),new A(0,-1,0)],this._cubeUps=[new A(0,1,0),new A(0,1,0),new A(0,1,0),new A(0,1,0),new A(0,0,1),new A(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,s=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),bc.setFromMatrixPosition(e.matrixWorld),n.position.copy(bc),Rm.copy(n.position),Rm.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Rm),n.updateMatrixWorld(),s.makeTranslation(-bc.x,-bc.y,-bc.z),Cb.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cb)}}h(MA,"PointLightShadow");class zu extends Ql{constructor(e,t,n=0,s=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new MA}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}h(zu,"PointLight");class AA extends Sp{constructor(){super(new yo(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}h(AA,"DirectionalLightShadow");class lh extends Ql{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(vt.DefaultUp),this.updateMatrix(),this.target=new vt,this.shadow=new AA}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}h(lh,"DirectionalLight");class Tp extends Ql{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}h(Tp,"AmbientLight");class ys{static decodeText(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);let t="";for(let n=0,s=e.length;n<s;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}h(ys,"LoaderUtils");class SA extends bo{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,o=Bl.get(e);if(o!==void 0)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Bl.add(e,l),t&&t(l),r.manager.itemEnd(e)}).catch(function(l){s&&s(l),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}h(SA,"ImageBitmapLoader");class CA{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Tb(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Tb();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}h(CA,"Clock");function Tb(){return(typeof performance=="undefined"?Date:performance).now()}h(Tb,"now");const Z0="\\[\\]\\.:\\/",VO=new RegExp("["+Z0+"]","g"),Q0="[^"+Z0+"]",HO="[^"+Z0.replace("\\.","")+"]",GO=/((?:WC+[\/:])*)/.source.replace("WC",Q0),WO=/(WCOD+)?/.source.replace("WCOD",HO),jO=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Q0),$O=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Q0),XO=new RegExp("^"+GO+WO+jO+$O+"$"),YO=["material","materials","bones","map"];class TA{constructor(e,t,n){const s=n||ft.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=n.length;s!==r;++s)n[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}h(TA,"Composite");class ft{constructor(e,t,n){this.path=t,this.parsedPath=n||ft.parseTrackName(t),this.node=ft.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new ft.Composite(e,t,n):new ft(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(VO,"")}static parseTrackName(e){const t=XO.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=n.nodeName.substring(s+1);YO.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=h(function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===t||a.uuid===t)return a;const l=n(a.children);if(l)return l}return null},"searchNodeSubtree"),s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,r=n.length;s!==r;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,s=t.propertyName;let r=t.propertyIndex;if(e||(e=ft.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let c=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[s];if(o===void 0){const c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[r]!==void 0&&(r=e.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}h(ft,"PropertyBinding");ft.Composite=TA;ft.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ft.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ft.prototype.GetterByBindingType=[ft.prototype._getValue_direct,ft.prototype._getValue_array,ft.prototype._getValue_arrayElement,ft.prototype._getValue_toArray];ft.prototype.SetterByBindingTypeAndVersioning=[[ft.prototype._setValue_direct,ft.prototype._setValue_direct_setNeedsUpdate,ft.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ft.prototype._setValue_array,ft.prototype._setValue_array_setNeedsUpdate,ft.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ft.prototype._setValue_arrayElement,ft.prototype._setValue_arrayElement_setNeedsUpdate,ft.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ft.prototype._setValue_fromArray,ft.prototype._setValue_fromArray_setNeedsUpdate,ft.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class J0{constructor(e,t,n=0,s=1/0){this.ray=new vo(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new mp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Xg(e,this,n,t),n.sort(Eb),n}intersectObjects(e,t=!0,n=[]){for(let s=0,r=e.length;s<r;s++)Xg(e[s],this,n,t);return n.sort(Eb),n}}h(J0,"Raycaster");function Eb(i,e){return i.distance-e.distance}h(Eb,"ascSort");function Xg(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const s=i.children;for(let r=0,o=s.length;r<o;r++)Xg(s[r],e,t,!0)}}h(Xg,"intersectObject");const Pb=new A;class EA extends vt{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new et,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;s.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}n.setAttribute("position",new Fe(s,3));const r=new $n({fog:!1,toneMapped:!1});this.cone=new Ws(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Pb.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Pb),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}h(EA,"SpotLightHelper");class PA extends Re{constructor(e,t,n){const s=new oh(t,4,2),r=new hi({wireframe:!0,fog:!1,toneMapped:!1});super(s,r),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}h(PA,"PointLightHelper");const KO=new A,Rb=new Te,Ib=new Te;class RA extends vt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const s=new no(t);s.rotateY(Math.PI*.5),this.material=new hi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=s.getAttribute("position"),o=new Float32Array(r.count*3);s.setAttribute("color",new Zt(o,3)),this.add(new Re(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Rb.copy(this.light.color),Ib.copy(this.light.groundColor);for(let n=0,s=t.count;n<s;n++){const r=n<s/2?Rb:Ib;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(KO.setFromMatrixPosition(this.light.matrixWorld).negate())}}h(RA,"HemisphereLightHelper");const Db=new A,ed=new A,Lb=new A;class IA extends vt{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let s=new et;s.setAttribute("position",new Fe([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new $n({fog:!1,toneMapped:!1});this.lightPlane=new vn(s,r),this.add(this.lightPlane),s=new et,s.setAttribute("position",new Fe([0,0,0,0,0,1],3)),this.targetLine=new vn(s,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Db.setFromMatrixPosition(this.light.matrixWorld),ed.setFromMatrixPosition(this.light.target.matrixWorld),Lb.subVectors(ed,Db),this.lightPlane.lookAt(ed),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(ed),this.targetLine.scale.z=Lb.length()}}h(IA,"DirectionalLightHelper");const td=new A,nn=new yp;class DA extends Ws{constructor(e){const t=new et,n=new $n({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(g,m){l(g),l(m)}h(a,"addLine");function l(g){s.push(0,0,0),r.push(0,0,0),o[g]===void 0&&(o[g]=[]),o[g].push(s.length/3-1)}h(l,"addPoint"),t.setAttribute("position",new Fe(s,3)),t.setAttribute("color",new Fe(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new Te(16755200),u=new Te(16711680),d=new Te(43775),f=new Te(16777215),p=new Te(3355443);this.setColors(c,u,d,f,p)}setColors(e,t,n,s,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,s=1;nn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),cn("c",t,e,nn,0,0,-1),cn("t",t,e,nn,0,0,1),cn("n1",t,e,nn,-n,-s,-1),cn("n2",t,e,nn,n,-s,-1),cn("n3",t,e,nn,-n,s,-1),cn("n4",t,e,nn,n,s,-1),cn("f1",t,e,nn,-n,-s,1),cn("f2",t,e,nn,n,-s,1),cn("f3",t,e,nn,-n,s,1),cn("f4",t,e,nn,n,s,1),cn("u1",t,e,nn,n*.7,s*1.1,-1),cn("u2",t,e,nn,-n*.7,s*1.1,-1),cn("u3",t,e,nn,0,s*2,-1),cn("cf1",t,e,nn,-n,0,1),cn("cf2",t,e,nn,n,0,1),cn("cf3",t,e,nn,0,-s,1),cn("cf4",t,e,nn,0,s,1),cn("cn1",t,e,nn,-n,0,-1),cn("cn2",t,e,nn,n,0,-1),cn("cn3",t,e,nn,0,-s,-1),cn("cn4",t,e,nn,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}h(DA,"CameraHelper");function cn(i,e,t,n,s,r,o){td.set(s,r,o).unproject(n);const a=e[i];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],td.x,td.y,td.z)}}h(cn,"setPoint");typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:N0}}));typeof window!="undefined"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=N0);var qO=Object.defineProperty,ZO=h((i,e)=>qO(i,"name",{value:e,configurable:!0}),"__name$2S");class e1{constructor(e){C(this,"running",!1);C(this,"keepLoop",!1);C(this,"lastTimestamp",0);C(this,"onUpdate");this.onUpdate=e}start(){this.running||(this.running=!0,this.keepLoop=!0,this.lastTimestamp=new Date().valueOf(),requestAnimationFrame(()=>this.loop()))}stop(){this.keepLoop=!1}loop(){const e=new Date().valueOf();try{this.keepLoop&&this.onUpdate(Math.max(e-this.lastTimestamp,1)/1e3)}catch(t){throw this.running=!1,this.keepLoop=!1,t}this.lastTimestamp=e,this.keepLoop?requestAnimationFrame(()=>this.loop()):this.running=!1}}h(e1,"RenderLoop");ZO(e1,"RenderLoop");var QO=Object.defineProperty,LA=h((i,e)=>QO(i,"name",{value:e,configurable:!0}),"__name$2R");function kA(i,e=300){let t=Date.now(),n=0;function s(){const r=Date.now();n+=r-t,t=r;const o=Math.min(1,n/e);i(o),o<1&&requestAnimationFrame(s)}h(s,"step"),LA(s,"step"),s()}h(kA,"createTransitionAnimation");LA(kA,"createTransitionAnimation");var JO=Object.defineProperty,df=h((i,e)=>JO(i,"name",{value:e,configurable:!0}),"__name$2Q");function va(i,e,t){let n,s,r=df(a=>e(a),"_onDragMove"),o=df(a=>(document.removeEventListener("pointermove",r),document.removeEventListener("pointerup",n),document.removeEventListener("pointerout",s),t&&t(a)),"_onDragEnd");n=o,s=df(a=>{(!a.relatedTarget||a.relatedTarget.nodeName==="HTML")&&o(a)},"onPointerOut"),document.addEventListener("pointermove",r),document.addEventListener("pointerup",n),document.addEventListener("pointerout",s),i&&r(i)}h(va,"addGlobalDragListener");df(va,"addGlobalDragListener");var eN=Object.defineProperty,nd=h((i,e)=>eN(i,"name",{value:e,configurable:!0}),"__name$2P");const kb="color-box",Ob="color-box-active";var tN=Rt({props:{value:{type:Array,default:[1,1,1]},colorBox:Boolean},emits:["update:value"],setup(i,e){const t=ze(),n=ze(),s=160/2,r=13,o=vr(new Te),a=vr({h:0,s:0,l:0}),l=ze(0),c=ze(0),u=ze(0),d=ze(0),f=vr([16777215,16777215,16777215,16777215,16777215,16777215,16777215,16777215]);try{const T=localStorage.getItem(kb);if(T){const M=JSON.parse(T);for(let R=0,L=f.length;R<L;++R)f[R]=M[R]}const P=localStorage.getItem(Ob);P&&(d.value=JSON.parse(P))}catch(T){console.error(T)}mi(f,function(){!i.colorBox||localStorage.setItem(kb,JSON.stringify(f))},{deep:!0}),mi(d,function(){!i.colorBox||localStorage.setItem(Ob,JSON.stringify(d.value))}),mi(()=>i.value,function(){o.setRGB(i.value[0],i.value[1],i.value[2]),o.getHSL(a);let T=a.h,P=a.s,M=a.l,R=P*Math.min(M,1-M)+M;P=R?2-2*M/R:0,(P||R||u.value&&!P&&!R)&&(c.value=P,u.value=R),P&&(l.value=T),f[d.value]=o.getHex()},{immediate:!0});const p=Je(function(){return o.getHexString()}),g=Je(function(){return f.map(T=>new Te().setHex(T).getHexString())}),m=Je(function(){return{transform:`rotate(${Math.round(l.value*360)-60}deg)`,"transform-origin":`0 ${s}px`}}),v=Je(function(){return{"background-color":`#${new Te().setHSL(l.value,1,.5).getHexString()}`}}),y=Je(function(){return{left:`${Math.round(100*c.value)}%`,top:`${Math.round(100*(1-u.value))}%`}});function b(T){T.stopPropagation();const P=t.value.getBoundingClientRect(),M=s,R=s,L=T.clientX-P.left,W=T.clientY-P.top,k=Math.sqrt((L-M)**2+(W-R)**2);k>=s-r&&k<=s&&va(T,z=>{const S=z.clientX-P.left-M,B=z.clientY-P.top-R,K=(Math.atan2(B,S)/Math.PI*180+360*2+90+60)%360/360,ie=new Te().setHSL(K,a.s,a.l);e.emit("update:value",[ie.r,ie.g,ie.b]),l.value=K})}h(b,"onHueRingMouseDown"),nd(b,"onHueRingMouseDown");function _(T){T.stopPropagation();const P=n.value.getBoundingClientRect();va(T,M=>{let R=Math.min(Math.max(M.clientX-P.left,0),P.width)/P.width,L=1-Math.min(Math.max(M.clientY-P.top,0),P.height)/P.height;c.value=R,u.value=L;let W=L-L*R/2,k=Math.min(W,1-W);R=k?(L-W)/k:0;const z=new Te().setHSL(l.value,R,W);e.emit("update:value",[z.r,z.g,z.b])})}h(_,"onSvRectMouseDown"),nd(_,"onSvRectMouseDown");function x(T){const M=(T.target.value||"").trim();if(/^([a-fA-F0-9]{6})$/.test(M)){const R=Number.parseInt(M.substring(0,6),16),L=new Te().setHex(R);e.emit("update:value",[L.r,L.g,L.b])}}h(x,"onTextInput"),nd(x,"onTextInput");function w(T){d.value=T;const P=new Te().setHex(f[T]);e.emit("update:value",[P.r,P.g,P.b])}return h(w,"onBoxClick"),nd(w,"onBoxClick"),{hueRing:t,svRect:n,activeBox:d,hex:p,colorBoxHex:g,hueRingHandlerStyle:m,svRectStyle:v,svRectHandlerStyle:y,onHueRingMouseDown:b,onSvRectMouseDown:_,onTextInput:x,onBoxClick:w}}});const t1=h(i=>(ba("data-v-3618be33"),i=i(),wa(),i),"_withScopeId$5"),nN={class:"color-picker"},iN={class:"hue-ring-inner"},sN=t1(()=>he("div",{class:"bg1 bg"},null,-1)),rN=t1(()=>he("div",{class:"bg2 bg"},null,-1)),oN={class:"color-value"},aN=t1(()=>he("span",null,"#",-1)),lN=["value"],cN={key:0,class:"color-box"},uN=["onClick"];function hN(i,e,t,n,s,r){return Se(),ke("div",nN,[he("div",{class:"hue-ring",onPointerdown:e[1]||(e[1]=(...o)=>i.onHueRingMouseDown&&i.onHueRingMouseDown(...o)),ref:"hueRing"},[he("div",{class:"hue-ring-handler",style:En(i.hueRingHandlerStyle)},null,4),he("div",iN,[he("div",{class:"sv-rect",style:En(i.svRectStyle),onPointerdown:e[0]||(e[0]=(...o)=>i.onSvRectMouseDown&&i.onSvRectMouseDown(...o)),ref:"svRect"},[sN,rN,he("div",{class:"sv-rect-handler",style:En(i.svRectHandlerStyle)},null,4)],36)])],544),he("div",oN,[he("div",{class:"block",style:En({"background-color":`#${i.hex}`})},null,4),aN,he("input",{type:"text",value:i.hex,onInput:e[2]||(e[2]=(...o)=>i.onTextInput&&i.onTextInput(...o))},null,40,lN)]),i.colorBox?(Se(),ke("div",cN,[(Se(!0),ke(At,null,ro(i.colorBoxHex,(o,a)=>(Se(),ke("div",{class:en(["color",{active:i.activeBox===a}]),style:En({"background-color":`#${o}`}),onClick:l=>i.onBoxClick(a)},null,14,uN))),256))])):Qe("",!0)])}h(hN,"_sfc_render$r");var OA=Dt(tN,[["render",hN],["__scopeId","data-v-3618be33"]]);const dN={},fN=h(i=>(ba("data-v-488ada72"),i=i(),wa(),i),"_withScopeId$4"),pN=fN(()=>he("div",{class:"fullscreen-loading"},[he("div",{class:"lds-dual-ring"})],-1));function mN(i,e){return Se(),Bt(D0,{to:"body"},[pN])}h(mN,"_sfc_render$q");var gN=Dt(dN,[["render",mN],["__scopeId","data-v-488ada72"]]),vN=Object.defineProperty,yN=h((i,e)=>vN(i,"name",{value:e,configurable:!0}),"__name$2O"),_N=Rt({props:{value:Boolean,label:String},emits:["input"],setup(i,e){function t(){e.emit("input",!i.value)}return h(t,"flip"),yN(t,"flip"),{flip:t}}});const bN={class:"input-boolean"};function wN(i,e,t,n,s,r){return Se(),ke("div",bN,[he("div",{class:en(["input-boolean__checkbox",{checked:!!i.value}]),onClick:e[0]||(e[0]=(...o)=>i.flip&&i.flip(...o))},null,2),i.label?(Se(),ke("div",{key:0,class:"input-boolean__label",onClick:e[1]||(e[1]=(...o)=>i.flip&&i.flip(...o))},rn(i.label),1)):Qe("",!0)])}h(wN,"_sfc_render$p");var Ta=Dt(_N,[["render",wN],["__scopeId","data-v-271a8ef3"]]),xN=Object.defineProperty,id=h((i,e)=>xN(i,"name",{value:e,configurable:!0}),"__name$2N"),MN=Rt({props:{value:Number,readonly:Boolean,disabled:Boolean,min:Number,max:Number,step:Number,resettable:Boolean,defaultValue:Number},emits:["input"],setup(i,e){const t=ze();let n=!1;function s(){n&&(o(),document.removeEventListener("mousedown",s))}h(s,"postOnMouseDown"),id(s,"postOnMouseDown");function r(){n||(n=!0,document.addEventListener("mousedown",s))}h(r,"onChange"),id(r,"onChange"),xa(function(){document.removeEventListener("mousedown",s)});function o(){if(n){n=!1;const l=t.value;if(l){const c=l.value;let u=Number(c);isFinite(u)||(u=0),i.step!=null&&(u=Math.round(u/i.step)*i.step),i.min!=null&&(u=Math.max(i.min,u)),i.max!=null&&(u=Math.min(i.max,u)),e.emit("input",u)}}}h(o,"onPost"),id(o,"onPost");function a(){e.emit("input",i.defaultValue||0)}return h(a,"onReset"),id(a,"onReset"),{inputDom:t,onChange:r,onPost:o,onReset:a}}}),n1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFxJREFUSIntlEsOACEIQ2Xuf+e6MkFiLCN+Nryl0AoxtZQkiSLeRgDohCJuLTW25vZ8VHebrw7Q+JZu/jHAGbEitME1jr1BCChY36xON9gWKIsOEQvajPdfRZJQKkl2V7+RNsIHAAAAAElFTkSuQmCC";const AN=h(i=>(ba("data-v-3550c3d4"),i=i(),wa(),i),"_withScopeId$3"),SN={class:"input-number"},CN=["value","readonly","disabled"],TN=AN(()=>he("img",{src:n1,alt:""},null,-1)),EN=[TN];function PN(i,e,t,n,s,r){return Se(),ke("div",SN,[he("input",{type:"text",value:i.value,readonly:i.readonly,disabled:i.disabled,onInput:e[0]||(e[0]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[2]||(e[2]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"inputDom"},null,40,CN),i.resettable?(Se(),ke("button",{key:0,class:"normal-button",onClick:e[3]||(e[3]=(...o)=>i.onReset&&i.onReset(...o))},EN)):Qe("",!0)])}h(PN,"_sfc_render$o");var Rr=Dt(MN,[["render",PN],["__scopeId","data-v-3550c3d4"]]),RN=Object.defineProperty,IN=h((i,e)=>RN(i,"name",{value:e,configurable:!0}),"__name$2M"),DN=Rt({props:{value:{type:Number,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},step:{type:Number,required:!0},fractionDigits:Number,label:String},emits:["update:value"],setup(i,e){const t=ze(),n=Je(function(){return i.value.toFixed(i.fractionDigits)}),s=Je(function(){return{width:`${Math.round((i.value-i.min)/(i.max-i.min)*100)}%`}});function r(o){va(o,function(a){const l=t.value.getBoundingClientRect();let u=Math.max(0,Math.min(1,(a.clientX-l.left)/l.width))*(i.max-i.min)+i.min;u=Math.round(u/i.step)*i.step,e.emit("update:value",u)})}return h(r,"onMouseDown"),IN(r,"onMouseDown"),{dom:t,valueText:n,barStyle:s,onMouseDown:r}}});const LN={class:"label"},kN={class:"value"};function ON(i,e,t,n,s,r){return Se(),ke("div",{class:"label-range",onPointerdown:e[0]||(e[0]=(...o)=>i.onMouseDown&&i.onMouseDown(...o)),ref:"dom"},[he("div",{class:"bar",style:En(i.barStyle)},null,4),he("div",LN,rn(i.label),1),he("div",kN,rn(i.valueText),1)],544)}h(ON,"_sfc_render$n");var NN=Dt(DN,[["render",ON],["__scopeId","data-v-763688a1"]]);const kf={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Jl{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}h(Jl,"Pass");const FN=new yo(-1,1,1,-1,0,1),i1=new et;i1.setAttribute("position",new Fe([-1,3,0,-1,-1,0,3,-1,0],3));i1.setAttribute("uv",new Fe([0,2,0,0,2,0],2));class s1{constructor(e){this._mesh=new Re(i1,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,FN)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}h(s1,"FullScreenQuad");class Yg extends Jl{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Zn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=vp.clone(e.uniforms),this.material=new Zn({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new s1(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}h(Yg,"ShaderPass");class Kg extends Jl{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const s=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),r.buffers.stencil.setFunc(s.ALWAYS,o,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(s.EQUAL,1,4294967295),r.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),r.buffers.stencil.setLocked(!0)}}h(Kg,"MaskPass");class NA extends Jl{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}h(NA,"ClearMaskPass");class FA{constructor(e,t){if(this.renderer=e,t===void 0){const n=e.getSize(new je);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,t=new Hn(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],kf===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),Yg===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new Yg(kf),this.clock=new CA}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let s=0,r=this.passes.length;s<r;s++){const o=this.passes[s];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),o.needsSwap){if(n){const a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Kg!==void 0&&(o instanceof Kg?n=!0:o instanceof NA&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new je);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(n,s),this.renderTarget2.setSize(n,s);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(n,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}h(FA,"EffectComposer");new yo(-1,1,1,-1,0,1);const zA=new et;zA.setAttribute("position",new Fe([-1,3,0,-1,-1,0,3,-1,0],3));zA.setAttribute("uv",new Fe([0,2,0,0,2,0],2));class Ns extends Jl{constructor(e,t,n,s){super(),this.renderScene=t,this.renderCamera=n,this.selectedObjects=s!==void 0?s:[],this.visibleEdgeColor=new Te(1,1,1),this.hiddenEdgeColor=new Te(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new je(e.x,e.y):new je(256,256);const r=Math.round(this.resolution.x/this.downSampleRatio),o=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new Hn(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new W0,this.depthMaterial.side=Ci,this.depthMaterial.depthPacking=UM,this.depthMaterial.blending=Us,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Ci,this.prepareMaskMaterial.fragmentShader=u(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new Hn(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new Hn(r,o),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new Hn(r,o),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new Hn(Math.round(r/2),Math.round(o/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new Hn(r,o),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new Hn(Math.round(r/2),Math.round(o/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const a=4,l=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(a),this.separableBlurMaterial1.uniforms.texSize.value.set(r,o),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(l),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(r/2),Math.round(o/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=l,this.overlayMaterial=this.getOverlayMaterial(),kf===void 0&&console.error("THREE.OutlinePass relies on CopyShader");const c=kf;this.copyUniforms=vp.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new Zn({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:Us,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Te,this.oldClearAlpha=1,this.fsQuad=new s1(null),this.tempPulseColor1=new Te,this.tempPulseColor2=new Te,this.textureMatrix=new ve;function u(d,f){const p=f.isPerspectiveCamera?"perspective":"orthographic";return d.replace(/DEPTH_TO_VIEW_Z/g,p+"DepthToViewZ")}h(u,"replaceDepthToViewZ")}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let n=Math.round(e/this.downSampleRatio),s=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,s),this.renderTargetBlurBuffer1.setSize(n,s),this.renderTargetEdgeBuffer1.setSize(n,s),this.separableBlurMaterial1.uniforms.texSize.value.set(n,s),n=Math.round(n/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(n,s),this.renderTargetEdgeBuffer2.setSize(n,s),this.separableBlurMaterial2.uniforms.texSize.value.set(n,s)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function n(s){s.isMesh&&(e===!0?s.visible=t.get(s):(t.set(s,s.visible),s.visible=e))}h(n,"gatherSelectedMeshesCallBack");for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(n)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,n=[];function s(o){o.isMesh&&n.push(o)}h(s,"gatherSelectedMeshesCallBack");for(let o=0;o<this.selectedObjects.length;o++)this.selectedObjects[o].traverse(s);function r(o){if(o.isMesh||o.isSprite){let a=!1;for(let l=0;l<n.length;l++)if(n[l].id===o.id){a=!0;break}if(a===!1){const l=o.visible;(e===!1||t.get(o)===!0)&&(o.visible=e),t.set(o,l)}}else(o.isPoints||o.isLine)&&(e===!0?o.visible=t.get(o):(t.set(o,o.visible),o.visible=e))}h(r,"VisibilityChangeCallBack"),this.renderScene.traverse(r)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,n,s,r){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const o=e.autoClear;e.autoClear=!1,r&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const a=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=a,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+Math.cos(performance.now()*.01/this.pulsePeriod)*.75/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ns.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ns.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ns.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ns.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,r&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=o}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=n.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new Zn({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new je(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new Zn({uniforms:{maskTexture:{value:null},texSize:{value:new je(.5,.5)},visibleEdgeColor:{value:new A(1,1,1)},hiddenEdgeColor:{value:new A(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new Zn({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new je(.5,.5)},direction:{value:new je(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new Zn({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:Fg,depthTest:!1,depthWrite:!1,transparent:!0})}}h(Ns,"OutlinePass");Ns.BlurDirectionX=new je(1,0);Ns.BlurDirectionY=new je(0,1);class BA extends Jl{constructor(e,t,n,s,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=s,this.clearAlpha=r!==void 0?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Te}render(e,t,n){const s=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==void 0&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=o),e.autoClear=s}}h(BA,"RenderPass");var zN=Object.defineProperty,BN=h((i,e)=>zN(i,"name",{value:e,configurable:!0}),"__name$2L");class r1{constructor(){C(this,"shadingMode","solid");C(this,"enablePressure",!0);C(this,"remeshVoxelSize",.003);C(this,"paintColor",[1,0,1]);C(this,"keepTransformUnchangedWhileMoving",!0);C(this,"useLocalSpaceForTransformControl",!0);C(this,"allowModifyingBoneLengthWhenBindingIk",!0);C(this,"keepInternalTransformWhenBindingIk",!0);C(this,"keepBothEndsOfClayNodesWhenStretching",!0);C(this,"quadView",!1);C(this,"outlineSelected",!0);C(this,"showGrids",!0);C(this,"showLightHelpers",!1);C(this,"showIkBones",!1);C(this,"tools",{})}}h(r1,"EditorOptions");BN(r1,"EditorOptions");const Io=new J0,Ai=new A,Gr=new A,Yt=new Be,Nb={X:new A(1,0,0),Y:new A(0,1,0),Z:new A(0,0,1)},Im={type:"change"},Fb={type:"mouseDown"},zb={type:"mouseUp",mode:null},Bb={type:"objectChange"};class UA extends vt{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new VA;this._gizmo=n,this.add(n);const s=new HA;this._plane=s,this.add(s);const r=this;function o(b,_){let x=_;Object.defineProperty(r,b,{get:function(){return x!==void 0?x:_},set:function(w){x!==w&&(x=w,s[b]=w,n[b]=w,r.dispatchEvent({type:b+"-changed",value:w}),r.dispatchEvent(Im))}}),r[b]=_,s[b]=_,n[b]=_}h(o,"defineProperty"),o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);const a=new A,l=new A,c=new Be,u=new Be,d=new A,f=new Be,p=new A,g=new A,m=new A,v=0,y=new A;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",u),o("cameraPosition",d),o("cameraQuaternion",f),o("pointStart",p),o("pointEnd",g),o("rotationAxis",m),o("rotationAngle",v),o("eye",y),this._offset=new A,this._startNorm=new A,this._endNorm=new A,this._cameraScale=new A,this._parentPosition=new A,this._parentQuaternion=new Be,this._parentQuaternionInv=new Be,this._parentScale=new A,this._worldScaleStart=new A,this._worldQuaternionInv=new Be,this._worldScale=new A,this._positionStart=new A,this._quaternionStart=new Be,this._scaleStart=new A,this._getPointer=UN.bind(this),this._onPointerDown=HN.bind(this),this._onPointerHover=VN.bind(this),this._onPointerMove=GN.bind(this),this._onPointerUp=WN.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Io.setFromCamera(e,this.camera);const t=Dm(this._gizmo.picker[this.mode],Io);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Io.setFromCamera(e,this.camera);const t=Dm(this._plane,Io,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Fb.mode=this.mode,this.dispatchEvent(Fb)}}pointerMove(e){const t=this.axis,n=this.mode,s=this.object;let r=this.space;if(n==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),s===void 0||t===null||this.dragging===!1||e.button!==-1)return;Io.setFromCamera(e,this.camera);const o=Dm(this._plane,Io,!0);if(!!o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(s.position.applyQuaternion(Yt.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),r==="world"&&(s.parent&&s.position.add(Ai.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Ai.setFromMatrixPosition(s.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),Gr.set(a,a,a)}else Ai.copy(this.pointStart),Gr.copy(this.pointEnd),Ai.applyQuaternion(this._worldQuaternionInv),Gr.applyQuaternion(this._worldQuaternionInv),Gr.divide(Ai),t.search("X")===-1&&(Gr.x=1),t.search("Y")===-1&&(Gr.y=1),t.search("Z")===-1&&(Gr.z=1);s.scale.copy(this._scaleStart).multiply(Gr),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(Ai.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ai.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Nb[t]),Ai.copy(Nb[t]),r==="local"&&Ai.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(Ai.cross(this.eye).normalize())*a),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Yt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Yt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Im),this.dispatchEvent(Bb)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(zb.mode=this.mode,this.dispatchEvent(zb)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Im),this.dispatchEvent(Bb),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Io}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}h(UA,"TransformControls");function UN(i){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:i.button};{const e=this.domElement.getBoundingClientRect();return{x:(i.clientX-e.left)/e.width*2-1,y:-(i.clientY-e.top)/e.height*2+1,button:i.button}}}h(UN,"getPointer");function VN(i){if(!!this.enabled)switch(i.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(i));break}}h(VN,"onPointerHover");function HN(i){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(i)),this.pointerDown(this._getPointer(i)))}h(HN,"onPointerDown");function GN(i){!this.enabled||this.pointerMove(this._getPointer(i))}h(GN,"onPointerMove");function WN(i){!this.enabled||(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(i)))}h(WN,"onPointerUp");function Dm(i,e,t){const n=e.intersectObject(i,!0);for(let s=0;s<n.length;s++)if(n[s].object.visible||t)return n[s];return!1}h(Dm,"intersectObjectWithRay");const sd=new it,Ot=new A(0,1,0),Ub=new A(0,0,0),Vb=new ve,rd=new Be,ff=new Be,As=new A,Hb=new ve,ou=new A(1,0,0),Ko=new A(0,1,0),au=new A(0,0,1),od=new A,wc=new A,xc=new A;class VA extends vt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new hi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new $n({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const s=t.clone();s.opacity=.5;const r=e.clone();r.color.setHex(16711680);const o=e.clone();o.color.setHex(65280);const a=e.clone();a.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const g=e.clone();g.color.setHex(7895160);const m=new On(0,.04,.1,12);m.translate(0,.05,0);const v=new sn(.08,.08,.08);v.translate(0,.04,0);const y=new et;y.setAttribute("position",new Fe([0,0,0,1,0,0],3));const b=new On(.0075,.0075,.5,3);b.translate(0,.25,0);function _(B,ne){const K=new eo(B,.0075,3,64,ne*Math.PI*2);return K.rotateY(Math.PI/2),K.rotateX(Math.PI/2),K}h(_,"CircleGeometry");function x(){const B=new et;return B.setAttribute("position",new Fe([0,0,0,1,1,1],3)),B}h(x,"TranslateHelperGeometry");const w={X:[[new Re(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new Re(m,r),[-.5,0,0],[0,0,Math.PI/2]],[new Re(b,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Re(m,o),[0,.5,0]],[new Re(m,o),[0,-.5,0],[Math.PI,0,0]],[new Re(b,o)]],Z:[[new Re(m,a),[0,0,.5],[Math.PI/2,0,0]],[new Re(m,a),[0,0,-.5],[-Math.PI/2,0,0]],[new Re(b,a),null,[Math.PI/2,0,0]]],XYZ:[[new Re(new no(.1,0),d.clone()),[0,0,0]]],XY:[[new Re(new sn(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new Re(new sn(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new sn(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},T={X:[[new Re(new On(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Re(new On(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Re(new On(.2,0,.6,4),n),[0,.3,0]],[new Re(new On(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Re(new On(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Re(new On(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Re(new no(.2,0),n)]],XY:[[new Re(new sn(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Re(new sn(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new sn(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},P={START:[[new Re(new no(.01,2),s),null,null,null,"helper"]],END:[[new Re(new no(.01,2),s),null,null,null,"helper"]],DELTA:[[new vn(x(),s),null,null,null,"helper"]],X:[[new vn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new vn(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new vn(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new Re(_(.5,1),g),null,[0,Math.PI/2,0]]],X:[[new Re(_(.5,.5),r)]],Y:[[new Re(_(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new Re(_(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new Re(_(.75,1),f),null,[0,Math.PI/2,0]]]},R={AXIS:[[new vn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},L={XYZE:[[new Re(new oh(.25,10,8),n)]],X:[[new Re(new eo(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Re(new eo(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Re(new eo(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Re(new eo(.75,.1,2,24),n)]]},W={X:[[new Re(v,r),[.5,0,0],[0,0,-Math.PI/2]],[new Re(b,r),[0,0,0],[0,0,-Math.PI/2]],[new Re(v,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Re(v,o),[0,.5,0]],[new Re(b,o)],[new Re(v,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Re(v,a),[0,0,.5],[Math.PI/2,0,0]],[new Re(b,a),[0,0,0],[Math.PI/2,0,0]],[new Re(v,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Re(new sn(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new Re(new sn(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new sn(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Re(new sn(.1,.1,.1),d.clone())]]},k={X:[[new Re(new On(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Re(new On(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Re(new On(.2,0,.6,4),n),[0,.3,0]],[new Re(new On(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Re(new On(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Re(new On(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Re(new sn(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Re(new sn(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Re(new sn(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Re(new sn(.2,.2,.2),n),[0,0,0]]]},z={X:[[new vn(y,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new vn(y,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new vn(y,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function S(B){const ne=new vt;for(const K in B)for(let ie=B[K].length;ie--;){const G=B[K][ie][0].clone(),se=B[K][ie][1],q=B[K][ie][2],U=B[K][ie][3],le=B[K][ie][4];G.name=K,G.tag=le,se&&G.position.set(se[0],se[1],se[2]),q&&G.rotation.set(q[0],q[1],q[2]),U&&G.scale.set(U[0],U[1],U[2]),G.updateMatrix();const ae=G.geometry.clone();ae.applyMatrix4(G.matrix),G.geometry=ae,G.renderOrder=1/0,G.position.set(0,0,0),G.rotation.set(0,0,0),G.scale.set(1,1,1),ne.add(G)}return ne}h(S,"setupGizmo"),this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=S(w)),this.add(this.gizmo.rotate=S(M)),this.add(this.gizmo.scale=S(W)),this.add(this.picker.translate=S(T)),this.add(this.picker.rotate=S(L)),this.add(this.picker.scale=S(k)),this.add(this.helper.translate=S(P)),this.add(this.helper.rotate=S(R)),this.add(this.helper.scale=S(z)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ff;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let r=0;r<s.length;r++){const o=s[r];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag==="helper"){o.visible=!1,o.name==="AXIS"?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,this.axis==="X"&&(Yt.setFromEuler(sd.set(0,0,0)),o.quaternion.copy(n).multiply(Yt),Math.abs(Ot.copy(ou).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Yt.setFromEuler(sd.set(0,0,Math.PI/2)),o.quaternion.copy(n).multiply(Yt),Math.abs(Ot.copy(Ko).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Yt.setFromEuler(sd.set(0,Math.PI/2,0)),o.quaternion.copy(n).multiply(Yt),Math.abs(Ot.copy(au).applyQuaternion(n).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Yt.setFromEuler(sd.set(0,Math.PI/2,0)),Ot.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(Vb.lookAt(Ub,Ot,Ko)),o.quaternion.multiply(Yt),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),Ai.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ai.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(Ai),o.visible=this.dragging):(o.quaternion.copy(n),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1));continue}o.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Ot.copy(ou).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Ot.copy(Ko).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Ot.copy(au).applyQuaternion(n).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Ot.copy(au).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Ot.copy(ou).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Ot.copy(Ko).applyQuaternion(n).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(rd.copy(n),Ot.copy(this.eye).applyQuaternion(Yt.copy(n).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(Vb.lookAt(this.eye,Ub,Ko)),o.name==="X"&&(Yt.setFromAxisAngle(ou,Math.atan2(-Ot.y,Ot.z)),Yt.multiplyQuaternions(rd,Yt),o.quaternion.copy(Yt)),o.name==="Y"&&(Yt.setFromAxisAngle(Ko,Math.atan2(Ot.x,Ot.z)),Yt.multiplyQuaternions(rd,Yt),o.quaternion.copy(Yt)),o.name==="Z"&&(Yt.setFromAxisAngle(au,Math.atan2(Ot.y,Ot.x)),Yt.multiplyQuaternions(rd,Yt),o.quaternion.copy(Yt))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(l){return o.name===l}))&&(o.material.color.setHex(16776960),o.material.opacity=1)}super.updateMatrixWorld(e)}}h(VA,"TransformControlsGizmo");class HA extends Re{constructor(){super(new pa(1e5,1e5,2,2),new hi({visible:!1,wireframe:!0,side:Ci,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),od.copy(ou).applyQuaternion(t==="local"?this.worldQuaternion:ff),wc.copy(Ko).applyQuaternion(t==="local"?this.worldQuaternion:ff),xc.copy(au).applyQuaternion(t==="local"?this.worldQuaternion:ff),Ot.copy(wc),this.mode){case"translate":case"scale":switch(this.axis){case"X":Ot.copy(this.eye).cross(od),As.copy(od).cross(Ot);break;case"Y":Ot.copy(this.eye).cross(wc),As.copy(wc).cross(Ot);break;case"Z":Ot.copy(this.eye).cross(xc),As.copy(xc).cross(Ot);break;case"XY":As.copy(xc);break;case"YZ":As.copy(od);break;case"XZ":Ot.copy(xc),As.copy(wc);break;case"XYZ":case"E":As.set(0,0,0);break}break;case"rotate":default:As.set(0,0,0)}As.length()===0?this.quaternion.copy(this.cameraQuaternion):(Hb.lookAt(Ai.set(0,0,0),As,Ot),this.quaternion.setFromRotationMatrix(Hb)),super.updateMatrixWorld(e)}}h(HA,"TransformControlsPlane");var jN=Object.defineProperty,$N=h((i,e)=>jN(i,"name",{value:e,configurable:!0}),"__name$2K");const Gb=new it,XN=new A,Lm=new Be;class o1{constructor(){C(this,"perspective",!0);C(this,"perspectiveCamera",new Fn(45,1,.1,2e3));C(this,"orthographicCamera",new yo(-1,1,-1,1,0,2e3));C(this,"target",new A);C(this,"distance",1);C(this,"alpha",0);C(this,"beta",0);C(this,"_position",new A);C(this,"_up",new A);C(this,"_dir",new A)}get(){return this.perspective?this.perspectiveCamera:this.orthographicCamera}update(e,t){Gb.set(0,this.beta,-this.alpha),Lm.setFromEuler(Gb),this._position.set(this.distance,0,0),this._position.applyQuaternion(Lm),this._position.add(this.target);const n=this.get();if(n.position.copy(this._position),this._up.set(0,1,0),this._dir.subVectors(this._position,this.target).normalize(),XN.crossVectors(this._up,this._dir).lengthSq()<1e-8&&this._up.applyQuaternion(Lm),n.up.copy(this._up),n.lookAt(this.target),this.perspective)this.perspectiveCamera.aspect=e/t;else{const s=this.distance/850,r=e/2*s,o=t/2*s;this.orthographicCamera.left=-r,this.orthographicCamera.right=+r,this.orthographicCamera.bottom=-o,this.orthographicCamera.top=+o}n.updateProjectionMatrix()}}h(o1,"ArcRotateCamera");$N(o1,"ArcRotateCamera");var YN=Object.defineProperty,KN=h((i,e)=>YN(i,"name",{value:e,configurable:!0}),"__name$2J");class a1{constructor(){C(this,"element");C(this,"pointerOver",!1);C(this,"pointerX",0);C(this,"pointerY",0);C(this,"pressure",0);C(this,"mouseLeft",!1);C(this,"mouseLeftDownThisFrame",!1);C(this,"mouseRight",!1);C(this,"mouseRightDownThisFrame",!1);C(this,"mouseMiddle",!1);C(this,"mouseMiddleDownThisFrame",!1);C(this,"doubleClick",!1);C(this,"wheelDetX",0);C(this,"wheelDetY",0);C(this,"onContextmenu");C(this,"onPointerMove");C(this,"onPointerDown");C(this,"onPointerUp");C(this,"onPointerLeave");C(this,"onPointerOut");C(this,"onDblClick");C(this,"onWheel");C(this,"onKeyDown");C(this,"onKeyUp");C(this,"onBlur");C(this,"keyMap",new Map);C(this,"timestamp",0);this.onContextmenu=e=>{e.target===this.element&&e.preventDefault()},this.onPointerMove=e=>{e.target===this.element&&(this.pressure=e.pressure,this.pointerOver=!0,this.pointerX=e.offsetX,this.pointerY=e.offsetY)},this.onPointerDown=e=>{if(e.target===this.element)switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!0,this.mouseLeftDownThisFrame=!0;break;case 1:this.mouseMiddle=!0,this.mouseMiddleDownThisFrame=!0;break;case 2:this.mouseRight=!0,this.mouseRightDownThisFrame=!0;break}},this.onPointerUp=e=>{switch(this.pressure=e.pressure,e.button){case 0:this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1;break;case 1:this.mouseMiddle=!1,this.mouseMiddleDownThisFrame=!1;break;case 2:this.mouseRight=!1,this.mouseLeftDownThisFrame=!1;break}},this.onPointerLeave=()=>{this.pressure=0,this.pointerOver=!1},this.onPointerOut=e=>{(e.clientY<=0||e.clientX<=0||e.clientX>=window.innerWidth||e.clientY>=window.innerHeight)&&(this.pressure=0,this.mouseLeft=!1,this.mouseLeftDownThisFrame=!1,this.mouseRight=!1,this.mouseLeftDownThisFrame=!1)},this.onDblClick=e=>{this.doubleClick=!0},this.onWheel=e=>{e.preventDefault(),this.wheelDetX+=e.deltaX/100,this.wheelDetY+=e.deltaY/100},this.onKeyDown=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||((e.altKey||e.ctrlKey||e.key==="Tab")&&e.preventDefault(),this.keyMap.has(e.key)||this.keyMap.set(e.key,this.timestamp))},this.onKeyUp=e=>{const t=e.target;t&&"tagName"in t&&t.tagName==="INPUT"||this.keyMap.delete(e.key)},this.onBlur=()=>{this.keyMap.clear()}}setup(e){this.unload(),this.element=e,e.addEventListener("contextmenu",this.onContextmenu),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointerleave",this.onPointerLeave),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointerout",this.onPointerOut),e.addEventListener("dblclick",this.onDblClick),e.addEventListener("wheel",this.onWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("blur",this.onBlur)}unload(){const e=this.element;!e||(e.removeEventListener("contextmenu",this.onContextmenu),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointerleave",this.onPointerLeave),document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointerout",this.onPointerOut),e.removeEventListener("dblclick",this.onDblClick),e.removeEventListener("wheel",this.onWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("blur",this.onBlur),this.element=void 0)}update(){this.mouseLeftDownThisFrame=!1,this.mouseRightDownThisFrame=!1,this.mouseMiddleDownThisFrame=!1,this.doubleClick=!1,this.wheelDetX=0,this.wheelDetY=0,this.timestamp=Date.now()}isKeyPressed(e){return this.keyMap.has(e)}isKeyPressedThisFrame(e){return this.keyMap.get(e)===this.timestamp}isKeyRepeated(e,t=150){const n=this.keyMap.get(e);if(n==null)return!1;const s=this.timestamp-n;return s>=t||s===0?(this.keyMap.set(e,this.timestamp),!0):!1}}h(a1,"Input");KN(a1,"Input");var qN=Object.defineProperty,ZN=h((i,e)=>qN(i,"name",{value:e,configurable:!0}),"__name$2I");class vl{constructor(e,t,n,s,r,o){C(this,"ctx");C(this,"index");C(this,"enabled",!0);C(this,"element");C(this,"camera",new o1);C(this,"zoomLevel",0);C(this,"left",0);C(this,"bottom",0);C(this,"width",0);C(this,"height",0);C(this,"input",new a1);C(this,"mouseScr",new je);C(this,"mouseNdc",new A);C(this,"mouseRay0",new A);C(this,"mouseRay1",new A);C(this,"mouseRayN",new A);C(this,"raycaster",new J0);C(this,"transformControls");C(this,"defaultLight");this.ctx=e,this.index=t,this.element=n,this.input.setup(n),this.camera.alpha=s,this.camera.beta=r,this.camera.perspective=o,this.transformControls=new UA(this.camera.get(),n),e.scene.add(this.transformControls),this.defaultLight=new lh,e.scene.add(this.defaultLight)}update(){const e=this.element.getBoundingClientRect();this.left=e.left,this.bottom=e.bottom,this.width=e.width,this.height=e.height,this.width&&this.height?this.camera.update(this.width,this.height):this.enabled=!1}dispose(){this.transformControls.dispose(),this.defaultLight.dispose(),this.input.unload()}mousePick(e){return this.raycaster.intersectObjects(this.ctx.readonlyRef().scene.children.filter(t=>{if(!t.visible)return!1;const n=t.userData.node;return n!=null&&n.visible?!e||n.type===e:!1})).filter(t=>{const n=t.object.userData.node;return n==null?void 0:n.visible})}}h(vl,"EditorView");ZN(vl,"EditorView");var QN=Object.defineProperty,Ep=h((i,e)=>QN(i,"name",{value:e,configurable:!0}),"__name$2H");async function GA(i){return new Promise(e=>{const t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(new Blob([i]))})}h(GA,"bufferToDataUrl");Ep(GA,"bufferToDataUrl");async function l1(i){return(await fetch(i)).arrayBuffer()}h(l1,"dataUrlToArrayBuffer");Ep(l1,"dataUrlToArrayBuffer");const Of=new DataView(new ArrayBuffer(4));function c1(i){const e=new Uint8Array(i.length*4);for(let t=0,n=i.length;t<n;++t){Of.setFloat32(0,i[t]);const s=t*4;for(let r=0;r<4;++r)e[s+r]=Of.getUint8(r)}return e}h(c1,"float32ArrayToBytes");Ep(c1,"float32ArrayToBytes");function u1(i){const e=new Float32Array(i.length/4);for(let t=0,n=e.length;t<n;++t){const s=t*4;for(let r=0;r<4;++r)Of.setUint8(r,i[s+r]);e[t]=Of.getFloat32(0)}return e}h(u1,"bytesToFloat32Array");Ep(u1,"bytesToFloat32Array");var JN=Object.defineProperty,e4=h((i,e)=>JN(i,"name",{value:e,configurable:!0}),"__name$2G");class Ke{onRemoved(){}}h(Ke,"ModelNodeComponent");e4(Ke,"ModelNodeComponent");var t4=Object.defineProperty,h1=h((i,e)=>t4(i,"name",{value:e,configurable:!0}),"__name$2F"),$e=(i=>(i[i.NUMBER=1]="NUMBER",i[i.STRING=2]="STRING",i[i.BOOLEAN=3]="BOOLEAN",i[i.NUMBER_ARRAY=4]="NUMBER_ARRAY",i[i.BYTES=5]="BYTES",i))($e||{});const d1={};function Ze(i){return function(e){if(!e.name.startsWith("C"))throw new Error('Component class name should be prefixed with "C"');if(i.storable&&i.dataType==null)throw new Error(`Component [${e.name}] missing data type`);d1[e.name]=Object.assign({constructor:e},i)}}h(Ze,"registerModelComponent");h1(Ze,"registerModelComponent");function WA(i){return!!d1[i]}h(WA,"isModelNodeComponentDefExists");h1(WA,"isModelNodeComponentDefExists");function vi(i){const e=d1[i];if(!e)throw new Error(`Component def [${i}] not found`);return e}h(vi,"getModelNodeComponentDef");h1(vi,"getModelNodeComponentDef");var jA=Object.defineProperty,n4=Object.getOwnPropertyDescriptor,i4=h((i,e)=>jA(i,"name",{value:e,configurable:!0}),"__name$2E"),s4=h((i,e,t,n)=>{for(var s=n>1?void 0:n?n4(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&jA(e,t,s),s},"__decorateClass$L");let bs=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new Float32Array);C(this,"dirty",!0);C(this,"partialUpdate",!1)}},"CColors");i4(bs,"CColors");bs=s4([Ze({storable:!0,dataType:$e.BYTES,clone(i){return new Float32Array(i)},serialize:c1,deserialize:u1})],bs);var r4=Object.defineProperty,is=h((i,e)=>r4(i,"name",{value:e,configurable:!0}),"__name$2D");const on=function(){const i=new A,e=new A;return function(t,n,s,r,o){i.subVectors(s,n);const a=i.length();if(a<1e-8)return!1;i.divideScalar(a);const l=i.dot(o);if(Math.abs(l)<1e-8)return!1;e.subVectors(r,n);const c=e.dot(o)/l;return t.copy(n),t.addScaledVector(i,c),!0}}(),Bu=new A,Uu=new Be,Ul=new A;function Ea(i,e){return e.decompose(Bu,Uu,Ul),i.copy(Bu),i}h(Ea,"getTranslation");is(Ea,"getTranslation");function Nf(i,e){return e.decompose(Bu,Uu,Ul),i.copy(Uu),i}h(Nf,"getRotation");is(Nf,"getRotation");function $A(i,e){return e.decompose(Bu,Uu,Ul),i.copy(Ul),i}h($A,"getScale");is($A,"getScale");function ca(i){return i.decompose(Bu,Uu,Ul),Ul.x}h(ca,"getScaleScalar");is(ca,"getScaleScalar");function qg(i,e,t,n,s,r){let o=t.x,a=t.y,l=t.z,c=n.x,u=n.y,d=n.z,f=s.x,p=s.y,g=s.z,m=r.x,v=r.y,y=r.z,b=c**2*v**2+c**2*y**2-2*c*u*m*v-2*c*d*m*y+u**2*m**2+u**2*y**2-2*u*d*v*y+d**2*m**2+d**2*v**2,_=!1,x=(c*m*v*a-c*m*v*p+c*m*y*l-c*m*y*g-c*v**2*o+c*v**2*f-c*y**2*o+c*y**2*f-u*m**2*a+u*m**2*p+u*m*v*o-u*m*v*f+u*v*y*l-u*v*y*g-u*y**2*a+u*y**2*p-d*m**2*l+d*m**2*g+d*m*y*o-d*m*y*f-d*v**2*l+d*v**2*g+d*v*y*a-d*v*y*p)/b;isFinite(x)||(_=!0,x=0);let w=o+c*x,T=a+u*x,P=l+d*x;if(i&&(i.x=w,i.y=T,i.z=P),e){let M=(-c*v*l+c*v*g+c*y*a-c*y*p+u*m*l-u*m*g-u*y*o+u*y*f-d*m*a+d*m*p+d*v*o-d*v*f)/b;if(isFinite(M)){let R=u*y-d*v,L=-c*y+d*m,W=c*v-u*m;e.x=w+R*M,e.y=T+L*M,e.z=P+W*M}else{_=!0;let R=u*(l-g)-d*(a-p),L=-c*(l-g)+d*(o-f),W=c*(a-p)-u*(o-f);e.x=w+u*W-d*L,e.y=T+-c*W+d*R,e.z=P+c*L-u*R}}return _}h(qg,"closestPointsBetweenTwoLines");is(qg,"closestPointsBetweenTwoLines");const ec=function(){const i=new A,e=new A,t=new ve;return function(n,s,r){return i.crossVectors(r,s).normalize(),e.crossVectors(s,i).normalize(),t.set(i.x,i.y,i.z,0,e.x,e.y,e.z,0,s.x,s.y,s.z,0,0,0,0,1).transpose(),n.setFromRotationMatrix(t)}}();function bu(i,e){return i.x=Math.round(i.x/e)*e,i.y=Math.round(i.y/e)*e,i.z=Math.round(i.z/e)*e,i}h(bu,"snapPoint");is(bu,"snapPoint");function tc(i,e){return Math.abs(i.x-e.x)<1e-8&&Math.abs(i.y-e.y)<1e-8&&Math.abs(i.z-e.z)<1e-8}h(tc,"vectorsEqual");is(tc,"vectorsEqual");function XA(i,e,t){const n=Math.min(e.x,t.x),s=Math.max(e.x,t.x),r=Math.min(e.y,t.y),o=Math.max(e.y,t.y),a=i.x,l=i.y;return!(a<n||a>s||l<r||l>o)}h(XA,"intersectPointRect");is(XA,"intersectPointRect");const o4=function(){const i=new A,e=new A,t=new A;return function(n,s,r,o,a,l,c,u){i.subVectors(s,r);const d=l.dot(i),f=c.dot(i);if(d<=0&&f<=0)return n.copy(r);e.subVectors(s,o);const p=l.dot(e),g=c.dot(e);if(p>=0&&g<=p)return n.copy(o);t.subVectors(s,a);const m=l.dot(t),v=c.dot(t);if(v>=0&&m<=v)return n.copy(a);const y=d*g-p*f;if(y<=0&&d>=0&&p<=0){const P=d/(d-p);return n.copy(r).addScaledVector(l,P)}const b=m*f-d*v;if(b<=0&&f>=0&&v<=0){const P=f/(f-v);return n.copy(r).addScaledVector(c,P)}const _=p*v-m*g;if(_<=0&&g-p>=0&&m-v>=0){const P=(g-p)/(g-p+(m-v));return n.copy(o).addScaledVector(u,P)}const x=1/(_+b+y),w=b*x,T=y*x;return n.copy(r).addScaledVector(l,w).addScaledVector(c,T)}}(),a4=function(){const i=new A,e=new A,t=new A,n=new A;return function(s,r,o,a,l){e.crossVectors(a,l);let c=r.dot(e),u;if(c>0)u=1;else if(c<0)u=-1,c=-c;else return-1;i.subVectors(s,o);const d=u*r.dot(n.crossVectors(i,l));if(d<0)return-1;const f=u*r.dot(t.crossVectors(a,i));if(f<0||f+d>c)return-1;const p=-u*i.dot(e);return p<0?-1:p/c}}(),YA=function(){const i=new A;return function(e,t,n,s){return e.copy(t).addScaledVector(n,i.subVectors(s,t).dot(n))}}(),KA=function(){const i=new A;return function(e,t,n){return Math.atan2(i.crossVectors(t,n).dot(e),t.dot(n))}}();function yr(i,e){const t=Math.acos(e.w)*2,n=Math.sin(t/2);return n>1e-6?i.set(e.x,e.y,e.z).multiplyScalar(1/n):i.set(1,0,0),t}h(yr,"getAxisAngle");is(yr,"getAxisAngle");function lu(i){return i=i%(Math.PI*2),i<0&&(i+=Math.PI*2),i}h(lu,"simplifyAngle");is(lu,"simplifyAngle");function Zg(i,e){return Math.PI-Math.abs(Math.abs(e-i)%(Math.PI*2)-Math.PI)}h(Zg,"absAngleDiff");is(Zg,"absAngleDiff");function f1(i,e,t){if(i=lu(i),t-e>1e-8&&lu(t-e)<1e-8)return i;if(e=lu(e),t=lu(t),t<e){if(i>=0&&i<=t||i>=e)return i}else if(i>=e&&i<=t)return i;const n=Zg(i,e),s=Zg(i,t);return n<=s?e:t}h(f1,"clampAngle");is(f1,"clampAngle");var qA=Object.defineProperty,l4=Object.getOwnPropertyDescriptor,c4=h((i,e)=>qA(i,"name",{value:e,configurable:!0}),"__name$2C"),u4=h((i,e,t,n)=>{for(var s=n>1?void 0:n?l4(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&qA(e,t,s),s},"__decorateClass$K");let _n=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new A)}},"CFlipDirection");c4(_n,"CFlipDirection");_n=u4([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,instanceable:!0,equal:tc,clone(i){return new A().copy(i)},serialize(i){return[i.x,i.y,i.z]},deserialize(i){return new A(i[0],i[1],i[2])}})],_n);var ZA=Object.defineProperty,h4=Object.getOwnPropertyDescriptor,p1=h((i,e)=>ZA(i,"name",{value:e,configurable:!0}),"__name$2B"),d4=h((i,e,t,n)=>{for(var s=n>1?void 0:n?h4(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&ZA(e,t,s),s},"__decorateClass$J");let Ce=h(class extends Ke{constructor(){super(...arguments);C(this,"value",null);C(this,"parentChanged",!0);C(this,"localTransformChanged",!0);C(this,"worldTransformChanged",!0);C(this,"mesh");C(this,"instance",!1);C(this,"usePlainMaterial",!1)}onRemoved(){this.dispose()}dispose(){this.value&&(this.instance||ya(this.value),this.value.removeFromParent(),this.value=null)}},"CObject3D");p1(Ce,"CObject3D");Ce=d4([Ze({})],Ce);function ya(i){for(let t of i.children)ya(t);if(i.isInstancedMesh)return;if("geometry"in i){const t=i.geometry;t&&t.dispose()}if("material"in i){const t=i.material;t&&(t instanceof Array?t.forEach(hl):hl(t))}const e=i;e.__originalMaterial&&(e.__originalMaterial instanceof Array?e.__originalMaterial.forEach(hl):hl(e.__originalMaterial)),e.__plainMaterial&&hl(e.__plainMaterial)}h(ya,"disposeObject3D");p1(ya,"disposeObject3D");function hl(i){Object.keys(i).forEach(e=>{const t=i[e];t&&typeof t=="object"&&typeof t.dispose=="function"&&t.dispose()}),i.dispose()}h(hl,"disposeMaterial");p1(hl,"disposeMaterial");var QA=Object.defineProperty,f4=Object.getOwnPropertyDescriptor,p4=h((i,e)=>QA(i,"name",{value:e,configurable:!0}),"__name$2A"),m4=h((i,e,t,n)=>{for(var s=n>1?void 0:n?f4(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&QA(e,t,s),s},"__decorateClass$I");let an=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new Float32Array);C(this,"dirty",!0);C(this,"partialUpdate",!1)}},"CVertices");p4(an,"CVertices");an=m4([Ze({storable:!0,dataType:$e.BYTES,clone(i){return new Float32Array(i)},serialize:c1,deserialize:u1})],an);var g4=Object.defineProperty,Mc=h((i,e)=>g4(i,"name",{value:e,configurable:!0}),"__name$2z"),v4=Rt({props:{value:{type:A,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean},emits:["input"],setup(i,e){const t=ze(),n=ze(),s=ze();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}h(o,"postOnMouseDown"),Mc(o,"postOnMouseDown");function a(d){return Number(d.toFixed(3))}h(a,"format"),Mc(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}h(l,"onChange"),Mc(l,"onChange"),xa(function(){document.removeEventListener("mousedown",o)});function c(){var d,f,p;if(r){r=!1;let g=Number(((d=t.value)==null?void 0:d.value)||"0")||0,m=Number(((f=n.value)==null?void 0:f.value)||"0")||0,v=Number(((p=s.value)==null?void 0:p.value)||"0")||0;e.emit("input",new A(g,m,v))}}h(c,"onPost"),Mc(c,"onPost");function u(){e.emit("input",new A)}return h(u,"onReset"),Mc(u,"onReset"),{input0:t,input1:n,input2:s,format:a,onChange:l,onPost:c,onReset:u}}});const y4=h(i=>(ba("data-v-792b48dc"),i=i(),wa(),i),"_withScopeId$2"),_4={class:"input-vec3"},b4=["value","readonly","disabled"],w4=["value","readonly","disabled"],x4=["value","readonly","disabled"],M4=y4(()=>he("img",{src:n1,alt:""},null,-1)),A4=[M4];function S4(i,e,t,n,s,r){return Se(),ke("div",_4,[he("input",{type:"text",placeholder:"x",value:i.format(i.value.x),readonly:i.readonly,disabled:i.disabled,onInput:e[0]||(e[0]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[2]||(e[2]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"input0"},null,40,b4),he("input",{type:"text",placeholder:"y",value:i.format(i.value.y),readonly:i.readonly,disabled:i.disabled,onInput:e[3]||(e[3]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[5]||(e[5]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"input1"},null,40,w4),he("input",{type:"text",placeholder:"z",value:i.format(i.value.z),readonly:i.readonly,disabled:i.disabled,onInput:e[6]||(e[6]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[8]||(e[8]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"input2"},null,40,x4),i.resettable?(Se(),ke("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>i.onReset&&i.onReset(...o))},A4)):Qe("",!0)])}h(S4,"_sfc_render$m");var JA=Dt(v4,[["render",S4],["__scopeId","data-v-792b48dc"]]),eS=Object.defineProperty,C4=Object.getOwnPropertyDescriptor,T4=h((i,e)=>eS(i,"name",{value:e,configurable:!0}),"__name$2y"),E4=h((i,e,t,n)=>{for(var s=n>1?void 0:n?C4(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&eS(e,t,s),s},"__decorateClass$H");let ps=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new A(1,1,1));C(this,"dirty",!0)}},"CBoxSize");T4(ps,"CBoxSize");ps=E4([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,autoCopy:!0,equal:tc,label:"Size",inputComponent:JA,clone(i){return new A().copy(i)},serialize(i){return[i.x,i.y,i.z]},deserialize(i){return new A(i[0],i[1],i[2])}})],ps);var tS=Object.defineProperty,P4=Object.getOwnPropertyDescriptor,R4=h((i,e)=>tS(i,"name",{value:e,configurable:!0}),"__name$2x"),I4=h((i,e,t,n)=>{for(var s=n>1?void 0:n?P4(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&tS(e,t,s),s},"__decorateClass$G");let pn=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!0)}},"CCastShadow");R4(pn,"CCastShadow");pn=I4([Ze({storable:!0,dataType:$e.BOOLEAN,instanceable:!0,label:"Cast Shadow",inlineLabel:!0,inputComponent:Ta})],pn);var D4=Object.defineProperty,L4=h((i,e)=>D4(i,"name",{value:e,configurable:!0}),"__name$2w");class m1{constructor(e,t){C(this,"root");C(this,"zIndex",1e3);C(this,"show");C(this,"hide");C(this,"currentVisibleSubMenu");this.show=e,this.hide=t}handleMenuItemMouseOver(e,t){var n,s,r;(s=(n=this.currentVisibleSubMenu)==null?void 0:n.subMenu)==null||s.hide(),this.currentVisibleSubMenu=e,(r=e.subMenu)==null||r.show(t,"right")}hideAll(){this.root?this.root.hide():this.hide()}}h(m1,"PopupMenuContext");L4(m1,"PopupMenuContext");var k4=Object.defineProperty,Ac=h((i,e)=>k4(i,"name",{value:e,configurable:!0}),"__name$2v");let ad=[];var O4=Rt({props:{title:String,triggerBy:{type:String,default:"mousedown"},position:{type:String,default:"bottom"},disabled:Boolean,className:String,dynamicSize:Boolean},setup(i){const e=ze(),t=ze(),n=ze({left:0,top:0,width:"auto",height:"auto"}),s=ze(!1),r=ze(!1),o=new m1(d,f),a=ei("popupMenuItemContext",null);a&&(a.parent&&(o.root=a.parent.root||a.parent,o.zIndex=a.parent.zIndex+1),a.subMenu=o),Sl("popupMenuContext",o),rp(function(){o.root||ad.push(o)}),op(function(){o.root||(ad=ad.filter(p=>p!==o)),document.body.removeEventListener("mousedown",f)});function l(p){i.triggerBy==="mousedown"&&(r.value?f():d(e.value,i.position))}h(l,"onTriggerMouseDown"),Ac(l,"onTriggerMouseDown");function c(){if(i.triggerBy==="hover"||i.triggerBy==="mouseover")return d(e.value,i.position)}h(c,"onTriggerMouseOver"),Ac(c,"onTriggerMouseOver");function u(p){p.key==="Escape"&&(o.root?o.hide():f())}h(u,"onKeyDown"),Ac(u,"onKeyDown");async function d(p,g){if(i.disabled)return;o.root||ad.forEach(R=>R.hideAll());const m=document.body.getBoundingClientRect(),v=p.getBoundingClientRect(),y=m.width,b=m.height;r.value=!0,s.value=!1,n.value={left:0,top:0,width:"auto",height:"auto"},await Qi(),document.body.addEventListener("mousedown",f),t.value.focus();const _=t.value.getBoundingClientRect();let x,w;const T=_.right-_.left,P=_.bottom-_.top;if(typeof g=="object")x=g.x,w=g.y;else switch(g){case"bottom":x=v.left,w=v.bottom;break;default:x=v.right,w=v.top;break}const M={"z-index":o.zIndex};if(i.dynamicSize?(M.width="auto",M.height="auto",s.value=!1):(M.width=Math.floor(T)+"px",M.height=Math.floor(P)+"px",M.overflow="hidden",s.value=!0),x+T>y?M.right=0:M.left=Math.floor(x)+"px",w+P>b){const R=Math.floor(Math.max(0,b-P));M.top=R+"px",M.height=Math.floor(b-R)+"px"}else M.top=Math.floor(w)+"px";n.value=M}h(d,"show"),Ac(d,"show");function f(){var p,g;document.body.removeEventListener("mousedown",f),r.value=!1,(g=(p=o.currentVisibleSubMenu)==null?void 0:p.subMenu)==null||g.hide(),o.currentVisibleSubMenu=void 0}return h(f,"hide"),Ac(f,"hide"),{trigger:e,menu:t,onTriggerMouseDown:l,onTriggerMouseOver:c,onKeyDown:u,style:n,scrollable:s,visible:r,show:d,hide:f}}});const N4=["disabled"],F4={class:"scroll"};function z4(i,e,t,n,s,r){return Se(),ke(At,null,[i.title?(Se(),ke("button",{key:0,class:en(["popup-menu-trigger",i.className]),disabled:i.disabled,onMousedown:e[0]||(e[0]=mn((...o)=>i.onTriggerMouseDown&&i.onTriggerMouseDown(...o),["stop"])),onMouseover:e[1]||(e[1]=(...o)=>i.onTriggerMouseOver&&i.onTriggerMouseOver(...o)),ref:"trigger"},rn(i.title),43,N4)):Qe("",!0),(Se(),Bt(D0,{to:"body"},[i.visible?(Se(),ke("div",{key:0,class:en(["popup-menu",{scrollable:i.scrollable}]),style:En(i.style),ref:"menu",tabindex:"0",onMousedown:e[2]||(e[2]=mn(()=>{},["stop"])),onContextmenu:e[3]||(e[3]=mn(()=>{},["prevent"])),onKeydown:e[4]||(e[4]=(...o)=>i.onKeyDown&&i.onKeyDown(...o))},[he("div",F4,[Pu(i.$slots,"default",{},void 0,!0)])],38)):Qe("",!0)]))],64)}h(z4,"_sfc_render$l");var g1=Dt(O4,[["render",z4],["__scopeId","data-v-e883b650"]]),B4=Object.defineProperty,U4=h((i,e)=>B4(i,"name",{value:e,configurable:!0}),"__name$2u"),V4=Rt({components:{ColorPicker:OA,PopupMenu:g1},props:{value:Array},emits:["input"],setup(i,e){const t=Je(function(){const s=i.value||[1,1,1];return{"background-color":`#${new Te().setRGB(s[0],s[1],s[2]).getHexString()}`}});function n(s){e.emit("input",s)}return h(n,"onInput"),U4(n,"onInput"),{style:t,onInput:n}}});const H4={style:{padding:"8px 8px 0 8px"}};function G4(i,e,t,n,s,r){const o=qt("color-picker"),a=qt("popup-menu");return Se(),ke("div",{class:"input-color",style:En(i.style)},[Pe(a,{title:" "},{default:Ht(()=>[he("div",H4,[Pe(o,{value:i.value,"onUpdate:value":i.onInput},null,8,["value","onUpdate:value"])])]),_:1})],4)}h(G4,"_sfc_render$k");var Pp=Dt(V4,[["render",G4],["__scopeId","data-v-1ea277a0"]]),nS=Object.defineProperty,W4=Object.getOwnPropertyDescriptor,j4=h((i,e)=>nS(i,"name",{value:e,configurable:!0}),"__name$2t"),$4=h((i,e,t,n)=>{for(var s=n>1?void 0:n?W4(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&nS(e,t,s),s},"__decorateClass$F");let gn=h(class extends Ke{constructor(){super(...arguments);C(this,"value",[1,1,1])}},"CColor");j4(gn,"CColor");gn=$4([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,autoCopy:!0,equal:(i,e)=>new Te().setRGB(i[0],i[1],i[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Color",inlineLabel:!0,inputComponent:Pp,clone(i){return[...i]}})],gn);var X4=Rt({props:{value:Object},setup(){}});const Y4={key:0,class:"credit-info"},K4=["href"],q4=["href"],Z4=["href"];function Q4(i,e,t,n,s,r){return i.value?(Se(),ke("div",Y4,[fr(" This work is based on "),he("a",{href:i.value.url,target:"_blank"},rn(i.value.name),9,K4),fr(" by "),he("a",{href:i.value.user.url,target:"_blank"},rn(i.value.user.name),9,q4),fr(" licensed under "),he("a",{href:i.value.license.url,target:"_blank"},rn(i.value.license.name),9,Z4),fr(". ")])):Qe("",!0)}h(Q4,"_sfc_render$j");var J4=Dt(X4,[["render",Q4],["__scopeId","data-v-64ad5277"]]),eF=Object.defineProperty,tF=h((i,e)=>eF(i,"name",{value:e,configurable:!0}),"__name$2s");function wu(i){if(typeof i!="object"||!i)return i;if(Array.isArray(i))return i.map(wu);const e={};for(let t in i)if(i.hasOwnProperty(t)){const n=i[t];typeof n=="object"?ArrayBuffer.isView(n)?e[t]=n:Array.isArray(n)?e[t]=n.map(wu):e[t]=wu(n):e[t]=n}return e}h(wu,"deepClone");tF(wu,"deepClone");var iS=Object.defineProperty,nF=Object.getOwnPropertyDescriptor,iF=h((i,e)=>iS(i,"name",{value:e,configurable:!0}),"__name$2r"),sF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?nF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&iS(e,t,s),s},"__decorateClass$E");let Vu=h(class extends Ke{constructor(){super(...arguments);C(this,"value",null)}},"CCredit");iF(Vu,"CCredit");Vu=sF([Ze({storable:!0,dataType:$e.STRING,clone:wu,label:"Credit",inputComponent:J4,serialize(i){return i?JSON.stringify(i):""},deserialize(i){return i?JSON.parse(i):null}})],Vu);var sS=Object.defineProperty,rF=Object.getOwnPropertyDescriptor,oF=h((i,e)=>sS(i,"name",{value:e,configurable:!0}),"__name$2q"),aF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?rF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&sS(e,t,s),s},"__decorateClass$D");let Fs=h(class extends Ke{constructor(){super(...arguments);C(this,"value",[0,0,0])}},"CEmissive");oF(Fs,"CEmissive");Fs=aF([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,equal:(i,e)=>new Te().setRGB(i[0],i[1],i[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Emissive",inlineLabel:!0,inputComponent:Pp,clone(i){return[...i]}})],Fs);var rS=Object.defineProperty,lF=Object.getOwnPropertyDescriptor,cF=h((i,e)=>rS(i,"name",{value:e,configurable:!0}),"__name$2p"),uF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?lF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&rS(e,t,s),s},"__decorateClass$C");let Hu=h(class extends Ke{constructor(){super(...arguments);C(this,"value",[1,1,1])}},"CGroundColor");cF(Hu,"CGroundColor");Hu=uF([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,autoCopy:!0,equal:(i,e)=>new Te().setRGB(i[0],i[1],i[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Ground Color",inputComponent:Pp,clone(i){return[...i]}})],Hu);var oS=Object.defineProperty,hF=Object.getOwnPropertyDescriptor,dF=h((i,e)=>oS(i,"name",{value:e,configurable:!0}),"__name$2o"),fF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?hF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&oS(e,t,s),s},"__decorateClass$B");let Gu=h(class extends Ke{constructor(){super(...arguments);C(this,"value",.5)}},"CHeight");dF(Gu,"CHeight");Gu=fF([Ze({storable:!0,dataType:$e.NUMBER,autoCopy:!0,label:"Height",inputComponent:Rr,inputComponentProps:{min:0,step:.001}})],Gu);var pF=Object.defineProperty,Sc=h((i,e)=>pF(i,"name",{value:e,configurable:!0}),"__name$2n"),mF=Rt({components:{InputNumber:Rr},props:{value:{type:Array,required:!0},min:{type:Number,required:!0},max:{type:Number,required:!0},maxDet:{type:Number,required:!0},step:{type:Number,default:1}},emits:["input"],setup(i,e){const t=ze(),n=Je(function(){let f=i.min,p=i.max;return{left:(i.value[0]-f)/(p-f)*100+"%"}}),s=Je(function(){let f=i.min,p=i.max;return{left:(i.value[1]-f)/(p-f)*100+"%"}}),r=Je(function(){let f=i.min,p=i.max;return{left:(i.value[0]-f)/(p-f)*100+"%",width:(i.value[1]-i.value[0])/(p-f)*100+"%"}});function o(f){let p=Math.min(i.max,Math.max(i.min,Math.round(f/i.step)*i.step)),g=i.value[1];g<p&&(g=p),g-p>i.maxDet&&(g=Math.min(i.max,Math.max(i.min,p+i.maxDet))),e.emit("input",[p,g])}h(o,"inputValue1"),Sc(o,"inputValue1");function a(f){let p=i.value[0],g=Math.min(i.max,Math.max(i.min,Math.round(f/i.step)*i.step));p>g&&(p=g),g-p>i.maxDet&&(p=Math.min(i.max,Math.max(i.min,g-i.maxDet))),e.emit("input",[p,g])}h(a,"inputValue2"),Sc(a,"inputValue2");let l="bar";function c(){switch(l){case"bar":let f=Math.min(i.max,Math.max(i.min,Math.round((i.value[0]-i.step)/i.step)*i.step));if(f>=i.min){let p=Math.min(i.max,Math.max(i.min,Math.round((i.value[1]+(f-i.value[0]))/i.step)*i.step));e.emit("input",[f,p])}break;case"val1":o(i.value[0]-i.step);break;case"val2":a(i.value[1]-i.step);break}}h(c,"moveLeft"),Sc(c,"moveLeft");function u(){switch(l){case"bar":let f=Math.min(i.max,Math.max(i.min,Math.round((i.value[1]+i.step)/i.step)*i.step));if(f<=i.max){let p=Math.min(i.max,Math.max(i.min,Math.round((i.value[0]+(f-i.value[1]))/i.step)*i.step));e.emit("input",[p,f])}break;case"val1":o(i.value[0]+i.step);break;case"val2":a(i.value[1]+i.step);break}}h(u,"moveRight"),Sc(u,"moveRight");function d(f){const g=t.value.getBoundingClientRect(),m=f.clientX-g.left,v=i.value[0],y=i.value[1],b=i.min,_=i.max;l="bar",m<=(i.value[0]-b)/(_-b)*g.width+2&&(l="val1"),m>=(i.value[1]-b)/(_-b)*g.width-2&&(l="val2"),va(f,x=>{const T=t.value.getBoundingClientRect(),P=x.clientX-T.left,M=Math.min(1,Math.max(0,P/T.width)),R=(i.max-i.min)*M+i.min;switch(l){case"bar":const L=(P-m)/T.width*(i.max-i.min);if(L<0){let W=Math.min(i.max,Math.max(i.min,Math.round((v+L)/i.step)*i.step));if(W>=i.min){let k=Math.min(i.max,Math.max(i.min,Math.round((y+(W-v))/i.step)*i.step));e.emit("input",[W,k])}}else{let W=Math.min(i.max,Math.max(i.min,Math.round((y+L)/i.step)*i.step));if(W<=i.max){let k=Math.min(i.max,Math.max(i.min,Math.round((v+(W-y))/i.step)*i.step));e.emit("input",[k,W])}}break;case"val1":R<=i.value[1]&&i.value[1]-R<=i.maxDet&&o(R);break;case"val2":R>=i.value[0]&&R-i.value[0]<=i.maxDet&&a(R);break}})}return h(d,"onPointerDown"),Sc(d,"onPointerDown"),{bar:t,slider1Style:n,slider2Style:s,sliderBarStyle:r,inputValue1:o,inputValue2:a,moveLeft:c,moveRight:u,onPointerDown:d}}});const gF={class:"input-double-range"},vF={class:"input-double-range__slider-container",ref:"bar"};function yF(i,e,t,n,s,r){const o=qt("input-number");return Se(),ke("div",gF,[Pe(o,{value:i.value[0],onInput:i.inputValue1},null,8,["value","onInput"]),he("div",{class:"input-double-range__bar",tabindex:"0",onKeydown:[e[0]||(e[0]=Sn((...a)=>i.moveLeft&&i.moveLeft(...a),["left"])),e[1]||(e[1]=Sn((...a)=>i.moveRight&&i.moveRight(...a),["right"]))],onPointerdown:e[2]||(e[2]=(...a)=>i.onPointerDown&&i.onPointerDown(...a))},[he("div",vF,[he("div",{class:"input-double-range__slider-bar",style:En(i.sliderBarStyle)},null,4),he("div",{class:"input-double-range__slider",style:En(i.slider1Style)},null,4),he("div",{class:"input-double-range__slider",style:En(i.slider2Style)},null,4)],512)],32),Pe(o,{value:i.value[1],onInput:i.inputValue2},null,8,["value","onInput"])])}h(yF,"_sfc_render$i");var _F=Dt(mF,[["render",yF],["__scopeId","data-v-5aca574d"]]),aS=Object.defineProperty,bF=Object.getOwnPropertyDescriptor,wF=h((i,e)=>aS(i,"name",{value:e,configurable:!0}),"__name$2m"),xF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?bF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&aS(e,t,s),s},"__decorateClass$A");let co=h(class extends Ke{constructor(){super(...arguments);C(this,"value",[-180,180])}},"CHingeAngleRange");wF(co,"CHingeAngleRange");co=xF([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,autoCopy:!0,label:"Hinge Limit",inputComponent:_F,inputComponentProps:{min:-360,max:360,maxDet:360}})],co);var MF=Object.defineProperty,AF=h((i,e)=>MF(i,"name",{value:e,configurable:!0}),"__name$2l"),SF=Rt({props:{value:String,disabled:Boolean,options:Array},emits:["input"],setup(i,e){const t=ze();function n(){const s=t.value;s&&e.emit("input",s.value)}return h(n,"onChange"),AF(n,"onChange"),{selectDom:t,onChange:n}}});const CF=["value","disabled"],TF=["value"];function EF(i,e,t,n,s,r){return Se(),ke("select",{class:"input-select",value:i.value,disabled:i.disabled,onChange:e[0]||(e[0]=(...o)=>i.onChange&&i.onChange(...o)),ref:"selectDom"},[(Se(!0),ke(At,null,ro(i.options,o=>(Se(),ke("option",{key:o,value:o},rn(o),9,TF))),128))],40,CF)}h(EF,"_sfc_render$h");var ch=Dt(SF,[["render",EF],["__scopeId","data-v-f534510c"]]),lS=Object.defineProperty,PF=Object.getOwnPropertyDescriptor,RF=h((i,e)=>lS(i,"name",{value:e,configurable:!0}),"__name$2k"),IF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?PF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&lS(e,t,s),s},"__decorateClass$z");let Ti=h(class extends Ke{constructor(){super(...arguments);C(this,"value","none")}},"CHingeAxis");RF(Ti,"CHingeAxis");Ti=IF([Ze({storable:!0,dataType:$e.STRING,autoCopy:!0,label:"Hinge",inputComponent:ch,inputComponentProps:{options:["none","horizontal","vertical"]}})],Ti);var cS=Object.defineProperty,DF=Object.getOwnPropertyDescriptor,LF=h((i,e)=>cS(i,"name",{value:e,configurable:!0}),"__name$2j"),kF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?DF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&cS(e,t,s),s},"__decorateClass$y");const km=24,Kn=new A;let mt=h(class extends Ke{constructor(){super(...arguments);C(this,"value");C(this,"dirty",!0);C(this,"start",new A);C(this,"end",new A);C(this,"quaternion",new Be);C(this,"boneMesh");C(this,"hingeIndicator");C(this,"moveHandler");C(this,"rotateHandler");C(this,"moveHandlerHovered",!1);C(this,"moveHandlerZ",0);C(this,"rotateHandlerHovered",!1);C(this,"rotateHandlerZ",0);C(this,"hingeEnabled",!1)}onRemoved(){var e,t;this.boneMesh&&(ya(this.boneMesh),this.boneMesh.removeFromParent()),this.hingeIndicator&&(ya(this.hingeIndicator),this.hingeIndicator.removeFromParent()),this.moveHandler&&(this.moveHandler.geometry.dispose(),(e=this.moveHandler.material)==null||e.dispose(),this.moveHandler.removeFromParent()),this.rotateHandler&&(this.rotateHandler.geometry.dispose(),(t=this.rotateHandler.material)==null||t.dispose(),this.rotateHandler.removeFromParent())}updateHandlersHoverState(e,t){var n,s;(n=this.moveHandler)!=null&&n.visible&&(Kn.copy(this.start).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),Kn.x+=1,Kn.y+=1,Kn.x*=t.width/2,Kn.y*=t.height/2,this.moveHandlerZ=Kn.z,Math.abs(t.mouseScr.x-Kn.x)<=km/2&&Math.abs(t.mouseScr.y-Kn.y)<=km/2&&(this.moveHandlerHovered=!0)),(s=this.rotateHandler)!=null&&s.visible&&(Kn.copy(this.end).applyMatrix4(e.getParentWorldMatrix()).project(t.camera.get()),Kn.x+=1,Kn.y+=1,Kn.x*=t.width/2,Kn.y*=t.height/2,this.rotateHandlerZ=Kn.z,Math.sqrt((t.mouseScr.x-Kn.x)**2+(t.mouseScr.y-Kn.y)**2)<=km/2&&(this.rotateHandlerHovered=!0)),this.moveHandlerHovered&&this.rotateHandlerHovered&&(this.moveHandlerZ<this.rotateHandlerZ?this.rotateHandlerHovered=!1:this.moveHandlerHovered=!1)}resetHandlers(e){this.moveHandlerHovered=!1,this.rotateHandlerHovered=!1,this.boneMesh&&(this.boneMesh.visible=e.options.showIkBones),this.hingeIndicator&&(this.hingeIndicator.visible=e.options.showIkBones&&this.hingeEnabled),this.moveHandler&&(this.moveHandler.visible=!1),this.rotateHandler&&(this.rotateHandler.visible=!1)}},"CIkNode");LF(mt,"CIkNode");mt=kF([Ze({})],mt);var uS=Object.defineProperty,OF=Object.getOwnPropertyDescriptor,NF=h((i,e)=>uS(i,"name",{value:e,configurable:!0}),"__name$2i"),FF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?OF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&uS(e,t,s),s},"__decorateClass$x");let fi=h(class extends Ke{constructor(){super(...arguments);C(this,"value",.2)}},"CIkNodeLength");NF(fi,"CIkNodeLength");fi=FF([Ze({storable:!0,dataType:$e.NUMBER,autoCopy:!0,equal(i,e){return Math.abs(i-e)<1e-8},label:"Length",inputComponent:Rr,inputComponentProps:{min:0}})],fi);var zF=Object.defineProperty,Cc=h((i,e)=>zF(i,"name",{value:e,configurable:!0}),"__name$2h"),BF=Rt({props:{value:{type:it,required:!0},readonly:Boolean,disabled:Boolean,resettable:Boolean},emits:["input"],setup(i,e){const t=ze(),n=ze(),s=ze();let r=!1;function o(){r&&(c(),document.removeEventListener("mousedown",o))}h(o,"postOnMouseDown"),Cc(o,"postOnMouseDown");function a(d){return Number((d/Math.PI*180).toFixed(1))}h(a,"format"),Cc(a,"format");function l(){r||(r=!0,document.addEventListener("mousedown",o))}h(l,"onChange"),Cc(l,"onChange"),xa(function(){document.removeEventListener("mousedown",o)});function c(){var d,f,p;if(r){r=!1;let g=Number(((d=t.value)==null?void 0:d.value)||"0")||0,m=Number(((f=n.value)==null?void 0:f.value)||"0")||0,v=Number(((p=s.value)==null?void 0:p.value)||"0")||0;e.emit("input",new it(g/180*Math.PI,m/180*Math.PI,v/180*Math.PI))}}h(c,"onPost"),Cc(c,"onPost");function u(){e.emit("input",new it)}return h(u,"onReset"),Cc(u,"onReset"),{input0:t,input1:n,input2:s,format:a,onChange:l,onPost:c,onReset:u}}});const UF=h(i=>(ba("data-v-6ff85571"),i=i(),wa(),i),"_withScopeId$1"),VF={class:"input-euler"},HF=["value","readonly","disabled"],GF=["value","readonly","disabled"],WF=["value","readonly","disabled"],jF=UF(()=>he("img",{src:n1,alt:""},null,-1)),$F=[jF];function XF(i,e,t,n,s,r){return Se(),ke("div",VF,[he("input",{type:"text",placeholder:"x",value:i.format(i.value.x),readonly:i.readonly,disabled:i.disabled,onInput:e[0]||(e[0]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[2]||(e[2]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"input0"},null,40,HF),he("input",{type:"text",placeholder:"y",value:i.format(i.value.y),readonly:i.readonly,disabled:i.disabled,onInput:e[3]||(e[3]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[4]||(e[4]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[5]||(e[5]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"input1"},null,40,GF),he("input",{type:"text",placeholder:"z",value:i.format(i.value.z),readonly:i.readonly,disabled:i.disabled,onInput:e[6]||(e[6]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[7]||(e[7]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[8]||(e[8]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"input2"},null,40,WF),i.resettable?(Se(),ke("button",{key:0,class:"normal-button",onClick:e[9]||(e[9]=(...o)=>i.onReset&&i.onReset(...o))},$F)):Qe("",!0)])}h(XF,"_sfc_render$g");var hS=Dt(BF,[["render",XF],["__scopeId","data-v-6ff85571"]]),dS=Object.defineProperty,YF=Object.getOwnPropertyDescriptor,KF=h((i,e)=>dS(i,"name",{value:e,configurable:!0}),"__name$2g"),qF=h((i,e,t,n)=>{for(var s=n>1?void 0:n?YF(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&dS(e,t,s),s},"__decorateClass$w");let Ut=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new it)}},"CIkNodeRotation");KF(Ut,"CIkNodeRotation");Ut=qF([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,instanceable:!0,equal(i,e){return Math.abs(i.x-e.x)<1e-8&&Math.abs(i.y-e.y)<1e-8&&Math.abs(i.z-e.z)<1e-8},label:"Rotation",inputComponent:hS,inputComponentProps:{resettable:!0},clone(i){return new it().copy(i)},serialize(i){return[i.x,i.y,i.z]},deserialize(i){return new it(i[0],i[1],i[2])}})],Ut);var ZF=Object.defineProperty,QF=h((i,e)=>ZF(i,"name",{value:e,configurable:!0}),"__name$2f"),JF=Rt({props:{value:String,accept:String},emits:["input"],setup(i,e){const t=ze();async function n(){var o;if(!((o=t.value)!=null&&o.files))return;const s=t.value.files[0];if(!s)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsDataURL(s)});t.value.value="",e.emit("input",r)}return h(n,"onChange"),QF(n,"onChange"),{input:t,onChange:n}}});const e5={class:"input-file normal-button"},t5=["accept"];function n5(i,e,t,n,s,r){return Se(),ke("div",null,[he("label",e5,[he("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>i.onChange&&i.onChange(...o)),accept:i.accept},null,40,t5),fr(" ... ")])])}h(n5,"_sfc_render$f");var fS=Dt(JF,[["render",n5],["__scopeId","data-v-cd0c5822"]]),pS=Object.defineProperty,i5=Object.getOwnPropertyDescriptor,s5=h((i,e)=>pS(i,"name",{value:e,configurable:!0}),"__name$2e"),r5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?i5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&pS(e,t,s),s},"__decorateClass$v");let uo=h(class extends Ke{constructor(){super(...arguments);C(this,"value","");C(this,"dirty",!0);C(this,"texture")}onRemoved(){this.texture&&this.texture.dispose()}},"CImage");s5(uo,"CImage");uo=r5([Ze({storable:!0,dataType:$e.STRING,label:"Image File",inputComponent:fS,inputComponentProps:{accept:"image/png, image/jpeg"}})],uo);var mS=Object.defineProperty,o5=Object.getOwnPropertyDescriptor,a5=h((i,e)=>mS(i,"name",{value:e,configurable:!0}),"__name$2d"),l5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?o5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&mS(e,t,s),s},"__decorateClass$u");let ho=h(class extends Ke{constructor(){super(...arguments);C(this,"value","");C(this,"dirty",!0)}},"CImportFbx");a5(ho,"CImportFbx");ho=l5([Ze({storable:!0,dataType:$e.STRING,label:".fbx File",inputComponent:fS,inputComponentProps:{accept:".fbx"}})],ho);var c5=Object.defineProperty,u5=h((i,e)=>c5(i,"name",{value:e,configurable:!0}),"__name$2c"),h5=Rt({props:{value:String,accept:String},emits:["input"],setup(i,e){const t=ze();async function n(){var o;if(!((o=t.value)!=null&&o.files))return;const s=t.value.files[0];if(!s)return;const r=await new Promise(function(a,l){const c=new FileReader;c.onload=function(){a(c.result)},c.onerror=l,c.readAsText(s)});t.value.value="",e.emit("input",r)}return h(n,"onChange"),u5(n,"onChange"),{input:t,onChange:n}}});const d5={class:"input-file normal-button"},f5=["accept"];function p5(i,e,t,n,s,r){return Se(),ke("div",null,[he("label",d5,[he("input",{type:"file",ref:"input",onChange:e[0]||(e[0]=(...o)=>i.onChange&&i.onChange(...o)),accept:i.accept},null,40,f5),fr(" ... ")])])}h(p5,"_sfc_render$e");var m5=Dt(h5,[["render",p5],["__scopeId","data-v-51992a25"]]),gS=Object.defineProperty,g5=Object.getOwnPropertyDescriptor,v5=h((i,e)=>gS(i,"name",{value:e,configurable:!0}),"__name$2b"),y5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?g5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&gS(e,t,s),s},"__decorateClass$t");let fo=h(class extends Ke{constructor(){super(...arguments);C(this,"value","");C(this,"dirty",!0)}},"CImportObj");v5(fo,"CImportObj");fo=y5([Ze({storable:!0,dataType:$e.STRING,label:".obj File",inputComponent:m5,inputComponentProps:{accept:".obj"}})],fo);var vS=Object.defineProperty,_5=Object.getOwnPropertyDescriptor,b5=h((i,e)=>vS(i,"name",{value:e,configurable:!0}),"__name$2a"),w5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?_5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&vS(e,t,s),s},"__decorateClass$s");let Ar=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new Uint8Array);C(this,"dirty",!0)}},"CImportReadonlyGltf");b5(Ar,"CImportReadonlyGltf");Ar=w5([Ze({storable:!0,dataType:$e.BYTES})],Ar);var yS=Object.defineProperty,x5=Object.getOwnPropertyDescriptor,M5=h((i,e)=>yS(i,"name",{value:e,configurable:!0}),"__name$29"),A5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?x5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&yS(e,t,s),s},"__decorateClass$r");let oi=h(class extends Ke{constructor(){super(...arguments);C(this,"value",1)}},"CIntensity");M5(oi,"CIntensity");oi=A5([Ze({storable:!0,dataType:$e.NUMBER,autoCopy:!0,equal(i,e){return Math.abs(i-e)<1e-8},label:"Intensity",inputComponent:Rr,inputComponentProps:{min:0,step:.001}})],oi);var _S=Object.defineProperty,S5=Object.getOwnPropertyDescriptor,C5=h((i,e)=>_S(i,"name",{value:e,configurable:!0}),"__name$28"),T5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?S5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&_S(e,t,s),s},"__decorateClass$q");let pi=h(class extends Ke{constructor(){super(...arguments);C(this,"value",null);C(this,"camera",null)}onRemoved(){this.value&&(ya(this.value),this.value.removeFromParent(),this.value=null),this.camera&&(ya(this.camera),this.camera.removeFromParent(),this.camera=null)}},"CLightHelper");C5(pi,"CLightHelper");pi=T5([Ze({})],pi);var bS=Object.defineProperty,E5=Object.getOwnPropertyDescriptor,P5=h((i,e)=>bS(i,"name",{value:e,configurable:!0}),"__name$27"),R5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?E5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&bS(e,t,s),s},"__decorateClass$p");let Wu=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!1)}},"CLockEnd");P5(Wu,"CLockEnd");Wu=R5([Ze({storable:!0,dataType:$e.BOOLEAN,autoCopy:!0,label:"Lock End",inlineLabel:!0,inputComponent:Ta})],Wu);var wS=Object.defineProperty,I5=Object.getOwnPropertyDescriptor,D5=h((i,e)=>wS(i,"name",{value:e,configurable:!0}),"__name$26"),L5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?I5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&wS(e,t,s),s},"__decorateClass$o");let _r=h(class extends Ke{constructor(){super(...arguments);C(this,"value","512")}},"CMapSize");D5(_r,"CMapSize");_r=L5([Ze({storable:!0,dataType:$e.STRING,autoCopy:!0,label:"Shadow Quality",inputComponent:ch,inputComponentProps:{options:["128","256","512","1024","2048"]}})],_r);var k5=Object.defineProperty,ld=h((i,e)=>k5(i,"name",{value:e,configurable:!0}),"__name$25"),O5=Rt({props:{value:Number,min:{type:Number,required:!0},max:{type:Number,required:!0},step:Number},emits:["input"],setup(i,e){const t=Je(function(){return i.step?Math.round(i.min/i.step):i.min}),n=Je(function(){return i.step?Math.round(i.max/i.step):i.max}),s=Je(function(){const f=i.value==null?0:i.value;return i.step?Math.round(f/i.step):f}),r=Je(function(){const f=i.value==null?0:i.value;return i.step?f.toFixed(-Math.log10(i.step)):f});function o(f){let p=Number(f.target.value);i.step&&(p*=i.step),e.emit("input",p)}h(o,"onRangeInput"),ld(o,"onRangeInput");const a=ze();let l=!1;function c(){l&&(d(),document.removeEventListener("mousedown",c))}h(c,"postOnMouseDown"),ld(c,"postOnMouseDown");function u(){l||(l=!0,document.addEventListener("mousedown",c))}h(u,"onChange"),ld(u,"onChange"),xa(function(){document.removeEventListener("mousedown",c)});function d(){if(l){l=!1;const f=a.value;if(f){const p=f.value;let g=Number(p);isFinite(g)||(g=0),i.step!=null&&(g=Math.round(g/i.step)*i.step),i.min!=null&&(g=Math.max(i.min,g)),i.max!=null&&(g=Math.min(i.max,g)),e.emit("input",g)}}}return h(d,"onPost"),ld(d,"onPost"),{inputDom:a,onChange:u,onPost:d,iMin:t,iMax:n,iValue:s,text:r,onRangeInput:o}}});const N5={class:"input-range"},F5=["value","min","max"],z5=["value"];function B5(i,e,t,n,s,r){return Se(),ke("div",N5,[he("input",{class:"range",type:"range",value:i.iValue,min:i.iMin,max:i.iMax,onInput:e[0]||(e[0]=(...o)=>i.onRangeInput&&i.onRangeInput(...o))},null,40,F5),he("input",{class:"num",type:"text",value:i.text,onInput:e[1]||(e[1]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[2]||(e[2]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[3]||(e[3]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"inputDom"},null,40,z5)])}h(B5,"_sfc_render$d");var uh=Dt(O5,[["render",B5],["__scopeId","data-v-63841fa7"]]),xS=Object.defineProperty,U5=Object.getOwnPropertyDescriptor,V5=h((i,e)=>xS(i,"name",{value:e,configurable:!0}),"__name$24"),H5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?U5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&xS(e,t,s),s},"__decorateClass$n");let zs=h(class extends Ke{constructor(){super(...arguments);C(this,"value",0)}},"CMetalness");V5(zs,"CMetalness");zs=H5([Ze({storable:!0,dataType:$e.NUMBER,equal(i,e){return Math.abs(i-e)<1e-8},label:"Metalness",inputComponent:uh,inputComponentProps:{min:0,max:1,step:.01}})],zs);var G5=Object.defineProperty,Om=h((i,e)=>G5(i,"name",{value:e,configurable:!0}),"__name$23"),W5=Rt({props:{value:String,readonly:Boolean,disabled:Boolean},emits:["input"],setup(i,e){const t=ze();let n=!1;function s(){n&&(o(),document.removeEventListener("mousedown",s))}h(s,"postOnMouseDown"),Om(s,"postOnMouseDown");function r(){n||(n=!0,document.addEventListener("mousedown",s))}h(r,"onChange"),Om(r,"onChange"),xa(function(){document.removeEventListener("mousedown",s)});function o(){if(n){n=!1;const a=t.value;a&&e.emit("input",a.value)}}return h(o,"onPost"),Om(o,"onPost"),{inputDom:t,onChange:r,onPost:o}}});const j5=["value","readonly","disabled"];function $5(i,e,t,n,s,r){return Se(),ke("input",{class:"input-string",type:"text",value:i.value,readonly:i.readonly,disabled:i.disabled,onInput:e[0]||(e[0]=(...o)=>i.onChange&&i.onChange(...o)),onBlur:e[1]||(e[1]=(...o)=>i.onPost&&i.onPost(...o)),onKeydown:e[2]||(e[2]=Sn((...o)=>i.onPost&&i.onPost(...o),["enter"])),ref:"inputDom"},null,40,j5)}h($5,"_sfc_render$c");var X5=Dt(W5,[["render",$5],["__scopeId","data-v-07fa832a"]]),MS=Object.defineProperty,Y5=Object.getOwnPropertyDescriptor,K5=h((i,e)=>MS(i,"name",{value:e,configurable:!0}),"__name$22"),q5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Y5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&MS(e,t,s),s},"__decorateClass$m");let Kt=h(class extends Ke{constructor(){super(...arguments);C(this,"value","")}},"CName");K5(Kt,"CName");Kt=q5([Ze({storable:!0,dataType:$e.STRING,instanceable:!0,label:"Name",inputComponent:X5})],Kt);var AS=Object.defineProperty,Z5=Object.getOwnPropertyDescriptor,Q5=h((i,e)=>AS(i,"name",{value:e,configurable:!0}),"__name$21"),J5=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Z5(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&AS(e,t,s),s},"__decorateClass$l");let Un=h(class extends Ke{constructor(){super(...arguments);C(this,"value",1)}},"COpacity");Q5(Un,"COpacity");Un=J5([Ze({storable:!0,dataType:$e.NUMBER,equal(i,e){return Math.abs(i-e)<1e-8},label:"Opacity",inputComponent:uh,inputComponentProps:{min:0,max:1,step:.01}})],Un);var SS=Object.defineProperty,ez=Object.getOwnPropertyDescriptor,tz=h((i,e)=>SS(i,"name",{value:e,configurable:!0}),"__name$20"),nz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?ez(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&SS(e,t,s),s},"__decorateClass$k");let ju=h(class extends Ke{constructor(){super(...arguments);C(this,"value",0)}},"CPenumbra");tz(ju,"CPenumbra");ju=nz([Ze({storable:!0,dataType:$e.NUMBER,autoCopy:!0,label:"Edge Softness",inputComponent:uh,inputComponentProps:{min:0,max:1,step:.01}})],ju);var CS=Object.defineProperty,iz=Object.getOwnPropertyDescriptor,sz=h((i,e)=>CS(i,"name",{value:e,configurable:!0}),"__name$1$"),rz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?iz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&CS(e,t,s),s},"__decorateClass$j");let Ue=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new A)}},"CPosition");sz(Ue,"CPosition");Ue=rz([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,instanceable:!0,equal:tc,label:"Position",inputComponent:JA,inputComponentProps:{resettable:!0},clone(i){return new A().copy(i)},serialize(i){return[i.x,i.y,i.z]},deserialize(i){return new A(i[0],i[1],i[2])}})],Ue);var TS=Object.defineProperty,oz=Object.getOwnPropertyDescriptor,az=h((i,e)=>TS(i,"name",{value:e,configurable:!0}),"__name$1_"),lz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?oz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&TS(e,t,s),s},"__decorateClass$i");let ri=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!0)}},"CReceiveShadow");az(ri,"CReceiveShadow");ri=lz([Ze({storable:!0,dataType:$e.BOOLEAN,instanceable:!0,label:"Receive Shadow",inlineLabel:!0,inputComponent:Ta})],ri);var ES=Object.defineProperty,cz=Object.getOwnPropertyDescriptor,uz=h((i,e)=>ES(i,"name",{value:e,configurable:!0}),"__name$1Z"),hz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?cz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&ES(e,t,s),s},"__decorateClass$h");let lt=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new it)}},"CRotation");uz(lt,"CRotation");lt=hz([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,instanceable:!0,equal(i,e){return Math.abs(i.x-e.x)<1e-8&&Math.abs(i.y-e.y)<1e-8&&Math.abs(i.z-e.z)<1e-8},label:"Rotation",inputComponent:hS,inputComponentProps:{resettable:!0},clone(i){return new it().copy(i)},serialize(i){return[i.x,i.y,i.z]},deserialize(i){return new it(i[0],i[1],i[2])}})],lt);var PS=Object.defineProperty,dz=Object.getOwnPropertyDescriptor,fz=h((i,e)=>PS(i,"name",{value:e,configurable:!0}),"__name$1Y"),pz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?dz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&PS(e,t,s),s},"__decorateClass$g");let Bs=h(class extends Ke{constructor(){super(...arguments);C(this,"value",1)}},"CRoughness");fz(Bs,"CRoughness");Bs=pz([Ze({storable:!0,dataType:$e.NUMBER,equal(i,e){return Math.abs(i-e)<1e-8},label:"Roughness",inputComponent:uh,inputComponentProps:{min:0,max:1,step:.01}})],Bs);var RS=Object.defineProperty,mz=Object.getOwnPropertyDescriptor,gz=h((i,e)=>RS(i,"name",{value:e,configurable:!0}),"__name$1X"),vz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?mz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&RS(e,t,s),s},"__decorateClass$f");let Ft=h(class extends Ke{constructor(){super(...arguments);C(this,"value",1)}},"CScale");gz(Ft,"CScale");Ft=vz([Ze({storable:!0,dataType:$e.NUMBER,instanceable:!0,equal(i,e){return Math.abs(i-e)<1e-8},label:"Scale",inputComponent:Rr,inputComponentProps:{resettable:!0,defaultValue:1}})],Ft);var IS=Object.defineProperty,yz=Object.getOwnPropertyDescriptor,_z=h((i,e)=>IS(i,"name",{value:e,configurable:!0}),"__name$1W"),bz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?yz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&IS(e,t,s),s},"__decorateClass$e");let Si=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!0);C(this,"throttleHash","")}},"CSdfDirty");_z(Si,"CSdfDirty");Si=bz([Ze({})],Si);var DS=Object.defineProperty,wz=Object.getOwnPropertyDescriptor,xz=h((i,e)=>DS(i,"name",{value:e,configurable:!0}),"__name$1V"),Mz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?wz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&DS(e,t,s),s},"__decorateClass$d");let Vl=h(class extends Ke{constructor(){super(...arguments);C(this,"value","add")}},"CSdfOperator");xz(Vl,"CSdfOperator");Vl=Mz([Ze({storable:!0,dataType:$e.STRING,label:"Operator",inputComponent:ch,inputComponentProps:{options:["add","subtract"]}})],Vl);var LS=Object.defineProperty,Az=Object.getOwnPropertyDescriptor,Sz=h((i,e)=>LS(i,"name",{value:e,configurable:!0}),"__name$1U"),Cz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Az(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&LS(e,t,s),s},"__decorateClass$c");let $u=h(class extends Ke{constructor(){super(...arguments);C(this,"value",10)}},"CShadowMappingRange");Sz($u,"CShadowMappingRange");$u=Cz([Ze({storable:!0,dataType:$e.NUMBER,autoCopy:!0,label:"Shadow Mapping Range",inputComponent:Rr,inputComponentProps:{min:0}})],$u);var kS=Object.defineProperty,Tz=Object.getOwnPropertyDescriptor,Ez=h((i,e)=>kS(i,"name",{value:e,configurable:!0}),"__name$1T"),Pz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Tz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&kS(e,t,s),s},"__decorateClass$b");let Hl=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!1)}},"CShowMoveHandler");Ez(Hl,"CShowMoveHandler");Hl=Pz([Ze({storable:!0,dataType:$e.BOOLEAN,autoCopy:!0,label:"Move Handler",inlineLabel:!0,inputComponent:Ta})],Hl);var OS=Object.defineProperty,Rz=Object.getOwnPropertyDescriptor,Iz=h((i,e)=>OS(i,"name",{value:e,configurable:!0}),"__name$1S"),Dz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Rz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&OS(e,t,s),s},"__decorateClass$a");let Gl=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!0)}},"CShowRotateHandler");Iz(Gl,"CShowRotateHandler");Gl=Dz([Ze({storable:!0,dataType:$e.BOOLEAN,autoCopy:!0,label:"Rotate Handler",inlineLabel:!0,inputComponent:Ta})],Gl);var NS=Object.defineProperty,Lz=Object.getOwnPropertyDescriptor,kz=h((i,e)=>NS(i,"name",{value:e,configurable:!0}),"__name$1R"),Oz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Lz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&NS(e,t,s),s},"__decorateClass$9");let Xu=h(class extends Ke{constructor(){super(...arguments);C(this,"value",[1,1,1])}},"CSkyColor");kz(Xu,"CSkyColor");Xu=Oz([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,autoCopy:!0,equal:(i,e)=>new Te().setRGB(i[0],i[1],i[2]).getHex()===new Te().setRGB(e[0],e[1],e[2]).getHex(),label:"Sky Color",inputComponent:Pp,clone(i){return[...i]}})],Xu);var FS=Object.defineProperty,Nz=Object.getOwnPropertyDescriptor,Fz=h((i,e)=>FS(i,"name",{value:e,configurable:!0}),"__name$1Q"),zz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Nz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&FS(e,t,s),s},"__decorateClass$8");let Wl=h(class extends Ke{constructor(){super(...arguments);C(this,"value",.006)}},"CSmooth");Fz(Wl,"CSmooth");Wl=zz([Ze({storable:!0,dataType:$e.NUMBER,equal(i,e){return Math.abs(i-e)<1e-8},label:"Smooth",inputComponent:Rr,inputComponentProps:{min:0}})],Wl);var zS=Object.defineProperty,Bz=Object.getOwnPropertyDescriptor,Uz=h((i,e)=>zS(i,"name",{value:e,configurable:!0}),"__name$1P"),Vz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Bz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&zS(e,t,s),s},"__decorateClass$7");let Yu=h(class extends Ke{constructor(){super(...arguments);C(this,"value",30)}},"CSpotLightAngle");Uz(Yu,"CSpotLightAngle");Yu=Vz([Ze({storable:!0,dataType:$e.NUMBER,autoCopy:!0,label:"Angle",inputComponent:uh,inputComponentProps:{min:0,max:90,step:.1}})],Yu);var BS=Object.defineProperty,Hz=Object.getOwnPropertyDescriptor,Gz=h((i,e)=>BS(i,"name",{value:e,configurable:!0}),"__name$1O"),Wz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Hz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&BS(e,t,s),s},"__decorateClass$6");let Hi=h(class extends Ke{constructor(){super(...arguments);C(this,"value","none")}},"CSymmetry");Gz(Hi,"CSymmetry");Hi=Wz([Ze({storable:!0,dataType:$e.STRING,label:"Symmetry",inputComponent:ch,inputComponentProps:{options:["none","x","y","z"]}})],Hi);var US=Object.defineProperty,jz=Object.getOwnPropertyDescriptor,$z=h((i,e)=>US(i,"name",{value:e,configurable:!0}),"__name$1N"),Xz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?jz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&US(e,t,s),s},"__decorateClass$5");let Sr=h(class extends Ke{constructor(){super(...arguments);C(this,"value",new A(1,1,1))}},"CTemporaryScale");$z(Sr,"CTemporaryScale");Sr=Xz([Ze({autoCopy:!0,clone(i){return new A().copy(i)}})],Sr);var VS=Object.defineProperty,Yz=Object.getOwnPropertyDescriptor,Kz=h((i,e)=>VS(i,"name",{value:e,configurable:!0}),"__name$1M"),qz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Yz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&VS(e,t,s),s},"__decorateClass$4");let Ku=h(class extends Ke{constructor(){super(...arguments);C(this,"value","512")}},"CTextureSize");Kz(Ku,"CTextureSize");Ku=qz([Ze({storable:!0,dataType:$e.STRING,autoCopy:!0,label:"Texture Quality",inputComponent:ch,inputComponentProps:{options:["128","256","512","1024","2048"]}})],Ku);var HS=Object.defineProperty,Zz=Object.getOwnPropertyDescriptor,GS=h((i,e)=>HS(i,"name",{value:e,configurable:!0}),"__name$1L"),Qz=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Zz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&HS(e,t,s),s},"__decorateClass$3");function v1(i){return i.map(e=>({radius:e.radius,position:new A().copy(e.position)}))}h(v1,"cloneTube");GS(v1,"cloneTube");const xu=new $n({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:2273612,opacity:.75}),Ff=xu.clone();Ff.color.setHex(16776960);Ff.opacity=1;const Mu=xu.clone();Mu.color.setHex(15964205);Mu.opacity=1;var nu;let ot=h((nu=class extends Ke{constructor(){super(...arguments);C(this,"value",[]);C(this,"dirty",!0);C(this,"group");C(this,"pickers",[]);C(this,"circles",[]);C(this,"lines",[]);C(this,"hovered",-1);C(this,"selected",[]);C(this,"draggingStartValue");C(this,"draggingStartMatrix");C(this,"draggingStartInvMatrix");C(this,"draggingStartNodeIndex",-1)}onRemoved(){var e;(e=this.group)==null||e.removeFromParent()}updateColor(){for(let e=0,t=this.circles.length;e<t;++e){const n=this.circles[e];if(this.selected.includes(e)||e===this.draggingStartNodeIndex?n.material=Mu:e===this.hovered?n.material=Ff:n.material=xu,e<t-1){const s=this.lines[e];this.selected.includes(e)&&this.selected.includes(e+1)?s.material=Mu:s.material=xu}}}addSelection(e){this.selected.includes(e)||this.selected.push(e)}clone(e=this.value){return v1(e)}},C(nu,"normalMaterial",xu),C(nu,"hoveredMaterial",Ff),C(nu,"selectedMaterial",Mu),nu),"CTube");GS(ot,"CTube");ot=Qz([Ze({storable:!0,dataType:$e.NUMBER_ARRAY,equal(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;++t){const s=i[t],r=e[t];if(Math.abs(s.radius-r.radius)>1e-8||!tc(s.position,r.position))return!1}return!0},clone:v1,serialize(i){const e=[];for(let t of i)e.push(t.radius,t.position.x,t.position.y,t.position.z);return e},deserialize(i){const e=[];for(let t=0,n=i.length;t<n;t+=4)e.push({radius:i[t],position:new A(i[t+1],i[t+2],i[t+3])});return e}})],ot);var WS=Object.defineProperty,Jz=Object.getOwnPropertyDescriptor,eB=h((i,e)=>WS(i,"name",{value:e,configurable:!0}),"__name$1K"),tB=h((i,e,t,n)=>{for(var s=n>1?void 0:n?Jz(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&WS(e,t,s),s},"__decorateClass$2");let po=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!1)}},"CUsePlainMaterial");eB(po,"CUsePlainMaterial");po=tB([Ze({storable:!0,dataType:$e.BOOLEAN,label:"Use Plain Material",inlineLabel:!0,inputComponent:Ta})],po);var jS=Object.defineProperty,nB=Object.getOwnPropertyDescriptor,iB=h((i,e)=>jS(i,"name",{value:e,configurable:!0}),"__name$1J"),sB=h((i,e,t,n)=>{for(var s=n>1?void 0:n?nB(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&jS(e,t,s),s},"__decorateClass$1");let zt=h(class extends Ke{constructor(){super(...arguments);C(this,"value",!0)}},"CVisible");iB(zt,"CVisible");zt=sB([Ze({storable:!0,dataType:$e.BOOLEAN,instanceable:!0})],zt);var $S=Object.defineProperty,rB=Object.getOwnPropertyDescriptor,oB=h((i,e)=>$S(i,"name",{value:e,configurable:!0}),"__name$1I"),aB=h((i,e,t,n)=>{for(var s=n>1?void 0:n?rB(e,t):e,r=i.length-1,o;r>=0;r--)(o=i[r])&&(s=(n?o(e,t,s):o(s))||s);return n&&s&&$S(e,t,s),s},"__decorateClass");let qu=h(class extends Ke{constructor(){super(...arguments);C(this,"value",.5)}},"CWidth");oB(qu,"CWidth");qu=aB([Ze({storable:!0,dataType:$e.NUMBER,autoCopy:!0,label:"Width",inputComponent:Rr,inputComponentProps:{min:0,step:.001}})],qu);var lB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntlDEOACEIBMH4/y/PNVqK6xEbw9TLbDQEs6LI4koIQJK5S75jOYNr8ijb/w5Odt+yLFCGlRe2XSBLFTxSALDauHRBJDcLbtHV+1O8xQcgdTP9QsaHuQAAAABJRU5ErkJggg==",cB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGJJREFUSIntlMEOwCAMQsX4/7/cXU1cIwM9rRyb8tBIbK1UcgVmKSJiMQKY5wAoFgV/m2d7EvzIvnIi2iNd93ZA5hlfQRk4a1F3A3b1tANkse+gFoIyW/AdhIVbfxHjLf1ADzNkU8v8yWLDAAAAAElFTkSuQmCC",uB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGlJREFUSIntk8EOwCAIQ8X//+futEQZSgnsRi8m+KCKOEarlZUwEAC4hUSoWmbxm8G7xxwinKzjFne8VrQtAEC3yWuLZhh+S1xXljvxUwei0+DxH4NqlRjcHjht4E1PyoAZzbJ/0Gr9pwf7m2fK2pb3HwAAAABJRU5ErkJggg==",hB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGVJREFUSIntkcEKwCAMQxvx/3+5ngo63KK2wg59pyIkMa1IkvwezB5VVY/MgKlfSMCbpjCRCfu5N2Sf+QwQGWsDwG47GuCFBjzXYo2sDTvs8YrM3H0DL1sBKytZNorS1MiQJLlDA/9ET+yIPaCNAAAAAElFTkSuQmCC",dB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHBJREFUSIntlMEOwCAIQ2X//8/dZVuMoZt0eNDYG4J9hBBK2VpexhIA8BSZ0TpJtbkXp5r3QHDJyx0KrK0JjfCrUxaHxtgzJtm8/uR99N5/LUFryKAygIGGABTz1zWNwtIA6afjlrI94U6GHsGtOXUCrECLjc6LLwMAAAAASUVORK5CYII=",fB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFRJREFUSIntkkEKACAIBLP//9lOhgdJSlc6ODdhmYFojKaJQt6AmXmPidz9FVpu3any18iMxEKcpGnBsoglS3+2sgj061pSSEDEIodFtBwegQaav1kXY2ucLK26fgAAAABJRU5ErkJggg==",pB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF9JREFUSIntk0EOwCAIBN2m///y9m4WLIKJB+ZiRN0hRsdomuuBKpLkVhgg80oE1pknGhRlKdi9rl8CkgSArEQGz6HR+VLg1eexTKDWlCwlsPYffabeB3u9rirkTZPnA+JpX7qX66AGAAAAAElFTkSuQmCC",mB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFtJREFUSIntk0EKACAIBN3o/1+2a5iVqEQH5yJI7oopUVF8D7QkM7NLDFD1Ugx2Nd1SCABzlG9OnTeLuCYmo8sgg7DB7b9MBieRv0c0bw+R/z4WntxBWrdFEWYA0ho4CpvAbnEAAAAASUVORK5CYII=",Tc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGNJREFUSIljYBgFAw0YiVX4/////ygaGRmJ1kvQYHTD8YmTbDilapgocgElgBTv41NLtA+QDaE47HEZiByxVLFwaEcyDNA0HyAbRowYNjDwQQQD5KYaFnItGTRg4IvrUUBzAAC2uXOjDxKDVAAAAABJRU5ErkJggg==",gB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntk8EKACEIRDP2/3959hRI4DqNnRbfLQqfNjVG83ss2gAAuohZWCeEFWTnHkXoO866pwWn4sWsCjLoCaQgTwRqBtQV7S/Fr+GQBYr4ioCBykANOBV8/VJWGgoqXTfNXV4/VTgWLIRfCQAAAABJRU5ErkJggg==",vB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntkkkKACEMBO1h/v/l8jIDIlGJC3hInVzoVCKmFATXI+sQYKqYZNbbImhlHk+QD08zXQGAJJVF6v2I4QSruAX/VMcE1z2RSf1zynXvbkqwmnl3SoLgDBnHw1PSkFB0SwAAAABJRU5ErkJggg==",yB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAE5JREFUSIljYBgFwx4w4pP8////fxTFjIx41ZME0A3HJUY1w6lqCSFDKLaEGAMosoRYzaOWDC5LaJ6yaJ4/aJrL8RlOVuFF00JwFAw9AACJKmejS/9FQQAAAABJRU5ErkJggg==",_B="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAFdJREFUSIljYBgFo4BSwEiswv/////H0MzISLR+og3HxaaK4cTwKTKcFDGyDCdHnIlkm0kEOFMBOd4mKVUNmSDCC2iainBppmo+wGYIqTl5cJRFo2BoAwCKVWuoeE0X9QAAAABJRU5ErkJggg==",bB="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAEVJREFUSIljYBgFo2AUMJKi+P/////hGhkZSdJLkuHY+FQ1nKqWEDKEkDwTxS4gAGhuAVGApnGAyzBiDR88+WAUjIKBAwBuly/fa4hrDAAAAABJRU5ErkJggg==",wB=Object.defineProperty,XS=h((i,e)=>wB(i,"name",{value:e,configurable:!0}),"__name$1H");const YS=[{name:"Container",label:"Container",icon:uB,showInList:!0,instanceable:!0,components:[Kt,zt,Ue,lt,Ft,Un,Ce],canBeRoot:!0,validChildTypes:["Container","IKChain","Image","ObjModel","FbxModel","ImportModel","Box","Shape","Clay","Mirror","AmbientLight","HemisphereLight","DirectionalLight","PointLight","SpotLight"]},{name:"IKChain",label:"IK Chain",icon:dB,showInList:!0,instanceable:!0,components:[Kt,zt,Ue,lt,Ft,Un,Ce,Hl,Wu],canBeRoot:!0,validChildTypes:["IKNode"]},{name:"IKNode",label:"IK Node",icon:fB,showInList:!0,instanceable:!0,components:[Kt,zt,Un,Ce,mt,fi,Ut,Gl,Ti,co],canBeRoot:!1,validChildTypes:["Container","IKChain","Image","ObjModel","FbxModel","ImportModel","Box","Shape","Clay","Mirror","AmbientLight","HemisphereLight","DirectionalLight","PointLight","SpotLight"]},{name:"Box",label:"Box",icon:lB,showInList:!0,instanceable:!0,mesh:!0,components:[Kt,zt,pn,ri,Ue,lt,Ft,gn,Fs,Bs,zs,Un,Ce,ps],canBeRoot:!0,validChildTypes:[]},{name:"Shape",label:"SDF Shape",icon:yB,showInList:!0,instanceable:!0,mesh:!0,components:[Kt,zt,pn,ri,Ue,lt,Ft,gn,Fs,Bs,zs,Un,Ce,Si,Wl,Hi],canBeRoot:!0,validChildTypes:["Tube"]},{name:"Tube",label:"Tube",icon:bB,showInList:!0,components:[Kt,Ce,Vl,ot],canBeRoot:!1,validChildTypes:[]},{name:"Clay",label:"Clay",icon:cB,showInList:!0,instanceable:!0,mesh:!0,components:[Kt,zt,pn,ri,Ue,lt,Ft,Bs,zs,gn,Fs,Un,Ce,an,bs,Hi,Sr],canBeRoot:!0,validChildTypes:[]},{name:"Image",label:"Image",icon:pB,showInList:!0,instanceable:!0,mesh:!0,components:[Kt,zt,pn,ri,Ue,lt,Ft,Un,Ce,uo],canBeRoot:!0,defaultData:{[pn.name]:!1,[ri.name]:!1},validChildTypes:[]},{name:"ObjModel",label:"Import .obj",icon:vB,showInList:!0,instanceable:!0,mesh:!0,components:[Kt,zt,pn,ri,Ue,lt,Ft,Un,Ce,fo],canBeRoot:!0,validChildTypes:[]},{name:"FbxModel",label:"Import .fbx",icon:hB,showInList:!0,instanceable:!0,mesh:!0,components:[Kt,zt,pn,ri,Ue,lt,Ft,Un,Ce,ho],canBeRoot:!0,validChildTypes:[]},{name:"ImportModel",label:"Import Model",icon:mB,showInList:!1,instanceable:!0,mesh:!0,components:[Vu,Kt,zt,pn,ri,Ue,lt,Ft,po,Bs,zs,gn,Fs,Un,Ce,Ar],canBeRoot:!0,validChildTypes:[]},{name:"Mirror",label:"Mirror",icon:gB,showInList:!0,mesh:!0,components:[Kt,zt,Ku,Ue,lt,Ft,Ce,qu,Gu,gn],canBeRoot:!0,validChildTypes:[]},{name:"Target",label:"Target",icon:_B,showInList:!1,instanceable:!0,fixed:!0,unique:!0,components:[Ue,Ce],canBeRoot:!1,validChildTypes:[]},{name:"AmbientLight",label:"Ambient Light",icon:Tc,showInList:!0,instanceable:!0,light:!0,components:[Kt,zt,Ce,oi,gn],canBeRoot:!0,defaultData:{[oi.name]:.2},validChildTypes:[]},{name:"HemisphereLight",label:"Hemisphere Light",icon:Tc,showInList:!0,instanceable:!0,light:!0,components:[Kt,zt,Ue,Ce,pi,oi,Xu,Hu],canBeRoot:!0,validChildTypes:[],defaultData:{[oi.name]:.2,[Ue.name]:new A(0,1,0)}},{name:"DirectionalLight",label:"Directional Light",icon:Tc,showInList:!0,instanceable:!0,light:!0,components:[Kt,zt,pn,_r,$u,Ue,Ce,pi,oi,gn],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[Ue.name]:new A(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]},{name:"PointLight",label:"Point Light",icon:Tc,showInList:!0,instanceable:!0,light:!0,components:[Kt,zt,pn,_r,Ue,Ce,pi,oi,gn],canBeRoot:!0,validChildTypes:[],defaultData:{[Ue.name]:new A(0,1,0)}},{name:"SpotLight",label:"Spot Light",icon:Tc,showInList:!0,instanceable:!0,light:!0,components:[Kt,zt,pn,_r,ju,Yu,Ue,Ce,pi,oi,gn],canBeRoot:!0,validChildTypes:["Target"],defaultData:{[Ue.name]:new A(0,1,0)},defaultChildren:[{type:"Target",selected:!1}]}],KS={};for(let i of YS)KS[i.name]=i;function jn(i){const e=KS[i];if(!e)throw new Error(`Node def [${i}] not found`);return e}h(jn,"getModelNodeDef");XS(jn,"getModelNodeDef");function y1(i){return jn(i.type).validChildTypes.map(jn).filter(t=>t.unique?!i.children.find(n=>n.type===t.name):!0)}h(y1,"getValidChildNodeDefs");XS(y1,"getValidChildNodeDefs");var xB=Object.defineProperty,MB=h((i,e)=>xB(i,"name",{value:e,configurable:!0}),"__name$1G");const cd=new ve;class ua{constructor(){C(this,"id",0);C(this,"type","");C(this,"expanded",!0);C(this,"components",{});C(this,"parent",null);C(this,"children",[]);C(this,"dirty",!0);C(this,"deleted",!1);C(this,"opacity",1);C(this,"visible",!0);C(this,"instanceId",0);C(this,"instanceMeshDirty",!0);C(this,"instanceMeshRebuild",!0);C(this,"mirrorGeometry",{})}get(e){const t=this.components[e.name];if(!t)throw new Error(`Component [${e.name}] not found`);return t}has(e){return this.components[e.name]!=null}value(e){return this.get(e).value}cloneValue(e){const t=this.get(e).value,n=vi(e.name);return n.clone?n.clone(t):t}forEach(e){const t=[this];for(;;){const n=t.pop();if(!n)break;if(e(n)===!1)return!1;for(let s=n.children.length;s--;)t.push(n.children[s])}}getLocalMatrix(){if(this.has(Ce)){const e=this.value(Ce);if(e)return e.matrix}return this.parent?this.parent.getLocalMatrix():cd}getWorldMatrix(){if(this.has(Ce)){const e=this.value(Ce);if(e)return e.matrixWorld}return this.parent?this.parent.getWorldMatrix():cd}getParentWorldMatrix(){return this.type==="Target"?cd:this.parent?this.parent.getWorldMatrix():cd}async toJson(){var t;const e=[];for(let n of this.children)e.push(await n.toJson());return{type:this.type,expanded:this.expanded,parentId:(t=this.parent)==null?void 0:t.id,instanceId:this.instanceId,data:await this.getComponentsDataJson(),children:e}}getComponentData(e){const t={};for(let n in this.components){const s=vi(n);if(!(e&&!(s.instanceable||s.autoCopy))&&s.storable){let o=this.components[n].value;s.clone&&(o=s.clone(o)),t[n]=o}}return t}async getComponentsDataJson(){const e={};for(let t in this.components){const n=vi(t);if(n.storable){let r=this.components[t].value;n.serialize&&(r=n.serialize(r)),r&&n.dataType===$e.BYTES&&(r=await GA(r)),e[t]=r}}return e}isValidChild(e){return!!y1(this).find(t=>t.name===e)}}h(ua,"ModelNode");MB(ua,"ModelNode");var AB=Object.defineProperty,SB=h((i,e)=>AB(i,"name",{value:e,configurable:!0}),"__name$1F");class _1{onValueChanged(e,t,n){n===ps&&(t.get(ps).dirty=!0)}onChildAdded(e,t,n){}onBeforeChildRemoved(e,t,n){}onMoved(e,t,n,s){}}h(_1,"BoxWatcher");SB(_1,"BoxWatcher");var CB=Object.defineProperty,TB=h((i,e)=>CB(i,"name",{value:e,configurable:!0}),"__name$1E");class b1{onValueChanged(e,t,n){n===an?t.get(an).dirty=!0:n===bs&&(t.get(bs).dirty=!0)}onChildAdded(e,t,n){}onBeforeChildRemoved(e,t,n){}onMoved(e,t,n,s){}}h(b1,"ClayWatcher");TB(b1,"ClayWatcher");var EB=Object.defineProperty,PB=h((i,e)=>EB(i,"name",{value:e,configurable:!0}),"__name$1D");class w1{onValueChanged(e,t,n){n===ot?(t.get(ot).dirty=!0,t.parent&&(t.parent.dirty=!0,t.parent.get(Si).value=!0)):n===Vl?t.parent&&(t.parent.dirty=!0,t.parent.get(Si).value=!0):(n===Hi||n===Wl)&&t.type==="Shape"&&(t.get(Si).value=!0)}onChildAdded(e,t,n){t.type==="Shape"&&(t.dirty=!0,t.get(Si).value=!0)}onBeforeChildRemoved(e,t,n){t.type==="Shape"&&(t.dirty=!0,t.get(Si).value=!0)}onMoved(e,t,n,s){(n==null?void 0:n.type)==="Shape"&&(n.dirty=!0,n.get(Si).value=!0),(s==null?void 0:s.type)==="Shape"&&(s.dirty=!0,s.get(Si).value=!0)}}h(w1,"SdfShapeWatcher");PB(w1,"SdfShapeWatcher");var RB=Object.defineProperty,qS=h((i,e)=>RB(i,"name",{value:e,configurable:!0}),"__name$1C");const IB=[fi,Ut,Ti,co];function dl(i,e){if(!i)return;i.dirty=!0;let t=Math.max(0,e?i.children.indexOf(e):0);for(let n=i.children.length;t<n;++t){const s=i.children[t],r=s.get(mt);r&&(s.dirty=!0,r.dirty=!0);const o=s.get(Ce);o&&(o.localTransformChanged=!0,o.worldTransformChanged=!0)}}h(dl,"markIkChainDirty");qS(dl,"markIkChainDirty");class x1{onValueChanged(e,t,n){IB.includes(n)&&dl(t.parent,t)}onMoved(e,t,n,s){t.has(mt)&&(dl(n),dl(s,t))}onChildAdded(e,t,n){n.has(mt)&&dl(t,n)}onBeforeChildRemoved(e,t,n){n.has(mt)&&dl(t,n)}}h(x1,"IkNodeWatcher");qS(x1,"IkNodeWatcher");var DB=Object.defineProperty,LB=h((i,e)=>DB(i,"name",{value:e,configurable:!0}),"__name$1B");class M1{onValueChanged(e,t,n){n===uo&&(t.get(uo).dirty=!0)}onChildAdded(e,t,n){}onBeforeChildRemoved(e,t,n){}onMoved(e,t,n,s){}}h(M1,"ImageWatcher");LB(M1,"ImageWatcher");var kB=Object.defineProperty,OB=h((i,e)=>kB(i,"name",{value:e,configurable:!0}),"__name$1A");class A1{onValueChanged(e,t,n){n===fo?t.get(fo).dirty=!0:n===ho?t.get(ho).dirty=!0:n===Ar&&(t.get(Ar).dirty=!0)}onChildAdded(e,t,n){}onBeforeChildRemoved(e,t,n){}onMoved(e,t,n,s){}}h(A1,"ImportModelWatcher");OB(A1,"ImportModelWatcher");var NB=Object.defineProperty,FB=h((i,e)=>NB(i,"name",{value:e,configurable:!0}),"__name$1z");class S1{onValueChanged(e,t,n){n===po&&!t.instanceId&&e.instanceMeshUpdated(t.id,!1)}onMoved(e,t,n,s){}onChildAdded(e,t,n){}onBeforeChildRemoved(e,t,n){}}h(S1,"MaterialWatcher");FB(S1,"MaterialWatcher");var zB=Object.defineProperty,BB=h((i,e)=>zB(i,"name",{value:e,configurable:!0}),"__name$1y");class C1{onValueChanged(e,t,n){n===Un&&t.forEach(s=>s.dirty=!0)}onChildAdded(e,t,n){}onBeforeChildRemoved(e,t,n){}onMoved(e,t,n,s){t.forEach(r=>r.dirty=!0)}}h(C1,"OpacityWatcher");BB(C1,"OpacityWatcher");var UB=Object.defineProperty,VB=h((i,e)=>UB(i,"name",{value:e,configurable:!0}),"__name$1x");const HB=[Ue,lt,Ft,Sr];class T1{onValueChanged(e,t,n){if(HB.includes(n)&&t.has(Ce)){t.dirty=!0;const s=t.get(Ce);s.localTransformChanged=!0,s.worldTransformChanged=!0}t.type==="Target"&&t.parent&&(t.parent.dirty=!0)}onMoved(e,t,n,s){if(t.has(Ce)){t.dirty=!0;const r=t.get(Ce);r.parentChanged=!0,r.worldTransformChanged=!0}}onChildAdded(e,t,n){}onBeforeChildRemoved(e,t,n){}}h(T1,"TransformWatcher");VB(T1,"TransformWatcher");var GB=Object.defineProperty,WB=h((i,e)=>GB(i,"name",{value:e,configurable:!0}),"__name$1w");class hh{constructor(){C(this,"nodesMap",new Map);C(this,"nodes",[]);C(this,"cameraFov",45);C(this,"cameraPerspective",!0);C(this,"cameras",[]);C(this,"watchers",[new T1,new x1,new C1,new M1,new A1,new _1,new w1,new b1,new S1]);C(this,"dirty",!0);C(this,"instanceDirty",!0);C(this,"referenceMap",new Map);C(this,"selected",[])}reset(){this.selected=[],this.dirty=!1,this.instanceDirty=!1,this.referenceMap.clear();for(let e of this.nodes.map(t=>t.id))this.removeNode(e);this.cameras=[]}addSelection(e){this.selected.includes(e)||this.selected.push(e)}isNodeExists(e,t){if(t){const n=this.nodesMap.get(e);return(n==null?void 0:n.type)===t}return this.nodesMap.has(e)}forEach(e){for(let t of this.nodes)if(t.forEach(e)===!1)return!1}getNode(e){const t=this.nodesMap.get(e);if(!t)throw new Error(`Node #${e} does not exist`);return t}getSelectedNodes(){return this.selected.map(e=>this.getNode(e))}getTopmostSelectedNodes(){const e=[];for(let t of this.selected){const n=this.getNode(t);let s=!0;for(let r=n.parent;r;r=r.parent)if(this.selected.includes(r.id)){s=!1;break}s&&e.push(n)}return e}createNode(e,t,n=null,s=null,r,o){if(this.isNodeExists(e))throw new Error(`Node #${e} already exists`);const a=jn(t),l=new ua;l.id=e,l.type=t;for(let u of a.components)l.components[u.name]=new u;if(l.parent=n,this.instanceMeshUpdated(e,!0),o&&(l.instanceId=o,this.referenceMap.has(o)?this.referenceMap.get(o).push(e):this.referenceMap.set(o,[e]),this.instanceDirty=!0),r)for(let u in r){let d=l.components[u];if(!d&&o&&u===_n.name&&(d=l.components[u]=new _n),d){const f=vi(u);d.value=f.clone?f.clone(r[u]):r[u]}}const c=n?n.children:this.nodes;if(s!=null?c.splice(s,0,l):c.push(l),this.nodesMap.set(e,l),n)for(let u of this.watchers)u.onChildAdded(this,n,l);return this.dirty=!0,l}removeNode(e){var r;if(!this.isNodeExists(e))return;const t=this.getNode(e);if(t.parent)for(let o of this.watchers)o.onBeforeChildRemoved(this,t.parent,t);t.deleted=!0,this.instanceMeshUpdated(e,!0),t.forEach(o=>{if(o.instanceId){const a=this.referenceMap.get(o.instanceId);a&&this.referenceMap.set(o.instanceId,a.filter(l=>l!==o.id)),this.instanceDirty=!0}});for(let o in t.mirrorGeometry)(r=t.mirrorGeometry[o])==null||r.dispose(),delete t.mirrorGeometry[o];t.forEach(o=>{this.nodesMap.delete(o.id);const a=this.selected.indexOf(o.id);a>=0&&this.selected.splice(a,1)});const n=t.parent?t.parent.children:this.nodes,s=n.indexOf(t);s>=0&&n.splice(s,1),t.forEach(o=>{for(let a in o.components)o.components[a].onRemoved()}),this.dirty=!0}moveNode(e,t,n,s){const r=e.parent,o=r?r.children:this.nodes;o.splice(o.indexOf(e),1);const a=t?t.children:this.nodes;if(e.parent=t,n){const l=a.indexOf(n);s?a.splice(l+1,0,e):a.splice(l,0,e)}else s?a.push(e):a.unshift(e);e.dirty=!0,this.dirty=!0;for(let l of this.watchers)l.onMoved(this,e,r,t)}setValue(e,t,n){e.get(t).value=n,e.dirty=!0,this.dirty=!0;for(let r of this.watchers)r.onValueChanged(this,e,t);if(vi(t.name).autoCopy){const r=this.referenceMap.get(e.id);if(r)for(let o of r){const a=this.getNode(o);a.get(t).value=n,a.dirty=!0;for(let l of this.watchers)l.onValueChanged(this,a,t)}}}updateVertices(e,t,n,s){const r=e.get(t),o=r.value,a=e.get(Ce);if(a.mesh){const l=a.mesh;if(t===an){l.updateVertices(n,s);for(let c=0,u=o.length;c<u;++c)o[c]=l.aPosition[c]}else if(t===bs){l.updateColors(n,s);for(let c=0,u=o.length;c<u;++c)o[c]=l.aColor[c]}}for(let l=0,c=n.length;l<c;++l){const u=n[l];for(let d=0;d<3;++d)o[u*3+d]=s[l*3+d]}e.dirty=!0,this.dirty=!0,r.partialUpdate=!0;for(let l of this.watchers)l.onValueChanged(this,e,t)}instanceMeshUpdated(e,t){var s;const n=this.referenceMap.get(e);if(n){this.instanceDirty=!0;for(let r of n)if(this.isNodeExists(r)){const o=this.getNode(r);o.instanceMeshDirty=!0,o.instanceMeshRebuild=t}}if(this.isNodeExists(e)){const r=this.getNode(e);for(let o in r.mirrorGeometry)t&&((s=r.mirrorGeometry[o])==null||s.dispose()),delete r.mirrorGeometry[o]}}}h(hh,"Model");WB(hh,"Model");var jB=Object.defineProperty,pf=h((i,e)=>jB(i,"name",{value:e,configurable:!0}),"__name$1v");const $B=200;class E1{constructor(e){C(this,"model");C(this,"enableMerge",!0);C(this,"currentFrameRecords",[]);C(this,"redoStack",[]);C(this,"undoStack",[]);C(this,"nextNodeId",0);C(this,"deletedNodes",new Set);C(this,"dirty",!1);C(this,"lastEventTarget",null);C(this,"onPointerDown",h(e=>{this.lastEventTarget=e.target,this.enableMerge=!1},"onPointerDown"));C(this,"onKeyDown",h(e=>{this.lastEventTarget!==e.target&&(this.lastEventTarget=e.target,this.enableMerge=!1)},"onKeyDown"));this.model=e}setup(){window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("keydown",this.onKeyDown)}unload(){window.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("keydown",this.onKeyDown)}clear(){this.dirty=!1,this.currentFrameRecords.length=0,this.redoStack.length=0,this.undoStack.length=0}save(){this.dirty=!1}update(){if(this.nextNodeId=0,!this.currentFrameRecords.length)return;if(!this.currentFrameRecords.find(l=>!l.empty)){this.currentFrameRecords.length=0;return}this.redoStack.length=0;const e=[],t=[];let n,s;for(let l of this.currentFrameRecords)l.empty||(e.push(l.redo),t.push(l.undo),n=n||l.getCtx,s=s||l.setCtx);let r=pf(()=>{for(let l of e)l()},"redo"),o=pf(()=>{for(let l of t)l()},"undo");r();const a=this.currentFrameRecords.map(l=>l.hash).sort().join("@");if(this.enableMerge)for(;this.undoStack.length;){const l=this.undoStack[this.undoStack.length-1];if(l.hash===a)s&&l.getCtx?s(l.getCtx()):o=l.undo,this.undoStack.pop();else break}else{const l=this.undoStack[this.undoStack.length-1];l&&!l.hash.endsWith("!")&&(l.hash+="!")}this.enableMerge=!0,this.undoStack.push({hash:a,redo:r,undo:o,getCtx:n,setCtx:s}),this.undoStack.length>=$B&&this.undoStack.shift(),this.deletedNodes.clear(),this.currentFrameRecords.length=0,this.dirty=!0}undo(){const e=this.undoStack.pop();!e||(this.redoStack.push(e),this.model.selected=[],e.undo(),this.dirty=!0)}redo(){const e=this.redoStack.pop();!e||(this.undoStack.push(e),e.redo(),this.dirty=!0)}getNextNodeId(){if(this.nextNodeId)return this.nextNodeId;let e=0;return this.model.forEach(t=>{e=Math.max(e,t.id)}),e}createNode(e){const t=this.getNextNodeId()+1;if(this.currentFrameRecords.push({hash:"$createNode",redo:()=>{let n=t;if(e.parentId){let r=this.model.getNode(e.parentId);for(;r;r=r.parent)r.expanded=!0}const s=this.model.createNode(n++,e.type,e.parentId?this.model.getNode(e.parentId):null,null,e.data,e.instanceId);if(e.expanded!=null&&(s.expanded=e.expanded),(e.selected==null||e.selected)&&this.model.addSelection(s.id),e.children){const r=[];for(let o of e.children)r.push([s,o]);for(;r.length;){const o=r.shift();if(!o)break;const a=o[0],l=o[1],c=this.model.createNode(n++,l.type,a,null,l.data,l.instanceId);if(l.expanded!=null&&(c.expanded=l.expanded),(l.selected==null||l.selected)&&this.model.addSelection(c.id),l.children){const u=[];for(let d of l.children)u.push([c,d]);r.unshift(...u)}}}},undo:()=>{this.model.removeNode(t)}}),this.enableMerge=!1,this.nextNodeId=t,e.children){const n=[...e.children];for(;;){const s=n.pop();if(!s)break;this.nextNodeId+=1,s.children&&n.push(...s.children)}}return t}removeNode(e){if(!this.model.isNodeExists(e)||this.deletedNodes.has(e))return;class t{constructor(a,l){C(this,"id");C(this,"type");C(this,"expanded");C(this,"parentId",0);C(this,"instanceId",0);C(this,"index",0);C(this,"data");C(this,"children");this.id=a.id,this.type=a.type,this.expanded=a.expanded,a.parent&&(this.parentId=a.parent.id),this.instanceId=a.instanceId;const c=a.parent?a.parent.children:l.nodes;this.index=c.indexOf(a),this.data=a.getComponentData(),this.children=a.children.map(u=>new t(u,l))}}h(t,"NodeRecord"),pf(t,"NodeRecord");const n=new t(this.model.getNode(e),this.model),s=[n];for(;s.length;){const o=s.pop();if(!o)break;this.deletedNodes.add(o.id),s.push(...o.children)}this.currentFrameRecords.push({hash:"$removeNode",redo:()=>{this.model.removeNode(e)},undo:()=>{const o=this.model.createNode(n.id,n.type,n.parentId?this.model.getNode(n.parentId):null,n.index,n.data,n.instanceId);this.model.addSelection(o.id);const a=[[o,n.children]];for(;;){const l=a.pop();if(!l)break;const c=l[0],u=l[1];for(let d of u){const f=this.model.createNode(d.id,d.type,c,null,d.data,d.instanceId);f.expanded=d.expanded,this.model.addSelection(f.id),d.children.length&&a.push([f,d.children])}}}}),this.enableMerge=!1;const r=this.model.referenceMap.get(e);if(r)for(let o of r)this.removeNode(o)}moveNode(e,t,n,s,r){const o=e.id,a=t?t.id:0,l=n?n.id:0,c=s,u=e.parent?e.parent.id:0;let d=0,f=!1;const p=e.parent?e.parent.children:this.model.nodes,g=p.indexOf(e);if(g>0&&(d=p[g-1].id,f=!0),this.currentFrameRecords.push({hash:"$moveNode",redo:()=>{this.model.moveNode(this.model.getNode(o),a?this.model.getNode(a):null,l?this.model.getNode(l):null,c)},undo:()=>{this.model.moveNode(this.model.getNode(o),u?this.model.getNode(u):null,d?this.model.getNode(d):null,f),this.model.addSelection(o)}}),this.enableMerge=!1,r&&u!==a){if(e.has(Ue)||e.has(lt)||e.has(Ft)){let m=e.getWorldMatrix();if(t&&(m=new ve().copy(t.getWorldMatrix()).invert().multiply(m)),e.has(Ue)){const v=new A,y=new Be,b=new A;m.decompose(v,y,b),e.has(Ue)&&this.setValue(e,Ue,v),e.has(lt)&&this.setValue(e,lt,new it().setFromQuaternion(y)),e.has(Ft)&&this.setValue(e,Ft,b.x)}}else if(e.has(ot)){let m=e.getWorldMatrix();t&&(m=new ve().copy(t.getWorldMatrix()).invert().multiply(m));const v=ca(m),y=e.get(ot).clone();for(let b of y)b.position.applyMatrix4(m),b.radius*=v;this.setValue(e,ot,y)}}}setValue(e,t,n,s){const r=e.id,o=e.value(t),a=r+"#"+(s||t.name),l=vi(t.name);return l.equal&&l.equal(o,n)?(this.currentFrameRecords.push({hash:a,empty:!0,redo(){},undo(){}}),!1):o===n?(this.currentFrameRecords.push({hash:a,redo(){},undo(){}}),!1):(this.currentFrameRecords=this.currentFrameRecords.filter(c=>c.hash!==a),this.currentFrameRecords.push({hash:a,redo:()=>{this.model.setValue(this.model.getNode(r),t,n)},undo:()=>{this.model.setValue(this.model.getNode(r),t,o),this.model.addSelection(r)}}),!0)}mergeLastRecord(e){const t=this.undoStack[this.undoStack.length-1];if(!t)return;const n=[];for(let o of e)n.push(o.node.id+"#"+(o.hashName||o.componentClass.name));let s=n.sort().join("@"),r=t.hash;r.endsWith("!")&&(r=r.substring(0,r.length-1)),s===r&&(this.undoStack.pop(),t.hash=r,this.currentFrameRecords.push(t))}updateVertices(e,t,n,s){if(!n.length)return!1;const r=e.id,o=e.value(t);let a=new Float32Array(s.length);for(let f=0,p=n.length;f<p;++f){const g=n[f];for(let m=0;m<3;++m)a[f*3+m]=o[g*3+m]}let l=n,c=n,u=s;const d=r+"#"+t.name;return this.currentFrameRecords=this.currentFrameRecords.filter(f=>f.hash!==d),this.currentFrameRecords.push({hash:d,redo:()=>{this.model.updateVertices(this.model.getNode(r),t,c,u)},undo:()=>{this.model.updateVertices(this.model.getNode(r),t,l,a),this.model.addSelection(r)},setCtx:([f,p,g,m])=>{{const v=new Set([...f,...l]),y=new Float32Array(v.size*3);for(let w=0,T=p.length;w<T;++w)y[w]=p[w];const b=[...f],_=new Set(f);let x=p.length;for(let w=0,T=l.length;w<T;++w){const P=l[w];if(!_.has(P)){b.push(P);for(let M=0;M<3;++M)y[x+M]=a[w*3+M];x+=3}}l=b,a=y}{const v=new Set([...c,...g]),y=new Float32Array(v.size*3);for(let w=0,T=u.length;w<T;++w)y[w]=u[w];const b=[...c],_=new Set(c);let x=u.length;for(let w=0,T=g.length;w<T;++w){const P=g[w];if(!_.has(P)){b.push(P);for(let M=0;M<3;++M)y[x+M]=m[w*3+M];x+=3}}c=b,u=y}},getCtx:()=>[l,a,c,u]}),!0}}h(E1,"ModelHistory");pf(E1,"ModelHistory");var XB=Object.defineProperty,YB=h((i,e)=>XB(i,"name",{value:e,configurable:!0}),"__name$1u");class ss{constructor(){C(this,"subSystems",[])}setup(e){}dispose(){}sub(...e){return this.subSystems.push(...e),this}update(e){this.begin(e);for(let t of this.subSystems)t.update(e);this.end(e)}}h(ss,"UpdateSystem");YB(ss,"UpdateSystem");var KB=Object.defineProperty,qB=h((i,e)=>KB(i,"name",{value:e,configurable:!0}),"__name$1t");class P1 extends ss{begin(e){for(let n of e.nextFrameCallbacks)n();e.nextFrameCallbacks.length=0;const t=Date.now();for(let n of e.throttleTasks.entries())n[1].time<=t&&(n[1].callback(),e.throttleTasks.delete(n[0]))}end(e){}}h(P1,"CallbackFireSystem");qB(P1,"CallbackFireSystem");var ZB=Object.defineProperty,ZS=h((i,e)=>ZB(i,"name",{value:e,configurable:!0}),"__name$1s");class yl{constructor(){C(this,"mouseNdc0",new A);C(this,"rotating",!1);C(this,"eulerX0",0);C(this,"eulerY0",0);C(this,"moving",!1);C(this,"target0",new A);C(this,"mouseRayN0",new A)}}h(yl,"CameraDraggingState");ZS(yl,"CameraDraggingState");const ud=new A,hd=new A,Wb=new A,jb=new A,$b=new A,QB=40,Xb=-20,Nm=2.5;class R1 extends ss{constructor(){super(...arguments);C(this,"states",[new yl,new yl,new yl,new yl])}begin(t){if(t.disableCameraDraggingThisFrame){t.disableCameraDraggingThisFrame=!1;return}let n=-1;for(let s of t.views){const r=this.states[s.index];if(!s.enabled){r.rotating=!1,r.moving=!1;continue}const o=s.input;if(s.index===t.mainViewIndex)if(o.mouseRight)if(r.rotating){const a=s.mouseNdc.x-r.mouseNdc0.x,l=s.mouseNdc.y-r.mouseNdc0.y;s.camera.alpha=Math.max(-Math.PI/2,Math.min(Math.PI/2,r.eulerX0+l*Math.PI/2)),s.camera.beta=(r.eulerY0-a*Math.PI/2)%(Math.PI*2)}else o.pointerOver&&o.mouseRightDownThisFrame&&(r.rotating=!0,r.mouseNdc0.copy(s.mouseNdc),r.eulerX0=s.camera.alpha,r.eulerY0=s.camera.beta);else r.rotating=!1;o.mouseMiddle?r.moving?(ud.copy(r.mouseNdc0),ud.z=-1,ud.unproject(s.camera.get()),hd.copy(r.mouseNdc0),hd.z=1,hd.unproject(s.camera.get()),on(Wb,ud,hd,r.target0,r.mouseRayN0),on(jb,s.mouseRay0,s.mouseRay1,r.target0,r.mouseRayN0),$b.subVectors(jb,Wb),s.camera.target.subVectors(r.target0,$b),n=s.index):o.pointerOver&&o.mouseMiddleDownThisFrame&&(r.moving=!0,r.target0.copy(s.camera.target),r.mouseNdc0.copy(s.mouseNdc),r.mouseRayN0.copy(s.mouseRayN)):r.moving=!1,o.wheelDetY&&o.pointerOver&&(s.zoomLevel=Math.max(Xb,Math.min(QB,s.zoomLevel+o.wheelDetY)),n=s.index)}if(n>=0){const s=t.views[n];for(let r of t.views)r.index!==n&&r.enabled&&(r.camera.target.copy(s.camera.target),r.zoomLevel=s.zoomLevel)}for(let s of t.views)s.enabled&&(s.camera.distance=s.zoomLevel>=0?Nm+s.zoomLevel:Nm-s.zoomLevel/Xb*Nm)}end(t){}}h(R1,"CameraDraggingSystem");ZS(R1,"CameraDraggingSystem");var JB=Object.defineProperty,eU=h((i,e)=>JB(i,"name",{value:e,configurable:!0}),"__name$1r");class I1 extends ss{begin(e){e.history.update()}end(e){}}h(I1,"HistorySystem");eU(I1,"HistorySystem");var tU=Object.defineProperty,nU=h((i,e)=>tU(i,"name",{value:e,configurable:!0}),"__name$1q");class D1 extends ss{constructor(){super(...arguments);C(this,"showIkBones",!1)}setup(t){this.showIkBones=t.options.showIkBones}begin(t){t=t.readonlyRef(),t.options.showIkBones!==this.showIkBones&&(this.showIkBones=t.options.showIkBones,t.model.forEach(n=>{if(n.has(mt)){const s=n.get(mt);s.boneMesh&&(s.boneMesh.visible=t.options.showIkBones),s.hingeIndicator&&(s.hingeIndicator.visible=t.options.showIkBones&&s.hingeEnabled)}}))}end(t){}}h(D1,"IkBoneVisibleUpdateSystem");nU(D1,"IkBoneVisibleUpdateSystem");var iU=Object.defineProperty,sU=h((i,e)=>iU(i,"name",{value:e,configurable:!0}),"__name$1p");class L1 extends ss{constructor(){super(...arguments);C(this,"ambientLight",new Tp(16777215,.5))}setup(t){t.scene.add(this.ambientLight)}begin(t){if(t=t.readonlyRef(),t.options.shadingMode==="solid"){t.renderer.physicallyCorrectLights=!1,this.ambientLight.visible=!0;for(let r of t.views){if(!r.enabled)continue;const o=r.defaultLight;o.intensity=.5,o.position.copy(r.camera._position).addScaledVector(r.camera._dir,2),o.up.copy(r.camera._up),o.lookAt(r.camera.target)}}else this.ambientLight.visible=!1,t.renderer.physicallyCorrectLights=!0;const n=t.options.shadingMode==="rendered",s=t.options.showLightHelpers;t.model.forEach(r=>{if(jn(r.type).light){const o=r.value(Ce),a=r.visible;if(o&&(o.visible=n&&a),r.has(pi)){const l=r.get(pi),c=t.model.selected.includes(r.id)||!!r.children.length&&t.model.selected.includes(r.children[0].id);l.value&&(l.value.visible=a&&(s||c)),l.camera&&(l.camera.visible=n&&o.castShadow&&a&&(s||c))}}})}end(t){}}h(L1,"LightUpdateSystem");sU(L1,"LightUpdateSystem");var rU=Object.defineProperty,oU=h((i,e)=>rU(i,"name",{value:e,configurable:!0}),"__name$1o");class k1{update(e,t){if(t.instanceId||t.type!=="Box")return;const n=t.get(ps);if(!n.dirty)return;n.dirty=!1;const s=t.get(Ce),r=n.value,o=new sn(r.x,r.y,r.z);if(s.value){const a=s.value;a.geometry.dispose(),a.geometry=o}else s.value=new Re(o,new Pr),s.value.userData={node:t},s.parentChanged=!0,s.localTransformChanged=!0;o.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)}}h(k1,"BoxUpdateFilter");oU(k1,"BoxUpdateFilter");var aU=Object.defineProperty,lU=h((i,e)=>aU(i,"name",{value:e,configurable:!0}),"__name$1n");class Hs{constructor(e=0){C(this,"bits");this.bits=new Uint32Array((e>>>5)+1)}checkCapacity(e){if(e>this.bits.length){const t=new Uint32Array(e);t.set(this.bits,0),this.bits=t}}expandCapacity(e){this.checkCapacity((e>>>5)+1)}clear(){for(let e=0,t=this.bits.length;e<t;++e)this.bits[e]=0}set(e){const t=e>>>5;this.checkCapacity(t+1),this.bits[t]=(this.bits[t]|1<<(e&31))>>>0}get(e){const t=e>>>5;return t>=this.bits.length?!1:(this.bits[t]&1<<(e&31))!==0}clearBit(e){const t=e>>>5;t>=this.bits.length||(this.bits[t]=(this.bits[t]&~(1<<(e&31)))>>>0)}setBit(e,t){t?this.set(e):this.clearBit(e)}and(e){const t=Math.min(this.bits.length,e.bits.length);for(let n=0;n<t;++n)this.bits[n]=(this.bits[n]&e.bits[n])>>>0;if(this.bits.length>t)for(let n=t,s=this.bits.length;n<s;++n)this.bits[n]=0}or(e){const t=Math.min(this.bits.length,e.bits.length);for(let n=0;n<t;++n)this.bits[n]=(this.bits[n]|e.bits[n])>>>0;if(e.bits.length>t){this.checkCapacity(e.bits.length);for(let n=t,s=e.bits.length;n<s;++n)this.bits[n]=e.bits[n]}}equals(e){const t=this.bits.length>=e.bits.length?this:e,n=t===this?e:this;for(let s=0,r=n.bits.length;s<r;++s)if(t.bits[s]!==n.bits[s])return!1;for(let s=t.bits.length-n.bits.length+1,r=t.bits.length;s<r;++s)if(t.bits[s])return!1;return!0}intersects(e){for(let t=0,n=Math.min(this.bits.length,e.bits.length);t<n;++t)if((this.bits[t]&e.bits[t])!==0)return!0;return!1}containsAll(e){if(e.bits.length>this.bits.length){for(let t=this.bits.length,n=e.bits.length;t<n;++t)if(e.bits[t]!==0)return!1}for(let t=0,n=Math.min(this.bits.length,e.bits.length);t<n;++t)if((this.bits[t]&e.bits[t])!==e.bits[t])return!1;return!0}isEmpty(){for(let e=0,t=this.bits.length;e<t;++e)if(this.bits[e]!==0)return!1;return!0}clone(){const e=new Hs;return e.bits=this.bits.slice(),e}}h(Hs,"Bits");lU(Hs,"Bits");var cU=Object.defineProperty,QS=h((i,e)=>cU(i,"name",{value:e,configurable:!0}),"__name$1m");const ia=new DataView(new ArrayBuffer(12)),Yb=new Array(8),Kb=new Array(8);function Qg(i,e){ia.setUint32(0,i),ia.setUint32(4,e);for(let t=0;t<8;++t)Yb[t]=String.fromCharCode(ia.getUint8(t));return Yb.join("")}h(Qg,"hashUint32x2");QS(Qg,"hashUint32x2");function O1(i,e,t){ia.setFloat32(0,i||0),ia.setFloat32(4,e||0),ia.setFloat32(8,t||0);for(let n=0;n<12;++n)Kb[n]=String.fromCharCode(ia.getUint8(n));return Kb.join("")}h(O1,"hashFloat32x3");QS(O1,"hashFloat32x3");var uU=Object.defineProperty,JS=h((i,e)=>uU(i,"name",{value:e,configurable:!0}),"__name$1l");const Vn=new A,Fm=new zn,dd=new zn,qb=new A,Zb=new A,Qb=new A,hU=new A;function Jg(i,e){if(e.isLeaf=!1,e.depth>=ks.MAX_DEPTH){e.isLeaf=!0;return}if(e.indices.length<=ks.MAX_TRI_PER_NODE){e.isLeaf=!0;return}if(!e.indices.length){e.isLeaf=!0;return}dd.makeEmpty();for(let t of e.indices)dd.expandByPoint(i.getTriangleCenter(Vn,t));e.splitCenter.copy(dd.min).add(dd.max).multiplyScalar(.5),e.children.length=0;for(let t=0;t<8;++t){const n=new ks;n.depth=e.depth+1,e.children.push(n)}for(let t of e.indices)i.getTriangleCenter(Vn,t),Vn.x<e.splitCenter.x?Vn.y<e.splitCenter.y?Vn.z<e.splitCenter.z?e.children[0].indices.push(t):e.children[1].indices.push(t):Vn.z<e.splitCenter.z?e.children[2].indices.push(t):e.children[3].indices.push(t):Vn.y<e.splitCenter.y?Vn.z<e.splitCenter.z?e.children[4].indices.push(t):e.children[5].indices.push(t):Vn.z<e.splitCenter.z?e.children[6].indices.push(t):e.children[7].indices.push(t)}h(Jg,"constructChildren");JS(Jg,"constructChildren");const Yf=class{constructor(){C(this,"depth",1);C(this,"children",[]);C(this,"box",new zn);C(this,"splitCenter",new A);C(this,"isLeaf",!1);C(this,"indices",[])}build(e){this.indices.length=0;for(let n=0;n<e.triNum;++n)this.indices.push(n);const t=[this];for(;t.length;){const n=t.pop();if(!n)break;n.recomputeBox(e),Jg(e,n),n.isLeaf||t.push(...n.children)}}recomputeBox(e){this.box.makeEmpty();for(let t of this.indices)this.box.union(e.getTriangleBox(Fm,t));this.box.expandByScalar(1e-7)}update(e,t){if(!t.length)return;const n=new Hs(e.triNum);for(let r of t)n.set(r);const s=new Set;{const r=[this];for(;r.length;){const o=r.pop();if(!o)break;let a=!1;if(o.depth===1)a=!0;else{const l=o.indices.filter(c=>!n.get(c));a=l.length!==o.indices.length,o.indices=l}a&&(o.indices.length?(s.add(o),r.push(...o.children)):(o.box.makeEmpty(),o.isLeaf=!0,o.children.length=0))}}{const r=[[this,t]];for(;r.length;){const o=r.pop();if(!o)break;const a=o[0],l=o[1];if(s.add(a),a.depth!==1&&a.indices.push(...l),a.isLeaf){if(a.indices.length<=Yf.MAX_TRI_PER_NODE||a.depth>=Yf.MAX_DEPTH)continue;const y=[a];for(;y.length;){const b=y.pop();if(!b)break;b.recomputeBox(e),Jg(e,b),b.isLeaf||y.push(...b.children)}continue}const c=[],u=[],d=[],f=[],p=[],g=[],m=[],v=[];for(let y of l)e.getTriangleCenter(Vn,y),Vn.x<a.splitCenter.x?Vn.y<a.splitCenter.y?Vn.z<a.splitCenter.z?c.push(y):u.push(y):Vn.z<a.splitCenter.z?d.push(y):f.push(y):Vn.y<a.splitCenter.y?Vn.z<a.splitCenter.z?p.push(y):g.push(y):Vn.z<a.splitCenter.z?m.push(y):v.push(y);c.length&&r.push([a.children[0],c]),u.length&&r.push([a.children[1],u]),d.length&&r.push([a.children[2],d]),f.length&&r.push([a.children[3],f]),p.length&&r.push([a.children[4],p]),g.length&&r.push([a.children[5],g]),m.length&&r.push([a.children[6],m]),v.length&&r.push([a.children[7],v])}}for(let r of s)r.recomputeBox(e)}raycast(e,t,n){const s=[],r=[this],o=1/t.direction.x,a=1/t.direction.y,l=1/t.direction.z;for(;r.length;){const c=r.pop();if(!c)break;const u=(c.box.min.x-t.origin.x)*o,d=(c.box.max.x-t.origin.x)*o,f=(c.box.min.y-t.origin.y)*a,p=(c.box.max.y-t.origin.y)*a,g=(c.box.min.z-t.origin.z)*l,m=(c.box.max.z-t.origin.z)*l,v=Math.max(Math.min(u,d),Math.min(f,p),Math.min(g,m)),y=Math.min(Math.max(u,d),Math.max(f,p),Math.max(g,m));if(!(y<0||v>y))if(c.isLeaf)for(let b of c.indices){e.getTriangle(qb,Zb,Qb,b);const _=t.intersectTriangle(qb,Zb,Qb,n,hU);if(_){const x=new A().copy(_),w=e.getNormal(new A,b),T=t.origin.distanceTo(x);s.push({point:x,normal:w,distance:T,triangleIndex:b})}}else r.push(...c.children)}return s.sort((c,u)=>c.distance-u.distance)}intersectSphere(e,t){const n=[this],s=[];for(;n.length;){const r=n.pop();if(!r)break;if(!!r.box.intersectsSphere(t))if(r.isLeaf)for(let o of r.indices)e.getTriangleBox(Fm,o),Fm.intersectsSphere(t)&&s.push(o);else n.push(...r.children)}return s}};let ks=Yf;h(ks,"OctreeNode"),C(ks,"MAX_DEPTH",8),C(ks,"MAX_TRI_PER_NODE",100);JS(ks,"OctreeNode");var dU=Object.defineProperty,e2=h((i,e)=>dU(i,"name",{value:e,configurable:!0}),"__name$1k");const un=new A,Jt=new A,hn=new A,fd=new A,Ss=new A,er=new A,fU=new A,Nn=1e-7;function mf(i,e){let t=i.x,n=i.y,s=i.z,r=e.x,o=e.y,a=e.z;return t=Math.round(t/Nn)*Nn,n=Math.round(n/Nn)*Nn,s=Math.round(s/Nn)*Nn,r=Math.round(r/Nn)*Nn,o=Math.round(o/Nn)*Nn,a=Math.round(a/Nn)*Nn,t===r&&n===o&&s===a}h(mf,"isSameVertex");e2(mf,"isSameVertex");class N1{constructor(){C(this,"aPosition",new Float32Array);C(this,"aColor",new Float32Array);C(this,"aNormal",new Float32Array);C(this,"triCenter",new Float32Array);C(this,"triBox",new Float32Array);C(this,"triNum",0);C(this,"sharedVertexMap",new Uint32Array);C(this,"sharedVertexIndices",new Map);C(this,"edgeNeighborMap",new Uint32Array);C(this,"holes",new Uint8Array);C(this,"octree",new ks);C(this,"dirtyTriangles",[]);C(this,"dirtyTrianglesMask",new Hs);C(this,"positionNeedsUpdate",!1);C(this,"colorNeedsUpdate",!1)}buildFromTriangles(e,t){const n=this.aPosition=new Float32Array(e.length),s=this.aNormal=new Float32Array(e.length),r=this.aColor=new Float32Array(e.length);(t==null?void 0:t.length)!==r.length&&(t=void 0);let o=0;for(let a=0,l=e.length/9;a<l;++a)if(un.fromArray(e,a*9),Jt.fromArray(e,a*9+3),hn.fromArray(e,a*9+6),!(mf(un,Jt)||mf(un,hn)||mf(Jt,hn))){for(let c=0;c<9;++c)n[o*9+c]=e[a*9+c];if(t)for(let c=0;c<9;++c)r[o*9+c]=t[a*9+c];else for(let c=0;c<9;++c)r[o*9+c]=1;fd.subVectors(un,Jt),Ss.subVectors(hn,Jt),Ss.cross(fd).normalize();for(let c=0;c<3;++c){const u=o*9+c*3;s[u]=Ss.x,s[u+1]=Ss.y,s[u+2]=Ss.z}o+=1}o<e.length/9&&(this.aPosition=n.subarray(0,o*9),this.aNormal=s.subarray(0,o*9),this.aColor=r.subarray(0,o*9),console.info(`Discard ${e.length/9-o} zero area triangles`)),this.init()}init(){const e=this.aPosition,t=this.triNum=e.length/9,n=this.triCenter=new Float32Array(t*3),s=this.triBox=new Float32Array(t*6);for(let r=0;r<t;++r)un.fromArray(e,r*9),Jt.fromArray(e,r*9+3),hn.fromArray(e,r*9+6),er.copy(un).add(Jt).add(hn).multiplyScalar(1/3),n[r*3]=er.x,n[r*3+1]=er.y,n[r*3+2]=er.z,s[r*6]=Math.min(un.x,Jt.x,hn.x),s[r*6+1]=Math.min(un.y,Jt.y,hn.y),s[r*6+2]=Math.min(un.z,Jt.z,hn.z),s[r*6+3]=Math.max(un.x,Jt.x,hn.x),s[r*6+4]=Math.max(un.y,Jt.y,hn.y),s[r*6+5]=Math.max(un.z,Jt.z,hn.z);this.buildTriangleNeighborEdgeMap(),this.octree.build(this),this.dirtyTrianglesMask.expandCapacity(t)}buildTriangleNeighborEdgeMap(){const e=this.triNum,t=this.aPosition,n=this.sharedVertexMap=new Uint32Array(e*3),s=this.sharedVertexIndices;s.clear();const r=new Map;for(let p=0,g=e*3;p<g;++p){let m=t[p*3],v=t[p*3+1],y=t[p*3+2];m=Math.round(m/Nn)*Nn,v=Math.round(v/Nn)*Nn,y=Math.round(y/Nn)*Nn;const b=O1(m,v,y);let _=r.get(b);_==null?(_=p,r.set(b,_),s.set(_,[])):s.get(_).push(p),n[p]=_}const o=new Map,a=new Uint8Array(e);let l=0,c=0;for(let p=0;p<e;++p){let g=!1;for(let m=0;m<3;++m){const v=p*3+m,y=n[v],b=n[p*3+(m+1)%3];if(y===b){g=!0;break}}if(g){c+=1,a[p]=1;continue}for(let m=0;m<3;++m){const v=p*3+m,y=n[v],b=n[p*3+(m+1)%3],_=Qg(y,b);o.get(_)==null?o.set(_,v):l+=1}}c&&console.warn(`Mesh has ${c} zero area triangles`),l&&console.warn(`Mesh has ${l} duplicate edges (embedded faces may exist)`);const u=this.edgeNeighborMap=new Uint32Array(e*3),d=this.holes=new Uint8Array(e*3);let f=0;for(let p=0;p<e;++p)if(!a[p])for(let g=0;g<3;++g){const m=p*3+g,v=n[m],y=n[p*3+(g+1)%3],b=Qg(y,v),_=o.get(b);_==null?(d[m]=1,f+=1):u[m]=_}f&&console.warn(`Mesh has ${f} edges border hole`)}getTriangleCenter(e,t){return e.fromArray(this.triCenter,t*3),e}getTriangleBox(e,t){return e.min.fromArray(this.triBox,t*6),e.max.fromArray(this.triBox,t*6+3),e}getTriangle(e,t,n,s){e.fromArray(this.aPosition,this.sharedVertexMap[s*3]*3),t.fromArray(this.aPosition,this.sharedVertexMap[s*3+1]*3),n.fromArray(this.aPosition,this.sharedVertexMap[s*3+2]*3)}getVertex(e,t){return e.fromArray(this.aPosition,t*3)}getNormal(e,t){return e.fromArray(this.aNormal,t*3*3),e}getAverageNormal(e,t){e.set(0,0,0);for(let n of t)e.add(this.getNormal(fU,n));return e.normalize()}getAverageCenter(e,t){e.set(0,0,0);for(let n of t)e.add(this.getTriangleCenter(er,n));return e.divideScalar(t.length)}toThree(e){if(e){const t=e,n=t.geometry.getAttribute("position");if(n.array===this.aPosition){if(this.positionNeedsUpdate){this.positionNeedsUpdate=!1,n.needsUpdate=!0;const s=t.geometry.getAttribute("normal");s.needsUpdate=!0}if(this.colorNeedsUpdate){this.colorNeedsUpdate=!1;const s=t.geometry.getAttribute("color");s.needsUpdate=!0}}else t.geometry.dispose(),t.geometry=new et,t.geometry.setAttribute("position",new Fe(this.aPosition,3)),t.geometry.setAttribute("normal",new Fe(this.aNormal,3)),t.geometry.setAttribute("color",new Fe(this.aColor,3));return t}else return new Re(new et().setAttribute("position",new Zt(this.aPosition,3)).setAttribute("normal",new Zt(this.aNormal,3)).setAttribute("color",new Zt(this.aColor,3)),new Pr({vertexColors:!0}))}raycast(e,t){return this.octree.raycast(this,e,t)}intersectSphere(e){return this.octree.intersectSphere(this,e)}getVertexTriangleIndex(e){return(e-e%3)/3}markTriangleDirty(e){this.dirtyTrianglesMask.get(e)||(this.dirtyTrianglesMask.set(e),this.dirtyTriangles.push(e))}updateVertices(e,t){const n=this.aPosition;for(let s=0,r=e.length;s<r;++s){const o=this.sharedVertexMap[e[s]];this.markTriangleDirty(this.getVertexTriangleIndex(o));for(let l=0;l<3;++l)n[o*3+l]=t[s*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a){this.markTriangleDirty(this.getVertexTriangleIndex(l));for(let c=0;c<3;++c)n[l*3+c]=t[s*3+c]}}this.positionNeedsUpdate=!0}updateColors(e,t){const n=this.aColor;for(let s=0,r=e.length;s<r;++s){const o=this.sharedVertexMap[e[s]];for(let l=0;l<3;++l)n[o*3+l]=t[s*3+l];const a=this.sharedVertexIndices.get(o);if(a)for(let l of a)for(let c=0;c<3;++c)n[l*3+c]=t[s*3+c]}this.colorNeedsUpdate=!0}update(e){const t=this.dirtyTriangles,n=this.aPosition,s=this.aNormal,r=this.triCenter,o=this.triBox;let a=0,l=0,c=0,u=0,d=0,f=0,p=!1;if(e!=null&&e.boundingSphere){p=!0;const g=e.boundingSphere.center,m=e.boundingSphere.radius;a=g.x-m,l=g.y-m,c=g.z-m,u=g.x+m,d=g.y+m,f=g.z+m}for(let g of t){un.fromArray(n,g*9),Jt.fromArray(n,g*9+3),hn.fromArray(n,g*9+6),fd.subVectors(un,Jt),Ss.subVectors(hn,Jt),Ss.cross(fd).normalize();for(let m=0;m<3;++m){const v=g*9+m*3;s[v]=Ss.x,s[v+1]=Ss.y,s[v+2]=Ss.z}er.copy(un).add(Jt).add(hn).multiplyScalar(1/3),r[g*3]=er.x,r[g*3+1]=er.y,r[g*3+2]=er.z,o[g*6]=Math.min(un.x,Jt.x,hn.x),o[g*6+1]=Math.min(un.y,Jt.y,hn.y),o[g*6+2]=Math.min(un.z,Jt.z,hn.z),o[g*6+3]=Math.max(un.x,Jt.x,hn.x),o[g*6+4]=Math.max(un.y,Jt.y,hn.y),o[g*6+5]=Math.max(un.z,Jt.z,hn.z),p&&(a=Math.min(o[g*6],a),l=Math.min(o[g*6+1],l),c=Math.min(o[g*6+2],c),u=Math.max(o[g*6+3],u),d=Math.max(o[g*6+4],d),f=Math.max(o[g*6+5],f))}if(p){const g=e.boundingSphere;g.center.set((u+a)/2,(d+l)/2,(f+c)/2),g.radius=Math.max(u-g.center.x,g.center.x-a,d-g.center.y,g.center.y-l,f-g.center.z,g.center.z-c)}this.octree.update(this,t),this.dirtyTriangles.length=0,this.dirtyTrianglesMask.clear()}}h(N1,"DynamicMesh");e2(N1,"DynamicMesh");var pU=Object.defineProperty,t2=h((i,e)=>pU(i,"name",{value:e,configurable:!0}),"__name$1j");const zm=new Int8Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),Di=new Uint16Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);function Fi(i,e){return i/(i-e)}h(Fi,"getAlpha");t2(Fi,"getAlpha");const tt=new Float32Array(12*3),nt=new Float32Array(12*3),He=new A,$t=new A;function F1(i,e,t,n,s,r,o,a,l,c,u,d,f,p,g,m,v){const y=a[c],b=a[u],_=a[d],x=a[f],w=a[p],T=a[g],P=a[m],M=a[v],R=!!(t&&l);let L=0;if(y<0&&(L|=1<<0),b<0&&(L|=1<<1),_<0&&(L|=1<<2),x<0&&(L|=1<<3),w<0&&(L|=1<<4),T<0&&(L|=1<<5),P<0&&(L|=1<<6),M<0&&(L|=1<<7),Di[L]!==0){if(Di[L]&1<<0){const W=Fi(y,b);tt[0]=n+W*o,tt[1]=s,tt[2]=r,R&&(He.fromArray(l,c*3),$t.fromArray(l,u*3),He.lerp($t,W),nt[0]=He.x,nt[1]=He.y,nt[2]=He.z)}if(Di[L]&1<<1){const W=Fi(b,_);tt[3]=n+o,tt[3+1]=s,tt[3+2]=r+W*o,R&&(He.fromArray(l,u*3),$t.fromArray(l,d*3),He.lerp($t,W),nt[3]=He.x,nt[3+1]=He.y,nt[3+2]=He.z)}if(Di[L]&1<<2){const W=Fi(x,_);tt[3*2]=n+W*o,tt[3*2+1]=s,tt[3*2+2]=r+o,R&&(He.fromArray(l,f*3),$t.fromArray(l,d*3),He.lerp($t,W),nt[3*2]=He.x,nt[3*2+1]=He.y,nt[3*2+2]=He.z)}if(Di[L]&1<<3){const W=Fi(y,x);tt[3*3]=n,tt[3*3+1]=s,tt[3*3+2]=r+W*o,R&&(He.fromArray(l,c*3),$t.fromArray(l,f*3),He.lerp($t,W),nt[3*3]=He.x,nt[3*3+1]=He.y,nt[3*3+2]=He.z)}if(Di[L]&1<<4){const W=Fi(w,T);tt[3*4]=n+W*o,tt[3*4+1]=s+o,tt[3*4+2]=r,R&&(He.fromArray(l,p*3),$t.fromArray(l,g*3),He.lerp($t,W),nt[3*4]=He.x,nt[3*4+1]=He.y,nt[3*4+2]=He.z)}if(Di[L]&1<<5){const W=Fi(T,P);tt[3*5]=n+o,tt[3*5+1]=s+o,tt[3*5+2]=r+W*o,R&&(He.fromArray(l,g*3),$t.fromArray(l,m*3),He.lerp($t,W),nt[3*5]=He.x,nt[3*5+1]=He.y,nt[3*5+2]=He.z)}if(Di[L]&1<<6){const W=Fi(M,P);tt[3*6]=n+W*o,tt[3*6+1]=s+o,tt[3*6+2]=r+o,R&&(He.fromArray(l,v*3),$t.fromArray(l,m*3),He.lerp($t,W),nt[3*6]=He.x,nt[3*6+1]=He.y,nt[3*6+2]=He.z)}if(Di[L]&1<<7){const W=Fi(w,M);tt[3*7]=n,tt[3*7+1]=s+o,tt[3*7+2]=r+W*o,R&&(He.fromArray(l,p*3),$t.fromArray(l,v*3),He.lerp($t,W),nt[3*7]=He.x,nt[3*7+1]=He.y,nt[3*7+2]=He.z)}if(Di[L]&1<<8){const W=Fi(y,w);tt[3*8]=n,tt[3*8+1]=s+W*o,tt[3*8+2]=r,R&&(He.fromArray(l,c*3),$t.fromArray(l,p*3),He.lerp($t,W),nt[3*8]=He.x,nt[3*8+1]=He.y,nt[3*8+2]=He.z)}if(Di[L]&1<<9){const W=Fi(b,T);tt[3*9]=n+o,tt[3*9+1]=s+W*o,tt[3*9+2]=r,R&&(He.fromArray(l,u*3),$t.fromArray(l,g*3),He.lerp($t,W),nt[3*9]=He.x,nt[3*9+1]=He.y,nt[3*9+2]=He.z)}if(Di[L]&1<<10){const W=Fi(_,P);tt[3*10]=n+o,tt[3*10+1]=s+W*o,tt[3*10+2]=r+o,R&&(He.fromArray(l,d*3),$t.fromArray(l,m*3),He.lerp($t,W),nt[3*10]=He.x,nt[3*10+1]=He.y,nt[3*10+2]=He.z)}if(Di[L]&1<<11){const W=Fi(x,M);tt[3*11]=n,tt[3*11+1]=s+W*o,tt[3*11+2]=r+o,R&&(He.fromArray(l,f*3),$t.fromArray(l,v*3),He.lerp($t,W),nt[3*11]=He.x,nt[3*11+1]=He.y,nt[3*11+2]=He.z)}for(let W=0;;W+=3){const k=zm[L*16+W];if(k===-1)break;const z=zm[L*16+W+1],S=zm[L*16+W+2],B=tt[k*3],ne=tt[k*3+1],K=tt[k*3+2],ie=tt[z*3],G=tt[z*3+1],se=tt[z*3+2],q=tt[S*3],U=tt[S*3+1],le=tt[S*3+2];if(i.push(B,ne,K,ie,G,se,q,U,le),R&&t.push(nt[k*3],nt[k*3+1],nt[k*3+2],nt[z*3],nt[z*3+1],nt[z*3+2],nt[S*3],nt[S*3+1],nt[S*3+2]),e){const ae=ie-B,J=G-ne,te=se-K,me=ie-q,de=G-U,be=se-le,we=J*be-te*de,Ae=te*me-ae*be,V=ae*de-J*me,X=1/Math.sqrt(we**2+Ae**2+V**2),E=-we*X,ee=-Ae*X,Q=-V*X;e.push(E,ee,Q,E,ee,Q,E,ee,Q)}}}}h(F1,"marchingCubes");t2(F1,"marchingCubes");var mU=Object.defineProperty,wo=h((i,e)=>mU(i,"name",{value:e,configurable:!0}),"__name$1i");function n2(i,e,t,n,s,r,o){return Math.sqrt((i-n)**2+(e-s)**2+(t-r)**2)-o}h(n2,"sphere");wo(n2,"sphere");function i2(i,e,t,n,s,r,o,a,l,c,u){const d=a-n,f=l-s,p=c-r,g=d**2+f**2+p**2,m=o-u,v=g-m**2,y=1/g,b=i-n,_=e-s,x=t-r,w=b*d+_*f+x*p,T=w-g,P=(b*g-d*w)**2+(_*g-f*w)**2+(x*g-p*w)**2,M=w**2*g,R=T**2*g,L=Math.sign(m)*m*m*P;return Math.sign(T)*v*R>L?Math.sqrt(P+R)*y-u:Math.sign(w)*v*M<L?Math.sqrt(P+M)*y-o:(Math.sqrt(P*v*y)+w*m)*y-o}h(i2,"roundCone");wo(i2,"roundCone");function gU(i,e){return Math.min(i,e)}h(gU,"merge");wo(gU,"merge");function s2(i,e,t){const n=Math.max(0,Math.min(1,.5+.5*(e-i)/t));return e*(1-n)+i*n-t*n*(1-n)}h(s2,"mergeSmooth");wo(s2,"mergeSmooth");function r2(i,e){return Math.max(i,e)}h(r2,"intersect");wo(r2,"intersect");function o2(i,e,t){const n=Math.max(0,Math.min(1,.5-.5*(e-i)/t));return e*(1-n)+i*n+t*n*(1-n)}h(o2,"intersectSmooth");wo(o2,"intersectSmooth");function vU(i,e){return r2(i,-e)}h(vU,"subtract");wo(vU,"subtract");function a2(i,e,t){return o2(i,-e,t)}h(a2,"subtractSmooth");wo(a2,"subtractSmooth");var yU=Object.defineProperty,z1=h((i,e)=>yU(i,"name",{value:e,configurable:!0}),"__name$1h");class dh{constructor(e,t,n){C(this,"position");C(this,"radius");C(this,"operator");C(this,"bb");C(this,"fatBb",new zn);this.position=e,this.radius=t,this.operator=n,this.bb=new zn().expandByPoint(e).expandByScalar(t)}createSymmetry(e){const t=new A().copy(this.position);return t.setComponent(e,-t.getComponent(e)),new dh(t,this.radius,this.operator)}sdf(e,t,n){return n2(e,t,n,this.position.x,this.position.y,this.position.z,this.radius)}}h(dh,"SdfSphere");z1(dh,"SdfSphere");class fh{constructor(e,t,n,s,r){C(this,"p1");C(this,"r1");C(this,"p2");C(this,"r2");C(this,"operator");C(this,"bb");C(this,"fatBb",new zn);this.p1=e,this.r1=t,this.p2=n,this.r2=s,this.operator=r,this.bb=new zn().union(new zn().expandByPoint(e).expandByScalar(t)).union(new zn().expandByPoint(n).expandByScalar(s))}createSymmetry(e){const t=new A().copy(this.p1).setComponent(e,-this.p1.getComponent(e)),n=new A().copy(this.p2).setComponent(e,-this.p2.getComponent(e));return new fh(t,this.r1,n,this.r2,this.operator)}sdf(e,t,n){return i2(e,t,n,this.p1.x,this.p1.y,this.p1.z,this.r1,this.p2.x,this.p2.y,this.p2.z,this.r2)}}h(fh,"SdfRoundCone");z1(fh,"SdfRoundCone");const Ya=new A;class Rp{constructor(){C(this,"resolution",.003);C(this,"maxResolutionSeg",100);C(this,"symmetryAxis",-1);C(this,"smoothRange",.01);C(this,"shapes",[])}sphere(e,t,n){if(t<=0)return;const s=new dh(e,t,n);this.shapes.push(s),this.symmetryAxis>=0&&this.shapes.push(s.createSymmetry(this.symmetryAxis))}roundCone(e,t,n,s,r){if(t<=0&&s<=0)return;if(Ya.subVectors(e,n).length()+Math.min(t,s)<=Math.max(t,s))return t>s?this.sphere(e,t,r):this.sphere(n,s,r);const a=new fh(e,t,n,s,r);this.shapes.push(a),this.symmetryAxis>=0&&this.shapes.push(a.createSymmetry(this.symmetryAxis))}build(){const e=new zn;for(let y of this.shapes)y.operator&&e.union(y.bb);if(e.isEmpty())return{position:[],normal:[]};e.getSize(Ya);let t=Math.max(this.resolution,Math.max(Ya.x,Ya.y,Ya.z)/this.maxResolutionSeg);const n=this.smoothRange;for(let y of this.shapes)y.fatBb.copy(y.bb).expandByScalar(t+n);const s=e.min.x-t-n,r=e.min.y-t-n,o=e.min.z-t-n,a=e.max.x+t+n,l=e.max.y+t+n,c=e.max.z+t+n,u=Math.ceil((a-s)/t),d=Math.ceil((l-r)/t),f=Math.ceil((c-o)/t),p=new Float32Array(u*d*f),g=new Hs(p.length);for(let y=0;y<u;++y){const b=s+y*t;for(let _=0;_<d;++_){const x=r+_*t;for(let w=0;w<f;++w){const T=o+w*t,P=y*d*f+_*f+w;for(let M of this.shapes)if(!!M.fatBb.containsPoint(Ya.set(b,x,T)))if(M.operator)g.get(P)?p[P]=s2(p[P],M.sdf(b,x,T),n):(g.set(P),p[P]=M.sdf(b,x,T));else{if(!g.get(P))continue;p[P]=a2(p[P],M.sdf(b,x,T),n)}}}}const m=[],v=[];for(let y=0;y<u-1;++y){const b=s+y*t;for(let _=0;_<d-1;++_){const x=r+_*t;for(let w=0;w<f-1;++w){const T=o+w*t;!g.get(y*d*f+_*f+w)||F1(m,v,null,b,x,T,t,p,null,y*d*f+_*f+w,(y+1)*d*f+_*f+w,(y+1)*d*f+_*f+(w+1),y*d*f+_*f+(w+1),y*d*f+(_+1)*f+w,(y+1)*d*f+(_+1)*f+w,(y+1)*d*f+(_+1)*f+(w+1),y*d*f+(_+1)*f+(w+1))}}}return{position:m,normal:v}}}h(Rp,"SdfMeshBuilder");z1(Rp,"SdfMeshBuilder");var _U=Object.defineProperty,bU=h((i,e)=>_U(i,"name",{value:e,configurable:!0}),"__name$1g");class B1{update(e,t){var l;if(t.instanceId||t.type!=="Clay")return;const n=t.get(an),s=t.get(bs);if(!n.dirty&&!s.dirty)return;n.dirty=!1,s.dirty=!1;const r=n.partialUpdate||s.partialUpdate;if(n.partialUpdate=!1,s.partialUpdate=!1,n.value.length===0){const c=new Rp;c.sphere(new A(0,0,0),.25,!0);const{position:u}=c.build();n.value=new Float32Array(u),s.value=new Float32Array(u.length);for(let d=0,f=s.value.length;d<f;++d)s.value[d]=1}const o=t.get(Ce);!o.mesh||!r?(o.mesh=new N1,o.mesh.buildFromTriangles(n.value,s.value),n.value=new Float32Array(o.mesh.aPosition),s.value=new Float32Array(o.mesh.aColor)):o.mesh.update((l=o.value)==null?void 0:l.geometry),r||o.dispose();const a=o.value;o.value?o.mesh.toThree(o.value):(o.value=o.mesh.toThree(),o.value.userData={node:t},o.parentChanged=!0,o.localTransformChanged=!0),e.model.instanceMeshUpdated(t.id,a!==o.value)}}h(B1,"ClayUpdateFilter");bU(B1,"ClayUpdateFilter");var wU=Object.defineProperty,xU=h((i,e)=>wU(i,"name",{value:e,configurable:!0}),"__name$1f");class U1{update(e,t){if(t.type==="Container"){const n=t.get(Ce);n.value||(n.value=new di,n.value.userData={node:t}),t.instanceId&&(t.instanceMeshDirty=!1)}}}h(U1,"ContainerUpdateFilter");xU(U1,"ContainerUpdateFilter");var MU=Object.defineProperty,AU=h((i,e)=>MU(i,"name",{value:e,configurable:!0}),"__name$1e");class V1{update(e,t){if(t.instanceId||t.type!=="Shape"||!t.value(Si))return;const n=t.get(Si);n.value=!1;const s=t.get(Ce);s.value||(s.value=new Re(new et,new Pr),s.value.userData={node:t}),n.throttleHash=`#${t.id}-update-sdf-shape-geometry`,e.throttle(n.throttleHash,25,function(){if(t.deleted)return;n.throttleHash="";const r=new Rp;switch(r.smoothRange=t.value(Wl),t.value(Hi)){case"x":r.symmetryAxis=0;break;case"y":r.symmetryAxis=1;break;case"z":r.symmetryAxis=2;break}for(let u of t.children){const d=u.value(ot),f=u.value(Vl)==="add";if(d.length===1)r.sphere(d[0].position,d[0].radius,f);else for(let p=0;p+1<d.length;++p){const g=d[p],m=d[p+1];r.roundCone(g.position,g.radius,m.position,m.radius,f)}}const{position:o,normal:a}=r.build(),c=s.value.geometry;c.setAttribute("position",new Fe(o,3)),c.setAttribute("normal",new Fe(a,3)),c.computeBoundingSphere(),e.model.instanceMeshUpdated(t.id,!0)},!1)}}h(V1,"SdfShapeUpdateFilter");AU(V1,"SdfShapeUpdateFilter");var SU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGZJREFUSIntlsEOwCAIQ8vCf+u+HC8z0WnUMEh2oDc09PVkJQAZjmIAEJHkYU5EN7eDpXkNzbPDr2rD8upSo3fIAfAoK/2HvUtpdKwABCAAAfgDwPo13QOs67MDWNdmB3Arfjh/WwpBzho97mV7igAAAABJRU5ErkJggg==",CU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAALhJREFUSIntVdsOwjAIHcb/HvtyfAFCESjVGmPieVuBc8k2CkcPuHiuuHeIieiMigAwFcoEBmIAuKImU58KDeTE4AF99vD1SMAnQCI6xfFCAu3nNGESFBfeYZXW9/sk6UtmVxW5OgWA9EMI3TeI2xy3F4j2KO/i+niCv8D3BQS//R+UDt6dTXeR2YxHIYbSm/FYAZSlFazr1ATX7bqeLsmtF05sbf3KvOxcRyAUehouiLsCg9DCueIBQtEIj3OkCCMAAAAASUVORK5CYII=",TU=Object.defineProperty,EU=h((i,e)=>TU(i,"name",{value:e,configurable:!0}),"__name$1d");const l2=new Ap,e0=l2.load(SU);e0.minFilter=e0.magFilter=Cn;const t0=l2.load(CU);t0.minFilter=t0.magFilter=Cn;class H1{update(e,t){var s,r,o,a;if(t.type!=="IKChain")return;t.instanceId&&(t.instanceMeshDirty=!1);const n=t.get(Ce);n.value||(n.value=new di,n.value.userData={node:t});for(let l=0,c=t.children.length;l<c;++l){const u=t.children[l];u.instanceId&&(u.instanceMeshDirty=!1);const d=u.get(Ce);d.value||(d.value=new di,d.value.userData={node:u});const f=u.get(mt);if(!f.dirty)continue;if(!f.boneMesh){const T=f.boneMesh=new Re;T.material=new hi({depthWrite:!1,depthTest:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5,color:7829367}),T.renderOrder=1,T.visible=e.options.showIkBones,d.value.add(T)}const p=f.boneMesh,g=u.value(fi),m=p.geometry;((s=m==null?void 0:m.parameters)==null?void 0:s.height)!==g&&((r=p.geometry)==null||r.dispose(),p.geometry=new xp(.003,g,6).translate(0,u.value(fi)/2,0).rotateZ(-Math.PI/2));const v=u.value(co);let y=v[0]/180*Math.PI,b=v[1]/180*Math.PI;if(u.instanceId&&u.has(_n)){const T=u.value(_n);switch(u.value(Ti)){case"horizontal":T.z>1e-6&&([y,b]=[-b,-y]);break;case"vertical":T.y>1e-6&&([y,b]=[-b,-y]);break}}if(!f.hingeIndicator){const T=f.hingeIndicator=new Re;T.material=new hi({depthWrite:!1,depthTest:!1,fog:!1,toneMapped:!1,transparent:!0,opacity:.5,color:16777215,side:Ci}),T.renderOrder=1}const _=f.hingeIndicator;_.visible=e.options.showIkBones&&u.value(Ti)!=="none";const x=l===0?t.value(Ce):t.children[l-1].value(Ce);_.parent!==x&&x.add(_);const w=_.geometry;switch((!w||((o=w==null?void 0:w.parameters)==null?void 0:o.thetaStart)!==y||((a=w==null?void 0:w.parameters)==null?void 0:a.thetaLength)!==b-y)&&(w==null||w.dispose(),_.geometry=new wp(.025,32,y,b-y)),u.value(Ti)){case"horizontal":_.rotation.set(-Math.PI/2,0,0),f.hingeEnabled=!0,_.material.color.setHex(65535);break;case"vertical":_.rotation.set(0,0,0),f.hingeEnabled=!0,_.material.color.setHex(16776960);break;default:f.hingeEnabled=!1;break}if(l===0?_.position.set(0,0,0):_.position.set(t.children[l-1].value(fi),0,0),f.moveHandler||(f.moveHandler=new la(new et().setFromPoints([new A]),new mr({map:e0,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),f.moveHandler.renderOrder=2,d.value.add(f.moveHandler),f.moveHandler.visible=!1),f.rotateHandler||(f.rotateHandler=new la(new et().setFromPoints([new A]),new mr({map:t0,sizeAttenuation:!1,depthTest:!1,depthWrite:!1,transparent:!0,size:24})),f.rotateHandler.renderOrder=2,d.value.add(f.rotateHandler),f.rotateHandler.visible=!1),f.dirty=!1,f.quaternion.setFromEuler(u.value(Ut)),l>0){const T=t.children[l-1].get(mt);f.start.copy(T.end),f.quaternion.multiplyQuaternions(T.quaternion,f.quaternion).normalize()}else f.start.set(0,0,0);f.end.set(u.value(fi),0,0).applyQuaternion(f.quaternion).add(f.start),f.rotateHandler.position.set(g,0,0)}}}h(H1,"IkChainUpdateFilter");EU(H1,"IkChainUpdateFilter");var PU=Object.defineProperty,RU=h((i,e)=>PU(i,"name",{value:e,configurable:!0}),"__name$1c");class G1 extends et{constructor(e=1,t=1,n=1,s=1){super(),this.type="DoubleSidedPlaneGeometry";const r=e/2,o=t/2,a=Math.floor(n),l=Math.floor(s),c=a+1,u=l+1,d=e/a,f=t/l,p=[],g=[],m=[],v=[];for(let b=0;b<2;++b)for(let _=0;_<u;_++){const x=_*f-o;for(let w=0;w<c;w++){const T=w*d-r;g.push(T,-x,0),m.push(0,0,b===0?1:-1),v.push(w/a),v.push(1-_/l)}}const y=c*u;for(let b=0;b<l;b++)for(let _=0;_<a;_++){const x=_+c*b,w=_+c*(b+1),T=_+1+c*(b+1),P=_+1+c*b;p.push(x,w,P),p.push(w,T,P),p.push(x+y,P+y,T+y),p.push(x+y,T+y,w+y)}this.setIndex(p),this.setAttribute("position",new Fe(g,3)),this.setAttribute("normal",new Fe(m,3)),this.setAttribute("uv",new Fe(v,2))}}h(G1,"DoubleSidedPlaneGeometry");RU(G1,"DoubleSidedPlaneGeometry");var IU=Object.defineProperty,DU=h((i,e)=>IU(i,"name",{value:e,configurable:!0}),"__name$1b");class W1{update(e,t){if(t.instanceId||!t.has(uo))return;const n=t.get(uo);if(!n.dirty||(n.dirty=!1,!n.value))return;const s=new Image;s.onload=function(){if(t.deleted||s.src!==n.value)return;n.texture&&n.texture.dispose();const r=n.texture=new Pn;if(n.texture.image=s,n.texture.needsUpdate=!0,t.type!=="Image")return;const o=t.get(Ce);o.dispose();const a=1,l=s.height/s.width*a;o.value=new Re(new G1(a,l),new X0({map:r})),o.value.userData={node:t},e.model.dirty=!0,t.dirty=!0,o.parentChanged=!0,o.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)},s.src=n.value}}h(W1,"ImageUpdateFilter");DU(W1,"ImageUpdateFilter");var pd=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function md(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}h(md,"commonjsRequire");var c2={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,e){(function(t){i.exports=t()})(function(){return h(function t(n,s,r){function o(c,u){if(!s[c]){if(!n[c]){var d=typeof md=="function"&&md;if(!u&&d)return d(c,!0);if(a)return a(c,!0);var f=new Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f}var p=s[c]={exports:{}};n[c][0].call(p.exports,function(g){var m=n[c][1][g];return o(m||g)},p,p.exports,t,n,s,r)}return s[c].exports}h(o,"u");for(var a=typeof md=="function"&&md,l=0;l<r.length;l++)o(r[l]);return o},"s")({1:[function(t,n,s){var r=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var c,u,d,f,p,g,m,v=[],y=0,b=l.length,_=b,x=r.getTypeOf(l)!=="string";y<l.length;)_=b-y,d=x?(c=l[y++],u=y<b?l[y++]:0,y<b?l[y++]:0):(c=l.charCodeAt(y++),u=y<b?l.charCodeAt(y++):0,y<b?l.charCodeAt(y++):0),f=c>>2,p=(3&c)<<4|u>>4,g=1<_?(15&u)<<2|d>>6:64,m=2<_?63&d:64,v.push(a.charAt(f)+a.charAt(p)+a.charAt(g)+a.charAt(m));return v.join("")},s.decode=function(l){var c,u,d,f,p,g,m=0,v=0,y="data:";if(l.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var b,_=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&_--,l.charAt(l.length-2)===a.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(b=o.uint8array?new Uint8Array(0|_):new Array(0|_);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(f=a.indexOf(l.charAt(m++)))>>4,u=(15&f)<<4|(p=a.indexOf(l.charAt(m++)))>>2,d=(3&p)<<6|(g=a.indexOf(l.charAt(m++))),b[v++]=c,p!==64&&(b[v++]=u),g!==64&&(b[v++]=d);return b}},{"./support":30,"./utils":32}],2:[function(t,n,s){var r=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(u,d,f,p,g){this.compressedSize=u,this.uncompressedSize=d,this.crc32=f,this.compression=p,this.compressedContent=g}h(c,"o"),c.prototype={getContentWorker:function(){var u=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return u.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(u,d,f){return u.pipe(new a).pipe(new l("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},n.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,n,s){var r=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,n,s){var r=t("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var u=0;u<8;u++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();n.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,u,d,f){var p=o,g=f+d;c^=-1;for(var m=f;m<g;m++)c=c>>>8^p[255&(c^u[m])];return-1^c}(0|l,a,a.length,0):function(c,u,d,f){var p=o,g=f+d;c^=-1;for(var m=f;m<g;m++)c=c>>>8^p[255&(c^u.charCodeAt(m))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,n,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,n,s){var r=null;r=typeof Promise!="undefined"?Promise:t("lie"),n.exports={Promise:r}},{lie:37}],7:[function(t,n,s){var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",o=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=r?"uint8array":"array";function u(d,f){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}h(u,"h"),s.magic="\b\0",a.inherits(u,l),u.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,d.data),!1)},u.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},s.compressWorker=function(d){return new u("Deflate",d)},s.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,n,s){function r(p,g){var m,v="";for(m=0;m<g;m++)v+=String.fromCharCode(255&p),p>>>=8;return v}h(r,"A");function o(p,g,m,v,y,b){var _,x,w=p.file,T=p.compression,P=b!==c.utf8encode,M=a.transformTo("string",b(w.name)),R=a.transformTo("string",c.utf8encode(w.name)),L=w.comment,W=a.transformTo("string",b(L)),k=a.transformTo("string",c.utf8encode(L)),z=R.length!==w.name.length,S=k.length!==L.length,B="",ne="",K="",ie=w.dir,G=w.date,se={crc32:0,compressedSize:0,uncompressedSize:0};g&&!m||(se.crc32=p.crc32,se.compressedSize=p.compressedSize,se.uncompressedSize=p.uncompressedSize);var q=0;g&&(q|=8),P||!z&&!S||(q|=2048);var U=0,le=0;ie&&(U|=16),y==="UNIX"?(le=798,U|=function(J,te){var me=J;return J||(me=te?16893:33204),(65535&me)<<16}(w.unixPermissions,ie)):(le=20,U|=function(J){return 63&(J||0)}(w.dosPermissions)),_=G.getUTCHours(),_<<=6,_|=G.getUTCMinutes(),_<<=5,_|=G.getUTCSeconds()/2,x=G.getUTCFullYear()-1980,x<<=4,x|=G.getUTCMonth()+1,x<<=5,x|=G.getUTCDate(),z&&(ne=r(1,1)+r(u(M),4)+R,B+="up"+r(ne.length,2)+ne),S&&(K=r(1,1)+r(u(W),4)+k,B+="uc"+r(K.length,2)+K);var ae="";return ae+=`
\0`,ae+=r(q,2),ae+=T.magic,ae+=r(_,2),ae+=r(x,2),ae+=r(se.crc32,4),ae+=r(se.compressedSize,4),ae+=r(se.uncompressedSize,4),ae+=r(M.length,2),ae+=r(B.length,2),{fileRecord:d.LOCAL_FILE_HEADER+ae+M+B,dirRecord:d.CENTRAL_FILE_HEADER+r(le,2)+ae+r(W.length,2)+"\0\0\0\0"+r(U,4)+r(v,4)+M+B+W}}h(o,"n");var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),u=t("../crc32"),d=t("../signature");function f(p,g,m,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=m,this.encodeFileName=v,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}h(f,"s"),a.inherits(f,l),f.prototype.push=function(p){var g=p.meta.percent||0,m=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:m?(g+100*(m-v-1))/m:100}}))},f.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var g=this.streamFiles&&!p.file.dir;if(g){var m=o(p,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(p){this.accumulate=!1;var g=this.streamFiles&&!p.file.dir,m=o(p,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),g)this.push({data:function(v){return d.DATA_DESCRIPTOR+r(v.crc32,4)+r(v.compressedSize,4)+r(v.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var p=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var m=this.bytesWritten-p,v=function(y,b,_,x,w){var T=a.transformTo("string",w(x));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(y,2)+r(y,2)+r(b,4)+r(_,4)+r(T.length,2)+T}(this.dirRecords.length,m,p,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(p){this._sources.push(p);var g=this;return p.on("data",function(m){g.processChunk(m)}),p.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),p.on("error",function(m){g.error(m)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(p){var g=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var m=0;m<g.length;m++)try{g[m].error(p)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,g=0;g<p.length;g++)p[g].lock()},n.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,n,s){var r=t("../compressions"),o=t("./ZipFileWorker");s.generateWorker=function(a,l,c){var u=new o(l.streamFiles,c,l.platform,l.encodeFileName),d=0;try{a.forEach(function(f,p){d++;var g=function(b,_){var x=b||_,w=r[x];if(!w)throw new Error(x+" is not a valid compression method !");return w}(p.options.compression,l.compression),m=p.options.compressionOptions||l.compressionOptions||{},v=p.dir,y=p.date;p._compressWorker(g,m).withStreamInfo("file",{name:f,dir:v,date:y,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(u)}),u.entriesCount=d}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,n,s){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}h(r,"n"),(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=t("./external"),n.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,n,s){var r=t("./utils"),o=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function d(f){return new o.Promise(function(p,g){var m=f.decompressed.getContentWorker().pipe(new c);m.on("error",function(v){g(v)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}h(d,"f"),n.exports=function(f,p){var g=this;return p=r.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(m){var v=new l(p);return v.load(m),v}).then(function(m){var v=[o.Promise.resolve(m)],y=m.files;if(p.checkCRC32)for(var b=0;b<y.length;b++)v.push(d(y[b]));return o.Promise.all(v)}).then(function(m){for(var v=m.shift(),y=v.files,b=0;b<y.length;b++){var _=y[b],x=_.fileNameStr,w=r.resolve(_.fileNameStr);g.file(w,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:p.createFolders}),_.dir||(g.file(w).unsafeOriginalName=x)}return v.zipComment.length&&(g.comment=v.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,n,s){var r=t("../utils"),o=t("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}h(a,"s"),r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,n,s){var r=t("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var u=this;a.on("data",function(d,f){u.push(d)||u._helper.pause(),c&&c(f)}).on("error",function(d){u.emit("error",d)}).on("end",function(){u.push(null)})}h(o,"n"),t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,n,s){n.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,n,s){function r(w,T,P){var M,R=a.getTypeOf(T),L=a.extend(P||{},u);L.date=L.date||new Date,L.compression!==null&&(L.compression=L.compression.toUpperCase()),typeof L.unixPermissions=="string"&&(L.unixPermissions=parseInt(L.unixPermissions,8)),L.unixPermissions&&16384&L.unixPermissions&&(L.dir=!0),L.dosPermissions&&16&L.dosPermissions&&(L.dir=!0),L.dir&&(w=y(w)),L.createFolders&&(M=v(w))&&b.call(this,M,!0);var W=R==="string"&&L.binary===!1&&L.base64===!1;P&&P.binary!==void 0||(L.binary=!W),(T instanceof d&&T.uncompressedSize===0||L.dir||!T||T.length===0)&&(L.base64=!1,L.binary=!0,T="",L.compression="STORE",R="string");var k=null;k=T instanceof d||T instanceof l?T:g.isNode&&g.isStream(T)?new m(w,T):a.prepareContent(w,T,L.binary,L.optimizedBinaryString,L.base64);var z=new f(w,k,L);this.files[w]=z}h(r,"s");var o=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),u=t("./defaults"),d=t("./compressedObject"),f=t("./zipObject"),p=t("./generate"),g=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),v=h(function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var T=w.lastIndexOf("/");return 0<T?w.substring(0,T):""},"_"),y=h(function(w){return w.slice(-1)!=="/"&&(w+="/"),w},"g"),b=h(function(w,T){return T=T!==void 0?T:u.createFolders,w=y(w),this.files[w]||r.call(this,w,null,{dir:!0,createFolders:T}),this.files[w]},"b");function _(w){return Object.prototype.toString.call(w)==="[object RegExp]"}h(_,"h");var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var T,P,M;for(T in this.files)M=this.files[T],(P=T.slice(this.root.length,T.length))&&T.slice(0,this.root.length)===this.root&&w(P,M)},filter:function(w){var T=[];return this.forEach(function(P,M){w(P,M)&&T.push(M)}),T},file:function(w,T,P){if(arguments.length!==1)return w=this.root+w,r.call(this,w,T,P),this;if(_(w)){var M=w;return this.filter(function(L,W){return!W.dir&&M.test(L)})}var R=this.files[this.root+w];return R&&!R.dir?R:null},folder:function(w){if(!w)return this;if(_(w))return this.filter(function(R,L){return L.dir&&w.test(R)});var T=this.root+w,P=b.call(this,T),M=this.clone();return M.root=P.name,M},remove:function(w){w=this.root+w;var T=this.files[w];if(T||(w.slice(-1)!=="/"&&(w+="/"),T=this.files[w]),T&&!T.dir)delete this.files[w];else for(var P=this.filter(function(R,L){return L.name.slice(0,w.length)===w}),M=0;M<P.length;M++)delete this.files[P[M].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var T,P={};try{if((P=a.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");a.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var M=P.comment||this.comment||"";T=p.generateWorker(this,P,M)}catch(R){(T=new l("error")).error(R)}return new c(T,P.type||"string",P.mimeType)},generateAsync:function(w,T){return this.generateInternalStream(w).accumulate(T)},generateNodeStream:function(w,T){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(T)}};n.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,n,s){n.exports=t("stream")},{stream:void 0}],17:[function(t,n,s){var r=t("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}h(o,"i"),t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===c&&this.data[f+2]===u&&this.data[f+3]===d)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),u=a.charCodeAt(2),d=a.charCodeAt(3),f=this.readData(4);return l===f[0]&&c===f[1]&&u===f[2]&&d===f[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,n,s){var r=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}h(o,"i"),o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},n.exports=o},{"../utils":32}],19:[function(t,n,s){var r=t("./Uint8ArrayReader");function o(a){r.call(this,a)}h(o,"i"),t("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,n,s){var r=t("./DataReader");function o(a){r.call(this,a)}h(o,"i"),t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,n,s){var r=t("./ArrayReader");function o(a){r.call(this,a)}h(o,"i"),t("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,n,s){var r=t("../utils"),o=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");n.exports=function(d){var f=r.getTypeOf(d);return r.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new c(d):o.uint8array?new u(r.transformTo("uint8array",d)):new a(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,n,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,n,s){var r=t("./GenericWorker"),o=t("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}h(a,"s"),o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},n.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,n,s){var r=t("./GenericWorker"),o=t("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}h(a,"s"),t("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,n,s){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}h(a,"s"),r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},n.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,n,s){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=r.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}h(a,"s"),r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,n,s){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}h(r,"n"),r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=r},{}],29:[function(t,n,s){var r=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),u=t("../external"),d=null;if(c.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(g,m){return new u.Promise(function(v,y){var b=[],_=g._internalType,x=g._outputType,w=g._mimeType;g.on("data",function(T,P){b.push(T),m&&m(P)}).on("error",function(T){b=[],y(T)}).on("end",function(){try{var T=function(P,M,R){switch(P){case"blob":return r.newBlob(r.transformTo("arraybuffer",M),R);case"base64":return l.encode(M);default:return r.transformTo(P,M)}}(x,function(P,M){var R,L=0,W=null,k=0;for(R=0;R<M.length;R++)k+=M[R].length;switch(P){case"string":return M.join("");case"array":return Array.prototype.concat.apply([],M);case"uint8array":for(W=new Uint8Array(k),R=0;R<M.length;R++)W.set(M[R],L),L+=M[R].length;return W;case"nodebuffer":return Buffer.concat(M);default:throw new Error("concat : unsupported type '"+P+"'")}}(_,b),w);v(T)}catch(P){y(P)}b=[]}).resume()})}h(f,"l");function p(g,m,v){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=v,r.checkSupport(y),this._worker=g.pipe(new o(y)),g.lock()}catch(b){this._worker=new a("error"),this._worker.error(b)}}h(p,"f"),p.prototype={accumulate:function(g){return f(this,g)},on:function(g,m){var v=this;return g==="data"?this._worker.on(g,function(y){m.call(v,y.data,y.meta)}):this._worker.on(g,function(){r.delay(m,arguments,v)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},g)}},n.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,n,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",s.nodebuffer=typeof Buffer!="undefined",s.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")s.blob=!1;else{var r=new ArrayBuffer(0);try{s.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),s.blob=o.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(t,n,s){for(var r=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}h(d,"a");function f(){l.call(this,"utf-8 encode")}h(f,"l"),s.utf8encode=function(p){return o.nodebuffer?a.newBufferFrom(p,"utf-8"):function(g){var m,v,y,b,_,x=g.length,w=0;for(b=0;b<x;b++)(64512&(v=g.charCodeAt(b)))==55296&&b+1<x&&(64512&(y=g.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),b++),w+=v<128?1:v<2048?2:v<65536?3:4;for(m=o.uint8array?new Uint8Array(w):new Array(w),b=_=0;_<w;b++)(64512&(v=g.charCodeAt(b)))==55296&&b+1<x&&(64512&(y=g.charCodeAt(b+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),b++),v<128?m[_++]=v:(v<2048?m[_++]=192|v>>>6:(v<65536?m[_++]=224|v>>>12:(m[_++]=240|v>>>18,m[_++]=128|v>>>12&63),m[_++]=128|v>>>6&63),m[_++]=128|63&v);return m}(p)},s.utf8decode=function(p){return o.nodebuffer?r.transformTo("nodebuffer",p).toString("utf-8"):function(g){var m,v,y,b,_=g.length,x=new Array(2*_);for(m=v=0;m<_;)if((y=g[m++])<128)x[v++]=y;else if(4<(b=c[y]))x[v++]=65533,m+=b-1;else{for(y&=b===2?31:b===3?15:7;1<b&&m<_;)y=y<<6|63&g[m++],b--;1<b?x[v++]=65533:y<65536?x[v++]=y:(y-=65536,x[v++]=55296|y>>10&1023,x[v++]=56320|1023&y)}return x.length!==v&&(x.subarray?x=x.subarray(0,v):x.length=v),r.applyFromCharCode(x)}(p=r.transformTo(o.uint8array?"uint8array":"array",p))},r.inherits(d,l),d.prototype.processChunk=function(p){var g=r.transformTo(o.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=g;(g=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),g.set(m,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var v=function(b,_){var x;for((_=_||b.length)>b.length&&(_=b.length),x=_-1;0<=x&&(192&b[x])==128;)x--;return x<0||x===0?_:x+c[b[x]]>_?x:_}(g),y=g;v!==g.length&&(o.uint8array?(y=g.subarray(0,v),this.leftOver=g.subarray(v,g.length)):(y=g.slice(0,v),this.leftOver=g.slice(v,g.length))),this.push({data:s.utf8decode(y),meta:p.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=d,r.inherits(f,l),f.prototype.processChunk=function(p){this.push({data:s.utf8encode(p.data),meta:p.meta})},s.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,n,s){var r=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(m){return m}h(c,"n");function u(m,v){for(var y=0;y<m.length;++y)v[y]=255&m.charCodeAt(y);return v}h(u,"l"),t("setimmediate"),s.newBlob=function(m,v){s.checkSupport("blob");try{return new Blob([m],{type:v})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(m,v,y){var b=[],_=0,x=m.length;if(x<=y)return String.fromCharCode.apply(null,m);for(;_<x;)v==="array"||v==="nodebuffer"?b.push(String.fromCharCode.apply(null,m.slice(_,Math.min(_+y,x)))):b.push(String.fromCharCode.apply(null,m.subarray(_,Math.min(_+y,x)))),_+=y;return b.join("")},stringifyByChar:function(m){for(var v="",y=0;y<m.length;y++)v+=String.fromCharCode(m[y]);return v},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function f(m){var v=65536,y=s.getTypeOf(m),b=!0;if(y==="uint8array"?b=d.applyCanBeUsed.uint8array:y==="nodebuffer"&&(b=d.applyCanBeUsed.nodebuffer),b)for(;1<v;)try{return d.stringifyByChunk(m,y,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(m)}h(f,"s");function p(m,v){for(var y=0;y<m.length;y++)v[y]=m[y];return v}h(p,"f"),s.applyFromCharCode=f;var g={};g.string={string:c,array:function(m){return u(m,new Array(m.length))},arraybuffer:function(m){return g.string.uint8array(m).buffer},uint8array:function(m){return u(m,new Uint8Array(m.length))},nodebuffer:function(m){return u(m,a.allocBuffer(m.length))}},g.array={string:f,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},g.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return p(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},g.uint8array={string:f,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},g.nodebuffer={string:f,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return g.nodebuffer.uint8array(m).buffer},uint8array:function(m){return p(m,new Uint8Array(m.length))},nodebuffer:c},s.transformTo=function(m,v){if(v=v||"",!m)return v;s.checkSupport(m);var y=s.getTypeOf(v);return g[y][m](v)},s.resolve=function(m){for(var v=m.split("/"),y=[],b=0;b<v.length;b++){var _=v[b];_==="."||_===""&&b!==0&&b!==v.length-1||(_===".."?y.pop():y.push(_))}return y.join("/")},s.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(m){var v,y,b="";for(y=0;y<(m||"").length;y++)b+="\\x"+((v=m.charCodeAt(y))<16?"0":"")+v.toString(16).toUpperCase();return b},s.delay=function(m,v,y){setImmediate(function(){m.apply(y||null,v||[])})},s.inherits=function(m,v){function y(){}h(y,"r"),y.prototype=v.prototype,m.prototype=new y},s.extend=function(){var m,v,y={};for(m=0;m<arguments.length;m++)for(v in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],v)&&y[v]===void 0&&(y[v]=arguments[m][v]);return y},s.prepareContent=function(m,v,y,b,_){return l.Promise.resolve(v).then(function(x){return r.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader!="undefined"?new l.Promise(function(w,T){var P=new FileReader;P.onload=function(M){w(M.target.result)},P.onerror=function(M){T(M.target.error)},P.readAsArrayBuffer(x)}):x}).then(function(x){var w=s.getTypeOf(x);return w?(w==="arraybuffer"?x=s.transformTo("uint8array",x):w==="string"&&(_?x=o.decode(x):y&&b!==!0&&(x=function(T){return u(T,r.uint8array?new Uint8Array(T.length):new Array(T.length))}(x))),x):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,n,s){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function u(d){this.files=[],this.loadOptions=d}h(u,"h"),u.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(d)+")")}},isSignature:function(d,f){var p=this.reader.index;this.reader.setIndex(d);var g=this.reader.readString(4)===f;return this.reader.setIndex(p),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=c.uint8array?"uint8array":"array",p=o.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,p,g=this.zip64EndOfCentralSize-44;0<g;)d=this.reader.readInt(2),f=this.reader.readInt(4),p=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var g=f-p;if(0<g)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(d){this.reader=r(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,n,s){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),u=t("./compressions"),d=t("./support");function f(p,g){this.options=p,this.loadOptions=g}h(f,"l"),f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var g,m;if(p.skip(22),this.fileNameLength=p.readInt(2),m=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(v){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===v)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,g,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var g=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(g),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var g,m,v,y=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<y;)g=p.readInt(2),m=p.readInt(2),v=p.readData(m),this.extraFields[g]={id:g,length:m,value:v};p.setIndex(y)},handleUTF8:function(){var p=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var m=o.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var y=o.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var g=r(p.value);return g.readInt(1)!==1||l(this.fileName)!==g.readInt(4)?null:c.utf8decode(g.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var g=r(p.value);return g.readInt(1)!==1||l(this.fileComment)!==g.readInt(4)?null:c.utf8decode(g.readData(p.length-5))}return null}},n.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,n,s){function r(g,m,v){this.name=g,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=m,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}h(r,"n");var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),u=t("./stream/GenericWorker");r.prototype={internalStream:function(g){var m=null,v="string";try{if(!g)throw new Error("No output type specified.");var y=(v=g.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),m=this._decompressWorker();var b=!this._dataBinary;b&&!y&&(m=m.pipe(new l.Utf8EncodeWorker)),!b&&y&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(_){(m=new u("error")).error(_)}return new o(m,v,"")},async:function(g,m){return this.internalStream(g).accumulate(m)},nodeStream:function(g,m){return this.internalStream(g||"nodebuffer").toNodejsStream(m)},_compressWorker:function(g,m){if(this._data instanceof c&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(v,g,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new a(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<d.length;p++)r.prototype[d[p]]=f;n.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,n,s){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,u=new l(g),d=r.document.createTextNode("");u.observe(d,{characterData:!0}),o=h(function(){d.data=c=++c%2},"r")}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){g(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(g,0)};else{var f=new r.MessageChannel;f.port1.onmessage=g,o=h(function(){f.port2.postMessage(0)},"r")}var p=[];function g(){var m,v;a=!0;for(var y=p.length;y;){for(v=p,p=[],m=-1;++m<y;)v[m]();y=p.length}a=!1}h(g,"u"),n.exports=function(m){p.push(m)!==1||a||o()}}).call(this,typeof pd!="undefined"?pd:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(t,n,s){var r=t("immediate");function o(){}h(o,"u");var a={},l=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function d(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==o&&m(this,y)}h(d,"o");function f(y,b,_){this.promise=y,typeof b=="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}h(f,"h");function p(y,b,_){r(function(){var x;try{x=b(_)}catch(w){return a.reject(y,w)}x===y?a.reject(y,new TypeError("Cannot resolve promise with itself")):a.resolve(y,x)})}h(p,"f");function g(y){var b=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof b=="function")return function(){b.apply(y,arguments)}}h(g,"c");function m(y,b){var _=!1;function x(P){_||(_=!0,a.reject(y,P))}h(x,"n");function w(P){_||(_=!0,a.resolve(y,P))}h(w,"i");var T=v(function(){b(w,x)});T.status==="error"&&x(T.value)}h(m,"d");function v(y,b){var _={};try{_.value=y(b),_.status="success"}catch(x){_.status="error",_.value=x}return _}h(v,"p"),(n.exports=d).prototype.finally=function(y){if(typeof y!="function")return this;var b=this.constructor;return this.then(function(_){return b.resolve(y()).then(function(){return _})},function(_){return b.resolve(y()).then(function(){throw _})})},d.prototype.catch=function(y){return this.then(null,y)},d.prototype.then=function(y,b){if(typeof y!="function"&&this.state===c||typeof b!="function"&&this.state===l)return this;var _=new this.constructor(o);return this.state!==u?p(_,this.state===c?y:b,this.outcome):this.queue.push(new f(_,y,b)),_},f.prototype.callFulfilled=function(y){a.resolve(this.promise,y)},f.prototype.otherCallFulfilled=function(y){p(this.promise,this.onFulfilled,y)},f.prototype.callRejected=function(y){a.reject(this.promise,y)},f.prototype.otherCallRejected=function(y){p(this.promise,this.onRejected,y)},a.resolve=function(y,b){var _=v(g,b);if(_.status==="error")return a.reject(y,_.value);var x=_.value;if(x)m(y,x);else{y.state=c,y.outcome=b;for(var w=-1,T=y.queue.length;++w<T;)y.queue[w].callFulfilled(b)}return y},a.reject=function(y,b){y.state=l,y.outcome=b;for(var _=-1,x=y.queue.length;++_<x;)y.queue[_].callRejected(b);return y},d.resolve=function(y){return y instanceof this?y:a.resolve(new this(o),y)},d.reject=function(y){var b=new this(o);return a.reject(b,y)},d.all=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,x=!1;if(!_)return this.resolve([]);for(var w=new Array(_),T=0,P=-1,M=new this(o);++P<_;)R(y[P],P);return M;function R(L,W){b.resolve(L).then(function(k){w[W]=k,++T!==_||x||(x=!0,a.resolve(M,w))},function(k){x||(x=!0,a.reject(M,k))})}},d.race=function(y){var b=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,x=!1;if(!_)return this.resolve([]);for(var w=-1,T=new this(o);++w<_;)P=y[w],b.resolve(P).then(function(M){x||(x=!0,a.resolve(T,M))},function(M){x||(x=!0,a.reject(T,M))});var P;return T}},{immediate:36}],38:[function(t,n,s){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),n.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,n,s){var r=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),u=Object.prototype.toString,d=0,f=-1,p=0,g=8;function m(y){if(!(this instanceof m))return new m(y);this.options=o.assign({level:f,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},y||{});var b=this.options;b.raw&&0<b.windowBits?b.windowBits=-b.windowBits:b.gzip&&0<b.windowBits&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var _=r.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(_!==d)throw new Error(l[_]);if(b.header&&r.deflateSetHeader(this.strm,b.header),b.dictionary){var x;if(x=typeof b.dictionary=="string"?a.string2buf(b.dictionary):u.call(b.dictionary)==="[object ArrayBuffer]"?new Uint8Array(b.dictionary):b.dictionary,(_=r.deflateSetDictionary(this.strm,x))!==d)throw new Error(l[_]);this._dict_set=!0}}h(m,"p");function v(y,b){var _=new m(b);if(_.push(y,!0),_.err)throw _.msg||l[_.err];return _.result}h(v,"n"),m.prototype.push=function(y,b){var _,x,w=this.strm,T=this.options.chunkSize;if(this.ended)return!1;x=b===~~b?b:b===!0?4:0,typeof y=="string"?w.input=a.string2buf(y):u.call(y)==="[object ArrayBuffer]"?w.input=new Uint8Array(y):w.input=y,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(T),w.next_out=0,w.avail_out=T),(_=r.deflate(w,x))!==1&&_!==d)return this.onEnd(_),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&_!==1);return x===4?(_=r.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===d):x!==2||(this.onEnd(d),!(w.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},s.Deflate=m,s.deflate=v,s.deflateRaw=function(y,b){return(b=b||{}).raw=!0,v(y,b)},s.gzip=function(y,b){return(b=b||{}).gzip=!0,v(y,b)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,n,s){var r=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),u=t("./zlib/zstream"),d=t("./zlib/gzheader"),f=Object.prototype.toString;function p(m){if(!(this instanceof p))return new p(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||m&&m.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&(15&v.windowBits)==0&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=r.inflateInit2(this.strm,v.windowBits);if(y!==l.Z_OK)throw new Error(c[y]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}h(p,"a");function g(m,v){var y=new p(v);if(y.push(m,!0),y.err)throw y.msg||c[y.err];return y.result}h(g,"o"),p.prototype.push=function(m,v){var y,b,_,x,w,T,P=this.strm,M=this.options.chunkSize,R=this.options.dictionary,L=!1;if(this.ended)return!1;b=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?P.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?P.input=new Uint8Array(m):P.input=m,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new o.Buf8(M),P.next_out=0,P.avail_out=M),(y=r.inflate(P,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&R&&(T=typeof R=="string"?a.string2buf(R):f.call(R)==="[object ArrayBuffer]"?new Uint8Array(R):R,y=r.inflateSetDictionary(this.strm,T)),y===l.Z_BUF_ERROR&&L===!0&&(y=l.Z_OK,L=!1),y!==l.Z_STREAM_END&&y!==l.Z_OK)return this.onEnd(y),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&y!==l.Z_STREAM_END&&(P.avail_in!==0||b!==l.Z_FINISH&&b!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=a.utf8border(P.output,P.next_out),x=P.next_out-_,w=a.buf2string(P.output,_),P.next_out=x,P.avail_out=M-x,x&&o.arraySet(P.output,P.output,_,x,0),this.onData(w)):this.onData(o.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(L=!0)}while((0<P.avail_in||P.avail_out===0)&&y!==l.Z_STREAM_END);return y===l.Z_STREAM_END&&(b=l.Z_FINISH),b===l.Z_FINISH?(y=r.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l.Z_OK):b!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(P.avail_out=0))},p.prototype.onData=function(m){this.chunks.push(m)},p.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},s.Inflate=p,s.inflate=g,s.inflateRaw=function(m,v){return(v=v||{}).raw=!0,g(m,v)},s.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,n,s){var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";s.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)u.hasOwnProperty(d)&&(l[d]=u[d])}}return l},s.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,u,d,f){if(c.subarray&&l.subarray)l.set(c.subarray(u,u+d),f);else for(var p=0;p<d;p++)l[f+p]=c[u+p]},flattenChunks:function(l){var c,u,d,f,p,g;for(c=d=0,u=l.length;c<u;c++)d+=l[c].length;for(g=new Uint8Array(d),c=f=0,u=l.length;c<u;c++)p=l[c],g.set(p,f),f+=p.length;return g}},a={arraySet:function(l,c,u,d,f){for(var p=0;p<d;p++)l[f+p]=c[u+p]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,o)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,a))},s.setTyped(r)},{}],42:[function(t,n,s){var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(d,f){if(f<65537&&(d.subarray&&a||!d.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(d,f));for(var p="",g=0;g<f;g++)p+=String.fromCharCode(d[g]);return p}h(u,"l"),l[254]=l[254]=1,s.string2buf=function(d){var f,p,g,m,v,y=d.length,b=0;for(m=0;m<y;m++)(64512&(p=d.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=d.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),m++),b+=p<128?1:p<2048?2:p<65536?3:4;for(f=new r.Buf8(b),m=v=0;v<b;m++)(64512&(p=d.charCodeAt(m)))==55296&&m+1<y&&(64512&(g=d.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),m++),p<128?f[v++]=p:(p<2048?f[v++]=192|p>>>6:(p<65536?f[v++]=224|p>>>12:(f[v++]=240|p>>>18,f[v++]=128|p>>>12&63),f[v++]=128|p>>>6&63),f[v++]=128|63&p);return f},s.buf2binstring=function(d){return u(d,d.length)},s.binstring2buf=function(d){for(var f=new r.Buf8(d.length),p=0,g=f.length;p<g;p++)f[p]=d.charCodeAt(p);return f},s.buf2string=function(d,f){var p,g,m,v,y=f||d.length,b=new Array(2*y);for(p=g=0;p<y;)if((m=d[p++])<128)b[g++]=m;else if(4<(v=l[m]))b[g++]=65533,p+=v-1;else{for(m&=v===2?31:v===3?15:7;1<v&&p<y;)m=m<<6|63&d[p++],v--;1<v?b[g++]=65533:m<65536?b[g++]=m:(m-=65536,b[g++]=55296|m>>10&1023,b[g++]=56320|1023&m)}return u(b,g)},s.utf8border=function(d,f){var p;for((f=f||d.length)>d.length&&(f=d.length),p=f-1;0<=p&&(192&d[p])==128;)p--;return p<0||p===0?f:p+l[d[p]]>f?p:f}},{"./common":41}],43:[function(t,n,s){n.exports=function(r,o,a,l){for(var c=65535&r|0,u=r>>>16&65535|0,d=0;a!==0;){for(a-=d=2e3<a?2e3:a;u=u+(c=c+o[l++]|0)|0,--d;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(t,n,s){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,n,s){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();n.exports=function(o,a,l,c){var u=r,d=c+l;o^=-1;for(var f=c;f<d;f++)o=o>>>8^u[255&(o^a[f])];return-1^o}},{}],46:[function(t,n,s){var r,o=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),u=t("./messages"),d=0,f=4,p=0,g=-2,m=-1,v=4,y=2,b=8,_=9,x=286,w=30,T=19,P=2*x+1,M=15,R=3,L=258,W=L+R+1,k=42,z=113,S=1,B=2,ne=3,K=4;function ie(E,ee){return E.msg=u[ee],ee}h(ie,"R");function G(E){return(E<<1)-(4<E?9:0)}h(G,"T");function se(E){for(var ee=E.length;0<=--ee;)E[ee]=0}h(se,"D");function q(E){var ee=E.state,Q=ee.pending;Q>E.avail_out&&(Q=E.avail_out),Q!==0&&(o.arraySet(E.output,ee.pending_buf,ee.pending_out,Q,E.next_out),E.next_out+=Q,ee.pending_out+=Q,E.total_out+=Q,E.avail_out-=Q,ee.pending-=Q,ee.pending===0&&(ee.pending_out=0))}h(q,"F");function U(E,ee){a._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,ee),E.block_start=E.strstart,q(E.strm)}h(U,"N");function le(E,ee){E.pending_buf[E.pending++]=ee}h(le,"U");function ae(E,ee){E.pending_buf[E.pending++]=ee>>>8&255,E.pending_buf[E.pending++]=255&ee}h(ae,"P");function J(E,ee){var Q,F,O=E.max_chain_length,j=E.strstart,N=E.prev_length,$=E.nice_match,I=E.strstart>E.w_size-W?E.strstart-(E.w_size-W):0,D=E.window,H=E.w_mask,Z=E.prev,re=E.strstart+L,ue=D[j+N-1],ge=D[j+N];E.prev_length>=E.good_match&&(O>>=2),$>E.lookahead&&($=E.lookahead);do if(D[(Q=ee)+N]===ge&&D[Q+N-1]===ue&&D[Q]===D[j]&&D[++Q]===D[j+1]){j+=2,Q++;do;while(D[++j]===D[++Q]&&D[++j]===D[++Q]&&D[++j]===D[++Q]&&D[++j]===D[++Q]&&D[++j]===D[++Q]&&D[++j]===D[++Q]&&D[++j]===D[++Q]&&D[++j]===D[++Q]&&j<re);if(F=L-(re-j),j=re-L,N<F){if(E.match_start=ee,$<=(N=F))break;ue=D[j+N-1],ge=D[j+N]}}while((ee=Z[ee&H])>I&&--O!=0);return N<=E.lookahead?N:E.lookahead}h(J,"L");function te(E){var ee,Q,F,O,j,N,$,I,D,H,Z=E.w_size;do{if(O=E.window_size-E.lookahead-E.strstart,E.strstart>=Z+(Z-W)){for(o.arraySet(E.window,E.window,Z,Z,0),E.match_start-=Z,E.strstart-=Z,E.block_start-=Z,ee=Q=E.hash_size;F=E.head[--ee],E.head[ee]=Z<=F?F-Z:0,--Q;);for(ee=Q=Z;F=E.prev[--ee],E.prev[ee]=Z<=F?F-Z:0,--Q;);O+=Z}if(E.strm.avail_in===0)break;if(N=E.strm,$=E.window,I=E.strstart+E.lookahead,D=O,H=void 0,H=N.avail_in,D<H&&(H=D),Q=H===0?0:(N.avail_in-=H,o.arraySet($,N.input,N.next_in,H,I),N.state.wrap===1?N.adler=l(N.adler,$,H,I):N.state.wrap===2&&(N.adler=c(N.adler,$,H,I)),N.next_in+=H,N.total_in+=H,H),E.lookahead+=Q,E.lookahead+E.insert>=R)for(j=E.strstart-E.insert,E.ins_h=E.window[j],E.ins_h=(E.ins_h<<E.hash_shift^E.window[j+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[j+R-1])&E.hash_mask,E.prev[j&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=j,j++,E.insert--,!(E.lookahead+E.insert<R)););}while(E.lookahead<W&&E.strm.avail_in!==0)}h(te,"j");function me(E,ee){for(var Q,F;;){if(E.lookahead<W){if(te(E),E.lookahead<W&&ee===d)return S;if(E.lookahead===0)break}if(Q=0,E.lookahead>=R&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+R-1])&E.hash_mask,Q=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),Q!==0&&E.strstart-Q<=E.w_size-W&&(E.match_length=J(E,Q)),E.match_length>=R)if(F=a._tr_tally(E,E.strstart-E.match_start,E.match_length-R),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=R){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+R-1])&E.hash_mask,Q=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else F=a._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(F&&(U(E,!1),E.strm.avail_out===0))return S}return E.insert=E.strstart<R-1?E.strstart:R-1,ee===f?(U(E,!0),E.strm.avail_out===0?ne:K):E.last_lit&&(U(E,!1),E.strm.avail_out===0)?S:B}h(me,"Z");function de(E,ee){for(var Q,F,O;;){if(E.lookahead<W){if(te(E),E.lookahead<W&&ee===d)return S;if(E.lookahead===0)break}if(Q=0,E.lookahead>=R&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+R-1])&E.hash_mask,Q=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=R-1,Q!==0&&E.prev_length<E.max_lazy_match&&E.strstart-Q<=E.w_size-W&&(E.match_length=J(E,Q),E.match_length<=5&&(E.strategy===1||E.match_length===R&&4096<E.strstart-E.match_start)&&(E.match_length=R-1)),E.prev_length>=R&&E.match_length<=E.prev_length){for(O=E.strstart+E.lookahead-R,F=a._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-R),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=O&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+R-1])&E.hash_mask,Q=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=R-1,E.strstart++,F&&(U(E,!1),E.strm.avail_out===0))return S}else if(E.match_available){if((F=a._tr_tally(E,0,E.window[E.strstart-1]))&&U(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return S}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(F=a._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<R-1?E.strstart:R-1,ee===f?(U(E,!0),E.strm.avail_out===0?ne:K):E.last_lit&&(U(E,!1),E.strm.avail_out===0)?S:B}h(de,"W");function be(E,ee,Q,F,O){this.good_length=E,this.max_lazy=ee,this.nice_length=Q,this.max_chain=F,this.func=O}h(be,"M");function we(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=b,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*P),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*T+1)),se(this.dyn_ltree),se(this.dyn_dtree),se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(M+1),this.heap=new o.Buf16(2*x+1),se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*x+1),se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}h(we,"H");function Ae(E){var ee;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=y,(ee=E.state).pending=0,ee.pending_out=0,ee.wrap<0&&(ee.wrap=-ee.wrap),ee.status=ee.wrap?k:z,E.adler=ee.wrap===2?0:1,ee.last_flush=d,a._tr_init(ee),p):ie(E,g)}h(Ae,"G");function V(E){var ee=Ae(E);return ee===p&&function(Q){Q.window_size=2*Q.w_size,se(Q.head),Q.max_lazy_match=r[Q.level].max_lazy,Q.good_match=r[Q.level].good_length,Q.nice_match=r[Q.level].nice_length,Q.max_chain_length=r[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=R-1,Q.match_available=0,Q.ins_h=0}(E.state),ee}h(V,"K");function X(E,ee,Q,F,O,j){if(!E)return g;var N=1;if(ee===m&&(ee=6),F<0?(N=0,F=-F):15<F&&(N=2,F-=16),O<1||_<O||Q!==b||F<8||15<F||ee<0||9<ee||j<0||v<j)return ie(E,g);F===8&&(F=9);var $=new we;return(E.state=$).strm=E,$.wrap=N,$.gzhead=null,$.w_bits=F,$.w_size=1<<$.w_bits,$.w_mask=$.w_size-1,$.hash_bits=O+7,$.hash_size=1<<$.hash_bits,$.hash_mask=$.hash_size-1,$.hash_shift=~~(($.hash_bits+R-1)/R),$.window=new o.Buf8(2*$.w_size),$.head=new o.Buf16($.hash_size),$.prev=new o.Buf16($.w_size),$.lit_bufsize=1<<O+6,$.pending_buf_size=4*$.lit_bufsize,$.pending_buf=new o.Buf8($.pending_buf_size),$.d_buf=1*$.lit_bufsize,$.l_buf=3*$.lit_bufsize,$.level=ee,$.strategy=j,$.method=Q,V(E)}h(X,"Y"),r=[new be(0,0,0,0,function(E,ee){var Q=65535;for(Q>E.pending_buf_size-5&&(Q=E.pending_buf_size-5);;){if(E.lookahead<=1){if(te(E),E.lookahead===0&&ee===d)return S;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var F=E.block_start+Q;if((E.strstart===0||E.strstart>=F)&&(E.lookahead=E.strstart-F,E.strstart=F,U(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-W&&(U(E,!1),E.strm.avail_out===0))return S}return E.insert=0,ee===f?(U(E,!0),E.strm.avail_out===0?ne:K):(E.strstart>E.block_start&&(U(E,!1),E.strm.avail_out),S)}),new be(4,4,8,4,me),new be(4,5,16,8,me),new be(4,6,32,32,me),new be(4,4,16,16,de),new be(8,16,32,32,de),new be(8,16,128,128,de),new be(8,32,128,256,de),new be(32,128,258,1024,de),new be(32,258,258,4096,de)],s.deflateInit=function(E,ee){return X(E,ee,b,15,8,0)},s.deflateInit2=X,s.deflateReset=V,s.deflateResetKeep=Ae,s.deflateSetHeader=function(E,ee){return E&&E.state?E.state.wrap!==2?g:(E.state.gzhead=ee,p):g},s.deflate=function(E,ee){var Q,F,O,j;if(!E||!E.state||5<ee||ee<0)return E?ie(E,g):g;if(F=E.state,!E.output||!E.input&&E.avail_in!==0||F.status===666&&ee!==f)return ie(E,E.avail_out===0?-5:g);if(F.strm=E,Q=F.last_flush,F.last_flush=ee,F.status===k)if(F.wrap===2)E.adler=0,le(F,31),le(F,139),le(F,8),F.gzhead?(le(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),le(F,255&F.gzhead.time),le(F,F.gzhead.time>>8&255),le(F,F.gzhead.time>>16&255),le(F,F.gzhead.time>>24&255),le(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),le(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(le(F,255&F.gzhead.extra.length),le(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(E.adler=c(E.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(le(F,0),le(F,0),le(F,0),le(F,0),le(F,0),le(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),le(F,3),F.status=z);else{var N=b+(F.w_bits-8<<4)<<8;N|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(N|=32),N+=31-N%31,F.status=z,ae(F,N),F.strstart!==0&&(ae(F,E.adler>>>16),ae(F,65535&E.adler)),E.adler=1}if(F.status===69)if(F.gzhead.extra){for(O=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>O&&(E.adler=c(E.adler,F.pending_buf,F.pending-O,O)),q(E),O=F.pending,F.pending!==F.pending_buf_size));)le(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>O&&(E.adler=c(E.adler,F.pending_buf,F.pending-O,O)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){O=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>O&&(E.adler=c(E.adler,F.pending_buf,F.pending-O,O)),q(E),O=F.pending,F.pending===F.pending_buf_size)){j=1;break}j=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,le(F,j)}while(j!==0);F.gzhead.hcrc&&F.pending>O&&(E.adler=c(E.adler,F.pending_buf,F.pending-O,O)),j===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){O=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>O&&(E.adler=c(E.adler,F.pending_buf,F.pending-O,O)),q(E),O=F.pending,F.pending===F.pending_buf_size)){j=1;break}j=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,le(F,j)}while(j!==0);F.gzhead.hcrc&&F.pending>O&&(E.adler=c(E.adler,F.pending_buf,F.pending-O,O)),j===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&q(E),F.pending+2<=F.pending_buf_size&&(le(F,255&E.adler),le(F,E.adler>>8&255),E.adler=0,F.status=z)):F.status=z),F.pending!==0){if(q(E),E.avail_out===0)return F.last_flush=-1,p}else if(E.avail_in===0&&G(ee)<=G(Q)&&ee!==f)return ie(E,-5);if(F.status===666&&E.avail_in!==0)return ie(E,-5);if(E.avail_in!==0||F.lookahead!==0||ee!==d&&F.status!==666){var $=F.strategy===2?function(I,D){for(var H;;){if(I.lookahead===0&&(te(I),I.lookahead===0)){if(D===d)return S;break}if(I.match_length=0,H=a._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++,H&&(U(I,!1),I.strm.avail_out===0))return S}return I.insert=0,D===f?(U(I,!0),I.strm.avail_out===0?ne:K):I.last_lit&&(U(I,!1),I.strm.avail_out===0)?S:B}(F,ee):F.strategy===3?function(I,D){for(var H,Z,re,ue,ge=I.window;;){if(I.lookahead<=L){if(te(I),I.lookahead<=L&&D===d)return S;if(I.lookahead===0)break}if(I.match_length=0,I.lookahead>=R&&0<I.strstart&&(Z=ge[re=I.strstart-1])===ge[++re]&&Z===ge[++re]&&Z===ge[++re]){ue=I.strstart+L;do;while(Z===ge[++re]&&Z===ge[++re]&&Z===ge[++re]&&Z===ge[++re]&&Z===ge[++re]&&Z===ge[++re]&&Z===ge[++re]&&Z===ge[++re]&&re<ue);I.match_length=L-(ue-re),I.match_length>I.lookahead&&(I.match_length=I.lookahead)}if(I.match_length>=R?(H=a._tr_tally(I,1,I.match_length-R),I.lookahead-=I.match_length,I.strstart+=I.match_length,I.match_length=0):(H=a._tr_tally(I,0,I.window[I.strstart]),I.lookahead--,I.strstart++),H&&(U(I,!1),I.strm.avail_out===0))return S}return I.insert=0,D===f?(U(I,!0),I.strm.avail_out===0?ne:K):I.last_lit&&(U(I,!1),I.strm.avail_out===0)?S:B}(F,ee):r[F.level].func(F,ee);if($!==ne&&$!==K||(F.status=666),$===S||$===ne)return E.avail_out===0&&(F.last_flush=-1),p;if($===B&&(ee===1?a._tr_align(F):ee!==5&&(a._tr_stored_block(F,0,0,!1),ee===3&&(se(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),q(E),E.avail_out===0))return F.last_flush=-1,p}return ee!==f?p:F.wrap<=0?1:(F.wrap===2?(le(F,255&E.adler),le(F,E.adler>>8&255),le(F,E.adler>>16&255),le(F,E.adler>>24&255),le(F,255&E.total_in),le(F,E.total_in>>8&255),le(F,E.total_in>>16&255),le(F,E.total_in>>24&255)):(ae(F,E.adler>>>16),ae(F,65535&E.adler)),q(E),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?p:1)},s.deflateEnd=function(E){var ee;return E&&E.state?(ee=E.state.status)!==k&&ee!==69&&ee!==73&&ee!==91&&ee!==103&&ee!==z&&ee!==666?ie(E,g):(E.state=null,ee===z?ie(E,-3):p):g},s.deflateSetDictionary=function(E,ee){var Q,F,O,j,N,$,I,D,H=ee.length;if(!E||!E.state||(j=(Q=E.state).wrap)===2||j===1&&Q.status!==k||Q.lookahead)return g;for(j===1&&(E.adler=l(E.adler,ee,H,0)),Q.wrap=0,H>=Q.w_size&&(j===0&&(se(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0),D=new o.Buf8(Q.w_size),o.arraySet(D,ee,H-Q.w_size,Q.w_size,0),ee=D,H=Q.w_size),N=E.avail_in,$=E.next_in,I=E.input,E.avail_in=H,E.next_in=0,E.input=ee,te(Q);Q.lookahead>=R;){for(F=Q.strstart,O=Q.lookahead-(R-1);Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[F+R-1])&Q.hash_mask,Q.prev[F&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=F,F++,--O;);Q.strstart=F,Q.lookahead=R-1,te(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=R-1,Q.match_available=0,E.next_in=$,E.input=I,E.avail_in=N,Q.wrap=j,p},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,n,s){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,n,s){n.exports=function(r,o){var a,l,c,u,d,f,p,g,m,v,y,b,_,x,w,T,P,M,R,L,W,k,z,S,B;a=r.state,l=r.next_in,S=r.input,c=l+(r.avail_in-5),u=r.next_out,B=r.output,d=u-(o-r.avail_out),f=u+(r.avail_out-257),p=a.dmax,g=a.wsize,m=a.whave,v=a.wnext,y=a.window,b=a.hold,_=a.bits,x=a.lencode,w=a.distcode,T=(1<<a.lenbits)-1,P=(1<<a.distbits)-1;e:do{_<15&&(b+=S[l++]<<_,_+=8,b+=S[l++]<<_,_+=8),M=x[b&T];t:for(;;){if(b>>>=R=M>>>24,_-=R,(R=M>>>16&255)===0)B[u++]=65535&M;else{if(!(16&R)){if((64&R)==0){M=x[(65535&M)+(b&(1<<R)-1)];continue t}if(32&R){a.mode=12;break e}r.msg="invalid literal/length code",a.mode=30;break e}L=65535&M,(R&=15)&&(_<R&&(b+=S[l++]<<_,_+=8),L+=b&(1<<R)-1,b>>>=R,_-=R),_<15&&(b+=S[l++]<<_,_+=8,b+=S[l++]<<_,_+=8),M=w[b&P];n:for(;;){if(b>>>=R=M>>>24,_-=R,!(16&(R=M>>>16&255))){if((64&R)==0){M=w[(65535&M)+(b&(1<<R)-1)];continue n}r.msg="invalid distance code",a.mode=30;break e}if(W=65535&M,_<(R&=15)&&(b+=S[l++]<<_,(_+=8)<R&&(b+=S[l++]<<_,_+=8)),p<(W+=b&(1<<R)-1)){r.msg="invalid distance too far back",a.mode=30;break e}if(b>>>=R,_-=R,(R=u-d)<W){if(m<(R=W-R)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break e}if(z=y,(k=0)===v){if(k+=g-R,R<L){for(L-=R;B[u++]=y[k++],--R;);k=u-W,z=B}}else if(v<R){if(k+=g+v-R,(R-=v)<L){for(L-=R;B[u++]=y[k++],--R;);if(k=0,v<L){for(L-=R=v;B[u++]=y[k++],--R;);k=u-W,z=B}}}else if(k+=v-R,R<L){for(L-=R;B[u++]=y[k++],--R;);k=u-W,z=B}for(;2<L;)B[u++]=z[k++],B[u++]=z[k++],B[u++]=z[k++],L-=3;L&&(B[u++]=z[k++],1<L&&(B[u++]=z[k++]))}else{for(k=u-W;B[u++]=B[k++],B[u++]=B[k++],B[u++]=B[k++],2<(L-=3););L&&(B[u++]=B[k++],1<L&&(B[u++]=B[k++]))}break}}break}}while(l<c&&u<f);l-=L=_>>3,b&=(1<<(_-=L<<3))-1,r.next_in=l,r.next_out=u,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=u<f?f-u+257:257-(u-f),a.hold=b,a.bits=_}},{}],49:[function(t,n,s){var r=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),u=1,d=2,f=0,p=-2,g=1,m=852,v=592;function y(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}h(y,"L");function b(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}h(b,"s");function _(k){var z;return k&&k.state?(z=k.state,k.total_in=k.total_out=z.total=0,k.msg="",z.wrap&&(k.adler=1&z.wrap),z.mode=g,z.last=0,z.havedict=0,z.dmax=32768,z.head=null,z.hold=0,z.bits=0,z.lencode=z.lendyn=new r.Buf32(m),z.distcode=z.distdyn=new r.Buf32(v),z.sane=1,z.back=-1,f):p}h(_,"a");function x(k){var z;return k&&k.state?((z=k.state).wsize=0,z.whave=0,z.wnext=0,_(k)):p}h(x,"o");function w(k,z){var S,B;return k&&k.state?(B=k.state,z<0?(S=0,z=-z):(S=1+(z>>4),z<48&&(z&=15)),z&&(z<8||15<z)?p:(B.window!==null&&B.wbits!==z&&(B.window=null),B.wrap=S,B.wbits=z,x(k))):p}h(w,"h");function T(k,z){var S,B;return k?(B=new b,(k.state=B).window=null,(S=w(k,z))!==f&&(k.state=null),S):p}h(T,"u");var P,M,R=!0;function L(k){if(R){var z;for(P=new r.Buf32(512),M=new r.Buf32(32),z=0;z<144;)k.lens[z++]=8;for(;z<256;)k.lens[z++]=9;for(;z<280;)k.lens[z++]=7;for(;z<288;)k.lens[z++]=8;for(c(u,k.lens,0,288,P,0,k.work,{bits:9}),z=0;z<32;)k.lens[z++]=5;c(d,k.lens,0,32,M,0,k.work,{bits:5}),R=!1}k.lencode=P,k.lenbits=9,k.distcode=M,k.distbits=5}h(L,"j");function W(k,z,S,B){var ne,K=k.state;return K.window===null&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new r.Buf8(K.wsize)),B>=K.wsize?(r.arraySet(K.window,z,S-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):(B<(ne=K.wsize-K.wnext)&&(ne=B),r.arraySet(K.window,z,S-B,ne,K.wnext),(B-=ne)?(r.arraySet(K.window,z,S-B,B,0),K.wnext=B,K.whave=K.wsize):(K.wnext+=ne,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=ne))),0}h(W,"Z"),s.inflateReset=x,s.inflateReset2=w,s.inflateResetKeep=_,s.inflateInit=function(k){return T(k,15)},s.inflateInit2=T,s.inflate=function(k,z){var S,B,ne,K,ie,G,se,q,U,le,ae,J,te,me,de,be,we,Ae,V,X,E,ee,Q,F,O=0,j=new r.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return p;(S=k.state).mode===12&&(S.mode=13),ie=k.next_out,ne=k.output,se=k.avail_out,K=k.next_in,B=k.input,G=k.avail_in,q=S.hold,U=S.bits,le=G,ae=se,ee=f;e:for(;;)switch(S.mode){case g:if(S.wrap===0){S.mode=13;break}for(;U<16;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(2&S.wrap&&q===35615){j[S.check=0]=255&q,j[1]=q>>>8&255,S.check=a(S.check,j,2,0),U=q=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&q)<<8)+(q>>8))%31){k.msg="incorrect header check",S.mode=30;break}if((15&q)!=8){k.msg="unknown compression method",S.mode=30;break}if(U-=4,E=8+(15&(q>>>=4)),S.wbits===0)S.wbits=E;else if(E>S.wbits){k.msg="invalid window size",S.mode=30;break}S.dmax=1<<E,k.adler=S.check=1,S.mode=512&q?10:12,U=q=0;break;case 2:for(;U<16;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(S.flags=q,(255&S.flags)!=8){k.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){k.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=q>>8&1),512&S.flags&&(j[0]=255&q,j[1]=q>>>8&255,S.check=a(S.check,j,2,0)),U=q=0,S.mode=3;case 3:for(;U<32;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}S.head&&(S.head.time=q),512&S.flags&&(j[0]=255&q,j[1]=q>>>8&255,j[2]=q>>>16&255,j[3]=q>>>24&255,S.check=a(S.check,j,4,0)),U=q=0,S.mode=4;case 4:for(;U<16;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}S.head&&(S.head.xflags=255&q,S.head.os=q>>8),512&S.flags&&(j[0]=255&q,j[1]=q>>>8&255,S.check=a(S.check,j,2,0)),U=q=0,S.mode=5;case 5:if(1024&S.flags){for(;U<16;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}S.length=q,S.head&&(S.head.extra_len=q),512&S.flags&&(j[0]=255&q,j[1]=q>>>8&255,S.check=a(S.check,j,2,0)),U=q=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(G<(J=S.length)&&(J=G),J&&(S.head&&(E=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),r.arraySet(S.head.extra,B,K,J,E)),512&S.flags&&(S.check=a(S.check,B,J,K)),G-=J,K+=J,S.length-=J),S.length))break e;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(G===0)break e;for(J=0;E=B[K+J++],S.head&&E&&S.length<65536&&(S.head.name+=String.fromCharCode(E)),E&&J<G;);if(512&S.flags&&(S.check=a(S.check,B,J,K)),G-=J,K+=J,E)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(G===0)break e;for(J=0;E=B[K+J++],S.head&&E&&S.length<65536&&(S.head.comment+=String.fromCharCode(E)),E&&J<G;);if(512&S.flags&&(S.check=a(S.check,B,J,K)),G-=J,K+=J,E)break e}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;U<16;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(q!==(65535&S.check)){k.msg="header crc mismatch",S.mode=30;break}U=q=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),k.adler=S.check=0,S.mode=12;break;case 10:for(;U<32;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}k.adler=S.check=y(q),U=q=0,S.mode=11;case 11:if(S.havedict===0)return k.next_out=ie,k.avail_out=se,k.next_in=K,k.avail_in=G,S.hold=q,S.bits=U,2;k.adler=S.check=1,S.mode=12;case 12:if(z===5||z===6)break e;case 13:if(S.last){q>>>=7&U,U-=7&U,S.mode=27;break}for(;U<3;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}switch(S.last=1&q,U-=1,3&(q>>>=1)){case 0:S.mode=14;break;case 1:if(L(S),S.mode=20,z!==6)break;q>>>=2,U-=2;break e;case 2:S.mode=17;break;case 3:k.msg="invalid block type",S.mode=30}q>>>=2,U-=2;break;case 14:for(q>>>=7&U,U-=7&U;U<32;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if((65535&q)!=(q>>>16^65535)){k.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&q,U=q=0,S.mode=15,z===6)break e;case 15:S.mode=16;case 16:if(J=S.length){if(G<J&&(J=G),se<J&&(J=se),J===0)break e;r.arraySet(ne,B,K,J,ie),G-=J,K+=J,se-=J,ie+=J,S.length-=J;break}S.mode=12;break;case 17:for(;U<14;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(S.nlen=257+(31&q),q>>>=5,U-=5,S.ndist=1+(31&q),q>>>=5,U-=5,S.ncode=4+(15&q),q>>>=4,U-=4,286<S.nlen||30<S.ndist){k.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;U<3;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}S.lens[N[S.have++]]=7&q,q>>>=3,U-=3}for(;S.have<19;)S.lens[N[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,Q={bits:S.lenbits},ee=c(0,S.lens,0,19,S.lencode,0,S.work,Q),S.lenbits=Q.bits,ee){k.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;be=(O=S.lencode[q&(1<<S.lenbits)-1])>>>16&255,we=65535&O,!((de=O>>>24)<=U);){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(we<16)q>>>=de,U-=de,S.lens[S.have++]=we;else{if(we===16){for(F=de+2;U<F;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(q>>>=de,U-=de,S.have===0){k.msg="invalid bit length repeat",S.mode=30;break}E=S.lens[S.have-1],J=3+(3&q),q>>>=2,U-=2}else if(we===17){for(F=de+3;U<F;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}U-=de,E=0,J=3+(7&(q>>>=de)),q>>>=3,U-=3}else{for(F=de+7;U<F;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}U-=de,E=0,J=11+(127&(q>>>=de)),q>>>=7,U-=7}if(S.have+J>S.nlen+S.ndist){k.msg="invalid bit length repeat",S.mode=30;break}for(;J--;)S.lens[S.have++]=E}}if(S.mode===30)break;if(S.lens[256]===0){k.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,Q={bits:S.lenbits},ee=c(u,S.lens,0,S.nlen,S.lencode,0,S.work,Q),S.lenbits=Q.bits,ee){k.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,Q={bits:S.distbits},ee=c(d,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,Q),S.distbits=Q.bits,ee){k.msg="invalid distances set",S.mode=30;break}if(S.mode=20,z===6)break e;case 20:S.mode=21;case 21:if(6<=G&&258<=se){k.next_out=ie,k.avail_out=se,k.next_in=K,k.avail_in=G,S.hold=q,S.bits=U,l(k,ae),ie=k.next_out,ne=k.output,se=k.avail_out,K=k.next_in,B=k.input,G=k.avail_in,q=S.hold,U=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;be=(O=S.lencode[q&(1<<S.lenbits)-1])>>>16&255,we=65535&O,!((de=O>>>24)<=U);){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(be&&(240&be)==0){for(Ae=de,V=be,X=we;be=(O=S.lencode[X+((q&(1<<Ae+V)-1)>>Ae)])>>>16&255,we=65535&O,!(Ae+(de=O>>>24)<=U);){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}q>>>=Ae,U-=Ae,S.back+=Ae}if(q>>>=de,U-=de,S.back+=de,S.length=we,be===0){S.mode=26;break}if(32&be){S.back=-1,S.mode=12;break}if(64&be){k.msg="invalid literal/length code",S.mode=30;break}S.extra=15&be,S.mode=22;case 22:if(S.extra){for(F=S.extra;U<F;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}S.length+=q&(1<<S.extra)-1,q>>>=S.extra,U-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;be=(O=S.distcode[q&(1<<S.distbits)-1])>>>16&255,we=65535&O,!((de=O>>>24)<=U);){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if((240&be)==0){for(Ae=de,V=be,X=we;be=(O=S.distcode[X+((q&(1<<Ae+V)-1)>>Ae)])>>>16&255,we=65535&O,!(Ae+(de=O>>>24)<=U);){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}q>>>=Ae,U-=Ae,S.back+=Ae}if(q>>>=de,U-=de,S.back+=de,64&be){k.msg="invalid distance code",S.mode=30;break}S.offset=we,S.extra=15&be,S.mode=24;case 24:if(S.extra){for(F=S.extra;U<F;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}S.offset+=q&(1<<S.extra)-1,q>>>=S.extra,U-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){k.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(se===0)break e;if(J=ae-se,S.offset>J){if((J=S.offset-J)>S.whave&&S.sane){k.msg="invalid distance too far back",S.mode=30;break}te=J>S.wnext?(J-=S.wnext,S.wsize-J):S.wnext-J,J>S.length&&(J=S.length),me=S.window}else me=ne,te=ie-S.offset,J=S.length;for(se<J&&(J=se),se-=J,S.length-=J;ne[ie++]=me[te++],--J;);S.length===0&&(S.mode=21);break;case 26:if(se===0)break e;ne[ie++]=S.length,se--,S.mode=21;break;case 27:if(S.wrap){for(;U<32;){if(G===0)break e;G--,q|=B[K++]<<U,U+=8}if(ae-=se,k.total_out+=ae,S.total+=ae,ae&&(k.adler=S.check=S.flags?a(S.check,ne,ae,ie-ae):o(S.check,ne,ae,ie-ae)),ae=se,(S.flags?q:y(q))!==S.check){k.msg="incorrect data check",S.mode=30;break}U=q=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;U<32;){if(G===0)break e;G--,q+=B[K++]<<U,U+=8}if(q!==(4294967295&S.total)){k.msg="incorrect length check",S.mode=30;break}U=q=0}S.mode=29;case 29:ee=1;break e;case 30:ee=-3;break e;case 31:return-4;case 32:default:return p}return k.next_out=ie,k.avail_out=se,k.next_in=K,k.avail_in=G,S.hold=q,S.bits=U,(S.wsize||ae!==k.avail_out&&S.mode<30&&(S.mode<27||z!==4))&&W(k,k.output,k.next_out,ae-k.avail_out)?(S.mode=31,-4):(le-=k.avail_in,ae-=k.avail_out,k.total_in+=le,k.total_out+=ae,S.total+=ae,S.wrap&&ae&&(k.adler=S.check=S.flags?a(S.check,ne,ae,k.next_out-ae):o(S.check,ne,ae,k.next_out-ae)),k.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(le==0&&ae===0||z===4)&&ee===f&&(ee=-5),ee)},s.inflateEnd=function(k){if(!k||!k.state)return p;var z=k.state;return z.window&&(z.window=null),k.state=null,f},s.inflateGetHeader=function(k,z){var S;return k&&k.state?(2&(S=k.state).wrap)==0?p:((S.head=z).done=!1,f):p},s.inflateSetDictionary=function(k,z){var S,B=z.length;return k&&k.state?(S=k.state).wrap!==0&&S.mode!==11?p:S.mode===11&&o(1,z,B,0)!==S.check?-3:W(k,z,B,B)?(S.mode=31,-4):(S.havedict=1,f):p},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,n,s){var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(u,d,f,p,g,m,v,y){var b,_,x,w,T,P,M,R,L,W=y.bits,k=0,z=0,S=0,B=0,ne=0,K=0,ie=0,G=0,se=0,q=0,U=null,le=0,ae=new r.Buf16(16),J=new r.Buf16(16),te=null,me=0;for(k=0;k<=15;k++)ae[k]=0;for(z=0;z<p;z++)ae[d[f+z]]++;for(ne=W,B=15;1<=B&&ae[B]===0;B--);if(B<ne&&(ne=B),B===0)return g[m++]=20971520,g[m++]=20971520,y.bits=1,0;for(S=1;S<B&&ae[S]===0;S++);for(ne<S&&(ne=S),k=G=1;k<=15;k++)if(G<<=1,(G-=ae[k])<0)return-1;if(0<G&&(u===0||B!==1))return-1;for(J[1]=0,k=1;k<15;k++)J[k+1]=J[k]+ae[k];for(z=0;z<p;z++)d[f+z]!==0&&(v[J[d[f+z]]++]=z);if(P=u===0?(U=te=v,19):u===1?(U=o,le-=257,te=a,me-=257,256):(U=l,te=c,-1),k=S,T=m,ie=z=q=0,x=-1,w=(se=1<<(K=ne))-1,u===1&&852<se||u===2&&592<se)return 1;for(;;){for(M=k-ie,L=v[z]<P?(R=0,v[z]):v[z]>P?(R=te[me+v[z]],U[le+v[z]]):(R=96,0),b=1<<k-ie,S=_=1<<K;g[T+(q>>ie)+(_-=b)]=M<<24|R<<16|L|0,_!==0;);for(b=1<<k-1;q&b;)b>>=1;if(b!==0?(q&=b-1,q+=b):q=0,z++,--ae[k]==0){if(k===B)break;k=d[f+v[z]]}if(ne<k&&(q&w)!==x){for(ie===0&&(ie=ne),T+=S,G=1<<(K=k-ie);K+ie<B&&!((G-=ae[K+ie])<=0);)K++,G<<=1;if(se+=1<<K,u===1&&852<se||u===2&&592<se)return 1;g[x=q&w]=ne<<24|K<<16|T-m|0}}return q!==0&&(g[T+q]=k-ie<<24|64<<16|0),y.bits=ne,0}},{"../utils/common":41}],51:[function(t,n,s){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,n,s){var r=t("../utils/common"),o=0,a=1;function l(O){for(var j=O.length;0<=--j;)O[j]=0}h(l,"n");var c=0,u=29,d=256,f=d+1+u,p=30,g=19,m=2*f+1,v=15,y=16,b=7,_=256,x=16,w=17,T=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=new Array(2*(f+2));l(W);var k=new Array(2*p);l(k);var z=new Array(512);l(z);var S=new Array(256);l(S);var B=new Array(u);l(B);var ne,K,ie,G=new Array(p);function se(O,j,N,$,I){this.static_tree=O,this.extra_bits=j,this.extra_base=N,this.elems=$,this.max_length=I,this.has_stree=O&&O.length}h(se,"D");function q(O,j){this.dyn_tree=O,this.max_code=0,this.stat_desc=j}h(q,"F");function U(O){return O<256?z[O]:z[256+(O>>>7)]}h(U,"N");function le(O,j){O.pending_buf[O.pending++]=255&j,O.pending_buf[O.pending++]=j>>>8&255}h(le,"U");function ae(O,j,N){O.bi_valid>y-N?(O.bi_buf|=j<<O.bi_valid&65535,le(O,O.bi_buf),O.bi_buf=j>>y-O.bi_valid,O.bi_valid+=N-y):(O.bi_buf|=j<<O.bi_valid&65535,O.bi_valid+=N)}h(ae,"P");function J(O,j,N){ae(O,N[2*j],N[2*j+1])}h(J,"L");function te(O,j){for(var N=0;N|=1&O,O>>>=1,N<<=1,0<--j;);return N>>>1}h(te,"j");function me(O,j,N){var $,I,D=new Array(v+1),H=0;for($=1;$<=v;$++)D[$]=H=H+N[$-1]<<1;for(I=0;I<=j;I++){var Z=O[2*I+1];Z!==0&&(O[2*I]=te(D[Z]++,Z))}}h(me,"Z");function de(O){var j;for(j=0;j<f;j++)O.dyn_ltree[2*j]=0;for(j=0;j<p;j++)O.dyn_dtree[2*j]=0;for(j=0;j<g;j++)O.bl_tree[2*j]=0;O.dyn_ltree[2*_]=1,O.opt_len=O.static_len=0,O.last_lit=O.matches=0}h(de,"W");function be(O){8<O.bi_valid?le(O,O.bi_buf):0<O.bi_valid&&(O.pending_buf[O.pending++]=O.bi_buf),O.bi_buf=0,O.bi_valid=0}h(be,"M");function we(O,j,N,$){var I=2*j,D=2*N;return O[I]<O[D]||O[I]===O[D]&&$[j]<=$[N]}h(we,"H");function Ae(O,j,N){for(var $=O.heap[N],I=N<<1;I<=O.heap_len&&(I<O.heap_len&&we(j,O.heap[I+1],O.heap[I],O.depth)&&I++,!we(j,$,O.heap[I],O.depth));)O.heap[N]=O.heap[I],N=I,I<<=1;O.heap[N]=$}h(Ae,"G");function V(O,j,N){var $,I,D,H,Z=0;if(O.last_lit!==0)for(;$=O.pending_buf[O.d_buf+2*Z]<<8|O.pending_buf[O.d_buf+2*Z+1],I=O.pending_buf[O.l_buf+Z],Z++,$===0?J(O,I,j):(J(O,(D=S[I])+d+1,j),(H=P[D])!==0&&ae(O,I-=B[D],H),J(O,D=U(--$),N),(H=M[D])!==0&&ae(O,$-=G[D],H)),Z<O.last_lit;);J(O,_,j)}h(V,"K");function X(O,j){var N,$,I,D=j.dyn_tree,H=j.stat_desc.static_tree,Z=j.stat_desc.has_stree,re=j.stat_desc.elems,ue=-1;for(O.heap_len=0,O.heap_max=m,N=0;N<re;N++)D[2*N]!==0?(O.heap[++O.heap_len]=ue=N,O.depth[N]=0):D[2*N+1]=0;for(;O.heap_len<2;)D[2*(I=O.heap[++O.heap_len]=ue<2?++ue:0)]=1,O.depth[I]=0,O.opt_len--,Z&&(O.static_len-=H[2*I+1]);for(j.max_code=ue,N=O.heap_len>>1;1<=N;N--)Ae(O,D,N);for(I=re;N=O.heap[1],O.heap[1]=O.heap[O.heap_len--],Ae(O,D,1),$=O.heap[1],O.heap[--O.heap_max]=N,O.heap[--O.heap_max]=$,D[2*I]=D[2*N]+D[2*$],O.depth[I]=(O.depth[N]>=O.depth[$]?O.depth[N]:O.depth[$])+1,D[2*N+1]=D[2*$+1]=I,O.heap[1]=I++,Ae(O,D,1),2<=O.heap_len;);O.heap[--O.heap_max]=O.heap[1],function(ge,xe){var pe,Oe,Ge,Ie,We,Ne,Xe=xe.dyn_tree,St=xe.max_code,wn=xe.stat_desc.static_tree,oe=xe.stat_desc.has_stree,ye=xe.stat_desc.extra_bits,Ee=xe.stat_desc.extra_base,Le=xe.stat_desc.max_length,Ve=0;for(Ie=0;Ie<=v;Ie++)ge.bl_count[Ie]=0;for(Xe[2*ge.heap[ge.heap_max]+1]=0,pe=ge.heap_max+1;pe<m;pe++)Le<(Ie=Xe[2*Xe[2*(Oe=ge.heap[pe])+1]+1]+1)&&(Ie=Le,Ve++),Xe[2*Oe+1]=Ie,St<Oe||(ge.bl_count[Ie]++,We=0,Ee<=Oe&&(We=ye[Oe-Ee]),Ne=Xe[2*Oe],ge.opt_len+=Ne*(Ie+We),oe&&(ge.static_len+=Ne*(wn[2*Oe+1]+We)));if(Ve!==0){do{for(Ie=Le-1;ge.bl_count[Ie]===0;)Ie--;ge.bl_count[Ie]--,ge.bl_count[Ie+1]+=2,ge.bl_count[Le]--,Ve-=2}while(0<Ve);for(Ie=Le;Ie!==0;Ie--)for(Oe=ge.bl_count[Ie];Oe!==0;)St<(Ge=ge.heap[--pe])||(Xe[2*Ge+1]!==Ie&&(ge.opt_len+=(Ie-Xe[2*Ge+1])*Xe[2*Ge],Xe[2*Ge+1]=Ie),Oe--)}}(O,j),me(D,ue,O.bl_count)}h(X,"Y");function E(O,j,N){var $,I,D=-1,H=j[1],Z=0,re=7,ue=4;for(H===0&&(re=138,ue=3),j[2*(N+1)+1]=65535,$=0;$<=N;$++)I=H,H=j[2*($+1)+1],++Z<re&&I===H||(Z<ue?O.bl_tree[2*I]+=Z:I!==0?(I!==D&&O.bl_tree[2*I]++,O.bl_tree[2*x]++):Z<=10?O.bl_tree[2*w]++:O.bl_tree[2*T]++,D=I,ue=(Z=0)===H?(re=138,3):I===H?(re=6,3):(re=7,4))}h(E,"X");function ee(O,j,N){var $,I,D=-1,H=j[1],Z=0,re=7,ue=4;for(H===0&&(re=138,ue=3),$=0;$<=N;$++)if(I=H,H=j[2*($+1)+1],!(++Z<re&&I===H)){if(Z<ue)for(;J(O,I,O.bl_tree),--Z!=0;);else I!==0?(I!==D&&(J(O,I,O.bl_tree),Z--),J(O,x,O.bl_tree),ae(O,Z-3,2)):Z<=10?(J(O,w,O.bl_tree),ae(O,Z-3,3)):(J(O,T,O.bl_tree),ae(O,Z-11,7));D=I,ue=(Z=0)===H?(re=138,3):I===H?(re=6,3):(re=7,4)}}h(ee,"V"),l(G);var Q=!1;function F(O,j,N,$){ae(O,(c<<1)+($?1:0),3),function(I,D,H,Z){be(I),Z&&(le(I,H),le(I,~H)),r.arraySet(I.pending_buf,I.window,D,H,I.pending),I.pending+=H}(O,j,N,!0)}h(F,"J"),s._tr_init=function(O){Q||(function(){var j,N,$,I,D,H=new Array(v+1);for(I=$=0;I<u-1;I++)for(B[I]=$,j=0;j<1<<P[I];j++)S[$++]=I;for(S[$-1]=I,I=D=0;I<16;I++)for(G[I]=D,j=0;j<1<<M[I];j++)z[D++]=I;for(D>>=7;I<p;I++)for(G[I]=D<<7,j=0;j<1<<M[I]-7;j++)z[256+D++]=I;for(N=0;N<=v;N++)H[N]=0;for(j=0;j<=143;)W[2*j+1]=8,j++,H[8]++;for(;j<=255;)W[2*j+1]=9,j++,H[9]++;for(;j<=279;)W[2*j+1]=7,j++,H[7]++;for(;j<=287;)W[2*j+1]=8,j++,H[8]++;for(me(W,f+1,H),j=0;j<p;j++)k[2*j+1]=5,k[2*j]=te(j,5);ne=new se(W,P,d+1,f,v),K=new se(k,M,0,p,v),ie=new se(new Array(0),R,0,g,b)}(),Q=!0),O.l_desc=new q(O.dyn_ltree,ne),O.d_desc=new q(O.dyn_dtree,K),O.bl_desc=new q(O.bl_tree,ie),O.bi_buf=0,O.bi_valid=0,de(O)},s._tr_stored_block=F,s._tr_flush_block=function(O,j,N,$){var I,D,H=0;0<O.level?(O.strm.data_type===2&&(O.strm.data_type=function(Z){var re,ue=4093624447;for(re=0;re<=31;re++,ue>>>=1)if(1&ue&&Z.dyn_ltree[2*re]!==0)return o;if(Z.dyn_ltree[18]!==0||Z.dyn_ltree[20]!==0||Z.dyn_ltree[26]!==0)return a;for(re=32;re<d;re++)if(Z.dyn_ltree[2*re]!==0)return a;return o}(O)),X(O,O.l_desc),X(O,O.d_desc),H=function(Z){var re;for(E(Z,Z.dyn_ltree,Z.l_desc.max_code),E(Z,Z.dyn_dtree,Z.d_desc.max_code),X(Z,Z.bl_desc),re=g-1;3<=re&&Z.bl_tree[2*L[re]+1]===0;re--);return Z.opt_len+=3*(re+1)+5+5+4,re}(O),I=O.opt_len+3+7>>>3,(D=O.static_len+3+7>>>3)<=I&&(I=D)):I=D=N+5,N+4<=I&&j!==-1?F(O,j,N,$):O.strategy===4||D===I?(ae(O,2+($?1:0),3),V(O,W,k)):(ae(O,4+($?1:0),3),function(Z,re,ue,ge){var xe;for(ae(Z,re-257,5),ae(Z,ue-1,5),ae(Z,ge-4,4),xe=0;xe<ge;xe++)ae(Z,Z.bl_tree[2*L[xe]+1],3);ee(Z,Z.dyn_ltree,re-1),ee(Z,Z.dyn_dtree,ue-1)}(O,O.l_desc.max_code+1,O.d_desc.max_code+1,H+1),V(O,O.dyn_ltree,O.dyn_dtree)),de(O),$&&be(O)},s._tr_tally=function(O,j,N){return O.pending_buf[O.d_buf+2*O.last_lit]=j>>>8&255,O.pending_buf[O.d_buf+2*O.last_lit+1]=255&j,O.pending_buf[O.l_buf+O.last_lit]=255&N,O.last_lit++,j===0?O.dyn_ltree[2*N]++:(O.matches++,j--,O.dyn_ltree[2*(S[N]+d+1)]++,O.dyn_dtree[2*U(j)]++),O.last_lit===O.lit_bufsize-1},s._tr_align=function(O){ae(O,2,3),J(O,_,W),function(j){j.bi_valid===16?(le(j,j.bi_buf),j.bi_buf=0,j.bi_valid=0):8<=j.bi_valid&&(j.pending_buf[j.pending++]=255&j.bi_buf,j.bi_buf>>=8,j.bi_valid-=8)}(O)}},{"../utils/common":41}],53:[function(t,n,s){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,n,s){(function(r){(function(o,a){if(!o.setImmediate){var l,c,u,d,f=1,p={},g=!1,m=o.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(o);v=v&&v.setTimeout?v:o,l={}.toString.call(o.process)==="[object process]"?function(x){process.nextTick(function(){b(x)})}:function(){if(o.postMessage&&!o.importScripts){var x=!0,w=o.onmessage;return o.onmessage=function(){x=!1},o.postMessage("","*"),o.onmessage=w,x}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",_,!1):o.attachEvent("onmessage",_),function(x){o.postMessage(d+x,"*")}):o.MessageChannel?((u=new MessageChannel).port1.onmessage=function(x){b(x.data)},function(x){u.port2.postMessage(x)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(x){var w=m.createElement("script");w.onreadystatechange=function(){b(x),w.onreadystatechange=null,c.removeChild(w),w=null},c.appendChild(w)}):function(x){setTimeout(b,0,x)},v.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var w=new Array(arguments.length-1),T=0;T<w.length;T++)w[T]=arguments[T+1];var P={callback:x,args:w};return p[f]=P,l(f),f++},v.clearImmediate=y}function y(x){delete p[x]}h(y,"f");function b(x){if(g)setTimeout(b,0,x);else{var w=p[x];if(w){g=!0;try{(function(T){var P=T.callback,M=T.args;switch(M.length){case 0:P();break;case 1:P(M[0]);break;case 2:P(M[0],M[1]);break;case 3:P(M[0],M[1],M[2]);break;default:P.apply(a,M)}})(w)}finally{y(x),g=!1}}}}h(b,"c");function _(x){x.source===o&&typeof x.data=="string"&&x.data.indexOf(d)===0&&b(+x.data.slice(d.length))}h(_,"d")})(typeof self=="undefined"?r===void 0?this:r:self)}).call(this,typeof pd!="undefined"?pd:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(c2);var LU=c2.exports;/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var Jb={},n0=h(function(i){return URL.createObjectURL(new Blob([i],{type:"text/javascript"}))},"durl"),u2=h(function(i){return new Worker(i)},"cwk");try{URL.revokeObjectURL(n0(""))}catch{n0=h(function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},"durl"),u2=h(function(e){return new Worker(e,{type:"module"})},"cwk")}var kU=h(function(i,e,t,n,s){var r=u2(Jb[e]||(Jb[e]=n0(i)));return r.onerror=function(o){return s(o.error,null)},r.onmessage=function(o){return s(null,o.data)},r.postMessage(t,n),r},"wk"),_t=Uint8Array,Bn=Uint16Array,Cr=Uint32Array,nc=new _t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ic=new _t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Zu=new _t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h2=h(function(i,e){for(var t=new Bn(31),n=0;n<31;++n)t[n]=e+=1<<i[n-1];for(var s=new Cr(t[30]),n=1;n<30;++n)for(var r=t[n];r<t[n+1];++r)s[r]=r-t[n]<<5|n;return[t,s]},"freb"),d2=h2(nc,2),j1=d2[0],zf=d2[1];j1[28]=258,zf[258]=28;var f2=h2(ic,0),p2=f2[0],i0=f2[1],Qu=new Bn(32768);for(var Wt=0;Wt<32768;++Wt){var Wr=(Wt&43690)>>>1|(Wt&21845)<<1;Wr=(Wr&52428)>>>2|(Wr&13107)<<2,Wr=(Wr&61680)>>>4|(Wr&3855)<<4,Qu[Wt]=((Wr&65280)>>>8|(Wr&255)<<8)>>>1}var es=h(function(i,e,t){for(var n=i.length,s=0,r=new Bn(e);s<n;++s)++r[i[s]-1];var o=new Bn(e);for(s=0;s<e;++s)o[s]=o[s-1]+r[s-1]<<1;var a;if(t){a=new Bn(1<<e);var l=15-e;for(s=0;s<n;++s)if(i[s])for(var c=s<<4|i[s],u=e-i[s],d=o[i[s]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)a[Qu[d]>>>l]=c}else for(a=new Bn(n),s=0;s<n;++s)i[s]&&(a[s]=Qu[o[i[s]-1]++]>>>15-i[s]);return a},"hMap"),Tr=new _t(288);for(var Wt=0;Wt<144;++Wt)Tr[Wt]=8;for(var Wt=144;Wt<256;++Wt)Tr[Wt]=9;for(var Wt=256;Wt<280;++Wt)Tr[Wt]=7;for(var Wt=280;Wt<288;++Wt)Tr[Wt]=8;var jl=new _t(32);for(var Wt=0;Wt<32;++Wt)jl[Wt]=5;var m2=es(Tr,9,0),g2=es(Tr,9,1),v2=es(jl,5,0),y2=es(jl,5,1),gf=h(function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},"max"),Ki=h(function(i,e,t){var n=e/8|0;return(i[n]|i[n+1]<<8)>>(e&7)&t},"bits"),vf=h(function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},"bits16"),ph=h(function(i){return(i/8|0)+(i&7&&1)},"shft"),ts=h(function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var n=new(i instanceof Bn?Bn:i instanceof Cr?Cr:_t)(t-e);return n.set(i.subarray(e,t)),n},"slc"),mh=h(function(i,e,t){var n=i.length;if(!n||t&&!t.l&&n<5)return e||new _t(0);var s=!e||t,r=!t||t.i;t||(t={}),e||(e=new _t(n*3));var o=h(function(te){var me=e.length;if(te>me){var de=new _t(Math.max(me*2,te));de.set(e),e=de}},"cbuf"),a=t.f||0,l=t.p||0,c=t.b||0,u=t.l,d=t.d,f=t.m,p=t.n,g=n*8;do{if(!u){t.f=a=Ki(i,l,1);var m=Ki(i,l+1,3);if(l+=3,m)if(m==1)u=g2,d=y2,f=9,p=5;else if(m==2){var _=Ki(i,l,31)+257,x=Ki(i,l+10,15)+4,w=_+Ki(i,l+5,31)+1;l+=14;for(var T=new _t(w),P=new _t(19),M=0;M<x;++M)P[Zu[M]]=Ki(i,l+M*3,7);l+=x*3;for(var R=gf(P),L=(1<<R)-1,W=es(P,R,1),M=0;M<w;){var k=W[Ki(i,l,L)];l+=k&15;var v=k>>>4;if(v<16)T[M++]=v;else{var z=0,S=0;for(v==16?(S=3+Ki(i,l,3),l+=2,z=T[M-1]):v==17?(S=3+Ki(i,l,7),l+=3):v==18&&(S=11+Ki(i,l,127),l+=7);S--;)T[M++]=z}}var B=T.subarray(0,_),ne=T.subarray(_);f=gf(B),p=gf(ne),u=es(B,f,1),d=es(ne,p,1)}else throw"invalid block type";else{var v=ph(l)+4,y=i[v-4]|i[v-3]<<8,b=v+y;if(b>n){if(r)throw"unexpected EOF";break}s&&o(c+y),e.set(i.subarray(v,b),c),t.b=c+=y,t.p=l=b*8;continue}if(l>g){if(r)throw"unexpected EOF";break}}s&&o(c+131072);for(var K=(1<<f)-1,ie=(1<<p)-1,G=l;;G=l){var z=u[vf(i,l)&K],se=z>>>4;if(l+=z&15,l>g){if(r)throw"unexpected EOF";break}if(!z)throw"invalid length/literal";if(se<256)e[c++]=se;else if(se==256){G=l,u=null;break}else{var q=se-254;if(se>264){var M=se-257,U=nc[M];q=Ki(i,l,(1<<U)-1)+j1[M],l+=U}var le=d[vf(i,l)&ie],ae=le>>>4;if(!le)throw"invalid distance";l+=le&15;var ne=p2[ae];if(ae>3){var U=ic[ae];ne+=vf(i,l)&(1<<U)-1,l+=U}if(l>g){if(r)throw"unexpected EOF";break}s&&o(c+131072);for(var J=c+q;c<J;c+=4)e[c]=e[c-ne],e[c+1]=e[c+1-ne],e[c+2]=e[c+2-ne],e[c+3]=e[c+3-ne];c=J}}t.l=u,t.p=G,t.b=c,u&&(a=1,t.m=f,t.d=d,t.n=p)}while(!a);return c==e.length?e:ts(e,0,c)},"inflt"),Ps=h(function(i,e,t){t<<=e&7;var n=e/8|0;i[n]|=t,i[n+1]|=t>>>8},"wbits"),fl=h(function(i,e,t){t<<=e&7;var n=e/8|0;i[n]|=t,i[n+1]|=t>>>8,i[n+2]|=t>>>16},"wbits16"),yf=h(function(i,e){for(var t=[],n=0;n<i.length;++n)i[n]&&t.push({s:n,f:i[n]});var s=t.length,r=t.slice();if(!s)return[gr,0];if(s==1){var o=new _t(t[0].s+1);return o[t[0].s]=1,[o,1]}t.sort(function(w,T){return w.f-T.f}),t.push({s:-1,f:25001});var a=t[0],l=t[1],c=0,u=1,d=2;for(t[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=s-1;)a=t[t[c].f<t[d].f?c++:d++],l=t[c!=u&&t[c].f<t[d].f?c++:d++],t[u++]={s:-1,f:a.f+l.f,l:a,r:l};for(var f=r[0].s,n=1;n<s;++n)r[n].s>f&&(f=r[n].s);var p=new Bn(f+1),g=Bf(t[u-1],p,0);if(g>e){var n=0,m=0,v=g-e,y=1<<v;for(r.sort(function(T,P){return p[P.s]-p[T.s]||T.f-P.f});n<s;++n){var b=r[n].s;if(p[b]>e)m+=y-(1<<g-p[b]),p[b]=e;else break}for(m>>>=v;m>0;){var _=r[n].s;p[_]<e?m-=1<<e-p[_]++-1:++n}for(;n>=0&&m;--n){var x=r[n].s;p[x]==e&&(--p[x],++m)}g=e}return[new _t(p),g]},"hTree"),Bf=h(function(i,e,t){return i.s==-1?Math.max(Bf(i.l,e,t+1),Bf(i.r,e,t+1)):e[i.s]=t},"ln"),s0=h(function(i){for(var e=i.length;e&&!i[--e];);for(var t=new Bn(++e),n=0,s=i[0],r=1,o=h(function(l){t[n++]=l},"w"),a=1;a<=e;++a)if(i[a]==s&&a!=e)++r;else{if(!s&&r>2){for(;r>138;r-=138)o(32754);r>2&&(o(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(o(s),--r;r>6;r-=6)o(8304);r>2&&(o(r-3<<5|8208),r=0)}for(;r--;)o(s);r=1,s=i[a]}return[t.subarray(0,n),e]},"lc"),pl=h(function(i,e){for(var t=0,n=0;n<e.length;++n)t+=i[n]*e[n];return t},"clen"),Au=h(function(i,e,t){var n=t.length,s=ph(e+2);i[s]=n&255,i[s+1]=n>>>8,i[s+2]=i[s]^255,i[s+3]=i[s+1]^255;for(var r=0;r<n;++r)i[s+r+4]=t[r];return(s+4+n)*8},"wfblk"),r0=h(function(i,e,t,n,s,r,o,a,l,c,u){Ps(e,u++,t),++s[256];for(var d=yf(s,15),f=d[0],p=d[1],g=yf(r,15),m=g[0],v=g[1],y=s0(f),b=y[0],_=y[1],x=s0(m),w=x[0],T=x[1],P=new Bn(19),M=0;M<b.length;++M)P[b[M]&31]++;for(var M=0;M<w.length;++M)P[w[M]&31]++;for(var R=yf(P,7),L=R[0],W=R[1],k=19;k>4&&!L[Zu[k-1]];--k);var z=c+5<<3,S=pl(s,Tr)+pl(r,jl)+o,B=pl(s,f)+pl(r,m)+o+14+3*k+pl(P,L)+(2*P[16]+3*P[17]+7*P[18]);if(z<=S&&z<=B)return Au(e,u,i.subarray(l,l+c));var ne,K,ie,G;if(Ps(e,u,1+(B<S)),u+=2,B<S){ne=es(f,p,0),K=f,ie=es(m,v,0),G=m;var se=es(L,W,0);Ps(e,u,_-257),Ps(e,u+5,T-1),Ps(e,u+10,k-4),u+=14;for(var M=0;M<k;++M)Ps(e,u+3*M,L[Zu[M]]);u+=3*k;for(var q=[b,w],U=0;U<2;++U)for(var le=q[U],M=0;M<le.length;++M){var ae=le[M]&31;Ps(e,u,se[ae]),u+=L[ae],ae>15&&(Ps(e,u,le[M]>>>5&127),u+=le[M]>>>12)}}else ne=m2,K=Tr,ie=v2,G=jl;for(var M=0;M<a;++M)if(n[M]>255){var ae=n[M]>>>18&31;fl(e,u,ne[ae+257]),u+=K[ae+257],ae>7&&(Ps(e,u,n[M]>>>23&31),u+=nc[ae]);var J=n[M]&31;fl(e,u,ie[J]),u+=G[J],J>3&&(fl(e,u,n[M]>>>5&8191),u+=ic[J])}else fl(e,u,ne[n[M]]),u+=K[n[M]];return fl(e,u,ne[256]),u+K[256]},"wblk"),_2=new Cr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),gr=new _t(0),b2=h(function(i,e,t,n,s,r){var o=i.length,a=new _t(n+o+5*(1+Math.ceil(o/7e3))+s),l=a.subarray(n,a.length-s),c=0;if(!e||o<8)for(var u=0;u<=o;u+=65535){var d=u+65535;d<o?c=Au(l,c,i.subarray(u,d)):(l[u]=r,c=Au(l,c,i.subarray(u,o)))}else{for(var f=_2[e-1],p=f>>>13,g=f&8191,m=(1<<t)-1,v=new Bn(32768),y=new Bn(m+1),b=Math.ceil(t/3),_=2*b,x=h(function(E){return(i[E]^i[E+1]<<b^i[E+2]<<_)&m},"hsh"),w=new Cr(25e3),T=new Bn(288),P=new Bn(32),M=0,R=0,u=0,L=0,W=0,k=0;u<o;++u){var z=x(u),S=u&32767,B=y[z];if(v[S]=B,y[z]=S,W<=u){var ne=o-u;if((M>7e3||L>24576)&&ne>423){c=r0(i,l,0,w,T,P,R,L,k,u-k,c),L=M=R=0,k=u;for(var K=0;K<286;++K)T[K]=0;for(var K=0;K<30;++K)P[K]=0}var ie=2,G=0,se=g,q=S-B&32767;if(ne>2&&z==x(u-q))for(var U=Math.min(p,ne)-1,le=Math.min(32767,u),ae=Math.min(258,ne);q<=le&&--se&&S!=B;){if(i[u+ie]==i[u+ie-q]){for(var J=0;J<ae&&i[u+J]==i[u+J-q];++J);if(J>ie){if(ie=J,G=q,J>U)break;for(var te=Math.min(q,J-2),me=0,K=0;K<te;++K){var de=u-q+K+32768&32767,be=v[de],we=de-be+32768&32767;we>me&&(me=we,B=de)}}}S=B,B=v[S],q+=S-B+32768&32767}if(G){w[L++]=268435456|zf[ie]<<18|i0[G];var Ae=zf[ie]&31,V=i0[G]&31;R+=nc[Ae]+ic[V],++T[257+Ae],++P[V],W=u+ie,++M}else w[L++]=i[u],++T[i[u]]}}c=r0(i,l,r,w,T,P,R,L,k,u-k,c),!r&&c&7&&(c=Au(l,c+1,gr))}return ts(a,0,n+ph(c)+s)},"dflt"),w2=function(){for(var i=new Cr(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;i[e]=t}return i}(),sc=h(function(){var i=-1;return{p:function(e){for(var t=i,n=0;n<e.length;++n)t=w2[t&255^e[n]]^t>>>8;i=t},d:function(){return~i}}},"crc"),$1=h(function(){var i=1,e=0;return{p:function(t){for(var n=i,s=e,r=t.length,o=0;o!=r;){for(var a=Math.min(o+2655,r);o<a;++o)s+=n+=t[o];n=(n&65535)+15*(n>>16),s=(s&65535)+15*(s>>16)}i=n,e=s},d:function(){return i%=65521,e%=65521,(i&255)<<24|i>>>8<<16|(e&255)<<8|e>>>8}}},"adler"),Pa=h(function(i,e,t,n,s){return b2(i,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+e.mem,t,n,!s)},"dopt"),gh=h(function(i,e){var t={};for(var n in i)t[n]=i[n];for(var n in e)t[n]=e[n];return t},"mrg"),ew=h(function(i,e,t){for(var n=i(),s=i.toString(),r=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var a=n[o],l=r[o];if(typeof a=="function"){e+=";"+l+"=";var c=a.toString();if(a.prototype)if(c.indexOf("[native code]")!=-1){var u=c.indexOf(" ",8)+1;e+=c.slice(u,c.indexOf("(",u))}else{e+=c;for(var d in a.prototype)e+=";"+l+".prototype."+d+"="+a.prototype[d].toString()}else e+=c}else t[l]=a}return[e,t]},"wcln"),gd=[],OU=h(function(i){var e=[];for(var t in i)(i[t]instanceof _t||i[t]instanceof Bn||i[t]instanceof Cr)&&e.push((i[t]=new i[t].constructor(i[t])).buffer);return e},"cbfs"),x2=h(function(i,e,t,n){var s;if(!gd[t]){for(var r="",o={},a=i.length-1,l=0;l<a;++l)s=ew(i[l],r,o),r=s[0],o=s[1];gd[t]=ew(i[a],r,o)}var c=gh({},gd[t][1]);return kU(gd[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,OU(c),n)},"wrkr"),rc=h(function(){return[_t,Bn,Cr,nc,ic,Zu,j1,p2,g2,y2,Qu,es,gf,Ki,vf,ph,ts,mh,cc,xo,X1]},"bInflt"),oc=h(function(){return[_t,Bn,Cr,nc,ic,Zu,zf,i0,m2,Tr,v2,jl,Qu,_2,gr,es,Ps,fl,yf,Bf,s0,pl,Au,r0,ph,ts,b2,Pa,vh,xo]},"bDflt"),M2=h(function(){return[Y1,q1,Pt,sc,w2]},"gze"),A2=h(function(){return[K1,T2]},"guze"),S2=h(function(){return[Z1,Pt,$1]},"zle"),C2=h(function(){return[E2]},"zule"),xo=h(function(i){return postMessage(i,[i.buffer])},"pbf"),X1=h(function(i){return i&&i.size&&new _t(i.size)},"gu8"),ac=h(function(i,e,t,n,s,r){var o=x2(t,n,s,function(a,l){o.terminate(),r(a,l)});return o.postMessage([i,e],e.consume?[i.buffer]:[]),function(){o.terminate()}},"cbify"),ns=h(function(i){return i.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return i.push(e.data[0],e.data[1])}},"astrm"),lc=h(function(i,e,t,n,s){var r,o=x2(i,n,s,function(a,l){a?(o.terminate(),e.ondata.call(e,a)):(l[1]&&o.terminate(),e.ondata.call(e,a,l[0],l[1]))});o.postMessage(t),e.push=function(a,l){if(r)throw"stream finished";if(!e.ondata)throw"no stream handler";o.postMessage([a,r=l],[a.buffer])},e.terminate=function(){o.terminate()}},"astrmify"),ci=h(function(i,e){return i[e]|i[e+1]<<8},"b2"),yn=h(function(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16|i[e+3]<<24)>>>0},"b4"),Bm=h(function(i,e){return yn(i,e)+yn(i,e+4)*4294967296},"b8"),Pt=h(function(i,e,t){for(;t;++e)i[e]=t,t>>>=8},"wbytes"),Y1=h(function(i,e){var t=e.filename;if(i[0]=31,i[1]=139,i[2]=8,i[8]=e.level<2?4:e.level==9?2:0,i[9]=3,e.mtime!=0&&Pt(i,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){i[3]=8;for(var n=0;n<=t.length;++n)i[n+10]=t.charCodeAt(n)}},"gzh"),K1=h(function(i){if(i[0]!=31||i[1]!=139||i[2]!=8)throw"invalid gzip data";var e=i[3],t=10;e&4&&(t+=i[10]|(i[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!i[t++]);return t+(e&2)},"gzs"),T2=h(function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},"gzl"),q1=h(function(i){return 10+(i.filename&&i.filename.length+1||0)},"gzhl"),Z1=h(function(i,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;i[0]=120,i[1]=n<<6|(n?32-2*n:1)},"zlh"),E2=h(function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"},"zlv");function Q1(i,e){return!e&&typeof i=="function"&&(e=i,i={}),this.ondata=e,i}h(Q1,"AsyncCmpStrm");var js=function(){function i(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return h(i,"Deflate"),i.prototype.p=function(e,t){this.ondata(Pa(e,this.o,0,0,!t),t)},i.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},i}(),P2=function(){function i(e,t){lc([oc,function(){return[ns,js]}],this,Q1.call(this,e,t),function(n){var s=new js(n.data);onmessage=ns(s)},6)}return h(i,"AsyncDeflate"),i}();function R2(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ac(i,e,[oc],function(n){return xo(vh(n.data[0],n.data[1]))},0,t)}h(R2,"deflate");function vh(i,e){return Pa(i,e||{},0,0)}h(vh,"deflateSync");var Ei=function(){function i(e){this.s={},this.p=new _t(0),this.ondata=e}return h(i,"Inflate"),i.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new _t(t+e.length);n.set(this.p),n.set(e,t),this.p=n},i.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=mh(this.p,this.o,this.s);this.ondata(ts(n,t,this.s.b),this.d),this.o=ts(n,this.s.b-32768),this.s.b=this.o.length,this.p=ts(this.p,this.s.p/8|0),this.s.p&=7},i.prototype.push=function(e,t){this.e(e),this.c(t)},i}(),J1=function(){function i(e){this.ondata=e,lc([rc,function(){return[ns,Ei]}],this,0,function(){var t=new Ei;onmessage=ns(t)},7)}return h(i,"AsyncInflate"),i}();function ev(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ac(i,e,[rc],function(n){return xo(cc(n.data[0],X1(n.data[1])))},1,t)}h(ev,"inflate");function cc(i,e){return mh(i,e)}h(cc,"inflateSync");var Uf=function(){function i(e,t){this.c=sc(),this.l=0,this.v=1,js.call(this,e,t)}return h(i,"Gzip"),i.prototype.push=function(e,t){js.prototype.push.call(this,e,t)},i.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=Pa(e,this.o,this.v&&q1(this.o),t&&8,!t);this.v&&(Y1(n,this.o),this.v=0),t&&(Pt(n,n.length-8,this.c.d()),Pt(n,n.length-4,this.l)),this.ondata(n,t)},i}(),tw=function(){function i(e,t){lc([oc,M2,function(){return[ns,js,Uf]}],this,Q1.call(this,e,t),function(n){var s=new Uf(n.data);onmessage=ns(s)},8)}return h(i,"AsyncGzip"),i}();function nw(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ac(i,e,[oc,M2,function(){return[Vf]}],function(n){return xo(Vf(n.data[0],n.data[1]))},2,t)}h(nw,"gzip");function Vf(i,e){e||(e={});var t=sc(),n=i.length;t.p(i);var s=Pa(i,e,q1(e),8),r=s.length;return Y1(s,e),Pt(s,r-8,t.d()),Pt(s,r-4,n),s}h(Vf,"gzipSync");var Hf=function(){function i(e){this.v=1,Ei.call(this,e)}return h(i,"Gunzip"),i.prototype.push=function(e,t){if(Ei.prototype.e.call(this,e),this.v){var n=this.p.length>3?K1(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ei.prototype.c.call(this,t)},i}(),I2=function(){function i(e){this.ondata=e,lc([rc,A2,function(){return[ns,Ei,Hf]}],this,0,function(){var t=new Hf;onmessage=ns(t)},9)}return h(i,"AsyncGunzip"),i}();function D2(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ac(i,e,[rc,A2,function(){return[Gf]}],function(n){return xo(Gf(n.data[0]))},3,t)}h(D2,"gunzip");function Gf(i,e){return mh(i.subarray(K1(i),-8),e||new _t(T2(i)))}h(Gf,"gunzipSync");var o0=function(){function i(e,t){this.c=$1(),this.v=1,js.call(this,e,t)}return h(i,"Zlib"),i.prototype.push=function(e,t){js.prototype.push.call(this,e,t)},i.prototype.p=function(e,t){this.c.p(e);var n=Pa(e,this.o,this.v&&2,t&&4,!t);this.v&&(Z1(n,this.o),this.v=0),t&&Pt(n,n.length-4,this.c.d()),this.ondata(n,t)},i}(),NU=function(){function i(e,t){lc([oc,S2,function(){return[ns,js,o0]}],this,Q1.call(this,e,t),function(n){var s=new o0(n.data);onmessage=ns(s)},10)}return h(i,"AsyncZlib"),i}();function FU(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ac(i,e,[oc,S2,function(){return[a0]}],function(n){return xo(a0(n.data[0],n.data[1]))},4,t)}h(FU,"zlib");function a0(i,e){e||(e={});var t=$1();t.p(i);var n=Pa(i,e,2,4);return Z1(n,e),Pt(n,n.length-4,t.d()),n}h(a0,"zlibSync");var Wf=function(){function i(e){this.v=1,Ei.call(this,e)}return h(i,"Unzlib"),i.prototype.push=function(e,t){if(Ei.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ei.prototype.c.call(this,t)},i}(),L2=function(){function i(e){this.ondata=e,lc([rc,C2,function(){return[ns,Ei,Wf]}],this,0,function(){var t=new Wf;onmessage=ns(t)},11)}return h(i,"AsyncUnzlib"),i}();function k2(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return ac(i,e,[rc,C2,function(){return[Ju]}],function(n){return xo(Ju(n.data[0],X1(n.data[1])))},5,t)}h(k2,"unzlib");function Ju(i,e){return mh((E2(i),i.subarray(2,-4)),e)}h(Ju,"unzlibSync");var O2=function(){function i(e){this.G=Hf,this.I=Ei,this.Z=Wf,this.ondata=e}return h(i,"Decompress"),i.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new _t(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var s=this,r=h(function(){s.ondata.apply(s,arguments)},"cb");this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(r):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(r):new this.Z(r),this.s.push(this.p,t),this.p=null}}},i}(),zU=function(){function i(e){this.G=I2,this.I=J1,this.Z=L2,this.ondata=e}return h(i,"AsyncDecompress"),i.prototype.push=function(e,t){O2.prototype.push.call(this,e,t)},i}();function BU(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return i[0]==31&&i[1]==139&&i[2]==8?D2(i,e,t):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?ev(i,e,t):k2(i,e,t)}h(BU,"decompress");function UU(i,e){return i[0]==31&&i[1]==139&&i[2]==8?Gf(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?cc(i,e):Ju(i,e)}h(UU,"decompressSync");var tv=h(function(i,e,t,n){for(var s in i){var r=i[s],o=e+s;r instanceof _t?t[o]=[r,n]:Array.isArray(r)?t[o]=[r[0],gh(n,r[1])]:tv(r,o+"/",t,n)}},"fltn"),iw=typeof TextEncoder!="undefined"&&new TextEncoder,l0=typeof TextDecoder!="undefined"&&new TextDecoder,N2=0;try{l0.decode(gr,{stream:!0}),N2=1}catch{}var F2=h(function(i){for(var e="",t=0;;){var n=i[t++],s=(n>127)+(n>223)+(n>239);if(t+s>i.length)return[e,ts(i,t-1)];s?s==3?(n=((n&15)<<18|(i[t++]&63)<<12|(i[t++]&63)<<6|i[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):s&1?e+=String.fromCharCode((n&31)<<6|i[t++]&63):e+=String.fromCharCode((n&15)<<12|(i[t++]&63)<<6|i[t++]&63):e+=String.fromCharCode(n)}},"dutf8"),VU=function(){function i(e){this.ondata=e,N2?this.t=new TextDecoder:this.p=gr}return h(i,"DecodeUTF8"),i.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new _t(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var s=F2(n),r=s[0],o=s[1];if(t){if(o.length)throw"invalid utf-8 data";this.p=null}else this.p=o;this.ondata(r,t)},i}(),HU=function(){function i(e){this.ondata=e}return h(i,"EncodeUTF8"),i.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(mo(e),this.d=t||!1)},i}();function mo(i,e){if(e){for(var t=new _t(i.length),n=0;n<i.length;++n)t[n]=i.charCodeAt(n);return t}if(iw)return iw.encode(i);for(var s=i.length,r=new _t(i.length+(i.length>>1)),o=0,a=h(function(u){r[o++]=u},"w"),n=0;n<s;++n){if(o+5>r.length){var l=new _t(o+8+(s-n<<1));l.set(r),r=l}var c=i.charCodeAt(n);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|i.charCodeAt(++n)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return ts(r,0,o)}h(mo,"strToU8");function nv(i,e){if(e){for(var t="",n=0;n<i.length;n+=16384)t+=String.fromCharCode.apply(null,i.subarray(n,n+16384));return t}else{if(l0)return l0.decode(i);var s=F2(i),r=s[0],o=s[1];if(o.length)throw"invalid utf-8 data";return r}}h(nv,"strFromU8");var z2=h(function(i){return i==1?3:i<6?2:i==9?1:0},"dbf"),B2=h(function(i,e){return e+30+ci(i,e+26)+ci(i,e+28)},"slzh"),U2=h(function(i,e,t){var n=ci(i,e+28),s=nv(i.subarray(e+46,e+46+n),!(ci(i,e+8)&2048)),r=e+46+n,o=yn(i,e+20),a=t&&o==4294967295?V2(i,r):[o,yn(i,e+24),yn(i,e+42)],l=a[0],c=a[1],u=a[2];return[ci(i,e+10),l,c,s,r+ci(i,e+30)+ci(i,e+32),u]},"zh"),V2=h(function(i,e){for(;ci(i,e)!=1;e+=4+ci(i,e+2));return[Bm(i,e+12),Bm(i,e+4),Bm(i,e+20)]},"z64e"),oo=h(function(i){var e=0;if(i)for(var t in i){var n=i[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},"exfl"),$l=h(function(i,e,t,n,s,r,o,a){var l=n.length,c=t.extra,u=a&&a.length,d=oo(c);Pt(i,e,o!=null?33639248:67324752),e+=4,o!=null&&(i[e++]=20,i[e++]=t.os),i[e]=20,e+=2,i[e++]=t.flag<<1|(r==null&&8),i[e++]=s&&8,i[e++]=t.compression&255,i[e++]=t.compression>>8;var f=new Date(t.mtime==null?Date.now():t.mtime),p=f.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(Pt(i,e,p<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),e+=4,r!=null&&(Pt(i,e,t.crc),Pt(i,e+4,r),Pt(i,e+8,t.size)),Pt(i,e+12,l),Pt(i,e+14,d),e+=16,o!=null&&(Pt(i,e,u),Pt(i,e+6,t.attrs),Pt(i,e+10,o),e+=14),i.set(n,e),e+=l,d)for(var g in c){var m=c[g],v=m.length;Pt(i,e,+g),Pt(i,e+2,v),i.set(m,e+4),e+=4+v}return u&&(i.set(a,e),e+=u),e},"wzh"),iv=h(function(i,e,t,n,s){Pt(i,e,101010256),Pt(i,e+8,t),Pt(i,e+10,t),Pt(i,e+12,n),Pt(i,e+16,s)},"wzf"),eh=function(){function i(e){this.filename=e,this.c=sc(),this.size=0,this.compression=0}return h(i,"ZipPassThrough"),i.prototype.process=function(e,t){this.ondata(null,e,t)},i.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},i}(),GU=function(){function i(e,t){var n=this;t||(t={}),eh.call(this,e),this.d=new js(t,function(s,r){n.ondata(null,s,r)}),this.compression=8,this.flag=z2(t.level)}return h(i,"ZipDeflate"),i.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},i.prototype.push=function(e,t){eh.prototype.push.call(this,e,t)},i}(),WU=function(){function i(e,t){var n=this;t||(t={}),eh.call(this,e),this.d=new P2(t,function(s,r,o){n.ondata(s,r,o)}),this.compression=8,this.flag=z2(t.level),this.terminate=this.d.terminate}return h(i,"AsyncZipDeflate"),i.prototype.process=function(e,t){this.d.push(e,t)},i.prototype.push=function(e,t){eh.prototype.push.call(this,e,t)},i}(),jU=function(){function i(e){this.ondata=e,this.u=[],this.d=1}return h(i,"Zip"),i.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=mo(e.filename),s=n.length,r=e.comment,o=r&&mo(r),a=s!=e.filename.length||o&&r.length!=o.length,l=s+oo(e.extra)+30;if(s>65535)throw"filename too long";var c=new _t(l);$l(c,0,e,n,a);var u=[c],d=h(function(){for(var v=0,y=u;v<y.length;v++){var b=y[v];t.ondata(null,b,!1)}u=[]},"pAll"),f=this.d;this.d=0;var p=this.u.length,g=gh(e,{f:n,u:a,o,t:function(){e.terminate&&e.terminate()},r:function(){if(d(),f){var v=t.u[p+1];v?v.r():t.d=1}f=1}}),m=0;e.ondata=function(v,y,b){if(v)t.ondata(v,y,b),t.terminate();else if(m+=y.length,u.push(y),b){var _=new _t(16);Pt(_,0,134695760),Pt(_,4,e.crc),Pt(_,8,m),Pt(_,12,e.size),u.push(_),g.c=m,g.b=l+m+16,g.crc=e.crc,g.size=e.size,f&&g.r(),f=1}else f&&d()},this.u.push(g)},i.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},i.prototype.e=function(){for(var e=0,t=0,n=0,s=0,r=this.u;s<r.length;s++){var o=r[s];n+=46+o.f.length+oo(o.extra)+(o.o?o.o.length:0)}for(var a=new _t(n+22),l=0,c=this.u;l<c.length;l++){var o=c[l];$l(a,e,o,o.f,o.u,o.c,t,o.o),e+=46+o.f.length+oo(o.extra)+(o.o?o.o.length:0),t+=o.b}iv(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},i.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},i}();function $U(i,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};tv(i,"",n,e);var s=Object.keys(n),r=s.length,o=0,a=0,l=r,c=new Array(r),u=[],d=h(function(){for(var m=0;m<u.length;++m)u[m]()},"tAll"),f=h(function(){var m=new _t(a+22),v=o,y=a-o;a=0;for(var b=0;b<l;++b){var _=c[b];try{var x=_.c.length;$l(m,a,_,_.f,_.u,x);var w=30+_.f.length+oo(_.extra),T=a+w;m.set(_.c,T),$l(m,o,_,_.f,_.u,x,a,_.m),o+=16+w+(_.m?_.m.length:0),a=T+x}catch(P){return t(P,null)}}iv(m,o,c.length,y,v),t(null,m)},"cbf");r||f();for(var p=h(function(m){var v=s[m],y=n[v],b=y[0],_=y[1],x=sc(),w=b.length;x.p(b);var T=mo(v),P=T.length,M=_.comment,R=M&&mo(M),L=R&&R.length,W=oo(_.extra),k=_.level==0?0:8,z=h(function(S,B){if(S)d(),t(S,null);else{var ne=B.length;c[m]=gh(_,{size:w,crc:x.d(),c:B,f:T,m:R,u:P!=v.length||R&&M.length!=L,compression:k}),o+=30+P+W+ne,a+=76+2*(P+W)+(L||0)+ne,--r||f()}},"cbl");if(P>65535&&z("filename too long",null),!k)z(null,b);else if(w<16e4)try{z(null,vh(b,_))}catch(S){z(S,null)}else u.push(R2(b,_,z))},"_loop_1"),g=0;g<l;++g)p(g);return d}h($U,"zip");function XU(i,e){e||(e={});var t={},n=[];tv(i,"",t,e);var s=0,r=0;for(var o in t){var a=t[o],l=a[0],c=a[1],u=c.level==0?0:8,d=mo(o),f=d.length,p=c.comment,g=p&&mo(p),m=g&&g.length,v=oo(c.extra);if(f>65535)throw"filename too long";var y=u?vh(l,c):l,b=y.length,_=sc();_.p(l),n.push(gh(c,{size:l.length,crc:_.d(),c:y,f:d,m:g,u:f!=o.length||g&&p.length!=m,o:s,compression:u})),s+=30+f+v+b,r+=76+2*(f+v)+(m||0)+b}for(var x=new _t(r+22),w=s,T=r-s,P=0;P<n.length;++P){var d=n[P];$l(x,d.o,d,d.f,d.u,d.c.length);var M=30+d.f.length+oo(d.extra);x.set(d.c,d.o+M),$l(x,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+M+(d.m?d.m.length:0)}return iv(x,s,n.length,T,w),x}h(XU,"zipSync");var H2=function(){function i(){}return h(i,"UnzipPassThrough"),i.prototype.push=function(e,t){this.ondata(null,e,t)},i.compression=0,i}(),YU=function(){function i(){var e=this;this.i=new Ei(function(t,n){e.ondata(null,t,n)})}return h(i,"UnzipInflate"),i.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},i.compression=8,i}(),KU=function(){function i(e,t){var n=this;t<32e4?this.i=new Ei(function(s,r){n.ondata(null,s,r)}):(this.i=new J1(function(s,r,o){n.ondata(s,r,o)}),this.terminate=this.i.terminate)}return h(i,"AsyncUnzipInflate"),i.prototype.push=function(e,t){this.i.terminate&&(e=ts(e,0)),this.i.push(e,t)},i.compression=8,i}(),qU=function(){function i(e){this.onfile=e,this.k=[],this.o={0:H2},this.p=gr}return h(i,"Unzip"),i.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var s=Math.min(this.c,e.length),r=e.subarray(0,s);if(this.c-=s,this.d?this.d.push(r,!this.c):this.k[0].push(r),e=e.subarray(s),e.length)return this.push(e,t)}else{var o=0,a=0,l=void 0,c=void 0;this.p.length?e.length?(c=new _t(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,d=this.c,f=d&&this.d,p=h(function(){var y,b=yn(c,a);if(b==67324752){o=1,l=a,g.d=null,g.c=0;var _=ci(c,a+6),x=ci(c,a+8),w=_&2048,T=_&8,P=ci(c,a+26),M=ci(c,a+28);if(u>a+30+P+M){var R=[];g.k.unshift(R),o=2;var L=yn(c,a+18),W=yn(c,a+22),k=nv(c.subarray(a+30,a+=30+P),!w);L==4294967295?(y=T?[-2]:V2(c,a),L=y[0],W=y[1]):T&&(L=-1),a+=M,g.c=L;var z,S={name:k,compression:x,start:function(){if(!S.ondata)throw"no callback";if(!L)S.ondata(null,gr,!0);else{var B=n.o[x];if(!B)throw"unknown compression type "+x;z=L<0?new B(k):new B(k,L,W),z.ondata=function(G,se,q){S.ondata(G,se,q)};for(var ne=0,K=R;ne<K.length;ne++){var ie=K[ne];z.push(ie,!1)}n.k[0]==R&&n.c?n.d=z:z.push(gr,!0)}},terminate:function(){z&&z.terminate&&z.terminate()}};L>=0&&(S.size=L,S.originalSize=W),g.onfile(S)}return"break"}else if(d){if(b==134695760)return l=a+=12+(d==-2&&8),o=3,g.c=0,"break";if(b==33639248)return l=a-=4,o=3,g.c=0,"break"}},"_loop_2"),g=this;a<u-4;++a){var m=p();if(m==="break")break}if(this.p=gr,d<0){var v=o?c.subarray(0,l-12-(d==-2&&8)-(yn(c,l-16)==134695760&&4)):c.subarray(0,a);f?f.push(v,!!o):this.k[+(o==2)].push(v)}if(o&2)return this.push(c.subarray(a),t);this.p=c.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},i.prototype.register=function(e){this.o[e.compression]=e},i}();function ZU(i,e){if(typeof e!="function")throw"no callback";for(var t=[],n=h(function(){for(var f=0;f<t.length;++f)t[f]()},"tAll"),s={},r=i.length-22;yn(i,r)!=101010256;--r)if(!r||i.length-r>65558){e("invalid zip file",null);return}var o=ci(i,r+8);o||e(null,{});var a=o,l=yn(i,r+16),c=l==4294967295;if(c){if(r=yn(i,r-12),yn(i,r)!=101075792){e("invalid zip file",null);return}a=o=yn(i,r+32),l=yn(i,r+48)}for(var u=h(function(f){var p=U2(i,l,c),g=p[0],m=p[1],v=p[2],y=p[3],b=p[4],_=p[5],x=B2(i,_);l=b;var w=h(function(P,M){P?(n(),e(P,null)):(s[y]=M,--o||e(null,s))},"cbl");if(!g)w(null,ts(i,x,x+m));else if(g==8){var T=i.subarray(x,x+m);if(m<32e4)try{w(null,cc(T,new _t(v)))}catch(P){w(P,null)}else t.push(ev(T,{size:v},w))}else w("unknown compression type "+g,null)},"_loop_3"),d=0;d<a;++d)u();return n}h(ZU,"unzip");function QU(i){for(var e={},t=i.length-22;yn(i,t)!=101010256;--t)if(!t||i.length-t>65558)throw"invalid zip file";var n=ci(i,t+8);if(!n)return{};var s=yn(i,t+16),r=s==4294967295;if(r){if(t=yn(i,t-12),yn(i,t)!=101075792)throw"invalid zip file";n=yn(i,t+32),s=yn(i,t+48)}for(var o=0;o<n;++o){var a=U2(i,s,r),l=a[0],c=a[1],u=a[2],d=a[3],f=a[4],p=a[5],g=B2(i,p);if(s=f,!l)e[d]=ts(i,g,g+c);else if(l==8)e[d]=cc(i.subarray(g,g+c),new _t(u));else throw"unknown compression type "+l}return e}h(QU,"unzipSync");var JU=Object.freeze(Object.defineProperty({__proto__:null,Deflate:js,AsyncDeflate:P2,deflate:R2,deflateSync:vh,Inflate:Ei,AsyncInflate:J1,inflate:ev,inflateSync:cc,Gzip:Uf,AsyncGzip:tw,gzip:nw,gzipSync:Vf,Gunzip:Hf,AsyncGunzip:I2,gunzip:D2,gunzipSync:Gf,Zlib:o0,AsyncZlib:NU,zlib:FU,zlibSync:a0,Unzlib:Wf,AsyncUnzlib:L2,unzlib:k2,unzlibSync:Ju,compress:nw,AsyncCompress:tw,compressSync:Vf,Compress:Uf,Decompress:O2,AsyncDecompress:zU,decompress:BU,decompressSync:UU,DecodeUTF8:VU,EncodeUTF8:HU,strToU8:mo,strFromU8:nv,ZipPassThrough:eh,ZipDeflate:GU,AsyncZipDeflate:WU,Zip:jU,zip:$U,zipSync:XU,UnzipPassThrough:H2,UnzipInflate:YU,AsyncUnzipInflate:KU,Unzip:qU,unzip:ZU,unzipSync:QU},Symbol.toStringTag,{value:"Module"}));function G2(i,e,t){const n=t.length-i-1;if(e>=t[n])return n-1;if(e<=t[i])return i;let s=i,r=n,o=Math.floor((s+r)/2);for(;e<t[o]||e>=t[o+1];)e<t[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}h(G2,"findSpan");function e6(i,e,t,n){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=t;++a){r[a]=e-n[i+1-a],o[a]=n[i+a]-e;let l=0;for(let c=0;c<a;++c){const u=o[c+1],d=r[a-c],f=s[c]/(u+d);s[c]=l+u*f,l=d*f}s[a]=l}return s}h(e6,"calcBasisFunctions");function t6(i,e,t,n){const s=G2(i,n,e),r=e6(s,n,i,e),o=new wt(0,0,0,0);for(let a=0;a<=i;++a){const l=t[s-i+a],c=r[a],u=l.w*c;o.x+=l.x*u,o.y+=l.y*u,o.z+=l.z*u,o.w+=l.w*c}return o}h(t6,"calcBSplinePoint");function n6(i,e,t,n,s){const r=[];for(let d=0;d<=t;++d)r[d]=0;const o=[];for(let d=0;d<=n;++d)o[d]=r.slice(0);const a=[];for(let d=0;d<=t;++d)a[d]=r.slice(0);a[0][0]=1;const l=r.slice(0),c=r.slice(0);for(let d=1;d<=t;++d){l[d]=e-s[i+1-d],c[d]=s[i+d]-e;let f=0;for(let p=0;p<d;++p){const g=c[p+1],m=l[d-p];a[d][p]=g+m;const v=a[p][d-1]/a[d][p];a[p][d]=f+g*v,f=m*v}a[d][d]=f}for(let d=0;d<=t;++d)o[0][d]=a[d][t];for(let d=0;d<=t;++d){let f=0,p=1;const g=[];for(let m=0;m<=t;++m)g[m]=r.slice(0);g[0][0]=1;for(let m=1;m<=n;++m){let v=0;const y=d-m,b=t-m;d>=m&&(g[p][0]=g[f][0]/a[b+1][y],v=g[p][0]*a[y][b]);const _=y>=-1?1:-y,x=d-1<=b?m-1:t-d;for(let T=_;T<=x;++T)g[p][T]=(g[f][T]-g[f][T-1])/a[b+1][y+T],v+=g[p][T]*a[y+T][b];d<=b&&(g[p][m]=-g[f][m-1]/a[b+1][d],v+=g[p][m]*a[d][b]),o[m][d]=v;const w=f;f=p,p=w}}let u=t;for(let d=1;d<=n;++d){for(let f=0;f<=t;++f)o[d][f]*=u;u*=t-d}return o}h(n6,"calcBasisFunctionDerivatives");function i6(i,e,t,n,s){const r=s<i?s:i,o=[],a=G2(i,n,e),l=n6(a,n,i,r,e),c=[];for(let u=0;u<t.length;++u){const d=t[u].clone(),f=d.w;d.x*=f,d.y*=f,d.z*=f,c[u]=d}for(let u=0;u<=r;++u){const d=c[a-i].clone().multiplyScalar(l[u][0]);for(let f=1;f<=i;++f)d.add(c[a-i+f].clone().multiplyScalar(l[u][f]));o[u]=d}for(let u=r+1;u<=s+1;++u)o[u]=new wt(0,0,0);return o}h(i6,"calcBSplineDerivatives");function s6(i,e){let t=1;for(let s=2;s<=i;++s)t*=s;let n=1;for(let s=2;s<=e;++s)n*=s;for(let s=2;s<=i-e;++s)n*=s;return t/n}h(s6,"calcKoverI");function r6(i){const e=i.length,t=[],n=[];for(let r=0;r<e;++r){const o=i[r];t[r]=new A(o.x,o.y,o.z),n[r]=o.w}const s=[];for(let r=0;r<e;++r){const o=t[r].clone();for(let a=1;a<=r;++a)o.sub(s[r-a].clone().multiplyScalar(s6(r,a)*n[a]));s[r]=o.divideScalar(n[0])}return s}h(r6,"calcRationalCurveDerivatives");function o6(i,e,t,n,s){const r=i6(i,e,t,n,s);return r6(r)}h(o6,"calcNURBSDerivatives");class c0 extends $0{constructor(e,t,n,s,r){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=r||this.knots.length-1;for(let o=0;o<n.length;++o){const a=n[o];this.controlPoints[o]=new wt(a.x,a.y,a.z,a.w)}}getPoint(e,t=new A){const n=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),r=t6(this.degree,this.knots,this.controlPoints,s);return r.w!==1&&r.divideScalar(r.w),n.set(r.x,r.y,r.z)}getTangent(e,t=new A){const n=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),r=o6(this.degree,this.knots,this.controlPoints,s,1);return n.copy(r[1]).normalize(),n}}h(c0,"NURBSCurve");let gt,fn,xi;class W2 extends bo{constructor(e){super(e)}load(e,t,n,s){const r=this,o=r.path===""?ys.extractUrlBase(e):r.path,a=new ah(this.manager);a.setPath(r.path),a.setResponseType("arraybuffer"),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,function(l){try{t(r.parse(l,o))}catch(c){s?s(c):console.error(c),r.manager.itemError(e)}},n,s)}parse(e,t){if(a6(e))gt=new K2().parse(e);else{const s=Q2(e);if(!l6(s))throw new Error("THREE.FBXLoader: Unknown format.");if(sw(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+sw(s));gt=new Y2().parse(s)}const n=new Ap(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new j2(n,this.manager).parse(gt)}}h(W2,"FBXLoader");class j2{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){fn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),s=this.parseDeformers(),r=new $2().parse(s);return this.parseScene(s,r,n),xi}parseConnections(){const e=new Map;return"Connections"in gt&&gt.Connections.connections.forEach(function(n){const s=n[0],r=n[1],o=n[2];e.has(s)||e.set(s,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(s).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const l={ID:s,relationship:o};e.get(r).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in gt.Objects){const n=gt.Objects.Video;for(const s in n){const r=n[s],o=parseInt(s);if(e[o]=r.RelativeFilename||r.Filename,"Content"in r){const a=r.Content instanceof ArrayBuffer&&r.Content.byteLength>0,l=typeof r.Content=="string"&&r.Content!=="";if(a||l){const c=this.parseImage(n[s]);t[r.RelativeFilename||r.Filename]=c}}}}for(const n in e){const s=e[n];t[s]!==void 0?e[n]=t[s]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let r;switch(s){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),r="image/tga";break;default:console.warn('FBXLoader: Image type "'+s+'" is not supported.');return}if(typeof t=="string")return"data:"+r+";base64,"+t;{const o=new Uint8Array(t);return window.URL.createObjectURL(new Blob([o],{type:r}))}}parseTextures(e){const t=new Map;if("Texture"in gt.Objects){const n=gt.Objects.Texture;for(const s in n){const r=this.parseTexture(n[s],e);t.set(parseInt(s),r)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const s=e.WrapModeU,r=e.WrapModeV,o=s!==void 0?s.value:0,a=r!==void 0?r.value:0;if(n.wrapS=o===0?wr:li,n.wrapT=a===0?wr:li,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;n.offset.x=l[0],n.offset.y=l[1]}return n}loadTexture(e,t){let n;const s=this.textureLoader.path,r=fn.get(e.id).children;r!==void 0&&r.length>0&&t[r[0].ID]!==void 0&&(n=t[r[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),o=new Pn):(l.setPath(this.textureLoader.path),o=l.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),o=new Pn):o=this.textureLoader.load(n);return this.textureLoader.setPath(s),o}parseMaterials(e){const t=new Map;if("Material"in gt.Objects){const n=gt.Objects.Material;for(const s in n){const r=this.parseMaterial(n[s],e);r!==null&&t.set(parseInt(s),r)}}return t}parseMaterial(e,t){const n=e.id,s=e.attrName;let r=e.ShadingModel;if(typeof r=="object"&&(r=r.value),!fn.has(n))return null;const o=this.parseParameters(e,t,n);let a;switch(r.toLowerCase()){case"phong":a=new _u;break;case"lambert":a=new X0;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',r),a=new _u;break}return a.setValues(o),a.name=s,a}parseParameters(e,t,n){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new Te().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(s.color=new Te().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new Te().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(s.emissive=new Te().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new Te().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new Te().fromArray(e.SpecularColor.value));const r=this;return fn.get(n).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":s.bumpMap=r.getTexture(t,o.ID);break;case"Maya|TEX_ao_map":s.aoMap=r.getTexture(t,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=r.getTexture(t,o.ID),s.map!==void 0&&(s.map.encoding=bt);break;case"DisplacementColor":s.displacementMap=r.getTexture(t,o.ID);break;case"EmissiveColor":s.emissiveMap=r.getTexture(t,o.ID),s.emissiveMap!==void 0&&(s.emissiveMap.encoding=bt);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=r.getTexture(t,o.ID);break;case"ReflectionColor":s.envMap=r.getTexture(t,o.ID),s.envMap!==void 0&&(s.envMap.mapping=Rf,s.envMap.encoding=bt);break;case"SpecularColor":s.specularMap=r.getTexture(t,o.ID),s.specularMap!==void 0&&(s.specularMap.encoding=bt);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=r.getTexture(t,o.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),s}getTexture(e,t){return"LayeredTexture"in gt.Objects&&t in gt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=fn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in gt.Objects){const n=gt.Objects.Deformer;for(const s in n){const r=n[s],o=fn.get(parseInt(s));if(r.attrType==="Skin"){const a=this.parseSkeleton(o,n);a.ID=s,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,e[s]=a}else if(r.attrType==="BlendShape"){const a={id:s};a.rawTargets=this.parseMorphTargets(o,n),a.id=s,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[s]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(s){const r=t[s.ID];if(r.attrType!=="Cluster")return;const o={ID:s.ID,indices:[],weights:[],transformLink:new ve().fromArray(r.TransformLink.a)};"Indexes"in r&&(o.indices=r.Indexes.a,o.weights=r.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let s=0;s<e.children.length;s++){const r=e.children[s],o=t[r.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=fn.get(parseInt(r.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){xi=new di;const s=this.parseModels(e.skeletons,t,n),r=gt.Objects.Model,o=this;s.forEach(function(l){const c=r[l.ID];o.setLookAtProperties(l,c),fn.get(l.ID).parents.forEach(function(d){const f=s.get(d.ID);f!==void 0&&f.add(l)}),l.parent===null&&xi.add(l)}),this.bindSkeleton(e.skeletons,t,s),this.createAmbientLight(),xi.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=q2(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const a=new X2().parse();xi.children.length===1&&xi.children[0].isGroup&&(xi.children[0].animations=a,xi=xi.children[0]),xi.animations=a}parseModels(e,t,n){const s=new Map,r=gt.Objects.Model;for(const o in r){const a=parseInt(o),l=r[o],c=fn.get(a);let u=this.buildSkeleton(c,e,a,l.attrName);if(!u){switch(l.attrType){case"Camera":u=this.createCamera(c);break;case"Light":u=this.createLight(c);break;case"Mesh":u=this.createMesh(c,t,n);break;case"NurbsCurve":u=this.createCurve(c,t);break;case"LimbNode":case"Root":u=new Fu;break;case"Null":default:u=new di;break}u.name=l.attrName?ft.sanitizeNodeName(l.attrName):"",u.ID=a}this.getTransformData(u,l),s.set(a,u)}return s}buildSkeleton(e,t,n,s){let r=null;return e.parents.forEach(function(o){for(const a in t){const l=t[a];l.rawBones.forEach(function(c,u){if(c.ID===o.ID){const d=r;r=new Fu,r.matrixWorld.copy(c.transformLink),r.name=s?ft.sanitizeNodeName(s):"",r.ID=n,l.bones[u]=r,d!==null&&r.add(d)}})}}),r}createCamera(e){let t,n;if(e.children.forEach(function(s){const r=gt.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new vt;else{let s=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(s=1);let r=1;n.NearPlane!==void 0&&(r=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let a=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,l=n.AspectHeight.value);const c=a/l;let u=45;n.FieldOfView!==void 0&&(u=n.FieldOfView.value);const d=n.FocalLength?n.FocalLength.value:null;switch(s){case 0:t=new Fn(u,c,r,o),d!==null&&t.setFocalLength(d);break;case 1:t=new yo(-a/2,a/2,l/2,-l/2,r,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+s+"."),t=new vt;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(s){const r=gt.Objects.NodeAttribute[s.ID];r!==void 0&&(n=r)}),n===void 0)t=new vt;else{let s;n.LightType===void 0?s=0:s=n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new Te().fromArray(n.Color.value));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const l=1;switch(s){case 0:t=new zu(r,o,a,l);break;case 1:t=new lh(r,o);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=Zi.degToRad(n.InnerAngle.value));let u=0;n.OuterAngle!==void 0&&(u=Zi.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new Cp(r,o,a,c,u,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new zu(r,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let s,r=null,o=null;const a=[];return e.children.forEach(function(l){t.has(l.ID)&&(r=t.get(l.ID)),n.has(l.ID)&&a.push(n.get(l.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new _u({color:13421772}),a.push(o)),"color"in r.attributes&&a.forEach(function(l){l.vertexColors=!0}),r.FBX_Deformer?(s=new j0(r,o),s.normalizeSkinWeights()):s=new Re(r,o),s}createCurve(e,t){const n=e.children.reduce(function(r,o){return t.has(o.ID)&&(r=t.get(o.ID)),r},null),s=new $n({color:3342591,linewidth:1});return new vn(n,s)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Z2(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&fn.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const r=gt.Objects.Model[s.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),xi.add(e.target)):e.lookAt(new A().fromArray(o))}}})}bindSkeleton(e,t,n){const s=this.parsePoseNodes();for(const r in e){const o=e[r];fn.get(parseInt(o.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;fn.get(c).parents.forEach(function(d){n.has(d.ID)&&n.get(d.ID).bind(new rh(o.bones),s[d.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in gt.Objects){const t=gt.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const s=t[n].PoseNode;Array.isArray(s)?s.forEach(function(r){e[r.Node]=new ve().fromArray(r.Matrix.a)}):e[s.Node]=new ve().fromArray(s.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in gt&&"AmbientColor"in gt.GlobalSettings){const e=gt.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],s=e[2];if(t!==0||n!==0||s!==0){const r=new Te(t,n,s);xi.add(new Tp(r,1))}}}}h(j2,"FBXTreeParser");class $2{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in gt.Objects){const n=gt.Objects.Geometry;for(const s in n){const r=fn.get(parseInt(s)),o=this.parseGeometry(r,n[s],e);t.set(parseInt(s),o)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const s=n.skeletons,r=[],o=e.parents.map(function(d){return gt.Objects.Model[d.ID]});if(o.length===0)return;const a=e.children.reduce(function(d,f){return s[f.ID]!==void 0&&(d=s[f.ID]),d},null);e.children.forEach(function(d){n.morphTargets[d.ID]!==void 0&&r.push(n.morphTargets[d.ID])});const l=o[0],c={};"RotationOrder"in l&&(c.eulerOrder=Z2(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const u=q2(c);return this.genGeometry(t,a,r,u)}genGeometry(e,t,n,s){const r=new et;e.attrName&&(r.name=e.attrName);const o=this.parseGeoNode(e,t),a=this.genBuffers(o),l=new Fe(a.vertex,3);if(l.applyMatrix4(s),r.setAttribute("position",l),a.colors.length>0&&r.setAttribute("color",new Fe(a.colors,3)),t&&(r.setAttribute("skinIndex",new gp(a.weightsIndices,4)),r.setAttribute("skinWeight",new Fe(a.vertexWeights,4)),r.FBX_Deformer=t),a.normal.length>0){const c=new ui().getNormalMatrix(s),u=new Fe(a.normal,3);u.applyNormalMatrix(c),r.setAttribute("normal",u)}if(a.uvs.forEach(function(c,u){let d="uv"+(u+1).toString();u===0&&(d="uv"),r.setAttribute(d,new Fe(a.uvs[u],2))}),o.material&&o.material.mappingType!=="AllSame"){let c=a.materialIndex[0],u=0;if(a.materialIndex.forEach(function(d,f){d!==c&&(r.addGroup(u,f-u,c),c=d,u=f)}),r.groups.length>0){const d=r.groups[r.groups.length-1],f=d.start+d.count;f!==a.materialIndex.length&&r.addGroup(f,a.materialIndex.length-f,c)}r.groups.length===0&&r.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(r,e,n,s),r}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(s,r){s.indices.forEach(function(o,a){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:r,weight:s.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,s=0,r=!1,o=[],a=[],l=[],c=[],u=[],d=[];const f=this;return e.vertexIndices.forEach(function(p,g){let m,v=!1;p<0&&(p=p^-1,v=!0);let y=[],b=[];if(o.push(p*3,p*3+1,p*3+2),e.color){const _=vd(g,n,p,e.color);l.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(_){b.push(_.weight),y.push(_.id)}),b.length>4){r||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),r=!0);const _=[0,0,0,0],x=[0,0,0,0];b.forEach(function(w,T){let P=w,M=y[T];x.forEach(function(R,L,W){if(P>R){W[L]=P,P=R;const k=_[L];_[L]=M,M=k}})}),y=_,b=x}for(;b.length<4;)b.push(0),y.push(0);for(let _=0;_<4;++_)u.push(b[_]),d.push(y[_])}if(e.normal){const _=vd(g,n,p,e.normal);a.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(m=vd(g,n,p,e.material)[0],m<0&&(f.negativeMaterialIndices=!0,m=0)),e.uv&&e.uv.forEach(function(_,x){const w=vd(g,n,p,_);c[x]===void 0&&(c[x]=[]),c[x].push(w[0]),c[x].push(w[1])}),s++,v&&(f.genFace(t,e,o,m,a,l,c,u,d,s),n++,s=0,o=[],a=[],l=[],c=[],u=[],d=[])}),t}genFace(e,t,n,s,r,o,a,l,c,u){for(let d=2;d<u;d++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(d-1)*3]]),e.vertex.push(t.vertexPositions[n[(d-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(d-1)*3+2]]),e.vertex.push(t.vertexPositions[n[d*3]]),e.vertex.push(t.vertexPositions[n[d*3+1]]),e.vertex.push(t.vertexPositions[n[d*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(d-1)*4]),e.vertexWeights.push(l[(d-1)*4+1]),e.vertexWeights.push(l[(d-1)*4+2]),e.vertexWeights.push(l[(d-1)*4+3]),e.vertexWeights.push(l[d*4]),e.vertexWeights.push(l[d*4+1]),e.vertexWeights.push(l[d*4+2]),e.vertexWeights.push(l[d*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(d-1)*4]),e.weightsIndices.push(c[(d-1)*4+1]),e.weightsIndices.push(c[(d-1)*4+2]),e.weightsIndices.push(c[(d-1)*4+3]),e.weightsIndices.push(c[d*4]),e.weightsIndices.push(c[d*4+1]),e.weightsIndices.push(c[d*4+2]),e.weightsIndices.push(c[d*4+3])),t.color&&(e.colors.push(o[0]),e.colors.push(o[1]),e.colors.push(o[2]),e.colors.push(o[(d-1)*3]),e.colors.push(o[(d-1)*3+1]),e.colors.push(o[(d-1)*3+2]),e.colors.push(o[d*3]),e.colors.push(o[d*3+1]),e.colors.push(o[d*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(r[0]),e.normal.push(r[1]),e.normal.push(r[2]),e.normal.push(r[(d-1)*3]),e.normal.push(r[(d-1)*3+1]),e.normal.push(r[(d-1)*3+2]),e.normal.push(r[d*3]),e.normal.push(r[d*3+1]),e.normal.push(r[d*3+2])),t.uv&&t.uv.forEach(function(f,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(a[p][0]),e.uvs[p].push(a[p][1]),e.uvs[p].push(a[p][(d-1)*2]),e.uvs[p].push(a[p][(d-1)*2+1]),e.uvs[p].push(a[p][d*2]),e.uvs[p].push(a[p][d*2+1])})}addMorphTargets(e,t,n,s){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const r=this;n.forEach(function(o){o.rawTargets.forEach(function(a){const l=gt.Objects.Geometry[a.geoID];l!==void 0&&r.genMorphGeometry(e,t,l,s,a.name)})})}genMorphGeometry(e,t,n,s,r){const o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,u=new Float32Array(c);for(let g=0;g<l.length;g++){const m=l[g]*3;u[m]=a[g*3],u[m+1]=a[g*3+1],u[m+2]=a[g*3+2]}const d={vertexIndices:o,vertexPositions:u},f=this.genBuffers(d),p=new Fe(f.vertex,3);p.name=r||n.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Normals.a;let r=[];return n==="IndexToDirect"&&("NormalIndex"in e?r=e.NormalIndex.a:"NormalsIndex"in e&&(r=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:r,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.UV.a;let r=[];return n==="IndexToDirect"&&(r=e.UVIndex.a),{dataSize:2,buffer:s,indices:r,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,s=e.Colors.a;let r=[];return n==="IndexToDirect"&&(r=e.ColorIndex.a),{dataSize:4,buffer:s,indices:r,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const s=e.Materials.a,r=[];for(let o=0;o<s.length;++o)r.push(o);return{dataSize:1,buffer:s,indices:r,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(c0===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new et;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new et;const n=t-1,s=e.KnotVector.a,r=[],o=e.Points.a;for(let d=0,f=o.length;d<f;d+=4)r.push(new wt().fromArray(o,d));let a,l;if(e.Form==="Closed")r.push(r[0]);else if(e.Form==="Periodic"){a=n,l=s.length-1-a;for(let d=0;d<n;++d)r.push(r[d])}const u=new c0(n,s,r,a,l).getPoints(r.length*12);return new et().setFromPoints(u)}}h($2,"GeometryParser");class X2{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const s=t[n],r=this.addClip(s);e.push(r)}return e}parseClips(){if(gt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=gt.Objects.AnimationCurveNode,t=new Map;for(const n in e){const s=e[n];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const r={id:s.id,attr:s.attrName,curves:{}};t.set(r.id,r)}}return t}parseAnimationCurves(e){const t=gt.Objects.AnimationCurve;for(const n in t){const s={id:t[n].id,times:t[n].KeyTime.a.map(c6),values:t[n].KeyValueFloat.a},r=fn.get(s.id);if(r!==void 0){const o=r.parents[0].ID,a=r.parents[0].relationship;a.match(/X/)?e.get(o).curves.x=s:a.match(/Y/)?e.get(o).curves.y=s:a.match(/Z/)?e.get(o).curves.z=s:a.match(/d|DeformPercent/)&&e.has(o)&&(e.get(o).curves.morph=s)}}}parseAnimationLayers(e){const t=gt.Objects.AnimationLayer,n=new Map;for(const s in t){const r=[],o=fn.get(parseInt(s));o!==void 0&&(o.children.forEach(function(l,c){if(e.has(l.ID)){const u=e.get(l.ID);if(u.curves.x!==void 0||u.curves.y!==void 0||u.curves.z!==void 0){if(r[c]===void 0){const d=fn.get(l.ID).parents.filter(function(f){return f.relationship!==void 0})[0].ID;if(d!==void 0){const f=gt.Objects.Model[d.toString()];if(f===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:f.attrName?ft.sanitizeNodeName(f.attrName):"",ID:f.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};xi.traverse(function(g){g.ID===f.id&&(p.transform=g.matrix,g.userData.transformData&&(p.eulerOrder=g.userData.transformData.eulerOrder))}),p.transform||(p.transform=new ve),"PreRotation"in f&&(p.preRotation=f.PreRotation.value),"PostRotation"in f&&(p.postRotation=f.PostRotation.value),r[c]=p}}r[c]&&(r[c][u.attr]=u)}else if(u.curves.morph!==void 0){if(r[c]===void 0){const d=fn.get(l.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID,f=fn.get(d).parents[0].ID,p=fn.get(f).parents[0].ID,g=fn.get(p).parents[0].ID,m=gt.Objects.Model[g],v={modelName:m.attrName?ft.sanitizeNodeName(m.attrName):"",morphName:gt.Objects.Deformer[d].attrName};r[c]=v}r[c][u.attr]=u}}}),n.set(parseInt(s),r))}return n}parseAnimStacks(e){const t=gt.Objects.AnimationStack,n={};for(const s in t){const r=fn.get(parseInt(s)).children;r.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=e.get(r[0].ID);n[s]={name:t[s].attrName,layer:o}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(s){t=t.concat(n.generateTracks(s))}),new K0(e.name,-1,t)}generateTracks(e){const t=[];let n=new A,s=new Be,r=new A;if(e.transform&&e.transform.decompose(n,s,r),n=n.toArray(),s=new it().setFromQuaternion(s,e.eulerOrder).toArray(),r=r.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");o!==void 0&&t.push(o)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const o=this.generateRotationTrack(e.modelName,e.R.curves,s,e.preRotation,e.postRotation,e.eulerOrder);o!==void 0&&t.push(o)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const o=this.generateVectorTrack(e.modelName,e.S.curves,r,"scale");o!==void 0&&t.push(o)}if(e.DeformPercent!==void 0){const o=this.generateMorphTrack(e);o!==void 0&&t.push(o)}return t}generateVectorTrack(e,t,n,s){const r=this.getTimesForAllAxes(t),o=this.getKeyframeTrackValues(r,t,n);return new ga(e+"."+s,r,o)}generateRotationTrack(e,t,n,s,r,o){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Zi.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Zi.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Zi.degToRad));const a=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(a,t,n);s!==void 0&&(s=s.map(Zi.degToRad),s.push(o),s=new it().fromArray(s),s=new Be().setFromEuler(s)),r!==void 0&&(r=r.map(Zi.degToRad),r.push(o),r=new it().fromArray(r),r=new Be().setFromEuler(r).invert());const c=new Be,u=new it,d=[];for(let f=0;f<l.length;f+=3)u.set(l[f],l[f+1],l[f+2],o),c.setFromEuler(u),s!==void 0&&c.premultiply(s),r!==void 0&&c.multiply(r),c.toArray(d,f/3*4);return new Mr(e+".quaternion",a,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(r){return r/100}),s=xi.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ma(e.modelName+".morphTargetInfluences["+s+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,s){return n-s}),t.length>1){let n=1,s=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==s&&(t[n]=o,s=o,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const s=n,r=[];let o=-1,a=-1,l=-1;return e.forEach(function(c){if(t.x&&(o=t.x.times.indexOf(c)),t.y&&(a=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),o!==-1){const u=t.x.values[o];r.push(u),s[0]=u}else r.push(s[0]);if(a!==-1){const u=t.y.values[a];r.push(u),s[1]=u}else r.push(s[1]);if(l!==-1){const u=t.z.values[l];r.push(u),s[2]=u}else r.push(s[2])}),r}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],s=e.values[t]-n,r=Math.abs(s);if(r>=180){const o=r/180,a=s/o;let l=n+a;const c=e.times[t-1],d=(e.times[t]-c)/o;let f=c+d;const p=[],g=[];for(;f<e.times[t];)p.push(f),f+=d,g.push(l),l+=a;e.times=rw(e.times,t,p),e.values=rw(e.values,t,g)}}}}h(X2,"AnimationParser");class Y2{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new sv,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(s,r){const o=s.match(/^[\s\t]*;/),a=s.match(/^[\s\t]*$/);if(o||a)return;const l=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=s.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(s,l):c?t.parseNodeProperty(s,c,n[++r]):u?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),r={name:n},o=this.parseNodeAttr(s),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,r):n in a?(n==="PoseNode"?a.PoseNode.push(r):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),o.id!==""&&(a[n][o.id]=r)):typeof o.id=="number"?(a[n]={},a[n][o.id]=r):n!=="Properties70"&&(n==="PoseNode"?a[n]=[r]:a[n]=r),typeof o.id=="number"&&(r.id=o.id),o.name!==""&&(r.attrName=o.name),o.type!==""&&(r.attrType=o.type),this.pushStack(r)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",s="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:n,type:s}}parseNodeProperty(e,t,n){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),r=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&r===","&&(r=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(e,s,r);return}if(s==="C"){const l=r.split(",").slice(1),c=parseInt(l[0]),u=parseInt(l[1]);let d=r.split(",").slice(3);d=d.map(function(f){return f.trim().replace(/^"/,"")}),s="connections",r=[c,u],h6(r,d),o[s]===void 0&&(o[s]=[])}s==="Node"&&(o.id=r),s in o&&Array.isArray(o[s])?o[s].push(r):s!=="a"?o[s]=r:o.a=r,this.setCurrentProp(o,s),s==="a"&&r.slice(-1)!==","&&(o.a=Vm(r))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Vm(t.a))}parseNodeSpecialProperty(e,t,n){const s=n.split('",').map(function(u){return u.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=s[0],o=s[1],a=s[2],l=s[3];let c=s[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Vm(c);break}this.getPrevNode()[r]={type:o,type2:a,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),r)}}h(Y2,"TextParser");class K2{parse(e){const t=new u0(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const s=new sv;for(;!this.endOfContent(t);){const r=this.parseNode(t,n);r!==null&&s.add(r.name,r)}return s}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},s=t>=7500?e.getUint64():e.getUint32(),r=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const o=e.getUint8(),a=e.getString(o);if(s===0)return null;const l=[];for(let f=0;f<r;f++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",u=l.length>1?l[1]:"",d=l.length>2?l[2]:"";for(n.singleProperty=r===1&&e.getOffset()===s;s>e.getOffset();){const f=this.parseNode(e,t);f!==null&&this.parseSubNode(a,n,f)}return n.propertyList=l,typeof c=="number"&&(n.id=c),u!==""&&(n.attrName=u),d!==""&&(n.attrType=d),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const s=n.propertyList[0];Array.isArray(s)?(t[n.name]=n,n.a=s):t[n.name]=s}else if(e==="Connections"&&n.name==="C"){const s=[];n.propertyList.forEach(function(r,o){o!==0&&s.push(r)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let s=n.propertyList[0],r=n.propertyList[1];const o=n.propertyList[2],a=n.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),r==="Color"||r==="ColorRGB"||r==="Vector"||r==="Vector3D"||r.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[s]={type:r,type2:o,flag:a,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),r=e.getUint32(),o=e.getUint32();if(r===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}typeof JU=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=Ju(new Uint8Array(e.getArrayBuffer(o))),l=new u0(a.buffer);switch(t){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}h(K2,"BinaryParser");class u0{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let s=0;s<e;s++)t[s]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),ys.decodeText(new Uint8Array(t))}}h(u0,"BinaryReader");class sv{add(e,t){this[e]=t}}h(sv,"FBXTree");function a6(i){const e="Kaydara FBX Binary  \0";return i.byteLength>=e.length&&e===Q2(i,0,e.length)}h(a6,"isFbxFormatBinary");function l6(i){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(s){const r=i[s-1];return i=i.slice(t+s),t++,r}h(n,"read");for(let s=0;s<e.length;++s)if(n(1)===e[s])return!1;return!0}h(l6,"isFbxFormatASCII");function sw(i){const e=/FBXVersion: (\d+)/,t=i.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}h(sw,"getFbxVersion");function c6(i){return i/46186158e3}h(c6,"convertFBXTimeToSeconds");const u6=[];function vd(i,e,t,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=i;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(s=n.indices[s]);const r=s*n.dataSize,o=r+n.dataSize;return d6(u6,n.buffer,r,o)}h(vd,"getData");const Um=new it,Ka=new A;function q2(i){const e=new ve,t=new ve,n=new ve,s=new ve,r=new ve,o=new ve,a=new ve,l=new ve,c=new ve,u=new ve,d=new ve,f=new ve,p=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(Ka.fromArray(i.translation)),i.preRotation){const L=i.preRotation.map(Zi.degToRad);L.push(i.eulerOrder||it.DefaultOrder),t.makeRotationFromEuler(Um.fromArray(L))}if(i.rotation){const L=i.rotation.map(Zi.degToRad);L.push(i.eulerOrder||it.DefaultOrder),n.makeRotationFromEuler(Um.fromArray(L))}if(i.postRotation){const L=i.postRotation.map(Zi.degToRad);L.push(i.eulerOrder||it.DefaultOrder),s.makeRotationFromEuler(Um.fromArray(L)),s.invert()}i.scale&&r.scale(Ka.fromArray(i.scale)),i.scalingOffset&&a.setPosition(Ka.fromArray(i.scalingOffset)),i.scalingPivot&&o.setPosition(Ka.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(Ka.fromArray(i.rotationOffset)),i.rotationPivot&&c.setPosition(Ka.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(d.copy(i.parentMatrix),u.copy(i.parentMatrixWorld));const g=t.clone().multiply(n).multiply(s),m=new ve;m.extractRotation(u);const v=new ve;v.copyPosition(u);const y=v.clone().invert().multiply(u),b=m.clone().invert().multiply(y),_=r,x=new ve;if(p===0)x.copy(m).multiply(g).multiply(b).multiply(_);else if(p===1)x.copy(m).multiply(b).multiply(g).multiply(_);else{const W=new ve().scale(new A().setFromMatrixScale(d)).clone().invert(),k=b.clone().multiply(W);x.copy(m).multiply(g).multiply(k).multiply(_)}const w=c.clone().invert(),T=o.clone().invert();let P=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(s).multiply(w).multiply(a).multiply(o).multiply(r).multiply(T);const M=new ve().copyPosition(P),R=u.clone().multiply(M);return f.copyPosition(R),P=f.clone().multiply(x),P.premultiply(u.invert()),P}h(q2,"generateTransform");function Z2(i){i=i||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return i===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[i]}h(Z2,"getEulerOrder");function Vm(i){return i.split(",").map(function(t){return parseFloat(t)})}h(Vm,"parseNumberArray");function Q2(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),ys.decodeText(new Uint8Array(i,e,t))}h(Q2,"convertArrayBufferToString");function h6(i,e){for(let t=0,n=i.length,s=e.length;t<s;t++,n++)i[n]=e[t]}h(h6,"append");function d6(i,e,t,n){for(let s=t,r=0;s<n;s++,r++)i[r]=e[s];return i}h(d6,"slice");function rw(i,e,t){return i.slice(0,e).concat(t).concat(i.slice(e))}h(rw,"inject");class J2 extends bo{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new iC(t)}),this.register(function(t){return new uC(t)}),this.register(function(t){return new hC(t)}),this.register(function(t){return new rC(t)}),this.register(function(t){return new oC(t)}),this.register(function(t){return new aC(t)}),this.register(function(t){return new lC(t)}),this.register(function(t){return new nC(t)}),this.register(function(t){return new cC(t)}),this.register(function(t){return new sC(t)}),this.register(function(t){return new eC(t)}),this.register(function(t){return new dC(t)}),this.register(function(t){return new fC(t)})}load(e,t,n,s){const r=this;let o;this.resourcePath!==""?o=this.resourcePath:this.path!==""?o=this.path:o=ys.extractUrlBase(e),this.manager.itemStart(e);const a=h(function(c){s?s(c):console.error(c),r.manager.itemError(e),r.manager.itemEnd(e)},"_onError"),l=new ah(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{r.parse(c,o,function(u){t(u),r.manager.itemEnd(e)},a)}catch(u){a(u)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let r;const o={},a={};if(typeof e=="string")r=JSON.parse(e);else if(e instanceof ArrayBuffer)if(ys.decodeText(new Uint8Array(e,0,4))===pC){try{o[pt.KHR_BINARY_GLTF]=new mC(e)}catch(u){s&&s(u);return}r=JSON.parse(o[pt.KHR_BINARY_GLTF].content)}else r=JSON.parse(ys.decodeText(new Uint8Array(e)));else r=e;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new wC(r,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let c=0;c<r.extensionsUsed.length;++c){const u=r.extensionsUsed[c],d=r.extensionsRequired||[];switch(u){case pt.KHR_MATERIALS_UNLIT:o[u]=new tC;break;case pt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[u]=new yC;break;case pt.KHR_DRACO_MESH_COMPRESSION:o[u]=new gC(r,this.dracoLoader);break;case pt.KHR_TEXTURE_TRANSFORM:o[u]=new vC;break;case pt.KHR_MESH_QUANTIZATION:o[u]=new _C;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,t,s,r)})}}h(J2,"GLTFLoader");function f6(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}h(f6,"GLTFRegistry");const pt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class eC{constructor(e){this.parser=e,this.name=pt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const r=t[n];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const r=t.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e];let c;const u=new Te(16777215);l.color!==void 0&&u.fromArray(l.color);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new lh(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new zu(u),c.distance=d;break;case"spot":c=new Cp(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(c),t.cache.add(n,s),s}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return n._getNodeRef(t.cache,a,l)})}}h(eC,"GLTFLightsExtension");class tC{constructor(){this.name=pt.KHR_MATERIALS_UNLIT}getMaterialType(){return hi}extendParams(e,t,n){const s=[];e.color=new Te(1,1,1),e.opacity=1;const r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",r.baseColorTexture,bt))}return Promise.all(s)}}h(tC,"GLTFMaterialsUnlitExtension$1");class nC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}h(nC,"GLTFMaterialsEmissiveStrengthExtension");class iC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new je(a,a)}return Promise.all(r)}}h(iC,"GLTFMaterialsClearcoatExtension$1");class sC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(n.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}h(sC,"GLTFMaterialsIridescenceExtension$1");class rC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];t.sheenColor=new Te(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=s.extensions[this.name];return o.sheenColorFactor!==void 0&&t.sheenColor.fromArray(o.sheenColorFactor),o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture,bt)),o.sheenRoughnessTexture!==void 0&&r.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}h(rC,"GLTFMaterialsSheenExtension");class oC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(n.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}h(oC,"GLTFMaterialsTransmissionExtension$1");class aC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new Te(a[0],a[1],a[2]),Promise.all(r)}}h(aC,"GLTFMaterialsVolumeExtension$1");class lC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}h(lC,"GLTFMaterialsIorExtension");class cC{constructor(e){this.parser=e,this.name=pt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:_o}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new Te(a[0],a[1],a[2]),o.specularColorTexture!==void 0&&r.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture,bt)),Promise.all(r)}}h(cC,"GLTFMaterialsSpecularExtension");class uC{constructor(e){this.parser=e,this.name=pt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r.source,o)}}h(uC,"GLTFTextureBasisUExtension");class hC{constructor(e){this.parser=e,this.name=pt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,r=s.textures[e];if(!r.extensions||!r.extensions[t])return null;const o=r.extensions[t],a=s.images[o.source];let l=n.textureLoader;if(a.uri){const c=n.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return n.loadTextureImage(e,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}h(hC,"GLTFTextureWebPExtension");class dC{constructor(e){this.name=pt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,u=s.count,d=s.byteStride,f=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(u,d,f,s.mode,s.filter).then(function(p){return p.buffer}):o.ready.then(function(){const p=new ArrayBuffer(u*d);return o.decodeGltfBuffer(new Uint8Array(p),u,d,f,s.mode,s.filter),p})})}else return null}}h(dC,"GLTFMeshoptCompression");class fC{constructor(e){this.name=pt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const s=t.meshes[n.mesh];for(const c of s.primitives)if(c.mode!==qi.TRIANGLES&&c.mode!==qi.TRIANGLE_STRIP&&c.mode!==qi.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(u=>(l[c]=u,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],f=c[0].count,p=[];for(const g of d){const m=new ve,v=new A,y=new Be,b=new A(1,1,1),_=new hA(g.geometry,g.material,f);for(let x=0;x<f;x++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,x),l.ROTATION&&y.fromBufferAttribute(l.ROTATION,x),l.SCALE&&b.fromBufferAttribute(l.SCALE,x),_.setMatrixAt(x,m.compose(v,y,b));for(const x in l)x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&g.geometry.setAttribute(x,l[x]);vt.prototype.copy.call(_,g),_.frustumCulled=!1,this.parser.assignFinalMaterial(_),p.push(_)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}h(fC,"GLTFMeshGpuInstancing");const pC="glTF",Ec=12,ow={JSON:1313821514,BIN:5130562};class mC{constructor(e){this.name=pt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Ec);if(this.header={magic:ys.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==pC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-Ec,s=new DataView(e,Ec);let r=0;for(;r<n;){const o=s.getUint32(r,!0);r+=4;const a=s.getUint32(r,!0);if(r+=4,a===ow.JSON){const l=new Uint8Array(e,Ec+r,o);this.content=ys.decodeText(l)}else if(a===ow.BIN){const l=Ec+r;this.body=e.slice(l,l+o)}r+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}h(mC,"GLTFBinaryExtension");class gC{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=pt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,r=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const u in o){const d=h0[u]||u.toLowerCase();a[d]=o[u]}for(const u in e.attributes){const d=h0[u]||u.toLowerCase();if(o[u]!==void 0){const f=n.accessors[e.attributes[u]],p=th[f.componentType];c[d]=p.name,l[d]=f.normalized===!0}}return t.getDependency("bufferView",r).then(function(u){return new Promise(function(d){s.decodeDracoFile(u,function(f){for(const p in f.attributes){const g=f.attributes[p],m=l[p];m!==void 0&&(g.normalized=m)}d(f)},a,c)})})}}h(gC,"GLTFDracoMeshCompressionExtension");class vC{constructor(){this.name=pt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}h(vC,"GLTFTextureTransformExtension");class jf extends Pr{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new Te().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(l){for(const c in a)l.uniforms[c]=a[c];l.fragmentShader=l.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(l){a.specular.value=l}},specularMap:{get:function(){return a.specularMap.value},set:function(l){a.specularMap.value=l,l?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(l){a.glossiness.value=l}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(l){a.glossinessMap.value=l,l?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}h(jf,"GLTFMeshStandardSGMaterial");class yC{constructor(){this.name=pt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return jf}extendParams(e,t,n){const s=t.extensions[this.name];e.color=new Te(1,1,1),e.opacity=1;const r=[];if(Array.isArray(s.diffuseFactor)){const o=s.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(s.diffuseTexture!==void 0&&r.push(n.assignTexture(e,"map",s.diffuseTexture,bt)),e.emissive=new Te(0,0,0),e.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,e.specular=new Te(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const o=s.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",o)),r.push(n.assignTexture(e,"specularMap",o,bt))}return Promise.all(r)}createMaterial(e){const t=new jf(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=ih,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}h(yC,"GLTFMaterialsPbrSpecularGlossinessExtension");class _C{constructor(){this.name=pt.KHR_MESH_QUANTIZATION}}h(_C,"GLTFMeshQuantizationExtension");class rv extends Zl{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,r=e*s*3+s;for(let o=0;o!==s;o++)t[o]=n[r+o];return t}interpolate_(e,t,n,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,u=s-t,d=(n-t)/u,f=d*d,p=f*d,g=e*c,m=g-c,v=-2*p+3*f,y=p-f,b=1-v,_=y-f+d;for(let x=0;x!==a;x++){const w=o[m+x+a],T=o[m+x+l]*u,P=o[g+x+a],M=o[g+x]*u;r[x]=b*w+_*T+v*P+y*M}return r}}h(rv,"GLTFCubicSplineInterpolant");const p6=new Be;class bC extends rv{interpolate_(e,t,n,s){const r=super.interpolate_(e,t,n,s);return p6.fromArray(r).normalize().toArray(r),r}}h(bC,"GLTFCubicSplineQuaternionInterpolant");const qi={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},th={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},aw={9728:Cn,9729:ai,9984:If,9985:F0,9986:Df,9987:Ma},lw={33071:li,33648:Lu,10497:wr},cw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},h0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},jr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},m6={CUBICSPLINE:void 0,LINEAR:fa,STEP:Fl},Hm={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function g6(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new Pr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ha})),i.DefaultMaterial}h(g6,"createDefaultMaterial");function Pc(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}h(Pc,"addUnknownExtensionsToUserData");function qo(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}h(qo,"assignExtrasToUserData");function v6(i,e,t){let n=!1,s=!1,r=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(i);const o=[],a=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(n){const f=d.POSITION!==void 0?t.getDependency("accessor",d.POSITION):i.attributes.position;o.push(f)}if(s){const f=d.NORMAL!==void 0?t.getDependency("accessor",d.NORMAL):i.attributes.normal;a.push(f)}if(r){const f=d.COLOR_0!==void 0?t.getDependency("accessor",d.COLOR_0):i.attributes.color;l.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],f=c[2];return n&&(i.morphAttributes.position=u),s&&(i.morphAttributes.normal=d),r&&(i.morphAttributes.color=f),i.morphTargetsRelative=!0,i})}h(v6,"addMorphTargets");function y6(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}h(y6,"updateMorphTargets");function _6(i){const e=i.extensions&&i.extensions[pt.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+uw(e.attributes):t=i.indices+":"+uw(i.attributes)+":"+i.mode,t}h(_6,"createPrimitiveKey");function uw(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}h(uw,"createAttributesKey");function d0(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}h(d0,"getNormalizedComponentScale");function b6(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}h(b6,"getImageURIMimeType");class wC{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new f6,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,r=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap=="undefined"||n||s&&r<98?this.textureLoader=new Ap(this.options.manager):this.textureLoader=new SA(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ah(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:n,userData:{}};Pc(r,a,s),qo(a,s),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,r=t.length;s<r;s++){const o=t[s].joints;for(let a=0,l=o.length;a<l;a++)e[o[a]].isBone=!0}for(let s=0,r=e.length;s<r;s++){const o=e[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),r=h((o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,u]of o.children.entries())r(u,a.children[c])},"updateMappings");return r(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const r=e(t[s]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(r,o){return n.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[pt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){n.load(ys.resolveURL(t.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,r=t.byteOffset||0;return n.slice(r,r+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=cw[s.type],c=th[s.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,f=s.byteOffset||0,p=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,g=s.normalized===!0;let m,v;if(p&&p!==d){const y=Math.floor(f/p),b="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let _=t.cache.get(b);_||(m=new c(a,y*p,s.count*p/u),_=new cA(m,p/u),t.cache.add(b,_)),v=new bp(_,l,f%p/u,g)}else a===null?m=new c(s.count*l):m=new c(a,f,s.count*l),v=new Zt(m,l,g);if(s.sparse!==void 0){const y=cw.SCALAR,b=th[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,w=new b(o[1],_,s.sparse.count*y),T=new c(o[2],x,s.sparse.count*l);a!==null&&(v=new Zt(v.array.slice(),v.itemSize,v.normalized));for(let P=0,M=w.length;P<M;P++){const R=w[P];if(v.setX(R,T[P*l]),l>=2&&v.setY(R,T[P*l+1]),l>=3&&v.setZ(R,T[P*l+2]),l>=4&&v.setW(R,T[P*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const l=n.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const s=this,r=this.json,o=r.textures[e],a=r.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,n).then(function(u){u.flipY=!1,u.name=o.name||a.name||"";const f=(r.samplers||{})[o.sampler]||{};return u.magFilter=aw[f.magFilter]||ai,u.minFilter=aw[f.minFilter]||Ma,u.wrapS=lw[f.wrapS]||wr,u.wrapT=lw[f.wrapT]||wr,s.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const n=this,s=this.json,r=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const o=s.images[e],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=n.getDependency("bufferView",o.bufferView).then(function(d){c=!0;const f=new Blob([d],{type:o.mimeType});return l=a.createObjectURL(f),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(f,p){let g=f;t.isImageBitmapLoader===!0&&(g=h(function(m){const v=new Pn(m);v.needsUpdate=!0,f(v)},"onLoad")),t.load(ys.resolveURL(d,r.path),g,void 0,p)})}).then(function(d){return c===!0&&a.revokeObjectURL(l),d.userData.mimeType=o.mimeType||b6(o.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,t,n,s){const r=this;return this.getDependency("texture",n.index).then(function(o){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r.extensions[pt.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[pt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[pt.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.encoding=s),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,r=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new mr,gi.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(a,l)),n=l}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let l=this.cache.get(a);l||(l=new $n,gi.prototype.copy.call(l,n),l.color.copy(n.color),this.cache.add(a,l)),n=l}if(s||r||o){let a="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=n.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(n))),n=l}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return Pr}loadMaterial(e){const t=this,n=this.json,s=this.extensions,r=n.materials[e];let o;const a={},l=r.extensions||{},c=[];if(l[pt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const d=s[pt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else if(l[pt.KHR_MATERIALS_UNLIT]){const d=s[pt.KHR_MATERIALS_UNLIT];o=d.getMaterialType(),c.push(d.extendParams(a,r,t))}else{const d=r.pbrMetallicRoughness||{};if(a.color=new Te(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const f=d.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}d.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",d.baseColorTexture,bt)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}r.doubleSided===!0&&(a.side=Ci);const u=r.alphaMode||Hm.OPAQUE;if(u===Hm.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Hm.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==hi&&(c.push(t.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new je(1,1),r.normalTexture.scale!==void 0)){const d=r.normalTexture.scale;a.normalScale.set(d,d)}return r.occlusionTexture!==void 0&&o!==hi&&(c.push(t.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==hi&&(a.emissive=new Te().fromArray(r.emissiveFactor)),r.emissiveTexture!==void 0&&o!==hi&&c.push(t.assignTexture(a,"emissiveMap",r.emissiveTexture,bt)),Promise.all(c).then(function(){let d;return o===jf?d=s[pt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):d=new o(a),r.name&&(d.name=r.name),qo(d,r),t.associations.set(d,{materials:e}),r.extensions&&Pc(s,d,r),d})}createUniqueName(e){const t=ft.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function r(a){return n[pt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return hw(l,a,t)})}h(r,"createDracoPrimitive");const o=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],u=_6(c),d=s[u];if(d)o.push(d.promise);else{let f;c.extensions&&c.extensions[pt.KHR_DRACO_MESH_COMPRESSION]?f=r(c):f=hw(new et,c,t),s[u]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,n=this.json,s=this.extensions,r=n.meshes[e],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const u=o[l].material===void 0?g6(this.cache):this.getDependency("material",o[l].material);a.push(u)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let p=0,g=u.length;p<g;p++){const m=u[p],v=o[p];let y;const b=c[p];if(v.mode===qi.TRIANGLES||v.mode===qi.TRIANGLE_STRIP||v.mode===qi.TRIANGLE_FAN||v.mode===void 0)y=r.isSkinnedMesh===!0?new j0(m,b):new Re(m,b),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),v.mode===qi.TRIANGLE_STRIP?y.geometry=dw(y.geometry,LR):v.mode===qi.TRIANGLE_FAN&&(y.geometry=dw(y.geometry,BM));else if(v.mode===qi.LINES)y=new Ws(m,b);else if(v.mode===qi.LINE_STRIP)y=new vn(m,b);else if(v.mode===qi.LINE_LOOP)y=new dA(m,b);else if(v.mode===qi.POINTS)y=new la(m,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(y.geometry.morphAttributes).length>0&&y6(y,r),y.name=t.createUniqueName(r.name||"mesh_"+e),qo(y,r),v.extensions&&Pc(s,y,v),t.assignFinalMaterial(y),d.push(y)}for(let p=0,g=d.length;p<g;p++)t.associations.set(d[p],{meshes:e,primitives:p});if(d.length===1)return d[0];const f=new di;t.associations.set(f,{meshes:e});for(let p=0,g=d.length;p<g;p++)f.add(d[p]);return f})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Fn(Zi.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new yo(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),qo(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return n.inverseBindMatrices=s,n})}loadAnimation(e){const n=this.json.animations[e],s=[],r=[],o=[],a=[],l=[];for(let c=0,u=n.channels.length;c<u;c++){const d=n.channels[c],f=n.samplers[d.sampler],p=d.target,g=p.node,m=n.parameters!==void 0?n.parameters[f.input]:f.input,v=n.parameters!==void 0?n.parameters[f.output]:f.output;s.push(this.getDependency("node",g)),r.push(this.getDependency("accessor",m)),o.push(this.getDependency("accessor",v)),a.push(f),l.push(p)}return Promise.all([Promise.all(s),Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],f=c[2],p=c[3],g=c[4],m=[];for(let y=0,b=u.length;y<b;y++){const _=u[y],x=d[y],w=f[y],T=p[y],P=g[y];if(_===void 0)continue;_.updateMatrix();let M;switch(jr[P.path]){case jr.weights:M=ma;break;case jr.rotation:M=Mr;break;case jr.position:case jr.scale:default:M=ga;break}const R=_.name?_.name:_.uuid,L=T.interpolation!==void 0?m6[T.interpolation]:fa,W=[];jr[P.path]===jr.weights?_.traverse(function(z){z.morphTargetInfluences&&W.push(z.name?z.name:z.uuid)}):W.push(R);let k=w.array;if(w.normalized){const z=d0(k.constructor),S=new Float32Array(k.length);for(let B=0,ne=k.length;B<ne;B++)S[B]=k[B]*z;k=S}for(let z=0,S=W.length;z<S;z++){const B=new M(W[z]+"."+jr[P.path],x.array,k,L);T.interpolation==="CUBICSPLINE"&&(B.createInterpolant=h(function(K){const ie=this instanceof Mr?bC:rv;return new ie(this.times,this.values,this.getValueSize()/3,K)},"InterpolantFactoryMethodGLTFCubicSpline"),B.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(B)}}const v=n.name?n.name:"animation_"+e;return new K0(v,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(r){const o=n._getNodeRef(n.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(!!a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(e){const t=this.json,n=this.extensions,s=this,r=t.nodes[e],o=r.name?s.createUniqueName(r.name):"";return function(){const a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),Promise.all(a)}().then(function(a){let l;if(r.isBone===!0?l=new Fu:a.length>1?l=new di:a.length===1?l=a[0]:l=new vt,l!==a[0])for(let c=0,u=a.length;c<u;c++)l.add(a[c]);if(r.name&&(l.userData.name=r.name,l.name=o),qo(l,r),r.extensions&&Pc(n,l,r),r.matrix!==void 0){const c=new ve;c.fromArray(r.matrix),l.applyMatrix4(c)}else r.translation!==void 0&&l.position.fromArray(r.translation),r.rotation!==void 0&&l.quaternion.fromArray(r.rotation),r.scale!==void 0&&l.scale.fromArray(r.scale);return s.associations.has(l)||s.associations.set(l,{}),s.associations.get(l).nodes=e,l})}loadScene(e){const t=this.json,n=this.extensions,s=this.json.scenes[e],r=this,o=new di;s.name&&(o.name=r.createUniqueName(s.name)),qo(o,s),s.extensions&&Pc(n,o,s);const a=s.nodes||[],l=[];for(let c=0,u=a.length;c<u;c++)l.push(xC(a[c],o,t,r));return Promise.all(l).then(function(){const c=h(u=>{const d=new Map;for(const[f,p]of r.associations)(f instanceof gi||f instanceof Pn)&&d.set(f,p);return u.traverse(f=>{const p=r.associations.get(f);p!=null&&d.set(f,p)}),d},"reduceAssociations");return r.associations=c(o),o})}}h(wC,"GLTFParser");function xC(i,e,t,n){const s=t.nodes[i];return n.getDependency("node",i).then(function(r){if(s.skin===void 0)return r;let o;return n.getDependency("skin",s.skin).then(function(a){o=a;const l=[];for(let c=0,u=o.joints.length;c<u;c++)l.push(n.getDependency("node",o.joints[c]));return Promise.all(l)}).then(function(a){return r.traverse(function(l){if(!l.isMesh)return;const c=[],u=[];for(let d=0,f=a.length;d<f;d++){const p=a[d];if(p){c.push(p);const g=new ve;o.inverseBindMatrices!==void 0&&g.fromArray(o.inverseBindMatrices.array,d*16),u.push(g)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',o.joints[d])}l.bind(new rh(c,u),l.matrixWorld)}),r})}).then(function(r){e.add(r);const o=[];if(s.children){const a=s.children;for(let l=0,c=a.length;l<c;l++){const u=a[l];o.push(xC(u,r,t,n))}}return Promise.all(o)})}h(xC,"buildNodeHierarchy");function w6(i,e,t){const n=e.attributes,s=new zn;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(s.set(new A(l[0],l[1],l[2]),new A(c[0],c[1],c[2])),a.normalized){const u=d0(th[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=e.targets;if(r!==void 0){const a=new A,l=new A;for(let c=0,u=r.length;c<u;c++){const d=r[c];if(d.POSITION!==void 0){const f=t.json.accessors[d.POSITION],p=f.min,g=f.max;if(p!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(p[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(p[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(p[2]),Math.abs(g[2]))),f.normalized){const m=d0(th[f.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}i.boundingBox=s;const o=new go;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=o}h(w6,"computeBounds");function hw(i,e,t){const n=e.attributes,s=[];function r(o,a){return t.getDependency("accessor",o).then(function(l){i.setAttribute(a,l)})}h(r,"assignAttributeAccessor");for(const o in n){const a=h0[o]||o.toLowerCase();a in i.attributes||s.push(r(n[o],a))}if(e.indices!==void 0&&!i.index){const o=t.getDependency("accessor",e.indices).then(function(a){i.setIndex(a)});s.push(o)}return qo(i,e),w6(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?v6(i,e.targets,t):i})}h(hw,"addPrimitiveAttributes");function dw(i,e){let t=i.getIndex();if(t===null){const o=[],a=i.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);i.setIndex(o),t=i.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(e===BM)for(let o=1;o<=n;o++)s.push(t.getX(0)),s.push(t.getX(o)),s.push(t.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(s.push(t.getX(o)),s.push(t.getX(o+1)),s.push(t.getX(o+2))):(s.push(t.getX(o+2)),s.push(t.getX(o+1)),s.push(t.getX(o)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=i.clone();return r.setIndex(s),r}h(dw,"toTrianglesDrawMode");const x6=/^[og]\s*(.+)?/,M6=/^mtllib /,A6=/^usemtl /,S6=/^usemap /,fw=/\s+/,pw=new A,Gm=new A,mw=new A,gw=new A,$i=new A,yd=new Te;function C6(){const i={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,r){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:s||"",mtllib:Array.isArray(r)&&r.length>0?r[r.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const r=this.currentMaterial();if(r&&r.groupEnd===-1&&(r.groupEnd=this.geometry.vertices.length/3,r.groupCount=r.groupEnd-r.groupStart,r.inherited=!1),s&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),r}},n&&n.name&&typeof n.clone=="function"){const s=n.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseNormalIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/3)*3},parseUVIndex:function(e,t){const n=parseInt(e,10);return(n>=0?n-1:n+t/2)*2},addVertex:function(e,t,n){const s=this.vertices,r=this.object.geometry.vertices;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const s=this.normals,r=this.object.geometry.normals;r.push(s[e+0],s[e+1],s[e+2]),r.push(s[t+0],s[t+1],s[t+2]),r.push(s[n+0],s[n+1],s[n+2])},addFaceNormal:function(e,t,n){const s=this.vertices,r=this.object.geometry.normals;pw.fromArray(s,e),Gm.fromArray(s,t),mw.fromArray(s,n),$i.subVectors(mw,Gm),gw.subVectors(pw,Gm),$i.cross(gw),$i.normalize(),r.push($i.x,$i.y,$i.z),r.push($i.x,$i.y,$i.z),r.push($i.x,$i.y,$i.z)},addColor:function(e,t,n){const s=this.colors,r=this.object.geometry.colors;s[e]!==void 0&&r.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&r.push(s[t+0],s[t+1],s[t+2]),s[n]!==void 0&&r.push(s[n+0],s[n+1],s[n+2])},addUV:function(e,t,n){const s=this.uvs,r=this.object.geometry.uvs;r.push(s[e+0],s[e+1]),r.push(s[t+0],s[t+1]),r.push(s[n+0],s[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,s,r,o,a,l,c){const u=this.vertices.length;let d=this.parseVertexIndex(e,u),f=this.parseVertexIndex(t,u),p=this.parseVertexIndex(n,u);if(this.addVertex(d,f,p),this.addColor(d,f,p),a!==void 0&&a!==""){const g=this.normals.length;d=this.parseNormalIndex(a,g),f=this.parseNormalIndex(l,g),p=this.parseNormalIndex(c,g),this.addNormal(d,f,p)}else this.addFaceNormal(d,f,p);if(s!==void 0&&s!==""){const g=this.uvs.length;d=this.parseUVIndex(s,g),f=this.parseUVIndex(r,g),p=this.parseUVIndex(o,g),this.addUV(d,f,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,s=e.length;n<s;n++){const r=this.parseVertexIndex(e[n],t);this.addVertexPoint(r),this.addColor(r)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,s=this.uvs.length;for(let r=0,o=e.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(let r=0,o=t.length;r<o;r++)this.addUVLine(this.parseUVIndex(t[r],s))}};return i.startObject("",!1),i}h(C6,"ParserState");class MC extends bo{constructor(e){super(e),this.materials=null}load(e,t,n,s){const r=this,o=new ah(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(r.parse(a))}catch(l){s?s(l):console.error(l),r.manager.itemError(e)}},n,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new C6;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let s=[];for(let a=0,l=n.length;a<l;a++){const c=n[a].trimStart();if(c.length===0)continue;const u=c.charAt(0);if(u!=="#")if(u==="v"){const d=c.split(fw);switch(d[0]){case"v":t.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7?(yd.setRGB(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6])).convertSRGBToLinear(),t.colors.push(yd.r,yd.g,yd.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":t.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(u==="f"){const f=c.slice(1).trim().split(fw),p=[];for(let m=0,v=f.length;m<v;m++){const y=f[m];if(y.length>0){const b=y.split("/");p.push(b)}}const g=p[0];for(let m=1,v=p.length-1;m<v;m++){const y=p[m],b=p[m+1];t.addFace(g[0],y[0],b[0],g[1],y[1],b[1],g[2],y[2],b[2])}}else if(u==="l"){const d=c.substring(1).trim().split(" ");let f=[];const p=[];if(c.indexOf("/")===-1)f=d;else for(let g=0,m=d.length;g<m;g++){const v=d[g].split("/");v[0]!==""&&f.push(v[0]),v[1]!==""&&p.push(v[1])}t.addLineGeometry(f,p)}else if(u==="p"){const f=c.slice(1).trim().split(" ");t.addPointGeometry(f)}else if((s=x6.exec(c))!==null){const d=(" "+s[0].slice(1).trim()).slice(1);t.startObject(d)}else if(A6.test(c))t.object.startMaterial(c.substring(7).trim(),t.materialLibraries);else if(M6.test(c))t.materialLibraries.push(c.substring(7).trim());else if(S6.test(c))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(s=c.split(" "),s.length>1){const f=s[1].trim().toLowerCase();t.object.smooth=f!=="0"&&f!=="off"}else t.object.smooth=!0;const d=t.object.currentMaterial();d&&(d.smooth=t.object.smooth)}else{if(c==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+c+'"')}}t.finalize();const r=new di;if(r.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,l=t.objects.length;a<l;a++){const c=t.objects[a],u=c.geometry,d=c.materials,f=u.type==="Line",p=u.type==="Points";let g=!1;if(u.vertices.length===0)continue;const m=new et;m.setAttribute("position",new Fe(u.vertices,3)),u.normals.length>0&&m.setAttribute("normal",new Fe(u.normals,3)),u.colors.length>0&&(g=!0,m.setAttribute("color",new Fe(u.colors,3))),u.hasUVIndices===!0&&m.setAttribute("uv",new Fe(u.uvs,2));const v=[];for(let b=0,_=d.length;b<_;b++){const x=d[b],w=x.name+"_"+x.smooth+"_"+g;let T=t.materials[w];if(this.materials!==null){if(T=this.materials.create(x.name),f&&T&&!(T instanceof $n)){const P=new $n;gi.prototype.copy.call(P,T),P.color.copy(T.color),T=P}else if(p&&T&&!(T instanceof mr)){const P=new mr({size:10,sizeAttenuation:!1});gi.prototype.copy.call(P,T),P.color.copy(T.color),P.map=T.map,T=P}}T===void 0&&(f?T=new $n:p?T=new mr({size:1,sizeAttenuation:!1}):T=new _u,T.name=x.name,T.flatShading=!x.smooth,T.vertexColors=g,t.materials[w]=T),v.push(T)}let y;if(v.length>1){for(let b=0,_=d.length;b<_;b++){const x=d[b];m.addGroup(x.groupStart,x.groupCount,b)}f?y=new Ws(m,v):p?y=new la(m,v):y=new Re(m,v)}else f?y=new Ws(m,v[0]):p?y=new la(m,v[0]):y=new Re(m,v[0]);y.name=c.name,r.add(y)}else if(t.vertices.length>0){const a=new mr({size:1,sizeAttenuation:!1}),l=new et;l.setAttribute("position",new Fe(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(l.setAttribute("color",new Fe(t.colors,3)),a.vertexColors=!0);const c=new la(l,a);r.add(c)}return r}}h(MC,"OBJLoader");var T6=Object.defineProperty,E6=h((i,e)=>T6(i,"name",{value:e,configurable:!0}),"__name$1a");class ov{update(e,t){if(!t.instanceId){if(t.has(fo)){const n=t.get(fo);if(!n.dirty||(n.dirty=!1,!n.value))return;const s=t.get(Ce);s.dispose(),s.value=new MC().parse(n.value),s.value.userData={node:t};for(let r of s.value.children)r.userData={node:t};s.parentChanged=!0,s.localTransformChanged=!0,e.model.instanceMeshUpdated(t.id,!0)}else if(t.has(ho)){const n=t.get(ho);if(!n.dirty||(n.dirty=!1,!n.value))return;const s=t.get(Ce);s.dispose(),l1(n.value).then(function(r){if(t.deleted)return;s.value=new W2().parse(r,void 0);const o=[s.value];for(;o.length;){const a=o.pop();if(!a)break;a.userData={node:t},o.push(...a.children)}s.parentChanged=!0,s.localTransformChanged=!0,t.dirty=!0,e.model.dirty=!0,e.model.instanceMeshUpdated(t.id,!0)})}else if(t.has(Ar)){const n=t.get(Ar);if(!n.dirty||(n.dirty=!1,!n.value.length))return;const s=t.get(Ce);s.dispose(),console.info("Loading gltf zip"),LU.loadAsync(n.value).then(async function(r){if(t.deleted)return;const o=Object.values(r.files).filter(f=>!f.dir),a=o.find(f=>f.name.toLocaleLowerCase().endsWith(".gltf"));if(!a){console.error("Failed to find entry file");return}const l={};for(let f of o){console.info(`Loading ${f.name}`);const p=await f.async("blob");if(t.deleted)return;l[f.name]=URL.createObjectURL(p)}const c=new q0;c.setURLModifier(f=>{const p=new URL(f),g=p.pathname.replace(p.origin+"/","");return l[g]||f});const u=new J2(c),d=l[a.name];u.load(d,f=>{if(t.deleted)return;s.value=f.scene;const p=[f.scene];for(;p.length;){const g=p.pop();if(!g)break;g.userData={node:t},p.push(...g.children)}s.parentChanged=!0,s.localTransformChanged=!0,t.dirty=!0,e.model.dirty=!0,e.model.instanceMeshUpdated(t.id,!0)})})}}}}h(ov,"ImportModelUpdateFilter");E6(ov,"ImportModelUpdateFilter");var P6=Object.defineProperty,R6=h((i,e)=>P6(i,"name",{value:e,configurable:!0}),"__name$19");class av{update(e,t){if(t.instanceId){const n=e.model.getNode(t.instanceId);for(let s in t.components)vi(s).autoCopy&&(t.components[s].value=n.components[s].value)}}}h(av,"InstanceNodeUpdateFilter");R6(av,"InstanceNodeUpdateFilter");var I6=Object.defineProperty,D6=h((i,e)=>I6(i,"name",{value:e,configurable:!0}),"__name$18");class lv{update(e,t){if(t.has(pi)){const n=t.get(pi),s=n.value;s&&s.update();const r=n.camera;r&&r.update()}}}h(lv,"LightHelperUpdateFilter");D6(lv,"LightHelperUpdateFilter");var L6=Object.defineProperty,k6=h((i,e)=>L6(i,"name",{value:e,configurable:!0}),"__name$17");class cv{update(e,t){var n,s,r,o;switch(t.type){case"AmbientLight":{const a=t.get(Ce);a.value||(a.value=new Tp);const l=a.value,c=t.value(gn);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(oi)}break;case"HemisphereLight":{const a=t.get(Ce);a.value||(a.value=new wA);const l=a.value,c=t.value(Xu);l.color.setRGB(c[0],c[1],c[2]);const u=t.value(Hu);l.groundColor.setRGB(u[0],u[1],u[2]),l.intensity=t.value(oi);const d=t.get(pi);d.value||(d.value=new RA(l,.25),e.scene.add(d.value))}break;case"DirectionalLight":{const a=t.get(Ce);a.value||(a.value=new lh);const l=a.value;l.castShadow=t.value(pn);const c=t.value(gn);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(oi);const u=Number.parseInt(t.value(_r));l.shadow.mapSize.x!==u&&(l.shadow.mapSize.set(u,u),(n=l.shadow.map)==null||n.setSize(u,u),(s=l.shadow.mapPass)==null||s.setSize(u,u),l.shadow.dispose());const d=t.value($u)/2;l.shadow.camera.top=+d,l.shadow.camera.right=+d,l.shadow.camera.bottom=-d,l.shadow.camera.left=-d,l.shadow.camera.near=0,l.shadow.camera.updateProjectionMatrix();const f=t.get(pi);f.value||(f.value=new IA(l),e.scene.add(f.value)),f.camera||(f.camera=new DA(l.shadow.camera),e.scene.add(f.camera));const g=t.children[0].get(Ce);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break;case"PointLight":{const a=t.get(Ce);let l=a.value;const c=Number.parseInt(t.value(_r));l&&l.shadow.mapSize.x!==c&&(l.dispose(),l.removeFromParent(),a.value=null,a.localTransformChanged=!0,a.worldTransformChanged=!0,a.parentChanged=!0),a.value||(l=a.value=new zu,l.shadow.mapSize.set(c,c)),l.castShadow=t.value(pn);const u=t.value(gn);l.color.setRGB(u[0],u[1],u[2]),l.intensity=t.value(oi);const d=.005;l.shadow.camera.near!==d&&(l.shadow.camera.near=d,l.shadow.camera.updateProjectionMatrix());const f=t.get(pi);let p=f.value;p&&p.light!==l&&(p.dispose(),p.removeFromParent(),f.value=null),f.value||(f.value=new PA(l,.25),e.scene.add(f.value))}break;case"SpotLight":{const a=t.get(Ce);a.value||(a.value=new Cp);const l=a.value;l.castShadow=t.value(pn);const c=t.value(gn);l.color.setRGB(c[0],c[1],c[2]),l.intensity=t.value(oi),l.angle=t.value(Yu)/180*Math.PI,l.penumbra=t.value(ju);const u=Number.parseInt(t.value(_r));l.shadow.mapSize.x!==u&&(l.shadow.mapSize.set(u,u),(r=l.shadow.map)==null||r.setSize(u,u),(o=l.shadow.mapPass)==null||o.setSize(u,u),l.shadow.dispose());const d=.005;l.shadow.camera.near!==d&&(l.shadow.camera.near=d,l.shadow.camera.updateProjectionMatrix());const f=t.get(pi);f.value||(f.value=new EA(l),e.scene.add(f.value));const g=t.children[0].get(Ce);g.parentChanged=!1,g.value||(g.value=l.target,e.scene.add(g.value))}break}}}h(cv,"LightUpdateFilter");k6(cv,"LightUpdateFilter");var O6=Object.defineProperty,N6=h((i,e)=>O6(i,"name",{value:e,configurable:!0}),"__name$16");class uv{update(e,t){if(!t.instanceId&&t.has(Ce)){const n=t.value(Ce);if(!n)return;if(t.has(po)){const s=t.value(po);t.get(Ce).usePlainMaterial=s;const r=[n];for(;r.length;){const o=r.pop();if(!o)break;const a=o;a.isMesh&&(s?(a.__plainMaterial||(a.__originalMaterial=a.material,a.__plainMaterial=new Pr),a.material=a.__plainMaterial,this.updateMaterial(t,a.__plainMaterial)):a.__originalMaterial&&(a.material=a.__originalMaterial)),r.push(...o.children)}}else{if(!n.isMesh)return;const s=n.material;if(!(s!=null&&s.isMeshStandardMaterial))return;this.updateMaterial(t,s)}}}updateMaterial(e,t){if(e.has(gn)){const n=e.value(gn);t.color.setRGB(n[0],n[1],n[2])}if(e.has(Fs)){const n=e.value(Fs);t.emissive.setRGB(n[0],n[1],n[2])}e.has(Bs)&&(t.roughness=e.value(Bs)),e.has(zs)&&(t.metalness=e.value(zs))}}h(uv,"MaterialUpdateFilter");N6(uv,"MaterialUpdateFilter");class yh extends Re{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Fn;const n=this,s=t.color!==void 0?new Te(t.color):new Te(8355711),r=t.textureWidth||512,o=t.textureHeight||512,a=t.clipBias||0,l=t.shader||yh.ReflectorShader,c=t.multisample!==void 0?t.multisample:4,u=new dr,d=new A,f=new A,p=new A,g=new ve,m=new A(0,0,-1),v=new wt,y=new A,b=new A,_=new wt,x=new ve,w=this.camera,T=new Hn(r,o,{samples:c,type:Ol}),P=new Zn({uniforms:vp.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});P.uniforms.tDiffuse.value=T.texture,P.uniforms.color.value=s,P.uniforms.textureMatrix.value=x,this.material=P,this.onBeforeRender=function(M,R,L){if(f.setFromMatrixPosition(n.matrixWorld),p.setFromMatrixPosition(L.matrixWorld),g.extractRotation(n.matrixWorld),d.set(0,0,1),d.applyMatrix4(g),y.subVectors(f,p),y.dot(d)>0)return;y.reflect(d).negate(),y.add(f),g.extractRotation(L.matrixWorld),m.set(0,0,-1),m.applyMatrix4(g),m.add(p),b.subVectors(f,m),b.reflect(d).negate(),b.add(f),w.position.copy(y),w.up.set(0,1,0),w.up.applyMatrix4(g),w.up.reflect(d),w.lookAt(b),w.far=L.far,w.updateMatrixWorld(),w.projectionMatrix.copy(L.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(w.projectionMatrix),x.multiply(w.matrixWorldInverse),x.multiply(n.matrixWorld),u.setFromNormalAndCoplanarPoint(d,f),u.applyMatrix4(w.matrixWorldInverse),v.set(u.normal.x,u.normal.y,u.normal.z,u.constant);const W=w.projectionMatrix;_.x=(Math.sign(v.x)+W.elements[8])/W.elements[0],_.y=(Math.sign(v.y)+W.elements[9])/W.elements[5],_.z=-1,_.w=(1+W.elements[10])/W.elements[14],v.multiplyScalar(2/v.dot(_)),W.elements[2]=v.x,W.elements[6]=v.y,W.elements[10]=v.z+1-a,W.elements[14]=v.w,n.visible=!1;const k=M.getRenderTarget(),z=M.xr.enabled,S=M.shadowMap.autoUpdate,B=M.outputEncoding,ne=M.toneMapping;M.xr.enabled=!1,M.shadowMap.autoUpdate=!1,M.outputEncoding=xr,M.toneMapping=Vs,M.setRenderTarget(T),M.state.buffers.depth.setMask(!0),M.autoClear===!1&&M.clear(),M.render(R,w),M.xr.enabled=z,M.shadowMap.autoUpdate=S,M.outputEncoding=B,M.toneMapping=ne,M.setRenderTarget(k);const K=L.viewport;K!==void 0&&M.state.viewport(K),n.visible=!0},this.getRenderTarget=function(){return T},this.dispose=function(){T.dispose(),n.material.dispose()}}}h(yh,"Reflector");yh.ReflectorShader={uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <encodings_fragment>

		}`};var F6=Object.defineProperty,z6=h((i,e)=>F6(i,"name",{value:e,configurable:!0}),"__name$15");class hv{update(e,t){if(t.type!=="Mirror")return;const n=t.value(qu),s=t.value(Gu),r=t.get(Ce);if(!r.value){const d=t.value(gn);r.value=new yh(new pa(n,s),{color:new Te().setRGB(d[0],d[1],d[2])}),r.value.userData.node=t;return}const o=r.value,a=o.geometry;(a.parameters.width!==n||a.parameters.height!==s)&&(a.dispose(),r.value.geometry=new pa(n,s));const l=o.material.uniforms.color.value,c=t.value(gn);l.setRGB(c[0],c[1],c[2]);const u=Number.parseInt(t.value(Ku));o.getRenderTarget().setSize(u,u)}}h(hv,"MirrorUpdateFilter");z6(hv,"MirrorUpdateFilter");var B6=Object.defineProperty,U6=h((i,e)=>B6(i,"name",{value:e,configurable:!0}),"__name$14");class dv{update(e,t){if(t.has(Ce)){const n=t.get(Ce);if(n.parentChanged){const r=n.value;if(r){r.removeFromParent();const o=qe(t.parent);if(o){if(o.has(Ce)){const a=o.value(Ce);a&&a.add(r)}}else e.scene.add(r)}n.parentChanged=!1}const s=t.has(zt)?t.value(zt):!0;n.value&&(n.value.visible=s)}}}h(dv,"Object3DRelationshipUpdateFilter");U6(dv,"Object3DRelationshipUpdateFilter");var V6=Object.defineProperty,AC=h((i,e)=>V6(i,"name",{value:e,configurable:!0}),"__name$13");function fv(i,e){const t=i;if(t.isMesh)if(Array.isArray(t.material))for(let n of t.material)n.opacity!==e&&(n.opacity=e,n.transparent=n.opacity<1,n.needsUpdate=!0);else t.material.opacity!==e&&(t.material.opacity=e,t.material.transparent=t.material.opacity<1,t.material.needsUpdate=!0);for(let n of i.children)fv(n,e)}h(fv,"setOpacity");AC(fv,"setOpacity");class pv{update(e,t){if(t.instanceId)return;if(t.opacity=(t.parent?t.parent.opacity:1)*(t.has(Un)?t.value(Un):1),jn(t.type).mesh){const s=t.get(Ce);s.value&&fv(s.value,t.opacity)}}}h(pv,"OpacityUpdateFilter");AC(pv,"OpacityUpdateFilter");var H6=Object.defineProperty,G6=h((i,e)=>H6(i,"name",{value:e,configurable:!0}),"__name$12");class mv{update(e,t){if(!t.has(Ce)||!t.has(pn)&&!t.has(ri))return;const n=t.value(Ce);if(!n)return;const s=t.has(pn)?t.value(pn):null,r=t.has(ri)?t.value(ri):null,o=[n];for(;o.length;){const a=o.pop();if(!a)break;s!=null&&(a.castShadow=s),r!=null&&(a.receiveShadow=r),o.push(...a.children)}}}h(mv,"ShadowUpdateFilter");G6(mv,"ShadowUpdateFilter");var W6=Object.defineProperty,j6=h((i,e)=>W6(i,"name",{value:e,configurable:!0}),"__name$11");class gv{update(e,t){if(t.has(Ce)){const n=t.get(Ce),s=n.value;if(s){if(n.localTransformChanged){if(t.has(Ue)&&s.position.copy(t.value(Ue)),t.has(lt)&&s.rotation.copy(t.value(lt)),t.has(Ft)&&(s.scale.x=s.scale.y=s.scale.z=t.value(Ft)),t.has(Sr)&&s.scale.multiply(t.value(Sr)),t.has(mt)){const r=t.get(mt);s.position.copy(r.start),s.quaternion.copy(r.quaternion)}s.updateMatrix(),n.localTransformChanged=!1}n.worldTransformChanged&&(s.updateMatrixWorld(!0),n.worldTransformChanged=!1,t.forEach(r=>{if(r.has(ot)){const o=r.get(ot);o.group&&(o.group.matrixAutoUpdate=!1,o.group.matrix.copy(r.getWorldMatrix()))}}))}}}}h(gv,"TransformUpdateFilter");j6(gv,"TransformUpdateFilter");class Ip extends et{constructor(e=(s,r,o)=>o.set(s,r,Math.cos(s)*Math.sin(r)),t=8,n=8){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const s=[],r=[],o=[],a=[],l=1e-5,c=new A,u=new A,d=new A,f=new A,p=new A,g=t+1;for(let m=0;m<=n;m++){const v=m/n;for(let y=0;y<=t;y++){const b=y/t;e(b,v,u),r.push(u.x,u.y,u.z),b-l>=0?(e(b-l,v,d),f.subVectors(u,d)):(e(b+l,v,d),f.subVectors(d,u)),v-l>=0?(e(b,v-l,d),p.subVectors(u,d)):(e(b,v+l,d),p.subVectors(d,u)),c.crossVectors(f,p).normalize(),o.push(c.x,c.y,c.z),a.push(b,v)}}for(let m=0;m<n;m++)for(let v=0;v<t;v++){const y=m*g+v,b=m*g+v+1,_=(m+1)*g+v+1,x=(m+1)*g+v;s.push(y,b,x),s.push(b,_,x)}this.setIndex(s),this.setAttribute("position",new Fe(r,3)),this.setAttribute("normal",new Fe(o,3)),this.setAttribute("uv",new Fe(a,2))}}h(Ip,"ParametricGeometry");const Xl={klein:function(i,e,t){e*=Math.PI,i*=2*Math.PI,e=e*2;let n,s;e<Math.PI?(n=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(e)*Math.cos(i),s=-8*Math.sin(e)-2*(1-Math.cos(e)/2)*Math.sin(e)*Math.cos(i)):(n=3*Math.cos(e)*(1+Math.sin(e))+2*(1-Math.cos(e)/2)*Math.cos(i+Math.PI),s=-8*Math.sin(e));const r=-2*(1-Math.cos(e)/2)*Math.sin(i);t.set(n,r,s)},plane:function(i,e){return function(t,n,s){const r=t*i,o=0,a=n*e;s.set(r,o,a)}},mobius:function(i,e,t){i=i-.5;const n=2*Math.PI*e,s=2,r=Math.cos(n)*(s+i*Math.cos(n/2)),o=Math.sin(n)*(s+i*Math.cos(n/2)),a=i*Math.sin(n/2);t.set(r,o,a)},mobius3d:function(i,e,t){i*=Math.PI,e*=2*Math.PI,i=i*2;const n=i/2,s=2.25,r=.125,o=.65;let a=r*Math.cos(e)*Math.cos(n)-o*Math.sin(e)*Math.sin(n);const l=r*Math.cos(e)*Math.sin(n)+o*Math.sin(e)*Math.cos(n),c=(s+a)*Math.sin(i);a=(s+a)*Math.cos(i),t.set(a,c,l)}};Xl.TubeGeometry=h(class extends Ip{constructor(e,t=64,n=1,s=8,r=!1){const o=t+1,a=e.computeFrenetFrames(t,r),l=a.tangents,c=a.normals,u=a.binormals,d=new A;function f(p,g,m){g*=2*Math.PI;const v=Math.floor(p*(o-1));e.getPointAt(p,d);const y=c[v],b=u[v],_=-n*Math.cos(g),x=n*Math.sin(g);d.x+=_*y.x+x*b.x,d.y+=_*y.y+x*b.y,d.z+=_*y.z+x*b.z,m.copy(d)}h(f,"ParametricTube"),super(f,t,s),this.tangents=l,this.normals=c,this.binormals=u,this.path=e,this.segments=t,this.radius=n,this.segmentsRadius=s,this.closed=r}},"TubeGeometry");Xl.TorusKnotGeometry=h(class extends Xl.TubeGeometry{constructor(e=200,t=40,n=64,s=8,r=2,o=3){class a extends $0{getPoint(f,p=new A){const g=p;f*=Math.PI*2;const m=.5,v=(1+m*Math.cos(o*f))*Math.cos(r*f),y=(1+m*Math.cos(o*f))*Math.sin(r*f),b=m*Math.sin(o*f);return g.set(v,y,b).multiplyScalar(e)}}h(a,"TorusKnotCurve");const l=n,c=s,u=new a;super(u,l,t,c,!0,!1),this.radius=e,this.tube=t,this.segmentsT=n,this.segmentsR=s,this.p=r,this.q=o}},"TorusKnotGeometry");Xl.SphereGeometry=h(class extends Ip{constructor(e,t,n){function s(r,o,a){r*=Math.PI,o*=2*Math.PI;const l=e*Math.sin(r)*Math.cos(o),c=e*Math.sin(r)*Math.sin(o),u=e*Math.cos(r);a.set(l,c,u)}h(s,"sphere"),super(s,t,n)}},"SphereGeometry");Xl.PlaneGeometry=h(class extends Ip{constructor(e,t,n,s){function r(o,a,l){const c=o*e,u=0,d=a*t;l.set(c,u,d)}h(r,"plane"),super(r,n,s)}},"PlaneGeometry");var $6=Object.defineProperty,X6=h((i,e)=>$6(i,"name",{value:e,configurable:!0}),"__name$10");function $f(i=1,e=20){const t=[];let n=0,s=i;const r=Math.PI*2/e,o=Math.cos(r),a=Math.sin(r);for(let l=0;l<e;++l){const c=n*o-s*a,u=n*a+s*o;t.push(new A(n,s,0),new A(c,u,0)),n=c,s=u}return t}h($f,"xyCirclePoints");X6($f,"xyCirclePoints");var Y6=Object.defineProperty,K6=h((i,e)=>Y6(i,"name",{value:e,configurable:!0}),"__name$$");class Dp extends et{constructor(e=1,t=20){super(),this.setFromPoints($f(e,t)),this.type="CircleEdgeGeometry"}}h(Dp,"CircleEdgeGeometry");K6(Dp,"CircleEdgeGeometry");var q6=Object.defineProperty,Z6=h((i,e)=>q6(i,"name",{value:e,configurable:!0}),"__name$_");const Q6=Xl.SphereGeometry,J6=new Q6(1,20,20),e8=new Dp,t8=new et().setFromPoints([new A,new A(1,0,0)]),n8=new A(1,0,0),Wm=new A;class vv{update(e,t){if(!t.has(ot))return;const n=t.get(ot);if(!n.dirty)return;n.dirty=!1,n.group||(n.group=new di,n.group.visible=!1,e.scene.add(n.group));const s=n.value;for(;s.length<n.pickers.length;){const o=n.pickers.pop();o==null||o.removeFromParent()}for(;s.length<n.circles.length;){const o=n.circles.pop();o==null||o.removeFromParent()}for(;n.lines.length&&s.length-1<n.lines.length;){const o=n.lines.pop();o==null||o.removeFromParent()}for(;s.length>n.pickers.length;){const o=new Re(J6);o.visible=!1;const a=n.pickers.push(o);o.userData={index:a-1},n.group.add(o)}for(;s.length>n.circles.length;){const o=new vn(e8,ot.normalMaterial);n.circles.push(o),n.group.add(o)}for(;s.length-1>n.lines.length;){const o=new vn(t8,ot.normalMaterial);n.lines.push(o),n.group.add(o)}for(let o=0,a=s.length;o<a;++o){const l=s[o],c=n.circles[o];c.position.copy(l.position),c.scale.setScalar(l.radius);const u=n.pickers[o];if(u.position.copy(l.position),u.scale.setScalar(l.radius),o<a-1){const d=n.lines[o];d.position.copy(l.position),Wm.subVectors(s[o+1].position,l.position);const f=Wm.length();d.scale.setScalar(f),f>1e-8&&d.quaternion.setFromUnitVectors(n8,Wm.divideScalar(f))}}const r=t.get(Ce);r.value||(r.value=new vt,r.value.userData={node:t},r.parentChanged=!0,r.localTransformChanged=!0)}}h(vv,"TubeUpdateFilter");Z6(vv,"TubeUpdateFilter");var i8=Object.defineProperty,s8=h((i,e)=>i8(i,"name",{value:e,configurable:!0}),"__name$Z");const _d=[],Cs=new A,jm=new A,bd=new Be,wd=new ve,$m=new ve,xd=new A;class yv extends ss{constructor(t){super();C(this,"filters");this.filters=t}begin(t){t=t.readonlyRef();const n=qe(this);if(t.model.dirty){t.model.forEach(s=>{s.parent&&!s.parent.visible?s.visible=!1:s.visible=s.has(zt)?s.value(zt):!0,s.dirty&&_d.push(s)});for(let s of n.filters)for(let r of _d)s.update(t,r);for(let s of _d)s.dirty=!1;_d.length=0,t.model.dirty=!1}t.model.instanceDirty&&(t.model.instanceDirty=!1,t.model.forEach(s=>{if(s.instanceId){if(s.instanceMeshDirty){if(s.instanceMeshDirty=!1,!jn(s.type).mesh)return;let o=s.instanceMeshRebuild;s.instanceMeshRebuild&&(s.instanceMeshRebuild=!1,n.recreateInstanceMesh(t,s)),s.has(_n)&&t.throttle(`#${s.id}-update-instance-mirror-geometry`,250,()=>{s.deleted||n.updateInstanceMirrorGeometry(t,s)},s.visible&&o)}n.updateInstanceMaterial(t,s)}}),t.model.dirty=!0)}end(t){}recreateInstanceMesh(t,n){if(!n.has(Ce))return;const s=n.get(Ce);if(s.instance=!0,s.dispose(),!t.model.isNodeExists(n.instanceId))return;const r=t.model.getNode(n.instanceId),o=r.value(Ce);if(!o)return;const a=[[o,null]];let l=0;for(;a.length;){const c=a.pop();if(!c)break;const u=c[0],d=c[1];let f;if(u.isMesh){const p=u;f=new Re(p.geometry,p.material)}else f=new vt;f.position.copy(u.position),f.quaternion.copy(u.quaternion),f.scale.copy(u.scale),f.updateMatrix(),f.updateMatrixWorld(!0),f.userData={node:n,origin:u,instanceId:l++},d?d.add(f):s.value=f;for(let p of u.children)a.push([p,f])}n.dirty=!0,s.parentChanged=!0,s.localTransformChanged=!0,s.worldTransformChanged=!0,s.usePlainMaterial=r.get(Ce).usePlainMaterial}updateInstanceMaterial(t,n){if(!n.has(Ce)||!n.has(po))return;const s=t.model.getNode(n.instanceId),r=n.get(Ce),o=s.get(Ce);if(r.usePlainMaterial===o.usePlainMaterial||(r.usePlainMaterial=o.usePlainMaterial,!r.value)||!o.value)return;const a=[[r.value,o.value]];for(;a.length;){const l=a.pop();if(!l)break;const c=l[0],u=l[1];if(c.isMesh&&(c.material=u.material),c.children.length===u.children.length)for(let d=0,f=c.children.length;d<f;++d)a.push([c.children[d],u.children[d]])}}updateInstanceMirrorGeometry(t,n){if(!n.has(_n))return;const s=n.value(_n),r=n.value(Ce);if(!r)return;const o=t.model.getNode(n.instanceId);if(!o.value(Ce))return;const l=1e-6,c=O1(Math.round(s.x/l)*l,Math.round(s.y/l)*l,Math.round(s.z/l)*l),u=r,d=[u];for(;d.length;){const f=d.shift();if(!f)break;const p=f.userData;if(p.relatedMatOrigin||(p.relatedMatOrigin=new ve,p.relatedMatFlipped=new ve),f!==u){const g=f.parent.userData;wd.copy(g.relatedMatOrigin),$m.copy(g.relatedMatFlipped).invert();const m=p.origin;jm.copy(m.position),jm.applyMatrix4(wd).reflect(s).applyMatrix4($m),bd.copy(m.quaternion);const v=yr(xd,bd);xd.applyMatrix4(wd).reflect(s).applyMatrix4($m),xd.normalize(),bd.setFromAxisAngle(xd,-v),f.position.copy(jm),f.quaternion.copy(bd),f.updateMatrix(),f.updateMatrixWorld(!0),p.relatedMatOrigin.multiplyMatrices(wd,m.matrix),p.relatedMatFlipped.multiplyMatrices(g.relatedMatFlipped,f.matrix)}f.isMesh&&this.mirrorMesh(o,c+"/"+p.instanceId,f,p.origin,s),d.push(...f.children)}}mirrorMesh(t,n,s,r,o){if(!(!(s!=null&&s.geometry)||!(r!=null&&r.geometry))){if(t.mirrorGeometry[n]){s.geometry=t.mirrorGeometry[n];return}if(s.geometry===r.geometry){s.geometry=new et;const a=r.geometry.getIndex();a&&(s.geometry.index=new Zt(new Uint32Array(a.array.length),a.itemSize),this.flipIndex(s.geometry.index,a));const l=r.geometry.getAttribute("position");l&&s.geometry.setAttribute("position",new Fe(new Float32Array(l.array),l.itemSize));const c=r.geometry.getAttribute("normal");c&&s.geometry.setAttribute("normal",new Fe(new Float32Array(c.array),c.itemSize));const u=r.geometry.getAttribute("color");u&&s.geometry.setAttribute("color",new Fe(new Float32Array(u.array),u.itemSize));const d=r.geometry.getAttribute("uv");d&&s.geometry.setAttribute("uv",d.clone())}this.mirrorGeometry(s.geometry,r.geometry,o),s.geometry.boundingSphere=null,t.mirrorGeometry[n]=s.geometry}}flipIndex(t,n){const s=t.array,r=n.array;for(let o=0,a=r.length;o<a;o+=3)s[o]=r[o+2],s[o+1]=r[o+1],s[o+2]=r[o]}mirrorGeometry(t,n,s){const r=!t.getIndex();this.mirrorAttribute(t.getAttribute("position"),n.getAttribute("position"),s,r),this.mirrorAttribute(t.getAttribute("normal"),n.getAttribute("normal"),s,r),r&&this.flipTriangles(t.getAttribute("color"),n.getAttribute("color"))}mirrorAttribute(t,n,s,r){if(!t||!n||t.itemSize!==3)return;const o=t.array,a=n.array;if(r)for(let l=0,c=a.length;l<c;l+=9)for(let u=0;u<9;u+=3)Cs.fromArray(a,l+6-u),Cs.reflect(s),o[l+u]=Cs.x,o[l+u+1]=Cs.y,o[l+u+2]=Cs.z;else for(let l=0,c=a.length;l<c;l+=3)Cs.fromArray(a,l),Cs.reflect(s),o[l]=Cs.x,o[l+1]=Cs.y,o[l+2]=Cs.z;t.needsUpdate=!0}flipTriangles(t,n){if(!t||!n||t.itemSize!==3)return;const s=t.array,r=n.array;for(let o=0,a=r.length;o<a;o+=9)for(let l=0;l<9;l+=3)s[o+l]=r[o+6-l],s[o+l+1]=r[o+6-l+1],s[o+l+2]=r[o+6-l+2];t.needsUpdate=!0}}h(yv,"ModelUpdateSystem");s8(yv,"ModelUpdateSystem");var r8=Object.defineProperty,o8=h((i,e)=>r8(i,"name",{value:e,configurable:!0}),"__name$Y");class _v extends ss{begin(e){e=e.readonlyRef();for(let t of e.views)t.enabled&&(t.mouseScr.x=t.input.pointerX,t.mouseScr.y=t.height-t.input.pointerY,t.mouseNdc.x=t.mouseScr.x/t.width*2-1,t.mouseNdc.y=t.mouseScr.y/t.height*2-1,t.mouseRay0.copy(t.mouseNdc),t.mouseRay0.z=-1,t.mouseRay0.unproject(t.camera.get()),t.mouseRay1.copy(t.mouseNdc),t.mouseRay1.z=1,t.mouseRay1.unproject(t.camera.get()),t.mouseRayN.subVectors(t.mouseRay1,t.mouseRay0).normalize(),t.raycaster.setFromCamera(t.mouseNdc,t.camera.get()))}end(e){}}h(_v,"MouseSystem");o8(_v,"MouseSystem");var a8=Object.defineProperty,l8=h((i,e)=>a8(i,"name",{value:e,configurable:!0}),"__name$X");class bv extends ss{begin(e){if(e=e.readonlyRef(),!e.options.outlineSelected){e.outlinePass.selectedObjects.length=0,e.outlinePass.enabled=!1;return}const t=e.model.getTopmostSelectedNodes(),n=[];for(let s of t)if(s.has(Ce)&&s.visible){const r=s.value(Ce);r&&n.push(r)}e.outlinePass.selectedObjects=n,e.outlinePass.enabled=!!n.length}end(e){}}h(bv,"OutlineUpdateSystem");l8(bv,"OutlineUpdateSystem");var c8=Object.defineProperty,u8=h((i,e)=>c8(i,"name",{value:e,configurable:!0}),"__name$W");class _l extends Ws{constructor(e=10,t=10,n=4473924,s=4473924,r=8947848,o=!0){const a=new Te(n),l=new Te(s),c=new Te(r),u=t/2,d=e/t,f=e/2,p=[],g=[];for(let y=0,b=0,_=-f;y<=t;y++,_+=d){p.push(-f,0,_,f,0,_),p.push(_,0,-f,_,0,f);const x=y===u?a:c,w=y===u?l:c;x.toArray(g,b),b+=3,x.toArray(g,b),b+=3,w.toArray(g,b),b+=3,w.toArray(g,b),b+=3}const m=new et;m.setAttribute("position",new Fe(p,3)),m.setAttribute("color",new Fe(g,3));const v=new $n({vertexColors:!0,toneMapped:!1,depthWrite:o});super(m,v),this.type="Grids"}dispose(){this.geometry.dispose(),this.material.dispose()}}h(_l,"Grids");u8(_l,"Grids");var h8=Object.defineProperty,SC=h((i,e)=>h8(i,"name",{value:e,configurable:!0}),"__name$V");const $r=200,d8=new A(1,0,0),f8=new A(0,1,0),p8=new A(0,0,1),m8=new A;function _f(i,e){return m8.crossVectors(i._dir,e).lengthSq()<1e-8}h(_f,"isCameraParallelTo");SC(_f,"isCameraParallelTo");class wv extends ss{constructor(){super(...arguments);C(this,"groundGrids",new _l($r,$r,16135762,3113955,5592405));C(this,"xzGrids",new _l($r,$r,16135762,3113955,5592405,!1));C(this,"xyGrids",new _l($r,$r,16135762,7316763,5592405,!1).rotateX(Math.PI/2));C(this,"yzGrids",new _l($r,$r,7316763,3113955,5592405,!1).rotateZ(Math.PI/2))}setup(t){t.scene.add(this.groundGrids),t.scene.add(this.xzGrids),t.scene.add(this.xyGrids),t.scene.add(this.yzGrids)}begin(t){t=t.readonlyRef();const n=t.canvas.getBoundingClientRect(),s=t.renderer,r=t.composer,o=t.renderPass,a=t.outlinePass;s.setScissorTest(!0),s.setClearColor(0,0),s.clear();const l=t.options.shadingMode==="solid";for(let c of t.views){for(let u of t.views){const d=c===u;u.transformControls.visible=d&&t.tool.enableTransformControls,u.defaultLight.visible=l&&d}if(c.enabled&&c.width&&c.height){const u=c.camera;this.xzGrids.visible=t.options.showGrids&&_f(u,f8),this.xyGrids.visible=t.options.showGrids&&_f(u,p8),this.yzGrids.visible=t.options.showGrids&&_f(u,d8),this.groundGrids.visible=t.options.showGrids&&!(this.xzGrids.visible||this.xyGrids.visible||this.yzGrids.visible),t.tool.beforeRender(t,c);const d=-n.left+c.left,f=n.bottom-c.bottom,p=c.width,g=c.height;s.setViewport(d,f,p,g),s.setScissor(d,f,p,g),o.camera=u.get(),a.renderCamera=u.get(),r.setSize(p,g),r.render()}}}end(t){}}h(wv,"RenderSystem");SC(wv,"RenderSystem");var g8=Object.defineProperty,v8=h((i,e)=>g8(i,"name",{value:e,configurable:!0}),"__name$U");const Xm=new sh,qa=new A,Za=new A,cs=new A,tr=new A,Ts=new A,nr=new A,ir=new A,Rc=new A,Ic=new A,Dc=new A,Md=new A,Lc=new A,kc=new A,Oc=new A,vw=new ve,y8=new Be,_8=new A;class xv{constructor(){C(this,"dom");C(this,"parent");C(this,"x0",0);C(this,"y0",0);C(this,"x1",0);C(this,"y1",0);const e=this.dom=document.createElement("div");e.style.pointerEvents="none",e.style.position="absolute",e.style.zIndex="20",e.style.border="dashed 1px #fff",e.style.background="rgba(255, 255, 255, .1)",e.style.boxSizing="border-box"}attach(e){this.parent=e,e.appendChild(this.dom)}show(){this.dom.style.display="block"}hide(){this.dom.style.display="none"}setPoint1(e,t){this.x0=e,this.y0=t}setPoint2(e,t){if(this.x1=e,this.y1=t,!this.parent)return;const n=(this.x0+1)/2,s=(this.x1+1)/2,r=(this.y0+1)/2,o=(this.y1+1)/2,a=this.parent.getBoundingClientRect(),l=Math.round(a.width*Math.min(n,s)),c=Math.round(a.width*(1-Math.max(n,s))),u=Math.round(a.height*Math.min(r,o)),d=Math.round(a.height*(1-Math.max(r,o)));this.dom.style.left=`${l}px`,this.dom.style.right=`${c}px`,this.dom.style.top=`${d}px`,this.dom.style.bottom=`${u}px`,n!==s||r!==o?this.show():this.hide()}select(e,t){let n=this.x0,s=this.y0,r=this.x1,o=this.y1;n===r&&(r+=Number.EPSILON),s===o&&(o+=Number.EPSILON);const a=0,l=1,c=Number.MAX_VALUE;if(e.updateProjectionMatrix(),e.updateMatrixWorld(),e.isPerspectiveCamera){Za.set(n,s,a),Za.x=Math.min(n,r),Za.y=Math.max(s,o),r=Math.max(n,r),o=Math.min(s,o),cs.setFromMatrixPosition(e.matrixWorld),tr.copy(Za),Ts.set(r,Za.y,0),nr.set(r,o,l),ir.set(Za.x,o,0),tr.unproject(e),Ts.unproject(e),nr.unproject(e),ir.unproject(e),Lc.copy(tr).sub(cs),kc.copy(Ts).sub(cs),Oc.copy(nr).sub(cs),Lc.normalize(),kc.normalize(),Oc.normalize(),Lc.multiplyScalar(c),kc.multiplyScalar(c),Oc.multiplyScalar(c),Lc.add(cs),kc.add(cs),Oc.add(cs);const f=Xm.planes;f[0].setFromCoplanarPoints(cs,tr,Ts),f[1].setFromCoplanarPoints(cs,Ts,nr),f[2].setFromCoplanarPoints(nr,ir,cs),f[3].setFromCoplanarPoints(ir,tr,cs),f[4].setFromCoplanarPoints(Ts,nr,ir),f[5].setFromCoplanarPoints(Oc,kc,Lc),f[5].normal.multiplyScalar(-1)}else if(e.isOrthographicCamera){const f=Math.min(n,r),p=Math.max(s,o),g=Math.max(n,r),m=Math.min(s,o);tr.set(f,p,-1),Ts.set(g,p,-1),nr.set(g,m,-1),ir.set(f,m,-1),Rc.set(f,p,1),Ic.set(g,p,1),Dc.set(g,m,1),Md.set(f,m,1),tr.unproject(e),Ts.unproject(e),nr.unproject(e),ir.unproject(e),Rc.unproject(e),Ic.unproject(e),Dc.unproject(e),Md.unproject(e);const v=Xm.planes;v[0].setFromCoplanarPoints(tr,Rc,Ic),v[1].setFromCoplanarPoints(Ts,Ic,Dc),v[2].setFromCoplanarPoints(Dc,Md,ir),v[3].setFromCoplanarPoints(Md,Rc,tr),v[4].setFromCoplanarPoints(Ts,nr,ir),v[5].setFromCoplanarPoints(Dc,Ic,Rc),v[5].normal.multiplyScalar(-1)}const u=[],d={};for(let f of t)this.searchChildInFrustum(u,d,Xm,f);return u}searchChildInFrustum(e,t,n,s){if(s.isMesh||s.isLine||s.isPoints)if(s.isInstancedMesh){const r=s;t[r.uuid]=[];for(let o=0;o<r.count;o++)r.getMatrixAt(o,vw),vw.decompose(qa,y8,_8),qa.applyMatrix4(r.matrixWorld),n.containsPoint(qa)&&t[r.uuid].push(o)}else{const r=s;r.geometry.boundingSphere===null&&r.geometry.computeBoundingSphere(),qa.copy(r.geometry.boundingSphere.center),qa.applyMatrix4(s.matrixWorld),n.containsPoint(qa)&&e.push(s)}if(s.children.length>0)for(let r=0;r<s.children.length;r++)this.searchChildInFrustum(e,t,n,s.children[r])}}h(xv,"SelectionRect");v8(xv,"SelectionRect");var b8=Object.defineProperty,w8=h((i,e)=>b8(i,"name",{value:e,configurable:!0}),"__name$T");const yw=new A(0,0,1),Nc=new A,Ym=new ve,Xr=new A,Km=new vo;class Mv extends ss{constructor(){super(...arguments);C(this,"prevTool");C(this,"selectionRect",new xv);C(this,"dragMovedFramesCount",0);C(this,"sculptPicked",!1);C(this,"sculptIndicator",new Ws(new et().setFromPoints([...$f(1),...$f(.05)]),new $n({fog:!1,toneMapped:!1,transparent:!0,color:15964205,opacity:1})));C(this,"sculptIndicatorSym",new Ws(this.sculptIndicator.geometry.clone(),this.sculptIndicator.material.clone()))}setup(t){this.sculptIndicator.visible=!1,t.scene.add(this.sculptIndicator),this.sculptIndicatorSym.visible=!1,this.sculptIndicatorSym.material.opacity=.33,t.scene.add(this.sculptIndicatorSym)}begin(t){var s;const n=qe(t.tool);if(t.selectionRectSetThisFrame=!1,n.enableSelectionRect)for(let r of t.views){if(r=qe(r),!r.enabled)continue;const o=r.input;if(o.pointerOver&&o.mouseLeft){const a=Math.max(-1,Math.min(1,r.mouseNdc.x)),l=Math.max(-1,Math.min(1,r.mouseNdc.y));t.selectionRectDragging?(this.selectionRect.setPoint2(a,l),t.selectionEnd.set(a,l),this.dragMovedFramesCount<2&&(this.selectionRect.hide(),(this.dragMovedFramesCount||!t.selectionStart.equals(t.selectionEnd))&&(this.dragMovedFramesCount+=1))):(t.selectionRectDragging=!0,t.selectionRectViewIndex=r.index,this.selectionRect.attach(r.element),this.selectionRect.setPoint1(a,l),this.selectionRect.setPoint2(a,l),t.selectionStart.set(a,l),t.selectionEnd.set(a,l),this.dragMovedFramesCount=0)}if(t.selectionRectDragging&&t.selectionRectViewIndex===r.index&&!o.mouseLeft&&(t.selectionRectDragging=!1,t.selectionRectSetThisFrame=!0,this.selectionRect.hide(),n.enableDefaultSelectionBehavior))if(t.selectionStart.equals(t.selectionEnd)){const a=r.mousePick();let l=0;for(let c of a){const u=c.object.userData.node;if(u!=null&&u.visible){l=u.id;break}}if(l){if(t.model.selected.includes(l)?r.input.isKeyPressed("Control")&&(t.model.selected=t.model.selected.filter(c=>c!==l)):(r.input.isKeyPressed("Control")||(t.model.selected=[]),t.model.addSelection(l)),o.doubleClick){let c=t.model.getNode(l);for(c=c.parent;c;)c.expanded=!0,c=c.parent}}else r.input.isKeyPressed("Control")||(t.model.selected=[])}else{const a=this.selectionRect.select(r.camera.get(),t.readonlyRef().scene.children.filter(l=>l.visible&&!!l.userData.node));r.input.isKeyPressed("Control")||(t.model.selected=[]);for(let l of a){const c=l.userData.node;c&&t.model.addSelection(c.id)}}}else this.selectionRect.hide(),t.selectionRectDragging=!1;do{if(this.sculptIndicator.visible=!1,this.sculptIndicatorSym.visible=!1,t.sculptNodeId=0,t.sculptSym=!1,t.sculptMoved=!1,this.sculptPicked){let a=!1;for(let l of t.views)if(l.input.mouseLeft){a=!0;break}a||(this.sculptPicked=!1);break}if(!n.sculpt)break;const r=t.readonlyRef().model.getSelectedNodes().filter(a=>a.type==="Clay"&&!a.instanceId&&a.visible)[0];if(!r)break;const o=r.get(Ce).mesh;if(!o)break;t.sculptNodeId=r.id,t.sculptSym=r.value(Hi)!=="none";for(let a of t.views){if(a=qe(a),!a.enabled)continue;const l=a.input;if(l.mouseLeft?(l.pointerOver||t.sculptActiveView===a.index)&&(t.sculptActiveView=a.index,l.mouseLeftDownThisFrame?(t.sculptMoved=!0,t.sculptStartThisFrame=!0,t.sculptX0=t.sculptX1=l.pointerX,t.sculptY0=t.sculptY1=l.pointerY):(t.sculptX1!==l.pointerX||t.sculptY1!==l.pointerY)&&(t.sculptMoved=!0,t.sculptStartThisFrame=!1,t.sculptX0=t.sculptX1,t.sculptY0=t.sculptY1,t.sculptX1=l.pointerX,t.sculptY1=l.pointerY)):t.sculptActiveView===a.index&&(t.sculptActiveView=-1),!l.pointerOver)continue;const c=r.getWorldMatrix();Ym.copy(c).invert(),Km.copy(a.raycaster.ray),Km.applyMatrix4(Ym);const u=o.raycast(Km,!0)[0];if(!u)break;l.mouseLeft||(this.sculptIndicator.visible=!0,this.sculptIndicatorSym.visible=t.sculptSym),this.sculptIndicator.position.copy(u.point).applyMatrix4(c),Xr.copy(u.normal).transformDirection(c),this.sculptIndicator.quaternion.setFromUnitVectors(yw,Xr);let d=n.brushRadius/a.height;if(a.camera.perspective?d*=this.sculptIndicator.position.distanceTo(a.camera._position):d*=a.camera.orthographicCamera.top-a.camera.orthographicCamera.bottom,this.sculptIndicator.scale.setScalar(d),t.sculptLocalRadius=d*ca(Ym),this.sculptIndicatorSym.visible){switch(Nc.copy(u.point),Xr.copy(u.normal),r.value(Hi)){case"x":Nc.x*=-1,Xr.x*=-1;break;case"y":Nc.y*=-1,Xr.y*=-1;break;case"z":Nc.z*=-1,Xr.z*=-1;break}this.sculptIndicatorSym.position.copy(Nc).applyMatrix4(c),Xr.transformDirection(c),this.sculptIndicatorSym.quaternion.setFromUnitVectors(yw,Xr),this.sculptIndicatorSym.scale.copy(this.sculptIndicator.scale)}break}}while(!1);n.begin(t);for(let r of t.views)r=qe(r),n.enableTransformControls?r.transformControls.attach(t.dummyObject):r.transformControls.detach(),r.enabled&&n.update(t,r);if(n.end(t),n.sculpt&&!t.sculptNodeId)for(let r of t.views){r=qe(r);const o=r.input;if(o.pointerOver&&o.mouseLeftDownThisFrame)for(let a of r.mousePick()){const l=a.object.userData.node;if((l==null?void 0:l.type)==="Clay"){t.model.addSelection(l.id),this.sculptPicked=!0,t.sculptActiveView=-1;break}}}if(qe(this.prevTool)!==n&&((s=this.prevTool)==null||s.onUnselected(t),this.prevTool=n,t.statusBarMessage=n.tips),n.optionsProps.length){const r=t.options.tools[n.constructor.name]=t.options.tools[n.constructor.name]||{};for(let o of n.optionsProps)r[o]=n[o]}}end(t){}}h(Mv,"ToolSystem");w8(Mv,"ToolSystem");var x8=Object.defineProperty,Av=h((i,e)=>x8(i,"name",{value:e,configurable:!0}),"__name$S");const Yr=new A,Fc=new A,Qa=new A,zc=new A,Ad=new A,Sd=new A,Cd=new A,Td=new A,qm=new A,Zm=new A,Qm=new A,Bc=new A;function f0(i,e,t){return i[e]=t.x,i[e+1]=t.y,i[e+2]=t.z,e+3}h(f0,"vertex$1");Av(f0,"vertex");function zi(i,e,t,n){return e=f0(i,e,t),f0(i,e,n)}h(zi,"line");Av(zi,"line");class Sv extends Ws{constructor(){const t=new et,n=new Array(12*2*3).fill(0),s=new Array(12*2*3).fill(1);t.setAttribute("position",new Fe(n,3)),t.setAttribute("color",new Fe(s,3));const r=new $n({vertexColors:!0,toneMapped:!1,color:16776960});super(t,r);C(this,"point1",new A);C(this,"point2",new A);C(this,"normal1",new A);C(this,"normal2",new A);C(this,"length",0);C(this,"width",0);C(this,"height",0);C(this,"dirty",!1);this.type="BoxEdge"}setPoint1(t){this.point1.equals(t)||(this.dirty=!0,this.point1.copy(t))}setPoint2(t){this.point2.equals(t)||(this.dirty=!0,this.point2.copy(t))}setNormal1(t){this.normal1.equals(t)||(this.dirty=!0,this.normal1.copy(t))}setNormal2(t){this.normal2.equals(t)||(this.dirty=!0,this.normal2.copy(t))}setHeight(t){t!==this.height&&(this.dirty=!0,this.height=t)}getLength(){return this.length}getWidth(){return this.width}updateGeometry(){if(!this.dirty)return;this.dirty=!1;const t=this.geometry.attributes.position,n=t.array;Yr.copy(this.point1),Qa.copy(this.point2),Zm.copy(this.normal1).normalize(),Qm.crossVectors(this.normal1,this.normal2).normalize(),qm.subVectors(Qa,Yr),Fc.copy(Yr).addScaledVector(Zm,this.width=qm.dot(Zm)),zc.copy(Yr).addScaledVector(Qm,this.length=qm.dot(Qm)),Bc.copy(this.normal2).normalize().multiplyScalar(this.height),Ad.addVectors(Yr,Bc),Sd.addVectors(Fc,Bc),Cd.addVectors(Qa,Bc),Td.addVectors(zc,Bc);let s=0;s=zi(n,s,Yr,Fc),s=zi(n,s,Fc,Qa),s=zi(n,s,Qa,zc),s=zi(n,s,zc,Yr),s=zi(n,s,Yr,Ad),s=zi(n,s,Fc,Sd),s=zi(n,s,Qa,Cd),s=zi(n,s,zc,Td),s=zi(n,s,Ad,Sd),s=zi(n,s,Sd,Cd),s=zi(n,s,Cd,Td),zi(n,s,Td,Ad),t.needsUpdate=!0}}h(Sv,"BoxEdge");Av(Sv,"BoxEdge");var M8=Object.defineProperty,Cv=h((i,e)=>M8(i,"name",{value:e,configurable:!0}),"__name$R");const Vt=new A,Li=new A,ki=new A,Oi=new A,Do=new A,Lo=new A,ko=new A,Oo=new A,No=new A;function cr(i,e,t){return i[e]=t.x,i[e+1]=t.y,i[e+2]=t.z,e+3}h(cr,"vertex");Cv(cr,"vertex");function CC(i,e,t,n,s,r,o){let a=0;cr(i,a,t),a=cr(e,a,o),cr(i,a,n),a=cr(e,a,o),cr(i,a,s),a=cr(e,a,o),cr(i,a,r),cr(e,a,o)}h(CC,"face");Cv(CC,"face");const kt=class extends Re{constructor(){const t=new et,n=new Float32Array(4*3),s=new Float32Array(4*3);t.setAttribute("position",new Fe(n,3)),t.setAttribute("normal",new Fe(s,3)),t.setIndex([0,1,3,0,3,2]);const r=new hi({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16776960,opacity:.75});super(t,r);C(this,"size",new A(1,1,1));C(this,"face",kt.Right);C(this,"dirty",!0);this.type="BoxFace"}setSize(t){this.size.equals(t)||(this.dirty=!0,this.size.copy(t))}setFace(t){t!==this.face&&(this.dirty=!0,this.face=t)}getFace(){return this.face}setFaceFromNormal(t){t.x<-1e-6?this.setFace(kt.Left):t.x>1e-6?this.setFace(kt.Right):t.y<-1e-6?this.setFace(kt.Bottom):t.y>1e-6?this.setFace(kt.Top):t.z<-1e-6?this.setFace(kt.Back):this.setFace(kt.Front)}getFaceNormal(t){switch(this.face){case kt.Left:t.set(-1,0,0);break;case kt.Right:t.set(1,0,0);break;case kt.Bottom:t.set(0,-1,0);break;case kt.Top:t.set(0,1,0);break;case kt.Back:t.set(0,0,-1);break;case kt.Front:t.set(0,0,1);break}return t}getFaceTangent(t){switch(this.face){case kt.Left:t.set(0,0,-1);break;case kt.Right:t.set(0,0,1);break;case kt.Bottom:t.set(-1,0,0);break;case kt.Top:t.set(1,0,0);break;case kt.Back:t.set(0,-1,0);break;case kt.Front:t.set(0,1,0);break}return t}updateGeometry(){if(!this.dirty)return;this.dirty=!1,Vt.copy(this.size).multiplyScalar(-.5),Li.set(this.size.x,0,0),ki.set(0,this.size.y,0),Oi.set(0,0,this.size.z);const t=this.geometry.attributes.position,n=this.geometry.attributes.normal,s=t.array,r=n.array;switch(t.needsUpdate=!0,n.needsUpdate=!0,this.face){case kt.Left:Do.copy(Vt),Lo.copy(Vt).add(Oi),ko.copy(Vt).add(ki),Oo.copy(Vt).add(Oi).add(ki),No.set(-1,0,0);break;case kt.Right:Do.copy(Vt).add(Li),Lo.copy(Vt).add(ki).add(Li),ko.copy(Vt).add(Oi).add(Li),Oo.copy(Vt).add(Oi).add(ki).add(Li),No.set(1,0,0);break;case kt.Bottom:Do.copy(Vt),Lo.copy(Vt).add(Li),ko.copy(Vt).add(Oi),Oo.copy(Vt).add(Oi).add(Li),No.set(0,-1,0);break;case kt.Top:Do.copy(Vt).add(ki),Lo.copy(Vt).add(Oi).add(ki),ko.copy(Vt).add(Li).add(ki),Oo.copy(Vt).add(Oi).add(Li).add(ki),No.set(0,1,0);break;case kt.Back:Do.copy(Vt),Lo.copy(Vt).add(ki),ko.copy(Vt).add(Li),Oo.copy(Vt).add(ki).add(Li),No.set(0,0,-1);break;case kt.Front:Do.copy(Vt).add(Oi),Lo.copy(Vt).add(Li).add(Oi),ko.copy(Vt).add(ki).add(Oi),Oo.copy(Vt).add(ki).add(Li).add(Oi),No.set(0,0,1);break}CC(s,r,Do,Lo,ko,Oo,No)}};let An=kt;h(An,"BoxFace"),C(An,"Right",0),C(An,"Left",1),C(An,"Top",2),C(An,"Bottom",3),C(An,"Front",4),C(An,"Back",5);Cv(An,"BoxFace");var A8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAF1JREFUSIntlDkOADEIxCDa/3/Z26TKBbmUBtcZD4oQIsFr1HoAMCVUNZ1LcjLX5FOZFXkv9+1OY/15VeAJlcOMSB7RDlEQBX4AWut9pKAnP1Iwkos0zvXV8xw84QcGmUP1JGS0xQAAAABJRU5ErkJggg==",S8=Object.defineProperty,C8=h((i,e)=>S8(i,"name",{value:e,configurable:!0}),"__name$Q");function TC(i,e,t,n,s){let r,o,a,l,c=t-i,u=n-e,d=Math.abs(c),f=Math.abs(u),p=2*f-d,g=2*d-f;if(f<=d){c>=0?(r=i,o=e,a=t):(r=t,o=n,a=i),s(r,o);for(let m=0;r<a;m++)r=r+1,p<0?p=p+2*f:(c<0&&u<0||c>0&&u>0?o=o+1:o=o-1,p=p+2*(f-d)),s(r,o)}else{u>=0?(r=i,o=e,l=n):(r=t,o=n,l=e),s(r,o);for(let m=0;o<l;m++)o=o+1,g<=0?g=g+2*d:(c<0&&u<0||c>0&&u>0?r=r+1:r=r-1,g=g+2*(d-f)),s(r,o)}}h(TC,"pixelLine");C8(TC,"pixelLine");var T8=Object.defineProperty,E8=h((i,e)=>T8(i,"name",{value:e,configurable:!0}),"__name$P");const Fo=new go,bi=new vo,_w=new ve,Ed=new A;class ln{constructor(){C(this,"sep",!1);C(this,"tips","");C(this,"enableTransformControls",!1);C(this,"enableDefaultDeleteShortcut",!0);C(this,"enableSelectionRect",!1);C(this,"enableDefaultSelectionBehavior",!1);C(this,"sculpt",!1);C(this,"brushRadius",50);C(this,"brushStepSpacingRadiusRatio",.2);C(this,"brushStrength",.5);C(this,"hasDirection",!1);C(this,"hasThirdDirection",!1);C(this,"brushDirection",1);C(this,"brushHardness",.5);C(this,"hasHardness",!1);C(this,"hasColor",!1);C(this,"frontFacesOnly",!1);C(this,"optionsProps",[])}setup(e){}dispose(){}begin(e){}update(e,t){}end(e){}beforeRender(e,t){}onUnselected(e){}sculptPickStrokeVertices(e,t,n,s,r){e=e.readonlyRef(),_w.copy(t.getWorldMatrix()).invert();const o=new Set,a=[],l=Math.max(1,Math.floor(this.brushRadius*this.brushStepSpacingRadiusRatio));e.sculptStartThisFrame&&(e.sculptAccWalkedPixels=l);const c=t.value(Hi);TC(e.sculptX0,e.sculptY0,e.sculptX1,e.sculptY1,(p,g)=>{if(e.sculptAccWalkedPixels+=1,e.sculptAccWalkedPixels<l)return;e.sculptAccWalkedPixels=0,bi.origin.set(p/n.width*2-1,(n.height-g)/n.height*2-1,-1),bi.direction.copy(bi.origin).setZ(1),bi.origin.unproject(n.camera.get()),bi.direction.unproject(n.camera.get()),bi.direction.sub(bi.origin).normalize(),bi.applyMatrix4(_w);const m=s.raycast(bi,!0)[0];if(!m)return;Fo.set(m.point,e.sculptLocalRadius);const v=s.intersectSphere(Fo),y=[],b=new Set;for(let w of v)if(!(r&&(s.getNormal(Ed,w),Ed.dot(bi.direction)>=0)))for(let T=0;T<3;++T){const P=s.sharedVertexMap[w*3+T];b.has(P)||(b.add(P),y.push(P),o.add(P))}switch(c){case"x":Fo.center.x*=-1,bi.direction.x*=-1;break;case"y":Fo.center.y*=-1,bi.direction.y*=-1;break;case"z":Fo.center.z*=-1,bi.direction.z*=-1;break;default:{a.push({center:m.point,triangles:v,indices:y});return}}const _=s.intersectSphere(Fo),x=[];b.clear();for(let w of _)if(!(r&&(s.getNormal(Ed,w),Ed.dot(bi.direction)>=0)))for(let T=0;T<3;++T){const P=s.sharedVertexMap[w*3+T];b.has(P)||(b.add(P),x.push(P),o.add(P))}a.push({center:m.point,triangles:v,indices:y,centerSym:new A().copy(Fo.center),trianglesSym:_,indicesSym:x})});const u=Array.from(o),d=new Map,f=new Float32Array(u.length*3);for(let p=0,g=u.length;p<g;++p){const m=u[p];for(let v=0;v<3;++v)f[p*3+v]=s.aPosition[m*3+v];d.set(m,p*3)}return{indices:u,offset:d,position:f,track:a}}sculptFalloff(e){return(3*e-4)*e**3+1}}h(ln,"EditorTool");E8(ln,"EditorTool");var P8=Object.defineProperty,R8=h((i,e)=>P8(i,"name",{value:e,configurable:!0}),"__name$O");const Pd=new A,Uc=new A,bw=new A,Jm=new A,dn=new A,Vc=new A,Hc=new A,ww=new A,I8=new A,zo=new ve,Rd=new A,xw=new A,Bo=new A,Kr=new A,Gc=new A,Ni=.25;class _h extends ln{constructor(){super(...arguments);C(this,"name",_h.name);C(this,"label","Box");C(this,"icon",A8);C(this,"tips","Hold [Alt] to create a box");C(this,"boxEdge",new Sv);C(this,"boxFace",new An);C(this,"activeViewIndex",-1);C(this,"draggingFace",!1);C(this,"draggingFaceNodeId",0);C(this,"draggingFaceIndex",0);C(this,"draggingFaceNormal",new A);C(this,"faceNormalWorld0",new A);C(this,"position0",new A);C(this,"boxSize0",new A);C(this,"localMat0",new ve);C(this,"invWorldMat0",new ve);C(this,"mouse0",new A);C(this,"local0",new A);C(this,"creating",!1);C(this,"point2Set",!1);C(this,"point1",new A);C(this,"point2",new A);C(this,"normal1",new A);C(this,"normal2",new A);C(this,"boxHeight",0)}setup(t){this.boxEdge.visible=!1,t.scene.add(this.boxEdge),this.boxFace.visible=!1,t.scene.add(this.boxFace)}begin(t){this.draggingFace||(this.boxFace.visible=!1),this.creating||(this.boxEdge.visible=!1)}update(t,n){var r;const s=n.input;if(this.draggingFace){if(this.activeViewIndex!==n.index)return;if(s.pointerOver&&s.mouseLeft&&t.model.isNodeExists(this.draggingFaceNodeId,"Box")){if(ww.crossVectors(this.faceNormalWorld0,n.mouseRayN).lengthSq()<1e-6)return;qg(Pd,null,this.mouse0,this.faceNormalWorld0,n.mouseRay0,n.mouseRayN),Uc.copy(Pd).applyMatrix4(this.invWorldMat0);const o=bw.subVectors(Uc,this.local0).dot(this.draggingFaceNormal);Jm.copy(this.position0),dn.copy(this.boxSize0);const a=t.model.getNode(this.draggingFaceNodeId);switch(this.draggingFaceIndex){case An.Left:case An.Right:{dn.x=Math.max(0,o+dn.x),s.isKeyPressed("Shift")&&(dn.x=Math.round(dn.x/Ni)*Ni);const l=this.draggingFaceIndex===An.Left?1:-1;Vc.set(l*this.boxSize0.x/2,0,0),Hc.set(l*dn.x/2,0,0)}break;case An.Bottom:case An.Top:{dn.y=Math.max(0,o+dn.y),s.isKeyPressed("Shift")&&(dn.y=Math.round(dn.y/Ni)*Ni);const l=this.draggingFaceIndex===An.Bottom?1:-1;Vc.set(0,l*this.boxSize0.y/2,0),Hc.set(0,l*dn.y/2,0)}break;case An.Back:case An.Front:{dn.z=Math.max(0,o+dn.z),s.isKeyPressed("Shift")&&(dn.z=Math.round(dn.z/Ni)*Ni);const l=this.draggingFaceIndex===An.Back?1:-1;Vc.set(0,0,l*this.boxSize0.z/2),Hc.set(0,0,l*dn.z/2)}break}Vc.applyMatrix4(this.localMat0),Hc.applyMatrix4(this.localMat0),Jm.add(Vc).sub(Hc),t.history.setValue(a,ps,new A().copy(dn)),t.history.setValue(a,Ue,new A().copy(Jm)),dn.multiplyScalar(ca(a.getWorldMatrix())),t.statusBarMessage=`${dn.x.toFixed(2)} \xD7 ${dn.y.toFixed(2)} \xD7 ${dn.z.toFixed(2)}`}else this.draggingFace=!1,this.activeViewIndex=-1,this.draggingFaceNodeId=0,t.statusBarMessage=this.tips;return}if(this.creating){if(!this.point2Set){if(this.activeViewIndex!==n.index)return;if(s.mouseRightDownThisFrame&&(this.creating=!1,t.statusBarMessage=this.tips),on(this.point2,n.mouseRay0,n.mouseRay1,this.point1,this.normal2)){if(this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry(),s.isKeyPressed("Shift")){Bo.copy(this.normal1),Kr.crossVectors(this.normal1,this.normal2).normalize();let l=this.boxEdge.getWidth(),c=this.boxEdge.getLength();l=Math.round(l/Ni)*Ni,c=Math.round(c/Ni)*Ni,this.point2.copy(this.point1).addScaledVector(Bo,l).addScaledVector(Kr,c),this.boxEdge.setPoint2(this.point2),this.boxEdge.updateGeometry()}const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a}`}s.mouseLeft||(this.point2Set=!0);return}if(!s.pointerOver||(s.mouseRightDownThisFrame&&(this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips),ww.crossVectors(this.normal2,n.mouseRayN).lengthSq()<1e-8))return;if(!qg(Pd,null,this.point2,this.normal2,n.mouseRay0,n.mouseRayN)){this.boxHeight=bw.subVectors(Pd,this.point2).dot(this.normal2),s.isKeyPressed("Shift")&&(this.boxHeight=Math.round(this.boxHeight/Ni)*Ni),this.boxEdge.setHeight(this.boxHeight),this.boxEdge.updateGeometry();const o=Math.abs(this.boxEdge.getWidth()).toFixed(2),a=Math.abs(this.boxEdge.getLength()).toFixed(2),l=Math.abs(this.boxHeight).toFixed(2);t.statusBarMessage=`${o} \xD7 ${a} \xD7 ${l}`}if(s.mouseLeftDownThisFrame){this.creating=!1,this.point2Set=!1,t.statusBarMessage=this.tips;let o=null;for(let v of t.model.getSelectedNodes())if(v.isValidChild("Box")){o=v;break}o?zo.copy(o.getWorldMatrix()).invert():zo.identity(),Uc.copy(this.point1).applyMatrix4(zo),Rd.copy(this.point2).applyMatrix4(zo),xw.copy(this.point2).addScaledVector(this.normal2,this.boxHeight).applyMatrix4(zo),Bo.copy(this.normal1).transformDirection(zo),Kr.copy(this.normal2).transformDirection(zo),Gc.crossVectors(Bo,Kr).normalize();let a=Uc.dot(Bo),l=Rd.dot(Bo);a>l&&([a,l]=[l,a]);let c=Uc.dot(Gc),u=Rd.dot(Gc);c>u&&([c,u]=[u,c]);let d=Rd.dot(Kr),f=xw.dot(Kr);d>f&&([d,f]=[f,d]);const p=new it().setFromQuaternion(ec(new Be,Gc,Kr)),g=new A(l-a,f-d,u-c),m=new A().addScaledVector(Bo,a+g.x/2).addScaledVector(Kr,d+g.y/2).addScaledVector(Gc,c+g.z/2);t.history.createNode({type:"Box",parentId:o?o.id:0,data:{[ps.name]:g,[Ue.name]:m,[lt.name]:p}})}return}if(s.pointerOver){for(let o of n.mousePick()){const a=o.object.userData.node;if((a==null?void 0:a.type)==="Box"){const l=(r=o.face)==null?void 0:r.normal;l&&(this.boxFace.visible=!0,this.boxFace.matrixAutoUpdate=!1,this.boxFace.matrix.copy(a.getWorldMatrix()),this.boxFace.setSize(a.value(ps)),this.boxFace.setFaceFromNormal(l),this.boxFace.updateGeometry(),this.point1.copy(o.point),s.mouseLeftDownThisFrame&&!s.isKeyPressed("Alt")&&!a.instanceId&&(this.draggingFace=!0,this.activeViewIndex=n.index,this.draggingFaceNodeId=a.id,this.draggingFaceIndex=this.boxFace.getFace(),this.draggingFaceNormal.copy(l),this.faceNormalWorld0.copy(l).transformDirection(a.getWorldMatrix()),this.position0.copy(a.value(Ue)),this.boxSize0.copy(a.value(ps)),this.localMat0.copy(a.getLocalMatrix()),this.invWorldMat0.copy(a.getWorldMatrix()).invert(),this.mouse0.copy(o.point),this.local0.copy(this.mouse0).applyMatrix4(this.invWorldMat0)));break}}s.isKeyPressed("Alt")&&s.mouseLeftDownThisFrame&&(this.boxFace.visible?(this.creating=!0,this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2),this.normal1.transformDirection(this.boxFace.matrix),this.normal2.transformDirection(this.boxFace.matrix)):on(this.point1,n.mouseRay0,n.mouseRay1,this.point1.set(0,0,0),n.camera.perspective?I8.set(0,1,0):n.mouseRayN)&&(n.camera.perspective?(this.normal1.set(1,0,0),this.normal2.set(0,1,0)):(this.boxFace.setFaceFromNormal(n.mouseRayN),this.boxFace.getFaceTangent(this.normal1),this.boxFace.getFaceNormal(this.normal2)),this.creating=!0),this.creating&&(s.isKeyPressed("Shift")&&bu(this.point1,Ni),this.activeViewIndex=n.index,this.boxHeight=0,this.boxEdge.setPoint1(this.point1),this.boxEdge.setPoint2(this.point1),this.boxEdge.setNormal1(this.normal1),this.boxEdge.setNormal2(this.normal2),this.boxEdge.setHeight(0),this.boxEdge.updateGeometry(),this.boxEdge.visible=!0))}}onUnselected(t){this.draggingFace=!1,this.creating=!1,this.point2Set=!1,this.boxEdge.visible=!1,this.boxFace.visible=!1}}h(_h,"BoxTool");R8(_h,"BoxTool");var D8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAItJREFUSIntkskRgCAMAIljIR4taP8FaAsencSPMtGBkGD4sR8zjO6C6lwlF7wpGqDXYoFika/UPBISmkZiMrMIJzKJpCS/IxLBr4j04dR9rUUcEREAICswdJOf93P1c0yoCjzy7VhQIxWBBLoWmjnYE5juWIr2FE1uiH58DvUroLse+xmce/9dFTUXvoWCImYNNpoAAAAASUVORK5CYII=",L8=Object.defineProperty,k8=h((i,e)=>L8(i,"name",{value:e,configurable:!0}),"__name$N");class bh extends ln{constructor(){super(...arguments);C(this,"name",bh.name);C(this,"label","Select");C(this,"icon",D8);C(this,"enableSelectionRect",!0);C(this,"enableDefaultSelectionBehavior",!0)}}h(bh,"CursorTool");k8(bh,"CursorTool");var O8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntk0sOwCAIRB3vf2e6aqJN+AnEJjpLJfNQhtaudgvcBRHRVAiwtW59zbmzNPMIpGuwaOcioERaxymzyJ6DyygN4IGMYXAHw7ITo7nUmBnCQUOxliDSC8x7AABaurQak5b/+ZeQUsALKQWcoQdg9q9krk0nEQAAAABJRU5ErkJggg==",N8=Object.defineProperty,F8=h((i,e)=>N8(i,"name",{value:e,configurable:!0}),"__name$M");const eg=new A,Id=new A,Dd=new A,Uo=new A,Ld=new ve,Ja=new ve,kd=new ve,el=new A,us=new Be,tg=new Be,z8=new Be,Mw=new Be,Od=new A,Aw=new A,Nd=new A,Sw=new A,Cw=new A,ng=new A,Fd=new Be,Tw=new A;class Tv extends ln{constructor(){super(...arguments);C(this,"label","IK Bind");C(this,"icon",O8);C(this,"activeView",-1);C(this,"ikChains",[]);C(this,"node");C(this,"rotate",!1);C(this,"mouse0",new A);C(this,"nodeInvMat",new ve);C(this,"chainInvMat",new ve);C(this,"chainPosition0",new A);C(this,"nodeStart0",new A);C(this,"nodeEnd0",new A);C(this,"nodeRotation0",new Be);C(this,"nodeLocalMat0",new Map);C(this,"objWorldMat0",new Map)}begin(t){this.cleanup(t);const n=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?n.add(s):s.type==="IKNode"&&s.parent&&n.add(s.parent);this.ikChains=Array.from(n);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const l=s.children[r].get(mt);l.boneMesh&&(l.boneMesh.visible=!0),l.hingeIndicator&&(l.hingeIndicator.visible=l.hingeEnabled),r===0&&l.moveHandler&&(l.moveHandler.visible=!0),l.rotateHandler&&(l.rotateHandler.visible=!0)}}update(t,n){const s=n.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null;for(let l of this.ikChains)for(let c of l.children){const u=c.get(mt);u.updateHandlersHoverState(c,n),u.moveHandlerHovered&&u.moveHandlerZ<r&&(r=u.moveHandlerZ,o=c,a=u),u.rotateHandlerHovered&&u.rotateHandlerZ<r&&(r=u.rotateHandlerZ,o=c,a=u)}if(o&&a){this.node=o,this.rotate=a.rotateHandlerHovered,this.activeView=n.index;const l=o.parent,c=l.getWorldMatrix();this.mouse0.copy(this.rotate?a.end:a.start).applyMatrix4(c),on(this.mouse0,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),this.nodeInvMat.copy(c).invert(),this.chainInvMat.copy(l.getParentWorldMatrix()).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.nodeRotation0.copy(a.quaternion),this.chainPosition0.copy(l.value(Ue)),this.nodeLocalMat0.clear(),this.objWorldMat0.clear();for(let u of l.children){this.nodeLocalMat0.set(u.id,new ve().copy(u.getLocalMatrix()));for(let d of u.children)this.objWorldMat0.set(d.id,new ve().copy(d.getWorldMatrix()))}t.model.addSelection(this.node.id)}}}else if(this.activeView===n.index&&this.node&&!this.node.deleted){const r=this.node.parent;if(on(eg,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),this.rotate){Id.copy(this.mouse0).applyMatrix4(this.nodeInvMat),Dd.copy(eg).applyMatrix4(this.nodeInvMat),Uo.subVectors(Dd,Id),Aw.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),Nd.copy(this.nodeEnd0).add(Uo).sub(this.nodeStart0);let o=Nd.length();Nd.normalize(),tg.setFromUnitVectors(Aw,Nd),Sw.set(0,0,1).applyQuaternion(this.nodeRotation0).applyQuaternion(tg),Cw.set(0,1,0).applyQuaternion(this.nodeRotation0).applyQuaternion(tg),ec(us,Sw,Cw),Fd.copy(us);const a=r.children.indexOf(this.node);if(a>0){const c=r.children[a-1];Mw.copy(c.get(mt).quaternion).invert(),us.multiplyQuaternions(Mw,us)}let l=t.history.setValue(this.node,Ut,new it().setFromQuaternion(us));if(t.options.allowModifyingBoneLengthWhenBindingIk&&(l=t.history.setValue(this.node,fi,o)||l),l&&t.options.keepInternalTransformWhenBindingIk){let c=r.children.indexOf(this.node);if(c<0)return;ng.copy(this.node.get(mt).start),Tw.set(1,1,1);const u=r.getWorldMatrix();for(let d=r.children.length;c<d;++c){const f=r.children[c];Ja.compose(ng,Fd,Tw),Ja.multiplyMatrices(u,Ja).invert();for(let g of f.children){const m=this.objWorldMat0.get(g.id);!m||(kd.multiplyMatrices(Ja,m),kd.decompose(el,us,Od),g.has(Ue)&&t.history.setValue(g,Ue,new A().copy(el)),g.has(lt)&&t.history.setValue(g,lt,new it().setFromQuaternion(us)))}const p=c+1;if(p<d){Uo.set(o,0,0).applyQuaternion(Fd),ng.add(Uo);const g=r.children[p];Fd.multiply(z8.setFromEuler(g.value(Ut))),o=g.value(fi)}}}}else if(Id.copy(this.mouse0).applyMatrix4(this.chainInvMat),Dd.copy(eg).applyMatrix4(this.chainInvMat),Uo.subVectors(Dd,Id),t.history.setValue(r,Ue,new A().copy(this.chainPosition0).add(Uo))&&t.options.keepInternalTransformWhenBindingIk){el.copy(this.chainPosition0).add(Uo),us.setFromEuler(r.value(lt)),Od.setScalar(r.value(Ft)),Ld.compose(el,us,Od),Ld.multiplyMatrices(r.getParentWorldMatrix(),Ld);for(let a of r.children){const l=this.nodeLocalMat0.get(a.id);if(!!l){Ja.multiplyMatrices(Ld,l).invert();for(let c of a.children){const u=this.objWorldMat0.get(c.id);!u||(kd.multiplyMatrices(Ja,u),kd.decompose(el,us,Od),c.has(Ue)&&t.history.setValue(c,Ue,new A().copy(el)),c.has(lt)&&t.history.setValue(c,lt,new it().setFromQuaternion(us)))}}}}}}else this.activeView===n.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let n of this.ikChains)if(!n.deleted)for(let s of n.children){if(s.deleted)continue;s.get(mt).resetHandlers(t)}this.ikChains.length=0}}h(Tv,"IkBindTool");F8(Tv,"IkBindTool");var B8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntktsOwCAIQ+3+/5/xyWRbVrATNVl23kRCubSUn92AfZiZXRIBmitzL85iacVHRI5IbLRzV0Chu5Eokd1HmvbNHVj8cUUAkOYaD6VbaYJGxiShi7at6/yWXdQj4gmmiExd2zKR6cdf4q7vUwFJaZOIR/7h8gAAAABJRU5ErkJggg==",U8=Object.defineProperty,V8=h((i,e)=>U8(i,"name",{value:e,configurable:!0}),"__name$L");const wi=new A,Ew=new ve;class Ev extends ln{constructor(){super(...arguments);C(this,"label","Stretch Joint");C(this,"icon",B8);C(this,"node",null);C(this,"dragging",!1);C(this,"draggedPrevFrame",!1);C(this,"length0",0);C(this,"childrenPosition0",new Map);C(this,"scale",new A)}begin(t){this.cleanup(t),this.node=null;for(let s of t.model.getSelectedNodes())if(!s.instanceId){this.node=s;break}for(;this.node&&!(this.node.type==="IKNode"&&!this.node.instanceId);)this.node=this.node.parent;if(!this.node){this.enableTransformControls=!1;return}const n=this.node.parent;for(let s=0,r=n.children.length;s<r;++s){const a=n.children[s].get(mt);a.boneMesh&&(a.boneMesh.visible=!0)}if(this.enableTransformControls=!0,!this.dragging){this.node.getWorldMatrix().decompose(t.dummyObject.position,t.dummyObject.quaternion,t.dummyObject.scale),t.dummyObject.scale.setScalar(1),this.length0=this.node.value(fi),this.childrenPosition0.clear();for(let s of this.node.children)s.has(Ue)&&this.childrenPosition0.set(s.id,new A().copy(s.value(Ue)))}this.draggedPrevFrame=this.dragging,this.dragging=!1}update(t,n){if(!this.enableTransformControls){const r=n.input;if(r.pointerOver&&r.mouseLeftDownThisFrame)for(let o of n.mousePick()){const a=o.object.userData.node;if(a&&!a.instanceId){t.model.selected=[a.id];break}}return}const s=n.transformControls;if(s.camera=n.camera.get(),s.setMode("translate"),s.setMode("scale"),s.setSpace("local"),s.dragging&&this.node){this.dragging=!0;const r=t.dummyObject.matrix;$A(this.scale,r),this.scale.x=Math.max(this.scale.x,0),t.history.setValue(this.node,fi,this.length0*this.scale.x);for(let o of this.childrenPosition0){const a=t.model.getNode(o[0]),l=o[1],c=new A().copy(l);c.x*=this.scale.x,t.history.setValue(a,Ue,c)}for(let o of this.node.children)o.type==="Clay"&&t.model.setValue(o,Sr,new A().copy(this.scale))}}end(t){if(this.draggedPrevFrame&&!this.dragging&&this.node){const n=this.scale,s=this.length0,r=n.x*s,o=r-s,a=t.options.keepBothEndsOfClayNodesWhenStretching;let l=!1;for(let c of this.node.children)if(c.type==="Clay"){l=!0;const u=c.getLocalMatrix();Ew.copy(u).invert();const d=c.cloneValue(an);for(let f=0,p=d.length;f<p;f+=3)wi.fromArray(d,f),wi.applyMatrix4(u),n.x>1&&a?wi.x>0&&wi.x<r?wi.x*=n.x:wi.x>=r&&(wi.x+=o):wi.x*=n.x,wi.y*=n.y,wi.z*=n.z,wi.applyMatrix4(Ew),d[f]=wi.x,d[f+1]=wi.y,d[f+2]=wi.z;t.history.setValue(c,an,d)}if(l){const c=[];c.push({node:this.node,componentClass:fi});for(let u of this.childrenPosition0){const d=t.model.getNode(u[0]);c.push({node:d,componentClass:Ue})}t.history.mergeLastRecord(c)}}}onUnselected(t){this.cleanup(t),this.node=null,this.dragging=!1,this.draggedPrevFrame=!1,this.scale.setScalar(1),this.childrenPosition0.clear()}cleanup(t){if(this.node){for(let s of this.node.children)s.type==="Clay"&&t.model.setValue(s,Sr,new A(1,1,1));const n=this.node.parent;for(let s=0,r=n.children.length;s<r;++s)n.children[s].get(mt).resetHandlers(t)}}}h(Ev,"IkJointStretchTool");V8(Ev,"IkJointStretchTool");var H8=Object.defineProperty,G8=h((i,e)=>H8(i,"name",{value:e,configurable:!0}),"__name$K");class Pv{constructor(){C(this,"length",0);C(this,"localRotation",new Be);C(this,"start",new A);C(this,"end",new A);C(this,"rotation",new Be);C(this,"hingeEnabled",!1);C(this,"hingeAxis",new A(1,0,0));C(this,"lowerAngle",-Math.PI);C(this,"upperAngle",+Math.PI)}}h(Pv,"CcdJoint");G8(Pv,"CcdJoint");var W8=Object.defineProperty,j8=h((i,e)=>W8(i,"name",{value:e,configurable:!0}),"__name$J");const ig=new A,Pw=new A,Rw=new A,Wc=new Be,Iw=new A,Dw=new A,zd=new Be,Bd=new A;class Rv{constructor(){C(this,"joints",[]);C(this,"iterLimit",20);C(this,"precision",1e-4)}resize(e){this.joints.length=e;for(let t=0;t<e;++t)this.joints[t]||(this.joints[t]=new Pv)}resolve(e){const t=this.joints.length;if(!t)return;for(let s=0;s<t;++s){const r=this.joints[s];if(s>0){const o=this.joints[s-1];r.rotation.multiplyQuaternions(o.rotation,r.localRotation),r.start.copy(o.end)}else r.rotation.copy(r.localRotation),r.start.set(0,0,0);r.end.set(r.length,0,0).applyQuaternion(r.rotation).add(r.start)}const n=this.joints[t-1];ig.copy(n.end);for(let s=0;s<this.iterLimit;++s){for(let r=t-1;r>=0;--r){const o=this.joints[r];if(Pw.subVectors(n.end,o.start).normalize(),Rw.subVectors(e,o.start).normalize(),Wc.setFromUnitVectors(Pw,Rw),Iw.set(0,0,1).applyQuaternion(o.rotation).applyQuaternion(Wc),Dw.set(0,1,0).applyQuaternion(o.rotation).applyQuaternion(Wc),ec(o.localRotation,Iw,Dw),r>0){const a=this.joints[r-1];zd.copy(a.rotation).invert(),o.localRotation.multiplyQuaternions(zd,o.localRotation)}if(o.hingeEnabled){zd.copy(o.localRotation).invert(),Bd.copy(o.hingeAxis).applyQuaternion(zd),Wc.setFromUnitVectors(o.hingeAxis,Bd),o.localRotation.multiply(Wc).normalize();let a=yr(Bd,o.localRotation);const l=Math.sign(Bd.dot(o.hingeAxis));a=f1(a*l,o.lowerAngle,o.upperAngle),o.localRotation.setFromAxisAngle(o.hingeAxis,a)}for(let a=r;a<t;++a){const l=this.joints[a];if(a>0){const c=this.joints[a-1];l.rotation.multiplyQuaternions(c.rotation,l.localRotation),l.start.copy(c.end)}else l.rotation.copy(l.localRotation),l.start.set(0,0,0);l.end.set(l.length,0,0).applyQuaternion(l.rotation).add(l.start)}}if(n.end.distanceToSquared(ig)<=this.precision||n.end.distanceToSquared(e)<=this.precision)break;ig.copy(n.end)}}}h(Rv,"CcdChain");j8(Rv,"CcdChain");var $8=Object.defineProperty,Ir=h((i,e)=>$8(i,"name",{value:e,configurable:!0}),"__name$I");class Iv{constructor(e){C(this,"node");C(this,"length",0);C(this,"localRotation",new Be);C(this,"localRotation0",new Be);C(this,"hingeEnabled",!1);C(this,"hingeAxis",new A(1,0,0));C(this,"lowerAngle",-Math.PI);C(this,"upperAngle",+Math.PI);C(this,"localMat",new ve);C(this,"worldMat",new ve);C(this,"hasLockEndChild",!1);C(this,"children",[]);C(this,"parent",null);C(this,"start",new A);C(this,"end",new A);C(this,"rotation",new Be);this.node=e}}h(Iv,"VirtualIkNode");Ir(Iv,"VirtualIkNode");class Dv{constructor(){C(this,"localMat",new ve);C(this,"worldMat",new ve);C(this,"hasLockEndChild",!1);C(this,"children",[]);C(this,"parent",null)}}h(Dv,"VirtualContainer");Ir(Dv,"VirtualContainer");class Lp{constructor(){C(this,"children",[]);C(this,"localMat",new ve);C(this,"worldMat",new ve);C(this,"hasLockEndChild",!1);C(this,"lockEnd",!1);C(this,"endWorld",new A);C(this,"parent",null)}}h(Lp,"VirtualIkChain");Ir(Lp,"VirtualIkChain");function Lv(i){const e=[];let t=!1;for(let n of i.children){const s=Lv(n);s&&(e.push(s),(s.hasLockEndChild||s.lockEnd)&&(t=!0))}switch(i.type){case"Container":{const n=new Dv;n.localMat.copy(i.getLocalMatrix()),n.worldMat.copy(i.getWorldMatrix()),n.hasLockEndChild=t,n.children=e;for(let s of n.children)s.parent=n;return n}case"IKChain":{const n=new Lp;if(n.localMat.copy(i.getLocalMatrix()),n.worldMat.copy(i.getWorldMatrix()),n.lockEnd=i.value(Wu),n.hasLockEndChild=t,n.children=e,n.lockEnd&&i.children.length){const s=i.children[i.children.length-1];n.endWorld.copy(s.get(mt).end),n.endWorld.applyMatrix4(n.worldMat)}for(let s of n.children)s.parent=n;return n}case"IKNode":{const n=new Iv(i);switch(n.localMat.copy(i.getLocalMatrix()),n.worldMat.copy(i.getWorldMatrix()),n.length=i.value(fi),n.localRotation.setFromEuler(i.value(Ut)),n.localRotation0.copy(n.localRotation),i.value(Ti)){case"horizontal":n.hingeEnabled=!0,n.hingeAxis.set(0,1,0);break;case"vertical":n.hingeEnabled=!0,n.hingeAxis.set(0,0,1);break;default:n.hingeEnabled=!1;break}const s=i.value(co);if(n.lowerAngle=s[0]/180*Math.PI,n.upperAngle=s[1]/180*Math.PI,i.instanceId&&i.has(_n)){const r=i.value(_n);switch(i.value(Ti)){case"horizontal":r.z>1e-6&&([n.lowerAngle,n.upperAngle]=[-n.upperAngle,-n.lowerAngle]);break;case"vertical":r.y>1e-6&&([n.lowerAngle,n.upperAngle]=[-n.upperAngle,-n.lowerAngle]);break}}n.hasLockEndChild=t,n.children=e;for(let r of n.children)r.parent=n;return n}}return null}h(Lv,"createVirtualNode");Ir(Lv,"createVirtualNode");function EC(i){return Lv(i)}h(EC,"saveIkChainState");Ir(EC,"saveIkChainState");const Ud=new Rv,X8=new A(1,1,1);function kv(i,e,t,n){Ud.resize(t+1);for(let s=0;s<=t;++s){const r=Ud.joints[s],o=e.children[s];r.length=o.length,r.localRotation.copy(o.localRotation),r.hingeEnabled=o.hingeEnabled,r.hingeAxis.copy(o.hingeAxis),r.lowerAngle=o.lowerAngle,r.upperAngle=o.upperAngle}Ud.resolve(n);for(let s=0;s<=t;++s){const r=Ud.joints[s],o=e.children[s];o.localRotation.copy(r.localRotation),i.history.setValue(o.node,Ut,new it().setFromQuaternion(o.localRotation))}Ov(e)}h(kv,"resolveIkChain");Ir(kv,"resolveIkChain");function Ov(i){for(let e=0,t=i.children.length;e<t;++e){const n=i.children[e];if(e===0)n.rotation.copy(n.localRotation),n.start.set(0,0,0);else{const s=i.children[e-1];n.rotation.multiplyQuaternions(s.rotation,n.localRotation),n.start.copy(s.end)}n.end.set(n.length,0,0).applyQuaternion(n.rotation).add(n.start),n.localMat.compose(n.start,n.rotation,X8)}}h(Ov,"updateIkChainLocalMatrices");Ir(Ov,"updateIkChainLocalMatrices");const Lw=new ve,kw=new A;function Xf(i,e){if((e.hasLockEndChild||e.lockEnd)&&e.parent&&e.worldMat.multiplyMatrices(e.parent.worldMat,e.localMat),e.lockEnd){const t=e;Lw.copy(t.worldMat).invert(),kw.copy(t.endWorld).applyMatrix4(Lw),kv(i,t,t.children.length-1,kw)}if(e.hasLockEndChild)for(let t of e.children)Xf(i,t)}h(Xf,"resolveLockedEnds");Ir(Xf,"resolveLockedEnds");function Nv(i){if(i instanceof Lp)for(let e of i.children)e.localRotation.copy(e.localRotation0);if(i.hasLockEndChild)for(let e of i.children)Nv(e)}h(Nv,"resetIkChains");Ir(Nv,"resetIkChains");var Y8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHlJREFUSIntU0EOwDAIqvv/n9m1MzjRNlmylCNSsFHHOPgaxkgAeIjMqK4Fbx5x28xXQ643w8xU0YQBGQCgPBulY6+bOeVH6RyYOau1Qjwf/aQVUlnfckjVqLTSHZO5VlrTbRetmEYzajWhDpzx8iXOj9kFZ/WDH+MGbSHHUbX+Pw0AAAAASUVORK5CYII=",K8=Object.defineProperty,q8=h((i,e)=>K8(i,"name",{value:e,configurable:!0}),"__name$H");const sr=new A,rr=new A,tl=new A,nl=new A,Ow=new A,jc=new A,Vo=new Be,Vd=new Be,Nw=new A,Fw=new A,Ho=new A,sg=new A,zw=new Be,Bw=new A;class Fv extends ln{constructor(){super(...arguments);C(this,"label","Move IK Chain");C(this,"icon",Y8);C(this,"activeView",-1);C(this,"ikChains",[]);C(this,"node");C(this,"action","swing");C(this,"mouse0",new A);C(this,"origin",new A);C(this,"boneAxis",new A);C(this,"invMat",new ve);C(this,"nodeEnd0",new A);C(this,"rotation0",new Be);C(this,"position0",new A);C(this,"chain0",null)}begin(t){this.cleanup(t);const n=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?n.add(s):s.type==="IKNode"&&s.parent&&n.add(s.parent);this.ikChains=Array.from(n);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const a=s.children[r],l=a.get(mt);r===0&&l.moveHandler&&(l.moveHandler.visible=s.value(Hl)),l.rotateHandler&&(l.rotateHandler.visible=a.value(Gl))}}update(t,n){const s=n.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null,l=!1;for(let c of this.ikChains)for(let u of c.children){const d=u.get(mt);d.updateHandlersHoverState(u,n),d.moveHandlerHovered&&d.moveHandlerZ<r&&(r=d.moveHandlerZ,o=u,a=d,l=!1),d.rotateHandlerHovered&&d.rotateHandlerZ<r&&(r=d.rotateHandlerZ,o=u,a=d,l=!0)}if(o&&a){this.node=o,this.action=l?"swing":"move",this.activeView=n.index;const c=o.parent,u=c.getWorldMatrix();l?this.mouse0.copy(a.end).applyMatrix4(u):(this.position0.copy(c.value(Ue)),Ea(this.mouse0,c.getWorldMatrix())),on(this.mouse0,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),l?(this.invMat.copy(u).invert(),this.nodeEnd0.copy(a.end)):this.invMat.copy(c.getParentWorldMatrix()).invert(),t.model.addSelection(this.node.id)}else{let c;for(let f of n.mousePick()){for(c=f.object.userData.node;c&&!c.has(mt);)c=c.parent||void 0;if(c){this.mouse0.copy(f.point);break}}if(!c){t.model.selected=[];return}if(t.model.selected=[c.id],c.value(Ti)!=="none")return;this.node=c,this.action="twist",this.activeView=n.index;const u=c.getParentWorldMatrix();this.invMat.copy(u).invert(),rr.copy(this.mouse0).applyMatrix4(this.invMat);const d=c.get(mt);this.boneAxis.subVectors(d.end,d.start).normalize(),YA(this.origin,d.start,this.boneAxis,rr),this.boneAxis.transformDirection(u),this.rotation0.copy(d.quaternion),this.origin.distanceTo(rr)<1e-8?this.node=void 0:this.origin.applyMatrix4(u)}this.node&&(this.chain0=EC(this.node.parent))}}else if(this.activeView===n.index&&this.node&&!this.node.deleted&&this.chain0){let r=!1;if(this.action==="move"){on(sr,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),rr.copy(this.mouse0).applyMatrix4(this.invMat),tl.copy(sr).applyMatrix4(this.invMat),nl.subVectors(tl,rr);const o=this.node.parent,a=new A().addVectors(this.position0,nl);r=t.history.setValue(o,Ue,a),Vo.setFromEuler(o.value(lt)),Bw.setScalar(o.value(Ft)),this.chain0.localMat.compose(a,Vo,Bw),this.chain0.worldMat.multiplyMatrices(o.getParentWorldMatrix(),this.chain0.localMat)}else if(this.action==="swing"){if(on(sr,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),rr.copy(this.mouse0).applyMatrix4(this.invMat),tl.copy(sr).applyMatrix4(this.invMat),nl.subVectors(tl,rr),nl.lengthSq()<1e-6)return;jc.copy(this.nodeEnd0).add(nl),this.mouse0.copy(sr),this.nodeEnd0.copy(jc);const o=this.chain0.children.findIndex(a=>a.node.id===this.node.id);kv(t,this.chain0,o,jc),r=!0}else{if(Math.acos(Math.abs(this.boneAxis.dot(n.mouseRayN)))*180/Math.PI>45){if(!on(sr,n.mouseRay0,n.mouseRay1,this.origin,n.mouseRayN))return;Ho.crossVectors(this.boneAxis,n.mouseRayN).normalize();const c=this.mouse0.distanceTo(this.origin),u=.4,d=-nl.subVectors(sr,this.mouse0).dot(Ho)/c*Math.PI/2*u;Ho.copy(this.boneAxis).transformDirection(this.invMat),Vd.setFromAxisAngle(Ho,d)}else{if(!on(sr,n.mouseRay0,n.mouseRay1,this.origin,this.boneAxis))return;rr.copy(this.mouse0).applyMatrix4(this.invMat),tl.copy(sr).applyMatrix4(this.invMat),sg.copy(this.origin).applyMatrix4(this.invMat),Ow.subVectors(rr,sg).normalize(),jc.subVectors(tl,sg).normalize(),Ho.copy(this.boneAxis).transformDirection(this.invMat);const c=KA(Ho,Ow,jc);Vd.setFromAxisAngle(Ho,c)}Nw.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(Vd),Fw.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(Vd),ec(Vo,Nw,Fw);const o=this.node.parent,a=o.children.indexOf(this.node);if(a>0){const c=o.children[a-1];zw.copy(c.get(mt).quaternion).invert(),Vo.multiplyQuaternions(zw,Vo)}r=t.history.setValue(this.node,Ut,new it().setFromQuaternion(Vo)),this.chain0.children.find(c=>c.node.id===this.node.id).localRotation.copy(Vo),Ov(this.chain0)}if(r){for(let o of this.chain0.children)Nv(o);if(this.node.id===this.chain0.children[this.chain0.children.length-1].node.id)for(let o of this.chain0.children)Xf(t,o);else Xf(t,this.chain0)}}}else this.activeView===n.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let n of this.ikChains)if(!n.deleted)for(let s of n.children){if(s.deleted)continue;s.get(mt).resetHandlers(t)}this.ikChains.length=0}}h(Fv,"IkMoveTool");q8(Fv,"IkMoveTool");var Z8="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHhJREFUSIntk0sOgDAIRDve/864ra0DJUM1Mc4SKI9Pae3X2wJzmJldAgEam9aYnNnKkiuQI4KplbuALYoqZn7r1NunDgBAGcvyb/Mq9eyp4rKQO7+7ZHVcIaAKsqQRUn2Q00MGlLtliSqu3oWwQ5Mg25f/yO/6vk5YzaN81PvS3QAAAABJRU5ErkJggg==",Q8=Object.defineProperty,J8=h((i,e)=>Q8(i,"name",{value:e,configurable:!0}),"__name$G");const qr=new A,or=new A,il=new A,$c=new A,Hd=new A,Gd=new A,Zr=new Be,Go=new Be,Uw=new A,Vw=new A,Wo=new A,rg=new A,Wd=new Be,jd=new A,sl=new A;class zv extends ln{constructor(){super(...arguments);C(this,"label","Move Single Joint (Ignore IK)");C(this,"icon",Z8);C(this,"activeView",-1);C(this,"ikChains",[]);C(this,"node");C(this,"action","swing");C(this,"mouse0",new A);C(this,"origin",new A);C(this,"boneAxis",new A);C(this,"invMat",new ve);C(this,"nodeStart0",new A);C(this,"nodeEnd0",new A);C(this,"rotation0",new Be);C(this,"position0",new A)}begin(t){this.cleanup(t);const n=new Set;for(let s of t.model.getSelectedNodes())s.type==="IKChain"?n.add(s):s.type==="IKNode"&&s.parent&&n.add(s.parent);this.ikChains=Array.from(n);for(let s of this.ikChains)for(let r=0,o=s.children.length;r<o;++r){const a=s.children[r],l=a.get(mt);r===0&&l.moveHandler&&(l.moveHandler.visible=s.value(Hl)),l.rotateHandler&&(l.rotateHandler.visible=a.value(Gl))}}update(t,n){const s=n.input;if(s.mouseLeft){if(s.mouseLeftDownThisFrame){if(s.pointerOver){let r=1/0,o=null,a=null,l=!1;for(let c of this.ikChains)for(let u of c.children){const d=u.get(mt);d.updateHandlersHoverState(u,n),d.moveHandlerHovered&&d.moveHandlerZ<r&&(r=d.moveHandlerZ,o=u,a=d,l=!1),d.rotateHandlerHovered&&d.rotateHandlerZ<r&&(r=d.rotateHandlerZ,o=u,a=d,l=!0)}if(o&&a){this.node=o,this.action=l?"swing":"move",this.activeView=n.index;const c=o.parent,u=c.getWorldMatrix();l?this.mouse0.copy(a.end).applyMatrix4(u):(this.position0.copy(c.value(Ue)),Ea(this.mouse0,c.getWorldMatrix())),on(this.mouse0,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),l?(this.invMat.copy(u).invert(),this.nodeStart0.copy(a.start),this.nodeEnd0.copy(a.end),this.rotation0.copy(a.quaternion)):this.invMat.copy(c.getParentWorldMatrix()).invert(),t.model.addSelection(this.node.id)}else{let c;for(let f of n.mousePick()){for(c=f.object.userData.node;c&&!c.has(mt);)c=c.parent||void 0;if(c){this.mouse0.copy(f.point);break}}if(!c){t.model.selected=[];return}if(t.model.selected=[c.id],c.value(Ti)!=="none")return;this.node=c,this.action="twist",this.activeView=n.index;const u=c.getParentWorldMatrix();this.invMat.copy(u).invert(),or.copy(this.mouse0).applyMatrix4(this.invMat);const d=c.get(mt);this.boneAxis.subVectors(d.end,d.start).normalize(),YA(this.origin,d.start,this.boneAxis,or),this.boneAxis.transformDirection(u),this.rotation0.copy(d.quaternion),this.origin.distanceTo(or)<1e-8?this.node=void 0:this.origin.applyMatrix4(u)}}}else if(this.activeView===n.index&&this.node&&!this.node.deleted)if(this.action==="move"){on(qr,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),or.copy(this.mouse0).applyMatrix4(this.invMat),il.copy(qr).applyMatrix4(this.invMat),$c.subVectors(il,or);const r=this.node.parent;t.history.setValue(r,Ue,new A().addVectors(this.position0,$c))}else{if(this.action==="swing")on(qr,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN),or.copy(this.mouse0).applyMatrix4(this.invMat),il.copy(qr).applyMatrix4(this.invMat),$c.subVectors(il,or),Hd.subVectors(this.nodeEnd0,this.nodeStart0).normalize(),Gd.subVectors(this.nodeEnd0,this.nodeStart0).add($c).normalize(),Go.setFromUnitVectors(Hd,Gd);else if(Math.acos(Math.abs(this.boneAxis.dot(n.mouseRayN)))*180/Math.PI>45){if(!on(qr,n.mouseRay0,n.mouseRay1,this.origin,n.mouseRayN))return;Wo.crossVectors(this.boneAxis,n.mouseRayN).normalize();const l=this.mouse0.distanceTo(this.origin),c=.4,u=-$c.subVectors(qr,this.mouse0).dot(Wo)/l*Math.PI/2*c;Wo.copy(this.boneAxis).transformDirection(this.invMat),Go.setFromAxisAngle(Wo,u)}else{if(!on(qr,n.mouseRay0,n.mouseRay1,this.origin,this.boneAxis))return;or.copy(this.mouse0).applyMatrix4(this.invMat),il.copy(qr).applyMatrix4(this.invMat),rg.copy(this.origin).applyMatrix4(this.invMat),Hd.subVectors(or,rg).normalize(),Gd.subVectors(il,rg).normalize(),Wo.copy(this.boneAxis).transformDirection(this.invMat);const l=KA(Wo,Hd,Gd);Go.setFromAxisAngle(Wo,l)}Uw.set(0,0,1).applyQuaternion(this.rotation0).applyQuaternion(Go),Vw.set(0,1,0).applyQuaternion(this.rotation0).applyQuaternion(Go),ec(Zr,Uw,Vw);const r=this.node.parent,o=r.children.indexOf(this.node);if(o>0){const l=r.children[o-1];Wd.copy(l.get(mt).quaternion).invert(),Zr.multiplyQuaternions(Wd,Zr)}let a=!1;switch(this.node.value(Ti)){case"horizontal":sl.set(0,1,0),a=!0;break;case"vertical":sl.set(0,0,1),a=!0;break}if(a){Wd.copy(Zr).invert(),jd.copy(sl).applyQuaternion(Wd),Go.setFromUnitVectors(sl,jd),Zr.multiply(Go).normalize();let l=yr(jd,Zr);const c=Math.sign(jd.dot(sl)),u=this.node.value(co);let d=u[0],f=u[1];if(this.node.instanceId&&this.node.has(_n)){const p=this.node.value(_n);switch(this.node.value(Ti)){case"horizontal":p.z>1e-6&&([d,f]=[-f,-d]);break;case"vertical":p.y>1e-6&&([d,f]=[-f,-d]);break}}l=f1(l*c,d/180*Math.PI,f/180*Math.PI),Zr.setFromAxisAngle(sl,l)}t.history.setValue(this.node,Ut,new it().setFromQuaternion(Zr))}}else this.activeView===n.index&&(this.activeView=-1,this.node=void 0)}onUnselected(t){this.cleanup(t)}cleanup(t){for(let n of this.ikChains)if(!n.deleted)for(let s of n.children){if(s.deleted)continue;s.get(mt).resetHandlers(t)}this.ikChains.length=0}}h(zv,"IkRotateTool");J8(zv,"IkRotateTool");var eV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIdJREFUSIntlUsOwCAIRKHp/a883TWUgsqnSRfOzhjn8VEk2pqI5QIAWkyZ2dzoAGiPo2o401k5LKP1ylLKwK11BwAAAcAMUsngNh9BUoCVyNOAiHkYAGCpsVKvazp6bFFzE0BqfEh21NwDkA60MkE+HxX/AmRKZfbAM0pcIhPghtn1IW09dAGjkjYnuN3k5AAAAABJRU5ErkJggg==",tV=Object.defineProperty,nV=h((i,e)=>tV(i,"name",{value:e,configurable:!0}),"__name$F");const Xc=new ve,$d=new A,Yc=new A,iV=new A(1,0,0),Hw=new ve,Gw=new A,Ww=new Be,og=new A,jo=new zn;class Bv extends ln{constructor(){super(...arguments);C(this,"label","Rescale");C(this,"icon",eV);C(this,"lineMaterial",new $n({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}));C(this,"lineGeometry",new et().setFromPoints([new A(0,0,0),new A(1,0,0)]));C(this,"line",new vn(this.lineGeometry,this.lineMaterial));C(this,"nodes",[]);C(this,"dragging",!1);C(this,"draggingViewIndex",-1);C(this,"mat0",new ve);C(this,"pos0",new A);C(this,"detMat",[]);C(this,"len0",0)}setup(t){this.line.visible=!1,t.scene.add(this.line)}begin(t){this.nodes=t.model.getTopmostSelectedNodes().filter(n=>n.has(Ft)),this.nodes.length&&(this.line.visible=this.dragging)}update(t,n){if(!this.nodes.length)return;const s=n.input;if(this.dragging&&this.draggingViewIndex===n.index)if(s.mouseLeft){on($d,n.mouseRay0,n.mouseRay1,this.pos0,n.mouseRayN),this.line.position.copy(this.pos0),Yc.subVectors($d,this.pos0);const r=Yc.length();Yc.divideScalar(r),this.line.scale.setScalar(r),this.line.quaternion.setFromUnitVectors(iV,Yc),Hw.copy(this.mat0).scale(og.setScalar(r/this.len0));for(let o=0;o<this.nodes.length;++o){const a=this.nodes[o];Xc.copy(a.getParentWorldMatrix()).invert().multiply(Hw),o>0&&Xc.multiply(this.detMat[o-1]),Xc.decompose(Gw,Ww,og),t.history.setValue(a,Ft,og.x),o>0&&(t.history.setValue(a,Ue,new A().copy(Gw)),t.history.setValue(a,lt,new it().setFromQuaternion(Ww)))}if(this.nodes[0].has(Ce)){const o=this.nodes[0].value(Ce);if(o){jo.setFromObject(qe(o));const a=(jo.max.x-jo.min.x).toFixed(2),l=(jo.max.y-jo.min.y).toFixed(2),c=(jo.max.z-jo.min.z).toFixed(2);t.statusBarMessage=`${a} \xD7 ${l} \xD7 ${c}`}}}else this.dragging=!1,this.draggingViewIndex=-1;else if(s.pointerOver&&s.mouseLeftDownThisFrame){if(this.mat0.copy(this.nodes[0].getWorldMatrix()),Ea(this.pos0,this.mat0),this.detMat.length=this.nodes.length-1,this.detMat.length){Xc.copy(this.nodes[0].getWorldMatrix()).invert();for(let r=0;r<this.detMat.length;++r)this.detMat[r]||(this.detMat[r]=new ve),this.detMat[r].multiplyMatrices(Xc,this.nodes[r+1].getWorldMatrix())}on($d,n.mouseRay0,n.mouseRay1,this.pos0,n.mouseRayN),this.dragging=!0,this.draggingViewIndex=n.index,this.len0=Yc.subVectors($d,this.pos0).length();return}}onUnselected(t){this.nodes.length=0,this.dragging=!1,this.line.visible=!1}}h(Bv,"RescaleTool");nV(Bv,"RescaleTool");var sV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAKhJREFUSIntVMcRgDAMkzkGoawA+w8AK1A2CR9yl2KCwgVe6BnLilJk4EcpGAddM6gcbV0YYQAQEemaAes+e0LLNhlPUMTTrBnhsLbuc+z0NEDBiudwr3oqVqgYctwzvVknsL/oqYGke7fG8uiits5yv33k16+Iac4Vv0yyBi3Vj3CXzlRPiO+TbAcWG6o7XnSnIblvRwHiCZqatskNNNhTubO/2IP/OACgKKX6b2Wl3wAAAABJRU5ErkJggg==",rV=Object.defineProperty,oV=h((i,e)=>rV(i,"name",{value:e,configurable:!0}),"__name$E");const $o=new ve;class Uv extends ln{constructor(){super(...arguments);C(this,"label","Rotate");C(this,"icon",sV);C(this,"nodes",[]);C(this,"detMat",[]);C(this,"dragging",!1)}begin(t){if(this.nodes=t.model.getTopmostSelectedNodes().filter(n=>n.has(lt)||n.has(Ut)),!this.nodes.length){this.enableTransformControls=!1;return}if(this.enableTransformControls=!0,!this.dragging&&(this.nodes[0].getWorldMatrix().decompose(t.dummyObject.position,t.dummyObject.quaternion,t.dummyObject.scale),this.detMat.length=this.nodes.length-1,this.detMat.length)){$o.copy(this.nodes[0].getWorldMatrix()).invert();for(let n=0;n<this.detMat.length;++n)this.detMat[n]||(this.detMat[n]=new ve),this.detMat[n].multiplyMatrices($o,this.nodes[n+1].getWorldMatrix())}this.dragging=!1}update(t,n){if(!this.enableTransformControls)return;const s=n.transformControls;if(s.camera=n.camera.get(),s.setMode("rotate"),s.setSpace(t.options.useLocalSpaceForTransformControl?"local":"world"),s.setRotationSnap(n.input.isKeyPressed("Shift")?.25*Math.PI:null),s.dragging){this.dragging=!0;const r=t.dummyObject.matrix;for(let o=0;o<this.nodes.length;++o){const a=this.nodes[o];if($o.copy(a.getParentWorldMatrix()).invert().multiply(r),o>0&&$o.multiply(this.detMat[o-1]),a.has(lt)){const l=new it().setFromQuaternion(Nf(new Be,$o));t.history.setValue(a,lt,l)}else if(a.has(Ut)){const l=Nf(new Be,$o),c=a.parent,u=c.children.indexOf(a);if(u>0){const d=c.children[u-1],f=new Be().copy(d.get(mt).quaternion).invert();l.multiplyQuaternions(f,l)}t.history.setValue(a,Ut,new it().setFromQuaternion(l))}o>0&&a.has(Ue)&&t.history.setValue(a,Ue,Ea(new A,$o))}}}onUnselected(t){this.nodes.length=0,this.dragging=!1}}h(Uv,"RotateTool");oV(Uv,"RotateTool");var aV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntVEEOwCAIs2b///J2GQkh6VZQD1vsxaClIAFa2/gdzhtmH6qTtwGA8QAg8uVsnu7NTolLxM+K+zJlEpLInvPG79GRdcgUjGTPfKU5iCJ2Kr9NBZhSvlRHCD6dPSxFZdCWBCmLewF12TFIXaGu640SLqrDp4K4/n+JAAAAAElFTkSuQmCC",lV=Object.defineProperty,cV=h((i,e)=>lV(i,"name",{value:e,configurable:!0}),"__name$D");const jw=new A;class Vv extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Brush");C(this,"icon",aV);C(this,"sculpt",!0);C(this,"hasDirection",!0);C(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,n){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView)return;const s=n.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,n);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.01,u=new A,d=new A,f=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly);for(let p of f.track)this.stroke(p.indices,c,a.getAverageNormal(d,p.triangles),a.getAverageCenter(u,p.triangles),t.sculptLocalRadius,f.offset,f.position),t.sculptSym&&this.stroke(p.indicesSym,c,a.getAverageNormal(d,p.trianglesSym),a.getAverageCenter(u,p.trianglesSym),t.sculptLocalRadius,f.offset,f.position);t.history.updateVertices(r,an,f.indices,f.position)}stroke(t,n,s,r,o,a,l){r.addScaledVector(s,-o*Math.sign(n)*.5);for(let c of t)this.strokeVertex(s,r,o,n,l,a.get(c))}strokeVertex(t,n,s,r,o,a){jw.fromArray(o,a);const l=jw.distanceTo(n)/s;if(l>=1)return;const c=this.sculptFalloff(l)*r;o[a]+=t.x*c,o[a+1]+=t.y*c,o[a+2]+=t.z*c}}h(Vv,"SculptBrushTool");cV(Vv,"SculptBrushTool");var uV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHJJREFUSIntlMEKgDAMQ1Px/39ZLwoSZk2j87K9S2G0SQehwORvtoNu4tda3irbzhK/E+R3W7zSN4i4OsA9sklXcaWZk9NKErNWzc8aEaHMyQaq4CPOHclmlnfrmFR+YV9OJ7KWiXLsMqRksNhniZoAwA6iu8NUWhw/8AAAAABJRU5ErkJggg==",hV=Object.defineProperty,dV=h((i,e)=>hV(i,"name",{value:e,configurable:!0}),"__name$C");const Xd=new A,Yd=new A;class Hv extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Crease");C(this,"icon",uV);C(this,"sculpt",!0);C(this,"hasDirection",!0);C(this,"brushStrength",.25);C(this,"brushStepSpacingRadiusRatio",.1);C(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,n){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView)return;const s=n.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,n);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.1,u=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly),d=new A;for(let f of u.track)this.stroke(f.indices,c,a.getAverageNormal(d,f.triangles),f.center,t.sculptLocalRadius,u.offset,u.position),t.sculptSym&&this.stroke(f.indicesSym,c,a.getAverageNormal(d,f.trianglesSym),f.centerSym,t.sculptLocalRadius,u.offset,u.position);t.history.updateVertices(r,an,u.indices,u.position)}stroke(t,n,s,r,o,a,l){for(let c of t)this.strokeVertex(s,r,o,n,l,a.get(c))}strokeVertex(t,n,s,r,o,a){Xd.fromArray(o,a);const l=Xd.distanceTo(n)/s;if(l>=1)return;const c=this.sculptFalloff(l),u=c**5*r*-.01;o[a]+=t.x*u,o[a+1]+=t.y*u,o[a+2]+=t.z*u,Xd.fromArray(o,a),Yd.subVectors(n,Xd);const d=c*r*.1;o[a]+=Yd.x*d,o[a+1]+=Yd.y*d,o[a+2]+=Yd.z*d}}h(Hv,"SculptCreaseTool");dV(Hv,"SculptCreaseTool");var fV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHdJREFUSIntlMEOwCAIQ2H//8/stMQZcC1gdrE3I7w2RBE5+ltaaTYze8FUczwbNJ5no9kQBkfJSyarQg+M9sJwNAB3Kd/pywZsCBr+1KVM2GdGj4h+xxL/iTaDyGiLiaerA5JaEdvgTGN5nKtlh8Kh/d2294883Y/A1zVqqAZoAAAAAElFTkSuQmCC",pV=Object.defineProperty,mV=h((i,e)=>pV(i,"name",{value:e,configurable:!0}),"__name$B");const $w=new A,ag=new A,Kc=new A,Kd=new A;class Gv extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Drag");C(this,"icon",fV);C(this,"sculpt",!0);C(this,"brushRadius",100);C(this,"brushStrength",1);C(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);C(this,"nodeId",0);C(this,"stroke0");C(this,"mouse0",new A);C(this,"local0",new A);C(this,"invMat",new ve)}begin(t){t.sculptActiveView===-1&&(this.nodeId=0,this.stroke0=void 0)}update(t,n){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView)return;const s=n.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,n);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly);if(l.track.length&&(this.nodeId=r.id,this.stroke0=l,this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert()),this.nodeId!==r.id||!this.stroke0||!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}if(!on($w,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN))return;ag.copy($w).applyMatrix4(this.invMat).sub(this.local0);const c=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(Kc.copy(ag),r.value(Hi)){case"x":Kc.x*=-1;break;case"y":Kc.y*=-1;break;case"z":Kc.z*=-1;break}const u=t.options.enablePressure?1:s.pressure;this.stroke(this.stroke0.indices,this.brushStrength*u,t.sculptSym,ag,Kc,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,c),t.history.updateVertices(r,an,this.stroke0.indices,c)}stroke(t,n,s,r,o,a,l,c,u,d){for(let f of t)this.strokeVertex(s,r,o,a,l,c,n,d,u.get(f))}strokeVertex(t,n,s,r,o,a,l,c,u){if(Kd.fromArray(c,u),t){const d=Kd.distanceTo(r)/a,f=Kd.distanceTo(o)/a;if(d>=1){if(f>=1)return;const p=this.sculptFalloff(f)*l;c[u]+=s.x*p,c[u+1]+=s.y*p,c[u+2]+=s.z*p}else if(f>=1){const p=this.sculptFalloff(d)*l;c[u]+=n.x*p,c[u+1]+=n.y*p,c[u+2]+=n.z*p}else{const p=1-d+(1-f),g=this.sculptFalloff(d)*l*(1-d)/p,m=this.sculptFalloff(f)*l*(1-f)/p;c[u]+=n.x*g+s.x*m,c[u+1]+=n.y*g+s.y*m,c[u+2]+=n.z*g+s.z*m}}else{const d=Kd.distanceTo(r)/a;if(d>=1)return;const f=this.sculptFalloff(d)*l;c[u]+=n.x*f,c[u+1]+=n.y*f,c[u+2]+=n.z*f}}}h(Gv,"SculptDragTool");mV(Gv,"SculptDragTool");var gV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIVJREFUSIntVUEOgCAMo8T/f1kvmujMRjvYSXtCmKVjHbT2owL7iXJiZpPOEl9jAMjJc4itytG3xRaRL1VryZX1KP5Vg1LlIzVRnGfdboMy6mnrqs3j9cV9znURAznbFe1vs3jUAAAym0g2nQUlUskifazMj9M185pHeQ8om1my0qvkezgA21OnjKJcGJgAAAAASUVORK5CYII=",vV=Object.defineProperty,yV=h((i,e)=>vV(i,"name",{value:e,configurable:!0}),"__name$A");const lg=new A,_V=new A;class Wv extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Flatten");C(this,"icon",gV);C(this,"sculpt",!0);C(this,"brushStrength",.2);C(this,"hasDirection",!0);C(this,"hasThirdDirection",!0);C(this,"brushDirection",0);C(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,n){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView)return;const s=n.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,n);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=new A,c=new A,u=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly),d=t.options.enablePressure?1:s.pressure;for(let f of u.track)this.stroke(f.indices,this.brushStrength*d,a.getAverageNormal(c,f.triangles),a.getAverageCenter(l,f.triangles),f.center,t.sculptLocalRadius,u.offset,u.position),t.sculptSym&&this.stroke(f.indicesSym,this.brushStrength*d,a.getAverageNormal(c,f.trianglesSym),a.getAverageCenter(l,f.trianglesSym),f.centerSym,t.sculptLocalRadius,u.offset,u.position);t.history.updateVertices(r,an,u.indices,u.position)}stroke(t,n,s,r,o,a,l,c){for(let u of t)this.strokeVertex(s,r,o,a,n,c,l.get(u))}strokeVertex(t,n,s,r,o,a,l){lg.fromArray(a,l);const c=lg.distanceTo(s)/r;if(c>=1)return;const u=_V.subVectors(n,lg).dot(t);if(this.brushDirection===-Math.sign(u))return;const d=this.sculptFalloff(c)*o*u;a[l]+=t.x*d,a[l+1]+=t.y*d,a[l+2]+=t.z*d}}h(Wv,"SculptFlattenTool");yV(Wv,"SculptFlattenTool");var bV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHNJREFUSIntVEEOgDAIW43//zJeXKJkakujB7MegbaMMFqb+D3AFEVEnEgARrljnELsuIrn3KiW7prNUyZSJyrfFc8aiytWdn5FQzVgtmhVBDMAQPoHzohobsXkjvPtFnUoryiPlSHaa/107BgN+1xP2NgAXJmHlymbSbgAAAAASUVORK5CYII=",wV=Object.defineProperty,xV=h((i,e)=>wV(i,"name",{value:e,configurable:!0}),"__name$z");const cg=new A,ug=new Set,rl=new A,Xw=new A,Yw=new A;class jv extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Inflate");C(this,"icon",bV);C(this,"sculpt",!0);C(this,"brushStrength",.2);C(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,n){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView)return;const s=n.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,n);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*l*.01,u=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly);for(let d of u.track)this.stroke(a,d.indices,c,d.center,t.sculptLocalRadius,u.offset,u.position),t.sculptSym&&this.stroke(a,d.indicesSym,c,d.centerSym,t.sculptLocalRadius,u.offset,u.position);t.history.updateVertices(r,an,u.indices,u.position)}stroke(t,n,s,r,o,a,l){for(let c of n)this.strokeVertex(t,c,r,o,s,l,a.get(c))}strokeVertex(t,n,s,r,o,a,l){cg.fromArray(a,l);const c=cg.distanceTo(s)/r;if(c>=1)return;rl.set(0,0,0);let u=t.getVertexTriangleIndex(t.edgeNeighborMap[n]);const d=u;let f=50;ug.clear();do{ug.add(u),t.getNormal(Xw,u),t.getTriangleCenter(Yw,u),rl.addScaledVector(Xw,cg.distanceTo(Yw));const g=u;for(let m=0;m<3;++m){const v=u*3+m;if(t.holes[v])continue;const y=t.getVertexTriangleIndex(t.edgeNeighborMap[v]);if(u===y||ug.has(y))continue;let b=!1;for(let _=0;_<3;++_)if(t.sharedVertexMap[y*3+_]===n){b=!0;break}if(b){u=y;break}}if(g===u)break;if(f--<=0){console.warn("Loop limit reached");break}}while(d!==u);rl.normalize();const p=this.sculptFalloff(c)*o;a[l]+=rl.x*p,a[l+1]+=rl.y*p,a[l+2]+=rl.z*p}}h(jv,"SculptInflateTool");xV(jv,"SculptInflateTool");var MV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHpJREFUSIntVUkKwDAI1NL/f3l6aS6hLhMNFNq5heAsUYzIDxEBAOtOO8lVtcwXisw4WYJWl7jhCUZn0w0APLn1nmOGmTYiYRLQ5GzNwZKVsOreGoYWAapuVcBDWw+2pnjPFA0wKZb7liksD4W37LLkqdU7k237WL6JC85mj5JuLIckAAAAAElFTkSuQmCC",AV=Object.defineProperty,SV=h((i,e)=>AV(i,"name",{value:e,configurable:!0}),"__name$y");const Kw=new A,hg=new A,qc=new A,qd=new A;class $v extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Move");C(this,"icon",MV);C(this,"sculpt",!0);C(this,"brushStrength",1);C(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"]);C(this,"nodeId",0);C(this,"stroke0");C(this,"mouse0",new A);C(this,"local0",new A);C(this,"invMat",new ve)}update(t,n){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView)return;const s=n.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,n);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh;if(t.sculptStartThisFrame){if(this.nodeId=r.id,this.stroke0=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly),!this.stroke0.track.length){this.nodeId=0,this.stroke0=void 0;return}this.mouse0.copy(this.stroke0.track[0].center).applyMatrix4(r.getWorldMatrix()),this.local0.copy(this.stroke0.track[0].center),this.invMat.copy(r.getWorldMatrix()).invert();return}else if(this.nodeId!==r.id){this.nodeId=0,this.stroke0=void 0;return}if(!this.stroke0||!this.stroke0.track.length||!on(Kw,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN))return;hg.copy(Kw).applyMatrix4(this.invMat).sub(this.local0);const l=new Float32Array(this.stroke0.position);if(t.sculptSym)switch(qc.copy(hg),r.value(Hi)){case"x":qc.x*=-1;break;case"y":qc.y*=-1;break;case"z":qc.z*=-1;break}const c=t.options.enablePressure?1:s.pressure;this.stroke(this.stroke0.indices,this.brushStrength*c,t.sculptSym,hg,qc,this.stroke0.track[0].center,this.stroke0.track[0].centerSym,t.sculptLocalRadius,this.stroke0.offset,l),t.history.updateVertices(r,an,this.stroke0.indices,l)}stroke(t,n,s,r,o,a,l,c,u,d){for(let f of t)this.strokeVertex(s,r,o,a,l,c,n,d,u.get(f))}strokeVertex(t,n,s,r,o,a,l,c,u){if(qd.fromArray(c,u),t){const d=qd.distanceTo(r)/a,f=qd.distanceTo(o)/a;if(d>=1){if(f>=1)return;const p=this.sculptFalloff(f)*l;c[u]+=s.x*p,c[u+1]+=s.y*p,c[u+2]+=s.z*p}else if(f>=1){const p=this.sculptFalloff(d)*l;c[u]+=n.x*p,c[u+1]+=n.y*p,c[u+2]+=n.z*p}else{const p=1-d+(1-f),g=this.sculptFalloff(d)*l*(1-d)/p,m=this.sculptFalloff(f)*l*(1-f)/p;c[u]+=n.x*g+s.x*m,c[u+1]+=n.y*g+s.y*m,c[u+2]+=n.z*g+s.z*m}}else{const d=qd.distanceTo(r)/a;if(d>=1)return;const f=this.sculptFalloff(d)*l;c[u]+=n.x*f,c[u+1]+=n.y*f,c[u+2]+=n.z*f}}}h($v,"SculptMoveTool");SV($v,"SculptMoveTool");var CV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIFJREFUSIntVMsOwCAIo/v/f2YnE8MQqMHsYi9GbcsrQeTib6BCUlX9CIGSNjX2zLO/snknLxSx9y3z1UkH8YgVs1KAmcT21mpdfdYGJrEwwBFz1tS2oVT17jCplkZz8BJg55UaVngzHvsAAEPQstBW6MheJFnXs3hUYw2PVnnRgheBggsc8NK3TAAAAABJRU5ErkJggg==",TV=Object.defineProperty,EV=h((i,e)=>TV(i,"name",{value:e,configurable:!0}),"__name$x");const qw=new A,Xi=new A,Zc=new A,Zd=new vo,Zw=new ve;class Xv extends ln{constructor(){super(...arguments);C(this,"label","Paint");C(this,"icon",CV);C(this,"tips","Press [P] to pick color");C(this,"sculpt",!0);C(this,"brushRadius",25);C(this,"brushStrength",1);C(this,"hasHardness",!0);C(this,"hasColor",!0);C(this,"frontFacesOnly",!0);C(this,"optionsProps",["brushRadius","brushStrength","brushHardness","frontFacesOnly"])}update(t,n){if(!t.sculptNodeId)return;const s=n.input;if(s.pointerOver&&s.isKeyPressed("p")){const f=t.model.getNode(t.sculptNodeId),g=f.get(Ce).mesh;Zw.copy(f.getWorldMatrix()).invert(),Zd.origin.copy(n.mouseRay0),Zd.direction.copy(n.mouseRayN),Zd.applyMatrix4(Zw);const m=g.raycast(Zd,!0)[0];if(m){const v=m.triangleIndex;Xi.set(0,0,0),Xi.add(Zc.fromArray(g.aColor,v*9)),Xi.add(Zc.fromArray(g.aColor,v*9+3)),Xi.add(Zc.fromArray(g.aColor,v*9+6)),Xi.divideScalar(3),t.options.paintColor=[Xi.x,Xi.y,Xi.z]}return}if(t=t.readonlyRef(),!t.sculptMoved||n.index!==t.sculptActiveView||!s.mouseLeft)return;const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*l,u=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly),d=new Float32Array(u.position);for(let f=0,p=u.indices.length;f<p;++f){const g=u.indices[f];for(let m=0;m<3;++m)d[f*3+m]=a.aColor[g*3+m]}Zc.set(t.options.paintColor[0],t.options.paintColor[1],t.options.paintColor[2]);for(let f of u.track)this.stroke(f.indices,c,f.center,t.sculptLocalRadius,u.offset,u.position,d),t.sculptSym&&this.stroke(f.indicesSym,c,f.centerSym,t.sculptLocalRadius,u.offset,u.position,d);t.history.updateVertices(r,bs,u.indices,d)}stroke(t,n,s,r,o,a,l){for(let c of t)this.strokeVertex(s,r,n,a,l,o.get(c))}strokeVertex(t,n,s,r,o,a){qw.fromArray(r,a);const l=qw.distanceTo(t)/n;if(l>=1)return;const u=Math.pow(1-l,2*(1-this.brushHardness))*s;Xi.fromArray(o,a).lerp(Zc,u),o[a]=Xi.x,o[a+1]=Xi.y,o[a+2]=Xi.z}}h(Xv,"SculptPaintTool");EV(Xv,"SculptPaintTool");var PV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAIJJREFUSIntVUEOwCAIk2X//zI7kbiFxpbhzZ4US2tEcYyDBUxNcHd/CZjJGrR4xAItwplgjGWT1c4yYdqEISLOHL8RISvenFguLrOrmLNcepG9LZDDFqhsolyz0hFVHgt6E20GyGiLSYarQ6TUIraJK4m/jxMVTmnPVD/5irV+MgcPCvzbPZirI9cAAAAASUVORK5CYII=",RV=Object.defineProperty,IV=h((i,e)=>RV(i,"name",{value:e,configurable:!0}),"__name$w");const dg=new A,Qd=new A;class Yv extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Pinch");C(this,"icon",PV);C(this,"sculpt",!0);C(this,"hasDirection",!0);C(this,"optionsProps",["brushRadius","brushStrength","brushDirection","frontFacesOnly"])}update(t,n){if(t=t.readonlyRef(),!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView)return;const s=n.input;if(!s.mouseLeft)return;if(s.isKeyPressed("Shift"))return t.sculptSmoothTool.doStroke(t,n);const r=t.model.getNode(t.sculptNodeId),a=r.get(Ce).mesh,l=t.options.enablePressure?1:s.pressure,c=this.brushStrength*this.brushDirection*l*.1,u=this.sculptPickStrokeVertices(t,r,n,a,this.frontFacesOnly);for(let d of u.track)this.stroke(d.indices,c,d.center,t.sculptLocalRadius,u.offset,u.position),t.sculptSym&&this.stroke(d.indicesSym,c,d.centerSym,t.sculptLocalRadius,u.offset,u.position);t.history.updateVertices(r,an,u.indices,u.position)}stroke(t,n,s,r,o,a){for(let l of t)this.strokeVertex(s,r,n,a,o.get(l))}strokeVertex(t,n,s,r,o){dg.fromArray(r,o);const a=dg.distanceTo(t)/n;if(a>=1)return;Qd.subVectors(t,dg);const l=this.sculptFalloff(a)*s;r[o]+=Qd.x*l,r[o+1]+=Qd.y*l,r[o+2]+=Qd.z*l}}h(Yv,"SculptPinchTool");IV(Yv,"SculptPinchTool");var DV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHxJREFUSIntVMsOgDAIG8b//2W8zGRBgcrD03pcoAVWGGNDgJn5V5GjW+xEgmTbRESogBl4E0tC+R4q4MtnrbE80Ubu5mfJwwLWGNLkGvGao83+4Q7PAVoR5c5BUbbJcHGRLqyc9lv0iugulIukTaF5G7o3E9DZzZzrDRcXkCuzdkeSNcIAAAAASUVORK5CYII=",LV=Object.defineProperty,kV=h((i,e)=>LV(i,"name",{value:e,configurable:!0}),"__name$v");const ol=new A,Qc=new A,fg=new Set;class Kv extends ln{constructor(){super(...arguments);C(this,"label","Sculpt Smooth (Shift)");C(this,"icon",DV);C(this,"sculpt",!0);C(this,"brushStrength",1);C(this,"optionsProps",["brushRadius","brushStrength","frontFacesOnly"])}update(t,n){t=t.readonlyRef(),!(!t.sculptMoved||!t.sculptNodeId||n.index!==t.sculptActiveView||!n.input.mouseLeft)&&this.doStroke(t,n)}doStroke(t,n){const s=t.model.getNode(t.sculptNodeId),o=s.get(Ce).mesh,a=this.sculptPickStrokeVertices(t,s,n,o,this.frontFacesOnly),l=t.options.enablePressure?1:n.input.pressure;for(let c of a.track)this.stroke(o,c.indices,this.brushStrength*l,c.center,t.sculptLocalRadius,a.offset,a.position),t.sculptSym&&this.stroke(o,c.indicesSym,this.brushStrength*l,c.centerSym,t.sculptLocalRadius,a.offset,a.position);t.history.updateVertices(s,an,a.indices,a.position)}stroke(t,n,s,r,o,a,l){for(let c of n)this.strokeVertex(t,c,r,o,s,l,a.get(c))}strokeVertex(t,n,s,r,o,a,l){ol.fromArray(a,l);const c=ol.distanceTo(s)/r;if(c>=1)return;let u=t.getVertexTriangleIndex(t.edgeNeighborMap[n]);const d=u;let f=0,p=0,g=0,m=0,v=50;fg.clear();do{fg.add(u);for(let _=0;_<3;++_){const x=t.sharedVertexMap[u*3+_];if(x!==n){t.getVertex(Qc,x);const w=Qc.distanceTo(ol);f+=Qc.x*w,p+=Qc.y*w,g+=Qc.z*w,m+=w}}const b=u;for(let _=0;_<3;++_){const x=u*3+_;if(t.holes[x])continue;const w=t.getVertexTriangleIndex(t.edgeNeighborMap[x]);if(u===w||fg.has(w))continue;let T=!1;for(let P=0;P<3;++P)if(t.sharedVertexMap[w*3+P]===n){T=!0;break}if(T){u=w;break}}if(b===u)break;if(v--<=0){console.warn("Loop limit reached");break}}while(d!==u);if(m=1/m,!isFinite(m))return;f*=m,p*=m,g*=m;const y=this.sculptFalloff(c)*o;a[l]+=(f-ol.x)*y,a[l+1]+=(p-ol.y)*y,a[l+2]+=(g-ol.z)*y}}h(Kv,"SculptSmoothTool");kV(Kv,"SculptSmoothTool");var OV=Object.defineProperty,NV=h((i,e)=>OV(i,"name",{value:e,configurable:!0}),"__name$u");const ry=class extends ln{constructor(){super(...arguments);C(this,"icon","");C(this,"label","");C(this,"sep",!0)}};let Os=ry;h(Os,"ToolSeperator"),C(Os,"instance",new ry);NV(Os,"ToolSeperator");var FV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAHZJREFUSIljYBgF1AT/oYAUPYykGI6ikZGRaL1EG47sA1J9QrRFpBrMRHVXDAoLyAlfovXgU0goDrDJMRJSQA5ATsI0jwMMQO0gIkkhPguoErw0zWhKCiaku4gUC8i1jCgL0IPl3oMzRIf54CiukS2hSTE9sgEAj0t/GHidkfcAAAAASUVORK5CYII=",zV=Object.defineProperty,BV=h((i,e)=>zV(i,"name",{value:e,configurable:!0}),"__name$t");const Jc=new ve;class qv extends ln{constructor(){super(...arguments);C(this,"label","Translate");C(this,"icon",FV);C(this,"nodes",[]);C(this,"detMat",[]);C(this,"dragging",!1)}begin(t){if(this.nodes=t.model.getTopmostSelectedNodes().filter(n=>n.has(Ue)),!this.nodes.length){this.enableTransformControls=!1;return}if(this.enableTransformControls=!0,!this.dragging&&(this.nodes[0].getWorldMatrix().decompose(t.dummyObject.position,t.dummyObject.quaternion,t.dummyObject.scale),this.detMat.length=this.nodes.length-1,this.detMat.length)){Jc.copy(this.nodes[0].getWorldMatrix()).invert();for(let n=0;n<this.detMat.length;++n)this.detMat[n]||(this.detMat[n]=new ve),this.detMat[n].multiplyMatrices(Jc,this.nodes[n+1].getWorldMatrix())}this.dragging=!1}update(t,n){if(!this.enableTransformControls)return;const s=n.transformControls;if(s.camera=n.camera.get(),s.setMode("translate"),s.setSpace(t.options.useLocalSpaceForTransformControl?"local":"world"),s.setTranslationSnap(n.input.isKeyPressed("Shift")?.25:null),s.dragging){this.dragging=!0;const r=t.dummyObject.matrix;for(let o=0;o<this.nodes.length;++o){const a=this.nodes[o];Jc.copy(a.getParentWorldMatrix()).invert().multiply(r),o>0&&Jc.multiply(this.detMat[o-1]),t.history.setValue(a,Ue,Ea(new A,Jc))}}}onUnselected(t){this.nodes.length=0,this.dragging=!1}}h(qv,"TranslateTool");BV(qv,"TranslateTool");var UV="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAGRJREFUSIntlMESABAIROX//znXGKJajBl7JG8LldLXbZG2ycxcBROp8Sa18NEaDA4zWQFYTHIoG49Ws3NfleXgdpPQgx8zQf8qFwDSgLNq3uhyCdo6q0bAnkF4/EoodJx/wVQASvh7kexwAhUAAAAASUVORK5CYII=",VV=Object.defineProperty,HV=h((i,e)=>VV(i,"name",{value:e,configurable:!0}),"__name$s");const Yi=new A,Qw=new A,ar=new A,Jw=new Be,ex=new A(1,0,0),al=new ve,tx=.003,nx=.003,ix=5,pg=.05;class Zv extends ln{constructor(){super(...arguments);C(this,"label","Tube");C(this,"icon",UV);C(this,"tips","Hold [Alt] to create/insert a tube node. Resize tube node with mouse wheel.");C(this,"enableDefaultDeleteShortcut",!1);C(this,"enableSelectionRect",!0);C(this,"enableDefaultSelectionBehavior",!1);C(this,"nodes",[]);C(this,"enableDeleteThisFrame",!0);C(this,"dragging",!1);C(this,"draggingActiveViewIndex",-1);C(this,"mouse0",new A);C(this,"circle",new vn(new Dp,new $n({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0,color:16711935})));C(this,"line1",new vn(new et().setFromPoints([new A(0,0,0),new A(1,0,0)]),this.circle.material.clone()));C(this,"line2",new vn(this.line1.geometry.clone(),this.line1.material.clone()));C(this,"creating",!1);C(this,"radius",.1);C(this,"lastNodeId",0)}setup(t){this.circle.visible=!1,t.scene.add(this.circle),this.line1.visible=!1,t.scene.add(this.line1),this.line2.visible=!1,t.scene.add(this.line2)}begin(t){t=t.readonlyRef();for(let n of this.nodes){if(n.deleted)continue;const s=n.get(ot);s.group&&(s.group.visible=!1),t.model.selected.includes(n.id)?s.selected=s.selected.filter(r=>r<s.value.length):s.selected.length=0}this.enableDefaultDeleteShortcut=!0,this.enableDeleteThisFrame=!0,this.nodes=t.model.getSelectedNodes().filter(n=>n.has(ot)&&!n.instanceId);for(let n of this.nodes){const s=n.get(ot);s.group&&(s.group.visible=!0),s.hovered=-1,s.selected.length&&(this.enableDefaultDeleteShortcut=!1),n.id===this.lastNodeId&&s.value.length&&(s.selected=[0],this.lastNodeId=0)}this.enableSelectionRect=!0,this.creating||(this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1,this.lastNodeId=0)}update(t,n){const s=n.input;if(s.isKeyPressed("Delete")&&this.enableDeleteThisFrame){this.enableDeleteThisFrame=!1;for(let r of this.nodes){const o=r.get(ot);if(o.selected.length){const a=o.clone().filter((l,c)=>!o.selected.includes(c));o.selected.length=0,a.length===0?t.history.removeNode(r.id):t.history.setValue(r,ot,a)}}return}if(this.dragging&&n.index===this.draggingActiveViewIndex)if(this.enableSelectionRect=!1,s.mouseLeft){if(on(Qw,n.mouseRay0,n.mouseRay1,this.mouse0,n.mouseRayN)){ar.subVectors(Qw,this.mouse0);let r=!0;for(let o of this.nodes){const a=o.get(ot);if(a.draggingStartNodeIndex>=0){r=a.selected.includes(a.draggingStartNodeIndex);break}}for(let o of this.nodes){const a=o.get(ot);if(a.selected.length||a.draggingStartNodeIndex>=0){const l=a.clone(a.draggingStartValue);if(r)for(let c of a.selected)l[c].position.applyMatrix4(a.draggingStartMatrix).add(ar).applyMatrix4(a.draggingStartInvMatrix),s.isKeyPressed("Shift")&&bu(l[c].position,pg);a.draggingStartNodeIndex>=0&&!r&&(l[a.draggingStartNodeIndex].position.applyMatrix4(a.draggingStartMatrix).add(ar).applyMatrix4(a.draggingStartInvMatrix),s.isKeyPressed("Shift")&&bu(l[a.draggingStartNodeIndex].position,pg)),t.history.setValue(o,ot,l)}}if(!r)for(let o of this.nodes){const a=o.get(ot);a.draggingStartNodeIndex>=0?a.selected=[a.draggingStartNodeIndex]:a.selected=[]}}}else{this.dragging=!1,this.draggingActiveViewIndex=-1;for(let r of this.nodes){const o=r.get(ot);o.draggingStartNodeIndex=-1}}if(s.pointerOver&&!(this.dragging||this.creating)){let r=!1;for(let o of this.nodes){const a=o.get(ot),l=n.raycaster.intersectObjects(a.pickers);if(l.length){const c=l[0].object.userData.index;if(a.hovered=c==null?-1:c,s.mouseLeftDownThisFrame)this.dragging=!0,this.draggingActiveViewIndex=n.index,this.mouse0.copy(l[0].point),a.draggingStartNodeIndex=a.hovered;else if(s.wheelDetY)for(let u of l){const d=u.object.userData.index;if(d!=null&&a.selected.includes(d)){r=!0;break}}}else a.hovered=-1}if(this.dragging&&n.index===this.draggingActiveViewIndex)for(let o of this.nodes){const a=o.get(ot);(a.selected.length||a.draggingStartNodeIndex>=0)&&(a.draggingStartMatrix=new ve().copy(o.getWorldMatrix()),a.draggingStartInvMatrix=new ve().copy(o.getWorldMatrix()).invert(),a.draggingStartValue=a.clone())}if(r){t.disableCameraDraggingThisFrame=!0;for(let o of this.nodes){const a=o.get(ot);if(a.selected.length){const l=a.clone();for(let c of a.selected)l[c].radius=Math.max(tx,Math.min(ix,l[c].radius-s.wheelDetY*nx));t.history.setValue(o,ot,l)}}}if(!this.dragging&&!this.creating&&s.isKeyPressed("Alt")){this.creating=!0;for(let o of this.nodes){const a=o.get(ot);if(a.selected.length){this.radius=a.value[a.selected[0]].radius,this.radius*=ca(o.getWorldMatrix());break}}}}if(this.creating)if(s.isKeyPressed("Alt")){if(this.enableSelectionRect=!1,s.pointerOver){let r=null,o=null,a=-1;for(let l of this.nodes){const c=l.get(ot);if(c.selected.length){r=l,o=c,a=c.selected[0];break}}if(r)Yi.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix());else for(let l of t.readonlyRef().model.getSelectedNodes())if(l.isValidChild("Tube")){Yi.setFromMatrixPosition(l.getWorldMatrix());break}if(on(this.circle.position,n.mouseRay0,n.mouseRay1,Yi,n.mouseRayN),s.isKeyPressed("Shift")&&bu(this.circle.position,pg),s.wheelDetY&&(this.radius=Math.min(ix,Math.max(tx,-s.wheelDetY*nx+this.radius)),t.disableCameraDraggingThisFrame=!0),this.circle.scale.setScalar(this.radius),this.circle.visible=!0,this.line1.visible=!1,this.line2.visible=!1,r&&(this.line1.position.copy(o.value[a].position).applyMatrix4(r.getWorldMatrix()),ar.subVectors(this.circle.position,this.line1.position),this.line1.scale.setScalar(ar.length()),this.line1.quaternion.setFromUnitVectors(ex,ar.normalize()),this.line1.visible=!0,a<o.value.length-1&&(this.line2.position.copy(o.value[a+1].position).applyMatrix4(r.getWorldMatrix()),ar.subVectors(this.circle.position,this.line2.position),this.line2.scale.setScalar(ar.length()),this.line2.quaternion.setFromUnitVectors(ex,ar.normalize()),this.line2.visible=!0,o.lines[a].visible=!1,t.nextFrameEnd(()=>{const l=o==null?void 0:o.lines[a];l&&(l.visible=!0)}))),s.mouseLeftDownThisFrame){Yi.copy(this.circle.position);let l=this.radius;if(!r&&this.nodes.length&&this.nodes[0].value(ot).length===0&&(r=this.nodes[0]),r){al.copy(r.getWorldMatrix()).invert(),Yi.applyMatrix4(al),l*=ca(al);let c;o?(c=o.clone(),c.splice(a+1,0,{position:new A().copy(Yi),radius:l}),o.selected=[a+1]):(c=[{position:new A().copy(Yi),radius:l}],this.lastNodeId=r.id),t.history.setValue(r,ot,c)}else{let c=null;if(this.nodes.length)c=this.nodes[0].parent;else for(let d of t.model.getSelectedNodes())if(d.isValidChild("Tube")){c=d;break}if(c&&(al.copy(c.getWorldMatrix()).invert(),Yi.applyMatrix4(al),l*=ca(al)),t.model.selected=[],!c){for(let d of t.model.getSelectedNodes())if(d.isValidChild("Shape")){c=d;break}this.lastNodeId=t.history.createNode({type:"Shape",parentId:c?c.id:0,data:{[Ue.name]:new A().copy(Yi)},children:[{type:"Tube",data:{[ot.name]:[{radius:l,position:new A}]}}]})+1}else this.lastNodeId=t.history.createNode({type:"Tube",parentId:c?c.id:0,data:{[ot.name]:[{radius:l,position:new A().copy(Yi)}]}})}this.creating=!1}}}else this.creating=!1;if(t.selectionRectSetThisFrame&&t.selectionRectViewIndex===n.index)if(t.selectionStart.equals(t.selectionEnd)){let r=!1;for(let o of this.nodes){const a=o.get(ot);a.selected.length&&(r=!0),a.selected.includes(a.hovered)?s.isKeyPressed("Control")&&(a.selected=a.selected.filter(l=>l!==a.hovered),r=!0):(s.isKeyPressed("Control")||(a.selected.length=0),a.hovered>=0&&(a.addSelection(a.hovered),r=!0))}if(!r){const o=n.mousePick("Shape");let a=null;for(let l of o){const c=o[0].object.userData.node;if(c){a=c;break}}a?t.model.selected=a.children.map(l=>l.id):t.model.selected=[]}}else{const r=n.camera.get();for(let o of this.nodes){const a=o.get(ot);s.isKeyPressed("Control")||(a.selected.length=0);for(let l of a.pickers)if(Yi.setFromMatrixPosition(l.matrixWorld).project(r),XA(Yi,t.selectionStart,t.selectionEnd)){const c=l.userData.index;c!=null&&a.addSelection(c)}}}}end(t){for(let n of this.nodes)n.get(ot).updateColor()}beforeRender(t,n){for(let s of this.nodes){const r=s.get(ot);Nf(Jw,s.getWorldMatrix()).invert();for(let o of r.circles)o.quaternion.copy(Jw).multiply(n.camera.get().quaternion)}this.circle.visible&&this.circle.quaternion.copy(n.camera.get().quaternion)}onUnselected(t){this.dragging=!1,this.creating=!1,this.lastNodeId=0,this.circle.visible=!1,this.line1.visible=!1,this.line2.visible=!1;for(let n of this.nodes){if(n.deleted)continue;const s=n.get(ot);s.group&&(s.group.visible=!1),s.selected.length=0}this.nodes.length=0}}h(Zv,"TubeTool");HV(Zv,"TubeTool");var GV=Object.defineProperty,WV=h((i,e)=>GV(i,"name",{value:e,configurable:!0}),"__name$r");class wh{constructor(e,t,n,s,r){C(this,"systems",[new yv([new av,new cv,new W1,new ov,new k1,new V1,new vv,new B1,new hv,new U1,new H1,new dv,new gv,new mv,new lv,new uv,new pv]),new _v,new Mv,new I1,new D1,new L1,new bv,new wv,new R1,new P1]);C(this,"sculptSmoothTool",new Kv);C(this,"tools",[new bh,Os.instance,new qv,new Uv,new Bv,Os.instance,new zv,new Fv,Os.instance,new Tv,new Ev,Os.instance,new _h,new Zv,Os.instance,new Vv,new jv,new Hv,new Yv,new Wv,new $v,new Gv,this.sculptSmoothTool,new Xv]);C(this,"sculptNodeId",0);C(this,"sculptActiveView",-1);C(this,"sculptSym",!1);C(this,"sculptLocalRadius",0);C(this,"sculptMoved",!1);C(this,"sculptStartThisFrame",!1);C(this,"sculptAccWalkedPixels",0);C(this,"sculptX0",0);C(this,"sculptY0",0);C(this,"sculptX1",0);C(this,"sculptY1",0);C(this,"canvas");C(this,"renderer");C(this,"composer");C(this,"renderPass");C(this,"outlinePass");C(this,"scene",new Nu);C(this,"views");C(this,"mainViewIndex");C(this,"dummyObject",new vt);C(this,"disableCameraDraggingThisFrame",!1);C(this,"selectionRectDragging",!1);C(this,"selectionRectViewIndex",-1);C(this,"selectionRectSetThisFrame",!1);C(this,"selectionStart",new je);C(this,"selectionEnd",new je);C(this,"model",new hh);C(this,"history",new E1(this.model));C(this,"fps",0);C(this,"detSec",0);C(this,"lastTimestamp",0);C(this,"statusBarMessage","");C(this,"tool",this.tools[0]);C(this,"nextFrameCallbacks",[]);C(this,"throttleTasks",new Map);C(this,"options",new r1);this.history.setup(),this.canvas=e,this.renderer=new aA({canvas:e}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=kM,this.mainViewIndex=1,this.views=[new vl(this,0,t,-Math.PI/2,-Math.PI/2,!1),new vl(this,1,n,-Math.PI/8,-Math.PI/4,!0),new vl(this,2,s,0,-Math.PI/2,!1),new vl(this,3,r,0,0,!1)],this.composer=new FA(this.renderer),this.renderPass=new BA(this.scene,this.views[this.mainViewIndex].camera.get()),this.composer.addPass(this.renderPass),this.outlinePass=new Ns(new je,this.scene,this.renderPass.camera),this.outlinePass.visibleEdgeColor.setHex(15964205);{const o=[!1,!1,!1,!1];this.outlinePass.changeVisibilityOfNonSelectedObjects=a=>{if(a)for(let l of this.views)l.transformControls.visible=o[l.index];else for(let l of this.views)o[l.index]=l.transformControls.visible,l.transformControls.visible=!1;Ns.prototype.changeVisibilityOfNonSelectedObjects.call(this.outlinePass,a)}}this.composer.addPass(this.outlinePass),this.scene.add(this.dummyObject);for(let o of this.systems)o.setup(this);for(let o of this.tools)o.setup(this)}dispose(){this.history.unload();for(let e of this.views)e.dispose();for(let e of this.systems)e.dispose();for(let e of this.tools)e.dispose();this.renderer.dispose()}update(){const e=Date.now();this.detSec=(e-this.lastTimestamp)/1e3,this.fps=Math.floor(1/this.detSec),this.lastTimestamp=e;for(let t=0;t<this.views.length;++t){const n=this.views[t];if(n.enabled=t===this.mainViewIndex||this.options.quadView,t===this.mainViewIndex){const s=n.camera;s.perspective=this.model.cameraPerspective&&(Math.abs(s.alpha%(Math.PI/2))>1e-8||Math.abs(s.beta%(Math.PI/2))>1e-8),s.perspectiveCamera.fov=this.model.cameraFov}}for(let t of this.views)t=qe(t),t.enabled&&t.update();for(let t of this.systems)t.update(this);for(let t of this.views)t=qe(t),t.input.update()}reset(){this.views[this.mainViewIndex].camera.alpha=-Math.PI/8,this.views[this.mainViewIndex].camera.beta=-Math.PI/4;for(let e of this.views)e.camera.target.set(0,0,0),e.zoomLevel=0;this.model.reset(),this.history.clear()}readonlyRef(){return qe(this)}nextFrameEnd(e){this.nextFrameCallbacks.push(e)}throttle(e,t,n,s=!1){const r=this.throttleTasks.get(e);r?(s||(r.time=Date.now()+t),r.callback=n):s?(n(),this.throttleTasks.set(e,{time:Date.now()+t,callback:()=>{}})):this.throttleTasks.set(e,{time:Date.now()+t,callback:n})}load(e){this.reset();for(let t=0;t<4;++t){const n=e.views[t],s=this.views[t];s.zoomLevel=n.zoomLevel,s.camera.alpha=n.alpha,s.camera.beta=n.beta,s.camera.target.set(...n.target),t===this.mainViewIndex&&(s.camera.perspective=n.perspective,s.camera.perspectiveCamera.fov=n.fov,this.model.cameraPerspective=n.perspective,this.model.cameraFov=n.fov)}this.model.cameras=e.cameras;for(let t of e.nodes){const n=this.model.createNode(t.id,t.type,t.parentId?this.model.getNode(t.parentId):null,null,t.data,t.instanceId);n.expanded=t.expanded}}}h(wh,"EditorContext");WV(wh,"EditorContext");var jV=Object.defineProperty,$V=h((i,e)=>jV(i,"name",{value:e,configurable:!0}),"__name$q"),XV=Rt({props:{editorContext:{type:wh,required:!0}},emits:["setData"],setup(i,e){const t=Je(function(){return i.editorContext.model.selected.join(",")}),n=Je(function(){const r=i.editorContext.model.getSelectedNodes();if(!r.length)return[];const o=[],a=new Set;let l=r[0];l.instanceId&&(l=i.editorContext.model.getNode(l.instanceId));const c=jn(l.type);for(let u of c.components)vi(u.name).inputComponent&&a.add(u.name);for(let u=1,d=r.length;u<d;++u){let f=r[u];f.instanceId&&(f=i.editorContext.model.getNode(f.instanceId));const p=jn(f.type),g=new Set;for(let m of p.components)vi(m.name).inputComponent&&g.add(m.name);for(let m of a)g.has(m)||a.delete(m)}for(let u of a){const d=vi(u);o.push({name:u,componentClass:d.constructor,label:d.label||u,inlineLabel:d.inlineLabel||!1,inputComponent:d.inputComponent,inputComponentProps:d.inputComponentProps,value:l.value(d.constructor)})}return o});function s(r,o){e.emit("setData",i.editorContext.model.getSelectedNodes().map(a=>({node:a,type:r,value:o})))}return h(s,"onInput"),$V(s,"onInput"),{key:t,properties:n,onInput:s}}});function YV(i,e,t,n,s,r){return Se(),ke("div",{class:"properties",key:i.key},[(Se(!0),ke(At,null,ro(i.properties,o=>(Se(),ke("div",{class:en(["property",{inline:o.inlineLabel}])},[he("label",null,rn(o.label),1),(Se(),Bt(x3(o.inputComponent),gM({class:"value",value:o.value,onInput:a=>i.onInput(o.componentClass,a)},o.inputComponentProps),null,16,["value","onInput"]))],2))),256))])}h(YV,"_sfc_render$b");var KV=Dt(XV,[["render",YV]]),qV=Object.defineProperty,ZV=h((i,e)=>qV(i,"name",{value:e,configurable:!0}),"__name$p");class Qv{constructor(){C(this,"parent");C(this,"subMenu")}}h(Qv,"PopupMenuItemContext");ZV(Qv,"PopupMenuItemContext");var QV=Object.defineProperty,sx=h((i,e)=>QV(i,"name",{value:e,configurable:!0}),"__name$o"),JV=Rt({props:{title:String,icon:String,hotkey:String,disabled:Boolean,sep:Boolean,popup:Boolean,checked:Boolean},setup(i,e){const t=ze(),n=Je(function(){return!!e.slots.default}),s=new Qv;Sl("popupMenuItemContext",s),s.parent=ei("popupMenuContext",null)||void 0;function r(){var a;(a=s.parent)==null||a.handleMenuItemMouseOver(s,t.value)}h(r,"onMouseOver"),sx(r,"onMouseOver");function o(a){var l;i.disabled||i.sep||n.value||(l=s.parent)==null||l.hideAll()}return h(o,"onClick"),sx(o,"onClick"),{menuItem:t,hasChild:n,onMouseOver:r,onClick:o}}});const eH=["src"],tH={class:"title"},nH={key:0,class:"hotkey"};function iH(i,e,t,n,s,r){return Se(),ke("div",{class:en(["popup-menu-item",{"has-child":i.hasChild,disabled:i.disabled,sep:i.sep,popup:i.popup}]),ref:"menuItem",onMouseover:e[0]||(e[0]=mn((...o)=>i.onMouseOver&&i.onMouseOver(...o),["stop"])),onClick:e[1]||(e[1]=(...o)=>i.onClick&&i.onClick(...o))},[i.sep?Qe("",!0):(Se(),ke(At,{key:0},[he("div",{class:en(["icon",{checked:i.checked,img:!!i.icon}])},[i.icon&&!i.checked?(Se(),ke("img",{key:0,src:i.icon,alt:""},null,8,eH)):Qe("",!0)],2),he("div",tH,rn(i.title),1),i.hotkey?(Se(),ke("div",nH,rn(i.hotkey),1)):Qe("",!0),Pu(i.$slots,"default",{},void 0,!0)],64))],34)}h(iH,"_sfc_render$a");var PC=Dt(JV,[["render",iH],["__scopeId","data-v-4eb751b0"]]),sH=Object.defineProperty,hs=h((i,e)=>sH(i,"name",{value:e,configurable:!0}),"__name$n"),rH=Rt({name:"model-tree-node",props:{model:{type:hh,required:!0},node:{type:ua,required:!0},depth:{type:Number,required:!0},draggingNode:ua,dragOverNode:ua,dropPosition:String},emits:["setValue","setSelection","dragStart","dragOver","contextmenu","rangeSelect"],setup(i,e){const t=ze(),n=Je(function(){const _=i.node;return(_.has(Kt)?_.value(Kt):"")||`${_.type}#${_.id}`}),s=Je(function(){return jn(i.node.type).icon}),r=Je(function(){return i.node.has(zt)}),o=Je(function(){return r.value&&i.node.value(zt)});function a(_,x,w){e.emit("setValue",_,x,w)}h(a,"onSetValue"),hs(a,"onSetValue");function l(){a(i.node,zt,!o.value)}h(l,"toggleVisible"),hs(l,"toggleVisible");function c(){i.node.expanded=!i.node.expanded}h(c,"toggleExpanded"),hs(c,"toggleExpanded");function u(_){e.emit("setSelection",_)}h(u,"onSetSelection"),hs(u,"onSetSelection");function d(_){const x=i.node.id;if(_.ctrlKey){const w=i.model.selected;w.includes(x)?e.emit("setSelection",w.filter(T=>T!==x)):e.emit("setSelection",[...w,x])}else _.shiftKey?b(x):e.emit("setSelection",[x])}h(d,"onNodeClick"),hs(d,"onNodeClick");function f(_){if(!_.shiftKey){if(!i.model.selected.includes(i.node.id)){if(_.ctrlKey)return;e.emit("setSelection",[i.node.id])}g(i.node)}}h(f,"onMouseDown"),hs(f,"onMouseDown");function p(_){if(i.draggingNode&&t.value){const x=t.value.getBoundingClientRect(),w=_.clientY-x.top,T=6;let P=w<=T?"before":w>=x.height-T?"after":"atLast";P==="after"&&i.node.children.length&&i.node.expanded&&(P="atFirst"),e.emit("dragOver",i.node,P)}}h(p,"onMouseMove"),hs(p,"onMouseMove");function g(_){e.emit("dragStart",_)}h(g,"onDragStart"),hs(g,"onDragStart");function m(_,x){e.emit("dragOver",_,x)}h(m,"onDragOver"),hs(m,"onDragOver");const v=Je(function(){const _=i.node,x=i.draggingNode===_,w=i.dragOverNode===_,T=i.dropPosition;return{selected:i.model.selected.includes(_.id),dragging:x,"drag-over-before":w&&T==="before","drag-over-inside":w&&(T==="atFirst"||T==="atLast"),"drag-over-after":w&&T==="after",instance:!!_.instanceId}});function y(_,x){e.emit("contextmenu",_,x)}h(y,"onContextMenu"),hs(y,"onContextMenu");function b(_){e.emit("rangeSelect",_)}return h(b,"onRangeSelect"),hs(b,"onRangeSelect"),{dom:t,name:n,icon:s,hasVisible:r,visible:o,onSetValue:a,toggleVisible:l,toggleExpanded:c,onSetSelection:u,onNodeClick:d,onMouseDown:f,onMouseMove:p,onDragStart:g,onDragOver:m,classnames:v,onContextMenu:y,onRangeSelect:b}}});const oH={class:"visibility"},aH={class:"expand"},lH=["src"],cH={class:"node-name"};function uH(i,e,t,n,s,r){const o=qt("model-tree-node",!0);return Se(),ke(At,null,[he("div",{class:en(["model-tree-node",i.classnames]),onMousedown:e[3]||(e[3]=mn((...a)=>i.onMouseDown&&i.onMouseDown(...a),["left"])),onMousemove:e[4]||(e[4]=(...a)=>i.onMouseMove&&i.onMouseMove(...a)),onContextmenu:e[5]||(e[5]=mn(a=>i.onContextMenu(i.node,a),["prevent"])),ref:"dom"},[he("div",oH,[i.hasVisible?(Se(),ke("div",{key:0,class:en(["icon",[i.visible?"visible":"invisible"]]),onClick:e[0]||(e[0]=mn((...a)=>i.toggleVisible&&i.toggleVisible(...a),["stop"]))},null,2)):Qe("",!0)]),he("div",{class:"name",style:En({"padding-left":`${i.depth*16+2}px`}),onClick:e[2]||(e[2]=(...a)=>i.onNodeClick&&i.onNodeClick(...a))},[he("div",aH,[i.node.children.length?(Se(),ke("div",{key:0,class:en(["icon",[i.node.expanded?"collapse":"expand"]]),onClick:e[1]||(e[1]=mn((...a)=>i.toggleExpanded&&i.toggleExpanded(...a),["stop"]))},null,2)):Qe("",!0)]),he("img",{class:"node-icon",src:i.icon,alt:""},null,8,lH),he("span",cH,rn(i.name),1)],4)],34),i.node.expanded?(Se(!0),ke(At,{key:0},ro(i.node.children,a=>(Se(),Bt(o,{key:a.id,model:i.model,node:a,depth:i.depth+1,onSetValue:i.onSetValue,onSetSelection:i.onSetSelection,onRangeSelect:i.onRangeSelect,"dragging-node":i.draggingNode,"drag-over-node":i.dragOverNode,"drop-position":i.dropPosition,onDragStart:i.onDragStart,onDragOver:i.onDragOver,onContextmenu:i.onContextMenu},null,8,["model","node","depth","onSetValue","onSetSelection","onRangeSelect","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu"]))),128)):Qe("",!0)],64)}h(uH,"_sfc_render$9");var hH=Dt(rH,[["render",uH],["__scopeId","data-v-6a76ea03"]]),dH=Object.defineProperty,kn=h((i,e)=>dH(i,"name",{value:e,configurable:!0}),"__name$m"),fH=Rt({components:{PopupMenu:g1,PopupMenuItem:PC,ModelTreeNode:hH},props:{model:{type:hh,required:!0}},emits:["setValue","moveNode","select","focus","cut","copy","paste","delete","convertToClay","applyTransformation","createInstance","flip","copyPose","pastePose"],setup(i,e){const t=ze();function n(B,ne,K){e.emit("setValue",B,ne,K)}h(n,"onSetValue"),kn(n,"onSetValue");let s=!1;const r=ze(),o=ze(),a=ze("");function l(B){r.value=B,o.value=void 0;const ne=kn(function(){r.value!==o.value&&r.value&&o.value&&e.emit("moveNode",o.value,a.value),r.value=void 0,o.value=void 0,document.removeEventListener("mouseup",ne)},"onMouseUp");document.addEventListener("mouseup",ne)}h(l,"onDragStart"),kn(l,"onDragStart");function c(B,ne){B!==o.value&&(s=!0),o.value=B,a.value=ne}h(c,"onDragOver"),kn(c,"onDragOver");function u(B){if(s){s=!1;return}e.emit("select",B)}h(u,"onSetSelection"),kn(u,"onSetSelection");function d(B){const ne=qe(i.model),K=new Set(ne.selected);if(!K.size){u([B]);return}const ie=[];let G=!1,se=!1;ne.forEach(q=>{if(G&&se)return!1;!se&&K.has(q.id)&&(se=!0),q.id===B&&(G=!0),(se||G)&&ie.push(q.id)}),u(ie)}h(d,"onRangeSelect"),kn(d,"onRangeSelect");const f=ze();function p(B,ne){f.value=B,t.value.show(ne.target,{x:ne.clientX,y:ne.clientY})}h(p,"onContextMenu"),kn(p,"onContextMenu");function g(){e.emit("focus",f.value)}h(g,"onFocus"),kn(g,"onFocus");function m(){e.emit("cut")}h(m,"onCut"),kn(m,"onCut");function v(){e.emit("copy")}h(v,"onCopy"),kn(v,"onCopy");function y(){e.emit("paste",f.value)}h(y,"onPaste"),kn(y,"onPaste");function b(){e.emit("delete")}h(b,"onDelete"),kn(b,"onDelete");const _=Je(function(){const B=f.value;return B?["Shape","Box","ObjModel","FbxModel"].includes(B.type):!1});function x(){e.emit("convertToClay",f.value)}h(x,"onConvertToClay"),kn(x,"onConvertToClay");const w=Je(function(){const B=f.value;return B?!B.instanceId&&B.type==="Clay":!1});function T(){e.emit("applyTransformation",f.value)}h(T,"onApplyTransformation"),kn(T,"onApplyTransformation");const P=Je(function(){const B=f.value;if(!B)return!1;const ne=jn(B.type);return!!ne.instanceable&&!ne.unique}),M=Je(function(){const B=f.value;return B?!B.has(_n):!1});function R(B){e.emit("createInstance",f.value,B)}h(R,"onCreateInstance"),kn(R,"onCreateInstance");const L=Je(function(){const B=f.value;return B?["Container","IKChain","IKNode"].includes(B.type):!1});function W(B){e.emit("flip",f.value,B)}h(W,"onFlip"),kn(W,"onFlip");const k=Je(function(){const B=f.value;return B?["IKChain"].includes(B.type):!1});function z(){e.emit("copyPose",f.value)}h(z,"onCopyPose"),kn(z,"onCopyPose");function S(){e.emit("pastePose",f.value)}return h(S,"onPastePose"),kn(S,"onPastePose"),{contextMenu:t,onSetValue:n,onSetSelection:u,draggingNode:r,dragOverNode:o,dropPosition:a,onDragStart:l,onDragOver:c,onRangeSelect:d,onContextMenu:p,contextMenuNode:f,onFocus:g,onCut:m,onCopy:v,onPaste:y,onDelete:b,canConvertToClay:_,onConvertToClay:x,canApplyTransformation:w,onApplyTransformation:T,canCreateInstance:P,canCreateMirrorInstance:M,onCreateInstance:R,canFlip:L,onFlip:W,hasPose:k,onCopyPose:z,onPastePose:S}}});function pH(i,e,t,n,s,r){const o=qt("model-tree-node"),a=qt("popup-menu-item"),l=qt("popup-menu");return Se(),ke("div",{class:"model-tree",onClick:e[6]||(e[6]=mn(c=>i.onSetSelection([]),["left","self"])),onContextmenu:e[7]||(e[7]=mn(c=>i.onContextMenu(void 0,c),["self","prevent"]))},[(Se(!0),ke(At,null,ro(i.model.nodes,c=>(Se(),Bt(o,{key:c.id,model:i.model,node:c,depth:0,onSetValue:i.onSetValue,onSetSelection:i.onSetSelection,"dragging-node":i.draggingNode,"drag-over-node":i.dragOverNode,"drop-position":i.dropPosition,onDragStart:i.onDragStart,onDragOver:i.onDragOver,onContextmenu:i.onContextMenu,onRangeSelect:i.onRangeSelect},null,8,["model","node","onSetValue","onSetSelection","dragging-node","drag-over-node","drop-position","onDragStart","onDragOver","onContextmenu","onRangeSelect"]))),128)),Pe(l,{ref:"contextMenu"},{default:Ht(()=>[Pe(a,{title:"Focus",onClick:i.onFocus,disabled:!i.contextMenuNode},null,8,["onClick","disabled"]),i.canFlip?(Se(),ke(At,{key:0},[Pe(a,{title:"Flip",onClick:e[0]||(e[0]=c=>i.onFlip("flip"))}),Pe(a,{title:"Flip Left to Right",onClick:e[1]||(e[1]=c=>i.onFlip("left-to-right"))}),Pe(a,{title:"Flip Right to Left",onClick:e[2]||(e[2]=c=>i.onFlip("right-to-left"))})],64)):Qe("",!0),i.canConvertToClay||i.canApplyTransformation||i.canCreateInstance?(Se(),ke(At,{key:1},[Pe(a,{sep:""}),i.canConvertToClay?(Se(),Bt(a,{key:0,title:"Convert to Clay",onClick:i.onConvertToClay},null,8,["onClick"])):Qe("",!0),i.canApplyTransformation?(Se(),Bt(a,{key:1,title:"Apply Transformation",onClick:i.onApplyTransformation},null,8,["onClick"])):Qe("",!0),i.canCreateInstance?(Se(),ke(At,{key:2},[Pe(a,{title:"Create Shadow Node",onClick:e[3]||(e[3]=c=>i.onCreateInstance("none"))}),i.canCreateMirrorInstance?(Se(),ke(At,{key:0},[Pe(a,{title:"Create Mirror Shadow Node",onClick:e[4]||(e[4]=c=>i.onCreateInstance("z"))}),Pe(a,{title:"Create Vertical Mirror Shadow Node",onClick:e[5]||(e[5]=c=>i.onCreateInstance("y"))})],64)):Qe("",!0)],64)):Qe("",!0)],64)):Qe("",!0),i.hasPose?(Se(),ke(At,{key:2},[Pe(a,{sep:""}),Pe(a,{title:"Copy Pose",onClick:i.onCopyPose},null,8,["onClick"]),Pe(a,{title:"Paste Pose",onClick:i.onPastePose},null,8,["onClick"])],64)):Qe("",!0),Pe(a,{sep:""}),Pe(a,{title:"Cut",hotkey:"Ctrl+X",onClick:i.onCut,disabled:!i.model.selected.length},null,8,["onClick","disabled"]),Pe(a,{title:"Copy",hotkey:"Ctrl+C",onClick:i.onCopy,disabled:!i.model.selected.length},null,8,["onClick","disabled"]),Pe(a,{title:"Paste",hotkey:"Ctrl+V",onClick:i.onPaste},null,8,["onClick"]),Pe(a,{title:"Delete",hotkey:"Delete",onClick:i.onDelete,disabled:!i.model.selected.length},null,8,["onClick","disabled"])]),_:1},512)],32)}h(pH,"_sfc_render$8");var mH=Dt(fH,[["render",pH],["__scopeId","data-v-5aa4f4ef"]]),gH=Object.defineProperty,rx=h((i,e)=>gH(i,"name",{value:e,configurable:!0}),"__name$l"),vH=Rt({props:{modal:Boolean,title:String,width:String,height:String,closable:Boolean,visible:Boolean,x:Number,y:Number},emits:["update:visible","update:x","update:y","close"],setup(i,e){const t=ze(),n=ze(0),s=ze(0),r=Je(function(){const l={};return l.left=Math.round(n.value)+"px",l.top=Math.round(s.value)+"px",i.width&&(l.width=i.width),i.height&&(l.height=i.height),l});mi([()=>i.x,()=>i.y],function([l,c]){l!=null&&c!=null&&(n.value=l,s.value=c)},{immediate:!0}),mi(()=>i.visible,async function(l){if(l&&(i.x==null||i.y==null)&&(n.value=0,s.value=0,await Qi(),t.value)){const c=document.body.getBoundingClientRect(),u=t.value.getBoundingClientRect();n.value=(c.width-u.width)/2,s.value=(c.height-u.height)/2}},{immediate:!0});function o(){e.emit("update:visible",!1),e.emit("close")}h(o,"close"),rx(o,"close");function a(l){const c=l.clientX,u=l.clientY,d=n.value,f=s.value;va(l,p=>{if(t.value){const g=p.clientX-c,m=p.clientY-u,v=document.body.getBoundingClientRect(),y=t.value.getBoundingClientRect();n.value=Math.max(0,Math.min(v.width-y.width,d+g)),s.value=Math.max(0,Math.min(v.height-y.height,f+m)),e.emit("update:x",n.value),e.emit("update:y",s.value)}})}return h(a,"onTitleMouseDown"),rx(a,"onTitleMouseDown"),{dialog:t,style:r,close:o,onTitleMouseDown:a}}});const yH={class:"popup-dialog__title-text"},_H={class:"popup-dialog__body"},bH={key:0,class:"popup-dialog__buttons"};function wH(i,e,t,n,s,r){return Se(),Bt(D0,{to:"body"},[he("div",{class:en(["popup-dialog__mask",{modal:i.modal,visible:i.visible}])},[he("div",{class:"popup-dialog",style:En(i.style),ref:"dialog"},[he("div",{class:"popup-dialog__title",onPointerdown:e[2]||(e[2]=(...o)=>i.onTitleMouseDown&&i.onTitleMouseDown(...o))},[he("div",yH,rn(i.title),1),i.closable?(Se(),ke("button",{key:0,class:"popup-dialog__btn-close",onMousedown:e[0]||(e[0]=mn(()=>{},["stop"])),onClick:e[1]||(e[1]=(...o)=>i.close&&i.close(...o))},null,32)):Qe("",!0)],32),he("div",_H,[Pu(i.$slots,"default",{},void 0,!0)]),i.$slots.buttons?(Se(),ke("div",bH,[Pu(i.$slots,"buttons",{},void 0,!0)])):Qe("",!0)],4)],2)])}h(wH,"_sfc_render$7");var kp=Dt(vH,[["render",wH],["__scopeId","data-v-4be1c5cb"]]),xH=Object.defineProperty,MH=h((i,e)=>xH(i,"name",{value:e,configurable:!0}),"__name$k"),AH=Rt({props:{alpha:Number,beta:Number},emits:["setView"],setup(i,e){const t=Je(function(){const s=(i.alpha||0)/Math.PI*180,r=-(i.beta||0)/Math.PI*180-90;return{transform:`rotateX(${s}deg) rotateY(${r}deg)`}});function n(s){e.emit("setView",s)}return h(n,"setView"),MH(n,"setView"),{cubeStyle:t,setView:n}}});function SH(i,e,t,n,s,r){return Se(),ke("div",{class:"view-rotation-handler",onContextmenu:e[6]||(e[6]=mn(()=>{},["prevent"]))},[he("div",{class:"cube",style:En(i.cubeStyle)},[he("div",{class:"face front",onClick:e[0]||(e[0]=o=>i.setView("front"))},"+Z"),he("div",{class:"face back",onClick:e[1]||(e[1]=o=>i.setView("back"))},"-Z"),he("div",{class:"face top",onClick:e[2]||(e[2]=o=>i.setView("top"))},"+Y"),he("div",{class:"face bottom",onClick:e[3]||(e[3]=o=>i.setView("bottom"))},"-Y"),he("div",{class:"face right",onClick:e[4]||(e[4]=o=>i.setView("right"))},"+X"),he("div",{class:"face left",onClick:e[5]||(e[5]=o=>i.setView("left"))},"-X")],4)],32)}h(SH,"_sfc_render$6");var CH=Dt(AH,[["render",SH],["__scopeId","data-v-308c1057"]]),TH=Object.defineProperty,ox=h((i,e)=>TH(i,"name",{value:e,configurable:!0}),"__name$j"),EH=Rt({components:{ViewRotationHandler:CH},props:{editorContext:wh,quadView:Boolean,mainView:Number},emits:["mounted","beforeUnmount","setView"],setup(i,e){const t=ze(),n=ze(),s=ze(),r=ze(),o=ze(),a=ze(),l=ze(),c=ze(),u=ze(),d=ze();let f;mi(()=>i.quadView,function(){p()}),rp(function(){p(),f=setInterval(p,50),e.emit("mounted",n.value,l.value,c.value,u.value,d.value)}),xa(function(){clearInterval(f),e.emit("beforeUnmount")});function p(){const m=t.value.getBoundingClientRect(),v=n.value;(v.width!==m.width||v.height!==m.height)&&(v.width=m.width,v.height=m.height)}h(p,"resize"),ox(p,"resize");function g(m){e.emit("setView",m)}return h(g,"setView"),ox(g,"setView"),{wrapper:t,canvas:n,view1:s,view2:r,view3:o,view4:a,view1Control:l,view2Control:c,view3Control:u,view4Control:d,setView:g}}});const PH={ref:"canvas"},RH={class:"view v1",ref:"view1",tabindex:"0"},IH={class:"control",ref:"view1Control"},DH={class:"view v2",ref:"view2",tabindex:"0"},LH={class:"control",ref:"view2Control"},kH={class:"view v3",ref:"view3",tabindex:"0"},OH={class:"control",ref:"view3Control"},NH={class:"view v4",ref:"view4",tabindex:"0"},FH={class:"control",ref:"view4Control"};function zH(i,e,t,n,s,r){const o=qt("view-rotation-handler");return Se(),ke("div",{class:en(["canvas-wrapper",{"quad-view":i.quadView}]),ref:"wrapper"},[he("canvas",PH,null,512),ml(he("div",RH,[he("div",IH,null,512),i.editorContext?(Se(),Bt(o,{key:0,alpha:i.editorContext.views[0].camera.alpha,beta:i.editorContext.views[0].camera.beta,onSetView:i.setView},null,8,["alpha","beta","onSetView"])):Qe("",!0)],512),[[Ph,i.quadView||i.mainView===0]]),ml(he("div",DH,[he("div",LH,null,512),i.editorContext?(Se(),Bt(o,{key:0,alpha:i.editorContext.views[1].camera.alpha,beta:i.editorContext.views[1].camera.beta,onSetView:i.setView},null,8,["alpha","beta","onSetView"])):Qe("",!0)],512),[[Ph,i.quadView||i.mainView===1]]),ml(he("div",kH,[he("div",OH,null,512),i.editorContext?(Se(),Bt(o,{key:0,alpha:i.editorContext.views[2].camera.alpha,beta:i.editorContext.views[2].camera.beta,onSetView:i.setView},null,8,["alpha","beta","onSetView"])):Qe("",!0)],512),[[Ph,i.quadView||i.mainView===2]]),ml(he("div",NH,[he("div",FH,null,512),i.editorContext?(Se(),Bt(o,{key:0,alpha:i.editorContext.views[3].camera.alpha,beta:i.editorContext.views[3].camera.beta,onSetView:i.setView},null,8,["alpha","beta","onSetView"])):Qe("",!0)],512),[[Ph,i.quadView||i.mainView===3]])],2)}h(zH,"_sfc_render$5");var BH=Dt(EH,[["render",zH],["__scopeId","data-v-5bd07d3d"]]),UH=Object.defineProperty,VH=h((i,e)=>UH(i,"name",{value:e,configurable:!0}),"__name$i"),HH=Rt({props:{width:{type:Number,default:250},minWidth:{type:Number,default:50},maxWidth:{type:Number,default:500},direction:{type:String,default:"left"}},setup(i,e){function t(n){if(n.button!==0)return;const s=i.width,r=n.clientX;va(n,function(o){const a=(o.clientX-r)*(i.direction==="left"?-1:1),l=Math.min(Math.max(s+a,i.minWidth),i.maxWidth);e.emit("update:width",l)})}return h(t,"onResize"),VH(t,"onResize"),{onResize:t}}});const GH={class:"side-panel-content"};function WH(i,e,t,n,s,r){return Se(),ke("div",{class:"side-panel",style:En({width:`${i.width}px`})},[he("div",GH,[Pu(i.$slots,"default",{},void 0,!0)]),i.direction==="left"?(Se(),ke("div",{key:0,class:"resizer-handler left",onPointerdown:e[0]||(e[0]=(...o)=>i.onResize&&i.onResize(...o))},null,32)):Qe("",!0),i.direction==="right"?(Se(),ke("div",{key:1,class:"resizer-handler right",onPointerdown:e[1]||(e[1]=(...o)=>i.onResize&&i.onResize(...o))},null,32)):Qe("",!0)],4)}h(WH,"_sfc_render$4");var jH=Dt(HH,[["render",WH],["__scopeId","data-v-64397c11"]]),$H=Object.defineProperty,XH=h((i,e)=>$H(i,"name",{value:e,configurable:!0}),"__name$h");function Op(i,e){const t=wM(i);e&&e(t);const n=document.createElement("div");return document.body.appendChild(n),t.mount(n),function(){t.unmount(),n.remove()}}h(Op,"createComponentInstance");XH(Op,"createComponentInstance");var YH=Object.defineProperty,KH=h((i,e)=>YH(i,"name",{value:e,configurable:!0}),"__name$g"),qH=Rt({components:{PopupDialog:kp},setup(){const i=ze(!1),e=ze(""),t=ei("context",null);t&&(i.value=t.visible,e.value=t.content),mi(i,s=>{s||t==null||t.onCloseCallback()});function n(){i.value=!1}return h(n,"ok"),KH(n,"ok"),{visible:i,content:e,ok:n}}});const ZH={style:{"white-space":"pre-wrap"}};function QH(i,e,t,n,s,r){const o=qt("popup-dialog");return Se(),Bt(o,{modal:"",title:"Message",closable:"",visible:i.visible,"onUpdate:visible":e[1]||(e[1]=a=>i.visible=a)},{buttons:Ht(()=>[he("button",{onClick:e[0]||(e[0]=(...a)=>i.ok&&i.ok(...a))},"Ok")]),default:Ht(()=>[he("div",ZH,rn(i.content),1)]),_:1},8,["visible"])}h(QH,"_sfc_render$3");var JH=Dt(qH,[["render",QH]]),eG=Object.defineProperty,ax=h((i,e)=>eG(i,"name",{value:e,configurable:!0}),"__name$f"),tG=Rt({components:{PopupDialog:kp},setup(){const i=ze(!1),e=ze("");let t=!1;const n=ei("context",null);n&&(i.value=n.visible,e.value=n.content),mi(i,o=>{o||n==null||n.onCloseCallback(t)});function s(){t=!0,i.value=!1}h(s,"yes"),ax(s,"yes");function r(){i.value=!1}return h(r,"no"),ax(r,"no"),{visible:i,content:e,yes:s,no:r}}});const nG={style:{"white-space":"pre-wrap"}};function iG(i,e,t,n,s,r){const o=qt("popup-dialog");return Se(),Bt(o,{modal:"",title:"Confirm",closable:"",visible:i.visible,"onUpdate:visible":e[2]||(e[2]=a=>i.visible=a)},{buttons:Ht(()=>[he("button",{onClick:e[0]||(e[0]=(...a)=>i.yes&&i.yes(...a))},"Yes"),he("button",{onClick:e[1]||(e[1]=(...a)=>i.no&&i.no(...a))},"No")]),default:Ht(()=>[he("div",nG,rn(i.content),1)]),_:1},8,["visible"])}h(iG,"_sfc_render$2");var sG=Dt(tG,[["render",iG]]),rG=Object.defineProperty,lx=h((i,e)=>rG(i,"name",{value:e,configurable:!0}),"__name$e"),oG=Rt({components:{PopupDialog:kp},setup(){const i=ze(!1),e=ze(""),t=ze(),n=ze(null);let s=!1;const r=ei("context",null);r&&(i.value=r.visible,e.value=r.title,n.value=r.value),mi(i,async l=>{var c,u;l?(await Qi(),(c=t.value)==null||c.focus(),(u=t.value)==null||u.select()):r==null||r.onCloseCallback(s?n.value:null)},{immediate:!0});function o(){s=!0,i.value=!1}h(o,"ok"),lx(o,"ok");function a(){s=!1,i.value=!1}return h(a,"cancel"),lx(a,"cancel"),{visible:i,title:e,input:t,value:n,ok:o,cancel:a}}});function aG(i,e,t,n,s,r){const o=qt("popup-dialog");return Se(),Bt(o,{modal:"",title:i.title,closable:"",visible:i.visible,"onUpdate:visible":e[3]||(e[3]=a=>i.visible=a)},{buttons:Ht(()=>[he("button",{onClick:e[1]||(e[1]=(...a)=>i.ok&&i.ok(...a))},"Ok"),he("button",{onClick:e[2]||(e[2]=(...a)=>i.cancel&&i.cancel(...a))},"Cancel")]),default:Ht(()=>[ml(he("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>i.value=a),style:{width:"100%"},ref:"input"},null,512),[[bM,i.value]])]),_:1},8,["title","visible"])}h(aG,"_sfc_render$1");var lG=Dt(oG,[["render",aG]]),cG=Object.defineProperty,uc=h((i,e)=>cG(i,"name",{value:e,configurable:!0}),"__name$d");class Jv{constructor(e,t,n){C(this,"visible");C(this,"content");C(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=n}}h(Jv,"AlertDialogContext");uc(Jv,"AlertDialogContext");function bf(i){let e;return new Promise(function(t){const n=new Jv(!0,i,function(){e(),t()});e=Op(JH,s=>{s.provide("context",n)})})}h(bf,"showAlertDialog");uc(bf,"showAlertDialog");class ey{constructor(e,t,n){C(this,"visible");C(this,"content");C(this,"onCloseCallback");this.visible=e,this.content=t,this.onCloseCallback=n}}h(ey,"ConfirmDialogContext");uc(ey,"ConfirmDialogContext");function RC(i){let e;return new Promise(function(t){const n=new ey(!0,i,function(s){e(),t(s)});e=Op(sG,s=>{s.provide("context",n)})})}h(RC,"showConfirmDialog");uc(RC,"showConfirmDialog");class ty{constructor(e,t,n,s){C(this,"visible");C(this,"title");C(this,"value");C(this,"onCloseCallback");this.visible=e,this.title=t,this.value=n,this.onCloseCallback=s}}h(ty,"PromptDialogContext");uc(ty,"PromptDialogContext");function uG(i,e){let t;return new Promise(function(n){const s=new ty(!0,i,e==null?null:e,function(r){t(),n(r)});t=Op(lG,r=>{r.provide("context",s)})})}h(uG,"showPromptDialog");uc(uG,"showPromptDialog");var hG=Object.defineProperty,nh=h((i,e)=>hG(i,"name",{value:e,configurable:!0}),"__name$c");async function IC(i,e){const t=await ny(i,e);if(t){for(let n of t)i.history.removeNode(n.id);return!0}return!1}h(IC,"cutModelSelected");nh(IC,"cutModelSelected");async function ny(i,e){var s;if(((s=e==null?void 0:e.target)==null?void 0:s.tagName)==="INPUT")return;const t=i.model.getTopmostSelectedNodes(),n=[];for(let r of t)n.push(await r.toJson());return await navigator.clipboard.writeText(JSON.stringify(n)),t}h(ny,"copyModelSelected");nh(ny,"copyModelSelected");async function DC(i,e){var t;if(e&&"target"in e&&((t=e.target)==null?void 0:t.tagName)==="INPUT")return!1;try{let n=h(function(u){u=u.filter(d=>d.instanceId?o.isNodeExists(d.instanceId)?d.type===d.type:!1:!0);for(let d of u)d.children&&(d.children=n(d.children));return u},"filterInvalidInstancedNodes");nh(n,"filterInvalidInstancedNodes");let s=JSON.parse(await navigator.clipboard.readText());if(!Array.isArray(s))return!1;async function r(u){for(let d of u){for(let f in d.data){const p=vi(f);let g=d.data[f];p.dataType===$e.BYTES&&(g=new Uint8Array(await l1(g))),p.deserialize&&(g=p.deserialize(g)),d.data[f]=g}d.children&&await r(d.children),d.selected=!1}}h(r,"convertJsonToRealDataType"),nh(r,"convertJsonToRealDataType"),await r(s);const o=i.model;let a=e instanceof ua?e:void 0;a||o.forEach(u=>{if(o.selected.includes(u.id))return a=u,!1}),s=n(s);let l=!1;const c=i.history;for(let u of s)if(u.selected=!0,a){if(a.isValidChild(u.type)){const d={...u};d.parentId=a.id,c.createNode(d),l=!0}}else if(jn(u.type).canBeRoot){const f={...u};f.parentId=void 0,c.createNode(f),l=!0}return l&&(o.selected=[]),!0}catch(n){return console.error(n),!1}}h(DC,"pastedModelNodes");nh(DC,"pastedModelNodes");var dG=Object.defineProperty,fG=h((i,e)=>dG(i,"name",{value:e,configurable:!0}),"__name$b");function LC(i,e){e=qe(e);const t=e.parent;let n=[],s=[];switch(e.type){case"Shape":{const r=e.get(Si);if(r.throttleHash){const l=i.throttleTasks.get(r.throttleHash);l&&(l.callback(),i.throttleTasks.delete(r.throttleHash)),r.throttleHash=""}const a=e.value(Ce).geometry;n=[new Float32Array(a.getAttribute("position").array)],a.hasAttribute("color")?s=[new Float32Array(a.getAttribute("color").array)]:s=[null]}break;default:{if(!e.has(Ce))return;const r=e.value(Ce);if(!r)return;const o=[];if(r.geometry)o.push(r.geometry);else for(let u of r.children)u.geometry&&o.push(u.geometry);const a=new A,l=new A,c=new A;for(let u of o){if(!u.isBufferGeometry)continue;const d=u.getAttribute("position");if(!d)continue;const f=u.index;if(f){const p=new Float32Array(f.count*3),g=new Float32Array(f.count*3);for(let m=0,v=f.count;m<v;m+=3){a.fromBufferAttribute(d,f.getX(m)),l.fromBufferAttribute(d,f.getX(m+1)),c.fromBufferAttribute(d,f.getX(m+2));const y=m*3;p[y]=a.x,p[y+1]=a.y,p[y+2]=a.z,p[y+3]=l.x,p[y+4]=l.y,p[y+5]=l.z,p[y+6]=c.x,p[y+7]=c.y,p[y+8]=c.z}if(u.hasAttribute("color")){const m=u.getAttribute("color");for(let v=0,y=f.count;v<y;v+=3){a.fromBufferAttribute(m,f.getX(v)),l.fromBufferAttribute(m,f.getX(v+1)),c.fromBufferAttribute(m,f.getX(v+2));const b=v*3;g[b]=a.x,g[b+1]=a.y,g[b+2]=a.z,g[b+3]=l.x,g[b+4]=l.y,g[b+5]=l.z,g[b+6]=c.x,g[b+7]=c.y,g[b+8]=c.z}}else for(let m=0,v=g.length;m<v;++m)g[m]=1;p.length&&(n.push(p),s.push(g))}else if(d.array.length)if(n.push(new Float32Array(d.array)),u.hasAttribute("color")){const p=u.getAttribute("color");s.push(new Float32Array(p.array))}else s.push(null)}}break}if(!!n.length){for(let r=0,o=n.length;r<o;++r){const a=n[r],l=s[r],c={[an.name]:a,[bs.name]:l||void 0},u=[Kt,pn,ri,Ue,lt,Ft,Bs,zs,gn,Fs,Un,Hi];for(let d of u)e.has(d)&&(c[d.name]=e.cloneValue(d));i.history.createNode({type:"Clay",parentId:t?t.id:0,data:c})}i.history.removeNode(e.id)}}h(LC,"convertModelNodeToClay");fG(LC,"convertModelNodeToClay");var pG=Object.defineProperty,Np=h((i,e)=>pG(i,"name",{value:e,configurable:!0}),"__name$a");async function kC(i){function e(t){const n={type:t.type,children:[]};if(t.has(Ut)){const s=t.value(Ut);n.euler={x:s.x,y:s.y,z:s.z}}return n.children=t.children.map(e),n}h(e,"getPoseJson"),Np(e,"getPoseJson"),await navigator.clipboard.writeText(JSON.stringify(e(i)))}h(kC,"copyPose");Np(kC,"copyPose");async function OC(i,e){try{let t=h(function(s,r){if(r.type===s.type&&(r.euler&&s.has(Ut)&&i.history.setValue(s,Ut,new it(r.euler.x,r.euler.y,r.euler.z)),s.children.length===r.children.length))for(let o=0,a=s.children.length;o<a;++o)t(s.children[o],r.children[o])},"applyPose");Np(t,"applyPose");let n=JSON.parse(await navigator.clipboard.readText());if(!("type"in n))return;t(e,n)}catch(t){console.error(t)}}h(OC,"pastePose");Np(OC,"pastePose");var mG=Object.defineProperty,NC=h((i,e)=>mG(i,"name",{value:e,configurable:!0}),"__name$9");function FC(i,e,t){var v;e=qe(e);const n=new ve,s=new ve,r=new A,o=new A,a=new A;if(t!=="none"){switch(n.copy(e.getParentWorldMatrix()),s.copy(n).invert(),t){case"x":r.set(1,0,0);break;case"y":r.set(0,1,0);break;case"z":r.set(0,0,1);break}o.copy(r).transformDirection(n),a.applyMatrix4(n)}const l=new A,c=new Be,u=new A,d=new ve,f=new A,p=new Be;function g(y,b,_,x,w){const T={type:y.type,instanceId:y.instanceId||y.id};T.data=y.getComponentData(!0);let P;if(t!=="none"){if(b=b,_=_,x=x,y.instanceId&&y.has(_n)&&tc(y.value(_n),r)?delete T.data[_n.name]:T.data[_n.name]=new A().copy(r),l.set(0,0,0),c.set(0,0,0,1),u.set(1,1,1),y.has(Ue)){const R=T.data[Ue.name];R.applyMatrix4(b),R.sub(a),R.reflect(o),R.add(a),R.applyMatrix4(x),l.copy(R)}if(y.has(lt)){const R=T.data[lt.name];c.setFromEuler(R);const L=yr(f,c);f.applyMatrix4(b),f.sub(a),f.reflect(o),f.add(a),f.applyMatrix4(x),f.normalize(),c.setFromAxisAngle(f,-L),R.setFromQuaternion(c)}if(y.has(mt)){if(t==="x")throw new Error("Flipping on x axis will broke the ik chain");const R=y.get(mt);l.copy(R.start),l.applyMatrix4(b),l.sub(a),l.reflect(o),l.add(a),l.applyMatrix4(x);let L=yr(f,R.quaternion);f.applyMatrix4(b),f.sub(a),f.reflect(o),f.add(a),f.applyMatrix4(x),f.normalize(),c.setFromAxisAngle(f,-L);const W=T.data[Ut.name];w?(p.multiplyQuaternions(w,c),W.setFromQuaternion(p)):W.setFromQuaternion(c)}y.has(Ft)&&u.setScalar(y.value(Ft)),d.compose(l,c,u),_=new ve().multiplyMatrices(_,d),x=new ve().copy(_).invert(),b=y.getWorldMatrix(),P=new Be().copy(c).invert()}T.children=[];let M;for(let R of y.children){const L=g(R,b,_,x,M);M=L.invQuat1,T.children.push(L.creationInfo)}return T.expanded=y.expanded,T.selected=!1,{creationInfo:T,invQuat1:P}}h(g,"makeNewNode"),NC(g,"makeNewNode");const m=g(e,n,n,s).creationInfo;m.parentId=(v=e.parent)==null?void 0:v.id,m.selected=!0,i.model.selected=[],i.history.createNode(m)}h(FC,"createInstanceNode");NC(FC,"createInstanceNode");class Fp{constructor(){this.pluginCallbacks=[],this.register(function(e){return new UC(e)}),this.register(function(e){return new VC(e)}),this.register(function(e){return new HC(e)}),this.register(function(e){return new jC(e)}),this.register(function(e){return new $C(e)}),this.register(function(e){return new GC(e)}),this.register(function(e){return new WC(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){const r=new BC,o=[];for(let a=0,l=this.pluginCallbacks.length;a<l;a++)o.push(this.pluginCallbacks[a](r));r.setPlugins(o),r.write(e,t,s).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(s,r){n.parse(e,s,r,t)})}}h(Fp,"GLTFExporter");const Lt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Ui={};Ui[Cn]=Lt.NEAREST;Ui[If]=Lt.NEAREST_MIPMAP_NEAREST;Ui[Df]=Lt.NEAREST_MIPMAP_LINEAR;Ui[ai]=Lt.LINEAR;Ui[F0]=Lt.LINEAR_MIPMAP_NEAREST;Ui[Ma]=Lt.LINEAR_MIPMAP_LINEAR;Ui[li]=Lt.CLAMP_TO_EDGE;Ui[wr]=Lt.REPEAT;Ui[Lu]=Lt.MIRRORED_REPEAT;const cx={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},ux=12,gG=1179937895,vG=2,hx=8,yG=1313821514,_G=5130562;function cu(i,e){return i.length===e.length&&i.every(function(t,n){return t===e[n]})}h(cu,"equalArray");function bG(i){return new TextEncoder().encode(i).buffer}h(bG,"stringToArrayBuffer");function wG(i){return cu(i.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}h(wG,"isIdentityMatrix");function xG(i,e,t){const n={min:new Array(i.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(i.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let s=e;s<e+t;s++)for(let r=0;r<i.itemSize;r++){let o;i.itemSize>4?o=i.array[s*i.itemSize+r]:r===0?o=i.getX(s):r===1?o=i.getY(s):r===2?o=i.getZ(s):r===3&&(o=i.getW(s)),n.min[r]=Math.min(n.min[r],o),n.max[r]=Math.max(n.max[r],o)}return n}h(xG,"getMinMax");function zC(i){return Math.ceil(i/4)*4}h(zC,"getPaddedBufferSize");function mg(i,e=0){const t=zC(i.byteLength);if(t!==i.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(i)),e!==0)for(let s=i.byteLength;s<t;s++)n[s]=e;return n.buffer}return i}h(mg,"getPaddedArrayBuffer");function dx(){return typeof document=="undefined"&&typeof OffscreenCanvas!="undefined"?new OffscreenCanvas(1,1):document.createElement("canvas")}h(dx,"getCanvas");function fx(i,e){if(i.toBlob!==void 0)return new Promise(n=>i.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),i.convertToBlob({type:e,quality:t})}h(fx,"getToBlobPromise");class BC{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const s=this,r=s.buffers,o=s.json;n=s.options;const a=s.extensionsUsed,l=new Blob(r,{type:"application/octet-stream"}),c=Object.keys(a);if(c.length>0&&(o.extensionsUsed=c),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),n.binary===!0){const u=new FileReader;u.readAsArrayBuffer(l),u.onloadend=function(){const d=mg(u.result),f=new DataView(new ArrayBuffer(hx));f.setUint32(0,d.byteLength,!0),f.setUint32(4,_G,!0);const p=mg(bG(JSON.stringify(o)),32),g=new DataView(new ArrayBuffer(hx));g.setUint32(0,p.byteLength,!0),g.setUint32(4,yG,!0);const m=new ArrayBuffer(ux),v=new DataView(m);v.setUint32(0,gG,!0),v.setUint32(4,vG,!0);const y=ux+g.byteLength+p.byteLength+f.byteLength+d.byteLength;v.setUint32(8,y,!0);const b=new Blob([m,g,p,f,d],{type:"application/octet-stream"}),_=new FileReader;_.readAsArrayBuffer(b),_.onloadend=function(){t(_.result)}}}else if(o.buffers&&o.buffers.length>0){const u=new FileReader;u.readAsDataURL(l),u.onloadend=function(){const d=u.result;o.buffers[0].uri=d,t(o)}}else t(o)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,s=this.extensionsUsed;try{const r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const o in r.gltfExtensions)t.extensions[o]=r.gltfExtensions[o],s[o]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(r){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+r.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const n=new A;for(let s=0,r=e.count;s<r;s++)if(Math.abs(n.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),s=new A;for(let r=0,o=n.count;r<o;r++)s.fromBufferAttribute(n,r),s.x===0&&s.y===0&&s.z===0?s.setX(1):s.normalize(),n.setXYZ(r,s.x,s.y,s.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const s={};(t.offset.x!==0||t.offset.y!==0)&&(s.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(s.rotation=t.rotation,n=!0),(t.repeat.x!==1||t.repeat.y!==1)&&(s.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=s,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(p){return p.encoding===bt?h(function(m){return m<.04045?m*.0773993808:Math.pow(m*.9478672986+.0521327014,2.4)},"SRGBToLinear"):h(function(m){return m},"LinearToLinear")}h(n,"getEncodingConversion"),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const s=e==null?void 0:e.image,r=t==null?void 0:t.image,o=Math.max((s==null?void 0:s.width)||0,(r==null?void 0:r.width)||0),a=Math.max((s==null?void 0:s.height)||0,(r==null?void 0:r.height)||0),l=dx();l.width=o,l.height=a;const c=l.getContext("2d");c.fillStyle="#00ffff",c.fillRect(0,0,o,a);const u=c.getImageData(0,0,o,a);if(s){c.drawImage(s,0,0,o,a);const p=n(e),g=c.getImageData(0,0,o,a).data;for(let m=2;m<g.length;m+=4)u.data[m]=p(g[m]/256)*256}if(r){c.drawImage(r,0,0,o,a);const p=n(t),g=c.getImageData(0,0,o,a).data;for(let m=1;m<g.length;m+=4)u.data[m]=p(g[m]/256)*256}c.putImageData(u,0,0);const f=(e||t).clone();return f.source=new pp(l),f.encoding=xr,f}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,s,r){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;t===Lt.UNSIGNED_BYTE?a=1:t===Lt.UNSIGNED_SHORT?a=2:a=4;const l=zC(s*e.itemSize*a),c=new DataView(new ArrayBuffer(l));let u=0;for(let p=n;p<n+s;p++)for(let g=0;g<e.itemSize;g++){let m;e.itemSize>4?m=e.array[p*e.itemSize+g]:g===0?m=e.getX(p):g===1?m=e.getY(p):g===2?m=e.getZ(p):g===3&&(m=e.getW(p)),t===Lt.FLOAT?c.setFloat32(u,m,!0):t===Lt.UNSIGNED_INT?c.setUint32(u,m,!0):t===Lt.UNSIGNED_SHORT?c.setUint16(u,m,!0):t===Lt.UNSIGNED_BYTE&&c.setUint8(u,m),u+=a}const d={buffer:this.processBuffer(c.buffer),byteOffset:this.byteOffset,byteLength:l};return r!==void 0&&(d.target=r),r===Lt.ARRAY_BUFFER&&(d.byteStride=e.itemSize*a),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(s){const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){const o=mg(r.result),a={buffer:t.processBuffer(o),byteOffset:t.byteOffset,byteLength:o.byteLength};t.byteOffset+=o.byteLength,s(n.bufferViews.push(a)-1)}})}processAccessor(e,t,n,s){const r=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"};let a;if(e.array.constructor===Float32Array)a=Lt.FLOAT;else if(e.array.constructor===Uint32Array)a=Lt.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)a=Lt.UNSIGNED_SHORT;else if(e.array.constructor===Uint8Array)a=Lt.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");if(n===void 0&&(n=0),s===void 0&&(s=e.count),s===0)return null;const l=xG(e,n,s);let c;t!==void 0&&(c=e===t.index?Lt.ELEMENT_ARRAY_BUFFER:Lt.ARRAY_BUFFER);const u=this.processBufferView(e,a,n,s,c),d={bufferView:u.id,byteOffset:u.byteOffset,componentType:a,count:s,max:l.max,min:l.min,type:o[e.itemSize]};return e.normalized===!0&&(d.normalized=!0),r.accessors||(r.accessors=[]),r.accessors.push(d)-1}processImage(e,t,n,s="image/png"){const r=this,o=r.cache,a=r.json,l=r.options,c=r.pending;o.images.has(e)||o.images.set(e,{});const u=o.images.get(e),d=s+":flipY/"+n.toString();if(u[d]!==void 0)return u[d];a.images||(a.images=[]);const f={mimeType:s},p=dx();p.width=Math.min(e.width,l.maxTextureSize),p.height=Math.min(e.height,l.maxTextureSize);const g=p.getContext("2d");if(n===!0&&(g.translate(0,p.height),g.scale(1,-1)),e.data!==void 0){t!==Bi&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const v=new Uint8ClampedArray(e.height*e.width*4);for(let y=0;y<v.length;y+=4)v[y+0]=e.data[y+0],v[y+1]=e.data[y+1],v[y+2]=e.data[y+2],v[y+3]=e.data[y+3];g.putImageData(new ImageData(v,e.width,e.height),0,0)}else g.drawImage(e,0,0,p.width,p.height);l.binary===!0?c.push(fx(p,s).then(v=>r.processBufferViewImage(v)).then(v=>{f.bufferView=v})):p.toDataURL!==void 0?f.uri=p.toDataURL(s):c.push(fx(p,s).then(v=>new FileReader().readAsDataURL(v)).then(v=>{f.uri=v}));const m=a.images.push(f)-1;return u[d]=m,m}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Ui[e.magFilter],minFilter:Ui[e.minFilter],wrapS:Ui[e.wrapS],wrapT:Ui[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let s=e.userData.mimeType;s==="image/webp"&&(s="image/png");const r={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,s)};e.name&&(r.name=e.name),this._invokeAll(function(a){a.writeTexture&&a.writeTexture(e,r)});const o=n.textures.push(r)-1;return t.textures.set(e,o),o}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const s={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const r=e.color.toArray().concat([e.opacity]);if(cu(r,[1,1,1,1])||(s.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(s.pbrMetallicRoughness.metallicFactor=e.metalness,s.pbrMetallicRoughness.roughnessFactor=e.roughness):(s.pbrMetallicRoughness.metallicFactor=.5,s.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const a=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),l={index:this.processTexture(a)};this.applyTextureTransform(l,a),s.pbrMetallicRoughness.metallicRoughnessTexture=l}if(e.map){const a={index:this.processTexture(e.map)};this.applyTextureTransform(a,e.map),s.pbrMetallicRoughness.baseColorTexture=a}if(e.emissive){const a=e.emissive.clone().multiplyScalar(e.emissiveIntensity),l=Math.max(a.r,a.g,a.b);if(l>1&&(a.multiplyScalar(1/l),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),l>0&&(s.emissiveFactor=a.toArray()),e.emissiveMap){const c={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(c,e.emissiveMap),s.emissiveTexture=c}}if(e.normalMap){const a={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(a.scale=e.normalScale.x),this.applyTextureTransform(a,e.normalMap),s.normalTexture=a}if(e.aoMap){const a={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(a.strength=e.aoMapIntensity),this.applyTextureTransform(a,e.aoMap),s.occlusionTexture=a}e.transparent?s.alphaMode="BLEND":e.alphaTest>0&&(s.alphaMode="MASK",s.alphaCutoff=e.alphaTest),e.side===Ci&&(s.doubleSided=!0),e.name!==""&&(s.name=e.name),this.serializeUserData(e,s),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(e,s)});const o=n.materials.push(s)-1;return t.materials.set(e,o),o}processMesh(e){const t=this.cache,n=this.json,s=[e.geometry.uuid];if(Array.isArray(e.material))for(let _=0,x=e.material.length;_<x;_++)s.push(e.material[_].uuid);else s.push(e.material.uuid);const r=s.join(":");if(t.meshes.has(r))return t.meshes.get(r);const o=e.geometry;let a;e.isLineSegments?a=Lt.LINES:e.isLineLoop?a=Lt.LINE_LOOP:e.isLine?a=Lt.LINE_STRIP:e.isPoints?a=Lt.POINTS:a=e.material.wireframe?Lt.LINES:Lt.TRIANGLES;const l={},c={},u=[],d=[],f={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},p=o.getAttribute("normal");p!==void 0&&!this.isNormalizedNormalAttribute(p)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(p)));let g=null;for(let _ in o.attributes){if(_.slice(0,5)==="morph")continue;const x=o.attributes[_];if(_=f[_]||_.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_)||(_="_"+_),t.attributes.has(this.getUID(x))){c[_]=t.attributes.get(this.getUID(x));continue}g=null;const T=x.array;_==="JOINTS_0"&&!(T instanceof Uint16Array)&&!(T instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),g=new Zt(new Uint16Array(T),x.itemSize,x.normalized));const P=this.processAccessor(g||x,o);P!==null&&(c[_]=P,t.attributes.set(this.getUID(x),P))}if(p!==void 0&&o.setAttribute("normal",p),Object.keys(c).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _=[],x=[],w={};if(e.morphTargetDictionary!==void 0)for(const T in e.morphTargetDictionary)w[e.morphTargetDictionary[T]]=T;for(let T=0;T<e.morphTargetInfluences.length;++T){const P={};let M=!1;for(const R in o.morphAttributes){if(R!=="position"&&R!=="normal"){M||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),M=!0);continue}const L=o.morphAttributes[R][T],W=R.toUpperCase(),k=o.attributes[R];if(t.attributes.has(this.getUID(L,!0))){P[W]=t.attributes.get(this.getUID(L,!0));continue}const z=L.clone();if(!o.morphTargetsRelative)for(let S=0,B=L.count;S<B;S++)z.setXYZ(S,L.getX(S)-k.getX(S),L.getY(S)-k.getY(S),L.getZ(S)-k.getZ(S));P[W]=this.processAccessor(z,o),t.attributes.set(this.getUID(k,!0),P[W])}d.push(P),_.push(e.morphTargetInfluences[T]),e.morphTargetDictionary!==void 0&&x.push(w[T])}l.weights=_,x.length>0&&(l.extras={},l.extras.targetNames=x)}const m=Array.isArray(e.material);if(m&&o.groups.length===0)return null;const v=m?e.material:[e.material],y=m?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _=0,x=y.length;_<x;_++){const w={mode:a,attributes:c};if(this.serializeUserData(o,w),d.length>0&&(w.targets=d),o.index!==null){let P=this.getUID(o.index);(y[_].start!==void 0||y[_].count!==void 0)&&(P+=":"+y[_].start+":"+y[_].count),t.attributes.has(P)?w.indices=t.attributes.get(P):(w.indices=this.processAccessor(o.index,o,y[_].start,y[_].count),t.attributes.set(P,w.indices)),w.indices===null&&delete w.indices}const T=this.processMaterial(v[y[_].materialIndex]);T!==null&&(w.material=T),u.push(w)}l.primitives=u,n.meshes||(n.meshes=[]),this._invokeAll(function(_){_.writeMesh&&_.writeMesh(e,l)});const b=n.meshes.push(l)-1;return t.meshes.set(r,b),b}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,s={type:n?"orthographic":"perspective"};return n?s.orthographic={xmag:e.right*2,ymag:e.top*2,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:s.perspective={aspectRatio:e.aspect,yfov:Zi.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(s.name=e.type),t.cameras.push(s)-1}processAnimation(e,t){const n=this.json,s=this.nodeMap;n.animations||(n.animations=[]),e=Fp.Utils.mergeMorphTargetTracks(e.clone(),t);const r=e.tracks,o=[],a=[];for(let l=0;l<r.length;++l){const c=r[l],u=ft.parseTrackName(c.name);let d=ft.findNode(t,u.nodeName);const f=cx[u.propertyName];if(u.objectName==="bones"&&(d.isSkinnedMesh===!0?d=d.skeleton.getBoneByName(u.objectIndex):d=void 0),!d||!f)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',c.name),null;const p=1;let g=c.values.length/c.times.length;f===cx.morphTargetInfluences&&(g/=d.morphTargetInfluences.length);let m;c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(m="CUBICSPLINE",g/=3):c.getInterpolation()===Fl?m="STEP":m="LINEAR",a.push({input:this.processAccessor(new Zt(c.times,p)),output:this.processAccessor(new Zt(c.values,g)),interpolation:m}),o.push({sampler:a.length-1,target:{node:s.get(d),path:f}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:a,channels:o}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,s=t.nodes[n.get(e)],r=e.skeleton;if(r===void 0)return null;const o=e.skeleton.bones[0];if(o===void 0)return null;const a=[],l=new Float32Array(r.bones.length*16),c=new ve;for(let d=0;d<r.bones.length;++d)a.push(n.get(r.bones[d])),c.copy(r.boneInverses[d]),c.multiply(e.bindMatrix).toArray(l,d*16);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new Zt(l,16)),joints:a,skeleton:n.get(o)}),s.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,s=this.nodeMap;t.nodes||(t.nodes=[]);const r={};if(n.trs){const a=e.quaternion.toArray(),l=e.position.toArray(),c=e.scale.toArray();cu(a,[0,0,0,1])||(r.rotation=a),cu(l,[0,0,0])||(r.translation=l),cu(c,[1,1,1])||(r.scale=c)}else e.matrixAutoUpdate&&e.updateMatrix(),wG(e.matrix)===!1&&(r.matrix=e.matrix.elements);if(e.name!==""&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){const a=this.processMesh(e);a!==null&&(r.mesh=a)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const a=[];for(let l=0,c=e.children.length;l<c;l++){const u=e.children[l];if(u.visible||n.onlyVisible===!1){const d=this.processNode(u);d!==null&&a.push(d)}}a.length>0&&(r.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(e,r)});const o=t.nodes.push(r)-1;return s.set(e,o),o}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const s={};e.name!==""&&(s.name=e.name),t.scenes.push(s);const r=[];for(let o=0,a=e.children.length;o<a;o++){const l=e.children[o];if(l.visible||n.onlyVisible===!1){const c=this.processNode(l);c!==null&&r.push(c)}}r.length>0&&(s.nodes=r),this.serializeUserData(e,s)}processObjects(e){const t=new Nu;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(s){s.beforeParse&&s.beforeParse(e)});const n=[];for(let s=0;s<e.length;s++)e[s]instanceof Nu?this.processScene(e[s]):n.push(e[s]);n.length>0&&this.processObjects(n);for(let s=0;s<this.skins.length;++s)this.processSkin(this.skins[s]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);this._invokeAll(function(s){s.afterParse&&s.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}h(BC,"GLTFWriter");class UC{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}const n=this.writer,s=n.json,r=n.extensionsUsed,o={};e.name&&(o.name=e.name),o.color=e.color.toArray(),o.intensity=e.intensity,e.isDirectionalLight?o.type="directional":e.isPointLight?(o.type="point",e.distance>0&&(o.range=e.distance)):e.isSpotLight&&(o.type="spot",e.distance>0&&(o.range=e.distance),o.spot={},o.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,o.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||e.target.position.x!==0||e.target.position.y!==0||e.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(s.extensions=s.extensions||{},s.extensions[this.name]={lights:[]},r[this.name]=!0);const a=s.extensions[this.name].lights;a.push(o),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}}h(UC,"GLTFLightExtension");class VC{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},s[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}h(VC,"GLTFMaterialsUnlitExtension");class HC{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const n=this.writer,s=n.extensionsUsed,r={};t.pbrMetallicRoughness.baseColorFactor&&(r.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const o=[1,1,1];if(e.specular.toArray(o,0),r.specularFactor=o,r.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(r.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const a={index:n.processTexture(e.specularMap)};n.applyTextureTransform(a,e.specularMap),r.specularGlossinessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}h(HC,"GLTFMaterialsPBRSpecularGlossiness");class GC{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,s=n.extensionsUsed,r={};if(r.clearcoatFactor=e.clearcoat,e.clearcoatMap){const o={index:n.processTexture(e.clearcoatMap)};n.applyTextureTransform(o,e.clearcoatMap),r.clearcoatTexture=o}if(r.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const o={index:n.processTexture(e.clearcoatRoughnessMap)};n.applyTextureTransform(o,e.clearcoatRoughnessMap),r.clearcoatRoughnessTexture=o}if(e.clearcoatNormalMap){const o={index:n.processTexture(e.clearcoatNormalMap)};n.applyTextureTransform(o,e.clearcoatNormalMap),r.clearcoatNormalTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}h(GC,"GLTFMaterialsClearcoatExtension");class WC{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,s=n.extensionsUsed,r={};if(r.iridescenceFactor=e.iridescence,e.iridescenceMap){const o={index:n.processTexture(e.iridescenceMap)};n.applyTextureTransform(o,e.iridescenceMap),r.iridescenceTexture=o}if(r.iridescenceIor=e.iridescenceIOR,r.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],r.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const o={index:n.processTexture(e.iridescenceThicknessMap)};n.applyTextureTransform(o,e.iridescenceThicknessMap),r.iridescenceThicknessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}h(WC,"GLTFMaterialsIridescenceExtension");class jC{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,s=n.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){const o={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(o,e.transmissionMap),r.transmissionTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}h(jC,"GLTFMaterialsTransmissionExtension");class $C{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,s=n.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){const o={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(o,e.thicknessMap),r.thicknessTexture=o}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,s[this.name]=!0}}h($C,"GLTFMaterialsVolumeExtension");Fp.Utils={insertKeyframe:function(i,e){const n=i.getValueSize(),s=new i.TimeBufferType(i.times.length+1),r=new i.ValueBufferType(i.values.length+n),o=i.createInterpolant(new i.ValueBufferType(n));let a;if(i.times.length===0){s[0]=e;for(let l=0;l<n;l++)r[l]=0;a=0}else if(e<i.times[0]){if(Math.abs(i.times[0]-e)<.001)return 0;s[0]=e,s.set(i.times,1),r.set(o.evaluate(e),0),r.set(i.values,n),a=0}else if(e>i.times[i.times.length-1]){if(Math.abs(i.times[i.times.length-1]-e)<.001)return i.times.length-1;s[s.length-1]=e,s.set(i.times,0),r.set(i.values,0),r.set(o.evaluate(e),i.values.length),a=s.length-1}else for(let l=0;l<i.times.length;l++){if(Math.abs(i.times[l]-e)<.001)return l;if(i.times[l]<e&&i.times[l+1]>e){s.set(i.times.slice(0,l+1),0),s[l+1]=e,s.set(i.times.slice(l+1),l+2),r.set(i.values.slice(0,(l+1)*n),0),r.set(o.evaluate(e),(l+1)*n),r.set(i.values.slice((l+1)*n),(l+2)*n),a=l+1;break}}return i.times=s,i.values=r,a},mergeMorphTargetTracks:function(i,e){const t=[],n={},s=i.tracks;for(let r=0;r<s.length;++r){let o=s[r];const a=ft.parseTrackName(o.name),l=ft.findNode(e,a.nodeName);if(a.propertyName!=="morphTargetInfluences"||a.propertyIndex===void 0){t.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),o=o.clone(),o.setInterpolation(fa)}const c=l.morphTargetInfluences.length,u=l.morphTargetDictionary[a.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+a.propertyIndex);let d;if(n[l.uuid]===void 0){d=o.clone();const p=new d.ValueBufferType(c*d.times.length);for(let g=0;g<d.times.length;g++)p[g*c+u]=d.values[g];d.name=(a.nodeName||"")+".morphTargetInfluences",d.values=p,n[l.uuid]=d,t.push(d);continue}const f=o.createInterpolant(new o.ValueBufferType(1));d=n[l.uuid];for(let p=0;p<d.times.length;p++)d.values[p*c+u]=f.evaluate(d.times[p]);for(let p=0;p<o.times.length;p++){const g=this.insertKeyframe(d,o.times[p]);d.values[g*c+u]=o.values[p]}}return i.tracks=t,i}};class XC{parse(e){let t="",n=0,s=0,r=0;const o=new A,a=new Te,l=new A,c=new je,u=[];function d(g){let m=0,v=0,y=0;const b=g.geometry,_=new ui,x=b.getAttribute("position"),w=b.getAttribute("normal"),T=b.getAttribute("uv"),P=b.getIndex();if(t+="o "+g.name+`
`,g.material&&g.material.name&&(t+="usemtl "+g.material.name+`
`),x!==void 0)for(let M=0,R=x.count;M<R;M++,m++)o.fromBufferAttribute(x,M),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(T!==void 0)for(let M=0,R=T.count;M<R;M++,y++)c.fromBufferAttribute(T,M),t+="vt "+c.x+" "+c.y+`
`;if(w!==void 0){_.getNormalMatrix(g.matrixWorld);for(let M=0,R=w.count;M<R;M++,v++)l.fromBufferAttribute(w,M),l.applyMatrix3(_).normalize(),t+="vn "+l.x+" "+l.y+" "+l.z+`
`}if(P!==null)for(let M=0,R=P.count;M<R;M+=3){for(let L=0;L<3;L++){const W=P.getX(M+L)+1;u[L]=n+W+(w||T?"/"+(T?s+W:"")+(w?"/"+(r+W):""):"")}t+="f "+u.join(" ")+`
`}else for(let M=0,R=x.count;M<R;M+=3){for(let L=0;L<3;L++){const W=M+L+1;u[L]=n+W+(w||T?"/"+(T?s+W:"")+(w?"/"+(r+W):""):"")}t+="f "+u.join(" ")+`
`}n+=m,s+=y,r+=v}h(d,"parseMesh");function f(g){let m=0;const v=g.geometry,y=g.type,b=v.getAttribute("position");if(t+="o "+g.name+`
`,b!==void 0)for(let _=0,x=b.count;_<x;_++,m++)o.fromBufferAttribute(b,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z+`
`;if(y==="Line"){t+="l ";for(let _=1,x=b.count;_<=x;_++)t+=n+_+" ";t+=`
`}if(y==="LineSegments")for(let _=1,x=_+1,w=b.count;_<w;_+=2,x=_+1)t+="l "+(n+_)+" "+(n+x)+`
`;n+=m}h(f,"parseLine");function p(g){let m=0;const v=g.geometry,y=v.getAttribute("position"),b=v.getAttribute("color");if(t+="o "+g.name+`
`,y!==void 0){for(let _=0,x=y.count;_<x;_++,m++)o.fromBufferAttribute(y,_),o.applyMatrix4(g.matrixWorld),t+="v "+o.x+" "+o.y+" "+o.z,b!==void 0&&(a.fromBufferAttribute(b,_).convertLinearToSRGB(),t+=" "+a.r+" "+a.g+" "+a.b),t+=`
`;t+="p ";for(let _=1,x=y.count;_<=x;_++)t+=n+_+" ";t+=`
`}n+=m}return h(p,"parsePoints"),e.traverse(function(g){g.isMesh===!0&&d(g),g.isLine===!0&&f(g),g.isPoints===!0&&p(g)}),t}}h(XC,"OBJExporter");var MG=Object.defineProperty,wf=h((i,e)=>MG(i,"name",{value:e,configurable:!0}),"__name$8");async function YC(i,e,t){function n(){const r=new Nu;r.traverse=function(o){a(r);function a(l){for(let c of l.children)c.visible&&(o(c),a(c))}h(a,"traverseVisible"),wf(a,"traverseVisible")};for(let o of i.readonlyRef().model.nodes)if(o.has(Ce)){const a=o.value(Ce);a&&r.children.push(a)}return r}h(n,"getExportScene"),wf(n,"getExportScene");async function s(r){try{i.statusBarMessage="Exporting...",e.value=!0,await Qi(),await r(async function(){i.statusBarMessage="Writing files...",await Qi()}),i.statusBarMessage="File exported."}catch(o){console.error(o),i.statusBarMessage="Failed to export."}finally{e.value=!1}}switch(h(s,"process"),wf(s,"process"),t){case"obj":try{const r=await showSaveFilePicker({types:[{accept:{"application/object":[".obj"]}}]});await s(async function(o){const a=n(),l=new XC().parse(a);await o();const c=await r.createWritable({keepExistingData:!1});await c.write(l),await c.close()})}catch{return}break;case"glb":try{const r=await showSaveFilePicker({types:[{accept:{"application/object":[".glb"]}}]});await s(async function(o){const a=n(),c=await new Fp().parseAsync(a,{onlyVisible:!0,binary:!0});await o();const u=await r.createWritable({keepExistingData:!1});await u.write(c),await u.close()})}catch{return}break;default:return}}h(YC,"exportModel");wf(YC,"exportModel");var AG=Object.defineProperty,xf=h((i,e)=>AG(i,"name",{value:e,configurable:!0}),"__name$7");const Xt=new A,lr=new Be,Jd=new A(1,0,0),eu=new A(0,1,0),px=new A(0,0,1);function KC(i,e,t){e=qe(e);let n;if(e.type==="IKNode"){const a=e.parent,l=a.children.findIndex(c=>c.id===e.id);if(l){const u=a.children[l-1].get(mt);n=new Be().copy(u.quaternion).invert()}}s(e,new A,new A(0,0,1),new ve,new ve,new ve,n);function s(a,l,c,u,d,f,p){const g=a.getLocalMatrix(),m=new A,v=new Be,y=new A;g.decompose(m,v,y);const b=new ve().multiplyMatrices(u,g);if(t==="flip"){const P=yr(Xt,v);Xt.applyMatrix4(u),Xt.sub(l),Xt.reflect(c),Xt.add(l),Xt.applyMatrix4(f),Xt.normalize(),v.setFromAxisAngle(Xt,-P),m.applyMatrix4(u),m.sub(l),m.reflect(c),m.add(l),m.applyMatrix4(f)}else Jd.set(1,0,0).applyQuaternion(v),eu.set(0,1,0).applyQuaternion(v),Jd.z=0,Jd.normalize(),eu.z=0,eu.normalize(),px.crossVectors(Jd,eu).normalize(),ec(v,px,eu),m.z=0;a.has(lt)&&i.history.setValue(a,lt,new it().setFromQuaternion(v)),a.has(Ut)&&(p?lr.multiplyQuaternions(p,v):lr.copy(v),i.history.setValue(a,Ut,new it().setFromQuaternion(lr)));const _=new ve().compose(m,v,y);_.multiplyMatrices(d,_);const x=new ve().copy(_).invert(),w=new Set;let T;for(let P of a.children){if(w.has(P.id))continue;w.add(P.id);const M=o(P,a);if(M){w.add(M.id);let R=P,L=M;P.has(Ue)&&P.value(Ue).z>0&&(L=P,R=M),r(l,c,R,u,d,f,T,L,u,d,f,T)}else{const{rotation:R}=s(P,l,c,b,_,x,T);T=new Be().copy(R).invert()}}return{rotation:v}}h(s,"processMiddleNode"),xf(s,"processMiddleNode");function r(a,l,c,u,d,f,p,g,m,v,y,b){const _=c.getLocalMatrix(),x=new A,w=new Be,T=new A;_.decompose(x,w,T);const P=new ve().multiplyMatrices(u,_),M=g.getLocalMatrix(),R=new A,L=new Be,W=new A;M.decompose(R,L,W);const k=new ve().multiplyMatrices(m,M);if(t==="flip"||t==="left-to-right"){const G=yr(Xt,w);Xt.applyMatrix4(u),Xt.sub(a),Xt.reflect(l),Xt.add(a),Xt.applyMatrix4(f),Xt.normalize(),w.setFromAxisAngle(Xt,-G),x.applyMatrix4(u),x.sub(a),x.reflect(l),x.add(a),x.applyMatrix4(f),g.has(lt)&&i.history.setValue(g,lt,new it().setFromQuaternion(w)),g.has(Ut)&&(p?lr.multiplyQuaternions(p,w):lr.copy(w),i.history.setValue(g,Ut,new it().setFromQuaternion(lr)))}if(t==="flip"||t==="right-to-left"){const G=yr(Xt,L);Xt.applyMatrix4(m),Xt.sub(a),Xt.reflect(l),Xt.add(a),Xt.applyMatrix4(y),Xt.normalize(),L.setFromAxisAngle(Xt,-G),R.applyMatrix4(m),R.sub(a),R.reflect(l),R.add(a),R.applyMatrix4(y),c.has(lt)&&i.history.setValue(c,lt,new it().setFromQuaternion(L)),c.has(Ut)&&(b?lr.multiplyQuaternions(b,L):lr.copy(L),i.history.setValue(c,Ut,new it().setFromQuaternion(lr)))}const z=new ve().compose(x,w,T);z.multiplyMatrices(d,z);const S=new ve().copy(z).invert(),B=new ve().compose(R,L,W);B.multiplyMatrices(v,B);const ne=new ve().copy(B).invert();let K,ie;for(let G of c.children){const se=o(G,g);if(se){const{rotationLeft:q,rotationRight:U}=r(a,l,G,P,z,S,K,se,k,B,ne,ie);K=new Be().copy(q).invert(),ie=new Be().copy(U).invert()}}return{rotationLeft:w,rotationRight:L}}h(r,"processMirrorNode"),xf(r,"processMirrorNode");function o(a,l){var d;if(a.type==="IKNode"&&((d=a.parent)==null?void 0:d.id)===l.id)return null;const c=a.has(Ue)?a.value(Ue):null;if(a.has(_n)){for(let f of l.children)if(a.id!==f.id&&a.type===f.type&&(a.instanceId===f.id||a.instanceId===f.instanceId)&&(!c||u(c,f.value(Ue))))return f}else for(let f of l.children)if(a.id!==f.id&&a.type===f.type&&f.has(_n)&&(f.instanceId===a.id||f.instanceId===a.instanceId)&&(!c||u(c,f.value(Ue))))return f;return null;function u(f,p){return Math.abs(f.x-p.x)<1e-8&&Math.abs(f.y-p.y)<1e-8&&Math.abs(f.z+p.z)<1e-8}}h(o,"findMirrorNode"),xf(o,"findMirrorNode")}h(KC,"flipNode");xf(KC,"flipNode");var SG=Object.defineProperty,CG=h((i,e)=>SG(i,"name",{value:e,configurable:!0}),"__name$6");const qC=2016834916,ZC=2,ef=new DataView(new ArrayBuffer(8));class iy{constructor(){C(this,"buffer",new Uint8Array(64));C(this,"size",0)}expandCapacity(e){const t=e+this.size;if(this.buffer.length<t){const n=new Uint8Array(Math.pow(2,Math.ceil(Math.log2(t))));for(let s=0,r=this.size;s<r;++s)n[s]=this.buffer[s];this.buffer=n}}writeUint32(e){this.expandCapacity(4),ef.setUint32(0,e);for(let t=0;t<4;++t)this.buffer[this.size+t]=ef.getUint8(t);this.size+=4}writeFloat64(e){this.expandCapacity(8),ef.setFloat64(0,e);for(let t=0;t<8;++t)this.buffer[this.size+t]=ef.getUint8(t);this.size+=8}writeBoolean(e){this.writeUint32(e?1:0)}writeString(e){const n=new TextEncoder().encode(e);this.writeUint32(n.length),this.expandCapacity(n.length);for(let s=0,r=n.length;s<r;++s)this.buffer[this.size+s]=n[s];this.size+=n.length}writeBytes(e){this.writeUint32(e.length),this.expandCapacity(e.length);for(let t=0,n=e.length;t<n;++t)this.buffer[this.size+t]=e[t];this.size+=e.length}writeNumberArray(e){this.writeUint32(e.length);for(let t of e)this.writeFloat64(t)}write(e){e=e.readonlyRef(),this.writeUint32(qC),this.writeUint32(ZC);for(let n of e.views)this.writeFloat64(n.zoomLevel),this.writeFloat64(n.camera.alpha),this.writeFloat64(n.camera.beta),this.writeFloat64(n.camera.target.x),this.writeFloat64(n.camera.target.y),this.writeFloat64(n.camera.target.z),this.writeBoolean(n.index===e.mainViewIndex?e.model.cameraPerspective:n.camera.perspective),this.writeFloat64(n.camera.perspectiveCamera.fov);const t=e.model;this.writeUint32(t.cameras.length);for(let n of t.cameras)this.writeString(n.name),this.writeFloat64(n.zoomLevel),this.writeFloat64(n.alpha),this.writeFloat64(n.beta),this.writeFloat64(n.target[0]),this.writeFloat64(n.target[1]),this.writeFloat64(n.target[2]),this.writeBoolean(n.perspective),this.writeFloat64(n.fov);return e.model.forEach(n=>{var r;this.writeUint32(n.id),this.writeString(n.type),this.writeBoolean(n.expanded),this.writeUint32(((r=n.parent)==null?void 0:r.id)||0),this.writeUint32(n.instanceId);const s=[];for(let o in n.components){const a=n.components[o],l=vi(o);if(l.storable){if(n.instanceId&&!l.instanceable)continue;const c=l.serialize?l.serialize(a.value):a.value;c!=null&&s.push([l.dataType,o,c])}}this.writeUint32(s.length);for(let o of s){const a=o[0],l=o[1],c=o[2];switch(this.writeUint32(a),this.writeString(l.substring(1)),a){case $e.NUMBER:this.writeFloat64(c);break;case $e.STRING:this.writeString(c);break;case $e.BOOLEAN:this.writeBoolean(c);break;case $e.NUMBER_ARRAY:this.writeNumberArray(c);break;case $e.BYTES:this.writeBytes(c);break;default:throw new Error(`Unimplemented data type of component [${l}]`)}}}),this}getBytes(){return this.buffer.subarray(0,this.size)}}h(iy,"ProjectWriter");CG(iy,"ProjectWriter");var TG=Object.defineProperty,EG=h((i,e)=>TG(i,"name",{value:e,configurable:!0}),"__name$5");const tf=new DataView(new ArrayBuffer(8));class zp{constructor(e){C(this,"buffer");C(this,"index",0);this.buffer=e}end(){return this.index>=this.buffer.length}readUint32(){for(let t=0;t<4;++t)tf.setUint8(t,this.buffer[this.index+t]);const e=tf.getUint32(0);return this.index+=4,e}readFloat64(){for(let t=0;t<8;++t)tf.setUint8(t,this.buffer[this.index+t]);const e=tf.getFloat64(0);return this.index+=8,e}readBoolean(){return!!this.readUint32()}readString(){const e=new TextDecoder,t=this.readUint32(),n=this.buffer.subarray(this.index,this.index+t),s=e.decode(n);return this.index+=t,s}readBytes(){const e=this.readUint32(),t=this.buffer.subarray(this.index,this.index+e);return this.index+=e,t}readNumberArray(){const e=this.readUint32(),t=[];for(let n=0;n<e;++n)t.push(this.readFloat64());return t}read(){if(this.readUint32()!==qC)throw new Error("Failed to read magic header");const t=this.readUint32();if(t>ZC)throw new Error("Unknown file version");const n={views:[],cameras:[],nodes:[]};for(let s=0;s<4;++s){const r=this.readFloat64(),o=this.readFloat64(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),u=this.readFloat64();let d=s===1,f=45;t>=2&&(d=this.readBoolean(),f=this.readFloat64()),n.views.push({zoomLevel:r,alpha:o,beta:a,target:[l,c,u],perspective:d,fov:f})}if(t>=2){const s=this.readUint32();for(let r=0;r<s;++r){const o=this.readString(),a=this.readFloat64(),l=this.readFloat64(),c=this.readFloat64(),u=this.readFloat64(),d=this.readFloat64(),f=this.readFloat64(),p=this.readBoolean(),g=this.readFloat64();n.cameras.push({name:o,zoomLevel:a,alpha:l,beta:c,target:[u,d,f],perspective:p,fov:g})}}for(;!this.end();){const s=this.readUint32(),r=this.readString(),o=this.readBoolean(),a=this.readUint32(),l=this.readUint32(),c=this.readUint32(),u={};for(let d=0;d<c;++d){const f=this.readUint32(),p="C"+this.readString();let g;switch(f){case $e.NUMBER:g=this.readFloat64();break;case $e.STRING:g=this.readString();break;case $e.BOOLEAN:g=this.readBoolean();break;case $e.NUMBER_ARRAY:g=this.readNumberArray();break;case $e.BYTES:g=this.readBytes();break;default:throw new Error(`Unimplemented data type [${f}]`)}if(WA(p)){const m=vi(p);m.deserialize&&(g=m.deserialize(g)),u[p]=g}}n.nodes.push({id:s,type:r,expanded:o,parentId:a,instanceId:l,data:u})}return n}}h(zp,"ProjectReader");EG(zp,"ProjectReader");var PG=Object.defineProperty,RG=h((i,e)=>PG(i,"name",{value:e,configurable:!0}),"__name$4");async function QC(i,e,t){let n=null;try{[n]=await showOpenFilePicker({types:[t],multiple:!1})}catch{return}try{i.statusBarMessage="Loading...",e.value=!0,await Qi();const s=await n.getFile(),r=new zp(new Uint8Array(await s.arrayBuffer())).read(),o={};let a=i.history.getNextNodeId()+1;for(let u of r.nodes)o[u.id]=a++;const l={};for(let u of r.nodes)l[u.id]={originId:u.id,type:u.type,data:u.data,expanded:u.expanded,instanceId:u.instanceId?o[u.instanceId]:0};const c=[];for(let u of r.nodes)if(u.parentId){const d=l[u.parentId];d.children=d.children||[],d.children.push(l[u.id])}else c.push(l[u.id]);for(let u of c)i.history.createNode(u);focus(),i.statusBarMessage=""}catch(s){console.error(s),i.statusBarMessage="Failed to import file."}finally{e.value=!1}}h(QC,"importModel");RG(QC,"importModel");var IG=Object.defineProperty,DG=h((i,e)=>IG(i,"name",{value:e,configurable:!0}),"__name$3");const tu=new A,nf=new A,sf=new A,mx=new A,gx=new A,vx=new A,rf=new A,gg=new A,vg=new A,yx=new A,of=new A,_x=new A,yg=new A,_g=new A(1,0,0);function JC(i,e,t,n,s=.005){const r=Math.max(n.max.x-n.min.x,n.max.y-n.min.y,n.max.z-n.min.z),o=r/(Math.ceil(r/s)+.5),a=1/o,l=i.length/9,c=n.min.x-o,u=n.min.y-o,d=n.min.z-o,f=n.max.x+o,p=n.max.y+o,g=n.max.z+o,m=Math.floor(c*a),v=Math.floor(u*a),y=Math.floor(d*a),b=Math.ceil(f*a),_=Math.ceil(p*a),x=Math.ceil(g*a),w=b-m,T=_-v,P=x-y,M=w*T*P,R=new Float32Array(M),L=new Float32Array(M*3);for(let U=0;U<M;++U)R[U]=o;const W=new Hs(M),k=new Hs(M*3);for(let U=0;U<l;++U){const le=t[U*6]-o,ae=t[U*6+1]-o,J=t[U*6+2]-o,te=t[U*6+3]+o,me=t[U*6+4]+o,de=t[U*6+5]+o,be=Math.floor(le*a),we=Math.floor(ae*a),Ae=Math.floor(J*a),V=Math.ceil(te*a),X=Math.ceil(me*a),E=Math.ceil(de*a),ee=V-be,Q=X-we,F=E-Ae;tu.fromArray(i,U*9),nf.fromArray(i,U*9+3),sf.fromArray(i,U*9+6),mx.fromArray(e,U*9),gx.fromArray(e,U*9+3),vx.fromArray(e,U*9+6),rf.addVectors(mx,gx).add(vx).multiplyScalar(1/3),gg.subVectors(nf,tu),vg.subVectors(sf,tu),yx.subVectors(sf,nf);for(let O=0;O<ee;++O){const j=O+be-m,N=c+j*o;for(let $=0;$<Q;++$){const I=$+we-v,D=u+I*o;for(let H=0;H<F;++H){const Z=H+Ae-y,re=d+Z*o,ue=j*T*P+I*P+Z;of.set(N,D,re),o4(_x,of,tu,nf,sf,gg,vg,yx),yg.subVectors(_x,of);const ge=yg.length();if(!(ge>o)){W.set(ue),ge<=R[ue]&&(R[ue]=ge,L[ue*3]=rf.x,L[ue*3+1]=rf.y,L[ue*3+2]=rf.z);for(let xe=0;xe<3;++xe){const pe=yg.getComponent(xe);if(pe<0||pe>o)continue;const Oe=ue*3+xe;if(k.get(Oe))continue;_g.set(0,0,0),_g.setComponent(xe,1);const Ge=a4(of,_g,tu,gg,vg);Ge<0||Ge>o||k.set(Oe)}}}}}}const z=new Hs(R.length),S=[0],B=T*P,ne=P,K=1,ie=[-B,+B,-ne,+ne,-K,+K],G=[0,0,1,1,2,2];for(;S.length;){const U=S.pop();if(U==null)break;if(W.get(U)){let le=!1;for(let ae=0;ae<6;++ae){const J=ie[ae],te=U+J;te<0||te>=M||z.get(te)||!W.get(te)||(k.get((J>0?U:te)*3+G[ae])?le=!0:(z.set(te),S.push(te)))}le&&z.set(U)}else{z.set(U);for(let le=0;le<6;++le){const ae=U+ie[le];ae<0||ae>=M||z.get(ae)||(z.set(ae),S.push(ae))}}}for(let U=0;U<M;++U)z.get(U)||(R[U]=-R[U]);const se=[],q=[];for(let U=0;U<w-1;++U){const le=c+U*o;for(let ae=0;ae<T-1;++ae){const J=u+ae*o;for(let te=0;te<P-1;++te){const me=d+te*o;F1(se,null,q,le,J,me,o,R,L,U*T*P+ae*P+te,(U+1)*T*P+ae*P+te,(U+1)*T*P+ae*P+(te+1),U*T*P+ae*P+(te+1),U*T*P+(ae+1)*P+te,(U+1)*T*P+(ae+1)*P+te,(U+1)*T*P+(ae+1)*P+(te+1),U*T*P+(ae+1)*P+(te+1))}}}return{position:new Float32Array(se),color:new Float32Array(q)}}h(JC,"voxelizeRemesh");DG(JC,"voxelizeRemesh");var LG=Object.defineProperty,kG=h((i,e)=>LG(i,"name",{value:e,configurable:!0}),"__name$2");async function eT(i,e,t,n){const s=await fetch(i);if(!s.body)throw new Error("Failed to get response body");const r=s.body.getReader();n||(n=Number.parseInt(s.headers.get("Content-Length")||"0"));let o=0;const a=[];for(;;){const{done:u,value:d}=await r.read();if(u||!d)break;if(a.push(d),o+=d.length,e(o,n),t!=null&&t.value)return await r.cancel(),r.releaseLock(),null}const l=new Uint8Array(o);let c=0;for(let u of a)l.set(u,c),c+=u.length;return l}h(eT,"progressiveDownload");kG(eT,"progressiveDownload");var OG=Object.defineProperty,NG=h((i,e)=>OG(i,"name",{value:e,configurable:!0}),"__name$1");const FG="gYxItIxQuvELUDHlN23TLnKHSMC47FjIJmWce1uK",zG=`https://sketchfab.com/oauth2/authorize/?response_type=token&client_id=${FG}`,bg="sketchfab-token",tT=vr({token:{accessToken:"",expires:0},user:{displayName:"",username:""},loadLocalStorage(){const i=localStorage.getItem(bg);if(!i)return;const e=JSON.parse(i);e.expires>Date.now()&&(this.token=e,this.getUser())},login(){window.location.replace(zG)},logout(){this.token={accessToken:"",expires:0},localStorage.removeItem(bg)},parseRouterPath(i){i=i||"",i.startsWith("/")&&(i=i.substring(1));const e=i.split("&"),t={accessToken:"",expires:0};for(let n of e){const s=n.split("=");if(s.length<2)continue;const r=s[0],o=s[1];switch(r){case"access_token":t.accessToken=o;break;case"expires_in":t.expires=Number.parseInt(o)*1e3+Date.now();break}}t.accessToken&&t.accessToken!==this.token.accessToken&&(this.token=t,localStorage.setItem(bg,JSON.stringify(t)),this.getUser())},async fetch(i,e="get"){return fetch(i,{method:e,headers:{Authorization:`Bearer ${this.token.accessToken}`},mode:"cors"})},async getUser(){const i=await this.fetch("https://api.sketchfab.com/v3/me");this.user=await i.json()},async getModelDownloadUrl(i){var r,o,a,l;const e=new URL(i).pathname.split("-"),t=e[e.length-1];if(!t)return;const n=await(await this.fetch(`https://api.sketchfab.com/v3/models/${t}/download`)).json(),s=await(await this.fetch(`https://api.sketchfab.com/v3/models/${t}`)).json();return{download:n,info:{name:s==null?void 0:s.name,url:s==null?void 0:s.viewerUrl,license:{name:(r=s==null?void 0:s.license)==null?void 0:r.label,url:(o=s==null?void 0:s.license)==null?void 0:o.url},user:{name:(a=s==null?void 0:s.user)==null?void 0:a.displayName,url:(l=s==null?void 0:s.user)==null?void 0:l.profileUrl}}}}});tT.loadLocalStorage();function nT(){return tT}h(nT,"useSketchfabClient");NG(nT,"useSketchfabClient");var BG=Object.defineProperty,ut=h((i,e)=>BG(i,"name",{value:e,configurable:!0}),"__name");const p0=".doll",wg={description:"Model",accept:{"application/figure-doll-editor":[p0]}},bx="figure-doll-editor-options";var UG=Rt({components:{ColorPicker:OA,FullscreenLoading:gN,InputBoolean:Ta,InputNumber:Rr,LabelRange:NN,ModelNodeProperties:KV,ModelTree:mH,PopupDialog:kp,PopupMenu:g1,PopupMenuItem:PC,QuadView:BH,SidePanel:jH},setup(){const i=HP(),e=nT(),t=ze(),n=ze(),s=new e1(function(){var N;(N=n.value)==null||N.update()}),r=ze({showTools:!0,showModelTree:!0,showProperties:!0,showStatusBar:!0,modelTreePanelWidth:200,modelNodePropertiesPanelWidth:200,colorPanelX:250,colorPanelY:50}),o=ze(!1),a=ze(null);let l=null;const c=Je(function(){var $;const N=($=n.value)==null?void 0:$.model;return N?N.selected.length===0?YS.filter(I=>!I.canBeRoot||!I.showInList?!1:I.unique?!N.nodes.find(D=>D.type===I.name):!0):N.selected.length>1?[]:y1(N.getSelectedNodes()[0]).filter(I=>I.showInList):[]}),u=Je(function(){var $;const N=($=n.value)==null?void 0:$.model;return N?N.getSelectedNodes().filter(I=>!jn(I.type).fixed).length:!1});mi([a,()=>{var N,$;return($=(N=n.value)==null?void 0:N.history)==null?void 0:$.dirty}],function([N,$]){N&&N.endsWith(p0)&&(N=N.substring(0,N.length-p0.length)),document.title=(N||"Untitled")+($?"*":"")+" - Figure Doll Editor"},{immediate:!0}),mi([r,()=>{var N;return(N=n.value)==null?void 0:N.options}],function(){var N;localStorage.setItem(bx,JSON.stringify({ui:r.value,options:(N=n.value)==null?void 0:N.options}))},{deep:!0}),rp(async function(){"showOpenFilePicker"in window||await bf(`This application is only available in Chrome or Edge.
Cannot open or save files in the current browser.`),e.parseRouterPath(i.currentRoute.value.fullPath),i.currentRoute.value.fullPath.length>1&&await i.push("/")});function d(){var N;(N=t.value)==null||N.focus()}h(d,"focus"),ut(d,"focus");function f(N,$,I,D,H){n.value=new wh(N,$,I,D,H);try{const Z=localStorage.getItem(bx);if(Z){const re=JSON.parse(Z);if("ui"in re&&Object.assign(r.value,re.ui),"options"in re){Object.assign(n.value.options,re.options);for(let ue in n.value.options.tools){const ge=n.value.options.tools[ue],xe=n.value.tools.find(pe=>pe.constructor.name===ue);if(xe)for(let pe in ge)xe[pe]=ge[pe]}}}}catch(Z){console.error(Z)}s.start(),window.ctx=n.value.readonlyRef()}h(f,"onCanvasMounted"),ut(f,"onCanvasMounted");function p(){var N;(N=n.value)==null||N.dispose(),n.value=void 0}h(p,"onBeforeCanvasUnmount"),ut(p,"onBeforeCanvasUnmount");function g(N){var $;(($=N==null?void 0:N.target)==null?void 0:$.tagName)!=="INPUT"&&(n.value.history.undo(),d())}h(g,"onUndo"),ut(g,"onUndo");function m(N){var $;(($=N==null?void 0:N.target)==null?void 0:$.tagName)!=="INPUT"&&(n.value.history.redo(),d())}h(m,"onRedo"),ut(m,"onRedo");async function v(){return n.value.history.dirty?await RC(`Unsaved changes will be lost.
Are you sure you want to continue?`):!0}h(v,"historyConfirm"),ut(v,"historyConfirm");async function y(){await v()&&(a.value=null,l=null,n.value.reset(),d(),n.value.statusBarMessage="")}h(y,"onNew"),ut(y,"onNew");async function b(){try{[l]=await showOpenFilePicker({types:[wg],multiple:!1})}catch{return}if(await v())try{n.value.statusBarMessage="Loading...",o.value=!0,await Qi();const N=await l.getFile();a.value=N.name;const $=new zp(new Uint8Array(await N.arrayBuffer())).read();n.value.load($),d(),n.value.statusBarMessage=""}catch(N){console.error(N),n.value.statusBarMessage="Failed to open file."}finally{o.value=!1}}h(b,"onOpen"),ut(b,"onOpen");async function _(){await QC(n.value,o,wg)}h(_,"onImport"),ut(_,"onImport");async function x(N){await YC(n.value,o,N)}h(x,"onExport"),ut(x,"onExport");async function w(N){N!=null&&N.shiftKey?await T():(l?await P():await T(),d())}h(w,"onSave"),ut(w,"onSave");async function T(){try{l=await showSaveFilePicker({types:[wg],suggestedName:a.value||void 0})}catch{return}const N=await l.getFile();a.value=N.name,await P(),d()}h(T,"onSaveAs"),ut(T,"onSaveAs");async function P(){if(!!l)try{n.value.statusBarMessage="Saving...",o.value=!0,await Qi();const N=await l.createWritable({keepExistingData:!1}),$=new iy().write(n.value).getBytes();n.value.statusBarMessage="Writing files...",await Qi(),await N.write($),await N.close(),n.value.history.save(),n.value.statusBarMessage="File saved."}catch{n.value.statusBarMessage="Failed to save file."}finally{o.value=!1}}h(P,"saveFile"),ut(P,"saveFile");function M(N){const $=n.value,D=$.views[$.mainViewIndex].camera;let H=D.alpha,Z=D.beta;switch(N){case"front":H=0,Z=-Math.PI/2,Math.abs(H-D.alpha)<1e-8&&Math.abs(Z-D.beta)<1e-8&&(H=0,Z=+Math.PI/2);break;case"back":H=0,Z=+Math.PI/2,Math.abs(H-D.alpha)<1e-8&&Math.abs(Z-D.beta)<1e-8&&(H=0,Z=-Math.PI/2);break;case"top":H=-Math.PI/2,Z=-Math.PI/2,Math.abs(H-D.alpha)<1e-8&&Math.abs(Z-D.beta)<1e-8&&(H=+Math.PI/2,Z=-Math.PI/2);break;case"bottom":H=+Math.PI/2,Z=-Math.PI/2,Math.abs(H-D.alpha)<1e-8&&Math.abs(Z-D.beta)<1e-8&&(H=-Math.PI/2,Z=-Math.PI/2);break;case"right":H=0,Z=0,Math.abs(H-D.alpha)<1e-8&&Math.abs(Z-D.beta)<1e-8&&(H=0,Z=Math.PI);break;case"left":H=0,Z=Math.PI,Math.abs(H-D.alpha)<1e-8&&Math.abs(Z-D.beta)<1e-8&&(H=0,Z=0);break}const re=H-D.alpha,ue=Z-D.beta;kA(function(ge){D.alpha=H-re*(1-ge),D.beta=Z-ue*(1-ge)},100)}h(M,"onSetView"),ut(M,"onSetView");function R(N,$,I){n.value.history.setValue(N,$,I)}h(R,"onSetValue"),ut(R,"onSetValue");function L(N,$){N=qe(N);const I=n.value;let H=qe(I.model).getSelectedNodes();const Z=$==="before"||$==="after"?N.parent:N;H=H.filter(ue=>{let ge=!0,xe=ue.parent;for(;ge&&xe;){if(!xe.expanded){ge=!1;break}xe=xe.parent}return!ge||ue.parent&&H.includes(ue.parent)?!1:!jn(ue.type).fixed});for(let ue of H)if(!re(Z,ue))return;for(let ue of H){const ge=I.options.keepTransformUnchangedWhileMoving;$==="before"||$==="after"?I.history.moveNode(ue,Z,N,$==="after",ge):I.history.moveNode(ue,Z,null,$==="atLast",ge)}function re(ue,ge){const xe=jn(ge.type);if(!ue)return xe.canBeRoot;if(!ue.isValidChild(ge.type))return!1;for(;ue;ue=ue.parent)if(ue.id===ge.id)return!1;return!0}h(re,"isValidChild"),ut(re,"isValidChild")}h(L,"onMoveNode"),ut(L,"onMoveNode");function W(N){const $=n.value.model,I=$.selected[0];$.selected=[];const D={type:N,parentId:I},H=jn(N);H.defaultData&&(D.data=H.defaultData),H.defaultChildren&&(D.children=H.defaultChildren),n.value.history.createNode(D),d()}h(W,"onAddNode"),ut(W,"onAddNode");function k(N){var D;if((N==null?void 0:N.key)==="Backspace"||((D=N==null?void 0:N.target)==null?void 0:D.tagName)==="INPUT"||!n.value.tool.enableDefaultDeleteShortcut&&(N==null?void 0:N.key)==="Delete")return;const I=n.value.model.getTopmostSelectedNodes();for(let H of I)jn(H.type).fixed||n.value.history.removeNode(H.id);d()}h(k,"onDelete"),ut(k,"onDelete");function z(N){n.value.nextFrameEnd(function(){n.value.model.selected=N})}h(z,"onSelect"),ut(z,"onSelect");function S(N){const $=new Set;for(let I of N){let D=I.node;D.instanceId&&(vi(I.type.name).instanceable||(D=n.value.model.getNode(D.instanceId)));const H=`${D.id}#${I.type.name}`;$.has(H)||($.add(H),n.value.history.setValue(D,I.type,I.value))}}h(S,"onSetNodesProperties"),ut(S,"onSetNodesProperties");function B(N){if(!N)return;const $=new A;if(Ea($,N.getWorldMatrix()),N.has(Ce)){const I=N.value(Ce);if(I){const D=I.geometry;D&&(D.boundingSphere||D.computeBoundingSphere(),$.copy(D.boundingSphere.center),$.applyMatrix4(N.getWorldMatrix()))}}for(let I of n.value.views)I.camera.target.copy($)}h(B,"onFocus"),ut(B,"onFocus");async function ne(N){await IC(n.value,N)&&d()}h(ne,"onCut"),ut(ne,"onCut");async function K(N){await ny(n.value,N)&&d()}h(K,"onCopy"),ut(K,"onCopy");async function ie(N){await DC(n.value,N)&&d()}h(ie,"onPaste"),ut(ie,"onPaste");function G(N){LC(n.value,N)}h(G,"onConvertToClay"),ut(G,"onConvertToClay");function se(N){N=qe(N);const $=n.value,I=N.getLocalMatrix(),D=N.cloneValue(an),H=new A;for(let Z=0,re=D.length;Z<re;Z+=3)H.fromArray(D,Z),H.applyMatrix4(I),D[Z]=H.x,D[Z+1]=H.y,D[Z+2]=H.z;$.history.setValue(N,an,D),$.history.setValue(N,Ue,new A),$.history.setValue(N,lt,new it),$.history.setValue(N,Ft,1)}h(se,"onApplyTransformation"),ut(se,"onApplyTransformation");const q=Je(function(){const N=n.value;if(!N)return!1;const $=N.model.selected[0];return $?N.model.getNode($).type==="Clay":!1});async function U(){var Z;const N=(Z=n.value)==null?void 0:Z.readonlyRef();if(!N)return;const $=N.model.selected[0];if(!$)return;const I=N.model.getNode($),H=I.get(Ce).mesh;if(!!H)try{o.value=!0,await Qi(),await new Promise(function(ue){setTimeout(ue,50)});const re=JC(H.aPosition,H.aColor,H.triBox,H.octree.box,N.options.remeshVoxelSize);N.history.enableMerge=!1,N.history.setValue(I,an,re.position,"remesh-position"),N.history.setValue(I,bs,re.color,"remesh-color")}finally{o.value=!1}}h(U,"onRemesh"),ut(U,"onRemesh");function le(N,$){FC(n.value,N,$)}h(le,"onCreateInstance"),ut(le,"onCreateInstance");function ae(N,$){KC(n.value,N,$)}h(ae,"onFlip"),ut(ae,"onFlip");function J(N){return kC(N)}h(J,"onCopyPose"),ut(J,"onCopyPose");function te(N){return OC(n.value,N)}h(te,"onPastePose"),ut(te,"onPastePose");function me(N){const $=n.value,I=$.model,D=$.views[$.mainViewIndex];D.zoomLevel=N.zoomLevel,D.camera.alpha=N.alpha,D.camera.beta=N.beta,D.camera.target.set(N.target[0],N.target[1],N.target[2]),I.cameraPerspective=N.perspective,I.cameraFov=N.fov}h(me,"onLoadCamera"),ut(me,"onLoadCamera");function de(N){n.value.model.cameras.splice(N,1),n.value.history.dirty=!0}h(de,"onDeleteCamera"),ut(de,"onDeleteCamera");function be(){const N=n.value,$=N.model,I=N.views[N.mainViewIndex];$.cameras.push({name:new Date().toISOString().replace("T"," ").replace(/\.[0-9]+Z/,""),zoomLevel:I.zoomLevel,alpha:I.camera.alpha,beta:I.camera.beta,target:[I.camera.target.x,I.camera.target.y,I.camera.target.z],perspective:$.cameraPerspective,fov:$.cameraFov}),N.history.dirty=!0}h(be,"onSaveCamera"),ut(be,"onSaveCamera");const we=ze("");async function Ae(){await v()&&e.login()}h(Ae,"onSketchfabLogin"),ut(Ae,"onSketchfabLogin");function V(){e.logout()}h(V,"onSketchfabLogout"),ut(V,"onSketchfabLogout");const X=ze(!1),E=ze(""),ee=ze(""),Q=ze(!1),F=ze(0);async function O(){var N;if(!!we.value)try{n.value.statusBarMessage="Fetching model download url...",o.value=!0;const{info:$,download:I}=await e.getModelDownloadUrl(we.value);if((N=I.gltf)!=null&&N.url){we.value="",n.value.statusBarMessage="Downloading model...",o.value=!1,X.value=!0,Q.value=!1,F.value=0,E.value="0.0MB",ee.value=(I.gltf.size/1024/1024).toFixed(1)+"MB";const D=await eT(I.gltf.url,(H,Z)=>{F.value=Math.round(H/Z*100),E.value=(H/1024/1024).toFixed(1)+"MB"},Q,I.gltf.size);if(!D){n.value.statusBarMessage="Download canceled.";return}n.value.history.createNode({type:"ImportModel",data:{[Kt.name]:$.name,[Vu.name]:$,[Ar.name]:D}}),n.value.statusBarMessage="Model imported."}else n.value.statusBarMessage="Failed to download model.",I.detail?await bf("Could not download model: "+I.detail):await bf("Failed to get model download url.")}catch{n.value.statusBarMessage="Failed to import model."}finally{o.value=!1,X.value=!1}}h(O,"onSketchfabImportModel"),ut(O,"onSketchfabImportModel");function j(){window.open("https://github.com/x6ud/figure-doll-editor#download-models")}return h(j,"onOpenTutorial"),ut(j,"onOpenTutorial"),{dom:t,sketchfabClient:e,editorCtx:n,fullscreenLoading:o,uiOptions:r,validChildNodeDefs:c,canDelete:u,canRemesh:q,sketchfabModelUrl:we,downloadProgressDialog:X,downloadProgressText:E,downloadTotalText:ee,downloadCancelFlag:Q,downloadProgressPercent:F,onCanvasMounted:f,onBeforeCanvasUnmount:p,onUndo:g,onRedo:m,onNew:y,onOpen:b,onImport:_,onExport:x,onSave:w,onSaveAs:T,onSetView:M,onSetValue:R,onMoveNode:L,onAddNode:W,onDelete:k,onSelect:z,onSetNodesProperties:S,onFocus:B,onCut:ne,onCopy:K,onPaste:ie,onConvertToClay:G,onApplyTransformation:se,onRemesh:U,onCreateInstance:le,onFlip:ae,onCopyPose:J,onPastePose:te,onLoadCamera:me,onDeleteCamera:de,onSaveCamera:be,onSketchfabLogin:Ae,onSketchfabLogout:V,onSketchfabImportModel:O,onOpenTutorial:j}}}),VG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsSAAALEgHS3X78AAAAG3RFWHRTb2Z0d2FyZQBDZWxzeXMgU3R1ZGlvIFRvb2zBp+F8AAAPYElEQVR42u1be1RU1ff/nLkz4Ixo4AM1FTF8P6CwfKJo9FIyAzEUtbQkDTMrM7Ny3XXTwge4VktSVrpKMzHSJMon6nKVpqQpShhCKC41zRe+ZgCZuXf//vh9z133ztwZEOlbra9nrVlc7p17ztmfs/c+n733GUZE+F9u7B4A9wC4B8A9AP7qJkkSAUBoaCjMZjMAQFGU/58AY7q/AGAymeBwOFBZWQmHw4G5c+eyfyUAXPAOHTogICAAsiwjMTGRAUBubi6NGjXKQ7CcnBwqLCxE9+7dUVxcrHsmiiL7VwAwf/58uv/++9GqVSvIsgxFUVBYWOghwO7du2nfvn0AgKioKDidTvz888/q97799lsSBAEjR45kmZmZdPHixQYHoUEBWLRoEYWFhcFsNsPf3x8AIAgCTCYTBEFQPyaTCXl5eYiJiUFUVBTbv38/DRw40Ktg27dvJ7vdjuPHj8NisUAQBMyZM4f9YwD4/PPPyWw2w2w2o7S0FP3794efnx+GDRvGuBm4t+HDh8NisYCIwBiDy+UCEUFRFPWv9kNEkGUZjz/+OAOApUuX0ptvvsn+VgCWL19OZrMZL7/8siqoKIps586dZLPZsGvXLoiiyCRJIq66x44dIwAgIgiCACJCeHg4KywsJMYYevfuzbT+g7fHHnsMu3btQr9+/VSzOn36NARBQEpKCvuvA5CZmUkmk0kVngs6ePBg7N27FyNGjMAjjzzCAODXX38lPk54eDgDgJKSEuratSsDgBMnTlC3bt0YABw/fpwYY+jRo4dOe3h/2nvh4eFQFAUVFRVITk5m/zUAFi9eTK1bt0Z5ebnufnR0NIYOHcokSaL4+Hj1/qZNmzyc1++//06dO3dmAFBWVkadOnXSrfxzzz0Hxhg4MMeOHaOIiAidNvHr7OxsIiI4nU5MnDiR/aUALFiwgNq0aYOAgACcOHFC3Z727t1LgwcPVoXnDq9r1666SQPA6dOnKTQ0lGm3y0mTJmH16tUeQJWWlhIAyLIMl8sFp9MJp9OJmpoa1NTU4Pbt26ipqcGzzz7L1q9fT+PGjfvrAOCrExISgsDAQMTFxTEA+Omnn2jQoEE6O+YqfurUKXrggQfUSZ07d47atWunU2VRFBm/7z5meXk5cUfYuXNnDzC1c+vduzcqKiowZcoU1uAAaCccGhqKFi1aIDY2lh04cIAGDBjACgsLidu3Vq0lSaKXXnoJXOjk5GSsXLnSY6X//PNPat26tXrv/PnzJMsy2rdvb9in+/tbt26lQ4cOAQCCg4PxyiuvsAYHQBRF9uWXX9KECRPYzp07qWnTpujXrx/j9qn9PldzDtzUqVMhCIJKe7XUt3nz5gwArly5QnwLbNWqlaEAZWVltG7dOkNSFRMTo/qGoKAgvPbaa6xBANAinpWVRe3atcOQIUNYQUEBMcbw4IMPegx09uxZ+uyzz1QVv3r1KjVv3pxVVFRQs2bNdPY/Y8YM9T0+n4yMDK/zGT9+PNxB4D5I22/jxo3x1ltvsQYDIDs7mxITE1l+fj75+fkhMjKSeTMVruocAK3gN27coPvuu8/j3evXr1NgYKBOGzgowcHBOr/BQeDtqaeewvbt2z3m7u/vj3feeYfdFQCpqak0d+5ctmHDBhozZgw7fPgw9enThxkJzlfl4sWL1KpVK9VetcIBwK1bt6hJkyYeE3O/rzUhbh6rVq2CKIpMu30WFBTQQw89pOtvxYoVZLfbUV1djXnz5rF6A5Cenk4dO3ZEfHw8O3jwIFksFnDq+/XXX3tEapIk0fTp09GiRQsGADdv3qSmTZt6TKCyspJsNpvuvsPhoMaNGzN3QN3Ni4PhdDqRlZWF0aNHo1evXmzPnj3kcDhgt9sxduxYlp6eTna73WsQVScAli1bRu3atUObNm3Qv39/da/v3bs3O3nyJIWFhTF3c9GqvLfVBoDq6mpq1KiR6rxmz56NJUuWeJ2w+w5w8uRJ4nGC3W6Hu2ZmZGTQ1atX6w/AypUrKTk5meXm5lJwcDDy8vIgiiL77bffqEePHoyvSPv27XXbE1d5u91O6enpPsPY27dv08KFCyGKItMCUhsA586dI5fLhdDQUFZSUkJfffWVhzZ++umndOHChfoDsGbNGmrWrBmCgoIQFRWldqLl8nwfFwQBLVu21Km9w+GgtLQ0jwm4EyGn00kWi4VxQPz9/b1qQEpKCmRZhpY3aGMKLUhr1qyh06dP1x+A9evXU9u2bTFkyBCPDrj6awe8du0aBQUFMbvdTiaTCTabzYO/e7Ntl8tFZrOZ1dTUkJ+fn8fzGzdukKIoCAoKMhSmuLiYunfvrhuna9euGDt2rFcGWSsA27ZtI6vViqFDhxrS1I4dO3p0fuvWLRIEAYwxWK1WD9rrazyXy0VEBK4NAFBVVUWKooA7R199HD9+nHr27Mk0gRjFx8fXD4DNmzeT1WoFZ1hG7cyZMxQSEuLxvKqqijjjM5lMKvszSoJ+8MEHunfff/99EJG67WnNoTYAioqKqFevXgwAtmzZQrGxsT53FJ8A5OXl0YEDB7yunCRJNGXKFLRt29bDvt9++20sXrwYc+fORWpqqs+VJ80kuOD8mmeDFi5cWOegLS4uDjk5ORg4cCD279/vM6nqE4Dt27eTv78/fvzxR0MnJooiu3DhArVp08bDvqurq2nRokUQRZG5XC5ijEEQhDpHabIsE/8+B1RRFDUbJMuyGkMYtaNHj9KNGzcQHR3N0tLSyOFw3DkAW7ZsIavVCn9/f5jNZvTr148ZqeHFixcpMzNTN4AWAP59RVHIZDLVCQRFUWj+/Pm6lTMaV5ZlNVcgyzK0zLCqqgrnz59HQkJC/XzA999/T0eOHMGwYcPU4Oe7776Du0dPSUlRtz9u/4sXL/Zgh//5nw/oc6+fN28e3MEyEsLdvouLi8nlcqmAPPzww8yX7/AKQE5ODsXFxTFJkigmJga7d+8GACQkJGDjxo26lbly5Qpx2lsHAFRzdwdBK4yRtvhygNpnRUVF5HK5UFNTg759+9bPCW7cuJG0qnPgwAHKy8sDACQlJUEQBGgzPVrqa8TxvUxeBcHouRaE2rw/zxW4XC41j5ifn0+culssFrz77rt1B4CHvtqM7/Dhw9G3b1+mDUp4xoYTICPhaxHAq0m4O0JvAJw9e5ZkWYY2ASOKolpwSU9Pp1mzZt0ZE8zKyqKkpCQdALGxsapNGaWyrl+/ThaLBY0bN64VAAO19DCJ2gC4dOkSybIMvgsZjbd37146evQoZsyYcWcArF27liZOnOhR2XnmmWfgHndfuXKFtOWvgIAArxPyZY+cD7D/sCROjd0BuH79OimKAm1myZtfiI6ORklJCaZOnVp3AFavXk2TJk3y2NslSaJRo0YZpsB4AMQYg1Ho661E5t5EUWR85XmAxIW32+1ERGjSpAmra39RUVE4c+YMJk+efHcaoF09ngtwF/D111+HyWRSqa87BXanwwYagAULFgAA3nvvPSiKgtTUVMyZMweKomDJkiV3VCqXJIkGDBiAy5cvY/z48XcGQGZmJgUFBcFsNqOoqEhHaCRJooSEBPCgwyjt5XA4CIDqD3ypvrvdczqsjQe0DJDv8S6XC0a1BO2ctm3bRna7HWPGjLkzAD755BOaPn06W7duHTVt2hQjR47UsSltQkSbBVq2bJluhSorKwmAunp1re/zPt0TJO7OsLy8nHi1yP1TU1MDp9MJRVHw9NNP3xkAH3/8Mc2cOZPx3WDHjh2Un5+vY4GJiYnIzs5WtUObBzQKjnhoXBsI2u944xS+wOTv79ixg1wuF2JjY+uXFeYJRZ5U2LNnDwmCoCZH3NNQly5douDgYK87QFVVFQGA1WplvqpPWpBnzZpluKv4osbR0dGQZRn79u1Dz549kZCQUD8AFi1aRNXV1RBFUU2JS5JETz75pJocHTduHLp06cKMyltGE+WJTyLS8QVvwrzxxhswyigbvZefn0+yLGPQoEHqWN26dVPPJd0xAB999BE5nU51Rb755hviDvHw4cO0efNmlRp37tyZ/fHHH+SeGzACgF/zbW3p0qVew233eoJRKygoIFmWsWXLFo/4o1OnTl53gFoBMLI1nmLiNXuTyYRGjRohKysLL774oq6Y6WtltbvKzZs3iYigrRYZpdfd+0hISICiKNi0aZPh9qjlM/WuDC1YsIAEQVDP6kmSRBERETh27JguBOXFEm3dv64hLG/Xrl0jRVGQkZGhPrt8+TItX75cN6ekpCQoiqKePdAKrx1v1apVVFupvM61QZvNhtmzZ6tn/I4ePaoToKysTJcD5EB4iwF8tZSUFHChp02bplaKy8vLiYjUKNSbafHrzMxMmjZt2t0DwDsNDAzEzJkzmSRJFBkZiZEjR+oEGzt2rFoCt1gsHmzQqDRuxAaJCCaTSb3mJKhDhw668R599FHdKZHbt2/rrokIr776asMAwAdt2bIlLl++DADo06ePjmBoU9JlZWVERMjKyjIkQL5OeoiiyM6fP09aAHiWR0tyeIrOvb8VK1aQLMu1Cl+vM0KSJFHbtm0hCAImT57MeOqZJyK1gZIkSZSUlKSupLaS5Ms5au+dOnWK1q5d62HfRvNq3749ZFnG1atXfZbE7woAPpjFYkFISAgmTJjAtm7dSiNGjGCHDh2irVu3eiQxud0nJiaCiKCt3nhLePJWWlpK69ev9xkErVu3jmRZxvPPP18npnnXAPAJ+/n5ISwsDAEBARgxYoSagfHm5fn9hIQENcjh54q8OUsedLmDCQA9evSAoig4ceJErRrS4ADwSfr7+6NLly6wWq2w2WyIjo5mdeHq/HrUqFFQFAWRkZGGJTRuVlrhcnNziR/Ads8l3KkMDXJWeOHChcQYQ0REBARB0FVj6tpiY2OhKIou5wgABw8epG3btoGHtoqiIDY2lnGafjfCNxgAfFWtVivCw8N9JkGMaoP8dCkAPPHEE+oBacYYoqKi2K5du0hRFFy6dAnV1dWoqqpCRUXFXQne4ABoQQgJCUFJSQkiIyN1J75Hjx5tuAv88MMPutogbyaTCbIso7KyEr/88gtqyyn+7QBoD1W88MILHpmgDRs2kBYQbZBi5AQjIyNx5MgRiKLIPvzwQ3K5XP/sH0xoW0ZGBjkcDmjt1N1hffHFF8RZ3rlz53QrHBYWhpMnT8Jms0GW5Trv6/8YAAAgLS2NjGze6J7NZlM1Q5Zl+Pn5weFwoCF+FPG3AfBvaPcAuAfAPQD+twH4PyYSYSaTaCiyAAAAAElFTkSuQmCC",HG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAZNJREFUOI3Fk79rU1EUxz/nvgZiqkMRgkKGDMlQCDRgXbpZgrSIQ5ZM/gHB3exFcLB0kQ6OLkIgW6wubdA2mTIEApVAoWPgpQ/E16bxx+u7xyHk0Te1kMEDl8s5XD7fc773XpgzRFXnAph5O5gbIMCLTCazk0wmbwUbj8cT13UPgS1VPQV43+v19DYxGo3U8zxtt9uay+V+AMsGEBGZ4v8GcHwK/hiCKzg+Af8iUi8Wi5N0Ov21Xq/TaDSWROTNQqy/tx/g+wnccWBpEUYu3EvCzmtIpQA8a+26iHyp1Wqb+Xz+SRzgDcG5hCCEMw9MCJMLOPdngMg7x3FIJBIJA2j0FjbWwEzA/ALzB+QKVh/Bg4cwPXhfRPaq1eqG7/sMBoOjhRhg8ylc/oRPzWm+UoTqy0i20+ncdRznmeu6lMtl31r7CmC32+3G7f68p7r7TjUIYuVSqWSz2ewZ8BHIz4S3W63WjVc4HA5VRPZVletLgMeFQuFbpVJJGWNms0a7tZYwDGk2m7/7/f5zVT2IufnfP9M/jW8Tm1+fCIsAAAAASUVORK5CYII=",GG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFBJREFUOI1jYBgF6OA/FFBsCDJNH0P+owGyDaGKS3BppqohuAxjwmUgIyMjIy4+0QYhA0YoICmqsXkNH5skw8gyBJ8GQobgDEB0jYQCe/ABAKCQl4Lg46L9AAAAAElFTkSuQmCC",WG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAFRJREFUOI3lkjsOACAIQ8V4/yvXCUIMH4kbdqWUl5Qx2oq8AQCky0Syv6IQbaweEZNn9uZkmSIxJQBo4pkiXqpxkFl/JK+QMhE3df5YuX4r5InoI21GkSwM7aEiTgAAAABJRU5ErkJggg==",jG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAC5JREFUOI1jYBgFwxT8////PyE1TNSyjGoGMeKSwOcdRkZGnPrwgqEZRqOAjgAAfNwMAvOaLCwAAAAASUVORK5CYII=",$G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAADBJREFUOI1jYBgFgwf8hwKKDcHGJtsQYgxjIsuWkWUQXkCVWEM2gGJDRgEDAwMDAwA87SfhU+Y3UgAAAABJRU5ErkJggg==",XG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAACJJREFUOI1jYBgFo2AQAUZcEv////+PUxMjI059o2AUUAIA4coEAgSS2PIAAAAASUVORK5CYII=",YG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAEVJREFUOI1jYBi2gBGf5P////+jKGZkxKseqwHohuATJ8oVxKphIsp0UgHRzsailmouGnwGYYDBFWvINpKaIGmbRYYHAAC8Mj/Vvda64QAAAABJRU5ErkJggg==",KG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAGFJREFUOI3dk0EOwCAIBMH0/19er4ILKqaHlqOsw6hR5LelWRMATFg1zNOGB0ybCLBVICwzgaplQCubzOodox2Ta1AGESHPz+7JQwDArz2V6VtGoxUziQYffZHQpnCCD1UHNO0sGtTVHO8AAAAASUVORK5CYII=";const _i=h(i=>(ba("data-v-381541ad"),i=i(),wa(),i),"_withScopeId"),qG={class:"toolbar"},ZG={class:"properties"},QG={class:"cols",style:{"align-items":"center","margin-bottom":"8px"}},JG={class:"cols",style:{"align-items":"center"}},eW=_i(()=>he("div",{class:"fill"},null,-1)),tW={style:{"margin-right":"4px"}},nW={class:"properties"},iW={class:"cols",style:{"align-items":"center","margin-bottom":"8px"}},sW=_i(()=>he("div",{style:{"margin-right":"4px"}},"FOV",-1)),rW={class:"camera-list"},oW={class:"item"},aW=["onClick"],lW=_i(()=>he("div",{class:"properties cols"},[he("div",null,[he("img",{src:VG,alt:""})]),he("div",{style:{padding:"4px 6px 4px 8px"}},[he("div",{style:{"margin-bottom":"6px"}},[he("span",{style:{"font-size":"16px","font-weight":"bold"}}," Figure Doll Editor "),fr(" Ver 20230220 ")]),he("div",{style:{"margin-bottom":"6px"}},"Author: x6udpngx"),he("div",{style:{"margin-bottom":"6px"}},[he("a",{href:"https://github.com/x6ud/figure-doll-editor",target:"_blank"}," Source ")]),he("div",null,[he("a",{href:"https://ko-fi.com/x6udpngx",target:"_blank"},[he("img",{src:HG,alt:"",style:{"vertical-align":"text-bottom"}}),fr(" Support Me on Ko-fi ")])])])],-1)),cW=_i(()=>he("div",{class:"separator"},null,-1)),uW=_i(()=>he("img",{src:GG,alt:""},null,-1)),hW=[uW],dW=_i(()=>he("img",{src:WG,alt:""},null,-1)),fW=[dW],pW={key:1,class:"button-group cols",style:{"margin-right":"6px"},title:"Direction"},mW=_i(()=>he("img",{src:jG,alt:""},null,-1)),gW=[mW],vW=_i(()=>he("img",{src:$G,alt:""},null,-1)),yW=[vW],_W=_i(()=>he("img",{src:XG,alt:""},null,-1)),bW=[_W],wW={class:"properties"},xW={class:"property inline"},MW=_i(()=>he("label",null,"Voxel size",-1)),AW=_i(()=>he("span",null,"\xA0m",-1)),SW=_i(()=>he("div",{class:"fill"},null,-1)),CW={class:"button-group cols"},TW=_i(()=>he("img",{src:YG,alt:""},null,-1)),EW=[TW],PW=_i(()=>he("img",{src:KG,alt:""},null,-1)),RW=[PW],IW={class:"cols fill"},DW={key:0,class:"tools scrollable"},LW={class:"scroll"},kW={key:0},OW={key:0},NW=["title","onClick"],FW=["src"],zW={key:0,class:"rows",style:{width:"100%",height:"100%"}},BW=["disabled"],UW={key:0,class:"status-bar cols"},VW=_i(()=>he("div",{class:"fill"},null,-1)),HW={class:"cols",style:{"align-items":"center"}},GW={class:"progress-bar",style:{width:"260px","margin-right":"4px"}},WW={class:"text"};function jW(i,e,t,n,s,r){var b,_,x;const o=qt("popup-menu-item"),a=qt("popup-menu"),l=qt("input-number"),c=qt("input-boolean"),u=qt("label-range"),d=qt("model-tree"),f=qt("side-panel"),p=qt("model-node-properties"),g=qt("quad-view"),m=qt("color-picker"),v=qt("popup-dialog"),y=qt("fullscreen-loading");return Se(),ke(At,null,[he("div",{class:"container rows",tabindex:"0",onKeydown:[e[42]||(e[42]=Sn(mn((...w)=>i.onUndo&&i.onUndo(...w),["ctrl"]),["z"])),e[43]||(e[43]=Sn(mn((...w)=>i.onRedo&&i.onRedo(...w),["ctrl"]),["y"])),e[44]||(e[44]=Sn(mn((...w)=>i.onOpen&&i.onOpen(...w),["ctrl","prevent"]),["o"])),e[45]||(e[45]=Sn(mn((...w)=>i.onSave&&i.onSave(...w),["ctrl","prevent"]),["s"])),e[46]||(e[46]=Sn(mn((...w)=>i.onCut&&i.onCut(...w),["ctrl"]),["x"])),e[47]||(e[47]=Sn(mn((...w)=>i.onCopy&&i.onCopy(...w),["ctrl"]),["c"])),e[48]||(e[48]=Sn(mn((...w)=>i.onPaste&&i.onPaste(...w),["ctrl"]),["v"])),e[49]||(e[49]=Sn((...w)=>i.onDelete&&i.onDelete(...w),["delete"]))],onContextmenu:e[50]||(e[50]=mn(()=>{},["prevent"])),ref:"dom"},[he("div",qG,[i.editorCtx?(Se(),ke(At,{key:0},[Pe(a,{title:"File"},{default:Ht(()=>[Pe(o,{title:"New",onClick:i.onNew},null,8,["onClick"]),Pe(o,{title:"Open",popup:"",hotkey:"Ctrl+O",onClick:i.onOpen},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Save",hotkey:"Ctrl+S",onClick:i.onSave},null,8,["onClick"]),Pe(o,{title:"Save As",popup:"",hotkey:"Shirt+Ctrl+S",onClick:i.onSaveAs},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Import",popup:"",onClick:i.onImport},null,8,["onClick"]),Pe(o,{title:"Export"},{default:Ht(()=>[Pe(a,null,{default:Ht(()=>[Pe(o,{title:"glTF 2.0 Binary (.glb)",popup:"",onClick:e[0]||(e[0]=w=>i.onExport("glb"))}),Pe(o,{title:"Wavefront (.obj)",popup:"",onClick:e[1]||(e[1]=w=>i.onExport("obj"))})]),_:1})]),_:1})]),_:1}),Pe(a,{title:"Edit"},{default:Ht(()=>[Pe(o,{title:"Undo",hotkey:"Ctrl+Z",onClick:i.onUndo},null,8,["onClick"]),Pe(o,{title:"Redo",hotkey:"Ctrl+Y",onClick:i.onRedo},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Cut",hotkey:"Ctrl+X",onClick:i.onCut},null,8,["onClick"]),Pe(o,{title:"Copy",hotkey:"Ctrl+C",onClick:i.onCopy},null,8,["onClick"]),Pe(o,{title:"Paste",hotkey:"Ctrl+V",onClick:i.onPaste},null,8,["onClick"]),Pe(o,{title:"Delete",hotkey:"Delete",onClick:i.onDelete},null,8,["onClick"]),Pe(o,{sep:""}),Pe(o,{title:"Move Nodes: Keep World Position Unchanged",onClick:e[2]||(e[2]=w=>i.editorCtx.options.keepTransformUnchangedWhileMoving=!i.editorCtx.options.keepTransformUnchangedWhileMoving),checked:i.editorCtx.options.keepTransformUnchangedWhileMoving},null,8,["checked"]),Pe(o,{sep:""}),Pe(o,{title:"Transform: Use Local Space For Controls",onClick:e[3]||(e[3]=w=>i.editorCtx.options.useLocalSpaceForTransformControl=!i.editorCtx.options.useLocalSpaceForTransformControl),checked:i.editorCtx.options.useLocalSpaceForTransformControl},null,8,["checked"]),Pe(o,{sep:""}),Pe(o,{title:"IK Bind: Allow Modification of Joint Length",onClick:e[4]||(e[4]=w=>i.editorCtx.options.allowModifyingBoneLengthWhenBindingIk=!i.editorCtx.options.allowModifyingBoneLengthWhenBindingIk),checked:i.editorCtx.options.allowModifyingBoneLengthWhenBindingIk},null,8,["checked"]),Pe(o,{title:"IK Bind: Keep Internal Object Position Unchanged",onClick:e[5]||(e[5]=w=>i.editorCtx.options.keepInternalTransformWhenBindingIk=!i.editorCtx.options.keepInternalTransformWhenBindingIk),checked:i.editorCtx.options.keepInternalTransformWhenBindingIk},null,8,["checked"]),Pe(o,{sep:""}),Pe(o,{title:"Stretch Joint: Keep Both Ends of Clay Nodes Unchanged",onClick:e[6]||(e[6]=w=>i.editorCtx.options.keepBothEndsOfClayNodesWhenStretching=!i.editorCtx.options.keepBothEndsOfClayNodesWhenStretching),checked:i.editorCtx.options.keepBothEndsOfClayNodesWhenStretching},null,8,["checked"])]),_:1}),Pe(a,{title:"View"},{default:Ht(()=>[Pe(o,{title:"Window"},{default:Ht(()=>[Pe(a,null,{default:Ht(()=>[Pe(o,{title:"Tools",checked:i.uiOptions.showTools,onClick:e[7]||(e[7]=w=>i.uiOptions.showTools=!i.uiOptions.showTools)},null,8,["checked"]),Pe(o,{title:"Nodes Panel",checked:i.uiOptions.showModelTree,onClick:e[8]||(e[8]=w=>i.uiOptions.showModelTree=!i.uiOptions.showModelTree)},null,8,["checked"]),Pe(o,{title:"Properties Panel",checked:i.uiOptions.showProperties,onClick:e[9]||(e[9]=w=>i.uiOptions.showProperties=!i.uiOptions.showProperties)},null,8,["checked"]),Pe(o,{title:"Status Bar",checked:i.uiOptions.showStatusBar,onClick:e[10]||(e[10]=w=>i.uiOptions.showStatusBar=!i.uiOptions.showStatusBar)},null,8,["checked"])]),_:1})]),_:1}),Pe(o,{sep:""}),Pe(o,{title:"Quad Views",checked:i.editorCtx.options.quadView,onClick:e[11]||(e[11]=w=>i.editorCtx.options.quadView=!i.editorCtx.options.quadView)},null,8,["checked"]),Pe(o,{title:"Outline Selected",checked:i.editorCtx.options.outlineSelected,onClick:e[12]||(e[12]=w=>i.editorCtx.options.outlineSelected=!i.editorCtx.options.outlineSelected)},null,8,["checked"]),Pe(o,{sep:""}),Pe(o,{title:"Grids",checked:i.editorCtx.options.showGrids,onClick:e[13]||(e[13]=w=>i.editorCtx.options.showGrids=!i.editorCtx.options.showGrids)},null,8,["checked"]),Pe(o,{title:"Light Indicators",checked:i.editorCtx.options.showLightHelpers,onClick:e[14]||(e[14]=w=>i.editorCtx.options.showLightHelpers=!i.editorCtx.options.showLightHelpers)},null,8,["checked"]),Pe(o,{title:"IK Joint Indicators",checked:i.editorCtx.options.showIkBones,onClick:e[15]||(e[15]=w=>i.editorCtx.options.showIkBones=!i.editorCtx.options.showIkBones)},null,8,["checked"])]),_:1}),Pe(a,{title:"Sketchfab","dynamic-size":""},{default:Ht(()=>[he("div",ZG,[i.sketchfabClient.token.accessToken?(Se(),ke(At,{key:0},[he("div",QG,[ml(he("input",{type:"text",placeholder:"Sketchfab Model URL",style:{"margin-right":"4px",width:"260px"},"onUpdate:modelValue":e[16]||(e[16]=w=>i.sketchfabModelUrl=w),onKeydown:e[17]||(e[17]=Sn((...w)=>i.onSketchfabImportModel&&i.onSketchfabImportModel(...w),["enter"]))},null,544),[[bM,i.sketchfabModelUrl]]),he("button",{class:"normal-button",style:{"font-size":"8px",padding:"2px 6px"},onClick:e[18]||(e[18]=(...w)=>i.onSketchfabImportModel&&i.onSketchfabImportModel(...w))}," Import ")]),he("div",JG,[eW,he("div",tW,rn(i.sketchfabClient.user.displayName),1),he("button",{class:"normal-button",onClick:e[19]||(e[19]=(...w)=>i.onSketchfabLogout&&i.onSketchfabLogout(...w)),style:{"font-size":"8px",padding:"2px 6px"}}," Logout ")])],64)):(Se(),ke("button",{key:1,class:"normal-button",onClick:e[20]||(e[20]=(...w)=>i.onSketchfabLogin&&i.onSketchfabLogin(...w))}," Sketchfab Login "))])]),_:1}),Pe(a,{title:"Camera","dynamic-size":""},{default:Ht(()=>[he("div",nW,[he("div",iW,[sW,Pe(l,{style:{width:"4em","margin-right":"8px"},min:4,max:90,value:i.editorCtx.model.cameraFov,onInput:e[21]||(e[21]=w=>i.editorCtx.model.cameraFov=w)},null,8,["value"]),Pe(c,{label:"Orthographic",value:!i.editorCtx.model.cameraPerspective,onInput:e[22]||(e[22]=w=>i.editorCtx.model.cameraPerspective=!w)},null,8,["value"])]),he("div",rW,[(Se(!0),ke(At,null,ro(i.editorCtx.model.cameras,w=>(Se(),ke("div",oW,[he("div",{class:"name normal-button",onClick:T=>i.onLoadCamera(w)},rn(w.name),9,aW),he("button",{class:"icon-button",onClick:e[23]||(e[23]=T=>i.onDeleteCamera(i.i))},"\xD7")]))),256))]),he("button",{class:"normal-button",style:{width:"100%","margin-top":"4px"},onClick:e[24]||(e[24]=(...w)=>i.onSaveCamera&&i.onSaveCamera(...w))}," Save Current ")])]),_:1}),Pe(a,{title:"About","dynamic-size":""},{default:Ht(()=>[lW]),_:1}),he("button",{class:"popup-menu-trigger",onClick:e[25]||(e[25]=(...w)=>i.onOpenTutorial&&i.onOpenTutorial(...w)),style:{cursor:"pointer"}}," Tutorial "),i.editorCtx.tool.sculpt?(Se(),ke(At,{key:0},[cW,Pe(u,{style:{"margin-right":"6px"},value:i.editorCtx.tool.brushRadius,"onUpdate:value":e[26]||(e[26]=w=>i.editorCtx.tool.brushRadius=w),label:"Radius",min:1,max:200,step:1,"fraction-digits":0},null,8,["value"]),i.editorCtx.tool.hasHardness?(Se(),Bt(u,{key:0,style:{"margin-right":"6px"},value:i.editorCtx.tool.brushHardness,"onUpdate:value":e[27]||(e[27]=w=>i.editorCtx.tool.brushHardness=w),label:"Hardness",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"])):Qe("",!0),Pe(u,{style:{"margin-right":"2px"},value:i.editorCtx.tool.brushStrength,"onUpdate:value":e[28]||(e[28]=w=>i.editorCtx.tool.brushStrength=w),label:"Strength",min:.01,max:1,step:.01,"fraction-digits":2},null,8,["value","min","step"]),he("button",{class:en(["normal-button toggle-button",{active:i.editorCtx.options.enablePressure}]),title:"Enable Tablet Pressure Sensitivity",style:{"margin-right":"6px",padding:"0"},onClick:e[29]||(e[29]=w=>i.editorCtx.options.enablePressure=!i.editorCtx.options.enablePressure)},hW,2),he("button",{class:en(["normal-button toggle-button",{active:i.editorCtx.tool.frontFacesOnly}]),title:"Front Faces Only",style:{"margin-right":"6px",padding:"0"},onClick:e[30]||(e[30]=w=>i.editorCtx.tool.frontFacesOnly=!i.editorCtx.tool.frontFacesOnly)},fW,2),i.editorCtx.tool.hasDirection?(Se(),ke("div",pW,[he("button",{class:en(["normal-button toggle-button",{active:i.editorCtx.tool.brushDirection===1}]),style:{padding:"0"},onClick:e[31]||(e[31]=w=>i.editorCtx.tool.brushDirection=1)},gW,2),i.editorCtx.tool.hasThirdDirection?(Se(),ke("button",{key:0,class:en(["normal-button toggle-button",{active:i.editorCtx.tool.brushDirection===0}]),style:{padding:"0"},onClick:e[32]||(e[32]=w=>i.editorCtx.tool.brushDirection=0)},yW,2)):Qe("",!0),he("button",{class:en(["normal-button toggle-button",{active:i.editorCtx.tool.brushDirection===-1}]),style:{padding:"0"},onClick:e[33]||(e[33]=w=>i.editorCtx.tool.brushDirection=-1)},bW,2)])):Qe("",!0),i.canRemesh?(Se(),Bt(a,{key:2,title:"Remesh","class-name":"normal-button dropdown"},{default:Ht(()=>[he("div",wW,[he("div",xW,[MW,Pe(l,{class:"value",style:{width:"6em"},min:1e-4,max:1,value:i.editorCtx.options.remeshVoxelSize,onInput:e[34]||(e[34]=w=>i.editorCtx.options.remeshVoxelSize=w)},null,8,["min","value"]),AW]),he("button",{class:"normal-button",style:{width:"100%"},onClick:e[35]||(e[35]=(...w)=>i.onRemesh&&i.onRemesh(...w))}," Remesh ")])]),_:1})):Qe("",!0)],64)):Qe("",!0),SW,he("div",CW,[he("button",{class:en(["normal-button toggle-button",{active:i.editorCtx.options.shadingMode==="solid"}]),title:"Shadow Off",style:{padding:"0"},onClick:e[36]||(e[36]=w=>i.editorCtx.options.shadingMode="solid")},EW,2),he("button",{class:en(["normal-button toggle-button",{active:i.editorCtx.options.shadingMode==="rendered"}]),title:"Shadow On",style:{padding:"0"},onClick:e[37]||(e[37]=w=>i.editorCtx.options.shadingMode="rendered")},RW,2)])],64)):Qe("",!0)]),he("div",IW,[i.uiOptions.showTools?(Se(),ke("div",DW,[he("div",LW,[i.editorCtx?(Se(),ke("div",kW,[(Se(!0),ke(At,null,ro(i.editorCtx.tools,w=>(Se(),ke(At,null,[w.sep?(Se(),ke("hr",OW)):Qe("",!0),w.sep?Qe("",!0):(Se(),ke("button",{key:1,class:en(["tool icon-button toggle-button",{active:i.editorCtx.tool===w}]),title:w.label,onClick:T=>i.editorCtx.tool=w},[he("img",{src:w.icon,alt:""},null,8,FW)],10,NW))],64))),256))])):Qe("",!0)])])):Qe("",!0),i.uiOptions.showModelTree?(Se(),Bt(f,{key:1,direction:"right",width:i.uiOptions.modelTreePanelWidth,"onUpdate:width":e[40]||(e[40]=w=>i.uiOptions.modelTreePanelWidth=w),style:{"border-left":"none"}},{default:Ht(()=>[i.editorCtx?(Se(),ke("div",zW,[he("div",{class:"toolbar",onClick:e[39]||(e[39]=mn(w=>i.onSelect([]),["self"]))},[Pe(a,{title:"Add",disabled:!i.validChildNodeDefs.length},{default:Ht(()=>[(Se(!0),ke(At,null,ro(i.validChildNodeDefs,w=>(Se(),Bt(o,{key:w.name,title:w.label,icon:w.icon,onClick:T=>i.onAddNode(w.name)},null,8,["title","icon","onClick"]))),128))]),_:1},8,["disabled"]),he("button",{disabled:!i.canDelete,onClick:e[38]||(e[38]=(...w)=>i.onDelete&&i.onDelete(...w))}," Delete ",8,BW)]),Pe(d,{class:"fill",model:i.editorCtx.model,onSelect:i.onSelect,onSetValue:i.onSetValue,onMoveNode:i.onMoveNode,onFocus:i.onFocus,onCut:i.onCut,onCopy:i.onCopy,onPaste:i.onPaste,onDelete:i.onDelete,onConvertToClay:i.onConvertToClay,onApplyTransformation:i.onApplyTransformation,onCreateInstance:i.onCreateInstance,onFlip:i.onFlip,onCopyPose:i.onCopyPose,onPastePose:i.onPastePose},null,8,["model","onSelect","onSetValue","onMoveNode","onFocus","onCut","onCopy","onPaste","onDelete","onConvertToClay","onApplyTransformation","onCreateInstance","onFlip","onCopyPose","onPastePose"])])):Qe("",!0)]),_:1},8,["width"])):Qe("",!0),i.uiOptions.showProperties?(Se(),Bt(f,{key:2,direction:"right",width:i.uiOptions.modelNodePropertiesPanelWidth,"onUpdate:width":e[41]||(e[41]=w=>i.uiOptions.modelNodePropertiesPanelWidth=w),style:{"border-left":"none"}},{default:Ht(()=>[i.editorCtx?(Se(),Bt(p,{key:0,"editor-context":i.editorCtx,onSetData:i.onSetNodesProperties},null,8,["editor-context","onSetData"])):Qe("",!0)]),_:1},8,["width"])):Qe("",!0),Pe(g,{class:"fill","editor-context":i.editorCtx,"quad-view":(_=(b=i.editorCtx)==null?void 0:b.options)==null?void 0:_.quadView,"main-view":(x=i.editorCtx)==null?void 0:x.mainViewIndex,onMounted:i.onCanvasMounted,onBeforeUnmount:i.onBeforeCanvasUnmount,onSetView:i.onSetView},null,8,["editor-context","quad-view","main-view","onMounted","onBeforeUnmount","onSetView"])]),i.uiOptions.showStatusBar&&i.editorCtx?(Se(),ke("div",UW,[he("div",null,rn(i.editorCtx.statusBarMessage),1),VW,he("div",null,"FPS: "+rn(i.editorCtx.fps),1)])):Qe("",!0)],544),i.editorCtx?(Se(),Bt(v,{key:0,title:"Color",visible:i.editorCtx.tool.hasColor,x:i.uiOptions.colorPanelX,"onUpdate:x":e[52]||(e[52]=w=>i.uiOptions.colorPanelX=w),y:i.uiOptions.colorPanelY,"onUpdate:y":e[53]||(e[53]=w=>i.uiOptions.colorPanelY=w)},{default:Ht(()=>[Pe(m,{value:i.editorCtx.options.paintColor,"onUpdate:value":e[51]||(e[51]=w=>i.editorCtx.options.paintColor=w),"color-box":""},null,8,["value"])]),_:1},8,["visible","x","y"])):Qe("",!0),i.downloadProgressDialog?(Se(),Bt(v,{key:1,visible:i.downloadProgressDialog,modal:"",title:"Downloading"},{default:Ht(()=>[he("div",HW,[he("div",GW,[he("div",{class:"progress",style:En({width:`${i.downloadProgressPercent}%`})},null,4),he("div",WW,rn(i.downloadProgressText)+" / "+rn(i.downloadTotalText),1)]),he("button",{class:"normal-button",onClick:e[54]||(e[54]=w=>i.downloadCancelFlag=!0)},"Cancel")])]),_:1},8,["visible"])):Qe("",!0),i.fullscreenLoading?(Se(),Bt(y,{key:2})):Qe("",!0)],64)}h(jW,"_sfc_render");var $W=Dt(UG,[["render",jW],["__scopeId","data-v-381541ad"]]);const XW=UP({history:nP(),routes:[{path:"/:pathMatch(.*)",component:$W}]}),sy=wM(OE),iT=new k0;sy.config.errorHandler=function(i,e,t){iT.dispatch(i)};sy.provide("errorSignal",iT);sy.use(XW).mount("#app");
//# sourceMappingURL=index.3dd2b285.js.map
